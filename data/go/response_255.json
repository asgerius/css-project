[{"tags": ["sql", "go", "protocol-buffers", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "edited": false, "score": 0, "creation_date": 1574977154, "post_id": 59082330, "comment_id": 104426171, "body": "Appreciate your response! &#39;If you make your gRPC package dependent on a database&#39; - good point, I&#39;ll move this logic out of gRPC package."}], "tags": [], "owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "is_accepted": true, "score": 2, "last_activity_date": 1574919423, "creation_date": 1574919423, "answer_id": 59082330, "question_id": 59079565, "link": "https://stackoverflow.com/questions/59079565/how-to-use-scan-and-value-when-working-with-sql-and-grpc/59082330#59082330", "title": "How to use Scan and Value when working with SQL and gRPC?", "body": "<p>The scanner and valuer interfaces are not really things you'll use yourself, not when it comes to storing custom types in a DB, at least. I'll first cover the use of the <code>Scan()</code> and <code>Value()</code> functions, then I'll address your issues.</p>\n\n<p>When you get a <code>sql.Row</code> result, and want to assign (scan) the values from the result set into your variables of a custom type. The docs show the <code>sql.Row.Scan()</code> function takes 0 or more arguments of type <code>interface{}</code>, basically anything. (<a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\">check docs here</a>).</p>\n\n<p>In the list of supported types into which values can be scanned, the last line is the important one:</p>\n\n<blockquote>\n  <p>any type implementing Scanner (see Scanner docs)</p>\n</blockquote>\n\n<p>With the function <code>func (ts *Timestamp) Scan(value interface{}) error {</code>, the <code>Timestamp</code> type now implements the <code>Scanner</code> interface, thus allowing <code>sql.Row</code> to assign values to this type. The documentation for the <code>Scanner</code> interface is located right below the docs for <code>Scan()</code>, which I linked above.</p>\n\n<p>Of course, that helps you to read values from the DB, gets you nowhere when it comes to storing these types. For that, you need the <code>Valuer</code> interface. In case you haven't guessed it yet, the <code>func (ts Timestamp) Value() (driver.Value, error)</code> function indeed makes it so your <code>Timestamp</code> type implements this interface. The documentation for the <code>driver.Valuer</code> interface can be found <a href=\"https://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"nofollow noreferrer\">here</a>, all the way at the bottom.</p>\n\n<p>The point of the <code>Valuer</code> interface is to allow a way to convert <em>any</em> type to a <code>driver.Value</code>, that the driver can work with and store in the DB (again: <a href=\"https://golang.org/pkg/database/sql/driver/#Value\" rel=\"nofollow noreferrer\">docs here</a>).</p>\n\n<hr>\n\n<h2>Fixing the issues</h2>\n\n<p>First up, I'm goign to have to assume your protoc output is written to the <code>v1</code> package. If it isn't, it's not going to work very well for you.</p>\n\n<p>The offending line is indeed the one you marked out:</p>\n\n<pre><code>u.CreatedAt = time.Now()\n</code></pre>\n\n<p>First up, <code>User.CreatedAt</code> is of type <code>Timestamp</code>, which is in and of itself a message containing a single timestamp. To set the <code>CreatedAt</code> time to <code>time.Now()</code>, you need to initialise the <code>CreatedAt</code> field correctly:</p>\n\n<pre><code>u.CreatedAt = &amp;Timestamp{\n    Timestamp: ptypes.TimestampNow(), // this returns a PROTOBUF TYPE!\n}\n</code></pre>\n\n<p>You <em>are</em> doing this in your <code>Scan</code> and <code>Value</code>  functions already, so I really don't get why you didn't do it here...</p>\n\n<hr>\n\n<h2>Advice</h2>\n\n<p>If the protoc output is indeed written to the <code>v1</code> package, I really, really would remove the <code>User.Create()</code> function. In fact, I'd outright kill it. Your protocol buffers are used for communication. Exposing your program via RPC's. It's an API. These <code>message</code> types are essentially request and response objects (glorified DTO's if you will). You're adding this <code>Create</code> function to it, which turns them into AR types. It makes your protobuf package unusable. The beauty of gRPC is that you generate golang, C++, Python, ... code that others can use to call your program. If you make your gRPC package dependent on a database, as you are doing, I personally would never, ever use it.</p>\n"}], "owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 751, "favorite_count": 0, "accepted_answer_id": 59082330, "answer_count": 1, "score": 1, "last_activity_date": 1574919423, "creation_date": 1574895680, "question_id": 59079565, "link": "https://stackoverflow.com/questions/59079565/how-to-use-scan-and-value-when-working-with-sql-and-grpc", "title": "How to use Scan and Value when working with SQL and gRPC?", "body": "<p>Could someone explain how to properly use <code>Scan()</code> and <code>Value()</code> in the following example?</p>\n\n<p>I'm trying to make use of the following examples:</p>\n\n<ul>\n<li><a href=\"https://github.com/jinzhu/gorm/issues/2017#issuecomment-537627961\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/issues/2017#issuecomment-537627961</a></li>\n<li><a href=\"https://github.com/travisjeffery/proto-go-sql/blob/master/_example/person_sql.go\" rel=\"nofollow noreferrer\">https://github.com/travisjeffery/proto-go-sql/blob/master/_example/person_sql.go</a></li>\n</ul>\n\n<p>My proto:</p>\n\n<pre><code>message Timestamp {\n  google.protobuf.Timestamp timestamp = 1;\n}\nmessage User {\n  uint32 ID = 1;\n  Timestamp createdAt = 2;\n}\n</code></pre>\n\n<p>Code (need to fix <code>time.Now()</code>):</p>\n\n<pre><code>package v1\n\nimport (\n        \"database/sql/driver\"\n        \"fmt\"\n        \"time\"\n\n        \"github.com/golang/protobuf/ptypes\"\n)\n\nfunc (u *User) Create() {\n  u.CreatedAt = time.Now() // FIXME: ERROR. How do I make use of Scan() and Value() here?\n\n  // saving to SQL database\n}\n\nfunc (ts *Timestamp) Scan(value interface{}) error {\n    switch t := value.(type) {\n    case time.Time:\n            var err error\n            ts.Timestamp, err = ptypes.TimestampProto(t)\n            if err != nil {\n                    return err\n            }\n    default:\n            return fmt.Errorf(\"Not a protobuf Timestamp\")\n    }\n    return nil\n}\n\nfunc (ts Timestamp) Value() (driver.Value, error) {\n        return ptypes.Timestamp(ts.Timestamp)\n}\n</code></pre>\n"}, {"tags": ["go", "package", "heap", "priority-queue"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1574893132, "post_id": 59078929, "comment_id": 104395453, "body": "See the <a href=\"https://godoc.org/container/heap#example-package--PriorityQueue\" rel=\"nofollow noreferrer\">example in the documentation</a>."}, {"owner": {"reputation": 31, "user_id": 10909235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065da3be4fe8e45a9bd1a86bac2562ab?s=128&d=identicon&r=PG&f=1", "display_name": "paartrk", "link": "https://stackoverflow.com/users/10909235/paartrk"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1574893812, "post_id": 59078929, "comment_id": 104395693, "body": "That&#39;s what I was confused about, just like how in this example how they create the push, pop, len .etc functions, every time you wanted to use a heap would you have to write those functions as well or could you just call it from the heap package?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1574900485, "post_id": 59078929, "comment_id": 104397259, "body": "See the <a href=\"https://godoc.org/container/heap#Interface\" rel=\"nofollow noreferrer\">Interface</a> documentation.  The application provides simple operations for accessing the underlying data.  The heap package uses those operations to implement heap semantics."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574916191, "post_id": 59078929, "comment_id": 104400246, "body": "@paartrk Yes, of course."}, {"owner": {"reputation": 53801, "user_id": 463785, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/7eddc694f2de624abcae48bcef3d736b?s=128&d=identicon&r=PG", "display_name": "tugberk", "link": "https://stackoverflow.com/users/463785/tugberk"}, "edited": false, "score": 0, "creation_date": 1598221113, "post_id": 59078929, "comment_id": 112379561, "body": "You can see the usage of <code>container&#47;heap</code> package in this post along with some example usage: <a href=\"http://www.tugberkugurlu.com/archive/usage-of-the-heap-data-structure-in-go-golang-with-examples\" rel=\"nofollow noreferrer\">tugberkugurlu.com/archive/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2375, "user_id": 4383715, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/xUzxb.png?s=128&g=1", "display_name": "PumpkinSeed", "link": "https://stackoverflow.com/users/4383715/pumpkinseed"}, "is_accepted": false, "score": 2, "last_activity_date": 1574894058, "last_edit_date": 1574894058, "creation_date": 1574893741, "answer_id": 59079297, "question_id": 59078929, "link": "https://stackoverflow.com/questions/59078929/how-do-you-use-the-heap-package-in-go/59079297#59079297", "title": "How do you use the heap package in Go?", "body": "<p>There is the heap.Interface what you should implement first.</p>\n\n<pre><code>type Interface interface {\n    sort.Interface\n    Push(x interface{}) // add x as element Len()\n    Pop() interface{}   // remove and return element Len() - 1.\n}\n</code></pre>\n\n<p>This means you should have the necessary methods for your PriorityMessage struct. After you pass the instance of the struct into the heap.Init(&amp;pm).</p>\n\n<p>You can find details in the <a href=\"https://godoc.org/container/heap#example-package--PriorityQueue\" rel=\"nofollow noreferrer\">godoc</a> as linked in the comments.</p>\n\n<p>Just to clarify the confusion. Go is a strongly typed language with lack of generics. So the heap package designed on the way that it's type independent. You can create your own implementation for all of the types what you want to implement. Any type implements the heap.Interface can be used by the heap package.</p>\n"}], "owner": {"reputation": 31, "user_id": 10909235, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/065da3be4fe8e45a9bd1a86bac2562ab?s=128&d=identicon&r=PG&f=1", "display_name": "paartrk", "link": "https://stackoverflow.com/users/10909235/paartrk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2014, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574894058, "creation_date": 1574891491, "question_id": 59078929, "link": "https://stackoverflow.com/questions/59078929/how-do-you-use-the-heap-package-in-go", "title": "How do you use the heap package in Go?", "body": "<p>I've been trying to use the Heap package in Go and I am not sure on how to initialize it. </p>\n\n<pre><code>package main\nimport \"container/heap\"\n\ntype PriorityMessage struct {\n    Priority int\n    Message string\n}\n\nfunc priorityQueue() {\n    //WOULD THIS not initialize the heap?\n    h := heap.Init(h PriorityMessage)\n\n}\n</code></pre>\n\n<p>I've been trying to find examples online of how other's initialized their heaps and all of them seem to create their own versions of the Go heap package everytime. Would calling the heap.Init(h Interface) function from the heap package not work? </p>\n"}, {"tags": ["arrays", "algorithm", "go", "recursion", "matrix"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574891347, "post_id": 59078358, "comment_id": 104394868, "body": "do you mind sharing your test suite ?"}, {"owner": {"reputation": 683, "user_id": 7612336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oFuR0TTik5I/AAAAAAAAAAI/AAAAAAAABYg/pxpjxgm2Lvc/photo.jpg?sz=128", "display_name": "DavSanchez", "link": "https://stackoverflow.com/users/7612336/davsanchez"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574891507, "post_id": 59078358, "comment_id": 104394936, "body": "I&#39;m afraid I cannot @mh-cbon, I am doing the exercise through a website (LeetCode) and they only output the specific test case that made the whole suite fail :("}], "answers": [{"comments": [{"owner": {"reputation": 683, "user_id": 7612336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oFuR0TTik5I/AAAAAAAAAAI/AAAAAAAABYg/pxpjxgm2Lvc/photo.jpg?sz=128", "display_name": "DavSanchez", "link": "https://stackoverflow.com/users/7612336/davsanchez"}, "edited": false, "score": 0, "creation_date": 1574899098, "post_id": 59079464, "comment_id": 104396996, "body": "Ah I see! That would make my use of pointers for the score slice useless, right? I tried removing it but it outputs 0 points... anyway, I left the pointer there and it seems to have passed the previous test. Now I\u2019ll have to solve the time limit exceeding for the large matrices in the test suite... \ud83d\ude05 Thanks a lot!"}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 683, "user_id": 7612336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oFuR0TTik5I/AAAAAAAAAAI/AAAAAAAABYg/pxpjxgm2Lvc/photo.jpg?sz=128", "display_name": "DavSanchez", "link": "https://stackoverflow.com/users/7612336/davsanchez"}, "edited": false, "score": 1, "creation_date": 1574899731, "post_id": 59079464, "comment_id": 104397129, "body": "Not completly (re pointers to slices). It you append to a slice and it needs to grow (lookup cap) then you get back a totally new slice (meaning that any changes will not impact the callers copy). In your code you do call append on vals so should pass it as a pointer. see <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">blog.golang.org/slices</a> for more info on this."}, {"owner": {"reputation": 683, "user_id": 7612336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oFuR0TTik5I/AAAAAAAAAAI/AAAAAAAABYg/pxpjxgm2Lvc/photo.jpg?sz=128", "display_name": "DavSanchez", "link": "https://stackoverflow.com/users/7612336/davsanchez"}, "edited": false, "score": 0, "creation_date": 1574948937, "post_id": 59079464, "comment_id": 104415233, "body": "Yeah, I imagined it was because of that. Thanks!"}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 1, "last_activity_date": 1574895021, "creation_date": 1574895021, "answer_id": 59079464, "question_id": 59078358, "link": "https://stackoverflow.com/questions/59078358/matrix-traversal-not-doing-optimal-path/59079464#59079464", "title": "Matrix traversal not doing optimal path", "body": "<p>The parameter you are using to <code>traverseAndCollectTopDown</code> / <code>traverseAndCollectBottomUp</code> is a <code>grid [][]int</code>. You are modifying that and then passing it directly into other functions (recursively). In go a slice is effectively <a href=\"https://golang.org/doc/faq#references\" rel=\"nofollow noreferrer\">passed by reference</a> meaning that when one of your routines edits the slice this impacts the slice held by all of the other routines too (so as soon as one path finds a '1' it gets removed and another path going through the same cell will find a '0' there).</p>\n\n<p>To fix this take a copy of grid before making a recursive call e.g. call <code>grid = copyGrid(grid)</code> in <code>traverseAndCollectTopDown</code> / <code>traverseAndCollectBottomUp</code> before modifying grid.</p>\n\n<pre><code>func copyGrid(in [][]int) [][]int {\n    duplicate := make([][]int, len(in))\n    for i := range in {\n        duplicate[i] = make([]int, len(in[i]))\n        copy(duplicate[i], in[i])\n    }\n    return duplicate \n}\n</code></pre>\n"}], "owner": {"reputation": 683, "user_id": 7612336, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-oFuR0TTik5I/AAAAAAAAAAI/AAAAAAAABYg/pxpjxgm2Lvc/photo.jpg?sz=128", "display_name": "DavSanchez", "link": "https://stackoverflow.com/users/7612336/davsanchez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 59079464, "answer_count": 1, "score": 0, "last_activity_date": 1574895021, "creation_date": 1574888412, "last_edit_date": 1592644375, "question_id": 59078358, "link": "https://stackoverflow.com/questions/59078358/matrix-traversal-not-doing-optimal-path", "title": "Matrix traversal not doing optimal path", "body": "<p>I have encountered the following problem that I am attempting to solve:</p>\n<blockquote>\n<p>In a N x N <code>grid</code> representing a field of cherries, each cell is one of three possible integers.</p>\n<ul>\n<li>0 means the cell is empty, so you can pass through;</li>\n<li>1 means the cell contains a cherry, that you can pick up and pass through;</li>\n<li>-1 means the cell contains a thorn that blocks your way.</li>\n</ul>\n<p>Your task is to collect maximum number of cherries possible by following the rules below:</p>\n<ul>\n<li>Starting at the position (0, 0) and reaching (N-1, N-1) by moving right or down through valid path cells (cells with &gt; value 0 or 1);</li>\n<li>After reaching (N-1, N-1), returning to (0, 0) by moving left or up through valid path cells;</li>\n<li>When passing through a path cell containing a cherry, you pick it up and the cell becomes an empty cell (0);</li>\n<li>If there is no valid path between (0, 0) and (N-1, N-1), then no cherries can be collected.</li>\n</ul>\n<pre><code>Example 1:\n\nInput: grid =\n[[0, 1, -1],\n [1, 0, -1],\n [1, 1,  1]]\n\nOutput: 5\n\nExplanation: \nThe player started at (0, 0) and went down, down, right right to reach (2, 2).\n4 cherries were picked up during this single trip, and the matrix becomes [[0,1,-1],[0,0,-1],[0,0,0]].\nThen, the player went left, up, up, left to return home, picking up one more cherry.\nThe total number of cherries picked up is 5, and this is the maximum possible.\n</code></pre>\n<p>Note:</p>\n<ul>\n<li><code>grid</code> is an <code>N</code> by <code>N</code> 2D array, with <code>1 &lt;= N &lt;= 50</code>.</li>\n<li>Each <code>grid[i][j]</code> is an integer in the set <code>{-1, 0, 1}</code>.</li>\n<li>It is guaranteed that grid[0][0] and grid[N-1][N-1] are not -1.</li>\n</ul>\n</blockquote>\n<p>So I need to write a function <code>cherryPickup</code> that takes a grid and returns the maximum score.</p>\n<p>My first suboptimal attempt (written in Go) is the following, which supposedly would try to walk every possible path, storing the score in a slice upon round-trip path completion, and then return the greatest score present in the slice:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>func cherryPickup(grid [][]int) int {\n\n    values := []int{}\n    pVals := &amp;values\n    finalPoints := 0\n\n    // Begin top-down path\n    traverseAndCollectTopDown(grid, 0, 0, 0, pVals)\n\n    // Find max value in slice\n    for i, pathPoints := range values {\n        if i == 0 || pathPoints &gt; finalPoints {\n            finalPoints = pathPoints\n        }\n    }\n\n    return finalPoints\n}\n\nfunc isTraversable(grid [][]int, x, y int) bool {\n    return (grid[x][y] != -1)\n}\n\nfunc isOnBounds(grid [][]int, x, y int) bool {\n    return (x &lt; len(grid) &amp;&amp; y &lt; len(grid[0]) &amp;&amp; x &gt;= 0 &amp;&amp; y &gt;= 0)\n}\n\nfunc traverseAndCollectTopDown(grid [][]int, x, y, points int, vals *[]int) {\n\n    // Collect point before continuing\n    if grid[x][y] == 1 {\n        grid[x][y] = 0\n        points++\n    }\n\n    // If reached bottom, begin bottom-up path\n    if (x == len(grid)-1) &amp;&amp; (y == len(grid[0])-1) {\n        traverseAndCollectBottomUp(grid, x, y, points, vals)\n        return\n    }\n\n    // Go Down\n    if isOnBounds(grid, x+1, y) &amp;&amp; isTraversable(grid, x+1, y) {\n        traverseAndCollectTopDown(grid, x+1, y, points, vals)\n    }\n    // Go Right\n    if isOnBounds(grid, x, y+1) &amp;&amp; isTraversable(grid, x, y+1) {\n        traverseAndCollectTopDown(grid, x, y+1, points, vals)\n    }\n\n}\n\nfunc traverseAndCollectBottomUp(grid [][]int, x, y, points int, vals *[]int) {\n\n    if grid[x][y] == 1 {\n        grid[x][y] = 0\n        points++\n    }\n\n    if x == 0 &amp;&amp; y == 0 {\n        *vals = append(*vals, points)\n        return\n    }\n\n    // Go Up\n    if isOnBounds(grid, x-1, y) &amp;&amp; isTraversable(grid, x-1, y) {\n        traverseAndCollectBottomUp(grid, x-1, y, points, vals)\n    }\n    // Go Left\n    if isOnBounds(grid, x, y-1) &amp;&amp; isTraversable(grid, x, y-1) {\n        traverseAndCollectBottomUp(grid, x, y-1, points, vals)\n    }\n}\n</code></pre>\n<p>Currently it passes a bunch of tests, but this one is failing and I don't know why.</p>\n<blockquote>\n<p>Input: <code>[[1,1,1,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,1],[1,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,0,0,0],[0,0,0,1,1,1,1]]</code></p>\n<p>Output: 10</p>\n<p>Expected: 15</p>\n</blockquote>\n<p>I get the way this grid must score the 15 points, however, why does my code fail to travel the winning path and only scores 10? Also, do you recommend any terminal utilities, programs or strategies to help visualize better what is happening on every run?</p>\n<p>Thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574890101, "post_id": 59078356, "comment_id": 104394423, "body": "I recommend you read <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">this</a> to better understand how slices work. Here&#39;s also a bit of commentary to go with your code <a href=\"https://play.golang.com/p/J_vWRsCd5rN\" rel=\"nofollow noreferrer\">play.golang.com/p/J_vWRsCd5rN</a>"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574890244, "post_id": 59078611, "comment_id": 104394478, "body": "it&#39;s <code>make([]record, 0)</code> not <code>new(recordType,0)</code>."}, {"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1574894652, "post_id": 59078611, "comment_id": 104395915, "body": "The answer is when building a new collection: set &quot;record = nil&quot; this assures"}, {"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1574894778, "post_id": 59078611, "comment_id": 104395961, "body": "the record is initialized by the new append statement. Now I get the desired db[0] collection1 and db[1] collection2.   THANKS EVERYONE FOR THE HELP"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1574890383, "last_edit_date": 1574890383, "creation_date": 1574889695, "answer_id": 59078611, "question_id": 59078356, "link": "https://stackoverflow.com/questions/59078356/appending-to-interface-problems-additonal-info/59078611#59078611", "title": "Appending to []interface{} problems --Additonal Info", "body": "<p>A slice is a view over an array. When you do:</p>\n\n<pre><code>record = record[:0]\n</code></pre>\n\n<p>You are not creating a new empty slice. You are still using the underlying array, with a new slice viewing it as a slice with a length of 0. As you append new elements to <code>record</code>, you are overwriting the underlying array elements.</p>\n\n<p>Replace the above statement with:</p>\n\n<pre><code>record = make([]recordType,0)\n</code></pre>\n\n<p>or</p>\n\n<pre><code>record= []recordType{}\n</code></pre>\n\n<p>to use a new slice for records.</p>\n"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 33, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574890383, "creation_date": 1574888399, "question_id": 59078356, "link": "https://stackoverflow.com/questions/59078356/appending-to-interface-problems-additonal-info", "title": "Appending to []interface{} problems --Additonal Info", "body": "<p>To followup on my last question, I have tried again:</p>\n\n<p>I create a collection of records (<strong>map[string]string</strong>)</p>\n\n<p>When I append two different collections to an interface slice:  <strong>var db []interface{}</strong></p>\n\n<p>what I expected is     <em>db[0] collection1 and db[1] collection2</em></p>\n\n<p>What I get is         <em>db[0] collection2 and db[1] collection2</em></p>\n\n<p><strong>The following is the active code:</strong></p>\n\n<pre><code>record = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\nrecord = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\nfmt.Println(\"Record 1: \", record)\ndb = append(db, record)\nfmt.Println(\"Database1 = \", db)\n\nrecord = record[:0]\nfmt.Println(\"Record: \", record)\nrecord = append(record, newWorkDataItem(\"FWT\", d, \"Left\", \"---\", \"15\", \"12.5\"))\nrecord = append(record, newWorkDataItem(\"FWT\", d, \"Right\", \"---\", \"15\", \"12.5\"))\n\nfmt.Println(\"Record 2: \", record)\ndb = append(db, record)\nfmt.Println(\"Database2 = \", db)\nfmt.Println(\"db[0] \", db[0])\nfmt.Println(\"db[1] \", db[1])\n</code></pre>\n\n<p><strong>The following is the Results:</strong></p>\n\n<pre><code>Record 1:  [map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5]]\n\nDatabase1 =  [[map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5]]]\n\nRecord:  []\n\nRecord 2:  [map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Right Weight:12.5]]\n\nDatabase2 =  [[map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Right Weight:12.5]] [map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Right Weight:12.5]]]\n\ndb[0]  [map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Right Weight:12.5]]\n\ndb[1]  [map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:15 Side:Right Weight:12.5]]\n</code></pre>\n\n<p>AS you can see by appending a new collection to 'db' seems to not only overwrite the first collection and then appends the new collection.  </p>\n\n<p>So we get collection2, collection2   NOT collection1, collection2</p>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1574885355, "post_id": 59077437, "comment_id": 104392608, "body": "<code>Is this the correct way</code>: it depends of your requirements/program intrinsic. <code>are there any other way to do the same ?</code> a million different ways, all as good as each other given the current description of your requirements."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1574884461, "creation_date": 1574884461, "answer_id": 59077608, "question_id": 59077437, "link": "https://stackoverflow.com/questions/59077437/to-start-kafka-consumer-and-an-http-server-in-parallel/59077608#59077608", "title": "To start Kafka consumer and an HTTP server in parallel?", "body": "<p>What you're doing is correct. If there is a chance <code>consumers.KafkaConsumer</code> could terminate with an error, you might want to handle that:</p>\n\n<pre><code>go func() {\n  log.Fatal(consumers.KafkaConsumer())\n}()\n</code></pre>\n\n<p>If not, then what you have is sufficient.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user9973079"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 59077608, "answer_count": 1, "score": -1, "last_activity_date": 1574885349, "creation_date": 1574883723, "last_edit_date": 1574885349, "question_id": 59077437, "link": "https://stackoverflow.com/questions/59077437/to-start-kafka-consumer-and-an-http-server-in-parallel", "title": "To start Kafka consumer and an HTTP server in parallel?", "body": "<p>Is there a way to start the go-server and kafka consumer parallely efficiently.\nWhat i am doing is below ?</p>\n\n<pre><code>go consumers.KafkaConsumer()\nrouter := router.NewRouter()\nlog.Fatal(http.ListenAndServe(\":8001\", router))\n</code></pre>\n\n<p>Is this the correct way or are there any other way to do the same ?</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1574876552, "post_id": 59075722, "comment_id": 104388893, "body": "&quot;The ? looks like the sql package is not even putting a value there but sending the question mark as is&quot; -- Yes, that&#39;s what it&#39;s meant to do. Parameter substitution happens server-side."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574876871, "post_id": 59075722, "comment_id": 104389051, "body": "I don&#39;t see anything obviously wrong with your code. Aside from the obvious (there&#39;s a syntax error, somewhere), I don&#39;t think there&#39;s enough here to help solve your problem. You&#39;ll need to do some more debugging on your side, to determine exactly which statement is generating the error, and then why."}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574877165, "post_id": 59075722, "comment_id": 104389179, "body": "Could the column type be the problem? SQL has <code>tinyint</code> and <code>float</code> set but I send <code>int</code> and <code>float32</code>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1574877284, "post_id": 59075722, "comment_id": 104389240, "body": "No, it&#39;s a syntax error. The column type isn&#39;t even considered yet at that stage of parsing."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1574878238, "post_id": 59075722, "comment_id": 104389666, "body": "Does sqlserver support <code>?</code> as a placeholder for the parameters? Or do you expect the driver to deal with that? What driver are you using btw?"}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574878338, "post_id": 59075722, "comment_id": 104389703, "body": "Hi @mkopriva we were just thinking about that with the placeholder. I am researching that right now. This is the driver I am using github.com/denisenkom/go-mssqldb"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574878603, "post_id": 59075722, "comment_id": 104389814, "body": "A quick <a href=\"https://github.com/denisenkom/go-mssqldb/search?q=insert+into&amp;unscoped_q=insert+into\" rel=\"nofollow noreferrer\">search</a> in that repo suggests that the syntax you&#39;re looking for is <code>insert into test (id, idstr) values (@p1, @p2)</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574878766, "post_id": 59075722, "comment_id": 104389892, "body": "It&#39;s actually mentioned in the readme <a href=\"https://github.com/denisenkom/go-mssqldb/blob/cfbb681360f0a7de54ae77703318f0e60d422e00/README.md#parameters\" rel=\"nofollow noreferrer\">github.com/denisenkom/go-mssqldb/blob/&hellip;</a>"}, {"owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574879636, "post_id": 59075722, "comment_id": 104390296, "body": "@mkopriva if you want to write an answer, I give you the credits."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1574879906, "post_id": 59075722, "comment_id": 104390410, "body": "@TheFool no need to, but please fix yours. <code>@x</code> by itself is invalid. You either need to use <code>@p1</code> to <code>@pN</code> where <code>N</code> is the total number of params. Or you can use <code>@x</code> but then you need to provide the param as <code>sql.Named(&quot;x&quot;, &lt;somevalue&gt;)</code>. (at least that&#39;s how I understand it, I may be wrong) Adding a link to the readme or some sql-server documentation would also be a nice addition."}], "answers": [{"tags": [], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "is_accepted": true, "score": 3, "last_activity_date": 1574881353, "last_edit_date": 1574881353, "creation_date": 1574878869, "answer_id": 59076348, "question_id": 59075722, "link": "https://stackoverflow.com/questions/59075722/sql-statement-exec-error-mssql-incorrect-syntax-near/59076348#59076348", "title": "sql statement.exec error: mssql: Incorrect syntax near &#39;?&#39;", "body": "<blockquote>\n  <p>The <a href=\"https://github.com/denisenkom/go-mssqldb#parameters\" rel=\"nofollow noreferrer\">sqlserver driver</a> uses normal MS SQL Server syntax and expects parameters in the sql query to be in the form of either @Name or @p1 to @pN (ordinal position).</p>\n</blockquote>\n\n<pre><code>insertSql := \"insert into test (id, idstr) values (@p1, @p2)\"\n</code></pre>\n\n<p><em>After some testing, I can confirm it works. It even works with sqlite3 so this seems to be a more widely accepted way.</em></p>\n"}], "owner": {"reputation": 2672, "user_id": 9208887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64b42a62830357a073f912ce786822e1?s=128&d=identicon&r=PG&f=1", "display_name": "The Fool", "link": "https://stackoverflow.com/users/9208887/the-fool"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 353, "favorite_count": 0, "accepted_answer_id": 59076348, "answer_count": 1, "score": 2, "last_activity_date": 1574881353, "creation_date": 1574876443, "last_edit_date": 1574876474, "question_id": 59075722, "link": "https://stackoverflow.com/questions/59075722/sql-statement-exec-error-mssql-incorrect-syntax-near", "title": "sql statement.exec error: mssql: Incorrect syntax near &#39;?&#39;", "body": "<p>I need help understanding this error. The code works with sqlite. The <code>?</code> looks like the sql package is not even putting a value there but sending the question mark as is.\nI can run other select statements without issues so its not a connection problem or something like that.</p>\n\n<p>Error: <strong>Incorrect syntax near '?'</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestSQLServerInsert(t *testing.T) {\n    db, err := sql.Open(\"sqlserver\", \"my_trusted_string\")\n    //db, err := sql.Open(\"sqlite3\", \"../data/utm_info.db\")\n\n    if err != nil {\n        t.Errorf(\"could not open database: %v\", err)\n    }\n    defer db.Close()\n\n    c := controller.NewC(db)\n    u := controller.UtilizationResponse{\n        Snapshot: []int{46, 22, 4, 4, 5, 3, 0, 8, 49},\n        History:  []float32{55.1, 47.2, 0.3, 33.4, 23.5},\n        Time:     time.Now(),\n    }\n\n    affectedRows, err := c.InsertUtil(u)\n    if err != nil {\n        t.Errorf(\"could not insert into db: %v\", err)\n    }\n    var count int64 = 1\n    assert.Equal(t, affectedRows, count)\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// InsertUtil response inserts a new record into the database\nfunc (c *Controller) InsertUtil(u UtilizationResponse) (rowsAffected int64, err error) {\n    return insertUtil(c.DB, u)\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func insertUtil(db *sql.DB, u UtilizationResponse) (int64, error) {\n    stmt, err := db.Prepare(\"INSERT INTO Utilization VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)\")\n    if err != nil {\n        return 0, err\n    }\n    res, err := stmt.Exec(\n        u.Time,\n        u.Snapshot[0],\n        u.Snapshot[1],\n        u.Snapshot[2],\n        u.Snapshot[3],\n        u.Snapshot[4],\n        u.Snapshot[5],\n        u.Snapshot[6],\n        u.Snapshot[7],\n        u.Snapshot[8],\n        u.History[0],\n        u.History[1],\n        u.History[2],\n        u.History[3],\n        u.History[4],\n    )\n    if err != nil {\n        return 0, err\n    }\n    rowCnt, err := res.RowsAffected()\n    if err != nil {\n        return 0, err\n    }\n    return rowCnt, nil\n}\n\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type UtilizationResponse struct {\n    Snapshot []int     `json:\"snapshot,omitempty\"`\n    History  []float32 `json:\"history,omitempty\"`\n    Time     time.Time `json:\"time,omitempty\"`\n}\n</code></pre>\n"}, {"tags": ["go", "horizon", "ginkgo", "stellar"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1574875668, "post_id": 59075348, "comment_id": 104388485, "body": "do you have psql installed on your system?"}, {"owner": {"reputation": 11, "user_id": 12447168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae702fc12bccbd01dc041fa43d43cc82?s=128&d=identicon&r=PG&f=1", "display_name": "sayoojmandodi", "link": "https://stackoverflow.com/users/12447168/sayoojmandodi"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1574923602, "post_id": 59075348, "comment_id": 104402469, "body": "psql has been installed"}], "owner": {"reputation": 11, "user_id": 12447168, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae702fc12bccbd01dc041fa43d43cc82?s=128&d=identicon&r=PG&f=1", "display_name": "sayoojmandodi", "link": "https://stackoverflow.com/users/12447168/sayoojmandodi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 28, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1574877041, "creation_date": 1574874873, "last_edit_date": 1574877041, "question_id": 59075348, "link": "https://stackoverflow.com/questions/59075348/things-to-be-taken-care-before-running-stellar-horizon-test-cases", "title": "Things to be taken care Before Running Stellar Horizon Test Cases", "body": "<p>I have cloned the Stellar Horizon Repo from GitHub written in Go.\nI thought to run the test cases first.where the test cases have been written by using GINKGO Testing Framework. I have been running the test cases using ginkgo command\neg : ginkgo (package path name will be given here). \nThis is how I run test cases. Test cases for particular package has been executing properly. \nBut I am getting a panic in the first test file only. Which I debugged and found that the panic is occurring while running a command. Please find the below details for reference .</p>\n\n<p>File name : <strong>action_accounts_test.go</strong>\nfunc name : TestAccountAction_Show() // Has been defined below</p>\n\n<pre><code>func TestAccountActions_Show(t *testing.T) {\n\n    ht := StartHTTPTest(t, \"allow_trust\") **// This function is not returning anything. Its //getting panic inside this //** \n    defer ht.Finish()\n    // existing account\n    w := ht.Get(\n        \"/accounts/GCXKG6RN4ONIEPCMNFB732A436Z5PNDSRLGWK7GBLCMQLIFO4S7EYWVU\",\n    )\n\n    if ht.Assert.Equal(200, w.Code) {\n        var result horizon.Account\n        err := json.Unmarshal(w.Body.Bytes(), &amp;result)\n        ht.Require.NoError(err)\n        ht.Assert.Equal(\"8589934593\", result.Sequence)\n\n        ht.Assert.NotEqual(0, result.LastModifiedLedger)\n        for _, balance := range result.Balances {\n            if balance.Type == \"native\" {\n                ht.Assert.Equal(uint32(0), balance.LastModifiedLedger)\n            } else {\n                ht.Assert.NotEqual(uint32(0), balance.LastModifiedLedger)\n            }\n        }\n    }\n\n    // missing account\n    w = ht.Get(\"/accounts/GDBAPLDCAEJV6LSEDFEAUDAVFYSNFRUYZ4X75YYJJMMX5KFVUOHX46SQ\")\n    ht.Assert.Equal(404, w.Code)\n}\n</code></pre>\n\n<p>I did a Debugging and found that its getting panic in the below func call which happens inside the above func <strong>StartHTTPTest()</strong></p>\n\n<pre><code>scenarios.Load(StellarCoreDatabaseURL(), stellarCorePath)\nscenarios.Load(DatabaseURL(), horizonPath)\n</code></pre>\n\n<p>Definition of the particular func </p>\n\n<pre><code>func Load(url string, path string) {\n\n    log.Println(\"database url\", url, \"   Path : \", path)\n    sql, err := Asset(path)\n    log.Println(\"Print err:\", err, \"  sql :\", sql)\n    if err != nil {\n        log.Panic(err)\n    }\n\n    reader := bytes.NewReader(sql)\n    cmd := exec.Command(\"psql\", url)\n    cmd.Stdin = reader\n\n    err = cmd.Run() **// Exactly here it return some error**\n    log.Println(\"Print err\", err)\n\n    if err != nil { **// Since err is not nil .the statement will get executed .**\n        **log.Panic(err)**\n    }\n}\n</code></pre>\n\n<p>The Error returned by <strong>cmd.Run()</strong> is  <strong>exit status 2</strong>\nI just printed the error and found this is the error <strong>exit status 2</strong></p>\n\n<p><strong>What is the reason for the particular error?</strong></p>\n"}, {"tags": ["go", "timing"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574872421, "post_id": 59074673, "comment_id": 104386828, "body": "What is <code>n</code> initialized to?"}, {"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 6, "creation_date": 1574872453, "post_id": 59074673, "comment_id": 104386847, "body": "<a href=\"https://progolang.com/how-to-write-benchmarks-in-go/\" rel=\"nofollow noreferrer\">progolang.com/how-to-write-benchmarks-in-go</a>"}, {"owner": {"reputation": 341, "user_id": 4232861, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/F0ayV.jpg?s=128&g=1", "display_name": "dogwood", "link": "https://stackoverflow.com/users/4232861/dogwood"}, "edited": false, "score": 0, "creation_date": 1574872672, "post_id": 59074673, "comment_id": 104386960, "body": "An integer input from console by user."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1574873120, "post_id": 59074673, "comment_id": 104387205, "body": "Okay, that&#39;s not an ideal way to do benchmarks. Read the blog linked above for the proper approach."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1574875257, "post_id": 59074673, "comment_id": 104388297, "body": "Use the built-in benchmarking system in the <code>testing</code> package for benchmarks."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1574893321, "last_edit_date": 1574893321, "creation_date": 1574876120, "answer_id": 59075645, "question_id": 59074673, "link": "https://stackoverflow.com/questions/59074673/am-i-doing-execution-timing-measurement-in-go-in-a-useful-way/59075645#59075645", "title": "Am I doing execution timing measurement in Go in a useful way?", "body": "<blockquote>\n  <p>what am I doing wrong and how can I make it right?</p>\n</blockquote>\n\n<hr>\n\n<p>Use the Go <a href=\"https://golang.org/pkg/testing/\" rel=\"nofollow noreferrer\"><code>testing</code></a> package for benchmarks. For example:</p>\n\n<hr>\n\n<p>Write the Fibonacci number computation as a function in your code.</p>\n\n<p><code>fibonacci.go</code>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// fibonacci returns the Fibonacci number for 0 &lt;= n &lt;= 92.\n// OEIS: A000045: Fibonacci numbers:\n// F(n) = F(n-1) + F(n-2) with F(0) = 0 and F(1) = 1.\nfunc fibonacci(n int) int64 {\n    if n &lt; 0 {\n        panic(\"n &lt; 0\")\n    }\n    f := int64(0)\n    a, b := int64(0), int64(1)\n    for i := 0; i &lt;= n; i++ {\n        if a &lt; 0 {\n            panic(\"overflow\")\n        }\n        f, a, b = a, b, a+b\n    }\n    return f\n}\n\nfunc main() {\n    for _, n := range []int{0, 1, 2, 3, 90, 91, 92} {\n        fmt.Printf(\"%-2d  %d\\n\", n, fibonacci(n))\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/FFdG4RlNpUZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FFdG4RlNpUZ</a></p>\n\n<p>Output:</p>\n\n<pre><code>$ go run fibonacci.go\n0   0\n1   1\n2   1\n3   2\n90  2880067194370816120\n91  4660046610375530309\n92  7540113804746346429\n$\n</code></pre>\n\n<hr>\n\n<p>Write and run some benchmarks using the Go <code>testing</code> package.</p>\n\n<p><code>fibonacci_test.go</code>:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc BenchmarkFibonacciN0(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fibonacci(0)\n    }\n}\n\nfunc BenchmarkFibonacciN92(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        fibonacci(92)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test fibonacci.go fibonacci_test.go -bench=. -benchmem\ngoos: linux\ngoarch: amd64\nBenchmarkFibonacciN0-4     367003574    3.25 ns/op   0 B/op   0 allocs/op\nBenchmarkFibonacciN92-4     17369262   63.0 ns/op    0 B/op   0 allocs/op\n$ \n</code></pre>\n"}], "owner": {"reputation": 341, "user_id": 4232861, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/F0ayV.jpg?s=128&g=1", "display_name": "dogwood", "link": "https://stackoverflow.com/users/4232861/dogwood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1574893321, "creation_date": 1574872337, "question_id": 59074673, "link": "https://stackoverflow.com/questions/59074673/am-i-doing-execution-timing-measurement-in-go-in-a-useful-way", "title": "Am I doing execution timing measurement in Go in a useful way?", "body": "<p>My code:</p>\n\n<pre><code>        // repeat fib(n) 10000 times\n        i := 10000\n        var total_time time.Duration\n        for i &gt; 0 {\n\n            // do fib(n) -&gt; f0\n            start := time.Now()\n            for n &gt; 0 {\n                f0, f1, n = f1, f0.Add(f0, f1), n-1\n            }\n            total_time = total_time + time.Since(start)\n\n            i--\n        }\n\n        // and divide total execution time by 10000\n        var normalized_time = total_time / 10000\n        fmt.Println(normalized_time)\n</code></pre>\n\n<p>The execution times I'm seeing are so extremely short that I am suspicious that what I've done isn't useful. If it's wrong, what am I doing wrong and how can I make it right?</p>\n"}, {"tags": ["go", "google-cloud-firestore", "slice", "go-templates", "go-html-template"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1574871251, "creation_date": 1574871251, "answer_id": 59074338, "question_id": 59074264, "link": "https://stackoverflow.com/questions/59074264/why-arent-the-passed-variables-rendering-in-html-template/59074338#59074338", "title": "Why aren&#39;t the passed variables rendering in html/template?", "body": "<p>Never omit errors, check what <code>indexTemplate.Execute(w, cities)</code> returns. It probably reveals the cause:</p>\n\n<p>You pass <code>cities</code> as the data, which is a slice. There is no <code>cities</code> field or method of it. The passed data becomes the <em>dot</em>, so you have to range over the dot.</p>\n\n<p>Instead of:</p>\n\n<pre><code>{{ range .cities }}\n</code></pre>\n\n<p>Use:</p>\n\n<pre><code>{{ range . }}\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 11843526, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38f12747264bfd62cf5cb57d00d7728d?s=128&d=identicon&r=PG&f=1", "display_name": "GolangNewb", "link": "https://stackoverflow.com/users/11843526/golangnewb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 59074338, "answer_count": 1, "score": 0, "last_activity_date": 1574871312, "creation_date": 1574870984, "last_edit_date": 1574871312, "question_id": 59074264, "link": "https://stackoverflow.com/questions/59074264/why-arent-the-passed-variables-rendering-in-html-template", "title": "Why aren&#39;t the passed variables rendering in html/template?", "body": "<p>I can't figure out why the passed variables aren't rendered with html/template</p>\n\n<p>This is what is rendered in the Browser:   </p>\n\n<p>This is all the passed variables: [0xc0000a8ec0 0xc0000a8f80 0xc0000a9040 0xc0000a9100]</p>\n\n<p>City    Population  State   Country Capital</p>\n\n<p>This is the log:<br>\n$ go run main.go</p>\n\n<pre><code>2019/11/27 11:00:39 **** =&gt; &amp;city has &amp;main.City{Name:\"Washington D.C.\", State:\"\", Country:\"USA\", Capital:false, Population:680000} before appending to cities ****\n2019/11/27 11:00:39 **** =&gt; &amp;city has &amp;main.City{Name:\"Los Angeles\", State:\"CA\", Country:\"USA\", Capital:false, Population:3900000} before appending to cities ****\n2019/11/27 11:00:39 **** =&gt; &amp;city has &amp;main.City{Name:\"San Francisco\", State:\"CA\", Country:\"USA\", Capital:false, Population:860000} before appending to cities ****\n2019/11/27 11:00:39 **** =&gt; &amp;city has &amp;main.City{Name:\"Tokyo\", State:\"\", Country:\"Japan\", Capital:true, Population:9000000} before appending to cities ****\n**** =&gt; cities outside {} has 4\n</code></pre>\n\n<p>Here is the handler function:   </p>\n\n<pre><code>func indexHandler(w http.ResponseWriter, r *http.Request) {\n    projectID := \"XXXXXXXXXXXXXX\"\n    ctx := context.Background()\n\n    client, _ := firestore.NewClient(ctx, projectID)\n\n    query := client.Collection(\"cities\").Documents(ctx)\n    defer query.Stop()\n    cities := make([]*City, 0)\n    for {\n        doc, err := query.Next()\n        if err == iterator.Done {\n            break\n        }\n        c := doc.Data()\n\n        // is there an easier way to populate the city struct\n        city := City{\n            Name:       c[\"name\"].(string),\n            Country:    c[\"country\"].(string),\n            Population: c[\"population\"].(int64),\n        }\n        // This is my ugly solution to dealing with nil value from Firestore\n        _, ok := c[\"capital\"]\n        if ok {\n            city.Capital = c[\"capital\"].(bool)\n        }\n        state, ok := c[\"state\"].(string)\n        if ok {\n            city.State = state\n        }\n        log.Printf(\"**** =&gt; &amp;city has %#v before appending to cities ****\", &amp;city)\n        cities = append(cities, &amp;city)\n\n    }\n\n    fmt.Printf(\"**** =&gt; cities outside {} has %d\", len(cities))\n    indexTemplate.Execute(w, cities)    \n}\n</code></pre>\n\n<p>This is the index.html template:<br>\n    \n\n<pre><code>{% autoescape true %}\n\n&lt;html lang=\"en\"&gt;\n&lt;head&gt;\n&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;\n\n&lt;/head&gt;\n&lt;body&gt;\n        &lt;P&gt;This is all the passed variables: {{ . }}&lt;/P&gt;\n    &lt;table&gt;\n        &lt;tr&gt;  &lt;td&gt;City&lt;/td&gt; &lt;td&gt;Population&lt;/td&gt; &lt;td&gt; State&lt;/td&gt;&lt;td&gt;Country&lt;/td&gt; &lt;td&gt;Capital&lt;/td&gt; &lt;/tr&gt;\n\n    {{ range .cities }}\n    &lt;tr&gt;  &lt;td&gt;testing&lt;/td&gt; &lt;td&gt;testing&lt;/td&gt; &lt;td&gt;testing&lt;/td&gt;&lt;td&gt;testing&lt;/td&gt; &lt;td&gt;testing&lt;/td&gt; &lt;/tr&gt;\n    &lt;tr&gt;  &lt;td&gt;{{.Name}}&lt;/td&gt; &lt;td&gt;{{ .Population}}&lt;/td&gt; &lt;td&gt;{{ .State}}&lt;/td&gt;&lt;td&gt;{{.Country}}&lt;/td&gt; &lt;td&gt;{{.Capital}}&lt;/td&gt; &lt;/tr&gt;\n    {{ end }}\n\n\n&lt;/table&gt;\n{{ $cities := . }}\n\n&lt;/body&gt;\n&lt;/html&gt;\n{% endautoescape %}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1574885779, "post_id": 59074075, "comment_id": 104392786, "body": "The answer you gave is good at explaining part of the problem."}, {"owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "edited": false, "score": 0, "creation_date": 1574886532, "post_id": 59074075, "comment_id": 104393091, "body": "What I am trying to do is put a collection of records as one entry into the db interface:   db [0] [record, record, record...], [1] [record, record, record...]      WHAT AM I DOING WRONG?   Posting a New example"}], "tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 0, "last_activity_date": 1574870330, "creation_date": 1574870330, "answer_id": 59074075, "question_id": 59073795, "link": "https://stackoverflow.com/questions/59073795/appending-to-interface-problems/59074075#59074075", "title": "Appending to []interface{} problems", "body": "<p>A slice is made of three values. The pointer to the data buffer, the len and the capacity. When you assign a slice, you make a copy of the three values.</p>\n\n<p>So when you append record to <code>db</code> the first time, it copies the pointer to data and the len. By changing the length of record, you don\u2019t change the length of the copy in <code>db</code>.\nThis is why you still have the two values in the db. </p>\n\n<p>You have to override <code>db[0]</code> with the truncated record so that <code>db</code> has the new record length. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n//\n// Data Base Structures and Variables\n//\nvar record []interface{}\n\nvar db []interface{}\n\nfunc newWorkDataItem(exercise, date, side, notes, reps, weight string) (list map[string]string) {\n    wdList := make(map[string]string)\n    wdList[\"Exercise\"] = exercise\n    wdList[\"Data\"] = date\n    wdList[\"Side\"] = side\n    wdList[\"Notes\"] = notes\n    wdList[\"Reps\"] = reps\n    wdList[\"Weight\"] = weight\n    return wdList\n}\n\n//\n// Main Function\n//\nfunc main() {\n    //\n    // Load Current Date\n    //\n    t := time.Now()\n    d := fmt.Sprintf(\"%d %d %d\", t.Month(), t.Day(), t.Year())\n    //\n    // Create Database Records\n    //\n    record = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n    record = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n    db = append(db, record)\n    fmt.Println(\"Database1 = \", db)\n\n    record = record[:0]\n    fmt.Println(\"Record: \", record)\n    record = append(record, newWorkDataItem(\"FWT\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n\n    db[0] = record // &lt;- override db[0] with new record slice\n\n    fmt.Println(\"Database2 = \", db)\n\n}\n</code></pre>\n\n<p>outputs the expected result</p>\n\n<pre><code>Database1 =  [[map[Data:11 10 2009 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5] map[Data:11 10 2009 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5]]]\nRecord:  []\nDatabase2 =  [[map[Data:11 10 2009 Exercise:FWT Notes:--- Reps:10 Side:Left Weight:12.5]]]\n</code></pre>\n\n<p>See this <a href=\"https://play.golang.org/p/8lHPudcVlo5\" rel=\"nofollow noreferrer\">Go Playground</a> demonstration.</p>\n"}], "owner": {"reputation": 171, "user_id": 2533972, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/8c8d9c2ef759224739138d5095f0170a?s=128&d=identicon&r=PG", "display_name": "Godfather", "link": "https://stackoverflow.com/users/2533972/godfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1574887873, "creation_date": 1574869406, "last_edit_date": 1574887873, "question_id": 59073795, "link": "https://stackoverflow.com/questions/59073795/appending-to-interface-problems", "title": "Appending to []interface{} problems", "body": "<p>I am using two nested interface slices to provide record separation. I load a couple of dataItem into an interface slice (<strong>var record []interface{}</strong>)</p>\n\n<p>Then I load that interface slice into another interface slice (<strong>var db []interface{}</strong>).</p>\n\n<p>So I should have:  <strong>db[0]record_org</strong></p>\n\n<p>So then I clear the previous record slice (<strong>var record []interface{}</strong>)</p>\n\n<p>Now here is the problem: I load the record slice with new dataItem.</p>\n\n<p>Now without doing anything else the first dataItem in DB changes??</p>\n\n<p>What am I missing about interfaces where a nested Interface can change its parents data???</p>\n\n<p>I include a working example of the problem so the whole world can wonder at my stupidity.</p>\n\n<p><strong>---------------------------- testDB.go --------------------------------</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n//\n// Data Base Structures and Variables\n//\nvar record []interface{}\n\nvar db []interface{}\n\nfunc newWorkDataItem(exercise, date, side, notes, reps, weight string) (list map[string]string) {\n    wdList := make(map[string]string)\n    wdList[\"Exercise\"] = exercise\n    wdList[\"Data\"] = date\n    wdList[\"Side\"] = side\n    wdList[\"Notes\"] = notes\n    wdList[\"Reps\"] = reps\n    wdList[\"Weight\"] = weight\n    return wdList\n}\n\n//\n// Main Function\n//\nfunc main() {\n    //\n    // Load Current Date\n    //\n    t := time.Now()\n    d := fmt.Sprintf(\"%d %d %d\", t.Month(), t.Day(), t.Year())\n    //\n    // Create Database Records\n    //\n    record = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n    record = append(record, newWorkDataItem(\"FWC\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n    db = append(db, record)\n    fmt.Println(\"Database1 = \", db)\n\n    record = record[:0]\n    fmt.Println(\"Record: \", record)\n    record = append(record, newWorkDataItem(\"FWT\", d, \"Left\", \"---\", \"10\", \"12.5\"))\n\n    fmt.Println(\"Database2 = \", db)\n}\n</code></pre>\n\n<p><strong>---------------------- Displayed Results --------------------------</strong></p>\n\n<p>Database1 =  [[map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5]]]</p>\n\n<p>Record:  []</p>\n\n<p>Database2 =  [[map[Data:11 27 2019 Exercise:FWT Notes:--- Reps:10 Side:Left Weight:12.5] map[Data:11 27 2019 Exercise:FWC Notes:--- Reps:10 Side:Left Weight:12.5]]]</p>\n"}, {"tags": ["go", "module", "go-modules", "mattermost"], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 11631008, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-A6DPo3fATzY/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO_vYd9hVWRpk9fwWW_FXWYZFRGNw/mo/photo.jpg?sz=128", "display_name": "godvlpr", "link": "https://stackoverflow.com/users/11631008/godvlpr"}, "edited": false, "score": 0, "creation_date": 1574932855, "post_id": 59075343, "comment_id": 104406546, "body": "Nope, it didn&#39;t work, now i fixed this. I use mattermost-server and trouble was in that library, i wrote to mattermost dev. team, and they said that they know aboute this bug, and i need to use version 0.0.0"}], "tags": [], "owner": {"reputation": 4731, "user_id": 1803960, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Tts13.jpg?s=128&g=1", "display_name": "Mayank", "link": "https://stackoverflow.com/users/1803960/mayank"}, "is_accepted": false, "score": 0, "last_activity_date": 1574874848, "creation_date": 1574874848, "answer_id": 59075343, "question_id": 59072751, "link": "https://stackoverflow.com/questions/59072751/get-latest-version-in-go-mod-if-one-of-the-requires-is-incompatible/59075343#59075343", "title": "Get latest version in go.mod if one of the requires is +incompatible", "body": "<p>use <code>replace</code> in go.mod</p>\n\n<pre><code>replace github.com/mattermost/mattermost-server v5.11.1+incompatible =&gt; github.com/mattermost/mattermost-server v5.17.1\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 0, "last_activity_date": 1574935103, "creation_date": 1574935103, "answer_id": 59086118, "question_id": 59072751, "link": "https://stackoverflow.com/questions/59072751/get-latest-version-in-go-mod-if-one-of-the-requires-is-incompatible/59086118#59086118", "title": "Get latest version in go.mod if one of the requires is +incompatible", "body": "<p>First of all prune the no-more-necessart dependencies using <code>go mod tidy</code>. Now, update all direct and indirect packages to the latest (minor) version with <code>go get -u ./...</code> where the <code>go.mod</code> file is located.</p>\n"}], "owner": {"reputation": 91, "user_id": 11631008, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-A6DPo3fATzY/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO_vYd9hVWRpk9fwWW_FXWYZFRGNw/mo/photo.jpg?sz=128", "display_name": "godvlpr", "link": "https://stackoverflow.com/users/11631008/godvlpr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1264, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1574935103, "creation_date": 1574866010, "last_edit_date": 1574886235, "question_id": 59072751, "link": "https://stackoverflow.com/questions/59072751/get-latest-version-in-go-mod-if-one-of-the-requires-is-incompatible", "title": "Get latest version in go.mod if one of the requires is +incompatible", "body": "<p>I have go.mod file, with require, one of them if <code>github.com/mattermost/mattermost-server v5.11.1+incompatible</code> but there is a new version of library in github, <code>5.17.1</code>. </p>\n\n<p>I download latest version and work with it, but when i run <code>go mod init</code> my go.mod contains <code>5.11.1+incompatible</code> version. </p>\n\n<p>How do I configure the go.mod files to use the latest version ?</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 924, "user_id": 2076411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f7defd6e494dbf5d0431d28203fd3e?s=128&d=identicon&r=PG", "display_name": "ied3vil", "link": "https://stackoverflow.com/users/2076411/ied3vil"}, "edited": false, "score": 0, "creation_date": 1574867445, "post_id": 59073186, "comment_id": 104384150, "body": "You should though lookup for others who have this problem before posting the question, just saying..."}, {"owner": {"reputation": 301, "user_id": 6144802, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-Iqtvo3-SXds/AAAAAAAAAAI/AAAAAAAABGE/RdsOlAAxU7o/photo.jpg?sz=128", "display_name": "Sergey", "link": "https://stackoverflow.com/users/6144802/sergey"}, "edited": false, "score": 0, "creation_date": 1574869963, "post_id": 59073186, "comment_id": 104385512, "body": "There is anonymous user, but I connect to database not on localhost. Host in entry for my user in user table looks like 1.1.%. And ip of the server, from which I am connecting, looks like 1.1.2.3. So there should be a match"}], "tags": [], "owner": {"reputation": 924, "user_id": 2076411, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8f7defd6e494dbf5d0431d28203fd3e?s=128&d=identicon&r=PG", "display_name": "ied3vil", "link": "https://stackoverflow.com/users/2076411/ied3vil"}, "is_accepted": false, "score": 0, "last_activity_date": 1574867407, "creation_date": 1574867407, "answer_id": 59073186, "question_id": 59071860, "link": "https://stackoverflow.com/questions/59071860/mysqldump-with-exec-command-results-in-1045-error-but-works-fine-from-terminal/59073186#59073186", "title": "mysqldump with exec.Command results in 1045 error, but works fine from terminal", "body": "<p>You probably have an anonymous user <code>''@'localhost'</code> or <code>''@'127.0.0.1'</code>.</p>\n\n<p>run <code>mysql&gt; SELECT user, host FROM mysql.user;</code> to see what users you have on mySQL.</p>\n\n<p><a href=\"http://dev.mysql.com/doc/refman/5.5/en/connection-access.html\" rel=\"nofollow noreferrer\">Documentation</a>: </p>\n\n<blockquote>\n  <p>When multiple matches are possible, the server must determine which of\n  them to use. It resolves this issue as follows: (...)</p>\n  \n  <p>When a client attempts to connect, the server looks through the rows\n  [of table mysql.user] in sorted order. The server uses the first row\n  that matches the client host name and user name. (...) The server uses\n  sorting rules that order rows with the most-specific Host values\n  first. Literal host names [such as 'localhost'] and IP addresses are\n  the most specific.</p>\n</blockquote>\n\n<p>Note: an empty string acts a wildcard in MySQL's authentication algorithm</p>\n"}], "owner": {"reputation": 301, "user_id": 6144802, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh3.googleusercontent.com/-Iqtvo3-SXds/AAAAAAAAAAI/AAAAAAAABGE/RdsOlAAxU7o/photo.jpg?sz=128", "display_name": "Sergey", "link": "https://stackoverflow.com/users/6144802/sergey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1574867407, "creation_date": 1574863108, "last_edit_date": 1574867055, "question_id": 59071860, "link": "https://stackoverflow.com/questions/59071860/mysqldump-with-exec-command-results-in-1045-error-but-works-fine-from-terminal", "title": "mysqldump with exec.Command results in 1045 error, but works fine from terminal", "body": "<p>cmd init</p>\n\n<pre><code>cmd := exec.Command(\"mysqldump\",\n        \"--column-statistics=0\",\n        \"--default-character-set=utf8\",\n        \"-P\", port,\n        \"-h\", host,\n        \"-u\", username,\n        fmt.Sprintf(\"-p'%s'\", password),\n        dbname)\n</code></pre>\n\n<p>error text i get</p>\n\n<blockquote>\n  <p>mysqldump: [Warning] Using a password on the command line interface\n  can be insecure. mysqldump: Got error: 1045: Access denied for user\n  'user'@'ipaddress' (using password: YES) when trying to connect</p>\n</blockquote>\n\n<p>cmd.String() output</p>\n\n<blockquote>\n  <p>/usr/bin/mysqldump --column-statistics=0 --default-character-set=utf8\n  -P port -h host -u username -p'password' dbname</p>\n</blockquote>\n\n<p>when I execute cmd.String() output in terminal on same machine, everything works as expected.\nWhat reasons can be for this behavior?</p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1574867165, "last_edit_date": 1574867165, "creation_date": 1574860988, "answer_id": 59071223, "question_id": 59070961, "link": "https://stackoverflow.com/questions/59070961/how-does-go-json-decoding-error-behavior-work/59071223#59071223", "title": "How does Go JSON decoding error behavior work?", "body": "<p>A quick test reveals it:</p>\n\n<pre><code>func main() {\n    var r Response\n    if err := json.Unmarshal([]byte(src), &amp;r); err != nil {\n        fmt.Println(err)\n    }\n    fmt.Printf(\"%+v\", r)\n}\n\nconst src = `{\n    \"title\": \"test\",\n    \"type\": \"type\"\n}\n</code></pre>\n\n<p>Result (try it on the <a href=\"https://play.golang.org/p/b8as_sXmbvu\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>json: cannot unmarshal string into Go struct field Response.title of type struct { Text string \"json:\\\"text\\\"\"; Accessibility struct { Label string \"json:\\\"label\\\"\"; Identifier string \"json:\\\"identifier\\\"\" } \"json:\\\"accessibility\\\"\" }\n{Title:{Text: Accessibility:{Label: Identifier:}} Type:type}\n</code></pre>\n\n<p>A non-<code>nil</code> error is returned while the subsequent <code>Type</code> field gets unmarshaled properly.</p>\n\n<p>In general: <strong>An error is returned, while unmarshaling continues without any guarantees.</strong></p>\n\n<p>This is documented at <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal()</code></a>:</p>\n\n<blockquote>\n  <p>If a JSON value is not appropriate for a given target type, or if a JSON number overflows the target type, <strong>Unmarshal skips that field and completes the unmarshaling as best it can</strong>. If no more serious errors are encountered, <strong>Unmarshal returns an UnmarshalTypeError</strong> describing the earliest such error. In any case, <strong>it's not guaranteed that all the remaining fields</strong> following the problematic one <strong>will be unmarshaled</strong> into the target object.</p>\n</blockquote>\n"}], "owner": {"reputation": 45146, "user_id": 131640, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/288ecb3cc93b05f92b2c7145a8b80c55?s=128&d=identicon&r=PG", "display_name": "Steve", "link": "https://stackoverflow.com/users/131640/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 59071223, "answer_count": 1, "score": 0, "last_activity_date": 1574867165, "creation_date": 1574860060, "last_edit_date": 1574861182, "question_id": 59070961, "link": "https://stackoverflow.com/questions/59070961/how-does-go-json-decoding-error-behavior-work", "title": "How does Go JSON decoding error behavior work?", "body": "<p>I'm trying to understand the behavior of JSON decoding and unmarshalling in Go when an error is encountered.  In particular, in the following struct, the <code>title</code> field is a different format than is provided by the returned JSON and an error provided.  Is the behavior to continue with other fields despite the error, or will processing of the additional fields stop?  I haven't found any mention of how this is handled in the standard library.</p>\n\n<pre><code>type Response struct {\n    Title struct {\n        Text          string `json:\"text\"`\n        Accessibility struct {\n            Label      string `json:\"label\"`\n            Identifier string `json:\"identifier\"`\n        } `json:\"accessibility\"`\n    } `json:\"title,omitempty\"`\n    Type    string `json:\"type\"`\n}\n</code></pre>\n\n<pre><code>{\n    \"title\": \"test\",\n    \"type\": \"type\"\n}\n</code></pre>\n"}, {"tags": ["go", "rabbitmq", "timeout", "channel"], "comments": [{"owner": {"reputation": 449, "user_id": 9131933, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/272423f6785184b9d180ef6a5bd16504?s=128&d=identicon&r=PG&f=1", "display_name": "newbie", "link": "https://stackoverflow.com/users/9131933/newbie"}, "edited": false, "score": 0, "creation_date": 1574849053, "post_id": 59067465, "comment_id": 104373514, "body": "In java it&#39;s a property on the ConnectionFactory ? So you don&#39;t have to handle the condition in your code."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 8200805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/375a2e1a056ceddbe859537d814a17ca?s=128&d=identicon&r=PG&f=1", "display_name": "Qworel", "link": "https://stackoverflow.com/users/8200805/qworel"}, "edited": false, "score": 0, "creation_date": 1574850284, "post_id": 59067658, "comment_id": 104374232, "body": "Thanks, but I don`t need timeout refresh in case if I received message. Tried to apply your changes to my existing code and it helped (updated question). Thx!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 25, "user_id": 8200805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/375a2e1a056ceddbe859537d814a17ca?s=128&d=identicon&r=PG&f=1", "display_name": "Qworel", "link": "https://stackoverflow.com/users/8200805/qworel"}, "edited": false, "score": 0, "creation_date": 1574850649, "post_id": 59067658, "comment_id": 104374480, "body": "@Qworel If you don&#39;t need a reset, comment out the resetting code :) But then you may use <code>time.After()</code> after all :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1574851131, "last_edit_date": 1574851131, "creation_date": 1574849209, "answer_id": 59067658, "question_id": 59067465, "link": "https://stackoverflow.com/questions/59067465/how-to-timeout-rabbitmqconsumer-if-it-didnt-receive-response/59067658#59067658", "title": "How to timeout RabbitMQConsumer if it didn`t receive response", "body": "<p>Your loop has a <code>select</code> with 2 cases: a timeout and a <code>default</code> branch. Upon entering the loop the timeout will not fire, so the <code>default</code> branch is executed.</p>\n\n<p>The <code>default</code> branch contains a <code>for range</code> over the <code>msgs</code> channel which keeps receiving from the channel until it is closed (and all values have been received from it). Normally this shouldn't happen, so the timeout case will not be revisited (only if some error occurs and <code>msgs</code> is closed).</p>\n\n<p>Instead inside the loop use a <code>select</code> with 2 cases, one timeout and one  that receives only a single value from <code>msgs</code>. If a message is received, restart the timeout. For a restartable timer use <a href=\"https://golang.org/pkg/time/#Timer\" rel=\"nofollow noreferrer\"><code>time.Timer</code></a>.</p>\n\n<pre><code>timeout := time.Second\ntimer := time.NewTimer(timeout)\nfor {\n    select {\n    case &lt;-timer.C:\n        fmt.Println(\"timeout, returning\")\n        return\n    case msg := &lt;-msgs:\n        fmt.Println(\"received message:\", msg)\n        // Reset timer: it must be stopped first\n        // (and drain its channel if it reports false)\n        if !timer.Stop() {\n            &lt;-timer.C\n        }\n        timer.Reset(timeout)\n    }\n}\n</code></pre>\n\n<p>Check this <a href=\"https://play.golang.org/p/EwGJd1Pe2jK\" rel=\"nofollow noreferrer\">Go Playground</a> example to see it in action.</p>\n\n<p>Note that if you don't need to reset the timer once a message is received, just comment out the resetter code. Also, if no reset is needed, <a href=\"https://golang.org/pkg/time/#After\" rel=\"nofollow noreferrer\"><code>time.After()</code></a> is simpler:</p>\n\n<pre><code>timeout := time.After(time.Second)\nfor {\n    select {\n    case &lt;-timeout:\n        fmt.Println(\"timeout, returning\")\n        return\n    case msg := &lt;-msgs:\n        fmt.Println(\"received message:\", msg, time.Now())\n    }\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/QrEUOGT_cAz\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>One final note: if you would break from the loop before the timeout happens, the timer in the background would not be freed immediately (only when the timeout happens). If you need this operation frequently, you may use <a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\"><code>context.WithTimeout()</code></a> to obtain a <a href=\"https://golang.org/pkg/context/#Context\" rel=\"nofollow noreferrer\"><code>context.Context</code></a> and a cancel function which you may call immediately before returning to free up the timer resource (preferably as deferred).</p>\n\n<p>This is how it would look like:</p>\n\n<pre><code>ctx, cancel := context.WithTimeout(context.Background(), time.Second)\ndefer cancel()\nfor {\n    select {\n    case &lt;-ctx.Done():\n        fmt.Println(\"timeout, returning\")\n        return\n    case msg := &lt;-msgs:\n        fmt.Println(\"received message:\", msg, time.Now())\n    }\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/1G1ggWAn8iu\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574853629, "post_id": 59068006, "comment_id": 104376166, "body": "this seems plain wrong to me. if two instances of this code run, msgs will be unsync, and some workers will miss their correlation id. values pops only once out of msgs."}, {"owner": {"reputation": 25, "user_id": 8200805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/375a2e1a056ceddbe859537d814a17ca?s=128&d=identicon&r=PG&f=1", "display_name": "Qworel", "link": "https://stackoverflow.com/users/8200805/qworel"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574855349, "post_id": 59068006, "comment_id": 104377114, "body": "@mh-cbon in our implementation we have one queue per worker so that`s not an issue"}], "tags": [], "owner": {"reputation": 25, "user_id": 8200805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/375a2e1a056ceddbe859537d814a17ca?s=128&d=identicon&r=PG&f=1", "display_name": "Qworel", "link": "https://stackoverflow.com/users/8200805/qworel"}, "is_accepted": false, "score": 0, "last_activity_date": 1574850375, "creation_date": 1574850375, "answer_id": 59068006, "question_id": 59067465, "link": "https://stackoverflow.com/questions/59067465/how-to-timeout-rabbitmqconsumer-if-it-didnt-receive-response/59068006#59068006", "title": "How to timeout RabbitMQConsumer if it didn`t receive response", "body": "<p>Changed select to this:</p>\n\n<pre><code>c1 := make(chan error, 1)\n    go func() {\n        for d := range msgs {\n            if corrID == d.CorrelationId {\n                err = json.Unmarshal([]byte(uncompress(d.Body)), &amp;v)\n                if err != nil {\n                    c1 &lt;- err\n                }\n                ch.Ack(d.DeliveryTag, false)\n                c1 &lt;- nil\n            }\n        }\n    }()\n\n    select {\n    case &lt;-time.After(defaultTimeout * time.Second):\n        log.Printf(\"Failed to receive response for action %+v\\n Payload: %+v\\nError: %+v\\n\", action, body, err)\n        return errors.New(\"Failed to receive response in time for action\")\n    case err := &lt;-c1:\n        failOnError(err, \"Failed to process response\")\n    }\n    return err\n</code></pre>\n"}], "owner": {"reputation": 25, "user_id": 8200805, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/375a2e1a056ceddbe859537d814a17ca?s=128&d=identicon&r=PG&f=1", "display_name": "Qworel", "link": "https://stackoverflow.com/users/8200805/qworel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 59067658, "answer_count": 2, "score": 1, "last_activity_date": 1574862826, "creation_date": 1574848552, "last_edit_date": 1574862826, "question_id": 59067465, "link": "https://stackoverflow.com/questions/59067465/how-to-timeout-rabbitmqconsumer-if-it-didnt-receive-response", "title": "How to timeout RabbitMQConsumer if it didn`t receive response", "body": "<p>I got code that consumes messages from RabbitMQ queue. It should fail if it doesn`t received message for some time.</p>\n\n<pre><code>msgs, err := ch.Consume(\n        c.ResponseQueue, // queue\n        \"\",              // consumer\n        false,           // auto-ack\n        false,           // exclusive\n        false,           // no-local\n        false,           // no-wait\n        nil,             // args\n    )\n    failOnError(err, \"Failed to register a consumer\")\n\n...\n\nloop:\n    for timeout := time.After(time.Second); ; {\n        select {\n        case &lt;-timeout:\n            log.Printf(\"Failed to receive response for action %+v\\n Payload: %+v\\nError: %+v\\n\", action, body, err)\n            return errors.New(\"Failed to receive response for action\")\n        default:\n            for d := range msgs {\n                if corrID == d.CorrelationId {\n                    err = json.Unmarshal([]byte(uncompress(d.Body)), &amp;v)\n                    if err != nil {\n                        return err\n                    }\n                    ch.Ack(d.DeliveryTag, false)\n                    break loop\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>I took consume code from RabbitMQ manual and tried some advices for implementing timeout. I know how to do it in Java, but can`t repeat it in Golang.</p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>Update:</strong></p>\n\n<p>Changed select to this:</p>\n\n<pre><code>c1 := make(chan error, 1)\n    go func() {\n        for d := range msgs {\n            if corrID == d.CorrelationId {\n                err = json.Unmarshal([]byte(uncompress(d.Body)), &amp;v)\n                if err != nil {\n                    c1 &lt;- err\n                }\n                ch.Ack(d.DeliveryTag, false)\n                c1 &lt;- nil\n            }\n        }\n    }()\n\n    select {\n    case &lt;-time.After(defaultTimeout * time.Second):\n        log.Printf(\"Failed to receive response for action %+v\\n Payload: %+v\\nError: %+v\\n\", action, body, err)\n        return errors.New(\"Failed to receive response in time for action\")\n    case err := &lt;-c1:\n        failOnError(err, \"Failed to process response\")\n    }\n    return err\n</code></pre>\n\n<p>Now it works as expected - if it doesn`t receive message with proper corellationId it will fail with timeout. Thanks for help everyone.</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1574847277, "post_id": 59066953, "comment_id": 104372413, "body": "Have you considered using <a href=\"https://commonmark.org/\" rel=\"nofollow noreferrer\">commonmark</a> instead? It has <a href=\"https://github.com/commonmark/commonmark-spec/wiki/list-of-commonmark-implementations#go\" rel=\"nofollow noreferrer\">libraries</a> and comes with a spec."}, {"owner": {"reputation": 2022, "user_id": 6443753, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4f68b7d6834500d99fcbc5e8b7717387?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Ferro", "link": "https://stackoverflow.com/users/6443753/thomas-ferro"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1574847837, "post_id": 59066953, "comment_id": 104372747, "body": "I&#39;m making my own implementation for a training purpose, but thanks for the ressources !"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1574848304, "post_id": 59066953, "comment_id": 104373019, "body": "Regular expressions are rarely the answer to lexing/parsing because most languages are not regular languages. Have you seen <a href=\"https://talks.golang.org/2011/lex.slide#1\" rel=\"nofollow noreferrer\">&quot;Lexical Scanning in Go&quot; by Rob Pike</a> yet?"}, {"owner": {"reputation": 2022, "user_id": 6443753, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4f68b7d6834500d99fcbc5e8b7717387?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Ferro", "link": "https://stackoverflow.com/users/6443753/thomas-ferro"}, "edited": false, "score": 0, "creation_date": 1574848467, "post_id": 59066953, "comment_id": 104373131, "body": "Not yet but I sure will !"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1574851190, "post_id": 59066953, "comment_id": 104374793, "body": "Looks like you are looking to create a regex, but do not know where to get started. Please check <a href=\"https://stackoverflow.com/questions/22937618\">Reference - What does this regex mean</a> resource, it has plenty  of hints. Also, refer to <a href=\"https://stackoverflow.com/a/2759417/3832970\">Learning Regular Expressions</a> post for some basic regex info. Once you get some expression ready and still have issues with the solution, please edit the question with the latest details and we&#39;ll be glad to help you fix the problem."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574856284, "post_id": 59066953, "comment_id": 104377627, "body": "the dup is wrong imho, OP is asking to parse a markdown syntax, as mentioned, regexp are rarely a solution to this problem. however i did not find a suitable stackoverflow topic that introduces this subject."}, {"owner": {"reputation": 2022, "user_id": 6443753, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4f68b7d6834500d99fcbc5e8b7717387?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Ferro", "link": "https://stackoverflow.com/users/6443753/thomas-ferro"}, "edited": false, "score": 0, "creation_date": 1574857136, "post_id": 59066953, "comment_id": 104378105, "body": "Yes, I was probably wrong to induced my first solution with regexp as the question."}], "owner": {"reputation": 2022, "user_id": 6443753, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/4f68b7d6834500d99fcbc5e8b7717387?s=128&d=identicon&r=PG&f=1", "display_name": "Thomas Ferro", "link": "https://stackoverflow.com/users/6443753/thomas-ferro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1574851183, "answer_count": 0, "score": 0, "last_activity_date": 1574846859, "creation_date": 1574846859, "question_id": 59066953, "link": "https://stackoverflow.com/questions/59066953/escape-matches-when-surrounded-by-a-char-sequence", "closed_reason": "Duplicate", "title": "Escape matches when surrounded by a char sequence", "body": "<p>I am implementing a <em>Markdown to HTML</em> converter and I found myself in a situation where I don't know if one regex will suffice.</p>\n\n<p>It is implied in <a href=\"https://www.markdownguide.org/basic-syntax/#escaping-backticks\" rel=\"nofollow noreferrer\">the Markdown guide</a> that you can escape backticks in a code block by surrounding the block with two backticks.</p>\n\n<p>For instance, the following Markdown text:</p>\n\n<pre><code>``Use `code` in your Markdown file.``\n</code></pre>\n\n<p>should be converted to the following HTML:</p>\n\n<pre><code>&lt;code&gt;Use `code` in your Markdown file.&lt;/code&gt;\n</code></pre>\n\n<p>My first guess for implementing this is to</p>\n\n<ol>\n<li>Find all of the code blocks with double backticks</li>\n<li>Replace the double backticks with the <code>&lt;code&gt;</code> tag</li>\n<li>Do the same with single backticks, except the ones already inside a <code>&lt;code&gt;</code> tag</li>\n</ol>\n\n<p>Is there any way to create a pattern that matches text between two backticks <strong>but not inside <code>&lt;code&gt;</code> tags</strong> ? Or am I overthinking it and there is a simpler solution ?</p>\n"}, {"tags": ["go", "recursion", "struct", "slice"], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 4108663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/8ac9c11e063aa393d2283088e0c85901?s=128&d=identicon&r=PG&f=1", "display_name": "TheAuzzieJesus", "link": "https://stackoverflow.com/users/4108663/theauzziejesus"}, "edited": false, "score": 0, "creation_date": 1574845392, "post_id": 59066353, "comment_id": 104371424, "body": "Legend! Exactly what I was looking to do. Thanks :)"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1574845985, "last_edit_date": 1574845985, "creation_date": 1574844725, "answer_id": 59066353, "question_id": 59066267, "link": "https://stackoverflow.com/questions/59066267/having-some-issues-recursively-printing-a-complete-list-of-a-tree-like-structure/59066353#59066353", "title": "Having some issues recursively printing a complete list of a tree-like structure", "body": "<p>A simple and elegant solution would be to \"arm\" <code>command</code> with a <code>print()</code> method. This could print its name, and range over its subcommands, calling their <code>print()</code> (which do the same):</p>\n\n<pre><code>func (c *command) print() {\n    fmt.Println(c.name)\n    for _, sc := range c.subcommands {\n        sc.print()\n    }\n}\n</code></pre>\n\n<p>Then printing the commands in <code>main()</code> is just calling their <code>print()</code> method (<code>getLastCommand()</code> is not even needed / used):</p>\n\n<pre><code>for _, c := range commands {\n    c.print()\n}\n</code></pre>\n\n<p>This will result in your desired output (try it on the <a href=\"https://play.golang.org/p/g5AF0CXqQCF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>base1\nbase2\nbase3\nbase3:sub1\nbase3:sub1:sub1\nbase3:sub2\n</code></pre>\n\n<p>Note that of course <code>print()</code> doesn't have to be a method, it may be a regular function too, in which case it could look like this:</p>\n\n<pre><code>func print(c *command) {\n    fmt.Println(c.name)\n    for _, sc := range c.subcommands {\n        print(sc)\n    }\n}\n</code></pre>\n\n<p>And the loop in <code>main()</code>:</p>\n\n<pre><code>for _, c := range commands {\n    print(&amp;c)\n}\n</code></pre>\n\n<p>Result is the same, try this one on the <a href=\"https://play.golang.org/p/KyeIuX776NR\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>I would also suggest to be consistent. If you decide to use pointer to <code>command</code>, do it everywhere (e.g. the <code>commands</code> slice in your <code>main()</code> stores non-pointers, that's why its element's address had to be taken to pass to <code>print()</code>).</p>\n"}], "owner": {"reputation": 577, "user_id": 4108663, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/8ac9c11e063aa393d2283088e0c85901?s=128&d=identicon&r=PG&f=1", "display_name": "TheAuzzieJesus", "link": "https://stackoverflow.com/users/4108663/theauzziejesus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59066353, "answer_count": 1, "score": 2, "last_activity_date": 1574848062, "creation_date": 1574844334, "last_edit_date": 1574848062, "question_id": 59066267, "link": "https://stackoverflow.com/questions/59066267/having-some-issues-recursively-printing-a-complete-list-of-a-tree-like-structure", "title": "Having some issues recursively printing a complete list of a tree-like structure", "body": "<p>I'm having trouble creating a structure for a CLI tool that will have <em>n</em> commands. Each command can have <em>n</em> subcommands, and each subcommand can have <em>n</em> more subcommands.</p>\n\n<p>My issue is that, in Go, I'm struggling to figure out a way to create a recursive function to output the name of each command, along with each <em>n</em> subcommands + every <em>n</em> subcommands for that subcommand, in a complete list.</p>\n\n<p>For example, I'm looking to get the following output:</p>\n\n<pre><code>1. command1\n2. command2\n3. command3\n4. command3 subcommand1\n5. command3 subcommand1 subcommand1\n6. command3 subcommand2\n</code></pre>\n\n<p>Here is my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype command struct {\n    name        string\n    parent      *command\n    subcommands []*command\n}\n\nfunc getLastCommand(c command) command {\n    for _, s := range c.subcommands {\n        if len(s.subcommands) == 0 {\n            return *s\n        }\n        return getLastCommand(*s)\n    }\n    return c\n}\n\nfunc main() {\n    cmdBase1 := command{\n        name: \"base1\",\n    }\n\n    cmdBase2 := command{\n        name: \"base2\",\n    }\n\n    var (\n        cmdBase3,\n        cmdBase3Sub1,\n        cmdBase3Sub1Sub1,\n        cmdBase3Sub2 command\n    )\n\n    cmdBase3 = command{\n        name:        \"base3\",\n        subcommands: []*command{&amp;cmdBase3Sub1, &amp;cmdBase3Sub2},\n    }\n\n    cmdBase3Sub1 = command{\n        name:        \"base3:sub1\",\n        parent:      &amp;cmdBase3,\n        subcommands: []*command{&amp;cmdBase3Sub1Sub1},\n    }\n\n    cmdBase3Sub1Sub1 = command{\n        name:   \"base3:sub1:sub1\",\n        parent: &amp;cmdBase3Sub1,\n    }\n\n    cmdBase3Sub2 = command{\n        name:   \"base3:sub2\",\n        parent: &amp;cmdBase3,\n    }\n\n    // root commands\n    commands := []command{\n        cmdBase1,\n        cmdBase2,\n        cmdBase3,\n    }\n\n    for _, c := range commands {\n        last := getLastCommand(c)\n        fmt.Println(last.name)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HZPRlSghfAY\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HZPRlSghfAY</a></p>\n\n<p>Here is the current output:</p>\n\n<pre><code>base1\nbase2\nbase3:sub1:sub1\n</code></pre>\n\n<p>My desired output is with the above code is:</p>\n\n<pre><code>base1\nbase2\nbase3\nbase3:sub1\nbase3:sub1:sub1\nbase3:sub2\n</code></pre>\n\n<p>What do I need to change in my code so I can get my above desired output? Is there an algorithm or data structure that I could follow to solve this? I've tried depth-first and binary searching, but I can't seem to mold it to my structure.</p>\n"}, {"tags": ["go", "google-cloud-firestore", "firebase-security", "go-templates"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574846444, "post_id": 59065803, "comment_id": 104371976, "body": "<code>Property.template</code> is unexported. I do not know the firebase driver, but mapping unexported fields usually does not work."}, {"owner": {"reputation": 130, "user_id": 9357197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwHUW.jpg?s=128&g=1", "display_name": "Geogram", "link": "https://stackoverflow.com/users/9357197/geogram"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574870221, "post_id": 59065803, "comment_id": 104385639, "body": "@MarkusWMahlberg I&#39;ve updated the question with the struct."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1575273186, "post_id": 59065803, "comment_id": 104496750, "body": "You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too. Specifically, your question lacks a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>."}, {"owner": {"reputation": 1484, "user_id": 6003934, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4cke01Q4sh8/AAAAAAAAAAI/AAAAAAAAARQ/-ZrFPVUGL4s/photo.jpg?sz=128", "display_name": "Juancki", "link": "https://stackoverflow.com/users/6003934/juancki"}, "edited": false, "score": 0, "creation_date": 1575297861, "post_id": 59065803, "comment_id": 104509075, "body": "Can you provide an entry of Firestore with all the field. Have all the documents you are iterating over all fields?"}], "owner": {"reputation": 130, "user_id": 9357197, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cwHUW.jpg?s=128&g=1", "display_name": "Geogram", "link": "https://stackoverflow.com/users/9357197/geogram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1574870643, "creation_date": 1574842517, "last_edit_date": 1574870643, "question_id": 59065803, "link": "https://stackoverflow.com/questions/59065803/getting-data-from-firestore-to-display-a-go-template-file", "title": "Getting data from Firestore to display a go template file", "body": "<p>How can I get the p.template from firestore, which is a string, into template.ParseFiles function? Is it possible to use the field value in the function to select the correct template file?</p>\n\n<pre><code>type Property struct {\n    Name            string        `firestore:\"name\"`\n    ApprovedOrigins []interface{} `firestore:\"approvedOrigins\"`\n    Template        string        `firestore:\"selected\"`\n}\n</code></pre>\n\n<p>As you can see above the firestore field name is <code>selected</code></p>\n\n<pre><code>\nfunc serveHandler(w http.ResponseWriter, r *http.Request, params map[string]string) {\n    ctx := context.Background()\n    client, err := firestore.NewClient(ctx, projectId)\n    if err != nil {\n        // TODO: Handle error.\n        log.Println(\"FIREBASE ERROR:\", err)\n    }\n\n    // collection group query in firestore\n    q := client.CollectionGroup(\"data\").Where(\"approvedOrigins\", \"array-contains\", r.Host).Limit(1)\n\n    // iterate through the document query\n    iter := q.Documents(ctx)\n    defer iter.Stop()\n    for {\n        doc, err := iter.Next()\n        if err == iterator.Done {\n            break\n        }\n        if err != nil {\n            // TODO: Handle error.\n            log.Println(\"FIREBASE ERROR:\", err)\n        }\n\n        fmt.Println(\"Database connected...\")\n\n        var p Property\n        if err := doc.DataTo(&amp;p); err != nil {\n            fmt.Println(err)\n        }\n        fmt.Println(p.Template) // This is not logging any data/string\n\n        t, _ := template.ParseFiles(p.Template + \".html\")   \n        fmt.Println(t.Execute(w, p)) //504 error happens here\n\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574843473, "post_id": 59065456, "comment_id": 104370451, "body": "Try <code>db.First(user.Profile, user.ProfileID)</code> (without the <code>&amp;</code>)."}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574844283, "post_id": 59065456, "comment_id": 104370875, "body": "it doesn&#39;t change anything. I&#39;ve already try it. Thanks)"}], "answers": [{"comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574843101, "post_id": 59065869, "comment_id": 104370234, "body": "There&#39;s probably no need for the second <code>&amp;</code>, right? <code>user.Profile</code> is already a pointer, doing <code>&amp;user.Profile</code> would result in a value of type <code>**Profile</code> which may, or may not be supported by gorm."}, {"owner": {"reputation": 46, "user_id": 5958885, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PBBAEnnrVj0/AAAAAAAAAAI/AAAAAAAAACg/hDAVJ-gnnww/photo.jpg?sz=128", "display_name": "Denis Sterligov", "link": "https://stackoverflow.com/users/5958885/denis-sterligov"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574844102, "post_id": 59065869, "comment_id": 104370776, "body": "But you still need to initialize the structure. Otherwise you pass nil"}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1574844317, "post_id": 59065869, "comment_id": 104370893, "body": "Wow!  I know this answer but, I want to optimize this code.  Any other solutions ?"}, {"owner": {"reputation": 148, "user_id": 12096585, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mChCc7Hxh4bqY4DZYrIFAlZGSiaNAjESoOHZOWV=k-s128", "display_name": "anna", "link": "https://stackoverflow.com/users/12096585/anna"}, "edited": false, "score": 1, "creation_date": 1574888485, "post_id": 59065869, "comment_id": 104393831, "body": "A thought on optimizing: you&#39;re making the type in this struct a pointer so it starts as &lt;nil&gt; and then you&#39;re generating a spot in memory for an empty struct to pass it along. The user.Profile will already be initialized as the empty struct if you change its type to not be a pointer. Unless you sometimes need the User.Profile to be nil, this seems like a very roundabout way to hold a bunch of empty values and their memory address and on top of that, it won&#39;t be safe to use in your go routines."}], "tags": [], "owner": {"reputation": 46, "user_id": 5958885, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PBBAEnnrVj0/AAAAAAAAAAI/AAAAAAAAACg/hDAVJ-gnnww/photo.jpg?sz=128", "display_name": "Denis Sterligov", "link": "https://stackoverflow.com/users/5958885/denis-sterligov"}, "is_accepted": true, "score": 2, "last_activity_date": 1574925888, "last_edit_date": 1574925888, "creation_date": 1574842795, "answer_id": 59065869, "question_id": 59065456, "link": "https://stackoverflow.com/questions/59065456/how-understand-this-error-unsupported-destination-should-be-slice-or-struct/59065869#59065869", "title": "How understand this error? &quot;unsupported destination, should be slice or struct&quot;", "body": "<p>You have not initialized the Profile struct. You must first initialize the struct.</p>\n\n<pre><code>user.Profile = &amp;Profile{}\ndb.First(user.Profile, user.ProfileID)\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1970, "favorite_count": 0, "accepted_answer_id": 59065869, "answer_count": 1, "score": 0, "last_activity_date": 1574925888, "creation_date": 1574841086, "last_edit_date": 1574848183, "question_id": 59065456, "link": "https://stackoverflow.com/questions/59065456/how-understand-this-error-unsupported-destination-should-be-slice-or-struct", "title": "How understand this error? &quot;unsupported destination, should be slice or struct&quot;", "body": "<p>I have structure like this:</p>\n\n<pre><code>type Users struct{\n  ID uint \n  Profile  *Profile\n  Name string \n  ProfileID uint \n}\ntype Profile struct{\n  ID uint \n  Name string \n}\n</code></pre>\n\n<p>And I want insert into `User.Profile1 related profile </p>\n\n<pre><code> db.First(&amp;user.Profile, user.ProfileID)\n</code></pre>\n\n<p>Here I get error like this </p>\n\n<pre><code>unsupported destination, should be slice or struct \n</code></pre>\n\n<p>And I don't understand why this error appears. I know that solution is create slice of Profile, but I need only one Profile. </p>\n"}, {"tags": ["go", "import", "go-modules"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574853782, "post_id": 59065117, "comment_id": 104376248, "body": "see go mod edit."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 11631008, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-A6DPo3fATzY/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO_vYd9hVWRpk9fwWW_FXWYZFRGNw/mo/photo.jpg?sz=128", "display_name": "godvlpr", "link": "https://stackoverflow.com/users/11631008/godvlpr"}, "edited": false, "score": 0, "creation_date": 1574860392, "post_id": 59068298, "comment_id": 104379943, "body": "I&#39;m sure that my go.mod is correct. I use library from git, and that library has incorrent import in code"}, {"owner": {"reputation": 203, "user_id": 4944549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-SLFKgr8IBRY/AAAAAAAAAAI/AAAAAAAAF3A/71fQPA6bYRE/photo.jpg?sz=128", "display_name": "vijay krishna", "link": "https://stackoverflow.com/users/4944549/vijay-krishna"}, "edited": false, "score": 0, "creation_date": 1574929013, "post_id": 59068298, "comment_id": 104404589, "body": "which library is it? you can check <a href=\"https://github.com/golang/go/wiki/Modules#when-should-i-use-the-replace-directive\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/&hellip;</a>, you can use replace directive at the end of go mod to point to right path."}, {"owner": {"reputation": 166, "user_id": 11904651, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-WUMVN-fvfNk/AAAAAAAAAAI/AAAAAAAAAOY/j_7iNZcBCGU/photo.jpg?sz=128", "display_name": "Ankush Chadha", "link": "https://stackoverflow.com/users/11904651/ankush-chadha"}, "edited": false, "score": 0, "creation_date": 1575923964, "post_id": 59068298, "comment_id": 104721930, "body": "replace directive fixes the issues locally but the problem still exists for the consumers of the modules where replace directive is used."}], "tags": [], "owner": {"reputation": 203, "user_id": 4944549, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh6.googleusercontent.com/-SLFKgr8IBRY/AAAAAAAAAAI/AAAAAAAAF3A/71fQPA6bYRE/photo.jpg?sz=128", "display_name": "vijay krishna", "link": "https://stackoverflow.com/users/4944549/vijay-krishna"}, "is_accepted": false, "score": 0, "last_activity_date": 1574851282, "creation_date": 1574851282, "answer_id": 59068298, "question_id": 59065117, "link": "https://stackoverflow.com/questions/59065117/replace-string-in-go-sum/59068298#59068298", "title": "Replace string in go.sum", "body": "<p>You should not touch go.sum file, make sure your go.mod file is correct and go.sum is adjusted accordingly</p>\n"}], "owner": {"reputation": 91, "user_id": 11631008, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-A6DPo3fATzY/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQO_vYd9hVWRpk9fwWW_FXWYZFRGNw/mo/photo.jpg?sz=128", "display_name": "godvlpr", "link": "https://stackoverflow.com/users/11631008/godvlpr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 229, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574851282, "creation_date": 1574839734, "question_id": 59065117, "link": "https://stackoverflow.com/questions/59065117/replace-string-in-go-sum", "title": "Replace string in go.sum", "body": "<p>How can i replace a string in go.sum. I use one SDK and it contains a strange import, that import is incorrect, the path of that library was changed to another, and when i do <code>go mod init</code> this incorrect import writes to go.sum.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "edited": false, "score": 0, "creation_date": 1574839117, "post_id": 59064895, "comment_id": 104368358, "body": "In my file Line are small may be 50 char, but file size could be 500 MB to 500 GB. So If I go line by line it is going to be read heavy(like billions of read overhead to syscall). Thats why I wanted to use buffer size of say 5MB or 500 MB based on my RAM"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "edited": false, "score": 0, "creation_date": 1574839465, "post_id": 59064895, "comment_id": 104368513, "body": "If you use a large buffer size, each read will fill the buffer, and then the reader will parse the lines from that buffer. It will not re-read the file for each line."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1574838801, "creation_date": 1574838801, "answer_id": 59064895, "question_id": 59064811, "link": "https://stackoverflow.com/questions/59064811/multi-line-buffered-read-in-go/59064895#59064895", "title": "Multi line buffered read in go", "body": "<p>Since you're using the bufio reader, you shouldn't really work on aligning the input with buffer boundaries yourself. Use one of the high level read functions, such as `bufioreader.ReadString('\\n'), which will read a line using the underlying buffer, and you won't have to deal with line delimiters yourself.</p>\n"}, {"tags": [], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "is_accepted": false, "score": 0, "last_activity_date": 1574842875, "creation_date": 1574842875, "answer_id": 59065889, "question_id": 59064811, "link": "https://stackoverflow.com/questions/59064811/multi-line-buffered-read-in-go/59065889#59065889", "title": "Multi line buffered read in go", "body": "<p>You don\u2019t need bufio reader if you have your own buffer. With your code you have a useless copy of data from the buffer in bufio to the byteslice.</p>\n\n<p>Regarding the split \"foo\" problem, the solution is to move the last 2 characters from the buffer to the front before the next read. </p>\n\n<p>More precisely, if the word to replace has length <em>m</em>, the copy the <em>m-1</em> last letters of the buffer to the front of the buffer, fill the remain of the buffer and search for the word to replace in the buffer. </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// assume we want to find word\n\nfile, err := os.Open(filename)\nif err != nil {\n    panic(err)\n}\ndefer file.Close()\n\ntrailingLen := len(word)-1\ndataLen := 5*1024*1024 + trailingLen\ndata := make([]byte, dataLen) // read 5 MB\n\nfor {\n    n, err := file.Read(data[trailingLen:])\n    if err != nil {\n        if err == io.EOF {\n            break\n        }\n        panic(err)\n    }\n    // search and replace word in data[:n]\n\n    if n == dataLen {\n        copy(data, data[dataLen-trailingLen:])\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8872904, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d13838c5a48a6d8ec08992527ba7a5dc?s=128&d=identicon&r=PG&f=1", "display_name": "Amit", "link": "https://stackoverflow.com/users/8872904/amit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 59064895, "answer_count": 2, "score": 1, "last_activity_date": 1574842875, "creation_date": 1574838483, "question_id": 59064811, "link": "https://stackoverflow.com/questions/59064811/multi-line-buffered-read-in-go", "title": "Multi line buffered read in go", "body": "<p>I am trying to read file in buffered manner because I have very large files. I want to apply some text replacement on a file. Suppose for each read I search for a word 'foo' and replace it with some other word 'bar'. If I read using buffer of some size 5MB then it may be the case foo will split into two reads may be one read 'fo' and another read 'o' then I will not be able to find that word. Is there a way so that I can use buffered read upto last newline or may be read multiple line in buffer\nI did below. But It will not read upto next line or previous line</p>\n\n<pre><code>file, err := os.Open(filename)\nif err != nil {\n    panic(err)\n}\ndefer file.Close()\n\nbyteSlice := make([]byte, 5*1024*1024) // read 5 MB\nbufioreader := bufio.NewReaderSize(file, bufferSize)\n\nfor {\n    n, err := bufioreader.Read(byteSlice)\n    if n &gt; 0 {\n        fmt.Println(byteSlice[:n])\n    } else if err == io.EOF {\n        break\n    } else {\n        panic(err)\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1574848299, "post_id": 59064256, "comment_id": 104373012, "body": "Please <a href=\"https://stackoverflow.com/q/38517593/13860\">don&#39;t use relative imports</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 6, "last_activity_date": 1574847780, "creation_date": 1574847780, "answer_id": 59067217, "question_id": 59064256, "link": "https://stackoverflow.com/questions/59064256/is-it-possible-to-call-a-test-func-from-another-file-to-start-the-testing/59067217#59067217", "title": "Is it possible to call a test Func from another file to start the testing", "body": "<p>There are some great testing patterns in Go. Unfortunately, the way that you're trying to test is not going to work.</p>\n\n<p>Your unit tests should be run using the command <code>go test &lt;pkg</code>. Tests should never be called from within your code itself.</p>\n\n<p>Generally there are two main forms of unit testing in Go - black and white box unit testing.</p>\n\n<blockquote>\n  <p>White-box testing: Testing <strong>unexported</strong> functions from within the\n  package itself.</p>\n  \n  <p>Black-box testing: Testing <strong>exported</strong> functions from outside the\n  package, emulating how other packages will interact with it.</p>\n</blockquote>\n\n<p>If I have a package, <code>example</code>, that I'd like to test. There is a simple <strong>exported</strong> function that sums a list of numbers that are provided. There is also an <strong>unexported</strong> utility function that's used by the <code>Sum</code> function.</p>\n\n<p><strong>example.go</strong></p>\n\n<pre><code>package example\n\nfunc Sum(nums ...int) int {\n    sum := 0\n    for _, num := range nums {\n        sum = add(sum, num)\n    }\n    return sum\n}\n\nfunc add(a, b int) int {\n    return a + b\n}\n</code></pre>\n\n<p><strong>example_test.go</strong> : black-box testing</p>\n\n<p>Notice that I'm testing the <code>example</code> package, but the test sits in the <code>example_test</code> package. Adding the <code>_test</code> keeps the Go compiler happy and lets it know that this is a testing package for <code>example</code>. Here, we may only access exported variables and functions which lets us test the behaviour that external packages will experience when importing and using our <code>example</code> package.</p>\n\n<pre><code>package example_test\n\nimport (\n    \"testing\"\n\n    \"example\"\n)\n\nfunc TestSum(t *testing.T) {\n    tests := []struct {\n        nums []int\n        sum  int\n    }{\n        {nums: []int{1, 2, 3}, sum: 6},\n        {nums: []int{2, 3, 4}, sum: 9},\n    }\n\n    for _, test := range tests {\n        s := example.Sum(test.nums...)\n        if s != test.sum {\n            t.FailNow()\n        }\n    }\n}\n</code></pre>\n\n<p><strong>example_internal_test.go</strong> : white-box testing</p>\n\n<p>Notice that I'm testing the <code>example</code> package, and the test also sits in the <code>example</code> package. This allows the unit tests to access unexported variables and functions.</p>\n\n<pre><code>package example\n\nimport \"testing\"\n\nfunc TestAdd(t *testing.T) {\n    tests := []struct {\n        a   int\n        b   int\n        sum int\n    }{\n        {a: 1, b: 2, sum: 3},\n        {a: 3, b: 4, sum: 7},\n    }\n\n    for _, test := range tests {\n        s := add(test.a, test.b)\n        if s != test.sum {\n            t.FailNow()\n        }\n    }\n}\n</code></pre>\n\n<p>I hope that this you a better understanding on how Go's testing framework is set up and should be used. I haven't used any external libraries in the examples for simplicity sake, although a very popular and powerful package to help with unit testing is <a href=\"https://github.com/stretchr/testify\" rel=\"noreferrer\">github.com/stretchr/testify</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": -2, "last_activity_date": 1574850982, "last_edit_date": 1574850982, "creation_date": 1574849623, "answer_id": 59067782, "question_id": 59064256, "link": "https://stackoverflow.com/questions/59064256/is-it-possible-to-call-a-test-func-from-another-file-to-start-the-testing/59067782#59067782", "title": "Is it possible to call a test Func from another file to start the testing", "body": "<p>What you are attempting <em>is</em> possible, but not advised, as it depends on internal details of Go's <code>testing</code> library, which are not covered by the Go 1 Compatibly Guarantee, meaning you'll likely have to tweak this approach for every version of Go.</p>\n\n<p>You should rarely, if ever, attempt this.  I did this once, for a suite of API integration tests that I wanted to be able to run as normal tests, but also from a CLI tool, to test third-party implementations of the API. Now that I've done it, I'm not sure I'd do it again. I'd probably look for a different approach.</p>\n\n<p>But if you can't be dissuaded, here's what you need to do:</p>\n\n<ol>\n<li><p>Your tests must <em>not</em> be defined in a file named <code>*_test.go</code>. Such files are excluded from normal compilation.</p></li>\n<li><p>You must trigger the tests to run from a file appropriately named <code>*_test.go</code>, for your normal test case.</p></li>\n<li><p>You must manually orchestrate the tests in your non-test case.</p></li>\n</ol>\n\n<p>In detail:</p>\n\n<ol>\n<li><p>Put tests in non-test files.  The <code>testing</code> package is just a standard package, so it's easy to include wherever you need it:</p>\n\n<p><strong>foo.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package foo\n\nimport \"testing\"\n\nfunc SomethingTest(t *testing.T) {\n  // your tests\n}\n</code></pre></li>\n<li><p>Run the tests from a <code>*_test.go</code> file:</p>\n\n<p><strong>foo_test.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestSomething(t *testing.T) {\n    SomethingTest(t)\n}\n</code></pre></li>\n<li><p>And run the tests from your non-test files. Here you are in risky territory, as it requires using methods that are not protected by the Go 1 compatibility guarantee. You need to call the <a href=\"https://golang.org/pkg/testing/#MainStart\" rel=\"nofollow noreferrer\">testing.MainStart</a> method, with a manually-crafted list of tests.</p>\n\n<p>This also requires implementing your own version of <code>testing.testDeps</code>, which is private, but an interface, so easy to implement. You can see my Go 1.9 implementation <a href=\"https://github.com/go-kivik/kiviktest/blob/master/go19testing.go\" rel=\"nofollow noreferrer\">here</a>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>tests := []testing.InternalTest{\n    {\n        Name: \"TestSomething\",\n        f:     SomethingTest,\n    },\n}\nm := testing.MainStart(MyTestDeps, tests, nil, nil)\nos.Exit(m.Run())\n</code></pre></li>\n</ol>\n\n<p>This is a very simplified example, not meant to be complete. But I hope it puts you on the right path.</p>\n"}], "owner": {"reputation": 149, "user_id": 2028837, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/96fc2500fcb5addb319a53cc291c90fd?s=128&d=identicon&r=PG", "display_name": "Arvind", "link": "https://stackoverflow.com/users/2028837/arvind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2398, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1574850982, "creation_date": 1574836027, "last_edit_date": 1574848224, "question_id": 59064256, "link": "https://stackoverflow.com/questions/59064256/is-it-possible-to-call-a-test-func-from-another-file-to-start-the-testing", "title": "Is it possible to call a test Func from another file to start the testing", "body": "<p>Is it possible to call a test Function from a non test go file to start the execution of tests?</p>\n\n<p>e.g., I have a test function:</p>\n\n<pre><code>package API\n\nimport \"testing\"\n\nfunc TestAPI(t *testing.T) { \n...\n}\n</code></pre>\n\n<p>I need to call this from a non test go file. </p>\n\n<pre><code>package main\n\nimport \"../API\"\n\nAPI.TestAPI()\n</code></pre>\n\n<p>Can I do that? </p>\n"}, {"tags": ["git", "go", "primary-key", "timescaledb"], "comments": [{"owner": {"reputation": 1535, "user_id": 840340, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97a63af0bfc1297ec206eca06c7b54bc?s=128&d=identicon&r=PG", "display_name": "k_rus", "link": "https://stackoverflow.com/users/840340/k-rus"}, "edited": false, "score": 0, "creation_date": 1574842502, "post_id": 59063405, "comment_id": 104369909, "body": "Can you share the schema of the table, the hypertable and few insert statements?"}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1574833945, "creation_date": 1574833945, "answer_id": 59063835, "question_id": 59063405, "link": "https://stackoverflow.com/questions/59063405/duplicate-key-error-but-there-is-no-duplicate-data/59063835#59063835", "title": "Duplicate key error! But there is no duplicate data", "body": "<p>You could try and use <a href=\"https://git-scm.com/docs/git-bisect\" rel=\"nofollow noreferrer\"><code>git bisect</code></a>, <a href=\"https://stackoverflow.com/q/17267816/6309\">as in here</a>.</p>\n\n<p>Actually, since you know the error comes from one of the commits from your colleague's merged branch, you could try and merge incrementally that branch (by merging only the first commit of that branch, then the second, and so on), checking each time if those changes introduces the bug you are experiencing.</p>\n"}], "owner": {"reputation": 133, "user_id": 10545595, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/psjcf.jpg?s=128&g=1", "display_name": "user321", "link": "https://stackoverflow.com/users/10545595/user321"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 59063835, "answer_count": 1, "score": 1, "last_activity_date": 1574849989, "creation_date": 1574831608, "last_edit_date": 1574849989, "question_id": 59063405, "link": "https://stackoverflow.com/questions/59063405/duplicate-key-error-but-there-is-no-duplicate-data", "title": "Duplicate key error! But there is no duplicate data", "body": "<p>I'm getting the following error: </p>\n\n<pre><code>ERROR ERROR #23505 duplicate key value violates unique constraint \"tableName_pkey\": \nERROR Error while creating table record =  Record not inserted!:\n</code></pre>\n\n<p>A little background:</p>\n\n<p>My service was working fine on my branch and there was no duplicate key error.<br>\nBut my service started throwing this duplicated error ever since I merged my code with my colleague. </p>\n\n<p>I have tried to find the mistake but unable to track it.<br>\nEvery time unique data is being sent to the table but still this error is displayed.</p>\n"}, {"tags": ["go", "serialization"], "comments": [{"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 2, "creation_date": 1574837017, "post_id": 59062330, "comment_id": 104367479, "body": "The question doesn&#39;t make sense. You want to other side to not know the type but you want them to also know it? The only thing approximating this is send a json-like object (e.g. <code>map[string]interface{}</code>) but what&#39;s the point?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1574850098, "post_id": 59062330, "comment_id": 104374126, "body": "If the actual type is important (i.e a struct, for example), then the receiving end <i>must</i> know it in advance, as Go cannot dynamically create custom types at runtime."}, {"owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "reply_to_user": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1574858587, "post_id": 59062330, "comment_id": 104378959, "body": "@user10753492 The sending side of my message passing package knows the concrete type. I want it to pass this info to the receiving side of the package so that it can unmarshal it into the correct concrete type."}, {"owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "edited": false, "score": 0, "creation_date": 1574910272, "post_id": 59062330, "comment_id": 104399005, "body": "I posted an answer assuming there&#39;s a finite set of concrete types that both sender and receiver are aware of"}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "edited": false, "score": 0, "creation_date": 1574859026, "post_id": 59065905, "comment_id": 104379206, "body": "What you are basically saying is that my message passing package should not attempt to unmarshal the actual message object, and leave that for the receiving app. This isn&#39;t the end of the world, but it is leaving more work for the receiving app, and exposes the fact that the message passing package is using json in its implementation."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574865958, "post_id": 59065905, "comment_id": 104383269, "body": "That&#39;s not what it&#39;s saying at all. The package can handle the unmarshalling. The receiving app just passes the object it wants the message unmarshalled into, the same way you do with <code>json.Unmarshal</code>."}, {"owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "edited": false, "score": 0, "creation_date": 1574866633, "post_id": 59065905, "comment_id": 104383667, "body": "I wasn&#39;t clear enough in my original description, so I updated it. In my main use case (change notifications) the object contains interface{} fields, so specifying the object isn&#39;t sufficient."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574878467, "post_id": 59065905, "comment_id": 104389761, "body": "If the object contains <code>interface{}</code>, the concrete type of the receiving object is <code>interface{}</code>. The cure for that is &quot;don&#39;t do that&quot; - receive into the actual object instead. I do think it might be handy to have a variant of <code>json.Unmarshal</code> that takes JSON-ified data as stored in <code>interface{}</code> or <code>map[string]interface{}</code> or similar, though, to avoid an extra round-trip in some cases."}, {"owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "edited": false, "score": 0, "creation_date": 1574882853, "post_id": 59065905, "comment_id": 104391544, "body": "My conclusion is that getting this to be as neat as a go channel isn&#39;t possible, and I should use another approach."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 1, "last_activity_date": 1574842937, "creation_date": 1574842937, "answer_id": 59065905, "question_id": 59062330, "link": "https://stackoverflow.com/questions/59062330/go-deserialization-when-type-is-not-known/59065905#59065905", "title": "Go deserialization when type is not known", "body": "<h3>TL;DR</h3>\n\n<p>Just use <code>json.Unmarshal</code>.  You can wrap it lightly, using your transport, and call <code>json.Unmarshal</code> (or with a <code>json.Decoder</code> instance, use <code>d.Decode</code>) on your prebuilt JSON bytes and the <code>v interface{}</code> argument from your caller.</p>\n\n<h3>Somewhat longer, with an example</h3>\n\n<p>Consider how <a href=\"https://golang.org/pkg/encoding/json/#Unmarshal\" rel=\"nofollow noreferrer\"><code>json.Unmarshal</code></a> does its own magic.  Its first argument is the JSON (<code>data []byte</code>), but its second argument is of type <code>interface{}</code>:</p>\n\n\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Unmarshal(data []byte, v interface{}) error\n</code></pre>\n\n<p>As the documentation goes on to say, if <code>v</code> really <em>is</em> just an <code>interface{}</code>:</p>\n\n<blockquote>\n  <p>To unmarshal JSON into an interface value, Unmarshal stores one of these in the interface value:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>bool, for JSON booleans\nfloat64, for JSON numbers\nstring, for JSON strings\n[]interface{}, for JSON arrays\nmap[string]interface{}, for JSON objects\nnil for JSON null\n</code></pre>\n</blockquote>\n\n<p>but if <code>v</code> has an underlying <em>concrete type</em>, such as <code>type myData struct { ... }</code>, it's much fancier.  It only does the above if <code>v</code>'s underlying type <em>is</em> <code>interface{}</code>.</p>\n\n<p>Its <a href=\"https://golang.org/src/encoding/json/decode.go?s=4043:4091#L85\" rel=\"nofollow noreferrer\">actual implementation</a> is particularly complex because it's optimized to do the de-JSON-ification and the assignment into the target object at the same time.  In principle, though, it's mostly a big type-switch on the underlying (concrete) type of the interface value.</p>\n\n<p>Meanwhile, what you are describing in your question is that you will first deserialize into generic JSON\u2014which really means a variable of type <code>interface{}</code>\u2014and then do your own assignment <em>out</em> of this pre-decoded JSON into another variable of type <code>interface{}</code>, where the type signature of your own decoder would be:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func xxxDecoder(/* maybe some args here, */ v interface{}) error {\n    var predecoded interface{}\n\n    // get some json bytes from somewhere into variable `data`\n    err := json.Unmarshal(data, &amp;predecoded)\n\n    // now emulate json.Unmarshal by getting field names and assigning\n    ... this is the hard part ...\n}\n</code></pre>\n\n<p>and you would then <em>call</em> this code by writing:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type myData struct {\n    Field1 int    `xxx:\"Field1\"`\n    Field2 string `xxx:\"Field2\"`\n}\n</code></pre>\n\n<p>so that you know that JSON object key \"Field1\" should fill in your Field1 field with an integer, and JSON object key \"Field2\" should fill in your Field2 field with a string:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func whatever() {\n    var x myData\n    err := xxxDecode(..., &amp;x)\n    if err != nil { ... handle error ... }\n    ... use x.Field1 and x.Field2 ...\n}\n</code></pre>\n\n<p>But this is silly.  You can just write:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type myData struct {\n    Field1 int    `json:\"Field1\"`\n    Field2 string `json:\"Field2\"`\n}\n</code></pre>\n\n<p>(or even omit the tags since the field's names are the default json tags), and then do this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func xxxDecode(..., v interface{}) error {\n    ... get data bytes as before ...\n    return json.Unmarshal(data, v)\n}\n</code></pre>\n\n<p>In other words, <strong>just let <code>json.Unmarshal</code> do all the work</strong> by providing <em>json</em> tags in the data structures in question.  You still get\u2014and transmit across your special transport\u2014the JSON data bytes <em>from</em> <code>json.Marshal</code> and <code>json.Unmarshal</code>.  You do the transmitting and receiving.  <code>json.Marshal</code> and <code>json.Unmarshal</code> do all the hard work: you don't have to touch it!</p>\n\n<h3>It's still fun to see how <code>Json.Unmarshal</code> works</h3>\n\n<p>Jump down to <a href=\"https://golang.org/src/encoding/json/decode.go#L661\" rel=\"nofollow noreferrer\">around line 660 of <code>encoding/json/decode.go</code></a>, where you will find the thing that handles a JSON \"object\" (<code>{</code> followed by either <code>}</code> or a string that represents a key), for instance:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (d *decodeState) object(v reflect.Value) error {\n</code></pre>\n\n<p>There are some mechanics to handle corner cases (including the fact that <code>v</code> might not be settable and/or might be a pointer that should be followed), then it makes sure that <code>v</code> is either a <code>map[T1]T2</code> or <code>struct</code>, and if it is a map, that it's suitable\u2014that both <code>T1</code> and <code>T2</code> will work when decoding the \"key\":value items in the object.</p>\n\n<p>If all goes well, it gets into the JSON key-and-value scanning loop starting at line 720 (<code>for {</code>, which will break or return as appropriate).  On each trip through this loop, the code reads the JSON key first, leaving the <code>:</code> and value part for later.</p>\n\n<p>If we're decoding into a <code>struct</code>, the decoder now uses the struct's fields\u2014names and <code>json:\"...\"</code> tags\u2014to find a <code>reflect.Value</code> that we'll use to store right into the field.<sup>1</sup>  This is <code>subv</code>, found by calling <code>v.Field(i)</code> for the right <code>i</code>, with some slightly complicated goo to handle embedded anonymous <code>structs</code> and pointer-following.  The core of this is just <code>subv = v.Field(i)</code>, though, where <code>i</code> is whichever field this key names, within the struct.  So <code>subv</code> is now a <code>reflect.Value</code> that represents the actual struct instance's value, which we should set once we've decoded the value part of the JSON key-value pair.</p>\n\n<p>If we're decoding into a map, we will decode the value into a temporary first, then store it into the map after decoding.  It would be nice to share this with the struct-field storing, but we need a different <code>reflect</code> function to do the store into the map: <a href=\"https://golang.org/pkg/reflect/#Value.SetMapIndex\" rel=\"nofollow noreferrer\"><code>v.SetMapIndex</code></a>, where <code>v</code> is the <code>reflect.Value</code> of the map.  That's why for a map, <code>subv</code> points to a temporary <code>Elem</code>.</p>\n\n<p>We're now ready to convert the actual value to the target type, so we go back to the JSON bytes and consume the colon <code>:</code> character and read the JSON value.  We get the value and store it into our storage location (<code>subv</code>).  This is the code starting at line 809 (<code>if destring {</code>).  The actual assigning is done through the decoder functions (<code>d.literalStore</code> at line 908, or <code>d.value</code> at line 412) and these actually decode the JSON value while doing the storing.  Note that only <code>d.literalStore</code> really stores the value\u2014<code>d.value</code> calls on <code>d.array</code>, <code>d.object</code>, or <code>d.literalStore</code> to do the work recursively if needed.</p>\n\n<p><code>d.literalStore</code> therefore contains many <code>switch v.Kind()</code>s: it parses a <code>null</code> or a <code>true</code> or <code>false</code> or an integer or a string or an array, then makes sure it can store the resulting value into <code>v.Kind()</code>, and chooses <em>how</em> to store that resulting value into <code>v.Kind()</code> based on the combination of what it just decoded, and the actual <code>v.Kind()</code>.  So there's a bit of a combinatorial explosion here, but it gets the job done.</p>\n\n<p>If all that worked, and we're decoding to a map, we may now need to massage the type of the temporary, find the real key, and store the converted value into the map.  That's what lines 830 (<code>if v.Kind() == reflect.Map {</code>) through the final close brace at 867 are about.</p>\n\n<hr>\n\n<p><sup>1</sup>To find fields, we first look over at <code>encoding/json/encode.go</code> to find <code>cachedTypeFields</code>.  It is a caching version of <a href=\"https://golang.org/src/encoding/json/encode.go#L1074\" rel=\"nofollow noreferrer\"><code>typeFields</code></a>.  This is where the json tags are found and put into a slice.  The result is cached via <code>cachedTypeFields</code> in a map indexed by the reflect-type value of the <code>struct</code> type.  So what we get is a slow lookup the first time we use a <code>struct</code> type, then a fast lookup afterwards, to get a slice of information about how to do the decoding.  This slice-of-information maps from json-tag-or-field name to: field; type; whether it's a sub-field of an anonymous structure; and so on: everything we will need to know to decode it properly\u2014or to encode it, on the encoding side.  (I didn't really look closely at this code.)</p>\n"}, {"comments": [{"owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "edited": false, "score": 0, "creation_date": 1574953203, "post_id": 59081164, "comment_id": 104417562, "body": "Yes, and this is pretty mucyh what I&#39;m currently doing. But either the generic package needs to know about the set of types so it can do the decode (which isn&#39;t desired for a general change notification service) or the user of the package needs to do the decode (and I&#39;d prefer the package did that for it)"}], "tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1574910169, "creation_date": 1574910169, "answer_id": 59081164, "question_id": 59062330, "link": "https://stackoverflow.com/questions/59062330/go-deserialization-when-type-is-not-known/59081164#59081164", "title": "Go deserialization when type is not known", "body": "<p>You can encode/decode several message on the same buffer, whether that be a \"gob\" or \"json\" or some other encoding.</p>\n\n<p>Assuming there's a limited set of concrete types that you want to support, you can always encode a type tag as the first thing, then encode the actual object. This way the decode can decode the type tag first, and depending on its value, decide how to decode the next item.</p>\n\n<pre><code>// encoder side\n\nenc := json.NewEncoder(buffer) // or gob.NewEncoder(buffer)\nenc.Encode(\"player\")\nenc.Encode(playerInstance)\n\n\n// decoder side\n\ndec := json.NewDecoder(buffer) // or gob.NewDecoder(buffer)\nvar tag string\ndec.Decode(&amp;tag)\nswitch tag {\n    case \"player\":\n        var playerInstance Player\n        dec.Decode(&amp;player)\n        // do something with it\n    case \"somethingelse\":\n        // decode something else\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 98, "user_id": 2211841, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/0ac526bc38a8299955e0942f14c99ab3?s=128&d=identicon&r=PG", "display_name": "host.13", "link": "https://stackoverflow.com/users/2211841/host-13"}, "is_accepted": false, "score": 0, "last_activity_date": 1584216584, "last_edit_date": 1584216584, "creation_date": 1584216248, "answer_id": 60686847, "question_id": 59062330, "link": "https://stackoverflow.com/questions/59062330/go-deserialization-when-type-is-not-known/60686847#60686847", "title": "Go deserialization when type is not known", "body": "<p>Try <a href=\"https://github.com/untillpro/dynobuffers\" rel=\"nofollow noreferrer\">dynobuffers</a> instead of struct. It provides get and set by name ability for byte array. Also it is much more faster than json.</p>\n"}], "owner": {"reputation": 45, "user_id": 3014416, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52a40aaf51ae7f0550504afa50860876?s=128&d=identicon&r=PG&f=1", "display_name": "user3014416", "link": "https://stackoverflow.com/users/3014416/user3014416"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 788, "favorite_count": 0, "accepted_answer_id": 59065905, "answer_count": 3, "score": -3, "last_activity_date": 1584216584, "creation_date": 1574823262, "last_edit_date": 1574860780, "question_id": 59062330, "link": "https://stackoverflow.com/questions/59062330/go-deserialization-when-type-is-not-known", "title": "Go deserialization when type is not known", "body": "<p>I'm writing a package in go to send messages between services, using a specific type of transport.</p>\n\n<p>I'd like the package to not understand the type of messages being sent.\nMy first thought is to serialize the message object into json, send that, deserialize on the receiving end, and pass the go object (as an <code>interface{}</code>) to the subscribing code.</p>\n\n<p>The serialization isn't a problem, but I don't see how the generic package code can deserialize the message since it doesn't know the type. I thought of using reflect <code>TypeOf()</code>, and passing that value as part of the message. But I don't see how to accomplish this since Type is an interface and the implementing rtype is not exported.</p>\n\n<p>If the receiving app gets an <code>interface{}</code>, it is going to have to check the type anyways, so maybe it should just do the deserialization. Or the receiver could provide a reflect Type so the package can deserialize?</p>\n\n<p>Or it could give the receiver a map of field name to value, but I'd prefer the actual type.</p>\n\n<p>Any suggestions?</p>\n\n<p>Let me add an example:</p>\n\n<p>I have a go channel for sending change notifications of different types of objects. Since go doesn't support tagged unions, I define the channel type as:</p>\n\n<pre><code>type UpdateInfo struct {\n    UpdateType UpdateType\n    OldObject interface{}\n    NewObject interface{}\n}\n</code></pre>\n\n<p>The receiving end of the channel gets an UpdateInfo with OldObject and NewObject as the actual concrete object types that were sent.</p>\n\n<p>I want to extend this to work between applications, where the transport will be via a message queue to support pub/sub, multiple consumers, etc.</p>\n"}, {"tags": ["go", "deadlock"], "comments": [{"owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "edited": false, "score": 1, "creation_date": 1574808484, "post_id": 59060294, "comment_id": 104360347, "body": "<i>Do not communicate by sharing memory; instead, share memory by communicating.</i>. Do not pass a pointer to <code>done</code> to multiple routines. Use a channel or <code>sync.WaitGroup</code>"}, {"owner": {"reputation": 18851, "user_id": 414813, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83284c54c3fc960dcdf8844ed92227d7?s=128&d=identicon&r=PG", "display_name": "CAFxX", "link": "https://stackoverflow.com/users/414813/cafxx"}, "edited": false, "score": 3, "creation_date": 1574810210, "post_id": 59060294, "comment_id": 104360864, "body": "The title seems completely uncorrelated... The runtime is already detecting the deadlock for you, you want to know why there is a deadlock, not how to detect it."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1574865727, "post_id": 59060414, "comment_id": 104383137, "body": "This is totally unnecessary. <code>for tmp := range channel</code> will already exit the loop when the channel is closed."}, {"owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574924103, "post_id": 59060414, "comment_id": 104402643, "body": "@Adrian you are right. Shouldn&#39;t have tried to answer this quickly from mobile. I removed the incorrect example from my answer."}], "tags": [], "owner": {"reputation": 626, "user_id": 2454720, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2a13483fe013b55121def2b6bbd68462?s=128&d=identicon&r=PG", "display_name": "Ferdy Pruis", "link": "https://stackoverflow.com/users/2454720/ferdy-pruis"}, "is_accepted": false, "score": -1, "last_activity_date": 1574924059, "last_edit_date": 1574924059, "creation_date": 1574807929, "answer_id": 59060414, "question_id": 59060294, "link": "https://stackoverflow.com/questions/59060294/how-can-i-detect-a-deadlock/59060414#59060414", "title": "How can i detect a deadlock?", "body": "<p>Reading from a channel is blocked until there is data. You can check the second return value to assert whether the channel was closed.\nUse <code>close(channel)</code> when finished writing.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>tmp, ok := &lt;-channel\n</code></pre>\n\n<p>You have an endless for-loop forever reading the channel.</p>\n"}, {"tags": [], "owner": {"reputation": 46, "user_id": 5958885, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-PBBAEnnrVj0/AAAAAAAAAAI/AAAAAAAAACg/hDAVJ-gnnww/photo.jpg?sz=128", "display_name": "Denis Sterligov", "link": "https://stackoverflow.com/users/5958885/denis-sterligov"}, "is_accepted": false, "score": 0, "last_activity_date": 1574809948, "creation_date": 1574809948, "answer_id": 59060753, "question_id": 59060294, "link": "https://stackoverflow.com/questions/59060294/how-can-i-detect-a-deadlock/59060753#59060753", "title": "How can i detect a deadlock?", "body": "<p>I advise you to read the following article <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">https://blog.golang.org/pipelines</a>.</p>\n\n<p>But I don't think that channels are a good choice in this case. Perhaps it would be better to use sync.WaitGroup</p>\n\n<pre><code>wg := &amp;sync.WaitGroup{}\nwg.Add(max)\nfor number := min; number &lt;= max; number++ {\n    go func(number int) {\n        defer wg.Done()\n        res := checkNumber(number)\n        if strings.Contains(res, \":\") {\n            parts := strings.Split(res, \":\")\n            fmt.Printf(\"%s is an amicable of %s!\\n\", parts[0], parts[1])\n        } else {\n            fmt.Printf(\"%s is perfect!\\n\", res)\n        }\n    }(number)\n}\nwg.Wait()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 27, "user_id": 12441382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72f45052831caf3b14618521793dcd6?s=128&d=identicon&r=PG&f=1", "display_name": "Jooarye", "link": "https://stackoverflow.com/users/12441382/jooarye"}, "edited": false, "score": 0, "creation_date": 1574842606, "post_id": 59060775, "comment_id": 104369975, "body": "Hey, thanks for the quick response. I edited my program and implemented your ideas, it works fine now!"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 7, "last_activity_date": 1574810128, "creation_date": 1574810128, "answer_id": 59060775, "question_id": 59060294, "link": "https://stackoverflow.com/questions/59060294/how-can-i-detect-a-deadlock/59060775#59060775", "title": "How can i detect a deadlock?", "body": "<p>There are multiple problems with your program:</p>\n\n<ul>\n<li>The use of <code>done</code> is racy. Multiple goroutines are writing to it without synchronization. It doesn't look like it's been used.</li>\n<li>You are trying to read from a channel in an infinite for-loop. Eventually, you read from a channel when there are no goroutines left, and that's the deadlock.</li>\n</ul>\n\n<p>One way to deal with this is to use a sync.WaitGroup, and keep track of starting/stopping goroutines that way.</p>\n\n<pre><code>wg:=sync.WaitGroup{}\nfor number := min; number &lt;= max; number++ {\n    wg.Add(1)\n    go checkNumber(number, channel, &amp;wg)\n}\n</code></pre>\n\n<p>In checkNumber:</p>\n\n<pre><code>func checkNumber(number int, channel chan string,wg *wg.WaitGroup) {\n  defer wg.Done()\n  ...\n}\n</code></pre>\n\n<p>You can have a separate goroutine that waits for all goroutines to complete:</p>\n\n<pre><code>go func() {\n  wg.Wait()\n  close(chan)\n}()\n</code></pre>\n\n<p>And, in your for-loop, read it like this, so it terminates when the channel closes:</p>\n\n<pre><code>for tmp:=range chan {\n  ...\n}\n</code></pre>\n"}], "owner": {"reputation": 27, "user_id": 12441382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a72f45052831caf3b14618521793dcd6?s=128&d=identicon&r=PG&f=1", "display_name": "Jooarye", "link": "https://stackoverflow.com/users/12441382/jooarye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1574924059, "creation_date": 1574807212, "last_edit_date": 1574891040, "question_id": 59060294, "link": "https://stackoverflow.com/questions/59060294/how-can-i-detect-a-deadlock", "title": "How can i detect a deadlock?", "body": "<p>I just recently started learning go and wanted to test my skills by writing a program that calculates all amicable and perfect numbers. Sadly I'm having issues with my code! If anyone knows how I can stop the program after all numbers are calculated, preferably without an error, please let me know.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc getDivisorSum(number int) int {\n    divisors := 0\n\n    for possibleDivisor := 1; possibleDivisor &lt;= number / 2; possibleDivisor++ {\n        if number % possibleDivisor == 0 {\n            divisors += possibleDivisor\n        }\n    }\n\n    return divisors\n}\n\nfunc checkNumber(number int, channel chan string, done *int) {\n    first := getDivisorSum(number)\n\n    if first == number {\n        channel &lt;- fmt.Sprintf(\"%d\", number)\n        *done += 1\n        return\n    }\n\n    second := getDivisorSum(first)\n\n    if number == second {\n        channel &lt;- fmt.Sprintf(\"%d:%d\", number, first)\n        *done += 1\n        return\n    }\n}\n\nfunc checkNumberRange(min int, max int) {\n    channel := make(chan string)\n    done := 0\n\n    for number := min; number &lt;= max; number++ {\n        go checkNumber(number, channel, &amp;done)\n    }\n\n    for {\n        tmp := &lt;- channel\n\n        if strings.Contains(tmp, \":\") {\n            parts := strings.Split(tmp, \":\")\n            fmt.Printf(\"%s is an amicable of %s!\\n\", parts[0], parts[1])\n        } else {\n            fmt.Printf(\"%s is perfect!\\n\", tmp)\n        }\n    }\n}\n\nfunc main() {\n    checkNumberRange(1, 65536)\n}\n\n</code></pre>\n\n<p>At the moment the program is crashing with a deadlock at </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>tmp := &lt;- channel\n</code></pre>\n\n<p>Thanks in advance, Jooarye!</p>\n"}, {"tags": ["sockets", "go", "udp"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574806338, "post_id": 59059874, "comment_id": 104359672, "body": "<a href=\"https://golang.org/pkg/net/#Dial\" rel=\"nofollow noreferrer\">&quot;Dial connects to the address on the named network.&quot;</a> What&#39;s confusing about that?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574806815, "post_id": 59059874, "comment_id": 104359836, "body": "It executes a syscall to open a network socket for the UDP &quot;connection&quot;, and gets a file descriptor back which is wrapped in a <code>net.Conn</code> for use. It uses dial/connection semantics because that is how the underlying OS network stack operates."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574806835, "post_id": 59059874, "comment_id": 104359845, "body": "<a href=\"https://golang.org/src/net/udpsock_posix.go?h=dialUDP#L97\" rel=\"nofollow noreferrer\">golang.org/src/net/udpsock_posix.go?h=dialUDP#L97</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1574809323, "post_id": 59059874, "comment_id": 104360601, "body": "The POSIX socket api has &quot;connected&quot; UDP sockets, so <code>Dial</code> is exactly the same as you would get via the <code>connect</code> syscall in C."}, {"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574810966, "post_id": 59059874, "comment_id": 104361081, "body": "@Adrian you don&#39;t need an IP address and port number to open a UDP socket, atleast, not in C..."}], "answers": [{"comments": [{"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1574810920, "post_id": 59060842, "comment_id": 104361064, "body": "I find it confusing that Golang keeps a connection state for a connectionless protocol. The whole <code>Dial</code> interface makes it hard to send messages to multiple hosts at once with a single socket. Moreover, does <code>Dial</code> ever fail for a UDP connection considering that, in theory, there&#39;s no need to establish set connection successfully? What would be an efficient way of sending UDP packets across multiple hosts at once?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 1, "creation_date": 1574812529, "post_id": 59060842, "comment_id": 104361474, "body": "@Whiteclaws: what torek is getting at is that this mirrors the underlying OS. You&#39;re understanding of the C api is incomplete, and you can create a &quot;connected&quot; UDP socket, which may behave slightly differently (for example, a connected socket may only return packets from the established remote host)."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 4, "creation_date": 1574813438, "post_id": 59060842, "comment_id": 104361702, "body": "@Whiteclaws: if you&#39;re willing to bypass all the good stuff Go does for you, you can get a raw OS socket and call the raw OS <code>sendto</code> system call directly. There are a number of obstacles here (of varying difficulty levels), and if you do this, your Go program won&#39;t run on <i>other</i> OSes. Note that the Go ecosystem includes wrapping OS sockets in non-blocking behavior for better goroutine performance."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1574822546, "post_id": 59060842, "comment_id": 104363597, "body": "@Whiteclaws, perhaps you\u2019re missing the fact that you create an ordinary unconnected UDP socket using <a href=\"https://golang.org/pkg/net/#ListenUDP\" rel=\"nofollow noreferrer\"><code>ListenUDP</code></a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1574842676, "post_id": 59060842, "comment_id": 104370010, "body": "I would add that since some version of Go, every &quot;standard&quot; connection type from the <code>net</code> package (<code>IPConn</code>, <code>TCPConn</code>, <code>UDPConn</code>) supports the <code>SyscallConn</code> method which allows getting one&#39;s hand on a very thinly wrapped underlying socket\u2014<a href=\"https://golang.org/pkg/syscall/#RawConn\" rel=\"nofollow noreferrer\"><code>syscall.RawConn</code></a> which basically allows one to call arbitrary <code>fcntl</code>s on the socket as well as doing &quot;raw&quot; reads and writes on it."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1574843439, "post_id": 59060842, "comment_id": 104370427, "body": "@kostix: according to the linked page, it was new in 1.9. I managed to miss it. Nice to know it&#39;s there, for various special purpose hacks."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1574845572, "post_id": 59060842, "comment_id": 104371504, "body": "Yeah, precisely :) \u2014 to obviate the need for nifty hacks like <a href=\"https://github.com/libp2p/go-reuseport\" rel=\"nofollow noreferrer\">this one</a>. IIRC, an umbrella issue which resulted in the current approach and implementation was <a href=\"https://github.com/golang/go/issues/9661\" rel=\"nofollow noreferrer\">#9661</a>."}, {"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1574878657, "post_id": 59060842, "comment_id": 104389840, "body": "@torek is the second &quot;fire-and-forget&quot; behavior available through raw sockets?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1574878949, "post_id": 59060842, "comment_id": 104389985, "body": "@Whiteclaws: if you use the <code>syscall.RawConn</code> trick to grab hold of a UDP socket before it&#39;s connected, you could then do a bunch of <code>syscall.Sendto</code> or <code>syscall.Sendmsg</code> operations before the dial code does a <code>connect</code>. Whether this works at all on Windows, I don&#39;t know; on BSD-derived systems and Linux, it should."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574879053, "post_id": 59060842, "comment_id": 104390030, "body": "Meanwhile, as JimB noted, you could use <code>ListenUDP</code> to create a socket that&#39;s bound but not connected. You could then use the <code>RawConn</code> <code>Write</code> method to do <code>syscall.Sendto</code> etc. Again, it&#39;s not obvious whether this works on every OS."}, {"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "edited": false, "score": 0, "creation_date": 1574881602, "post_id": 59060842, "comment_id": 104391085, "body": "@torek this doesn&#39;t seem to be a very trivial matter in Go and looks like it isn&#39;t the intended way of doing things, very well, I guess..."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 5, "last_activity_date": 1574810580, "creation_date": 1574810580, "answer_id": 59060842, "question_id": 59059874, "link": "https://stackoverflow.com/questions/59059874/why-does-the-udp-writer-dial/59060842#59060842", "title": "Why does the UDP writer dial?", "body": "<p>UDP <em>is</em> connectionless, at least in principal (implementations vary).  But there's still an implementation detail to worry about: to send a UDP packet (datagram) from \"me\" (my IP host and port addresses) to \"you\" (your IP host and port addresses), I must, at the least, specify your IP-and-port.  The same goes in reverse if and when you want to send a datagram to me.</p>\n\n<p>Depending on the underlying OS, you or I <em>may</em> be able to do this with a <code>sendto</code> system-call.  That is, we start with a <code>socket</code> system call, then use a <code>sendto</code> system call to fire-and-forget: the datagram goes off, or doesn't, and we never bother to see what happens next.  The <code>sendto</code> call takes a destination address, which for TCP or UDP, supplies the IP address and port.</p>\n\n<p>Or, we may use a <code>socket</code> system call, followed by an optional <code>bind</code> system call, followed by a <code>connect</code> system call.<sup>1</sup>  The <code>bind</code>, if we do it, establishes our local port (and maybe IP address, if we have more than one) and the <code>connect</code> establishes our destination IP address and port.  Now we can send packets with <code>write</code> or <code>send</code> system calls.</p>\n\n<p>(Some systems add <code>sendmsg</code> and other such calls, which are generally supersets of all of the above and therefore can be used without a preliminary <code>connect</code>.  But <em>all</em> systems that support TCP have the concept of creating a network connection and bind-and-or-connect-ing and then writing data.)</p>\n\n<p>One least-common-denominator setup, which is also pretty useful, is to assume that you'll specify your remote peer address at the time you want to create a network connection.  To do that in Go, use <code>Dial</code>.  Even if your underlying system has, say, only raw IP sockets, the library could build UDP atop those and provide the <code>Dial</code> interface, and that would then still work in Go.</p>\n\n<hr>\n\n<p><sup>1</sup>Ideally, this probably should have been an \"establish peer information\" system call, providing <em>both</em> local <em>and</em> remote addressing information, plus any optional flags.  Omitting a remote specifier would mean \"listen to all incoming connections from everyone\".  That would have eliminated the need for the <code>SO_REUSEADDR</code> flag, which exists just because it's otherwise impossible to distinguish between a <code>bind</code> that comes before a <code>connect</code>, or a <code>bind</code> that comes before a <code>listen</code>.  But it's a little late to fix 4.2BSD now. \ud83d\ude00</p>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 1, "accepted_answer_id": 59060842, "answer_count": 1, "score": 1, "last_activity_date": 1574810580, "creation_date": 1574805059, "last_edit_date": 1574806218, "question_id": 59059874, "link": "https://stackoverflow.com/questions/59059874/why-does-the-udp-writer-dial", "title": "Why does the UDP writer dial?", "body": "<p>I come from a C background and from my understanding, UDP is a connection-less protocol which, I assume, means that packets can't be sent without making a connection first. However, as I have gotten into Go and started writing networking code. I realised that Go's UDP writer dials a host before sending packets to it. Why is that?</p>\n"}, {"tags": ["go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1574848310, "post_id": 59059094, "comment_id": 104373021, "body": "Call to that API returns: <i>main.go:25: googleapi: Error 400: Switching network mode to custom subnet mode is not supported for legacy mode network., badRequest</i>."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1574801117, "creation_date": 1574801117, "answer_id": 59059094, "question_id": 59058750, "link": "https://stackoverflow.com/questions/59058750/gcp-compute-api-creates-vpc-in-legacy-mode/59059094#59059094", "title": "GCP Compute API creates VPC in legacy mode", "body": "<p>You need to use <a href=\"https://godoc.org/google.golang.org/api/compute/v1#NetworksService.SwitchToCustomMode\" rel=\"nofollow noreferrer\"><code>NetworksService.SwitchToCustomMode</code></a></p>\n\n<blockquote>\n  <p>SwitchToCustomMode: Switches the network mode from auto subnet mode to custom subnet mode.</p>\n</blockquote>\n\n<pre><code>func (r *NetworksService) SwitchToCustomMode(project string, network string) *NetworksSwitchToCustomModeCall\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "is_accepted": true, "score": 2, "last_activity_date": 1574849663, "last_edit_date": 1574849663, "creation_date": 1574849023, "answer_id": 59067604, "question_id": 59058750, "link": "https://stackoverflow.com/questions/59058750/gcp-compute-api-creates-vpc-in-legacy-mode/59067604#59067604", "title": "GCP Compute API creates VPC in legacy mode", "body": "<p>Terraform already found a fix for this issue: <a href=\"https://github.com/terraform-providers/terraform-provider-google/blob/f2f276ea0b8a98fa782a9321a9d4b55122e27fe5/google/resource_compute_network.go#L83\" rel=\"nofollow noreferrer\">link</a>. Apparently <code>AutoCreateSubnetworks</code> field is not included in request payload unless explicitely told by <code>ForceSendFields</code> property.</p>\n\n<p>In practice, this works:</p>\n\n<pre><code>func CreateVPC(ctx context.Context, ns *compute.NetworksService, name string) (*compute.Operation, error) {\n    net := &amp;compute.Network{\n        Name:                  name,\n        AutoCreateSubnetworks: false,\n        // make sure AutoCreateSubnetworks field is included in request\n        ForceSendFields: []string{\"AutoCreateSubnetworks\"},\n    }\n    return ns.Insert(projectID, net).Context(ctx).Do()\n}\n</code></pre>\n\n<p>The documentation of <code>ForceSendFields</code> says exactly that all empty fields are omitted from request payload. Unfortunately, what it does not say is that if <code>AutoCreateSubnetworks</code> is omitted then VPC is created in legacy mode.</p>\n\n<blockquote>\n  <p>By default, fields with\n    empty values are omitted from API requests. However, any non-pointer,\n    non-interface field appearing in ForceSendFields will be sent to the\n    server regardless of whether the field is empty or not.</p>\n</blockquote>\n"}], "owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 135, "favorite_count": 1, "accepted_answer_id": 59067604, "answer_count": 2, "score": 1, "last_activity_date": 1574849663, "creation_date": 1574799422, "last_edit_date": 1574801506, "question_id": 59058750, "link": "https://stackoverflow.com/questions/59058750/gcp-compute-api-creates-vpc-in-legacy-mode", "title": "GCP Compute API creates VPC in legacy mode", "body": "<p>I am using the below Go program to create a VPC in my Google Cloud Platform project.</p>\n\n<pre><code>func CreateGCPClient(ctx context.Context) (*compute.Service, error) {\n    cred := option.WithCredentialsFile(path)\n    return compute.NewService(ctx, cred)\n}\n\nfunc CreateNetworksService(s *compute.Service) *compute.NetworksService {\n    return compute.NewNetworksService(s)\n}\n\nfunc CreateVPC(ctx context.Context, ns *compute.NetworksService, name string) (*compute.Operation, error) {\n    net := &amp;compute.Network{\n        Name:                  name,\n        AutoCreateSubnetworks: false,\n        IPv4Range:             \"\",\n    }\n    return ns.Insert(projectID, net).Context(ctx).Do()\n}\n\nfunc main() {\n    log.SetFlags(log.Lshortfile)\n    ctx := context.Background()\n    clt, err := CreateGCPClient(ctx)\n    if err != nil {\n        log.Fatal(err)\n    }\n    netserv := CreateNetworksService(clt)\n\n    out, err := CreateVPC(ctx, netserv, \"test\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Printf(\"Out: %+v\\n\", out)\n}\n</code></pre>\n\n<p>This is creating a VPC in <em>legacy</em> mode instead of <em>custom</em> mode. <a href=\"https://cloud.google.com/compute/docs/reference/rest/v1/networks/insert\" rel=\"nofollow noreferrer\">Documentation</a> says that <code>IPv4Range</code> field is deprecated. In fact, first I tried to elide it completely from <code>compute.Network</code> struct. But it gives the same result.</p>\n\n<p>Apparently GCP automatically allocates a default private CIDR (10.240.0.0/16) to the VPC everytime it gets created by this program.</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["docker", "go", "elasticsearch", "kibana"], "comments": [{"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 1, "creation_date": 1574789457, "post_id": 59056385, "comment_id": 104352354, "body": "Did you try to access the logs and verify whether its getting hit in the go server and did you try to query elastic search outside to verify whether its working ?"}, {"owner": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "reply_to_user": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574789589, "post_id": 59056385, "comment_id": 104352423, "body": "What I can see is the last thing I posted in the original question. <code>Error getting response</code> is dumped from webserver func in main.go, so it manages to create the <code>NewDefaultClient</code>, but cannot get <code>es.Info()</code>"}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574789761, "post_id": 59056385, "comment_id": 104352506, "body": "Try using something like this directly , elastic.NewClient(       elastic.SetURL(&quot;<a href=\"http://localhost:9200&quot;\" rel=\"nofollow noreferrer\">localhost:9200&quot;</a>),       elastic.SetSniff(false),     )"}, {"owner": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "reply_to_user": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574790194, "post_id": 59056385, "comment_id": 104352738, "body": "I tried that, but it seems that <code>SetURL</code> is not a func that i can use through <code>elasticsearch</code>. It refuses to compile and my IDE outputs <code>SetURL not declared by package elasticsearch</code>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1574790721, "post_id": 59056385, "comment_id": 104353005, "body": "127.0.0.1 in Docker is almost always &quot;this container&quot;.  You need to add configuration to your application (environment variables work well here) for the location of the database, and then you can use the Docker Compose service name <code>elasticsearch</code> as a host name."}, {"owner": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1574791664, "post_id": 59056385, "comment_id": 104353443, "body": "@DavidMaze Do you have an example at hand, where something like this is done? I&#39;m having a hard time wrapping my head around the containers and my own system, whats what, in the different files."}], "answers": [{"comments": [{"owner": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "edited": false, "score": 0, "creation_date": 1574790376, "post_id": 59056662, "comment_id": 104352832, "body": "I can confirm that I get this using curl through the terminal or when I just access it directly through my browser. As mentioned in the question, I am also able to access <code>localhost:5601</code> which takes me to Kibana where I can query all the data I indexed earlier today."}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "reply_to_user": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "edited": false, "score": 0, "creation_date": 1574797337, "post_id": 59056662, "comment_id": 104355934, "body": "Try setting the network and verify once"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1574860984, "post_id": 59056662, "comment_id": 104380271, "body": "You do not need to explicitly declare a network; Docker Compose provides a <code>default</code> network for you.  <a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow noreferrer\">Networking in Compose</a> has details.  (This also won&#39;t solve the missing address configuration in the original question.)"}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574861294, "post_id": 59056662, "comment_id": 104380466, "body": "That&#39;s right , But there is one more aspect when you check the example in the link its specified that (Within the web container, your connection string to db would look like postgres://db:5432, and from the host machine, the connection string would look like postgres://{DOCKER_IP}:8001)"}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574861363, "post_id": 59056662, "comment_id": 104380504, "body": "So just check docker inspect container_id and check the IP for your elasticsearch, kinbana and go webserver."}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574862574, "post_id": 59056662, "comment_id": 104381183, "body": "One more things that popped mind suddenly was you can directly use <a href=\"http://elasticsearch:9200/\" rel=\"nofollow noreferrer\">elasticsearch:9200</a> to access your container when you are in the same network using docker compose try that also."}, {"owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "edited": false, "score": 0, "creation_date": 1574862799, "post_id": 59056662, "comment_id": 104381334, "body": "sometimes there is a a possiblity that max virtual memory areas vm.max_map_count [65530] is too low,due to that the elastic search container would have automatically stopped , So increase it using the command sysctl -w vm.max_map_count=262144 and then start the container again."}], "tags": [], "owner": {"reputation": 1878, "user_id": 2436979, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6OF9s.jpg?s=128&g=1", "display_name": "redhatvicky", "link": "https://stackoverflow.com/users/2436979/redhatvicky"}, "is_accepted": false, "score": -2, "last_activity_date": 1574795016, "last_edit_date": 1574795016, "creation_date": 1574790250, "answer_id": 59056662, "question_id": 59056385, "link": "https://stackoverflow.com/questions/59056385/cannot-connect-to-elasticsearch-from-go-server-running-in-docker/59056662#59056662", "title": "Cannot connect to Elasticsearch from Go server running in Docker", "body": "<p>You can mention the network as bridge in the docker-compose file and verify once , How it works .</p>\n\n<pre><code>version: \"3.7\"\n\nservices:\n  web:\n    image: go-docker-webserver\n    build: .\n    ports:\n      - \"8080:8080\"\n    networks:\n      - elastic\n\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.4.2\n    environment:\n      node.name: elasticsearch\n      cluster.initial_master_nodes: elasticsearch\n      cluster.name: docker-cluster\n      bootstrap.memory_lock: \"true\"\n      ES_JAVA_OPTS: -Xms256m -Xmx256m\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - \"9200:9200\"\n    networks:\n      - elastic\n\n  kibana:\n    image: docker.elastic.co/kibana/kibana:7.4.2\n    ports:\n      - \"5601:5601\"\n    links:\n      - elasticsearch\n    networks:\n      - elastic\n\nnetworks:\n  elastic:\n    driver: bridge\n</code></pre>\n\n<p>set the kernal setting to 262144 :</p>\n\n<pre><code>sysctl -w vm.max_map_count=262144\n</code></pre>\n"}], "owner": {"reputation": 712, "user_id": 2984408, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/cEZLr.jpg?s=128&g=1", "display_name": "Severin", "link": "https://stackoverflow.com/users/2984408/severin"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "closed_date": 1574796689, "answer_count": 1, "score": -4, "last_activity_date": 1574795016, "creation_date": 1574789202, "question_id": 59056385, "link": "https://stackoverflow.com/questions/59056385/cannot-connect-to-elasticsearch-from-go-server-running-in-docker", "closed_reason": "Duplicate", "title": "Cannot connect to Elasticsearch from Go server running in Docker", "body": "<p>I have set up an environment today that runs a <code>golang:1.13-alpine</code> image, along with the latest images for Elasticsearch and Kibana.</p>\n\n<p>Elasticsearch and Kibana are running fine when accessing from my local machine, but I cannot connect to Elasticsearch through the Go server. I have put this together from guides I have found and followed. </p>\n\n<p>I am still a bit green using Docker. I have an idea that I am pointing at the wrong ip address in the container, but I am unsure how to fix it. Hope someone can guide me in the right direction.</p>\n\n<p><strong>docker-compose.yml:</strong></p>\n\n<pre><code>version: \"3.7\"\n\nservices:\n  web:\n    image: go-docker-webserver\n    build: .\n    ports:\n      - \"8080:8080\"\n\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.4.2\n    environment:\n      node.name: elasticsearch\n      cluster.initial_master_nodes: elasticsearch\n      cluster.name: docker-cluster\n      bootstrap.memory_lock: \"true\"\n      ES_JAVA_OPTS: -Xms256m -Xmx256m\n    ulimits:\n      memlock:\n        soft: -1\n        hard: -1\n    ports:\n      - \"9200:9200\"\n\n  kibana:\n    image: docker.elastic.co/kibana/kibana:7.4.2\n    ports:\n      - \"5601:5601\"\n    links:\n      - elasticsearch\n</code></pre>\n\n<p><strong>Dockefile:</strong></p>\n\n<pre><code>FROM golang:1.13-alpine as builder\n\nRUN apk add --no-cache --virtual .build-deps \\\n    bash \\\n    gcc \\\n    git \\\n    musl-dev\n\nRUN mkdir build\nCOPY . /build\nWORKDIR /build\n\nRUN go get\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -ldflags '-extldflags \"-static\"' -o webserver .\nRUN adduser -S -D -H -h /build webserver\nUSER webserver\n\nFROM scratch\nCOPY --from=builder /build/webserver /app/\nWORKDIR /app\nEXPOSE 8080\nEXPOSE 9200\nCMD [\"./webserver\"]\n</code></pre>\n\n<p><strong>main.go</strong>:</p>\n\n<pre><code>func webserver(logger *log.Logger) *http.Server {\n    router := http.NewServeMux()\n    router.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n\n        es, err := elasticsearch.NewDefaultClient()\n        if err != nil {\n            log.Fatalf(\"Error creating the client: %s\", err)\n        }\n\n        res, err := es.Info()\n        if err != nil {\n            log.Fatalf(\"Error getting response: %s\", err)\n        }\n\n        log.Println(res)\n    })\n\n    return &amp;http.Server{\n        Addr:         listenAddr,\n        Handler:      router,\n        ErrorLog:     logger,\n        ReadTimeout:  5 * time.Second,\n        WriteTimeout: 10 * time.Second,\n        IdleTimeout:  15 * time.Second,\n    }\n}\n</code></pre>\n\n<p>When I boot the server, everything is running fine and I can access Kibana and query the data that I have indexed, but as soon as I hit <code>localhost:8080</code> in Postman, the server dies and outputs: </p>\n\n<pre><code>web_1            | 2019/11/26 16:40:40 Error getting response: dial tcp 127.0.0.1:9200: connect: connection refused\ngo-api_web_1 exited with code 1\n</code></pre>\n"}, {"tags": ["go", "encryption"], "comments": [{"owner": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "edited": false, "score": 2, "creation_date": 1574787307, "post_id": 59055673, "comment_id": 104351251, "body": "Do you want the decrypting end to say &quot;I refuse to attempt to decrypt this, because it is too late&quot;? Or do you want the (potentially hostile) decrypting end to be <i>unable to</i> decrypt because it&#39;s too late? I don&#39;t see how the latter is possible, given that it&#39;s always possible to pretend the wallclock time is anything you like."}, {"owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "reply_to_user": {"reputation": 35869, "user_id": 7512, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/d064a7aca29011d3246302b27c41f4d9?s=128&d=identicon&r=PG", "display_name": "slim", "link": "https://stackoverflow.com/users/7512/slim"}, "edited": false, "score": 0, "creation_date": 1574787582, "post_id": 59055673, "comment_id": 104351401, "body": "Indeed i want the latter. I did figure this might be impossible but i thought it was worth question to see if anyone had any clever ideas. in terms of just including a time lock into the code then i would just include a encrypted time into blob im storing so i can check its age on decryption"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1574787671, "post_id": 59055673, "comment_id": 104351453, "body": "You never use &quot;clever ideas&quot; in cryptography. You can rely on proven implementations based on solid research, or you can have broken cryptography."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1574787788, "post_id": 59055673, "comment_id": 104351525, "body": "If you want a service that can provide these constraints, take a look at something like <a href=\"https://www.vaultproject.io/\" rel=\"nofollow noreferrer\">vaultproject.io</a>"}, {"owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "edited": false, "score": 0, "creation_date": 1574788023, "post_id": 59055673, "comment_id": 104351657, "body": "By clever ideas I mean an encryption technique that I am not aware of. Sadly it is very hard to keep abreast of all developments in all areas of programming.   Vault is a fantastic service we use heavily at my day job, I am looking for this to be part of a open source cli tool"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574793613, "post_id": 59055673, "comment_id": 104354304, "body": "The closest you can get is probably something akin to <a href=\"https://en.wikipedia.org/wiki/Time-based_One-time_Password_algorithm\" rel=\"nofollow noreferrer\">TOTP</a>, though it would still be vulnerable to attack by anyone who either knew when it was supposed to be valid or was willing to brute-force time periods until they hit it."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1574795330, "post_id": 59055673, "comment_id": 104355098, "body": "The only way to achieve that is to have some server validating the time by decrypting some key or something, AFAIK."}, {"owner": {"reputation": 248566, "user_id": 3474, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ffbf4e85b8ffbae4e9039b9c0cf07bc8?s=128&d=identicon&r=PG", "display_name": "erickson", "link": "https://stackoverflow.com/users/3474/erickson"}, "edited": false, "score": 0, "creation_date": 1574795899, "post_id": 59055673, "comment_id": 104355323, "body": "Where would the (temporarily) decrypted reside? Against whom are you trying to protect that data? (For example, do you want to decrypt and re-encrypt the data on the user&#39;s device---user being the person providing the original decryption key? And you want to protect that data when device is seized by law enforcment? Or... ?)"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574796627, "post_id": 59055673, "comment_id": 104355626, "body": "The only way I can imagine to achieve this is to encode the decryption key on a medium that will decay over time, such as a radioactive substance. To my knowledge, this technology has never been created, except perhaps in experimental quantum computing contexts."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1574797318, "post_id": 59055673, "comment_id": 104355919, "body": "Is there something preventing you from re-encrypting with your own key, and then you delete that key as soon as it&#39;s &quot;expired&quot;?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1574798735, "post_id": 59055673, "comment_id": 104356591, "body": "Cryptography which relies on the non-existence of closed timelike curves is best avoided. Sorry, I will have been wanted to say: has best been avoided tomorrow."}, {"owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "reply_to_user": {"reputation": 248566, "user_id": 3474, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/ffbf4e85b8ffbae4e9039b9c0cf07bc8?s=128&d=identicon&r=PG", "display_name": "erickson", "link": "https://stackoverflow.com/users/3474/erickson"}, "edited": false, "score": 0, "creation_date": 1574800434, "post_id": 59055673, "comment_id": 104357280, "body": "@erickson, yes i want to store the data back onto the client device. Essentially what i want an encrypted cache so that i don&#39;t have to ask the user for their key every time they run my cmd. I don&#39;t want to use a fixed key as that could easily be extracted from the binary. I think i&#39;ll just accept that risk and mitigate it with some basic obfuscation"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1574802620, "post_id": 59055673, "comment_id": 104358209, "body": "Why all the hassle when the data resides on the user&#39;s device anyway? Simply let him decrypt the data locally into memory. So there we have our data on rest encryption. Once you have access to the data, you can store it away, either way. Period."}, {"owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "edited": false, "score": 0, "creation_date": 1574840110, "post_id": 59055673, "comment_id": 104368829, "body": "User devices can be compromised. Holding the data in memory for an extended period of time (Several hours), unencrypted, is a significant risk."}], "answers": [{"tags": [], "owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "is_accepted": false, "score": 0, "last_activity_date": 1574840662, "creation_date": 1574840662, "answer_id": 59065352, "question_id": 59055673, "link": "https://stackoverflow.com/questions/59055673/how-to-encrypt-data-that-can-be-decrypted-for-fixed-duration/59065352#59065352", "title": "How to encrypt data that can be decrypted for fixed duration", "body": "<p>The answer to this specific question appears to be, no it is not possible to do locally.</p>\n\n<p>The best solution to this kind of problem, ie a temporary cache of data decrypted with a user's key is to either use security tooling present on the users machine, ie macos keychain or to simply re-encrypt the cache with a key known to the program and except that it is possible to reverse engineer that program to find the decryption key.</p>\n\n<p>My plan to deliver this is to generate an encryption key when the program is first run, use that + a known salt to encrypt my cache. The idea being that both the program, the generated key and the cache would need to be compromised together to decrypt my cache.</p>\n"}], "owner": {"reputation": 594, "user_id": 1209233, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5555d8507d5f73e1904e4cd9176f2759?s=128&d=identicon&r=PG", "display_name": "Rick Burgess", "link": "https://stackoverflow.com/users/1209233/rick-burgess"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 73, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574840662, "creation_date": 1574786662, "last_edit_date": 1574795377, "question_id": 59055673, "link": "https://stackoverflow.com/questions/59055673/how-to-encrypt-data-that-can-be-decrypted-for-fixed-duration", "title": "How to encrypt data that can be decrypted for fixed duration", "body": "<p>My use case looks like this:</p>\n\n<ol>\n<li>encrypt some super secret data using a key provided by user</li>\n<li>when requested, ask the user for that key and decrypt the data</li>\n<li>re-encrypt the data with a key that will allow my program to access the data for a user defined period of time</li>\n<li>if token expired ask user for original key again</li>\n</ol>\n\n<p>This feels like it should be a solved problem by my googlefu is weak today.</p>\n\n<p>I could just decrypt the data and store it with a known key in my program but cracking my code would expose those secrets.</p>\n\n<p>I could and maybe should, use some local secure storage for this data like macos keychain etc but i'd like to keep the amount of native variations to a minimum.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 1, "creation_date": 1574823320, "post_id": 59055256, "comment_id": 104363772, "body": "i some-how dont understand the question here, it&#39;s the operation system that decide whether you can access the hardware directly not the language, right? if considering the driver, cgo maybe helpful"}], "answers": [{"tags": [], "owner": {"reputation": 378, "user_id": 2354621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u4uu6.jpg?s=128&g=1", "display_name": "Nilo Paim", "link": "https://stackoverflow.com/users/2354621/nilo-paim"}, "is_accepted": true, "score": 1, "last_activity_date": 1576003502, "creation_date": 1576003502, "answer_id": 59273567, "question_id": 59055256, "link": "https://stackoverflow.com/questions/59055256/which-is-the-correct-way-of-using-siusbxp-from-go/59273567#59273567", "title": "Which is the correct way of using SIUSBXP from Go?", "body": "<p>Specifically about this dll, I made this animal to works:</p>\n\n<pre><code>SiUSBXp                      = syscall.MustLoadDLL(\"SiUSBXp.dll\")\nSIGetNumDevices              = SiUSBXp.MustFindProc(\"SI_GetNumDevices\")\nSIGetProductString           = SiUSBXp.MustFindProc(\"SI_GetProductString\")\n.\n.\n.\n... and so on...\n</code></pre>\n\n<p>That way, the dll is loaded by the first line and the required functions are referenced in the other lines.</p>\n\n<p>To call a function, for example:</p>\n\n<pre><code>func GetNumDevices() int {\nvar lpdwNumDevices int\nr1, _, _ := SIGetNumDevices.Call(uintptr(unsafe.Pointer(&amp;lpdwNumDevices)))\n\nif int(r1) == StatusSISUCCESS {\n    if lpdwNumDevices == 1 {\n        log.Println(lpdwNumDevices,\"hardware(s) found\")\n    }\n    return lpdwNumDevices\n}\n\nreturn -1\n}\n</code></pre>\n\n<p>This kind of code can be used when you need to communicate with some another dll, as far I can see.</p>\n\n<p>Note that I didn't use cgo.</p>\n"}], "owner": {"reputation": 378, "user_id": 2354621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/u4uu6.jpg?s=128&g=1", "display_name": "Nilo Paim", "link": "https://stackoverflow.com/users/2354621/nilo-paim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 59273567, "answer_count": 1, "score": 1, "last_activity_date": 1576003502, "creation_date": 1574785288, "last_edit_date": 1574787352, "question_id": 59055256, "link": "https://stackoverflow.com/questions/59055256/which-is-the-correct-way-of-using-siusbxp-from-go", "title": "Which is the correct way of using SIUSBXP from Go?", "body": "<p>I have a hardware that is accessed via SIUSBXP (Silicon Labs).</p>\n\n<p>Is there a way to access the hardware directly from Go? </p>\n\n<p>Or should I write a C/C++ wrapper and links it to my Go program?</p>\n"}, {"tags": ["go", "rabbitmq", "rpc", "amqp"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1574793697, "post_id": 59054511, "comment_id": 104354336, "body": "That&#39;s not how message queues work. The publisher is expected to fire and forget and assume that sufficient consumers will be made available to keep up with the volume of messages. What you&#39;re describing is not a correct usage of message queues."}, {"owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574845271, "post_id": 59054511, "comment_id": 104371365, "body": "@Adrian I understand your premise. But there is the <code>NotifyReturn()</code> function, which allows to react to the deliverability of a message. I think my use case is a valid one, as far as I understand amqp. The configuration of the publish (immediate / mandatory) also implies more reliability than &quot;fire and forget&quot;."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1574846630, "post_id": 59054511, "comment_id": 104372071, "body": "The idea is that the consumer can answer to the original message. But the producer should be unaware of &quot;who&quot; answers and be content to get an answer. The whole idea of a message queue is to decouple your application parts as much as possible while still providing two way communication."}, {"owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "edited": false, "score": 0, "creation_date": 1574847014, "post_id": 59054511, "comment_id": 104372263, "body": "I do not seek to know &quot;who&quot; answered. I simply want to know if the message was routed or not! I really do not understand why this breaks with the idea if a message broker like rabbitmq."}], "answers": [{"tags": [], "owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "is_accepted": false, "score": 0, "last_activity_date": 1574846773, "creation_date": 1574846773, "answer_id": 59066925, "question_id": 59054511, "link": "https://stackoverflow.com/questions/59054511/rabbitmq-amqp-direct-reply-to-and-return-notification/59066925#59066925", "title": "rabbitmq / amqp direct reply to and return notification", "body": "<p>Ok, after more wandering in the dark I finaly realized my fundamental error: Not carefully reading the documentation:</p>\n\n<blockquote>\n  <p>If the RPC server publishes with the mandatory flag set then amq.rabbitmq.reply-to.* is treated as not a queue; i.e. if the server only publishes to this name then the message will be considered \"not routed\"; a basic.return will be sent if the mandatory flag was set.\n  <a href=\"https://www.rabbitmq.com/direct-reply-to.html\" rel=\"nofollow noreferrer\">RabbitMQ Direct-Reply-To Article</a></p>\n</blockquote>\n\n<p>It is by design, that the reply messages, in my configured case, are considered \"not routed\". </p>\n"}], "owner": {"reputation": 487, "user_id": 3004786, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/mQ3jy.jpg?s=128&g=1", "display_name": "huehnerhose", "link": "https://stackoverflow.com/users/3004786/huehnerhose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 423, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574846773, "creation_date": 1574782972, "last_edit_date": 1574783878, "question_id": 59054511, "link": "https://stackoverflow.com/questions/59054511/rabbitmq-amqp-direct-reply-to-and-return-notification", "title": "rabbitmq / amqp direct reply to and return notification", "body": "<p>I use rabbitmq for delivering messages from various input-sources (websocket, rest, ...) to my workers. Every worker listens to a bunch of different routing-keys on a shared exchange. </p>\n\n<p>Now it is possible that workerA handles \"routeA\". When my input-source sends something to routeA, workerA picks it up and consumes it. </p>\n\n<p>But what happens if there is no routeA-\"consumer\"? In that case I want the input source to \"know\" that there is no one for that request. And since there is no \"rabbit consumer\" consuming this message, it is discarded. (sorry if the lingo isn't accurate) As far as I understand the control message (?) handling, that is where <code>NotifyReturn()</code> (golang library for amqp) kicks in, so that the publisher can know about the fact, it's message was discarded. </p>\n\n<p>Here is a stripped example of my code. This approach works for me in a simple \"just publish this message scenario\". I breaks for RPC. \nRPC always triggers the <code>case returnNotification := &lt;-returnChannel:</code> case. </p>\n\n<p>My question: </p>\n\n<ul>\n<li>Am I holding it wrong? / Is this not the way to check the deliverability of a message?</li>\n</ul>\n\n<p>Thanks!</p>\n\n<p><strong>edit</strong>: Forgot to mention: The error is raised on the \"reply\". So the request is send, but the reply (send via the \"just publish\") gets a NO_ROUTE returnNotification</p>\n\n<h1>Just publish</h1>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    // error handling omitted for example code\n    tC, _ := rabbitConnection.Channel()\n    defer tC.Close()\n\n    tC.Confirm(false)\n\n    var ack = make(chan uint64)\n    var nack = make(chan uint64)\n    tC.NotifyConfirm(ack, nack)\n\n    returnChannel := make(chan amqp.Return)\n    tC.NotifyReturn(returnChannel)\n\n    p := someFunctionGeneratingAPublishing()\n\n    tC.Publish(\n        exchange,\n        e.GetRoutingKey(),\n        true,\n        false,\n        *p,\n    )\n\n    select {\n    case returnNotification := &lt;-returnChannel:\n        if returnNotification.ReplyCode == amqp.NoRoute {\n            return fmt.Errorf(\"no amqp route for %s\", e.GetRoutingKey())\n        }\n\n    case &lt;-ack:\n        return nil\n\n    case &lt;-nack:\n        return fmt.Errorf(\"basic nack for %s\", e.GetRoutingKey())\n    }\n</code></pre>\n\n<h1>RPC</h1>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    publishing := someFunctionGeneratingAPublishing()\n    publishing.ReplyTo = \"amq.rabbitmq.reply-to\"\n\n    con := GetConnection()\n    directChannel, _ := con.Channel()\n    defer directChannel.Close()\n\n    directChannel.Confirm(false)\n\n    var ack = make(chan uint64)\n    var nack = make(chan uint64)\n    directChannel.NotifyConfirm(ack, nack)\n\n    returnChannel := make(chan amqp.Return)\n    directChannel.NotifyReturn(returnChannel)\n\n    // consume direct-reply to pattern queue\n    deliveryChan, _ := directChannel.Consume(\n        \"amq.rabbitmq.reply-to\",\n        \"\",\n        true,\n        false,\n        false,\n        false,\n        nil,\n    )\n\n\n    directChannel.Publish(\n        exchange,\n        e.GetRoutingKey(),\n        true,\n        false,\n        *publishing,\n    )\n\n    select {\n    case returnNotification := &lt;-returnChannel:\n        if returnNotification.ReplyCode == amqp.NoRoute {\n            return fmt.Errorf(\"no amqp route for %s\", e.GetRoutingKey())\n        }\n\n    case &lt;-ack:\n        return nil\n\n    case &lt;-nack:\n        return fmt.Errorf(\"basic nack for %s\", e.GetRoutingKey())\n    }\n\n</code></pre>\n"}, {"tags": ["go", "file-upload", "upload", "google-cloud-storage", "object-storage"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574779435, "post_id": 59053277, "comment_id": 104346585, "body": "Are you asking how to prevent net/http.Request.FormFile from calling net/http.Request.ParseMultipartForm without reading everything upfront?"}, {"owner": {"reputation": 1623, "user_id": 3080315, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dca9f77ce600fbae2b1cd16df56dba3e?s=128&d=identicon&r=PG&f=1", "display_name": "jz22", "link": "https://stackoverflow.com/users/3080315/jz22"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574779952, "post_id": 59053277, "comment_id": 104346891, "body": "Exactly, I would like to prevent reading the entire body before writing the data in the bucket. I want it to write each chunk directly in the bucket as it reaches the server."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1574780002, "post_id": 59053277, "comment_id": 104346921, "body": "Create a <a href=\"https://godoc.org/mime/multipart#Reader\" rel=\"nofollow noreferrer\">multipart.Reader</a> on the request body. Iterate through the parts with <a href=\"https://godoc.org/mime/multipart#Reader.NextPart\" rel=\"nofollow noreferrer\">Reader.NextPart</a>.  io.Copy the part to the bucket."}], "answers": [{"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1574780430, "post_id": 59053603, "comment_id": 104347196, "body": "@jz22, a nitpick: you should tighten error handling in your function (unless you left it out for brevity)."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1574781103, "post_id": 59053603, "comment_id": 104347611, "body": "@kostix, I think you meant to comment the other answer or the question."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1574782104, "post_id": 59053603, "comment_id": 104348257, "body": "Peter, no, my nitpick was about the OP&#39;s question, not your answer ;-) Actually I like your answer best and upvoted it, FWIW."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 4, "last_activity_date": 1574780026, "creation_date": 1574780026, "answer_id": 59053603, "question_id": 59053277, "link": "https://stackoverflow.com/questions/59053277/uploading-file-to-google-storage-without-saving-it-to-memory/59053603#59053603", "title": "Uploading file to Google Storage without saving it to memory", "body": "<blockquote>\n  <p>FormFile returns the first file for the provided form key. FormFile calls ParseMultipartForm and ParseForm if necessary.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Request.FormFile\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request.FormFile</a></p>\n\n<blockquote>\n  <p>ParseMultipartForm parses a request body as multipart/form-data. The whole request body is parsed and up to a total of maxMemory bytes of its file parts are stored in memory, with the remainder stored on disk in temporary files.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/net/http/#Request.ParseMultipartForm\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Request.ParseMultipartForm</a></p>\n\n<p>At the time of writing this, <a href=\"https://github.com/golang/go/blob/release-branch.go1.13/src/net/http/request.go#L33\" rel=\"nofollow noreferrer\">FormFile passes 32 MB as the maxMemory argument</a>.</p>\n\n<p>So you with this code you will need up to 32 MB of memory per request, plus <a href=\"https://godoc.org/google.golang.org/api/googleapi#pkg-constants\" rel=\"nofollow noreferrer\">googleapi.DefaultUploadChunkSize, which is currently 8 MB</a>, as well as some amount of disk space for everything that doesn't fit in memory.</p>\n\n<p>So uploading will not start until the whole file has been read, but not all of it is kept in memory. If that's not what you want, use <a href=\"https://godoc.org/net/http#Request.MultipartReader\" rel=\"nofollow noreferrer\">Request.MultipartReader</a> instead of ParseMultipartForm:</p>\n\n<blockquote>\n  <p>MultipartReader returns a MIME multipart reader if this is a multipart/form-data or a multipart/mixed POST request, else returns nil and an error. Use this function instead of ParseMultipartForm to process the request body as a stream.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1814, "user_id": 12258482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812d353caef22c1ee1ae0e5ceee57508?s=128&d=identicon&r=PG", "display_name": "I Love Reflection", "link": "https://stackoverflow.com/users/12258482/i-love-reflection"}, "is_accepted": true, "score": 5, "last_activity_date": 1574781408, "last_edit_date": 1574781408, "creation_date": 1574781017, "answer_id": 59053893, "question_id": 59053277, "link": "https://stackoverflow.com/questions/59053277/uploading-file-to-google-storage-without-saving-it-to-memory/59053893#59053893", "title": "Uploading file to Google Storage without saving it to memory", "body": "<p>As noted in a comment on question and the answer by Peter, use the <a href=\"https://godoc.org/net/http#Request.MultipartReader\" rel=\"nofollow noreferrer\">multipart reader directly</a> to read the request body. </p>\n\n<pre><code>func Upload(c *gin.Context) {\n    mr, err :=  c.Request.MultipartReader()\n    if err != nil {\n        // handle error\n        return\n    }\n    var foundImage bool\n    for {\n        p, err := mr.NextPart()\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            // handle error\n            return\n        }\n        if p.FormName() == \"image\" {\n            foundImage = true\n\n            ctx := context.Background()\n            client, err := storage.NewClient(ctx)\n            if err != nil {\n                // handle error\n                return\n            }\n            bucket := client.Bucket(\"test-bucket\")\n            w := bucket.Object(\"testfile\").NewWriter(ctx)\n            w.ContentType = \"image/jpeg\"\n            if _, err := io.Copy(w, p); err != nil {\n              // handle error\n              return\n            }\n            if err := w.Close(); err != nil {\n              // handle error\n              return\n            }\n        }\n    }\n    if !imageFound {\n       // handle error\n    }\n}\n</code></pre>\n\n<p>Replace the <code>// handle error</code> comments with code that responds to the client with an appropriate error status. It may be useful to log some of the errors as well.</p>\n"}], "owner": {"reputation": 1623, "user_id": 3080315, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/dca9f77ce600fbae2b1cd16df56dba3e?s=128&d=identicon&r=PG&f=1", "display_name": "jz22", "link": "https://stackoverflow.com/users/3080315/jz22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1424, "favorite_count": 2, "accepted_answer_id": 59053893, "answer_count": 2, "score": 4, "last_activity_date": 1574781408, "creation_date": 1574778893, "last_edit_date": 1574779945, "question_id": 59053277, "link": "https://stackoverflow.com/questions/59053277/uploading-file-to-google-storage-without-saving-it-to-memory", "title": "Uploading file to Google Storage without saving it to memory", "body": "<p>I want to upload files from the frontend directly through the backend into a Google Storage bucket, without saving it entirely in memory on the server first. I've added an endpoint similar to the <a href=\"https://cloud.google.com/go/getting-started/using-cloud-storage\" rel=\"nofollow noreferrer\">example</a> from the Google docs and it works. However, I'm not sure if this will save the entire file to memory first, since this could lead to issues when uploading larger files.</p>\n\n<p>If it saves the file to memory first, how could I change the code so that it streams the upload directly to Google Storage. The answers to similar questions didn't clarify my question.</p>\n\n<p>Thank you</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Upload(c *gin.Context) {\n    file, _, _ := c.Request.FormFile(\"image\")\n    ctx := context.Background()\n\n    client, err := storage.NewClient(ctx)\n    if err != nil {\n        fmt.Printf(\"Failed to create client with error: %v\", err)\n        return\n    }\n\n    bucket := client.Bucket(\"test-bucket\")\n\n    w := bucket.Object(\"testfile\").NewWriter(ctx)\n\n    w.ContentType = \"image/jpeg\"\n\n    io.Copy(w, file)\n    w.Close()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1574769916, "post_id": 59050460, "comment_id": 104341237, "body": "Calling a method on a nil value doesn&#39;t cause the program to hang. pprof is the answer (specifically the goroutine profile). Why doesn&#39;t it work for you?"}, {"owner": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1574770616, "post_id": 59050460, "comment_id": 104341610, "body": "@Peter I think you can try the code,you will know if it&#39;s stuck"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574771352, "post_id": 59050460, "comment_id": 104341987, "body": "@skl why are you trying to print <code>srcDbresult.Next()</code> in the error handling block?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574771612, "post_id": 59050460, "comment_id": 104342131, "body": "@skl what do you mean by &quot;number of the wrong code&quot;? Also what do you mean by &quot;hang&quot; or &quot;stuck&quot;? Did your program stop responding? Or did it actually crash with a proper panic stack trace?"}, {"owner": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574771669, "post_id": 59050460, "comment_id": 104342161, "body": "@mkopriva The example is only a easy code.The real thing is that the online program was stuck and I do not konw how to troubleshoot problems.That code is also my new takeover, and the program is stuck by chance. The whole process is so huge that I can&#39;t guess which line the error is in. What do you do in this case?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1574771803, "post_id": 59050460, "comment_id": 104342231, "body": "@skl it&#39;s still not clear to me what <i>you</i> mean by &quot;stuck&quot;. Did the program crash? Or, is it still alive but not responding?"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "edited": false, "score": 0, "creation_date": 1574769792, "post_id": 59050513, "comment_id": 104341172, "body": "The example is only a easy code.The real thing is that the online program was stuck and I do not konw where the wrong code is."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "edited": false, "score": 2, "creation_date": 1574769927, "post_id": 59050513, "comment_id": 104341243, "body": "@skl So then you&#39;re aksing debugging help about a code we don&#39;t see? That&#39;s off-topic for StackOverflow. Just handle all errors, and you should have a trace of what whent wrong. But you need to handle all errors somehow."}, {"owner": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "edited": false, "score": 0, "creation_date": 1574770504, "post_id": 59050513, "comment_id": 104341559, "body": "That code is also my new takeover, and the program is stuck by chance. The whole process is so huge that I can&#39;t guess which line the error is in. What do you do in this case?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1574769662, "creation_date": 1574769662, "answer_id": 59050513, "question_id": 59050460, "link": "https://stackoverflow.com/questions/59050460/how-to-know-the-number-of-the-wrong-code-in-a-stuck-program/59050513#59050513", "title": "how to know the number of the wrong code in a stuck program", "body": "<p>If <code>err</code> is not <code>nil</code>, don't touch <code>srcDbresult</code>, it's not valid / usable.</p>\n\n<p>Use it like this:</p>\n\n<pre><code>var srcDbresult *sql.Rows\nsrcDbresult, err = db.Query(sql)\nif err != nil {\n    err = errors.Wrap(err, \"db.Query error\")\n    panic(err) // Return or handle the error somehow, but do not continue\n}\n\ndefer srcDbresult.Close()\n\n// You can use srcDbresult here:\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 6158928, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yIPS7.jpg?s=128&g=1", "display_name": "sk l", "link": "https://stackoverflow.com/users/6158928/sk-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "closed_date": 1574834360, "answer_count": 1, "score": -6, "last_activity_date": 1574780015, "creation_date": 1574769482, "last_edit_date": 1574780015, "question_id": 59050460, "link": "https://stackoverflow.com/questions/59050460/how-to-know-the-number-of-the-wrong-code-in-a-stuck-program", "closed_reason": "Needs details or clarity", "title": "how to know the number of the wrong code in a stuck program", "body": "<p>My test code is like that:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var srcDbresult *sql.Rows\n\nsrcDbresult, err = db.Query(sql)\n\nif err != nil {\n    err = errors.Wrap(err, \"db.Query error\")\n    print(srcDbresult.Next())\n    panic(err)\n}\n</code></pre>\n\n<p>If the err is not nil, the program will hang in the print(srcDbresult.Next()),because the nil pointer execute the method.\nSo I want know if the program was stuck like the example code, how to know the line number of the wrong code. I've tried the pprof, but it cannot work.</p>\n"}, {"tags": ["go", "dependency-injection", "refactoring"], "comments": [{"owner": {"reputation": 189551, "user_id": 5233410, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XAODw.png?s=128&g=1", "display_name": "Nkosi", "link": "https://stackoverflow.com/users/5233410/nkosi"}, "edited": false, "score": 1, "creation_date": 1574768701, "post_id": 59050074, "comment_id": 104340583, "body": "This looks more like a design issue. Having that many dependencies is a code smell and indicates that the function may be doing too much. Some of those dependencies may need to be aggregated into a service."}, {"owner": {"reputation": 485, "user_id": 6769220, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ce9ed8a17974f3e3d27d252c3f751f76?s=128&d=identicon&r=PG&f=1", "display_name": "Faram", "link": "https://stackoverflow.com/users/6769220/faram"}, "reply_to_user": {"reputation": 189551, "user_id": 5233410, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XAODw.png?s=128&g=1", "display_name": "Nkosi", "link": "https://stackoverflow.com/users/5233410/nkosi"}, "edited": false, "score": 0, "creation_date": 1574769276, "post_id": 59050074, "comment_id": 104340869, "body": "I exaggerated on purpose. I would never code something like that. But having functions with two or three dependency injection arguments are quite common I would say. Especially if you don&#39;t got enough time for refactoring code because of deadlines or something like that."}, {"owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "edited": false, "score": 0, "creation_date": 1574772352, "post_id": 59050074, "comment_id": 104342589, "body": "You might want to look at <a href=\"https://github.com/jwells131313/dargo\" rel=\"nofollow noreferrer\">github.com/jwells131313/dargo</a> which is a dependency injection framework for golang"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574780502, "post_id": 59050074, "comment_id": 104347247, "body": "Or <a href=\"https://github.com/google/wire\" rel=\"nofollow noreferrer\">github.com/google/wire</a> which is first-party, though not part of the stdlib."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1574811727, "post_id": 59050074, "comment_id": 104361276, "body": "What is the difference between <code>.DoA()</code> and <code>.DoB()</code>? They both could be just <code>.Do()</code>. Now it is possible to define an interface like <code>type Doer interface { Do() }</code> and the signature can change to <code>DoSomething(...Doer)</code>."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1574768768, "post_id": 59050197, "comment_id": 104340623, "body": "This doesn&#39;t reduces the dependencies, it just groups them into a struct. Having to provide a struct value, you also need to initialize it with the same dependencies."}, {"owner": {"reputation": 485, "user_id": 6769220, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ce9ed8a17974f3e3d27d252c3f751f76?s=128&d=identicon&r=PG&f=1", "display_name": "Faram", "link": "https://stackoverflow.com/users/6769220/faram"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1574769047, "post_id": 59050197, "comment_id": 104340763, "body": "Yes, but in that way I would avoid having to many parameters in functions, which would make the code more readable I guess. Also imagine if one would need to call this function on multiple occasions: With the wrapper you only would need to inject dependencies once."}], "tags": [], "owner": {"reputation": 485, "user_id": 6769220, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ce9ed8a17974f3e3d27d252c3f751f76?s=128&d=identicon&r=PG&f=1", "display_name": "Faram", "link": "https://stackoverflow.com/users/6769220/faram"}, "is_accepted": true, "score": 2, "last_activity_date": 1574768574, "creation_date": 1574768574, "answer_id": 59050197, "question_id": 59050074, "link": "https://stackoverflow.com/questions/59050074/handling-dependency-injections/59050197#59050197", "title": "Handling dependency injections", "body": "<p>One way to handle many injections would be to use a struct as wrapper: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type SomethingDoer struct {\n  a handlerA.A,\n  b handlerB.B,\n  c handlerC.C,\n  d handlerD.D,\n  ...\n  z handlerZ.Z,\n}\n\nfunc (sd SomethingDoer) DoSomething() {\n   sd.a.DoA()\n   sd.b.DoB()\n   sd.c.DoC()\n   sd.d.DoD()\n   ....\n   sd.z.DoZ()\n}\n</code></pre>\n\n<p>I just figured that out by reading the question by myself again...</p>\n"}], "owner": {"reputation": 485, "user_id": 6769220, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/ce9ed8a17974f3e3d27d252c3f751f76?s=128&d=identicon&r=PG&f=1", "display_name": "Faram", "link": "https://stackoverflow.com/users/6769220/faram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 59050197, "answer_count": 1, "score": 0, "last_activity_date": 1574768574, "creation_date": 1574768165, "question_id": 59050074, "link": "https://stackoverflow.com/questions/59050074/handling-dependency-injections", "title": "Handling dependency injections", "body": "<p>let's say I have following code: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n   handlerA \"some/path/handlerA\"\n   handlerB \"some/path/handlerB\"\n   handlerC \"some/path/handlerC\"\n   handlerD \"some/path/handlerD\"\n   ....\n   handlerZ \"some/path/handlerZ\"\n)\n\nfunc DoSomething(a handlerA.A, b handlerB.B, c handlerC.C, d handlerD.D..., z handlerZ.Z) {\n   a.DoA()\n   b.DoB()\n   c.DoC()\n   d.DoD()\n   ....\n   z.DoZ()\n}\n</code></pre>\n\n<p>I obviously made the function <code>DoSomething(...)</code> mockable, as this makes my function unit testable. But because of that I get way to many arguments because of all the dependencies my function needs to get injected.</p>\n\n<p>Is there a better way in Golang to handle many dependencies? </p>\n"}, {"tags": ["arrays", "go", "slice"], "comments": [{"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 1, "creation_date": 1574765412, "post_id": 59049074, "comment_id": 104338919, "body": "use this one for delete element from slice      append(slice[:s], slice[s+1:]...)"}, {"owner": {"reputation": 95, "user_id": 5235551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3b0ee835d5e0ee10eaf0d3f9bfe858?s=128&d=identicon&r=PG&f=1", "display_name": "Toni.W", "link": "https://stackoverflow.com/users/5235551/toni-w"}, "reply_to_user": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1574765957, "post_id": 59049074, "comment_id": 104339235, "body": "@Aibaend the way you post  only be work when delete one element."}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1574766057, "post_id": 59049074, "comment_id": 104339295, "body": "use the loop for delete many elements"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574766250, "post_id": 59049074, "comment_id": 104339402, "body": "Ranging over a slice which is modified inside the loop is complicated and best avoided."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1574789388, "last_edit_date": 1574789388, "creation_date": 1574766264, "answer_id": 59049528, "question_id": 59049074, "link": "https://stackoverflow.com/questions/59049074/delete-an-element-from-a-slice-does-not-work/59049528#59049528", "title": "Delete an element from a slice does not work", "body": "<p>The <em>root</em> cause for the behavior is that inside <code>deleteSlice()</code>, you don't allocate a new backing array, you're reusing the backing array of the slice passed to it because you build the result in <code>strings[:0]</code>.</p>\n\n<p>Slices have a backing array. In your code, there is a single allocation for such a backing array, in your composite literal when you initialize <code>a</code> which contains the elements:</p>\n\n<pre><code>array = [\"a\", \"b\", \"c\"]\n</code></pre>\n\n<p>So first <code>deleteSlice()</code> is called with <code>\"a\"</code>, which is in it, so it is not re-added. After the first iteration, backing array looks like this:</p>\n\n<pre><code>array = [\"b\", \"c\", \"c\"]\n        [        ]               &lt;- returned out slice covers this\n</code></pre>\n\n<p>The backing array still contains 3 elements, but the slice only covers the first 2.</p>\n\n<p>The loop in main proceeds to the next iteration (index = 1), and the slice the loop iterates over covers the whole backing array (the slice used in <code>for rage</code> is only evaluated once!), so the element at index 1 in the backing array is now \"c\". This is passed to <code>deleteSlice()</code>. <code>deleteSlice()</code> removes the <code>\"c\"</code> element, backing array will not change (no elements to append after <code>\"c\"</code>):</p>\n\n<pre><code>array = [\"b\", \"c\", \"c\"]\n        [   ]                    &lt;- returned out slice covers this\n</code></pre>\n\n<p>and the returned slice has length 1 (the first element of the backing array.</p>\n\n<p>The loop in main proceeds to the last iteration: index = 2. Backing array has element \"c\" at index 2, which is passed to <code>deleteSlice()</code>. This element is not containd in the slice (which covers a single <code>[\"b\"]</code> element), so that is returned.</p>\n\n<p><strong>See related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/33495995/remove-slice-element-within-a-for/33496275#33496275\">Remove slice element within a for</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/28699485/remove-elements-in-slice/28699587#28699587\">Remove elements in slice</a></p>\n\n<p><strong>Suggested readings:</strong></p>\n\n<p><a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">The Go Blog: Arrays, slices (and strings): The mechanics of 'append'</a></p>\n\n<p><a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">The Go Blog: Go Slices: usage and internals</a></p>\n\n<p><a href=\"https://github.com/golang/go/wiki/SliceTricks\" rel=\"nofollow noreferrer\">Go Wiki: Slice tricks</a></p>\n"}], "owner": {"reputation": 95, "user_id": 5235551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb3b0ee835d5e0ee10eaf0d3f9bfe858?s=128&d=identicon&r=PG&f=1", "display_name": "Toni.W", "link": "https://stackoverflow.com/users/5235551/toni-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 59049528, "answer_count": 1, "score": 0, "last_activity_date": 1574789388, "creation_date": 1574764893, "last_edit_date": 1574767820, "question_id": 59049074, "link": "https://stackoverflow.com/questions/59049074/delete-an-element-from-a-slice-does-not-work", "title": "Delete an element from a slice does not work", "body": "<p>I want to delete some elements from a slice, but it does not work.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := []string{\"a\", \"b\", \"c\"}\n    for _, command := range a {\n        if command == \"a\" || command == \"b\" || command == \"c\" {\n            a = deleteSlice(a, command)\n        }\n    }\n    fmt.Println(a)\n}\nfunc deleteSlice(strings []string, str string) []string {\n    out := strings[:0]\n    for _, s := range strings {\n        if s != str {\n            out = append(out, s)\n        }\n    }\n    return out\n}\n\n</code></pre>\n\n<p>The expected result is <code>[]</code>,but it is <code>[b]</code>,actually.some people tell me the reason?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1574765104, "post_id": 59049109, "comment_id": 104338738, "body": "in Go language default value of integer is 0, but in postgres integer can be null."}], "tags": [], "owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "is_accepted": false, "score": 0, "last_activity_date": 1574765007, "creation_date": 1574765007, "answer_id": 59049109, "question_id": 59048682, "link": "https://stackoverflow.com/questions/59048682/use-gorm-condition-to-judge-timestamp/59049109#59049109", "title": "Use gorm condition to judge timestamp", "body": "<p>You should  use postgres query. Like this</p>\n\n<pre><code>db.Unscoped().Where(\"deleted_on isnull \").Delete(&amp;Tag{})\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 11519194, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-76UyaWXr7Iw/AAAAAAAAAAI/AAAAAAAAAA8/N5vXSh8csig/photo.jpg?sz=128", "display_name": "chezi chezi", "link": "https://stackoverflow.com/users/11519194/chezi-chezi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574765007, "creation_date": 1574763730, "last_edit_date": 1574764008, "question_id": 59048682, "link": "https://stackoverflow.com/questions/59048682/use-gorm-condition-to-judge-timestamp", "title": "Use gorm condition to judge timestamp", "body": "<p>Ask for advice:</p>\n\n<pre><code>db.Unscoped().Where(\"deleted_on != ? \", 0).Delete(&amp;Tag{})\n</code></pre>\n\n<p>deleted_on is of type int</p>\n\n<p>If deleted_on is a timestamp and the value is null, how should it be expressed?</p>\n"}, {"tags": ["go", "workspace", "gopath", "gota"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574764803, "post_id": 59047666, "comment_id": 104338576, "body": "1. Never, literally <b>never</b> set GOROOT. Never ever."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574764977, "post_id": 59047666, "comment_id": 104338673, "body": "2. The actual project is hosted at <a href=\"https://github.com/go-gota/gota\" rel=\"nofollow noreferrer\">github.com/go-gota/gota</a> so the import path is github.com/go-gota/gota."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574765388, "post_id": 59047666, "comment_id": 104338903, "body": "4. There are two modes in which Go works GOPATH mode (setting GO111Module=off) and modules mode (setting GO111MODULE=on). Choose on! GOPATH mode might be easier to start: In this mode source code is downloaded to src. The pkg folder is of zero interest to you; it is managed by the go tool."}], "answers": [{"tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": true, "score": 1, "last_activity_date": 1574764857, "creation_date": 1574764857, "answer_id": 59049066, "question_id": 59047666, "link": "https://stackoverflow.com/questions/59047666/installing-gota-package-in-go-workspace/59049066#59049066", "title": "Installing gota package in go workspace", "body": "<p>The authors of the repository must have migrated to a different repository.</p>\n\n<p>The official repository of these packages is: <a href=\"https://github.com/go-gota/gota\" rel=\"nofollow noreferrer\">github.com/go-gota/gota</a></p>\n\n<pre><code>https://www.github.com/kniren/gota/dataframe\nhttps://www.github.com/kniren/gota/series\n</code></pre>\n\n<p>These repositories do not exist, this is why your <code>go get</code> commands failed. In fact, trying to navigate to <a href=\"https://www.github.com/kniren/gota\" rel=\"nofollow noreferrer\">github.com/kniren/gota</a> redirects me to their official repository.</p>\n"}], "owner": {"reputation": 195, "user_id": 9077586, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210175242088068/picture?type=large", "display_name": "Alesi Rowland", "link": "https://stackoverflow.com/users/9077586/alesi-rowland"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 258, "favorite_count": 0, "accepted_answer_id": 59049066, "answer_count": 1, "score": -1, "last_activity_date": 1574764857, "creation_date": 1574760515, "question_id": 59047666, "link": "https://stackoverflow.com/questions/59047666/installing-gota-package-in-go-workspace", "title": "Installing gota package in go workspace", "body": "<p>I'm writing this away from my code so fingers crossed.</p>\n\n<p>I've recently started learning Go from a Python background. I've set up my workspace (Linux Mint OS) so:</p>\n\n<p>GOPATH=$HOME/go\nGOROOT=/usr/local/go</p>\n\n<p>Where under $HOME i have a dir called go and 3 subdirs called src, bin and pkg. </p>\n\n<p>I wanted to mess around with some dataframes (I use pandas a lot in Python) so I tried to install gota from github. Only their recommended install command:</p>\n\n<pre><code>go get -u github.com/kniren/gota/dataframe\ngo get -u github.com/kniren/gota/series\n</code></pre>\n\n<p>returns an error saying it could find the package in GOPATH or GOROOT. To me this is strange as go get seems like the equivalent to pip install and shouldn't be looking in my path but rather at the URL. I managed to get some files to install but using goget and the github URL of the project:</p>\n\n<pre><code>go get github.com/go-gota/gota/dataframe\ngo get github.com/go-gota/gota/series\n</code></pre>\n\n<p>and this built some files under a gonum.org directory in my src dir and a linux_amd64 dir in my pkg directory. So far neither section have the expected path to the libraries and I can't find a suitable method to import. import statements look in gopath's src directory however I assume it should be looking in the pkg directory? Why is this and what's wrong with my env?</p>\n"}, {"tags": ["mysql", "rest", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574763539, "post_id": 59047641, "comment_id": 104337846, "body": "<i>&quot;without storing as variables and then passing it to query&quot;</i> Why? How else would you tell the database which rows should be returned? How else would you filter the table records if not by using a <code>WHERE</code>, or <code>HAVING</code>, clause with search conditions?"}, {"owner": {"reputation": 70, "user_id": 9428861, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Saiprasanna Sastry", "link": "https://stackoverflow.com/users/9428861/saiprasanna-sastry"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574764116, "post_id": 59047641, "comment_id": 104338181, "body": "@mkopriva what i mean is abouve the query we are looping thtough URL.Query and getting albumId and Id, this are got in 2 iterations, i want to get it in a single iteration, so that i can pass them using WHERE clause. Right now i have two variables album id and id , passing the values got from the loop assiging it these variable and then pass to query, i dont want to do that"}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 0, "last_activity_date": 1574766207, "creation_date": 1574766207, "answer_id": 59049506, "question_id": 59047641, "link": "https://stackoverflow.com/questions/59047641/how-to-parse-multiple-query-params-and-pass-them-to-a-sql-command/59049506#59049506", "title": "how to parse multiple query params and pass them to a sql command", "body": "<p>First you need a set of valid table columns that can be used in the query, this is required to avoid unnecessary errors from columns with typos and sql injections from malicious input.</p>\n\n<pre><code>var photocolumns = map[string]struct{}{\n    \"id\":      {},\n    \"albumId\": {},\n    // all the other columns you accept as input\n}\n</code></pre>\n\n<p>Now depending on the database you may, or you may not, need to parse the query values and convert them to the correct type for the corresponding column. You can utilize the column map to associate each column with the correct converter type/func.</p>\n\n<pre><code>// a wrapper around strconv.Atoi that has the signature of the map-value type below\nfunc atoi(s string) (interface{}, error) {\n    return strconv.Atoi(s)\n}\n\nvar photocolumns = map[string]func(string) (interface{}, error) {\n    \"id\":      atoi,\n    \"albumId\": atoi,\n    // all the other columns you accept as input\n}\n</code></pre>\n\n<p>Then, all you need is a single loop and in it you do all the work you need. You get the correct column name, convert the value to the correct type, aggregate that converted value into a slice so that it can be passed to the db, and also construct the WHERE clause so that it can be concatenated to the sql query string.</p>\n\n<pre><code>where := \"\"\nparams := []interface{}{}\nfor k, v := range r.URL.Query() {\n    if convert, ok := photocolumns[k]; ok {\n        param, err := convert(v[0])\n        if err != nil {\n            fmt.Println(err)\n            return\n        }\n\n        params = append(params, param)\n        where += k + \" = ? AND \" \n    }\n}\nif len(where) &gt; 0 {\n    // prefix the string with WHERE and remove the last \" AND \"\n    where = \" WHERE \" + where[:len(where)-len(\" AND \")]\n}\n\nrows, err := db.Query(\"SELECT id, albumId, Title,thumbnailUrl,url from photo\" + where, params...)\n// ...\n</code></pre>\n"}], "owner": {"reputation": 70, "user_id": 9428861, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Saiprasanna Sastry", "link": "https://stackoverflow.com/users/9428861/saiprasanna-sastry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 59049506, "answer_count": 1, "score": 0, "last_activity_date": 1574766207, "creation_date": 1574760442, "question_id": 59047641, "link": "https://stackoverflow.com/questions/59047641/how-to-parse-multiple-query-params-and-pass-them-to-a-sql-command", "title": "how to parse multiple query params and pass them to a sql command", "body": "<p>i am playing around rest API's in go and when i do a get call with this </p>\n\n<blockquote>\n  <p><a href=\"http://localhost:8000/photos?albumId=1&amp;id=1\" rel=\"nofollow noreferrer\">http://localhost:8000/photos?albumId=1&amp;id=1</a></p>\n</blockquote>\n\n<p>i want to return only those values from db which corresponds to alubmId=1 and id =1 , or any other key in the query for that matter without storing as variables and then passing it to query, and when i dont give any query params i want it to return all the posts in db</p>\n\n<pre><code>  func getPhotos(w http.ResponseWriter, r *http.Request) {\n            w.Header().Set(\"Content-Type\", \"application/json\")\n            var photos []Photo\n\n            db, err = sql.Open(\"mysql\", \"root:$pwd@tcp(127.0.0.1:3306)/typicode\")\n            if err != nil {\n                    panic(err.Error())\n            }\n\n            defer db.Close()\n\n            for k, v := range r.URL.Query() {\n                    fmt.Printf(\"%s: %s\\n\", k, v)\n            }\n\n            result, err := db.Query(\"SELECT id, albumId, Title,thumbnailUrl,url from photo\")\n            if err != nil {\n                    panic(err.Error())\n            }\n\n            defer result.Close()\n\n            for result.Next() {\n                    var photo Photo\n                    err := result.Scan(&amp;photo.Id, &amp;photo.AlbumId, &amp;photo.Title, &amp;photo.Url, &amp;photo.Thumbnailurl)\n                    if err != nil {\n                            panic(err.Error())\n                    }\n                    photos = append(photos, photo)\n            }\n            json.NewEncoder(w).Encode(photos)\n    }\n</code></pre>\n"}, {"tags": ["xml", "go", "xml-encoding"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1574764735, "last_edit_date": 1574764735, "creation_date": 1574761836, "answer_id": 59048070, "question_id": 59047594, "link": "https://stackoverflow.com/questions/59047594/xml-encoder-in-golang-does-not-close-tags-in-all-streams/59048070#59048070", "title": "XML Encoder in Golang does not close tags in all streams", "body": "<p>You cannot have multiple readers on the returned <a href=\"https://golang.org/pkg/io/#PipeReader\" rel=\"nofollow noreferrer\"><code>io.PipeReader</code></a>, data will not be duplicated for all readers. The <code>io.PipeReader</code> can only \"serve\" a single reader, and you launch 2 goroutines to read from it.</p>\n\n<p>To achieve what you want, use <a href=\"https://golang.org/pkg/io/#MultiWriter\" rel=\"nofollow noreferrer\"><code>io.MultiWriter()</code></a>. It returns you a single <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\"><code>io.Writer</code></a> to where you can write, and it will replicate the writes to all the writers you pass to it.</p>\n\n<p>For example:</p>\n\n<pre><code>f1 := &amp;bytes.Buffer{}\nf2 := &amp;bytes.Buffer{}\n\nw := io.MultiWriter(f1, f2)\n\nencoder := xml.NewEncoder(w)\n\nencoder.EncodeToken(xml.StartElement{Name: xml.Name{Local: \"test\"}})\nencoder.Encode(image.Point{1, 2})\nencoder.EncodeToken(xml.EndElement{Name: xml.Name{Local: \"test\"}})\nencoder.Flush()\n\nfmt.Println(f1)\nfmt.Println(f2)\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/qhyQsPxu9by\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>&lt;test&gt;&lt;Point&gt;&lt;X&gt;1&lt;/X&gt;&lt;Y&gt;2&lt;/Y&gt;&lt;/Point&gt;&lt;/test&gt;\n&lt;test&gt;&lt;Point&gt;&lt;X&gt;1&lt;/X&gt;&lt;Y&gt;2&lt;/Y&gt;&lt;/Point&gt;&lt;/test&gt;\n</code></pre>\n\n<p>The above example writes to 2 in-memory buffers. To write to 2 files, you may pass 2 <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code>s</a> to <code>io.MultiWriter()</code> (or anything else that implements <code>io.Writer</code>):</p>\n\n<pre><code>f1, err := os.Create(\"file1.xml\")\nif err != nil {\n    panic(err)\n}\ndefer f1.Close()\n\nf2, err := os.Create(\"file2.xml\")\nif err != nil {\n    panic(err)\n}\ndefer f2.Close()\n\nw := io.MultiWriter(f1, f2)\n\n// ...\n</code></pre>\n"}], "owner": {"reputation": 4405, "user_id": 954930, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/1pEmC.png?s=128&g=1", "display_name": "Gregor Menih", "link": "https://stackoverflow.com/users/954930/gregor-menih"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 59048070, "answer_count": 1, "score": 1, "last_activity_date": 1574764735, "creation_date": 1574760303, "question_id": 59047594, "link": "https://stackoverflow.com/questions/59047594/xml-encoder-in-golang-does-not-close-tags-in-all-streams", "title": "XML Encoder in Golang does not close tags in all streams", "body": "<p>I'm working on a streaming XML encoder that will simultaneously write the XML to a local file, and an S3 bucket. However, just by testing it writing to two local files, I can see that one of the files is missing the closing tags every time.</p>\n\n<p>Here is roughly how I do it (omitting error handling):</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>func copyToFile (fileName string) {\n    f, _ := os.Create(fileName)\n    defer f.Close()\n    io.Copy(f, pr)\n}\n\nfunc main () {\n    pr, pw := io.Pipe()\n    defer pw.Close()\n\n    encoder := xml.NewEncoder(pw)\n\n    go copyToFile(\"file1.xml\")\n    go copyToFile(\"file2.xml\")\n\n    encoder.EncodeToken(xml.StartElement{...})\n    encoder.Encode(SomeStruct{})\n    encoder.EncodeToken(xml.EndElement{...})\n    encoder.Flush()\n}\n</code></pre>\n\n<p>The result in <code>file1.xml</code> is as expected, with all tags properly closed, but in <code>file2.xml</code> the closing tag (the call of <code>encoder.EncodeToken(xml.EndElement{...})</code>) is missing.</p>\n\n<p>What am I doing wrong? Can I expect the same result when I copy the reader to S3?</p>\n"}, {"tags": ["javascript", "go", "service", "worker"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6682612"}, "edited": false, "score": 0, "creation_date": 1574764021, "post_id": 59048244, "comment_id": 104338123, "body": "I think that&#39;s how it should work. The service worker requests the resources, if they are not cached yet. If I deactivate the cache, all resource fetchings are initiated by sw.js."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6682612"}, "edited": false, "score": 0, "creation_date": 1574765433, "post_id": 59048244, "comment_id": 104338931, "body": "Nevermind, I had service worker update on reload activated. It works as intended. Thank you."}, {"owner": {"reputation": 631, "user_id": 4172742, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XwWtc.jpg?s=128&g=1", "display_name": "Pengson", "link": "https://stackoverflow.com/users/4172742/pengson"}, "edited": false, "score": 0, "creation_date": 1574780444, "post_id": 59048244, "comment_id": 104347204, "body": "The weired thing is the request still be made although the cache is there.  May be it&#39;s possible to find the exact reason from the full sw.js if you are ok to paste it here."}], "tags": [], "owner": {"reputation": 631, "user_id": 4172742, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XwWtc.jpg?s=128&g=1", "display_name": "Pengson", "link": "https://stackoverflow.com/users/4172742/pengson"}, "is_accepted": false, "score": 0, "last_activity_date": 1574762431, "creation_date": 1574762431, "answer_id": 59048244, "question_id": 59047507, "link": "https://stackoverflow.com/questions/59047507/service-worker-does-not-cache-index-html-served-by-golang-server-on/59048244#59048244", "title": "Service worker does not cache index.html served by golang server on &#39;/&#39;", "body": "<p>From the screenshot you uploaded, it says that the request for fetching the index.html is initiated by a script named sw.js, and the exact code is placed at the second line. If this is truly the service-worker in your code, please recheck it carefully and find out why this request is made.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6682612"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574763491, "creation_date": 1574760016, "last_edit_date": 1574763491, "question_id": 59047507, "link": "https://stackoverflow.com/questions/59047507/service-worker-does-not-cache-index-html-served-by-golang-server-on", "title": "Service worker does not cache index.html served by golang server on &#39;/&#39;", "body": "<p>I'm playing around with a service worker trying to cache my index.html. I'm serving it via</p>\n\n<pre><code>http.HandleFunc(\"/sw\", handle.SW)\nhttp.HandleFunc(\"/\", handle.Index)\n</code></pre>\n\n<p>My service worker cache looks like this</p>\n\n<pre><code>self.addEventListener('install', (event) =&gt; {\n    self.skipWaiting();\n    event.waitUntil(async function () {\n        const cache = await caches.open(CACHE_VERSION);\n        await cache.addAll([\n            '/',\n            '/static/merged.css',\n            '/static/merged.js',\n            '/favicon.ico'\n        ]);\n    }());\n});\n</code></pre>\n\n<p>Without the service worker my network tab in the developer tools shows the size of the index.html with 4.5 KB and a time of 46ms.</p>\n\n<p><a href=\"https://i.stack.imgur.com/CcB1c.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CcB1c.png\" alt=\"enter image description here\"></a></p>\n\n<p>Now with the service worker merged.css, merged.js and favicon.ico are cached, but my index has two entries. One from service worker, and one of size 4.5 KB and a time of 48ms. </p>\n\n<p><a href=\"https://i.stack.imgur.com/WveTK.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WveTK.png\" alt=\"enter image description here\"></a></p>\n\n<p>So I'm guessing that index.html is not cached and I can not find out how to do it.</p>\n"}, {"tags": ["go", "ethereum", "smartcontracts", "web3", "remix"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574758346, "post_id": 59046982, "comment_id": 104334971, "body": "Hey and welcome to SO! You might want to read <a href=\"http://stackoverflow.com/help/how-to-ask\">How do I ask a good question</a>, which enhances the probability for getting a useful answer <i>drastically</i>. You might find <a href=\"https://en.m.wikipedia.org/wiki/Eric_S._Raymond\" rel=\"nofollow noreferrer\">ESR</a>&#39;s excellent essay <a href=\"http://catb.org/~esr/faqs/smart-questions.html\" rel=\"nofollow noreferrer\">How To Ask Questions The Smart Way</a> helpful, too - despite its &quot;harsh&quot; title."}], "answers": [{"tags": [], "owner": {"reputation": 1428, "user_id": 7189060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d72ad91327f4eca9e7aaf84abfd403c3?s=128&d=identicon&r=PG&f=1", "display_name": "StillFantasy", "link": "https://stackoverflow.com/users/7189060/stillfantasy"}, "is_accepted": false, "score": 0, "last_activity_date": 1574779487, "creation_date": 1574779487, "answer_id": 59053440, "question_id": 59046982, "link": "https://stackoverflow.com/questions/59046982/how-can-i-transfer-erc20-tokens-from-a-smart-contract-without-transfer-to-base-a/59053440#59053440", "title": "How can I Transfer ERC20 tokens from a smart contract without transfer to base account", "body": "<p>Just use account A to interact with your erc20 contract. For example, <code>transfer</code> or <code>transferFrom</code> function might meet your needs.</p>\n"}], "owner": {"reputation": 1, "user_id": 12435430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/842c244adc0259ce6fd6191c43510d74?s=128&d=identicon&r=PG&f=1", "display_name": "SUHAIL M S", "link": "https://stackoverflow.com/users/12435430/suhail-m-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 214, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574779487, "creation_date": 1574758208, "last_edit_date": 1574758614, "question_id": 59046982, "link": "https://stackoverflow.com/questions/59046982/how-can-i-transfer-erc20-tokens-from-a-smart-contract-without-transfer-to-base-a", "title": "How can I Transfer ERC20 tokens from a smart contract without transfer to base account", "body": "<p>I have some ERC20 tokens in a smart contract which created by an account A. I want to transfer ERC20 Token to another address using the gas from A, Without transfer ERC20 Tokens to A . Is there any way to solve my issue </p>\n"}, {"tags": ["go", "png"], "answers": [{"comments": [{"owner": {"reputation": 436, "user_id": 4786343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/CqPee.png?s=128&g=1", "display_name": "Sermanes", "link": "https://stackoverflow.com/users/4786343/sermanes"}, "edited": false, "score": 0, "creation_date": 1574781466, "post_id": 59046854, "comment_id": 104347831, "body": "Works for me. I also changed the color RGBA to NRGBA, I saw it in the following example <a href=\"https://golang.org/pkg/image/png/#Encode\" rel=\"nofollow noreferrer\">golang.org/pkg/image/png/#Encode</a>. Thank you."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1574760319, "last_edit_date": 1574760319, "creation_date": 1574757761, "answer_id": 59046854, "question_id": 59046618, "link": "https://stackoverflow.com/questions/59046618/problems-with-alpha-channelpng-and-golang/59046854#59046854", "title": "Problems with Alpha channel(PNG) and Golang", "body": "<p><a href=\"https://golang.org/pkg/image/color/#Color\" rel=\"nofollow noreferrer\"><code>Color.RGBA()</code></a> returns color components that are in the range of <code>0..0xffff</code>, not in <code>0..0xff</code>:</p>\n\n<blockquote>\n<pre><code>// RGBA returns the alpha-premultiplied red, green, blue and alpha values\n// for the color. Each value ranges within [0, 0xffff], but is represented\n// by a uint32 so that multiplying by a blend factor up to 0xffff will not\n// overflow.\n</code></pre>\n</blockquote>\n\n<p>So when constructing the color to draw with, you have to right shift all 16-bit components (by 8) and not just convert to <code>uint8</code> because that conversion keeps the lowest 8 bits which might be \"random\" compared to the 16-bit value, and you need the higher 8 bits:</p>\n\n<pre><code>realColor := color.RGBA{\n    R: uint8(R&gt;&gt;8),\n    G: uint8(G&gt;&gt;8),\n    B: uint8(B&gt;&gt;8),\n    A: uint8(A&gt;&gt;8),\n}\n</code></pre>\n"}], "owner": {"reputation": 436, "user_id": 4786343, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/CqPee.png?s=128&g=1", "display_name": "Sermanes", "link": "https://stackoverflow.com/users/4786343/sermanes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 209, "favorite_count": 0, "accepted_answer_id": 59046854, "answer_count": 1, "score": 1, "last_activity_date": 1574760319, "creation_date": 1574756915, "question_id": 59046618, "link": "https://stackoverflow.com/questions/59046618/problems-with-alpha-channelpng-and-golang", "title": "Problems with Alpha channel(PNG) and Golang", "body": "<p>I'm having a simple problem with my images in golang. I'm painting a png image with a color, but the result is not what I want.</p>\n\n<p>In the pixels with the lowest number in Alpha, another color is painted. I'm using alphaChannel = false </p>\n\n<pre><code>/* return new image with new color\n * alphaChannel = true get AlphaChannel from given color\n * alphaChannel = false get AlphaChannel from image (x,y) point\n */\nfunc PaintPngImage(img image.Image, cl color.Color, alphaChannel bool) image.Image {\n    R, G, B, A := cl.RGBA()\n    composeImage := image.NewRGBA(img.Bounds())\n\n    // paint image over a new image\n    draw.Draw(composeImage, composeImage.Bounds(), img, image.Point{}, draw.Over)\n\n    // paint new color over the image\n    bounds := composeImage.Bounds()\n    w, h := bounds.Max.X, bounds.Max.Y\n\n    for x := 0; x &lt; w; x++ {\n        for y := 0; y &lt; h; y++ {\n            _, _, _, aa := composeImage.At(x, y).RGBA()\n            if !alphaChannel {\n                A = aa\n            }\n            realColor := color.RGBA{R: uint8(R),G: uint8(G),B: uint8(B),A: uint8(A)}\n            if aa != 0 {\n                composeImage.Set(x, y, realColor)\n            }\n        }\n    }\n\n    return composeImage\n}\n\ncolorLayer := PaintPngImage(layerImage, cl, false)\nout, err := os.Create(\"./output/test.png\")\nutils.ShowFatalError(err)\nerr = png.Encode(out, colorLayer)\nutils.CloseFile(out) // close file os.Close\nutils.ShowFatalError(err) // Show panic log if err != nil\n</code></pre>\n\n<p>Final: [<a href=\"https://i.stack.imgur.com/bQuKI.png\" rel=\"nofollow noreferrer\">1</a>]</p>\n\n<p>If I use jpeg.Decode instead of png.Decode the image has not strange colors.</p>\n"}, {"tags": ["go", "apache-kafka", "sarama"], "comments": [{"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1574780282, "post_id": 59046158, "comment_id": 104347110, "body": "What do you mean by &quot;kafka rest api&quot;? Have you tried looking at the unit tests for that function?"}, {"owner": {"reputation": 17, "user_id": 9426539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "LittleY", "link": "https://stackoverflow.com/users/9426539/littley"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1574820809, "post_id": 59046158, "comment_id": 104363224, "body": "1.This is what i mean by &quot;kafka rest api&quot;: <a href=\"https://docs.confluent.io/current/kafka-rest/quickstart.html\" rel=\"nofollow noreferrer\">docs.confluent.io/current/kafka-rest/quickstart.html</a>  2.Yes, check: <a href=\"https://github.com/Shopify/sarama/blob/master/alter_configs_request_test.go\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama/blob/master/&hellip;</a>"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1574839139, "post_id": 59046158, "comment_id": 104368368, "body": "REST <i>Proxy</i> only maintains consumers and producers, not Zookeeper or external ACLs"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1574839352, "post_id": 59046158, "comment_id": 104368471, "body": "And I think you missed this one <a href=\"https://github.com/Shopify/sarama/blob/master/acl_create_request_test.go\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama/blob/master/&hellip;</a>"}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1574839577, "post_id": 59046158, "comment_id": 104368565, "body": "Note that a <code>UserResourceType</code> is not available to map to <code>--entity-type users</code> <a href=\"https://github.com/Shopify/sarama/blob/master/config_resource_type.go#L9-L21\" rel=\"nofollow noreferrer\">github.com/Shopify/sarama/blob/master/&hellip;</a> so I think the only alternative is to use a Zookeeper golang library and add that data &quot;manually&quot;"}], "owner": {"reputation": 17, "user_id": 9426539, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "LittleY", "link": "https://stackoverflow.com/users/9426539/littley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574857311, "creation_date": 1574755001, "last_edit_date": 1574857311, "question_id": 59046158, "link": "https://stackoverflow.com/questions/59046158/how-to-create-a-sasl-scram-user-principal-of-kafka-by-go", "title": "How to create a Sasl Scram user principal of Kafka by Go?", "body": "<p>Now I'm making a kafka service broker and want to create a new user when provisioning by using golang.\nI've checked all kafka library of Go, But didn't find any way to create a user(principal).\nIt seems that two method below from Shopify/Sarama may be possible way, but I have no idea how to use it and could not find a sample code.</p>\n\n<pre><code>//AlterConfigsRequest is an alter config request type\ntype AlterConfigsRequest struct {\n    Resources    []*AlterConfigsResource\n    ValidateOnly bool\n}\n//AlterConfigsResource is an alter config resource type\ntype AlterConfigsResource struct {\n    Type          ConfigResourceType\n    Name          string\n    ConfigEntries map[string]*string\n}\n</code></pre>\n\n<p>What I want to do is: \n<strong><code>bin/kafka-configs.sh --zookeeper localhost:2181 --alter --add-config 'SCRAM-SHA-256=[iterations=8192,password=myusername-secret],SCRAM-SHA-512=[password=myusername-secret]' --entity-type users --entity-name myusername</code></strong></p>\n\n<p>Is it possible to call kafka-rest-api to create a user?\nwhat is the best solution?</p>\n"}, {"tags": ["go", "graphql", "microservices", "twirp"], "owner": {"reputation": 11, "user_id": 12342443, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hwutg.jpg?s=128&g=1", "display_name": "Prateek Sawala", "link": "https://stackoverflow.com/users/12342443/prateek-sawala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1574857032, "creation_date": 1574754686, "last_edit_date": 1574857032, "question_id": 59046093, "link": "https://stackoverflow.com/questions/59046093/how-to-wire-one-two-or-more-microservice-in-the-twirpql-server", "title": "How to wire one/two or more microservice in the TwirpQL Server?", "body": "<p>I'm using the <code>GraphQL server</code> which is most-often a gateway that bundles all my different <code>microservices</code> created using <a href=\"https://gqlgen.com/\" rel=\"nofollow noreferrer\"><code>gqlgen</code></a>. </p>\n\n<p>I want to make a switch to the <code>TwirpQL server</code> as I was following the official documentation of <a href=\"https://twirpql.dev/docs/multiple-services\" rel=\"nofollow noreferrer\">TwirpQL</a>. I believe it wants me to wrap every microservice inside it so there will be multiple GraphQL layers one for every microservice.</p>\n\n<p>I don't want to expose the other microservices as <code>Graphql</code>, but rather \"just\" create one entry point for all the requests and later send them to the respected microservice accordingly.</p>\n\n<p>Can anyone please enlighten me on the correct usage?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "middleware", "go-swagger"], "owner": {"reputation": 908, "user_id": 3649496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59c95010d46812ccabe7eea947a090ab?s=128&d=identicon&r=PG&f=1", "display_name": "infiniteLearner", "link": "https://stackoverflow.com/users/3649496/infinitelearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 631, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1574846806, "creation_date": 1574750200, "last_edit_date": 1574846806, "question_id": 59045045, "link": "https://stackoverflow.com/questions/59045045/how-to-implement-middleware-with-go-swagger", "title": "How to implement middleware with go-swagger?", "body": "<p>I am using go-swagger to create API endpoint and the business logic is called inside the handler function directly , which is working fine . I need to implement \"Middleware\" , which can also ease in unit testing which I am doing using mockery and testify . Below is the code . </p>\n\n<h3><code>Swagger.yml</code></h3>\n\n<p>I have provided only sample code for endpoint</p>\n\n<pre><code>---\nswagger: \"2.0\"\ninfo:\n  description: Swagger api for VM Manager\n  title: vmManager\n  version: 1.0.0\nconsumes:\n- application/json\nproduces:\n- application/json\nschemes:\n- http\npaths:\n  /createVM:\n    post:\n      tags:\n        - vmManager\n      operationId: createVM\n      parameters:\n        - name: body\n          in: body\n          schema:\n            $ref: \"#/definitions/vmInput\"\n      responses:\n        201:\n          description: Created\n          schema:\n            $ref: \"#/definitions/response\"\n        default:\n          description: error\n          schema:\n            $ref: \"#/definitions/errorObject\"\n</code></pre>\n\n<h3><code>configure_vmmanager.go</code></h3>\n\n<p>Call from above swagger comes here</p>\n\n<pre><code>api.VMManagerCreateVMHandler = vm_manager.CreateVMHandlerFunc(func(params vm_manager.CreateVMParams) middleware.Responder {\n        log.Debugf(\"Create VM Handler Called\")\n        log.Infof(\"Payload Data : %v , VM Name : %v , Request ID : %v\", params.Body.ConfigData, params.Body.VMName, params.Body.RequestID)  \n        log.WithFields(log.Fields{\n            \"Request Payload\": params.Body,\n        }).Infof(\"Request Payload to  CreateVMHandler: \")\n\n        vmOutput, err := resthandler.CreateVMHandler(params.Body)\n        if err != nil {\n                log.Errorf(\"Eror while creating VM %v :\" ,err)\n                 errorObject := &amp;models.ErrorObject{ErrorDetails: err ,}\n    // TODO Addition for custom error code\n                //return vm_manager.NewCreateVMDefault(*ErrorCode).WithPayload(&amp;models.Error{ErrorCode: errorCode, ErrorDesc: err.ErrorDesc})\n                return vm_manager.NewCreateVMDefault(int(*err.ErrorCode)).WithPayload(errorObject)\n        }\n        log.WithFields(log.Fields{\n            \"Response of CreateVMHandler\":vmOutput,\n        }).Infof(\"Response from  CreateVMHandler :\")\n        return vm_manager.NewCreateVMCreated().WithPayload(vmOutput)\n    })\n</code></pre>\n\n<h3><code>create_vm_handler.go</code></h3>\n\n<p>Definition part</p>\n\n<pre><code>func CreateVMHandler(item *models.VMInput) (*models.Response, *models.ErrorDetails) {\n.\n.\n.\nreturn serverOut, nil\n}\n</code></pre>\n\n<p>Please comment in case of any additional information is needed.</p>\n"}, {"tags": ["go", "resources", "resource-management"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574780028, "post_id": 59044658, "comment_id": 104346940, "body": "This question is broad enough that the only correct answer is &quot;it depends&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": true, "score": 5, "last_activity_date": 1574756853, "last_edit_date": 1592644375, "creation_date": 1574756853, "answer_id": 59046600, "question_id": 59044658, "link": "https://stackoverflow.com/questions/59044658/golang-resource-ownership-pattern-files-connections-close-ables/59046600#59046600", "title": "golang resource ownership pattern (files, connections, close-ables)", "body": "<p>You chose a bad example, since you generally would reuse a database connection, instead of opening and closing one for each use. Hence, you would pass the db connection to functions using it and do the resource management in the caller without any need for an resource manager:</p>\n<pre><code>// Imports etc omitted for the sake of readability\n\nfunc PingHandler(db *sql.DB) http.Handler (\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n       if err := db.ping(); err != nil {\n          http.Error(w,e.Error(),500)\n       }\n    })\n)\n\nfunc main(){\n    db,_ := sql.Open(&quot;superdb&quot;,os.Getenv(&quot;APP_DBURL&quot;))\n\n    // Note the db connection will only be closed if main exits.\n    defer db.Close()\n\n    // Setup the server\n    http.Handle(&quot;/ping&quot;, PingHandler(db))\n    server := &amp;http.Server{Addr: &quot;:8080&quot;}\n\n    // Create a channel for listening on SIGINT, -TERM and -QUIT\n    stop := make(chan os.Signal, 1)\n\n    // Register channel to be notified on said signals\n    signal.Notify(stop, syscall.SIGINT, syscall.SIGTERM, syscall.SIGQUIT)\n\n    go func(){\n            // When we get the signal...\n            &lt;- stop\n            ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n            // ... we gracefully shut down the server.\n            // That ensures that no new connections, which potentially\n            // would use our db connection, are accepted.\n            if err := server.Shutdown(ctx); err != nil {\n                // handle err\n            }\n    }\n\n    // This blocks until the server is shut down.\n    // AFTER it is shut down, main exits, the deferred calls are executed.\n    // In this case, the database connection is closed.\n    // And it is closed only after the last handler call which uses the connection is finished.\n    // Mission accomplished.\n    server.ListenAndServe()\n}\n</code></pre>\n<p>So in this example, there is no need for a resource manager and I honestly can not think of an example actually needing one. In the rare cases I needed something akin to one, I used <a href=\"https://golang.org/pkg/sync/#Pool\" rel=\"nofollow noreferrer\"><code>sync.Pool</code></a>.</p>\n<p>However, for gRPC client connections, <a href=\"https://github.com/grpc/grpc-go/issues/682#issuecomment-360531305\" rel=\"nofollow noreferrer\">there is no need to maintain a pool</a>, either:</p>\n<blockquote>\n<p>[...]However, the ClientConn should manage the connections itself, so if a connection is broken, it will reconnect automatically. And if you have multiple backends, it's possible to connect to multiple of them and load balance between them. [...]</p>\n</blockquote>\n<p>So the same principle applies: Create a connection (pool), pass it around as required, ensure that it is closed <em>after</em> all work is done.</p>\n<p>Go proverb:</p>\n<blockquote>\n<p><a href=\"https://www.youtube.com/watch?v=PAAkCSZUG1c&amp;t=14m35s\" rel=\"nofollow noreferrer\">Clear is better than clever.</a></p>\n<p>\u2013 <em>Robert Pike</em></p>\n</blockquote>\n<p>Instead of hiding resource management somewhere else, manage the resources as closely to the code where they are used and as explicitly as you possibly can.</p>\n"}], "owner": {"reputation": 605, "user_id": 2909076, "user_type": "registered", "accept_rate": 40, "profile_image": "https://graph.facebook.com/9384393/picture?type=large", "display_name": "Dan Jenson", "link": "https://stackoverflow.com/users/2909076/dan-jenson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 59046600, "answer_count": 1, "score": -2, "last_activity_date": 1574756853, "creation_date": 1574748064, "last_edit_date": 1574748416, "question_id": 59044658, "link": "https://stackoverflow.com/questions/59044658/golang-resource-ownership-pattern-files-connections-close-ables", "title": "golang resource ownership pattern (files, connections, close-ables)", "body": "<p>What is the proper way to manage resource ownership in golang? Suppose I have the following:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"role@/test_db\")\nam := NewResourceManager(db)\nam.DoWork()\ndb.Close()\n</code></pre>\n\n<p>Is it typical to always have the calling function maintain ownership and responsibility for closing resources? This feels a little weird to me because after closing, <code>am</code> still retains a reference and could try to use <code>db</code> if I or someone else is not careful later on (I guess this is a case for defer; however, if I want to pass the ResourceManager <code>am</code> back from this block, how would I even defer the closing of the file properly? I actually want it to stay open when this block finishes execution). I find that in other languages I often want to allow the instance to manage the resource and then clean it up when it's destructor is called, like this toy python example:</p>\n\n<pre><code>class Writer():\n   def __init__(self, filename):\n       self.f = open(filename, 'w+')\n\n   def __del__(self):\n       self.f.close()\n\n   def write(value):\n       self.f.write(value)\n</code></pre>\n\n<p>Unfortunately, there are no destructors in golang. I'm not sure how I would do this in go other than something like this:</p>\n\n<pre><code>type ResourceManager interface {\n   DoWork()\n   // Close() ?\n}\n\ntype resourceManager struct {\n  db *sql.DB\n}\n\nfunc NewResourceManager(db *sql.DB) ResourceManager {\n  return &amp;resourceManager{db}\n} \n\ndb, err := sql.Open(\"mysql\", \"role@/test_db\")\nam := NewResourceManager(db)\nam.DoWork()\nam.Close()  // using method shortening\n</code></pre>\n\n<p>But this seems less transparent, and I'm not sure how to communicate that the ResourceManager also needs to be Close()'d now. I'm finding this a frequent stumbling block, i.e. I also want to have a resource manager that holds a gRPC client connection, and if these types of resources aren't managed by resource managing objects, it seems like my main function is going to be cluttered with a lot of resource management, i.e. opening and closing. For instance, I could imagine a case where I wouldn't want <code>main</code> to know anything about the object and it's resources:</p>\n\n<pre><code>...\nfunc NewResourceManager() ResourceManager {\n  db, err := sql.Open(\"mysql\", \"role@/test_db\")\n  return &amp;resourceManager{db}\n}\n...\n// main elsewhere\nam := NewResourceManager()\nam.DoWork()\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "edited": false, "score": 1, "creation_date": 1574747633, "post_id": 59044243, "comment_id": 104330749, "body": "What is the value of <code>service.Settings.TimezoneName</code>?  Add <code>fmt.Printf(&quot;%q\\n&quot;, service.Settings.TimezoneName)</code> before this \t<code>tzloc, err := time.LoadLocation(service.Settings.TimezoneName)</code> to see the content of <code>service.Settings.TimezoneName</code>"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1574747719, "post_id": 59044243, "comment_id": 104330786, "body": "What does <code>log.Printf(&quot;tz = %q\\n&quot;, service.Settings.TimezoneName)</code> output? It will catch any rogue bytes in your input."}], "answers": [{"comments": [{"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 0, "creation_date": 1574808129, "post_id": 59044457, "comment_id": 104360250, "body": "Thanks, I&#39;ll check this once I get a chance and mark as answer if you&#39;re right."}], "tags": [], "owner": {"reputation": 1032, "user_id": 3198508, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/0bef3ebf78397965521fd92ee63b95f5?s=128&d=identicon&r=PG&f=1", "display_name": "SouvikMaji", "link": "https://stackoverflow.com/users/3198508/souvikmaji"}, "is_accepted": false, "score": 1, "last_activity_date": 1574746922, "creation_date": 1574746922, "answer_id": 59044457, "question_id": 59044243, "link": "https://stackoverflow.com/questions/59044243/timezones-failing-to-load-in-go-1-13/59044457#59044457", "title": "Timezones failing to load in Go 1.13", "body": "<p>Test with a hardcoded timezone string in <code>time.LoadLocation</code>. I suspect there might be whitespaces in your <code>TimezoneName</code> variable. </p>\n\n<p>Otherwise LoadLocation is working fine as expected in Go1.13. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    location, err := time.LoadLocation(\"Australia/Melbourne\")\n    if err != nil {\n        panic(err)\n    }\n\n    timeInUTC := time.Date(2018, 8, 30, 12, 0, 0, 0, time.UTC)\n    fmt.Println(timeInUTC.In(location))\n}\n</code></pre>\n\n<p>The above code is giving <code>2018-08-30 22:00:00 +1000 AEST</code> as output in Go <a href=\"https://play.golang.org/p/yVSVsz2WKdJ\" rel=\"nofollow noreferrer\">Playground</a>. Go Playground uses go 1.13.</p>\n\n<p>But if I put a space <a href=\"https://play.golang.org/p/SOv5QQgK0-c\" rel=\"nofollow noreferrer\">around</a> </p>\n\n<pre><code>location, err := time.LoadLocation(\"Australia/Melbourne \")\nif err != nil {\n     panic(err)\n}\n</code></pre>\n\n<p>It gives the error you are having.</p>\n\n<blockquote>\n  <p>panic: unknown time zone Australia/Melbourne</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 0, "creation_date": 1574825542, "post_id": 59062451, "comment_id": 104364210, "body": "Yeah I know. But the thing is it works or fails depending on whether I compile with 1.12 or 1.13."}, {"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "reply_to_user": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 0, "creation_date": 1574825869, "post_id": 59062451, "comment_id": 104364290, "body": "zoneinfo file will not compile into the binary, check the server you run the program @seesharper"}, {"owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "edited": false, "score": 0, "creation_date": 1574833689, "post_id": 59062451, "comment_id": 104366243, "body": "Yes it&#39;s there. What I meant was that it works in 1.12, so the zoneinfo file must be there."}], "tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 0, "last_activity_date": 1574824344, "last_edit_date": 1592644375, "creation_date": 1574824344, "answer_id": 59062451, "question_id": 59044243, "link": "https://stackoverflow.com/questions/59044243/timezones-failing-to-load-in-go-1-13/59062451#59062451", "title": "Timezones failing to load in Go 1.13", "body": "<p>if you are passing exactly <code>Australia/Melbourne</code> to <code>time.LoadLocation</code>, then you should check the zoneinfo file.</p>\n<p><a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/#LoadLocation</a></p>\n<blockquote>\n<p>the name is taken to be a location name corresponding to a file in the IANA Time Zone database.</p>\n<p>The time zone database needed by LoadLocation may not be present on all systems, especially non-Unix systems. LoadLocation looks in the directory or uncompressed zip file named by the ZONEINFO environment variable, if any, then looks in known installation locations on Unix systems, and finally looks in $GOROOT/lib/time/zoneinfo.zip.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 572, "user_id": 1389995, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/4e62074cbdebf48986f77be11f348825?s=128&d=identicon&r=PG", "display_name": "fussmonkey", "link": "https://stackoverflow.com/users/1389995/fussmonkey"}, "is_accepted": true, "score": 2, "last_activity_date": 1581435080, "creation_date": 1581435080, "answer_id": 60172367, "question_id": 59044243, "link": "https://stackoverflow.com/questions/59044243/timezones-failing-to-load-in-go-1-13/60172367#60172367", "title": "Timezones failing to load in Go 1.13", "body": "<p>This happened to us, where we are bundling the <code>zoneinfo.zip</code> file with our program because we need to run this on Windows servers. We set the ZONEINFO environment variable to the path with the .zip file and then call <code>time.LoadLocation(\"America/Chicago\")</code>. In version 1.12 this was fine. We upgraded to version 1.13 and had an issue of \"The system cannot find the path specified.\" when calling LoadLocation.</p>\n\n<p>In our case, updating the bundled <code>zoneinfo.zip</code> file to the latest version from the golang repo fixed the issue. The version we used previously was from commit <code>af3c48096</code>. Not sure if this was the same problem you ran into, since it's unclear if you were deploying that zip file like we are, but thought I'd chime in for anyone else running into the issue.</p>\n\n<p>Note: this only affected situations where Go version 1.13 wasn't installed - when I ran it locally, things were fine because it was falling back to the version in the $GOROOT folder (which was newer from when 1.13 was installed). The error happened on a Windows machine without Go installed, and also locally if I removed the $GOROOT\\lib\\time\\zoneinfo.zip file.</p>\n"}, {"comments": [{"owner": {"reputation": 343, "user_id": 12222077, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UtZrA.jpg?s=128&g=1", "display_name": "iamolegga", "link": "https://stackoverflow.com/users/12222077/iamolegga"}, "edited": false, "score": 0, "creation_date": 1618302436, "post_id": 61639061, "comment_id": 118554079, "body": "Thanks. Solved issue for go:1.14 with alpine image, so it looks like no matter what go version it is"}], "tags": [], "owner": {"reputation": 659, "user_id": 849459, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/4cf1fe8b2884598dc23e6bb73b9d65db?s=128&d=identicon&r=PG", "display_name": "Ankur Agarwal", "link": "https://stackoverflow.com/users/849459/ankur-agarwal"}, "is_accepted": false, "score": 2, "last_activity_date": 1588778904, "creation_date": 1588778904, "answer_id": 61639061, "question_id": 59044243, "link": "https://stackoverflow.com/questions/59044243/timezones-failing-to-load-in-go-1-13/61639061#61639061", "title": "Timezones failing to load in Go 1.13", "body": "<p>For docker, the solution by adding a tzdata or equivalent package. This solve the issue when using go 1.13</p>\n\n<p><a href=\"http://pouzek.si/blog/go-loadlocation-docker/\" rel=\"nofollow noreferrer\">http://pouzek.si/blog/go-loadlocation-docker/</a></p>\n\n<pre><code>FROM gliderlabs/alpine:3.3\n\nRUN apk add --no-cache tzdata\n\nCOPY out/go-loadlocation-docker /go-loadlocation-docker\n\nENTRYPOINT [\"/go-loadlocation-docker\"]\n</code></pre>\n"}], "owner": {"reputation": 8235, "user_id": 1284760, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/2f0d151197270b75a2c5e5bf6a2a6583?s=128&d=identicon&r=PG", "display_name": "see sharper", "link": "https://stackoverflow.com/users/1284760/see-sharper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1984, "favorite_count": 0, "accepted_answer_id": 60172367, "answer_count": 4, "score": 1, "last_activity_date": 1588778904, "creation_date": 1574745727, "question_id": 59044243, "link": "https://stackoverflow.com/questions/59044243/timezones-failing-to-load-in-go-1-13", "title": "Timezones failing to load in Go 1.13", "body": "<p>This simple code:</p>\n\n<pre><code>tzloc, err := time.LoadLocation(service.Settings.TimezoneName)\nif err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>works just fine in Go 1.12, but in 1.13, it fails with \"unknown timezone Australia/Melbourne\". I'm sure it works in some environments, but for whatever reason, it is broken in 1.13 for us. It is immediately fixed by reverting to 1.12. I am wondering if anyone knows of any issues or reasons in 1.13 why this would fail despite this assurance from the release notes: \"As always, the release maintains the Go 1 promise of compatibility. We expect almost all Go programs to continue to compile and run as before.\"</p>\n"}, {"tags": ["go", "opentracing", "jaeger"], "answers": [{"comments": [{"owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "edited": false, "score": 0, "creation_date": 1574832067, "post_id": 59047238, "comment_id": 104365705, "body": "Thanks for your response. I assume binding it to metrics and logging is very useful, allowing to go logs &lt;-&gt; tracing &lt;-&gt; metrics. <code>jaeger-client-go</code> is what I&#39;m using. I&#39;ve got tracing working separately but I&#39;d like to establish binding. My confusing comes from the fact that I can&#39;t pass <code>*zap.Logger</code> and <code>*prometheus.Registry</code>  into <code>cfg.NewTracer(config.Logger(...))</code> for <code>jaeger-client-go</code>. Instead, I need to wrap it into a simplified logger and some metrics factory as per <code>hotrod</code> example. I&#39;m new to this system and wondering why is it required."}], "tags": [], "owner": {"reputation": 13313, "user_id": 524946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49d8b563a893593818ec96a688409412?s=128&d=identicon&r=PG", "display_name": "jpkrohling", "link": "https://stackoverflow.com/users/524946/jpkrohling"}, "is_accepted": false, "score": 1, "last_activity_date": 1574759104, "creation_date": 1574759104, "answer_id": 59047238, "question_id": 59044026, "link": "https://stackoverflow.com/questions/59044026/why-go-jaeger-client-requires-wrappers-for-metrics-and-logs/59047238#59047238", "title": "Why go-jaeger-client requires wrappers for metrics and logs?", "body": "<p>You can bind it to metrics and logging frameworks, but you don't have to. You can simply just call <code>cfg.NewTracer()</code>, like in this example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ExampleFromEnv() {\n    cfg, err := jaegercfg.FromEnv()\n    if err != nil {\n        // parsing errors might happen here, such as when we get a string where we expect a number\n        log.Printf(\"Could not parse Jaeger env vars: %s\", err.Error())\n        return\n    }\n\n    tracer, closer, err := cfg.NewTracer()\n    if err != nil {\n        log.Printf(\"Could not initialize jaeger tracer: %s\", err.Error())\n        return\n    }\n    defer closer.Close()\n\n    opentracing.SetGlobalTracer(tracer)\n    // continue main()\n}\n</code></pre>\n\n<p>Source: <a href=\"https://github.com/jaegertracing/jaeger-client-go/blob/3585cc566102e0ea2225177423e3fcc3d2e5fd7a/config/example_test.go#L88-L105\" rel=\"nofollow noreferrer\">https://github.com/jaegertracing/jaeger-client-go/blob/3585cc566102e0ea2225177423e3fcc3d2e5fd7a/config/example_test.go#L88-L105</a></p>\n\n<p>Check the Jaeger Go Client readme for more information on the metrics/logging integration: <a href=\"https://github.com/jaegertracing/jaeger-client-go\" rel=\"nofollow noreferrer\">https://github.com/jaegertracing/jaeger-client-go</a></p>\n"}, {"tags": [], "owner": {"reputation": 471, "user_id": 2673284, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/40d04b9be7a037d05840c44dcec029ff?s=128&d=identicon&r=PG&f=1", "display_name": "Yuri Shkuro", "link": "https://stackoverflow.com/users/2673284/yuri-shkuro"}, "is_accepted": true, "score": 2, "last_activity_date": 1575951040, "creation_date": 1575951040, "answer_id": 59260094, "question_id": 59044026, "link": "https://stackoverflow.com/questions/59044026/why-go-jaeger-client-requires-wrappers-for-metrics-and-logs/59260094#59260094", "title": "Why go-jaeger-client requires wrappers for metrics and logs?", "body": "<p>Jaeger clients are designed to have a minimum set of dependencies. We don't know if your application is using Prometheus metrics or Zap logger. This is why <code>jaeger-client-go</code> (as well as many other Jaeger clients in other languages) provide two lightweight interfaces for a Logger and MetricsFactory that can be implemented for a specific logs/metrics backend that your application is using. Of course, the bindings for Prometheus and Zap are already implemented in the <code>jaeger-lib</code> and can be included optionally.</p>\n"}], "owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 321, "favorite_count": 0, "accepted_answer_id": 59260094, "answer_count": 2, "score": 1, "last_activity_date": 1575951040, "creation_date": 1574744386, "question_id": 59044026, "link": "https://stackoverflow.com/questions/59044026/why-go-jaeger-client-requires-wrappers-for-metrics-and-logs", "title": "Why go-jaeger-client requires wrappers for metrics and logs?", "body": "<p>I\u2019ve started with instrumenting my gRPC service using go-gRPC-middleware. I\u2019ve got logs working using zap and metrics exposed for Prometheus.</p>\n\n<p>Now that I\u2019m trying to configure tracing using jaeger go client it requires me to add wrapper around metrics storage and logger. I\u2019m not sure I understand why those wrappers are required</p>\n\n<p><a href=\"https://github.com/jaegertracing/jaeger/blob/bf64373d1e690594fd8c279720faf32722cf1494/examples/hotrod/pkg/tracing/init.go#L46\" rel=\"nofollow noreferrer\">https://github.com/jaegertracing/jaeger/blob/bf64373d1e690594fd8c279720faf32722cf1494/examples/hotrod/pkg/tracing/init.go#L46</a></p>\n"}, {"tags": ["go", "deferred"], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1574798309, "last_edit_date": 1574798309, "creation_date": 1574744576, "answer_id": 59044057, "question_id": 59043992, "link": "https://stackoverflow.com/questions/59043992/why-defer-statement-works-differently-when-annoymouse-function-returned/59044057#59044057", "title": "why defer statement works differently when annoymouse function returned", "body": "<p>This is because <code>defer</code> statement only <code>defer</code>s the evaluated function call - and the function call is evaluated at the time <code>defer</code> execuated. As per doc:</p>\n\n<blockquote>\n  <p>Each time a \"defer\" statement executes, the function value and parameters to the call are evaluated as usual and saved anew but the actual function is not invoked. Instead, deferred functions are invoked immediately before the surrounding function returns, in the reverse order they were deferred. That is, if the surrounding function returns through an explicit return statement, deferred functions are executed after any result parameters are set by that return statement but before the function returns to its caller. If a deferred function value evaluates to nil, execution panics when the function is invoked, not when the \"defer\" statement is executed. </p>\n</blockquote>\n\n<p>Your code <code>defer trace2()()</code> essentially is equlavent of <code>f := trace2(); defer f()</code>. So <code>trace2</code> gets evaluated (and thus called) immediately.</p>\n\n<p>So to achieve what you might want (tracing time), you may use <code>defer trace3()()</code> with <code>trace3()</code> like this:</p>\n\n<pre><code>func trace3() func() {\n    startTime := time.Now()\n\n    return func() {\n        fmt.Println(\"end time: \", time.Now())\n        fmt.Println(\"execute time: \", time.Since(startTime))\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 0, "last_activity_date": 1574744719, "creation_date": 1574744719, "answer_id": 59044085, "question_id": 59043992, "link": "https://stackoverflow.com/questions/59043992/why-defer-statement-works-differently-when-annoymouse-function-returned/59044085#59044085", "title": "why defer statement works differently when annoymouse function returned", "body": "<p>The way to trace time with defer is to pass the start time to the deferred function:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func trace1(startTime time.Time) {\n    fmt.Println(\"start\", startTime)\n    fmt.Println(\"end time: \", time.Now())\n    fmt.Println(\"execute time: \", time.Since(startTime))\n}\n\nfunc TestDeferFunc(t *testing.T) {\n    defer trace1(time.Now())\n    time.Sleep(3 * time.Second)\n}\n</code></pre>\n\n<p>The parameters passed are executed immediately, but the actual function call is deferred to the end.</p>\n\n<p>If you want to be more explicit about what is executed and what is deferred, you can wrap the whole thing in a function so that you are sure everything inside is executed at the end</p>\n\n<pre><code>defer func() {\n    ..... code ....\n}()\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 12434648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e88300768a0fecfece4f266452913ae3?s=128&d=identicon&r=PG&f=1", "display_name": "clayton xia", "link": "https://stackoverflow.com/users/12434648/clayton-xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 59044057, "answer_count": 2, "score": 0, "last_activity_date": 1574798309, "creation_date": 1574744165, "question_id": 59043992, "link": "https://stackoverflow.com/questions/59043992/why-defer-statement-works-differently-when-annoymouse-function-returned", "title": "why defer statement works differently when annoymouse function returned", "body": "<p>here i declare a function which defer trace1</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestDeferFunc(t *testing.T) {\n    fmt.Println(\"start\", time.Now())\n    defer trace1()\n    time.Sleep(3 * time.Second)\n}\n\nfunc trace1() {\n    startTime := time.Now()\n    fmt.Println(\"end time: \", startTime)\n    fmt.Println(\"execute time: \", time.Since(startTime))\n}\n</code></pre>\n\n<p>after run <code>go test -run=^TestDeferFunc$</code>,below is what i got</p>\n\n<pre><code>start 2019-11-26 12:50:59.59489797 +0800 CST m=+0.000202866\nend time:  2019-11-26 12:51:02.595090951 +0800 CST m=+3.000395880\nexecute time:  49.065\u00b5s\n</code></pre>\n\n<p>howerver, when i defer another annoymouse function, things changed</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestDeferFunc(t *testing.T) {\n    fmt.Println(\"start\", time.Now())\n    defer trace2()()\n    time.Sleep(3 * time.Second)\n}\n\nfunc trace2() func() {\n    startTime := time.Now()\n    fmt.Println(\"end time: \", startTime)\n    fmt.Println(\"execute time: \", time.Since(startTime))\n    return func() {\n        fmt.Println(\"zzz\")\n    }\n}\n</code></pre>\n\n<p>below is the <code>go test</code> result</p>\n\n<pre><code>start 2019-11-26 12:52:58.318472958 +0800 CST m=+0.000197852\nend time:  2019-11-26 12:52:58.318554368 +0800 CST m=+0.000279262\nexecute time:  4.853\u00b5s\nzzz\n</code></pre>\n\n<p>could someone help me out! thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574744191, "post_id": 59043990, "comment_id": 104329761, "body": "Sorry, Diskpart**** details"}], "answers": [{"comments": [{"owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "reply_to_user": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574749772, "post_id": 59044757, "comment_id": 104331423, "body": "No. Do you need for winodws?"}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574749837, "post_id": 59044757, "comment_id": 104331439, "body": "I have to run the above code, not working in the Windows environment."}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574749883, "post_id": 59044757, "comment_id": 104331456, "body": "Yes, Fahim. I need for windows."}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574750933, "post_id": 59044757, "comment_id": 104331821, "body": "The above package only returns drive details only. I need for disk details."}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574751117, "post_id": 59044757, "comment_id": 104331879, "body": "Example: &quot;Diskpart&quot; command execute in command prompt. and then &quot;list disk&quot; command executes.(Same result I need for Golang package)"}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574752786, "post_id": 59044757, "comment_id": 104332524, "body": "I need for Golang package only."}], "tags": [], "owner": {"reputation": 451, "user_id": 5671644, "user_type": "registered", "profile_image": "https://graph.facebook.com/965230240198588/picture?type=large", "display_name": "Fahim Abrar", "link": "https://stackoverflow.com/users/5671644/fahim-abrar"}, "is_accepted": true, "score": 0, "last_activity_date": 1574751004, "last_edit_date": 1574751004, "creation_date": 1574748615, "answer_id": 59044757, "question_id": 59043990, "link": "https://stackoverflow.com/questions/59043990/how-to-get-dispart-detailsdiskname-ex-disk-0-free-usage-of-disk-using-go/59044757#59044757", "title": "How to get Dispart details(diskname (ex : Disk 0) free &amp; usage of disk) using Golang package", "body": "<p>You can use this package <code>github.com/shirou/gopsutil</code> for <code>diskpart</code> details:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/shirou/gopsutil/disk\"\n)\n\nfunc main() {\n    diskInfo, err := disk.Usage(\"/\")\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(diskInfo)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574752178, "post_id": 59045424, "comment_id": 104332275, "body": "is that work on the French language? because of the above code run in the french language environment."}, {"owner": {"reputation": 529, "user_id": 1540739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c9e558372c8a4422060f277b3f73886?s=128&d=identicon&r=PG", "display_name": "arshpreet", "link": "https://stackoverflow.com/users/1540739/arshpreet"}, "reply_to_user": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574753912, "post_id": 59045424, "comment_id": 104332983, "body": "It will work, I never used Windows since 2005 but you need to test code first."}, {"owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "edited": false, "score": 0, "creation_date": 1574758448, "post_id": 59045424, "comment_id": 104335017, "body": "Worked!!!.but it will return the french language. How can I read the data?"}], "tags": [], "owner": {"reputation": 529, "user_id": 1540739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c9e558372c8a4422060f277b3f73886?s=128&d=identicon&r=PG", "display_name": "arshpreet", "link": "https://stackoverflow.com/users/1540739/arshpreet"}, "is_accepted": false, "score": 0, "last_activity_date": 1574751795, "creation_date": 1574751795, "answer_id": 59045424, "question_id": 59043990, "link": "https://stackoverflow.com/questions/59043990/how-to-get-dispart-detailsdiskname-ex-disk-0-free-usage-of-disk-using-go/59045424#59045424", "title": "How to get Dispart details(diskname (ex : Disk 0) free &amp; usage of disk) using Golang package", "body": "<p>You don't need to rely on any package of golang, You can just run OS(Window's) commands from Golang. </p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"diskpart\")\n    if err := cmd.Run(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(cmd)\n    cmd2 := exec.Command(\"list disk\")\n    if err := cmd.Run(); err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(cmd2)\n} \n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 8440124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e79f658b9bdc44bb9398b96e2d588e07?s=128&d=identicon&r=PG&f=1", "display_name": "Thiru", "link": "https://stackoverflow.com/users/8440124/thiru"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 59044757, "answer_count": 2, "score": 1, "last_activity_date": 1574751795, "creation_date": 1574744151, "question_id": 59043990, "link": "https://stackoverflow.com/questions/59043990/how-to-get-dispart-detailsdiskname-ex-disk-0-free-usage-of-disk-using-go", "title": "How to get Dispart details(diskname (ex : Disk 0) free &amp; usage of disk) using Golang package", "body": "<p>How to get Dispart details(disk name (ex: Disk 0) free &amp; usage of the disk) using Golang package</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 2, "creation_date": 1574746676, "post_id": 59043901, "comment_id": 104330479, "body": "While this would be in theory possible at the protocol level it would conflict with the response follows request paradigm of HTTP. It might also lead to problems with proxies, especially if these want to analyze the content first before forwarding (i.e. secure gateways). The proper scheme would be instead to have a &quot;preflight&quot; request to find out what the server expects and then a new request which then provides what the server expects."}, {"owner": {"reputation": 6086, "user_id": 943814, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e8b4b9fc52a3084be9a2de004e0bb6dc?s=128&d=identicon&r=PG", "display_name": "anderspitman", "link": "https://stackoverflow.com/users/943814/anderspitman"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1574747451, "post_id": 59043901, "comment_id": 104330689, "body": "I agree multiple requests would be more idiomatic of HTTP. However, that&#39;s very undesirable with what I&#39;m trying to do. Can proxies still cause issues if I&#39;m using HTTPS all the way from the client to my server?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1574747877, "post_id": 59043901, "comment_id": 104330835, "body": "Proxies might do SSL interception - which is common in companies but also often done with desktop antivirus. In this case it does not really matter if HTTP or HTTPS is used since the analysis is done in both cases. In short: better use HTTP(S) as intended and don&#39;t try to invent some shortcut which works in your current environment and use case but might cause unexpected problems later in different cases."}, {"owner": {"reputation": 6086, "user_id": 943814, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e8b4b9fc52a3084be9a2de004e0bb6dc?s=128&d=identicon&r=PG", "display_name": "anderspitman", "link": "https://stackoverflow.com/users/943814/anderspitman"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1574748594, "post_id": 59043901, "comment_id": 104331037, "body": "That makes sense. It really seems orthogonal to the problem I&#39;m trying to solve though. Why would a proxy be more likely to intercept my header if it&#39;s sent in the original request vs a preflight request?"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1574749528, "post_id": 59043901, "comment_id": 104331351, "body": "A proxy is more likely to expect common semantics of HTTP, i.e. send a full request and get a full response instead of getting only the request header, then the response header etc. Apart from that: the standard has a feature where the server first sends a provisional response header and then the real header+body. The client must announce support for this though and a proxy might filter this support if he cannot deal with it. See <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/100\" rel=\"nofollow noreferrer\">100 Continue</a> for more."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574779856, "post_id": 59043901, "comment_id": 104346828, "body": "The server shouldn&#39;t be <i>sending</i> a response until you finish sending the body. There&#39;s nothing you can do client-side to start reading that which has not yet been sent."}], "answers": [{"comments": [{"owner": {"reputation": 6086, "user_id": 943814, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e8b4b9fc52a3084be9a2de004e0bb6dc?s=128&d=identicon&r=PG", "display_name": "anderspitman", "link": "https://stackoverflow.com/users/943814/anderspitman"}, "edited": false, "score": 0, "creation_date": 1574747485, "post_id": 59044454, "comment_id": 104330700, "body": "As mentioned in my question, sending multiple requests isn&#39;t an option for my system."}], "tags": [], "owner": {"reputation": 1161, "user_id": 6013663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4a7b2e785ad782e5103fd679b9ec849?s=128&d=identicon&r=PG", "display_name": "Masudur Rahman", "link": "https://stackoverflow.com/users/6013663/masudur-rahman"}, "is_accepted": false, "score": 0, "last_activity_date": 1574747295, "last_edit_date": 1574747295, "creation_date": 1574746914, "answer_id": 59044454, "question_id": 59043901, "link": "https://stackoverflow.com/questions/59043901/http-client-post-read-response-before-sending-body/59044454#59044454", "title": "http.Client POST read response before sending body", "body": "<p>You can fulfill your requirements by sending an <code>OPTIONS</code> request to the url before sending actual request and read the response header.</p>\n\n<p>The response header will contain all the necessary headers to perform the preferred request.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>req, _ := http.NewRequest(\"OPTIONS\", \"example.com\", nil)\n\nresp, _ := client.Do(req)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1073, "user_id": 10794806, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GKvpJsipy5o/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hXsT0KoMOXyLso6Ie2mfwllaD7zQ/mo/photo.jpg?sz=128", "display_name": "Gaurav Dhiman", "link": "https://stackoverflow.com/users/10794806/gaurav-dhiman"}, "is_accepted": true, "score": 3, "last_activity_date": 1574753724, "creation_date": 1574753724, "answer_id": 59045857, "question_id": 59043901, "link": "https://stackoverflow.com/questions/59043901/http-client-post-read-response-before-sending-body/59045857#59045857", "title": "http.Client POST read response before sending body", "body": "<p>http client Do function doesn't block until whole response body is returned. if you don't want to read full response, why not just use res.Body.Close() after you have examined headers?. i think it should work if you want roughly same behavior. According to Doc.</p>\n\n<blockquote>\n  <p>The response body is streamed on demand as the Body field is read. If the network \n  connection fails or the server terminates the response, Body.Read calls return an error.</p>\n</blockquote>\n\n<p>Although DefaultTransport of default http.Client which is http.Transport doesn't give you guarantee that it won't read any byte before you specify.</p>\n"}], "owner": {"reputation": 6086, "user_id": 943814, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e8b4b9fc52a3084be9a2de004e0bb6dc?s=128&d=identicon&r=PG", "display_name": "anderspitman", "link": "https://stackoverflow.com/users/943814/anderspitman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 129, "favorite_count": 0, "accepted_answer_id": 59045857, "answer_count": 2, "score": -2, "last_activity_date": 1574753724, "creation_date": 1574743567, "question_id": 59043901, "link": "https://stackoverflow.com/questions/59043901/http-client-post-read-response-before-sending-body", "title": "http.Client POST read response before sending body", "body": "<p>Is there a way to do a <code>client.Do(\"POST\", \"example.com\", body)</code> and read the response headers before the entire response body has been received/closed? This would be similar to how JavaScript XHR requests emit an event that the headers have been received and you can read them before the rest of the request arrives.</p>\n\n<p>What I'm trying to accomplish is making a sort of \"smart client\" that uses information in the headers from my server to determine what to upload in the request body. So I need to start the request, read the response headers, then start writing to the request body. Because of the nature of my system, I can't split it across separate requests. I believe it's possible at the protocol level, but I'm not sure if go's http libraries support it.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1574751331, "post_id": 59043631, "comment_id": 104331953, "body": "This is covered in the official FAQ: <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"reputation": 5512, "user_id": 2770572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5b3d56dfc7342cc2a436cc73515d68f2?s=128&d=identicon&r=PG", "display_name": "michaelsnowden", "link": "https://stackoverflow.com/users/2770572/michaelsnowden"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574801131, "post_id": 59043631, "comment_id": 104357605, "body": "I saw that, but was unsure if it only applied to <code>interface{}</code> slices, or any slice declared with an interface type."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574836248, "post_id": 59043631, "comment_id": 104367188, "body": "interface{} is a totally normal type and follows the same rules like e.g. chan[]int. (Only struct{} has an additional rule.)"}], "answers": [{"comments": [{"owner": {"reputation": 5512, "user_id": 2770572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5b3d56dfc7342cc2a436cc73515d68f2?s=128&d=identicon&r=PG", "display_name": "michaelsnowden", "link": "https://stackoverflow.com/users/2770572/michaelsnowden"}, "edited": false, "score": 1, "creation_date": 1574742246, "post_id": 59043691, "comment_id": 104329317, "body": "I saw that, but was hoping it only applied to <code>interface{}</code>, not any given interface. Ah, what a pain. Thanks for the help!"}], "tags": [], "owner": {"reputation": 153402, "user_id": 1204143, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5ca341b160687d99b1317859f91054ee?s=128&d=identicon&r=PG", "display_name": "nneonneo", "link": "https://stackoverflow.com/users/1204143/nneonneo"}, "is_accepted": true, "score": 4, "last_activity_date": 1574741946, "creation_date": 1574741946, "answer_id": 59043691, "question_id": 59043631, "link": "https://stackoverflow.com/questions/59043631/assign-to-list-of-interfaces-in-go/59043691#59043691", "title": "Assign to list of interfaces in Go", "body": "<p>A slice of interfaces is not an interface - the layout of an interface and the layout of a concrete structure are different. Therefore, you can't assign <code>[]foo</code> to <code>[]Foo</code>.</p>\n\n<p>This is a common enough error that it's even documented on the golang wiki: <a href=\"https://github.com/golang/go/wiki/InterfaceSlice\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/InterfaceSlice</a></p>\n\n<p>If you <em>need</em> a slice of <code>Foo</code> interfaces then you'll have to just make one and assign them in a loop. Example taken from the wiki:</p>\n\n<pre><code>var dataSlice []int = foo()\nvar interfaceSlice []interface{} = make([]interface{}, len(dataSlice))\nfor i, d := range dataSlice {\n    interfaceSlice[i] = d\n}\n</code></pre>\n"}], "owner": {"reputation": 5512, "user_id": 2770572, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/5b3d56dfc7342cc2a436cc73515d68f2?s=128&d=identicon&r=PG", "display_name": "michaelsnowden", "link": "https://stackoverflow.com/users/2770572/michaelsnowden"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 248, "favorite_count": 1, "accepted_answer_id": 59043691, "answer_count": 1, "score": 1, "last_activity_date": 1574741946, "creation_date": 1574741467, "question_id": 59043631, "link": "https://stackoverflow.com/questions/59043631/assign-to-list-of-interfaces-in-go", "title": "Assign to list of interfaces in Go", "body": "<p>I have an interface <code>Foo</code> with a struct <code>foo</code> that implements it. I have an API that accepts a list of <code>Foo</code>s, and I need to pass in my list of <code>foo</code>s, but it doesn't work as expected:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype foo struct {\n}\n\nfunc (f foo) Do() {\n    fmt.Println(\"hi\")\n}\n\ntype Foo interface {\n    Do()\n}\n\nfunc main() {\n    var f foo\n    var F Foo\n    F = f // compiles just fine\n    var fs []foo\n    var Fs []Foo\n    Fs = fs // doesn't compile for some reason\n}\n</code></pre>\n\n<p>I'm sure I'm missing something obvious as I'm very new to Go, but why doesn't this compile?</p>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 2, "creation_date": 1574734098, "post_id": 59042646, "comment_id": 104327542, "body": "uintptr is basically an unsafe pointer to anything, unrelated to uint."}, {"owner": {"reputation": 1245, "user_id": 986696, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7faEG.jpg?s=128&g=1", "display_name": "Alex Jansen", "link": "https://stackoverflow.com/users/986696/alex-jansen"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1574735501, "post_id": 59042646, "comment_id": 104327826, "body": "It seems I forgot about 32-bit code running on 64-bit systems.  In that case *uint would be 4 bytes and uintptr would be 8 bytes.  Indeed, it looks like they&#39;re unrelated."}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 3, "last_activity_date": 1574734215, "creation_date": 1574734215, "answer_id": 59042704, "question_id": 59042646, "link": "https://stackoverflow.com/questions/59042646/whats-the-difference-between-uint-and-uintptr-in-golang/59042704#59042704", "title": "What&#39;s the difference between *uint and uintptr in Golang?", "body": "<p>uintptr is simply an integer representation of a memory address, regardless of the actual type it points to. Sort of like <code>void *</code> in C, or just casting a pointer to an integer. It's purpose is to be used in unsafe black magic, and it is not used in everyday go code. </p>\n"}, {"comments": [{"owner": {"reputation": 394, "user_id": 768671, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/064757ebe75f4440e668f7d3526bdd8b?s=128&d=identicon&r=PG", "display_name": "Basil", "link": "https://stackoverflow.com/users/768671/basil"}, "edited": false, "score": 0, "creation_date": 1603164954, "post_id": 59042710, "comment_id": 113942432, "body": "So in this <a href=\"https://github.com/golang/sys/blob/master/windows/zsyscall_windows.go#L3050\" rel=\"nofollow noreferrer\">example</a>. <code>uintptr(session)</code> it seems like it&#39;s casting a value to a pointer, and the ptr is not <i>actually</i> used as a pointer. Or does uintptr() internally get the pointer of the int?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 394, "user_id": 768671, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/064757ebe75f4440e668f7d3526bdd8b?s=128&d=identicon&r=PG", "display_name": "Basil", "link": "https://stackoverflow.com/users/768671/basil"}, "edited": false, "score": 0, "creation_date": 1603168672, "post_id": 59042710, "comment_id": 113943175, "body": "<code>uintptr</code> is simply an integer large enough to hold a pointer. It is still an int. The syscall will interpret the pointer as a pointer."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 3, "last_activity_date": 1574734237, "creation_date": 1574734237, "answer_id": 59042710, "question_id": 59042646, "link": "https://stackoverflow.com/questions/59042646/whats-the-difference-between-uint-and-uintptr-in-golang/59042710#59042710", "title": "What&#39;s the difference between *uint and uintptr in Golang?", "body": "<p>You are conflating uintptr and *uint. uintptr is used when you're dealing with pointers, it is a datatype that is large enough to hold a pointer. It is mainly used for unsafe memory access, look at the unsafe package. *uint is a pointer to an unsigned integer.</p>\n"}, {"comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 7, "creation_date": 1574741899, "post_id": 59042719, "comment_id": 104329244, "body": "To make this good answer a bit less magical\u2026 \u2014 <code>uintptr</code> may contain any pointer value but \u2014 contrary to <code>unsafe.Pointer</code>s, the GC does not consider <code>uintptr</code>s as live references to the memory blocks they point to. That&#39;s why they cannot be used except in certain narrow controlled cases."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 22, "last_activity_date": 1574797942, "last_edit_date": 1574797942, "creation_date": 1574734295, "answer_id": 59042719, "question_id": 59042646, "link": "https://stackoverflow.com/questions/59042646/whats-the-difference-between-uint-and-uintptr-in-golang/59042719#59042719", "title": "What&#39;s the difference between *uint and uintptr in Golang?", "body": "<p>The short answer is \"never use <code>uintptr</code>\". \ud83d\ude00</p>\n\n<p>The long answer is that <code>uintptr</code> is there to bypass the type system and allow the Go implementors to write Go runtime libraries, including the garbage collection system, in Go, and to call C-callable code including system calls using C pointers that are not handled <em>by</em> Go at all.</p>\n\n<p>If you're acting as an implementor\u2014e.g., providing access to system calls on a new OS\u2014you'll need <code>uintptr</code>.  You will also need to know all the special magic required to use it, such as locking your goroutine to an OS-level thread if the OS is going to do stack-ish things to OS-level threads, for instance.  (If you're using it with Go pointers, you may also need to tell the compiler not to move your goroutine stack, which is done with special compile-time directives.)</p>\n\n<p>Edit: as <a href=\"https://stackoverflow.com/questions/59042646/whats-the-difference-between-uint-and-uintptr-in-golang/59042719?noredirect=1#comment104329244_59042719\">kostix notes in a comment</a>, the runtime system considers an <code>unsafe.Pointer</code> as a reference to an object, which keeps the object alive for GC.  It <em>does not</em> consider a <code>uintptr</code> as such a reference.  (That is, while <code>unsafe.Pointer</code> has a pointer type, <code>uintptr</code> has integer type.)  See also the <a href=\"https://golang.org/pkg/unsafe/\" rel=\"noreferrer\">documentation for the <code>unsafe</code> package</a>.</p>\n"}], "owner": {"reputation": 1245, "user_id": 986696, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/7faEG.jpg?s=128&g=1", "display_name": "Alex Jansen", "link": "https://stackoverflow.com/users/986696/alex-jansen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4075, "favorite_count": 4, "accepted_answer_id": 59042719, "answer_count": 3, "score": 14, "last_activity_date": 1574797942, "creation_date": 1574733754, "question_id": 59042646, "link": "https://stackoverflow.com/questions/59042646/whats-the-difference-between-uint-and-uintptr-in-golang", "title": "What&#39;s the difference between *uint and uintptr in Golang?", "body": "<p>According to the <a href=\"https://tour.golang.org/basics/11\" rel=\"noreferrer\">Golang tour</a>, we're provided with the following integer types:</p>\n\n<pre><code>int  int8  int16  int32  int64\nuint uint8 uint16 uint32 uint64 uintptr\n</code></pre>\n\n<p>In theory, that means we could also have pointers to all of these types as follows:</p>\n\n<pre><code>*int  *int8  *int16  *int32  *int64\n*uint *uint8 *uint16 *uint32 *uint64 *uintptr\n</code></pre>\n\n<p>If this is the case, then we already have a pointer to a uint in the form of *uint.  That would make uintptr redundant.  The <a href=\"https://golang.org/pkg/builtin/#uintptr\" rel=\"noreferrer\">official documentation</a> doesn't shed much light on this:</p>\n\n<pre><code>uintptr is an integer type that is large enough to hold the bit pattern of any pointer.\n</code></pre>\n\n<p>As I understand it, that means that the bit width of a uint is determined at compile time based on the target architecture (typically either 32-bit or 64-bit).  It seems logical that the pointer width should scale to the target architecture as well (IE: a 32-bit *uint points to a 32-bit uint).  Is that the case in Golang?</p>\n\n<p>Another thought was that maybe uintptr was added to make the syntax less confusing when doing multiple indirection (IE: <code>foo *uinptr</code> vs <code>foo **uint</code>)?</p>\n\n<p>My last thought is that perhaps pointers and integers are incompatible data types in Golang.  That would be pretty frustrating since the hardware itself doesn't make any distinction between them.  For instance, a \"branch to this address\" instruction can use the same data from the same register that was just used in an \"add this value\" instruction.</p>\n\n<p>What's the real point (pun intended) of uintptr?</p>\n"}, {"tags": ["http", "go", "pipe", "multipart"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1574732126, "post_id": 59042335, "comment_id": 104327190, "body": "I pasted your code into the playground and it runs as expected.  <a href=\"https://play.golang.org/p/xleHc2DNRki\" rel=\"nofollow noreferrer\">play.golang.org/p/xleHc2DNRki</a>."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1574732566, "post_id": 59042335, "comment_id": 104327274, "body": "Here&#39;s improved version of code: <a href=\"https://play.golang.org/p/c-CovMAK3V9\" rel=\"nofollow noreferrer\">play.golang.org/p/c-CovMAK3V9</a>. Write slice directly to part instead of creating io.Reader and io.Copy.   Return errors."}, {"owner": {"reputation": 377, "user_id": 3284965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f9c9a1902f72e0e858107351d95ea8?s=128&d=identicon&r=PG&f=1", "display_name": "manpatha", "link": "https://stackoverflow.com/users/3284965/manpatha"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1574888913, "post_id": 59042335, "comment_id": 104394010, "body": "Thanks, both solutions worked."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1574889628, "post_id": 59042335, "comment_id": 104394262, "body": "The first is an exact copy of <code>httpreq</code> from the question.  If that works, then what&#39;s the question?"}], "owner": {"reputation": 377, "user_id": 3284965, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92f9c9a1902f72e0e858107351d95ea8?s=128&d=identicon&r=PG&f=1", "display_name": "manpatha", "link": "https://stackoverflow.com/users/3284965/manpatha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 501, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574730863, "creation_date": 1574730863, "question_id": 59042335, "link": "https://stackoverflow.com/questions/59042335/golang-multipart-post-multipart-request-with-io-pipe-failing-to-get-it-right", "title": "Golang: multipart POST multipart request with io.Pipe - failing to get it right", "body": "<p>I am using GO multipart with io to upload a file to a local server and this function fails me every time. <em>(This is just form request part)</em></p>\n\n<pre><code>func httpreq(uri string, params map[string]interface{}, fieldname, filename string, filebuf []byte) (*http.Request, error) {\n    pr, pw := io.Pipe()\n    writer := multipart.NewWriter(pw)\n    go func() {\n        defer pw.Close()\n        r := bytes.NewReader(filebuf)\n\n        part1, err := writer.CreateFormFile(fieldname, filename)\n        if err != nil {\n            return\n        }\n        if _, err = io.Copy(part1, r); err != nil {\n            return\n        }\n        // encode params into Json\n        var j []byte\n        j, err = json.Marshal(params)\n        if err != nil {\n            return\n        }\n        part2, err := writer.CreateFormField(\"json\")\n        if err != nil {\n            return\n        }\n\n        _, err = io.Copy(part2, bytes.NewBuffer(j))\n        if err != nil {\n            return\n        }\n        if err = writer.Close(); err != nil {\n            return\n        }\n    }()\n    req, err := http.NewRequest(\"POST\", uri, pr)\n    if err != nil {\n        return nil, err\n    }\n    req.Header.Set(\"Content-Type\", writer.FormDataContentType())\n    fmt.Printf(\"---&gt; %+v\", req)\n    return req, err\n}\n</code></pre>\n\n<p>I am expecting request something like this</p>\n\n<pre><code>--f82711203f053f26bd2ea538ab381e30ec1468bff784e34174b11bb679dc\nContent-Disposition: form-data; name=\"file\"; filename=\"nov.txt\"\nContent-Type: application/octet-stream\n\n   November 2019\nSu Mo Tu We Th Fr Sa\n                1  2\n 3  4  5  6  7  8  9\n10 11 12 13 14 15 16\n17 18 19 20 21 22 23\n24 25 26 27 28 29 30\n\n\n--f82711203f053f26bd2ea538ab381e30ec1468bff784e34174b11bb679dc\nContent-Disposition: form-data; name=\"json\"\n\n{\"data_profile_id\":\"1\",\"file_sha\":\"12345678\",\"no_cache\":true,\"service_name\":\"test\",\"tenant_id\":\"tenant\"}\n--f82711203f053f26bd2ea538ab381e30ec1468bff784e34174b11bb679dc--\n\n</code></pre>\n\n<p>but I get this</p>\n\n<pre><code>--c3b154dc079686ba162e0ab057c59580932ebab25294569201ef854394a7\nContent-Disposition: form-data; name=\"file\"; filename=\"102.pdf\"\nContent-Type: application/octet-stream\n\n\n--c3b154dc079686ba162e0ab057c59580932ebab25294569201ef854394a7\nContent-Disposition: form-data; name=\"json\"\n</code></pre>\n\n<p>If I move out part </p>\n\n<pre><code>// encode params into Json\n        var j []byte\n        j, err = json.Marshal(params)\n        if err != nil {\n            return\n        }\n        part2, err := writer.CreateFormField(\"json\")\n        if err != nil {\n            return\n        }\n\n        _, err = io.Copy(part2, bytes.NewBuffer(j))\n        if err != nil {\n            return\n        }\n</code></pre>\n\n<p>then it seems to be giving me somewhat close to expectation</p>\n\n<pre><code>--f82711203f053f26bd2ea538ab381e30ec1468bff784e34174b11bb679dc\nContent-Disposition: form-data; name=\"file\"; filename=\"nov.txt\"\nContent-Type: application/octet-stream\n\n   November 2019\nSu Mo Tu We Th Fr Sa\n                1  2\n 3  4  5  6  7  8  9\n10 11 12 13 14 15 16\n17 18 19 20 21 22 23\n24 25 26 27 28 29 30\n\n\n--f82711203f053f26bd2ea538ab381e30ec1468bff784e34174b11bb679dc\n</code></pre>\n\n<p>Any experts here and what am I missing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 1, "creation_date": 1574730076, "post_id": 59042123, "comment_id": 104326779, "body": "&quot;I tried using <code>weekdays() and</code>...&quot; - show us what you tried then and we can suggest improvements..."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1574733720, "last_edit_date": 1574733720, "creation_date": 1574732313, "answer_id": 59042487, "question_id": 59042123, "link": "https://stackoverflow.com/questions/59042123/check-if-time-falls-in-weekends/59042487#59042487", "title": "Check if time falls in weekends", "body": "<blockquote>\n  <p>check if the time falls in weekend time which is from Friday 10pm UTC to Sunday 10:05pm UTC.</p>\n</blockquote>\n\n<hr>\n\n<p>Use the Go <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\"><code>time</code></a>  package.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\n// A weekend is Friday 10pm UTC to Sunday 10:05pm UTC\nfunc isWeekend(t time.Time) bool {\n    t = t.UTC()\n    switch t.Weekday() {\n    case time.Friday:\n        h, _, _ := t.Clock()\n        if h &gt;= 12+10 {\n            return true\n        }\n    case time.Saturday:\n        return true\n    case time.Sunday:\n        h, m, _ := t.Clock()\n        if h &lt; 12+10 {\n            return true\n        }\n        if h == 12+10 &amp;&amp; m &lt;= 5 {\n            return true\n        }\n    }\n    return false\n}\n\nfunc main() {\n    t := time.Date(2019, 11, 22, 12+10, 5, 0, 0, time.UTC)\n    fmt.Println(t)\n    w := isWeekend(t)\n    fmt.Println(w)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/TZBoNcwH-qU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/TZBoNcwH-qU</a></p>\n\n<p>Output:</p>\n\n<pre><code>2019-11-22 22:05:00 +0000 UTC\ntrue\n</code></pre>\n"}], "owner": {"reputation": 401, "user_id": 8002010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c6796fea327cab9ac13e660bf3a9b67b?s=128&d=identicon&r=PG&f=1", "display_name": "rvl007", "link": "https://stackoverflow.com/users/8002010/rvl007"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 545, "favorite_count": 1, "accepted_answer_id": 59042487, "answer_count": 1, "score": -3, "last_activity_date": 1574733720, "creation_date": 1574729087, "question_id": 59042123, "link": "https://stackoverflow.com/questions/59042123/check-if-time-falls-in-weekends", "title": "Check if time falls in weekends", "body": "<p>I have a custom weekend time which is from <code>Friday 10pm UTC</code> to <code>Sunday 10:05pm UTC</code>. I have a current timestamp in UTC and just wanted to check if the time falls in weekend time. Any tricks will be much appreciated. I tried using <code>weekdays() and time</code> but was not able to achieve the desired results.</p>\n"}, {"tags": ["json", "go", "mux"], "answers": [{"tags": [], "owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "is_accepted": true, "score": 1, "last_activity_date": 1574730984, "last_edit_date": 1574730984, "creation_date": 1574730102, "answer_id": 59042257, "question_id": 59042102, "link": "https://stackoverflow.com/questions/59042102/example-json-response-with-golang/59042257#59042257", "title": "Example JSON response with Golang", "body": "<p>There's no value assigned to your \"place\" variable. I suppose you're trying to assign values through the json tags, however this tag is to inform the name of the json property within the json file and not the value of the property.</p>\n\n<p>Adapt your code to the below and it should work</p>\n\n<pre><code>type Place struct {\n  Location string `json:\"location\"`\n  Name string `json:\"name\"`\n  Body string `json:\"body\"`\n}\n\nvar place []Place\n\nfunc search(write http.ResponseWriter, req *http.Request) {\n\n  place = append(place, Place{Location: `123 Houston st`, Name:`Ricks Barber Shop`, Body:`this is the best barber shop in the world`})\n\n   write.Header().Set(\"Content-Type\", \"application/json\")\n   j, err := json.Marshal(&amp;place)\n\n   if err != nil {\n        //Your logic to handle Error\n   }    \n\n   fmt.Fprint(write, string(j)\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yHTcbqjoCjx\" rel=\"nofollow noreferrer\">Working command line program</a>. You can adapt this to your needs.</p>\n\n<p><a href=\"https://play.golang.org/p/yHTcbqjoCjx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/yHTcbqjoCjx</a></p>\n"}], "owner": {"reputation": 1187, "user_id": 9745881, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b98f80f191f7e758bb5ab4a7b5f57e13?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Sam", "link": "https://stackoverflow.com/users/9745881/ryan-sam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 59042257, "answer_count": 1, "score": -1, "last_activity_date": 1574730984, "creation_date": 1574728908, "question_id": 59042102, "link": "https://stackoverflow.com/questions/59042102/example-json-response-with-golang", "title": "Example JSON response with Golang", "body": "<p>I am trying to build an API with golang. To get started I am just trying to send some json data when I visit <a href=\"http://localhost:8085/search\" rel=\"nofollow noreferrer\">http://localhost:8085/search</a> but all I am viewing in the browser is <code>null</code>.</p>\n\n<p>I got this example from a <a href=\"https://medium.com/@hugo.bjarred/rest-api-with-golang-and-mux-e934f581b8b5\" rel=\"nofollow noreferrer\">Medium post</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"encoding/json\"\n    \"github.com/gorilla/mux\"\n)\n\ntype Place struct {\n  Location string `json:\"123 Houston st\"`\n  Name string `json:\"Ricks Barber Shop\"`\n  Body string `json:\"this is the best barber shop in the world\"`\n}\n\nvar place []Place\n\nfunc search(write http.ResponseWriter, req *http.Request) {\n    write.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(write).Encode(place)\n}\n\nfunc main() {\n    router := mux.NewRouter().StrictSlash(true)\n    router.HandleFunc(\"/search\", search).Methods(\"GET\")\n    log.Fatal(http.ListenAndServe(\":8085\", router))\n}\n</code></pre>\n"}, {"tags": ["go", "nested-loops"], "answers": [{"comments": [{"owner": {"reputation": 662, "user_id": 1887912, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cb3aa8025d2e06f2adac3f3a8a6388de?s=128&d=identicon&r=PG", "display_name": "JonB", "link": "https://stackoverflow.com/users/1887912/jonb"}, "edited": false, "score": 0, "creation_date": 1574767174, "post_id": 59042671, "comment_id": 104339894, "body": "How would I go and achieve that using a map?"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 1, "last_activity_date": 1574788471, "last_edit_date": 1574788471, "creation_date": 1574733967, "answer_id": 59042671, "question_id": 59041976, "link": "https://stackoverflow.com/questions/59041976/prettify-ugly-three-nested-for-loop/59042671#59042671", "title": "Prettify ugly three nested for-loop", "body": "<p>Right level of abstraction is what you need:</p>\n\n<pre><code>func has(in string[], item string) bool {\n   for _,x:=range in {\n      if x==item {\n        return true\n      }\n   }\n   return false\n}\nfunc isMeasuredTypeAUsageMetric(measuredTypeIn []string) []string {\n  result:=[]string{}\n  for _,item:=range measuredTypeIn {\n      if has(MeasuredTypes,item) {\n         if has(UsageTypes,item) {\n            result=append(result,item)\n         }\n      } else {\n        ///error\n     }\n  }\n  return result\n}\n</code></pre>\n\n<p>This can be further simplified by using a <code>map[string]bool</code> instead of a []string for the literals. </p>\n\n<pre><code>var MeasuredTypes=map[string]bool{\"itemInUsageTypes\": true,\n\"itemNotInUsageTypes\":false,\n...\n}\n</code></pre>\n\n<p>Then you can do:</p>\n\n<pre><code>usage,measured:=MeasuredTypes[item]\nif measured {\n  // It is measured type\n  if usage {\n     // It is usage type\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 662, "user_id": 1887912, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/cb3aa8025d2e06f2adac3f3a8a6388de?s=128&d=identicon&r=PG", "display_name": "JonB", "link": "https://stackoverflow.com/users/1887912/jonb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 59042671, "answer_count": 1, "score": -2, "last_activity_date": 1574788471, "creation_date": 1574727892, "question_id": 59041976, "link": "https://stackoverflow.com/questions/59041976/prettify-ugly-three-nested-for-loop", "title": "Prettify ugly three nested for-loop", "body": "<p>What would be the most Go way of prettifying this function?\nThis is what I have come up with, kind of does the trick but It's just too ugly, any help on prettifying this would be greatly appreciated.</p>\n\n<p>Also wold love to be able to <code>negate</code> this functions as well if possible.\nCould I not utilise the use of function literals, maps etc.</p>\n\n<pre><code>var UsageTypes = []string{\n\"PHYSICAL_SIZE\",\n\"PHYSICAL_SIZE\",\n\"PROVISIONED_SIZE\",\n\"SNAPSHOT_SIZE\",\n\"LOGICAL_SIZE_PERCENTAGE\",\n\"TOTAL_VOLUME_SIZE\",\n\"ALLOCATED_SIZE\",\n\"ALLOCATED_USED\",\n\"TOTAL_LOGICAL_SIZE\",\n\"TOTAL_LOGICAL_SIZE_PERCENTAGE\",\n\"TOTAL_SNAPSHOT_SIZE\",\n\"LOGICAL_OR_ALLOCATED_GREATER_SIZE\",\n}\n\nvar MeasuredTypes = []string{\n\"LIF_RECEIVED_DATA\",\n\"ECEIVED_ERRORS\",\n\"LIF_RECEIVED_PACKET\",\n\"LIF_SENT_DATA\",\n\"LIF_SENT_ERRORS\",\n\"LIF_SENT_PACKET\",\n\"LINK_CURRENT_STATE\",\n\"RX_BYTES\",\n\"RX_DISCARDS\",\n\"RX_CRC_ERRORS\",\n\"RX_ERRORS\",\n\"RX_FRAMES\",\n\"LINK_UP_TO_DOWNS\",\n\"TX_BYTES\",\n\"TX_DISCARDS\",\n\"TX_ERRORS\",\n\"TX_HW_ERRORS\",\n\"TX_FRAMES\",\n\"LOGICAL_OR_ALLOCATED_GREATER_SIZE\",\n\"LOGICAL_SIZE\",\n\"PHYSICAL_SIZE\",\n\"PROVISIONED_SIZE\",\n\"SNAPSHOT_SIZE\",\n\"VOLUME_ONLINE\",\n\"TOTAL_THROUGHPUT\",\n\"LOGICAL_SIZE_PERCENTAGE\",\n\"READ_THROUGHPUT\",\n\"WRITE_THROUGHPUT\",\n\"OTHER_THROUGHPUT\",\n\"TOTAL_IOPS\",\n\"WRITE_IOPS\",\n\"READ_IOPS\",\n\"OTHER_IOPS\",\n\"AVERAGE_TOTAL_LATENCY\",\n\"AVERAGE_WRITE_LATENCY\",\n\"AVERAGE_READ_LATENCY\",\n\"AVERAGE_OTHER_LATENCY\",\n\"FILESYSTEM_READ_OPS\",\n\"FILESYSTEM_WRITE_OPS\",\n\"FILESYSTEM_TOTAL_OPS\",\n\"FILESYSTEM_OTHER_OPS\",\n\"IO_BYTES_PER_READ_OPS\",\n\"IO_BYTES_PER_WRITE_OPS\",\n\"IO_BYTES_PER_OTHER_OPS\",\n\"IO_BYTES_PER_TOTAL_OPS\",\n\"READ_IO\",\n\"WRITE_IO\",\n\"TOTAL_IO\",\n\"OTHER_IO\",\n\"ACTIVE_CONNECTIONS\",\n\"TOTAL_VOLUME_SIZE\",\n\"ALLOCATED_SIZE\",\n\"ALLOCATED_USED\",\n\"TOTAL_LOGICAL_SIZE\",\n\"TOTAL_LOGICAL_SIZE_PERCENTAGE\",\n\"TOTAL_SNAPSHOT_SIZE\",\n\"ONTAP_CAPACITY_DISK_CAPACITY\",\n\"ONTAP_CAPACITY_TOTAL_STORAGE_EFFICIENCY_RATIO\",\n\"ONTAP_CAPACITY_TOTAL_PHYSICAL_USED\",\n\"ONTAP_CAPACITY_SIZE_USED\",\n\"ONTAP_CAPACITY_MEMORY\",\n\"ONTAP_CAPACITY_AVERAGE_PROCESSOR_BUSY\",\n\"ONTAP_CAPACITY_PEAK_PROCESSOR_BUSY\",\n}\n\nfunc isMeasuredTypeAUsageMetric(measuredTypeIn []string) []string {\n  result := []string{}\n  for i, _ := range measuredTypeIn {\n    var foundInBigList bool\n      for j, _ := range MeasuredTypes {\n        if measuredTypeIn[i] == MeasuredTypes[j] {\n          foundInBigList = true\n          fmt.Println(\"found in big list: \", measuredTypeIn[i])\n          for k, _ := range UsageTypes {\n            if measuredTypeIn[i] == UsageTypes[k] {\n              fmt.Println(\"found in inner list: \", measuredTypeIn[i])\n              result = append(result, measuredTypeIn[i])\n            }\n          }\n        }\n      }\n      if foundInBigList == false {\n        fmt.Println(\"not found, throw exception\")\n      }\n    }\n    return result\n  }\n\nfunc main() {\n  measuredTypeIn := []string{\"LOGICAL_SIZE_PERCENTAGE\", \"LOGICAL_OR_ALLOCATED_GREATER_SIZE\", \"BUKK\", \"ONTAP_CAPACITY_PEAK_PROCESSOR_BUSY\",}\n  fmt.Println(isMeasuredTypeAUsageMetric(measuredTypeIn))\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 0, "creation_date": 1574768599, "post_id": 59042488, "comment_id": 104340543, "body": "Thank you very much. The understanding of values and addresses (actually hexadecimal &quot;values&quot;) allocated in memory has been deepened.  The detailed diagram was very helpful for my understanding."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 0, "creation_date": 1574785418, "post_id": 59042488, "comment_id": 104350224, "body": "Note, by the way, that in the past, and maybe someday again in the future, some computers don&#39;t use simple linearly-addressed memory. Go should be able to run on such systems, but there, <code>%p</code> might print <i>two</i> hexadecimal numbers, or something (that&#39;s what C runtime systems did with segmented memory on 80286 machines)."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 7, "last_activity_date": 1574732317, "creation_date": 1574732317, "answer_id": 59042488, "question_id": 59041891, "link": "https://stackoverflow.com/questions/59041891/in-go-is-a-structure-pointer-not-a-reference-type/59042488#59042488", "title": "In Go, is a structure pointer not a reference type?", "body": "<p><code>pnum</code>, in <code>main</code>, is an actual variable: a box, floating in memory, containing a pointer of type <code>*Num</code>.</p>\n\n<pre><code> 0x40c138\n+--------+\n|    *---|---&gt;\n+--------+\n</code></pre>\n\n<p>To what does <code>pnum</code> point?  Well, <code>Num{i: 3}</code> created an unnamed variable, floating in memory somewhere.  We haven't printed it.  I <a href=\"https://play.golang.org/p/nO1FjtFpMs0\" rel=\"noreferrer\">modified your Playground example to add one more <code>fmt.Printf</code> call</a> to find out:</p>\n\n<pre><code>main type [**main.Num] : 0x40c138\npnum points to [*main.Num] : 0x40e020\n</code></pre>\n\n<p>or:</p>\n\n<pre><code> 0x40c138       0x40e020\n+--------+     +--------+\n|    *---|---&gt; |  i: 3  |\n+--------+     +--------+\n</code></pre>\n\n<p>Now let's move on: <code>main</code> calls <code>pointer</code>, passing to it the <em>value</em> stored in <code>pnum</code>\u2014the <code>0x40c138</code> value which lets the computer find the box holding the unnamed instance holding <code>i=3</code>.  This value is stored in memory somewhere.  Where is that somewhere?  Why, it's the number you printed, because you print <code>&amp;ip</code>.  Fortunately the Playground is very deterministic, so it's also the one I printed:</p>\n\n<pre><code>pointer type [**main.Num] : 0x40c148\n</code></pre>\n\n<p>So we can add another box to our drawing:</p>\n\n<pre><code> 0x40c138       0x40e020\n+--------+     +--------+\n|0x40e020|---&gt; |  i: 3  |\n+--------+     +--------+\n                   ^\n 0x40c148          |\n+--------+         |\n|0x40e020|---------+\n+--------+\n</code></pre>\n\n<p>Now <code>pointer</code> returns, discarding the box at <code>0x40c148</code> that holds <code>0x40e020</code>, and you call <code>pointerpointer</code>, passing <code>&amp;pnum</code> as a value.  Function <code>pointerpointer</code> now runs with a box at some location.  Where is that location?  We don't know; we never print it.  We do print what's <em>in</em> the box at that location, and what's <em>in</em> the box is <code>0x40c138</code>:</p>\n\n<pre><code> 0x40c138       0x40e020\n+--------+     +--------+\n|0x40e020|---&gt; |  i: 3  |\n+--------+     +--------+\n    ^\n    |\n ????????\n+--------+\n|0x40c138|\n+--------+\n</code></pre>\n\n<p>We can <a href=\"https://play.golang.org/p/mxETZ2TrCUp\" rel=\"noreferrer\">add one more <code>fmt.Printf</code> to the program to find where this last box actually is in memory</a> and run again:</p>\n\n<pre><code>pointerpointer's &amp;ip is [***main.Num] : 0x40c150\n</code></pre>\n\n<p>so replace the eight question marks  with <code>0x40c150</code>.</p>\n\n<p>The overall rule here is simple enough: <em>Every variable has some existence somewhere, unless the compiler can optimize it away.</em>  Taking the <em>address</em> of the variable, with <code>&amp;x</code>, tends to prevent the compiler from optimizing the variable itself away.  The <em>type</em> of <code>&amp;x</code> is <code>pointer to ___</code> where the blank is the type of <code>x</code>.  The <em>value</em> of <code>&amp;x</code> is the address of the variable.</p>\n\n<p>In this case, you</p>\n\n<ul>\n<li>made an anonymous (unnamed) <code>Num</code> instance,</li>\n<li>took its address (forcing the compiler to put it into memory somewhere), and </li>\n<li>set a variable <code>pnum</code> to that value</li>\n</ul>\n\n<p>(all in the first line of <code>main</code>).  Then you took the address of <code>pnum</code> itself, which means <code>pnum</code> also has to live somewhere in memory.  Those are the two boxes we drew initially.  You printed that address's type and value on your second line.</p>\n\n<p>You then passed the value stored in <code>pnum</code> to <code>func pointer</code>, which stored the value in a variable.  So that created another, separate variable, which has its own address.</p>\n\n<p>Without worrying about what function <code>pointer</code> did, you then passed the <em>address</em> of <code>pnum</code> to <code>func pointerpointer</code>.  This address is a value, and <code>pointerpointer</code> stored that value in a variable.  This, too, created another separate variable.</p>\n\n<p>Throughout all of this, the address of the anonymous <code>Num</code> with <code>i=3</code> never moved.  Neither did the address of <code>pnum</code> itself.</p>\n"}, {"tags": [], "owner": {"reputation": 530, "user_id": 10753492, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vpFmr9vacTw/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jiHeIG7f13oRVc9pqOOOdXPCY9Gg/mo/photo.jpg?sz=128", "display_name": "user10753492", "link": "https://stackoverflow.com/users/10753492/user10753492"}, "is_accepted": false, "score": 4, "last_activity_date": 1574743678, "creation_date": 1574743678, "answer_id": 59043917, "question_id": 59041891, "link": "https://stackoverflow.com/questions/59041891/in-go-is-a-structure-pointer-not-a-reference-type/59043917#59043917", "title": "In Go, is a structure pointer not a reference type?", "body": "<p>The short answer is:</p>\n\n<p>Pointers are passed by Value.</p>\n\n<p>The function <code>pointer</code> receives a copy of the memory address. It stores that copy somewhere (possibly its own stack, or something).</p>\n\n<p>The memory address is just a number.</p>\n\n<p>If you define a number in <code>main</code> and take its address, and then you pass that number to another function and take <em>its</em> address, should you expect both addresses to be the same?</p>\n"}, {"comments": [{"owner": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 0, "creation_date": 1574770281, "post_id": 59045427, "comment_id": 104341448, "body": "I understand that memory addresses are just values. It would be helpful if you could tell me more about what reference <i>semantics</i> mean. Now, I think reference <i>semantics</i> and reference type as the same.  The following is an example implementation where slice is a reference type.  <a href=\"https://play.golang.org/p/t0hC2563Ucz\" rel=\"nofollow noreferrer\">play.golang.org/p/t0hC2563Ucz</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 1, "creation_date": 1574770789, "post_id": 59045427, "comment_id": 104341706, "body": "@TsujiDaishiro A slice is a view into an array. The view itself is a value: If you pass a slice of length 5 into a function and the function shortens its copy of the slice to length 3 the calling function still has a slice of length 5: The slice as view itself is a value and is copied. You can access the elements of the underlying array through a slice and this is where slices show reference semantic: The individual elements of a slice (not the slice itself) might be shared and thus behave reference-like."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 1, "creation_date": 1574770999, "post_id": 59045427, "comment_id": 104341811, "body": "@TsujiDaishiro In your example both slices (the one in main and the copy in pow) are distinct value like slices but they both reference the same elements of the backing array. When you do <code>a[i] = a[i]*a[i]</code> you do not do anything to the slice itself, you manipulate elements of the backing array. The backing array is shared between main and pow. Thats why slices have &quot;reference semantic&quot; as the main reason to use a slice is to access the shared/referenced elements of the backing array."}, {"owner": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "edited": false, "score": 0, "creation_date": 1574771964, "post_id": 59045427, "comment_id": 104342343, "body": "I understand the concept that slice is a reference to an array. It was very helpful because I wasn&#39;t very conscious of it. I would like to deepen my understanding of detailed behavior while writing code. Thank you."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1574751802, "creation_date": 1574751802, "answer_id": 59045427, "question_id": 59041891, "link": "https://stackoverflow.com/questions/59041891/in-go-is-a-structure-pointer-not-a-reference-type/59045427#59045427", "title": "In Go, is a structure pointer not a reference type?", "body": "<blockquote>\n  <p>In Go, is a structure pointer not a reference type?</p>\n</blockquote>\n\n<p>No, simply because there <strong>are</strong> <strong>no</strong> <strong>reference</strong> <strong>types</strong> in Go.</p>\n\n<p>There are a few types with reference <em>semantics</em>, slices being the most prominent example, but even a slice is a value type and not a reference type.</p>\n\n<p>Pointers in Go a plain values and really machine level addresses. When you pass around a memory address there is no \"reference stuff\" going on. And if you store the memory address in a variable you can take the address of that variable. Again nothing referency-like. It's values all the way down in Go.</p>\n\n<p>It is basically like in C.</p>\n"}], "owner": {"reputation": 125, "user_id": 11681240, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mqEAqxQZJ-g/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_z-wA_s-nPd8S2wrm6btkpo4Xw/mo/photo.jpg?sz=128", "display_name": "Tsuji Daishiro", "link": "https://stackoverflow.com/users/11681240/tsuji-daishiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 350, "favorite_count": 0, "accepted_answer_id": 59042488, "answer_count": 3, "score": 0, "last_activity_date": 1574751802, "creation_date": 1574727070, "question_id": 59041891, "link": "https://stackoverflow.com/questions/59041891/in-go-is-a-structure-pointer-not-a-reference-type", "title": "In Go, is a structure pointer not a reference type?", "body": "<p>I don't understand the behavior of Go variables. I want you to tell me. See the example implementation below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc pointer(ip *Num) {\n    fmt.Printf(\"pointer type [%T] : %p\\n\", &amp;ip, &amp;ip)\n}\n\nfunc pointerpointer(ip **Num) {\n    fmt.Printf(\"pointerpointer type [%T] : %p\\n\", ip, ip)\n}\n\nfunc main() {\n    pnum := &amp;Num{i: 3}\n    fmt.Printf(\"main type [%T] : %p\\n\", &amp;pnum, &amp;pnum)\n    pointer(pnum)\n    pointerpointer(&amp;pnum)\n}\n\ntype Num struct {\n    i int\n}\n\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/LxDAgopxeh0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/LxDAgopxeh0</a></p>\n\n<ul>\n<li>result</li>\n</ul>\n\n<pre><code>main type [**main.Num] : 0x40c138\npointer type [**main.Num] : 0x40c148\npointerpointer type [**main.Num] : 0x40c138\n</code></pre>\n\n<p>I store the struct Num pointer as a variable [pnum]. The address that can be acquired when this is passed to the pointer function is different from the address that can be acquired in the main function. Why??</p>\n\n<p>It has been confirmed that the same address as the main function can be obtained by referring to the pointer pointer as the pointerpointer function.</p>\n"}, {"tags": ["go", "constructor"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1574717766, "post_id": 59040392, "comment_id": 104323404, "body": "&quot;accept interfaces, return structs&quot; isn&#39;t rule. It&#39;s a guideline. It should be violated sometimes. We always return <code>error</code> interfaces, not their concrete types, for example."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1574717768, "post_id": 59040392, "comment_id": 104323406, "body": "A constructor can return a concretion because its whole job is to return an instance of a particular type. It could still be used by a consumer that expects an interface and stored in an interface variable or passed in an interface parameter."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1574718236, "post_id": 59040392, "comment_id": 104323572, "body": "Where Effective Go is referring to returning interfaces is in the very specific context of that section - &quot;If a type exists only to implement an interface and will never have exported methods beyond that interface, there is no need to export the type itself. Exporting just the interface makes it clear the value has no interesting behavior beyond what is described in the interface.&quot; i.e. this is <i>specifically for constructors of unexported types</i>."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574751987, "post_id": 59040392, "comment_id": 104332207, "body": "In almost all cases a constructor constructs a non-interface type. The case you seem to think about is rare. IN Go you <i>start</i> with &quot;real&quot; (i.e. non-interface types) and introduce interfaces if needed."}], "answers": [{"tags": [], "owner": {"reputation": 1073, "user_id": 10794806, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-GKvpJsipy5o/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-hXsT0KoMOXyLso6Ie2mfwllaD7zQ/mo/photo.jpg?sz=128", "display_name": "Gaurav Dhiman", "link": "https://stackoverflow.com/users/10794806/gaurav-dhiman"}, "is_accepted": false, "score": 0, "last_activity_date": 1591384269, "last_edit_date": 1591384269, "creation_date": 1574761809, "answer_id": 59048061, "question_id": 59040392, "link": "https://stackoverflow.com/questions/59040392/how-to-write-idiomatic-constructor/59048061#59048061", "title": "How to write idiomatic constructor", "body": "<p>In most cases constructor functions return concrete types (or pointer to a type).\nThe situations in which returning interfaces might be a good idea is when calling factory functions or builder functions in which underlying concrete type satisfies that interface.</p>\n\n<p>Consider <code>error</code> interface for example, when you call <code>http.NewRequest</code> underlying concentrate error type can be of <code>net.Error</code>, <code>net.DNSError</code> etc. Now try to think how are you going to create an api like this without an <code>error</code> interface if function returns concrete type? Only solution to it I can think of is to create a massive error type for <code>net</code> package and add fields for extra information, but its most probably more harder to maintain, test that kind of error type and not to mention memory bloat.</p>\n\n<p>Whether you choose to return concrete type or an interface is a design choice, some guidelines exists to give solution to common scenarios.</p>\n"}, {"comments": [{"owner": {"reputation": 53, "user_id": 10651854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66a317565cd0dff9e149e448c0b8a424?s=128&d=identicon&r=PG&f=1", "display_name": "Bugsy", "link": "https://stackoverflow.com/users/10651854/bugsy"}, "edited": false, "score": 0, "creation_date": 1574802947, "post_id": 59054553, "comment_id": 104358341, "body": "Yes, now that you mention it I realize that error is a good example of when to return an interface."}, {"owner": {"reputation": 53, "user_id": 10651854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66a317565cd0dff9e149e448c0b8a424?s=128&d=identicon&r=PG&f=1", "display_name": "Bugsy", "link": "https://stackoverflow.com/users/10651854/bugsy"}, "edited": false, "score": 0, "creation_date": 1574803635, "post_id": 59054553, "comment_id": 104358626, "body": "Maybe my experience of interfaces is too limited so far. The main reason (if not the only) for why I&#39;ve defined interfaces is to be able to mock in a convenient way. In those cases the concrete type will not provide any more methods than the interface, so I haven&#39;t faced any problems with constructors which return interfaces (except that I&#39;m not happy about the feeling that I probably do it the wrong way)."}], "tags": [], "owner": {"reputation": 4589, "user_id": 5612096, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51821186ffde540f4d10b86544ca1a7d?s=128&d=identicon&r=PG", "display_name": "Adirio", "link": "https://stackoverflow.com/users/5612096/adirio"}, "is_accepted": true, "score": 1, "last_activity_date": 1574783501, "last_edit_date": 1574783501, "creation_date": 1574783103, "answer_id": 59054553, "question_id": 59040392, "link": "https://stackoverflow.com/questions/59040392/how-to-write-idiomatic-constructor/59054553#59054553", "title": "How to write idiomatic constructor", "body": "<p>As it has already been mentioned, returning an interface should be considered something exceptional.</p>\n\n<p>Returning errors of type <code>error</code> which is an interface is one of those exception.</p>\n\n<p>Returning an interface that represents an unexported type is the other exception. But why would you have an exported interface that describes an unexported struct instead of just having an exported struct?</p>\n\n<p>The reason is simple, that allows you a higher degree of control on how that struct is constructed.</p>\n\n<p>Compare this two pieces of code:</p>\n\n<pre><code>type MyType struct {\n    MyField string\n}\n\nfunc NewMyType(value string) MyType {\n    return MyType{value}\n}\n\nfunc (t MyType) MyMethod() string {\n    return t.MyField\n}\n</code></pre>\n\n<pre><code>type MyType interface {\n    MyMethod() string\n}\n\ntype myType struct {\n    MyField string\n}\n\nfunc NewMyType(value string) MyType {\n    return myType{value}\n}\n\nfunc (t myType) MyMethod() string {\n    return t.MyField\n}\n</code></pre>\n\n<p>In the first case I would be able to do: <code>myVar := MyType{}</code> while in the second case I won't be able to do so, I am forced to use the provided constructor. The first case also allows to modify the field value after creation which is not allowed in the second case. Making the field unexported will solve the second part but not the first.</p>\n\n<p>This example is obviously trivial, but being able to construct invalid structs may have a horrible impact. By having specific constructors you can ensure that the object is in a valid starting state and you will only need to make sure it always stays in a valid state. If you can't ensure that, you may need to check that it is in a valid state at the start of every method.</p>\n\n<p>For example consider a DB request. It needs a DB connection. If the user is able to create a DB request without a DB connection you will have to check that it is valid in every method. If you enforce him to use a constructor you can check at creation time and done.</p>\n"}], "owner": {"reputation": 53, "user_id": 10651854, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66a317565cd0dff9e149e448c0b8a424?s=128&d=identicon&r=PG&f=1", "display_name": "Bugsy", "link": "https://stackoverflow.com/users/10651854/bugsy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 0, "accepted_answer_id": 59054553, "answer_count": 2, "score": 2, "last_activity_date": 1591384269, "creation_date": 1574717501, "last_edit_date": 1574717744, "question_id": 59040392, "link": "https://stackoverflow.com/questions/59040392/how-to-write-idiomatic-constructor", "title": "How to write idiomatic constructor", "body": "<p>I'm confused about the constructors in Go. Most constructors I've seen return a struct, but 'Effective Go' suggests that an interface can be returned in some cases, according to the <a href=\"https://golang.org/doc/effective_go.html#generality\" rel=\"nofollow noreferrer\">rule of 'Generality'</a>.</p>\n\n<p>I trust 'Effective Go' to provide good ideas, but this doesn't seem to follow the principle of 'accept interfaces, return structs'. I guess that many types implement an interface and nothing more than that, so in that case it would be common to see constructors which return interfaces.</p>\n\n<p>Another related statement is that interfaces should be defined by the consumer, but 'Generality' means that the interface is defined by the producer.</p>\n\n<p>Can someone clarify?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 4, "creation_date": 1574716626, "post_id": 59040172, "comment_id": 104323011, "body": "This might be more appropriate for <a href=\"https://codereview.stackexchange.com/\">CodeReview</a>, since the code is already working."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574716696, "post_id": 59040172, "comment_id": 104323034, "body": "Also there&#39;s already an InfluxDB Go client - it&#39;s the top-tier client as InfluxDB itself is written in Go."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574716784, "post_id": 59040172, "comment_id": 104323059, "body": "You can get a <b>very slight</b> memory usage improvement (and more important, more readable code) by using <code>struct{}</code> in place of <code>bool</code> in your map keys. See <a href=\"https://stackoverflow.com/a/22770744/13860\">here</a>."}, {"owner": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574717052, "post_id": 59040172, "comment_id": 104323159, "body": "@Flimzy in regards to your comment on <code>&quot;\\\\&quot;</code>, the first backslash is an escape for the second. The compiler throws a syntax error without it."}, {"owner": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574717506, "post_id": 59040172, "comment_id": 104323308, "body": "@Flimzy and mkopriva +1 for backticks"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1574720573, "post_id": 59040172, "comment_id": 104324364, "body": "before worrying about performance, worry about correctness. then consider you are 1/ allocating 2/ converting. if you want something, like this, to be as performant as possible, you, simply, must execute as few ops as possible."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574717367, "post_id": 59040283, "comment_id": 104323265, "body": "But is it more efficient? (Of course, a benchmark is the only way to know)"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1574717538, "post_id": 59040283, "comment_id": 104323317, "body": "It will be <i>non</i>-equivalent if the input string is not valid UTF-8. The <code>range</code> loop will change &quot;bad&quot; input bytes to the invalid rune. It&#39;s not clear whether this should be considered a feature. :-)"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1574717555, "post_id": 59040283, "comment_id": 104323322, "body": "True. If speed is concern, IndexRune can be replaced with an if statement, but using a buffer should be more efficient in general."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "edited": false, "score": 1, "creation_date": 1574717584, "post_id": 59040283, "comment_id": 104323332, "body": "@Geuis that&#39;s subjective."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574717693, "post_id": 59040283, "comment_id": 104323375, "body": "@torek the original algorithm is broken if the input has multibyte characters."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574717736, "post_id": 59040283, "comment_id": 104323393, "body": "@BurakSerdar: we can&#39;t know that for sure (well, not without knowing what this other InfluxDB stuff is). See my answer (which technically should be a comment, and which I&#39;m still writing)."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1574718205, "last_edit_date": 1574718205, "creation_date": 1574716900, "answer_id": 59040283, "question_id": 59040172, "link": "https://stackoverflow.com/questions/59040172/is-there-a-more-efficient-way-to-handle-string-escaping-in-this-function/59040283#59040283", "title": "Is there a more efficient way to handle string escaping in this function?", "body": "<p>This should be somewhat equivalent to your code:</p>\n\n<pre><code>out := bytes.Buffer{}\nfor _, x := range str {\n  if strings.IndexRune(`\\\",= `, x)!=-1 {\n     out.WriteRune('\\\\')\n  }\n  out.WriteRune(x)\n}\nreturn out.String()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "edited": false, "score": 0, "creation_date": 1574722930, "post_id": 59040582, "comment_id": 104325057, "body": "Following up on this, I&#39;ve spent the last hour or so digging into the encoding problem some more. Is there a relatively straightforward way to always force-encode a string to utf8? Have been looking at this <a href=\"https://godoc.org/golang.org/x/text/encoding\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/text/encoding</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "edited": false, "score": 1, "creation_date": 1574724278, "post_id": 59040582, "comment_id": 104325401, "body": "I don&#39;t know what&#39;s actually <i>good</i>, but having just glanced over the doc at your link, that looks like a sensible approach. It&#39;s similar to what Python3 does with codecs."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 4, "last_activity_date": 1574718432, "creation_date": 1574718432, "answer_id": 59040582, "question_id": 59040172, "link": "https://stackoverflow.com/questions/59040172/is-there-a-more-efficient-way-to-handle-string-escaping-in-this-function/59040582#59040582", "title": "Is there a more efficient way to handle string escaping in this function?", "body": "<p>This should be a comment, but it needs too much room for that.</p>\n\n<p>One more thing to consider\u2014which I mentioned in <a href=\"https://stackoverflow.com/a/59040283/1256452\">a comment on Burak Serdar's answer</a>\u2014is what happens when your input string is not valid UTF-8.</p>\n\n<p>Remember that a Go string is a <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\"><em>byte sequence</em></a>.  It need not be valid Unicode.  It <em>may</em> be intended to <em>represent</em> valid Unicode, or it may not.  For instance, it could be ISO-Latin-1 or something else that might not play well with UTF-8.</p>\n\n<p>If it <em>is</em> non-UTF-8, using a <code>range</code> loop on it will translate each invalid sequence to the invalid rune.  (See the linked Go blog post.)  If it is <em>intended</em> to be valid UTF-8, this may be a plus, and of course, you can check for the resulting <a href=\"https://golang.org/pkg/unicode/utf8/\" rel=\"nofollow noreferrer\"><code>RuneError</code></a>.</p>\n\n<p>Your original loop leaves characters above ASCII DEL (127 or 0x7f) alone.  If the bytes in the string <em>are</em> something like ISO-Latin-1, this may be the correct behavior.  If not, you may be passing invalid, un-sanitized input to this other program.  If you are deliberately sanitizing input, you must find out what kind of input it expects, and do a complete job of sanitizing input.</p>\n\n<p>(I still have scars from being forced to cope with a really poor XML encoder coupled to an old database from some number of jobs ago, so I tend to be extra-cautious here.)</p>\n"}], "owner": {"reputation": 37219, "user_id": 68788, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/caeb7da8621bccbfdb00a166ec6c46bb?s=128&d=identicon&r=PG", "display_name": "Geuis", "link": "https://stackoverflow.com/users/68788/geuis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 59040582, "answer_count": 2, "score": 1, "last_activity_date": 1574718432, "creation_date": 1574716323, "last_edit_date": 1574716572, "question_id": 59040172, "link": "https://stackoverflow.com/questions/59040172/is-there-a-more-efficient-way-to-handle-string-escaping-in-this-function", "title": "Is there a more efficient way to handle string escaping in this function?", "body": "<p>I'm migrating some existing code from another language. In the following function it's more or less a 1-1 migration, but given the newness of the language to me I'd like to know if there's better / more efficient ways to handle how the escaped string gets built:</p>\n\n<pre><code>func influxEscape(str string) string {\n    var chars = map[string]bool{\n        \"\\\\\": true,\n        \"\\\"\": true,\n        \",\":  true,\n        \"=\":  true,\n        \" \":  true,\n    }\n\n    var escapeStr = \"\"\n\n    for i := 0; i &lt; len(str); i++ {\n        var char = string(str[i])\n\n        if chars[char] == true {\n            escapeStr += \"\\\\\" + char\n        } else {\n            escapeStr += char\n        }\n    }\n\n    return escapeStr\n}\n</code></pre>\n\n<p>This code performs escaping to make string values compatible with the InfluxDB line protocol.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1574718575, "post_id": 59040161, "comment_id": 104323690, "body": "But a note to the OP: what problem are you actually trying to solve? There&#39;s probably a different solution. This looks like an XY Problem (I made the same comment on the possible duplicate)"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1574721430, "post_id": 59040161, "comment_id": 104324630, "body": "It&#39;s impossible to write <code>MagicFunc</code> as specified, even when using the unsafe package and making assumptions about memory layout, interfaces and method values.  It might be possible to a function that works like this: <code>var f Foo; MagicFunc(val, &amp;f)</code>, but it will be fragile.  What is the higher-level problem you are trying to solve?"}, {"owner": {"reputation": 116, "user_id": 410369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca6fcd330b863a28faf9bf08931f3ee?s=128&d=identicon&r=PG", "display_name": "Zubin", "link": "https://stackoverflow.com/users/410369/zubin"}, "edited": false, "score": 0, "creation_date": 1574729427, "post_id": 59040161, "comment_id": 104326643, "body": "Thanks for the comments. This is pretty close to the problem I was trying to solve. I was looking to create a mock/assertion framework that could assert method calls on mock objects via method values (instead of e.g. using strings with the method name). This explains why nobody&#39;s done it this way before :) If you have any ideas around this I&#39;m open to it, though."}], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 3, "last_activity_date": 1574719141, "creation_date": 1574719141, "answer_id": 59040709, "question_id": 59040161, "link": "https://stackoverflow.com/questions/59040161/given-a-method-value-get-receiver-object/59040709#59040709", "title": "Given a method value, get receiver object", "body": "<p>No, it is not possible to get the method's receiver instance.</p>\n\n<p>The most you can get is the receiver's type if you use a <em>method expression</em> instead of <em>method value</em> but that won't help you get the <code>my info</code> string.</p>\n"}, {"tags": [], "owner": {"reputation": 6235, "user_id": 622060, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/59aeda6ad8dea5965841953391441d7d?s=128&d=identicon&r=PG", "display_name": "Per Johansson", "link": "https://stackoverflow.com/users/622060/per-johansson"}, "is_accepted": false, "score": 2, "last_activity_date": 1606249352, "creation_date": 1606249352, "answer_id": 64994254, "question_id": 59040161, "link": "https://stackoverflow.com/questions/59040161/given-a-method-value-get-receiver-object/64994254#64994254", "title": "Given a method value, get receiver object", "body": "<p>I wanted to deep-dive into this a bit and soon found this document: <a href=\"https://golang.org/s/go11func\" rel=\"nofollow noreferrer\">https://golang.org/s/go11func</a></p>\n<p>As describe there, when <code>MyFunc</code> is entered <code>val</code> doesn't contain a reference to f.Bar but rather to a special function with the signature <code>func() string</code>. That function knows that it can retrieve the orignal f pointer by checking the well-known <code>R0</code> register (in the example. On amd64 it appears to be <code>dx</code>, but that's an implementation detail obviously).</p>\n<p>Thus there's no way to do this without using implementation specific assembly code, which would be very fragile.</p>\n"}], "owner": {"reputation": 116, "user_id": 410369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ca6fcd330b863a28faf9bf08931f3ee?s=128&d=identicon&r=PG", "display_name": "Zubin", "link": "https://stackoverflow.com/users/410369/zubin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 59040709, "answer_count": 2, "score": 0, "last_activity_date": 1606249352, "creation_date": 1574716263, "last_edit_date": 1574718242, "question_id": 59040161, "link": "https://stackoverflow.com/questions/59040161/given-a-method-value-get-receiver-object", "title": "Given a method value, get receiver object", "body": "<p>Is there a way in Go, to get the receiver object from a method value?</p>\n\n<p>For example, is there any such <code>MagicFunc</code> that would make the following program output the string <code>my info</code> from the underlying Foo instance.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct {\n    A string\n}\n\nfunc (foo *Foo) Bar() string {\n    return \"bar\"\n}\n\nfunc MyFunc(val interface{}) {\n    i := MagicFunc(val)\n    f := i.(Foo)\n    fmt.Println(f.A)\n}\n\nfunc main() {\n    f := Foo{A: \"my info\"}\n    MyFunc(f.Bar)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574716926, "post_id": 59039834, "comment_id": 104323104, "body": "Yes, it&#39;s even possible exactly as you wrote it. Did you actually try it? What problem did you encounter?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574716958, "post_id": 59039834, "comment_id": 104323118, "body": "That doesn&#39;t create a struct, it creates a map."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574716991, "post_id": 59039834, "comment_id": 104323137, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/29347092/13860\">stackoverflow.com/q/29347092/13860</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1574714987, "creation_date": 1574714987, "answer_id": 59039898, "question_id": 59039834, "link": "https://stackoverflow.com/questions/59039834/create-a-struct-dynamically/59039898#59039898", "title": "Create a struct dynamically", "body": "<p>When building JSON, you can use any struct you have for that <code>interface{}</code> variables:</p>\n\n<pre><code>data.CustomFields=myStructVar\n</code></pre>\n\n<p>Above, the <code>myStructVar</code> is any struct that can be marshaled to JSON.</p>\n\n<p>If you do not have a struct for the custom fields, you can use a <code>map[string]interface{}</code>:</p>\n\n<pre><code>data.CustomFields=map[string]interface{}{\"field1\":\"value1\",\n\"field2\":\"value2\"}\n</code></pre>\n\n<p>When you're unmarshaling JSON input, the <code>interface{}</code> custom fields will be unmarshaled as a <code>map[string]interface{}</code> if it is a JSON object, <code>[]interface{}</code> if it is a JSON array, or as one of the primitive values (string,float64,bool).</p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 8264180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2AwAtDHqBvk/AAAAAAAAAAI/AAAAAAABJL0/T0z_fYhr2Ts/photo.jpg?sz=128", "display_name": "Samuel Mutel", "link": "https://stackoverflow.com/users/8264180/samuel-mutel"}, "edited": false, "score": 0, "creation_date": 1574884909, "post_id": 59039966, "comment_id": 104392446, "body": "The application is not written by me: <a href=\"https://github.com/netbox-community/go-netbox/blob/6634a33611e62d201b6890a041f2419015a6c6fa/netbox/models/writable_tenant.go#L42\" rel=\"nofollow noreferrer\">github.com/netbox-community/go-netbox/blob/&hellip;</a>."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 0, "last_activity_date": 1574715361, "creation_date": 1574715361, "answer_id": 59039966, "question_id": 59039834, "link": "https://stackoverflow.com/questions/59039834/create-a-struct-dynamically/59039966#59039966", "title": "Create a struct dynamically", "body": "<p>Instead of using an empty interface for the custom fields, use a <code>map[string]interface{}</code>.</p>\n\n<pre><code>type Payload struct {\n    Field1 string `json:\"field1\"`\n    Field2 int `json:\"field2\"`\n    CustomFields map[string]interface `json:\"customFields,omitempty`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/YwhBVcHHpWs\" rel=\"nofollow noreferrer\">Full working example</a></p>\n"}, {"comments": [{"owner": {"reputation": 83, "user_id": 8264180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2AwAtDHqBvk/AAAAAAAAAAI/AAAAAAABJL0/T0z_fYhr2Ts/photo.jpg?sz=128", "display_name": "Samuel Mutel", "link": "https://stackoverflow.com/users/8264180/samuel-mutel"}, "edited": false, "score": 0, "creation_date": 1575058300, "post_id": 59089389, "comment_id": 104452220, "body": "OK. I found the issue, it&#39;s not err == nil but err != nil ... gotcha"}], "tags": [], "owner": {"reputation": 83, "user_id": 8264180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2AwAtDHqBvk/AAAAAAAAAAI/AAAAAAABJL0/T0z_fYhr2Ts/photo.jpg?sz=128", "display_name": "Samuel Mutel", "link": "https://stackoverflow.com/users/8264180/samuel-mutel"}, "is_accepted": false, "score": 0, "last_activity_date": 1574945630, "creation_date": 1574945630, "answer_id": 59089389, "question_id": 59039834, "link": "https://stackoverflow.com/questions/59039834/create-a-struct-dynamically/59089389#59089389", "title": "Create a struct dynamically", "body": "<p>I did this piece of code ...<br>\nIt seems to not work properly, what I did wrong ?  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>tenantCustomFields := d.Get(\"custom_field\").(*schema.Set).List()               \n\n  cf := make(map[string]interface{})                                             \n  for _, customFieldRaw := range tenantCustomFields {                            \n    customField := customFieldRaw.(map[string]interface{})                         \n    customFieldName := customField[\"name\"].(string)                                \n    customFieldType := customField[\"type\"].(string)                                \n    customFieldValue := customField[\"value\"].(string)                              \n\n    if customFieldType == \"string\" {                                               \n      cf[customFieldName] = customFieldValue                                         \n    } else if customFieldType == \"integer\" {                                       \n      cfIntValue, err := strconv.ParseInt(customFieldValue, 10, 64)                  \n      if err == nil {                                                                \n        return err                                                                     \n      }                                                                              \n      cf[customFieldName] = cfIntValue                                               \n    } else if customFieldType == \"boolean\" {                                       \n      cfBoolValue, err := strconv.ParseBool(customFieldValue)                        \n      if err == nil {                                                                \n        return err                                                                     \n      }                                                                              \n      cf[customFieldName] = cfBoolValue                                              \n    }                                                                              \n  }\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 8264180, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2AwAtDHqBvk/AAAAAAAAAAI/AAAAAAABJL0/T0z_fYhr2Ts/photo.jpg?sz=128", "display_name": "Samuel Mutel", "link": "https://stackoverflow.com/users/8264180/samuel-mutel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 59039898, "answer_count": 3, "score": -2, "last_activity_date": 1574945630, "creation_date": 1574714699, "last_edit_date": 1574716935, "question_id": 59039834, "link": "https://stackoverflow.com/questions/59039834/create-a-struct-dynamically", "title": "Create a struct dynamically", "body": "<p>I would like to communicate in json with an application using its API.</p>\n\n<p>This application have a struct containing this field:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>CustomFields interface{} `json:\"custom_fields,omitempty\"`\n</code></pre>\n\n<p>When calling the API this part could be like:</p>\n\n<pre><code>\"custom_fields\": {\n  \"Field1\": \"Value1\",\n  \"Field2\": \"Value2\"\n}\n</code></pre>\n\n<p>The name of the field for custom fields are not fixed. They could be setup in the application. So I cannot just create a struct. I need to build dynamically the struct inside my code. Is-it possible?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 9065023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3acf56a83f123b0ec212785e8e9bbc?s=128&d=identicon&r=PG&f=1", "display_name": "Hunkerjr", "link": "https://stackoverflow.com/users/9065023/hunkerjr"}, "edited": false, "score": 0, "creation_date": 1574716828, "post_id": 59039567, "comment_id": 104323074, "body": "Ohhh... there we go. Capital letter. :FacePalm: I reread both link that I am following and it was, in bold, in the <code>medium</code> link. Clearly ... reading failure. I wasted so much time on this. At least, I will never ever forget that. Thanks alot!"}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 1, "last_activity_date": 1574713815, "last_edit_date": 1574713815, "creation_date": 1574713438, "answer_id": 59039567, "question_id": 59039542, "link": "https://stackoverflow.com/questions/59039542/directory-structure-and-import/59039567#59039567", "title": "Directory Structure and Import", "body": "<p>In Go, your variables and functions that you'd like to export (make available outside your package) need to start with a capital letter.</p>\n\n<pre><code>package library\n\nfunc privateAddNum(a int, b int) int {\n  return a + b\n}\n\nfunc PublicAddNum(a int, b int) int {\n  return a + b\n}\n</code></pre>\n\n<p><code>privateAddNum</code> is an <strong>unexported</strong> function and will only be accessible within the <code>library</code> package.</p>\n\n<p><code>PublicAddNum</code> is an <strong>exported</strong> function and will be accessible to external packages that import <code>library</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 9065023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3acf56a83f123b0ec212785e8e9bbc?s=128&d=identicon&r=PG&f=1", "display_name": "Hunkerjr", "link": "https://stackoverflow.com/users/9065023/hunkerjr"}, "edited": false, "score": 0, "creation_date": 1574716870, "post_id": 59039726, "comment_id": 104323087, "body": "Thanks for the reply. Capital letter was the missing link. I will check to remove the GOPATH as you indicated. Thanks alot for the reply."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1574714222, "creation_date": 1574714222, "answer_id": 59039726, "question_id": 59039542, "link": "https://stackoverflow.com/questions/59039542/directory-structure-and-import/59039726#59039726", "title": "Directory Structure and Import", "body": "<p>With your setup, the package import path is:</p>\n\n<pre><code>import \"Tutorial/library\"\n</code></pre>\n\n<p>And you should capitalize the names you want to export in the library package so you can access them from other packages.</p>\n\n<p>In general, the import path is the file path of the package (relative to $GOPATH) if it is local, or the remote path of the package, such as <code>github.com/myaccount/package</code>. The simple import names such as <code>import library</code> are reserved for built-in packages. Relative import paths also work, but they are not recommended, i.e. <code>import ./library</code>.</p>\n\n<p>That said, with the module system $GOPATH is no longer used. I recommend you read modules and how you can work outside the $GOPATH.</p>\n"}], "owner": {"reputation": 35, "user_id": 9065023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3acf56a83f123b0ec212785e8e9bbc?s=128&d=identicon&r=PG&f=1", "display_name": "Hunkerjr", "link": "https://stackoverflow.com/users/9065023/hunkerjr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 37, "favorite_count": 0, "accepted_answer_id": 59039726, "answer_count": 2, "score": -1, "last_activity_date": 1574716926, "creation_date": 1574713325, "last_edit_date": 1574716926, "question_id": 59039542, "link": "https://stackoverflow.com/questions/59039542/directory-structure-and-import", "title": "Directory Structure and Import", "body": "<p>I do not understand how the package / project directory structure works.\nI am following these 2 links <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">enter link description here</a> and <a href=\"https://medium.com/rungo/everything-you-need-to-know-about-package-in-go-b8bac62b74cc\" rel=\"nofollow noreferrer\">enter link description here</a></p>\n\n<p>My Go workspace is located under /workspace/golang.\nMy <code>$GOPATH</code> is equal to <code>/workspace/golang</code></p>\n\n<p>My directory structure is as follow :</p>\n\n<pre><code>/workspace/golang/src/Tutorial/\n...tutorial_main.go              &lt;- Default 'Hello World' program\n...library/\n......arithmetic.go\n</code></pre>\n\n<p>Content of arithmetic.go :</p>\n\n<pre><code>package library\n\nfunc addNum(a int, b int) int {\n  return a + b\n}\n</code></pre>\n\n<p>I <code>cd</code> into library folder and ran <code>go build arithmetic</code></p>\n\n<p>Now, I cannot figure out how to use my arithmetic.go in my tutorial_main.go file.\nI tried the following :</p>\n\n<pre><code>import \"library\"\nfmt.Println(\"Result : \", library.addNum(1,4))\n\nimport \"Tutorial/library\"\nfmt.Println(\"Result : \", library.addNum(1,4))\n\nimport \"src/Tutorial/library\"\nfmt.Println(\"Result : \", library.addNum(1,4))\n</code></pre>\n\n<p>Neither works. \nIt keep saying it cannot find <code>library</code>\nI don't understand what I am doing wrong. </p>\n"}, {"tags": ["amazon-web-services", "unit-testing", "go", "interface"], "comments": [{"owner": {"reputation": 199, "user_id": 1619706, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/12c7a2ca97ca7add3724de6489fe3310?s=128&d=identicon&r=PG", "display_name": "jackysatpal", "link": "https://stackoverflow.com/users/1619706/jackysatpal"}, "edited": false, "score": 0, "creation_date": 1574717831, "post_id": 59035071, "comment_id": 104323430, "body": "I don&#39;t know why this question was downvoted?"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 5, "last_activity_date": 1574696279, "creation_date": 1574696279, "answer_id": 59035327, "question_id": 59035071, "link": "https://stackoverflow.com/questions/59035071/golang-mocking-aws-services-which-have-same-method-name/59035327#59035327", "title": "Golang: mocking AWS services which have same method name", "body": "<p>If there are conflicting function names, you cannot embed interfaces, you have to use named fields:</p>\n\n<pre><code>type MockUpdateWorkflow struct {\n    g glueiface.GlueAPI\n    d dynamodbiface.DynamoDBAPI\n    mock.Mock\n}\n\nfunc setup() (*UpdateWorkflow, *MockUpdateWorkflow) {\n    mockClient := new(MockUpdateWorkflow)\n    mockServices := &amp;UpdateWorkflow{\n        glueIface: mockClient.g,\n        dbIface:   mockClient.d,\n        tableName: mockTableName,\n    }\n    return mockServices, mockClient\n}\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 1619706, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/12c7a2ca97ca7add3724de6489fe3310?s=128&d=identicon&r=PG", "display_name": "jackysatpal", "link": "https://stackoverflow.com/users/1619706/jackysatpal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 1, "accepted_answer_id": 59035327, "answer_count": 1, "score": -1, "last_activity_date": 1574696279, "creation_date": 1574695465, "question_id": 59035071, "link": "https://stackoverflow.com/questions/59035071/golang-mocking-aws-services-which-have-same-method-name", "title": "Golang: mocking AWS services which have same method name", "body": "<p>I'm using two AWS services, Glue and DynamoDB and both of these services, have a same method name <code>CreateTable</code> so while mocking these services, I'm getting <code>CreateTable is ambiguous</code> error.</p>\n\n<p>Glue: CreateTable <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/glue/#Glue.CreateTable\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/glue/#Glue.CreateTable</a></p>\n\n<p>DynamoDB: CreateTable <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/#DynamoDB.CreateTable\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/dynamodb/#DynamoDB.CreateTable</a></p>\n\n<p>Is there any way to resolve this issue?</p>\n\n<p>Code:</p>\n\n<pre><code>type UpdateWorkflow struct {\n    glueIface glueiface.GlueAPI\n    dbIface   dynamodbiface.DynamoDBAPI\n    tableName string\n}\n\nfunc NewUpdateWorkflow(tableName string) *UpdateWorkflow {\n    sess := sessions.NewSession()\n    return &amp;UpdateWorkflow{\n        dbIface:   dynamodb.New(sess),\n        glueIface: glue.New(sess),\n        tableName: tableName,\n    }\n}\n</code></pre>\n\n<p>Unit test:</p>\n\n<pre><code>// MockUpdateWorkflow is a mock implementation of gluetestutils and dynamodb service\ntype MockUpdateWorkflow struct {\n    glueiface.GlueAPI\n    dynamodbiface.DynamoDBAPI\n    mock.Mock\n}\n\nfunc setup() (*UpdateWorkflow, *MockUpdateWorkflow) {\n    mockClient := new(MockUpdateWorkflow)\n    mockServices := &amp;UpdateWorkflow{\n        glueIface: mockClient,\n        dbIface:   mockClient,\n        tableName: mockTableName,\n    }\n    return mockServices, mockClient\n}\n</code></pre>\n"}, {"tags": ["android", "firebase", "go", "firebase-cloud-messaging", "firebase-admin"], "comments": [{"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 1, "creation_date": 1574696859, "post_id": 59033584, "comment_id": 104313907, "body": "Have you tried setting the priority in the config? <a href=\"https://godoc.org/firebase.google.com/go/messaging#AndroidConfig\" rel=\"nofollow noreferrer\">godoc.org/firebase.google.com/go/messaging#AndroidConfig</a>"}, {"owner": {"reputation": 935, "user_id": 12210341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xjW3SjdB334/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDCeLd_NjF7rK-LtBQC82BnurApg/photo.jpg?sz=128", "display_name": "max ", "link": "https://stackoverflow.com/users/12210341/max"}, "reply_to_user": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1574703153, "post_id": 59033584, "comment_id": 104317308, "body": "Thanks Gavin , I will check that , Need to know the difference between these two fields. Priority at <b>android config</b> and Priority at <b>AndroidNotification</b>"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 0, "creation_date": 1574716976, "post_id": 59033584, "comment_id": 104323128, "body": "Using the client, it looks like you can only send a <code>Message</code>. The <code>Message</code> struct has a field for <code>AndroidConfig</code>. I assume that&#39;s how you&#39;d set the priority."}], "answers": [{"comments": [{"owner": {"reputation": 935, "user_id": 12210341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xjW3SjdB334/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDCeLd_NjF7rK-LtBQC82BnurApg/photo.jpg?sz=128", "display_name": "max ", "link": "https://stackoverflow.com/users/12210341/max"}, "edited": false, "score": 0, "creation_date": 1574737759, "post_id": 59042682, "comment_id": 104328288, "body": "I have raised it there, instead of feature request , can this be treated as high priority bug? Need to have fix in actulal repo otherwise my automated build will fail if I do anything custom on firebase admn go. My automated build process fetches the firebase go sdk from github every time for creating docker image."}], "tags": [], "owner": {"reputation": 5314, "user_id": 5190886, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YLo4CPWOOeA/AAAAAAAAAAI/AAAAAAAAAAA/NEX8mDWN_F0/photo.jpg?sz=128", "display_name": "Hiranya Jayathilaka", "link": "https://stackoverflow.com/users/5190886/hiranya-jayathilaka"}, "is_accepted": true, "score": 2, "last_activity_date": 1574734019, "creation_date": 1574734019, "answer_id": 59042682, "question_id": 59033584, "link": "https://stackoverflow.com/questions/59033584/setting-notification-priority-in-firebase-admin-go-client/59042682#59042682", "title": "Setting notification_priority in firebase admin go client", "body": "<p>From the documentation on <code>notification_priority</code>:</p>\n\n<blockquote>\n  <p>Set the relative priority for this notification. Priority is an indication of how much of the user's attention should be consumed by this notification. Low-priority notifications may be hidden from the user in certain situations, while the user might be interrupted for a higher-priority notification. The effect of setting the same priorities may differ slightly on different platforms. Note this priority differs from AndroidMessagePriority. This priority is processed by the client after the message has been delivered, whereas AndroidMessagePriority is an FCM concept that controls when the message is delivered.</p>\n</blockquote>\n\n<p>This parameter is currently not available in the Go SDK. Feel free to file a feature request in the GitHub repo.</p>\n"}], "owner": {"reputation": 935, "user_id": 12210341, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xjW3SjdB334/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdDCeLd_NjF7rK-LtBQC82BnurApg/photo.jpg?sz=128", "display_name": "max ", "link": "https://stackoverflow.com/users/12210341/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 470, "favorite_count": 2, "accepted_answer_id": 59042682, "answer_count": 1, "score": 1, "last_activity_date": 1574734019, "creation_date": 1574690435, "last_edit_date": 1574691971, "question_id": 59033584, "link": "https://stackoverflow.com/questions/59033584/setting-notification-priority-in-firebase-admin-go-client", "title": "Setting notification_priority in firebase admin go client", "body": "<p>As Per firebase document, we can set the parameter <strong>notification_priority</strong> to determine message priority.</p>\n\n<p><a href=\"https://firebase.google.com/docs/reference/fcm/rest/v1/projects.messages#androidnotification\" rel=\"nofollow noreferrer\">https://firebase.google.com/docs/reference/fcm/rest/v1/projects.messages#androidnotification</a></p>\n\n<pre><code>{\n  \"title\": string,\n  \"body\": string,\n  \"icon\": string,\n  \"color\": string,\n  \"sound\": string,\n  \"tag\": string,\n  \"click_action\": string,\n  \"body_loc_key\": string,\n  \"body_loc_args\": [\n    string\n  ],\n  \"title_loc_key\": string,\n  \"title_loc_args\": [\n    string\n  ],\n  \"channel_id\": string,\n  \"ticker\": string,\n  \"sticky\": boolean,\n  \"event_time\": string,\n  \"local_only\": boolean,\n  \"notification_priority\": enum (NotificationPriority),\n</code></pre>\n\n<p>I am trying to use firebase admin go client but when I see the message struct, I cannot see that element </p>\n\n<p>Struct Defined is as follows:\n<a href=\"https://godoc.org/firebase.google.com/go/messaging#AndroidNotification\" rel=\"nofollow noreferrer\">https://godoc.org/firebase.google.com/go/messaging#AndroidNotification</a></p>\n\n<pre><code>type AndroidNotification struct {\n    Title        string   `json:\"title,omitempty\"` // if specified, overrides the Title field of the Notification type\n    Body         string   `json:\"body,omitempty\"`  // if specified, overrides the Body field of the Notification type\n    Icon         string   `json:\"icon,omitempty\"`\n    Color        string   `json:\"color,omitempty\"` // notification color in #RRGGBB format\n    Sound        string   `json:\"sound,omitempty\"`\n    Tag          string   `json:\"tag,omitempty\"`\n    ClickAction  string   `json:\"click_action,omitempty\"`\n    BodyLocKey   string   `json:\"body_loc_key,omitempty\"`\n    BodyLocArgs  []string `json:\"body_loc_args,omitempty\"`\n    TitleLocKey  string   `json:\"title_loc_key,omitempty\"`\n    TitleLocArgs []string `json:\"title_loc_args,omitempty\"`\n    ChannelID    string   `json:\"channel_id,omitempty\"`\n    ImageURL     string   `json:\"image,omitempty\"`\n}\n</code></pre>\n\n<p>Is there any discrepancy in firebase documentation and struct or am I missing something?\nIssue is, message are delivered to device but no sound or on screen display if device is sleeping. ( Happening on one plus 7 pro, only sometimes)</p>\n\n<p>I checked the events using following commands </p>\n\n<pre><code>   1.  Dial *#*#426#*#* to open the FCM Diagnostics page.\n   2.  Tap the EVENTS button to show the event log.\n   3.  Check whether the message was delivered to the device. There should be a log entry reading \n</code></pre>\n\n<p>and saw that youtube message are coming with <strong>HIGH</strong> priority and priority of my messages is shown as <strong>UNKNOWN</strong>.</p>\n\n<p>How I can send message with high priority as described in documentation?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 82895, "user_id": 372239, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2twLb.jpg?s=128&g=1", "display_name": "Toto", "link": "https://stackoverflow.com/users/372239/toto"}, "edited": false, "score": 1, "creation_date": 1574688759, "post_id": 59032337, "comment_id": 104309374, "body": "From the <a href=\"https://stackoverflow.com/tags/regex/info\">regex tag info</a>: &quot;Since regular expressions are not fully standardized, all questions with this tag should also include a tag specifying the applicable programming language or tool.&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "edited": false, "score": 0, "creation_date": 1574688896, "post_id": 59032824, "comment_id": 104309457, "body": "Thanks Tim and for the explanation!"}, {"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "reply_to_user": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "edited": false, "score": 0, "creation_date": 1574688925, "post_id": 59032824, "comment_id": 104309471, "body": "Thanks for the good question, and I have no idea why you got downvoted (I reversed it, by the way)."}, {"owner": {"reputation": 82895, "user_id": 372239, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2twLb.jpg?s=128&g=1", "display_name": "Toto", "link": "https://stackoverflow.com/users/372239/toto"}, "edited": false, "score": 0, "creation_date": 1574689035, "post_id": 59032824, "comment_id": 104309554, "body": "golang doesn&#39;t support lookahead."}, {"owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "edited": false, "score": 0, "creation_date": 1574689103, "post_id": 59032824, "comment_id": 104309592, "body": "I didn&#39;t have the language tagged in the initial question, but this still works: <a href=\"https://regex101.com/r/bFz9mw/4/\" rel=\"nofollow noreferrer\">regex101.com/r/bFz9mw/4</a>"}, {"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "reply_to_user": {"reputation": 82895, "user_id": 372239, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/2twLb.jpg?s=128&g=1", "display_name": "Toto", "link": "https://stackoverflow.com/users/372239/toto"}, "edited": false, "score": 0, "creation_date": 1574689477, "post_id": 59032824, "comment_id": 104309837, "body": "@Toto I gave a very similar pattern in case lookarounds are not available."}], "tags": [], "owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "is_accepted": true, "score": 2, "last_activity_date": 1574689458, "last_edit_date": 1574689458, "creation_date": 1574688089, "answer_id": 59032824, "question_id": 59032337, "link": "https://stackoverflow.com/questions/59032337/regex-to-extract-content-from-slash-to-either-end-of-line-slash-or-query-string/59032824#59032824", "title": "Regex to extract content from slash to either end of line, slash or query string", "body": "<p>The following pattern seems to be working:</p>\n\n<pre><code>/[^?/]*/?(?=\\?|$)\n</code></pre>\n\n<p><a href=\"https://regex101.com/r/jSVuHH/1\" rel=\"nofollow noreferrer\"><h2>Demo</h2></a></p>\n\n<p>Here is an explanation of the regex:</p>\n\n<pre><code>/         match a (possibly) final path separator\n[^?/]*    match zero or more non / or ? characters\n/?        optionally match one more path separator\n(?=\\?|$)  which is followed by either `?` or the end of the string\n</code></pre>\n\n<p><strong>Edit:</strong></p>\n\n<p>If your version of regex does not support lookahead, then use the following similar pattern instead:</p>\n\n<pre><code>/[^?/]*/?(?:\\?|$)\n</code></pre>\n\n<p>Then, trim off the trailing <code>?</code>, should it exist.  On Go, you would use <code>strings.TrimRight</code>, with <code>?</code> as the character to trim.</p>\n"}], "owner": {"reputation": 7763, "user_id": 501494, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/5dc2a48c68041b350359e623be076651?s=128&d=identicon&r=PG", "display_name": "Jesse", "link": "https://stackoverflow.com/users/501494/jesse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 59032824, "answer_count": 1, "score": 0, "last_activity_date": 1574689458, "creation_date": 1574686500, "last_edit_date": 1574688873, "question_id": 59032337, "link": "https://stackoverflow.com/questions/59032337/regex-to-extract-content-from-slash-to-either-end-of-line-slash-or-query-string", "title": "Regex to extract content from slash to either end of line, slash or query string", "body": "<p>I'm trying to match the last slash in a path of arbitrary depth to essentially the end of the path. How do I adjust this so example one matches?</p>\n\n<pre><code>([^/]+[.html]?)/?\\?\n</code></pre>\n\n<ol>\n<li><a href=\"https://www.somedomain/path/some-slug-94690\" rel=\"nofollow noreferrer\">https://www.somedomain/path/some-slug-94690</a> (no match)</li>\n<li><a href=\"https://www.somedomain.com/one/somepath/another-slug?test\" rel=\"nofollow noreferrer\">https://www.somedomain.com/one/somepath/another-slug?test</a>  (another-slug)</li>\n<li><a href=\"https://www.anotherdomain.com/somepath/another-slug/?test\" rel=\"nofollow noreferrer\">https://www.anotherdomain.com/somepath/another-slug/?test</a> (another-slug)</li>\n<li><a href=\"https://www.anotherdomain.com/path/another_slug.html?test=true\" rel=\"nofollow noreferrer\">https://www.anotherdomain.com/path/another_slug.html?test=true</a> (another-slug)</li>\n</ol>\n\n<p><a href=\"https://regex101.com/r/bFz9mw/1\" rel=\"nofollow noreferrer\">https://regex101.com/r/bFz9mw/1</a></p>\n"}, {"tags": ["json", "go", "integer", "terraform"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1574685858, "post_id": 59032074, "comment_id": 104307834, "body": "Because this: <a href=\"https://play.golang.com/p/s7QA5O0rsh3\" rel=\"nofollow noreferrer\">play.golang.com/p/s7QA5O0rsh3</a>. Use <code>int64</code> instead."}], "answers": [{"comments": [{"owner": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "edited": false, "score": 0, "creation_date": 1574686037, "post_id": 59032168, "comment_id": 104307923, "body": "Thanks for this fast answer, i&#39;ll fork the project and change it"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "edited": false, "score": 1, "creation_date": 1574686065, "post_id": 59032168, "comment_id": 104307944, "body": "@MartinPaucot Or use 64-bit target (if that&#39;s an option for you), but yes, if you may get numbers this big, it&#39;s better to be explicit about the integer size."}, {"owner": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "edited": false, "score": 0, "creation_date": 1574686211, "post_id": 59032168, "comment_id": 104308029, "body": "I will use int64, it&#39;s a temporary change. As I said, I really do not know Go. It&#39;s just for waiting a real fix"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1574686144, "last_edit_date": 1574686144, "creation_date": 1574685947, "answer_id": 59032168, "question_id": 59032074, "link": "https://stackoverflow.com/questions/59032074/json-cannot-unmarshal-number-5088060241-into-struct-of-type-int/59032168#59032168", "title": "json: cannot unmarshal number 5088060241 into struct of type int", "body": "<p>Size of <code>int</code> is either 32 or 64 bit depending on the target architecture you compile to and run on. Your input <code>5088060240</code> is bigger than the max value of a 32-bit integer (which is <code>2147483647</code>), so if your <code>int</code> is 32-bit, you get this error.</p>\n\n<p>Easiest fix is to use <code>int64</code>. See this example:</p>\n\n<pre><code>var i int32\nfmt.Println(json.Unmarshal([]byte(\"5088060240\"), &amp;i))\n\nvar j int64\nfmt.Println(json.Unmarshal([]byte(\"5088060240\"), &amp;j))\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/n_0r-caTWuq\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>json: cannot unmarshal number 5088060240 into Go value of type int32\n&lt;nil&gt;\n</code></pre>\n"}], "owner": {"reputation": 898, "user_id": 7829123, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Rwdmn.png?s=128&g=1", "display_name": "Martin Paucot", "link": "https://stackoverflow.com/users/7829123/martin-paucot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 997, "favorite_count": 0, "accepted_answer_id": 59032168, "answer_count": 1, "score": 1, "last_activity_date": 1574686263, "creation_date": 1574685608, "last_edit_date": 1574686263, "question_id": 59032074, "link": "https://stackoverflow.com/questions/59032074/json-cannot-unmarshal-number-5088060241-into-struct-of-type-int", "title": "json: cannot unmarshal number 5088060241 into struct of type int", "body": "<p>I'm working on a Terraform project using the OVH provider, when the record is created, the provider is unable to fetch the ID of the record and trigger this error :\n<code>cannot unmarshal number 5088060240 into Go struct field OvhDomainZoneRecord.id of type int</code></p>\n\n<p>I opened an issue on the github repository but still waiting for an answer.\nI would like to correct the problem by myself but i'm not a Go developper and i canno't find any related error.</p>\n\n<p>The struct of OvhDomainZoneRecord :</p>\n\n<pre><code>type OvhDomainZoneRecord struct {\n    Id        int    `json:\"id,omitempty\"`\n    Zone      string `json:\"zone,omitempty\"`\n    Target    string `json:\"target\"`\n    Ttl       int    `json:\"ttl,omitempty\"`\n    FieldType string `json:\"fieldType\"`\n    SubDomain string `json:\"subDomain,omitempty\"`\n}\n</code></pre>\n\n<p>The related file :\n<a href=\"https://github.com/terraform-providers/terraform-provider-ovh/blob/master/ovh/resource_ovh_domain_zone_record.go\" rel=\"nofollow noreferrer\">https://github.com/terraform-providers/terraform-provider-ovh/blob/master/ovh/resource_ovh_domain_zone_record.go</a></p>\n"}, {"tags": ["file", "go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1574682035, "post_id": 59030891, "comment_id": 104305752, "body": "getLastLine(file) reads until the end of the file. There&#39;s nothing more to read in readFileFrom."}, {"owner": {"reputation": 385, "user_id": 8249447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2019240481630479/picture?type=large", "display_name": "Tr\u1ea7n Xu&#226;n Huy", "link": "https://stackoverflow.com/users/8249447/tr%e1%ba%a7n-xu%c3%a2n-huy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1574682175, "post_id": 59030891, "comment_id": 104305841, "body": "@peter Does this mean I can only read a file once for every file? Therefore, I need to combine these 2 functions into 1?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1574682570, "last_edit_date": 1574682570, "creation_date": 1574682262, "answer_id": 59031073, "question_id": 59030891, "link": "https://stackoverflow.com/questions/59030891/file-scanner-loop-does-not-execute/59031073#59031073", "title": "File scanner loop does not execute", "body": "<p><a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a> maintains the position where the next read or write operation will work. Reading from / writing to the file updates this position.</p>\n\n<p>If you use a single <code>file</code>, passing it to <code>getLastLine()</code> will read it till its end, so its pointer will point to the end of the file. Now passing it to <code>readFileFrom()</code> will not read and print anything because there is no more data after the end of the file (that's the definition of the \"end\").</p>\n\n<p>You need to either rewind the pointer using <a href=\"https://golang.org/pkg/os/#File.Seek\" rel=\"nofollow noreferrer\"><code>File.Seek()</code></a>, or you need to close and reopen it. Obviously just rewinding is more efficient. To set the pointer to the file start:</p>\n\n<pre><code>if _, err := file.Seek(0, io.SeekStart); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>So do this between the 2 function calls:</p>\n\n<pre><code>getLastLine(file)\nif _, err := file.Seek(0, io.SeekStart); err != nil {\n    panic(err)\n}\nreadFileFrom(file)\n</code></pre>\n\n<p>Also note that if you would open the file twice, you would not need to rewind it, and you could also run the 2 functions concurrently without interfering with each other, because they only read the file and each <code>os.File</code> has its own pointer.</p>\n\n<pre><code>file1, err := os.Open(\"a.txt\")\n// handle err\ndefer file1.Close()\n\nfile2, err := os.Open(\"a.txt\")\n// handle err\ndefer file2.Close()\n\nwg := sync.WaitGroup()\nwg.Add(1)\ngo func() {\n    defer wg.Done()\n    getLastLine(file1)\n}()\n\nreadFileFrom(file2)\n\nwg.Wait() // Wait for getLastLine() to complete\n</code></pre>\n"}], "owner": {"reputation": 385, "user_id": 8249447, "user_type": "registered", "profile_image": "https://graph.facebook.com/2019240481630479/picture?type=large", "display_name": "Tr\u1ea7n Xu&#226;n Huy", "link": "https://stackoverflow.com/users/8249447/tr%e1%ba%a7n-xu%c3%a2n-huy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "accepted_answer_id": 59031073, "answer_count": 1, "score": 1, "last_activity_date": 1574760553, "creation_date": 1574681702, "last_edit_date": 1574760553, "question_id": 59030891, "link": "https://stackoverflow.com/questions/59030891/file-scanner-loop-does-not-execute", "title": "File scanner loop does not execute", "body": "<p>I'm getting the last line of a text file, and try to read it.</p>\n\n<p>get last line:</p>\n\n<pre><code>func getLastLine(file *os.File) (result int) {\n    s := bufio.NewScanner(file)\n    result = 0\n    for s.Scan() {\n        result++\n    }\n    err := s.Err()\n    if err != nil {\n        log.Fatal(err)\n    }\n    return\n}\n</code></pre>\n\n<p>read file:</p>\n\n<pre><code>func readFileFrom(file *os.File) {\n    s := bufio.NewScanner(file)\n    for s.Scan() {\n        fmt.Println(s.Text())\n    }\n\n    err := s.Err()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>If i write this in <code>main.go</code>: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    getLastLine(file)\n    readFileFrom(file)\n</code></pre>\n\n<p>It will not execute the block:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>for s.Scan() {\n    fmt.Println(s.Text())\n}\n</code></pre>\n\n<p>If I remove the line <code>getLastLine(file)</code>, the reading works as expected.</p>\n\n<p>I think it's because 2 Scanners are accessing the same file.</p>\n"}, {"tags": ["mysql", "go", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574681715, "post_id": 59030584, "comment_id": 104305567, "body": "Try implementing the <code>sql.Scanner</code> and the <code>driver.Valuer</code> interfaces for your custom type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1574682212, "post_id": 59030584, "comment_id": 104305868, "body": "If that by itself doesn&#39;t help make sure to add <code>gorm</code> tags to the <code>JSONTime</code> fields. And please fix the rest of the tags, it is hard to know whether or not your actual code has the same tag mess as in the question, or whether you were just careless writing out the question."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574683095, "post_id": 59030584, "comment_id": 104306364, "body": "none of this code performs a migration, so from here, it wont create ANY colums ANYway. You <b>must</b> provide a simple, minimal, reproducible example of the sequence of code that you have been able to identify within your code base as not working so that we can help you."}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 0, "creation_date": 1574683419, "post_id": 59030584, "comment_id": 104306556, "body": "Just clarifying something. What datatypes are the <code>createdAt</code> and <code>updatedAt</code> fields in the table schema?  If you are using <code>datetime</code> then you can scan the column directly into <code>time.Time</code> as long as you use <code>?parseTime=true</code> when you open the db connection."}, {"owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574689520, "post_id": 59030584, "comment_id": 104309869, "body": "@mkopriva I&#39;ve updated the question hopefully that suffice"}, {"owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574689657, "post_id": 59030584, "comment_id": 104309952, "body": "@mkopriva actually as you said I think I need to implement driver.Valuer interface. <a href=\"https://golang.org/pkg/database/sql/driver/#Value\" rel=\"nofollow noreferrer\">golang.org/pkg/database/sql/driver/#Value</a> says driver only supports some basic types (e.g. int64,time.Time, etc)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574689784, "post_id": 59030584, "comment_id": 104310032, "body": "@nafas the tags are still a mess, there needs to be space between different tags. You&#39;re missing one <code>`</code> in your tags, and you have a duplicate <code>createdAt</code> tag."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574689982, "post_id": 59030584, "comment_id": 104310161, "body": "@nafas and yes, do implement the Valuer interface but also the Scanner interface. While I don&#39;t know what gorm does underneath, the standard library, which is used by gorm, does not recognize the <code>JSONTime</code> type and will not be able to store or read it from the database without the Value and Scan methods."}, {"owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574690462, "post_id": 59030584, "comment_id": 104310442, "body": "@mkopriva thanks for pointing out, it was mostly typo when I moved to stackoverflow. I&#39;ll try to implement Valuer and Scanner. will update later"}, {"owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574763153, "post_id": 59030584, "comment_id": 104337616, "body": "@mkopriva hey dude, took a while but finally managed to figure it out. thanks for your pointers. would be great if I get ur opinion on the answer, thanks"}], "answers": [{"tags": [], "owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "is_accepted": true, "score": 2, "last_activity_date": 1574763227, "creation_date": 1574763227, "answer_id": 59048516, "question_id": 59030584, "link": "https://stackoverflow.com/questions/59030584/sub-type-of-time-time-doesnt-create-the-column-using-gorm-lib/59048516#59048516", "title": "sub-type of time.Time doesn&#39;t create the Column using gorm lib", "body": "<p>Thanks to @mkopriva, I finally figured it out.</p>\n\n<p>There were a few issues:</p>\n\n<p>1- <code>MarshalJSONand</code> <code>UnmarshalJSON</code> are only for before and after database interaction</p>\n\n<p>2- the structure <code>table</code> definition didn't have the right <code>gorm</code> definition:</p>\n\n<pre><code>type tablestruct {\n    ID        int64            `gorm:\"primary_key;auto_increment\"json:\"id\"`\n    CreatedAt timeLib.JSONTime `gorm:\"type:timestamp;default:current_timestamp\"json:\"createdAt\"`\n    UpdatedAt timeLib.JSONTime `gorm:\"type:timestamp;default:current_timestamp ON update current_timestamp\"json:\"updatedAt\"`\n}\n</code></pre>\n\n<p>3- since type <code>JSONTime</code> is a new type, driver doesn't know how to convert it, so we need to override <code>Value</code>:</p>\n\n<pre><code>func (jsonTime JSONTime) Value() (driver.Value, error) {\n    return time.Time(jsonTime), nil\n}\n</code></pre>\n\n<p>4- finally we need to override <code>Scan</code> in order to convert database value into <code>JSONTime</code> value</p>\n\n<pre><code>func (jsonTime *JSONTime) Scan(value interface{}) error {\n    if value == nil {\n        *jsonTime = JSONTime(time.Now())\n        return nil\n    }\n    if readTime, err := driver.DefaultParameterConverter.ConvertValue(value); err == nil {\n        if convertedTime, ok := readTime.(time.Time); ok {\n            *jsonTime = JSONTime(convertedTime)\n            return nil\n        }\n    }\n    return errors.New(\"failed to scan TIME\")\n}\n</code></pre>\n"}], "owner": {"reputation": 4974, "user_id": 1638237, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/ffa06966d694c32fd87adbcd6bccdad6?s=128&d=identicon&r=PG&f=1", "display_name": "nafas", "link": "https://stackoverflow.com/users/1638237/nafas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 1, "accepted_answer_id": 59048516, "answer_count": 1, "score": 0, "last_activity_date": 1574763365, "creation_date": 1574680746, "last_edit_date": 1574763365, "question_id": 59030584, "link": "https://stackoverflow.com/questions/59030584/sub-type-of-time-time-doesnt-create-the-column-using-gorm-lib", "title": "sub-type of time.Time doesn&#39;t create the Column using gorm lib", "body": "<p>I'm trying to add a timestamp to the database and have the returned json with the number representing the timestamp instead of the current string representation of timestamp; essentially overriding marshal,unmarshal of <code>time.Time</code></p>\n\n<pre><code>type JSONTime time.Time\n\nfunc (j *JSONTime) UnmarshalJSON(data []byte) error {\n    if string(data) == \"null\" {\n        return nil\n    }\n    millis, err := strconv.ParseInt(string(data), 10, 64)\n    if err != nil {\n        return err\n    }\n    *j = JSONTime(time.Unix(0, millis*int64(time.Millisecond)))\n    return err\n}\n\nfunc (t JSONTime) MarshalJSON() ([]byte, error) {\n    //do your serializing here\n    stamp := fmt.Sprintf(\"%d\", time.Time(t).Unix()*1000)\n    return []byte(stamp), nil\n}\ntype table struct {\n    ID        int64    `gorm:\"primary_key;auto_increment\"json:\"id\"`\n    CreatedAt JSONTime json:\"createdAt\"`\n    UpdatedAt JSONTime json:\"updatedAt\"`\n}\n</code></pre>\n\n<p>the problem I have the above code simply ignores the creation of the columns on my database (other fields are created). I even manually created the column but gorm doesn't add the data either.</p>\n\n<p>I believe marshal and unmarshal work, but problem lies before even using them (i.e. adding the columns to db) </p>\n\n<p>what do am I doing wrong here?</p>\n\n<p>I'm using <a href=\"https://www.mysql.com/\" rel=\"nofollow noreferrer\">MySQL</a> and library <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">gorm</a></p>\n\n<p><strong>UPDATE 1:</strong></p>\n\n<p>Previously I had my table structure as follows:</p>\n\n<pre><code>type table struct {\n    ID        int64    `gorm:\"primary_key;auto_increment\"json:\"id\"`\n    CreatedAt time.Time json:\"createdAt\"`\n    UpdatedAt time.Time json:\"updatedAt\"`\n}\n</code></pre>\n\n<p>this was mostly working (e.g. creating columns on the database)</p>\n\n<p>in terms of database connection, I basically used:</p>\n\n<pre><code>root:password@tcp(127.0.0.1:3306)/database?parseTime=true\n</code></pre>\n\n<p>and use auto migrate for my repo:</p>\n\n<pre><code>db,err := // get db connection \nif err != nil {\n    panic(\"Failed to connect to database\")\n}\ndb.AutoMigrate(&amp;table{})\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1574678810, "post_id": 59029976, "comment_id": 104304044, "body": "Nobody is sending anything or closing the channel <code>c</code>, so <code>&lt;-c</code> is a blocking forever operation. If you want the code after that to be executed, remove that operation. If you need to wait for the goroutines, close the channel when they&#39;re done or use <code>sync.WaitGroup</code>. What is it exactly you&#39;re trying to do?"}], "answers": [{"comments": [{"owner": {"reputation": 68, "user_id": 1838539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a74af69a77a36de933614556eba315?s=128&d=identicon&r=PG", "display_name": "Pavel Tsvetkov", "link": "https://stackoverflow.com/users/1838539/pavel-tsvetkov"}, "edited": false, "score": 0, "creation_date": 1574735984, "post_id": 59030080, "comment_id": 104327917, "body": "yes, this solution works me,  @icza have sent it. All i read before in howto`s is not obviously for my question. Thank you"}], "tags": [], "owner": {"reputation": 313, "user_id": 7789681, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-dFy9hP_4zsg/AAAAAAAAAAI/AAAAAAAABGE/Cvgl1FEEuqA/photo.jpg?sz=128", "display_name": "Alexey Bril", "link": "https://stackoverflow.com/users/7789681/alexey-bril"}, "is_accepted": false, "score": 4, "last_activity_date": 1574679039, "creation_date": 1574679039, "answer_id": 59030080, "question_id": 59029976, "link": "https://stackoverflow.com/questions/59029976/routines-channels-and-infinite-loops/59030080#59030080", "title": "routines, channels and infinite loops", "body": "<p>Read from channel <code>&lt;-c</code> is blocking operation. </p>\n\n<p>Since you are not writing to this channel, you block further actions after reading from the channel.</p>\n\n<p>You can use sync.WaitGroup</p>\n\n<pre><code>wg := &amp;sync.WaitGroup{}\nwg.Add(1)\ngo func () {\n    defer wg.Done()\n    ...\n}\nwg.Wait()\n</code></pre>\n"}], "owner": {"reputation": 68, "user_id": 1838539, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94a74af69a77a36de933614556eba315?s=128&d=identicon&r=PG", "display_name": "Pavel Tsvetkov", "link": "https://stackoverflow.com/users/1838539/pavel-tsvetkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1574682651, "creation_date": 1574678654, "last_edit_date": 1574682651, "question_id": 59029976, "link": "https://stackoverflow.com/questions/59029976/routines-channels-and-infinite-loops", "title": "routines, channels and infinite loops", "body": "<p>I am trying to get information from channel, but looks like my code isn`t running after go routinnes. \nBoth my routines are working and first one collects info, and last one is watching for filling, and if filling is ends second routine stops both routines\nhow i can get information and get running code after routines? Or perhaps is there any right way to get info? </p>\n\n<pre><code>func main() {\n    watcher, _ := winlog.NewWinLogWatcher()\n    watcher.SubscribeFromBeginning(\"Application\", `*`)\n    i := 0\n    c := make(chan bool)\n    go func() {\n        for {\n            if flag == true {\n                return\n            }\n            select {\n            case evt := &lt;-watcher.Event():\n                i+=1\n                var event Event\n                data := []byte(evt.Xml)\n                _ = xml.Unmarshal(data, &amp;event)\n                Events = append(Events, event)\n            case err := &lt;-watcher.Error():\n                break\n            }\n        }\n    }()\n\n    go func() {\n        for {\n            if flag == true {\n                break\n            }\n            if I == 0 || I != i {\n                I = i\n            }\n            time.Sleep(time.Millisecond * 100)\n            if i == I &amp;&amp; flag == false{\n                flag = true\n            }\n            time.Sleep(time.Millisecond * 10)\n        }\n    }()\n    &lt;-c\n    // *** i cant print this info ***\n    time.Sleep(10*time.Millisecond)\n    fmt.Println(`Events counter:`, len(Events))\n}\n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574683285, "post_id": 59029621, "comment_id": 104306476, "body": "you have to explain the authors problem and its solution using your words. <a href=\"https://stackoverflow.com/help/how-to-answer\">stackoverflow.com/help/how-to-answer</a>"}], "tags": [], "owner": {"reputation": 187, "user_id": 10570437, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-iaQNw9_-2Fo/AAAAAAAAAAI/AAAAAAAAABY/g0EfFIQ2qQQ/photo.jpg?sz=128", "display_name": "Umair Riaz", "link": "https://stackoverflow.com/users/10570437/umair-riaz"}, "is_accepted": false, "score": -2, "last_activity_date": 1574677318, "creation_date": 1574677318, "answer_id": 59029621, "question_id": 59028602, "link": "https://stackoverflow.com/questions/59028602/upload-using-mime-multipart-corrupts-the-file/59029621#59029621", "title": "Upload using mime/multipart corrupts the file", "body": "<p>I found a solution:</p>\n\n<p><a href=\"https://github.com/GoesToEleven/golang-web-dev/tree/master/034_photo-blog/04_upload-pictures\" rel=\"nofollow noreferrer\">UploadFile</a></p>\n\n<p>Clone this, if you find any problem, comment here.</p>\n"}, {"comments": [{"owner": {"reputation": 35, "user_id": 11758983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EdDlp.jpg?s=128&g=1", "display_name": "Nathan J", "link": "https://stackoverflow.com/users/11758983/nathan-j"}, "edited": false, "score": 0, "creation_date": 1574681470, "post_id": 59030391, "comment_id": 104305433, "body": "The picture is correctly detected as an image now but it still is corrupted once uploaded (Same issue in eyes of gnome)"}, {"owner": {"reputation": 35, "user_id": 11758983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EdDlp.jpg?s=128&g=1", "display_name": "Nathan J", "link": "https://stackoverflow.com/users/11758983/nathan-j"}, "edited": false, "score": 0, "creation_date": 1574684569, "post_id": 59030391, "comment_id": 104307157, "body": "Oh yeah, that was obvious. Thanks. Any clue on why was it working in postman though?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1574683267, "last_edit_date": 1574683267, "creation_date": 1574680036, "answer_id": 59030391, "question_id": 59028602, "link": "https://stackoverflow.com/questions/59028602/upload-using-mime-multipart-corrupts-the-file/59030391#59030391", "title": "Upload using mime/multipart corrupts the file", "body": "<p>The call to <code>mimetype.DetectReader(file)</code> reads part of the file.  The call to  <code>_, err = io.Copy(pict, file)</code> reads the remainder of the file. To read the entire file, seek back to offset 0 before the call to <code>io.Copy</code>. </p>\n\n<p>Files are opened at offset 0. There's no need to seek to offset 0  immediately after the call to <code>Open</code>. </p>\n\n<p>Fix the problem by swapping order of the calls:</p>\n\n<pre><code>...\n\nmime, _, err := mimetype.DetectReader(file)\nif err != nil {\n    fmt.Println(\"Can't read the file\")\n    return\n}\n\n// Rewind to the start of the file\n_, err = file.Seek(0, io.SeekStart)\nif err != nil {\n    fmt.Println(\"Can't read the file\")\n    return\n}\n\n...\n</code></pre>\n\n<p>The sever has a similar problem.  Rewind after detecting the type:</p>\n\n<pre><code>mimeType, _, err := mimetype.DetectReader(file) // Package gabriel-vasile/mimetype\nif err != nil {\n    w.WriteHeader(http.StatusBadRequest)\n    return\n}\n\n// Rewind to the start of the file\n_, err = file.Seek(0, io.SeekStart)\nif err != nil {\n    w.WriteHeader(http.StatusInternalServerError)\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 11758983, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EdDlp.jpg?s=128&g=1", "display_name": "Nathan J", "link": "https://stackoverflow.com/users/11758983/nathan-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 59030391, "answer_count": 2, "score": 2, "last_activity_date": 1574683616, "creation_date": 1574673910, "last_edit_date": 1574683616, "question_id": 59028602, "link": "https://stackoverflow.com/questions/59028602/upload-using-mime-multipart-corrupts-the-file", "title": "Upload using mime/multipart corrupts the file", "body": "<p>I wrote a server that has a route to upload a picture. This is a form that receive a few parameters: <code>title</code>, <code>description</code>, <code>visibility</code> and the <code>picture</code>. The page also uses the <code>Authentication</code> header.</p>\n\n<pre><code>func UploadPictureRoute(prv *services.Provider) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        user, err := auth.ValidateRequest(prv, w, r)\n        if auth.RespondError(w, err) {\n            return\n        }\n\n        r.ParseMultipartForm(10 &lt;&lt; 20) // 10 meg max\n\n        title := r.FormValue(\"title\")\n        desc := r.FormValue(\"description\")\n        visib := r.FormValue(\"visibility\")\n        visibInt, err := strconv.Atoi(visib)\n        visibility := int8(visibInt) // Visibility can be either 0, 1, 2\n\n        if err != nil {\n            w.WriteHeader(http.StatusBadRequest)\n        }\n\n        file, _, err := r.FormFile(\"picture\")\n        if err != nil {\n            w.WriteHeader(http.StatusBadRequest)\n            return\n        }\n        defer file.Close()\n\n        mimeType, _, err := mimetype.DetectReader(file) // Package gabriel-vasile/mimetype\n        if err != nil {\n            w.WriteHeader(http.StatusBadRequest)\n            return\n        }\n\n        if !utils.IsValidMimetype(mimeType) { // Basically just comparing to image/png, image/jpg. Crashes here\n            w.WriteHeader(http.StatusBadRequest)\n            return\n        }\n\n        parentFolder := prv.PicturePath + \"/\" + strconv.FormatInt(*user.ID, 10) + \"/\"\n\n        _, err = os.Stat(parentFolder)\n        if os.IsNotExist(err) {\n            err = os.MkdirAll(parentFolder, os.ModePerm)\n            if err != nil {\n                w.WriteHeader(http.StatusInternalServerError)\n                return\n            }\n        }\n\n        pict := model.Picture{\n            Title:       title,\n            Description: desc,\n            Creator:     &amp;user,\n            Visibility:  visibility,\n            Ext:         utils.GetExtForMimetype(mimeType),\n        }\n\n        pict, err = dal.CreatePicture(prv, pict)\n        if err != nil {\n            w.WriteHeader(http.StatusInternalServerError)\n            return\n        }\n\n        outputFile, err := os.Create(parentFolder + strconv.FormatInt(*pict.ID, 10) + \".\" + pict.Ext)\n        if err != nil {\n            w.WriteHeader(http.StatusInternalServerError)\n            dal.DeletePicture(prv, pict)\n        }\n        defer outputFile.Close()\n\n        _, err = io.Copy(outputFile, file)\n        if err != nil {\n            w.WriteHeader(http.StatusInternalServerError)\n            return\n        }\n// Responding \n    }\n}\n</code></pre>\n\n<p>This works well using <code>Postman</code>, it uploads the file correctly and everything works as expected.</p>\n\n<p>However, i failed to write a go <code>http</code> client to upload a file:</p>\n\n<pre><code>type uploadResponse struct {\n    URLID string\n}\n\nfunc main() {\n    filename := \"filename.png\"\n\n    file, err := os.Open(filename)\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer file.Close()\n\n    // Just to be sure we're really at the start of the file\n    _, err = file.Seek(0, io.SeekStart)\n    if err != nil {\n        fmt.Println(\"Can't read the file\")\n        return\n    }\n\n    mime, _, err := mimetype.DetectReader(file)\n    if err != nil {\n        fmt.Println(\"Can't read the file\")\n        return\n    }\n\n    if !api.IsMimetypeAllowed(mime) { // Just check if it's a jpg/png/gif. This works on the client\n        fmt.Println(\"This filetype can't be uploaded to a Scinna server.\")\n        fmt.Println(\"Please convert this file to jpeg, png or gif.\")\n\n        return\n    }\n\n\n    body := &amp;bytes.Buffer{}\n    writer := multipart.NewWriter(body)\n\n    title, _ := writer.CreateFormField(\"title\")\n    title.Write([]byte(\"My picture title\"))\n\n    desc, _ := writer.CreateFormField(\"description\")\n    desc.Write([]byte(\"My picture description\"))\n\n    visib, _ := writer.CreateFormField(\"visibility\")\n    visib.Write([]byte(\"0\"))\n\n    pict, _ := writer.CreateFormFile(\"picture\", file.Name())\n    _, err = io.Copy(pict, file)\n\n    writer.Close()\n\n    r, err := http.NewRequest(\"POST\", \"https://myapi.local/pictures\", body)\n    if err != nil {\n        panic(err)\n    }\n    r.Header.Add(\"Content-Type\", writer.FormDataContentType())\n    r.Header.Add(\"Authorization\", \"Bearer \"+config.Token)\n\n    client := &amp;http.Client{}\n    client.Do(r)\n}\n</code></pre>\n\n<p>This code makes the server crash. The mimetype of the picture becomes <code>application/octet-stream</code> and the image headers are broken (It still opens in some editors, but EyesOfGnome basically says that the picture is not a JPG/PNG file because it can't find the magic numbers at the beginning)</p>\n\n<p>How do i fix the HTTP go client to successfully upload pictures ?</p>\n"}, {"tags": ["go", "kubernetes", "client-go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574854754, "post_id": 59027739, "comment_id": 104376768, "body": "try to print it with <code>%#v</code> or <code>%T</code> maybe it is a typped error with a blank message."}], "answers": [{"tags": [], "owner": {"reputation": 1265, "user_id": 1894196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5fd3405808cc6a9fe4b126b1ec39bd?s=128&d=identicon&r=PG", "display_name": "GianArb", "link": "https://stackoverflow.com/users/1894196/gianarb"}, "is_accepted": false, "score": 0, "last_activity_date": 1574859094, "creation_date": 1574859094, "answer_id": 59070676, "question_id": 59027739, "link": "https://stackoverflow.com/questions/59027739/upgrading-connection-error-in-port-forwarding-via-client-go/59070676#59070676", "title": "Upgrading connection error in Port forwarding via client-go", "body": "<p>I got the problem partially solved. At least I got it working and I am happy with that.</p>\n\n<p>The URL generated by the following code is <code>https://192.168.99.125:8443/namespaces/default/pods/influxdb-65c9fdf9cb-nzvpf/portforward?timeout=32s</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>reqURL := clientset.RESTClient().Post().\n        Resource(\"pods\").\n        Namespace(\"default\").\n        Name(\"test\").\n        SubResource(\"portforward\").URL()\n</code></pre>\n\n<p>It is wrong, the right one is: </p>\n\n<pre><code>https://192.168.99.125:8443/api/v1/namespaces/default/pods/influxdb-65c9fdf9cb-nzvpf/portforward\n</code></pre>\n\n<p>This is what I do to generate that URL right now:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    path := fmt.Sprintf(\"/api/v1/namespaces/%s/pods/%s/portforward\", \"default\", podName)\n\n    hostIP := strings.TrimLeft(config.Host, \"htps:/\")\n    serverURL := url.URL{Scheme: \"https\", Path: path, Host: hostIP}\n    dialer := spdy.NewDialer(upgrader, &amp;http.Client{Transport: transport}, http.MethodPost, &amp;serverURL)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 13050786, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/213e921acd00be70a3c487007972bb47?s=128&d=identicon&r=PG", "display_name": "hsin", "link": "https://stackoverflow.com/users/13050786/hsin"}, "is_accepted": false, "score": 1, "last_activity_date": 1584010425, "creation_date": 1584010425, "answer_id": 60652596, "question_id": 59027739, "link": "https://stackoverflow.com/questions/59027739/upgrading-connection-error-in-port-forwarding-via-client-go/60652596#60652596", "title": "Upgrading connection error in Port forwarding via client-go", "body": "<pre><code>clientset.CoreV1().RESTClient().Post().\n        Resource(\"pods\").\n        Namespace(\"default\").\n        Name(\"test\").\n        SubResource(\"portforward\").URL()\n</code></pre>\n\n<p>works for me and gives url with .../api/v1/namespaces...</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 15325864, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/80b240c55ea0a9aba18470bee1227e2a?s=128&d=identicon&r=PG&f=1", "display_name": "tomaspinho", "link": "https://stackoverflow.com/users/15325864/tomaspinho"}, "is_accepted": false, "score": 0, "last_activity_date": 1614844641, "last_edit_date": 1614844641, "creation_date": 1614818107, "answer_id": 66466930, "question_id": 59027739, "link": "https://stackoverflow.com/questions/59027739/upgrading-connection-error-in-port-forwarding-via-client-go/66466930#66466930", "title": "Upgrading connection error in Port forwarding via client-go", "body": "<p>The <code>*rest.Request</code> has a <code>Prefix(string)</code> method you can use to insert the missing subpath:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>reqURL := clientset.RESTClient().Post().\n        Prefix(&quot;api/v1&quot;).\n        Resource(&quot;pods&quot;).\n        Namespace(&quot;default&quot;).\n        Name(&quot;test&quot;).\n        SubResource(&quot;portforward&quot;).URL()\n</code></pre>\n"}], "owner": {"reputation": 1265, "user_id": 1894196, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa5fd3405808cc6a9fe4b126b1ec39bd?s=128&d=identicon&r=PG", "display_name": "GianArb", "link": "https://stackoverflow.com/users/1894196/gianarb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1614844641, "creation_date": 1574670590, "last_edit_date": 1574854408, "question_id": 59027739, "link": "https://stackoverflow.com/questions/59027739/upgrading-connection-error-in-port-forwarding-via-client-go", "title": "Upgrading connection error in Port forwarding via client-go", "body": "<p>This is an easy to run version of the code I wrote to do port-forwarding via client-go. There are hardcoded pod name, namespace, and port. You can change them with the one you have running.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"flag\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n\n    \"k8s.io/client-go/kubernetes\"\n    \"k8s.io/client-go/tools/clientcmd\"\n    \"k8s.io/client-go/tools/portforward\"\n    \"k8s.io/client-go/transport/spdy\"\n)\n\nfunc main() {\n\n    stopCh := make(&lt;-chan struct{})\n    readyCh := make(chan struct{})\n    var kubeconfig *string\n    if home := \"/home/gianarb\"; home != \"\" {\n        kubeconfig = flag.String(\"kubeconfig\", filepath.Join(home, \".kube\", \"config\"), \"(optional) absolute path to the kubeconfig file\")\n    } else {\n        kubeconfig = flag.String(\"kubeconfig\", \"\", \"absolute path to the kubeconfig file\")\n    }\n    flag.Parse()\n\n    // use the current context in kubeconfig\n    config, err := clientcmd.BuildConfigFromFlags(\"\", *kubeconfig)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    // create the clientset\n    clientset, err := kubernetes.NewForConfig(config)\n    if err != nil {\n        panic(err.Error())\n    }\n\n    reqURL := clientset.RESTClient().Post().\n        Resource(\"pods\").\n        Namespace(\"default\").\n        Name(\"test\").\n        SubResource(\"portforward\").URL()\n\n    transport, upgrader, err := spdy.RoundTripperFor(config)\n    if err != nil {\n        panic(err)\n    }\n    dialer := spdy.NewDialer(upgrader, &amp;http.Client{Transport: transport}, http.MethodPost, reqURL)\n    fw, err := portforward.New(dialer, []string{\"9999:9999\"}, stopCh, readyCh, os.Stdout, os.Stdout)\n    if err != nil {\n        panic(err)\n    }\n    if err := fw.ForwardPorts(); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Version golang 1.13:</p>\n\n<pre><code>    k8s.io/api v0.0.0-20190409021203-6e4e0e4f393b\n    k8s.io/apimachinery v0.0.0-20190404173353-6a84e37a896d\n    k8s.io/cli-runtime v0.0.0-20190409023024-d644b00f3b79\n    k8s.io/client-go v11.0.0+incompatible\n</code></pre>\n\n<p>The error I get is </p>\n\n<blockquote>\n  <p>error upgrading connection:  </p>\n</blockquote>\n\n<p>but there is nothing after the <code>:</code>.\nDo you have any experience with this topic?\nThanks</p>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 6381, "user_id": 12354911, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8Sz0V.jpg?s=128&g=1", "display_name": "Eldar", "link": "https://stackoverflow.com/users/12354911/eldar"}, "edited": false, "score": 1, "creation_date": 1574669861, "post_id": 59027349, "comment_id": 104299433, "body": "You can try to read content type of the response if not <code>&#39;application&#47;json&#39;</code> than don&#39;t add JSON values. <code>c.Writer.Header().Get(&quot;Content-Type&quot;)</code> is how you read content type. Hope it works for you."}], "answers": [{"tags": [], "owner": {"reputation": 175, "user_id": 5477548, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-u_GWgGl3A68/AAAAAAAAAAI/AAAAAAAAAF4/GqN9bcsoapY/photo.jpg?sz=128", "display_name": "yoad w", "link": "https://stackoverflow.com/users/5477548/yoad-w"}, "is_accepted": false, "score": 0, "last_activity_date": 1574687487, "last_edit_date": 1574687487, "creation_date": 1574672575, "answer_id": 59028216, "question_id": 59027349, "link": "https://stackoverflow.com/questions/59027349/json-response-is-appended-to-html-template-output/59028216#59028216", "title": "JSON response is appended to HTML template output", "body": "<p>So I talked with the guy who was in charge of our SM library. We added a flag to the <em>context</em> object, called \"responseOverridden\". Anyone with the reference to the context object can set the flag (in his own service), and then in the SM library we just don't return a JSON if this flag is set:</p>\n\n<pre><code>// someService.go\nfunc (r RestrictedHandler) Exec(c *smContext) (interface{}, ServiceError) {\n// check if we have a cookie for auth\nif tokenCookie, err := tokens.GetTokenFromCookie(c); err != nil {\n    c.HTML(401, \"login.html\")\n    c.replyOverriden = true\n    return \"\", err\n} else {\n    return r, nil\n}\n</code></pre>\n\n<p>}</p>\n\n<p>in library code:</p>\n\n<pre><code> // SM.go\n response, err := newH1.Exec(hc);\n if !hc.responseOverridden {\n     err != nil {\n        c.JSON(err.GetStatusCode(), gin.H{\n          \"status\": \"error\",\n          \"error\": err\n        })\n     } else {\n        c.JSON(http.StatusOK, gin.H{\n          \"status\": \"success\",\n          \"data\": response\n        })\n     }\n } \n // someone probably handled something in hc, so don't return JSON   \n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 5477548, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh3.googleusercontent.com/-u_GWgGl3A68/AAAAAAAAAAI/AAAAAAAAAF4/GqN9bcsoapY/photo.jpg?sz=128", "display_name": "yoad w", "link": "https://stackoverflow.com/users/5477548/yoad-w"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 61, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574687487, "creation_date": 1574668655, "last_edit_date": 1574682691, "question_id": 59027349, "link": "https://stackoverflow.com/questions/59027349/json-response-is-appended-to-html-template-output", "title": "JSON response is appended to HTML template output", "body": "<p>I have this weird behavior which I think is caused by using conflicting infrastructures:</p>\n\n<ol>\n<li>Traefik for reverse proxy<br></li>\n<li>In-house library, SM, which wraps all requests into our back-end language; It parses JSON from request and return a certain JSON structure for the response</li>\n<li>For Traefik, I must return a HTML page rather than a JSON. <br></li>\n</ol>\n\n<p>I use Go for BE and render HTML templates for FE\n\n<p>My flow look kinda like this:</p>\n\n<pre><code>func (r RestrictedHandler) Exec(c *smContext) (interface{}, ServiceError) {\n    // check if we have a cookie for auth\n    if tokenCookie, err := tokens.GetTokenFromCookie(c); err != nil {\n        c.HTML(401, \"login.html\")\n        return \"\", err\n    } else {\n        return r, nil\n    }\n}\n</code></pre>\n\n<p>And the wrapper for this:</p>\n\n<pre><code>    if response, err := newH1.Exec(hc); err != nil {\n        c.JSON(err.GetStatusCode(), gin.H{\n            \"status\": \"error\",\n            \"error\": err\n        })\n    } else {\n        c.JSON(http.StatusOK, gin.H{\n            \"status\": \"success\",\n            \"data\": response\n        })\n    }\n</code></pre>\n\n<p>So what happens here (I suspect) is that I \"push\" into the response \"buffer\" both HTML text and JSON text, resulting in the following html page the user gets:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html lang=\"en\"&gt;\n  &lt;head&gt;\n    &lt;meta charset=\"UTF-8\"&gt;\n    &lt;title&gt;Title&lt;/title&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    My returned page\n   &lt;/body&gt;\n&lt;/html&gt;{\"status\":\"error\",\"error\":{\"msg\":\"Unauthorized error\",\"type\":\"Unauthorized\"}}\n</code></pre>\n\n<p>So my questions is, how to stop writing into the context after <strong>c.HTML()</strong>? </p>\n\n<ol>\n<li>I tried c.Next() and c.Abort(), but I guess they are more for chaining middleware. </li>\n<li>Changing the SM library code (shared code with people I work with, but still possible to submit a pull request), to somehow check, \"if response has html tags in it, don't do c.JSON()\".<br></li>\n</ol>\n"}, {"tags": ["go", "methods", "struct", "interface", "field"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1574664879, "post_id": 59026269, "comment_id": 104297600, "body": "Please use go fmt to format your code and then you want to take the Go tour <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">tour.golang.org/welcome/1</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574667006, "post_id": 59026269, "comment_id": 104298364, "body": "If your need help with basics of the language please come up with a <i>minimal</i> example."}, {"owner": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "edited": false, "score": 0, "creation_date": 1574677438, "post_id": 59026269, "comment_id": 104303257, "body": "Thanks for the reply. I am making UT cases so there I couldn&#39;t use fmt."}], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "edited": false, "score": 0, "creation_date": 1574680078, "post_id": 59027784, "comment_id": 104304722, "body": "The above example you have defined is very clear and am aware of this. The way to call method is by passing values to struct and using struct we can call methods that is what you have done. But in my case it&#39;s a bit difficult. Sine I am making UT for the code I couldn&#39;t modify the above source code. Just trying to pass through it."}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "edited": false, "score": 0, "creation_date": 1574710376, "post_id": 59027784, "comment_id": 104320563, "body": "If I&#39;m understanding you correctly you need to call <code>NewRequestHandlerProxy</code> without modifying any of the above code? If thats the case then my example stands; you will need to pass in something that implements <code>IAdapter</code>; this may be something you create yourself (the point of an interface is that you can pass in anything that implements the interface) or using an existing struct provided elsewhere (note that you cannot use <code>RequestHandlerProxy</code> itself because that would be recursive). As things stand you have not provided enough information to provide a more detailed response."}, {"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "reply_to_user": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "edited": false, "score": 0, "creation_date": 1574711462, "post_id": 59027784, "comment_id": 104321009, "body": "Did a quick search - your code is from the voltha package (would have been helpful to state that). That being the case I&#39;d refer you to an example from that package; <a href=\"https://github.com/opencord/voltha-openolt-adapter/blob/master/adaptercore/openolt.go\" rel=\"nofollow noreferrer\">github.com/opencord/voltha-openolt-adapter/blob/master/&hellip;</a> implements the IAdapter interface."}, {"owner": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "edited": false, "score": 0, "creation_date": 1574766295, "post_id": 59027784, "comment_id": 104339428, "body": "Thank you very much. It was a great example on the link you have provided. The thing is we need to create a dummy struct on other side just by defining then using the values we can call the function. Very much helpful. Thanks again."}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 0, "last_activity_date": 1574670794, "creation_date": 1574670794, "answer_id": 59027784, "question_id": 59026269, "link": "https://stackoverflow.com/questions/59026269/interface-as-fields-in-struct-and-interface-calls-methods-which-takes-input-as-s/59027784#59027784", "title": "Interface as fields in struct and interface calls methods which takes input as same struct", "body": "<p>The code you provided is a bit difficult to follow (incomplete and its purpose unclear) so here is a simplified example which will hopefully answer your question. Note that from the question title I'm assuming that the fact that <code>RequestHandlerProxy</code> implements the interface <code>IAdapter</code> is confusing you; that is probably irrelevant (it may be that there are other functions that accept an <code>IAdapter</code> where it would make sense to pass in a <code>RequestHandlerProxy</code> or your own implementation of <code>IAdapter</code> such as <code>adaptImpl</code> below). </p>\n\n<p>I have simplified <code>IAdapter</code> to contain a single function and put everything in one file. To expand this to work in your example you will need to implement all three functions (<code>Adapter_descriptor()</code>,<code>Device_types()</code> &amp; <code>Health()</code>). Code can be run in the <a href=\"https://play.golang.org/p/1um7fEqAEne\" rel=\"nofollow noreferrer\">go playground</a> (if this does not answer your question perhaps you can modify that code to provide a simplified example of your issue).</p>\n\n<pre><code>package main\nimport \"errors\"\n\n// IAdapter - Reduced to one function to make this simple\ntype IAdapter interface {\n    Adapter_descriptor() error\n}\n\n/// NewRequestHandlerProxy - Simplified version of the New function\nfunc NewRequestHandlerProxy(iadapter IAdapter) {\n    return // code removed to make example simple\n}\n\n// adaptImpl - Implements the IAdapter interface\ntype adaptImpl struct {\n    isError bool // example only\n}\n\n// Adapter_descriptor - Implement the function specified in the interface\nfunc (a adaptImpl) Adapter_descriptor() error {\n    if a.IsError {\n        return errors.New(\"An error happened\")\n    }\n    return nil\n}\n\nfunc main() {\n    // Create an adaptImpl which implements IAdapter \n    x := adaptImpl{isError: true}\n    NewRequestHandlerProxy(x)\n}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 12427478, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAJZh6hFPZbboAEOpAtNYQbPmozWxUmH0mymDuNuQ=k-s128", "display_name": "Aravind pandi", "link": "https://stackoverflow.com/users/12427478/aravind-pandi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 59027784, "answer_count": 1, "score": -1, "last_activity_date": 1574671295, "creation_date": 1574663117, "last_edit_date": 1574671295, "question_id": 59026269, "link": "https://stackoverflow.com/questions/59026269/interface-as-fields-in-struct-and-interface-calls-methods-which-takes-input-as-s", "title": "Interface as fields in struct and interface calls methods which takes input as same struct", "body": "<p>In my case, \"RequestHandlerProxy\" is a structure which has field as interface \"IAdapter\" and interface has may methods to be called that method has input as structure \"RequestHandlerProxy\". Please help me how to work with this? How can I define values to struct \"RequestHandlerProxy\" and pass through?</p>\n\n<p>Below is my structure and methods of interface: Interface \"IAdapter\" is in file \"adapters\"</p>\n\n<pre><code>type RequestHandlerProxy struct {\n    TestMode       bool\n    coreInstanceId string\n    adapter        adapters.IAdapter\n    coreProxy      adapterif.CoreProxy\n}\n\nfunc NewRequestHandlerProxy(coreInstanceId string, iadapter adapters.IAdapter, cProxy adapterif.CoreProxy) *RequestHandlerProxy {\n    var proxy RequestHandlerProxy\n    proxy.coreInstanceId = coreInstanceId\n    proxy.adapter = iadapter\n    proxy.coreProxy = cProxy\n    return &amp;proxy\n}\n\nfunc (rhp *RequestHandlerProxy) Adapter_descriptor() (*empty.Empty, error) {\n    return new(empty.Empty), nil    \n}\n\nfunc (rhp *RequestHandlerProxy) Device_types() (*voltha.DeviceTypes, error) {\n    return nil, nil\n}\n\nfunc (rhp *RequestHandlerProxy) Health() (*voltha.HealthStatus, error) {    \n    return nil, nil\n}\n</code></pre>\n\n<p>Below is my interface in adapters file:</p>\n\n<pre><code>type IAdapter interface {\n    Adapter_descriptor() error\n    Device_types() (*voltha.DeviceTypes, error)\n    Health() (*voltha.HealthStatus, error)\n}\n</code></pre>\n"}, {"tags": ["go", "logging", "fluentd"], "answers": [{"comments": [{"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1574670152, "post_id": 59026778, "comment_id": 104299547, "body": "I changed the fluentd  call to   {      Flogger.EncodeAndPostData(&quot;debug.access&quot;, time.Now(), msg)  } But I can see nothing in the fluentd log files"}, {"owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1574670653, "post_id": 59026778, "comment_id": 104299736, "body": "I can see errors in td-agent logs  #0 [input_forward] unexpected error on reading data host=&quot;127.0.0.1&quot; port=52474 error_class=ArgumentError error=&quot;record must be a Hash: String&quot;   2019-11-25 13:57:25 +0530 [error]: #0 suppressed same stacktrace"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1574673999, "post_id": 59026778, "comment_id": 104301267, "body": "What datatype is <code>msg</code>?"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "edited": false, "score": 0, "creation_date": 1574674112, "post_id": 59026778, "comment_id": 104301323, "body": "Looking through the <code>fluentd</code> code, it seems like lower down the chain, even if you don&#39;t provide a <code>map</code> directly, the library attempts to convert the <code>msg</code> into some form of <code>json</code> or <code>key:value</code> pairs.  I re-iterate my previous point. You&#39;re using a <code>json</code> structured logging library, if you go against the grain you&#39;re likely to run into issues."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 0, "last_activity_date": 1574665757, "creation_date": 1574665757, "answer_id": 59026778, "question_id": 59026166, "link": "https://stackoverflow.com/questions/59026166/how-to-print-raw-logs-to-fluentd-with-go-rather-than-using-a-json-map/59026778#59026778", "title": "How to print raw logs to fluentd with Go rather than using a json map", "body": "<p>The function signatures as per the <a href=\"https://godoc.org/github.com/fluent/fluent-logger-golang/fluent\" rel=\"nofollow noreferrer\">Fluent GoDoc</a> as as follows:</p>\n\n<pre><code>func (f *Fluent) EncodeAndPostData(tag string, tm time.Time, message interface{}) error\n</code></pre>\n\n<pre><code>func (f *Fluent) Post(tag string, message interface{}) error\n</code></pre>\n\n<p>Both functions accept the empty interface as the message parameter. All Go types satisfy the interface, so you can pass in anything that you'd like.</p>\n\n<p>However, Fluentd is a <em>structured</em> logging library that primarily relies on <code>JSON</code> encoded data. Usually when using a third-party library, it serves well to use it the way it was intended.</p>\n\n<blockquote>\n  <p>Fluentd tries to structure data as JSON as much as possible: this\n  allows Fluentd to unify all facets of processing log data: collecting,\n  filtering, buffering, and outputting logs across multiple sources and\n  destinations</p>\n</blockquote>\n\n<p>Source: <a href=\"https://www.fluentd.org/architecture\" rel=\"nofollow noreferrer\">Fluentd Website</a></p>\n"}], "owner": {"reputation": 1047, "user_id": 1191999, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/8a5575da1a4d6205f568754e55294cfb?s=128&d=identicon&r=PG", "display_name": "Ram", "link": "https://stackoverflow.com/users/1191999/ram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 371, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574685235, "creation_date": 1574662512, "last_edit_date": 1574685235, "question_id": 59026166, "link": "https://stackoverflow.com/questions/59026166/how-to-print-raw-logs-to-fluentd-with-go-rather-than-using-a-json-map", "title": "How to print raw logs to fluentd with Go rather than using a json map", "body": "<p>I am using a golang function to print logs to fluentd. Fluent Post() method accepts only a map and not a string. I need a function to print raw text rather than forcing me to create a map.</p>\n\n<p>Is that possible? </p>\n\n<p>Below is my code: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n\n    \"github.com/fluent/fluent-logger-golang/fluent\"\n)\n\nvar Flogger *fluent.Fluent\n\nfunc init() {\n    initFluent()\n\n}\n\nfunc initFluent() {\n    var err error\n    Flogger, err = fluent.New(fluent.Config{FluentPort: 24224, FluentHost: \"127.0.0.1\"})\n    if err != nil {\n        fmt.Printf(\"Could not connect to Fluent at %s Error : %v\", os.Getenv(\"FLUENTHOST\"), err)\n    }\n}\n\n// DebugLog (msg string)  Logs the string to Fluent server\nfunc DebugLog(msg string) {\n    //Flogger.Post(\"debug.access\", map[string]string{\"data\": msg})\n    Flogger.EncodeAndPostData(\"debug.access\", time.Now(), map[string]string{\"data\": msg}) // both methods give same result\n}\n\nfunc main() {\n    msg := `{\"mykey\":\"myval\"}`\n    fmt.Println(msg) //  prints {\"mykey\":\"myval\"}\n    DebugLog(msg)    //  prints {\"data\":\"{\\\"mykey\\\":\\\"myval\\\"}\"}   with extra \\\n\n}\n</code></pre>\n"}, {"tags": ["multithreading", "go", "goroutine"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1574660097, "post_id": 59025565, "comment_id": 104296150, "body": "Ideally, the runtime should do this for you, invisibly. Unfortunately it&#39;s pretty hard to do and get right. The existing system does have a lot of magic to avoid using blocking system calls when possible, e.g., most file I/O is actually done with a wrapper around <code>epoll</code> or kqueues or whatever the system provides."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574661275, "post_id": 59025565, "comment_id": 104296463, "body": "Thanks @torek - yeah, when I&#39;ve written vaguely similar things in C, epoll() is awesome to avoid firing up extra threads."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574662195, "post_id": 59025565, "comment_id": 104296746, "body": "Even completely serializing os calls doesn&#39;t entirely work.  Wrapping open/write/close in a mutex still fails (roughly 2 in 1000 times)."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1574663771, "post_id": 59025565, "comment_id": 104297240, "body": "My guess there, is that thread reaping is probably covered by the garbage collector - so it&#39;s not an instant return to a standard goroutine as soon as the system call completes - hence even mutexing system calls to be serialized, doesn&#39;t actually work completely."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574689161, "post_id": 59025565, "comment_id": 104309634, "body": "I would avoid tinkering with the thread count unless you have a <i>very</i> good reason to do so. It doesn&#39;t seem like that&#39;s the case - there&#39;s no problem statement prompting the thread count change."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "edited": false, "score": 0, "creation_date": 1574724723, "post_id": 59025565, "comment_id": 104325499, "body": "Agreed, Adrian - the default threadcount is 10,000. The example above tweaks it down to 5, just to show the problem without creating 10k+1 files.  For better or worse, the problem I&#39;m solving benefits from having LOTS of files open concurrently - 40k+ is not unusual. At the moment, the open/write/close process for each file, is encapsulated in a goroutine, fed data by an associated channel.  A temporary triage is to restrict #open files to maxthreads (or bump maxthreads, since this is practically the solo app on the OS). Longer term, I think I&#39;ll have to restructure."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574759080, "post_id": 59025565, "comment_id": 104335363, "body": "I fail to see the point on having 10k+ threads for an equal number of files. This reads  like a <a href=\"http://xyproblem.info\" rel=\"nofollow noreferrer\">XY problem</a>. Maybe we should try to find out why you need as many threads (or think you do). Or, to put it differently: What is the actual stuff you want to do with 40k+ files <i>concurrently</i>? Since I refuse to believe that you have 40k+ cores available on your system."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "edited": false, "score": 0, "creation_date": 1574894136, "post_id": 59025565, "comment_id": 104395789, "body": "Thanks for the reply Mark. There is an element of XY about it, in the context of threads; and in fact, I&#39;ve resolved the specific problem I&#39;m having, by moving to Y (where Y is a small worker pool, each thread responsible for maintaining N concurrent open files, and using a thread-affinity system based on a fast hash of key elements of my input, to ensure that a particular type of data will always go to a particular thread for processing).  It&#39;s a solution for my requirements, but it&#39;s not an answer to my original question unfortunately.  (more in the next comment)."}, {"owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "edited": false, "score": 0, "creation_date": 1574894417, "post_id": 59025565, "comment_id": 104395863, "body": "(cont) ie: Although I do need to maintain 40k+ open files (in fact, more would be better), I don&#39;t necessarily need 40k+ threads to manage them - it was just architecturally nice to have that option in go when I thought that the number of goroutines was a near inexhaustible resource. ;)  Based on the responses I&#39;ve seen so far however, if I&#39;m using os calls, channel operations or other features of the language that require an os thread, the number of goroutines is practically limited to the OS threadcount. There is a little elasticity in that number, but once you cross it, you risk crashes."}], "owner": {"reputation": 29, "user_id": 12427204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8457b6ec218fbfaa70b311af3c66dd48?s=128&d=identicon&r=PG", "display_name": "Leigh", "link": "https://stackoverflow.com/users/12427204/leigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 128, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1574671394, "creation_date": 1574658643, "last_edit_date": 1574671394, "question_id": 59025565, "link": "https://stackoverflow.com/questions/59025565/controlling-the-initiation-of-os-threads-vs-goroutines", "title": "Controlling the initiation of OS threads vs goroutines?", "body": "<p>One of the great things about Go, it the fact that it has a massive number of lightweight threads (goroutines) available. This opens up some interesting strategic opportunities, but there are circumstances where Go tends to spawn OS threads; and these are generally limited to a maximum of 10,000 by default. If you happen to exceed that number, things crash.</p>\n\n<p>The following code locks down our max OS threads to 5, and then tries to fire up 10 concurrent goroutines. These goroutines will attempt to use system calls (in this case, file create / write / close), which tends to mean that our goroutine will temporarilly (and exclusively) associate with an os thread. Once the system call stuff is complete, our goroutine will return to being a nice lightweight thread again - sharing an os thread with other goroutines, most likely.</p>\n\n<p>There's a simple solution of course - don't write it like that! In fact, if you take out the file open/write/close, everything will work perfectly... but assuming for the moment, that the code structure below is representative of something bigger and meaner that can't really change a whole lot:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"runtime/debug\"\n    \"strconv\"\n    \"sync\"\n)\n\nfunc main() {\n    MaxThreads := 5\n    debug.SetMaxThreads(MaxThreads)\n\n    var fileChan []chan string\n\n    // Create 10 channels that we can use to send data to our file writers.\n    for i := 0; i &lt; 10; i++ {\n        fileChan = append(fileChan, make(chan string))\n    }\n\n    var wg sync.WaitGroup\n\n    for i := 0; i &lt; 10; i++ {\n        wg.Add(1)\n        go func(n int, fChan chan string) {\n            threadWriter(n, fChan)\n            wg.Done()\n        }(i, fileChan[i])\n    }\n\n    for i := 0; i &lt; 10; i++ {\n        for j := 0; j &lt; 10; j++ {\n            fileChan[i] &lt;- \"Test write \" + strconv.Itoa(j) + \" to chan \" + strconv.Itoa(i)\n        }\n    }\n\n    for i := 0; i &lt; 10; i++ {\n        close(fileChan[i])\n    }\n\n    wg.Wait()\n    fmt.Println(\"All done - success\")\n}\n\nfunc threadWriter(i int, dataChan chan string) {\n    // Open the file\n    f, err := os.Create(\"tmp/Thread-\" + strconv.Itoa(i) + \".txt\")\n    if err != nil {\n        log.Fatal(\"Cannot open thread file\", i)\n        return\n    }\n    // Wait for data to come in.\n    for str := range dataChan {\n        f.WriteString(str + \"\\n\")\n    }\n\n    f.Close()\n}\n</code></pre>\n\n<p>So here's the problem: <em>(threadtest.go)</em>\nI'll run the program 20 times. Sometimes it'll work fine, other times, it'll crash with\nruntime: program exceeds 5-thread limit\nfatal error: thread exhaustion</p>\n\n<pre><code>$ go build    \n$ if [ ! -d tmp ]; then mkdir tmp; fi; for i in `seq 1 20`; do ./threadtest 2&gt;/dev/null | grep success &gt; /dev/null; if [ $? -eq 0 ]; then echo \"all good\"; else echo \"NOPE - Threads exhausted\"; fi; rm tmp/Thread-*.txt; done\nNOPE - Threads exhausted\nall good\nNOPE - Threads exhausted\nall good\nall good\nall good\nNOPE - Threads exhausted\nNOPE - Threads exhausted\nNOPE - Threads exhausted\nall good\nNOPE - Threads exhausted\nall good\nall good\nall good\nall good\nall good\nall good\nall good\nall good\nall good\n</code></pre>\n\n<p>Sometimes it works, sometimes it doesn't - it just depends on the timing of system calls, and how many goroutines are in a 'os thread' state at the time. And that's cool.. there has to be a limit on os threads.</p>\n\n<p>However, rather than a panic, if there was some way to detect if we were about to go over the limit, and spin, that might work out ok.. ie:</p>\n\n<pre><code>func threadWriter(i int, dataChan chan string) {\n    while(debug.OsThreadsActive() &gt; 9999) {\n      // spin here until we are safe\n    }\n\n    // Open the file\n    f, err := os.Create(\"tmp/Thread-\" + strconv.Itoa(i) + \".txt\")\n    if err != nil {\n        log.Fatal(\"Cannot open thread file\", i)\n        return\n    }\n    // Wait for data to come in.\n    for str := range dataChan {\n        f.WriteString(str + \"\\n\")\n    }\n\n    f.Close()\n}\n</code></pre>\n\n<p>Unfortunately, looking at runtime/proc.go, there doesn't seem to be an easy interface I can get data from. mcount() is not something that I can query (nor would it be safe to, realistically).</p>\n\n<p>So - does anyone have any suggestions of how, given a goroutine count that exceeds MaxThreads, and a requirement to use potentially blocking os calls within those goroutines, to try and stop hitting MaxThreads? Or, do I just have to put a number-limited mutex lock around any potential system calls within my goroutines, and therefore try to limit concurrent threads on behalf of Go?</p>\n"}, {"tags": ["go", "deadlock", "goroutine"], "comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1574654563, "post_id": 59025035, "comment_id": 104294890, "body": "There&#39;s no coordination to indicate to the main go-routine reading the channel, that the task is complete i.e. the channel is never closed."}, {"owner": {"reputation": 104, "user_id": 6246590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed25f9b404bdde9d5a903a6d283da514?s=128&d=identicon&r=PG&f=1", "display_name": "echmel", "link": "https://stackoverflow.com/users/6246590/echmel"}, "edited": false, "score": 0, "creation_date": 1574671975, "post_id": 59025035, "comment_id": 104300284, "body": "You should read from &quot;c&quot; channel inside another goroutine"}], "answers": [{"tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 2, "last_activity_date": 1574654691, "last_edit_date": 1574654691, "creation_date": 1574654385, "answer_id": 59025066, "question_id": 59025035, "link": "https://stackoverflow.com/questions/59025035/dead-lock-in-goroutines/59025066#59025066", "title": "Dead lock in goroutines", "body": "<p>Because this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    for x:=range c {\n        println(x)\n    }\n</code></pre>\n\n<p>will loop until the channel <code>c</code> closes, which is never done here.</p>\n\n<p>Here is one way you can fix it, using a WaitGroup:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"sync\"\n\nfunc main() {\n    var wg sync.WaitGroup\n    c := make(chan int, 10)\n\n    for i := 0; i &lt; 5; i++ {\n        wg.Add(1)\n        go func(chanel chan int, i int) {\n            defer wg.Done()\n            println(\"i\", i)\n            chanel &lt;- 1\n        }(c, i)\n    }\n\n    go func() {\n        wg.Wait()\n        close(c)\n    }()\n\n    for x := range c {\n        println(x)\n    }\n    println(\"Done!\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Y9bkXoiQXUc\" rel=\"nofollow noreferrer\">Try it on Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1574654402, "creation_date": 1574654402, "answer_id": 59025068, "question_id": 59025035, "link": "https://stackoverflow.com/questions/59025035/dead-lock-in-goroutines/59025068#59025068", "title": "Dead lock in goroutines", "body": "<p>You create five goroutines, each sending an integer value to the channel. Once all those five values are written, there's no other goroutine left that writes to the channel.</p>\n\n<p>The main goroutine reads those five values from the channel. But there are no goroutines that can possibly write the sixth value or close the channel. So, you're deadlocked waiting data from the channel.</p>\n\n<p>Close the channel once all the writes are completed. It should be an interesting exercise to figure out how you can do that with this code.</p>\n"}, {"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1574654977, "creation_date": 1574654977, "answer_id": 59025127, "question_id": 59025035, "link": "https://stackoverflow.com/questions/59025035/dead-lock-in-goroutines/59025127#59025127", "title": "Dead lock in goroutines", "body": "<p>Channel needs to be closed to indicate task is complete.</p>\n\n<p>Coordinate with a <code>sync.WaitGroup</code>:</p>\n\n<pre><code>c := make(chan int, 10)\n\nvar wg sync.WaitGroup // here\n\nfor i := 0; i &lt; 5; i++ {\n\n    wg.Add(1) // here\n\n    go func(chanel chan int, i int) {\n        defer wg.Done()\n        println(\"i\", i)\n        chanel &lt;- 1\n    }(c, i)\n}\n\ngo func() {\n    wg.Wait() // and here\n    close(c)\n}()\n\nfor x := range c {\n    println(x)\n}\nprintln(\"Done!\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/VWcBC2YGLvM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/VWcBC2YGLvM</a></p>\n"}], "owner": {"reputation": 4994, "user_id": 1718042, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/A0fvm.png?s=128&g=1", "display_name": "max", "link": "https://stackoverflow.com/users/1718042/max"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 59025066, "answer_count": 3, "score": 0, "last_activity_date": 1574671411, "creation_date": 1574654034, "last_edit_date": 1574671411, "question_id": 59025035, "link": "https://stackoverflow.com/questions/59025035/dead-lock-in-goroutines", "title": "Dead lock in goroutines", "body": "<p>can someone give me some insight about this code, Why this get deadlock error in <code>for x:=range c</code></p>\n\n<pre><code>func main() {\n    c:=make(chan int,10)\n\n    for i:=0;i&lt;5;i++{\n        go func(chanel chan int,i int){\n            println(\"i\",i)\n            chanel &lt;- 1\n        }(c,i)\n    }\n\n    for x:=range c {\n        println(x)\n    }\n    println(\"Done!\")\n}\n</code></pre>\n"}, {"tags": ["oop", "go", "polymorphism"], "comments": [{"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "edited": false, "score": 0, "creation_date": 1574650184, "post_id": 59024457, "comment_id": 104294055, "body": "This comes up fairly frequently (<a href=\"https://stackoverflow.com/search?q=%5Bgo%5D+polymorphism\">stackoverflow.com/search?q=%5Bgo%5D+polymorphism</a>); <a href=\"https://stackoverflow.com/questions/35115385/polymorphism-in-go-lang\" title=\"polymorphism in go lang\">stackoverflow.com/questions/35115385/polymorphism-in-go-lang</a> and <a href=\"https://stackoverflow.com/questions/53674376/understanding-polymorphism-in-go\" title=\"understanding polymorphism in go\">stackoverflow.com/questions/53674376/&hellip;</a> seem to answer your question (in short the answer is interfaces)."}], "answers": [{"comments": [{"owner": {"reputation": 95, "user_id": 11923505, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-C6rwhQ11j2c/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rc9jkyB24w3AUZ5sNzK1lOdvZn_Uw/photo.jpg?sz=128", "display_name": "C. R. Ward", "link": "https://stackoverflow.com/users/11923505/c-r-ward"}, "edited": false, "score": 0, "creation_date": 1574883732, "post_id": 59025282, "comment_id": 104391951, "body": "I prefer to make an implementation an abstract class (as in C++), then specialize the abstract class to be different things, and then include it through composition in the class I am working on. This allows you to try polymorphism in a more specific way in your interface then in a general approach."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1574656286, "creation_date": 1574656286, "answer_id": 59025282, "question_id": 59024457, "link": "https://stackoverflow.com/questions/59024457/how-to-handle-polymorphic-objects/59025282#59025282", "title": "How to handle polymorphic objects", "body": "<p>As noted before, you can do this using interfaces. You can create a list of type <code>[]Intf</code> where <code>Intf</code> is an interface common to your types, and then you can put any type that implements that interface into your list. </p>\n\n<pre><code>type A struct{}\ntype B struct{}\n\ntype Intf interface {\n  // common methods of A and B\n}\n\nfunc f(a Intf) {\n   // Here, a is A or B\n}\n\n</code></pre>\n\n<p>You have to be careful about whether you're dealing with copies, or pointers. For instance:</p>\n\n<pre><code>a:=A{}\nb:=B{}\nx:=[]Intf{&amp;a,&amp;b}\nf(x)\n</code></pre>\n\n<p>is different from:</p>\n\n<pre><code>x:=[]Intf{a,b}\nf(x)\n</code></pre>\n\n<p>With the first one, if <code>f</code> modified the array elements, the variables <code>a</code> and <code>b</code> are modified because the interface contains a pointer. With the second one, if <code>f</code> modifies the array elements, <code>a</code> and <code>b</code> are not affected because the interfaces in the array contain pointers to copies of those variables. </p>\n\n<p>If, say, <code>A</code> has a method included in the interface <code>Intf</code> that takes a pointer receiver, then you have to use the address of all <code>A</code> instances in the array.</p>\n\n<p>Go's type system is explicit, and strict. So, for instance, you implemented your polymorphic list via interfaces, and you have functions:</p>\n\n<pre><code>func f(input []Intf) {\n}\nfunc g(input Intf) {\n}\n</code></pre>\n\n<p>And let's say you have these variables:</p>\n\n<pre><code>var a []A\nvar b A\n</code></pre>\n\n<p>where <code>A</code> implements <code>Intf</code>. Then:</p>\n\n<pre><code>g(b) // This is valid\nf(a) // This is *not* valid\n</code></pre>\n\n<p>This is because <code>f</code> gets a <code>[]Intf</code>, but <code>a</code> is an <code>[]A</code>, not <code>[]Intf</code>. To call <code>f</code>, you have to build a <code>[]Intf</code>:</p>\n\n<pre><code>fInput:=make([]Intf,0,len(a))\nfor _,x:=range a {\n   fInput=append(fInput,x)\n}\nf(fInput)\n</code></pre>\n\n<p>So if you're dealing with polymorphic lists, then it makes sense to always work with the interface list, not the concrete type list.</p>\n\n<p>You can also work with type assertions if you need direct access to fields depending on type:</p>\n\n<pre><code>func f(in []Intf) {\n   for _,x:=range in {\n      if a, ok:=x.(*A); ok {\n          a.Field=1\n      }\n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 2300947, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d538e47b4316ce2811754bd4642ac44d?s=128&d=identicon&r=PG", "display_name": "user2300947", "link": "https://stackoverflow.com/users/2300947/user2300947"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 122, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574671466, "creation_date": 1574648675, "last_edit_date": 1574671466, "question_id": 59024457, "link": "https://stackoverflow.com/questions/59024457/how-to-handle-polymorphic-objects", "title": "How to handle polymorphic objects", "body": "<p>I am planning to port our server to Go from c++ and I have a question with regards to handling a list of objects based from derived classes. \nWhat I meant is, say if I have a base class (or an interface) called A, and it has child classes B and C, and I want to have a generic list that can handle a list of Type A and it's derived. </p>\n\n<p>In object oriented languages, I can just create a list of (pointer) A and that's it, I can add objects B and C to the list because they are indeed of type A. But since Go does not have inheritance, I am confused on how to effectively handle this.</p>\n"}, {"tags": ["go", "gofmt"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 5, "creation_date": 1574636340, "post_id": 59023245, "comment_id": 104291544, "body": "Gofmt&#39;s style is no one&#39;s favorite, yet gofmt is everyone&#39;s favorite."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1574636407, "post_id": 59023245, "comment_id": 104291559, "body": "get used to it. <a href=\"https://go-proverbs.github.io/\" rel=\"nofollow noreferrer\">go-proverbs.github.io</a>"}], "answers": [{"comments": [{"owner": {"reputation": 182, "user_id": 669678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1f64ffdd7fb58a7e22a80b73f73054?s=128&d=identicon&r=PG", "display_name": "asynth", "link": "https://stackoverflow.com/users/669678/asynth"}, "edited": false, "score": 0, "creation_date": 1574657664, "post_id": 59024523, "comment_id": 104295524, "body": "I didn&#39;t have a problem with <code>y0 - 2.5*y1 + 2.*y2 - 0.5*y3</code>. It is that <code>0.5 * (y2 - y0)</code> and <code>0.5*(y3-y0)</code> are formatted differently from each other despite being the same, and that there is nothing clear at a glance in this: <code>((c3*x+c2)*x+c1)*x + c0</code>."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 182, "user_id": 669678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1f64ffdd7fb58a7e22a80b73f73054?s=128&d=identicon&r=PG", "display_name": "asynth", "link": "https://stackoverflow.com/users/669678/asynth"}, "edited": false, "score": 0, "creation_date": 1574659592, "post_id": 59024523, "comment_id": 104296000, "body": "@asynth: the <code>0.5 * (y2 - y0)</code> has spaces in it because it is the entire expression. The <code>0.5*(y3-y0)</code> has no spaces because it&#39;s <i>not</i> the entire expression: it is the RHS of a sum. That&#39;s really all there is to it. (BTW I agree with you that the <code>return</code> layout is particularly terrible, but I don&#39;t get to choose here.)"}], "tags": [], "owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "is_accepted": true, "score": 2, "last_activity_date": 1574649357, "creation_date": 1574649357, "answer_id": 59024523, "question_id": 59023245, "link": "https://stackoverflow.com/questions/59023245/go-fmt-producing-inconsistently-formatted-results-for-math-expressions/59024523#59024523", "title": "Go fmt producing inconsistently formatted results for math expressions", "body": "<p>This is documented in the <a href=\"https://github.com/golang/go/blob/master/src/go/printer/nodes.go#L660\" rel=\"nofollow noreferrer\">go source code</a>; the aim is to make operator precedence clear. For example in your example <code>y0 - 2.5*y1 + 2.*y2 - 0.5*y3</code> the multiplications will be performed before the subtractions and the format chosen makes this clear at a glance.</p>\n\n<p>In answer to your question; this is not a bug; indeed <a href=\"https://github.com/golang/go/issues/1206\" rel=\"nofollow noreferrer\">quite a bit of effort</a> was put into the formatting. You cannot exclude a line from formatting; this is by design, as mentioned in the <a href=\"https://golang.org/doc/faq\" rel=\"nofollow noreferrer\">FAQ</a>, the aim is to enforce layont rules:</p>\n\n<blockquote>\n  <p>gofmt is a pretty-printer whose purpose is to enforce layout rules; it\n  replaces the usual compendium of do's and don'ts that allows\n  interpretation.</p>\n</blockquote>\n\n<p>Below is a formatted extract from <a href=\"https://github.com/golang/go/blob/master/src/go/printer/nodes.go#L660\" rel=\"nofollow noreferrer\">go/printer/nodes.go</a> that details the formatting rules:</p>\n\n<blockquote>\n  <p>Format the binary expression: decide the cutoff and then format. Let's\n  call depth == 1 Normal mode, and depth > 1 Compact mode. (Algorithm\n  suggestion by Russ Cox.)</p>\n  \n  <p>The precedences are: <code>\n      5             *  /  %  &lt;&lt;  &gt;&gt;  &amp;  &amp;^\n      4             +  -  |  ^\n      3             ==  !=  &lt;  &lt;=  &gt;  &gt;=\n      2             &amp;&amp;\n      1             ||</code></p>\n  \n  <p>The only decision is whether there will be spaces around levels 4 and\n  5. There are never spaces at level 6 (unary), and always spaces at levels 3 and below.</p>\n  \n  <p>To choose the cutoff, look at the whole expression but excluding\n  primary expressions (function calls, parenthesized exprs), and apply\n  these rules:</p>\n  \n  <ol>\n  <li>If there is a binary operator with a right side unary operand that would clash without a space, the cutoff must be (in order):</li>\n  </ol>\n\n<pre><code>   /* 6   \n   &amp;&amp; 6   \n   &amp;^ 6   \n   ++ 5   \n   -- 5 \n</code></pre>\n  \n  <p>(Comparison operators always have spaces around them.)</p>\n  \n  <ol start=\"2\">\n  <li><p>If there is a mix of level 5 and level 4 operators, then the cutoff is 5 (use spaces to distinguish precedence) in Normal mode and 4\n  (never use spaces) in Compact mode.</p></li>\n  <li><p>If there are no level 4 operators or no level 5 operators, then the cutoff is 6 (always use spaces) in Normal mode and 4 (never use\n  spaces) in Compact mode.</p></li>\n  </ol>\n</blockquote>\n"}], "owner": {"reputation": 182, "user_id": 669678, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1f64ffdd7fb58a7e22a80b73f73054?s=128&d=identicon&r=PG", "display_name": "asynth", "link": "https://stackoverflow.com/users/669678/asynth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 59024523, "answer_count": 1, "score": -2, "last_activity_date": 1574671497, "creation_date": 1574636112, "last_edit_date": 1574671497, "question_id": 59023245, "link": "https://stackoverflow.com/questions/59023245/go-fmt-producing-inconsistently-formatted-results-for-math-expressions", "title": "Go fmt producing inconsistently formatted results for math expressions", "body": "<p>My understanding is that go fmt is supposed to produce code that is readable and consistently formatted. However I'm not finding this to be the case. </p>\n\n<p>I typed in the commented code and go fmt returned the uncommented code. Why did it collapse <code>0.5*(y3-y0)</code>, but not <code>0.5 * (y2 - y0)</code> ? How is that consistent? And, IMO, the return line with nearly every space collapsed out is a readability disaster.  </p>\n\n<p>Is the inconsistency a bug?\nIs there a way to get go fmt to leave some lines (like the return line) alone?</p>\n\n<pre><code>func cubicInterpolate(x, y0, y1, y2, y3 float64) float64 {\n    // 4-point, 3rd-order Hermite (x-form)\n    // c0 := y1\n    // c1 := 0.5 * (y2 - y0)\n    // c2 := y0 - 2.5 * y1 + 2. * y2 - 0.5 * y3\n    // c3 := 1.5 * (y1 - y2) + 0.5 * (y3 - y0)\n    //\n    // return ((c3 * x + c2) * x + c1) * x + c0\n\n    c0 := y1\n    c1 := 0.5 * (y2 - y0)\n    c2 := y0 - 2.5*y1 + 2.*y2 - 0.5*y3\n    c3 := 1.5*(y1-y2) + 0.5*(y3-y0)\n\n    return ((c3*x+c2)*x+c1)*x + c0\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574635578, "post_id": 59023124, "comment_id": 104291392, "body": "because <code>burst=2</code> ?"}, {"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574635609, "post_id": 59023124, "comment_id": 104291400, "body": "Sorry, I thought the <code>2</code> means <code>2</code> events should happen. How doI add things to the events then?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574635678, "post_id": 59023124, "comment_id": 104291414, "body": "<a href=\"https://godoc.org/golang.org/x/time/rate#Limiter.ReserveN\" rel=\"nofollow noreferrer\">godoc.org/golang.org/x/time/rate#Limiter.ReserveN</a> ?"}], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574635513, "creation_date": 1574635076, "last_edit_date": 1574635513, "question_id": 59023124, "link": "https://stackoverflow.com/questions/59023124/using-x-time-rate-limiter-to-determine-n-events-happen-within-seconds", "title": "Using x/time/rate.Limiter to determine N events happen within seconds", "body": "<p>I'm not understanding how Go's <a href=\"https://godoc.org/golang.org/x/time/rate\" rel=\"nofollow noreferrer\">rate limiter package</a> works. I want to use it to determine if some timestamps happen within a certain amount of time.</p>\n\n<pre><code>    var wg sync.WaitGroup\n    wg.Add(2)\n    limiter := rate.NewLimiter(rate.Every(100 * time.Second), 2)\n    go func(limiter *rate.Limiter) {\n        fmt.Println(\"Waiting!!\")\n            for {\n                if !limiter.Allow() {\n                    fmt.Println(\"Not allowed!!!\")\n                } else {\n                    fmt.Println(\"allowed!!\")\n                }\n            }\n\n        fmt.Println(\"done? blocked?\")\n    }(limiter)\n\n    wg.Wait()\n</code></pre>\n\n<p>Why is \"Not allowed!!!\" being printed even though I haven't added anything to the rate limiter to determine if 2 events happen in certain amount of seconds? </p>\n"}, {"tags": ["google-app-engine", "go"], "comments": [{"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1574623158, "post_id": 59021006, "comment_id": 104288288, "body": "The different runtime most likely has different timings, it&#39;s possible the migration simply brought your app overall closer to the deadline limit and the occasional spikes now cross that. Try to determine from the logs if the response times have all increased more or less proportionally, or just those of the odd peaks (i.e. if it&#39;s an overall increase or just some corner case-related one). With that info you could determine where you should focus your investigation."}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1574625713, "post_id": 59021006, "comment_id": 104288995, "body": "The different runtime acutally has decreased the overall response times. I have a public API endpoint where the average response time is 2.6sec and sometimes it just dies after 600sec. In general are 99.9% of all responses far far away from the deadline. Its really just random..."}, {"owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1574626443, "post_id": 59021006, "comment_id": 104289165, "body": "OK, so it&#39;s a corner case. Try to see if there&#39;s a pattern to those failures. Maybe same request path/handlers? If not maybe some common ops to all handlers for those requests? Maybe grouped close to instance (re)starts? Any traceback hints in the logs?"}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "edited": false, "score": 0, "creation_date": 1574627461, "post_id": 59021006, "comment_id": 104289407, "body": "The only pattern i can recognize is that it happends after the system had time to idle for 5+ minutes."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1574651302, "post_id": 59021006, "comment_id": 104294240, "body": "Does it happen when a new process is started (the logs show message <i>This request caused a new process to be started for your application...</i>)?"}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "edited": false, "score": 0, "creation_date": 1574667304, "post_id": 59021006, "comment_id": 104298506, "body": "I added some logs to my post. Here should be noted that it is filtered by the same request there are other requests in between. Its happens but it is not really a &quot;pattern&quot;."}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "edited": false, "score": 0, "creation_date": 1574667479, "post_id": 59021006, "comment_id": 104298566, "body": "I use a Cloud SQL client, Datastore client and Storage client. I initialize them just once at the startup. Is this a mistake?"}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574766979, "post_id": 59021006, "comment_id": 104339786, "body": "hey @Tiega, can provide me with this information: App Engine environment, error reporting (tracebacks) and one of your timeout error logs expanded from the Logging? I don&#39;t think initializing Cloud SQL client, Datastore client and Storage client once at the startup is a mistake and don&#39;t have to do with this issue."}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574791036, "post_id": 59021006, "comment_id": 104353163, "body": "@MethkalKhalawi there are no traces, the request comes and dies. I noticed that the requests not even reach the GO application. It dies within the nginx.... I also noticed that it always happens with the same client. The client doesn&#39;t send any header infos. I can even replicate the issue now, maybe this caueses problems in the nginx?"}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574853677, "post_id": 59021006, "comment_id": 104376196, "body": "Try to implement <a href=\"https://cloud.google.com/appengine/docs/standard/go/configuring-warmup-requests\" rel=\"nofollow noreferrer\">warmup requests</a> in your application. let me know if that solves your issue, so I can post it as a solution."}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574853885, "post_id": 59021006, "comment_id": 104376309, "body": "@MethkalKhalawi i already had. Like i sad i look like the request doesn&#39;t even reach my running Go-App, it seems do timeout before."}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574857227, "post_id": 59021006, "comment_id": 104378166, "body": "Can you post your app.yaml file? also explain the use case and the structure of your application?"}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574859661, "post_id": 59021006, "comment_id": 104379549, "body": "@MethkalKhalawi app.yaml added, its just basic. The Application is a ERP System. What you mean with Structure? Its an API-First and Controller-Repo-Model based system."}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574861725, "post_id": 59021006, "comment_id": 104380716, "body": "@Tiega, what do you mean in your previous comment by &quot;same client&quot;?"}, {"owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "reply_to_user": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574861998, "post_id": 59021006, "comment_id": 104380883, "body": "@MethkalKhalawi One of my users accessed a API via &quot;request-promise&quot; without any header. I contacted the user and ask to change it. Since then everything is stable. Seems to be a bug within the App Engine routing. I will try in a different Project later."}, {"owner": {"reputation": 1591, "user_id": 10053276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/831841800157687a198362eb5eface93?s=128&d=identicon&r=PG", "display_name": "Methkal Khalawi", "link": "https://stackoverflow.com/users/10053276/methkal-khalawi"}, "edited": false, "score": 0, "creation_date": 1574866650, "post_id": 59021006, "comment_id": 104383684, "body": "Please, let me know if this issue occurs again and if you have a support package, don&#39;t hesitate to contact us and <a href=\"https://cloud.google.com/support/docs/procedures#create_a_support_case\" rel=\"nofollow noreferrer\">create a case</a>. This will help us to have more visibility and troubleshoot your issue faster."}], "owner": {"reputation": 377, "user_id": 2214818, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/904dfd8f939241f50c468d2f27b25bd0?s=128&d=identicon&r=PG", "display_name": "Tiega", "link": "https://stackoverflow.com/users/2214818/tiega"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 89, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574859236, "creation_date": 1574620140, "last_edit_date": 1574859236, "question_id": 59021006, "link": "https://stackoverflow.com/questions/59021006/app-engine-gen-2-go-1-12-timeouts-since-migrated-from-go-1-9-gen1", "title": "App Engine Gen 2 Go 1.12 - timeouts since migrated from Go 1.9 Gen1", "body": "<p>Last week i migrated from GO 1.9 to GO 1.12. Since then i get random timeouts. With the following message:</p>\n\n<blockquote>\n  <p>Process terminated because the request deadline was exceeded. Please\n  ensure that your HTTP server is listening for requests on 0.0.0.0 and\n  on the port defined by the PORT environment variable. (Error code 123)</p>\n</blockquote>\n\n<p>Since the timeouts are seemingly random and most of the time its working, i would guess the server is correct configured....\nWarmup is configured and a quick look in the logs suggest that its working fine.</p>\n\n<p>I have no idea what to look for, maybe someone had similar issues?</p>\n\n<p>EDIT: Here some logs (all for the same request) - clone-id's simplified -</p>\n\n<blockquote>\n  <ul>\n  <li>16:36:17 - 200 after 1s (New process) - clone-id: 1</li>\n  <li>8x 16:41:07:xx - 502 after 604,7s (terminated - timeout) - clone-id:1</li>\n  <li>16:42 - 200 after 1,9s (New process) - clone-id: 2</li>\n  <li>16:42 - 200 after 2,1 (New process) - clone-id: 3</li>\n  <li>2x 16:50 - 502 after 24s (terminated - timeout) - clone-id: 1</li>\n  <li>3x 17:12:39 - 200 after 2,6s (New process) - clone-id: 4, 5, 6</li>\n  <li>4x 18:21:16 - 502 after 604,9s (terminated - timeout) - clone-id: 4</li>\n  </ul>\n</blockquote>\n\n<p>EDIT 2: I use a Cloud SQL client, Datastore client and Storage client. I initialize them just once at the startup. Is this a mistake?</p>\n\n<p>EDIT 3: I can replicate the issue now... it seems to be a problem when the client doesn't send any header information. The requests wont even reach the GO Application. When i use a small node-js app with \"request-promise\" to fire a bunch of requests it will die. Everytime.</p>\n\n<p>app.yaml:</p>\n\n<pre><code>runtime: go112\nenv: standard\ninstance_class: F2\ninbound_services:\n  - warmup\nhandlers:\n  - url: .*\n    script: auto\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "amazon-elastic-beanstalk", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1574689985, "post_id": 59020915, "comment_id": 104310162, "body": "AWS ELB is just a load balancer (it stands for Elastic Load Balancer), you can&#39;t deploy anything to it, and it doesn&#39;t provide specific environments for anything. Do you mean Elastic Beanstalk?"}, {"owner": {"reputation": 944, "user_id": 400988, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f1a8c286e4171d4f59f4a2ff36a1de3c?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/400988/ron"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574718749, "post_id": 59020915, "comment_id": 104323751, "body": "Yes, sorry about that. I meant Elastic Beanstalk. Been doing so much reading about it I got a bit mixed up. Edited the post"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574718836, "post_id": 59020915, "comment_id": 104323784, "body": "What version of Go are you running in EB?"}, {"owner": {"reputation": 944, "user_id": 400988, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f1a8c286e4171d4f59f4a2ff36a1de3c?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/400988/ron"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1574721076, "post_id": 59020915, "comment_id": 104324521, "body": "Thats a bit unclear. AWS docs (<a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/platforms/platform-history-go.html\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/elasticbeanstalk/latest/platforms/&hellip;</a>) state that version is 1.13, but the environment says GO 1. Which I can&#39;t imagine from installing a standard go environment."}, {"owner": {"reputation": 2396, "user_id": 1309818, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTYK5.jpg?s=128&g=1", "display_name": "Babu", "link": "https://stackoverflow.com/users/1309818/babu"}, "edited": false, "score": 0, "creation_date": 1582010898, "post_id": 59020915, "comment_id": 106618618, "body": "Check the answer <a href=\"https://stackoverflow.com/a/59913831/1309818\">stackoverflow.com/a/59913831/1309818</a>"}], "answers": [{"tags": [], "owner": {"reputation": 615, "user_id": 1320479, "user_type": "registered", "accept_rate": 28, "profile_image": "https://i.stack.imgur.com/jv5KS.png?s=128&g=1", "display_name": "NiBE", "link": "https://stackoverflow.com/users/1320479/nibe"}, "is_accepted": false, "score": 1, "last_activity_date": 1575363245, "creation_date": 1575363245, "answer_id": 59153299, "question_id": 59020915, "link": "https://stackoverflow.com/questions/59020915/how-do-i-deploy-a-go-app-with-modules-to-aws-eb/59153299#59153299", "title": "How do I deploy a Go app with modules to AWS EB", "body": "<p>I had the same problem, I was finally able to fix it adding this line in my build.sh script file:</p>\n\n<p><strong>sudo rm /var/app/current/go.*</strong></p>\n\n<p>So it is like this, in my case:</p>\n\n<pre><code>#!/usr/bin/env bash\n# Stops the process if something fails\nset -xe\n\nsudo rm /var/app/current/go.*\n\n# get all of the dependencies needed\ngo get \"github.com/gin-gonic/gin\"\ngo get \"github.com/jinzhu/gorm\"\ngo get \"github.com/jinzhu/gorm/dialects/postgres\"\ngo get \"github.com/appleboy/gin-jwt\"\n\n# create the application binary that eb uses\nGOOS=linux GOARCH=amd64 go build -o bin/application -ldflags=\"-s -w\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 2396, "user_id": 1309818, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/WTYK5.jpg?s=128&g=1", "display_name": "Babu", "link": "https://stackoverflow.com/users/1309818/babu"}, "edited": false, "score": 0, "creation_date": 1582010796, "post_id": 59913831, "comment_id": 106618573, "body": "This should be accepted as the answer. I did my experiment with the same and it works all the time I do <code>eb deploy</code>"}], "tags": [], "owner": {"reputation": 31, "user_id": 7617890, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8HfCShOjM_0/AAAAAAAAAAI/AAAAAAAAOA8/pchKME3fkSM/photo.jpg?sz=128", "display_name": "Molek Cazaplanetas", "link": "https://stackoverflow.com/users/7617890/molek-cazaplanetas"}, "is_accepted": false, "score": 3, "last_activity_date": 1582010386, "last_edit_date": 1582010386, "creation_date": 1579990063, "answer_id": 59913831, "question_id": 59020915, "link": "https://stackoverflow.com/questions/59020915/how-do-i-deploy-a-go-app-with-modules-to-aws-eb/59913831#59913831", "title": "How do I deploy a Go app with modules to AWS EB", "body": "<p>You can work with go modules.</p>\n\n<p><strong>build.sh</strong></p>\n\n<pre><code>#!/usr/bin/env bash\nset -xe\n\n# get all of the dependencies needed\ngo get\n\n# create the application binary that EB uses\ngo build -o bin/application application.go\n</code></pre>\n\n<p>and override GOPATH to point to $HOME which defaults to <code>/var/app/current</code> as given in the EB configuration management dashboard.</p>\n\n<p><strong>.ebextensions/go.config</strong></p>\n\n<pre><code>option_settings:\n    aws:elasticbeanstalk:application:environment:\n        GOPATH: /home/ec2-user\n</code></pre>\n"}], "owner": {"reputation": 944, "user_id": 400988, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/f1a8c286e4171d4f59f4a2ff36a1de3c?s=128&d=identicon&r=PG", "display_name": "Ron", "link": "https://stackoverflow.com/users/400988/ron"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 411, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1582010386, "creation_date": 1574619490, "last_edit_date": 1574718772, "question_id": 59020915, "link": "https://stackoverflow.com/questions/59020915/how-do-i-deploy-a-go-app-with-modules-to-aws-eb", "title": "How do I deploy a Go app with modules to AWS EB", "body": "<p>When I deploy the app, it runs fine on first install. But any following <code>eb deploy</code> procedures fail with an error that: <code>go.mod was found, but not expected</code>.\nIs there a specific configuration I have to set for deploying with Go modules?\nI switched to Dockerizing the app and deploying that way, which works fine. But it sounds a bit cumbersome to me as AWS Elastic Beanstalk provided specific Go environments. </p>\n"}, {"tags": ["mongodb", "go", "nosql"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 4, "creation_date": 1574620700, "post_id": 59020402, "comment_id": 104287587, "body": "What is a file other than its contents? Please clarify."}, {"owner": {"reputation": 11, "user_id": 12185961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0a7720b40c498aeeb992a18e5d39d77?s=128&d=identicon&r=PG&f=1", "display_name": "sec-social", "link": "https://stackoverflow.com/users/12185961/sec-social"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574625593, "post_id": 59020402, "comment_id": 104288963, "body": "@MarkusWMahlberg the file is of any kind could be a pdf, movie, mp3, ms office, etc."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 12185961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0a7720b40c498aeeb992a18e5d39d77?s=128&d=identicon&r=PG&f=1", "display_name": "sec-social", "link": "https://stackoverflow.com/users/12185961/sec-social"}, "is_accepted": false, "score": 0, "last_activity_date": 1574651793, "creation_date": 1574651793, "answer_id": 59024803, "question_id": 59020402, "link": "https://stackoverflow.com/questions/59020402/upload-file-to-mongodb-with-mongo-go-driver-using-gridfs/59024803#59024803", "title": "Upload file to MongoDB with mongo-go-driver using GridFS", "body": "<p>So as per this documentation <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo/gridfs\" rel=\"nofollow noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/mongo/gridfs</a>, we need to first create a new bucket with <code>NewBucket()</code>, than use <code>OpenUploadStream()</code> to initialize the upload stream, and finally we can upload the file with <code>uploadStream.Write()</code></p>\n\n<p>Here is the full source code of the solution <a href=\"https://gitlab.com/ykcab/mongo-gridfs\" rel=\"nofollow noreferrer\">https://gitlab.com/ykcab/mongo-gridfs</a>.</p>\n"}], "owner": {"reputation": 11, "user_id": 12185961, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a0a7720b40c498aeeb992a18e5d39d77?s=128&d=identicon&r=PG&f=1", "display_name": "sec-social", "link": "https://stackoverflow.com/users/12185961/sec-social"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 139, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1574651793, "creation_date": 1574616271, "question_id": 59020402, "link": "https://stackoverflow.com/questions/59020402/upload-file-to-mongodb-with-mongo-go-driver-using-gridfs", "title": "Upload file to MongoDB with mongo-go-driver using GridFS", "body": "<p>I looked the official GridFS documentation, and did some google search but there isn't any clear documentation on using GridFS in the official mongo-go-driver.</p>\n\n<p>So the further I could see is uploading the content of the file as below:</p>\n\n<pre><code>// Read the File\ndata, err := ioutil.ReadFile(\"data.txt\")\ncheck(err)\n.....\n// insert the collection to a document\nuplodedResult, err := fileCollection.InsertOne(ctx, bson.D{\n{\"file\", data},\n})\n</code></pre>\n\n<p>How do I upload the file instead not only its contents.</p>\n"}, {"tags": ["arrays", "for-loop", "go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1574617782, "creation_date": 1574617782, "answer_id": 59020639, "question_id": 59020197, "link": "https://stackoverflow.com/questions/59020197/duplicate-go-slices-key-values/59020639#59020639", "title": "Duplicate go slices key values", "body": "<p>You're reusing the same <code>devData</code> variable, and therefore its allocated memory, in each iteration of the <code>for</code> loop. This means that when you call <code>json.Unmarshal</code> and pass it the pointer to <code>devData</code> you're overwriting what has been written to that memory during the previous iteration.</p>\n\n<p>Instead of declaring the <code>devData</code> variable above the <code>if</code> statment, you should declare it inside the <code>for</code> loop to get a new segment of memory allocated for each of your iteration variables.</p>\n\n<hr>\n\n<p>Note that if the type of the variable is pointer-less then you could use your original approach since Go is pass-by-value and each time you pass a variable to a function, including <code>append</code>, a <em>shallow</em> copy of that variable's value gets created.</p>\n\n<p>However, since slices in go do hold a pointer to the first element of the slice the <code>Developer</code> type, because of its <code>Skills</code> field, does not qualify.</p>\n\n<p>And that is why you're seeing the <code>Name</code> field getting copied correctly, but the contents of the <code>Skills</code> field getting overwritten.</p>\n"}], "owner": {"reputation": 1685, "user_id": 4661744, "user_type": "registered", "accept_rate": 38, "profile_image": "https://lh4.googleusercontent.com/-OXVjBTYS9W0/AAAAAAAAAAI/AAAAAAAAACM/3OYwFVYCR3c/photo.jpg?sz=128", "display_name": "ujwal dhakal", "link": "https://stackoverflow.com/users/4661744/ujwal-dhakal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 59020639, "answer_count": 1, "score": 0, "last_activity_date": 1574617782, "creation_date": 1574614919, "last_edit_date": 1574615691, "question_id": 59020197, "link": "https://stackoverflow.com/questions/59020197/duplicate-go-slices-key-values", "title": "Duplicate go slices key values", "body": "<pre><code>type Developer struct {\n  Name        string   `json:\"name\"`\n  Skills      []interface{} `json:\"skills\"`\n}\n</code></pre>\n\n<p>This is my struct</p>\n\n<pre><code>var developers []Developer\nvar devData Developer\nif searchResult.TotalHits() &gt; 0 {\n    for _, hit := range searchResult.Hits.Hits {\n        err := json.Unmarshal(hit.Source, &amp;devData)\n        if err != nil {\n            fmt.Println(\"error\")\n        }\n        fmt.Println(devData.Skills) // utp here data are correct\n\n        developers = append(developers, devData)\n    }\n    //after loop data skills value are not correct\n}\n</code></pre>\n\n<p>but when actual data is made the skills are same throught all arrays</p>\n\n<pre><code>expected : ['name' : 'John Doe','skills': [\"php\",\"go\"]], ['name' : 'Rovvie Doe','skills': [\"java\",\"haskel]]\n\nBut output :  ['name' : 'John Doe','skills': [\"java\",\"haskel\"]], ['name' : 'Rovvie Doe','skills': [\"java\",\"haskel]]\n</code></pre>\n"}, {"tags": ["go", "build", "bazel"], "answers": [{"comments": [{"owner": {"reputation": 193, "user_id": 10193956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ea9b263c2971733ba905fa182f86587?s=128&d=identicon&r=PG&f=1", "display_name": "martinkaburu", "link": "https://stackoverflow.com/users/10193956/martinkaburu"}, "edited": false, "score": 0, "creation_date": 1574626009, "post_id": 59019571, "comment_id": 104289064, "body": "What do you think could be the cause for <b>found forbidden imports for <i>package_name</i></b>. Bazel Build is failing but the app compiles successfully and the imports work just fine."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 3, "last_activity_date": 1574611235, "creation_date": 1574611235, "answer_id": 59019571, "question_id": 59019448, "link": "https://stackoverflow.com/questions/59019448/what-is-the-difference-between-importmap-and-importpath-in-bazel-build-f/59019571#59019571", "title": "What is the difference between `importmap` and `importpath` in Bazel **BUILD** file", "body": "<p><code>importpath</code></p>\n\n<p><code>type: string</code></p>\n\n<p><code>default: required value</code></p>\n\n<blockquote>\n  <p>The source import path of this library. Other libraries can import\n  this library using this path. This must either be specified in\n  go_library or inherited from one of the libraries in embed.</p>\n</blockquote>\n\n<hr>\n\n<p><code>importmap</code></p>\n\n<p><code>type: string</code></p>\n\n<p><code>default: \"\"</code></p>\n\n<blockquote>\n  <p>The actual import path of this library. This is mostly only visible to\n  the compiler and linker, but it may also be seen in stack traces. This\n  may be set to prevent a binary from linking multiple packages with the\n  same import path e.g., from different vendor directories.</p>\n</blockquote>\n\n<hr>\n\n<p>Source: <a href=\"https://github.com/bazelbuild/rules_go/blob/master/go/core.rst#attributes\" rel=\"nofollow noreferrer\">Bazel Docs</a></p>\n"}], "owner": {"reputation": 193, "user_id": 10193956, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ea9b263c2971733ba905fa182f86587?s=128&d=identicon&r=PG&f=1", "display_name": "martinkaburu", "link": "https://stackoverflow.com/users/10193956/martinkaburu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1574611235, "creation_date": 1574610467, "question_id": 59019448, "link": "https://stackoverflow.com/questions/59019448/what-is-the-difference-between-importmap-and-importpath-in-bazel-build-f", "title": "What is the difference between `importmap` and `importpath` in Bazel **BUILD** file", "body": "<p>What different functionalities do these two declarations make in a <em>Golang</em> project <strong>Bazel BUILD</strong> file.</p>\n\n<p>example scenario:</p>\n\n<pre><code>go_library(\n    name = \"go_default_library\",\n    srcs = [\n        \"etcd.go\",\n        \"strategy.go\",\n    ],\n    importmap = \"path_to_package\",\n    importpath = \"path_to_package\",\n    deps = [\n        \"//path_to_dependacy:go_default_library\",\n        \"//path_to_dependacy:go_default_library\",\n        \"//path_to_dependacy:go_default_library\",\n],\n)\n</code></pre>\n"}, {"tags": ["go", "append", "slice"], "comments": [{"owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "edited": false, "score": 0, "creation_date": 1574623079, "post_id": 59019335, "comment_id": 104288259, "body": "Please comment why you are voting down this question so my future questions are in line with what is expected on Stack Overflow. Thanks!"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574623496, "post_id": 59019335, "comment_id": 104288398, "body": "Of course this is a duplicate of how to append slices. There is no fundamental difference between appending 17 and 18 slices."}, {"owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574624723, "post_id": 59019335, "comment_id": 104288731, "body": "I agree that there is no fundamental difference, but the question is not about the fundamental difference, it is about the concise syntax.Nick Corin advised me on using <code>a = append(a, append(b, c...)...)</code> to achieve it in one line."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1574639876, "post_id": 59019335, "comment_id": 104292170, "body": "There\u2019s no reason to search for \u201cone liners\u201d in go (or most languages for that matter). There\u2019s no global shortage on newline characters, and more readable alternatives still compile to the same instructions."}], "answers": [{"comments": [{"owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "edited": false, "score": 0, "creation_date": 1574611943, "post_id": 59019480, "comment_id": 104285120, "body": "Thank you, Nick! <code>a = append(a, append(b, c...)...)</code> is exactly what I was looking for as a one-liner solution"}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": true, "score": 3, "last_activity_date": 1574610659, "creation_date": 1574610659, "answer_id": 59019480, "question_id": 59019335, "link": "https://stackoverflow.com/questions/59019335/the-most-concise-way-to-concatenate-3-or-more-slices/59019480#59019480", "title": "The most concise way to concatenate 3 or more slices", "body": "<p>You could use your first method of using <code>append</code> like this:</p>\n\n<pre><code>a := []int{1, 2, 3, 4}\nb := []int{9, 8, 7, 6}\nc := []int{5, 4, 3, 2}\n\na = append(a, append(b, c...)...)\n</code></pre>\n\n<p>That being said, I think that your variadic <code>concat</code> function is cleaner and isn't very much code for a utility function.</p>\n\n<p><a href=\"https://play.golang.com/p/Y2lZidpVtIb\" rel=\"nofollow noreferrer\">(Go Playground Link)</a></p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 2231, "user_id": 9805867, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g1ebb.png?s=128&g=1", "display_name": "IvanD", "link": "https://stackoverflow.com/users/9805867/ivand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 59019480, "answer_count": 1, "score": -1, "last_activity_date": 1575234269, "creation_date": 1574609751, "last_edit_date": 1575234269, "question_id": 59019335, "link": "https://stackoverflow.com/questions/59019335/the-most-concise-way-to-concatenate-3-or-more-slices", "title": "The most concise way to concatenate 3 or more slices", "body": "<p>I am looking for a way to concisely and efficiently concatenate 3 or more slices in Go.</p>\n\n<p>Let's say I want to concatenate the following slices (all the code can be found here - <a href=\"https://play.golang.org/p/6682YiFF8qG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6682YiFF8qG</a>):</p>\n\n<pre><code>a := []int{1, 2, 3}\nb := []int{4, 5, 6}\nc := []int{7, 8, 9}\n</code></pre>\n\n<p>My first attempt is by using the append method:</p>\n\n<pre><code>d1 := append(a, b...)\nd1 = append(d1, c...) // [1 2 3 4 5 6 7 8 9]\n</code></pre>\n\n<p>However, this method is verbose and requires 2 append calls for concatenating three slices. So, for <code>n</code> slices, I will need <code>n-1</code> calls to append, which is not only verbose, but also inefficient as it requires multiple allocations.</p>\n\n<p>My next attempt is to create a variadic function to handle the concatenation with only one new slice allocation:</p>\n\n<pre><code>func concat(slicesOfSlices ...[]int) []int {\n    var totalLengthOfSlices int\n\n    for _, slice := range slicesOfSlices {\n        totalLengthOfSlices += len(slice)\n    }\n\n    arr := make([]int, 0, totalLengthOfSlices)\n\n    for _, slice := range slicesOfSlices {\n        arr = append(arr, slice...)\n    }\n\n    return arr\n}\n</code></pre>\n\n<p>Then I can use it as follows:</p>\n\n<pre><code>d2 := concat(a, b, c) // [1 2 3 4 5 6 7 8 9]\n</code></pre>\n\n<p>To illustrate, I want to emulate the following convenient functionality of the spread operator in JavaScript, which I often use in the following way:</p>\n\n<pre><code>const a = [1, 2, 3];\nconst b = [4, 5, 6];\nconst c = [7, 8, 9];\n\nconst d = [...a, ...b, ...c]; // [1, 2, 3, 4, 5, 6, 7, 8, 9]\n</code></pre>\n\n<p>In other words, I am looking for a way to do something like <code>d3 := append(a, b, c)</code> or <code>d3 := append(a, b..., c...)</code> but with the standard Go library or using less code than I did.</p>\n\n<h2>Note on possible duplicates</h2>\n\n<p>I don't think this is a duplicate of the question \"How to concatenate two slices\" as my question is about concatenating <strong>3 or more slices</strong> in the most concise and idiomatic way.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1574609469, "post_id": 59019254, "comment_id": 104284474, "body": "&quot;both should have Len method&quot; - that may be. What about <code>Less</code>? (and <code>Swap</code>, which you are not using here)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 6, "creation_date": 1574609552, "post_id": 59019254, "comment_id": 104284495, "body": "Neither slice nor string have Len method. Those are builtin types that can be passed into the the <code>len</code> function however that does not mean that they have a <code>Len</code> method or that they implement a <code>Len</code> method. None of the <a href=\"https://golang.org/pkg/builtin/\" rel=\"nofollow noreferrer\"><code>builtin</code></a> types have any methods, and also no <i>unnamed</i> (e.g. <code>[]string</code>) types have any methods, therefore they cannot implement <i>any</i> interface but the empty interface."}, {"owner": {"reputation": 9, "user_id": 6075468, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jxEN7.jpg?s=128&g=1", "display_name": "JinLing", "link": "https://stackoverflow.com/users/6075468/jinling"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574610082, "post_id": 59019254, "comment_id": 104284633, "body": "@mkopriva thank you so much for your help, I think I still have a long to go as a go newbie."}, {"owner": {"reputation": 67, "user_id": 12073111, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/D5i8M.jpg?s=128&g=1", "display_name": "Aibaend", "link": "https://stackoverflow.com/users/12073111/aibaend"}, "edited": false, "score": 0, "creation_date": 1574612611, "post_id": 59019254, "comment_id": 104285291, "body": "you can add filter to type by using &quot;reflect &quot; libary"}], "owner": {"reputation": 9, "user_id": 6075468, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/jxEN7.jpg?s=128&g=1", "display_name": "JinLing", "link": "https://stackoverflow.com/users/6075468/jinling"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1574623050, "creation_date": 1574609174, "last_edit_date": 1574623050, "question_id": 59019254, "link": "https://stackoverflow.com/questions/59019254/sort-interface-as-argument", "title": "sort.Interface as argument", "body": "<pre><code>func IsPalindrome(s sort.Interface) bool {\n    for lo, hi := 0, s.Len()-1; lo &lt; hi; {\n        if s.Less(lo, hi) || s.Less(hi, lo) {\n            return false\n        }\n        lo++\n        hi--\n    }\n    return true\n}\n</code></pre>\n\n<p>I am implementing a palindrome checker for any type which satisfy sort interface. I also have test case like this:</p>\n\n<pre><code>func TestIsPalindrome(t *testing.T) {\n    tests := []struct {\n        a sort.Interface\n        r bool\n    }{\n        {a: []int{1, 3, 1}, r: true},\n        {a: \"helloolled\", r: true},\n        {a: \"The Go Programming Language\", r: false},\n    }\n\n    for row, test := range tests {\n        assert.Equal(t, test.r, IsPalindrome(test.a), \"row: %d\\n\", row)\n    }\n}\n</code></pre>\n\n<p>but it complains that</p>\n\n<pre><code>cannot use []int literal (type []int) as type sort.Interface in field value:\n    []int does not implement sort.Interface (missing Len method)\ncannot use \"helloolled\" (type string) as type sort.Interface in field value:\n    string does not implement sort.Interface (missing Len method)\n....\n</code></pre>\n\n<p>I think []int is a slice, \"helloolled\" is string, both should have Len method.</p>\n\n<p>What's wrong with my code?</p>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 3, "creation_date": 1574604435, "post_id": 59018372, "comment_id": 104282997, "body": "you <code>go func() { wg.Wait();close(r); }()</code>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1574629640, "post_id": 59018372, "comment_id": 104289947, "body": "Think of the <code>wg</code> WaitGroup as a counter for the <i>writer group</i>. You need some set of entities (collectively, &quot;writers&quot;) that write to the channel and close it when done. To make that <i>easy</i>, you can have n (n==2 at the moment) &quot;writers&quot; that actually write, plus one extra non-writing &quot;writer group member&quot; that simply waits for the other writers to say &quot;done&quot; and then does the <code>close</code>. That&#39;s the anonymous function in mh-cbon&#39;s comment and Nick Corin&#39;s answer."}], "answers": [{"comments": [{"owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "edited": false, "score": 0, "creation_date": 1574631294, "post_id": 59019405, "comment_id": 104290369, "body": "Thank you! Sorry I didn&#39;t think of something so basic. Appreciated, it all makes sense now."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": true, "score": 5, "last_activity_date": 1574673408, "last_edit_date": 1574673408, "creation_date": 1574610168, "answer_id": 59019405, "question_id": 59018372, "link": "https://stackoverflow.com/questions/59018372/how-do-i-correctly-close-shared-channels-in-goroutines-while-processing-results/59019405#59019405", "title": "How do I correctly close shared channels in Goroutines while processing results", "body": "<p>I've edited your code to work without deadlocks. The trouble is that receiving on the channel is blocking the main thread and neither of your two <code>goroutines</code> are sending any more data.</p>\n\n<p>This solution runs a new <code>goroutine</code> which closes the results channel once the <code>WaitGroup</code> is done.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc worker1(r chan string, wg *sync.WaitGroup) {\n    for i := 0; i &lt; 5; i++ {\n        r &lt;- fmt.Sprintf(\"1.%d\", i)\n    }\n\n    wg.Done()\n}\n\nfunc worker2(r chan string, wg *sync.WaitGroup) {\n    for i := 0; i &lt; 5; i++ {\n        r &lt;- fmt.Sprintf(\"2.%d\", i)\n    }\n\n    wg.Done()\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    r := make(chan string)\n    wg.Add(2)\n    go worker1(r, &amp;wg)\n    go worker2(r, &amp;wg)\n\n    go func() {\n        defer close(r)\n        wg.Wait()\n    }()\n\n    for i := range r {\n        fmt.Printf(\"Got job result: %s\\n\", i)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.com/p/lC0mTi8gxbU\" rel=\"nofollow noreferrer\">(Go Playground)</a></p>\n"}], "owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 59019405, "answer_count": 1, "score": 1, "last_activity_date": 1574673408, "creation_date": 1574603600, "question_id": 59018372, "link": "https://stackoverflow.com/questions/59018372/how-do-i-correctly-close-shared-channels-in-goroutines-while-processing-results", "title": "How do I correctly close shared channels in Goroutines while processing results", "body": "<p>I'm attempting to find the correct method of using results produced by worker go routines while also gracefully exiting the results loop when all the work is completed. To illustrate, I've made the following example. My real world case varies slightly from this example in that I don't know how much \"work\" each worker go routine will return, where as obviously these for loops are performing a fixed number of results (5). </p>\n\n<p>I'm new to goroutines and channels, but the following are basic tenants as I understand them;</p>\n\n<ul>\n<li>Only senders should close a channel</li>\n<li>Performing <code>range</code> over a channel will continue until the channel is closed </li>\n</ul>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc worker1(r chan string, wg *sync.WaitGroup) {\n    for i := 0; i &lt; 5; i++ {\n        r &lt;- fmt.Sprintf(\"1.%d\", i)\n    }\n\n    wg.Done()\n}\n\nfunc worker2(r chan string, wg *sync.WaitGroup) {\n    for i := 0; i &lt; 5; i++ {\n        r &lt;- fmt.Sprintf(\"2.%d\", i)\n    }\n\n    wg.Done()\n}\n\nfunc main() {\n    var wg sync.WaitGroup\n\n    r := make(chan string)\n    wg.Add(2)\n    go worker1(r, &amp;wg)\n    go worker2(r, &amp;wg)\n\n    for i := range r {\n        fmt.Printf(\"Got job result: %s\\n\", i)\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>This example is deadlocking because the range loop never exits, as the channel never closes. I can perform a close on the channel once the work is done (i.e. replace <code>wg.Done()</code> with <code>close(r)</code>), but then I get a panic when the other worker goroutine attempts to send further results to the already closed channel. </p>\n\n<p>Finally I figure I can move the <code>wg.Wait()</code> to above the results loop, close the channel once it has been completed, and then start printing results, but that implies I cannot print any results until all work has been completed on all threads. </p>\n\n<p><em>What is the correct way to gracefully exit the results loop once all worker threads have finished, while also not waiting until all of the work has been completed before beginning to print results?</em></p>\n"}, {"tags": ["go", "apache-kafka", "segment-io"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 10215182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20277dc0941db14b213cd5abd8e77c32?s=128&d=identicon&r=PG&f=1", "display_name": "Sumit Sardana", "link": "https://stackoverflow.com/users/10215182/sumit-sardana"}, "edited": false, "score": 0, "creation_date": 1574606295, "post_id": 59017858, "comment_id": 104283552, "body": "Thanks Mike, Worked as you said. Thanks :)"}], "tags": [], "owner": {"reputation": 9357, "user_id": 12208910, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CQcCI.jpg?s=128&g=1", "display_name": "mike", "link": "https://stackoverflow.com/users/12208910/mike"}, "is_accepted": false, "score": 1, "last_activity_date": 1574600110, "creation_date": 1574600110, "answer_id": 59017858, "question_id": 59017342, "link": "https://stackoverflow.com/questions/59017342/read-latest-message-from-kafka-segmentio-kafka-go/59017858#59017858", "title": "Read latest message from kafka - segmentio/kafka-go", "body": "<p>What you need to know about consuming messages from Kafka is that each consumer client is part of a <a href=\"https://kafka.apache.org/documentation/#intro_consumers\" rel=\"nofollow noreferrer\">Consumer Group</a>. Kafka stores the already processed offset of each consumer group of a topic so it knows where to continue in case the consumer clients has been stopped and re-started. In that way it can be avoided to read the same messages multiple times. This information is stored in an internal Kafka topic called __consumer_offsets.</p>\n\n<p>In your case it means, that you have to ensure that you specify the Consumer Group (in the <a href=\"https://kafka.apache.org/documentation/#consumerconfigs\" rel=\"nofollow noreferrer\">KafkaConsumer API</a> it is the configuration \"group.id\") and keep it constant. Only then you will be able to continue reading from the latest/new message and not starting from beginning every time. Of course, you have to once start consuming the topic from beginning.</p>\n"}], "owner": {"reputation": 11, "user_id": 10215182, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/20277dc0941db14b213cd5abd8e77c32?s=128&d=identicon&r=PG&f=1", "display_name": "Sumit Sardana", "link": "https://stackoverflow.com/users/10215182/sumit-sardana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 842, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1574600110, "creation_date": 1574596318, "question_id": 59017342, "link": "https://stackoverflow.com/questions/59017342/read-latest-message-from-kafka-segmentio-kafka-go", "title": "Read latest message from kafka - segmentio/kafka-go", "body": "<p>I'm using segmentio/kafka-go client to read messages from a topic.\nI'm unable to find.. how to start reading from last/new message.</p>\n\n<p>Everytime I start the code, it starts reading from beginning offset in that partition.</p>\n"}, {"tags": ["go", "struct", "reflection", "tags"], "answers": [{"comments": [{"owner": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "edited": false, "score": 0, "creation_date": 1574617558, "post_id": 59016440, "comment_id": 104286652, "body": "Understood. In line 12 should it be <code>ft.Type</code> followed by <code>ft = ft.Elem()</code> in line 14 and <code>ParseStruct(ft, tag)</code> in line 25?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "edited": false, "score": 1, "creation_date": 1574661721, "post_id": 59016440, "comment_id": 104296592, "body": "@dikshant it would be <code>ft.Kind()</code> at line 12 (unchanged), otherwise you are correct."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1574661653, "last_edit_date": 1574661653, "creation_date": 1574589092, "answer_id": 59016440, "question_id": 59014705, "link": "https://stackoverflow.com/questions/59014705/extracting-tags-from-deeply-nested-structs-using-reflection/59016440#59016440", "title": "Extracting tags from deeply nested structs using reflection", "body": "<p>Both <code>reflect.Type</code> and <code>reflect.Value</code> has an <code>Elem()</code> methods. As per <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\">document</a>,</p>\n\n<p><code>Elem</code> method of <code>Type</code>.</p>\n\n<pre><code>// Elem returns a type's element type.\n// It panics if the type's Kind is not Array, Chan, Map, Ptr, or Slice.\nElem() Type\n</code></pre>\n\n<p><code>Value.Elem</code>:</p>\n\n<pre><code>func (v Value) Elem() Value\n\nElem returns the value that the interface v contains or that the pointer v points to. It panics if v's Kind is not Interface or Ptr. It returns the zero Value if v is nil. \n</code></pre>\n\n<p>You can use <code>Elem()</code> method to get the content of the pointer and then use the content to recurse. However, given that your orignal API is <code>func(interface{},string)</code>, you need to use <code>Value.Elem().Interface()</code> to get a meaningful <code>interface{}</code>. But instead of that, I suggest you change the API to accept <code>reflect.Type</code> - for this is most clear for tag extraction.</p>\n\n<p>Example code:</p>\n\n<pre><code>func ParseStruct(t reflect.Type, tag string) {\n    if t.Kind() == reflect.Ptr {\n        t = t.Elm()\n    }\n    if t.Kind() != reflect.Struct {\n        return\n    }\n\n    for i := 0; i &lt; t.NumField(); i++ {\n        f := t.Field(i)\n        value := f.Tag.Get(tag)\n        ft := t.Type\n        if ft.Kind() == reflect.Ptr {\n            ft = ft.Elem()\n        }\n\n        // It seems that you don't want a tag from an struct field; only other fields' tags are needed\n        if ft.Kind() != reflect.Struct {\n            if len(value) != 0 {\n                fmt.Println(value)\n            }\n            continue\n        }\n\n        ParseStruct(ft,tag)\n    }\n}\n</code></pre>\n\n<p>Note this code is very simple - it does not process tags of structs in slices or maps.</p>\n"}, {"tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": false, "score": 0, "last_activity_date": 1574591216, "creation_date": 1574591216, "answer_id": 59016689, "question_id": 59014705, "link": "https://stackoverflow.com/questions/59014705/extracting-tags-from-deeply-nested-structs-using-reflection/59016689#59016689", "title": "Extracting tags from deeply nested structs using reflection", "body": "<blockquote>\n  <p>when I encounter a field that is pointer how do I get its value and\n  then recurse?</p>\n</blockquote>\n\n<p>when you encounter a pointer, over <code>reflect.Value</code> or <code>reflect.Type</code>, you got to take the <code>Elem()</code> to proceed forward.</p>\n\n<p><code>reflect.ValueOf(new(string)).Elem()</code> goes from the value <code>*string</code> to <code>string</code></p>\n\n<p><code>reflect.TypeOf(new(string)).Elem()</code> goes from the type <code>*string</code> to <code>string</code></p>\n"}], "owner": {"reputation": 524, "user_id": 4695952, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/ddbb13b83fa0193327392265d2b94963?s=128&d=identicon&r=PG&f=1", "display_name": "Dikshant Adhikari", "link": "https://stackoverflow.com/users/4695952/dikshant-adhikari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 59016440, "answer_count": 2, "score": 0, "last_activity_date": 1574661653, "creation_date": 1574570216, "last_edit_date": 1574591054, "question_id": 59014705, "link": "https://stackoverflow.com/questions/59014705/extracting-tags-from-deeply-nested-structs-using-reflection", "title": "Extracting tags from deeply nested structs using reflection", "body": "<p>I am trying to extract some tags from some deeply nested structs. The structs were generated from a protobuf message and contain a json tag. </p>\n\n<p>I have pointer to a struct that may contain a struct with fields whose tags that I may want. I can iterate using the type to get the fields of a struct but when I encounter a field that is pointer how do I get its value and then recurse?</p>\n\n<pre><code>// Struct has hierarchy like this \na := &amp;somepb.UpdateRequest{\n        Updates: []*somepb.UpdateRequest_Foo{\n            &amp;somepb.UpdateRequest_Foo{\n                Id: 1,\n                Foo: &amp;somepb.FooInfo{\n                    Metadata: &amp;somepb.Metadata{\n                        Name:        \"Foo\",\n                        Description: \"Bar\",\n                    },\n                    Some:    \"s\",\n                    Things:  \"o\",\n                    Are:     \"m\",\n                    Broken:  \"e\",\n                    Here:    \"p\",\n                },\n            },\n        },\n } \n\n// ParseStruct parses struct tags of given object\nfunc ParseStruct(obj interface{}, tag string) {\n    r := reflect.ValueOf(obj)\n    if r.Kind() == reflect.Ptr {\n        obj = r.Elem().Interface()\n    }\n    rv := reflect.TypeOf(obj)\n    for i := 0; i &lt; rv.NumField(); i++ {\n        f := rv.Field(i)\n        // This is to avoid getting tags for Metadata itself (from the struct above)\n        // which is *Metadata, I want the tags for Name and Description\n        // inside *Metadata instead\n        if f.Type.Kind() == reflect.Ptr {\n            value := f.Tag.Get(tag)\n            if len(value) == 0 {\n                continue\n            }\n            fmt.Println(value)\n        }\n    }\n} \n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574586366, "post_id": 59014404, "comment_id": 104278926, "body": "Never call packages or files &quot;test&quot;. Export you stuff. Even without the module error your code would never work."}], "answers": [{"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 0, "last_activity_date": 1574567281, "creation_date": 1574567281, "answer_id": 59014473, "question_id": 59014404, "link": "https://stackoverflow.com/questions/59014404/referencing-a-go-module-that-is-local/59014473#59014473", "title": "Referencing a Go module that is local", "body": "<p>cd into <code>github.com/Company/test</code>, </p>\n\n<p>try <code>go mod edit --replace=github.com/Company/mymodule=../mymodule</code> </p>\n"}, {"tags": [], "owner": {"reputation": 3184, "user_id": 703264, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/d1Se3.jpg?s=128&g=1", "display_name": "Howard", "link": "https://stackoverflow.com/users/703264/howard"}, "is_accepted": false, "score": 0, "last_activity_date": 1574568915, "last_edit_date": 1574568915, "creation_date": 1574568570, "answer_id": 59014571, "question_id": 59014404, "link": "https://stackoverflow.com/questions/59014404/referencing-a-go-module-that-is-local/59014571#59014571", "title": "Referencing a Go module that is local", "body": "<p>The go.mod in test module could be:</p>\n\n<pre><code>module github.com/Company/test\nrequire github.com/Company/mymodule v0.0.0\nreplace github.com/Company/mymodule v0.0.0 =&gt; ../mymodule\ngo 1.12\n</code></pre>\n\n<p>PS. <em>sayHello</em> function name must be <strong>capitalized</strong>. Then it becomes public and exportable to the other modules.</p>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 2554021, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/fnLON.png?s=128&g=1", "display_name": "sigz", "link": "https://stackoverflow.com/users/2554021/sigz"}, "edited": false, "score": 0, "creation_date": 1612307121, "post_id": 59015137, "comment_id": 116725120, "body": "Is it possible to place the replace directive in a separated file module file ? It seems weird and dangerous to have to modify a potentialy versionned file to make some dependencies tests.."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": true, "score": 0, "last_activity_date": 1574589190, "last_edit_date": 1574589190, "creation_date": 1574575923, "answer_id": 59015137, "question_id": 59014404, "link": "https://stackoverflow.com/questions/59014404/referencing-a-go-module-that-is-local/59015137#59015137", "title": "Referencing a Go module that is local", "body": "<p>When resolving dependencies in your <code>go.mod</code>, Go will try to resolve the third-party modules by fetching them from the remote URL that you've provided.</p>\n\n<p>The remote URL, unless you've pushed it to GitHub for example, doesn't exist. This is when you get an error like this:</p>\n\n<pre><code>cannot load github.com/Company/mymodule: cannot find module providing package github.com/Company/mymodule\n</code></pre>\n\n<p>There is a work-around for local modules, you can use the <code>replace</code> keyword in your <code>go.mod</code> file.</p>\n\n<pre><code>replace github.com/Company/mymodule v0.0.0 =&gt; ../mymodule\n</code></pre>\n\n<p>This will let Go know where to find your local dependency. Just make sure to use the correct relative path to your module.</p>\n\n<p>Once your local tests are complete and you've pushed your module to a repository, then you can remove the <code>replace</code> line from your <code>go.mod</code> and use</p>\n\n<pre><code>go get -u github.com/Company/mymodule`\n</code></pre>\n\n<p>to get the module correctly working alongside your current project.</p>\n\n<p>As a side note, functions and variables in Go packages should start with a capital letter to be accessible from outside the package itself.</p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 57, "user_id": 12106502, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/716a6118027cfdd1789e4da5e91ad757?s=128&d=identicon&r=PG&f=1", "display_name": "Keerthi", "link": "https://stackoverflow.com/users/12106502/keerthi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1539, "favorite_count": 0, "closed_date": 1574587907, "accepted_answer_id": 59015137, "answer_count": 3, "score": 0, "last_activity_date": 1574589190, "creation_date": 1574566383, "question_id": 59014404, "link": "https://stackoverflow.com/questions/59014404/referencing-a-go-module-that-is-local", "closed_reason": "Duplicate", "title": "Referencing a Go module that is local", "body": "<p>I've been unsuccessful in importing a package from a local project (a Go module). Here is a brief of what I'm trying:</p>\n\n<p>I created a Go module package like so:</p>\n\n<pre><code>  $ cd \n  $ mkdir mymodule\n  $ cd mymodule\n  $ go mod init github.com/Company/mymodule\n</code></pre>\n\n<p>Then I added <code>hello.go</code> under the <code>mymodule</code> with a little function </p>\n\n<pre><code>// mymodule/hello.go\n\npackage mymodule\n\nfunc sayHello() string {\n    return \"Hello\"\n}\n</code></pre>\n\n<p><code>go build</code> was successful.</p>\n\n<p><strong>Note that the module is not pushed to github repository yet</strong>. I want to use (and perhaps test) mymodule before I push to github. So I created another package, like so:</p>\n\n<pre><code>  $ cd \n  $ mkdir test\n  $ cd test\n  $ go mod init github.com/Company/test\n</code></pre>\n\n<p>Then, created a new file <code>test.go</code> under the <code>test</code> directory and in there I try to import <code>mymodule</code>, like so:</p>\n\n<pre><code>// test/test.go\n\nimport (\n    \"fmt\"\n    \"github.com/Company/mymodule\"\n)\n\nfunc testMyModule() {\n    fmt.Println(mymodule.sayHello())\n}\n\n</code></pre>\n\n<p>But <code>go build</code> of <code>test</code> fails with the below error. What gives?</p>\n\n<pre><code>cannot load github.com/Company/mymodule: cannot find module providing package github.com/Company/mymodule\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574591328, "post_id": 59014085, "comment_id": 104279899, "body": "to put it in very simple words, this loop has more than one exit condition, thus the infinite <code>for</code> loop."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 11521907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af69a33ad20de66598a66b8edab346dc?s=128&d=identicon&r=PG&f=1", "display_name": "sad_jane", "link": "https://stackoverflow.com/users/11521907/sad-jane"}, "edited": false, "score": 0, "creation_date": 1574567058, "post_id": 59014228, "comment_id": 104276257, "body": "ok, that makes sense now, I am just not clear about this part of your answer <code>Unlike src.Read()\u2014which is allowed to only read, say, 1k instead of the full 32k\u2014the next chunk of code requires that dst.Write() write all 32k</code>, I thought that write will get the same number of bytes read"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 23, "user_id": 11521907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af69a33ad20de66598a66b8edab346dc?s=128&d=identicon&r=PG&f=1", "display_name": "sad_jane", "link": "https://stackoverflow.com/users/11521907/sad-jane"}, "edited": false, "score": 0, "creation_date": 1574568405, "post_id": 59014228, "comment_id": 104276416, "body": "The call to <code>dst.Write(buf[0:nr])</code> passes a slice whose length is <code>nr</code>. That function <i>can</i> return a short count, such as, say, 1024. What I&#39;m getting at here is that if the call to <code>src.Read()</code> (which passes a 32k buffer in this example) returns 1024, the call to <code>dst.Write</code> passes just 1k to it and it should return 1k and all is fine. But if the call to <code>src.Read()</code> returns 32k and the call to <code>dst.Write()</code> passes 32k and <code>dst.Write()</code> returns 1k, the overall <code>copyBuffer</code> code will <b>return an error</b>. So it&#39;s not symmetric."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 23, "user_id": 11521907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af69a33ad20de66598a66b8edab346dc?s=128&d=identicon&r=PG&f=1", "display_name": "sad_jane", "link": "https://stackoverflow.com/users/11521907/sad-jane"}, "edited": false, "score": 0, "creation_date": 1574568438, "post_id": 59014228, "comment_id": 104276418, "body": "In fewer words: The reader can return a short read, and all is fine. (The shortened read becomes the full size of the read-and-then-write.) The writer <b>must not</b> return a shortened write; if he does so, <code>copyBuffer</code> <b>fails</b>."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1574566532, "last_edit_date": 1574566532, "creation_date": 1574563860, "answer_id": 59014228, "question_id": 59014085, "link": "https://stackoverflow.com/questions/59014085/why-copybuffer-implements-while-loop/59014228#59014228", "title": "Why copyBuffer implements while loop", "body": "<p>Let's assume that <code>src</code> does not implement <code>WriterTo</code> and <code>dst</code> does not implement <code>ReaderFrom</code>, since otherwise we would not get down to the <code>for</code> loop at all.</p>\n\n<p>Let's further assume, for simplicity, that <code>src</code> does not implement <code>LimitedReader</code>, so that <code>size</code> is <code>32 * 1024</code>: 32 kBytes.  (There is no real loss of generality here as <code>LimitedReader</code> just allows the source to pick an even smaller number, at least in this case.)</p>\n\n<p>Finally, let's assume <code>buf</code> is <code>nil</code>.  (Or, if it's not nil, let's assume it has a capacity of 32768 bytes.  If it has a large capacity, we can just change the rest of the assumptions below, so that <code>src</code> has more bytes than there are in the buffer.)</p>\n\n<p>So: we enter the loop with <code>size</code> holding the size of the temporary buffer <code>buf</code>, which is 32k.  Now suppose the source is a file that holds 64k.  It will take at least two <code>src.Read()</code> calls to read it!  Clearly we need an outer loop.  That's the overall <code>for</code> here.</p>\n\n<p>Now suppose that <code>src.Read()</code> really does read the full 32k, so that <code>nr</code> is also <code>32 * 1024</code>.  The code will now call <code>dst.Write()</code>, passing the full 32k of data.  Unlike <code>src.Read()</code>\u2014which is allowed to only read, say, 1k instead of the full 32k\u2014the next chunk of code requires that <code>dst.Write()</code> write all 32k.  If it doesn't, the loop will <code>break</code> with <code>err</code> set to <code>ErrShortWrite</code>.</p>\n\n<p>(An alternative would have been to keep calling <code>dst.Write()</code> with the remaining bytes, so that <code>dst.Write()</code> could write only 1k of the 32k, requiring 32 calls to get it all written.)</p>\n\n<p>Note that <code>src.Read()</code> can choose to read only, say, 1k instead of 32k.  If the actual file is 64k, it will then take 64 trips, rather than 2, through the outer loop.  (An alternative choice would have been to force such a reader to implement the <code>LimitedReader</code>interface.  That's not as flexible, though, and is not what <code>LimitedReader</code> is intended for.)</p>\n"}, {"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": false, "score": 1, "last_activity_date": 1574564699, "last_edit_date": 1574564699, "creation_date": 1574564357, "answer_id": 59014253, "question_id": 59014085, "link": "https://stackoverflow.com/questions/59014085/why-copybuffer-implements-while-loop/59014253#59014253", "title": "Why copyBuffer implements while loop", "body": "<p><code>func copyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error)</code>\nwhen the total data size to copy if larger than <code>len(buf)</code>, <code>nr, er := src.Read(buf)</code> will try read at most <code>len(buf)</code> data every time. </p>\n\n<p>that's how <code>copyBuffer</code> works:</p>\n\n<pre><code>for {\n   copy `len(buf)` data from `src` to `dst`;\n   if EOF {\n       //done\n       break;\n   }\n   if other Errors {\n        return Error\n   }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 0, "last_activity_date": 1574570775, "last_edit_date": 1574570775, "creation_date": 1574570166, "answer_id": 59014698, "question_id": 59014085, "link": "https://stackoverflow.com/questions/59014085/why-copybuffer-implements-while-loop/59014698#59014698", "title": "Why copyBuffer implements while loop", "body": "<p>In the normal case, you would just call <a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\"><code>Copy</code></a> rather than <a href=\"https://golang.org/pkg/io/#CopyBuffer\" rel=\"nofollow noreferrer\"><code>CopyBuffer</code></a>.</p>\n\n<pre><code>func Copy(dst Writer, src Reader) (written int64, err error) {\n    return copyBuffer(dst, src, nil)\n}\n</code></pre>\n\n<p>The option to have a user-supplied buffer is, I think, just for extreme optimization scenarios.  The use of the word \"<code>Buffer</code>\" in the name is possibly a source of confusion since the function is <em>not</em> copying the buffer -- just using it internally.</p>\n\n<p>There are two reasons for the looping...</p>\n\n<ol>\n<li>The buffer might not be large enough to copy all of the data (the size of which is not necessarily known in advance) in one pass.</li>\n<li><a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>Reader</code></a>, though not <a href=\"https://golang.org/pkg/io/#Writer\" rel=\"nofollow noreferrer\">'Writer'</a>, may return partial results when it makes sense to do so.</li>\n</ol>\n\n<p>Regarding the second item, consider that the <code>Reader</code> does not necessarily represent a fixed file or data  buffer.  It could, instead, be a live stream from some other thread or process.  As such, there are many valid scenarios for stream data to be read and processed on an as-available basis.  <em>Although <code>CopyBuffer</code> doesn't do this, it still has to work with such behaviors from any <code>Reader</code>.</em></p>\n"}], "owner": {"reputation": 23, "user_id": 11521907, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af69a33ad20de66598a66b8edab346dc?s=128&d=identicon&r=PG&f=1", "display_name": "sad_jane", "link": "https://stackoverflow.com/users/11521907/sad-jane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 59014228, "answer_count": 3, "score": 1, "last_activity_date": 1574587842, "creation_date": 1574561871, "last_edit_date": 1574587842, "question_id": 59014085, "link": "https://stackoverflow.com/questions/59014085/why-copybuffer-implements-while-loop", "title": "Why copyBuffer implements while loop", "body": "<p>I am trying to understand how <code>copyBuffer</code> works under the hood, but what is not clear to me is the use of while loop</p>\n\n<pre><code>for {\n        nr, er := src.Read(buf)\n        //...\n}\n</code></pre>\n\n<p>Full code below:</p>\n\n<pre><code>// copyBuffer is the actual implementation of Copy and CopyBuffer.\n// if buf is nil, one is allocated.\nfunc copyBuffer(dst Writer, src Reader, buf []byte) (written int64, err error) {\n    // If the reader has a WriteTo method, use it to do the copy.\n    // Avoids an allocation and a copy.\n    if wt, ok := src.(WriterTo); ok {\n        return wt.WriteTo(dst)\n    }\n    // Similarly, if the writer has a ReadFrom method, use it to do the copy.\n    if rt, ok := dst.(ReaderFrom); ok {\n        return rt.ReadFrom(src)\n    }\n    size := 32 * 1024\n    if l, ok := src.(*LimitedReader); ok &amp;&amp; int64(size) &gt; l.N {\n        if l.N &lt; 1 {\n            size = 1\n        } else {\n            size = int(l.N)\n        }\n    }\n    if buf == nil {\n        buf = make([]byte, size)\n    }\n    for {\n        nr, er := src.Read(buf)\n        if nr &gt; 0 {\n            nw, ew := dst.Write(buf[0:nr])\n            if nw &gt; 0 {\n                written += int64(nw)\n            }\n            if ew != nil {\n                err = ew\n                break\n            }\n            if nr != nw {\n                err = ErrShortWrite\n                break\n            }\n        }\n        if er != nil {\n            if er != EOF {\n                err = er\n            }\n            break\n        }\n    }\n    return written, err\n}\n</code></pre>\n\n<p>It writes to <code>nw, ew := dst.Write(buf[0:nr])</code> when <code>nr</code> is the number of bytes read, so why is the <code>while loop</code> necessary?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3611, "user_id": 11810946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/adf8bed7e8aa9c830f4aa4e889c58175?s=128&d=identicon&r=PG&f=1", "display_name": "Brits", "link": "https://stackoverflow.com/users/11810946/brits"}, "edited": false, "score": 1, "creation_date": 1574585233, "post_id": 59013649, "comment_id": 104278710, "body": "To get an answer you will probably need to provide enough code to duplicate the issue (e.g. <a href=\"https://play.golang.org/p/SX_EK9ySNrA\" rel=\"nofollow noreferrer\">play.golang.org/p/SX_EK9ySNrA</a> - this gives me two cookies). Perhaps try <a href=\"https://github.com/juju/persistent-cookiejar\" rel=\"nofollow noreferrer\">github.com/juju/persistent-cookiejar</a> which adds, amoungst other things, an AllCookies() function (in case the cookies are not on the domain you are expecting)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1574586699, "post_id": 59013649, "comment_id": 104279004, "body": "The cookies might have a different path than &quot;/&quot; and won&#39;t show for &quot;/&quot;. There is basically no reliable way of peeking into a net/http/cookiejar unless you exactly know what to look for. There are drop in replacements for net/http/cookiejar which let you iterate of all cookies stored but net/http/cookiejar does not allow this."}], "answers": [{"tags": [], "owner": {"reputation": 6709, "user_id": 3640161, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/065307b80129366f064b9b99811658aa?s=128&d=identicon&r=PG", "display_name": "Tiago Lopo", "link": "https://stackoverflow.com/users/3640161/tiago-lopo"}, "is_accepted": false, "score": 0, "last_activity_date": 1574677180, "creation_date": 1574677180, "answer_id": 59029577, "question_id": 59013649, "link": "https://stackoverflow.com/questions/59013649/unable-to-obtain-cookies-from-cookiejar/59029577#59029577", "title": "Unable to obtain cookies from cookiejar", "body": "<p>Go's http package support redirects by default, but the cookie jar must be refreshed, specially if the domain changes. </p>\n\n<p>I spent a great deal of time debugging it some time ago, the solution I found was to specify a redirect handler: </p>\n\n<pre><code>client.CheckRedirect = getRedirectHandler(req, &amp;client)\n</code></pre>\n\n<p>Which had the following code: </p>\n\n<pre><code>func getRedirectHandler(req *Request, client *http.Client) redirectHandler {\n    fn := func(request *http.Request, via []*http.Request) error {\n        if req.FollowRedirect {\n            log.Debug(fmt.Sprintf(\"Redirecting to %s\", request.URL.String()))\n            jar, err := getCookieJarWithURL(request.URL.String(), req.Cookies)\n            if err != nil {\n                return err\n            }\n            client.Jar = jar\n            return nil\n        }\n        return errors.New(\"Redirect not allowed\")\n    }\n    return fn\n}\n</code></pre>\n\n<p>The full code can be found in this <a href=\"https://gist.github.com/tlopo/2561cf857237188aa563ebd4d9c6e5a4\" rel=\"nofollow noreferrer\">gist</a>: </p>\n\n<p>I hope that saves you some time :)</p>\n"}], "owner": {"reputation": 651, "user_id": 6119503, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c823ba11dd321ef4f4964185f9941a5c?s=128&d=identicon&r=PG&f=1", "display_name": "JC1", "link": "https://stackoverflow.com/users/6119503/jc1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 182, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574677180, "creation_date": 1574555751, "question_id": 59013649, "link": "https://stackoverflow.com/questions/59013649/unable-to-obtain-cookies-from-cookiejar", "title": "Unable to obtain cookies from cookiejar", "body": "<p>I've constructed a simple script which goes on a website, and does a few things on there (automating a checkout process on lego.com)</p>\n\n<p>This is all done using the go http client with a cookiejar on it, but when I try to print out the cookies after all the activity on the site, nothing prints - not sure if I'm doing something wrong here.</p>\n\n<pre><code>type Program struct {\n    taskInfo task.Task\n    client   http.Client\n    jar      *cookiejar.Jar\n    // Task Specific Variables\n    maxOrderQty   string\n    sessionID     string\n    sku           string\n    shipMethodUID string\n}\n</code></pre>\n\n<p>The HTTP client is initialized below</p>\n\n<pre><code>func (pr *Program) initializeClient() {\n    pr.jar, _ = cookiejar.New(nil)\n\n    pr.client = http.Client{\n        Timeout: time.Second * 10,\n        Jar:     pr.jar,\n    }\n}\n</code></pre>\n\n<p>After that, i make a few calls to the same domain (mixture of GET and POST) using said client. When I try to print out the cookies, nothing prints.</p>\n\n<pre><code>func (pr *Program) getSessionCookies() {\n    log.Debug(\"Getting Cookies\")\n    u, _ := url.Parse(\"https://www.lego.com/\")\n    for _, cookie := range pr.jar.Cookies(u) {\n        fmt.Printf(\"  %s: %s\\n\", cookie.Name, cookie.Value)\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "tcp"], "comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 1, "creation_date": 1574539251, "post_id": 59011605, "comment_id": 104271116, "body": "<a href=\"https://github.com/libp2p/go-reuseport\" rel=\"nofollow noreferrer\">github.com/libp2p/go-reuseport</a> might help"}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1574543174, "post_id": 59011605, "comment_id": 104272125, "body": "This should be possible in TCP in theory but it isn&#39;t in practice, because at the C level <code>bind()</code> precedes <code>connect()</code>. You can&#39;t rely on this kind f thing."}, {"owner": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1574596201, "post_id": 59011605, "comment_id": 104280983, "body": "The approach proposed by @SteffenUllrich appears to be what you are looking for. It uses <code>SO_REUSEADDR</code> and <code>SO_REUSEPORT</code> socket options.   It is important to note that these options are not standardized. From their description, it appears they are used in some very load intensive situations and I wonder if go routines mitigate some of the problems they are solving."}, {"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "reply_to_user": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "edited": false, "score": 0, "creation_date": 1574673205, "post_id": 59011605, "comment_id": 104300870, "body": "The approach proposed by  Steffen Ullrich will not work with TCP under any circumstances, for the reason I stated. @MomchilAtanasov"}], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1574585743, "post_id": 59015515, "comment_id": 104278795, "body": "The interleaved data you describe cannot possibly occur."}, {"owner": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 1, "creation_date": 1574593757, "post_id": 59015515, "comment_id": 104280471, "body": "@user207421, care to explain a bit? What I was describing was a hypothetical problem if a streaming API were to receive from two streams. In what way is that not possible, buffer size and TCP aside?"}], "tags": [], "owner": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "is_accepted": false, "score": -1, "last_activity_date": 1574596495, "last_edit_date": 1574596495, "creation_date": 1574580464, "answer_id": 59015515, "question_id": 59011605, "link": "https://stackoverflow.com/questions/59011605/how-to-connect-with-tcp-to-different-hosts-from-the-same-source-ip-and-port/59015515#59015515", "title": "How to connect with TCP to different hosts from the same source ip and port", "body": "<p>The problem you are facing is a general one, not related to Go programming language.</p>\n\n<p>To my knowedge, you should not be able to connect to two destinations from the same source IP address and Port. I am pretty sure this is backed up by the message you get.</p>\n\n<pre><code>err2: dial tcp 127.0.0.1:51234-&gt;127.0.0.1:51237: bind: address already in use\n</code></pre>\n\n<p>It is not complaining about your destination address. It is complaining about the source address <code>127.0.0.1:51234</code>. Try to change your source address and see what happens.</p>\n\n<hr>\n\n<p>Edit: It appears that there are socket options <code>SO_REUSEADDR</code> and <code>SO_REUSEPORT</code> that allow that but are non-standardized and appear to be used under verify specific load-intensive scenarios.</p>\n\n<p>It would help to know why you want to achieve such a setup.</p>\n\n<hr>\n\n<p>Addition: There is a stackoverflow question that is related to your problem: <a href=\"https://stackoverflow.com/questions/11129212/tcp-can-two-different-sockets-share-a-port\">TCP: can two different sockets share a port?</a></p>\n"}], "owner": {"reputation": 1, "user_id": 12422000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c39bd043d9d194b5e7eba06c16ec046b?s=128&d=identicon&r=PG&f=1", "display_name": "Niko", "link": "https://stackoverflow.com/users/12422000/niko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574596495, "creation_date": 1574538632, "last_edit_date": 1574545551, "question_id": 59011605, "link": "https://stackoverflow.com/questions/59011605/how-to-connect-with-tcp-to-different-hosts-from-the-same-source-ip-and-port", "title": "How to connect with TCP to different hosts from the same source ip and port", "body": "<p>I would like to initiate TCP connections between a process and other processes which are already listening from incoming TCP connections.\nI would like to use the same source address (ip-port) for these connections.\nI am programming in Go.</p>\n\n<p>I tried to run this code, but the second DialTCP call fails.</p>\n\n<pre><code>func main() {\n\n    ourAddr, _ := net.ResolveTCPAddr(\"tcp\", \"localhost:51234\")\n\n    otherAddr1, _ := net.ResolveTCPAddr(\"tcp\", \"localhost:51236\")\n    otherAddr2, _ := net.ResolveTCPAddr(\"tcp\", \"localhost:51237\")\n\n    conn1, err1 := net.DialTCP(\"tcp\", ourAddr, otherAddr1)\n    if err1 != nil {\n        log.Fatal(\"err1: \" + err1.Error())\n    }\n    defer conn1.Close()\n\n    conn2, err2 := net.DialTCP(\"tcp\", ourAddr, otherAddr2) // &lt;- this fails\n    if err2 != nil {\n        log.Fatal(\"err2: \" + err2.Error())\n    }\n    defer conn2.Close()\n\n}\n</code></pre>\n\n<p>The error message is: <strong>err2: dial tcp 127.0.0.1:51234->127.0.0.1:51237: bind: address already in use</strong></p>\n\n<p>(the problem should not be related to the destination processes since two instances of netcat are already listening on the destination addresses)</p>\n\n<p>I also tried using other ports (in case they were still in use) and it failed the same way</p>\n\n<p>Here is my go version:\n<code>go version go1.13.4 linux/amd64</code></p>\n\n<p>It seems to me the problem is not related to TCP but to the way I am using the Go library.\nWhat am I doing wrong, and how am I supposed to do?</p>\n"}, {"tags": ["rest", "go", "http-delete"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574539138, "post_id": 59011487, "comment_id": 104271072, "body": "Can you confirm that the client/browser is sending the body? Do you have something in front of the go app, like a proxy?"}, {"owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574539359, "post_id": 59011487, "comment_id": 104271147, "body": "In the network tab of my FireFox, I can see the body or params is being sent as <code>data\t{&quot;ids&quot;:[6026,6024]}</code>.  I didn&#39;t put anything in front of my golang app.   All the POST and PUT statements have no trouble parsing the body."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1574539871, "post_id": 59011487, "comment_id": 104271268, "body": "This is actually hinted to by the documentation on the <code>Form</code> and <code>PostForm</code> fields ( <a href=\"https://github.com/golang/go/blob/3409ce39bfd7584523b7a8c150a310cea92d879d/src/net/http/request.go#L248-L253\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/&hellip;</a>) Maybe try using the json as is, not as form-urlencoded, set the correct header for it in js, and parse the request&#39;s Body field using <code>encoding&#47;json</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574540178, "post_id": 59011487, "comment_id": 104271349, "body": "And the documentation on the actual <a href=\"https://github.com/golang/go/blob/3409ce39bfd7584523b7a8c150a310cea92d879d/src/net/http/request.go#L1239\" rel=\"nofollow noreferrer\"><code>ParseForm</code></a> method says <i>&quot;For POST, PUT, and PATCH requests, it also parses the request body as a form and puts the results into both r.PostForm and r.Form. Request body parameters take precedence over URL query string values in r.Form.&quot;</i>"}], "answers": [{"tags": [], "owner": {"reputation": 39380, "user_id": 54734, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/ea91774321962f70f19362f43568cda9?s=128&d=identicon&r=PG", "display_name": "VoiceOfUnreason", "link": "https://stackoverflow.com/users/54734/voiceofunreason"}, "is_accepted": true, "score": 3, "last_activity_date": 1574539402, "creation_date": 1574539402, "answer_id": 59011736, "question_id": 59011487, "link": "https://stackoverflow.com/questions/59011487/body-of-delete-request-is-empty-in-my-rest-api-endpoint/59011736#59011736", "title": "Body of delete request is empty in my rest api endpoint", "body": "<p><a href=\"https://tools.ietf.org/html/rfc7231#section-4.3.5\" rel=\"nofollow noreferrer\">https://tools.ietf.org/html/rfc7231#section-4.3.5</a></p>\n\n<blockquote>\n  <p>A payload within a DELETE request message has no defined semantics; sending a payload body on a DELETE request might cause some existing implementations to reject the request.</p>\n</blockquote>\n\n<p>The query string is part of the target-uri of the request; in other words, the query string is part of the <em>identifier</em>, not an incidental modifier of it.  But the message-body of the request is <em>not</em> part of the identifier.</p>\n\n<p>So your local framework, or any of the other general purpose components forwarding your request, are not required to provide support for the message-body.</p>\n\n<p>Think \"undefined behavior\" in C.</p>\n"}], "owner": {"reputation": 28441, "user_id": 27305, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/174ac998689321daaa7cfecf910522e4?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/27305/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1430, "favorite_count": 0, "accepted_answer_id": 59011736, "answer_count": 1, "score": 1, "last_activity_date": 1574545601, "creation_date": 1574538001, "last_edit_date": 1574545601, "question_id": 59011487, "link": "https://stackoverflow.com/questions/59011487/body-of-delete-request-is-empty-in-my-rest-api-endpoint", "title": "Body of delete request is empty in my rest api endpoint", "body": "<p>I seem to get empty body content of a Go http.Request if the method is DELETE.  But if I change the method to POST, then the body content gives me the content I expect.</p>\n\n<p>The relevant code from my golang looks like this:</p>\n\n<pre><code>import(\n  \"github.com/gorilla/handlers\"\n  \"github.com/gorilla/mux\"\n)\nfunc Delete(w http.ResponseWriter, r *http.Request) {\n  r.ParseForm()\n  qs := r.Form\n  log.Println(qs)\n}\n\n\nfunc main() {\n  router := mux.NewRouter()\n\n  router.HandleFunc(\"/profile\", Delete).Methods(\"POST\")\n  router.HandleFunc(\"/profile\", Delete).Methods(\"DELETE\")\n\n}\n</code></pre>\n\n<p>Now when I run this JavaScript code form my browser:</p>\n\n<pre><code>fetch(sendurl,{\n  method:\"POST\",\n  headers:{\n    'Content-Type': 'application/x-www-form-urlencoded'\n  },\n  body:\"data=\"+project.encodeFormURIComponent(JSON.stringify({\"ids\":[1032,1033]}))\n})\n.then(response=&gt;{\n  if(response.ok)\n    return response.json();\n})\n.then(result=&gt;{\n  console.log(result);\n})\n</code></pre>\n\n<p>I see a nice array of numbers in my <code>qs[ids]</code> in my Golang code.  But if I change my <code>method:\"POST\"</code> to <code>method:\"DELETE\"</code> in the JavaScript, then <code>qs</code> is empty.</p>\n\n<p>What am I doing wrong?</p>\n\n<hr>\n\n<p><strong>UPDATE</strong></p>\n\n<p>This JavaScript with the DELETE method can populate the Go <code>qs</code> variable the way one would normally expect:</p>\n\n<pre><code>fetch(sendurl+\"?data=\"+project.encodeFormURIComponent(JSON.stringify({\"ids\":[1032,1033]})),{\n  method:\"DELETE\",\n  headers:{\n    'Content-Type': 'application/x-www-form-urlencoded'\n  }\n})\n.then(response=&gt;{\n  if(response.ok)\n    return response.json();\n})\n.then(result=&gt;{\n  console.log(result);\n})\n</code></pre>\n\n<p>So it seems Go will ignore JavaScript <code>body</code> argument when <code>DELETE</code> method is used, but it will respect the query string content in the API endpoint url? Why is it like that?</p>\n"}, {"tags": ["windows", "go", "msys2"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "edited": false, "score": 0, "creation_date": 1574541782, "post_id": 59011233, "comment_id": 104271774, "body": "part1) Looks like it will work, testing now   part2) Kinda, for this example, i have msys2 installed at <code>C:\\msys64</code>  when you feed a path as a argument, such as <code>&#47;Workspace</code> msys2 gives go <code>C:\\msys2\\Workspace</code>,   but since its being fed a Abs path to open on a remote linux server, it resolves this by removing the install directory path from the path, but the issue is that its putting a extra <code>&#47;</code> at the beginning, meaning <code>&#47;Workspace</code> becomes <code>&#47;&#47;Workspace</code>"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "edited": false, "score": 0, "creation_date": 1574575191, "post_id": 59011233, "comment_id": 104277260, "body": "Oh I see, so in fact what you&#39;re looking for is a translation between a Windows absolute path like <code>C:\\msys64\\Workspace</code> and you&#39;re wanting an output of <code>&#47;Workspace</code>?"}, {"owner": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "edited": false, "score": 0, "creation_date": 1574732073, "post_id": 59011233, "comment_id": 104327177, "body": "Yeah, go ahead and test it out yourself, when you pass <code>&#47;Workspace</code> as a arg inside msys2, it will read it as a path, and slap its &quot;Install Dir&quot; to the beginning so windows programs can open that path/file."}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "edited": false, "score": 0, "creation_date": 1574764229, "post_id": 59011233, "comment_id": 104338255, "body": "I&#39;ve edited the answer to convert the windows absolute path to <code>&#47;Workspace</code>. Also, I&#39;ve added in a Go Playground link that works. Feel free to play around there. I re-worked the first function, too, so that it&#39;s more stable and covers more edge cases."}, {"owner": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "edited": false, "score": 0, "creation_date": 1574791838, "post_id": 59011233, "comment_id": 104353537, "body": "Curious as to how it removes the <code>Z:` part, i see where it fixes and converts </code>\\` to <code>&#47;</code>, but not where it removes <code>Z:</code> EDIT: The problem with this, is if i give it the path <code>Z:\\\\msys64\\\\Workspace\\\\Dragon</code>, it only returns <code>&#47;Dragon</code> <a href=\"https://play.golang.org/p/TsGGxtwbdR-\" rel=\"nofollow noreferrer\">play.golang.org/p/TsGGxtwbdR-</a>"}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": false, "score": 0, "last_activity_date": 1574764082, "last_edit_date": 1574764082, "creation_date": 1574536340, "answer_id": 59011233, "question_id": 59011037, "link": "https://stackoverflow.com/questions/59011037/issues-resolving-and-cleaning-output/59011233#59011233", "title": "Issues resolving and cleaning output", "body": "<p>For your first problem with determining whether the string is prefixed by a forward slash, you can use a function like this:</p>\n\n<pre><code>func ensureSlashPrefix(path string) string {\n    return fmt.Sprintf(\"/%s\", strings.Replace(path, \"/\", \"\", -1))\n}\n</code></pre>\n\n<p>For your second problem, perhaps I'm misunderstanding, but this function would return the absolute path to the provided relative path or a similar output to <code>echo $PWD/path</code>.</p>\n\n<pre><code>func cleanWindowsPath(path string) string {\n    base := filepath.Base(strings.Replace(path, \"\\\\\", \"/\", -1))\n    return ensureSlashPrefix(base)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/kIz2_TH8xhp\" rel=\"nofollow noreferrer\">(Go Playground)</a></p>\n"}], "owner": {"reputation": 1, "user_id": 11643686, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--1RxLZJlR6w/AAAAAAAAAAI/AAAAAAAAAAo/AAtmYwP97tA/photo.jpg?sz=128", "display_name": "Merith TK", "link": "https://stackoverflow.com/users/11643686/merith-tk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574880662, "creation_date": 1574535065, "last_edit_date": 1574880662, "question_id": 59011037, "link": "https://stackoverflow.com/questions/59011037/issues-resolving-and-cleaning-output", "title": "Issues resolving and cleaning output", "body": "<p>I am working on a fork of <a href=\"https://github.com/cdr/sshcode\" rel=\"nofollow noreferrer\">https://github.com/cdr/sshcode</a>, more specifically I am working on a PR to add git4win/msys2 support to the program</p>\n\n<p>The issue currently stems from these two functions</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func gitbashWindowsDir(dir string) string {\n    if dir == \"~\" { //Special case\n        return \"~/\"\n    }\n    mountPoints := gitbashMountPointsAndHome()\n\n    // Apply mount points\n    absDir, _ := filepath.Abs(dir)\n    absDir = filepath.ToSlash(absDir)\n    for _, mp := range mountPoints {\n        if strings.HasPrefix(absDir, mp[0]) {\n            resolved := strings.Replace(absDir, mp[0], mp[1], 1)\n            flog.Info(\"Resolved windows path '%s' to '%s\", dir, resolved)\n            return resolved\n        }\n    }\n    return dir\n}\n\n// This function returns an array with MINGW64 mount points including relative home dir\nfunc gitbashMountPointsAndHome() [][]string {\n    // Initialize mount points with home dir\n    mountPoints := [][]string{{filepath.ToSlash(os.Getenv(\"HOME\")), \"~\"}}\n    // Load mount points\n    out, err := exec.Command(\"mount\").Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    lines := strings.Split(string(out), \"\\n\")\n    var mountRx = regexp.MustCompile(`^(.*) on (.*) type`)\n    for _, line := range lines {\n        extract := mountRx.FindStringSubmatch(line)\n        if len(extract) &gt; 0 {\n            mountPoints = append(mountPoints, []string{extract[1], extract[2]})\n        }\n        res = strings.TrimPrefix(dir, line)\n    }\n    // Sort by size to get more restrictive mount points first\n    sort.Slice(mountPoints, func(i, j int) bool {\n        return len(mountPoints[i][0]) &gt; len(mountPoints[j][0])\n    })\n    return mountPoints\n}\n</code></pre>\n\n<p>How this is used, is on msys2/git4win, you give <code>gitbashWindowsDir(\"/Workspace\")</code> it SHOULD return <code>/Workspace</code> as it handles the unorthadox way msys2/git4win handle pathing.</p>\n\n<p>and when you give it <code>gitbashWindowsDir(\"Workspace/\")</code> it returns what is basically the same output as <code>echo $PWD/Workspace/</code> but in a window format</p>\n\n<p>I am working on a step-one patch that utilizes the <code>strings.Prefix</code> stuff, \nThis is what I have for this patch sofar</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    mydir, err := os.Getwd()\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(os.Getenv(\"PWD\"))\n    fmt.Println(mydir)\n}\n</code></pre>\n\n<p>I want to check if the input has the prefix <code>/</code> and if it does, just return that as a string, this seems to be the simple fix for <code>gitbashWindowsDir(\"/Workspace\")</code> returning <code>//Workspace</code>\nBut what i think the hardpart will be for <code>gitbashWindowsDir(\"Workspace/\")</code> as it returns the same output as <code>echo $PWD/Workspace/</code> but in a windows format (<code>Z:\\Workspace\\</code>)</p>\n\n<p><strong>______________________________________________</strong>\n<strong>______________________________________________</strong></p>\n\n<p>Update, i have gotten the prefix trimming to work, (stupidly simple)\nBut now i am expiriencing this issue</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"path/filepath\"\n    \"regexp\"\n    \"sort\"\n    \"strings\"\n\n    \"go.coder.com/flog\"\n)\n\nfunc main() {\n    fmt.Println(\"RESOLVED: \", gitbashWindowsDir(os.Args[1]))\n    fmt.Println(\"RESOLVED: \", gitbashWindowsDir(\"C:\\\\msys64\\\\Workspace\"))\n}\n\nfunc gitbashWindowsDir(dir string) string {\n\n    // if dir is left empty, line82:main.go will set it to `~`, this makes it so that\n    // if dir is `~`, return `~/` instead of continuing with the gitbashWindowsDir()\n    // function.\n    if dir == \"~\" {\n        return \"~/\"\n    }\n\n    mountPoints := gitbashMountPointsAndHome()\n\n    // Apply mount points\n    absDir, _ := filepath.Abs(dir)\n    absDir = filepath.ToSlash(absDir)\n    for _, mp := range mountPoints {\n        if strings.HasPrefix(absDir, mp[0]) {\n            resolved := strings.Replace(absDir, mp[0], mp[1], 1)\n\n            if strings.HasPrefix(resolved, \"//\") {\n                resolved = strings.TrimPrefix(resolved, \"/\")\n                flog.Info(\"DEBUG: strings.TrimPrefix\")\n                flog.Info(\"Resolved windows path '%s' to '%s\", dir, resolved)\n                flog.Info(\"'%s'\", resolved)\n                return resolved\n            }\n\n            flog.Info(\"Resolved windows path '%s' to '%s\", dir, resolved)\n            return resolved\n        }\n    }\n    return dir\n}\n\n// This function returns an array with MINGW64 mount points including relative home dir\nfunc gitbashMountPointsAndHome() [][]string {\n    mountPoints := [][]string{{filepath.ToSlash(os.Getenv(\"HOME\")), \"~\"}}\n\n    // Load mount points\n    out, err := exec.Command(\"mount\").Output()\n    if err != nil {\n        //log.Error(err)\n        log.Println(err)\n    }\n    lines := strings.Split(string(out), \"\\n\")\n    var mountRx = regexp.MustCompile(`^(.*) on (.*) type`)\n    for _, line := range lines {\n        extract := mountRx.FindStringSubmatch(line)\n        if len(extract) &gt; 0 {\n            mountPoints = append(mountPoints, []string{extract[1], extract[2]})\n        }\n    }\n\n    // Sort by size to get more restrictive mount points first\n    sort.Slice(mountPoints, func(i, j int) bool {\n        return len(mountPoints[i][0]) &gt; len(mountPoints[j][0])\n    })\n    return mountPoints\n}\n</code></pre>\n\n<p>When it runs this, it returns </p>\n\n<pre><code>merith@DESKTOP-BQUQ80R MINGW64 /z/sshcode\n$ go run ../debug.go Workspace\n2019-11-27 10:49:38 INFO       Resolved windows path 'Workspace' to '/z/sshcode/Workspace\nRESOLVED:  /z/sshcode/Workspace\n2019-11-27 10:49:38 INFO       DEBUG: strings.TrimPrefix\n2019-11-27 10:49:38 INFO       Resolved windows path 'C:\\msys64\\Workspace' to '/Workspace\n2019-11-27 10:49:38 INFO       '/Workspace'\nRESOLVED:  /Workspace\n</code></pre>\n\n<p>Right now i need to figure out how to detect and remove the <code>/*/</code> prefix, so that <code>/z/sshcode/Workspace</code> becomes <code>Workspace/</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1574536118, "post_id": 59010986, "comment_id": 104270270, "body": "I\u2019m not sure what you\u2019re trying to do in these examples. Are you looking for <code>C.GoString</code>?"}, {"owner": {"reputation": 1, "user_id": 11590021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z0Qob.png?s=128&g=1", "display_name": "noremac09", "link": "https://stackoverflow.com/users/11590021/noremac09"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1574536687, "post_id": 59010986, "comment_id": 104270422, "body": "I am trying to read string data from memory. You&#39;ve said that I can use <code>C.GoString</code>. How can I use it?"}, {"owner": {"reputation": 732, "user_id": 4999812, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8bd09518ec24320e674e5feb9cf69a63?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Dube", "link": "https://stackoverflow.com/users/4999812/brandon-dube"}, "edited": false, "score": 1, "creation_date": 1574565062, "post_id": 59010986, "comment_id": 104275988, "body": "The signature of C.GoString is fairly clear, <code>func C.GoString(*C.char) string</code>.  Pass it a pointer to the first char, as is normal usage in C.  It will scan up to the first null byte and convert that, less the null byte, into a Go string."}], "answers": [{"comments": [{"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1574648724, "post_id": 59014187, "comment_id": 104293811, "body": "Malloc doesn&#39;t guarantee that allocated space will be zeroed, so do not suggest that for regular cases, it causes undefined behavior as well."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1574658755, "post_id": 59014187, "comment_id": 104295805, "body": "@LaevusDexter: I&#39;m not suggesting that <i>you</i> call malloc. I&#39;m suggesting that if you import some existing C library, it may <i>already</i> call malloc. If it did, you need to know to call, or have it call, free afterward. The same goes when you invoke existing C++ code, however you do it. (If your case is particularly tricky, consider using SWIG, though I have not experimented with SWIG.)"}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 1, "last_activity_date": 1574563150, "creation_date": 1574563150, "answer_id": 59014187, "question_id": 59010986, "link": "https://stackoverflow.com/questions/59010986/get-string-data-from-a-pointer-to-c-char-array/59014187#59014187", "title": "Get string data from a pointer to C-Char array", "body": "<p>Your example C++ code is ... not good, as it returns a pointer to a variable whose storage has been released.  Use <code>static char text[]</code> or similar to fix it.  Real C or C++ code will return either a pointer to memory that should be released with <code>free</code>, or not, and you will need to handle these cases too.</p>\n\n<p>Still, you can get some or most of the way to what you want with <code>cgo</code>, which is built in to Go these days.  Note that when using cgo, you need a separate <code>import \"C\"</code> statement, generally prefixed with a comment.  (You cannot put this import into the regular import section.)</p>\n\n<p>Let's cover all this in several parts.</p>\n\n<h3>No DLL, C code that returns pointer to <code>static</code> storage-duration <code>char</code>s</h3>\n\n<p>If we ignore all the DLL aspects, and assume that you can link directly against a particular C function that returns <code>char *</code>, the example Go code to work with it would be:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n/*\nextern char *Function();\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n)\n\nfunc WrapFunction() string {\n    return C.GoString(C.Function())\n}\n\nfunc main() {\n    fmt.Println(WrapFunction())\n}\n</code></pre>\n\n<p>I put a sample <code>Function()</code> in a file by itself named <code>cgo.go</code> in a directory with just the one <code>.c</code> file, <code>function.c</code>, as well.  Here's the very simple C code for this particular <code>Function()</code>:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>char *Function() {\n    return \"hello\";\n}\n</code></pre>\n\n<p>(A C string literal has type <code>char [N]</code> with the integer constant <code>N</code> determined at compile time, and static duration, and C has that funny rule of \"decaying\" an array to a pointer to its first element, so we meet our goal of returning <code>char *</code> pointing to static-duration memory.)</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ go build\n$ ./cgo\nhello\n$ \n</code></pre>\n\n<h3>C code that returns pointer to dynamically-allocated memory</h3>\n\n<p>Let's say instead that the C (or wrapped C++) function uses <code>malloc</code> (or <code>new</code>) to allocate the string, so that we must free it.  Here's the updated <code>function.c</code> that does so:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#include &lt;stdio.h&gt;\n#include &lt;stdlib.h&gt;\n#include &lt;time.h&gt;\n\nchar *Function() {\n    char *text = malloc(25); /* big enough for hello and a number */\n    if (text != NULL) {\n        srand(time(NULL));   /* should do this just once, really */\n        sprintf(text, \"hello %d\", rand() % 100);\n    }\n    return text;\n}\n</code></pre>\n\n<p>Then we would rewrite <code>cgo.go</code> as:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n/*\n#include &lt;stdlib.h&gt;\nextern char *Function();\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc WrapFunction() string {\n    s := C.Function()\n    // Optional -- note that C.free(nil) is a no-op,\n    // and (by experimentation) C.GoString(nil) returns \"\".\n    // So, if it's OK to use \"\" if `C.Function` returns NULL,\n    // skip this test-and-panic.\n    if s == nil {\n        panic(\"C.Function returned NULL\")\n    }\n    defer C.free(unsafe.Pointer(s))\n    return C.GoString(s)\n}\n\nfunc main() {\n    fmt.Println(WrapFunction())\n}\n</code></pre>\n\n<p>Compiling and running this shows:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>$ go build\n$ ./cgo\nhello 27\n</code></pre>\n\n<p>See also <a href=\"https://blog.golang.org/c-go-cgo\" rel=\"nofollow noreferrer\">https://blog.golang.org/c-go-cgo</a> and <a href=\"https://golang.org/cmd/cgo/\" rel=\"nofollow noreferrer\">https://golang.org/cmd/cgo/</a>.</p>\n\n<h3>DLLs</h3>\n\n<p>Both of the above assume that the C wrapper is in the build directory.  Running <code>go build</code> discovers this and builds <code>function.c</code> to an object file, adds all the necessary runtime interface between C and Go, and invokes the function <code>Function</code> directly, by name.</p>\n\n<p>If you must determine the function name at runtime, you have a much more serious problem.  The heart of the issue is that you cannot get assistance from <code>cgo</code> to wrap the function directly, because cgo needs to see the function's name, in that comment above the <code>import \"C\"</code> line.</p>\n\n<p>See <a href=\"https://stackoverflow.com/q/8231618/1256452\">how to import a DLL function written in C using GO?</a> for several approaches.  Another one not listed there is to do the DLL lookup in a C wrapper that you write yourself.  Use <code>cgo</code> to pass the name of the function to look up, and all the (fixed) arguments.  Then you're calling a known (compile-time) function with a known (compile-time) return type and value, which simplifies the problem.  The cgo runtime wrapper will insert the appropriate runtime stack-switching for your known function, so that you do not have to use the <code>syscall</code> wrappers.</p>\n"}], "owner": {"reputation": 1, "user_id": 11590021, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z0Qob.png?s=128&g=1", "display_name": "noremac09", "link": "https://stackoverflow.com/users/11590021/noremac09"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 194, "favorite_count": 0, "accepted_answer_id": 59014187, "answer_count": 1, "score": -1, "last_activity_date": 1574563150, "creation_date": 1574534618, "last_edit_date": 1574535037, "question_id": 59010986, "link": "https://stackoverflow.com/questions/59010986/get-string-data-from-a-pointer-to-c-char-array", "title": "Get string data from a pointer to C-Char array", "body": "<p>I got pointer to C-char array I got from C++ dll.How can i get string data?</p>\n\n<p>I am using this code to get the pointer to a memory address:</p>\n\n<p>Go:</p>\n\n<pre><code>dll, err := windows.LoadDLL(\"someDll.dll\")\nif err != nil {\n    panic(err)\n}\nproc := dll.MustFindProc(\"Function\")\nresponse, _, _ := proc.Call()\n</code></pre>\n\n<p>C++ code:</p>\n\n<pre><code>extern \"C\" __declspec(dllexport) char* Function() {\n    char text[] = \"something\";\n    return text;\n}\n</code></pre>\n\n<p>I've tried this:</p>\n\n<pre><code>fmt.Println(*(*string)(unsafe.Pointer(&amp;response)))\n</code></pre>\n\n<p>And this:</p>\n\n<pre><code>var data []byte\nsh := (*reflect.SliceHeader)(unsafe.Pointer(&amp;data))\nsh.Data = response\nsh.Len = 9\nsh.Cap = 9\nfmt.Println(data, string(data))\n</code></pre>\n\n<p>but nothing works for me.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1574527619, "post_id": 59009805, "comment_id": 104267760, "body": "Could you: 1. change <code>fmt.Println(response.Payload)</code> to <code>fmt.Printf(&quot;%#v&quot;,reponse.Payload)</code>? 2. Add the output to your question as actual code, and not an image (if the image becomes unavailable, your question becomes meaningless)? 3. Add the output of <code>db.yourcollection.find({&quot;cid&quot;:cid})</code> to your question as well?"}, {"owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574529382, "post_id": 59009805, "comment_id": 104268335, "body": "@MarkusWMahlberg I just made those changes. Hopefully it helps."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574547583, "post_id": 59009805, "comment_id": 104273181, "body": "I was referring to the output of the mongo shell in order to check the fields and draw a difference between them and your expected output ;)"}], "answers": [{"tags": [], "owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "is_accepted": true, "score": 0, "last_activity_date": 1574533472, "creation_date": 1574533472, "answer_id": 59010828, "question_id": 59009805, "link": "https://stackoverflow.com/questions/59009805/appending-nested-struct-from-mongo-collection-cursor/59010828#59010828", "title": "Appending Nested Struct From Mongo Collection Cursor", "body": "<p>I found that when I moved <code>var initiative Initiative</code> inside the loop, it worked fine.</p>\n\n<pre><code>func GetInitiativesFromDB(d *database.MongoDB, cid string) (response InitiativeResponse, err error) {\n    filter := bson.M{\"cid\": cid}\n    cur, err := d.Database.Collection(INITIATIVECOLLECTION).Find(context.Background(), filter, options.Find())\n    fmt.Printf(\"%#v\", cur)\n    if err != nil {\n        return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n    }\n    for cur.Next(context.Background()) {\n        var initiative Initiative\n        err := cur.Decode(&amp;initiative)\n        if err != nil {\n            return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n        }\n        response.Payload = append(response.Payload, initiative)\n        fmt.Printf(\"%#v\", response.Payload)\n    }\n    if err := cur.Err(); err != nil {\n        return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n    }\n    _ = cur.Close(context.Background())\n    return response, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 117, "user_id": 10096250, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-lHa1mu8bbSY/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7pg9uZTR5XzQA3e2QUPjP-guqL_yA/mo/photo.jpg?sz=128", "display_name": "jmacnc", "link": "https://stackoverflow.com/users/10096250/jmacnc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "accepted_answer_id": 59010828, "answer_count": 1, "score": 1, "last_activity_date": 1574533472, "creation_date": 1574526907, "last_edit_date": 1574529649, "question_id": 59009805, "link": "https://stackoverflow.com/questions/59009805/appending-nested-struct-from-mongo-collection-cursor", "title": "Appending Nested Struct From Mongo Collection Cursor", "body": "<p>I'm running into an issue appending a nested struct to an array.</p>\n\n<p>Both have different nested values but when appending the last struct it overwrites the first nested struct.</p>\n\n<p>Here is a simple example of the concept. (I tried to replicate appending nested structs but its working fine) <a href=\"https://play.golang.org/p/PseTHzV33uL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/PseTHzV33uL</a></p>\n\n<p>Here are the structs in my actual code </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Initiative struct {\n    OID          primitive.ObjectID `bson:\"_id,omitempty\"json:\"id,omitempty\"`\n    Cid          string             `json:\"cid\"`\n    Name         string             `json:\"name\"`\n    Description  string             `json:\"description\"`\n    ProductName  string             `json:\"product_name\"`\n    ProductId    string             `json:\"product_id\"`\n    Quarter      string             `json:\"quarter\"`\n    Year         string             `json:\"year\"`\n    CustomFields []NestedField            `json:\"custom_fields\"`\n}\n\ntype NestedField struct {\n    Id    string `json:\"id\"`\n    Cid   string `json:\"cid\"`\n    Name  string `json:\"name\"`\n    Type  string `json:\"type\"`\n    Form  string `json:\"form\"`\n    Value string `json:\"value\"`\n}\n\ntype InitiativeResponse struct {\n    ErrorCode        string       `json:\"error_code,omitempty\"`\n    ErrorDescription string       `json:\"error_description,omitempty\"`\n    Message          string       `json:\"message,omitempty\"`\n    Payload          []Initiative `json:\"payload,omitempty\"`\n}\n</code></pre>\n\n<p>and this is my function.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetInitiativesFromDB(d *database.MongoDB, cid string) (response InitiativeResponse, err error) {\n    filter := bson.M{\"cid\": cid}\n    cur, err := d.Database.Collection(INITIATIVECOLLECTION).Find(context.Background(), filter, options.Find())\n    fmt.Printf(\"%#v\", cur)\n    if err != nil {\n        return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n    }\n    var initiative Initiative\n    for cur.Next(context.Background()) {\n        err := cur.Decode(&amp;initiative)\n        if err != nil {\n            return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n        }\n        response.Payload = append(response.Payload, initiative)\n        fmt.Printf(\"%#v\", response.Payload)\n    }\n    if err := cur.Err(); err != nil {\n        return response, errors.ErrorResponse{\"No initiatives were found\", 404}\n    }\n    _ = cur.Close(context.Background())\n    return response, nil\n}\n</code></pre>\n\n<p>This is what I found from printing the values of the the array after appending the first and second time. </p>\n\n<p>Notice that the first time the <code>NestedField</code>s have different values than after appending the second time.</p>\n\n<p>First Append</p>\n\n<pre><code>[]api.Initiative{\n    api.Initiative{\n        OID:primitive.ObjectID{0x5d, 0xd9, 0x3f, 0x96, 0xd2, 0xc6, 0xb2, 0x95, 0x19, 0xd2, 0xbf, 0x98}, \n        Cid:\"5d8502a2a284b46f3621f389\", \n        Name:\"1\", \n        Description:\"\", \n        ProductName:\"\", \n        ProductId:\"\", \n        Quarter:\"\", \n        Year:\"\", \n        CustomFields:[]api.NestedField{\n            api.NestedField{\n                Id:\"5db8ec9fee8040e9b6dfad87\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Test\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"ggg\"}, \n            api.NestedField{\n                Id:\"5dba0bcedf9cbf185683ecca\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Kylie\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"ggg\"}, \n            api.NestedField{\n                Id:\"5dd71d2af20bea1fef4564eb\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"asdfasdf\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"ggg\"}}}}\n</code></pre>\n\n<p>Second Append</p>\n\n<pre><code>\n[]api.Initiative{\n    api.Initiative{\n        OID:primitive.ObjectID{0x5d, 0xd9, 0x3f, 0x96, 0xd2, 0xc6, 0xb2, 0x95, 0x19, 0xd2, 0xbf, 0x98}, \n        Cid:\"5d8502a2a284b46f3621f389\", \n        Name:\"1\", \n        Description:\"\", \n        ProductName:\"\", \n        ProductId:\"\", \n        Quarter:\"\", \n        Year:\"\", \n        CustomFields:[]api.NestedField{\n            api.NestedField{\n                Id:\"5db8ec9fee8040e9b6dfad87\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Test\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"aaa\"}, \n            api.NestedField{\n                Id:\"5dba0bcedf9cbf185683ecca\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Kylie\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"aaa\"}, \n            api.NestedField{\n                Id:\"5dd71d2af20bea1fef4564eb\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"asdfasdf\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"\"}}}, \n    api.Initiative{\n        OID:primitive.ObjectID{0x5d, 0xd9, 0x3f, 0x9f, 0xd2, 0xc6, 0xb2, 0x95, 0x19, 0xd2, 0xbf, 0x99}, \n        Cid:\"5d8502a2a284b46f3621f389\", \n        Name:\"2\", \n        Description:\"\", \n        ProductName:\"\", \n        ProductId:\"\", \n        Quarter:\"\", \n        Year:\"\", \n        CustomFields:[]api.NestedField{\n            api.NestedField{\n                Id:\"5db8ec9fee8040e9b6dfad87\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Test\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"aaa\"}, \n            api.NestedField{\n                Id:\"5dba0bcedf9cbf185683ecca\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"Kylie\", \n                Type:\"text\", \n                Form:\"initiative\", \n                Value:\"aaa\"}, \n            api.NestedField{\n                Id:\"5dd71d2af20bea1fef4564eb\", \n                Cid:\"5d8502a2a284b46f3621f389\", \n                Name:\"asdfasdf\", \n                Type:\"text\",\n                Form:\"initiative\", \n                Value:\"\"}}}}\n</code></pre>\n\n<p>And the result of printing cur</p>\n\n<pre><code>&amp;mongo.Cursor{\n    Current:bson.Raw(nil), \n    bc:(*driver.BatchCursor)(0xc000204000), \n    batch:(*bsoncore.DocumentSequence)(nil), \n    registry:(*bsoncodec.Registry)(0xc0000ee070), \n    clientSession:(*session.Client)(0xc0001f40c0), err:error(nil)}\n</code></pre>\n\n<p>Does anyone know why this could be happening or how to fix it?</p>\n"}, {"tags": ["linux", "docker", "go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1574518971, "post_id": 59008571, "comment_id": 104265359, "body": "What does <code>file .&#47;application</code> print? Do you run this container on a amd64 system?"}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1574519436, "post_id": 59008571, "comment_id": 104265481, "body": "Are building the exe outside of Docker? If so, I&#39;d suggest building within the Docker build itself to ensure consistent library linkage from known Linux images."}, {"owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "edited": false, "score": 0, "creation_date": 1574520290, "post_id": 59008571, "comment_id": 104265728, "body": "Application builds inside the container, and as seem without any issues.  The output: docker build -t vkspotter . Sending build context to Docker daemon  9.067MB Step 1/7 : FROM golang:1.12.0  ---&gt; cee68f119e19 ... (skip some steps) Step 7/7 : ENTRYPOINT [&quot;./application&quot;]  ---&gt; Running in 1feb2636c88f Removing intermediate container 1feb2636c88f  ---&gt; 8c5011c23472 Successfully built 8c5011c23472 Successfully tagged vkspotter:latest"}, {"owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1574520570, "post_id": 59008571, "comment_id": 104265828, "body": "@tkausl Yes i do run the app on amd64 sys, my spec: Intel i5, Ubuntu 19.04. Can you please clarificate where  should i run the <code>file .&#47;application</code> command ?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574525460, "post_id": 59008571, "comment_id": 104267124, "body": "You can not be sure that there are no issues, since you are ignoring the return values of the respective commands in the long <code>RUN</code> label. Connect each command with an <code>&amp;&amp;</code> instead of a <code>;</code>and <a href=\"https://stackoverflow.com/posts/59008571/edit\">add the output to your question by editing it</a>"}, {"owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574526460, "post_id": 59008571, "comment_id": 104267426, "body": "@MarkusWMahlberg you was absolutely right, there is issue with <code>go env</code>. I suppose that image is used for creating container (<code>golang:1.12.0</code>) does not have bin for go env command, can it be so?"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574526786, "post_id": 59008571, "comment_id": 104267529, "body": "<code>goenv</code> != <code>go env</code> (note the blank). <code>docker run golang:1.12.0  go env</code> works as expected."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574526837, "post_id": 59008571, "comment_id": 104267541, "body": "Bit of <a href=\"https://gist.github.com/mwmahlberg/6af4cb8edc56a517b599a59a6b1b767e\" rel=\"nofollow noreferrer\">additional advice in a gist</a>."}, {"owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574530637, "post_id": 59008571, "comment_id": 104268736, "body": "@MarkusWMahlberg Thanks for replying, i make my Dockerfile looks like your template, and just remove <code>goenv</code> command, so my first issue was resolved. But i faced a some other problem <code>standard_init_linux.go:211: exec user process caused &quot;exec format error&quot;</code>, i searched information about it, and all i found was that occurs when you attempt to run a container with an architecture different from your host architecture.I believe this is a topic for a separate topic, right"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1574547489, "post_id": 59008571, "comment_id": 104273162, "body": "Most likely. I exclusively use 64bit Linux for creating and running images. I will doublecheck the gist and comment there accordingly."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "edited": false, "score": 0, "creation_date": 1574621043, "post_id": 59015455, "comment_id": 104287667, "body": "Yes it is right, but in above thread i was helped with that. and now i have new issue. The  error is: <code>standard_init_linux.go:211: exec user process caused &quot;exec format error&quot; </code>, i searched information about it, and all i found was that occurs when you attempt to run a container with an architecture different from your host architecture."}], "tags": [], "owner": {"reputation": 339, "user_id": 2852445, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03167a12f5062b9b5aec927a2fef5af3?s=128&d=identicon&r=PG&f=1", "display_name": "Momchil Atanasov", "link": "https://stackoverflow.com/users/2852445/momchil-atanasov"}, "is_accepted": false, "score": 0, "last_activity_date": 1574579764, "creation_date": 1574579764, "answer_id": 59015455, "question_id": 59008571, "link": "https://stackoverflow.com/questions/59008571/problem-with-run-docker-container-contains-golang-project/59015455#59015455", "title": "Problem with run docker container contains golang project", "body": "<p>If you look at the output error, you can clearly see the error message:</p>\n\n<pre><code>/bin/sh: 1: goenv: not found\n</code></pre>\n\n<p>I presume you wanted to type <code>go env</code> in your command?</p>\n"}, {"tags": [], "owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "is_accepted": true, "score": 1, "last_activity_date": 1574884067, "creation_date": 1574884067, "answer_id": 59077516, "question_id": 59008571, "link": "https://stackoverflow.com/questions/59008571/problem-with-run-docker-container-contains-golang-project/59077516#59077516", "title": "Problem with run docker container contains golang project", "body": "<p>The <code>standard_init_linux.go:211: exec user process caused \"exec format error\"</code> error occurs for various reasons, and not only when you try to launch an image with an architecture different from your host machine, as many forums say.\nIn my case, this error occurred due to the fact that the bundled program was placed in the wrong directory in the docker container.</p>\n"}], "owner": {"reputation": 31, "user_id": 12420288, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae1d6d8155a1bad40707b28f8fbd0ef5?s=128&d=identicon&r=PG&f=1", "display_name": "Nikolaj", "link": "https://stackoverflow.com/users/12420288/nikolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 274, "favorite_count": 0, "accepted_answer_id": 59077516, "answer_count": 2, "score": 2, "last_activity_date": 1574884067, "creation_date": 1574518782, "last_edit_date": 1574526272, "question_id": 59008571, "link": "https://stackoverflow.com/questions/59008571/problem-with-run-docker-container-contains-golang-project", "title": "Problem with run docker container contains golang project", "body": "<p>I experience some problem when attempt to run a my docker image that contain golang application.\nThis Is an error: <code>enter code here</code>standard_init_linux.go:211: exec user process caused \"exec format error\"</p>\n\n<p>This Is my environment:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"/home/nikolaj//home/nikolaj/go/bin\"\nGOCACHE=\"/home/nikolaj/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/nikolaj/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/snap/go/4765\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/snap/go/4765/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/dev/null\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build908015468=/tmp/go-build -gno-record-gcc-switches\"\n\ngo environment : GOARCH=\"amd64\"\nGOBIN=\"/home/nikolaj//home/nikolaj/go/bin\"\nGOCACHE=\"/home/nikolaj/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\n\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/nikolaj/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/snap/go/4765\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/snap/go/4765/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/dev/null\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build838573681=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>The dockerfile:</p>\n\n<pre><code>FROM golang:1.12.0\n\nWORKDIR /app\n\nENV SRC_DIR=/go/src/vk_acceptor/\n\nADD . $SRC_DIR\n\nRUN cd $SRC_DIR; env; goenv; export GO111MODULE=on; go get -u; go build -o application; cp application /app/\n\nRUN chmod +x application\n\nENTRYPOINT [\"./application\"]\n</code></pre>\n\n<p>After formatting <code>RUN command</code> it looks like this: <code>RUN cd $SRC_DIR &amp;&amp; env &amp;&amp; goenv &amp;&amp; export GO111MODULE=on &amp;&amp; go get -u &amp;&amp; go build -o application &amp;&amp; cp application /app/</code> </p>\n\n<p>Output of <code>docker build .</code> command :</p>\n\n<pre><code>Sending build context to Docker daemon  9.067MB\nStep 1/7 : FROM golang:1.12.0\n ---&gt; cee68f119e19\nStep 2/7 : WORKDIR /app\n ---&gt; Using cache\n ---&gt; 5bffbbf8f161\nStep 3/7 : ENV SRC_DIR=/go/src/vk_acceptor/\n ---&gt; Using cache\n ---&gt; bf145f38f8db\nStep 4/7 : ADD . $SRC_DIR\n ---&gt; 766466f20647\nStep 5/7 : RUN cd $SRC_DIR &amp;&amp; env &amp;&amp; goenv &amp;&amp; export GO111MODULE=on &amp;&amp; go get -u &amp;&amp; go build -o application &amp;&amp; cp application /app/\n ---&gt; Running in 7aeb8905c137\nHOSTNAME=7aeb8905c137\nSRC_DIR=/go/src/vk_acceptor/\nHOME=/root\nOLDPWD=/app\nPATH=/go/bin:/usr/local/go/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin\nGOPATH=/go\nPWD=/go/src/vk_acceptor\nGOLANG_VERSION=1.12\n/bin/sh: 1: goenv: not found\nThe command '/bin/sh -c cd $SRC_DIR &amp;&amp; env &amp;&amp; goenv &amp;&amp; export GO111MODULE=on &amp;&amp; go get -u &amp;&amp; go build -o application &amp;&amp; cp application /app/' returned a non-zero code: 127\n</code></pre>\n"}, {"tags": ["sqlite", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574514260, "post_id": 59007813, "comment_id": 104264235, "body": "What format is your config file? is it JSON, or XML, YAML perhaps? or something else?"}, {"owner": {"reputation": 13, "user_id": 7334424, "user_type": "registered", "profile_image": "https://graph.facebook.com/1225204654225525/picture?type=large", "display_name": "Egor Kado", "link": "https://stackoverflow.com/users/7334424/egor-kado"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574514450, "post_id": 59007813, "comment_id": 104264274, "body": "@mkopriva i would like to do it with YAML. I founded some modules for it (Viper and go-yaml)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574514928, "post_id": 59007813, "comment_id": 104264384, "body": "Those two packages work in different ways, so it is important to know which one of them you chose so that we can provide accurate solutions."}, {"owner": {"reputation": 13, "user_id": 7334424, "user_type": "registered", "profile_image": "https://graph.facebook.com/1225204654225525/picture?type=large", "display_name": "Egor Kado", "link": "https://stackoverflow.com/users/7334424/egor-kado"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574515455, "post_id": 59007813, "comment_id": 104264520, "body": "@mkopriva, ok, could you please tell me then, how could i implement it with go-yaml?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1574515486, "post_id": 59007813, "comment_id": 104264529, "body": "<a href=\"https://stackoverflow.com/a/30950396/965900\">stackoverflow.com/a/30950396/965900</a>"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574533629, "post_id": 59008531, "comment_id": 104269563, "body": "Go has excellent support for YAML, too. No reason to use JSON if you prefer YAML (and I generally do prefer YAML, or better, TOML, for configuration)"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1574535213, "post_id": 59008531, "comment_id": 104270044, "body": "Of course, you should go with what&#39;s best for your project and what you&#39;re most comfortable. But for the sake of simplicity, it&#39;s often handy to use what&#39;s build into the languages standard lib rather than relying on a third party lib."}], "tags": [], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "is_accepted": true, "score": 0, "last_activity_date": 1574533603, "last_edit_date": 1574533603, "creation_date": 1574518535, "answer_id": 59008531, "question_id": 59007813, "link": "https://stackoverflow.com/questions/59007813/how-to-get-path-from-config-file/59008531#59008531", "title": "How to get path from config file", "body": "<p>My first suggestion is that you use a <code>JSON</code> file rather than a <code>YAML</code> file for configuration, since Go supports it natively; you don't need to use any external packages.</p>\n\n<pre><code>type DBConfig struct {\n    Path string `json:\"path\"`\n}\n\nfunc loadConfig(path string) (*DBConfig, error) {\n    data, err := ioutil.ReadFile(path)\n    if err != nil {\n        return nil, err\n    }\n\n    var conf DBConfig\n    err = json.Unmarshal(data, &amp;conf)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;conf, nil   \n}\n</code></pre>\n\n<p>My second suggestion is that you pass in the path to this config file in as a <code>flag</code>. You can supply a flag when you run your application like this:</p>\n\n<pre><code>$ go build . -o MyApp\n$ ./MyApp --config=path/to/config/file\n</code></pre>\n\n<p>Flags are very powerful and allow you to easily configure your applications without changing much code. Using flags in Golang is simple.</p>\n\n<pre><code>var configPath = flag.String(\"config\", \"\", \"Path to file containing app config\")\n</code></pre>\n\n<p>Just make sure that you add <code>flag.Parse</code> to the top of your <code>main</code> function in order to access them. </p>\n\n<p><a href=\"https://play.golang.org/p/BpwwacsFj-5\" rel=\"nofollow noreferrer\">Here's a full example.</a></p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 13, "user_id": 7334424, "user_type": "registered", "profile_image": "https://graph.facebook.com/1225204654225525/picture?type=large", "display_name": "Egor Kado", "link": "https://stackoverflow.com/users/7334424/egor-kado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 59008531, "answer_count": 1, "score": 0, "last_activity_date": 1574533603, "creation_date": 1574513506, "last_edit_date": 1574533585, "question_id": 59007813, "link": "https://stackoverflow.com/questions/59007813/how-to-get-path-from-config-file", "title": "How to get path from config file", "body": "<p>I would like to get path to my sqlite DB from a config file. How could I do that in Go? </p>\n\n<p>This is a code, which I wrote before:</p>\n\n<pre><code>database, _ := sql.Open(\"sqlite3\", \"C:\\\\Users\\\\username\\\\project\\\\source.db\")\n</code></pre>\n\n<p>In this case my path is \"hard coded\" directly in code. I would like to set a variable, which takes a path from a config data.</p>\n"}, {"tags": ["html", "go", "range", "dropdown", "key-value"], "comments": [{"owner": {"reputation": 11, "user_id": 12308274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2958ce59fae616d7da0edb315d7a6dc4?s=128&d=identicon&r=PG&f=1", "display_name": "bheki", "link": "https://stackoverflow.com/users/12308274/bheki"}, "edited": false, "score": 0, "creation_date": 1574509953, "post_id": 59007244, "comment_id": 104263326, "body": "I don&#39;t know how to the value to selected. Thanks"}, {"owner": {"reputation": 312, "user_id": 4071461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/195116dca64969be94c447d3403dd15f?s=128&d=identicon&r=PG", "display_name": "kasvith", "link": "https://stackoverflow.com/users/4071461/kasvith"}, "edited": false, "score": 0, "creation_date": 1574513637, "post_id": 59007244, "comment_id": 104264078, "body": "Please show the code for data retrieval also from the backend."}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 12308274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2958ce59fae616d7da0edb315d7a6dc4?s=128&d=identicon&r=PG&f=1", "display_name": "bheki", "link": "https://stackoverflow.com/users/12308274/bheki"}, "edited": false, "score": 0, "creation_date": 1574772576, "post_id": 59010153, "comment_id": 104342724, "body": "Thanks Burak,you got me going. Below is the code that did the trick.                                                                                                     &lt;label for=&quot;size&quot; class=&quot;col-sm-2 col-form-label&quot;&gt;Size&lt;/label&gt;                   &lt;select class=&quot;form-control&quot;  name=&quot;size&quot; id=&quot;size&quot; value= &quot;{{.Size}}&quot;&gt;                   {{range $key, $value := .Sizes }}                        &lt;option value=&quot;{{ $value }}&quot;  {{if eq  $value  $.Size   }} selected {{end}}&gt;{{ $key }}&lt;/option&gt;                     {{end}}                                        &lt;/select&gt;"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1574529008, "creation_date": 1574529008, "answer_id": 59010153, "question_id": 59007244, "link": "https://stackoverflow.com/questions/59007244/returning-selected-data-to-drop-down-form-element-consisting-of-key-value-pairs/59010153#59010153", "title": "Returning selected data to drop down form element consisting of key value pairs", "body": "<p>When you render the template again after the error, you have to set the selected attribute for the option. </p>\n\n<pre><code>{{range $key, $value := .Sizes }}\n  &lt;option value=\"{{ $value }}\" {{if eq $value .SelectedItem}}selected{{end}}&gt;{{ $key }}&lt;/option&gt;  \n{{end}}\n</code></pre>\n\n<p>Above, <code>.SelectedItem</code> is the variable you passed to template that holds the selected item.</p>\n"}], "owner": {"reputation": 11, "user_id": 12308274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2958ce59fae616d7da0edb315d7a6dc4?s=128&d=identicon&r=PG&f=1", "display_name": "bheki", "link": "https://stackoverflow.com/users/12308274/bheki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1574529008, "creation_date": 1574509511, "question_id": 59007244, "link": "https://stackoverflow.com/questions/59007244/returning-selected-data-to-drop-down-form-element-consisting-of-key-value-pairs", "title": "Returning selected data to drop down form element consisting of key value pairs", "body": "<p>I am new to Golang.\nI have form with drop down element consisting of key value pairs. When I submit my form, it fails validation (The failure has nothing to do with the drop down element).\nI have to send back all correct captured date including the item selected on drop down item of my form.</p>\n\n<p>I have not been to do this. How does one send back what was selected? My html is shown below.</p>\n\n<pre><code>&lt;div&gt; \n   {{ with .Errors.Size }}\n       &lt;p class=\"error text-danger\"&gt;{{ . }}&lt;/p&gt;\n   {{ end }}\n   &lt;label for=\"size\" class=\"col-sm-2 col-form-label\"&gt;Size&lt;/label&gt;\n      &lt;select class=\"form-control\"  name=\"size\" id=\"size\"&gt;\n          {{range $key, $value := .Sizes }}\n            &lt;option value=\"{{ $value }}\"&gt;{{ $key }}&lt;/option&gt;  \n          {{end}}\n      &lt;/select&gt; \n&lt;/div&gt;\n</code></pre>\n"}]