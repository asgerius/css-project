[{"tags": ["function", "go", "closures"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565826937, "post_id": 57502868, "comment_id": 101475484, "body": "The question is not about JavaScript so the code and reference may be more confusing than informative to a Go developer with this question."}], "tags": [], "owner": {"reputation": 2317, "user_id": 1647447, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkxrG.png?s=128&g=1", "display_name": "Kevin Hutchinson", "link": "https://stackoverflow.com/users/1647447/kevin-hutchinson"}, "is_accepted": false, "score": 0, "last_activity_date": 1565822321, "last_edit_date": 1565822321, "creation_date": 1565821962, "answer_id": 57502868, "question_id": 57502797, "link": "https://stackoverflow.com/questions/57502797/does-golang-automatically-assign-variables-as-arguments-when-writing-function-cl/57502868#57502868", "title": "Does Golang automatically assign variables as arguments when writing function closures?", "body": "<p>The <code>sum</code> variable is inside each of the two closures when you assign <code>pos</code> and <code>neg</code>. The <code>sum</code> in the <code>pos</code> closure is updated by adding 1, 2, 3, 4 (fibonacci style) while the <code>sum</code> in the <code>neg</code> closure is updated by subtracting 2*1, 2*2, 2*3, 2*4 in each of the loop iterations.</p>\n\n<p>Or, in more detail:\n<code>pos := adder()</code> assigns to <code>pos</code> a function having a closure on <code>sum</code> where <code>sum</code> is 0 to begin. Then whenever you call the function <code>pos</code>, it will updated <code>sum</code> accordingly. The exact same is true with <code>neg</code>, and any other similar assignment.</p>\n\n<p>Here's some similar (simpler) code in JavaScript to run in your browser console:</p>\n\n<pre><code>function adder() {\n  var sum = 0;\n  return function(i) {\n    sum += i;\n    return sum;\n  }\n}\n\nvar pos = adder();\nconsole.log( pos(1) ); // add 1 to 0 (1)\nconsole.log( pos(2) ); // add 2 to 1 (3)\nconsole.log( pos(3) ); // add 3 to 3 (6)\nconsole.log( pos(4) ); // add 4 to 6 (10)\n</code></pre>\n\n<p>Here's some background about Closures in JavaScript: <a href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures\" rel=\"nofollow noreferrer\">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Closures</a></p>\n\n<p>Hope this helps.</p>\n"}, {"comments": [{"owner": {"reputation": 169, "user_id": 8228146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30e57d9484fab5de9328762d7522c24f?s=128&d=identicon&r=PG&f=1", "display_name": "Divyansh", "link": "https://stackoverflow.com/users/8228146/divyansh"}, "edited": false, "score": 0, "creation_date": 1565823835, "post_id": 57502895, "comment_id": 101474939, "body": "Thanks! I still have a doubt with the syntax though. In the declaration of <code>adder</code>, the code is <code>func adder() func(int) int{...}</code>. What I don&#39;t get is how is the variable <code>x</code> being passed on to the closure?Shouldn&#39;t <code>x</code> be first passed on to <code>adder</code>, like <code>func adder(x int)</code> and then adder passes it to the closure? Or is it that since closure is declared with <code>func(int) int</code>, Golang automatically gets it that <code>x</code> which is an <code>int</code> has to be passed on to the closure? I&#39;m from C++ background so this syntax confuses me."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 169, "user_id": 8228146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30e57d9484fab5de9328762d7522c24f?s=128&d=identicon&r=PG&f=1", "display_name": "Divyansh", "link": "https://stackoverflow.com/users/8228146/divyansh"}, "edited": false, "score": 0, "creation_date": 1565826291, "post_id": 57502895, "comment_id": 101475364, "body": "Everything after the literal text <code>func adder()</code> before the open brace for the function itself is the <i>return type</i>. In this case, the return type is <code>func(int) int</code>. The name <code>x</code> only appears later, when we write the function that <code>adder</code> will wrap up into a closure-thingy and return."}, {"owner": {"reputation": 169, "user_id": 8228146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30e57d9484fab5de9328762d7522c24f?s=128&d=identicon&r=PG&f=1", "display_name": "Divyansh", "link": "https://stackoverflow.com/users/8228146/divyansh"}, "edited": false, "score": 0, "creation_date": 1565826644, "post_id": 57502895, "comment_id": 101475426, "body": "So when we call <code>pos(i)</code>, Golang knows that the variable <code>i</code> has to be passed on to the <i>return type</i> <code>func(int)</code>.  Then, since the name <code>x</code> appears later, Golang creates a copy of <code>i</code> and assigns it to <code>x</code>. Am I thinking this right?"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 169, "user_id": 8228146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30e57d9484fab5de9328762d7522c24f?s=128&d=identicon&r=PG&f=1", "display_name": "Divyansh", "link": "https://stackoverflow.com/users/8228146/divyansh"}, "edited": false, "score": 0, "creation_date": 1565826919, "post_id": 57502895, "comment_id": 101475480, "body": "Not quite. <code>pos</code> is bound to the closure thingy, and therefore <code>pos</code> has type <code>func(int) int</code>: it&#39;s something you call, passing one <code>int</code>, getting one <code>int</code> back. So <code>pos(i)</code> passes <code>i</code> to the closure thingy, in which you&#39;ve called it <code>x</code>.  The closure thingy is the function created, then returned, inside <code>adder</code>. What we did was create a whole new function from scratch at runtime\u2014although in fact, the actual implementation is done by cheating, in non-JIT compilers."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 2, "last_activity_date": 1565826816, "last_edit_date": 1565826816, "creation_date": 1565822148, "answer_id": 57502895, "question_id": 57502797, "link": "https://stackoverflow.com/questions/57502797/does-golang-automatically-assign-variables-as-arguments-when-writing-function-cl/57502895#57502895", "title": "Does Golang automatically assign variables as arguments when writing function closures?", "body": "<p>Go handles first-class functions and closures in a pretty typical / standard way.  For some good background on closures in general, see <a href=\"https://en.wikipedia.org/wiki/Closure_(computer_programming)\" rel=\"nofollow noreferrer\">the Wikipedia article</a>.  In this case, calling <code>adder</code> itself:</p>\n\n<ol>\n<li>Creates the <code>int</code> object named <code>sum</code> with value <code>0</code>.</li>\n<li>Returns a closure: a function-like thingy<sup>1</sup> that, when called, has access to the variable <code>sum</code>.</li>\n</ol>\n\n<p>The particular function-like thingy that <code>adder</code> returns, which its caller captures in an ordinary variable, is a function that takes one argument.  You then call it, passing the one argument.  There's nothing special about this argument-passing: it works the same way as it would anywhere else.  Inside the function-like thingy, using the variable <code>x</code> gets you the value that the caller passed.  Using the name <code>sum</code> gets you the captured <code>int</code> object, whatever its value is.  Returning from the function leaves the captured <code>int</code> still captured, so a later call to the same function-like thingy sees the updated <code>int</code> in <code>sum</code>.</p>\n\n<p>By calling <code>adder</code> twice, you get two slightly-different function-like thingies: each one has its own private <code>sum</code>.  Both of these private <code>sum</code>s are initially zero.  Calling the function-like thingy whose value you've saved in <code>pos</code> gets you the function that uses one of them.  Calling the slightly-different function-like thingy whose value you've saved in <code>neg</code> gets you the function that uses the other one.</p>\n\n<hr>\n\n<p><sup>1</sup>There's no real difference between this \"function-like thingy\" and an actual function <em>except</em> that this particular function-like thingy doesn't have a <em>name</em> by which you can invoke it.  That's more or less what it means to have first-class functions.</p>\n\n<hr>\n\n<h3>If you're stuck on readability issues...</h3>\n\n<p>The original form of this is:</p>\n\n<pre><code>func adder() func(int) int {\n    sum := 0\n    return func(x int) int {\n        sum += x\n        return sum\n    }\n}\n</code></pre>\n\n<p>Let's rewrite this with a few type names and other syntactic changes that leave the core of the code the same.  First, let's make a name that means <code>func(int) int</code>:</p>\n\n<pre><code>type adderClosure func(int) int\n</code></pre>\n\n<p>Then we can use that to rewrite <code>adder</code>s first line:</p>\n\n<pre><code>func adder() adderClosure {\n    ...\n}\n</code></pre>\n\n<p>Now let's make a local variable inside adder to hold the function we're going to return.  To be explicit and redundant, we can use this type again:</p>\n\n<pre><code>    var ret adderClosure // not good style: just for illustration\n</code></pre>\n\n<p>Let's now assign that variable to our closure by doing this:</p>\n\n<pre><code>    sum := 0\n    ret = func(x int) int {\n        sum += x\n        return sum\n    }\n</code></pre>\n\n<p>and then we can <code>return ret</code> to return the closure.  <a href=\"https://play.golang.org/p/hxLKKAktRD9\" rel=\"nofollow noreferrer\">Here's the complete code on the Go Playground.</a></p>\n"}], "owner": {"reputation": 169, "user_id": 8228146, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30e57d9484fab5de9328762d7522c24f?s=128&d=identicon&r=PG&f=1", "display_name": "Divyansh", "link": "https://stackoverflow.com/users/8228146/divyansh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "accepted_answer_id": 57502895, "answer_count": 2, "score": 0, "last_activity_date": 1565826816, "creation_date": 1565821454, "last_edit_date": 1565824088, "question_id": 57502797, "link": "https://stackoverflow.com/questions/57502797/does-golang-automatically-assign-variables-as-arguments-when-writing-function-cl", "title": "Does Golang automatically assign variables as arguments when writing function closures?", "body": "<p>Here is the code I'm referring to:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc adder() func(int) int {\n    sum := 0\n    return func(x int) int {\n        sum += x\n        return sum\n    }\n}\n\nfunc main() {\n    pos, neg := adder(), adder()\n    for i := 0; i &lt; 10; i++ {\n        fmt.Println(\n            pos(i),\n            neg(-2*i),\n        )\n    }\n}\n</code></pre>\n\n<p>Following is the output when it is run:</p>\n\n<pre><code>    0 0\n    1 -2\n    3 -6\n    6 -12\n    10 -20\n    15 -30\n    21 -42\n    28 -56\n    36 -72\n    45 -90\n</code></pre>\n\n<p>I don't get how <code>x</code> is being assigned in the <code>return</code> statement in the <code>adder</code> function? It does not seem to be passed anywhere in the function.\nI also don't get how the <code>sum</code> variable works. Shouldn't it get reset everytime the function <code>adder</code> is called and be assigned the value <code>0</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 4, "creation_date": 1565816048, "post_id": 57501858, "comment_id": 101472996, "body": "These simple types of questions can be easily answered with minimal research. Please start with <a href=\"https://tour.golang.org/flowcontrol/6\" rel=\"nofollow noreferrer\">A Tour of Go</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565851563, "post_id": 57501858, "comment_id": 101479656, "body": "<a href=\"https://golang.org/ref/spec#Logical_operators\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Logical_operators</a>"}], "answers": [{"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1565816446, "creation_date": 1565816446, "answer_id": 57501984, "question_id": 57501858, "link": "https://stackoverflow.com/questions/57501858/i-dont-understand-the-evaluation-rule-here/57501984#57501984", "title": "I don&#39;t understand the evaluation rule here", "body": "<blockquote>\n  <p>By the way, is it valid if I only write <code>if x, ok := map[3]</code> without a <code>;</code> that extends it?</p>\n</blockquote>\n\n<p>No, this is a syntax error, because <code>x, ok := map[3]</code> is not a boolean expression. In fact, it's not even an expression; <a href=\"https://golang.org/ref/spec#ShortVarDecl\" rel=\"nofollow noreferrer\">a short variable declaration is a statement</a>. So it can't be the expression that controls an <code>if</code>.</p>\n\n<blockquote>\n  <p>but I am confused about the difference between either have a <code>; !ok</code> or a <code>; ok</code> at the end, and the meaning of those two.</p>\n</blockquote>\n\n<p>The same as for any <code>if</code>. If you want the block to run when <code>ok</code> is true, you use <code>if ok</code>. If you want the block to run when <code>ok</code> is false, you use <code>if !ok</code>. The only difference is that we've put the statement that gives <code>ok</code> its value between the word <code>if</code> and the test. </p>\n"}], "owner": {"reputation": 140, "user_id": 11031025, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-G0E69dIUmZc/AAAAAAAAAAI/AAAAAAAAAI0/x45Z7IK0ZAY/photo.jpg?sz=128", "display_name": "Tony Lucas", "link": "https://stackoverflow.com/users/11031025/tony-lucas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "closed_date": 1565851528, "accepted_answer_id": 57501984, "answer_count": 1, "score": -7, "last_activity_date": 1565816781, "creation_date": 1565815714, "last_edit_date": 1565816781, "question_id": 57501858, "link": "https://stackoverflow.com/questions/57501858/i-dont-understand-the-evaluation-rule-here", "closed_reason": "Not suitable for this site", "title": "I don&#39;t understand the evaluation rule here", "body": "<p>I am confused about a syntax usage in Go. </p>\n\n<pre><code>func f(){\n    m := map[int]string{1: \"one\", 2: \"two\"}\n    if x, ok := m[3]; !ok{\n        // do something\n    }\n}\n</code></pre>\n\n<p>I understand what <code>if x, ok := map[3]</code> does, but I am confused about the difference between either have a <code>; !ok</code> or a <code>; ok</code> at the end, and the meaning of those two.</p>\n\n<p>By the way, is it valid if I only write <code>if x, ok := map[3]</code> without a <code>;</code> that extends it?</p>\n\n<p>Thank you!</p>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1565813790, "post_id": 57500652, "comment_id": 101472205, "body": "Can you give the output for a particular case where the JS and Go versions are different?"}, {"owner": {"reputation": 97, "user_id": 7173917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tI-hvMxMLoI/AAAAAAAAAAI/AAAAAAAAAEk/nQ6T2LZUxDE/photo.jpg?sz=128", "display_name": "Spearmint", "link": "https://stackoverflow.com/users/7173917/spearmint"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1565852788, "post_id": 57500652, "comment_id": 101480025, "body": "@jesse No, sorry. Because it is for the website codesignal the output (and input) for that test case is hidden."}], "owner": {"reputation": 97, "user_id": 7173917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tI-hvMxMLoI/AAAAAAAAAAI/AAAAAAAAAEk/nQ6T2LZUxDE/photo.jpg?sz=128", "display_name": "Spearmint", "link": "https://stackoverflow.com/users/7173917/spearmint"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 375, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565890080, "creation_date": 1565809652, "last_edit_date": 1565890080, "question_id": 57500652, "link": "https://stackoverflow.com/questions/57500652/codesignal-hidden-test-case-failing-fareestimator", "title": "CodeSignal hidden test case failing - FareEstimator", "body": "<p>One single hidden test case is continuing to fail, leaving me unknowing on where the fault is in the code. From what I've derived from the function-input restrictions, there should be no special test cases; however, maybe that's the case. All other test cases succeed. Here is the CodeFights description of the problem:</p>\n\n<blockquote>\n  <p>Uber is building a Fare Estimator that can tell you how much your ride will cost before you request it. It works by passing approximated ride distance and ride time through this formula:</p>\n  \n  <p>(Cost per minute) * (ride time) + (Cost per mile) * (ride distance)</p>\n  \n  <p>where Cost per minute and Cost per mile depend on the car type.</p>\n  \n  <p>You are one of the engineers building the Fare Estimator, so knowing cost per minute and cost per mile for each car type, as well as ride distance and ride time, return the fare estimates for all car types.</p>\n</blockquote>\n\n<p>Here are the constraints for the inputs:</p>\n\n<blockquote>\n  <p>10 \u2264 <strong>ride_time</strong> \u2264 50</p>\n  \n  <p>5 \u2264 <strong>ride_distance</strong> \u2264 20</p>\n  \n  <p>4 \u2264 <strong>cost_per_minute.length</strong> \u2264 10</p>\n  \n  <p>0.1 \u2264 <strong>cost_per_minute[i]</strong> \u2264 350.0</p>\n  \n  <p><strong>cost_per_mile.length</strong> = <strong>cost_per_minute.length</strong></p>\n  \n  <p>0.5 \u2264 <strong>cost_per_mile[i]</strong> \u2264 7.0</p>\n</blockquote>\n\n<p>This is for CodeSignal, for a question that seemed easy at first glance. I tried replicating my code in JavaScript and all of the test cases passed there. The only real difference I can see is the conversion from int to float32 in Go (even though JavaScript does this behind the scenes). Thus, I tried to convert the integers and float32:s to float64:s before doing the arithmetic, in belief that there could've been a (very unlikely) fault in that there weren't enough decimals. None of it worked. I also tried to use append(ans, <em>allofthatstuff</em>) but nothing changed.</p>\n\n<p>Go (code in question)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func fareEstimator(ride_time int, ride_distance int, cost_per_minute []float32, cost_per_mile []float32) []float32 {\n    ans := make([]float32, len(cost_per_mile))\n    // ans := []float32{}\n\n    for i := 0; i &lt; len(cost_per_mile); i++ {\n        ans[i] = cost_per_minute[i] * float32(ride_time) + cost_per_mile[i] * float32(ride_distance)\n        // ans = append(ans, cost_per_minute[i] * float32(ride_time) + cost_per_mile[i] * float32(ride_distance))\n    }\n\n    return ans\n}\n</code></pre>\n\n<p>JavaScript</p>\n\n<pre><code>function fareEstimator(ride_time, ride_distance, cost_per_minute, cost_per_mile) {\n  var ans = [];\n\n  for (var i = 0; i &lt; cost_per_mile.length; i++) {\n    ans.push(cost_per_minute[i] * ride_time + cost_per_mile[i] * ride_distance);\n  }\n\n  return ans;\n}\n</code></pre>\n"}, {"tags": ["go", "video-streaming"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1565806969, "post_id": 57499973, "comment_id": 101469693, "body": "After the read you must not use buff past n. You&#39;re copying garbage as soon as there&#39;s a read that&#39;s shorter than any previous read."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1565807258, "post_id": 57499973, "comment_id": 101469797, "body": "Also, in the second version concurrent requests are stepping on each other&#39;s toes because they use the same buffer space. I wouldn&#39;t be surprised if the request for the favicon messes things up."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565809107, "post_id": 57499973, "comment_id": 101470499, "body": "To add to previous comments:  Neither handler exits. Fix by breaking from the loop on read error.   The bytes.NewReader/io.Copy code can be simplified to <code>w.Write(buff[:n])</code> (this also fixes problem mentioned in first comment).  The best fix is to use <a href=\"https://godoc.org/net/http#ServeFile\" rel=\"nofollow noreferrer\">ServeFile</a>."}], "answers": [{"tags": [], "owner": {"reputation": 59, "user_id": 10593233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2fsYK.jpg?s=128&g=1", "display_name": "Eshkod", "link": "https://stackoverflow.com/users/10593233/eshkod"}, "is_accepted": false, "score": -1, "last_activity_date": 1565876955, "creation_date": 1565876955, "answer_id": 57510673, "question_id": 57499973, "link": "https://stackoverflow.com/questions/57499973/why-go-sets-different-content-type-based-on-where-i-declared-the-buffer/57510673#57510673", "title": "Why Go sets different content-type based on where I declared the buffer", "body": "<p>Thanks for the comments, but fixing them still don't change the behaviour. \nFoe example the following code gets<br>\nwrite tcp 127.0.0.1:9008->127.0.0.1:60443: write: broken pipe</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\ntype Viewer struct {\n    ch   chan []byte\n    buff [3][4096]byte\n}\n\nfunc main() {\n    file := \"/Users/someUSer/Documents/Zoom/Ronen/zoom_0.mp4\"\n\n    f, err := os.Open(file)\n    defer f.Close()\n\n    if err != nil {\n        log.Fatalln(err)\n    }\n\n    m := make(map[int]*Viewer)\n    start := make(chan struct{})\n\n    go func() {\n\n        offset := int64(0)\n        &lt;-start\n        log.Println(\"Starting...\")\n        i := 0\n        for {\n            var b [4096]byte\n            n, err := f.ReadAt(b[:], offset)\n            if err != nil {\n                log.Println(err)\n                return\n            }\n\n            offset += int64(n)\n            for _, v := range m {\n                copy(v.buff[i%3][:], b[:n])\n                v.ch &lt;- v.buff[i%3][:n]\n            }\n            i++\n        }\n\n    }()\n\n    http.ListenAndServe(\":9008\", GetVidHandler(m, start))\n\n}\n\nfunc GetVidHandler(m map[int]*Viewer, start chan struct{}) http.HandlerFunc {\n\n    i := 0\n\n    return func(w http.ResponseWriter, r *http.Request) {\n\n        current := i\n        v := &amp;Viewer{ch: make(chan []byte)}\n        m[current] = v\n        i++\n        select {\n        case start &lt;- struct{}{}:\n        default:\n\n        }\n        cn, ok := w.(http.CloseNotifier)\n        if !ok {\n            http.NotFound(w, r)\n            return\n        }\n        // flusher, ok := w.(http.Flusher)\n        // if !ok {\n        //  http.NotFound(w, r)\n        //  return\n        // }\n\n        // Send the initial headers saying we're gonna stream the response.\n        // w.Header().Set(\"Transfer-Encoding\", \"chunked\")\n        // w.Header().Set(\"Content-Type\", \"video/mp4\")\n        // w.WriteHeader(http.StatusOK)\n        // // flusher.Flush()\n\n        // b := &lt;-v.ch\n        // log.Println(current, \"-Writing \", len(b), \" Bytes\")\n        // log.Printf(\"%d - WRITE - First 100 bytes %v\\n\", current, b[:100])\n        // w.Write(b[:len(b)])\n\n        // flusher.Flush()\n        for {\n            select {\n            case &lt;-cn.CloseNotify():\n                log.Println(\"Client stopped listening\")\n                return\n            default:\n                b := &lt;-v.ch\n                re := bytes.NewReader(b[:])\n                _, err := io.Copy(w, re)\n                if err != nil {\n                    log.Println(err)\n\n                }\n            }\n        }\n\n    }\n\n}\n\n//Works\n// func GetVidHandler(f *os.File) http.HandlerFunc {\n\n//  return func(w http.ResponseWriter, r *http.Request) {\n//      offset := int64(0)\n//      var buff [4096]byte\n//      for {\n//          n, _ := f.ReadAt(buff[:], offset)\n//          log.Printf(\"WRITE - First 100 bytes %v\\n\", buff[:100])\n\n//          offset += int64(n)\n//          re := bytes.NewReader(buff[:])\n//          io.Copy(w, re)\n//      }\n//  }\n\n// }\n\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 10593233, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2fsYK.jpg?s=128&g=1", "display_name": "Eshkod", "link": "https://stackoverflow.com/users/10593233/eshkod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565876955, "creation_date": 1565806283, "last_edit_date": 1565807562, "question_id": 57499973, "link": "https://stackoverflow.com/questions/57499973/why-go-sets-different-content-type-based-on-where-i-declared-the-buffer", "title": "Why Go sets different content-type based on where I declared the buffer", "body": "<p>I experiment with steaming video and can't explain the following behaviour.\nI get different response headers from Go's net/http server, from two different handlers, when the only difference is where I declare my buffer.</p>\n\n<p>In the code below there are two handlers where the only difference is that one handler declares the buffer locally. in that version the streaming works correctly, Chrome stream the video, I see it gets response with Transfer-Encoding: chunked and content-type: video/mp4.</p>\n\n<p>In the second version where the buffer is an input param, Chrome doesn't stream the video and the headers are different.</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n)\n\nfunc main() {\n    file := \"/Users/someUser/Documents/Zoom/Ronen/zoom_0.mp4\"\n\n    f, err := os.Open(file)\n    defer f.Close()\n\n    if err != nil {\n        log.Fatalln(err)\n    }\n    http.ListenAndServe(\":9008\", GetVidHandler(f))\n}\n\n//This implementation works, buff is declared locally.\n//I get header of content-type video/mp4\nfunc GetVidHandler(f *os.File) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        offset := int64(0)\n        var buff [4096]byte\n        for {\n            n, _ := f.ReadAt(buff[:], offset)\n            offset += int64(n)\n            re := bytes.NewReader(buff[:])\n            io.Copy(w, re)\n        }\n    }\n}\n\n//This implementation doesn't stream, buff is input param\n//I get header of content-type octet-stream\nfunc GetVidHandler(f *os.File, buff [4096]byte) http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        offset := int64(0)\n        for {\n            n, _ := f.ReadAt(buff[:], offset)\n            offset += int64(n)\n            re := bytes.NewReader(buff[:])\n            io.Copy(w, re)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["macos", "go", "tdd", "influxdb"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1565805151, "post_id": 57498765, "comment_id": 101468932, "body": "Advice: do not use relative imports."}, {"owner": {"reputation": 13, "user_id": 4306786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50a86da1a4a1e357871fa8e8f093c31d?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Pajor", "link": "https://stackoverflow.com/users/4306786/pawel-pajor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566234037, "post_id": 57498765, "comment_id": 101583845, "body": "@mkopriva - thx for the advice"}], "owner": {"reputation": 13, "user_id": 4306786, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/50a86da1a4a1e357871fa8e8f093c31d?s=128&d=identicon&r=PG&f=1", "display_name": "Pawel Pajor", "link": "https://stackoverflow.com/users/4306786/pawel-pajor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565801299, "creation_date": 1565800581, "last_edit_date": 1565801299, "question_id": 57498765, "link": "https://stackoverflow.com/questions/57498765/go-build-error-when-compiling-unit-tests-im-trying-to-mock-influxdb-types", "title": "Go: build error when compiling unit tests (I&#39;m trying to mock influxdb types)", "body": "<p>I'm just starting with go language. \nMy mini-project successfully reads data from <a href=\"https://www.influxdata.com/products/influxdb-overview\" rel=\"nofollow noreferrer\">InfluxDB</a>.\nProblem: when I import my package (which uses InfluxDB) into my unit test package, the build fails. </p>\n\n<p>\"Production\" code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package data\n\nimport client \"github.com/influxdata/influxdb1-client/v2\"\n\nfunc FunctionToTest() {}\n\n// To make import necessary, unused for now\nfunc createClient() (client.Client, error) {\n    return client.NewHTTPClient(client.HTTPConfig{Addr: addr})\n}\n</code></pre>\n\n<p>Unit test:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package data_test\n\nimport (\n    \"../data\"\n    \"testing\"\n)\n\nfunc TestSandBox(t *testing.T) {\n    data.FunctionToTest()\n}\n</code></pre>\n\n<p>I expected this to compile/run but:</p>\n\n<pre><code># crypto/x509\nIn file included from /usr/local/go/src/crypto/x509/root_cgo_darwin.go:17:\nIn file included from /System/Library/Frameworks/Security.framework/Headers/Security.h:31:\n/System/Library/Frameworks/Security.framework/Headers/SecItem.h:452:36: error: expected a version of the form 'major[.minor[.subminor]]'\n    API_AVAILABLE(macos(10.7), ios(NA));\n                                   ^\n/usr/include/os/availability.h:61:181: note: expanded from macro 'API_AVAILABLE'\n    #define API_AVAILABLE(...) __API_AVAILABLE_GET_MACRO(__VA_ARGS__,__API_AVAILABLE6, __API_AVAILABLE5, __API_AVAILABLE4, __API_AVAILABLE3, __API_AVAILABLE2, __API_AVAILABLE1, 0)(__VA_ARGS__)\n                                                                                                                                                                                    ^\n/usr/include/AvailabilityInternal.h:52025:54: note: expanded from macro '__API_AVAILABLE2'\n    #define __API_AVAILABLE2(x,y) __API_A(x) __API_A(y)\n                                                     ^\n/usr/include/AvailabilityInternal.h:52023:79: note: expanded from macro '__API_A'\n    #define __API_A(x) __attribute__((availability(__API_AVAILABLE_PLATFORM_##x)))\n                                                                              ^\n/usr/include/AvailabilityInternal.h:52018:60: note: expanded from macro '__API_AVAILABLE_PLATFORM_ios'\n    #define __API_AVAILABLE_PLATFORM_ios(x) ios,introduced=x\n                                                           ^\n</code></pre>\n\n<p>go env output:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/johndoe/Library/Caches/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/johndoe/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/4q/0yrdcxfd69x4mwzhvmwqg_gh0000gn/T/go-build020613348=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>Thanks for any help or suggestion.</p>\n"}, {"tags": ["go", "types"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1565794752, "post_id": 57497227, "comment_id": 101464201, "body": "Go is a statically typed language, in your example it cannot be other than <code>float64</code> (that&#39;s the default type for the floating point constant <code>12.34</code> which is used in your short variable declaration). If the value is an interface type, then you may use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> which would look something like this: <code>if x, ok := myvar.(float64); ok { fmt.Println(&quot;its float64:&quot;, x) }</code>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1565795070, "post_id": 57497227, "comment_id": 101464395, "body": "See related: <a href=\"https://stackoverflow.com/questions/40343471/how-to-check-if-interface-is-a-slice/40343605#40343605\">How to check if interface{} is a slice</a>."}], "answers": [{"tags": [], "owner": {"reputation": 36, "user_id": 11928035, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/00c6f079046401ac21ec7086c4649bb9?s=128&d=identicon&r=PG", "display_name": "nigma", "link": "https://stackoverflow.com/users/11928035/nigma"}, "is_accepted": true, "score": 2, "last_activity_date": 1565795552, "creation_date": 1565795552, "answer_id": 57497521, "question_id": 57497227, "link": "https://stackoverflow.com/questions/57497227/how-to-find-if-type-is-float64/57497521#57497521", "title": "How to find if type is float64", "body": "<p>You know that <code>myvar</code> is a <code>float64</code> because the variable is declared with the concrete type <code>float64</code>.  </p>\n\n<p>If <code>myvar</code> is an interface type, then you can use a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to determine if the concrete value is some type.</p>\n\n<pre><code>var myvar interface{} = 12.34\nif _, ok := myvar.(float64); ok {\n    fmt.Println(\"Type is float64.\")\n}\n</code></pre>\n\n<p>Try this program at <a href=\"https://play.golang.org/p/n5ftbp5V2Sx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/n5ftbp5V2Sx</a></p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "closed_date": 1565815577, "accepted_answer_id": 57497521, "answer_count": 1, "score": -5, "last_activity_date": 1565795552, "creation_date": 1565794615, "question_id": 57497227, "link": "https://stackoverflow.com/questions/57497227/how-to-find-if-type-is-float64", "closed_reason": "Needs details or clarity", "title": "How to find if type is float64", "body": "<p>I am trying to find if a variable is of type float64: </p>\n\n<pre><code>package main\nimport (\"fmt\")\nfunc main() {\n    myvar := 12.34\n    if myvar.(type) == float64 { \n        fmt.Println(\"Type is float64.\")\n    }\n}\n</code></pre>\n\n<p>However, it is not working and giving following error: </p>\n\n<pre><code>./rnFindType.go:6:10: use of .(type) outside type switch\n./rnFindType.go:6:21: type float64 is not an expression\n</code></pre>\n\n<p>What is the problem and how can it be solved?</p>\n"}, {"tags": ["go", "amazon-s3", "minio"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565790074, "post_id": 57495835, "comment_id": 101461562, "body": "Not sure if this relates, but have you seen this? <a href=\"https://stackoverflow.com/a/49151642/13860\">stackoverflow.com/a/49151642/13860</a>"}, {"owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565790528, "post_id": 57495835, "comment_id": 101461843, "body": "@Flimzy hmmm, actually my parts are smaller than 5mb, but I changed the minimum limit in my minio server, so it shouldn&#39;t raise a problem :-?"}], "owner": {"reputation": 1081, "user_id": 1185148, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/bhzy9.jpg?s=128&g=1", "display_name": "meshkati", "link": "https://stackoverflow.com/users/1185148/meshkati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 408, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565790014, "creation_date": 1565789660, "last_edit_date": 1565790014, "question_id": 57495835, "link": "https://stackoverflow.com/questions/57495835/how-to-get-list-of-failed-parts-on-s3-multipart-upload", "title": "How to get list of failed parts on s3 multipart upload", "body": "<p>sometimes after completing the multipart upload request with s3 client, I get this error:</p>\n\n<pre><code>InvalidPart: One or more of the specified parts could not be found. The part may not have been uploaded, or the specified entity tag may not match the part's entity tag.\\n\\tstatus code: 400, request id: 15BACD159D8498B7\n</code></pre>\n\n<p>there is no error on any <code>s3client.UploadPart(partInput)</code> calls, so the parts are uploaded well, and my <code>completedParts</code> slice is complete and all of the <code>s3.CompletedPart</code> are in it.</p>\n\n<p>How can I identify those \"One or more\" parts that s3 can't find and re-upload them?</p>\n"}, {"tags": ["postgresql", "go", "pgx"], "comments": [{"owner": {"reputation": 1042, "user_id": 9351817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37be8b4983da6e36d462dcc9e4e7090a?s=128&d=identicon&r=PG&f=1", "display_name": "J Spratt", "link": "https://stackoverflow.com/users/9351817/j-spratt"}, "edited": false, "score": 2, "creation_date": 1565791381, "post_id": 57495725, "comment_id": 101462337, "body": "My guess is that <code>NULL</code> is being explicitly passed rather than implicitly."}, {"owner": {"reputation": 2485, "user_id": 1257775, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5266f3439852a16a84f7ab4c7284fba7?s=128&d=identicon&r=PG", "display_name": "Adam Silver", "link": "https://stackoverflow.com/users/1257775/adam-silver"}, "reply_to_user": {"reputation": 1042, "user_id": 9351817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37be8b4983da6e36d462dcc9e4e7090a?s=128&d=identicon&r=PG&f=1", "display_name": "J Spratt", "link": "https://stackoverflow.com/users/9351817/j-spratt"}, "edited": false, "score": 0, "creation_date": 1565792702, "post_id": 57495725, "comment_id": 101463058, "body": "Does that mean I can&#39;t depend on default SQL values when using pgx?!"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565792774, "post_id": 57495725, "comment_id": 101463095, "body": "@AdamSilver did you try a version that&#39;s not &quot;under development&quot;, e.g. non-v4?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1042, "user_id": 9351817, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/37be8b4983da6e36d462dcc9e4e7090a?s=128&d=identicon&r=PG&f=1", "display_name": "J Spratt", "link": "https://stackoverflow.com/users/9351817/j-spratt"}, "edited": false, "score": 0, "creation_date": 1565796202, "post_id": 57495725, "comment_id": 101465039, "body": "Is it possible to enable dumping of SQL statements coming in in your Postgres instance? (Or for a specific connection, or client)? I&#39;d just peer at the log to be sure what gets sent. Maybe the <code>pgx</code> package has a similar debugging facility? I mean, @JSpratt had most probably guessed correctly: <code>pgx</code> explicitly sends <code>NULL</code> for every parameter you did not specify."}], "owner": {"reputation": 2485, "user_id": 1257775, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/5266f3439852a16a84f7ab4c7284fba7?s=128&d=identicon&r=PG", "display_name": "Adam Silver", "link": "https://stackoverflow.com/users/1257775/adam-silver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565789292, "creation_date": 1565789292, "question_id": 57495725, "link": "https://stackoverflow.com/questions/57495725/pgx-says-i-violate-not-null-constraint-despite-having-default-now", "title": "pgx says I violate not-null constraint despite having DEFAULT NOW()", "body": "<p>So I have this table:</p>\n\n<pre><code>CREATE TABLE customer (\n    id SERIAL PRIMARY KEY,\n    name character varying(30) NOT NULL,\n    created_at timestamp with time zone NOT NULL DEFAULT NOW()\n);\n</code></pre>\n\n<p>And I have <code>github.com/jackc/pgx/v4</code> in my import statement. </p>\n\n<p>My Go code looks like this:</p>\n\n<pre><code>    conn, err := pgx.Connect(context.Background(), os.Getenv(\"postgres://user:@127.0.0.1:5432/dbname\"))\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Unable to connection to database: %v\\n\", err)\n        os.Exit(1)\n    }\n    defer conn.Close(context.Background())\n\n    _, err = conn.Exec(context.Background(), \"INSERT INTO customer(name) values($1)\", \"something\")\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2019/08/14 09:24:26 ERROR: null value in column \"created_at\" violates not-null constraint (SQLSTATE 23502)\nexit status 1\n</code></pre>\n\n<p>How come when I have <code>DEFAULT NOW()</code>? I tried creating a recored from my DB GUI client (Postico) and <code>created_at</code> field got auto-populated.</p>\n\n<p>What's wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1565769076, "post_id": 57489987, "comment_id": 101450833, "body": "<code>Hour</code> is a function, and so is <code>Minute</code>. To get the actual value, call those functions, don&#39;t assing them."}, {"owner": {"reputation": 17, "user_id": 11925999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/um833.jpg?s=128&g=1", "display_name": "Mantas Silanskas", "link": "https://stackoverflow.com/users/11925999/mantas-silanskas"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565769312, "post_id": 57489987, "comment_id": 101450939, "body": "So I need make 3 functions one for Time.Now, Hour and Minute and then call them to my function ?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1565769690, "post_id": 57489987, "comment_id": 101451112, "body": "You can use <code>(now.Hour() * 60) + now.Minute()</code> to get 600 if it&#39;s 10:00, no need to pass the result to <code>ParseDuration</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565769819, "post_id": 57489987, "comment_id": 101451183, "body": "<a href=\"https://play.golang.com/p/v6kcR7Mq80-\" rel=\"nofollow noreferrer\">play.golang.com/p/v6kcR7Mq80-</a>"}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565771715, "post_id": 57490402, "comment_id": 101452142, "body": "To be explicit: <a href=\"https://play.golang.org/p/qTZwz-gKgxw\" rel=\"nofollow noreferrer\">Time.Truncate does not produce local midnight outside of UTC</a>. You have to decide if the intended result is what a continuously running stopwatch would show, or if it&#39;s what you would naively infer from a clock on the wall: <a href=\"https://play.golang.org/p/UUMHJJIPo-B\" rel=\"nofollow noreferrer\">play.golang.org/p/UUMHJJIPo-B</a>"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1565769189, "creation_date": 1565769189, "answer_id": 57490402, "question_id": 57489987, "link": "https://stackoverflow.com/questions/57489987/how-do-i-take-minutes-and-hours-from-time-now-function/57490402#57490402", "title": "How do I take minutes and hours from time.Now() function", "body": "<p>First, convert your time object to an interval. It sounds like what you care about is hours/minutes since midnight, so refer to <a href=\"https://stackoverflow.com/q/25254443/13860\">this post</a> to calculate midnight for your local time, or UTC, whichever you care about.  Then determine the duration since midnight, the you can easily use the <code>Hours</code> or <code>Minutes</code> methods on the <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\">Duration</a> type.</p>\n\n<p>Putting it all together:</p>\n\n<pre><code>midnight := time.Now().Truncate(24 * time.Hour) // or similar, depending on exact needs\ndur := time.Since(midnight)\nhours := dur.Hours()\nmins := dur.Minutes()\n</code></pre>\n\n<p>Note that <code>Hours()</code> and <code>Minutes()</code> return floats, not integers. If you need integers, do your own conversion.</p>\n\n<p>The <code>time.Time</code> object also has the <code>Hour</code> and <code>Minute</code> methods, which may do what you want, but they give less control when it comes to timezone handling.</p>\n\n<pre><code>now := time.Now()\nhour := now.Hour()\nmin := now.Minute()\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 11925999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/um833.jpg?s=128&g=1", "display_name": "Mantas Silanskas", "link": "https://stackoverflow.com/users/11925999/mantas-silanskas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 1, "closed_date": 1565788844, "answer_count": 1, "score": -2, "last_activity_date": 1565779036, "creation_date": 1565767666, "last_edit_date": 1565768834, "question_id": 57489987, "link": "https://stackoverflow.com/questions/57489987/how-do-i-take-minutes-and-hours-from-time-now-function", "closed_reason": "Not suitable for this site", "title": "How do I take minutes and hours from time.Now() function", "body": "<p>I am doing program for one of checking I need real time in minutes like if its 10:00 I should have 600 minutes</p>\n\n<p>I tried using time.Now() function and .Hour and .Minute and it works but sadly when it comes to ParseDuration to get minutes of hours I get these errors :\ngo:91:4: assignment mismatch: 1 variable but time.ParseDuration returns 2 values\ngo:91:25: cannot use hours (type func() int) as type string in argument to time.ParseDuration</p>\n\n<pre><code>now := time.Now()\nhours := (now.Hour)\nminutes := (now.Minute)\nm := time.ParseDuration(hours)\n</code></pre>\n\n<p>I expect get real time in minutes as integer that i could use in my if statements and cycles</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1565767158, "post_id": 57489797, "comment_id": 101449994, "body": "<code>UnmarshalJSON</code> always takes a <code>[]byte</code>, never an <code>io.Reader</code>. If you pass <code>io.Reader</code> to <code>json.NewDecoder</code> and then call <code>Decode</code> on that, your custom <code>UnmarshalJSON</code> will still get a <code>[]byte</code> that will hold the contents of that reader."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565767363, "post_id": 57489797, "comment_id": 101450074, "body": "... note also, that if the only reason to implement the custom unmarshaler is so that you can handle the enum, it might, in that case, be more sensible to declare a type for that enum and have that implement the unmarshaler interface instead of the struct."}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": 0, "last_activity_date": 1565775906, "last_edit_date": 1565775906, "creation_date": 1565770003, "answer_id": 57490631, "question_id": 57489797, "link": "https://stackoverflow.com/questions/57489797/decode-enum-from-json-from-io-reader-in-golang/57490631#57490631", "title": "Decode enum from json from io.Reader in golang", "body": "<p>According to the <a href=\"https://golang.org/pkg/encoding/json/#RawMessage.UnmarshalJSON\" rel=\"nofollow noreferrer\">doc</a>, here is the signature of UnmarshalJson. So the argument of the UnmarshalJson can only be of type <code>[]byte</code></p>\n\n<p>If the input is a <code>io.Reader</code>, you can use <a href=\"https://golang.org/src/encoding/json/stream.go?s=683:720#L21\" rel=\"nofollow noreferrer\">NewDecoder</a> and <a href=\"https://golang.org/src/encoding/json/stream.go?s=1425:1472#L39\" rel=\"nofollow noreferrer\">Decode</a>. With that the result can then be pass to UnmarshalJSON.</p>\n\n<p>The other option would be to create another method that will call <code>UnmarshalJson</code> under the hood </p>\n\n<pre><code>func (s *MyJsonStruct) myUnmarshalJSON(r io.Reader) error {\n        type Aux MyJsonStruct;\n        var a *Aux = (*Aux)(s);\n\n        d := json.NewDecoder(r)\n        d.Decode(&amp;a)\n        b := json.Marshal(a)\n        s.UnmarshalJson(b)\n}\n\nfunc (s *MyJsonStruct) UnmarshalJSON([]byte) error {\n\n    type Aux MyJsonStruct;\n    var a *Aux = (*Aux)(s);\n\n    d := json.NewDecoder(r)\n    d.Decode(&amp;a)\n\n\n    if s.Key != Enum1 &amp;&amp; s.Key != Enum2 {\n        s.Key = \"\"\n        return errors.New(\"invalid value for Key\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 563, "user_id": 10714010, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8d1de8ea4503b597aab9c31e5654c197?s=128&d=identicon&r=PG&f=1", "display_name": "user10714010", "link": "https://stackoverflow.com/users/10714010/user10714010"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 382, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565775906, "creation_date": 1565766793, "last_edit_date": 1565771017, "question_id": 57489797, "link": "https://stackoverflow.com/questions/57489797/decode-enum-from-json-from-io-reader-in-golang", "title": "Decode enum from json from io.Reader in golang", "body": "<p>I have a field in json that is either <code>abc</code> or <code>def</code> and I want to make sure that when I unmarshal the data it checks that the field only contains either of the 2 valid values, is there a way to do that in golang without adhoc checking?</p>\n\n<p>I know I can do it if I have the json in byte</p>\n\n<pre><code>const(\n   Enum1 = \"abc\"\n   Enum1 = \"def\"\n)\n\nfunc (s *MyJsonStruct) UnmarshalJSON(data []byte) error {\n    type Aux MyJsonStruct;\n    var a *Aux = (*Aux)(s);\n    err := json.Unmarshal(data, &amp;a)\n    if err != nil {\n        return err\n    }\n\n    if s.Key != Enum1 &amp;&amp; s.Key != Enum2 {\n        s.Key = \"\"\n        return errors.New(\"invalid value for Key\")\n    }\n}\n</code></pre>\n\n<p>How to override <code>UnmarshalJSON</code> if the input is <code>io.Reader</code></p>\n"}, {"tags": ["postgresql", "docker", "go"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 2, "creation_date": 1565771283, "post_id": 57489782, "comment_id": 101451917, "body": "That is not a problem with run.sh, as your output clearly states. It is a go problem."}, {"owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "edited": false, "score": 0, "creation_date": 1565787314, "post_id": 57489782, "comment_id": 101459910, "body": "Add your go code."}, {"owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "edited": false, "score": 1, "creation_date": 1566219949, "post_id": 57489782, "comment_id": 101576545, "body": "just assuming - i had a look at the code at <a href=\"https://github.com/codegangsta/gin/\" rel=\"nofollow noreferrer\">github.com/codegangsta/gin</a> and saw that this issue arrises if you try to run a command that does not exist"}], "owner": {"reputation": 561, "user_id": 5644413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CfH2F.jpg?s=128&g=1", "display_name": "Rishikesh Chandra", "link": "https://stackoverflow.com/users/5644413/rishikesh-chandra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1566219753, "creation_date": 1565766753, "last_edit_date": 1565774733, "question_id": 57489782, "link": "https://stackoverflow.com/questions/57489782/not-able-to-run-go-project-using-run-sh-on-mac-with-postgresql-running-on-docke", "title": "Not able to run Go project using run.sh on Mac, with PostgreSQL running on Docker", "body": "<p>I recently started working on a Go project which was using PostgreSQL on Docker. Everytime running the project using \"run.sh\" gave me the following error.</p>\n\n<pre><code>(base) Rishikeshs-MacBook-Pro:src rishikeshchandra$ ta_api/run.sh\n[gin] Listening on port 3507\n[gin] Building...\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x12aad91]\n\ngoroutine 1 [running]:\nos.(*ProcessState).success(...)\n    /usr/local/go/src/os/exec_posix.go:74\nos.(*ProcessState).Success(...)\n    /usr/local/go/src/os/exec.go:152\ngithub.com/codegangsta/gin/lib.(*builder).Build(0xc0000227e0, 0xc0000c5350, 0x1)\n    /Users/rishikeshchandra/go/src/github.com/codegangsta/gin/lib/builder.go:62 +0x321\nmain.build(0x143a460, 0xc0000227e0, 0x143ae60, 0xc000022840, 0xc0000a4190)\n    /Users/rishikeshchandra/go/src/github.com/codegangsta/gin/main.go:234 +0xb5\nmain.MainAction(0xc0000e0b00)\n    /Users/rishikeshchandra/go/src/github.com/codegangsta/gin/main.go:203 +0xa0c\ngopkg.in/urfave/cli%2ev1.HandleAction(0x134f940, 0x13ee4d0, 0xc0000e0b00, 0xc0000e0b00, 0x0)\n    /Users/rishikeshchandra/go/src/gopkg.in/urfave/cli.v1/app.go:516 +0x127\ngopkg.in/urfave/cli%2ev1.Command.Run(0x13d68cf, 0x3, 0x13d6612, 0x1, 0x0, 0x0, 0x0, 0x13e66cf, 0x32, 0x0, ...)\n    /Users/rishikeshchandra/go/src/gopkg.in/urfave/cli.v1/command.go:171 +0x4a4\ngopkg.in/urfave/cli%2ev1.(*App).Run(0xc000102000, 0xc0000100f0, 0xf, 0xf, 0x0, 0x0)\n    /Users/rishikeshchandra/go/src/gopkg.in/urfave/cli.v1/app.go:265 +0x70b\nmain.main()\n    /Users/rishikeshchandra/go/src/github.com/codegangsta/gin/main.go:140 +0xd17\n</code></pre>\n\n<p>Here is the code on my run.sh file </p>\n\n<pre><code>   #!/bin/bash\n\nexport PORT=3070\nexport PUBLIC_URL=http://localhost:3540\n#export FRONT_TOKEN_CATCH=http://m.com:8080/_tokenCatch/\nexport SECRET=secret\nexport DEBUG=true\nexport SKIP_ROLE_ON_ADMIN=true\nexport AUTO_MIGRATIONS=true\nexport MARKETDATA_SYNC=true\n#export STOCKS_SEED_DIR=./models/stocks/seeds/\n\nexport DB_PG=postgres://postgres:postgres@localhost:5531/postgres?sslmode=disable\n\ngin --appPort 3540 --port 3507 -i -x .git -x .postgress_data -x vendor --build ./cmd/server/ run\n</code></pre>\n"}, {"tags": ["go", "unicode"], "answers": [{"comments": [{"owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "edited": false, "score": 0, "creation_date": 1565766858, "post_id": 57489715, "comment_id": 101449861, "body": "I copy-pasted a wrong letter, sorry. I will edit the question."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1565785548, "post_id": 57489715, "comment_id": 101458918, "body": "Note: for non-trivial ranges there is also <a href=\"https://golang.org/pkg/unicode#RangeTable\" rel=\"nofollow noreferrer\"><code>unicode.RangeTable</code></a> which can be used with things like <a href=\"https://golang.org/pkg/unicode/#In\" rel=\"nofollow noreferrer\"><code>unicode.In</code></a>. The <a href=\"https://godoc.org/golang.org/x/text/unicode/rangetable\" rel=\"nofollow noreferrer\"><code>golang.org&#47;x&#47;text&#47;unicode&#47;rangetable</code></a> package provides some utilities for creating and inspecting <code>unicode.RangeTables</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1565770608, "last_edit_date": 1565770608, "creation_date": 1565766500, "answer_id": 57489715, "question_id": 57489488, "link": "https://stackoverflow.com/questions/57489488/what-is-correct-way-to-check-if-rune-is-in-basic-multilingual-plane/57489715#57489715", "title": "What is correct way to check if rune is in Basic Multilingual Plane?", "body": "<p>Basic Multilingual Plane have the following code point ranges allocated:</p>\n\n<pre><code>0000\u2013\u200b0FFF    8000\u2013\u200b8FFF\n1000\u2013\u200b1FFF    9000\u2013\u200b9FFF\n2000\u2013\u200b2FFF    A000\u2013\u200bAFFF\n3000\u2013\u200b3FFF    B000\u2013\u200bBFFF\n4000\u2013\u200b4FFF    C000\u2013\u200bCFFF\n5000\u2013\u200b5FFF    D000\u2013\u200bDFFF\n6000\u2013\u200b6FFF    E000\u2013\u200bEFFF\n7000\u2013\u200b7FFF    F000\u2013\u200bFFFF\n</code></pre>\n\n<p>So to tell if a rune falls in the basic multilingual plane, just check if it falls inside any of these ranges. Since these ranges cover all values between <code>0</code> and <code>0xffff</code> (both inclusive), just check it like this:</p>\n\n<pre><code>func isBMP(r rune) bool {\n    return r &gt;= 0 &amp;&amp; r &lt;= 0xffff\n}\n</code></pre>\n\n<p>Note that since <code>rune</code> is alias for <code>int32</code>, it may have negative values, so also checking if it's not negative is important.</p>\n\n<p>This will output your expected result. Try it on the <a href=\"https://play.golang.org/p/zAfey8cQZrQ\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Note #2: iterating over the runes of a string which contains invalid UTF-8 bytes, you will get the Unicode replacement character for the invalid bytes, which is <code>0xfffd</code>. If you want to exclude those from your test, you could modify it like:</p>\n\n<pre><code>func isBMP(r rune) bool {\n    return r &gt;= 0 &amp;&amp; r &lt;= 0xffff &amp;&amp; r != 0xfffd\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3509, "user_id": 4243840, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaeabd769bae1bf82fd4b8882fed6653?s=128&d=identicon&r=PG", "display_name": "JGNI", "link": "https://stackoverflow.com/users/4243840/jgni"}, "is_accepted": false, "score": 1, "last_activity_date": 1565766553, "creation_date": 1565766553, "answer_id": 57489730, "question_id": 57489488, "link": "https://stackoverflow.com/questions/57489488/what-is-correct-way-to-check-if-rune-is-in-basic-multilingual-plane/57489730#57489730", "title": "What is correct way to check if rune is in Basic Multilingual Plane?", "body": "<p>I'm not that familiar with go. However a bit of Googleing suggests that a rune is in fact an int32 so as anything in the basic multilingual plain has a code point between 0 and 65535 you should be able to do this</p>\n\n<pre><code>func isBMP(r rune) bool {\n    if r &lt;= 65535 {\n        return true\n    }\n    else {\n        return false\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 57489715, "answer_count": 2, "score": 2, "last_activity_date": 1565770608, "creation_date": 1565765449, "last_edit_date": 1565766886, "question_id": 57489488, "link": "https://stackoverflow.com/questions/57489488/what-is-correct-way-to-check-if-rune-is-in-basic-multilingual-plane", "title": "What is correct way to check if rune is in Basic Multilingual Plane?", "body": "<p>I want to check, whether a given rune is in a <a href=\"https://en.wikipedia.org/wiki/Plane_(Unicode)#Basic_Multilingual_Plane\" rel=\"nofollow noreferrer\">basic multilingual plane</a> or not. </p>\n\n<p>That is, what to put in this function - <a href=\"https://play.golang.org/p/3szTn8pP7xe\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3szTn8pP7xe</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc isBMP(r rune) bool {\n    // ???\n    return false\n}\n\nfunc main() {\n    fmt.Println(isBMP(rune('\u057a'))) // expect true\n    fmt.Println(isBMP(rune('\ud83d\ude02'))) // expect false\n}\n\n</code></pre>\n"}, {"tags": ["docker", "go", "kubernetes", "kubernetes-helm", "circleci"], "comments": [{"owner": {"reputation": 3793, "user_id": 873601, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/16dd69c7d8b13156595bc01387e55224?s=128&d=identicon&r=PG", "display_name": "Vishal Biyani", "link": "https://stackoverflow.com/users/873601/vishal-biyani"}, "edited": false, "score": 1, "creation_date": 1565763932, "post_id": 57489083, "comment_id": 101448695, "body": "Since only go binary is changing - only that layer will be downloaded - and not other layers of the container - I think a container image is a clean option!"}, {"owner": {"reputation": 4525, "user_id": 9423721, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-58LFQeZ--9E/AAAAAAAAAAI/AAAAAAAAAHg/qzH7iR1C4zs/photo.jpg?sz=128", "display_name": "Markus Dresch", "link": "https://stackoverflow.com/users/9423721/markus-dresch"}, "edited": false, "score": 0, "creation_date": 1565771154, "post_id": 57489083, "comment_id": 101451855, "body": "creating a container image is the common way to do this."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565774534, "post_id": 57489083, "comment_id": 101453493, "body": "The idiomatic way is to put the binary in your docker image that helm installs."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565774574, "post_id": 57489083, "comment_id": 101453514, "body": "&quot;I don&#39;t want to have to build and push a new docker image on every binary change.&quot; -- Why not? That is precisely what helm is designed for."}, {"owner": {"reputation": 176, "user_id": 7241983, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3mYmueIOEoA/AAAAAAAAAAI/AAAAAAAAATo/hfPxFB579wU/photo.jpg?sz=128", "display_name": "mathieux51", "link": "https://stackoverflow.com/users/7241983/mathieux51"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565776095, "post_id": 57489083, "comment_id": 101454273, "body": "@Flimzy because it brings the complexity of a private docker registry."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565776189, "post_id": 57489083, "comment_id": 101454326, "body": "That&#39;s part of the complexity inherent in using helm. It&#39;s also not very complex at all."}], "answers": [{"tags": [], "owner": {"reputation": 119, "user_id": 9300022, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--hpkcuS-CTc/AAAAAAAAAAI/AAAAAAAAAGo/o_BsKc-ypok/photo.jpg?sz=128", "display_name": "Marcin Ginszt", "link": "https://stackoverflow.com/users/9300022/marcin-ginszt"}, "is_accepted": false, "score": 0, "last_activity_date": 1565785263, "creation_date": 1565785263, "answer_id": 57494579, "question_id": 57489083, "link": "https://stackoverflow.com/questions/57489083/whats-the-idiomatic-way-to-move-a-go-binary-into-a-pod-before-helm-install/57494579#57494579", "title": "What&#39;s the idiomatic way to move a go binary into a pod before helm install?", "body": "<p>Your CI/CD should simply build a Docker container with that binary. Then you should push it to the private repository. Cluster should download the binary.</p>\n"}, {"comments": [{"owner": {"reputation": 176, "user_id": 7241983, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3mYmueIOEoA/AAAAAAAAAAI/AAAAAAAAATo/hfPxFB579wU/photo.jpg?sz=128", "display_name": "mathieux51", "link": "https://stackoverflow.com/users/7241983/mathieux51"}, "edited": false, "score": 0, "creation_date": 1565846014, "post_id": 57496259, "comment_id": 101478472, "body": "It does help. Thank you."}], "tags": [], "owner": {"reputation": 2069, "user_id": 11207414, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fe8d2b0efd28e43f5580e7546cf912f5?s=128&d=identicon&r=PG&f=1", "display_name": "Mark", "link": "https://stackoverflow.com/users/11207414/mark"}, "is_accepted": false, "score": 1, "last_activity_date": 1565791266, "creation_date": 1565791266, "answer_id": 57496259, "question_id": 57489083, "link": "https://stackoverflow.com/questions/57489083/whats-the-idiomatic-way-to-move-a-go-binary-into-a-pod-before-helm-install/57496259#57496259", "title": "What&#39;s the idiomatic way to move a go binary into a pod before helm install?", "body": "<p>According to the best practices - the binary file should be applied during your build image execution - as mentioned by community above and <a href=\"https://developers.redhat.com/blog/2016/02/24/10-things-to-avoid-in-docker-containers/\" rel=\"nofollow noreferrer\">best developer practices</a>: </p>\n\n<blockquote>\n  <p>Don\u2019t create images from running containers \u2013 In other terms, don\u2019t use \u201cdocker commit\u201d to create an image. This method to create an image is not reproducible  and should be completely avoided. Always use a Dockerfile or any other S2I (source-to-image) approach that is totally reproducible, and you can track changes to the Dockerfile if you store it in a source control repository (git).</p>\n</blockquote>\n\n<p>However, from another point of view you can consider:</p>\n\n<p><strong>1</strong>. <a href=\"https://kubernetes.io/docs/concepts/workloads/pods/init-containers/\" rel=\"nofollow noreferrer\">init contianers</a> to build your image directly on the cluster </p>\n\n<p><strong>2</strong>. <a href=\"https://github.com/GoogleContainerTools/kaniko\" rel=\"nofollow noreferrer\">kaniko</a> with with external location of your build context (gcs bucket git repository) </p>\n\n<p><strong>3</strong>. helm pre-install hook in order to use the above mentioned solutions</p>\n\n<p><strong>4</strong>. finally other solutions like <a href=\"https://cloud.google.com/cloud-build/docs/quickstart-docker#preparing_source_files\" rel=\"nofollow noreferrer\">cloud build</a>  or <a href=\"https://cloud.google.com/cloud-build/docs/build-debug-locally\" rel=\"nofollow noreferrer\">cloud build locally</a>  </p>\n\n<p>Please refer also to \"<a href=\"https://itnext.io/what-i-learned-switching-from-circleci-to-google-cloud-build-b4405de2be38\" rel=\"nofollow noreferrer\">Switching from CircleCI to Google Cloud Build</a>\". \nAs described in the article above you can use <a href=\"https://keel.sh/docs/#helm-example\" rel=\"nofollow noreferrer\">keel</a>  to automatically update your deployments when the image in the docker repository is updated.</p>\n\n<p>Please let me know if it helps.</p>\n"}], "owner": {"reputation": 176, "user_id": 7241983, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-3mYmueIOEoA/AAAAAAAAAAI/AAAAAAAAATo/hfPxFB579wU/photo.jpg?sz=128", "display_name": "mathieux51", "link": "https://stackoverflow.com/users/7241983/mathieux51"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1565791266, "creation_date": 1565763559, "question_id": 57489083, "link": "https://stackoverflow.com/questions/57489083/whats-the-idiomatic-way-to-move-a-go-binary-into-a-pod-before-helm-install", "title": "What&#39;s the idiomatic way to move a go binary into a pod before helm install?", "body": "<p>I use CircleCI to build a go binary that I want to run in a pod installed by Helm charts. I want to move the binary from CircleCI to the remote cluster so it's available when the pod starts. I know it's possible with volumes, like ConfigMap or Secrets but I'm not sure what the best way to do this.</p>\n\n<p>I once made it work with a private docker registry and a kubernetes Secrets for the credentials of the registry but I don't like this option. I don't want to have to build and push a new docker image on every binary change.</p>\n\n<pre><code>version: 2.1\njobs:\n  build_and_deploy:\n    docker:\n      - image: circleci/golang:1.12.7\n    steps:\n      - checkout\n      - run: go get -v -t -d ./...\n      - run: go build cmd/main.go\n      - run: ...\n      - run: helm install\n\nworkflows:\n  version: 2\n  build:\n    jobs:\n      - build_and_deploy:\n</code></pre>\n\n<p>The expected result should be a new binary available on the cluster every time the job runs.</p>\n"}, {"tags": ["go", "concurrency", "channels"], "comments": [{"owner": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 1, "creation_date": 1565761487, "post_id": 57488619, "comment_id": 101447902, "body": "well i dont think thats how you use a channel ... you could try this <a href=\"https://play.golang.org/p/6jDrSPaPrUQ\" rel=\"nofollow noreferrer\">play.golang.org/p/6jDrSPaPrUQ</a>"}, {"owner": {"reputation": 1, "user_id": 11856505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60fb57548c664cb5290c7114b4b3bdd6?s=128&d=identicon&r=PG&f=1", "display_name": "user11856505", "link": "https://stackoverflow.com/users/11856505/user11856505"}, "reply_to_user": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1565786170, "post_id": 57488619, "comment_id": 101459243, "body": "@SivaGuru your approach seems plausible. I will post my solution soon."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565767914, "post_id": 57488784, "comment_id": 101450270, "body": "&quot;Create a third goroutine to send the file.&quot; That doesn&#39;t solve the problem at all; the behavior would be exactly the same as in the original code. The second goroutine must upload the files one at a time to guarantee ordering."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1565761658, "creation_date": 1565761658, "answer_id": 57488784, "question_id": 57488619, "link": "https://stackoverflow.com/questions/57488619/buffered-channels-in-go/57488784#57488784", "title": "Buffered channels in Go", "body": "<p>You are writing one string to the channel, and reading it back. The sendFile() runs in a different goroutine, but there is no need for the channel in the way you're using it. You could simply do </p>\n\n<pre><code> fname:= SaveToFile(uartData)\n go SendFile(fname)\n</code></pre>\n\n<p>However, I don't think this is what you want to do.</p>\n\n<p>Instead, you should have a goroutine in which you read data from the UART, and write to a buffered channel. Listening to that channel is another goroutine that writes blocks of data to a file. When it is ready to be sent, create a third goroutine to send the file.</p>\n"}, {"comments": [{"owner": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1565802692, "post_id": 57495201, "comment_id": 101467965, "body": "as you are ranging over your channel it will be something like a infinite loop(it will be blocking when its empty).The defer close(ch) will make sure that &quot;SendFile&quot; goroutine stops. (<a href=\"https://play.golang.org/p/og5DnPzlu1I\" rel=\"nofollow noreferrer\">play.golang.org/p/og5DnPzlu1I</a>)"}, {"owner": {"reputation": 1, "user_id": 11856505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60fb57548c664cb5290c7114b4b3bdd6?s=128&d=identicon&r=PG&f=1", "display_name": "user11856505", "link": "https://stackoverflow.com/users/11856505/user11856505"}, "reply_to_user": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1565835697, "post_id": 57495201, "comment_id": 101476892, "body": "@SivaGuru thanks for the reply. So, is there a difference between <code>defer close(queue)</code> and <code>close(queue)</code> in the example you sent? I just tested it and the <code>defer close(queue)</code> causes a deadlock at runtime."}, {"owner": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1565840932, "post_id": 57495201, "comment_id": 101477656, "body": "Well defer makes sure that a command gets executed when the function returns or at the end of the function. In the example using defer is bad as the function won&#39;t return. Close(queue) will close the channel instantly.. Defer close(queue) will close when the function returns. As the function won&#39;t return it will be in a deadlock. In your example you can use defer"}, {"owner": {"reputation": 1, "user_id": 11856505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60fb57548c664cb5290c7114b4b3bdd6?s=128&d=identicon&r=PG&f=1", "display_name": "user11856505", "link": "https://stackoverflow.com/users/11856505/user11856505"}, "reply_to_user": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "edited": false, "score": 0, "creation_date": 1565844550, "post_id": 57495201, "comment_id": 101478218, "body": "@SivaGuru thank you for the explanation. Thumbs up!"}], "tags": [], "owner": {"reputation": 1, "user_id": 11856505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60fb57548c664cb5290c7114b4b3bdd6?s=128&d=identicon&r=PG&f=1", "display_name": "user11856505", "link": "https://stackoverflow.com/users/11856505/user11856505"}, "is_accepted": false, "score": 0, "last_activity_date": 1565787495, "creation_date": 1565787495, "answer_id": 57495201, "question_id": 57488619, "link": "https://stackoverflow.com/questions/57488619/buffered-channels-in-go/57495201#57495201", "title": "Buffered channels in Go", "body": "<p>After reading the comments and some online resources the following approach seems to work fine so far. The first 8 minutes in this <a href=\"https://www.youtube.com/watch?v=KBZlN0izeiY\" rel=\"nofollow noreferrer\">video</a> was quite helpful to understand the concept. The <code>defer close(ch)</code> is something I'm uncertain, though.</p>\n\n<pre><code>package main\n\nimport \"strings\"\n\nfunc SendFile(ch chan string) {\n  for filePath := range ch {\n   //upload file here\n  }\n\n}\n\nfunc SaveToFile(uartData []string) filePath string {\n\n    return filePath\n}\n\nfunc main() {\n\n\n    ch := make(chan string, 1000)\n    defer close(ch)\n    go SendFile(&lt;-ch)\n\n    uart := uartInit()\n\n\n    for {\n\n        data := uart.Read(buf)\n        uartData = strings.Split(string(buf), \" \")\n        ch &lt;- SaveToFile(uartData)\n\n    }\n}\n\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11856505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/60fb57548c664cb5290c7114b4b3bdd6?s=128&d=identicon&r=PG&f=1", "display_name": "user11856505", "link": "https://stackoverflow.com/users/11856505/user11856505"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1565787495, "creation_date": 1565760625, "question_id": 57488619, "link": "https://stackoverflow.com/questions/57488619/buffered-channels-in-go", "title": "Buffered channels in Go", "body": "<p>I am working on a project using raspberry pi and an arduino. I'm writing a GO program on the raspberry pi to receive UART data from the Arduino at 115200 baud rate every second. The raspberry pi reads the UART data, saves it to a file (based on the value to either <code>file1</code> or <code>file2</code>, etc), and then send the file to ftp server. </p>\n\n<p>Since uploading to server might take time depending on network I want to use go concurrency so that UART reading and saving to file are not interrupted. The following is pseudocode (skeleton) that I am trying to apply. My thinking in the code is the filepaths will be buffered in the channel sequencially and the upload is performed in the same order. Am I doing it correctly? Is there a better way to approach the problem?</p>\n\n<pre><code>package main\n\nimport \"strings\"\n\nfunc SendFile(filePath string) {\n\n}\n// based on the value of the data, SaveToFile saves the data to either file1, file2 or file3\nfunc SaveToFile(uartData []string) filePath string {\n\n    return filePath\n}\n\nfunc main() {\n\n\n    ch := make(chan string, 1000)\n\n    //uartInit initialization goes here\n    uart := uartInit()\n\n    //infinite loop for reading UART...\n    for {\n        buf := 1024 // UART buffer\n        data := uart.Read(buf)\n        uartData = strings.Split(string(buf), \" \")\n\n        //channel receives filepath \n        ch &lt;- SaveToFile(uartData)\n\n        //channel sends filepath\n        go SendFile(&lt;-ch)\n\n    }\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "kubernetes", "echo", "google-kubernetes-engine"], "comments": [{"owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "edited": false, "score": 0, "creation_date": 1565751014, "post_id": 57487493, "comment_id": 101445862, "body": "What host / interface is that listening on? <code>127.0.0.1&#47;localhost</code>? Or <code>0.0.0.0</code>? If it&#39;s the former then that&#39;s why it&#39;s not working. My guess would be that Gin maybe by default listens on <code>0.0.0.0</code> and Echo doesn&#39;t?"}, {"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565753473, "post_id": 57487493, "comment_id": 101446276, "body": "<code>echo</code> is listening and serving on port 8080 but you are exposing port 80 of the container, are you doing some port forwarding to direct requests from 80 to 8080, if yes, then please share that code as well, if no, then you need to expose port 8080 of the container."}, {"owner": {"reputation": 145, "user_id": 11784615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259f9aed8f8830208f6152fd6be7b8cd?s=128&d=identicon&r=PG&f=1", "display_name": "tonteki", "link": "https://stackoverflow.com/users/11784615/tonteki"}, "reply_to_user": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "edited": false, "score": 0, "creation_date": 1565754855, "post_id": 57487493, "comment_id": 101446494, "body": "@johnharris85 Thank you for answering! Actually gin and echo both are listening on <code>127.0.0.1&#47;localhost</code>"}, {"owner": {"reputation": 145, "user_id": 11784615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259f9aed8f8830208f6152fd6be7b8cd?s=128&d=identicon&r=PG&f=1", "display_name": "tonteki", "link": "https://stackoverflow.com/users/11784615/tonteki"}, "reply_to_user": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565755519, "post_id": 57487493, "comment_id": 101446600, "body": "@PraveenRewar I am not doing anything about port forwarding. I changed <code>EXPOSE 80</code> to <code>EXPOSE 8080</code> and deployed to GKE but the server still doesn&#39;t give us back any response..."}, {"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565756050, "post_id": 57487493, "comment_id": 101446696, "body": "Are you trying to access the APIs (or anything else) from another container or from the host itself. If you are trying to access it from host then you need to do port mapping as well. <code>docker run -p 8080:8080 image_name</code> this will map the 8080 port of the container to the 8080 port of host while running the container."}, {"owner": {"reputation": 145, "user_id": 11784615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259f9aed8f8830208f6152fd6be7b8cd?s=128&d=identicon&r=PG&f=1", "display_name": "tonteki", "link": "https://stackoverflow.com/users/11784615/tonteki"}, "reply_to_user": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565757171, "post_id": 57487493, "comment_id": 101446898, "body": "@PraveenRewar Yes I am trying to access the API(GKE) from localhost. Should I run <code>docker run -p 80:8080 image_name</code>? instead of <code>8080:8080</code> because I want to map 80 and 8080(container).  and I don&#39;t know much about <code>docker run</code> command. Because what I used to do is to run <code>docker build -t image_name</code> and <code>gcloud docker -- push image_name</code> and everything was fine.  when I run <code>docker run -p 80:8080 image_name</code>, server is up and it doesn&#39;t seem that it maps port to another port."}, {"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565757851, "post_id": 57487493, "comment_id": 101447029, "body": "<code>docker run -p 80:8080 image_name</code> should have done the job. What response are you getting when you hit localhost:80? Are you sure the app is up and running inside the container?"}, {"owner": {"reputation": 145, "user_id": 11784615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259f9aed8f8830208f6152fd6be7b8cd?s=128&d=identicon&r=PG&f=1", "display_name": "tonteki", "link": "https://stackoverflow.com/users/11784615/tonteki"}, "reply_to_user": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565793647, "post_id": 57487493, "comment_id": 101463548, "body": "@PraveenRewar Thank you so much! The server started to respond even after module was deployed! I can not thank you enough!"}, {"owner": {"reputation": 83, "user_id": 2889466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9WejX.jpg?s=128&g=1", "display_name": "Albert Sunyer", "link": "https://stackoverflow.com/users/2889466/albert-sunyer"}, "reply_to_user": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565798234, "post_id": 57487493, "comment_id": 101466097, "body": "@PraveenRewar would you mind to write it as an answer to be marked as valid?"}, {"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "reply_to_user": {"reputation": 83, "user_id": 2889466, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9WejX.jpg?s=128&g=1", "display_name": "Albert Sunyer", "link": "https://stackoverflow.com/users/2889466/albert-sunyer"}, "edited": false, "score": 0, "creation_date": 1565798451, "post_id": 57487493, "comment_id": 101466177, "body": "tonteki great :) @AlbertSunyer sure I will."}], "answers": [{"tags": [], "owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "is_accepted": false, "score": 1, "last_activity_date": 1565798866, "creation_date": 1565798866, "answer_id": 57498383, "question_id": 57487493, "link": "https://stackoverflow.com/questions/57487493/the-server-doesnt-respond-anymore-after-i-switch-framework-gin-to-echo/57498383#57498383", "title": "The server doesn&#39;t respond anymore after I switch framework Gin to Echo", "body": "<p>Use the command <code>docker run -p 80:8080 image_name</code> for running the container, it will publish the port 8080 of the container and map it with port 80 of the host.</p>\n"}], "owner": {"reputation": 145, "user_id": 11784615, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/259f9aed8f8830208f6152fd6be7b8cd?s=128&d=identicon&r=PG&f=1", "display_name": "tonteki", "link": "https://stackoverflow.com/users/11784615/tonteki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1565798866, "creation_date": 1565750004, "question_id": 57487493, "link": "https://stackoverflow.com/questions/57487493/the-server-doesnt-respond-anymore-after-i-switch-framework-gin-to-echo", "title": "The server doesn&#39;t respond anymore after I switch framework Gin to Echo", "body": "<p>I used to use Gin(Golang framework) and deploy docker image to GKE.\nIt was working totally fine.</p>\n\n<p>But the server doesn't respond anymore when I switched Gin to Echo(it is also Golang framework)</p>\n\n<p>I think it is because there is something wrong with port combination(port forwarding).</p>\n\n<p>My echo server code is like below.</p>\n\n<pre><code>func main() {\n    e := presentation.Router()\n\n    e.Logger.Fatal(e.Start(\":8080\")) // listen and serve on :8080\n}\n</code></pre>\n\n<p>and my dockerfile is like below.</p>\n\n<pre><code>FROM alpine:3.9\n\nWORKDIR /app\nADD main /app\n\nENV PORT 80\n\nEXPOSE 80\n\nCMD [\"./main\"]\n</code></pre>\n\n<p>When request reaches to 80 port, it has to render to 8080 port (container port).\nBut it doesn't seem that it is working like above at the moment.</p>\n\n<p>How can I match outer port and inner port??</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1565755078, "post_id": 57487057, "comment_id": 101446529, "body": "Write functions (or methods) which set up your objects. Rule of thumb: There is no syntactic sugar or magic in Go; if you need something you have to provide a function which does what you want."}], "answers": [{"comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1565750992, "post_id": 57487218, "comment_id": 101445858, "body": "It is well known pattern and it works great for unit tests.  <a href=\"https://en.wikipedia.org/wiki/Builder_pattern#Go\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Builder_pattern#Go</a>"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 3, "last_activity_date": 1565747294, "creation_date": 1565747294, "answer_id": 57487218, "question_id": 57487057, "link": "https://stackoverflow.com/questions/57487057/initializing-variable-from-const-with-some-changes/57487218#57487218", "title": "Initializing Variable From Const With Some Changes", "body": "<p>If you are really wanting the one-liner, you could do something like</p>\n\n<pre><code>func NewCS() *CompleteSearcher {\n    return &amp;CompleteSearcher{\n        A:     &amp;Searcher{},\n        B:     &amp;Searcher{},\n        C:     &amp;Searcher{},\n        Cache: &amp;Cacher{cache: make(map[string]interface{})},\n    }\n}\n\nfunc (c *CompleteSearcher) WithA(s *Searcher) *CompleteSearcher {\n    c.A = s\n    return c\n}\n\nfunc (c *CompleteSearcher) WithB(s *Searcher) *CompleteSearcher {\n    c.B = s\n    return c\n}\n\nfunc (c *CompleteSearcher) WithC(s *Searcher) *CompleteSearcher {\n    c.C = s\n    return c\n}\n\nfunc (c *CompleteSearcher) WithCacher(s *Cacher) *CompleteSearcher {\n    c.Cache = s\n    return c\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/qNq5scL67zv\" rel=\"nofollow noreferrer\">Playground example</a></p>\n"}], "owner": {"reputation": 43, "user_id": 3875080, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/c42356a1787934e0c4d9d37fdd3a23e7?s=128&d=identicon&r=PG&f=1", "display_name": "user3875080", "link": "https://stackoverflow.com/users/3875080/user3875080"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 57487218, "answer_count": 1, "score": 0, "last_activity_date": 1565747294, "creation_date": 1565745756, "question_id": 57487057, "link": "https://stackoverflow.com/questions/57487057/initializing-variable-from-const-with-some-changes", "title": "Initializing Variable From Const With Some Changes", "body": "<p>I'm trying to create some scenarios for unit testing purposes and running into some problems when dealing with complex objects that I'd like to start from a base state.</p>\n\n<p>In the below example is a simplified case where we have a query builder that may take three parameters. In this case we must always supply all three parameters to avoid a NPE when trying to access a reference.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n)\n\ntype Searcher struct {\n  Param string\n}\n\ntype CompleteSearcher struct {\n  A *Searcher\n  B *Searcher\n  C *Searcher\n}\n\nfunc (c *CompleteSearcher) FormatQuery() string {\n  return fmt.Sprintf(\"%s%s%s\", c.A.Param, c.B.Param, c.C.Param)\n}\n\nfunc main() {\n  testCases := []struct {\n    scenario string\n    want string\n    searcher *CompleteSearcher\n  }{\n    {\n      scenario: \"A populated\",\n      want: \"A\",\n      searcher: &amp;CompleteSearcher{\n          A: &amp;Searcher{Param: \"A\"},\n          B: &amp;Searcher{},\n          C: &amp;Searcher{},\n        },\n    },\n  }\n\n  for _, tc := range testCases {\n    got := tc.searcher.FormatQuery()\n    if got != tc.want {\n      fmt.Println(\"error\")\n    }\n  }\n}\n</code></pre>\n\n<p>My specific problem with this is mostly that the scenario must initialize all fields creating a noisy test where it's somewhat unclear what's actually under test. You can imagine with even more searchable fields, cache classes, backend classes, etc. that a simple enough function can have an enormous object responsible for actually doing the setup.</p>\n\n<p>So what I'd like to do instead is something like the following.</p>\n\n<pre><code>baseSearcher := &amp;CompleteSearcher{\n  A: &amp;Searcher{},\n  B: &amp;Searcher{},\n  C: &amp;Searcher{},\n}\ntestCases := []struct {\n  scenario string\n  want string\n  searcher *CompleteSearcher\n}{\n  {\n    scenario: \"A populated\",\n    want: \"A\",\n    searcher: New(baseSearcher){A: &amp;Searcher{Param: \"A\"}}\n  },\n}\n</code></pre>\n\n<p>Essentially I'd like to be able to test an entire object, but have the option to start with a \"base\" version of that object to prevent repeated setup in each scenario setup. From what I can tell there's no way to create a copy (even a shallow-copy) and then also do another assignment in a single statement, making it effectively impossible to have each scenario handle the object directly.</p>\n\n<p>Any tips on how to resolve this issue?</p>\n"}, {"tags": ["go", "sdl"], "answers": [{"comments": [{"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1565753370, "post_id": 57487747, "comment_id": 101446259, "body": "You are right. That line was an error. I removed it, still the sound is not working fine. For some reason, it plays well only 3 time snow. The 4th time it starts getting messed."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1565754223, "post_id": 57487747, "comment_id": 101446411, "body": "One potential problem could be the values you use for OpenAudio, but I am not familiar with the library, so that&#39;s just a guess. I can&#39;t see anything wrong with the code you posted, maybe there&#39;s something wrong in the sections you didn&#39;t post?"}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "edited": false, "score": 0, "creation_date": 1565783076, "post_id": 57487747, "comment_id": 101457743, "body": "the code outside of this is pretty straight forward. I just run SDL.AUDIOS[&quot;point_normal&quot;].Play(-1,1). Now I changed the wav for another file and it kinda works. But only EXACTLY three times. The fourth time it gets messed up"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1565752602, "creation_date": 1565752602, "answer_id": 57487747, "question_id": 57486839, "link": "https://stackoverflow.com/questions/57486839/sdl2-audio-not-playing-correctly/57487747#57487747", "title": "SDL2 audio not playing correctly", "body": "<p>I don't know the sound library you're using, but these lines look suspicious to me:</p>\n\n<pre><code>defer chunk.Free()\nreturn chunk\n</code></pre>\n\n<p>The returned \"chunk\" will have Free() called on it. Is that really what you intended?</p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565752602, "creation_date": 1565742969, "question_id": 57486839, "link": "https://stackoverflow.com/questions/57486839/sdl2-audio-not-playing-correctly", "title": "SDL2 audio not playing correctly", "body": "<p>Im making a game in Golang using SDL2 binding here : <a href=\"https://github.com/veandco/go-sdl2\" rel=\"nofollow noreferrer\">https://github.com/veandco/go-sdl2</a></p>\n\n<p>The problem is, I added code to play audio and when I try, the audio sound is messed up. you can tell it actually played something because of the duration of the sound, and it got triggered at the right event. But the sound itself is messed up. </p>\n\n<p>Here is my code :</p>\n\n<pre><code>package SDL\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n\n    \"github.com/veandco/go-sdl2/mix\"\n)\n\nvar AUDIOS map[string]*mix.Chunk\n\nfunc init() {\n    AUDIOS = make(map[string]*mix.Chunk)\n    AUDIOS[\"point_normal\"] = LoadAudio(\"sound/effects/point_normal.wav\")\n}\n\nfunc LoadAudio(path string) *mix.Chunk {\n    if err := mix.OpenAudio(44100, mix.DEFAULT_FORMAT, 2, 4096); err != nil {\n        log.Fatalf(\"%s\\n\", err.Error())\n    }\n\n\n    // Load entire WAV data from file\n    data, err := ioutil.ReadFile(path)\n    if err != nil {\n        log.Fatalf(\"%s\\n\", err.Error())\n    }\n\n    // Load WAV from data (memory)\n    chunk, err := mix.QuickLoadWAV(data)\n    if err != nil {\n        log.Fatalf(\"%s\\n\", err.Error())\n    }\n    defer chunk.Free()\n    return chunk\n}\n\nfunc CloseAudio() {\n    mix.CloseAudio()\n}\n</code></pre>\n\n<p>And here is the sound I try to play :</p>\n\n<p><a href=\"https://opengameart.org/sites/default/files/point_normal.wav\" rel=\"nofollow noreferrer\">https://opengameart.org/sites/default/files/point_normal.wav</a></p>\n\n<p>Can someone see anything wrong with my code?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1565791028, "post_id": 57486620, "comment_id": 101462129, "body": "Take a look at all the <code>throw()</code> calls in the runtime if you want to see most of the fatal runtime errors."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 8, "last_activity_date": 1565743585, "last_edit_date": 1565743585, "creation_date": 1565740790, "answer_id": 57486640, "question_id": 57486620, "link": "https://stackoverflow.com/questions/57486620/are-all-runtime-errors-recoverable-in-go/57486640#57486640", "title": "Are all runtime errors recoverable in Go?", "body": "<blockquote>\n  <p>Are there any examples where runtime errors will just crash the\n  program without a recoverable panic?</p>\n</blockquote>\n\n<hr>\n\n<p>For example, Go Out-Of-Memory (OOM) errors are not recoverable.</p>\n\n<hr>\n\n<blockquote>\n  <p><code>src/runtime/panic.go</code>:</p>\n\n<pre><code>// fatalpanic implements an unrecoverable panic. It is like fatalthrow, except\n// that if msgs != nil, fatalpanic also prints panic messages and decrements\n// runningPanicDefers once main is blocked from exiting.\nfunc fatalpanic(msgs *_panic) {\n    // ...\n}\n\n// fatalthrow implements an unrecoverable runtime throw. It freezes the\n// system, prints stack traces starting from its caller, and terminates the\n// process.\nfunc fatalthrow() {\n    // ...\n}\n</code></pre>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1565790934, "post_id": 57489459, "comment_id": 101462067, "body": "We could on an on here, there&#39;s a lot of <code>throw()</code>s in the runtime package, and a data race could really get you anything. Regular SIGSEGVs (without <code>debug.SetPanicOnFault</code>), <code>sync: unlock of unlocked mutex</code>, <code>inconsistent mutex state</code> , <code>alloc too large</code>, all <code>throw()</code> off the top of my head."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1565813590, "last_edit_date": 1565813590, "creation_date": 1565765299, "answer_id": 57489459, "question_id": 57486620, "link": "https://stackoverflow.com/questions/57486620/are-all-runtime-errors-recoverable-in-go/57489459#57489459", "title": "Are all runtime errors recoverable in Go?", "body": "<p>First change your <code>errorHandler()</code> because if there are no panics, <code>r</code> will be <code>nil</code> and thus the type assertion would fail:</p>\n\n<pre><code>func errorHandler() {\n    if r := recover(); r != nil {\n        fmt.Println(r)\n    }\n}\n</code></pre>\n\n<p>And now here are some examples with code to produce unrecoverable runtime errors:</p>\n\n<h3>1. Out of memory:</h3>\n\n<pre><code>func foo() {\n    defer errorHandler()\n    _ = make([]int64, 1&lt;&lt;40) // You have to change the size on 32-bit systems\n}\n</code></pre>\n\n<h3>2. Concurrent map writes and reads</h3>\n\n<p>For details see <a href=\"https://stackoverflow.com/questions/39288741/how-to-recover-from-concurrent-map-writes/39289246#39289246\">How to recover from concurrent map writes?</a>, for example see <a href=\"https://stackoverflow.com/questions/49239367/can-marshalling-a-mapstringstring-to-json-return-an-error/49240146#49240146\">Can marshalling a map[string]string to json return an error?</a></p>\n\n<pre><code>func foo() {\n    defer errorHandler()\n    m := map[string]int{}\n\n    go func() {\n        for {\n            m[\"x\"] = 1\n        }\n    }()\n    for {\n        _ = m[\"x\"]\n    }\n}\n</code></pre>\n\n<h3>3. Stack memory exhaustion</h3>\n\n<p>For details, see <a href=\"https://stackoverflow.com/questions/49940414/does-go-have-an-infinite-call-stack-equivalent/49940717#49940717\">Does Go have an &quot;infinite call stack&quot; equivalent?</a></p>\n\n<pre><code>func foo() {\n    defer errorHandler()\n\n    var f func(a [1000]int64)\n    f = func(a [1000]int64) {\n        f(a)\n    }\n    f([1000]int64{})\n}\n</code></pre>\n\n<h3>4. Attempting to launch a <code>nil</code> function as a goroutine</h3>\n\n<pre><code>func foo() {\n    defer errorHandler()\n    var f func()\n    go f()\n}\n</code></pre>\n\n<h3>5. All goroutines are asleep - deadlock</h3>\n\n<p>Title says it all. Here's a simple code to block the current goroutine, but if you have launched other goroutines, you obviously won't experience the crash. See other examples here: <a href=\"https://stackoverflow.com/questions/36419054/go-projects-main-goroutine-sleep-forever/36419222#36419222\">Go project&#39;s main goroutine sleep forever?</a></p>\n\n<pre><code>func foo() {\n    defer errorHandler()\n    select {}\n}\n</code></pre>\n\n<h3>6. Thread limit exhaustion</h3>\n\n<p>If your goroutines get blocked by IO operations, new threads may be started to execute your other goroutines. There is obviously a limit to the max thread count, if it is reached, your app will crash.</p>\n"}], "owner": {"reputation": 2014, "user_id": 324651, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88e4d6dfda2bce1bbf8e3a2a9fc67a80?s=128&d=identicon&r=PG", "display_name": "chrishiestand", "link": "https://stackoverflow.com/users/324651/chrishiestand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1264, "favorite_count": 3, "accepted_answer_id": 57489459, "answer_count": 2, "score": 10, "last_activity_date": 1565813590, "creation_date": 1565740630, "question_id": 57486620, "link": "https://stackoverflow.com/questions/57486620/are-all-runtime-errors-recoverable-in-go", "title": "Are all runtime errors recoverable in Go?", "body": "<p>I think an equivalent question is - do all runtime errors, which may be fatal, panic? Because anything that panics should be recoverable. I'm not talking about recovering from things like <code>os.Exit()</code>, or <code>log.Fatal()</code>, or bugs in the Go runtime, or someone tripping over the power cord, but from other runtime errors which will lead to the program crashing.</p>\n\n<p>Here's an example of a runtime error that can be caught via panic/recover:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc errorHandler() {\n    r := recover()\n    err := r.(error)\n    if err == nil {\n        return\n    }\n    fmt.Println(err.Error())\n}\n\nfunc foo() {\n    defer errorHandler()\n    smallSlice := []int{1, 0, 1}\n    smallSlice[10] = 1\n}\n\nfunc main() {\n    foo()\n    fmt.Println(\"recovery, end of main\")\n}\n</code></pre>\n\n<p>output:</p>\n\n<blockquote>\n  <p>runtime error: index out of range<br>\n  recovery, end of main</p>\n</blockquote>\n\n<p>Are there any examples where runtime errors will just crash the program without a recoverable panic?</p>\n"}, {"tags": ["go", "graph"], "comments": [{"owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "edited": false, "score": 1, "creation_date": 1565735704, "post_id": 57485791, "comment_id": 101443158, "body": "Does this helps: <a href=\"https://goplay.space/#HT2ejwQsU2L\" rel=\"nofollow noreferrer\">goplay.space/#HT2ejwQsU2L</a>"}], "answers": [{"tags": [], "owner": {"reputation": 97, "user_id": 7173917, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tI-hvMxMLoI/AAAAAAAAAAI/AAAAAAAAAEk/nQ6T2LZUxDE/photo.jpg?sz=128", "display_name": "Spearmint", "link": "https://stackoverflow.com/users/7173917/spearmint"}, "is_accepted": true, "score": 0, "last_activity_date": 1565867395, "last_edit_date": 1565867395, "creation_date": 1565865494, "answer_id": 57508399, "question_id": 57485791, "link": "https://stackoverflow.com/questions/57485791/traverse-an-array-of-pairs/57508399#57508399", "title": "Traverse an array of pairs", "body": "<p>In reality there are a lot of things that could be changed in the code (check out David Narepaks code <a href=\"http://goplay.space/#HT2ejwQsU2L\" rel=\"nofollow noreferrer\">here</a>). However, a quick fix to the <code>Walk</code> function checking if it is the base edge fixes the formatting issue. It should now be called from the <code>main</code> with <code>g.Walk(\"A\", true)</code>.</p>\n\n<pre><code>func (g *Graph) Walk(u string, f bool) {\n    for _, v := range g.Edges[u] {\n        if f == true {\n            fmt.Printf(\"\\n%s -&gt; %s\", u, v)\n        } else {\n            fmt.Printf(\" -&gt; %s\", v)\n        }\n        g.Walk(v, false)\n    }\n}\n</code></pre>\n\n<p><strong>EDIT</strong>\nAcually, you could just check for <code>f</code> and then set u to <code>\"\\n + u\"</code> accordingly:</p>\n\n<pre><code>func (g *Graph) Walk(u string, f bool) {\n    for _, v := range g.Edges[u] {\n        if f {\n            u = \"\\n\" + u\n        } else {\n            u = \"\"\n        }\n        fmt.Printf(\"%s -&gt; %s\", u, v)\n        g.Walk(v, false)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 6924028, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b504aba12a5b0c0f357c1c6c45d1d51?s=128&d=identicon&r=PG&f=1", "display_name": "Roughrider", "link": "https://stackoverflow.com/users/6924028/roughrider"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 94, "favorite_count": 0, "accepted_answer_id": 57508399, "answer_count": 1, "score": 0, "last_activity_date": 1565867395, "creation_date": 1565733428, "question_id": 57485791, "link": "https://stackoverflow.com/questions/57485791/traverse-an-array-of-pairs", "title": "Traverse an array of pairs", "body": "<p>I am trying to understand golang better with some simple graphing. I was trying this out for a class and I can not really figure it out. The thing is I know that the solution is very simple. I am trying to get it to print off each individual path by reading the edges. </p>\n\n<p>I have played with code quite a bit and this is really the simplest form I can get it. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Graph struct {\n    Edges map[string][]string\n}\n\n// NewGraph: Create graph with n nodes.\nfunc NewGraph() *Graph {\n    return &amp;Graph{\n        Edges: make(map[string][]string),\n    }\n}\n\n// AddEdge: Add an edge from u to v.\nfunc (g *Graph) AddEdge(u, v string) {\n    g.Edges[u] = append(g.Edges[u], v)\n\n}\n\n\nfunc (g *Graph) Walk(u string) {\n    for _, v := range g.Edges[u] {\n            fmt.Printf(\"%s -&gt; %s\", u, v)\n        g.Walk(v)\n    }\n}\n\nfunc (g *Graph) adjacentEdgesExample() {\n    fmt.Println(\"Printing all edges in graph.\")\n    for u, adjacent := range g.Edges { // Nodes are labelled 0 to N-1.\n        for _, v := range adjacent {\n            // Edge exists from u to v.\n            fmt.Printf(\"Edge: %s -&gt; %s\\n\", u, v)\n        }\n    }\n}\n\nfunc main() {\n    g := NewGraph()\n    g.AddEdge(\"A\", \"B\")\n    g.AddEdge(\"A\", \"D\")\n    g.AddEdge(\"D\", \"E\")\n    g.AddEdge(\"B\", \"C\")\n    g.adjacentEdgesExample()\n    fmt.Println(g.Edges)\n    g.Walk(\"A\")\n\n}\n</code></pre>\n\n<p>Example is at:</p>\n\n<p><a href=\"https://goplay.space/#Ro1puZYgu5X\" rel=\"nofollow noreferrer\">https://goplay.space/#Ro1puZYgu5X</a></p>\n\n<p>It results in the output of:</p>\n\n<pre><code>Printing all edges in graph.\nEdge: B -&gt; C\nEdge: A -&gt; B\nEdge: A -&gt; D\nEdge: D -&gt; E\nmap[A:[B D] B:[C] D:[E]]\nA -&gt; BB -&gt; CA -&gt; DD -&gt; E% \n</code></pre>\n\n<p>I would like to see the Walk method do something like this:</p>\n\n<pre><code>A -&gt; B -&gt; C\nA -&gt; D -&gt; E\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 1, "creation_date": 1565733528, "post_id": 57485698, "comment_id": 101442672, "body": "You don&#39;t want to marshal or unmarshal the interface, you want to marshal and unmarshal the struct.  <a href=\"https://play.golang.org/p/_QdYcjV9GTo\" rel=\"nofollow noreferrer\">play.golang.org/p/_QdYcjV9GTo</a>"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1565733959, "post_id": 57485698, "comment_id": 101442772, "body": "@sberry I want to read the result into an interface variable, without having to know in advance which concrete type I&#39;m receiving (the actual interface has several possible implementations, and gob data comes in over a network connection).  So, while your code avoids the panic, it does not solve my problem."}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1565736049, "post_id": 57485698, "comment_id": 101443225, "body": "Does it work without your customer marshaling / unmarshaling (will need to export the X field then)"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1565736923, "post_id": 57485698, "comment_id": 101443407, "body": "@sberry Yes, it does!  See <a href=\"https://play.golang.org/p/y8nWNhObUwb\" rel=\"nofollow noreferrer\">play.golang.org/p/y8nWNhObUwb</a> .  I&#39;ve added this link to my question, to make it easier to find."}, {"owner": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1565858115, "post_id": 57485698, "comment_id": 101481848, "body": "<a href=\"https://play.golang.org/p/m6s88GzQDE0\" rel=\"nofollow noreferrer\">play.golang.org/p/m6s88GzQDE0</a>"}, {"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "reply_to_user": {"reputation": 602, "user_id": 6863654, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VaBUN.png?s=128&g=1", "display_name": "beiping96", "link": "https://stackoverflow.com/users/6863654/beiping96"}, "edited": false, "score": 0, "creation_date": 1565884449, "post_id": 57485698, "comment_id": 101493114, "body": "@beiping96 yes, I had thought about this.  Initialising the interface object makes the &quot;interface is nil&quot; error go away.  But for this to work I need to know the concrete type in advance (which I don&#39;t)."}], "owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 177, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565736880, "creation_date": 1565732749, "last_edit_date": 1565736880, "question_id": 57485698, "link": "https://stackoverflow.com/questions/57485698/gob-decoding-into-an-interface-using-unmarshalbinary", "title": "gob-decoding into an interface using UnmarshalBinary", "body": "<p>I am trying to read a gob-encoded Go object into a variable of interface type.  When I let <code>gob</code> to the encoding itself, my code works (see below).  In contrast, when I try to encode/decode the object manually, using <code>MarshalBinary</code> and <code>UnmarshalBinary</code>, my program crashes with the following message:</p>\n\n<pre><code>panic: interface conversion: interface is nil, not encoding.BinaryUnmarshaler [recovered]\n    panic: interface conversion: interface is nil, not encoding.BinaryUnmarshaler\n</code></pre>\n\n<p>What am I doing wrong?</p>\n\n<p><strong>Details.</strong> The interface I am using is given by</p>\n\n<pre><code>type Duck interface {\n    encoding.BinaryMarshaler\n    encoding.BinaryUnmarshaler\n    Quack()\n}\n</code></pre>\n\n<p>The actual object I am encoding and trying to decode is</p>\n\n<pre><code>type A struct {\n    x byte\n}\n\nfunc (a *A) MarshalBinary() ([]byte, error) {\n    return []byte{a.x}, nil\n}\n\nfunc (a *A) UnmarshalBinary(data []byte) error {\n    a.x = data[0]\n    return nil\n}\n\nfunc (a *A) Quack() {\n    fmt.Println(a.x)\n}\n</code></pre>\n\n<p>I have registered the type with gob using</p>\n\n<pre><code>gob.Register(&amp;A{})\n</code></pre>\n\n<p>and encoding objects of type <code>&amp;A</code> seems to work fine.  I try to gob-decode the object into an interface variable using the commands</p>\n\n<pre><code>dec := gob.NewDecoder(buf)\nvar duck2 Duck\ndec.Decode(&amp;duck2)\n</code></pre>\n\n<p>The last of these commands results in the panic shown above.</p>\n\n<p>Full code is on <a href=\"https://play.golang.org/p/-zS7QjEJg9x\" rel=\"nofollow noreferrer\">play.golang.org</a>.</p>\n\n<p><strong>Updated.</strong> Without the custom en-/decoder, the code works (after renaming <code>a.x</code> to <code>a.X</code>, to make the field globally visible): <a href=\"https://play.golang.org/p/y8nWNhObUwb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/y8nWNhObUwb</a></p>\n"}, {"tags": ["go", "recursion"], "comments": [{"owner": {"reputation": 791, "user_id": 1532172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74f854e6ae20716feee1d28df9633360?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/1532172/brian"}, "edited": false, "score": 5, "creation_date": 1565725225, "post_id": 57484245, "comment_id": 101439905, "body": "By my calculations, there are 256^64=2^512 possible states that this array could be in. I don&#39;t think you can realistically loop through all of these combinations before the heat death of the universe."}, {"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "reply_to_user": {"reputation": 791, "user_id": 1532172, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/74f854e6ae20716feee1d28df9633360?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/1532172/brian"}, "edited": false, "score": 1, "creation_date": 1565725378, "post_id": 57484245, "comment_id": 101439959, "body": "Better start now then! jk... it seems you have answered the question I should have been asking."}], "answers": [{"comments": [{"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1565725776, "post_id": 57484389, "comment_id": 101440127, "body": "That first thing you put in your answer... I thought about that. I wasn&#39;t sure if I could essentially make my own data type? an int with a base of 256?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1565725834, "post_id": 57484389, "comment_id": 101440148, "body": "@Jeff That is just the meaning of the representation. But this &quot;data structure&quot; is basically just a byte slice: <code>[]byte</code>."}, {"owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1565725916, "post_id": 57484389, "comment_id": 101440173, "body": "I&#39;ve never done the bitwise operations before. Is that the better way to go?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "edited": false, "score": 0, "creation_date": 1565725975, "post_id": 57484389, "comment_id": 101440205, "body": "@Jeff The first section is if you want to convert a single, arbitrary round number to this byte slice. If you just want to generate them sequentially, then the 2nd section covers that."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1565769237, "last_edit_date": 1565769237, "creation_date": 1565725501, "answer_id": 57484389, "question_id": 57484245, "link": "https://stackoverflow.com/questions/57484245/looping-through-all-values-of-a-byte-array/57484389#57484389", "title": "Looping through all values of a byte array", "body": "<h2>Converting round number to byte array</h2>\n\n<p>This representation is basically the base 256 radix. The first byte will be the <code>round number % 256</code>. Then divide the round number by 256, and repeat until the round number becomes 0.</p>\n\n<p>Since 256 is a special number (256 = 2<sup>8</sup>), you may use bitwise operations for the calculations. E.g. the remainder is equal to bitmasking with <code>0xff</code>, and the division by 256 is equal to shifting right by 8.</p>\n\n<p>Also note that there is a <a href=\"https://golang.org/pkg/math/big/#Int\" rel=\"nofollow noreferrer\"><code>big.Int</code></a> type in the standard library which represents a (signed) multi-precision integer. And it has an <a href=\"https://golang.org/pkg/math/big/#Int.Bytes\" rel=\"nofollow noreferrer\"><code>Int.Bytes()</code></a> method which returns the absolute value as a big-endian byte slice. This is \"almost\" what we want, it's just in different byte order. So you may simply convert a round number to <code>big.Int</code> (e.g. using the <a href=\"https://golang.org/pkg/math/big/#Int.SetString\" rel=\"nofollow noreferrer\"><code>Int.SetString()</code></a> method), get its byte slice and reverse it.</p>\n\n<h2>Iterating over the values</h2>\n\n<p>If you don't want to convert a single round number but just iterate over the subsequent values, then do it like this:</p>\n\n<ol>\n<li><p>You start with a full zero slice or array.</p></li>\n<li><p>Check the first element of the slice. If &lt; 255, simply increment it by one. Done with the iteration.</p></li>\n<li><p>If it was 255, zero it, and attempt to do the same with the 2nd element: go to step 2.</p></li>\n</ol>\n\n<p>So if you have a state, this is how you can calculate the next one:</p>\n\n<pre><code>func next(data []byte) {\n    for idx := range data {\n        if data[idx] &lt; 255 {\n            data[idx]++\n            return\n        }\n        data[idx] = 0\n    }\n    fmt.Println(\"overflow\")\n}\n</code></pre>\n\n<p>This is how you can test it:</p>\n\n<pre><code>data := make([]byte, 64)\nfor iter := 0; iter &lt; 600; iter++ {\n    next(data)\n    fmt.Println(data)\n}\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/kYpaq5EpwMH\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[3 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n...\n[255 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[0 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n...\n[255 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[0 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[1 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n[2 2 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0]\n...\n</code></pre>\n"}], "owner": {"reputation": 3765, "user_id": 843443, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/07748ad3a158dfc6aee92c9bbac06b90?s=128&d=identicon&r=PG", "display_name": "Jeff", "link": "https://stackoverflow.com/users/843443/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 57484389, "answer_count": 1, "score": 2, "last_activity_date": 1565769237, "creation_date": 1565724785, "question_id": 57484245, "link": "https://stackoverflow.com/questions/57484245/looping-through-all-values-of-a-byte-array", "title": "Looping through all values of a byte array", "body": "<p>I'm trying to loop through all values of a small byte array (64 bytes). I want to increment the way a digital clock would, start at index 0, go 0-255 then increment index 1, repeat. I know this is probably a recursion method, but I can't wrap my head around the logic.</p>\n\n<p>So basically, for a 4 byte array (smaller for convenience)</p>\n\n<blockquote>\n  <p>Round 1</p>\n  \n  <p>value: [0 0 0 0]</p>\n  \n  <p>Round 256</p>\n  \n  <p>value [ 255 0 0 0]</p>\n  \n  <p>Round 256</p>\n  \n  <p>value [ 0 1 0 0 ]</p>\n  \n  <p>Round 257</p>\n  \n  <p>value [ 1 1 0 0 ]</p>\n</blockquote>\n\n<p>What I have so far:</p>\n\n<pre><code>func allValues() {\n    currentPlaceIndex := 0\n    content := make([]uint8, 64)\n    max := 256\n\n    for i := 0; i &lt; max; i++ {\n        content[currentPlaceIndex] = uint8(i)\n    }\n    fmt.Println(content)\n    content[currentPlaceIndex] = 0\n\n}\n</code></pre>\n\n<p>I can't seem to figure out how to recurse this.</p>\n"}, {"tags": ["go", "polymorphism"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565722033, "post_id": 57483515, "comment_id": 101438658, "body": "The only form of polymorphism in Go is interfaces, and interfaces describe only behavior; they cannot have fields."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565728316, "post_id": 57483515, "comment_id": 101440994, "body": "<a href=\"https://www.reddit.com/r/golang/comments/7vaw7o/interface_vs_struct_with_the_function_pointers/\" rel=\"nofollow noreferrer\">reddit: interface vs struct with the function pointers</a>"}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565729010, "post_id": 57483515, "comment_id": 101441247, "body": "-2: At this rate, I&#39;ll never become &quot;Inquisitive&quot; :("}], "answers": [{"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1565727845, "post_id": 57483840, "comment_id": 101440862, "body": "Nice answer.  This is similar to the approach that I initially thought I would have to take.  It&#39;s kind of bulky (creating extra wrappers for things) though, so not my preference."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1565722616, "creation_date": 1565722616, "answer_id": 57483840, "question_id": 57483515, "link": "https://stackoverflow.com/questions/57483515/return-polymorphic-type-with-data-member/57483840#57483840", "title": "Return polymorphic type with data member", "body": "<p>http.Server is a struct, so you cannot return a polymorphic object that generalizes that. You can do something else though:</p>\n\n<pre><code>type Server interface {\n  GetURL() string\n  Close() error\n}\n\ntype testServer struct {\n   URL string\n}\n\nfunc (t testServer) Close() error {}\nfunc (t testServer) GetURL() string {return t.URL}\n\ntype httpServer struct {\n    *http.Server\n}\n\nfunc (t httpServer) GetURL() string { return the url }\n</code></pre>\n\n<p>You can then return Server from your function.</p>\n"}, {"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1565728688, "post_id": 57484145, "comment_id": 101441128, "body": "This seems to behave exactly as I had hoped -- and very simple to construct."}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 1, "creation_date": 1565728755, "post_id": 57484145, "comment_id": 101441150, "body": "Don&#39;t even need <code>externalTestServer</code> -- can just use <code>Close: func() {}</code> to create the NOP."}], "tags": [], "owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "is_accepted": true, "score": 2, "last_activity_date": 1565724744, "last_edit_date": 1565724744, "creation_date": 1565724227, "answer_id": 57484145, "question_id": 57483515, "link": "https://stackoverflow.com/questions/57483515/return-polymorphic-type-with-data-member/57484145#57484145", "title": "Return polymorphic type with data member", "body": "<p>You could create a struct that has a field which is a string <code>URL</code> and a field that is a <code>Close</code> <code>func</code>. The <code>Close</code> <code>func</code> can be implemented by either <code>externalTestServer</code> or <code>httptest.Server</code>:</p>\n\n<pre><code>type server struct {\n    URL   string\n    Close func()\n}\n</code></pre>\n\n<pre><code>    if urlbase, ok := optionals[\"urlbase\"].(string); ok {\n        extServer := &amp;externalTestServer{URL: urlbase}\n        return &amp;server{\n            URL:   urlbase,\n            Close: extServer.Close,\n        }\n    }\n    testServer := httptest.NewServer(newMyServerHandler())\n    return &amp;server{\n        URL:   testServer.URL,\n        Close: testServer.Close,\n    }\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 0, "last_activity_date": 1566072686, "creation_date": 1566072686, "answer_id": 57539615, "question_id": 57483515, "link": "https://stackoverflow.com/questions/57483515/return-polymorphic-type-with-data-member/57539615#57539615", "title": "Return polymorphic type with data member", "body": "<p>Chris Drew's approach is ideal for this specific case, because it requires minimal code overhead.  Put another way, it is the simplest thing that will solve today's problem.  The solution uses the magic of an implicit closure (for the <em>receiver</em>) to reference the implementation of <code>Close()</code> polymorphically.</p>\n\n<p>My slightly simplified version of that is here...</p>\n\n<pre><code>type genericServer struct {\n    URL   string // snapshot of internal data\n    Close func() // single-function polymorphism without 'interface'\n}\n\nfunc getTargetServer() genericServer {\n    if urlbase, ok := optionals[\"urlbase\"].(string); ok {\n        return genericServer{URL: urlbase, Close: func() {}}\n    }\n    testServer := httptest.NewServer(newMyServerHandler())\n    return genericServer{URL: testServer.URL, Close: testServer.Close}\n}\n</code></pre>\n\n<hr>\n\n<p>By <em>embedding</em> an actual <em>interface type</em> into to return struct, this concept can be seamlessly extended to better support non-trivial polymorphic interfaces.  In this case, the Polymorphism is explicit based on the internal use of an interface type.  Still, the returned type is a wrapper that includes a copy of the (constant) member data, so the usage is identical -- effectively generalizing that of <a href=\"https://golang.org/pkg/net/http/httptest/#Server\" rel=\"nofollow noreferrer\"><code>*Server</code></a> for this use-case.</p>\n\n<pre><code>type Server interface {\n    Close()\n}\n\ntype nopServer struct {\n}\n\nfunc (nopServer) Close() {}\n\ntype genericServer struct {\n    URL string // snapshot of specific data\n    Server // embedded interface type for explicit polymorphism\n}\n\nfunc getTargetServer() genericServer {\n    if urlbase, ok := optionals[\"urlbase\"].(string); ok {\n        return genericServer{URL: urlbase, Server: nopServer{}}\n    }\n    testServer := httptest.NewServer(newMyServerHandler())\n    return genericServer{URL: testServer.URL, Server: testServer}\n}\n</code></pre>\n\n<hr>\n\n<p>Note that the <code>URL</code> value is not a live member of the implementation, so these solutions, as presented, are only meaningful when the data value will not change, although perhaps that limitation could be overcome by using a pointer.</p>\n"}], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 57484145, "answer_count": 3, "score": -1, "last_activity_date": 1566072709, "creation_date": 1565721010, "last_edit_date": 1566072709, "question_id": 57483515, "link": "https://stackoverflow.com/questions/57483515/return-polymorphic-type-with-data-member", "title": "Return polymorphic type with data member", "body": "<p>I'm trying to write a function <code>getTargetServer()</code> to return a polymorphic type that has both a data member <code>URL</code> and a method <code>Close()</code>.  This would be a generalization of the <a href=\"https://golang.org/pkg/net/http/httptest/#Server\" rel=\"nofollow noreferrer\"><code>*Server</code></a> returned from <a href=\"https://golang.org/pkg/net/http/httptest/#NewServer\" rel=\"nofollow noreferrer\"><code>httptest.NewServer()</code></a> but I want to alternatively be able to return a custom type for which <code>Close()</code> is a NOP.</p>\n\n<pre><code>type externalTestServer struct {\n    URL string\n}\n\nfunc (externalTestServer) Close() {}\n\nfunc getTargetServer() *externalTestServer {\n    if urlbase, ok := optionals[\"urlbase\"].(string); ok {\n        return &amp;externalTestServer{URL: urlbase}\n    } else {\n        testServer := httptest.NewServer(newMyServerHandler())\n        // return testServer // ### Error ###\n        return &amp;externalTestServer{URL: testServer.URL}\n    }\n}\n\nfunc Test_health_check(t *testing.T) {\n    testServer := getTargetServer()\n    defer testServer.Close()\n    response, err := http.Get(testServer.URL + \"/health\")\n    assert.NilError(t, err)\n    assert.Assert(t, cmp.Equal(response.StatusCode, http.StatusOK))\n}\n</code></pre>\n\n<p>This works like a charm except that <code>Close()</code> is <em>always</em> a NOP.  When I uncomment the indicated <code>### Error ###</code> line in order to return a closable <code>*Server</code>, I get the following error message:</p>\n\n<blockquote>\n  <p>cannot use testServer (type *httptest.Server) as type *externalTestServer in return argument</p>\n</blockquote>\n\n<p>I understand the error, but haven't discovered a solution that lets me return a polymorphic type that generalizes <code>*Server</code></p>\n\n<hr>\n\n<p>Note: \"A Tour of Go\" defines an <em>interface type</em> as follows:</p>\n\n<blockquote>\n  <p>An <em>interface type</em> is defined as a set of method signatures.</p>\n</blockquote>\n\n<p>Therefore, returning a simple interface will not allow for directly-accessible data members.</p>\n"}, {"tags": ["go", "build", "bazel"], "answers": [{"tags": [], "owner": {"reputation": 10540, "user_id": 521209, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lmaGX.jpg?s=128&g=1", "display_name": "Jin", "link": "https://stackoverflow.com/users/521209/jin"}, "is_accepted": true, "score": 1, "last_activity_date": 1565751999, "creation_date": 1565751999, "answer_id": 57487689, "question_id": 57482616, "link": "https://stackoverflow.com/questions/57482616/trying-to-write-a-custom-rule/57487689#57487689", "title": "Trying to write a custom rule", "body": "<p>Instead of: </p>\n\n<pre><code>ctx.actions.run(\n        inputs = ctx.attr.schemas,\n</code></pre>\n\n<p>Use:</p>\n\n<pre><code>ctx.actions.run(\n        inputs = ctx.files.schemas,\n</code></pre>\n\n<blockquote>\n  <p>Is this the right approach to generate a rule that executes a command?</p>\n</blockquote>\n\n<p>This looks right, as long as <code>gqlgen</code> creates the file with the correct output name (<code>outputs = [ctx.actions.declare_file(ctx.attr.name)]</code>). </p>\n\n<pre class=\"lang-py prettyprint-override\"><code>generated_go_file = ctx.actions.declare_file(ctx.attr.name + \".go\")\n\n# ..\n\nctx.actions.run(\n    outputs = [generated_go_file],\n    args = [\"run\", \"...\", \"--output\", generated_go_file.short_path],\n    # ..\n)\n</code></pre>\n\n<blockquote>\n  <p>Finally, is it okay to have the output file not exist in the filesystem, but rather be a label on which other rules can depend?</p>\n</blockquote>\n\n<p>The output file needs to be created, and as long as it's returned at the end of the rule implementation in a <a href=\"https://docs.bazel.build/versions/master/skylark/lib/DefaultInfo.html#files\" rel=\"nofollow noreferrer\"><code>DefaultInfo</code> provider</a>, other rules will be able to depend on the file label (e.g. <code>//my/package:foo-gqlgen.go</code>).</p>\n"}], "owner": {"reputation": 832, "user_id": 1738063, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9f890826b3eb5b96a2fea0ffc7a8242?s=128&d=identicon&r=PG", "display_name": "Duarte Nunes", "link": "https://stackoverflow.com/users/1738063/duarte-nunes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 0, "accepted_answer_id": 57487689, "answer_count": 1, "score": 1, "last_activity_date": 1565751999, "creation_date": 1565717187, "question_id": 57482616, "link": "https://stackoverflow.com/questions/57482616/trying-to-write-a-custom-rule", "title": "Trying to write a custom rule", "body": "<p>I'm trying to write a custom rule for <a href=\"https://github.com/99designs/gqlgen\" rel=\"nofollow noreferrer\">gqlgen</a>. The idea is to run it to generate Go code from a GraphQL schema.</p>\n\n<p>My intended usage is:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>gqlgen(\n    name = \"gql-gen-foo\",\n    schemas = [\"schemas/schema.graphql\"],\n    visibility = [\"//visibility:public\"],\n)\n</code></pre>\n\n<p>\"name\" is the name of the rule, on which I want other rules to depend; \"schemas\" is the set of input files.</p>\n\n<p>So far I have:</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>load(\n    \"@io_bazel_rules_go//go:def.bzl\",\n    _go_context = \"go_context\",\n    _go_rule = \"go_rule\",\n)\n\ndef _gqlgen_impl(ctx):\n    go = _go_context(ctx)\n    args = [\"run github.com/99designs/gqlgen --config\"] + [ctx.attr.config]\n    ctx.actions.run(\n        inputs = ctx.attr.schemas,\n        outputs = [ctx.actions.declare_file(ctx.attr.name)],\n        arguments = args,\n        progress_message = \"Generating GraphQL models and runtime from %s\" % ctx.attr.config,\n        executable = go.go,\n    )\n\n_gqlgen = _go_rule(\n    implementation = _gqlgen_impl,\n    attrs = {\n        \"config\": attr.string(\n            default = \"gqlgen.yml\",\n            doc = \"The gqlgen filename\",\n        ),\n        \"schemas\": attr.label_list(\n            allow_files = [\".graphql\"],\n            doc = \"The schema file location\",\n        ),\n    },\n    executable = True,\n)\n\ndef gqlgen(**kwargs):\n    tags = kwargs.get(\"tags\", [])\n    if \"manual\" not in tags:\n        tags.append(\"manual\")\n        kwargs[\"tags\"] = tags\n    _gqlgen(**kwargs)\n\n</code></pre>\n\n<p>My immediate issue is that Bazel complains that the schemas are not <code>Files</code>:</p>\n\n<pre><code>expected type 'File' for 'inputs' element but got type 'Target' instead\n</code></pre>\n\n<p>What's the right approach to specify the input files?</p>\n\n<p>Is this the right approach to generate a rule that executes a command?</p>\n\n<p>Finally, is it okay to have the output file not exist in the filesystem, but rather be a label on which other rules can depend?</p>\n"}, {"tags": ["arrays", "go", "multidimensional-array"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565716943, "post_id": 57482282, "comment_id": 101436476, "body": "<a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/15</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1565719529, "post_id": 57482282, "comment_id": 101437599, "body": "Also see related: <a href=\"https://stackoverflow.com/questions/39561140/how-is-two-dimensional-arrays-memory-representation/39561477#39561477\">How is two dimensional array&#39;s memory representation</a>."}], "answers": [{"comments": [{"owner": {"reputation": 927, "user_id": 798372, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/383ba8f2609a21395b37850a84dc137f?s=128&d=identicon&r=PG", "display_name": "Chris Dennis", "link": "https://stackoverflow.com/users/798372/chris-dennis"}, "edited": false, "score": 0, "creation_date": 1607197121, "post_id": 57482828, "comment_id": 115198625, "body": "Excellent answer, which deserves more attention than it seems to be getting, perhaps because the original question has a low score.  Thanks."}], "tags": [], "owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "is_accepted": false, "score": 4, "last_activity_date": 1565718004, "creation_date": 1565718004, "answer_id": 57482828, "question_id": 57482282, "link": "https://stackoverflow.com/questions/57482282/multi-dimensional-arrays-in-go/57482828#57482828", "title": "multi-dimensional arrays in Go", "body": "<p>You are indeed missing something crucial--in go, slices (which technically is the thing you are creating with the statement <code>genMap := [][]int{}</code>) default to length zero.  You cannot access any elements of <code>genMap</code> because there are none to access, so any attempt to do so results in an index out of range error.  For reference, check out <a href=\"https://stackoverflow.com/questions/7703251/slice-of-slices-types\">this previous answer on SO</a>.</p>\n\n<p>There are a few ways to address this.  You could preallocate the slices, append to each slice as you iterate through the loop, or pick a more convenient data type for your data.</p>\n\n<h2>Preallocate the slices</h2>\n\n<p>As you mention, you could simply allocate the slices to the known length before the loop.  This could potentially lead to speed improvements because you won't be moving values around in memory every time you have to expand the extent of the slices.  Remember, however, that your \"2D array\" is actually a slice of slice of ints, so each internal slice (the <code>[]int</code> part) has to be allocated in a separate step.  You can do this in the loop:</p>\n\n<pre><code>genMap := make([][]int, 10)      // Make the outer slice and give it size 10\nfor i := 0; i &lt; 10; i ++ {\n    genMap[i] = make([]int, 10)  // Make one inner slice per iteration and give it size 10\n    for j := 0; j &lt; 10; j++ {\n        genMap[i][j] = 1\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/-HYGQlEZVqF\" rel=\"nofollow noreferrer\">See the code in action.</a></p>\n\n<h2>Append while iterating</h2>\n\n<p>This is useful if you don't know how large the outer or inner slices will be.  The disadvantage, as stated before, is that you might be moving around a lot of memory when you call <code>append</code>, so this could be inefficient.</p>\n\n<pre><code>genMap := [][]int{}             // Make the outer slice with size 0\nfor i := 0; i &lt; 10; i ++ {\n    m := []int{}                // Make one inner slice per iteration with size 0\n    for j := 0; j &lt; 10; j++ {\n        m = append(m, 1)        // Append to the inner slice\n    }\n    genMap = append(genMap, m)  // Append to the outer slice\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6ymoyIXZQrj\" rel=\"nofollow noreferrer\">See the code in action.</a></p>\n\n<h2>Pick a more convenient data type</h2>\n\n<p>Sometimes it is more useful to design a struct that meets your needs but stores your data in a contiguous slice rather than a slice-of-slices.  This could improve performance and readability of your code.  Such a struct could have methods defined to help inserting and looking up indices, like so:</p>\n\n<pre><code>type TwoD struct {\n    data  []int\n    xSpan int\n    ySpan int\n}\n\n// Factory function\nfunc NewTwoD(xspan, yspan int) *TwoD {\n    return &amp;TwoD{data: make([]int, xspan*yspan), xSpan: xspan, ySpan: yspan}\n}\n\nfunc (td *TwoD) Put(x, y, value int) {\n    // optionally do some bounds checking here\n    td.data[x*td.ySpan+y] = value\n}\n\nfunc (td *TwoD) Get(x, y int) int {\n    // optionally do some bounds checking here\n    return td.data[x*td.ySpan+y]\n}\n\nfunc main() {\n    genMap := NewTwoD(10, 10)\n    for i := 0; i &lt; 10; i++ {\n        for j := 0; j &lt; 10; j++ {\n            genMap.Put(i, j, 1)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/60HzJAfjDRg\" rel=\"nofollow noreferrer\">See the code in action.</a></p>\n\n<p>Additionally, if you are planning on doing linear algebra with these values, consider checking out <a href=\"https://www.gonum.org/\" rel=\"nofollow noreferrer\">Gonum</a> for well-designed, well-tested code to help you out.</p>\n"}], "owner": {"reputation": 11, "user_id": 11923593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec773230072cccbe25013cb44f5a6e70?s=128&d=identicon&r=PG&f=1", "display_name": "Frederico Commore", "link": "https://stackoverflow.com/users/11923593/frederico-commore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2262, "favorite_count": 0, "closed_date": 1565719465, "answer_count": 1, "score": -1, "last_activity_date": 1565718004, "creation_date": 1565715572, "last_edit_date": 1565716063, "question_id": 57482282, "link": "https://stackoverflow.com/questions/57482282/multi-dimensional-arrays-in-go", "closed_reason": "Duplicate", "title": "multi-dimensional arrays in Go", "body": "<p>I'm learning Go and I'm trying to generate a 2d array [][]int that in a nested for loop just puts a value in the spot. Do I always have to create the array with a fixed size using make or is it possible to have this be done dynamically in the loop?</p>\n\n<pre><code>genMap := [][]int{}\nfor i := 0; i &lt; 10; i++ {\n    for j := 0; j &lt; 10; j++ {\n        genMap[i][j] = 1\n    }\n}\nreturn genMap\n</code></pre>\n\n<p>This gives the error index out of range though. So I'm not really sure if this is possible in Go or I'm missing something crucial</p>\n"}, {"tags": ["go", "state-machine", "ragel"], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 9464659, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7cc9c2936d907e7988773df07ba7fac6?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian D. Thurston", "link": "https://stackoverflow.com/users/9464659/adrian-d-thurston"}, "is_accepted": true, "score": 1, "last_activity_date": 1567437717, "creation_date": 1567437717, "answer_id": 57759417, "question_id": 57482237, "link": "https://stackoverflow.com/questions/57482237/difference-between-ragel-transition-actions-and-state-actions/57759417#57759417", "title": "Difference between Ragel transition actions and state actions", "body": "<p>Normally you want to use the transition actions. I actually rarely use the state-based actions. Mostly only when I want to initialize something and I want it to execute before the character is looked at. For example, before a condition is executed. State-based actions are currently the only way to make that happen.</p>\n\n<p>For a while I kind of dreamed of a solution where you could embed transition-based actions that run before the conditions are tested so you wouldn't need the state based actions for init. Using state-based actions always felt a bit like a hack.</p>\n"}], "owner": {"reputation": 1819, "user_id": 431333, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/49da5c89e87500da7d380e6ccd2696bc?s=128&d=identicon&r=PG", "display_name": "contrapsych", "link": "https://stackoverflow.com/users/431333/contrapsych"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 57759417, "answer_count": 1, "score": 0, "last_activity_date": 1567437717, "creation_date": 1565715350, "question_id": 57482237, "link": "https://stackoverflow.com/questions/57482237/difference-between-ragel-transition-actions-and-state-actions", "title": "Difference between Ragel transition actions and state actions", "body": "<p>State machines, the terminology, and the tools are all new to me, though I've been trying to wrap my head around them lately with various online resources. This started when I wanted to build a faster parser than regex in Ragel and Go. I'm stumped on chapter 3 of the <a href=\"https://www.colm.net/files/ragel/ragel-guide-6.9.pdf\" rel=\"nofollow noreferrer\">Ragel docs</a> which covers actions.</p>\n\n<p>It's not clear to me what the difference is between the actions tied to the state transitions vs the states themselves. The examples only have errors for the state embedded actions, so I'm not sure when you would use the <code>to</code> and <code>from</code> operators. I made a simple example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\n%% machine scanner;\n\n%%{\n    action fooStart { fmt.Println(\"foo start\")}\n    action fooEnd   { fmt.Println(\"foo end\")}\n    action barStart { fmt.Println(\"bar start\")}\n    action barEnd   { fmt.Println(\"bar end\")}\n    action bazStart { fmt.Println(\"baz start\")}\n    action bazEnd   { fmt.Println(\"baz end\")}\n\n    main := \"foo\" &gt;fooStart @fooEnd \"bar\" &gt;barStart @barEnd \"baz\" &gt;bazStart @bazEnd;\n}%%\n\n%% write data;\n\nfunc main() {\n    ParseEmbedding([]byte(\"foobarbaz\"))\n}\n\nfunc ParseEmbedding(data []byte) {\n\n\n    cs, p, pe := 0, 0, len(data)\n    %%{\n    write init;\n    write exec;\n    }%%\n}\n</code></pre>\n\n<p>Which outputs the following which is what I expect:</p>\n\n<pre><code>foo start\nfoo end\nbar start\nbar end\nbaz start\nbaz end\n</code></pre>\n\n<p>However, if I replace those with state embedded actions using the same surrounding code:</p>\n\n<p><code>main := \"foo\" &gt;~fooStart %*fooEnd \"bar\" &gt;~barStart %*barEnd \"baz\" &gt;~bazStart %*bazEnd;</code></p>\n\n<p>I get the following output of which the order and missing lines don't make sense to me:</p>\n\n<pre><code>bar start\nfoo end\nbaz start\nbar end\n</code></pre>\n\n<p>My initial impression is state embedded actions are used when you want to only run actions at certain points in the entire state machine instead of the more granular transitions. That still leaves me confused as to the order they are executed in, as well as why the start \"to-state\" action for \"foo\" is not executed.</p>\n\n<p>So my question is, what are some practical reasons or examples to use state actions instead of transition actions? How do they work differently in layman's terms?</p>\n\n<p>Here is a graph of the state embedded actions.\n<a href=\"https://i.stack.imgur.com/Q42Go.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Q42Go.png\" alt=\"state embedded actions\"></a></p>\n"}, {"tags": ["user-interface", "go", "andlabs-ui"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565711971, "post_id": 57480940, "comment_id": 101434410, "body": "It seems pretty clear from a glance at the code that one would expect the <code>ui.NewWindow</code> to be the call that creates a new window. Duplicating <code>ui.Main</code> I would assume is an error, I would expect it to be rather like <code>main()</code>, i.e. something to be called exactly once at startup."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565712288, "post_id": 57480940, "comment_id": 101434597, "body": "I tried <code>func makewinfn() *ui.NewWindow{</code> so that it returns window object but error is: <code>*ui.NewWindow is not a type</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565719825, "post_id": 57480940, "comment_id": 101437717, "body": "Right, it&#39;s a function, that creates and returns a new window object. Have you checked the documentation for this ui package?"}], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565711973, "post_id": 57481207, "comment_id": 101434413, "body": "The window does open but it is blank. I will have to add all components to <code>myOtherWindow</code> also and that is repetition of code. I want this function to return a customized window object which I can use as many times as needed. Problem is <code>Go</code> does not have classes hence how to get such an object."}, {"owner": {"reputation": 756, "user_id": 1991423, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dd760b4f440f7797016bb00260109795?s=128&d=identicon&r=PG&f=1", "display_name": "0xFF", "link": "https://stackoverflow.com/users/1991423/0xff"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565712038, "post_id": 57481207, "comment_id": 101434456, "body": "Make that logic its own function and call it with the appropriate parameters."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565712222, "post_id": 57481207, "comment_id": 101434566, "body": "It will be great if you alter your code to show this."}], "tags": [], "owner": {"reputation": 756, "user_id": 1991423, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/dd760b4f440f7797016bb00260109795?s=128&d=identicon&r=PG&f=1", "display_name": "0xFF", "link": "https://stackoverflow.com/users/1991423/0xff"}, "is_accepted": false, "score": 1, "last_activity_date": 1565710930, "creation_date": 1565710930, "answer_id": 57481207, "question_id": 57480940, "link": "https://stackoverflow.com/questions/57480940/opening-2-identical-windows-simultaneously-from-one-set-of-code/57481207#57481207", "title": "Opening 2 identical windows simultaneously from one set of code", "body": "<p>I don't know Go but assuming the GUI works like any other language I've used, in your makewinfn function you can simply create more windows by calling <code>ui.NewWindow()</code> again.</p>\n\n<pre><code>func makewinfn() {\n    var name = ui.NewEntry()\n    var button = ui.NewButton(\"Greet\")\n    var greeting = ui.NewLabel(\"\")\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name:\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle\", 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n    myOtherWindow := ui.NewWindow(\"MyOtherTitle\", 200, 100, false)\n    myOtherWindow.Show()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565737241, "post_id": 57484123, "comment_id": 101443488, "body": "Great. Is it possible to create these two windows as objects so that I can access their name entry field from anywhere in program?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565738766, "post_id": 57484123, "comment_id": 101443816, "body": "Also, currently closing one window closes both and ends the program. How to only close that window without ending program?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565769492, "post_id": 57484123, "comment_id": 101451021, "body": "Yes, it&#39;s possible, you could store the windows in package level variables (you&#39;ve seen how to do that in your previous question), and the <code>ui.Window</code> has a <code>Window.Title()</code> method for example to get its title. Since this time you have multiple windows, you could store them in multiple variables or in a slice."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565769603, "post_id": 57484123, "comment_id": 101451070, "body": "And if you don&#39;t want to quit when a window is closed, you may set your own function how to handle window closing events, see the <code>Window.OnClosing()</code> method. Set a function in which you don&#39;t quit (or you decrement the visible window count, and if that reaches 0, then quit)."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565786657, "post_id": 57484123, "comment_id": 101459527, "body": "Great. Any idea why I got so many downvotes for this question!?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1565724508, "last_edit_date": 1565724508, "creation_date": 1565724160, "answer_id": 57484123, "question_id": 57480940, "link": "https://stackoverflow.com/questions/57480940/opening-2-identical-windows-simultaneously-from-one-set-of-code/57484123#57484123", "title": "Opening 2 identical windows simultaneously from one set of code", "body": "<p>In UI libraries usually the components or widgets you build the interface with have parents, and usually a single component may have at most one parent.</p>\n\n<p>So if you want 2 windows, having the same components, you still have to create those components in 2 instances, because a component cannot be added to 2 different parents (in 2 different windows).</p>\n\n<p>So simplest would be to move the component and window creation logic into a function, and call that twice from the function you pass to <code>ui.Main()</code>:</p>\n\n<pre><code>func createWindow() {\n    var name = ui.NewEntry()\n    var button = ui.NewButton(\"Greet\")\n    var greeting = ui.NewLabel(\"\")\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name:\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle\", 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n}\n\nfunc makewinfn() {\n    createWindow()\n    createWindow()\n}\n</code></pre>\n\n<p>Using this <code>createWindow()</code> function of course is not a requirement, you could have a loop in <code>makewinfn()</code> with 2 iterations, each which could create a window.</p>\n\n<p>The above example creates 2 identical windows, but they will be \"independent\". If you enter a text in one of them and click on its button, the result will only be seen in its containing / parent window. This is possible because each component has been created twice.</p>\n\n<p>If you wan to customize the windows, you could pass a parameter to <code>createWindow()</code> so the window and its content could be customized / personalized based on its value. For example:</p>\n\n<pre><code>func createWindow(id string) {\n    var name = ui.NewEntry()\n    var button = ui.NewButton(\"Greet \" + id)\n    var greeting = ui.NewLabel(\"\")\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name \" + id + \":\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle \" + id, 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n}\n\nfunc makewinfn() {\n    createWindow(\"one\")\n    createWindow(\"two\")\n}\n</code></pre>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 57484123, "answer_count": 2, "score": -3, "last_activity_date": 1567098201, "creation_date": 1565709933, "last_edit_date": 1567098201, "question_id": 57480940, "link": "https://stackoverflow.com/questions/57480940/opening-2-identical-windows-simultaneously-from-one-set-of-code", "title": "Opening 2 identical windows simultaneously from one set of code", "body": "<p>I am using following code to create and show a window with GUI components as label, entry and button:</p>\n\n<pre><code>// modified from: https://github.com/andlabs/ui/wiki/Getting-Started\npackage main\nimport (\"github.com/andlabs/ui\")\nfunc makewinfn() {\n    var name = ui.NewEntry()\n    var button = ui.NewButton(\"Greet\")\n    var greeting = ui.NewLabel(\"\")\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name:\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle\", 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n}\nfunc main() {\n    ui.Main(makewinfn)\n    // HOW TO CREATE AND SHOW ANOTHER SUCH WINDOW HERE ?\n    // ui.Main(makewinfn) // this opens window only after first is closed.\n}\n</code></pre>\n\n<p>It works well, but as I mentioned in title and as commented in code above, how can I open two such windows simultaneously from main function?</p>\n\n<p>Repeating <code>ui.Main(makewinfn)</code> in main function leads to second window opening only after first is closed.</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["go", "editor", "jetbrains-ide", "goland", "golint"], "comments": [{"owner": {"reputation": 136418, "user_id": 783119, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bbfd3e5e9f8b698abf7cd1c7aae7a10?s=128&d=identicon&r=PG", "display_name": "LazyOne", "link": "https://stackoverflow.com/users/783119/lazyone"}, "edited": false, "score": 1, "creation_date": 1565782066, "post_id": 57480413, "comment_id": 101457282, "body": "1) I&#39;m not a GoLand user 2) From what I see from <a href=\"https://youtrack.jetbrains.com/issues/GO?q=golint\" rel=\"nofollow noreferrer\">GoLand tickets</a>, there is no desire/plan to implement actual linter integration, devs prefer implementing it as a native Inspections instead (as it&#39;s faster and provide more control like quick fixes, suppressing etc etc). That comes from quite old tickets (2016/2017) .. but even one that has recent comments (e.g. <a href=\"https://youtrack.jetbrains.com/issue/GO-2220\" rel=\"nofollow noreferrer\">youtrack.jetbrains.com/issue/GO-2220</a>) still suggests that dev want to go that way. File Watcher seems to be the best way for the moment. For on demand execution: External Tools"}, {"owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "edited": false, "score": 0, "creation_date": 1565782214, "post_id": 57480413, "comment_id": 101457341, "body": "Personally I prefere to decide myself when to run golint over my code. As it only provides suggestions for writing better code I think it could be quite annoying to get those warnings in some situations. I do always check my code at some point and try to follow the suggestions, but I don&#39;t do this all the time. However, golint helped me a lot to write better code in Go."}], "answers": [{"comments": [{"owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "edited": false, "score": 0, "creation_date": 1565781684, "post_id": 57492363, "comment_id": 101457075, "body": "I haven&#39;t used golangci-lint recently, but when I did the last time its output was totally different from what golint returns. It turned out, that it uses a whole bunch of linters, but the real &quot;golint&quot; is missing in the standard configuration. After I changed the call to include &quot;golint&quot;, the result was much better, but still not the same as I&#39;ve got with golint."}, {"owner": {"reputation": 11, "user_id": 10168778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nfJmzIk80J8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oiOrWXjc2z3wqaPl0Drfl_33BiLQ/mo/photo.jpg?sz=128", "display_name": "youze liang", "link": "https://stackoverflow.com/users/10168778/youze-liang"}, "reply_to_user": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "edited": false, "score": 0, "creation_date": 1565797454, "post_id": 57492363, "comment_id": 101465696, "body": "try &#39;golangci-lint&#39; ?"}, {"owner": {"reputation": 804, "user_id": 7171834, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9r1VB.png?s=128&g=1", "display_name": "Peter Gloor", "link": "https://stackoverflow.com/users/7171834/peter-gloor"}, "edited": false, "score": 0, "creation_date": 1565859892, "post_id": 57492363, "comment_id": 101482499, "body": "As mentioned in my comment, I did. It was on Windows. Maybe it&#39;s different on Linux. I&#39;m not interested in the other checks &#39;golangci-lint&#39; provides. In general when using GoLand &#39;go fmt&#39; and &#39;golint&#39; is enough for me. By the way, the guide mentioned in the question works for me, but I disabled it, because most of the time there is a reason I&#39;m aware of why I get the warnings and therefore I find them annoying. I rather prefere to manually run &#39;golint&#39; from the terminal from time to time."}], "tags": [], "owner": {"reputation": 11, "user_id": 10168778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nfJmzIk80J8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oiOrWXjc2z3wqaPl0Drfl_33BiLQ/mo/photo.jpg?sz=128", "display_name": "youze liang", "link": "https://stackoverflow.com/users/10168778/youze-liang"}, "is_accepted": false, "score": -1, "last_activity_date": 1565776443, "creation_date": 1565776443, "answer_id": 57492363, "question_id": 57480413, "link": "https://stackoverflow.com/questions/57480413/golint-support-for-jetbrains-goland/57492363#57492363", "title": "golint support for JetBrains GoLand", "body": "<p>it's an interesting question . Becauese i hava the same trouble like this. the terminal remind the golint not found . I try to add the order 'golint' to zsh . But I found the Golang IDE's preference -- tool --file watching , then you can add the template , the 'golangci-lint' is the tool that you want , though it's not 'golint'. You  could use it</p>\n"}], "owner": {"reputation": 3496, "user_id": 4541492, "user_type": "registered", "accept_rate": 35, "profile_image": "https://lh5.googleusercontent.com/-cOlHMb569P8/AAAAAAAAAAI/AAAAAAAADvQ/wlBHgpWKq7w/photo.jpg?sz=128", "display_name": "Vince Varga", "link": "https://stackoverflow.com/users/4541492/vince-varga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2466, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1574184520, "creation_date": 1565708172, "last_edit_date": 1565710333, "question_id": 57480413, "link": "https://stackoverflow.com/questions/57480413/golint-support-for-jetbrains-goland", "title": "golint support for JetBrains GoLand", "body": "<p>I'm using GoLand IDE for developing Go applications. I decided to use this as lots of things worked out of the box and I'm used to JetBrains IDEs (Android Studio, AppCode, IntelliJ) and I feel very effective with the learned keyboard shortcuts.</p>\n\n<p>Today, I wanted to enable <code>golint</code> on the project I'm working on, however, I didn't find any standard, simple way to add <code>golint</code> to GoLand.</p>\n\n<p>How can I have the linter go through my code and display a warning or error in JetBrains GoLand? I don't want to rely on the command-line tool to execute the command every time, I want to have it in the editor.</p>\n\n<p>Based on the <code>golint</code> output, it seems like it should not be too hard to integrate the output (it includes the file path, line, column, and the error in each line) and display it as an error right in the editor (with the little red lamp).</p>\n\n<p>I followed the only guide I found, <a href=\"https://github.com/vmware/dispatch/wiki/Configure-GoLand-with-golint\" rel=\"nofollow noreferrer\">Configure GoLand with golint</a>, but unfortunately, I don't consider it a good enough solution. The end result of that tutorial is that the IDE open a \"console\" at the bottom of the page, and it just outputs the command result in the IDE. I want to find a way to include it within my code.</p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1565701376, "creation_date": 1565701376, "answer_id": 57478310, "question_id": 57478256, "link": "https://stackoverflow.com/questions/57478256/how-to-unmarshal-a-json-string-with-a-hyphen-in-key-to-a-struct/57478310#57478310", "title": "How to unmarshal a json string with a hyphen in key to a struct?", "body": "<p>Simply use <a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">struct tags</a> to map struct fields to JSON properties:</p>\n\n<pre><code>type User struct {\n    UserName string `json:\"user-Name\"`\n    Age      int\n}\n</code></pre>\n\n<p>With this it will work, try it on the <a href=\"https://play.golang.org/p/LQ7QUbP8yrK\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 15564, "user_id": 6394722, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/117654f31d6ad5c9b2b0e00dcf4b24f3?s=128&d=identicon&r=PG&f=1", "display_name": "atline", "link": "https://stackoverflow.com/users/6394722/atline"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 939, "favorite_count": 0, "accepted_answer_id": 57478310, "answer_count": 1, "score": 2, "last_activity_date": 1565746648, "creation_date": 1565701172, "last_edit_date": 1565746648, "question_id": 57478256, "link": "https://stackoverflow.com/questions/57478256/how-to-unmarshal-a-json-string-with-a-hyphen-in-key-to-a-struct", "title": "How to unmarshal a json string with a hyphen in key to a struct?", "body": "<p>I have following code which is ok, it will print <code>Bob</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype User struct {\n    UserName string  // line2\n    Age  int\n}\n\nfunc main() {\n    var u User\n    str := `{\"userName\":\"Bob\", \"age\": 20}` // line1\n    json.Unmarshal([]byte(str), &amp;u)\n    fmt.Println(u.UserName)\n}\n</code></pre>\n\n<p>Unfortunately, in real case, the json string in <code>line1</code> is next, which you could see there is a hyphen(<code>-</code>) in the key.</p>\n\n<pre><code>str := `{\"user-Name\":\"Bob\", \"age\": 20}`\n</code></pre>\n\n<p>And as you all know, to automatically unmarshal the json string, we have to define a member in struct which is the same name of the key in json string, of course need to make it upper case. So I tried to change <code>line2</code> to <code>User-Name string</code>, but <code>-</code> is not valid in <code>go</code> variable name. What should I do?</p>\n"}, {"tags": ["user-interface", "go", "andlabs-ui"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1565700637, "creation_date": 1565700637, "answer_id": 57478106, "question_id": 57477945, "link": "https://stackoverflow.com/questions/57477945/not-able-to-keep-gui-variables-as-global/57478106#57478106", "title": "Not able to keep GUI variables as global", "body": "<p>When you use variables at the top level (package block), they are initialized before execution of <code>main()</code> begins.</p>\n\n<p>And you call code from the <code>github.com/andlabs/ui</code> package, but its <code>ui.Main()</code> was not yet called, and so the <code>ui</code> package and resources it depends on may not have been initialized.</p>\n\n<p>Only declare the variables but do not yet assign values to them, leave that to the <code>makewinfn()</code> function:</p>\n\n<pre><code>var name *ui.Entry\nvar button *ui.Button\nvar greeting *ui.Label\n\nfunc makewinfn() {\n    name = ui.NewEntry()\n    button = ui.NewButton(\"Greet\")\n    greeting = ui.NewLabel(\"\")\n\n    box := ui.NewVerticalBox()\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 57478106, "answer_count": 1, "score": 1, "last_activity_date": 1567098191, "creation_date": 1565700122, "last_edit_date": 1567098191, "question_id": 57477945, "link": "https://stackoverflow.com/questions/57477945/not-able-to-keep-gui-variables-as-global", "title": "Not able to keep GUI variables as global", "body": "<p>I find following code works: </p>\n\n\n\n<pre><code>// modified from: https://github.com/andlabs/ui/wiki/Getting-Started\npackage main\nimport (\"github.com/andlabs/ui\")\nfunc makewinfn() {\n    var name = ui.NewEntry()\n    var button = ui.NewButton(\"Greet\")\n    var greeting = ui.NewLabel(\"\")\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name:\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle\", 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n}\nfunc main() {\n    ui.Main(makewinfn)\n}\n</code></pre>\n\n<p>However, if I try with global variables:</p>\n\n<pre><code>package main\nimport (\"github.com/andlabs/ui\")\n// keeping following as global variables: \nvar name = ui.NewEntry()\nvar button = ui.NewButton(\"Greet\")\nvar greeting = ui.NewLabel(\"\")\nfunc makewinfn() {\n    box := ui.NewVerticalBox()\n    box.Append(ui.NewLabel(\"Enter your name:\"), false)\n    box.Append(name, false)\n    box.Append(button, false)\n    box.Append(greeting, false)\n    mywindow := ui.NewWindow(\"MyTitle\", 200, 100, false)\n    mywindow.SetChild(box)\n    button.OnClicked( func (*ui.Button) {greeting.SetText(\"Hello, \" + name.Text() + \"!\") } )\n    mywindow.OnClosing( func (*ui.Window) bool { ui.Quit(); return true } )\n    mywindow.Show()\n}\nfunc main() {\n    ui.Main(makewinfn)\n}\n</code></pre>\n\n<p>This code with global variables compiles all right but creates following error on running: </p>\n\n<pre><code>fatal error: unexpected signal during runtime execution\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x7fecb2712e19]\n</code></pre>\n\n<p>How can I keep GUI components as global variables? I have keep them as global so that I can access them from other functions. </p>\n"}, {"tags": ["go", "storage", "blockchain", "private-key", "chaincode"], "answers": [{"tags": [], "owner": {"reputation": 189, "user_id": 3882720, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8a6ecd6e63605eb9ff1fa0687e4f557c?s=128&d=identicon&r=PG&f=1", "display_name": "user3882720", "link": "https://stackoverflow.com/users/3882720/user3882720"}, "is_accepted": false, "score": 0, "last_activity_date": 1565784439, "creation_date": 1565784439, "answer_id": 57494386, "question_id": 57477728, "link": "https://stackoverflow.com/questions/57477728/how-to-store-private-key-in-state-ledger-hyperledger-fabric/57494386#57494386", "title": "How to store Private Key in state ledger Hyperledger Fabric", "body": "<p>I found out that the problem was truly been generated from the peers. The endorsement policy error that I was getting has to do with the peers and I had difficult times to find the solution. </p>\n\n<p>So, the problem was that in my chaincode I was storing a key in the ledger that was generated through  a function that I had to pass as a parameter a random variable : rand io.Reader</p>\n\n<p>That random variable was created each time in each peer differently so that was causing a conflict in the peers. </p>\n\n<p>To conclude, keep in mind that each time you are creating a chaincode and you run it, you install it in 2 or more peers and each peer runs the chaincode differently! Very important. </p>\n\n<p>Thank you.</p>\n"}], "owner": {"reputation": 189, "user_id": 3882720, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/8a6ecd6e63605eb9ff1fa0687e4f557c?s=128&d=identicon&r=PG&f=1", "display_name": "user3882720", "link": "https://stackoverflow.com/users/3882720/user3882720"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565784439, "creation_date": 1565699225, "question_id": 57477728, "link": "https://stackoverflow.com/questions/57477728/how-to-store-private-key-in-state-ledger-hyperledger-fabric", "title": "How to store Private Key in state ledger Hyperledger Fabric", "body": "<p>I have a problem storing a generated ecdsa Private Key in the database of Hyperledger Fabric. </p>\n\n<p>What I am doing is using the ecdsa.GenerateKey(elliptic.P224(), rand.Reader) function that ecdsa provides and trying to store that key in the ledger with the PutState() function of shim. The type of variable that is in struct is ecdsa.PrivateKey but when I try that the chaincode seems to stop and get the following error:</p>\n\n<p>Error: could not assemble transaction: ProposalResponsePayloads do not match - proposal response: version:1 response:</p>\n\n<p>Of course this indicates that the chaincode is not installed in both Organization peers. But I have. Then I tried to convert the ecdsa.PrivateKey into bytes and then to string but nothing seems to work. I will attach the code bellow.</p>\n\n<pre><code>    type UserDetails struct {\nObjectType string          `json:\"docType\"`\nFirstName  string          `json:\"firstName\"`\nLastName   string          `json:\"lastName\"`\nPublicKey  ecdsa.PublicKey `json:\"publicKey\"`\nPrivateKey []byte          `json:\"privateKey\"`\n    }\n</code></pre>\n\n<p>This above is my structure</p>\n\n<pre><code>    priv, err := ecdsa.GenerateKey(elliptic.P224(), rand.Reader)\nif err != nil {\n    fmt.Println(err)\n}\n\nenc_key := priv.D.Bytes()\nfmt.Println(enc_key)\n\nbytesPrivK := string(enc_key)\n\n\n\nobjectType := \"userDetails\"\nuserDetailsReg := &amp;UserDetails{objectType, firstName, lastName, *ecdsaPublicKey, enc_key}\nuserDetailsJSONasBytes, err := json.Marshal(userDetailsReg)\nif err != nil {\n    return shim.Error(err.Error())\n}\nfmt.Println(userDetailsReg)\n// === Save userDetails to state ===\nerr = stub.PutState(lastName, userDetailsJSONasBytes)\nif err != nil {\n    return shim.Error(err.Error())\n}\n</code></pre>\n\n<p>I also tried with the ecies package to generate an ecies private key then convert it to ecdsa and store it but still same error. I used ecies cause I need to encrypt message with the ecies encryption.</p>\n\n<pre><code>prv, err := ecies.GenerateKey(rand.Reader, ecies.DefaultCurve, nil)\nif err != nil {\n    fmt.Println(err.Error())\n}\n\neciesPrivatePem, err1 := ecies.MarshalPrivate(prv)\nif err1 != nil {\n    fmt.Println(err1)\n}\nencodedToStr := string(eciesPrivatePem)\n\necdsaPrivate := prv.ExportECDSA()\n</code></pre>\n\n<p>Here I tried either to store in an ecies.PrivateKey type or in string or even ecdsa.PrivateKey but always getting the same error.</p>\n\n<p>I am using the Hyperledger Fabric and CouchDB for this. Does anyone know why I cant store that even as a string? It seems really strange that even as a string a cant store it although the other 2 variables are strings and 1 ecdsa.PublicKey types. I cant find any other error in logs that indicates something more here. </p>\n\n<p>Any help or recommendation would be appreciated.</p>\n\n<p>Thank you</p>\n"}, {"tags": ["go", "circleci", "alpine", "bitbucket-cli"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565701080, "post_id": 57477007, "comment_id": 101428152, "body": "What does <code>go env</code> show on each platform?"}, {"owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565703563, "post_id": 57477007, "comment_id": 101429536, "body": "@Peter I&#39;ve updated my question to show this. They seem to be almost identical besides the <code>-fdebug-prefix-map</code>"}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1565711373, "post_id": 57477007, "comment_id": 101434112, "body": "Possibly related to the fact that alpine uses <code>musl</code>?"}, {"owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "reply_to_user": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1565716873, "post_id": 57477007, "comment_id": 101436442, "body": "@Zyl maybe, but the curious part is why I&#39;m getting different results on the same alpine image for different CI&#39;s."}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1565774539, "post_id": 57477007, "comment_id": 101453495, "body": "Is there any platform/environment at all on which you can get the binary produced by the Circle CI build to run and does the one from Bitbucket run there as well? I know that&#39;s tapping in the dark but maybe it&#39;s a start."}, {"owner": {"reputation": 21104, "user_id": 191450, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24a895bcec11df8f488a259f518063fc?s=128&d=identicon&r=PG", "display_name": "koblas", "link": "https://stackoverflow.com/users/191450/koblas"}, "edited": false, "score": 0, "creation_date": 1565891085, "post_id": 57477007, "comment_id": 101495855, "body": "What is the output from CircleCI for the steps that complete?  (e.g are we failing at &quot;go get&quot; or &quot;golint&quot;)?"}, {"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1565922366, "post_id": 57477007, "comment_id": 101504210, "body": "How do you get the compiled binary out of the build and running on the <code>alpine:3.9</code> image?"}, {"owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "reply_to_user": {"reputation": 21104, "user_id": 191450, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/24a895bcec11df8f488a259f518063fc?s=128&d=identicon&r=PG", "display_name": "koblas", "link": "https://stackoverflow.com/users/191450/koblas"}, "edited": false, "score": 0, "creation_date": 1565960984, "post_id": 57477007, "comment_id": 101516838, "body": "@koblas we aren&#39;t failing on CircleCI. I&#39;m going to try to get a reproducible this weekend"}, {"owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "reply_to_user": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1565961130, "post_id": 57477007, "comment_id": 101516906, "body": "@PabloLalloni I push it to a repo, run <code>alpine:3.9</code>, pull it down, and try to run it"}, {"owner": {"reputation": 1175, "user_id": 118015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9358fac88a1320409e7842a71dde5fcf?s=128&d=identicon&r=PG", "display_name": "Giovanni Bajo", "link": "https://stackoverflow.com/users/118015/giovanni-bajo"}, "edited": false, "score": 0, "creation_date": 1566134553, "post_id": 57477007, "comment_id": 101553244, "body": "It&#39;s not clear what command triggers the error. You&#39;re showing the error (exec format) and the CI script, but you&#39;re not showing what you do after the CI finishes (it&#39;s not even clear whether the CI finishes correctly or not). You should show the full CI log, and what exact command you&#39;re using that generates that error."}, {"owner": {"reputation": 85, "user_id": 5218121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b308136b453109457c54443dbc9fab7d?s=128&d=identicon&r=PG&f=1", "display_name": "big pigeon", "link": "https://stackoverflow.com/users/5218121/big-pigeon"}, "edited": false, "score": 0, "creation_date": 1566441201, "post_id": 57477007, "comment_id": 101659588, "body": "try <code>RUN mkdir &#47;lib64 &amp;&amp; ln -s &#47;lib&#47;libc.musl-x86_64.so.1 &#47;lib64&#47;ld-linux-x86-64.so.2</code> in linux apline 3,8"}], "answers": [{"comments": [{"owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "edited": false, "score": 0, "creation_date": 1566217532, "post_id": 57556366, "comment_id": 101575071, "body": "Unfortunately I don&#39;t think this is the problem because both already had it enabled and one works."}, {"owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "reply_to_user": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "edited": false, "score": 0, "creation_date": 1566220436, "post_id": 57556366, "comment_id": 101576829, "body": "To clarify, disabling means setting 0 for CGO_ENABLED. To enable, value must be 1 which is the usual default. Go release plays a role and installation could be customized. This is why forcing 0 in CircleCI could solve it."}], "tags": [], "owner": {"reputation": 730, "user_id": 6161244, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/990831a04db3b7c4a8ac83e67e00817d?s=128&d=identicon&r=PG", "display_name": "Constantin Konstantinidis", "link": "https://stackoverflow.com/users/6161244/constantin-konstantinidis"}, "is_accepted": false, "score": 1, "last_activity_date": 1566216260, "creation_date": 1566216260, "answer_id": 57556366, "question_id": 57477007, "link": "https://stackoverflow.com/questions/57477007/circleci-vs-bitbucket-go-build-issue/57556366#57556366", "title": "CircleCI vs Bitbucket Go Build Issue", "body": "<p>This <a href=\"https://github.com/golang/go/issues/28065\" rel=\"nofollow noreferrer\">issue</a> might be related.</p>\n\n<p>Setting <code>CGO_ENABLED=0</code> on alpine might solve it unless it is required by your build. The line to add could be like:\n<code>export CGO_ENABLED=0</code></p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566398683, "post_id": 57585551, "comment_id": 101645702, "body": "<code>GOMOD</code> is not read from the environment (so setting it will have no effect), it&#39;s additional information provided by <code>go env</code> and it&#39;s the absolute path to the go.mod of the main module."}], "tags": [], "owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "is_accepted": false, "score": -2, "last_activity_date": 1566368598, "creation_date": 1566368598, "answer_id": 57585551, "question_id": 57477007, "link": "https://stackoverflow.com/questions/57477007/circleci-vs-bitbucket-go-build-issue/57585551#57585551", "title": "CircleCI vs Bitbucket Go Build Issue", "body": "<blockquote>\n  <blockquote>\n    <p>GOMOD=\"/root/project/go.mod\"</p>\n  </blockquote>\n</blockquote>\n\n<p>Well, taking the fact that there is exactly one difference between the two environments, I'd say your GOMOD value is the culprit.</p>\n\n<blockquote>\n  <blockquote>\n    <p>Bitbucket CI go env\n    GOMOD=\"/opt/atlassian/pipelines/agent/build/go.mod\"</p>\n  </blockquote>\n</blockquote>\n\n<p>As an aside, check your go version as well, modules did not run before golang 1.6 if I remember my gopher trivia correctly.</p>\n"}], "owner": {"reputation": 7556, "user_id": 2761425, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e4c6951078654e01f8e31294982ccc3b?s=128&d=identicon&r=PG&f=1", "display_name": "bryan", "link": "https://stackoverflow.com/users/2761425/bryan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 461, "favorite_count": 2, "answer_count": 2, "score": 9, "last_activity_date": 1566368598, "creation_date": 1565696447, "last_edit_date": 1565732477, "question_id": 57477007, "link": "https://stackoverflow.com/questions/57477007/circleci-vs-bitbucket-go-build-issue", "title": "CircleCI vs Bitbucket Go Build Issue", "body": "<p>I'm running a <code>go build</code> command on a <code>golang:1.11-alpine</code> on two separate CI tools. As you can see the commands are exactly the same and the docker image is exactly the same.</p>\n\n<p>For some reason, when I run the compiled executable on an <code>alpine:3.9</code> docker image, only the <strong>bitbucket</strong> runs.</p>\n\n<p>For the Circle CI build, I get the following error:</p>\n\n<blockquote>\n  <p>standard_init_linux.go:207: exec user process caused \u201cexec format error\u201d</p>\n</blockquote>\n\n<p>I was reading online that it might be an architecture issue so I did a <code>file &lt;file&gt;</code> in the terminal and it appears both were compiled the same way. Here is the response I received for both files (identical):</p>\n\n<blockquote>\n  <p>cloud: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib/ld-musl-x86_64.so.1, stripped</p>\n</blockquote>\n\n<h2>Circle CI</h2>\n\n<pre><code>docker:\n  - image: golang:1.11-alpine\n\nsteps:\n  - checkout\n  - run:\n      name: Build Go Server\n      command: |\n        apk add --no-cache git build-base\n        export GOPATH=\"$HOME/go\"\n        export PATH=\"$PATH:$GOPATH/bin\"\n        go get -u github.com/golang/lint/golint@v0.0.0-20190227174305-8f45f776aaf1\n        go mod vendor\n        golint -set_exit_status $(go list ./... | grep -v /vendor/)\n        go test -short $(go list ./... | grep -v /vendor/)\n        go build -ldflags=\"-s -w\"\n</code></pre>\n\n<h2>Bitbucket CI</h2>\n\n<pre><code>steps:\n    - step: &amp;step-test-and-build-go\n            name: Test and Build Go Server\n            image: golang:1.11-alpine\n            script:\n                - apk add --no-cache git build-base\n                - export GOPATH=\"$HOME/go\"\n                - export PATH=\"$PATH:$GOPATH/bin\"\n                - go get -u github.com/golang/lint/golint@v0.0.0-20190227174305-8f45f776aaf1\n                - go mod vendor\n                - golint -set_exit_status $(go list ./... | grep -v /vendor/)\n                - go test -short $(go list ./... | grep -v /vendor/)\n                - go build -ldflags=\"-s -w\"\n</code></pre>\n\n<h2>Circle CI <code>go env</code></h2>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/root/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/root/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/root/project/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build122963699=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<h2>Bitbucket CI <code>go env</code></h2>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/root/.cache/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/root/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\nGCCGO=\"gccgo\"\nCC=\"gcc\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/opt/atlassian/pipelines/agent/build/go.mod\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build179086021=/tmp/go-build -gno-record-gcc-switches\"\n</code></pre>\n\n<p>I have cross-posted this question <a href=\"https://discuss.circleci.com/t/circleci-vs-bitbucket-go-build-issue/31898\" rel=\"noreferrer\">to the CircleCI forum</a>.</p>\n"}, {"tags": ["python", "go", "aws-sdk", "aws-api-gateway", "aws-sdk-go"], "comments": [{"owner": {"reputation": 4677, "user_id": 1420332, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/Xms75.png?s=128&g=1", "display_name": "Dmitry Harnitski", "link": "https://stackoverflow.com/users/1420332/dmitry-harnitski"}, "edited": false, "score": 0, "creation_date": 1565736925, "post_id": 57476977, "comment_id": 101443408, "body": "<a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/apigateway/\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/apigateway</a>"}, {"owner": {"reputation": 4349, "user_id": 5030709, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/tbBL9.jpg?s=128&g=1", "display_name": "Imran", "link": "https://stackoverflow.com/users/5030709/imran"}, "edited": false, "score": 0, "creation_date": 1565751699, "post_id": 57476977, "comment_id": 101445981, "body": "Have you tried <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/signer/v4/\" rel=\"nofollow noreferrer\">aws-signer-v4</a>?. <code>func (v4 Signer) Sign(r *http.Request, body io.ReadSeeker, service, region string, signTime time.Time) (http.Header, error)</code>"}], "owner": {"reputation": 11, "user_id": 5726440, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-s_YkXTMZtR0/AAAAAAAAAAI/AAAAAAAAARY/UYVFcDy0m00/photo.jpg?sz=128", "display_name": "Raj kumar", "link": "https://stackoverflow.com/users/5726440/raj-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 161, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565703483, "creation_date": 1565696323, "last_edit_date": 1565703483, "question_id": 57476977, "link": "https://stackoverflow.com/questions/57476977/how-do-i-authenticate-api-gateway-in-aws-with-accesskey-and-secretkey", "title": "How do I authenticate API Gateway in AWS with AccessKey and SecretKey", "body": "<p>I have an API Gateway and I used to pass <code>awsauth</code> (see below) parameter using the <code>aws4auth</code> Python package like <code>AWS4Auth(AK, SK, region, service=execute-api)</code>.</p>\n\n<p>But, I'm unable to find a similar package for Go. Is there any AWS-SDK in Go?</p>\n\n<p>Sample Python code of what I'd like to do in Go:</p>\n\n<pre><code>from requests_aws4auth import AWS4Auth\nawsauth = AWS4Auth(AK, SK, region, service=execute-api)\nrequests.post(host,auth=awsauth,json=document,headers=headers)\n</code></pre>\n"}, {"tags": ["go", "interface", "slice", "reflect"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565697398, "post_id": 57476809, "comment_id": 101426266, "body": "Note on terminology: You&#39;re using slices, not arrays."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1565696080, "creation_date": 1565696080, "answer_id": 57476909, "question_id": 57476809, "link": "https://stackoverflow.com/questions/57476809/generic-function-which-appends-two-arrays/57476909#57476909", "title": "Generic function which appends two arrays", "body": "<p><a href=\"https://golang.org/pkg/reflect/#Append\" rel=\"nofollow noreferrer\"><code>reflect.Append()</code></a> returns a value of type <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a>, so you don't have to (you shouldn't) pass that to <a href=\"https://golang.org/pkg/reflect/#ValueOf\" rel=\"nofollow noreferrer\"><code>reflect.ValueOf()</code></a>.</p>\n\n<p>So simply change the <code>return</code> statement to:</p>\n\n<pre><code>return r.Interface()\n</code></pre>\n\n<p>With this it works and outputs (try it on the <a href=\"https://play.golang.org/p/EyQ_nFG-3SP\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>=======\narr: []main.mystruct{main.mystruct{name:\"a1n1\", value:\"a1v1\"}, main.mystruct{name:\"a1n2\", value:\"a1v2\"}, main.mystruct{name:\"a2n1\", value:\"a2v1\"}, main.mystruct{name:\"a2n2\", value:\"a2v2\"}}\n[{a1n1 a1v1} {a1n2 a1v2} {a2n1 a2v1} {a2n2 a2v2}]\n[{a1n1 a1v1} {a1n2 a1v2} {a2n1 a2v1} {a2n2 a2v2}]\n</code></pre>\n\n<p>You also don't need to do any reflection-kungfu on the result: it's your slice wrapped in <code>interface{}</code>. Wrapping it in <code>reflect.Value</code> and calling <code>Value.Interface()</code> on it is just a redundant cycle. You may simply do:</p>\n\n<pre><code>arrayOp.([]mystruct)\n</code></pre>\n\n<p>On a side note: you shouldn't create a \"generic\" <code>append()</code> function that uses reflection under the hood, as this functionality is available as a built-in function <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a>. The builtin function is generic, it gets help from the compiler so it provides the generic nature at compile-time. Whatever you come up with using reflection will be slower.</p>\n"}], "owner": {"reputation": 9, "user_id": 11922044, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ttB6_e2GPmU/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdHkWY-pRvMpLe--Z1aeR2wwfnmUg/photo.jpg?sz=128", "display_name": "suraj pillai", "link": "https://stackoverflow.com/users/11922044/suraj-pillai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 39, "favorite_count": 0, "accepted_answer_id": 57476909, "answer_count": 1, "score": -1, "last_activity_date": 1565698963, "creation_date": 1565695686, "last_edit_date": 1565698963, "question_id": 57476809, "link": "https://stackoverflow.com/questions/57476809/generic-function-which-appends-two-arrays", "title": "Generic function which appends two arrays", "body": "<p>Not able to figure out how to convert interface{} returned from function into an array of structs</p>\n\n<p>As part of some practise i was trying to create a function which can take 2 slices of some type and concatenates both and returns the slice.</p>\n\n<p>The code can be found here - <a href=\"https://play.golang.org/p/P9pfrf_qTS1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/P9pfrf_qTS1</a></p>\n\n<pre><code>type mystruct struct {\n    name  string\n    value string\n}\n\nfunc appendarr(array1 interface{}, array2 interface{}) interface{} {\n    p := reflect.ValueOf(array1)\n    q := reflect.ValueOf(array2)\n    r := reflect.AppendSlice(p, q)\n    return reflect.ValueOf(r).Interface()\n}\n\nfunc main() {\n    fmt.Println(\"=======\")\n    array1 := []mystruct{\n        mystruct{\"a1n1\", \"a1v1\"},\n        mystruct{\"a1n2\", \"a1v2\"},\n    }\n    array2 := []mystruct{\n        mystruct{\"a2n1\", \"a2v1\"},\n        mystruct{\"a2n2\", \"a2v2\"},\n    }\n    arrayOp := appendarr(array1, array2)\n    fmt.Printf(\"arr: %#v\\n\", arrayOp) // this shows all the elements from array1 and 2\n    val := reflect.ValueOf(arrayOp)\n    fmt.Println(val)                          // output is &lt;[]main.mystruct Value&gt;\n    fmt.Println(val.Interface().([]mystruct)) // exception - interface {} is reflect.Value, not []main.mystruct\n}\n</code></pre>\n\n<p>I may have slices of different types of structs. I want to concatenate them and access the elements individually.\nIf there is any other way of achieving the same, please do let me know.</p>\n"}, {"tags": ["go", "floating-point", "ieee-754"], "comments": [{"owner": {"reputation": 88791, "user_id": 134204, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vwnA5.jpg?s=128&g=1", "display_name": "Panagiotis Kanavos", "link": "https://stackoverflow.com/users/134204/panagiotis-kanavos"}, "edited": false, "score": 2, "creation_date": 1565690423, "post_id": 57475303, "comment_id": 101422538, "body": "Most likely because the <i>compiler</i> calculates the result during compilation in the second case. That&#39;s a very common optimization. In any case, the rounding error appears in the <i>second</i> case, not the first. The compiler rounds the result before generating the assignment operation. Numbers like <code>0.1</code>, <code>0.2</code> and <code>0.3</code> <code>0.3</code> <a href=\"https://floating-point-gui.de/basic/\" rel=\"nofollow noreferrer\">can&#39;t be represented accuratelly</a> using floating points"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1565690866, "post_id": 57475303, "comment_id": 101422787, "body": "<a href=\"https://0.30000000000000004.com/\" rel=\"nofollow noreferrer\">0.30000000000000004.com</a> for the first part and for the second: Read how Go handles constants: They are (almost) arbitrary precision."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1565690897, "post_id": 57475303, "comment_id": 101422813, "body": "Also <code>fmt.Println()</code> performs some rounding, if you print it like <code>fmt.Printf(&quot;%.20f&quot;, c)</code>, you&#39;ll see a result of <code>-0.29999999999999998890</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1565691432, "post_id": 57475303, "comment_id": 101423092, "body": "Also see related: <a href=\"https://stackoverflow.com/questions/39444852/does-go-compilers-evaluation-differ-for-constant-expression-and-other-expressio/39445372#39445372\">Does Go compiler&#39;s evaluation differ for constant expression and other expression</a>"}, {"owner": {"reputation": 53, "user_id": 1703287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1wSeL.jpg?s=128&g=1", "display_name": "Lou-adrien", "link": "https://stackoverflow.com/users/1703287/lou-adrien"}, "edited": false, "score": 0, "creation_date": 1565691513, "post_id": 57475303, "comment_id": 101423138, "body": "I have updated the golang playground. Indeed using the formatted printf show the difference, so it seems that c was assigned the constant value -0.3 statically (by the compiler?) which was then approximated to the closest float64, instead of following the normal float operations flow which would aggregate rounding errors"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1565694421, "post_id": 57475303, "comment_id": 101424724, "body": "The Playground use a normal Go compiler which follows the Go language spec. So Yes, <code>(-0.2)+(-0.1)</code> was evaluated to -0.3 during compilation and that value was assigned to c. Everything is done 100% according to the language spec. What do you mean when you say &quot;instead of following the normal float operations flow&quot;. What is &quot;normal float operation&quot; except what the language spec says?"}, {"owner": {"reputation": 53, "user_id": 1703287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1wSeL.jpg?s=128&g=1", "display_name": "Lou-adrien", "link": "https://stackoverflow.com/users/1703287/lou-adrien"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565696436, "post_id": 57475303, "comment_id": 101425819, "body": "@Volker sorry &quot;normal float operation&quot; was not accurate, I meant &quot;my assumption about how this operation would be handled&quot;, i.e both (-0.2)+(-0.1) would be treated as a float operation at runtime, instead of a compile time operation to replace this value by the correct resulting constant. Could you point me out to the specs specifying this compiling behaviour?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1565698834, "post_id": 57475303, "comment_id": 101426980, "body": "<a href=\"https://golang.org/ref/spec#Constant_expressions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Constant_expressions</a> The spec is short, readable and searchable: The first three search results for &quot;const&quot; are all relevant entries in the table of contents. Go really is different from other languages. In most languages you have to ask an expert, in Go you can search the spec and this is often faster."}, {"owner": {"reputation": 53, "user_id": 1703287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1wSeL.jpg?s=128&g=1", "display_name": "Lou-adrien", "link": "https://stackoverflow.com/users/1703287/lou-adrien"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565701324, "post_id": 57475303, "comment_id": 101428295, "body": "@Volker could have done without the down-looking tone (whether a search is obvious or not is extremely subjective), but thanks anyways, your answers cleared my doubts. Have a nice day!"}], "answers": [{"comments": [{"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1565716303, "post_id": 57477864, "comment_id": 101436233, "body": "Go&#39;s rules for evaluating constants are quite different from those of most other mainstream programming languages. What happens in Java isn&#39;t really useful for understanding what&#39;s happening in the OP&#39;s Go example."}, {"owner": {"reputation": 11, "user_id": 10168778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nfJmzIk80J8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oiOrWXjc2z3wqaPl0Drfl_33BiLQ/mo/photo.jpg?sz=128", "display_name": "youze liang", "link": "https://stackoverflow.com/users/10168778/youze-liang"}, "reply_to_user": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "edited": false, "score": 0, "creation_date": 1565775653, "post_id": 57477864, "comment_id": 101454034, "body": "yeah, i just give an example"}], "tags": [], "owner": {"reputation": 11, "user_id": 10168778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nfJmzIk80J8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oiOrWXjc2z3wqaPl0Drfl_33BiLQ/mo/photo.jpg?sz=128", "display_name": "youze liang", "link": "https://stackoverflow.com/users/10168778/youze-liang"}, "is_accepted": false, "score": -1, "last_activity_date": 1565699787, "creation_date": 1565699787, "answer_id": 57477864, "question_id": 57475303, "link": "https://stackoverflow.com/questions/57475303/different-pattern-using-the-same-float-constant-values-leads-to-different-result/57477864#57477864", "title": "Different pattern using the same float constant values leads to different results", "body": "<p>i try to use java and the resule is </p>\n\n<pre class=\"lang-java prettyprint-override\"><code>public class StringTest {\n    public static void main(String[] args) {\n\n        double a = -0.2;\n        double b = -0.1;\n        System.out.println(a + b);\n       //  -0.30000000000000004\n\n        double c = a + b;\n        System.out.println(c);\n      // -0.30000000000000004\n\n    }\n}\n</code></pre>\n\n<p>it seems that the any programming language that uses binary floating point numbers will have this problem. some language's Number type used IEEE754 standard to represent number. \nAnd what is IEEE-745 float ,you can see <a href=\"https://en.wikipedia.org/wiki/IEEE_754\" rel=\"nofollow noreferrer\">it</a>.</p>\n"}], "owner": {"reputation": 53, "user_id": 1703287, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1wSeL.jpg?s=128&g=1", "display_name": "Lou-adrien", "link": "https://stackoverflow.com/users/1703287/lou-adrien"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 79, "favorite_count": 0, "closed_date": 1565735014, "answer_count": 1, "score": -4, "last_activity_date": 1565699787, "creation_date": 1565690080, "last_edit_date": 1565691096, "question_id": 57475303, "link": "https://stackoverflow.com/questions/57475303/different-pattern-using-the-same-float-constant-values-leads-to-different-result", "closed_reason": "Duplicate", "title": "Different pattern using the same float constant values leads to different results", "body": "<p>in the following snippet of go code I struggle to understand why the results are different:</p>\n\n<pre><code>func main() {\n    a := -0.2; b := -0.1; \n    fmt.Println(a+b)\n    //Outputs expected float value with rounding error  : -0.30000000000000004\n    c := (-0.2)+(-0.1)\n    fmt.Println(c)\n    //Will ouput -0.3 (the actual exact constant).\n}\n</code></pre>\n\n<p>What is happening exactly, does go somehow performs the c operation as constant instead of float64 operation when these constants are not used to instantiate floats?\nFull working version : <a href=\"https://play.golang.org/p/kUICDGFiMvf\" rel=\"nofollow noreferrer\">https://play.golang.org/p/kUICDGFiMvf</a></p>\n\n<p>Any insights would be appreciated, thanks.</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1565688078, "post_id": 57474513, "comment_id": 101421337, "body": "Yes. What the &quot;readers&quot; and &quot;writers&quot; do does not matter. They typically read and write some shared data and concurrent reads do not lead to races. But basically it is just &quot;arbitrary number of Rs or one single W&quot;. All you have to make sure that the Rs do nothing racy."}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565688309, "post_id": 57474513, "comment_id": 101421456, "body": "So... <code>RWMutex</code> is a misnomer?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1565688687, "post_id": 57474513, "comment_id": 101421658, "body": "No. concurrent reads never race an concurrent writes always race and this is the standard use case for RWMutex. Also it is RWMutex not ReadWriteMutex :-)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565688792, "post_id": 57474513, "comment_id": 101421719, "body": "RWMutex is a pragmatic name for the common use case. I wouldn&#39;t call it a misnomer. You can use a phone as a paper weight, but that doesn&#39;t mean that all phones should be called paper weights."}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1565689639, "post_id": 57474513, "comment_id": 101422145, "body": "Imho my case is more analogous to calling a phone a computer (rather than a paper weight), but I understand your sentiment."}, {"owner": {"reputation": 19267, "user_id": 801894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/67f2ccd17aa6fd622152ad88fc2ae784?s=128&d=identicon&r=PG", "display_name": "Solomon Slow", "link": "https://stackoverflow.com/users/801894/solomon-slow"}, "edited": false, "score": 2, "creation_date": 1565700865, "post_id": 57474513, "comment_id": 101428032, "body": "If you want to think of it at a more abstract level, a mutex protects a shared resource of some kind. What defines &quot;readers&quot; is that they never interfere with each other when they use the resource. What defines a &quot;writer&quot; is that its use of the resource potentially interferes with every other user."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565703626, "post_id": 57474513, "comment_id": 101429574, "body": "The mutex itself isn&#39;t safe or unsafe for anything. Code with no mutex can be safe; code with a mutex can be unsafe. The mutex doesn&#39;t care what the code that uses it actually does, it&#39;s just a lock. It&#39;s the code that&#39;s using it that&#39;s safe or not, and that code isn&#39;t shown here."}, {"owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "edited": false, "score": 0, "creation_date": 1565707558, "post_id": 57474513, "comment_id": 101432014, "body": "The word &quot;safe&quot; refers to being proof against data races in this context. I believe everything else that is needed to understand the full extent of the question is contained within it."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565690499, "post_id": 57475329, "comment_id": 101422582, "body": "Your solution means a mutex per goroutine/resource. OP&#39;s option 2."}, {"owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565691411, "post_id": 57475329, "comment_id": 101423080, "body": "Fine. I would say it&#39;s best to choose option 2 if so."}], "tags": [], "owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "is_accepted": true, "score": 1, "last_activity_date": 1565690161, "creation_date": 1565690161, "answer_id": 57475329, "question_id": 57474513, "link": "https://stackoverflow.com/questions/57474513/is-it-safe-to-use-the-read-lock-of-sync-rwmutex-for-writing-and-its-write-lock-f/57475329#57475329", "title": "Is it safe to use the read lock of sync.RWMutex for writing and its write lock for reading if the writes never race with each other by design?", "body": "<p>The answer of your question is Yes, just like Volker said.</p>\n\n<p>I would give you a more idiomatic Go solution:</p>\n\n<pre><code>every resources of goroutines in S take a sync.RWMutex\nthe goroutines in S read after sync.RWMutex.Rlock()\nthe goroutines in S write after sync.RWMutex.Lock()\nextra goroutine R read after sync.RWMutex.Rlock()\n</code></pre>\n\n<p>I think you just go into the wrong region, it should be a simple problem. :)</p>\n\n<p>If I misunderstand you, tell me.</p>\n"}, {"tags": [], "owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "is_accepted": false, "score": 1, "last_activity_date": 1565707252, "creation_date": 1565707252, "answer_id": 57480119, "question_id": 57474513, "link": "https://stackoverflow.com/questions/57474513/is-it-safe-to-use-the-read-lock-of-sync-rwmutex-for-writing-and-its-write-lock-f/57480119#57480119", "title": "Is it safe to use the read lock of sync.RWMutex for writing and its write lock for reading if the writes never race with each other by design?", "body": "<p>Answering myself because of all the confusion.</p>\n\n<p>Yes, it is safe to use the read lock of <code>sync.RWMutex</code> for writing and its write lock for reading if the writes never race with each other.</p>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    m := &amp;sync.RWMutex{}\n    wg := &amp;sync.WaitGroup{}\n    maxWriters := 5\n    wg.Add(maxWriters+1)\n    allData := make([]uint64, maxWriters)\n    go showAccumulatedData(m, wg, allData)\n    for i := 0; i &lt; maxWriters; i++ {\n        go writeData(m, wg, &amp;allData[i])\n    }\n    wg.Wait()\n    fmt.Println(accumulateData(m, allData))\n}\n\nfunc writeData(m *sync.RWMutex, wg *sync.WaitGroup, d *uint64) {\n    for i := 0; i &lt; 1000; i++ {\n        m.RLock()\n        *d++ // Write during read-lock.\n        m.RUnlock()\n        time.Sleep(time.Millisecond)\n    }\n    wg.Done()\n}\n\nfunc showAccumulatedData(m *sync.RWMutex, wg *sync.WaitGroup, allData []uint64) {\n    for i := 0; i &lt; 15; i++ {\n        fmt.Println(accumulateData(m, allData))\n        time.Sleep(time.Millisecond*50)\n    }\n    wg.Done()\n}\n\nfunc accumulateData(m *sync.RWMutex, allData []uint64) uint64 {\n    var accumulator uint64\n    m.Lock()\n    for _, v := range allData {\n        accumulator += v // Read during write-lock.\n    }\n    m.Unlock()\n    return  accumulator\n}\n</code></pre>\n"}], "owner": {"reputation": 1320, "user_id": 593146, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2404c3e4304714294c0458b3feb39ff0?s=128&d=identicon&r=PG", "display_name": "Zyl", "link": "https://stackoverflow.com/users/593146/zyl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 57475329, "answer_count": 2, "score": -2, "last_activity_date": 1565707252, "creation_date": 1565687345, "last_edit_date": 1565687696, "question_id": 57474513, "link": "https://stackoverflow.com/questions/57474513/is-it-safe-to-use-the-read-lock-of-sync-rwmutex-for-writing-and-its-write-lock-f", "title": "Is it safe to use the read lock of sync.RWMutex for writing and its write lock for reading if the writes never race with each other by design?", "body": "<p>From the Go docs:</p>\n\n<blockquote>\n  <p>A RWMutex is a reader/writer mutual exclusion lock. The lock can be\n  held by an arbitrary number of readers or a single writer.</p>\n</blockquote>\n\n<p>This introductory sentence is never followed by a definition of what a reader and writer may and may not do. Thus, I wonder whether a certain stretch of the definition is possible.</p>\n\n<p>Suppose we have a set of many goroutines; let's call it <code>S</code>. Each of the goroutines in <code>S</code> has its own resources which it reads from and writes to frequently. Suppose I have one extra goroutine <code>R</code> which routinely wants to scrape the state of the resources written by the goroutines in <code>S</code>. Let's explore the two more obvious solutions to see where I am going.</p>\n\n<ol>\n<li>We can use a single mutex. However, the goroutines in <code>S</code> would needlessly compete for the lock, since each goroutine from <code>S</code> accesses only its own resources anyway.</li>\n<li>Use one mutex for each goroutine in <code>S</code>. This eliminates needless competition and even gives <code>R</code> the option to decide whether it needs to have locked all mutexex at once or merely each mutex at least once at some point in time. Requires some extra work however.</li>\n</ol>\n\n<p>So my third idea is this: Let the goroutines in <code>S</code> take the read lock of a <code>sync.RWMutex</code> when they want to read or write (i.e. a generalized <em>inclusive lock</em>) and let <code>R</code> take the write lock of that mutex when it wants to read (i.e. a generalized <em>exclusive lock</em>). In other words:  </p>\n\n<p><strong>Is it safe to use the read lock of <code>sync.RWMutex</code> for writing and its write lock for reading if the writes never race with each other by design?</strong></p>\n"}, {"tags": ["unit-testing", "go", "testing", "struct"], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "edited": false, "score": 0, "creation_date": 1565688393, "post_id": 57474683, "comment_id": 101421502, "body": "Thank you, this worked for me. But could I just return value of struct instead of pointer."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "edited": false, "score": 1, "creation_date": 1565689070, "post_id": 57474683, "comment_id": 101421879, "body": "@IshanSharma Yes, you could, why couldn&#39;t you?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1565687993, "creation_date": 1565687993, "answer_id": 57474683, "question_id": 57474504, "link": "https://stackoverflow.com/questions/57474504/how-to-compare-two-values-which-are-structs-but-returned-as-interface/57474683#57474683", "title": "How to compare two values which are structs but returned as interface", "body": "<p>Although it's possible what you want, this comparison looks really \"hackish\", you should redesign to not require such comparison.</p>\n\n<p>But let's see how to do it. Let <code>A()</code>'s implementation be like this:</p>\n\n<pre><code>func A() interface{} {\n    return &amp;struct {\n        a, b, c int\n    }{1, 2, 3}\n}\n</code></pre>\n\n<p>If you want to compare the result, you have to first specify the value to compare to. One way is to use an anonymous struct:</p>\n\n<pre><code>got := A()\nexp := struct {\n    a, b, c int\n}{1, 2, 3}\n</code></pre>\n\n<p>Now since <code>A()</code> returns a pointer (wrapped in an <code>interface{}</code>), you can't really compare that. Comparing pointers compares the pointer value, not the pointed value. So first we should get the pointed value. For that, we may use reflection:</p>\n\n<pre><code>gotNoptr := reflect.ValueOf(got).Elem().Interface()\n</code></pre>\n\n<p>Now we have 2 struct values, and they are comparable if all their fields are comparable (which is true in this case):</p>\n\n<pre><code>if gotNoptr == exp {\n    fmt.Println(\"Match\")\n} else {\n    fmt.Printf(\"Mismatch\")\n}\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/A9W8qR0iVdQ\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Match\n</code></pre>\n\n<p>If you would change a number in the <code>exp</code> value, output would turn into <code>Mismatch</code>.</p>\n\n<p>An alternate way would be to declare <code>exp</code> to be a pointer too:</p>\n\n<pre><code>exp := &amp;struct {\n    a, b, c int\n}{1, 2, 3}\n</code></pre>\n\n<p>And use <code>reflect.DeepEqual()</code> to compare the pointed struct values:</p>\n\n<pre><code>if reflect.DeepEqual(got, exp) {\n    fmt.Println(\"Match\")\n} else {\n    fmt.Printf(\"Mismatch\")\n}\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/pSGONgIhFiV\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 17, "user_id": 10144687, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86473e93198ba5dc37332b2c0f247af0?s=128&d=identicon&r=PG&f=1", "display_name": "Ishan Sharma", "link": "https://stackoverflow.com/users/10144687/ishan-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "closed_date": 1565734882, "answer_count": 1, "score": -3, "last_activity_date": 1565688972, "creation_date": 1565687318, "last_edit_date": 1565688972, "question_id": 57474504, "link": "https://stackoverflow.com/questions/57474504/how-to-compare-two-values-which-are-structs-but-returned-as-interface", "closed_reason": "Not suitable for this site", "title": "How to compare two values which are structs but returned as interface", "body": "<p>I am really new with programming in Go and got stuck here.\nI have a function A which creates a struct from 3 different values a, b, c.</p>\n\n<pre><code>func A() interface{} {\n    s := new(struct{\n        a, b, c int\n    })\n    //fill the values in s\n    return s\n}\n</code></pre>\n\n<p>Now when I am testing this function, how will I compare the returned interface with some expected result?</p>\n\n<p><strong>I cannot move the struct definition global</strong></p>\n\n<p>If someone have a better way of doing this type of testing, please suggest.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 1180321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131cd1eb5c33b707a4f14a489101725?s=128&d=identicon&r=PG", "display_name": "killerx", "link": "https://stackoverflow.com/users/1180321/killerx"}, "edited": false, "score": 0, "creation_date": 1565687520, "post_id": 57474359, "comment_id": 101421076, "body": "hey, thanks so much.  1st: if there&#39;s other code logic with having this window, should that code logic be called in separate goroutine and have the window logic in the main one?  2nd: how will the paint.Event event be invoked? what action/buffer should I modify so that this logic is eventually invoked to upload and publish to the screen? Thanks"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 45, "user_id": 1180321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131cd1eb5c33b707a4f14a489101725?s=128&d=identicon&r=PG", "display_name": "killerx", "link": "https://stackoverflow.com/users/1180321/killerx"}, "edited": false, "score": 1, "creation_date": 1565687702, "post_id": 57474359, "comment_id": 101421161, "body": "@killerx Yes, you may launch other goroutines, but <code>driver.Main()</code> should be called from the <code>main</code>. You have an event loop, and when a repaint is required, your event loop will receive a <code>paint.Event</code> event, so that case will be executed."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1565686798, "creation_date": 1565686798, "answer_id": 57474359, "question_id": 57473937, "link": "https://stackoverflow.com/questions/57473937/bound-mismatch-when-drawing-buffer-to-screen-golang-org-x-exp-shiny-screen/57474359#57474359", "title": "Bound mismatch when drawing buffer to screen (golang.org/x/exp/shiny/screen)", "body": "<p>You specify an initial size of <code>width=62, height=32</code>, these are sizes in pixels. Which means you want your window to be \"tiny\". Windows usually have a <em>minimum</em> size (often dictated by window controls), and seemingly this minimum size is bigger than your intended size. So the blue rectangle you draw will not will the whole window (which will not be less than the minimum size).</p>\n\n<p>If you increase the size, e.g. <code>Rows = 300, Cols = 600</code>, then it will fill your window.</p>\n\n<p>Also, drop the <code>go</code> keyword when calling <code>driver.Main()</code>, some OS-specific libraries require it to be called from the <code>main</code> goroutine. And so remove the empty <code>for</code> from <code>main()</code>, <code>driver.Main()</code> blocks until your app should exit.</p>\n\n<p>Also, this still won't guarantee you see the blue rectangle, as if the window (screen) is refreshed / cleared, a redraw might be necessary.</p>\n\n<p>So instead move your drawing logic to the event loop, and execute it for the <code>paint.Event</code> events:</p>\n\n<pre><code>case paint.Event:\n    defaultDrawToBuffer(drawBuff.RGBA())\n    window.Upload(image.Point{}, drawBuff, drawBuff.Bounds())\n    window.Publish()\n</code></pre>\n"}], "owner": {"reputation": 45, "user_id": 1180321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f131cd1eb5c33b707a4f14a489101725?s=128&d=identicon&r=PG", "display_name": "killerx", "link": "https://stackoverflow.com/users/1180321/killerx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 132, "favorite_count": 0, "accepted_answer_id": 57474359, "answer_count": 1, "score": 1, "last_activity_date": 1565686798, "creation_date": 1565685017, "question_id": 57473937, "link": "https://stackoverflow.com/questions/57473937/bound-mismatch-when-drawing-buffer-to-screen-golang-org-x-exp-shiny-screen", "title": "Bound mismatch when drawing buffer to screen (golang.org/x/exp/shiny/screen)", "body": "<p>I am trying to use golang.org/x/exp/shiny/screen to create a windows and then paint a buffer on the screen. </p>\n\n<p>I have assigned same bounds (height and width) to the window and the buffer I am publishing on the window, but there seems to be a mismatch when I see the results. </p>\n\n<p>You can see in the picture, that the blue buffer which is uploaded to the window is not covering it completely. </p>\n\n<p><a href=\"https://i.stack.imgur.com/5jBeG.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/5jBeG.png\" alt=\"enter image description here\"></a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"log\"\n\n    \"golang.org/x/exp/shiny/driver\"\n    \"golang.org/x/exp/shiny/screen\"\n    \"golang.org/x/mobile/event/key\"\n    \"golang.org/x/mobile/event/lifecycle\"\n)\n\nconst (\n    Row = 32\n    Col = 64\n)\n\n// Colors\nvar (\n    Black = color.RGBA{0, 0, 0, 1.0}\n    White = color.RGBA{255, 255, 255, 1.0}\n    Blue  = color.RGBA{0, 0, 255, 1.0}\n)\n\nfunc main() {\n\n    go driver.Main(func(s screen.Screen) {\n        opts := screen.NewWindowOptions{\n            Height: Row,\n            Width:  Col,\n            Title:  \"Chip-8 VM\",\n        }\n\n        window, err := s.NewWindow(&amp;opts)\n        if err != nil {\n            log.Print(\"Unable to create display window: \")\n            log.Fatal(err)\n            return\n        }\n\n        defer window.Release()\n\n        dim := image.Point{Col, Row}\n        drawBuff, err := s.NewBuffer(dim)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        defaultDrawToBuffer(drawBuff.RGBA())\n\n        log.Print(\"Window bounds: \", opts)\n        log.Printf(\"Buffer bounds: %s\", drawBuff.Bounds())\n        log.Printf(\"Buffer size: %s\", drawBuff.Size())\n\n        window.Upload(image.Point{}, drawBuff, drawBuff.Bounds())\n        window.Publish()\n\n        for {\n            e := window.NextEvent()\n            switch e := e.(type) {\n\n            case lifecycle.Event:\n                if e.To == lifecycle.StageDead {\n                    return\n                } else if e.To == lifecycle.StageFocused {\n                    log.Print(\"Focus back on the screen!\")\n                }\n\n            case key.Event:\n                log.Print(\"pressed key: \", e.Code)\n                // exit game\n                if e.Code == key.CodeEscape {\n                    return\n                }\n            case error:\n                log.Print(e)\n            }\n\n        }\n    })\n\n    for {\n    }\n\n}\n\n// Bounds: (0,0)-(64,32)\nfunc defaultDrawToBuffer(img *image.RGBA) {\n    b := img.Bounds()\n\n    log.Printf(\"Bounds: %s\", b.String())\n\n    for x := b.Min.X; x &lt; b.Max.X; x++ {\n        for y := b.Min.Y; y &lt; b.Max.Y; y++ {\n            img.SetRGBA(x, y, Blue)\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "caching", "concurrency", "mutex"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1565682201, "post_id": 57473226, "comment_id": 101418650, "body": "Having many mutexes does not consure CPU resources. How you use them may do so. We know little about your actual code, so it&#39;s hard to help you out."}, {"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 1, "creation_date": 1565682407, "post_id": 57473226, "comment_id": 101418742, "body": "If I understand the task correct, the number of mutexes (hm... mutices?) depends on the number of resources being accessed, not on the number of users. That all said, need an MCVE to tell more."}, {"owner": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 1, "creation_date": 1565682535, "post_id": 57473226, "comment_id": 101418791, "body": "&quot;need a mutex per each user&quot; it&#39;s hard to imagine such a use case, can you elaborate?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1565683500, "post_id": 57473226, "comment_id": 101419213, "body": "If I understand, you&#39;re doing some calculation that takes a long time, and you don&#39;t want to do it more than once, if you receive simultaneous requests. What should happen if two equal requests come in together? Do both need to wait for the calculation to complete, or is it okay if one (or even both) get old data?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "edited": false, "score": 0, "creation_date": 1565683582, "post_id": 57473226, "comment_id": 101419254, "body": "@Flimzyyes, exactly"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565683602, "post_id": 57473226, "comment_id": 101419258, "body": "So... What should happen if two equal requests come in together? Do both need to wait for the calculation to complete, or is it okay if one (or even both) get old data?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1565683704, "post_id": 57473226, "comment_id": 101419318, "body": "@icza I did a stress test at 500 routines, the mutex increases cpu a lot at a high concurrency"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565683775, "post_id": 57473226, "comment_id": 101419344, "body": "@Flimzy once the first completed calculation, I will write it into memory cache, so the other will read from memory cache instead of redis."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565683801, "post_id": 57473226, "comment_id": 101419356, "body": "Okay, but you didn&#39;t answer my question. Do both requests need to wait for the calculation, or can one or both return old data instead?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "edited": false, "score": 0, "creation_date": 1565683868, "post_id": 57473226, "comment_id": 101419386, "body": "@Flimzyyes, both need to return. otherwise the user side will get wrong data."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565683891, "post_id": 57473226, "comment_id": 101419398, "body": "Yes, you still didn&#39;t answer my question. Obviously you need to return something. :) Do they <i>need to wait for the calculation</i>, or can they receive old data?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 1947, "user_id": 6022937, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Wm7nH.png?s=128&g=1", "display_name": "Nestor Sokil", "link": "https://stackoverflow.com/users/6022937/nestor-sokil"}, "edited": false, "score": 0, "creation_date": 1565683896, "post_id": 57473226, "comment_id": 101419403, "body": "@NestorSokil I updated my question, please check it again."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565683967, "post_id": 57473226, "comment_id": 101419435, "body": "If it&#39;s okay to send old data, your simplest sync option is no mutex, but just a semaphore. When a request comes in, check if an update is in progress, and if not, start one in the background, then immediately return the (outdated) data.  For many applications, this is perfectly acceptable, and solves the contention problem nicely <i>and</i> decreases response time, since nothing ever waits."}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565684051, "post_id": 57473226, "comment_id": 101419476, "body": "@Flimzy   if data is outdated, all requests need to wait the fresh data ready. either read from memory or read from redis."}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565684633, "post_id": 57473226, "comment_id": 101419760, "body": "@Flimzy thanks for your suggestion, but if there is no old data, this will be a problem, right? so some requests may not have data returned."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565684819, "post_id": 57473226, "comment_id": 101419848, "body": "Depends on your situation, but yes, that likely makes it problematic."}, {"owner": {"reputation": 5730, "user_id": 2704500, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/100556a196f1f860a0b08e8c3519152f?s=128&d=identicon&r=PG&f=1", "display_name": "pandaadb", "link": "https://stackoverflow.com/users/2704500/pandaadb"}, "edited": false, "score": 0, "creation_date": 1565685375, "post_id": 57473226, "comment_id": 101420115, "body": "I imagine what you would need is a loading cache? That will take a loading function and handle the concurrency issues internally. A quick google search led me to <a href=\"https://github.com/bluele/gcache\" rel=\"nofollow noreferrer\">github.com/bluele/gcache</a>"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 5730, "user_id": 2704500, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/100556a196f1f860a0b08e8c3519152f?s=128&d=identicon&r=PG&f=1", "display_name": "pandaadb", "link": "https://stackoverflow.com/users/2704500/pandaadb"}, "edited": false, "score": 0, "creation_date": 1565686202, "post_id": 57473226, "comment_id": 101420502, "body": "@pandaadb  I am trying to write a two level cache(memory +redis) with a load func, I am starting with <a href=\"https://github.com/patrickmn/go-cache\" rel=\"nofollow noreferrer\">github.com/patrickmn/go-cache</a>, the gcache seems not lightweight enough."}, {"owner": {"reputation": 556, "user_id": 4782509, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0PLn2.jpg?s=128&g=1", "display_name": "Frank Wang", "link": "https://stackoverflow.com/users/4782509/frank-wang"}, "edited": false, "score": 0, "creation_date": 1565693108, "post_id": 57473226, "comment_id": 101423959, "body": "I think your problem is that GoRoutines block too much under high concurrent pressure (Assume N * 10000 goroutine what get 10000 user data). If so, it&#39;s better solve this instead of &#39;find elegant solution for mutexes&#39;. Because mutexes do not bother you if you don&#39;t use them."}, {"owner": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1565700479, "post_id": 57473226, "comment_id": 101427851, "body": "Is this question a continuation of <a href=\"https://stackoverflow.com/questions/55768699/golang-redis-concurrency-scheduler-performance-issue\" title=\"golang redis concurrency scheduler performance issue\">stackoverflow.com/questions/55768699/&hellip;</a> ?"}, {"owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "reply_to_user": {"reputation": 3889, "user_id": 561422, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JwFD0.jpg?s=128&g=1", "display_name": "marco.m", "link": "https://stackoverflow.com/users/561422/marco-m"}, "edited": false, "score": 0, "creation_date": 1565701665, "post_id": 57473226, "comment_id": 101428461, "body": "@marco.m, not exactly, I was testing a redis-based rate limiter then. but the problem seems the same, redis operation (db access + redis write/read) takes some time (100-200 ms) which causes the problem at high concurrency access."}], "answers": [{"tags": [], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "is_accepted": false, "score": 1, "last_activity_date": 1567154373, "creation_date": 1567154373, "answer_id": 57723355, "question_id": 57473226, "link": "https://stackoverflow.com/questions/57473226/two-level-cache-memory-redis-implementation-in-go/57723355#57723355", "title": "two-level cache (memory + redis) implementation in Go", "body": "<p>Finally, here is my github repo:</p>\n\n<p><a href=\"https://github.com/seaguest/cache\" rel=\"nofollow noreferrer\">A lightweight distributed two-level cache (memory + redis) with loader function library for Go.\n</a></p>\n\n<p>Welcome to have a try, any suggestion is appreciated.</p>\n"}], "owner": {"reputation": 2182, "user_id": 991076, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/1a0377f4f9912163fc86713519db487f?s=128&d=identicon&r=PG", "display_name": "seaguest", "link": "https://stackoverflow.com/users/991076/seaguest"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1567154548, "creation_date": 1565682112, "last_edit_date": 1567154548, "question_id": 57473226, "link": "https://stackoverflow.com/questions/57473226/two-level-cache-memory-redis-implementation-in-go", "title": "two-level cache (memory + redis) implementation in Go", "body": "<p>I am trying to write a two-level cache (memory + redis), but I got a bottleneck when there is a high concurrency access for one key, I tried to use mutex for each key, but this increased cpu a lot since loadFromDB takes 100-200ms.</p>\n\n<pre><code>func (s *Store) GetJsonObjectWithExpire(key string, obj interface{}, ttl int, f StoreLoadFunc) error {\n    // first read from memory\n    v, ok := s.mem.Get(key)\n    if ok {\n        if v.Outdated() {\n            to := deepcopy.Copy(obj)\n            go s.updateMem(key, to, ttl, f)\n        }\n        return nil\n    }\n\n    // if missed in memory, check from redis\n    v, ok = s.rds.Get(key, obj)\n    if ok {\n        if v.Outdated() {\n            go s.rds.loadFromDB(key, nil, ttl, f, false)\n        }\n        return nil\n    }\n    return s.rds.loadFromDB(key, obj, ttl, f, true)\n}\n</code></pre>\n\n<p>loadFromDB will load object from db and write it to redis and memory, this will take about 100-200ms, both loadFromDB and rds.Get function use per-key RWMutex right now.</p>\n\n<p>since there will be a lot of keys(10000+),I am not sure if it is a good idea to use a mutex for each key? </p>\n\n<p>Is there any thing that I can do to improve the performance?</p>\n\n<p>UPDATE:\nHere is my code on github for my two-level cache-aside pattern implementation.</p>\n\n<p><a href=\"https://github.com/seaguest/cache\" rel=\"nofollow noreferrer\">https://github.com/seaguest/cache</a></p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 139, "user_id": 7203822, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/AKICG.jpg?s=128&g=1", "display_name": "Gaurav", "link": "https://stackoverflow.com/users/7203822/gaurav"}, "edited": false, "score": 0, "creation_date": 1565676875, "post_id": 57472008, "comment_id": 101416343, "body": "better to concatenate unmarshaled json result?"}], "answers": [{"tags": [], "owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "is_accepted": true, "score": 3, "last_activity_date": 1565677590, "creation_date": 1565677590, "answer_id": 57472206, "question_id": 57472008, "link": "https://stackoverflow.com/questions/57472008/how-to-read-multiple-json-files/57472206#57472206", "title": "How to read multiple json files", "body": "<p>You are using <code>fileIndex</code> while generating the filename instead of using <code>i</code> in the for loop.\nThe code after the changes would be :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Book struct {\n    Id    string `json: \"id\"`\n    Title string `json: \"title\"`\n}\n\nfunc main() {\n    fileIndex := 2 // three json files. All named test1.json, test2.json and test3.json\n\n    var master []Book\n\n    for i := 0; i &lt;= fileIndex; i++ {\n        fileName := fmt.Sprintf(\"%s%d%s\", \"test\", i, \".json\")\n\n        // Open jsonFile\n        jsonFile, err := os.Open(fileName)\n\n        defer jsonFile.Close()\n\n        byteValue, _ := ioutil.ReadAll(jsonFile)\n        fmt.Println(byteValue)\n        var book []Book\n\n        json.Unmarshal(byteValue, &amp;book)\n        fmt.Println(book)\n    }\n}\n</code></pre>\n\n<p>Also, you can do something like <code>master = append(master, book)</code> inside the for loop to finally get all JSON content in <code>master</code></p>\n"}], "owner": {"reputation": 23, "user_id": 4734982, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6facf219d7d8447432c6bf3f76b7a7de?s=128&d=identicon&r=PG", "display_name": "GeekSquard", "link": "https://stackoverflow.com/users/4734982/geeksquard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "accepted_answer_id": 57472206, "answer_count": 1, "score": -1, "last_activity_date": 1565689772, "creation_date": 1565676591, "last_edit_date": 1565689772, "question_id": 57472008, "link": "https://stackoverflow.com/questions/57472008/how-to-read-multiple-json-files", "title": "How to read multiple json files", "body": "<p>I am trying to read json data from multiple json files. I am not sure how I read each files and concatenate all results</p>\n\n<p>There json files name are test1.json, test2.json test3.json..etc with the same data structure but I am having an issue read then all and my code seems to only show the last one. I have concatenated a string based on the file name but seems to not working for me.</p>\n\n<pre><code>type Book struct {\n    Id    string `json: \"id\"`\n    Title string `json: \"title\"`\n}\n\nfunc main() {\n    fileIndex := 2 // three json files. All named test1.json, test2.json and test3.json\n\n    var master []Book\n\n    for i := 0; i &lt;= fileIndex; i++ {\n        fileName := fmt.Sprintf(\"%s%d%s\", \"test\", fileIndex, \".json\")\n\n        // Open jsonFile\n        jsonFile, err := os.Open(fileName)\n\n        defer jsonFile.Close()\n\n        byteValue, _ := ioutil.ReadAll(jsonFile)\n        fmt.Println(byteValue)\n        var book []Book\n\n        json.Unmarshal(byteValue, &amp;book)\n        fmt.Println(book) // all print shows the test3.json result \n    }\n}\n</code></pre>\n\n<p>I need to be able to read all three json files and hoping to concatenate all results. Can anyone help me? Thank you!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 1, "creation_date": 1565672897, "post_id": 57471309, "comment_id": 101415172, "body": "Please ask programming questions, not how to implement things. Try breaking this question/problem into the smallest part possible\u2014i.e. where does this fail for you?"}, {"owner": {"reputation": 21, "user_id": 3433056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQ4WZ.jpg?s=128&g=1", "display_name": "indrablake", "link": "https://stackoverflow.com/users/3433056/indrablake"}, "reply_to_user": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1565673928, "post_id": 57471309, "comment_id": 101415459, "body": "Ok thanks for your correction im sorry"}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 3433056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQ4WZ.jpg?s=128&g=1", "display_name": "indrablake", "link": "https://stackoverflow.com/users/3433056/indrablake"}, "edited": false, "score": 0, "creation_date": 1565674052, "post_id": 57471456, "comment_id": 101415486, "body": "Thanks dor quick answer, before i already make this fileserver to handle http request but response not what i want.. maybe ill try again"}, {"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "reply_to_user": {"reputation": 21, "user_id": 3433056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQ4WZ.jpg?s=128&g=1", "display_name": "indrablake", "link": "https://stackoverflow.com/users/3433056/indrablake"}, "edited": false, "score": 0, "creation_date": 1565674624, "post_id": 57471456, "comment_id": 101415626, "body": "What response did you expect and what did you get, please mention that, and also, how did you use Fileserver."}, {"owner": {"reputation": 21, "user_id": 3433056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQ4WZ.jpg?s=128&g=1", "display_name": "indrablake", "link": "https://stackoverflow.com/users/3433056/indrablake"}, "edited": false, "score": 0, "creation_date": 1565746341, "post_id": 57471456, "comment_id": 101445073, "body": "Sorry for late answer, i expected was responsr at field image can display in android when i get image item..in android im using glide for populate images"}], "tags": [], "owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "is_accepted": true, "score": 0, "last_activity_date": 1565673181, "creation_date": 1565673181, "answer_id": 57471456, "question_id": 57471309, "link": "https://stackoverflow.com/questions/57471309/how-to-get-images-path-from-golang-project-file/57471456#57471456", "title": "How to get images path from golang project file", "body": "<p>You should a create a file server to be able create an http link for files. You can use net/http's <a href=\"https://golang.org/src/net/http/fs.go?s=20537:20577#L703\" rel=\"nofollow noreferrer\">Fileserver</a> for the same. Fileserver is a good choice if you want it for a small time, like as long as you API server is running. \nAnother choice would be to create an FTP server and use that to store images.</p>\n"}], "owner": {"reputation": 21, "user_id": 3433056, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQ4WZ.jpg?s=128&g=1", "display_name": "indrablake", "link": "https://stackoverflow.com/users/3433056/indrablake"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 449, "favorite_count": 0, "accepted_answer_id": 57471456, "answer_count": 1, "score": -2, "last_activity_date": 1565673181, "creation_date": 1565671917, "question_id": 57471309, "link": "https://stackoverflow.com/questions/57471309/how-to-get-images-path-from-golang-project-file", "title": "How to get images path from golang project file", "body": "<p>I am a beginner in making a REST full API using golang, what I want to ask is to get an image file from the path in my golang project, before I have successfully uploaded the image and saved it in the path and the path I have saved it in mysql database, how do I do it to be able to display the image in the form of a link, so I can load it on android, </p>\n\n<p>and how to make it like this\n\"http: // localhost: 3004 / images / imagename.jpg\" \ninside the json result ( ImgEvent )??</p>\n\n<p>please help me... thanks</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (idb *InDB) GetEvents(c *gin.Context) {\n    var (\n        events    []structs.Event\n        newEvents structs.Event\n        result    gin.H\n    )\n\n    getimage := \"img_event\"\n    data := idb.DB.Select(getimage).Find(&amp;events)\n    if data != nil {\n        result = gin.H{\n            \"message\": \"Not found\",\n        }\n    }\n    newEvents.ImgEvent = getimage\n\n    data = idb.DB.Find(&amp;events)\n\n    if len(events) &lt;= 0 {\n        result = gin.H{\n            \"result\": nil,\n            \"count\":  0,\n        }\n    } else {\n        result = gin.H{\n            \"data\": events,\n        }\n    }\n\n    c.JSON(http.StatusOK, result)\n}\n\n========= Respone Json ===========\n\n{\n    \"data\": [\n        {\n            \"ID\": 1,\n            \"CreatedAt\": \"2019-07-28T22:38:20Z\",\n            \"UpdatedAt\": \"2019-08-12T09:51:41Z\",\n            \"DeletedAt\": null,\n            \"Judul\": \"test1\",\n            \"Isi\": \"Dalam menyambut ulang tahun Accent-er Regional JawaBarat yang ke 3.\\r\\n\\r\\nKami mengundang seluruh member terdaftar maupun non member untuk ikut hadir meramaikan acara ini.\\r\\n\\r\\nYang akan di selenggarakan di\\r\\n\\r\\nCikole,Lembang Bandung\n            \"ImgEvent\": \"event-images/event-bukalapak.jpg\",\n            \"TotalComments\": 1,\n            \"TotalLikes\": 5,\n            \"TotalView\": 3\n        },\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 4, "creation_date": 1565665987, "post_id": 57470612, "comment_id": 101413794, "body": "Have it return a <code>template.HTML</code> instead and return <code>template.HTML(&quot;\\&quot;&quot;)</code>.   <a href=\"https://golang.org/src/html/template/content.go?s=1375:1386#L25\" rel=\"nofollow noreferrer\">golang.org/src/html/template/content.go?s=1375:1386#L25</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "is_accepted": true, "score": 2, "last_activity_date": 1565710583, "creation_date": 1565710583, "answer_id": 57481107, "question_id": 57470612, "link": "https://stackoverflow.com/questions/57470612/export-double-quotes-using-template/57481107#57481107", "title": "export double quotes using template", "body": "<p>That is because <code>html/template</code> will make it html safe which escapes all the html special characters and replacing them with html encoding.</p>\n\n<p>In order to avoid that, you should replace <code>html/template</code> with <code>text/template</code></p>\n\n<p><a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">text/template</a></p>\n"}], "owner": {"reputation": 29652, "user_id": 7128934, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/oI2SB.jpg?s=128&g=1", "display_name": "d.b", "link": "https://stackoverflow.com/users/7128934/d-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 0, "accepted_answer_id": 57481107, "answer_count": 1, "score": -1, "last_activity_date": 1565710583, "creation_date": 1565665420, "last_edit_date": 1565665779, "question_id": 57470612, "link": "https://stackoverflow.com/questions/57470612/export-double-quotes-using-template", "title": "export double quotes using template", "body": "<p>I'm using <code>template</code> to export <code>\"</code> in go but it returns only <code>&amp;#34;</code>. Is there a way to get it to export <code>\"</code> instead.</p>\n\n<pre><code>import (\n    \"html/template\"\n)\n\n//Testf  a test function\nfunc Testf() string {\n    return \"\\\"\"\n}\n\n//MapToFunctions Map actions to functions\nvar MapToFunctions = template.FuncMap{\n    \"testf\":      Testf}\n</code></pre>\n\n<p>Then, to use in a file, I'd put <code>{{ testf }}</code></p>\n"}, {"tags": ["go", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565684507, "post_id": 57470536, "comment_id": 101419703, "body": "Can you also try to print the error that you are getting while unmarshling."}, {"owner": {"reputation": 467, "user_id": 1302465, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/44616d2d5815dcff0de69ef70b653ef5?s=128&d=identicon&r=PG", "display_name": "jkstar", "link": "https://stackoverflow.com/users/1302465/jkstar"}, "reply_to_user": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "edited": false, "score": 0, "creation_date": 1565703307, "post_id": 57470536, "comment_id": 101429384, "body": "Sorry for missing that. I&#39;ve included the screenshot of the error."}], "answers": [{"tags": [], "owner": {"reputation": 2703, "user_id": 9551146, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vH0OA.jpg?s=128&g=1", "display_name": "Narendranath Reddy", "link": "https://stackoverflow.com/users/9551146/narendranath-reddy"}, "is_accepted": false, "score": 0, "last_activity_date": 1565882512, "creation_date": 1565882512, "answer_id": 57511992, "question_id": 57470536, "link": "https://stackoverflow.com/questions/57470536/how-to-unmarshal-transaction-payload-in-hyperledger-fabric/57511992#57511992", "title": "How to unmarshal Transaction Payload in Hyperledger Fabric", "body": "<p>the response payload is in []bytes</p>\n\n<p>you can use <code>string(response.Payload)</code></p>\n\n<p>Above code is equivalent to .toString(\"utf8\")</p>\n\n<p>------ or ------</p>\n\n<p>USE</p>\n\n<pre><code>var data interface{}\n\nerr = json.Unmarshal(responseBody, &amp;data)\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 1302465, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/44616d2d5815dcff0de69ef70b653ef5?s=128&d=identicon&r=PG", "display_name": "jkstar", "link": "https://stackoverflow.com/users/1302465/jkstar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 339, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565882512, "creation_date": 1565664690, "last_edit_date": 1565703272, "question_id": 57470536, "link": "https://stackoverflow.com/questions/57470536/how-to-unmarshal-transaction-payload-in-hyperledger-fabric", "title": "How to unmarshal Transaction Payload in Hyperledger Fabric", "body": "<p>I need to fetch transaction fields from a transaction in the ledger. I'm able to successfully query the transaction from ledger by invoking <strong>qscc</strong> chaincode but unable to parse the fetched transaction to retrieve transaction fields. I want to unmarshal the transaction content into a structure with all the fields. With the below code, I'm getting error <strong>\"failed to unmarshal channel header\"</strong>. Appreciate your help.</p>\n\n<pre><code>chainCodeArgs := toChaincodeArgs(\"GetTransactionByID\", \"myc\", tid)\nresponse := stub.InvokeChaincode(\"qscc\", chainCodeArgs, \"myc\")\nfmt.Printf(\"****************\")\nif response.Status != shim.OK {\nerrStr := fmt.Sprintf(\"Failed to query chaincode. Got error: %s\", response.Payload)\nfmt.Printf(errStr)\nreturn \"\", fmt.Errorf(errStr)\n}\n\nrespStr := fmt.Sprintf(\"successfully queried qscc chaincode. Got response: %s\", response.Payload)\nfmt.Printf(respStr)\n\npayload, err := utils.UnmarshalPayload(response.Payload)\nif err != nil {\nreturn \"\", fmt.Errorf(\"Error when unmarshalling transaction payload response\")\n}\nfmt.Printf(\"++++++++++++++++++++++\")\nfmt.Println(payload)\n\nif payload.Header == nil {\nreturn \"\", fmt.Errorf(\"error getting txID from header: payload header is nil\")\n}\n\nchdr, err := utils.UnmarshalChannelHeader(payload.GetHeader().ChannelHeader)\nif err != nil {\nreturn \"\", fmt.Errorf(\"failed to unmarshal channel header\")\n}\n\nfmt.Printf(\"++++++++++++++++++++++\")\nfmt.Printf(chdr.TxId)\n</code></pre>\n\n<p>Error screenshot:</p>\n\n<p><a href=\"https://i.stack.imgur.com/CtneT.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CtneT.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 2, "creation_date": 1565666211, "post_id": 57470319, "comment_id": 101413837, "body": "If you want something similar in nature to Jinja2 (though actually modeled off Django) then Pongo2 is a good choice.  <a href=\"https://github.com/flosch/pongo2\" rel=\"nofollow noreferrer\">github.com/flosch/pongo2</a>"}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1565667499, "post_id": 57470319, "comment_id": 101414029, "body": "I wasn&#39;t expressly looking for a (more or less) direct replacement for Jinja2, but I guess I&#39;ll give Pongo2 a try, since it does look like the path of least resistance. Thanks."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1565680017, "post_id": 57470319, "comment_id": 101417663, "body": "Are you asking how to pass (multiple) data to a template invocation? Possible duplicate <a href=\"https://stackoverflow.com/questions/49473199/golang-pass-multiple-values-from-template-to-template/49475057#49475057\">Golang pass multiple values from template to template?</a>"}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1565707190, "post_id": 57470319, "comment_id": 101431808, "body": "I personally maintain a number of functions and <a href=\"https://golang.org/pkg/text/template/#FuncMap\" rel=\"nofollow noreferrer\">pass them to the engine as a map of functions</a>."}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1565736622, "post_id": 57470319, "comment_id": 101443360, "body": "@icza No, I&#39;m not asking that. I know one can pass data to a template invocation in a struct defined in the calling Go code. But in Jinja2 (and Django templates, if I&#39;m not mistaken) it&#39;s possible to call a macro (equivalent to a Go template) with constants strings (or numbers) as shown above. In Go, it appears you <i>have</i> to put those constants in the calling Go code, <i>not</i> in the template."}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1565738080, "post_id": 57470319, "comment_id": 101443679, "body": "@MarkusWMahlberg Yes, I already have a map of functions too. But in Jinja2/Django templates you can invoke Python object methods directly, e.g., <code>aString.upper()</code> or use some 50 filters (equivalent to Go template predefined global functions--less than 20)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1565771174, "post_id": 57470319, "comment_id": 101451863, "body": "I bet this is by design: &quot;Why should we clutter the engine with 50 filters of which 99% might turn out useless? Developer knows best what filters he or she needs.&quot;"}, {"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1566351881, "post_id": 57470319, "comment_id": 101625658, "body": "@MarkusWMahlberg Yes maybe it&#39;s by design, but sometimes the lack of certain features is <i>very</i> annoying. For example, there doesn&#39;t appear to be any way to do something different on the last element of a slice. I think this is not uncommon. Say you have a list of some kind and you want to separate the elements with commas, or perhaps a slice of URL/text pairs where you only want to show the text for the last one. Getting the length of the slice doesn&#39;t help, because you want length - 1 (but you <i>can&#39;t</i> substract!). So you have to write a &#39;dec&#39; function?"}], "answers": [{"comments": [{"owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "edited": false, "score": 0, "creation_date": 1567567316, "post_id": 57764338, "comment_id": 101996416, "body": "I took a quick look at pongo2 mentioned above, but decided to continue using bare Go templates (with functions of course) for now."}], "tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 1, "last_activity_date": 1567477489, "creation_date": 1567477489, "answer_id": 57764338, "question_id": 57470319, "link": "https://stackoverflow.com/questions/57470319/go-html-templates-something-similar-to-jinja2-macros/57764338#57764338", "title": "Go HTML templates: something similar to Jinja2 macros?", "body": "<p>Go templates are intentionally pretty basic. You're going to find that most of the time when you're looking for something that doesn't seem possible, you probably will end up solving it with a golang function. It helps keep templates simpler and pushes code into golang functions which are far more testable.</p>\n\n<p><a href=\"https://golang.org/pkg/html/template/#Template.Funcs\" rel=\"nofollow noreferrer\">https://golang.org/pkg/html/template/#Template.Funcs</a></p>\n\n<p>Alternatively, there are a number of alternative templating engines that are more full featured.</p>\n"}], "owner": {"reputation": 1452, "user_id": 1751286, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/0d235d4094b8dbf2cd9932667d828795?s=128&d=identicon&r=PG", "display_name": "Joe Abbate", "link": "https://stackoverflow.com/users/1751286/joe-abbate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1748, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1567477489, "creation_date": 1565662609, "question_id": 57470319, "link": "https://stackoverflow.com/questions/57470319/go-html-templates-something-similar-to-jinja2-macros", "title": "Go HTML templates: something similar to Jinja2 macros?", "body": "<p>This is partly a follow-up to my earlier <a href=\"https://stackoverflow.com/questions/55913146/go-html-templates-defining-array-of-array-of-strings-to-range-over\">question</a>. The problem I'm trying to solve now is converting Jinja2 macros with arguments, e.g., something like</p>\n\n<pre><code>{% macro example(arg1, arg2) %}\n{% if arg1 %}\n   do something with arg1 and arg2\n{% endif %}\n{% endmacro %}\n</code></pre>\n\n<p>AFAICT, in Go, the nearest equivalent are nested templates, e.g.,</p>\n\n<pre><code>{{define \"example\"}}\n{{if .Arg1}}\n    do something with .Arg1 and .Arg2\n{{end}}\n{{end}}\n</code></pre>\n\n<p>However, whereas in Jinja <code>arg1</code> and <code>arg2</code> are what I'd call true arguments, i.e., when you call the <code>example</code> macro you invoke it as <code>{{example(par1, par2)}}</code>, in Go, you use <code>{{template \"example\" .}}</code> and the dot is analogous in my mind to an undefined (or not clearly defined) global workspace.</p>\n\n<p>The problem is when those arguments are defined in the calling template, i.e., let's say that in Jinja it's called as <code>{{example(\"somestring\", \"another\")}}</code> in one template and two other strings in another template. I thought I could use variables to pass the information, e.g., <code>{{$arg1 := \"somestring\"}}</code> and then invoke the template, or even define the variable in the same action as the invocation, but Go keeps complaining <code>undefined variable \"$arg1\"</code> so it doesn't seem to be possible.</p>\n\n<p>I know I can \"push\" the definition of the strings to the calling Go code, but aside from complicating the calling tree, this doesn't feel right because after all the template is presentation code and those strings are part of the presentation, not the business logic. And it's not just string arguments, there are (a) instances of formatting functions (like <code>upper()</code> and <code>lower()</code>--I know I can define them in a funcmap) and (b) HTML formatting macros that, for example, take a CSS class attribute as one of the arguments.</p>\n\n<p>Is there any hope for a solution with Go templates or should I just give up and use something else?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "edited": false, "score": 0, "creation_date": 1565983408, "post_id": 57518153, "comment_id": 101526145, "body": "You have saved my skin, thank you! I have updated the example code to reflect the implementation of your answer in two different branches <a href=\"https://github.com/shackra/txdb_ejemplo\" rel=\"nofollow noreferrer\">github.com/shackra/txdb_ejemplo</a>"}], "tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": true, "score": 4, "last_activity_date": 1565921358, "creation_date": 1565921358, "answer_id": 57518153, "question_id": 57470228, "link": "https://stackoverflow.com/questions/57470228/cant-use-txdb-with-gormigrate/57518153#57518153", "title": "Can&#39;t use txdb with Gormigrate", "body": "<p>The problem seams to be that <code>gorm</code> uses the first <code>gorm.Open</code> argument as a dialect name (it has a set of predefined dialects) and not as a <code>database/sql</code> driver name.</p>\n\n<p>So you need to use a <code>gorm</code> known dialect name as the first argument, in this case you want <code>\"postgres\"</code> since you will be using postgresql as the underlying database hence you need <code>gorm</code> using the corresponding sql dialect.</p>\n\n<p>Then you tell <code>gorm</code> to use the <code>\"txdb\"</code> driver and <code>\"tx_1\"</code> as the connection url.</p>\n\n<p>This seem to work: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n\n    \"github.com/DATA-DOG/go-txdb\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/lib/pq\"\n    gormigrate \"gopkg.in/gormigrate.v1\"\n)\n\nvar (\n    migration_1 = func(tx *gorm.DB) error {\n        type Person struct {\n            gorm.Model\n            Name string\n        }\n\n        return tx.CreateTable(&amp;Person{}).Error\n    }\n    migration_2 = func(tx *gorm.DB) error {\n        type Person struct {\n            Age int\n        }\n        return tx.AutoMigrate(&amp;Person{}).Error\n    }\n    return_nil = func(tx *gorm.DB) error {\n        return nil\n    }\n)\n\ntype Person struct {\n    gorm.Model\n    Name string\n    Age  int\n}\n\nfunc MigrateAll(gdb *gorm.DB) error {\n    m := gormigrate.New(gdb, gormigrate.DefaultOptions, []*gormigrate.Migration{\n        {\n            ID:       \"first\",\n            Migrate:  migration_1,\n            Rollback: return_nil,\n        },\n        {\n            ID:       \"second\",\n            Migrate:  migration_2,\n            Rollback: return_nil,\n        },\n    })\n    return m.Migrate()\n}\n\nfunc main() {\n    url := os.Getenv(\"DATABASE_URL\")\n    txdb.Register(\"txdb\", \"postgres\", url)\n    var db *gorm.DB\n    var err error\n    for i := 0; i &lt; 3; i++ {\n        db, err = gorm.Open(\"postgres\", \"txdb\", \"tx_1\")\n        if err == nil {\n            break\n        }\n        fmt.Printf(\"connection failed, retrying in 10 seconds. Reason: %s\\n\", err)\n        time.Sleep(10 * time.Second)\n    }\n    if err != nil {\n        panic(fmt.Sprintf(\"connection failed: %s\", err))\n    }\n\n    defer db.Close()\n    err = MigrateAll(db)\n    if err != nil {\n        panic(fmt.Sprintf(\"migration failed: %s\", err))\n    }\n}\n</code></pre>\n\n<p>Alternatively you could pass <code>gorm.Open</code> directly the <code>*sql.Db</code>, the relevant part would be like: </p>\n\n<pre><code>        s, err := sql.Open(\"txdb\", \"tx_1\")\n        // handle err\n        db, err := gorm.Open(\"postgres\", s)\n        // handle err\n</code></pre>\n\n<p>And that would work too.</p>\n"}], "owner": {"reputation": 354, "user_id": 2020214, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/EvyEn.jpg?s=128&g=1", "display_name": "shackra", "link": "https://stackoverflow.com/users/2020214/shackra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 1, "accepted_answer_id": 57518153, "answer_count": 1, "score": 2, "last_activity_date": 1565921358, "creation_date": 1565661595, "last_edit_date": 1565889938, "question_id": 57470228, "link": "https://stackoverflow.com/questions/57470228/cant-use-txdb-with-gormigrate", "title": "Can&#39;t use txdb with Gormigrate", "body": "<p>I'm trying to use <a href=\"https://github.com/DATA-DOG/go-txdb\" rel=\"nofollow noreferrer\">txdb</a> for migrating my database inside an isolated transaction, for the purpose of testing code that interact with the database and also for tests with the migrations themselves. But every time I run my code an error is returned and some warnings are yell by Gorm:</p>\n\n<pre><code>$ DATABASE_URL=\"postgres://postgres@localhost:5432/postgres?sslmode=disable\" ./txdb_ejemplo\n`txdb_postgres` is not officially supported, running under compatibility mode.\n\n(/home/jorge/go/pkg/mod/gopkg.in/gormigrate.v1@v1.6.0/gormigrate.go:381)\n[2019-08-12 19:46:28]  pq: current transaction is aborted, commands ignored until end of transaction block\npanic: migration failed: pq: current transaction is aborted, commands ignored until end of transaction block\n\ngoroutine 1 [running]:\nmain.main()\n        /home/jorge/proyectos/kue/fero/txdb_ejemplo/main.go:76 +0x3a1\n</code></pre>\n\n<p>And this is the output of the docker service running offering the database:</p>\n\n<pre><code>db_1  | 2019-08-13 01:46:08.788 UTC [1] LOG:  database system is ready to accept connections\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] ERROR:  function database() does not exist at character 8\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] HINT:  No function matches the given name and argument types. You might need to add explicit type casts.\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] STATEMENT:  SELECT DATABASE()\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] ERROR:  syntax error at or near \"AND\" at character 71\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] STATEMENT:  SELECT count(*) FROM INFORMATION_SCHEMA.TABLES WHERE table_schema = ? AND table_name = ?\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] ERROR:  current transaction is aborted, commands ignored until end of transaction block\ndb_1  | 2019-08-13 01:46:28.564 UTC [48] STATEMENT:  CREATE TABLE migrations (id VARCHAR(255) PRIMARY KEY)\n</code></pre>\n\n<p>I don't understand what I'm doing wrong, but I offer a minimal functional example that reproduces the issue I'm having, <a href=\"https://github.com/shackra/txdb_ejemplo\" rel=\"nofollow noreferrer\">here is the repository with the code</a> and there is a primer of the Go code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"time\"\n\n    \"github.com/DATA-DOG/go-txdb\"\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/lib/pq\"\n    gormigrate \"gopkg.in/gormigrate.v1\"\n)\n\nvar (\n    migration_1 = func(tx *gorm.DB) error {\n        type Person struct {\n            gorm.Model\n            Name string\n        }\n\n        return tx.CreateTable(&amp;Person{}).Error\n    }\n    migration_2 = func(tx *gorm.DB) error {\n        type Person struct {\n            Age int\n        }\n        return tx.AutoMigrate(&amp;Person{}).Error\n    }\n    return_nil = func(tx *gorm.DB) error {\n        return nil\n    }\n)\n\ntype Person struct {\n    gorm.Model\n    Name string\n    Age  int\n}\n\nfunc MigrateAll(gdb *gorm.DB) error {\n    m := gormigrate.New(gdb, gormigrate.DefaultOptions, []*gormigrate.Migration{\n        {\n            ID:       \"first\",\n            Migrate:  migration_1,\n            Rollback: return_nil,\n        },\n        {\n            ID:       \"second\",\n            Migrate:  migration_2,\n            Rollback: return_nil,\n        },\n    })\n    return m.Migrate()\n}\n\nfunc main() {\n    url := os.Getenv(\"DATABASE_URL\")\n    txdb.Register(\"txdb_postgres\", \"postgres\", url)\n    var db *gorm.DB\n    var err error\n    for i := 0; i &lt; 3; i++ {\n        db, err = gorm.Open(\"txdb_postgres\", \"tx_1\")\n        if err == nil {\n            break\n        }\n        fmt.Printf(\"connection failed, retrying in 10 seconds. Reason: %s\\n\", err)\n        time.Sleep(10 * time.Second)\n    }\n    if err != nil {\n        panic(fmt.Sprintf(\"connection failed: %s\", err))\n    }\n\n    defer db.Close()\n    err = MigrateAll(db)\n    if err != nil {\n        panic(fmt.Sprintf(\"migration failed: %s\", err))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "asynchronous", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 332, "user_id": 1712581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/875c2ee70f81b21c3a5a82a5f9790396?s=128&d=identicon&r=PG", "display_name": "Prutser", "link": "https://stackoverflow.com/users/1712581/prutser"}, "edited": false, "score": 0, "creation_date": 1565701523, "post_id": 57470635, "comment_id": 101428390, "body": "Thank you so much! I like how you gave multiple examples and detailed comments. This really helps me out!"}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 0, "last_activity_date": 1565740354, "last_edit_date": 1565740354, "creation_date": 1565665662, "answer_id": 57470635, "question_id": 57470154, "link": "https://stackoverflow.com/questions/57470154/how-do-i-optimise-a-for-loop-which-makes-requests-to-an-api/57470635#57470635", "title": "How do I optimise a for loop which makes requests to an API?", "body": "<p>There are many ways to make each iteration executed asynchronously. One of them is by taking advantage of goroutine and channel (like what you desired).</p>\n\n<p>Please take a look at example below. I think it'll be easier if I put the explanations as comments on each part of the code.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// prepare the channel for data transporation purpose between goroutines and main routine\nresChan := make(chan []interface{})\n\nfor ID, person := range people {\n\n    // dispatch an IIFE as goroutine, so no need to change the `someApiCall()`\n    go func(id string, person Person) {\n        result := someApiCall(person)\n\n        // send both id and result to channel.\n        // it'll be better if we construct new type based id and result, but in this example I'll use channel with []interface{} type\n        resChan &lt;- []interface{}{id, result}\n    }(ID, person)\n}\n\n// close the channel since every data is sent.\nclose(resChan)\n\n// prepare a variable to hold all results\nresults := make(map[string]Result)\n\n// use `for` and `range` to retrieve data from channel\nfor res := range ch {\n    id := res[0].(string)\n    person := res[1].(Person)\n\n    // append it to the map\n    result[id] = person\n}\n\n// And do something with all the results once completed\n</code></pre>\n\n<hr>\n\n<p>Another way is by using few <code>sync</code> API like <code>sync.Mutex</code> and <code>sync.WaitGroup</code> to achieve same target.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// prepare a variable to hold all results\nresults := make(map[string]Result)\n\n// prepare a mutex object with purpose is to lock and unlock operations related to `results` variable, to avoid data race.\nmtx := new(sync.Mutex)\n\n// prepare a waitgroup object for effortlessly waits for goroutines to finish\nwg := new(sync.WaitGroup)\n\n// tell the waitgroup object how many goroutines that need to be finished\nwg.Add(people)\n\nfor ID, person := range people {\n\n    // dispatch an IIFE as goroutine, so no need to change the `someApiCall()`\n    go func(id string, person Person) {\n        result := someApiCall(person)\n\n        // lock the append operation on `results` variable to avoid data race\n        mtx.Lock()\n        results[ID] = result\n        mtx.Unlock()\n\n        // tell waitgroup object that one goroutine is just finished\n        wg.Done()\n    }(ID, person)\n}\n\n// block the process synchronously till all goroutine finishes.\n// after that it'll continue to next process underneath\nwg.Wait()\n\n// And do something with all the results once completed\n</code></pre>\n\n<hr>\n\n<p><strong>A warning</strong>. Both approaches above are fine to use on a case that there are only few data that need to be iterated. If there are a lot of it, it'll not be good, there will be tons of goroutine dispatched nearly in the same time, and will cause very high machine memory usage. I suggest to take a look about <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\">worker pool technique</a> to improve the code.</p>\n"}, {"tags": [], "owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "is_accepted": false, "score": 1, "last_activity_date": 1565665749, "creation_date": 1565665749, "answer_id": 57470649, "question_id": 57470154, "link": "https://stackoverflow.com/questions/57470154/how-do-i-optimise-a-for-loop-which-makes-requests-to-an-api/57470649#57470649", "title": "How do I optimise a for loop which makes requests to an API?", "body": "<p>You can use goroutine to call the api in parallel:</p>\n\n<pre><code>type Item struct {\n    id string\n    res Result\n}\n\nfunc callApi(id string, person Result, resultChannel chan Item) {\n    res := someApiCall(person)\n    resultChannel &lt;- Item{id, res}\n}\n\nresultChannel := make(chan Item)\nfor id, person := range people {\n    go callApi(id, person, resultChannel)\n}\n\nresult := make(map[string]Result)\nfor range people {\n    item := &lt;- resultChannel\n    result[item.id] = item.res\n}\n</code></pre>\n\n<p>However, the above code ignores error handling, e.g. <code>someApiCall</code> might fail or panic, and if there're too many persons, there will be too many api calls in parallel, normally, you should limit the number of api calls in parallel. I'll leave those problems as an exercise for you</p>\n"}], "owner": {"reputation": 332, "user_id": 1712581, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/875c2ee70f81b21c3a5a82a5f9790396?s=128&d=identicon&r=PG", "display_name": "Prutser", "link": "https://stackoverflow.com/users/1712581/prutser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 289, "favorite_count": 0, "closed_date": 1565668236, "accepted_answer_id": 57470635, "answer_count": 2, "score": -1, "last_activity_date": 1565740354, "creation_date": 1565660860, "last_edit_date": 1565700955, "question_id": 57470154, "link": "https://stackoverflow.com/questions/57470154/how-do-i-optimise-a-for-loop-which-makes-requests-to-an-api", "closed_reason": "Needs more focus", "title": "How do I optimise a for loop which makes requests to an API?", "body": "<p>I have a for-loop in my Go code. Each iteration makes a request to a certain API and then saves its result in a map. How do I optimise the performance so that the iterations will be called asynchronously?</p>\n\n<p>I'm currently diving into goroutines and channels and all that, but I'm still having trouble to apply it in the wild :)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>results := map[string]Result\n\nfor ID, person := range people {\n    result := someApiCall(person)\n    results[ID] = result\n}\n\n// And do something with all the results once completed\n</code></pre>\n"}, {"tags": ["go", "websocket", "aws-lambda", "serverless-framework"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 2722622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d29bcfb545ada8d51c1fe073e1c4e5?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/2722622/nate"}, "edited": false, "score": 0, "creation_date": 1565706578, "post_id": 57474225, "comment_id": 101431489, "body": "My guess was the method signature as well but I can&#39;t find an example for a websocket hander in Go. It does run and the <code>APIGatewayWebsocketProxyRequest</code> is populated"}, {"owner": {"reputation": 11, "user_id": 2722622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d29bcfb545ada8d51c1fe073e1c4e5?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/2722622/nate"}, "edited": false, "score": 0, "creation_date": 1565710501, "post_id": 57474225, "comment_id": 101433659, "body": "Turned on Cloudwatch logging for API and it&#39;s definitely this. Thank you."}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": true, "score": 0, "last_activity_date": 1565686235, "creation_date": 1565686235, "answer_id": 57474225, "question_id": 57468191, "link": "https://stackoverflow.com/questions/57468191/why-does-aws-api-gateway-websocket-send-error/57474225#57474225", "title": "Why does AWS API Gateway websocket send error", "body": "<p>Not sure if this is the only problem in your code, but your handler signature should be one listed in the <a href=\"https://docs.aws.amazon.com/lambda/latest/dg/go-programming-model-handler-types.html#go-programming-model-handler-types-signatures\" rel=\"nofollow noreferrer\">doc</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ()\nfunc () error\nfunc (TIn) error\nfunc () (TOut, error)\nfunc (context.Context) error\nfunc (context.Context, TIn) error\nfunc (context.Context) (TOut, error)\nfunc (context.Context, TIn) (TOut, error)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 2722622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d29bcfb545ada8d51c1fe073e1c4e5?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/2722622/nate"}, "is_accepted": false, "score": -1, "last_activity_date": 1565712286, "creation_date": 1565712286, "answer_id": 57481535, "question_id": 57468191, "link": "https://stackoverflow.com/questions/57468191/why-does-aws-api-gateway-websocket-send-error/57481535#57481535", "title": "Why does AWS API Gateway websocket send error", "body": "<p>Alright so it took a lot of trial and error but this is the method signature that works</p>\n\n<pre><code>type Response events.APIGatewayProxyResponse\n\nfunc Handler(context context.Context, request events.APIGatewayWebsocketProxyRequest) (Response, error) \n</code></pre>\n\n<p>I really wish the documentation for golang was better. Thanks to Clement for pointing me in the right direction.</p>\n"}], "owner": {"reputation": 11, "user_id": 2722622, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1d29bcfb545ada8d51c1fe073e1c4e5?s=128&d=identicon&r=PG&f=1", "display_name": "Nate", "link": "https://stackoverflow.com/users/2722622/nate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "accepted_answer_id": 57474225, "answer_count": 2, "score": 0, "last_activity_date": 1565712286, "creation_date": 1565643738, "last_edit_date": 1565689870, "question_id": 57468191, "link": "https://stackoverflow.com/questions/57468191/why-does-aws-api-gateway-websocket-send-error", "title": "Why does AWS API Gateway websocket send error", "body": "<p>I am using serverless framework to set up an AWS API Gateway websocket which calls a lambda function written in Go. Right now the handler only logs a message. I can connect to the websocket, and I can see the message is logged in Cloudwatch when I send a message through the socket, but I always get an error message that looks like </p>\n\n<pre><code>{\n  \"message\": \"Internal server error\",\n  \"connectionId\": \"eU3C1cE7CYcCJPw=\",\n  \"requestId\": \"eU3EQFX0iYcFysQ=\"\n}\n</code></pre>\n\n<p>There are no errors logged for the lambda in Cloudwatch. The AWS API Gateway config looks good to me. I'm at a loss trying to think of what could cause this.</p>\n\n<p>My main.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/aws/aws-lambda-go/events\"\n    \"github.com/aws/aws-lambda-go/lambda\"\n)\n\nfunc Handler(request events.APIGatewayWebsocketProxyRequest) {\n    fmt.Println(\"default function ran\")\n}\n\nfunc main() {\n    lambda.Start(Handler)\n}\n</code></pre>\n\n<p>Probably not super relevant but the serverless.yaml config:</p>\n\n<pre><code>functions:\n  websocket-default:\n    handler: bin/ws\n    events:\n      - websocket:\n          route: $default\n</code></pre>\n\n<p>The payload I'm sending:</p>\n\n<pre><code>{\n  \"action\": \"whatever\",\n  \"data\":  \"{whatever}\"\n}\n</code></pre>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 991, "user_id": 2555108, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xySgD.png?s=128&g=1", "display_name": "Michael Kolber", "link": "https://stackoverflow.com/users/2555108/michael-kolber"}, "edited": false, "score": 1, "creation_date": 1565635285, "post_id": 57466482, "comment_id": 101406435, "body": "Are you escaping <code>.</code>? As per the <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow noreferrer\">syntax spec</a>, <code>.</code> matches any character, so your <code>.*</code> at the end will match all following characters, including <code>}</code>s."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565636043, "post_id": 57466482, "comment_id": 101406749, "body": "This is probably better served by a discrete parser than a regexp (and I&#39;m saying that as someone very fond of regexp where it&#39;s appropriate)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565702208, "post_id": 57466482, "comment_id": 101428755, "body": "Parsing text is very common and pretty straightforward. For something like this you&#39;d probably just want to loop over the string character by character and apply your logic to it."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565635998, "post_id": 57466562, "comment_id": 101406736, "body": "Unfortunately this won&#39;t match anything with a single <code>}</code> inside the double-braces. I don&#39;t know if that&#39;s a problem in practice."}], "tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": true, "score": 1, "last_activity_date": 1565635252, "creation_date": 1565635252, "answer_id": 57466562, "question_id": 57466482, "link": "https://stackoverflow.com/questions/57466482/how-to-match-enclosing-brackets-which-are-next-to-each-other/57466562#57466562", "title": "How to match enclosing brackets which are next to each other?", "body": "<p>I'm guessing that maybe you might want to write an expression that'd look somewhat similar to: </p>\n\n<pre><code>\\s*{{\\s*\\$?\\.Values([^}]*)?\\s*}}\n</code></pre>\n\n<h3>Test</h3>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?m)\\s*{{\\s*\\$?\\.Values([^}]*)?\\s*}}`)\n    var str = `image: \"{{ $.Values.image.repository }}:{{ $.Values.image.tag }}`\n\n    for i, match := range re.FindAllString(str, -1) {\n        fmt.Println(match, \"found at index\", i)\n    }\n}\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>If you wish to explore/simplify/modify the expression, it's been\n  explained on the top right panel of\n  <a href=\"https://regex101.com/r/0xMQiq/1/\" rel=\"nofollow noreferrer\">regex101.com</a>. If you'd like, you\n  can also watch in <a href=\"https://regex101.com/r/0xMQiq/1/debugger\" rel=\"nofollow noreferrer\">this\n  link</a>, how it would match\n  against some sample inputs.</p>\n</blockquote>\n\n<hr>\n\n<h3>RegEx Circuit</h3>\n\n<p><a href=\"https://jex.im/regulex/#!flags=&amp;re=%5E(a%7Cb)*%3F%24\" rel=\"nofollow noreferrer\">jex.im</a> visualizes regular expressions: </p>\n\n<p><a href=\"https://i.stack.imgur.com/Cmnvj.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Cmnvj.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 43, "user_id": 11720975, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-oQUCpAe0Hhc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdQHPVb8qP-zF2mKGWWhBCNuB38tA/photo.jpg?sz=128", "display_name": "Shishir Jakati", "link": "https://stackoverflow.com/users/11720975/shishir-jakati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 1, "accepted_answer_id": 57466562, "answer_count": 1, "score": 1, "last_activity_date": 1565635252, "creation_date": 1565634892, "question_id": 57466482, "link": "https://stackoverflow.com/questions/57466482/how-to-match-enclosing-brackets-which-are-next-to-each-other", "title": "How to match enclosing brackets which are next to each other?", "body": "<p>I'm am attempting to parse lines of Helm templates. I run into issues when I have value declarations side-by-side on the same line.</p>\n\n<p>For example, the line <code>image: \"{{ $.Values.image.repository }}:{{ $.Values.image.tag }}\"</code> returns one big match as opposed to two matches within the brackets.</p>\n\n<p>I have tried using <code>(\\-)?( )?(.*):( )\\{\\{( )(\\$)?.Values.*\\}\\}</code>.</p>\n\n<p>I'd like to get both value instances instead of one large instance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1565632585, "post_id": 57465973, "comment_id": 101405293, "body": "There isn&#39;t one. You&#39;d need to write those (one-line) functions yourself."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565632982, "post_id": 57465973, "comment_id": 101405436, "body": "@Adrian that&#39;s a valid answer, but not sure if the question deserves a downvote."}, {"owner": {"reputation": 26908, "user_id": 1192728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/481baa815383ed3970e726842195f73f?s=128&d=identicon&r=PG", "display_name": "hqt", "link": "https://stackoverflow.com/users/1192728/hqt"}, "edited": false, "score": 1, "creation_date": 1565633317, "post_id": 57465973, "comment_id": 101405562, "body": "@Tommy I agree.  For your answer, there isn&#39;t one. Operators in Golang are not  functions as some other languages such as Ruby."}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1565699156, "creation_date": 1565699156, "answer_id": 57477714, "question_id": 57465973, "link": "https://stackoverflow.com/questions/57465973/call-operator-by-name/57477714#57477714", "title": "Call operator by name", "body": "<p>First, you shouldn't assume language X has any equivalent for feature Y in language Z. Also you should write/design code for the language you're using rather than designing as if it was another language and then translating line-by-line or function-by-function.</p>\n\n<p>As comments mentioned, operators are builtin in Go with no operator overloading or functional equivalents. If you haven't already you should take the <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Go Tour</a> and read the <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">Language Specification</a> to see what Go does have.</p>\n\n<p>If you really want/need to do something like you ask this is one way:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\ntype Compare func(int, int) bool\n\nfunc DoCompare(cmp Compare, a, b int) bool {\n    return cmp(a, b)\n}\n\nvar (\n    CmpLessThan           = func(a, b int) bool { return a &lt; b }\n    CmpLessThanOrEqual    = func(a, b int) bool { return a &lt;= b }\n    CmpGreaterThan        = func(a, b int) bool { return a &gt; b }\n    CmpGreaterThanOrEqual = func(a, b int) bool { return a &gt;= b }\n)\n\nfunc main() {\n    fmt.Println(DoCompare(CmpLessThan, 1, 2))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/uELm4RAujAI\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>Normally if something like this is needed, instead of multiple comparison functions, a single compare function is used that returns &lt;0, 0, or, >0 (e.g.\u00a0-1, 0, +1) for less-than, equal, greater-than. For example, <a href=\"https://golang.org/pkg/math/big/#Int.Cmp\" rel=\"nofollow noreferrer\"><code>big.Int.Cmp</code></a>.</p>\n"}, {"comments": [{"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 1, "creation_date": 1582210087, "post_id": 60221394, "comment_id": 106705555, "body": "I appreciate your answer here. Not sure why you (actually and I and every answer so far!) are all downvoted. YoU CAnT dO ThAt"}, {"owner": {"reputation": 324, "user_id": 5654201, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-foGBZQy_xpw/AAAAAAAAAAI/AAAAAAAAABs/mzkiWQ2JKYM/photo.jpg?sz=128", "display_name": "Ben Sarah Golightly", "link": "https://stackoverflow.com/users/5654201/ben-sarah-golightly"}, "reply_to_user": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1582221187, "post_id": 60221394, "comment_id": 106711852, "body": "some people <i>really</i> hate functional programming in Go :P"}], "tags": [], "owner": {"reputation": 324, "user_id": 5654201, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-foGBZQy_xpw/AAAAAAAAAAI/AAAAAAAAABs/mzkiWQ2JKYM/photo.jpg?sz=128", "display_name": "Ben Sarah Golightly", "link": "https://stackoverflow.com/users/5654201/ben-sarah-golightly"}, "is_accepted": false, "score": -1, "last_activity_date": 1581713715, "last_edit_date": 1581713715, "creation_date": 1581663130, "answer_id": 60221394, "question_id": 57465973, "link": "https://stackoverflow.com/questions/57465973/call-operator-by-name/60221394#60221394", "title": "Call operator by name", "body": "<p>I needed the same thing - basic operators as first-class functions in Go - and ended up writing a template and a bit of Python to generating my own.</p>\n\n<p>I've packaged it up into a single well-tested Go module, called <code>operator</code> after the Python module.</p>\n\n<p>Hope this helps!</p>\n\n<p><strong>Go Get:</strong></p>\n\n<pre><code>go get -u tawesoft.co.uk/go/operator\n</code></pre>\n\n<p><strong>Examples:</strong></p>\n\n<pre><code>operator.Boolean.Not(true) == false\noperator.Boolean.Nary.Any(false, true, true, false) == true\noperator.Int.Binary.Add(1, 2) == 3\n</code></pre>\n\n<p>In your case:</p>\n\n<pre><code>f(operator.Int.Binary.Lt, 1, 2)\n</code></pre>\n\n<p><strong>Links:</strong></p>\n\n<p><a href=\"https://www.tawesoft.co.uk/go\" rel=\"nofollow noreferrer\">Home</a> | <a href=\"https://godoc.org/tawesoft.co.uk/go/operator\" rel=\"nofollow noreferrer\">Docs</a> | <a href=\"https://github.com/tawesoft/go/tree/master/operator\" rel=\"nofollow noreferrer\">Source</a> | <a href=\"https://raw.githubusercontent.com/tawesoft/go/master/operator/LICENSE.txt\" rel=\"nofollow noreferrer\">License (MIT-0)</a></p>\n"}], "owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1581713715, "creation_date": 1565632503, "last_edit_date": 1565698447, "question_id": 57465973, "link": "https://stackoverflow.com/questions/57465973/call-operator-by-name", "title": "Call operator by name", "body": "<p>What is the Go equivalent of, for example, Python's <a href=\"https://docs.python.org/3.4/library/operator.html\" rel=\"nofollow noreferrer\"><code>operator</code></a> package for calling builtin operators by name?</p>\n\n<p>Meaning, how can I do something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func f(op func(int, int)bool, a int, b int)\n    ...\n    if op(a, b) {\n        ...\n\nf(operators.LessThan, 1, 2) // true\n</code></pre>\n\n<p>Stated otherwise, how to write a function that takes in what basic operator to apply as a function argument?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565632639, "post_id": 57465968, "comment_id": 101405311, "body": "<code>nil</code> is only a valid value for pointer, slices, and maps. You cannot have a <code>nil</code> struct value, for example."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565632688, "post_id": 57465968, "comment_id": 101405328, "body": "So what should I return instead, when the struct is not found?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1565632692, "post_id": 57465968, "comment_id": 101405330, "body": "Typically in a function like this your error return would be e.g. <code>return model.Article{}, err</code> to return an empty struct."}, {"owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565633061, "post_id": 57465968, "comment_id": 101405466, "body": "Thanks for the tip Adrian. Please answer and I&#39;ll accept."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 4, "last_activity_date": 1565633273, "creation_date": 1565633273, "answer_id": 57466126, "question_id": 57465968, "link": "https://stackoverflow.com/questions/57465968/cannot-use-nil-as-type-model-article-in-return-argument/57466126#57466126", "title": "cannot use nil as type model.Article in return argument", "body": "<p><code>nil</code> is only a valid value for pointer, slices, and maps. You cannot have a <code>nil</code> struct value, for example.</p>\n\n<p>Typically in a function like this your error return would be e.g. </p>\n\n<pre><code>return model.Article{}, err\n</code></pre>\n\n<p>to return an empty struct.</p>\n"}, {"tags": [], "owner": {"reputation": 1592, "user_id": 7251967, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-al-If026iHU/AAAAAAAAAAI/AAAAAAAAABE/9lsheyH-V9Q/photo.jpg?sz=128", "display_name": "negi Yogi", "link": "https://stackoverflow.com/users/7251967/negi-yogi"}, "is_accepted": false, "score": 0, "last_activity_date": 1566286007, "last_edit_date": 1566286007, "creation_date": 1565694348, "answer_id": 57476442, "question_id": 57465968, "link": "https://stackoverflow.com/questions/57465968/cannot-use-nil-as-type-model-article-in-return-argument/57476442#57476442", "title": "cannot use nil as type model.Article in return argument", "body": "<p>If you want to return the nil in case of error, update your function to this  </p>\n\n<pre><code>    func GetArticleBySlug(slug string) (*model.Article, error) {\n    var err error\n    article := new(model.Article)\n    err = database.SQL.Get(&amp;article, \"SELECT * FROM article WHERE slug=? LIMIT 1\", slug)\n    if err != nil {\n        log.Println(err)\n        return nil, err //&lt;- Problem here\n    }\n    return article, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 11513919, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-49Fm37GZKH8/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reUwLtoKDncJwrABPekqr8NUpMkKw/mo/photo.jpg?sz=128", "display_name": "grhn", "link": "https://stackoverflow.com/users/11513919/grhn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1014, "favorite_count": 0, "closed_date": 1565702921, "accepted_answer_id": 57466126, "answer_count": 2, "score": -2, "last_activity_date": 1566286007, "creation_date": 1565632486, "question_id": 57465968, "link": "https://stackoverflow.com/questions/57465968/cannot-use-nil-as-type-model-article-in-return-argument", "closed_reason": "Not suitable for this site", "title": "cannot use nil as type model.Article in return argument", "body": "<p>I have this function which is supposed to query database and return an <code>article</code> if found, and nil if the article is not found:</p>\n\n<pre><code>func GetArticleBySlug(slug string) (model.Article, error) {\n    var err error\n    var article model.Article\n    err = database.SQL.Get(&amp;article, \"SELECT * FROM article WHERE slug=? LIMIT 1\", slug)\n    if err != nil {\n        log.Println(err)\n        return nil, err //&lt;- Problem here\n    }\n    return article, nil\n}\n</code></pre>\n\n<p>Where <code>Article</code> is a struct defined in <code>model</code> package. </p>\n\n<p>But I get this error:</p>\n\n<pre><code>cannot use nil as type model.Article in return argument\n</code></pre>\n\n<p>How can I fix this?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1565632741, "post_id": 57465920, "comment_id": 101405353, "body": "Is the pointer <code>nil</code>? If so, you&#39;ll need to initialize it with a value before traversing into it."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565634828, "post_id": 57465920, "comment_id": 101406223, "body": "Update the question to show your test case."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 2, "last_activity_date": 1565679026, "last_edit_date": 1565679026, "creation_date": 1565658483, "answer_id": 57469950, "question_id": 57465920, "link": "https://stackoverflow.com/questions/57465920/using-reflection-to-populate-a-pointer-to-a-struct/57469950#57469950", "title": "Using reflection to populate a pointer to a struct", "body": "<p>I dropped your code as-is into the Go Playground and it doesn't build because <code>PopulateStruct</code> is declared as returning <code>interface{}</code> but does not actually return anything.  Removing the declared return type produces the panic you mention.</p>\n\n<p>This is because at entry to the outer <code>PopulateStruct</code> call, you have a valid pointer, pointing to a zero-valued <code>Table</code>.  A zero-valued <code>Table</code> has one element: a nil pointer in it of type <code>*Field</code>.  Your loop therefore runs once and finds a <code>reflect.Ptr</code>, as you expected.  Adding more diagnostic print messages helps see what's happening:</p>\n\n<pre><code>fmt.Printf(\"PopulateStruct: I have typeOf=%v, valueOf=%v\\n\", typeOf, valueOf)\nfor i := 0; i &lt; typeOf.Elem().NumField(); i++ {\n    switch typeOf.Elem().Field(i).Type.Kind() {\n// ... snipped some code ...\n    case reflect.Ptr:\n        ptr := reflect.New(valueOf.Elem().Field(i).Type())\n        fmt.Println(\"after allocating ptr, we have:\", ptr.Type(), ptr,\n            \"but its Elem is:\", ptr.Elem().Type(), ptr.Elem())\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>PopulateStruct: I have typeOf=*main.Table, valueOf=&amp;{&lt;nil&gt;}\nafter allocating ptr, we have: **main.Field 0x40c138 but its Elem is: *main.Field &lt;nil&gt;\n</code></pre>\n\n<p>Given the way <code>PopulateStruct</code> itself is constructed, we must actually allocate a real <code>Field</code> instance <em>now</em>, before calling <code>PopulateStruct</code>.  We can do this with:</p>\n\n<pre><code>        p2 := ptr.Elem()\n        ptr.Elem().Set(reflect.New(p2.Type().Elem()))\n</code></pre>\n\n<p>(<a href=\"https://golang.org/src/encoding/json/decode.go?s#L474\" rel=\"nofollow noreferrer\">code borrowed from <code>json.Unmarshal</code></a>).  Now we can fill in this <code>Field</code>, which has one field named <code>Name</code> of type <code>String</code>.</p>\n\n<p>The overall strategy here is not that great, in my opinion: filling-in probably should take a generic pointer, not specifically a pointer-to-<code>struct</code> pointer.  You can then emulate the <code>indirect</code> function in the json unmarshaller.  However, the addition of these two lines\u2014creating the target object and making the allocated pointer point to it\u2014suffices to make your existing code run.</p>\n\n<p>(Alternatively, you could just create and return a whole instance from scratch, in which case all you need is the type\u2014but I'm assuming you have a pattern in which only <em>some</em> fields are nil.)</p>\n\n<p><a href=\"https://play.golang.org/p/i8c5JlXFwp5\" rel=\"nofollow noreferrer\">Here's the complete Go Playground example.</a>  I made a few other changes as there's nothing to scan from when using the playground.</p>\n"}], "owner": {"reputation": 115, "user_id": 1515079, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a192b4f3876b4b421918943bda9612d2?s=128&d=identicon&r=PG", "display_name": "Tim Lind", "link": "https://stackoverflow.com/users/1515079/tim-lind"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 622, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1565700436, "creation_date": 1565632258, "last_edit_date": 1565700436, "question_id": 57465920, "link": "https://stackoverflow.com/questions/57465920/using-reflection-to-populate-a-pointer-to-a-struct", "title": "Using reflection to populate a pointer to a struct", "body": "<p>I'd like to iterate over the fields in a struct and prompt for string values to string fields, doing this recursively for fields that are pointers to structs. </p>\n\n<p>Currently this is what I've tried, but I get an error when trying to set this value in the pointer's string field.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Table struct {\n    PK *Field\n}\n\ntype Field struct {\n    Name string\n}\n\n\nfunc main() {\n    PopulateStruct(&amp;Table{})\n}\n\nfunc PopulateStruct(a interface{}) interface {} {\n    typeOf := reflect.TypeOf(a)\n    valueOf := reflect.ValueOf(a)\n    for i := 0; i &lt; typeOf.Elem().NumField(); i++ {\n        switch typeOf.Elem().Field(i).Type.Kind() {\n        case reflect.String:\n            fmt.Print(typeOf.Elem().Field(i).Name)\n            var s string\n            fmt.Scanf(\"%s\", &amp;s)\n            valueOf.Elem().Field(i).SetString(s)\n        case reflect.Ptr:\n            ptr := reflect.New(valueOf.Elem().Field(i).Type())\n            PopulateStruct(ptr.Elem().Interface())\n            valueOf.Elem().Field(i).Set(ptr)\n        }\n    }\n}\n</code></pre>\n\n<p>Expecting the return value to include an initialised struct with the pointers string field set. </p>\n\n<p>Getting an error when setting the pointer's string field.</p>\n\n<p>panic: reflect: call of reflect.Value.Field on zero Value</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 323, "user_id": 9325709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900514478124ece83447875b14afe55b?s=128&d=identicon&r=PG&f=1", "display_name": "maxwellhertz", "link": "https://stackoverflow.com/users/9325709/maxwellhertz"}, "edited": false, "score": 0, "creation_date": 1565658850, "post_id": 57465497, "comment_id": 101412628, "body": "Oh thank you! Now I think I know how defer function named return value work!"}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 5, "last_activity_date": 1565630100, "creation_date": 1565630100, "answer_id": 57465497, "question_id": 57465268, "link": "https://stackoverflow.com/questions/57465268/go-defer-function-return-values/57465497#57465497", "title": "Go defer function return values", "body": "<p>If <code>DeferFunc1</code> makes sense to you then <code>DeferFunc3</code> should as well as they illustrate the same concept, namely that you can modify a named return value.</p>\n\n<p>In <code>DeferFunc1</code> you are adding 3 to 1 in your defer yielding your expected 4.<br>\nIn <code>DeferFunc3</code> you are adding 1 to 2 in your defer yielding 3.  A naked return here, or a return of t would get you to 4.  But in this case, <code>t</code> is assigned the value of 2 right before your defer runs, so you get 3.<br>\nIn <code>DeferFunc2</code> you are not using a named return, so you cannot take advantage of this technique.</p>\n"}], "owner": {"reputation": 323, "user_id": 9325709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900514478124ece83447875b14afe55b?s=128&d=identicon&r=PG&f=1", "display_name": "maxwellhertz", "link": "https://stackoverflow.com/users/9325709/maxwellhertz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "accepted_answer_id": 57465497, "answer_count": 1, "score": 3, "last_activity_date": 1565630100, "creation_date": 1565628874, "question_id": 57465268, "link": "https://stackoverflow.com/questions/57465268/go-defer-function-return-values", "title": "Go defer function return values", "body": "<pre><code>func main() {\n\n    println(DeferFunc1(1))\n    println(DeferFunc2(1))\n    println(DeferFunc3(1))\n}\n\nfunc DeferFunc1(i int) (t int) {\n    t = i\n    defer func() {\n        t += 3\n    }()\n    return t\n}\n\nfunc DeferFunc2(i int) int {\n    t := i\n    defer func() {\n        t += 3\n    }()\n    return t\n}\n\nfunc DeferFunc3(i int) (t int) {\n    defer func() {\n        t += i\n    }()\n    return 2\n}\n</code></pre>\n\n<p>Above code will print: <code>4 1 3</code>. Can anyone explain this? Of course, <code>DeferFunc1</code> should return <code>4</code>. But why will <code>DeferFunc2</code> and <code>DeferFunc3</code> will return <code>1</code> and <code>3</code> respectively? Is that about closure or variable scope in Go?</p>\n"}, {"tags": ["google-app-engine", "go", "google-app-engine-go"], "answers": [{"tags": [], "owner": {"reputation": 1040, "user_id": 11672166, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/be83fb6d2f6554cc268dd0466d6fdf66?s=128&d=identicon&r=PG", "display_name": "JKleinne", "link": "https://stackoverflow.com/users/11672166/jkleinne"}, "is_accepted": false, "score": 0, "last_activity_date": 1565664874, "creation_date": 1565664874, "answer_id": 57470553, "question_id": 57465130, "link": "https://stackoverflow.com/questions/57465130/how-to-use-main-package-in-different-folder-than-app-yaml-for-appengine-go/57470553#57470553", "title": "How to use main package in different folder than app.yaml for appengine Go?", "body": "<p>The error code suggests that the string passed on to main must match the regex <code>^(?:[\\w.\\\\\\/:]+)$</code>. This means that the supplied string must match any character inside the character set such as <code>/w</code> which can be any word character ( alphanumeric &amp; underscore ), <code>.</code> which matches the <code>.</code> character, <code>\\\\</code> which matches a <code>\\</code> character, <code>\\/</code> which matches a <code>/</code> character and <code>:</code> which matches a <code>:</code> character.</p>\n\n<p>Notice that there isn't a <code>-</code> in the character set which would allow you to include the <code>-</code> character in the string supplied in main while respecting the regex it is constrained to. As such, so long as this constraint exclude <code>-</code> in the character set, main the expected string in the main attribute should be one that also excludes <code>-</code> while respecting the rest of the expression.</p>\n"}], "owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565664874, "creation_date": 1565628280, "question_id": 57465130, "link": "https://stackoverflow.com/questions/57465130/how-to-use-main-package-in-different-folder-than-app-yaml-for-appengine-go", "title": "How to use main package in different folder than app.yaml for appengine Go?", "body": "<p>I am trying to upload a Go app to appegnine Go 1.12 runtime. My main pkg is under a <code>cmd</code> folder as shows <a href=\"https://cloud.google.com/appengine/docs/standard/go112/config/appref#runtime_and_app_elements\" rel=\"nofollow noreferrer\">https://cloud.google.com/appengine/docs/standard/go112/config/appref#runtime_and_app_elements</a></p>\n\n<p>But if I try any of the approaches outlines in the official docs, I get the following error:</p>\n\n<pre><code>ERROR: (gcloud.app.deploy) An error occurred while parsing file: [/home/tamal/go/src/kmodules.xyz/resource-metadata/app.yaml]\nUnable to assign value './cmd/resource-metadata-server' to attribute 'main':\nValue './cmd/resource-metadata-server' for main does not match expression '^(?:[\\w.\\\\\\/:]+)$'\n  in \"/home/tamal/go/src/kmodules.xyz/resource-metadata/app.yaml\", line 3, column 7\n</code></pre>\n\n<pre><code>ERROR: (gcloud.app.deploy) An error occurred while parsing file: [/home/tamal/go/src/kmodules.xyz/resource-metadata/app.yaml]\nUnable to assign value 'kmodules.xyz/resource-metadata/cmd/resource-metadata-server' to attribute 'main':\nValue 'kmodules.xyz/resource-metadata/cmd/resource-metadata-server' for main does not match expression '^(?:[\\w.\\\\\\/:]+)$'\n  in \"/home/tamal/go/src/kmodules.xyz/resource-metadata/app.yaml\", line 2, column 7\n</code></pre>\n\n<p>The problem seems to be that I am not allowed to use <code>-</code> in the <code>main</code> entry in app.yaml. Why is that? Can this be fixed?</p>\n\n<p>I am using </p>\n\n<pre><code>$ gcloud version\nGoogle Cloud SDK 257.0.0\napp-engine-go \napp-engine-python 1.9.86\nbeta 2019.05.17\nbq 2.0.46\ncloud-datastore-emulator 2.1.0\ncore 2019.08.02\ngsutil 4.41\n</code></pre>\n"}, {"tags": ["sqlite", "go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 2980, "user_id": 539684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47fa84d0fb532a1a3ced7275069b0fa5?s=128&d=identicon&r=PG", "display_name": "Crixo", "link": "https://stackoverflow.com/users/539684/crixo"}, "edited": false, "score": 0, "creation_date": 1565645793, "post_id": 57464688, "comment_id": 101410138, "body": "Thanks @sberry! Just to make sure I fully understood the scenario (Sorry but I&#39;m a go newbie). I could place the snippet gorm.NowFunc... into my app main to make sure it will be always applied or also call db.SetNowFuncOverride(myNowFunc) just after I created my gorm.DB always into my main (I create the gorm.DB in main and I&#39;ll inject as dependency into all my sub classes)"}, {"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "reply_to_user": {"reputation": 2980, "user_id": 539684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47fa84d0fb532a1a3ced7275069b0fa5?s=128&d=identicon&r=PG", "display_name": "Crixo", "link": "https://stackoverflow.com/users/539684/crixo"}, "edited": false, "score": 0, "creation_date": 1565676694, "post_id": 57464688, "comment_id": 101416288, "body": "@Crixo Yes, exactly!  I hadn&#39;t even seen the <code>SetNowFuncOverride</code>."}], "tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": true, "score": 0, "last_activity_date": 1565626368, "creation_date": 1565626368, "answer_id": 57464688, "question_id": 57464598, "link": "https://stackoverflow.com/questions/57464598/gorm-model-timezone-configuration-using-sqlite/57464688#57464688", "title": "gorm.Model timezone configuration using sqlite", "body": "<p>If you read a bit into the code, you will see that the <code>delted_at</code>, <code>created_at</code>, and <code>updated_at</code> fields are controlled by the function <code>gorm.NowFunc</code> <a href=\"https://github.com/jinzhu/gorm/blob/master/utils.go#L20\" rel=\"nofollow noreferrer\">link</a>.</p>\n\n<p>According to the docs:</p>\n\n<pre><code>//    gorm.NowFunc = func() time.Time {\n//      return time.Now().UTC()\n//    }\n</code></pre>\n"}], "owner": {"reputation": 2980, "user_id": 539684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/47fa84d0fb532a1a3ced7275069b0fa5?s=128&d=identicon&r=PG", "display_name": "Crixo", "link": "https://stackoverflow.com/users/539684/crixo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 159, "favorite_count": 0, "accepted_answer_id": 57464688, "answer_count": 1, "score": 0, "last_activity_date": 1565626573, "creation_date": 1565625925, "last_edit_date": 1565626573, "question_id": 57464598, "link": "https://stackoverflow.com/questions/57464598/gorm-model-timezone-configuration-using-sqlite", "title": "gorm.Model timezone configuration using sqlite", "body": "<p>I'm using gorm w/ sqlite. My model includes gorm.Model so gorm handles for me created_at, ... but by default it saves all the auditing dates using the local time  (e.g. \"2019-08-12 17:45:39.356009+02:00\"). Is there a way to force the UTC for the auto generated fields? Is the behaviour based on gorm itself or also on the underlying sql database?</p>\n"}, {"tags": ["go", "testing", "nats.io"], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1565627949, "post_id": 57465020, "comment_id": 101403461, "body": "The NATS server seems to check if it is running in a Go routine: <a href=\"https://github.com/nats-io/nats-server/blob/master/test/test.go#L84\" rel=\"nofollow noreferrer\">github.com/nats-io/nats-server/blob/master/test/test.go#L84</a>"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1565628011, "post_id": 57465020, "comment_id": 101403481, "body": "About opening a bug report: The nats.io team seems to use Stackoverflow for asking questions... so that is what I did: <a href=\"https://nats.io/contributing/#communityhelp\" rel=\"nofollow noreferrer\">nats.io/contributing/#communityhelp</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1565628410, "post_id": 57465020, "comment_id": 101403631, "body": "Not a question, a bug report. And it can&#39;t &quot;check if it is running in a Go routine&quot; - as I indicated in my answer, if such a check were possible it would literally <i>always</i> return <code>true</code>, because <i>everything runs in a goroutine</i>. They&#39;re checking something, but I&#39;m not sure what. What the error text says is complete nonsense."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1565860224, "post_id": 57465020, "comment_id": 101482617, "body": "In this case it seems the error message is indeed bogus. Thx"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1565627787, "creation_date": 1565627787, "answer_id": 57465020, "question_id": 57464569, "link": "https://stackoverflow.com/questions/57464569/unable-to-start-nats-server-in-go-routine-while-testing/57465020#57465020", "title": "&quot;Unable to start NATS Server in Go Routine&quot; while testing", "body": "<p>It likely already starts a server per test. You cannot run things concurrently without a goroutine. The error doesn't really make any sense - anything in Go must be able to run in a goroutine, and in fact everything <em>does</em> run in a goroutine (even <code>main</code>), so it's unclear what they're really trying to say here (I would definitely recommend opening a bug report about it as that error message is <em>terrible</em>). In the meantime, you can keep <code>go test</code> from running concurrently with <code>-parallel 1</code> (as indicated in <code>go help testflag</code>), which might help.</p>\n"}, {"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1565681813, "post_id": 57465538, "comment_id": 101418492, "body": "Added a free port seeking ability to the <code>NewTestConn</code> function and that fixed it. Thanks a lot!"}], "tags": [], "owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "is_accepted": true, "score": 1, "last_activity_date": 1565630331, "creation_date": 1565630331, "answer_id": 57465538, "question_id": 57464569, "link": "https://stackoverflow.com/questions/57464569/unable-to-start-nats-server-in-go-routine-while-testing/57465538#57465538", "title": "&quot;Unable to start NATS Server in Go Routine&quot; while testing", "body": "<p>I suspect the error message:</p>\n\n<pre><code>Unable to start NATS Server in Go Routine\n</code></pre>\n\n<p>is misleading. The part about the Go Routine is likely just an implementation detail of how it tries to start the NATS Server. I suspect the server is failing to start because you have hardcoded your port in the options, and because multiple test packages are likely being run in parallel. Only one of your test packages will be able to bind to the port to start the NATS Server, and all others will fail.</p>\n\n<p>The <a href=\"https://golang.org/cmd/go/#hdr-Testing_flags\" rel=\"nofollow noreferrer\">docs on <code>go test</code> flags</a> say:</p>\n\n<pre><code>-parallel n\n    Allow parallel execution of test functions that call t.Parallel.\n    The value of this flag is the maximum number of tests to run\n    simultaneously; by default, it is set to the value of GOMAXPROCS.\n    Note that -parallel only applies within a single test binary.\n    The 'go test' command may run tests for different packages\n    in parallel as well, according to the setting of the -p flag\n    (see 'go help build').\n</code></pre>\n\n<p>Unless you have parallel tests within your given test suites, which I'll assume you don't, the problem may be different packages running in parallel. Following the clue at the end of the above, let's look at build flags:</p>\n\n<pre><code>-p n\n    the number of programs, such as build commands or\n    test binaries, that can be run in parallel.\n    The default is the number of CPUs available.\n</code></pre>\n\n<p>This is from the <a href=\"https://golang.org/cmd/go/#hdr-Compile_packages_and_dependencies\" rel=\"nofollow noreferrer\">\"Compile packages and dependencies\" docs</a>. Note you can pass build flags <strong>and</strong> test flags to <code>go test</code>:</p>\n\n<pre><code>$ go test -h\nusage: go test [build/test flags] [packages] [build/test flags &amp; test binary flags]\nRun 'go help test' for details.\n</code></pre>\n\n<p>So consider running <code>go test -p 1 ./...</code>. Alternatively, pass options to the <code>RunServer</code> function that allow multiple of them to happen safely in parallel.</p>\n"}, {"tags": [], "owner": {"reputation": 593, "user_id": 9070016, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2UBsC.jpg?s=128&g=1", "display_name": "therealak12", "link": "https://stackoverflow.com/users/9070016/therealak12"}, "is_accepted": false, "score": 0, "last_activity_date": 1613319887, "creation_date": 1613319887, "answer_id": 66197430, "question_id": 57464569, "link": "https://stackoverflow.com/questions/57464569/unable-to-start-nats-server-in-go-routine-while-testing/66197430#66197430", "title": "&quot;Unable to start NATS Server in Go Routine&quot; while testing", "body": "<p>In my case the problem was that I already ran an instance of nats-server so the tests were failing. By stopping the server, tests were passed successfully.</p>\n"}], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 364, "favorite_count": 0, "accepted_answer_id": 57465538, "answer_count": 3, "score": 0, "last_activity_date": 1613319887, "creation_date": 1565625771, "last_edit_date": 1565626230, "question_id": 57464569, "link": "https://stackoverflow.com/questions/57464569/unable-to-start-nats-server-in-go-routine-while-testing", "title": "&quot;Unable to start NATS Server in Go Routine&quot; while testing", "body": "<p>I'm trying to separate tests to use different NATS servers. (I'm not yet sure it is NATS, but my tests influence each other.)</p>\n\n<p>Doing that works fine when running a single test or testing a single package. Running <code>go test ./...</code> on all my packages (as done in CI) I get this error (paths anonymised):</p>\n\n<pre><code>panic: Unable to start NATS Server in Go Routine\n\ngoroutine 1 [running]:\ngithub.com/nats-io/gnatsd/test.RunServer(0xc000163400, 0xc000163400)\n    ./go/pkg/mod/github.com/nats-io/gnatsd@v1.4.1/test/test.go:66 +0xbd\n./lib/msgQueue/nats.NewTestConn(0xc0002adf68, 0x1879e12)\n    ./lib/msgQueue/nats/testconn.go:19 +0x80\n</code></pre>\n\n<p>It seems like Go starts goroutines to run tests in them. Both using <code>TestMain</code> and <code>init</code> in the tests does not solve the problem.</p>\n\n<p>Is it possible to start a server per test without running into the <code>goroutine</code> error? Or is there some lightweight, but functioning in-memory replacement?</p>\n\n<hr>\n\n<p>Here some code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// +build !build\n\npackage myNats\n\nimport (\n    \"fmt\"\n\n    \"github.com/pkg/errors\"\n    \"github.com/nats-io/gnatsd/server\"\n    \"github.com/nats-io/gnatsd/test\"\n    gonats \"github.com/nats-io/go-nats\"\n)\n\ntype Conn struct {\n    db *gonats.Conn\n}\n\nfunc NewTestConn() (conn *Conn, shutdown func()) {\n    opts := server.Options{\n        Host:   \"localhost\",\n        Port:   53347,\n        NoLog:  true,\n        NoSigs: true,\n    }\n    gnatsd := test.RunServer(&amp;opts)\n    if gnatsd == nil {\n        panic(\"could not start NATS test server\")\n    }\n\n    url := fmt.Sprintf(\"nats://%s:%d\", opts.Host, opts.Port)\n    conn, err := open(url)\n    if err != nil {\n        panic(errors.Wrap(err, \"could not connect to test NATS\"))\n    }\n\n    return conn, func() {\n        conn.close()\n        gnatsd.Shutdown()\n    }\n}\n\nfunc open(addr string) (*Conn, error) {\n    // Connect to NATS\n    nc, err := gonats.Connect(addr)\n    if err != nil {\n        return nil, errors.Wrapf(err, \"nats not reachable on %s\", addr)\n    }\n\n    if !nc.IsConnected() {\n        errorMsg := fmt.Errorf(\"could not establish connection to nats-server at: %s\", addr)\n        return nil, errorMsg\n    }\n\n    return &amp;Conn{\n        db: nc,\n    }, nil\n}\n</code></pre>\n\n<p>My goal would be to have a server per test:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestSomeThing(t *testing.T) {\n    conn, shutdown := myNats.NewTestConn()\n    defer shutdown()\n\n    _ = conn\n    // test code here\n}\n</code></pre>\n"}, {"tags": ["arrays", "go", "google-api", "byte", "grpc"], "comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 2, "creation_date": 1565630593, "post_id": 57463983, "comment_id": 101404517, "body": "Remove grpc / protobuf from the problem to start. Try this:  get your presentation doc, gob encode, save to disk.  In another, separate program, read the file from disk, gob decode and see if you have your original data."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 1, "creation_date": 1565646295, "post_id": 57463983, "comment_id": 101410285, "body": "Also be wary of sending a large payload in a single gRPC message. Using a <code>[]byte</code> to send files is tempting - but if the payload is greater than 4MB you&#39;re going to hit client-side limitations. So streaming file-chunks would be the next step in that situation..."}, {"owner": {"reputation": 875, "user_id": 1118461, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WFNAP.png?s=128&g=1", "display_name": "Zed_Blade", "link": "https://stackoverflow.com/users/1118461/zed-blade"}, "reply_to_user": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1565685465, "post_id": 57463983, "comment_id": 101420158, "body": "@colminator yes, I&#39;m aware of the limitations but for this case it&#39;s enough, though, good thinking on the chunk-streaming.. Might as well just setup the application to handle that.."}, {"owner": {"reputation": 875, "user_id": 1118461, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WFNAP.png?s=128&g=1", "display_name": "Zed_Blade", "link": "https://stackoverflow.com/users/1118461/zed-blade"}, "reply_to_user": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1565685505, "post_id": 57463983, "comment_id": 101420179, "body": "@sberry That&#39;s an option yes, thanks."}], "owner": {"reputation": 875, "user_id": 1118461, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/WFNAP.png?s=128&g=1", "display_name": "Zed_Blade", "link": "https://stackoverflow.com/users/1118461/zed-blade"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 966, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565623295, "creation_date": 1565623295, "question_id": 57463983, "link": "https://stackoverflow.com/questions/57463983/go-grpc-bytes-encoding-decoding", "title": "Go gRPC []bytes encoding/decoding", "body": "<p>I'm developing a set of functions (based on KNative Serving + Eventing) and I'm having a lot of problems getting the decoded data on the receiving-end if the stream.</p>\n\n<p>So, I'm implementing a couple of functions that, will use the Google APIs (via <code>google.golang.org/api/slides/v1</code>) to grab a Google Slides Presentation (a <code>struct</code> from the library), encode it as a <code>[]byte</code> and send it over the network with protobuf/gRPC.\nThis appears to be working correctly, however, when I try to decode it back into a <code>Presentation</code> I'm getting an error. Printing out the <code>Decode</code> call returns only <code>EOF</code>.</p>\n\n<p>Here's the proto definition:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage api;\n\nmessage ParserRequest { \n  bytes Presentation = 1;\n}\n\nmessage ParserResponse {\n  int32 Status = 1;\n  bytes Document = 2;\n}\n\nservice ParserService {\n// ParsePresentation parse the Google Slides presentation it into the SDR representation\n  rpc ParsePresentation(ParserRequest) returns (ParserResponse) {}\n}\n</code></pre>\n\n<p>The sending function is similar to:</p>\n\n<pre><code>presentation, err := svc.Presentations.Get(docID).Do()\nif err != nil {\n    log.Fatalf(\"Unable to retrieve data from document: %+v\", err)\n}\n\nif presentation != nil {\n    log.Printf(\"Calling Parser...\")\n\n    address := \"PORT:IP\"\n    conn, err := grpc.DialContext(ctx, address, grpc.WithInsecure())\n    if err != nil {\n        log.Printf(\"Dial Error! %+v\", err)\n        return nil, fmt.Errorf(\"could not connect shipping service: %+v\", err)\n    }\n    defer conn.Close()\n\n    log.Printf(\"Marshalling data...\")\n    // data, err := presentation.MarshalJSON()\n    // data, err := json.Marshal(presentation)\n\n    var buf bytes.Buffer\n    enc := gob.NewEncoder(&amp;buf)\n    err = enc.Encode(&amp;presentation)\n    if err != nil {\n        log.Println(\"Encode Error: %+v\", err)\n        log.Fatal(\"encode error:\", err)\n    }\n    data := buf.Bytes()\n    log.Println(data) //[255 211 255 129 3 1 1 12 ...]\n\n    cli, err := parser.NewParserServiceClient(conn).ParsePresentation(ctx, &amp;parser.ParserRequest{Presentation: data})\n    if err != nil {\n        log.Printf(\"Cli call Error! %+v\", err)\n        return nil, fmt.Errorf(\"failed to get parser service: %+v\", err)\n    }\n    log.Printf(\"Result: %d\", cli.Status)\n}\n</code></pre>\n\n<p>On the other end, I should now decode the <code>data</code> array and \"translate\" back into a <code>Presentation</code> struct, doing so via:</p>\n\n<pre><code>func (c *parserService) ParsePresentation(ctx context.Context, in *pb.ParserRequest) (*pb.ParserResponse, error) {\n    log.Printf(\"ParserService.ParsePresentation was called!\")\n\n    if in.Presentation == nil {\n        log.Fatalf(\"Missing parameter Google Slides document.\")\n    }\n\n    sdrDocument, err := gslides_parser.ParsePresentationBytes(in.Presentation)\n\n    if err != nil {\n        log.Fatalf(\"Unable to parse the Google Slides presentation: %+v\", err)\n    }\n\n    presentation, err := json.Marshal(sdrDocument)\n    return &amp;pb.ParserResponse{Status: 200, Document: presentation}, nil\n}\n</code></pre>\n\n<p>Than, when it gets to the <code>gslides_parser.ParsePresentationBytes(in.Presentation)</code> will then be decoded:</p>\n\n<pre><code>func ParsePresentationBytes(presentationParam []byte) (sdr.Document, error) {\n\n    var (\n        document     sdr.Document\n        presentation slides.Presentation\n    )\n\n    log.Printf(\"PresentationBytes gob decoder\")\n    log.Println(presentationParam) // Output: [255 211 255 129 3 1 1 12 ...]\n    // err := json.Unmarshal(presentationParam, &amp;presentation)\n\n    buf := bytes.NewBuffer(presentationParam)\n    log.Printf(\"New decoder...\")\n    dec := gob.NewDecoder(buf)\n    log.Printf(\"Decode...\")\n    log.Println(&amp;presentation) // Output: &amp;{[]  [] &lt;nil&gt; &lt;nil&gt;   []  {0 map[]} [] []}\n    err := dec.Decode(&amp;presentation)\n    log.Printf(\"Done decoding...\")\n\n    if err != nil {\n        // Never gets here\n        document = sdr.Document{}\n        (...)\n    } else {\n        log.Printf(\"PresentationBytes Error!\")\n    }\n\n    return document, nil\n}\n</code></pre>\n\n<p>So, why can't I decode the information? I don't see anything terribly wrong with this code, but I'm also a golang newb so I may have some error that is eluding me.\nIsn't gob the appropriate way of dealing with this? I tried simply marshalling/unmarshalling but that also produces errors.</p>\n"}, {"tags": ["go", "flutter", "dart", "protocol-buffers", "grpc"], "owner": {"reputation": 741, "user_id": 9210252, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5a7278056c0a66272dddde5c8d2fcd03?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian Coutsoftides", "link": "https://stackoverflow.com/users/9210252/adrian-coutsoftides"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 764, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1565622195, "creation_date": 1565619398, "last_edit_date": 1565622195, "question_id": 57462917, "link": "https://stackoverflow.com/questions/57462917/flutter-error-decoding-protobuf-response-from-golang-grpc-server", "title": "Flutter error decoding protobuf response from golang grpc server", "body": "<p>I've implemented a simple unary <code>gRPC</code> server in <code>golang</code> and I'm connecting to it from my phone over my local WAN with <code>flutter</code>.</p>\n\n<p>The protobuf request is just an <code>int64</code> timestamp and the response is a single message <code>LoadResponse</code> that contains an <strong>array of messages</strong> of type <code>Load</code>.</p>\n\n<p>The server is receiving the request perfectly and appears to be returning a response however flutter is having difficulty interpreting it and the error messages are not helpful:</p>\n\n<p>I get 2 messages from flutter, one in <strong>debug</strong> and one <strong>onscreen</strong>:</p>\n\n<h1>Debug:</h1>\n\n<p><code>InvalidProtocolBufferException: While parsing a protocol message, the input ended unexpectedly\nin the middle of a field.  This could mean either than the\ninput has been truncated or that an embedded message\nmisreported its own length.</code></p>\n\n<h1>OnScreen</h1>\n\n<p><code>gRPC Error(12, No responses received)</code></p>\n\n<p>Firstly, I don't know which error is accurate and neither make sense. The server is definitely receiving the request and returning a response. This implies that the service is recognised successfully so the <code>gRPC status code 12</code> error appears to be a false alarm. </p>\n\n<p>Otherwise the debug message doesn't allude to what my problem could be. In my flutter code I used a <code>FutureBuilder&lt;LoadResponse&gt;</code> to load this response (as it is a unary call) but perhaps I need a <code>StreamBuilder</code> instead because it contains an array of messages?</p>\n\n<h1>Code:</h1>\n\n<h1>lambda.proto</h1>\n\n<pre class=\"lang-proto prettyprint-override\"><code>syntax= \"proto3\";\npackage client;\noption go_package=\"lambdapb\";\n\nmessage Timestamp{\n    int64 timestamp = 1;\n}\n\nmessage LoadRequest{\n    Timestamp timestamp = 1;\n}\n\nservice LoadService{\n    rpc Load(LoadRequest) returns (LoadResponse){};\n}\n\nmessage Load {\n    string deliverydate = 1;\n    double splitnumber = 2;\n    string temperature = 3;\n    string firstname = 4;\n    string loaddate = 5;\n    double id = 6;\n    double weight = 7;\n    string ponumber = 8;\n    string tsize = 9;\n    string phone = 10;\n    string equipment = 11;\n    string ext = 12;\n    double miles = 13;\n    string lastname = 14;\n  }\n\nmessage LoadResponse{\n    repeated Load loads = 1;\n}\n\n</code></pre>\n\n<h1>main.go (server)</h1>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"context\"\n    \"crypto/tls\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"legion_server/lambdapb\"\n    \"log\"\n    \"net\"\n    \"net/http\"\n    \"net/url\"\n    \"strings\"\n    \"time\"\n\n    \"google.golang.org/grpc\"\n)\n\nvar tlsConf = &amp;http.Transport{\n    TLSClientConfig: &amp;tls.Config{\n        Renegotiation: tls.RenegotiateOnceAsClient,\n    },\n}\n\nvar client = &amp;http.Client{\n    Timeout:   time.Duration(5 * time.Second),\n    Transport: tlsConf,\n}\n\nfunc (*server) Load(ctx context.Context, req *lambdapb.LoadRequest) (*lambdapb.LoadResponse, error) {\n    timestamp := req.GetTimestamp().GetTimestamp()\n    fmt.Println(timestamp)\n    unixTime, err := time.Unix(timestamp, 0).MarshalText()\n    if err != nil {\n        fmt.Printf(\"Error converting timestamp to RFC 3339: %v\", err)\n    }\n    data := pullNewLoads(string(unixTime))\n    response := &amp;lambdapb.LoadResponse{\n        Loads: data,\n    }\n    fmt.Println(response)\n    return response, nil\n}\n\ntype server struct{}\n\nfunc main() {\n\n    listen, err := net.Listen(\"tcp\", \"0.0.0.0:50051\")\n    if err != nil {\n        log.Fatalf(\"Failed to listen %v\", err)\n    }\n\n    serv := grpc.NewServer()\n    lambdapb.RegisterLoadServiceServer(serv, &amp;server{})\n    if err := serv.Serve(listen); err != nil {\n        log.Fatalf(\"Failed to server: %v\", err)\n    }\n\n}\n\nfunc pullNewLoads(timestamp string) []*lambdapb.Load {\n\n    formData := url.Values{\n        \"top\":   {\"10\"},\n        \"lDate\": {timestamp},\n    }\n\n    req, err := http.NewRequest(\"POST\", \"https://api.*********.com/AppAvailLoads?\", strings.NewReader(formData.Encode()))\n    if err != nil {\n        fmt.Println(\"Error creating request\")\n    }\n\n    req.Header.Add(\"x-cdata-authtoken\", \"************\")\n    req.Header.Add(\"content-type\", \"application/x-www-form-urlencoded\")\n\n    resp, err := client.Do(req)\n\n    if err != nil {\n        fmt.Println(\"Error in request\")\n        fmt.Println(err)\n    }\n\n    defer resp.Body.Close() // defer only calls body.close() when pullNewLoads() returns\n\n    bodyBytes, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    var data map[string]interface{}\n\n    if err := json.Unmarshal(bodyBytes, &amp;data); err != nil {\n        fmt.Println(\"Error decoding json\")\n    }\n    values, err := json.Marshal(data[\"value\"].([]interface{}))\n    if err != nil {\n        log.Fatal(err)\n    }\n    var results []*lambdapb.Load\n\n    if err := json.Unmarshal(values, &amp;results); err != nil {\n        fmt.Printf(\"Error unmarshalling into struct %v\", err)\n    }\n\n    return results\n}\n\n</code></pre>\n\n<h1>Flutter:</h1>\n\n<h1>load_service.dart</h1>\n\n<pre class=\"lang-dart prettyprint-override\"><code>import 'package:Lambda/proto/lambdapb/lambda.pbgrpc.dart';\nimport 'package:fixnum/fixnum.dart';\nimport 'package:grpc/grpc.dart';\n\nclass LoadService {\n  static LoadServiceClient client;\n\n  LoadService(){\n    client = LoadServiceClient(ClientChannel(\n      \"192.168.1.87\",\n      port: 50051,\n      options: ChannelOptions(credentials: ChannelCredentials.insecure())\n    ));\n  }\n  Timestamp generateTimestamp(){\n    Timestamp timestamp = new Timestamp();\n    timestamp.setField(1, Int64((DateTime.now().subtract(Duration(days: 365)).millisecondsSinceEpoch / 1000).round()));\n    return timestamp;\n  }\n\n  Future&lt;LoadResponse&gt; getNewLoads(){\n    print('Starting request');\n    LoadRequest request = LoadRequest();\n    request.setField(1, generateTimestamp());\n    print('field set, waiting');\n    return client.load(request);\n  }\n}\n</code></pre>\n\n<h1>Screen:</h1>\n\n<pre class=\"lang-dart prettyprint-override\"><code>class RoleSelect extends StatefulWidget {\n  LoadService api;\n  RoleSelect({Key key}){\n    api = new LoadService();\n  }\n\n  _RoleSelectState createState() =&gt; _RoleSelectState();\n}\n// more code\n Widget build(BuildContext context) {\nreturn Center(\n                  child: FutureBuilder&lt;LoadResponse&gt;(\n            future: this.widget.api.getNewLoads(),\n            builder: (BuildContext context, snapshot){\n              if(snapshot.hasData){\n                print(snapshot.data.getField(1));\n                return Text(\"Response received\");\n              } else if (snapshot.hasError) {\n                return Text(snapshot.error.toString());\n              } else {\n                return Text(snapshot.connectionState.toString());\n              }\n            },\n          ),\n        )\n}\n</code></pre>\n\n<h1>Edit 1:</h1>\n\n<p>The service works fine when I return a <code>string</code> instead of <code>repeated Load loads</code>, it appears as though the dart code is having an error unpacking the array?</p>\n"}, {"tags": ["go", "proxy", "chromedp"], "comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 2, "creation_date": 1565611897, "post_id": 57460884, "comment_id": 101395171, "body": "it won&#39;t be that simple to avoid captcha because of the captcha is to prevent bots like yours. Why do you want to do that?"}, {"owner": {"reputation": 17, "user_id": 11902179, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xbXlsKkXapg/AAAAAAAAAAI/AAAAAAAAtiM/XgBXsuMOQ1w/photo.jpg?sz=128", "display_name": "SAJIKUMAR j s", "link": "https://stackoverflow.com/users/11902179/sajikumar-j-s"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1565613070, "post_id": 57460884, "comment_id": 101395773, "body": "@kabanek i undestand that. So i just need to pass proxy with chromedp. so is there a way to add proxy with chromedp"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565615512, "post_id": 57460884, "comment_id": 101397042, "body": "What&#39;s your question about adding a proxy?"}, {"owner": {"reputation": 17, "user_id": 11902179, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xbXlsKkXapg/AAAAAAAAAAI/AAAAAAAAtiM/XgBXsuMOQ1w/photo.jpg?sz=128", "display_name": "SAJIKUMAR j s", "link": "https://stackoverflow.com/users/11902179/sajikumar-j-s"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565670996, "post_id": 57460884, "comment_id": 101414777, "body": "@Adrian How to use proxy with chromedp in golang???"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565702743, "post_id": 57460884, "comment_id": 101429051, "body": "Using <code>chromedp.ProxyServer</code>, which you already have in your question, so it&#39;s not clear what you&#39;re asking. Can you show your code?"}, {"owner": {"reputation": 17, "user_id": 11902179, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xbXlsKkXapg/AAAAAAAAAAI/AAAAAAAAtiM/XgBXsuMOQ1w/photo.jpg?sz=128", "display_name": "SAJIKUMAR j s", "link": "https://stackoverflow.com/users/11902179/sajikumar-j-s"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566275434, "post_id": 57460884, "comment_id": 101594545, "body": "@Adrian Can you please check now, i tries <code>chromedp.ProxyServer</code> it, but not working for me."}], "answers": [{"tags": [], "owner": {"reputation": 372, "user_id": 880760, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/7af3c2bbcdca79069f2c3a2c5f3ea3d7?s=128&d=identicon&r=PG", "display_name": "Vishnu V", "link": "https://stackoverflow.com/users/880760/vishnu-v"}, "is_accepted": true, "score": 2, "last_activity_date": 1566455747, "creation_date": 1566455747, "answer_id": 57603287, "question_id": 57460884, "link": "https://stackoverflow.com/questions/57460884/how-to-us-proxy-with-chromedp/57603287#57603287", "title": "How to us proxy with chromedp", "body": "<p>Check this <a href=\"https://stackoverflow.com/a/57595751/880760\">answer</a></p>\n\n<pre><code>o := append(chromedp.DefaultExecAllocatorOptions[:],\n  //... any options here\n  chromedp.ProxyServer(\"http://username:password@proxyserver.com:31280\"), \n)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 11902179, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-xbXlsKkXapg/AAAAAAAAAAI/AAAAAAAAtiM/XgBXsuMOQ1w/photo.jpg?sz=128", "display_name": "SAJIKUMAR j s", "link": "https://stackoverflow.com/users/11902179/sajikumar-j-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1013, "favorite_count": 1, "accepted_answer_id": 57603287, "answer_count": 1, "score": -2, "last_activity_date": 1617819319, "creation_date": 1565611557, "last_edit_date": 1571731472, "question_id": 57460884, "link": "https://stackoverflow.com/questions/57460884/how-to-us-proxy-with-chromedp", "title": "How to us proxy with chromedp", "body": "<p>I want to take screenshot of (thousands of pages) of website like Amazon. I tried some code but getting captcha or traffic error in screenshot. So I want to add proxy with chromedp.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>ctx, cancel := chromedp.NewContext(context.Background())\ndefer cancel()\nchromedp.ProxyServer(\"http://username:password@proxyserver.com:31280\")\nchromedp.Run(ctx,\n        chromedp.Navigate(\"http://wtfismyip.com\"),\n        chromedp.Sleep(3*time.Second),\n        chromedp.ActionFunc(func(ctxt context.Context) error {\n            _, _, contentRect, err := page.GetLayoutMetrics().Do(ctxt)\n            v := page.Viewport{\n                X:      contentRect.X,\n                Y:      contentRect.Y,\n                Width:  contentRect.Width,\n                Height: contentRect.Height,\n                Scale:  1,\n            }\n            buf, err := page.CaptureScreenshot().WithClip(&amp;v).Do(ctxt)\n            log.Printf(\"Write %v\", \"/tmp/ss.png\")\n            ioutil.WriteFile(\"/tmp/ss.png\", buf, 0644)\n            return err\n        }))\n</code></pre>\n\n<p>Tried this as well but not working.</p>\n"}, {"tags": ["go", "aws-api-gateway", "serverless-framework", "serverless"], "comments": [{"owner": {"reputation": 573, "user_id": 7792934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7750267565c576fe30290043ca719936?s=128&d=identicon&r=PG&f=1", "display_name": "D. Pinheiro", "link": "https://stackoverflow.com/users/7792934/d-pinheiro"}, "edited": false, "score": 1, "creation_date": 1566217795, "post_id": 57460037, "comment_id": 101575227, "body": "<a href=\"https://github.com/dherault/serverless-offline/issues/775\" rel=\"nofollow noreferrer\">github.com/dherault/serverless-offline/issues/775</a> As stated here in this link, this is already a known issue of the plugin that resulted in a Go Lang incompatibility and for this reason Go Lang was taken from the Readme."}, {"owner": {"reputation": 5580, "user_id": 26685, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/51bde710f2efaa9597f5f264937a8967?s=128&d=identicon&r=PG", "display_name": "schmoopy", "link": "https://stackoverflow.com/users/26685/schmoopy"}, "edited": false, "score": 0, "creation_date": 1574464817, "post_id": 57460037, "comment_id": 104256247, "body": "Yea, too bad too :-("}], "owner": {"reputation": 573, "user_id": 7792934, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/7750267565c576fe30290043ca719936?s=128&d=identicon&r=PG&f=1", "display_name": "D. Pinheiro", "link": "https://stackoverflow.com/users/7792934/d-pinheiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 821, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1565608068, "creation_date": 1565608068, "question_id": 57460037, "link": "https://stackoverflow.com/questions/57460037/golang-serverless-offline", "title": "Golang Serverless Offline", "body": "<p>I'm new to the serverless framework and I have some questions: \nI have an APIGateway with Go Lang developed on the Serverless framework and I am trying to get serverless offline to work.\nI already installed the serverless-offline plugin and when I run the sls offline start command everything goes as expected.</p>\n\n<p>When I run the \"Get\" route in the browser, I am getting the following error:</p>\n\n<p><a href=\"https://i.stack.imgur.com/OmfcW.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/OmfcW.png\" alt=\"enter image description here\"></a></p>\n\n<p>My functions config in serverless.yml</p>\n\n<pre><code>functions:\n      getOrders:\n        # The handler property points to the file and module containing the code you want to run in your function.\n        handler: cmd/api/getOrders\n        memorySize: 128 # Memory Size available to function while running\n        description: Get all orders and convert them.\n        events:\n          - http:\n              path: orders\n              method: get\n</code></pre>\n\n<p>My handler:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc getAllOrders(ctx context.Context, request events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n\n        orders := services.GetAllOrders()\n\n        // Success HTTP response\n        body, _ := json.Marshal(&amp;models.ListOrdersResponse{\n            Orders: orders,\n        })\n\n        return events.APIGatewayProxyResponse{\n            Body:       string(body),\n            StatusCode: 200,\n        }, nil\n    }\n\n    func main() {\n        lambda.Start(getAllOrders)\n    }\n</code></pre>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1565609192, "creation_date": 1565609192, "answer_id": 57460318, "question_id": 57460002, "link": "https://stackoverflow.com/questions/57460002/how-to-access-http-client-response-body-global/57460318#57460318", "title": "How to access http client response body global", "body": "<p>In <code>func init()</code> you redeclare variables <code>var Regprofile GMLCInstance</code> locally to function scope. This declaration shadows global variable with local one. Just delete this local declaration inside <code>init()</code>.</p>\n"}], "owner": {"reputation": 25, "user_id": 11712511, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fzWQz8SeL44/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDzW_6DvPt3YLvtpmx0_HOnF0wGg/photo.jpg?sz=128", "display_name": "daniel wilson", "link": "https://stackoverflow.com/users/11712511/daniel-wilson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "closed_date": 1565724191, "accepted_answer_id": 57460318, "answer_count": 1, "score": -1, "last_activity_date": 1565609192, "creation_date": 1565607887, "question_id": 57460002, "link": "https://stackoverflow.com/questions/57460002/how-to-access-http-client-response-body-global", "closed_reason": "Not suitable for this site", "title": "How to access http client response body global", "body": "<p>In the code below, am trying to access the variable \"Regprofile\" as global variable but and getting empty output. Any help?</p>\n\n<pre><code>type GMLCInstance struct {\n    NfInstanceID   string   `json:\"nfInstanceID\"`\n    HeartBeatTimer int      `json:\"heartBeatTimer\"`\n    NfType         []string `json:\"nfType\"`\n    NfStatus       []string `json:\"nfStatus\"`\n    Ipv4Addresses  []string `json:\"ipv4Addresses\"`\n}\n\n\nvar Regprofile GMLCInstance\n\n\n// Request credentials and token from NRF and register profile to NFR database\nfunc init() {\n\n    urlcred := \"https://127.0.0.1:9090/credentials\"\n\n    // Perform the request\n    resp, err := netClient.Get(urlcred)\n    if err != nil {\n        log.Fatalf(\"Failed get: %s\", err)\n    }\n    defer resp.Body.Close()\n\n    // Fill the record with the data from the JSON\n    var cr Credential\n\n    // Use json.Decode for reading streams of JSON data\n    if err := json.NewDecoder(resp.Body).Decode(&amp;cr); err != nil {\n        log.Println(err)\n    }\n\n    //fmt.Println(cr)\n\n    clientId := cr.CLIENTID\n    clientsec := cr.CLIENTSECRET\n\n    // Get token\n\n    reqtoken := url.Values{\n        \"grant_type\":    []string{\"client_credentials\"},\n        \"client_id\":     []string{clientId},\n        \"client_secret\": []string{clientsec},\n        \"scope\":         []string{\"GMLC\"},\n    }\n\n    urlq := \"https://127.0.0.1:9090/oauth2/token?\"\n\n    res, err := netClient.PostForm(urlq+reqtoken.Encode(), nil)\n    if err != nil {\n        log.Fatalf(\"Failed get: %s\", err)\n    }\n\n\n    var auth AccessToken\n\n    // Use json.Decode for reading streams of JSON data\n    if err := json.NewDecoder(res.Body).Decode(&amp;auth); err != nil {\n        log.Println(err)\n    }\n\n    //fmt.Println(auth.AccessToken)\n\n    token := auth.AccessToken\n\n    para := url.Values{\n        \"access_token\": []string{token},\n    }\n\n    //============================================================\n    // Register GMLC Instance to NRF, PUT\n\n    var gmlc = []byte(`{\n                \"nfInstanceID\": \"f81d4fae-7dec-11d0-a765-00a0c91egmlc\",\n                \"heartBeatTimer\": 0,\n                \"nfType\": [\"GMLC\"],\n                \"nfStatus\": [\"string\"],\n                \"ipv4Addresses\": [\"172.16.0.X:5000\"]\n               }`)\n\n    //================= Registser profile to NRF ========================//\n    postnrf := \"https://127.0.0.1:9090/nnrf-nfm/v1/nf-instances/f81d4fae-7dec-11d0-a765-00a0c91egmlc?\"\n    rq, err := http.NewRequest(\"PUT\", postnrf+para.Encode(), bytes.NewBuffer(gmlc))\n    rq.Header.Set(\"Content-Type\", \"application/json\")\n    rq.Header.Set(\"Accept\", \"application/json\")\n\n    response, err := netClient.Do(rq)\n    if err != nil {\n        panic(err)\n    }\n    defer res.Body.Close()\n\n    decoder := json.NewDecoder(response.Body)\n\n    var Regprofile GMLCInstance\n\n    err = decoder.Decode(&amp;Regprofile)\n    if err != nil {\n        fmt.Println(\"Response body not well decoded\")\n    }\n\n    fmt.Println(Regprofile)\n\n}\n</code></pre>\n\n<p>The output of fmt.Println(Regprofile) gives\n{f81d4fae-7dec-11d0-a765-00a0c91egmlc 10 [GMLC] [REGISTERED] [172.16.0.X:5000]}</p>\n\n<p>However, when i print the variable in for example main as</p>\n\n<pre><code>func main(){\n\nfmt.Println(Regprofile)\n\n}\n</code></pre>\n\n<p>I get empty data as \n{ 0 [] [] []}</p>\n"}, {"tags": ["bash", "opencv", "go", "openvino"], "comments": [{"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1565612036, "post_id": 57459877, "comment_id": 101395239, "body": "my first thought - try with the absolute path"}, {"owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 0, "creation_date": 1565616945, "post_id": 57459877, "comment_id": 101397857, "body": "Already did. Does not work."}], "answers": [{"comments": [{"owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 0, "creation_date": 1567620663, "post_id": 57741519, "comment_id": 102020688, "body": "I am sorry for late response. Are you saying that installing recent version of OPENVINO will fix the issue? Because in this guide I see you had to workaround it a lot and still did not find adequate solution, correct?"}, {"owner": {"reputation": 26, "user_id": 5021812, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vdf6QLZY1tM/AAAAAAAAAAI/AAAAAAAAATQ/Caegh1XdQCQ/photo.jpg?sz=128", "display_name": "Seongjun Kim", "link": "https://stackoverflow.com/users/5021812/seongjun-kim"}, "reply_to_user": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 1, "creation_date": 1567710413, "post_id": 57741519, "comment_id": 102054560, "body": "@StefanRadonjic, Opposite. As my comment as you can see there (<a href=\"https://github.com/hybridgroup/gocv/issues/491#issuecomment-516607015\" rel=\"nofollow noreferrer\">github.com/hybridgroup/gocv/issues/491#issuecomment-5166070&zwnj;&#8203;15</a>), the latest version of OpenVINO doesn&#39;t support PVL, which offers some feature for GoCV so that we cannot really use GoCV with OpenVINO anymore."}, {"owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 0, "creation_date": 1567793166, "post_id": 57741519, "comment_id": 102083718, "body": "Aha, I understand. So in order to us GoCv with OpenVino I just have to follow your instructions on the issue and avoid using the latest version? Thank you for yur help btw."}, {"owner": {"reputation": 26, "user_id": 5021812, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vdf6QLZY1tM/AAAAAAAAAAI/AAAAAAAAATQ/Caegh1XdQCQ/photo.jpg?sz=128", "display_name": "Seongjun Kim", "link": "https://stackoverflow.com/users/5021812/seongjun-kim"}, "reply_to_user": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 1, "creation_date": 1567797183, "post_id": 57741519, "comment_id": 102085037, "body": "@StefanRadonjic, Mostlikely, openvino_2019.1.144 would work because that version generates <b>libopencv_pvl.so</b> and you can just follow the normal instruction intriduced in GoCV&#39;s website."}, {"owner": {"reputation": 26, "user_id": 5021812, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vdf6QLZY1tM/AAAAAAAAAAI/AAAAAAAAATQ/Caegh1XdQCQ/photo.jpg?sz=128", "display_name": "Seongjun Kim", "link": "https://stackoverflow.com/users/5021812/seongjun-kim"}, "reply_to_user": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "edited": false, "score": 0, "creation_date": 1572384639, "post_id": 57741519, "comment_id": 103541113, "body": "@StefanRadonjic, It seems like GoCV and OpenVino started working together again (though I didn&#39;t check it yet). Please check this out <a href=\"https://github.com/hybridgroup/gocv/commit/9faa6a86b25221c0195d775a6b516f973b760179#diff-864a6fce7f45a0c59a4b6b029a0fd78e\" rel=\"nofollow noreferrer\">github.com/hybridgroup/gocv/commit/&hellip;</a>"}], "tags": [], "owner": {"reputation": 26, "user_id": 5021812, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-vdf6QLZY1tM/AAAAAAAAAAI/AAAAAAAAATQ/Caegh1XdQCQ/photo.jpg?sz=128", "display_name": "Seongjun Kim", "link": "https://stackoverflow.com/users/5021812/seongjun-kim"}, "is_accepted": true, "score": 1, "last_activity_date": 1582658690, "last_edit_date": 1582658690, "creation_date": 1567284710, "answer_id": 57741519, "question_id": 57459877, "link": "https://stackoverflow.com/questions/57459877/running-go-program-which-uses-openvino-opencv-usr-bin-ld-cannot-find-lxxx/57741519#57741519", "title": "Running Go Program which uses OpenVINO &amp; OpenCV - /usr/bin/ld: cannot find -lXXX", "body": "<h2>Updated (Feb/25/2020)</h2>\n\n<p>As of 2019 R3.334, OpenVINO SDK started supporting GoCV again.</p>\n\n<hr>\n\n<p><br/><br/></p>\n\n<h2>Old message</h2>\n\n<p>Check this out:</p>\n\n<p><a href=\"https://github.com/hybridgroup/gocv/issues/491\" rel=\"nofollow noreferrer\">https://github.com/hybridgroup/gocv/issues/491</a></p>\n\n<p>The recent version of openvino dropped the support of pvl so that there is no libpvl or something like that.</p>\n\n<p>You can try one older version of it but there is no future.</p>\n"}], "owner": {"reputation": 905, "user_id": 8560600, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-zQ0B8tCv38k/AAAAAAAAAAI/AAAAAAAAAAw/bWWd0qZVS8I/photo.jpg?sz=128", "display_name": "Stefan Radonjic", "link": "https://stackoverflow.com/users/8560600/stefan-radonjic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 57741519, "answer_count": 1, "score": 0, "last_activity_date": 1582658690, "creation_date": 1565607266, "question_id": 57459877, "link": "https://stackoverflow.com/questions/57459877/running-go-program-which-uses-openvino-opencv-usr-bin-ld-cannot-find-lxxx", "title": "Running Go Program which uses OpenVINO &amp; OpenCV - /usr/bin/ld: cannot find -lXXX", "body": "<p>I am trying to write a program in Go Programming Language that is using OpenVINO DNN models in order to perform inference. In order to do that I've followed instructions from this GITHUB link: <a href=\"https://github.com/hybridgroup/gocv/tree/master/openvino\" rel=\"nofollow noreferrer\">https://github.com/hybridgroup/gocv/tree/master/openvino</a></p>\n\n<p>I have installed OpenVINO and 3rd party libraries that go with it, this includes OpenCV which is located in <code>~/intel/openvino_{version}/opencv</code> directory.</p>\n\n<p>Thing is whenever I try to execute following command: </p>\n\n<pre><code>go run -tags openvino ./cmd/version/main.go\n</code></pre>\n\n<p>I get this output:</p>\n\n<pre><code> runtime/cgo\n/usr/bin/ld: cannot find -lHeteroPlugin\n/usr/bin/ld: cannot find -lMKLDNNPlugin\n/usr/bin/ld: cannot find -lmyriadPlugin\n/usr/bin/ld: cannot find -linference_engine\n/usr/bin/ld: cannot find -lclDNNPlugin\n/usr/bin/ld: cannot find -lopencv_pvl\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>So I tried to set my <strong>CGO_LDFLAGS</strong> like this:</p>\n\n<pre><code>CGO_LDFLAGS=-L/opencv/lib -L/deployment_tools/inference_engine/lib/intel64 -lpthread -ldl -ldliaPlugin -lHeteroPlugin -lMKLDNNPlugin -lmyriadPlugin -linference_engine -lclDNNPlugin -lopencv_core -lopencv_pvl -lopencv_videoio -lopencv_imgproc -lopencv_highgui -lopencv_imgcodecs -lopencv_objdetect -lopencv_features2d -lopencv_video -lopencv_dnn -lopencv_calib3d\n</code></pre>\n\n<p>But when I do that I am getting:</p>\n\n<pre><code>bash: -L/deployment_tools/inference_engine/lib/intel64: No such file or directory\n</code></pre>\n\n<p>Even though <code>~/intel/openvino/deployment_tools/inference_engine/lib/intel64</code> does exitst on my system.</p>\n"}, {"tags": ["go", "gota"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1565601609, "post_id": 57458294, "comment_id": 101390453, "body": "In short: You cannot. See <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">golang.org/doc/faq#convert_slice_of_interface</a>"}, {"owner": {"reputation": 2201, "user_id": 3359432, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/5d48edbf794415b7f16c19c50d8cc524?s=128&d=identicon&r=PG&f=1", "display_name": "Nidhin David", "link": "https://stackoverflow.com/users/3359432/nidhin-david"}, "edited": false, "score": 0, "creation_date": 1565629014, "post_id": 57458294, "comment_id": 101403886, "body": "iterate and reassign??"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 10168778, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nfJmzIk80J8/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7oiOrWXjc2z3wqaPl0Drfl_33BiLQ/mo/photo.jpg?sz=128", "display_name": "youze liang", "link": "https://stackoverflow.com/users/10168778/youze-liang"}, "is_accepted": false, "score": 0, "last_activity_date": 1565691227, "last_edit_date": 1565691227, "creation_date": 1565688990, "answer_id": 57474977, "question_id": 57458294, "link": "https://stackoverflow.com/questions/57458294/convert-mapstringstring-to-mapstringinterface/57474977#57474977", "title": "Convert map[string][]string to []map[string]interface{}", "body": "<p>you could convert <code>map[string][]string</code>  to <code>map[string]interface{}</code> , then use append method to <code>[]map[string]interface{}</code></p>\n"}], "owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 103, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1565691227, "creation_date": 1565600638, "last_edit_date": 1565603337, "question_id": 57458294, "link": "https://stackoverflow.com/questions/57458294/convert-mapstringstring-to-mapstringinterface", "title": "Convert map[string][]string to []map[string]interface{}", "body": "<p>I have a tmp variable whose type is map[string][]string and I want to use LoadMaps feature of gota daraframe. But it only accepts []map[string]interface{}.\nNow I want to find a way to convert map[string][]string to []map[string]interface{}.</p>\n\n<pre><code>func main() {\n    input := [][]string{\n            []string{\"b\", \"3\", \"abc\", \"5.3\"},\n            []string{\"a\", \"4\", \"efg\", \"9.1\"},\n            []string{\"b\", \"4\", \"abc\", \"5.3\"},\n            []string{\"c\", \"3\", \"hij\", \"5.5\"},\n            []string{\"a\", \"2\", \"abc\", \"9.2\"},\n    }\n\n    tmp := map[string][]string{}\n    for _, slice := range input {\n        if len(slice) &lt;= 1 {\n            continue\n        }\n        //fmt.Println(slice)\n        tmp[slice[2]] = append(tmp[slice[2]], slice[0:2]...)\n        fmt.Println(reflect.TypeOf(tmp))\n    }\n\n\n    df := dataframe.LoadMaps(tmp)\n\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1565601646, "post_id": 57457935, "comment_id": 101390473, "body": "strings are immutable in Go, so there is no &quot;modification&quot; of string values in go. You can change the value stored in a variable but that&#39;s not the same."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565601822, "post_id": 57457935, "comment_id": 101390541, "body": "@mkopriva, I understand that is is immutable other than append operation. Please refer to the code, both s and t are sharing the same underlying data at the beginning, but later on, t will become a separate copy, so is it true that Go copies the string when u attempt to modify the underlying data?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565602104, "post_id": 57457935, "comment_id": 101390682, "body": "&quot;no new string is being created&quot; - source for this assertion?"}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565602104, "post_id": 57457935, "comment_id": 101390683, "body": "@mkopriva, that is not true, when we assign s to t, they are in fact pointing to the same address which holds the string data."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565602177, "post_id": 57457935, "comment_id": 101390720, "body": "@Mox yes? explain this then <a href=\"https://play.golang.com/p/-3d-x_LiT4U\" rel=\"nofollow noreferrer\">play.golang.com/p/-3d-x_LiT4U</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1565602210, "post_id": 57457935, "comment_id": 101390741, "body": "@Mox: You are wrong and mkopriva is right."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565602304, "post_id": 57457935, "comment_id": 101390797, "body": "@mkopriva, what u r printing are the address of the 2 variable, it does not mean they are not pointing to the same memory space. And it is precisely that they are immutable, u can have 2 strings pointing to the same address without any problem."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565602318, "post_id": 57457935, "comment_id": 101390804, "body": "@SergioTulentsev, oh thanks for pointing out that mistake."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565603876, "post_id": 57457935, "comment_id": 101391596, "body": "@Mox you&#39;re right, my bad. The two variables do indeed point to the same data. However, it still stands, that any kind of attempt at &quot;modification&quot; of that data (e.g. <code>a += b</code>, etc.) creates a new string, at a new place in memory. <a href=\"https://play.golang.com/p/tiJX6BL-ogJ\" rel=\"nofollow noreferrer\">play.golang.com/p/tiJX6BL-ogJ</a>"}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565603991, "post_id": 57457935, "comment_id": 101391649, "body": "@mkopriva, yes that is why by definition, it is called copy on write. there is a similar example on <a href=\"https://en.wikipedia.org/wiki/Copy-on-write\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Copy-on-write</a>. The reason why i reposted this question because the answer to the old question failed to answer it."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1565604103, "post_id": 57457935, "comment_id": 101391700, "body": "actually, i m looking for an answer that points to the internal implementation when a given golang string is modified."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565604419, "post_id": 57457935, "comment_id": 101391826, "body": "@Mox but how can you modify something that&#39;s immutable? Are you specifically looking for the implementation of <code>+=</code> when the operands are strings?"}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565604454, "post_id": 57457935, "comment_id": 101391835, "body": "@mkopriva, a friend of mine shared this link <a href=\"https://en.wikipedia.org/wiki/Immutable_object#Copy-on-write\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Immutable_object#Copy-on-write</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565615873, "post_id": 57457935, "comment_id": 101397217, "body": "&quot;internal implementation when a given golang string is modified&quot; doesn&#39;t exist. Strings are immutable. Therefore, there is zero code dedicated to mutating them, by definition. When you <code>s += &quot;foo&quot;</code>, a <i>new string</i> is created which is the concatenation of the old value with <code>&quot;foo&quot;</code>, and that <i>new string</i> is stored into <code>s</code>, replacing the previous value."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565616080, "post_id": 57457935, "comment_id": 101397353, "body": "@Adrian that means golang implements copy on write. pls read the wiki links i have shared."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565616232, "post_id": 57457935, "comment_id": 101397450, "body": "You keep bringing up COW and I&#39;m not entirely sure why. If you think you have a better answer than everyone else, you can answer your own question. If you have a question and want answers, that is exactly what the SO community is here for. If you have an opinion and want to engage in a debate, try a forum like Reddit or Google Groups."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565616345, "post_id": 57457935, "comment_id": 101397510, "body": "I have read your link BTW, and it <i>does not describe what happens in Go</i>. The phrase &quot;copy on write&quot; could be construed to describe what I explained in my earlier comment, but &quot;copy-on-write&quot; as a CE concept as described on that WP page is <i>not</i> what is happening here."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565616827, "post_id": 57457935, "comment_id": 101397791, "body": "The title of your question does not mention COW. Per wiki COW: &quot;when a user asks the system to copy an object, it instead merely creates a new reference that still points to the same object. As soon as a user attempts to modify the object through a particular reference, the system makes a real copy, applies the modification to that, and sets the reference to refer to the new copy.&quot; <i>That is not what is happening in Go, <b>nothing</b> is being done automatically or behind the scenes.</i>"}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565617291, "post_id": 57457935, "comment_id": 101398045, "body": "@Adrian that is the behaviour of the code in my question, t shares the same underlying byte data as s. And when it is being \u201cmodified\u201d, a new copy is created. Golang does it automatically."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1565617401, "post_id": 57457935, "comment_id": 101398105, "body": "It doesn&#39;t do it automatically. Your code does it explicitly, as I said in my earlier comment. <code>s += &quot;World&quot;</code> creates a new string and assigns it to the variable <code>s</code>. Nothing automatic, nothing behind the scenes."}], "answers": [{"comments": [{"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1565602448, "post_id": 57458638, "comment_id": 101390882, "body": "therefore Golang implements Copy on write/modification on string, m i rite?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 1, "creation_date": 1565602695, "post_id": 57458638, "comment_id": 101391041, "body": "@Mox: no, this term means something else. You don&#39;t &quot;write&quot; to an existing string here. You explicitly create a new one."}, {"owner": {"reputation": 698, "user_id": 5617424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rmoz.jpg?s=128&g=1", "display_name": "Vane Trajkov", "link": "https://stackoverflow.com/users/5617424/vane-trajkov"}, "edited": false, "score": 1, "creation_date": 1565602722, "post_id": 57458638, "comment_id": 101391052, "body": "Yes, copies the old value and creates new with the modifications made \ud83d\udc4d"}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565602784, "post_id": 57458638, "comment_id": 101391079, "body": "@SergioTulentsev, that is what we called copy on write. <a href=\"https://en.wikipedia.org/wiki/Copy-on-write\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Copy-on-write</a>"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 1, "creation_date": 1565602975, "post_id": 57458638, "comment_id": 101391155, "body": "@mox no. COW involves modifiable shared resources. You don\u2019t have those here."}, {"owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565603050, "post_id": 57458638, "comment_id": 101391188, "body": "@SergioTulentsev, May I point you to the book &quot;Go Programming Language&quot;, Turn to section 3.5 on String. It is clearly explained there."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 1, "creation_date": 1565604336, "post_id": 57458638, "comment_id": 101391789, "body": "@Mox: Yes, let&#39;s it read it, shall we? The very first sentence of the chapter says \u201cA string is an immutable sequence of bytes.\u201d And because it&#39;s immutable, there are no writes. Hence &quot;copy on <b>write</b>&quot; is not applicable. If you want new strings, <i>you</i> have to create them. Not some background COW magic."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1565604409, "post_id": 57458638, "comment_id": 101391822, "body": "@Mox: seeing that you accepted this answer (which says the same thing as me), I&#39;m not sure what you&#39;re arguing about."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "reply_to_user": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "edited": false, "score": 0, "creation_date": 1565604518, "post_id": 57458638, "comment_id": 101391862, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/197813/discussion-between-sergio-tulentsev-and-mox\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 698, "user_id": 5617424, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3rmoz.jpg?s=128&g=1", "display_name": "Vane Trajkov", "link": "https://stackoverflow.com/users/5617424/vane-trajkov"}, "is_accepted": true, "score": 4, "last_activity_date": 1565603651, "last_edit_date": 1565603651, "creation_date": 1565602089, "answer_id": 57458638, "question_id": 57457935, "link": "https://stackoverflow.com/questions/57457935/does-golang-copy-the-string-on-modification-write/57458638#57458638", "title": "Does Golang Copy the String on Modification/Write?", "body": "<p>In Go, string values are <code>read-only</code> byte slices and you cannot change its elements (immutable). Since it is a slice, it means that it has a backing (underlaying) array that has defined capacity. This being said, we can say that string is a data structure that points to a read-only backing array. </p>\n\n<p>Strings are optimized for high reusability and thus read-only. Whenever you modify a string a new string (byte slice) is created in the background which makes it a bit of costly operation. One recommendation is to convert a string to an actual byte slice <code>[]byte(string)</code> and work with bytes or use <a href=\"https://golang.org/pkg/strings/#Builder\" rel=\"nofollow noreferrer\">strings.Builder</a> when your program needs to do a lot of string manipulations.</p>\n\n<pre><code>s := \"Hello\" // backing array for \"hello\" created; `s` points to the backing array\nt := s // `t` a new string structure and points to the same backing array as `s`, \ns += \"World\" // new backing array created for \"HelloWorld\"; `s` points to the new backing array\nt += \"There\" // `t` was still pointing to \"Hello\" and with this operation, a new backing array is created for \"HelloThere\" and `t` points to it\n</code></pre>\n\n<p><a href=\"https://golang.org/src/reflect/value.go?s=56526:56578#L1873\" rel=\"nofollow noreferrer\">StringHeader - data structure</a></p>\n\n<p><a href=\"https://medium.com/rungo/string-data-type-in-go-8af2b639478\" rel=\"nofollow noreferrer\">String Data Type in GO</a></p>\n"}, {"tags": [], "owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "is_accepted": false, "score": 0, "last_activity_date": 1611290324, "last_edit_date": 1611290324, "creation_date": 1565619032, "answer_id": 57462821, "question_id": 57457935, "link": "https://stackoverflow.com/questions/57457935/does-golang-copy-the-string-on-modification-write/57462821#57462821", "title": "Does Golang Copy the String on Modification/Write?", "body": "<p>After much debate/discussion on this at the comment sections, here is my conclusion.</p>\n<p>Golang does not have copy-on-write.</p>\n<p>The <strong>+=</strong> here is an explicitly creating a new string which is equivalent to <strong>s = s + &quot;World&quot;</strong> which creates a new string and assign it back to <strong>s</strong></p>\n<p>And if you try to write the following code, it will result in compilation error due to immutability of the Golang string</p>\n<pre><code>t[0] = 'A' // cannot assign to t[0]\n</code></pre>\n<p>As a result, everything in Golang is explicit, nothing is done implicitly by Golang. That is why copy-on-write does not exist in Golang.</p>\n<p>Note: COW and immutability are not mutually exclusive.</p>\n"}], "owner": {"reputation": 2035, "user_id": 4415502, "user_type": "registered", "accept_rate": 76, "profile_image": "https://graph.facebook.com/1026723693/picture?type=large", "display_name": "Mox", "link": "https://stackoverflow.com/users/4415502/mox"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3683, "favorite_count": 1, "accepted_answer_id": 57458638, "answer_count": 2, "score": -2, "last_activity_date": 1611290324, "creation_date": 1565598912, "last_edit_date": 1565602344, "question_id": 57457935, "link": "https://stackoverflow.com/questions/57457935/does-golang-copy-the-string-on-modification-write", "title": "Does Golang Copy the String on Modification/Write?", "body": "<p>After reading the answer on <a href=\"https://stackoverflow.com/questions/8532127/does-go-language-use-copy-on-write-for-strings/\">Does Go language use Copy-on-write for strings</a>\n, I feel the question was not adequately answered.</p>\n\n<p>Given the example below, what is actually happening under the hood?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n  s := \"Hello\"\n  t := s // t shares the same data as s\n  s += \"World\" // a new string is created\n  t += \"There\" // a new string is created.\n\n  fmt.Printf(\"%s %s\\n\", s, t)\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>HelloWorld HelloThere\n</code></pre>\n\n<p>The question is when will golang determine there is a need to create a new copy? </p>\n"}, {"tags": ["reactjs", "firebase", "docker", "go", "amazon-elastic-beanstalk"], "comments": [{"owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565590479, "post_id": 57456270, "comment_id": 101386611, "body": "you can not add the <code>ENV</code> in your <code>docker-compose.yml</code> ?"}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "reply_to_user": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565591015, "post_id": 57456270, "comment_id": 101386781, "body": "I do not want to expose <code>firebaseConfig</code> information to public. If they are listed on <code>docker-compose.yml</code>, they are exposed on github."}, {"owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565591202, "post_id": 57456270, "comment_id": 101386825, "body": "add just the <code>ARG</code> name without a value in your <code>compose</code> and then pass the value in the docker up command <code>REACT_APP_FIREBASE_APP_ID=TEST &amp;&amp; docker-ompose up</code>"}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "reply_to_user": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565593101, "post_id": 57456270, "comment_id": 101387407, "body": "it works fine in local environment maybe, but I&#39;m talking about <code>elastic beanstalk </code>environment.  I tried it now by setting on <code>docker-compose.yml</code> and <code>elastic beanstalk</code> environment variables. but still same error occured."}, {"owner": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565593339, "post_id": 57456270, "comment_id": 101387498, "body": "All environment variables defined in the Elastic Beanstalk console are passed to the containers. so that should works see <a href=\"https://docs.amazonaws.cn/en_us/elasticbeanstalk/latest/dg/create_deploy_docker.html\" rel=\"nofollow noreferrer\">docs.amazonaws.cn/en_us/elasticbeanstalk/latest/dg/&hellip;</a>"}, {"owner": {"reputation": 2423, "user_id": 8437740, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/PsSye.png?s=128&g=1", "display_name": "Jithin", "link": "https://stackoverflow.com/users/8437740/jithin"}, "edited": false, "score": 0, "creation_date": 1565593364, "post_id": 57456270, "comment_id": 101387508, "body": "why don&#39;t you put the entire config info on another file and add that into <code>.gitignore</code> file?"}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "edited": false, "score": 0, "creation_date": 1565594201, "post_id": 57456270, "comment_id": 101387782, "body": "I added it on docker-compose.yml and set on elastic beanstalk. but not work.<a href=\"https://github.com/jpskgc/article/blob/master/docker-compose.yml#L47-L52\" rel=\"nofollow noreferrer\">github.com/jpskgc/article/blob/master/&hellip;</a> <a href=\"https://imgur.com/a/XvjL4dh\" rel=\"nofollow noreferrer\">imgur.com/a/XvjL4dh</a>"}, {"owner": {"reputation": 1773, "user_id": 6042773, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-5Z6chMdg08s/AAAAAAAAAAI/AAAAAAAAB4U/Zv5bZjaZQRw/photo.jpg?sz=128", "display_name": "Saikat Chakrabortty", "link": "https://stackoverflow.com/users/6042773/saikat-chakrabortty"}, "reply_to_user": {"reputation": 12305, "user_id": 8192635, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcaf44c9ff9eeeb51fc78c816891d75a?s=128&d=identicon&r=PG&f=1", "display_name": "LinPy", "link": "https://stackoverflow.com/users/8192635/linpy"}, "edited": false, "score": 0, "creation_date": 1565594394, "post_id": 57456270, "comment_id": 101387832, "body": "i guess, in case you passing ENV like @Linpy suggested, in your compose file instead of keeping <code>REACT_APP_FIREBASE_API_KEY </code> , i do like <code>REACT_APP_FIREBASE_API_KEY =${REACT_APP_FIREBASE_API_KEY}</code>"}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "edited": false, "score": 0, "creation_date": 1565595456, "post_id": 57456270, "comment_id": 101388169, "body": "I changed <code>docker-compose.yml</code> as @ saikat chakrabortty suggested, but still same error happens. <a href=\"https://github.com/jpskgc/article/blob/master/docker-compose.yml#L47-L52\" rel=\"nofollow noreferrer\">github.com/jpskgc/article/blob/master/&hellip;</a>"}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "edited": false, "score": 0, "creation_date": 1566453715, "post_id": 57456270, "comment_id": 101662169, "body": "As this article says, no prolbem to expose firebaseConfig. &lt;br&gt; <a href=\"https://stackoverflow.com/questions/37482366/is-it-safe-to-expose-firebase-apikey-to-the-public\" title=\"is it safe to expose firebase apikey to the public\">stackoverflow.com/questions/37482366/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "is_accepted": true, "score": 0, "last_activity_date": 1566459882, "creation_date": 1566459882, "answer_id": 57604388, "question_id": 57456270, "link": "https://stackoverflow.com/questions/57456270/how-to-hide-firebaseconfig-information-in-client-side/57604388#57604388", "title": "How to hide firebaseConfig information in client side", "body": "<p>There is no prolbem to expose firebaseConfig.<br>\nI take a look at flowing article.<br>\nSo issue is resolved.<br></p>\n\n<p><a href=\"https://stackoverflow.com/questions/37482366/is-it-safe-to-expose-firebase-apikey-to-the-public\">Is it safe to expose Firebase apiKey to the public?</a></p>\n"}], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1585, "favorite_count": 0, "accepted_answer_id": 57604388, "answer_count": 1, "score": 1, "last_activity_date": 1566459882, "creation_date": 1565589675, "last_edit_date": 1565595758, "question_id": 57456270, "link": "https://stackoverflow.com/questions/57456270/how-to-hide-firebaseconfig-information-in-client-side", "title": "How to hide firebaseConfig information in client side", "body": "<p>I'm setting authentication functionality by <code>firebase</code>.<br>\nIt's working fine in my local docker environment.<br>\nBut its <code>firebaseConfig</code> is located in client side.<br>\nI want to hide <code>firebaseConfig</code> information as environment variables.<br></p>\n\n<p>Here is the stack.</p>\n\n<pre><code>\u30fbclient: react/axios\n\u30fbapi: golang/gin\n\u30fbweb server: nginx\n\u30fbdb: mysql\n\u30fbcontainer: docker\n\u30fbci-tool: travis\n\u30fbdeploy: aws elastic beanstalk\n</code></pre>\n\n<p>Here is the repository structure<br></p>\n\n<pre><code>article\n  \u251c client\n  \u251c   \u2514 src\n  \u2502      \u2514 firebase.ts\n  \u251c api\n  \u251c nginx\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>I set <code>process.env</code> in <code>firebaseConfig</code>. </p>\n\n<pre class=\"lang-js prettyprint-override\"><code>//firebase.ts\nimport * as firebase from 'firebase';\nimport 'firebase/auth';\n\nconst firebaseConfig = {\n  apiKey: process.env.REACT_APP_FIREBASE_API_KEY,\n  authDomain: process.env.REACT_APP_FIREBASE_AUTH_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE_URL,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  storageBucket: '',\n  messagingSenderId: process.env.REACT_APP_FIREBASE_MESSAGING_SENDER_ID,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n};\n\nfirebase.initializeApp(firebaseConfig);\n\nexport default firebase;\n\n</code></pre>\n\n<p>This works fine in local environment.<br>\nBut in production environment(elastic beanstalk), I have no idea to set these environment variables because they are in client side.</p>\n\n<p>Entire source code is here:<br>\n<a href=\"https://github.com/jpskgc/article\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article</a><br>\nProduction URL is here:<br>\n<a href=\"http://multidocker-env.vwnrixavuv.ap-northeast-1.elasticbeanstalk.com/\" rel=\"nofollow noreferrer\">http://multidocker-env.vwnrixavuv.ap-northeast-1.elasticbeanstalk.com/</a><br></p>\n\n<p>I expect firebase authentication works in production environment(elastic beanstalk).<br>\nBut the actual does not.<br></p>\n\n<pre><code>Zr {code: \"auth/invalid-api-key\", message: \"Your API key is invalid, please check you have copied it correctly.\"}\ncode: \"auth/invalid-api-key\"\nmessage: \"Your API key is invalid, please check you have copied it correctly.\"\n__proto__: Error\n</code></pre>\n\n<p>****UPDATE****<br>\nI set environemt variables in <code>docker-compose.yml</code> and <code>elastic beanstalk</code>.<br>\nbut still same error occurs.</p>\n\n<pre><code>//docker-compose.yml\n  client:\n    build:\n      dockerfile: Dockerfile.dev\n      context: ./client\n    volumes:\n      - /app/node_modules\n      - ./client:/app\n    environment:\n      - REACT_APP_FIREBASE_API_KEY=${REACT_APP_FIREBASE_API_KEY}\n      - REACT_APP_FIREBASE_AUTH_DOMAIN=${REACT_APP_FIREBASE_AUTH_DOMAIN}\n      - REACT_APP_FIREBASE_DATABASE_URL=${REACT_APP_FIREBASE_DATABASE_URL}\n      - REACT_APP_FIREBASE_PROJECT_ID=${REACT_APP_FIREBASE_PROJECT_ID}\n      - REACT_APP_FIREBASE_MESSAGING_SENDER_ID=${REACT_APP_FIREBASE_MESSAGING_SENDER_ID}\n      - REACT_APP_FIREBASE_APP_ID=${REACT_APP_FIREBASE_APP_ID}\n</code></pre>\n\n<p>here is the <code>elastic beanstalk</code> environment variables setting:<br>\n<a href=\"https://imgur.com/a/XvjL4dh\" rel=\"nofollow noreferrer\">https://imgur.com/a/XvjL4dh</a></p>\n"}, {"tags": ["go", "kubernetes", "google-kubernetes-engine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565587055, "post_id": 57455768, "comment_id": 101385787, "body": "To debug, fmt.Printf(\u201cobj: %T\u201d, obj) to find the actual concrete type. The question uses  a type assertion, not a conversion or s typecast."}, {"owner": {"reputation": 1623, "user_id": 2398143, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a80e35b77564de45d5c4199b675fb394?s=128&d=identicon&r=PG", "display_name": "AnilJ", "link": "https://stackoverflow.com/users/2398143/anilj"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565589752, "post_id": 57455768, "comment_id": 101386400, "body": "Can you please elaborate. I am relatively new to go and learning it on the job. I tried printing the %T, and I see this (2019-08-11T22:58:19-07:00 DBG k8s.go:1530: obj: *v1.Pod)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565590166, "post_id": 57455768, "comment_id": 101386522, "body": "The output shows it&#39;s a pointer, so do <code>obj.(*v1.Pod)</code>, and not <code>obj.(v1.Pod)</code>."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 2, "creation_date": 1565590178, "post_id": 57455768, "comment_id": 101386527, "body": "<code>obj: *v1.Pod</code> implies that the type of <code>obj</code> is <code>*v1.Pod</code> \u2014 <i>pointer to</i> <code>v1.Pod</code>. Your type-test uses <code>v1.Pod</code> rather than <code>*v1.Pod</code>."}], "answers": [{"tags": [], "owner": {"reputation": 1623, "user_id": 2398143, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a80e35b77564de45d5c4199b675fb394?s=128&d=identicon&r=PG", "display_name": "AnilJ", "link": "https://stackoverflow.com/users/2398143/anilj"}, "is_accepted": false, "score": 0, "last_activity_date": 1565590259, "creation_date": 1565590259, "answer_id": 57456374, "question_id": 57455768, "link": "https://stackoverflow.com/questions/57455768/converting-typecasting-go-interface-object-to-concrete-type/57456374#57456374", "title": "Converting/typecasting go interface object to concrete type", "body": "<p>I could read the values and the content of the <code>obj</code> using this code. </p>\n\n<pre><code>func (k8s *K8S) handleAddPod(obj interface{}) {\n    pod, ok := obj.(*v1.Pod)   // Added * here.  \n    if ok {\n        log.Debug(\"Status: \" + string(pod.Status.Phase))\n        log.Debug(\"Pod added: \" + pod.Name + \" \" + pod.DeletionTimestamp.String())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1623, "user_id": 2398143, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/a80e35b77564de45d5c4199b675fb394?s=128&d=identicon&r=PG", "display_name": "AnilJ", "link": "https://stackoverflow.com/users/2398143/anilj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565590259, "creation_date": 1565585320, "question_id": 57455768, "link": "https://stackoverflow.com/questions/57455768/converting-typecasting-go-interface-object-to-concrete-type", "title": "Converting/typecasting go interface object to concrete type", "body": "<p>In the implementation of <code>informer</code>, one can provide event handlers like below. </p>\n\n<pre><code>podInformer.AddEventHandler(cache.ResourceEventHandlerFuncs {\n   // When a new pod gets created\n   AddFunc: func(obj interface{}) {\n       k8s.handleAddPod(obj)\n   },\n   // When a pod gets updated\n   UpdateFunc: func(oldObj interface{}, newObj interface{}) {\n       k8s.handleUpdatePod(oldObj, newObj)\n   },\n   // When a pod gets deleted\n   DeleteFunc: func(obj interface{}) {\n       k8s.handleDeletePod(obj)\n   },\n})\n</code></pre>\n\n<p>This is an example event handler for processing the <code>Pod</code> related events. So far, I have written the handler as below; however, it is failing to read the object. </p>\n\n<p>I am not able to typecast the <code>obj interface{}</code> into <code>v1.Pod</code> and an attempt to read it failing. The value of flag <code>ok</code> is coming out <code>false</code>. Can someone please suggest whats missing in this code? </p>\n\n<pre><code>func (k8s *K8S) handleAddPod(obj interface{}) {\n    pod, ok := obj.(v1.Pod)\n    if ok {\n        log.Debug(\"Status: \" + string(pod.Status.Phase))\n        log.Debug(\"Pod added: \" + pod.Name + \" \" + pod.DeletionTimestamp.String())\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 289, "user_id": 4640107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9de16c66a9eea778d4386419798e795?s=128&d=identicon&r=PG&f=1", "display_name": "Alan42", "link": "https://stackoverflow.com/users/4640107/alan42"}, "edited": false, "score": 0, "creation_date": 1565594143, "post_id": 57455629, "comment_id": 101387764, "body": "Thank you. The reason I run cmd.Wait() with goroutine is because I am worried that if I don&#39;t do this, it will cause a resource leak."}], "tags": [], "owner": {"reputation": 814, "user_id": 6396157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rHCim.jpg?s=128&g=1", "display_name": "Praveen Rewar", "link": "https://stackoverflow.com/users/6396157/praveen-rewar"}, "is_accepted": false, "score": 3, "last_activity_date": 1565584049, "creation_date": 1565584049, "answer_id": 57455629, "question_id": 57455563, "link": "https://stackoverflow.com/questions/57455563/error-handling-when-running-cmd-wait-with-goroutine/57455629#57455629", "title": "error handling when running cmd.Wait() with goroutine", "body": "<p>Why do you want to run <code>cmd.Wait()</code> as a goroutine? And if you really need to do this in a goroutine then you can try something like this. Basically wrapping up the <code>cmd.Wait()</code> command inside an inline go func</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func(){\n   _ := cmd.Wait()\n}()\n</code></pre>\n\n<p>You can do an error check also inside the go function.</p>\n"}, {"tags": [], "owner": {"reputation": 694, "user_id": 8627962, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4f-Yq3BvCaA/AAAAAAAAAAI/AAAAAAAAARM/NeJoNAwQHT0/photo.jpg?sz=128", "display_name": "Siva Guru", "link": "https://stackoverflow.com/users/8627962/siva-guru"}, "is_accepted": false, "score": 2, "last_activity_date": 1565590393, "creation_date": 1565590393, "answer_id": 57456398, "question_id": 57455563, "link": "https://stackoverflow.com/questions/57455563/error-handling-when-running-cmd-wait-with-goroutine/57456398#57456398", "title": "error handling when running cmd.Wait() with goroutine", "body": "<p>If \"cmd\" goes out of scope the garbage collector will free its reference.</p>\n\n<pre><code>   func execCommand() {\n    exec.Command(\"something\").Start()\n}\n\nfunc main() {\n    execCommand()\n    time.Sleep(time.Minute * 1)\n}\n</code></pre>\n\n<p>So something like this will have its resource freed when the command is executed\nexec.Wait command is used to get the exit code and waits for copying from stdout or something like that.</p>\n\n<p>If you still wanna use cmd.Wait you have to start it as a seperate Function or you could just use exec.Run  </p>\n\n<pre><code>go func(){\n   err := cmd.Run() //or cmd.Wait()\n   if err != nil {\n      fmt.println(\"error \", err)    \n      }\n}()\n</code></pre>\n"}], "owner": {"reputation": 289, "user_id": 4640107, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9de16c66a9eea778d4386419798e795?s=128&d=identicon&r=PG&f=1", "display_name": "Alan42", "link": "https://stackoverflow.com/users/4640107/alan42"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 542, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1565597195, "creation_date": 1565583183, "last_edit_date": 1565597195, "question_id": 57455563, "link": "https://stackoverflow.com/questions/57455563/error-handling-when-running-cmd-wait-with-goroutine", "title": "error handling when running cmd.Wait() with goroutine", "body": "<p>I tried to call some external commands <strong>non-blocking</strong> in Golang, so I used </p>\n\n<pre><code>cmd.Start()\n</code></pre>\n\n<p>and</p>\n\n<pre><code>go cmd.Wait()\n</code></pre>\n\n<p>Although I don't need to wait for the command to run successfully, the reason I run <code>cmd.wait()</code> is because the document mentions <code>Wait releases any resources associated with the Cmd.\"</code> So I don't want to cause a resource leak.</p>\n\n<p>However, this usage will cause linter to report an error, reminding me that I have not handled the error.</p>\n\n<pre><code>Error return value of `cmd.Wait` is not checked (errcheck)\n        go cmd.Wait()\n</code></pre>\n\n<p>How do I handle error for <code>go cmd.Wait()</code>? Or, if I don't run <code>go cmd.Wait()</code>, will it cause a resource leak?</p>\n\n<p>add:</p>\n\n<p>One reason I use <code>go cmd.Wait()</code> is that if I don't use it, the external process I started will become a zombie process when it is exited. I haven't figured out why this is happening.</p>\n"}, {"tags": ["pointers", "go", "slice"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1565610081, "post_id": 57454697, "comment_id": 101394332, "body": "Further to the answer given, it&#39;s very rare to need a pointer to a slice; it&#39;s even more rare to create one (vs passing one). Re-visit why you think your variable should be a pointer. Also, all-caps identifier names are not idiomatic Go."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1565610250, "post_id": 57454697, "comment_id": 101394397, "body": "@DaveC thanks for your comment Dave. Thing is I need to pass this slice to a function, which in turn will pass it to another function and the latter will add a few animations to it. When I attempted to use append without it being a pointer the changes would not reflect as were passed by copy."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565610292, "post_id": 57454697, "comment_id": 101394418, "body": "@DaveC if you can show me an example of how to append to a passed slice without needing a pointer it would be greatly appreciated"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1565612752, "post_id": 57454697, "comment_id": 101395608, "body": "If &quot;need to pass this slice to a function&quot; then I&#39;d take your <code>var foo []*Thing</code> and pass it as <code>someFunctionWantingASlicePointer(&amp;foo)</code>. Notice I made a distinction between &quot;creating one&quot; and &quot;passing one&quot; in my comment."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565612811, "post_id": 57454697, "comment_id": 101395634, "body": "@DaveC Thanks. I&#39;ll try this"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 3, "last_activity_date": 1565572628, "last_edit_date": 1565572628, "creation_date": 1565572426, "answer_id": 57454727, "question_id": 57454697, "link": "https://stackoverflow.com/questions/57454697/pointer-of-slice-of-pointers-panicking-when-making/57454727#57454727", "title": "Pointer of slice of pointers panicking when making", "body": "<p>To fix, you want:</p>\n\n<pre><code>s := make([]*SDL.Animable, 0, 100)\n\nANIMATIONS = &amp;s\n</code></pre>\n\n<p>The reason your code was panicking is basically you were dereferencing a nil pointer (<code>*ANIMATIONS</code>). You need to get a reference variable to store your new slice &amp; then you can get it's address (<code>&amp;s</code>) and store that in your pointer.</p>\n\n<p><em>Note:</em> the following will <em>NOT</em> work <code>&amp;make([]*SDL.Animable, 0, 100)</code> - as you cannot get the address of a returned result - hence the need to store the result &amp; get it's address.</p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38, "favorite_count": 0, "closed_date": 1565602949, "accepted_answer_id": 57454727, "answer_count": 1, "score": -2, "last_activity_date": 1565572628, "creation_date": 1565572042, "question_id": 57454697, "link": "https://stackoverflow.com/questions/57454697/pointer-of-slice-of-pointers-panicking-when-making", "closed_reason": "Not suitable for this site", "title": "Pointer of slice of pointers panicking when making", "body": "<p>I have the following code :</p>\n\n<pre><code>var ANIMATIONS *[]*SDL.Animable\n\n....\n\nfunc main() {\n    *ANIMATIONS = make([]*SDL.Animable, 0, 100)\n</code></pre>\n\n<p>But its panicking when running. What is the right way of initializing this?</p>\n\n<p>Error : </p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x8 pc=0x4afe3a]\n\ngoroutine 1 [running, locked to thread]:\nmain.main()\n</code></pre>\n"}, {"tags": ["go", "web", "design-patterns", "request", "httphandler"], "answers": [{"tags": [], "owner": {"reputation": 44, "user_id": 2696527, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mAiwifxnlXNJAeue1Afeitung3sAx3jCQ3spOMHTg=k-s128", "display_name": "Siva Chegondi", "link": "https://stackoverflow.com/users/2696527/siva-chegondi"}, "is_accepted": false, "score": -1, "last_activity_date": 1565594198, "creation_date": 1565594198, "answer_id": 57457009, "question_id": 57454280, "link": "https://stackoverflow.com/questions/57454280/code-design-for-handle-funcs-in-go-web-app/57457009#57457009", "title": "Code design for handle funcs in go web app", "body": "<p>Hi <a href=\"https://stackoverflow.com/users/11915351/golearner\">golearner</a>, in the <strong>mainHandler</strong> just render the form and make another handler kinda <em>\"/formaction\"</em> to handle the form, in that way you can easily organize your code.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1565617251, "creation_date": 1565617251, "answer_id": 57462332, "question_id": 57454280, "link": "https://stackoverflow.com/questions/57454280/code-design-for-handle-funcs-in-go-web-app/57462332#57462332", "title": "Code design for handle funcs in go web app", "body": "<p>The handlers' semantics should be designed to match the desired HTTP behavior, regardless of the code complexity. If you want to handle a single client request by doing a bunch of stuff, that should be a single handler. If the handler becomes too complex, break it up. Handlers are just functions and can be broken up exactly like any other function - by extracting some part of it into another function and calling that new function. To take you pseudocode:</p>\n\n<pre><code>func mainHandler(w http.ResponseWriter, r *http.Request) {\n    err := renderTemplate(w)\n    if err != nil { ... }\n    err, data := postToApi()\n    if err != nil { ... }\n    err, data2 := postToApi2(data)\n    if err != nil { ... }\n}\n</code></pre>\n\n<p>There's no reason for those functions to be handlers themselves or to get the client involved with a redirect. Just break up your logic the way you normally break up logic - it doesn't matter that it's an HTTP handler.</p>\n"}], "owner": {"reputation": 1, "user_id": 11915351, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7410f9629249edd675fcae751a4ef357?s=128&d=identicon&r=PG&f=1", "display_name": "golearner", "link": "https://stackoverflow.com/users/11915351/golearner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 30, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1565617251, "creation_date": 1565565411, "question_id": 57454280, "link": "https://stackoverflow.com/questions/57454280/code-design-for-handle-funcs-in-go-web-app", "title": "Code design for handle funcs in go web app", "body": "<p>I'm learning go and ran into some design issues while developing web app. The app has main route \"/\" where user can submit a simple form. With those form values I am calling external API and unmarshaling response into some struct. Now from here I want to make another call based on retrieved values to another external API and I'm not sure what's the proper way of doing this. Here is a snippet for better understandment:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    http.HandleFunc(\"/\", mainHandler)\n    log.Fatal(http.ListenAndServe(\":8080\", nil))\n}\n\nfunc mainHandler(w http.ResponseWriter, r *http.Request) {\n    //renders form template\n    //makes post and retrieves data from api\n    //here with retrieved data I want to make another call to different API,\n    // but mainHandler would get too big and complex. I'm not sure how should I pass this data to\n    // another handler or redirect to another handler with this data.\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 1, "creation_date": 1565558397, "post_id": 57453615, "comment_id": 101381945, "body": "Do you know what &quot;varint&quot; is? It is a variable size encoding, basically it encodes 7 bits at a time, and the high-bit (128) of each byte is used to signal that yet another byte has been encoded. Basically it encoded the value with the bits 12345678 into two bytes with the bits 1234567x 80000000, where x is used to signal the presence of another byte, and was set to 1. Coincidentaly, this is the same value you asked it to encode to begin with so it looks suspicious."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565558561, "post_id": 57453615, "comment_id": 101381972, "body": "If you examine the result of calling PutUvarint, you should find that it returns 2, telling you it encoded the input into 2 bytes. The &quot;MaxVarintLen64&quot; is just the maximum length necessary to encode all possible values."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565558666, "post_id": 57453615, "comment_id": 101381984, "body": "You can find more information in the <a href=\"https://golang.org/src/encoding/binary/varint.go\" rel=\"nofollow noreferrer\">source of varint.go</a>."}, {"owner": {"reputation": 1, "user_id": 11915137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609dd945b1094c798bf525753515bb6d?s=128&d=identicon&r=PG&f=1", "display_name": "flobib", "link": "https://stackoverflow.com/users/11915137/flobib"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603280, "post_id": 57453615, "comment_id": 101391296, "body": "I not understand, <code>PutUvarint</code> take an uint64, not an int. So why is put the signed bit.   <a href=\"https://golang.org/pkg/encoding/binary/#PutUvarint\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/binary/#PutUvarint</a>"}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603319, "post_id": 57453615, "comment_id": 101391320, "body": "It&#39;s not a sign bit, it&#39;s that your value required 8 bits to store, so it was split into 2 bytes, that&#39;s how <b>varint</b> works. It didn&#39;t store 8 bytes, it stored 2, <code>varint</code> is a variable sized integer encoding technique to save space, small values requires fewer bytes."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603423, "post_id": 57453615, "comment_id": 101391377, "body": "<code>varint</code> encodes 7 bits at a time, the lowest 7 bits go into the first byte, the next 7 bits go into the second byte and so on. But only if needed. If the value is less than 128, so it fits into 7 bits, varint encoding will use only 1 byte. The high order bit is reserved in each byte and is set to 1 if there are more bytes that follows."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603511, "post_id": 57453615, "comment_id": 101391423, "body": "129 requires 8 bits, so the first 7 bits (which result in the value 1) is encoded in the first byte. However, since there needs to be an additional byte to encode the last, 8th byte, the high-order bit of that first byte is set to 1. This, unfortunately, ends up reproducing your original value so it looks a bit odd, but the first byte in the encoded output, 129, is actually the value 1 + a high order bit set to signal the presence of yet another byte. The next byte takes the next 7 bits, which also has the value 1 (the high order bit of your original 129), and then no more bytes."}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603578, "post_id": 57453615, "comment_id": 101391458, "body": "The encoding can be thought of like this: <code>while (value &gt; 0) { byte b = value &amp; 7-bits; value = value shift-right 7-bits; if (value &gt; 0) b = b | high-order-bit-set; output(b); }</code>"}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565603717, "post_id": 57453615, "comment_id": 101391515, "body": "Make sure you understand what varint is. For instance, you allocated a byte array large enough to hold the maximum possible varint value, which is 10 bytes. But, the encoding of your 129 value only occupies the first 2 bytes, so for instance if you want to write the encoded values to a file or something, you should output 2 bytes, not all 10. The <code>PutUvarint</code> function returns the number of bytes it wrote to the array, 2 in your case. If you don&#39;t understand this, you&#39;ll like output all 10 bytes and this will be wrong."}, {"owner": {"reputation": 1, "user_id": 11915137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609dd945b1094c798bf525753515bb6d?s=128&d=identicon&r=PG&f=1", "display_name": "flobib", "link": "https://stackoverflow.com/users/11915137/flobib"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565605230, "post_id": 57453615, "comment_id": 101392121, "body": "I wanted to use <code>PutUvarint</code> because it returns the number of bytes.  <code>LittleEndian.PutUint64</code> not return the number of bytes.  <code>n := binary.PutUvarint (b, 129)</code> <code>b = b [:n]</code>"}, {"owner": {"reputation": 1, "user_id": 11915137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609dd945b1094c798bf525753515bb6d?s=128&d=identicon&r=PG&f=1", "display_name": "flobib", "link": "https://stackoverflow.com/users/11915137/flobib"}, "reply_to_user": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565605350, "post_id": 57453615, "comment_id": 101392177, "body": "But i understand <code>varint</code> now, your explications are clear"}, {"owner": {"reputation": 348226, "user_id": 267, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/1b11262da6d1cd26b1b0bc99a2620cee?s=128&d=identicon&r=PG", "display_name": "Lasse V. Karlsen", "link": "https://stackoverflow.com/users/267/lasse-v-karlsen"}, "edited": false, "score": 0, "creation_date": 1565608701, "post_id": 57453615, "comment_id": 101393648, "body": "PutUint64 always outputs 8 bytes, regardless of the value. 64 bits = 8 bytes. You can construct an 8-byte array and give to it, then you don&#39;t need the slice operation either. It&#39;s only the &quot;varint&quot; functions that output a varying number of bytes depending on the value output, the non-varint functions outputs a fixed number of bytes relative to the size of the type they handle."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1565560140, "creation_date": 1565560140, "answer_id": 57453863, "question_id": 57453615, "link": "https://stackoverflow.com/questions/57453615/go-binary-putuvarint-add-1-when-the-numeric-value-is-above-127/57453863#57453863", "title": "GO - binary.PutUvarint add 1 when the numeric value is above 127", "body": "<blockquote>\n  <p>I have searched on stack overflow and github issue and i not found\n  response.</p>\n</blockquote>\n\n<hr>\n\n<p>The first place to look is the Go package documentation.</p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">Package binary</a></p>\n  \n  <p>import \"encoding/binary\" </p>\n  \n  <p>The varint functions encode and decode single integer values using a\n  variable-length encoding; smaller values require fewer bytes. For a\n  specification, see\n  <a href=\"https://developers.google.com/protocol-buffers/docs/encoding\" rel=\"nofollow noreferrer\">https://developers.google.com/protocol-buffers/docs/encoding</a>.</p>\n</blockquote>\n\n<p>Always read the documentation.</p>\n"}], "owner": {"reputation": 1, "user_id": 11915137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/609dd945b1094c798bf525753515bb6d?s=128&d=identicon&r=PG&f=1", "display_name": "flobib", "link": "https://stackoverflow.com/users/11915137/flobib"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 1, "closed_date": 1565584436, "answer_count": 1, "score": -3, "last_activity_date": 1565560140, "creation_date": 1565557612, "last_edit_date": 1565558029, "question_id": 57453615, "link": "https://stackoverflow.com/questions/57453615/go-binary-putuvarint-add-1-when-the-numeric-value-is-above-127", "closed_reason": "Needs details or clarity", "title": "GO - binary.PutUvarint add 1 when the numeric value is above 127", "body": "<p>All is in the title.</p>\n\n<p>The GO function <code>binary.PutUvarint</code> add 1 when the numeric value is above 127.</p>\n\n<p>I have searched on <code>stack overflow</code> and <code>github</code> issue and i not found response.</p>\n\n<p>So I post this message to know if somebody can help.</p>\n\n<p>Thank you (Sorry for my bad English)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>b := make([]byte, binary.MaxVarintLen64)\n\nbinary.PutUvarint(b, 129)\nfmt.Println(b)\n// output\n// [129 1 0 0 0 0 0 0 0 0]\n\nbinary.LittleEndian.PutUint64(b, 129)\nfmt.Println(b)\n// output\n// [129 0 0 0 0 0 0 0 0 0]\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 4600, "user_id": 310298, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PkUnq.png?s=128&g=1", "display_name": "itaysk", "link": "https://stackoverflow.com/users/310298/itaysk"}, "edited": false, "score": 0, "creation_date": 1565556519, "post_id": 57453218, "comment_id": 101381552, "body": "Thanks. I should have mentioned that I would like to avoid using a typed schema because I may need to perform this on different types, some of them I don&#39;t have the full schema (custom resources). The <code>map[string]interface{}</code> solution can work, and it&#39;s quite similar to the solution I already have using gjson and iterators, except the deletion technique which I&#39;ll adopt but it&#39;s not the essence of the question, traversing is. Gonna let this sink for a while to see if a better answer arrives and if not I&#39;ll accept this."}], "tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": true, "score": 2, "last_activity_date": 1565553917, "creation_date": 1565553917, "answer_id": 57453218, "question_id": 57452888, "link": "https://stackoverflow.com/questions/57452888/find-and-delete-nested-json-object-in-go/57453218#57453218", "title": "find and delete nested json object in Go", "body": "<p>The easiest thing to do here is parse the JSON into an object, work with that object, then serialise back into JSON.</p>\n\n<p>Kubernetes provides a Go client library that defines the <a href=\"https://godoc.org/k8s.io/api/core/v1#Pod\" rel=\"nofollow noreferrer\">v1.Pod struct</a> you can Unmarshal onto using the stdlib encoding/json:</p>\n\n<pre><code>// import \"k8s.io/api/core/v1\"\nvar pod v1.Pod\nif err := json.Unmarshal(podBody, &amp;pod); err != nil {\n    log.Fatalf(\"parsing pod json: %s\", err)\n}\n</code></pre>\n\n<p>From there you can read <code>pod.Spec.Containers</code> and their <code>VolumeMounts</code>:</p>\n\n<pre><code>// Modify.\nfor c := range pod.Spec.Containers {\n    container := &amp;pod.Spec.Containers[c]\n    for i, vol := range container.VolumeMounts {\n        if strings.HasPrefix(vol.Name, \"default-token-\") {\n            // Remove the VolumeMount at index i.\n            container.VolumeMounts = append(container.VolumeMounts[:i], container.VolumeMounts[i+1:]...)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/3r5-XKIazhK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3r5-XKIazhK</a></p>\n\n<p>If you're worried about losing some arbitrary JSON which might appear in your input, you may instead wish to define <code>var pod map[string]interface{}</code> and then type-cast each of the properties within as <code>spec, ok := pod[\"spec\"].(map[string]interface{})</code>, <code>containers, ok := spec[\"containers\"].([]map[string]interface)</code> and so on.</p>\n\n<p>Hope that helps.</p>\n\n<p>ps. The \"removing\" is following <a href=\"https://github.com/golang/go/wiki/SliceTricks#delete\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SliceTricks#delete</a></p>\n"}, {"tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": false, "score": 1, "last_activity_date": 1565561834, "creation_date": 1565561834, "answer_id": 57454001, "question_id": 57452888, "link": "https://stackoverflow.com/questions/57452888/find-and-delete-nested-json-object-in-go/57454001#57454001", "title": "find and delete nested json object in Go", "body": "<p>To take a totally different approach from before, you could create a</p>\n\n<pre><code>type Root struct {\n    fields struct {\n        Spec *Spec `json:\"spec,omitempty\"`\n    }\n    other map[string]interface{}\n}\n</code></pre>\n\n<p>with custom UnmarshalJSON which unmarshals into both fields and other, and custom MarshalJSON which sets other[\"spec\"] = json.RawMessage(spec.MarshalJSON()) before returning json.Marshal(other):</p>\n\n<pre><code>func (v *Root) UnmarshalJSON(b []byte) error {\n    if err := json.Unmarshal(b, &amp;v.fields); err != nil {\n        return err\n    }\n    if v.other == nil {\n        v.other = make(map[string]interface{})\n    }\n    if err := json.Unmarshal(b, &amp;v.other); err != nil {\n        return err\n    }\n    return nil\n}\n\nfunc (v *Root) MarshalJSON() ([]byte, error) {\n    var err error\n    if v.other[\"spec\"], err = rawMarshal(v.fields.Spec); err != nil {\n        return nil, err\n    }\n    return json.Marshal(v.other)\n}\n\nfunc rawMarshal(v interface{}) (json.RawMessage, error) {\n    b, err := json.Marshal(v)\n    if err != nil {\n        return nil, err\n    }\n    return json.RawMessage(b), nil\n}\n</code></pre>\n\n<p>You then define these sort of types all of the way down through .spec.containers.volumeMounts and have a Container.MarshalJSON which throws away and VolumeMounts we don't like:</p>\n\n<pre><code>func (v *Container) MarshalJSON() ([]byte, error) {\n    mounts := v.fields.VolumeMounts\n    for i, mount := range mounts {\n        if strings.HasPrefix(mount.fields.Name, \"default-token-\") {\n            mounts = append(mounts[:i], mounts[i+1:]...)\n        }\n    }\n\n    var err error\n    if v.other[\"volumeMounts\"], err = rawMarshal(mounts); err != nil {\n        return nil, err\n    }\n    return json.Marshal(v.other)\n}\n</code></pre>\n\n<p>Full playground example: <a href=\"https://play.golang.org/p/k1603cchwC7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/k1603cchwC7</a></p>\n\n<p>I wouldn't do this.</p>\n"}], "owner": {"reputation": 4600, "user_id": 310298, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/PkUnq.png?s=128&g=1", "display_name": "itaysk", "link": "https://stackoverflow.com/users/310298/itaysk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 57453218, "answer_count": 2, "score": 0, "last_activity_date": 1565561834, "creation_date": 1565551154, "last_edit_date": 1565556895, "question_id": 57452888, "link": "https://stackoverflow.com/questions/57452888/find-and-delete-nested-json-object-in-go", "title": "find and delete nested json object in Go", "body": "<p>I have a json document of a Kubernetes Pod, here's an example: \n<a href=\"https://github.com/itaysk/kubectl-neat/blob/master/test/fixtures/pod-1-raw.json\" rel=\"nofollow noreferrer\">https://github.com/itaysk/kubectl-neat/blob/master/test/fixtures/pod-1-raw.json</a></p>\n\n<p>I'd like to traverse <code>spec.containers[i].volumeMounts</code> and delete those volumeMount objects where the <code>.name</code> starts with <code>\"default-token-\"</code>. Note that both <code>containers</code> and <code>volumeMounts</code> are arrays.</p>\n\n<p>Using jq it took me 1 min to write this 1 line: <code>try del(.spec.containers[].volumeMounts[] | select(.name | startswith(\"default-token-\")))</code>. I'm trying to rewrite this in Go.</p>\n\n<p>While looking for a good json library I settled on gjson/sjson.\nSince <a href=\"https://github.com/tidwall/sjson/issues/11\" rel=\"nofollow noreferrer\">sjson doesn't support array accessors</a> (the <code>#</code> syntax), and gjson doesn't support getting the path of result, I looked for workarounds.<br>\nI've tried using <code>Result.Index</code> do delete the the result from the byte slice directly, and succeeded, but for the query I wrote (<code>spec.containers.#.volumeMounts.#(name%\\\"default-token-*\\\")|0</code>) the Index is always 0 (I tried different variations of it, same result).<br>\nSo currently I have some code 25 line code that uses gjson to get <code>spec.containers.#.volumeMounts</code> and iterate it's way through the structure and eventually use <code>sjson.Delete</code> to delete.\nIt works, but it feels way more complicated then I expected it to be.</p>\n\n<p>Is there a better way to do this in Go? I'm willing to switch json library if needed.</p>\n\n<p>EDIT: I would prefer to avoid using a typed schema because I may need to perform this on different types, for some I don't have the full schema.<br>\n(also removed some distracting details about my current implemetation)</p>\n"}, {"tags": ["algorithm", "go", "red-black-tree"], "comments": [{"owner": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565540408, "post_id": 57451610, "comment_id": 101378093, "body": "which complexity did you expect?"}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565540500, "post_id": 57451610, "comment_id": 101378114, "body": "@mangusta time complexity. The benchmark&#39;s ns/op is increased by problem size, so it represents time complexity."}, {"owner": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565541233, "post_id": 57451610, "comment_id": 101378322, "body": "I know that you&#39;re talking about time complexity, I mean which time complexity did you expect."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "reply_to_user": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565541292, "post_id": 57451610, "comment_id": 101378330, "body": "@mangusta order log n"}, {"owner": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565541597, "post_id": 57451610, "comment_id": 101378392, "body": "so for example in case of &quot;BenchmarkRBTree/size-50000-8&quot; that &quot;ns/op&quot; value implies time spent on a single tree operation performed on the tree of size 50000 ?"}, {"owner": {"reputation": 3108, "user_id": 1556820, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cffaba688aa3f0f21ece8e09c9450e37?s=128&d=identicon&r=PG", "display_name": "mangusta", "link": "https://stackoverflow.com/users/1556820/mangusta"}, "edited": false, "score": 0, "creation_date": 1565542224, "post_id": 57451610, "comment_id": 101378515, "body": "It depends on what your benchmark is calculating, that&#39;s why I&#39;m asking my second question. If it calculates total time for insertion of ALL elements into the tree, then naturally the time will not be standing even close to logn"}, {"owner": {"reputation": 94553, "user_id": 775806, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/XNd2C.png?s=128&g=1", "display_name": "n. &#39;pronouns&#39; m.", "link": "https://stackoverflow.com/users/775806/n-pronouns-m"}, "edited": false, "score": 0, "creation_date": 1565543164, "post_id": 57451610, "comment_id": 101378693, "body": "It looks like you expect to insert N elements into an RB-tree in O(log N) time. Color me pessimistic but my gut feeling is that it ain&#39;t gonna happen."}, {"owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "edited": false, "score": 0, "creation_date": 1565544750, "post_id": 57451610, "comment_id": 101379072, "body": "I am sincerely sorry, this was a bad question, the benchmark was wrongly implemented! Thank you all!"}], "answers": [{"tags": [], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "is_accepted": true, "score": 3, "last_activity_date": 1565551838, "last_edit_date": 1565551838, "creation_date": 1565545618, "answer_id": 57452251, "question_id": 57451610, "link": "https://stackoverflow.com/questions/57451610/why-my-red-black-tree-implementation-benchmark-shows-linear-time-complexity/57452251#57452251", "title": "Why my red-black tree implementation benchmark shows linear time complexity?", "body": "<p>The benchmark was wrongly implemented, a correct version:</p>\n\n<pre><code>func BenchmarkRBTree_Put(b *testing.B) {\n    count := 0\n    grow := 1\n    for size := 0; size &lt; 100000; size += 1 * grow {\n        if count%10 == 0 {\n            count = 1\n            grow *= 10\n        }\n        b.Run(fmt.Sprintf(\"size-%d\", size), func(b *testing.B) {\n            // prepare problem size\n            tree := NewRBTree(func(a, b interface{}) bool {\n                if a.(int) &lt; b.(int) {\n                    return true\n                }\n                return false\n            })\n            for n := 0; n &lt; size-1; n++ {\n                tree.Put(n, n)\n            }\n            b.ResetTimer()\n            for i := 0; i &lt; b.N; i++ {\n                tree.Put(size, size) // only measure the last operation\n            }\n        })\n        count++\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/MmZ4Q.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/MmZ4Q.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 1022, "user_id": 3819460, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oZU0t.png?s=128&g=1", "display_name": "Jakob", "link": "https://stackoverflow.com/users/3819460/jakob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 1, "accepted_answer_id": 57452251, "answer_count": 1, "score": 1, "last_activity_date": 1565551838, "creation_date": 1565539922, "last_edit_date": 1565540514, "question_id": 57451610, "link": "https://stackoverflow.com/questions/57451610/why-my-red-black-tree-implementation-benchmark-shows-linear-time-complexity", "title": "Why my red-black tree implementation benchmark shows linear time complexity?", "body": "<p>The implementation basically follows <a href=\"https://en.wikipedia.org/wiki/Red%E2%80%93black_tree\" rel=\"nofollow noreferrer\">wiki</a>. </p>\n\n<p>Here is how I implemented the benchmark, in this case, it is benchmarking <code>Put</code> op:</p>\n\n<pre><code>func BenchmarkRBTree(b *testing.B) {\n    for size := 0; size &lt; 1000; size += 100 {\n        b.Run(fmt.Sprintf(\"size-%d\", size), func(b *testing.B) {\n            tree := NewRBTree(func(a, b interface{}) bool {\n                if a.(int) &lt; b.(int) {\n                    return true\n                }\n                return false\n            })\n            for i := 0; i &lt; b.N; i++ {\n                for n := 0; n &lt; size; n++ {\n                    tree.Put(n, n)\n                }\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>The benchmark results:</p>\n\n<pre><code>BenchmarkRBTree/size-0-8              2000000000              0.49 ns/op               0 B/op          0 allocs/op\nBenchmarkRBTree/size-100-8                200000             11170 ns/op            7984 B/op        298 allocs/op\nBenchmarkRBTree/size-200-8                100000             26450 ns/op           15984 B/op        598 allocs/op\nBenchmarkRBTree/size-300-8                 50000             38838 ns/op           23984 B/op        898 allocs/op\nBenchmarkRBTree/size-400-8                 30000             55460 ns/op           31984 B/op       1198 allocs/op\nBenchmarkRBTree/size-500-8                 20000             62654 ns/op           39984 B/op       1498 allocs/op\nBenchmarkRBTree/size-600-8                 20000             80317 ns/op           47984 B/op       1798 allocs/op\nBenchmarkRBTree/size-700-8                 20000             91308 ns/op           55984 B/op       2098 allocs/op\nBenchmarkRBTree/size-800-8                 10000            106180 ns/op           63984 B/op       2398 allocs/op\nBenchmarkRBTree/size-900-8                 10000            121026 ns/op           71984 B/op       2698 allocs/op\n</code></pre>\n\n<p>A visual line chart of <code>ns/op</code>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/UtZmD.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UtZmD.png\" alt=\"enter image description here\"></a></p>\n\n<p>Even I increase the problem size:</p>\n\n<pre><code>BenchmarkRBTree/size-0-8              2000000000              0.50 ns/op               0 B/op          0 allocs/op\nBenchmarkRBTree/size-10000-8                1000           1622187 ns/op          799989 B/op      29998 allocs/op\nBenchmarkRBTree/size-20000-8                 500           3693875 ns/op         1599994 B/op      59998 allocs/op\nBenchmarkRBTree/size-30000-8                 300           5693788 ns/op         2399998 B/op      89998 allocs/op\nBenchmarkRBTree/size-40000-8                 200           7663705 ns/op         3199998 B/op     119998 allocs/op\nBenchmarkRBTree/size-50000-8                 200           9869095 ns/op         3999997 B/op     149998 allocs/op\nBenchmarkRBTree/size-60000-8                 100          12133795 ns/op         4799999 B/op     179998 allocs/op\nBenchmarkRBTree/size-70000-8                 100          15422763 ns/op         5599999 B/op     209998 allocs/op\nBenchmarkRBTree/size-80000-8                 100          16140037 ns/op         6399998 B/op     239998 allocs/op\nBenchmarkRBTree/size-90000-8                 100          18161217 ns/op         7199997 B/op     269998 allocs/op\n</code></pre>\n\n<p>Visual chart:</p>\n\n<p><a href=\"https://i.stack.imgur.com/F988E.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/F988E.png\" alt=\"enter image description here\"></a></p>\n\n<p>You can check the code in <a href=\"https://play.golang.org/p/wmQi5u53KE_W\" rel=\"nofollow noreferrer\">Playground</a>, or a lengthy version:</p>\n\n<pre><code>type color uint32\n\nconst (\n    red color = iota\n    black\n)\n\ntype rbnode struct {\n    c      color\n    left   *rbnode\n    right  *rbnode\n    parent *rbnode\n    k, v   interface{}\n}\n\nfunc (n *rbnode) color() color {\n    if n == nil {\n        return black\n    }\n    return n.c\n}\n\nfunc (n *rbnode) grandparent() *rbnode {\n    return n.parent.parent\n}\n\nfunc (n *rbnode) uncle() *rbnode {\n    if n.parent == n.grandparent().left {\n        return n.grandparent().right\n    }\n    return n.grandparent().left\n}\n\nfunc (n *rbnode) sibling() *rbnode {\n    if n == n.parent.left {\n        return n.parent.right\n    }\n    return n.parent.left\n}\n\nfunc (n *rbnode) maximumNode() *rbnode {\n    for n.right != nil {\n        n = n.right\n    }\n    return n\n}\n\n// RBTree is a red-black tree\ntype RBTree struct {\n    root *rbnode\n    len  int\n    less Less\n}\n\n// Less returns true if a &lt; b\ntype Less func(a, b interface{}) bool\n\n// NewRBTree creates a red-black tree\nfunc NewRBTree(less Less) *RBTree {\n    return &amp;RBTree{less: less}\n}\n\n// Len returns the size of the tree\nfunc (t *RBTree) Len() int {\n    return t.len\n}\n\n// Put stores the value by given key\nfunc (t *RBTree) Put(key, value interface{}) {\n    var insertedNode *rbnode\n\n    new := &amp;rbnode{k: key, v: value, c: red}\n    if t.root != nil {\n        node := t.root\n    LOOP:\n        for {\n            switch {\n            case t.less(key, node.k):\n                if node.left == nil {\n                    node.left = new\n                    insertedNode = node.left\n                    break LOOP\n                }\n                node = node.left\n            case t.less(node.k, key):\n                if node.right == nil {\n                    node.right = new\n                    insertedNode = node.right\n                    break LOOP\n                }\n                node = node.right\n            default: // =\n                node.k = key\n                node.v = value\n                return\n            }\n        }\n        insertedNode.parent = node\n    } else {\n        t.root = new\n        insertedNode = t.root\n    }\n    t.insertCase1(insertedNode)\n    t.len++\n}\n\nfunc (t *RBTree) insertCase1(n *rbnode) {\n    if n.parent == nil {\n        n.c = black\n        return\n    }\n    t.insertCase2(n)\n}\nfunc (t *RBTree) insertCase2(n *rbnode) {\n    if n.parent.color() == black {\n        return\n    }\n    t.insertCase3(n)\n}\nfunc (t *RBTree) insertCase3(n *rbnode) {\n    if n.uncle().color() == red {\n        n.parent.c = black\n        n.uncle().c = black\n        n.grandparent().c = red\n        t.insertCase1(n.grandparent())\n        return\n    }\n    t.insertCase4(n)\n\n}\nfunc (t *RBTree) insertCase4(n *rbnode) {\n    if n == n.parent.right &amp;&amp; n.parent == n.grandparent().left {\n        t.rotateLeft(n.parent)\n        n = n.left\n    } else if n == n.parent.left &amp;&amp; n.parent == n.grandparent().right {\n        t.rotateRight(n.parent)\n        n = n.right\n    }\n    t.insertCase5(n)\n}\nfunc (t *RBTree) insertCase5(n *rbnode) {\n    n.parent.c = black\n    n.grandparent().c = red\n    if n == n.parent.left &amp;&amp; n.parent == n.grandparent().left {\n        t.rotateRight(n.grandparent())\n        return\n    } else if n == n.parent.right &amp;&amp; n.parent == n.grandparent().right {\n        t.rotateLeft(n.grandparent())\n    }\n}\n\nfunc (t *RBTree) replace(old, new *rbnode) {\n    if old.parent == nil {\n        t.root = new\n    } else {\n        if old == old.parent.left {\n            old.parent.left = new\n        } else {\n            old.parent.right = new\n        }\n    }\n    if new != nil {\n        new.parent = old.parent\n    }\n}\n\nfunc (t *RBTree) rotateLeft(n *rbnode) {\n    right := n.right\n    t.replace(n, right)\n    n.right = right.left\n    if right.left != nil {\n        right.left.parent = n\n    }\n    right.left = n\n    n.parent = right\n}\nfunc (t *RBTree) rotateRight(n *rbnode) {\n    left := n.left\n    t.replace(n, left)\n    n.left = left.right\n    if left.right != nil {\n        left.right.parent = n\n    }\n    left.right = n\n    n.parent = left\n}\n\n// Get returns the stored value by given key\nfunc (t *RBTree) Get(key interface{}) interface{} {\n    n := t.find(key)\n    if n == nil {\n        return nil\n    }\n    return n.v\n}\n\nfunc (t *RBTree) find(key interface{}) *rbnode {\n    n := t.root\n    for n != nil {\n        switch {\n        case t.less(key, n.k):\n            n = n.left\n        case t.less(n.k, key):\n            n = n.right\n        default:\n            return n\n        }\n    }\n    return nil\n}\n\n// Del deletes the stored value by given key\nfunc (t *RBTree) Del(key interface{}) {\n    var child *rbnode\n\n    n := t.find(key)\n    if n == nil {\n        return\n    }\n\n    if n.left != nil &amp;&amp; n.right != nil {\n        pred := n.left.maximumNode()\n        n.k = pred.k\n        n.v = pred.v\n        n = pred\n    }\n\n    if n.left == nil || n.right == nil {\n        if n.right == nil {\n            child = n.left\n        } else {\n            child = n.right\n        }\n        if n.c == black {\n            n.c = child.color()\n            t.delCase1(n)\n        }\n\n        t.replace(n, child)\n        if n.parent == nil &amp;&amp; child != nil {\n            child.c = black\n        }\n    }\n    t.len--\n}\n\nfunc (t *RBTree) delCase1(n *rbnode) {\n    if n.parent == nil {\n        return\n    }\n\n    t.delCase2(n)\n}\nfunc (t *RBTree) delCase2(n *rbnode) {\n    sibling := n.sibling()\n    if sibling.color() == red {\n        n.parent.c = red\n        sibling.c = black\n        if n == n.parent.left {\n            t.rotateLeft(n.parent)\n        } else {\n            t.rotateRight(n.parent)\n        }\n    }\n    t.delCase3(n)\n}\nfunc (t *RBTree) delCase3(n *rbnode) {\n    sibling := n.sibling()\n    if n.parent.color() == black &amp;&amp;\n        sibling.color() == black &amp;&amp;\n        sibling.left.color() == black &amp;&amp;\n        sibling.right.color() == black {\n        sibling.c = red\n        t.delCase1(n.parent)\n        return\n    }\n    t.delCase4(n)\n}\nfunc (t *RBTree) delCase4(n *rbnode) {\n    sibling := n.sibling()\n    if n.parent.color() == red &amp;&amp;\n        sibling.color() == black &amp;&amp;\n        sibling.left.color() == black &amp;&amp;\n        sibling.right.color() == black {\n        sibling.c = red\n        n.parent.c = black\n        return\n    }\n    t.delCase5(n)\n}\nfunc (t *RBTree) delCase5(n *rbnode) {\n    sibling := n.sibling()\n    if n == n.parent.left &amp;&amp;\n        sibling.color() == black &amp;&amp;\n        sibling.left.color() == red &amp;&amp;\n        sibling.right.color() == black {\n        sibling.c = red\n        sibling.left.c = black\n        t.rotateRight(sibling)\n    } else if n == n.parent.right &amp;&amp;\n        sibling.color() == black &amp;&amp;\n        sibling.right.color() == red &amp;&amp;\n        sibling.left.color() == black {\n        sibling.c = red\n        sibling.right.c = black\n        t.rotateLeft(sibling)\n    }\n    t.delCase6(n)\n}\nfunc (t *RBTree) delCase6(n *rbnode) {\n    sibling := n.sibling()\n    sibling.c = n.parent.color()\n    n.parent.c = black\n    if n == n.parent.left &amp;&amp; sibling.right.color() == red {\n        sibling.right.c = black\n        t.rotateLeft(n.parent)\n        return\n    }\n    sibling.left.c = black\n    t.rotateRight(n.parent)\n}\n</code></pre>\n"}, {"tags": ["string", "go", "double-quotes"], "comments": [{"owner": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "edited": false, "score": 0, "creation_date": 1565531707, "post_id": 57450500, "comment_id": 101376152, "body": "Firstly, <code>if c = `&quot;` {</code> should be <code>if c == `&quot;` {</code> (You are using a single equals sign where you mean to use a double one)."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "edited": false, "score": 1, "creation_date": 1565531815, "post_id": 57450500, "comment_id": 101376178, "body": "What @Collierre said, and also it&#39;s <code>&#39;&quot;&#39;</code>, not <code>`&quot;`</code>. <code>c</code> is not a string but a rune, so use single quotes to construct a rune."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1565531964, "post_id": 57450500, "comment_id": 101376215, "body": "... another thing, Go does not allow to use <code>{</code> on a new line. So reformat your code, it&#39;s not only unreadable but also invalid syntactically."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565531972, "post_id": 57450500, "comment_id": 101376218, "body": "OK, it works with <code>c == &#39;&quot;&#39;</code> and correction of <code>{</code>. Why are characters called <code>rune</code> in golang?"}, {"owner": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "edited": false, "score": 0, "creation_date": 1565532060, "post_id": 57450500, "comment_id": 101376241, "body": "@rnso, is there some reason you can&#39;t use regex for this?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565532144, "post_id": 57450500, "comment_id": 101376259, "body": "I am not well versed with regex. I did ask for better approaches. I will appreciate an answer using regex."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1565532154, "post_id": 57450500, "comment_id": 101376261, "body": "Go uses UTF-8 for source code. A rune allows go to represent any character in the UTF-8 number-space."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565532691, "post_id": 57450500, "comment_id": 101376390, "body": "@rnso I don&#39;t know why they chose that name, but you could speculate that they decided not to use <code>char</code> since that type in some other languages is known to hold exactly one byte of data and not more, while a <code>rune</code> may hold more than just one byte and so to avoid confusion they chose the latter. But that&#39;s just the first thing that came to my mind, if you really want to know you may go to the go-nuts mailing list and try to solicit the answer from the Go team."}], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565532914, "post_id": 57450677, "comment_id": 101376449, "body": "Great. What if there are more than one quoted strings in <code>oristr</code>?"}, {"owner": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1565533818, "post_id": 57450677, "comment_id": 101376629, "body": "I&#39;ve modified it now to support that."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 1, "creation_date": 1565586035, "post_id": 57450677, "comment_id": 101385587, "body": "With <code>&quot;[^&quot;]*&quot;</code> (<code>*</code> instead of <code>+</code>), even <code>&quot;&quot;</code> will be picked up correctly."}], "tags": [], "owner": {"reputation": 827, "user_id": 1697563, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3481471c4bbf2279945c7ab2d08d6aa2?s=128&d=identicon&r=PG&f=1", "display_name": "Collierre", "link": "https://stackoverflow.com/users/1697563/collierre"}, "is_accepted": true, "score": 0, "last_activity_date": 1565534164, "last_edit_date": 1565534164, "creation_date": 1565532764, "answer_id": 57450677, "question_id": 57450500, "link": "https://stackoverflow.com/questions/57450500/extracting-quoted-part-from-string/57450677#57450677", "title": "Extracting quoted part from string", "body": "<p>This is the most basic way of getting what you want. It could be improved to be more robust etc.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    var oristr = \"This is a \\\"test string\\\" for containing multiple \\\"test strings\\\" and another \\\"one\\\" here\"\n    re := regexp.MustCompile(`\"[^\"]+\"`)\n    newStrs := re.FindAllString(oristr, -1)\n    for _, s := range newStrs {\n        fmt.Println(s)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "closed_date": 1565724242, "accepted_answer_id": 57450677, "answer_count": 1, "score": -2, "last_activity_date": 1565534164, "creation_date": 1565531313, "question_id": 57450500, "link": "https://stackoverflow.com/questions/57450500/extracting-quoted-part-from-string", "closed_reason": "Not suitable for this site", "title": "Extracting quoted part from string", "body": "<p>I am trying following code to extract quoted part from a string: </p>\n\n<pre><code>package main\nimport (\"fmt\")\nfunc main(){\n    var oristr = \"This is a \\\"test string\\\" for testing only\"\n    var quotedstr = \"\"\n    var newstr = \"\"\n    var instring = false\n    fmt.Println(oristr)\n    for i,c := range oristr {\n        fmt.Printf(\"Char number: %d; char: %c\\n\", i, c);\n        if c = `\"` {\n            if instring\n            {instring=false}\n            else {instring=true}}\n        if instring\n        {quotedstr += c}\n        else {newstr += c}\n    }\n    fmt.Printf(\"Newstr: %s; quotedstr = %s\", newstr, quotedstr )\n}\n</code></pre>\n\n<p>However, I am getting following error: </p>\n\n<pre><code># command-line-arguments\n./getstring.go:11:14: syntax error: c = `\"` used as value\n./getstring.go:12:15: syntax error: unexpected newline, expecting { after if clause\n./getstring.go:14:4: syntax error: unexpected else, expecting }\n./getstring.go:15:3: syntax error: non-declaration statement outside function body\n</code></pre>\n\n<p>Why I am getting this error and how can this be corrected? </p>\n\n<p>Also, is this approach all right or some other approach may be better?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "is_accepted": true, "score": 1, "last_activity_date": 1565530689, "creation_date": 1565530689, "answer_id": 57450414, "question_id": 57450260, "link": "https://stackoverflow.com/questions/57450260/go-cannot-parse-nested-struct/57450414#57450414", "title": "Go - cannot parse nested struct", "body": "<p>Fields in your <code>action</code> struct should be exported :</p>\n\n<pre><code>type action struct {\n    Time string // notice the first capital letter\n    Name string\n    Data string\n}\n</code></pre>\n\n<p>You should then get the expected result :</p>\n\n<pre><code>{some@mail.ru some_account some_branch some_token [{12:12:12 some_name some_data} {12:12:12 some_name1 some_data1}]}\n</code></pre>\n"}], "owner": {"reputation": 5549, "user_id": 4730700, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e3697471edf3aff3b59521d6d8b8152d?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey K", "link": "https://stackoverflow.com/users/4730700/alexey-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 23, "favorite_count": 0, "closed_date": 1565741950, "accepted_answer_id": 57450414, "answer_count": 1, "score": -4, "last_activity_date": 1565530689, "creation_date": 1565529522, "question_id": 57450260, "link": "https://stackoverflow.com/questions/57450260/go-cannot-parse-nested-struct", "closed_reason": "Not suitable for this site", "title": "Go - cannot parse nested struct", "body": "<p>I have following structs</p>\n\n<pre><code>type logs struct {\n    Email      string\n    Account    string\n    BranchName string `json:\"branch_name\"`\n    Token      string\n    Actions    []action\n}\n\ntype action struct {\n    time string\n    name string\n    data string\n}\n</code></pre>\n\n<p>And code to parse</p>\n\n<pre><code>func logsHandler(writer http.ResponseWriter, request *http.Request) {\n    decoder := json.NewDecoder(request.Body)\n    var l logs\n    err := decoder.Decode(&amp;l)\n    if err != nil {\n        panic(err)\n    }\n\n    writeResponse(\"ok\", http.StatusOK, writer)\n\n    sendLogsEmail(l)\n}\n</code></pre>\n\n<p>And json</p>\n\n<pre><code>{\n    \"email\": \"some@mail.ru\",\n    \"account\": \"some_account\",\n    \"branch_name\": \"some_branch\",\n    \"token\": \"some_token\",\n    \"actions\": [\n        {\n            \"time\": \"12:12:12\",\n            \"name\": \"some_name\",\n            \"data\": \"some_data\"\n        },\n        {\n            \"time\": \"12:12:12\",\n            \"name\": \"some_name1\",\n            \"data\": \"some_data1\"\n        }\n    ]\n}\n</code></pre>\n\n<p>And I get output when parse</p>\n\n<pre><code>{some@mail.ru some_account some_branch some_token [{  } {  }]}\n</code></pre>\n\n<p>What am I doing wrong ?</p>\n"}, {"tags": ["go", "directory", "upload"], "answers": [{"tags": [], "owner": {"reputation": 3517, "user_id": 8069748, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/g9ZD9.png?s=128&g=1", "display_name": "Navid Zarepak", "link": "https://stackoverflow.com/users/8069748/navid-zarepak"}, "is_accepted": true, "score": 0, "last_activity_date": 1565518564, "creation_date": 1565518564, "answer_id": 57449110, "question_id": 57447963, "link": "https://stackoverflow.com/questions/57447963/how-to-upload-directories-to-golang-server-from-html/57449110#57449110", "title": "how to upload directories to golang server from html?", "body": "<p>HTML does allow you to select folders to upload but it's not the way you want. You can make some changes to achieve what you need.</p>\n\n<p>First, take a look at this answer on how to handle folder selects on HTML input:\n<a href=\"https://stackoverflow.com/questions/3590058\">Does HTML5 allow drag-drop upload of folders or a folder tree?</a></p>\n\n<p>Now if you want the folders too and not just the files, you can send the data in a way that you know which folder they belong and you can create the folders on your golang server or handle them any other way you might want. But if you just need the files, then that answer should be good enough for you.</p>\n"}], "owner": {"reputation": 3, "user_id": 6660065, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NxRhO.jpg?s=128&g=1", "display_name": "XiaoHui", "link": "https://stackoverflow.com/users/6660065/xiaohui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "closed_date": 1565528313, "accepted_answer_id": 57449110, "answer_count": 1, "score": -1, "last_activity_date": 1565518564, "creation_date": 1565506646, "question_id": 57447963, "link": "https://stackoverflow.com/questions/57447963/how-to-upload-directories-to-golang-server-from-html", "closed_reason": "Not suitable for this site", "title": "how to upload directories to golang server from html?", "body": "<p>I found many tutorials about uploading files from html input file type to golang server. But I can't find a proper way of how folders are uploaded to golang server and how golang server handle those folders.\nIs there any tutorial or reference i can follow?</p>\n"}, {"tags": ["go", "locking", "mutex", "reentrancy"], "comments": [{"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 1, "creation_date": 1565508849, "post_id": 57447879, "comment_id": 101371837, "body": "related: <a href=\"https://stackoverflow.com/q/14670979/1256452\">stackoverflow.com/q/14670979/1256452</a>"}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 3, "last_activity_date": 1565510160, "creation_date": 1565510160, "answer_id": 57448288, "question_id": 57447879, "link": "https://stackoverflow.com/questions/57447879/detect-the-same-goroutine-calling-sync-mutex-lock-twice-in-a-row/57448288#57448288", "title": "Detect the same goroutine calling sync.Mutex.Lock() twice in a row", "body": "<p>Go's <code>sync.Mutex</code> objects do not keep track of which goroutine locked them.  Or, to put it another way, there <em>isn't</em> a locking thread: there is just a data lock.</p>\n\n<p>Moreover, as the comment just above <a href=\"https://golang.org/src/sync/mutex.go?s=5772:5796#L165\" rel=\"nofollow noreferrer\"><code>Unlock</code></a> says, you can unlock them from some other goroutine than the one that locked them.  Hence it can actually make sense to call <code>Lock</code> twice.  Here's a skeleton example:</p>\n\n<pre><code>func f() {\n    mu.Lock()\n    ... if this is not just an example, some code goes here ...\n    // now wait for g() to call mu.Unlock()\n    mu.Lock()\n    fmt.Println(\"we got here, so g() must have done an unlock\")\n    mu.Unlock()\n}\n\nfunc g() {\n    ... some code probably goes here too ...\n    mu.Unlock() // allow f() to proceed\n    ... more code, perhaps ...\n}\n</code></pre>\n\n<p>In this case we would not want a panic in <code>f</code>'s second <code>Lock</code> call.</p>\n\n<p>You can build your own recursive locks or other techniques, but since the internal ID of each goroutine is hidden, it's <a href=\"https://stackoverflow.com/a/14673524/1256452\">pretty tricky</a>.  There's a link to <a href=\"https://github.com/jwells131313/goethe\" rel=\"nofollow noreferrer\">an implementation</a> in the comments at <a href=\"https://stackoverflow.com/a/14671462/1256452\">this answer</a> to <a href=\"https://stackoverflow.com/q/14670979/1256452\">Recursive locking in Go</a>, but I've never used it, or even looked closely at it.</p>\n"}], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1272, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1565535431, "creation_date": 1565505691, "last_edit_date": 1565535431, "question_id": 57447879, "link": "https://stackoverflow.com/questions/57447879/detect-the-same-goroutine-calling-sync-mutex-lock-twice-in-a-row", "title": "Detect the same goroutine calling sync.Mutex.Lock() twice in a row", "body": "<p>This code (a single threaded program) will never work:</p>\n\n<pre><code>func TestDoubleLockPanics(t *testing.T) {\n    var mu sync.Mutex\n    mu.Lock()\n    mu.Lock()\n}\n</code></pre>\n\n<p>However, when I run this test, there's no panic. The race detector does not print out a data race. <code>go vet</code> does not complain, there's no log message, it just blocks forever.</p>\n\n<p>(The actual real-life code I care about is, obviously, not this simple - I've just boiled it down to the essence.)</p>\n\n<p>Is there any way to get Go to tell me, loudly, when a thread that holds a lock attempts to re-acquire the same lock?</p>\n"}, {"tags": ["go", "gota"], "comments": [{"owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "edited": false, "score": 1, "creation_date": 1565494267, "post_id": 57447157, "comment_id": 101370188, "body": "Have you tried using a map[string][]string to collect items with same &quot;A column&quot; value?"}, {"owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "reply_to_user": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "edited": false, "score": 0, "creation_date": 1565495020, "post_id": 57447157, "comment_id": 101370240, "body": "No, I don&#39;t know how to do it."}, {"owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "edited": false, "score": 0, "creation_date": 1565495897, "post_id": 57447157, "comment_id": 101370310, "body": "Well I&#39;ve converted the idea into an answer. Hope you find that helpful"}, {"owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "edited": false, "score": 0, "creation_date": 1565495957, "post_id": 57447157, "comment_id": 101370317, "body": "Also, it seems you&#39;re new to Go, so check out <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">blog.golang.org/go-slices-usage-and-internals</a> and <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow noreferrer\">blog.golang.org/go-maps-in-action</a> to get an idea of those two very useful Go data types."}], "answers": [{"tags": [], "owner": {"reputation": 448, "user_id": 3946355, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51adb3fdec323f447fd70f20e76866d6?s=128&d=identicon&r=PG&f=1", "display_name": "Chang Qian", "link": "https://stackoverflow.com/users/3946355/chang-qian"}, "is_accepted": true, "score": 1, "last_activity_date": 1565495823, "creation_date": 1565495823, "answer_id": 57447262, "question_id": 57447157, "link": "https://stackoverflow.com/questions/57447157/group-string-2d-slice-by-row-value/57447262#57447262", "title": "group [][]string (2D slice) by row value", "body": "<p>The following <code>group()</code> function utilizes a map to collect input string slices with the same [0] element, and then converts it back to 2D slice. This will do your work:</p>\n\n<pre><code>func group(input [][]string) (output [][]string) {\n    tmp := map[string][]string{}\n    for _, slice := range input {\n        if len(slice) &lt;= 1 {\n            continue\n        }\n        tmp[slice[0]] = append(tmp[slice[0]], slice[1:]...)\n    }\n    for k := range tmp {\n        v := append([]string{k}, tmp[k]...)\n        output = append(output, v)\n    }\n    return\n}\n\nfunc main() {\n    input := [][]string{\n        []string{\"b\", \"3\", \"2.9\", \"5.3\"},\n        []string{\"a\", \"4\", \"5.1\", \"9.1\"},\n        []string{\"b\", \"4\", \"6.0\", \"5.3\"},\n        []string{\"c\", \"3\", \"6.0\", \"5.5\"},\n        []string{\"a\", \"2\", \"7.1\", \"9.2\"},\n    }\n    fmt.Println(group(input)) // [[a 4 5.1 9.1 2 7.1 9.2] [c 3 6.0 5.5] [b 3 2.9 5.3 4 6.0 5.3]]\n}\n</code></pre>\n\n<p>Analysis of the above code is left as exercise. :)</p>\n"}], "owner": {"reputation": 95, "user_id": 8660255, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/deab6881d51059ce496b8146ed41fc9e?s=128&d=identicon&r=PG&f=1", "display_name": "Morteza Hasanabadi", "link": "https://stackoverflow.com/users/8660255/morteza-hasanabadi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 57447262, "answer_count": 1, "score": 0, "last_activity_date": 1565495823, "creation_date": 1565494029, "question_id": 57447157, "link": "https://stackoverflow.com/questions/57447157/group-string-2d-slice-by-row-value", "title": "group [][]string (2D slice) by row value", "body": "<p>I'm working with a 2D slice of string in go and I want to group them by \"A\" column value but I couldn't figure it out.</p>\n\n<p>I tried to use gota data frame but it also doesn't have group by like what is available in pandas.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    input := [][]string{\n        []string{\"b\", \"3\", \"2.9\", \"5.3\"},\n        []string{\"a\", \"4\", \"5.1\", \"9.1\"},\n        []string{\"b\", \"4\", \"6.0\", \"5.3\"},\n        []string{\"c\", \"3\", \"6.0\", \"5.5\"},\n        []string{\"a\", \"2\", \"7.1\", \"9.2\"},\n    }\n</code></pre>\n\n<p>I want to have output like this.</p>\n\n<p>[[b 3 2.9 5.3 4 6.0 5.3] [a 4 5.1 9.1 2 7.1 9.2] [c 3 6.0 5.5]]</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11912804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e03325451cb446c1f708cee30ce2664?s=128&d=identicon&r=PG&f=1", "display_name": "RK844", "link": "https://stackoverflow.com/users/11912804/rk844"}, "edited": false, "score": 0, "creation_date": 1565493962, "post_id": 57447107, "comment_id": 101370152, "body": "I added some printing to visualize what was happening and it makes more sense now. Thanks for the solution."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1565493439, "last_edit_date": 1565493439, "creation_date": 1565493036, "answer_id": 57447107, "question_id": 57446978, "link": "https://stackoverflow.com/questions/57446978/comparing-two-slices-for-missing-element/57447107#57447107", "title": "Comparing two slices for missing element", "body": "<blockquote>\n  <p>Comparing two slices for missing element</p>\n  \n  <p>I have two slices: <code>a[]string</code>, <code>b[]string</code>. <code>b</code> contains all the same\n  elements as <code>a</code> plus an extra.</p>\n</blockquote>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc missing(a, b []string) string {\n    ma := make(map[string]bool, len(a))\n    for _, ka := range a {\n        ma[ka] = true\n    }\n    for _, kb := range b {\n        if !ma[kb] {\n            return kb\n        }\n    }\n    return \"\"\n}\n\nfunc main() {\n    a := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"}\n    b := []string{\"a\", \"1sdsdfsdfsdsdf\", \"c\", \"d\", \"e\", \"f\", \"g\", \"b\"}\n    fmt.Println(missing(a, b))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>1sdsdfsdfsdsdf\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "is_accepted": false, "score": 0, "last_activity_date": 1565515270, "creation_date": 1565515270, "answer_id": 57448769, "question_id": 57446978, "link": "https://stackoverflow.com/questions/57446978/comparing-two-slices-for-missing-element/57448769#57448769", "title": "Comparing two slices for missing element", "body": "<pre><code>/*\nAn example of how to find the difference between two slices.\nThis example uses empty struct (0 bytes) for map values.\n*/\n\npackage main\n\nimport (\n    \"fmt\"\n)\n\n// empty struct (0 bytes)\ntype void struct{}\n\n// missing compares two slices and returns slice of differences\nfunc missing(a, b []string) []string {\n    // create map with length of the 'a' slice\n    ma := make(map[string]void, len(a))\n    diffs := []string{}\n    // Convert first slice to map with empty struct (0 bytes)\n    for _, ka := range a {\n        ma[ka] = void{}\n    }\n    // find missing values in a\n    for _, kb := range b {\n        if _, ok := ma[kb]; !ok {\n            diffs = append(diffs, kb)\n        }\n    }\n    return diffs\n}\n\nfunc main() {\n    a := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"}\n    b := []string{\"a\", \"c\", \"d\", \"e\", \"f\", \"g\", \"b\"}\n    c := []string{\"a\", \"b\", \"x\", \"y\", \"z\"}\n    fmt.Println(\"a and b diffs\", missing(a, b))\n    fmt.Println(\"a and c diffs\", missing(a, c))\n}\n</code></pre>\n\n<p>Output </p>\n\n<pre><code>a and b diffs []\na and c diffs [x y z]\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11912804, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e03325451cb446c1f708cee30ce2664?s=128&d=identicon&r=PG&f=1", "display_name": "RK844", "link": "https://stackoverflow.com/users/11912804/rk844"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 702, "favorite_count": 2, "accepted_answer_id": 57447107, "answer_count": 2, "score": 1, "last_activity_date": 1565515270, "creation_date": 1565490882, "last_edit_date": 1565493332, "question_id": 57446978, "link": "https://stackoverflow.com/questions/57446978/comparing-two-slices-for-missing-element", "title": "Comparing two slices for missing element", "body": "<p>I have two slices: <code>a[]string</code>, <code>b[]string</code>. <code>b</code> contains all the same elements as <code>a</code> plus an extra. The indexes:values don't match one another but the values do, otherwise I could do something like <code>strings.Join()</code> and <code>strings.Replace()</code>. Here's what I'm trying.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/google/go-cmp/cmp\"\n)\n\nfunc compare(start_keys []string, end_keys []string) string {\n    match := make([]string, len(start_keys))\n    q := 0\n    for i := 0; i &lt; len(end_keys); i++ {\n        for z := 0; z &lt; len(start_keys); z++ {\n            if end_keys[i] == start_keys[z] {\n                match[q] = start_keys[z]\n                q++\n            }\n        }\n    } // now matches known\n\n    for i := 0; i &lt; len(end_keys); i++ {\n        n := end_keys[i]   // current element to compare to\n        s := nip(match, n) // compare result\n        if s == true {     // if no matches, print\n            a := end_keys[i]\n            fmt.Println(\"Not present: \", a)\n        }\n        i++\n    }\n    fmt.Println(\"List=\", match)\n    return \"error\"\n}\n\nfunc nip(matches []string, element string) bool {\n    zyx := 0\n    for n := 0; n &lt; len(matches); n++ {\n        if matches[n] == element {\n            n++\n            zyx++\n        } else if matches[n] != element {\n            n++\n        }\n    }\n    if zyx == 0 {\n        return true\n    }\n    return false\n}\n\nfunc main() {\n    start_keys := []string{\"a\", \"b\", \"c\", \"d\", \"e\", \"f\", \"g\"}\n    end_keys := []string{\"a\", \"1sdsdfsdfsdsdf\", \"c\", \"d\", \"e\", \"f\", \"g\", \"b\"}\n\n    x := compare(start_keys, end_keys)\n\n    x = x\n    foo := cmp.Diff(start_keys, end_keys)\n    fmt.Println(foo)\n}\n</code></pre>\n\n<p><code>matches[]</code> holds what I expect but <code>nip()</code> is returning true on certain matches and not for the unique value <code>1sdsdfsdfsdsdf</code></p>\n\n<pre><code>a\na :::: a\nc\na :::: c\nd :::: c\nf :::: c\nb :::: c\nNot present:  c\ne\na :::: e\nd :::: e\nf :::: e\nb :::: e\nNot present:  e\ng\na :::: g\nd :::: g\nf :::: g\nb :::: g\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13635, "user_id": 1061413, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0beb915463288cb6e8b50e8121860717?s=128&d=identicon&r=PG", "display_name": "Amit Kumar Gupta", "link": "https://stackoverflow.com/users/1061413/amit-kumar-gupta"}, "edited": false, "score": 2, "creation_date": 1565474987, "post_id": 57445911, "comment_id": 101368166, "body": "If this needs to continue to work even when the strict fields change, it needs to dynamically determine the names and types of all the fields. There\u2019s almost certainly no way to do that without reflection or something equivalently expensive."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": true, "score": 2, "last_activity_date": 1567477752, "creation_date": 1567477752, "answer_id": 57764365, "question_id": 57445911, "link": "https://stackoverflow.com/questions/57445911/converting-a-struct-to-a-tuple-slice-without-reflection/57764365#57764365", "title": "Converting a struct to a tuple slice without reflection", "body": "<p>You're going to have to use reflection. I know reflection gets a bad rap performance-wise, but it's worth your time to try it and benchmark it before you write it off.</p>\n\n<p>Alternatively, you can use code generation - will probably still use reflection, but it would happen at codegen time to output go code that would be compiled together so the performance implication would not be at runtime.</p>\n"}], "owner": {"reputation": 297, "user_id": 7467314, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/8c4715513d18c3b7c8c20346296c85da?s=128&d=identicon&r=PG&f=1", "display_name": "user7467314", "link": "https://stackoverflow.com/users/7467314/user7467314"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 57764365, "answer_count": 1, "score": 0, "last_activity_date": 1567477752, "creation_date": 1565473544, "last_edit_date": 1565475113, "question_id": 57445911, "link": "https://stackoverflow.com/questions/57445911/converting-a-struct-to-a-tuple-slice-without-reflection", "title": "Converting a struct to a tuple slice without reflection", "body": "<p>I need to convert a <code>struct</code> into a <code>[]Tuple</code>. Each tuple will represent a path to each leaf node of the struct. For example:</p>\n\n<pre><code>type inner struct {\n  D int\n}\n\ntype Example struct {\n  A string\n  B *inner\n  C []inner\n}\n\ne := Example{\n  A: \"a\",\n  B: &amp;inner{\n    D: 0,\n  },\n  C: []inner{\n    inner{D:0}, inner{D:1}, inner{D:2},\n  },\n}\n\nfunc toTuple(e *Example) []Tuple {\n  // this function should return:\n  //  [\n  //    Tuple{\"A\", \"a\"}\n  //    Tuple{\"B\", \"D\", \"0\"}\n  //    Tuple{\"C\", 0, \"D\", 0}\n  //    Tuple{\"C\", 1, \"D\", 1}\n  //    Tuple{\"C\", 2, \"D\", 2}\n  //  ]\n}\n</code></pre>\n\n<p>Is there any way to do this without having to manually specify each Tuple? I want to avoid having to do stuff like:</p>\n\n<pre><code>tuples = append(tuples, Tuple{\"A\", e.A})\n...\n...\nfor i, v := range e.C {\n  tuples = append(tuples, Tuple{\"C\", i, \"D\", v.D}\n}\n</code></pre>\n\n<p>because the struct could be quite large and that would lead to brittle, error prone code (for example if a new field is added to the struct). </p>\n\n<p>As this is a performance sensitive application,  I'd like to avoid the use of reflection. Is there any way to accomplish this?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1565464088, "post_id": 57444917, "comment_id": 101365974, "body": "I guess that you must use a regex for this because it is an exercise? If it was for something real I&#39;d split on dots, verify I had four parts, convert each part to a number, and verify the number was between 0 and 255."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1565464334, "post_id": 57444917, "comment_id": 101366035, "body": "Also please get out of the habit of compiling regular expressions inside functions, and especially don&#39;t do it inside loops. See that <code>MustCompile</code> function which will panic if it fails? Stick that outside your function in a variable assignment, then it will run one time at program start."}, {"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1565490614, "post_id": 57444917, "comment_id": 101369849, "body": "Yes it is an exercise, but thanks for explaining how you&#39;d do it, seems like a much simpler solution. I used compile because as far as I know it doesn&#39;t panic, like mustCompile. Would a global variable still be the way to go?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1565497536, "post_id": 57444917, "comment_id": 101370460, "body": "If MustCompile panics then your regular expression is bad. That means a panic is what you want since your program is broken."}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "edited": false, "score": 0, "creation_date": 1565490424, "post_id": 57444979, "comment_id": 101369836, "body": "Hi yes, thank you this worked. Is there a difference between anchoring every piece, like so <code>(^25[0-5]$|^2[0-4][0-9]$|^1[0-9][0-9]$|^[1-9]?[0-9]$)</code> versus just the front and back of the parenthesis?"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 0, "last_activity_date": 1565464211, "creation_date": 1565464211, "answer_id": 57444979, "question_id": 57444917, "link": "https://stackoverflow.com/questions/57444917/ipv4-regexp-capturing-the-incorrect-parts-of-the-address/57444979#57444979", "title": "IPv4 regexp capturing the incorrect parts of the address", "body": "<p>I am pretty sure that your expression needs anchors or the last part of it will match any single digit and succeed. Try using <code>^</code> on the front and <code>$</code> on the back.</p>\n"}, {"comments": [{"owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "edited": false, "score": 1, "creation_date": 1566202818, "post_id": 57445040, "comment_id": 101567889, "body": "The RegEx circuit resource has been really helping me out, thanks!"}], "tags": [], "owner": {"reputation": 1, "user_id": 6553328, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/omcAX.jpg?s=128&g=1", "display_name": "Emma", "link": "https://stackoverflow.com/users/6553328/emma"}, "is_accepted": true, "score": 0, "last_activity_date": 1565464806, "creation_date": 1565464806, "answer_id": 57445040, "question_id": 57444917, "link": "https://stackoverflow.com/questions/57444917/ipv4-regexp-capturing-the-incorrect-parts-of-the-address/57445040#57445040", "title": "IPv4 regexp capturing the incorrect parts of the address", "body": "<p>Maybe, this expression might be closer to what you might have in mind:</p>\n\n<pre><code>^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$\n</code></pre>\n\n<h3>Test</h3>\n\n<pre><code>package main\n\nimport (\n    \"regexp\"\n    \"fmt\"\n)\n\nfunc main() {\n    var re = regexp.MustCompile(`(?m)^(?:(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)\\.){3}(?:25[0-5]|2[0-4]\\d|[01]?\\d\\d?)$`)\n    var str = `127.0.0.1\n192.168.1.1\n192.168.1.255\n255.255.255.255\n0.0.0.0\n1.1.1.01\n\n30.168.1.255.1\n127.1\n192.168.1.256\n-1.2.3.4\n3...3`\n\n    for i, match := range re.FindAllString(str, -1) {\n        fmt.Println(match, \"found at index\", i)\n    }\n}\n</code></pre>\n\n<p>The expression is explained on the top right panel of <a href=\"https://regex101.com/r/rS3lsF/1/\" rel=\"nofollow noreferrer\">regex101.com</a>, if you wish to explore/simplify/modify it, and in <a href=\"https://regex101.com/r/rS3lsF/1/debugger\" rel=\"nofollow noreferrer\">this link</a>, you can watch how it would match against some sample inputs, if you like.</p>\n\n<h3>Reference:</h3>\n\n<p><a href=\"https://stackoverflow.com/questions/5284147/validating-ipv4-addresses-with-regexp\">Validating IPv4 addresses with regexp</a></p>\n\n<h3>RegEx Circuit</h3>\n\n<p><a href=\"https://jex.im/regulex/#!flags=&amp;re=%5E(a%7Cb)*%3F%24\" rel=\"nofollow noreferrer\">jex.im</a> visualizes regular expressions: </p>\n\n<p><a href=\"https://i.stack.imgur.com/lqP69.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/lqP69.png\" alt=\"enter image description here\"></a></p>\n"}], "owner": {"reputation": 79, "user_id": 10763181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8300f7c062a34b0f6cba5491c63bd648?s=128&d=identicon&r=PG&f=1", "display_name": "MjBVala", "link": "https://stackoverflow.com/users/10763181/mjbvala"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "closed_date": 1565465427, "accepted_answer_id": 57445040, "answer_count": 2, "score": -2, "last_activity_date": 1565464806, "creation_date": 1565463753, "question_id": 57444917, "link": "https://stackoverflow.com/questions/57444917/ipv4-regexp-capturing-the-incorrect-parts-of-the-address", "closed_reason": "Duplicate", "title": "IPv4 regexp capturing the incorrect parts of the address", "body": "<p>I'm trying to write a program that prints the invalid part or parts of an IPv4 address from terminal input.</p>\n\n<p>Here is my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package chapter4\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"regexp\"\n    \"strings\"\n    \"time\"\n)\n\nfunc IPV4() {\n    var f *os.File\n    f = os.Stdin\n    defer f.Close()\n\n    scanner := bufio.NewScanner(f)\n    fmt.Println(\"Exercise 1, Chapter 4 - Detecting incorrect parts of IPv4 Addresses, enter an address!\")\n    for scanner.Scan() {\n\n        if scanner.Text() == \"STOP\" {\n            fmt.Println(\"Initializing Level 4...\")\n            time.Sleep(5 * time.Second)\n            break\n        }\n        expression := \"(25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9]?[0-9])\"\n        matchMe, err := regexp.Compile(expression)\n        if err != nil {\n            fmt.Println(\"Could not compile!\", err)\n        }\n\n        s := strings.Split(scanner.Text(), \".\")\n\n        for _, value := range s {\n            fmt.Println(value)\n            str := matchMe.FindString(value)\n            if len(str) == 0 {\n                fmt.Println(value)\n            }\n        }\n\n    }\n}\n</code></pre>\n\n<p>My thought process is that for every terminal IP address input, I split the string by '.'</p>\n\n<p>Then I iterate over the resulting <code>[]string</code> and match each value to the regular expression. </p>\n\n<p>For some reason the only case where the regex expression doesn't match is when there are letter characters in the input. Every number, no matter the size or composition, is a valid match for my expression.</p>\n\n<p>I'm hoping you can help me identify the problem, and if there's a better way to do it, I'm all ears. Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1565465217, "post_id": 57444888, "comment_id": 101366240, "body": "So, you need to split an io.Reader to many io.Readers without breaking up the lines?"}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1565465679, "post_id": 57444888, "comment_id": 101366351, "body": "Exactly. It&#39;s because, if I assert an io.ReadSeeker, then I don&#39;t know where to jump next in the stream. I want to split the incoming Reader to many Readers without breaking up the lines. I also want to continue using the bufio.Scanner if it&#39;s possible."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1565465812, "post_id": 57444888, "comment_id": 101366380, "body": "Even you manage to obtain multiple readers into the same file (which I doubt is cheaply possible), you don&#39;t want to do this on spinning rust disks (with SSD you&#39;d probably be fine)"}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1565466620, "post_id": 57444888, "comment_id": 101366554, "body": "Assuming that there is no fixed line length it is impossible to say upfront where each line starts and ends. This means one either would need to have multiple readers where each one only processes every n-th line (starting with a different offset) or have a single reader which reads every line and then hands the content over to a go routine which processes this line. The first way (multiple readers) has a larger overhead since the file will be fully read multiple times this way. A single reader which hands over the processing of a line to other go routines scales probably much better."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565466921, "post_id": 57444888, "comment_id": 101366619, "body": "If you have a seekable source, then it&#39;s easy to split the source approximately equal size chunks: seek to some position; read data to find line break; open new reader from previous break (or start of source) and limit reader to end at break. Note that on some devices, multiple readers may not provide a benefit over a single reader. If you have a network connection or some other source that&#39;s not seekable, the solution is to read lines from one goroutine and parse those lines in worker goroutines."}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1565467002, "post_id": 57444888, "comment_id": 101366636, "body": "@SergioTulentsev So, what&#39;s the better solution for parsing a huge file?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1565467046, "post_id": 57444888, "comment_id": 101366646, "body": "@JohnFitzgerald  Read from one goroutine, process lines in worker goroutines."}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "reply_to_user": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1565467133, "post_id": 57444888, "comment_id": 101366665, "body": "@SteffenUllrich If io.Reader bears an *os.File, I can assert that length, otherwise it&#39;s impossible yes. Actually, I&#39;ve tried the both ways. In the single reader case, there happens to be a lot of contention because the single reader throws the lines so fast. It&#39;s only 2x faster than the sequential one when I send the messages in batches (like 1000 at a time to the other readers: keeping them in a buffer)."}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565467249, "post_id": 57444888, "comment_id": 101366692, "body": "@CeriseLim&#243;n Yes, that&#39;s what I have in mind and I&#39;ve tried it as well, using *os.Files. It is x2-4 faster on my machine with SSD. However, there happens a lot of channel messaging contention. So, I send 1000 lines at a time to the other readers (goroutines) using a slice of deserialized values as a buffer. Is there any other way?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565467331, "post_id": 57444888, "comment_id": 101366714, "body": "@JohnFitzgerald My first comment describes a solution where you can open multiple *os.Files on the same file.  The solution is to use approximately equal size chunks, not equal number of lines."}, {"owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565467568, "post_id": 57444888, "comment_id": 101366784, "body": "@CeriseLim&#243;n Yes, I understand. You jump to an approximate position then find a line end there and go further from there. I guess the sequential solution is better because I find my code become very complex due to slice buffering, channel message contention etc."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1567478008, "creation_date": 1567478008, "answer_id": 57764387, "question_id": 57444888, "link": "https://stackoverflow.com/questions/57444888/how-to-split-an-io-reader-into-many-io-readers-with-equal-number-of-lines/57764387#57764387", "title": "How to split an io.Reader into many io.Readers with equal number of lines?", "body": "<p>You've got a couple options:</p>\n\n<ol>\n<li><p>If you have seekable data, you can seek and then will have scan for the next newline so you can make sure that you only split on line breaks</p></li>\n<li><p>Pass lines into a goroutine instead of io.readers. Basically, each goroutine would have a channel and the main routing would feed each line from the io.reader into the channels.</p></li>\n<li><p>Split the file before hand with something like <code>split</code></p></li>\n</ol>\n"}], "owner": {"reputation": 15, "user_id": 10904897, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b467e89eb951dc8e68e0f2a8ba0b30b?s=128&d=identicon&r=PG&f=1", "display_name": "John Fitzgerald", "link": "https://stackoverflow.com/users/10904897/john-fitzgerald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 255, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1567478008, "creation_date": 1565463527, "last_edit_date": 1565465414, "question_id": 57444888, "link": "https://stackoverflow.com/questions/57444888/how-to-split-an-io-reader-into-many-io-readers-with-equal-number-of-lines", "title": "How to split an io.Reader into many io.Readers with equal number of lines?", "body": "<p>I want to do the same thing in Go as asked in <a href=\"https://stackoverflow.com/questions/2016894/how-to-split-a-large-text-file-into-smaller-files-with-equal-number-of-lines\">here</a>.</p>\n\n<p>I'm parsing a huge log file, and I need to parse it line by line. On each line I deserialize the line into a struct. The data may come from any data source (file, network etc). So, I receive an <code>io.Reader</code> in my function. Since the file is huge, I want to split it among many goroutines.</p>\n\n<p>I could have done this easily using <code>io.Pipe</code> etc. However, I need to split the file without cutting the lines, for example, in half without cutting them in the middle. So that, each goroutine may receive an <code>io.Reader</code> and then they may work in different parts of the file.</p>\n\n<p>Sometimes, I also need to send <code>io.MultiReader</code> to my function as well. In that case, I would do the same again. So, it's not necessarily the same file (but mostly it is).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func scan(r io.Reader, pf ProcessFunc) {\n    // need to split `r` here if `r` is:\n    // r.(io.ReadSeeker)\n\n    // run goroutine #1 with 50% of the stream\n    // uses bufio.Scanner\n\n    // run goroutine #2 with 50% of the stream\n    // uses bufio.Scanner\n\n    // another goroutine is receiving the deserialized values\n    // and sends them to the ProcessFunc for processing further\n    // down the pipeline\n}\n</code></pre>\n\n<p>Let's say the data is like this:</p>\n\n<pre><code>foo1 bar2\nfoo3 bar4\nfoo5 bar6\nfoo7 bar8\n</code></pre>\n\n<p>The goroutine #1 will get an io.Reader like so:</p>\n\n<pre><code>foo1 bar2\nfoo3 bar4\n</code></pre>\n\n<p>And the goroutine #2 will get an io.Reader like so:</p>\n\n<pre><code>foo5 bar6\nfoo7 bar8\n</code></pre>\n\n<p>But not like this:</p>\n\n<pre><code>o5 bar6    -&gt; breaks the line in the second io.Reader\nfoo7 bar8\n</code></pre>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1565462220, "post_id": 57444649, "comment_id": 101365531, "body": "If you&#39;re using the standard library and a sensible driver, then, if the query returns no row <code>QueryRow</code> will return <code>sql.ErrNoRows</code> <i>as documented</i>. If there&#39;s no row, there&#39;s no scanning, if you have problem with scanning then that means that a row was returned by that query. So which is it?"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462352, "post_id": 57444649, "comment_id": 101365563, "body": "QueryRow returns *row, I can&#39;t find out if it was not found only after scan. Here is comments in library: // If the query selects no rows, the *Row&#39;s Scan will return ErrNoRows."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462419, "post_id": 57444649, "comment_id": 101365585, "body": "<code>Scan</code> knows about no-rows or some-rows, by calling Scan the row object checks whether there is anything to scan, if not it returns ErrNoRows <i>before doing any scanning</i>, if yes it will scan the rows into the pointers provided."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462498, "post_id": 57444649, "comment_id": 101365604, "body": "Ok, so if I remove Scan, how can I get error?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565462520, "post_id": 57444649, "comment_id": 101365609, "body": "You can&#39;t, why would you remove Scan?"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462625, "post_id": 57444649, "comment_id": 101365633, "body": "May be I didn&#39;t understand you correctly. In my situation when I do Scan it thows error (not sql.ErrNoRows)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462636, "post_id": 57444649, "comment_id": 101365635, "body": "To clarify, your QueryRow and Scan code is correct, you&#39;re doing exactly what you should do. The question is why is everything a pointer, is every column NULLable? No? Maybe change some pointer fields to non-pointer fields then? Yes? Why? Why is id NULLable?"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462681, "post_id": 57444649, "comment_id": 101365644, "body": "It throws error, that he can&#39;t Scan as one of returned values is nil and he can&#39;t get &amp; of nil"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565462746, "post_id": 57444649, "comment_id": 101365661, "body": "Ok, let&#39;s say that only several fields can be null. It does not change situation"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463037, "post_id": 57444649, "comment_id": 101365719, "body": "The situation is: 1) I have a field in DB which can be null. 2) If I use &amp; in Scan and there is nil, it will throw error. 3) If I don&#39;t use &amp;, I will get &quot;invalid memory address or nil pointer dereference&quot;"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463197, "post_id": 57444649, "comment_id": 101365766, "body": "Use <code>sql.NullXxx</code> types for nullable columns, you don&#39;t have to have them in your original struct, you can choose to use them only for scanning/writing and then assign the result to your struct&#39;s instance. You get the benefit of getting rid of pointers in your fields."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463276, "post_id": 57444649, "comment_id": 101365791, "body": "Alternatively, use <code>COALESCE</code> in your SQL query, then you can leave out <code>sql.NullXxx</code> types and pointers from your Go code."}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463353, "post_id": 57444649, "comment_id": 101365808, "body": "But there is no Null type for time.Time and in my situation this field can be null"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463376, "post_id": 57444649, "comment_id": 101365812, "body": "There is if you create one ;)"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463429, "post_id": 57444649, "comment_id": 101365826, "body": "Yes, it is true :D But I thought that NullType is the same as pointers"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463488, "post_id": 57444649, "comment_id": 101365844, "body": "Just take a look at how the other Null types are implemented and you&#39;ll see it&#39;s very easy to pull off. If you don&#39;t want to do it yourself try <a href=\"https://godoc.org/github.com/lib/pq#NullTime\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq#NullTime</a>"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463576, "post_id": 57444649, "comment_id": 101365861, "body": "Yes, I know that pg lib has it. I use pgx and I don&#39;t know why there is now null time (I use pgx for a long time, but found this problem today)"}, {"owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463696, "post_id": 57444649, "comment_id": 101365888, "body": "Ok, so I think I should: 1) remove all pointers from my struct 2) write my own null time 3) use null type in scan"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565463827, "post_id": 57444649, "comment_id": 101365919, "body": "If possible you could test that query and code with <code>lib&#47;pq</code>, it&#39;s possible that the <code>pgx</code> driver and the <code>pq</code> driver handle pointer fields differently. I know for a fact that lib/pq can handle nil-pointers-to-null-columns at least in some cases if not all..."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1565464597, "post_id": 57444649, "comment_id": 101366104, "body": "<a href=\"https://imgur.com/a/BAxB7Wr\" rel=\"nofollow noreferrer\">imgur.com/a/BAxB7Wr</a> as stated in the previous comment <code>lib&#47;pq</code> knows how to handle pointer fields. So it seems this is a driver specific issue, and therefore you have now at least 3 options, use NullXxx types, use COALESCE, or change drivers."}], "answers": [{"tags": [], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "is_accepted": true, "score": 1, "last_activity_date": 1565466702, "creation_date": 1565466702, "answer_id": 57445258, "question_id": 57444649, "link": "https://stackoverflow.com/questions/57444649/queryrow-scan-returns-an-error-if-row-wasnt-found-how-to-solve/57445258#57445258", "title": "QueryRow().Scan() returns an error if row wasn&#39;t found. How to solve?", "body": "<p>Solution for pgx Driver:</p>\n\n<p>Remove pointers from struct</p>\n\n<pre><code>type Token struct {\n    Id             int64     `db:\"id\"`\n    Email          string    `db:\"email\"`\n    OperationType  string    `db:\"operation_type\"`\n    Token          string    `db:\"token\"`\n    ExpirationDate time.Time `db:\"expiration_date\"`\n}\n</code></pre>\n\n<p>Rewrite function</p>\n\n<pre><code>func (r Repo2) FindOneByEmail(ctx context.Context, email string, ct *Token) error {\n    var date pgtype.Timestamptz\n\n    row := r.DB.QueryRow(`\n        SELECT id, email, operation_type, token, expiration_date \n        FROM tokens \n        WHERE email=$1 AND type=$2 AND expiration_date&gt;$3::date`,\n        email, \"registration\", time.Now().UTC(),\n    )\n\n    err := row.Scan(&amp;ct.Id, &amp;ct.Email, &amp;ct.OperationType, &amp;ct.Token, &amp;date)\n    if err != nil {\n        return err\n    }\n\n    ct.ExpirationDate = date.Time\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1068, "user_id": 9099830, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b5de81fb6a10f82f3f4c0d2287a963d3?s=128&d=identicon&r=PG&f=1", "display_name": "Klimbo", "link": "https://stackoverflow.com/users/9099830/klimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 569, "favorite_count": 0, "accepted_answer_id": 57445258, "answer_count": 1, "score": 0, "last_activity_date": 1565524585, "creation_date": 1565461286, "last_edit_date": 1565524585, "question_id": 57444649, "link": "https://stackoverflow.com/questions/57444649/queryrow-scan-returns-an-error-if-row-wasnt-found-how-to-solve", "title": "QueryRow().Scan() returns an error if row wasn&#39;t found. How to solve?", "body": "<p>I have spent a lot of time trying to solve this problem.</p>\n\n<p>I have a struct:</p>\n\n<pre><code>type Token struct {\n    Id             *int64     `db:\"id\"`\n    Email          *string    `db:\"email\"`\n    OperationType  *string    `db:\"operation_type\"`\n    Token          *string    `db:\"token\"`\n    ExpirationDate *time.Time `db:\"expiration_date\"`\n}\n</code></pre>\n\n<p>I have a function which finds one token by email:</p>\n\n<pre><code>func (r Repo2) FindOneByEmail(ctx context.Context, email string, ct *Token) error {\n    row := r.DB.QueryRow(`\n        SELECT id, email, operation_type, token, expiration_date \n        FROM tokens \n        WHERE email=$1 AND type=$2 AND expiration_date&gt;$3::date`,\n        email, \"registration\", time.Now(),\n    )\n\n    err := row.Scan(&amp;ct.Id, &amp;ct.Email, &amp;ct.OperationType, &amp;ct.Token, &amp;ct.ExpirationDate)\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Some fields in db can be null (that is why I use pointers in struct)</p>\n\n<p>But when I do .Scan, it throws error (as value is null it can't take address \"&amp;\")</p>\n\n<p>But if I remove \"&amp;\", It throws error too \"invalid memory address or nil pointer dereference\"</p>\n\n<p><strong>So how can I solve this problem?</strong></p>\n\n<p>The idea is: If if finds a row, it needs to get fields values, but if row was not found it needs to throw sql.ErrNoRows </p>\n"}, {"tags": ["linux", "opencv", "go", "visual-studio-code", "openvino"], "answers": [{"tags": [], "owner": {"reputation": 43, "user_id": 9427555, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-oY9Pc_ZWy9w/AAAAAAAAAAI/AAAAAAAAABM/L-DMg6FH2cc/photo.jpg?sz=128", "display_name": "kuailehaibin", "link": "https://stackoverflow.com/users/9427555/kuailehaibin"}, "is_accepted": false, "score": -1, "last_activity_date": 1565806803, "creation_date": 1565806803, "answer_id": 57500083, "question_id": 57443419, "link": "https://stackoverflow.com/questions/57443419/loading-pre-trained-dnn-model-using-openvino-with-go-gocv-symbol-lookup-erro/57500083#57500083", "title": "Loading pre-trained DNN model using OpenVINO with Go &amp; GoCV - symbol lookup error", "body": "<p>Also I got the same problem in Docker container of Ubuntu18.04, Ubuntu16.04, CPU &amp;&amp; GPU.</p>\n"}], "owner": {"reputation": 73, "user_id": 11624875, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-il4jwOFeJG0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reBGx-wqrosy6a9NBqE_XyhU9XlDg/mo/photo.jpg?sz=128", "display_name": "Jovana Kosti\u0107", "link": "https://stackoverflow.com/users/11624875/jovana-kosti%c4%87"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565806803, "creation_date": 1565450615, "last_edit_date": 1565548443, "question_id": 57443419, "link": "https://stackoverflow.com/questions/57443419/loading-pre-trained-dnn-model-using-openvino-with-go-gocv-symbol-lookup-erro", "title": "Loading pre-trained DNN model using OpenVINO with Go &amp; GoCV - symbol lookup error", "body": "<p>I have installed, and verified installation of <strong>OpenVINO</strong> by following instructions at this link: <a href=\"https://docs.openvinotoolkit.org/latest/_docs_install_guides_installing_openvino_linux.html\" rel=\"nofollow noreferrer\">https://docs.openvinotoolkit.org/latest/_docs_install_guides_installing_openvino_linux.html</a></p>\n\n<p>Editor and Technologies that I am using are: <strong>Visual Studio Code</strong>, <strong>Go Programming Language</strong> and <strong>AWS Lambda</strong></p>\n\n<p>I am trying to load a pre-trained Deep Learning model and its configuration: <strong>frozen_inference_graph.bin</strong>, <strong>frozen_inference_graph.xml</strong></p>\n\n<p>Here is the code for it:</p>\n\n<pre><code>            net := gocv.ReadNet(localModelPath, localModelConfigPath)\n            if net.Empty() {\n                glog.Errorf(\"Error occurred while trying to read DNN model and its configuration from %v. Error message - %v\", localModelPath, err)\n                return err\n            }\n\n            defer net.Close()\n            net.SetPreferableBackend(gocv.NetBackendDefault)\n            net.SetPreferableTarget(gocv.NetTargetCPU)\n</code></pre>\n\n<p>Whenever I try to debug the program, after trying to execute <strong>gocv.ReadNet</strong> function I get the following error message:</p>\n\n<pre><code>/home/jovana/go/src/pipeline/lambda/inferenceLambda/__debug_bin: symbol lookup error: /home/jovana/go/src/pipeline/lambda/inferenceLambda/__debug_bin: undefined symbol: _ZN2cv3dnn14dnn4_v201901227readNetERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES9_S9_\n</code></pre>\n\n<p>Note that <strong>go/src/pipeline/lambda/inferenceLambda</strong> is path to the main.go script I am trying to debug.</p>\n\n<p>When I try just to run <strong>main.go</strong> script I get:</p>\n\n<pre><code>/tmp/go-build091433297/b001/exe/main: symbol lookup error: /tmp/go-build091433297/b001/exe/main: undefined symbol: _ZN2cv3dnn14dnn4_v201901227readNetERKNSt7__cxx1112basic_stringIcSt11char_traitsIcESaIcEEES9_S9_\n</code></pre>\n\n<p>I honestly have no idea what this message means and where to start fixing it. Please help.</p>\n"}, {"tags": ["go", "makefile", "travis-ci"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565450372, "post_id": 57443283, "comment_id": 101362783, "body": "<code>cmd&#47;captain&#47;main.go:4:2: undefined: Run</code> is the actual error"}, {"owner": {"reputation": 828, "user_id": 662017, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0b1bad601ac2781fc1a5dd2160121a44?s=128&d=identicon&r=PG", "display_name": "Alwin Doss", "link": "https://stackoverflow.com/users/662017/alwin-doss"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565450699, "post_id": 57443283, "comment_id": 101362863, "body": "@Flimzy that was the error, it was passing on my laptop because I had that file in my system, it was the folder where that file existed was ignored in <code>.gitignore</code> therefore it was not pushed to the Github repository. Thanks for the help!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565450753, "post_id": 57443283, "comment_id": 101362882, "body": "I&#39;m glad you got it working!"}], "answers": [{"comments": [{"owner": {"reputation": 828, "user_id": 662017, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0b1bad601ac2781fc1a5dd2160121a44?s=128&d=identicon&r=PG", "display_name": "Alwin Doss", "link": "https://stackoverflow.com/users/662017/alwin-doss"}, "edited": false, "score": 0, "creation_date": 1565450828, "post_id": 57443406, "comment_id": 101362899, "body": "that was the error, it was passing on my laptop because I had that file in my system, it was the folder where that file existed was ignored in .gitignore therefore it was not pushed to the Github repository. Thanks for the help!"}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1565450521, "creation_date": 1565450521, "answer_id": 57443406, "question_id": 57443283, "link": "https://stackoverflow.com/questions/57443283/golang-project-travis-ci-build-fails-with-error-makefile15-recipe-for-target/57443406#57443406", "title": "Golang project Travis CI Build fails with error `Makefile:15: recipe for target &#39;test&#39; failed`", "body": "<p>The interesting error message is:</p>\n\n<pre><code>cmd/captain/main.go:4:2: undefined: Run\n</code></pre>\n\n<p>So on line 4 of your <code>main.go</code>, you refer to an undefined symbol <code>Run</code>.</p>\n"}], "owner": {"reputation": 828, "user_id": 662017, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0b1bad601ac2781fc1a5dd2160121a44?s=128&d=identicon&r=PG", "display_name": "Alwin Doss", "link": "https://stackoverflow.com/users/662017/alwin-doss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 417, "favorite_count": 0, "closed_date": 1565724268, "accepted_answer_id": 57443406, "answer_count": 1, "score": -3, "last_activity_date": 1565450661, "creation_date": 1565449551, "last_edit_date": 1565450661, "question_id": 57443283, "link": "https://stackoverflow.com/questions/57443283/golang-project-travis-ci-build-fails-with-error-makefile15-recipe-for-target", "closed_reason": "Not suitable for this site", "title": "Golang project Travis CI Build fails with error `Makefile:15: recipe for target &#39;test&#39; failed`", "body": "<p>I have set up travis build for my Github project <a href=\"https://github.com/alwindoss/captain\" rel=\"nofollow noreferrer\">Captain</a>\nThe contents of <code>.travis.yml</code> is:</p>\n\n<pre><code>language: go\n\ngo:\n  - 1.12.x\n\nscript:\n  make\n\nenv:\n  - GO111MODULE=on GOPROXY=https://proxy.golang.org\n</code></pre>\n\n<p>The contents of my <code>Makefile</code> is:</p>\n\n<pre><code># Go parameters\nBINARY_FOLDER=./bin\nGOCMD=go\nGOBUILD=$(GOCMD) build\nGOCLEAN=$(GOCMD) clean\nGOTEST=$(GOCMD) test\nGOGET=$(GOCMD) get\nBINARY_NAME=captain\nBINARY_UNIX=$(BINARY_NAME)_unix\n\nall: test build\nbuild: \n        $(GOBUILD) -o $(BINARY_FOLDER)/$(BINARY_NAME) ./cmd/...\ntest: \n        $(GOTEST) -v ./...\nclean: \n        rm -rf $(BINARY_FOLDER)\nrun: all\n        $(BINARY_FOLDER)/$(BINARY_NAME)\n\n\n# Cross compilation\nbuild-linux:\n        CGO_ENABLED=0 GOOS=linux GOARCH=amd64 $(GOBUILD) -o $(BINARY_UNIX) -v\ndocker-build:\n        docker run --rm -it -v \"$(GOPATH)\":/go -w /go/src/bitbucket.org/rsohlich/makepost golang:latest go build -o \"$(BINARY_UNIX)\" -v\n</code></pre>\n\n<p>When ever the travis build triggers it errors out saying:</p>\n\n<pre><code>go test -v ./...\ngo: finding github.com/gorilla/mux v1.7.3\ngo: finding github.com/lib/pq v1.2.0\ngo: finding github.com/google/uuid v1.1.1\ngo: finding github.com/DATA-DOG/go-sqlmock v1.3.3\ngo: downloading github.com/DATA-DOG/go-sqlmock v1.3.3\ngo: downloading github.com/lib/pq v1.2.0\ngo: extracting github.com/DATA-DOG/go-sqlmock v1.3.3\ngo: extracting github.com/lib/pq v1.2.0\n# github.com/alwindoss/captain/cmd/captain\ncmd/captain/main.go:4:2: undefined: Run\n=== RUN   TestCreateWorklistPositiveScenario\n2019/08/10 14:56:19 Creating Worklist\n2019/08/10 14:56:19 {\"id\": \"ID\", \"name\": \"name\"}\n2019/08/10 14:56:19 Creating worklist in the RDBMS Store\n2019/08/10 14:56:19 Last Inserted ID: 1\n2019/08/10 14:56:19 ID = 1, affected = 1\n--- PASS: TestCreateWorklistPositiveScenario (0.00s)\n=== RUN   TestCreateWorklistWhenBadRequestIsSent\n2019/08/10 14:56:19 Creating Worklist\n2019/08/10 14:56:19 This is a bad request\n--- PASS: TestCreateWorklistWhenBadRequestIsSent (0.00s)\nPASS\nok      github.com/alwindoss/captain/internal/handler   0.005s\nMakefile:15: recipe for target 'test' failed\nmake: *** [test] Error 2\n</code></pre>\n\n<p>In the job log I see that all my tests pass but the build does not go beyond this. The very same <code>Makefile</code> works without issues locally on my Mac. </p>\n\n<p>I am not sure where the issue is. In the Makefile or in the way I have configured the Travis CI.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 342, "user_id": 7241652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8b4a762cfd5eacf792b222b005a4499?s=128&d=identicon&r=PG&f=1", "display_name": "Durlabh Sharma", "link": "https://stackoverflow.com/users/7241652/durlabh-sharma"}, "edited": false, "score": 0, "creation_date": 1565452741, "post_id": 57443339, "comment_id": 101363307, "body": "Great! Works fine. One more question. Using your code, I changed <code>if !ok {return}</code> to <code>if ok {fmt.Println(&quot;Read&quot;, x)}</code>. And it still worked fine. What broke the loop here? Is there any BTS processing in <code>select</code> when a channel is closed?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 342, "user_id": 7241652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8b4a762cfd5eacf792b222b005a4499?s=128&d=identicon&r=PG&f=1", "display_name": "Durlabh Sharma", "link": "https://stackoverflow.com/users/7241652/durlabh-sharma"}, "edited": false, "score": 0, "creation_date": 1565454626, "post_id": 57443339, "comment_id": 101363738, "body": "What breaks the loop in that case, is the program exiting."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1565449974, "creation_date": 1565449974, "answer_id": 57443339, "question_id": 57443099, "link": "https://stackoverflow.com/questions/57443099/go-channel-not-receiving-printing-last-value-sent-to-channel/57443339#57443339", "title": "Go channel not receiving/printing last value sent to channel", "body": "<p>The problem is that your <code>wg.Done()</code> is in the wrong place.  It must be <em>in your goroutine</em>, but you're executing it before the goroutine even starts, so your program is liable to exit before doing any work.</p>\n\n<p>Change this:</p>\n\n<pre><code>defer wg.Done()\ngo func() {\n</code></pre>\n\n<p>to this:</p>\n\n<pre><code>go func() {\n    defer wg.Done()\n</code></pre>\n\n<p>Of course then you'll have an infinitely running goroutine, because your <code>for</code> loop has no exit condition. You'll need to add one, probably by checking for the channel closing:</p>\n\n<pre><code>        select {\n        case x, ok := &lt;-c:\n            if !ok { // channel was closed\n                return\n            }\n            fmt.Println(\"Read\", x)\n        case t :=&lt;-ti:\n            fmt.Println(\"TIMED OUT with \"+t.String())\n        }\n</code></pre>\n\n<p>Then tell your main go routine to close the channel when it's done:</p>\n\n<pre><code>c &lt;- 40\nc &lt;- 50\nclose(c)  // We're done, so tell the goroutine to finish up\nwg.Wait() // But wait until it's done\n</code></pre>\n"}], "owner": {"reputation": 342, "user_id": 7241652, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8b4a762cfd5eacf792b222b005a4499?s=128&d=identicon&r=PG&f=1", "display_name": "Durlabh Sharma", "link": "https://stackoverflow.com/users/7241652/durlabh-sharma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 57443339, "answer_count": 1, "score": 0, "last_activity_date": 1565449974, "creation_date": 1565448127, "last_edit_date": 1565448487, "question_id": 57443099, "link": "https://stackoverflow.com/questions/57443099/go-channel-not-receiving-printing-last-value-sent-to-channel", "title": "Go channel not receiving/printing last value sent to channel", "body": "<p>Here's a piece of code which outputs a list of integers as pushed to a channel. Else a select checks and prints necessary timeout message. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar wg sync.WaitGroup\n\nfunc main() {\n    wg.Add(1)\n    c := make(chan int)\n\n    go readFromChannel(c, time.After(time.Duration(2)*time.Second))\n//  time.Sleep(time.Duration(5) * time.Second) //Talking about uncommenting this line\n    c &lt;- 10\n    c &lt;- 20\n    c &lt;- 30\n    c &lt;- 40\n    c &lt;- 50\n    wg.Wait()\n}\n\nfunc readFromChannel(c chan int, ti &lt;-chan time.Time) {\n    defer wg.Done()\n    go func() {\n        for {\n            select {\n            case x := &lt;-c:\n                fmt.Println(\"Read\", x)\n            case t :=&lt;-ti:\n                fmt.Println(\"TIMED OUT with \"+t.String())\n            }\n        }\n    }()\n\n}\n</code></pre>\n\n<p>Also here's the playground link for the same : <a href=\"https://play.golang.org/p/4hNWze4Pfwr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4hNWze4Pfwr</a>\nThis code outputs list of integer like </p>\n\n<pre><code>Read 10\nRead 20\nRead 30\nRead 40\nRead 50\n</code></pre>\n\n<p>But when I un-comment the line that make the main routine go to sleep for 5 sec(mentioned in the code as comment/line number 16), output changes to :</p>\n\n<pre><code>TIMED OUT with 2009-11-10 23:00:02 +0000 UTC m=+2.000000001\nRead 10\nRead 20\nRead 30\nRead 40\n</code></pre>\n\n<p>I want to understand why the last <code>Read 50</code> is not being printed in second case.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1588, "user_id": 1899494, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d8bff769c85b3fc72eec038070928ff?s=128&d=identicon&r=PG", "display_name": "hugo", "link": "https://stackoverflow.com/users/1899494/hugo"}, "edited": false, "score": 0, "creation_date": 1565437057, "post_id": 57441647, "comment_id": 101359895, "body": "I retracted my flag, but here&#39;s something perhaps more helpful: <a href=\"https://stackoverflow.com/questions/3387273/how-to-implement-resizable-arrays-in-go\" title=\"how to implement resizable arrays in go\">stackoverflow.com/questions/3387273/&hellip;</a>"}, {"owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "edited": false, "score": 0, "creation_date": 1565437446, "post_id": 57441647, "comment_id": 101359974, "body": "<code>a = append(a, iter.Val)</code> and you don&#39;t need <code>pha</code> any more."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565444397, "post_id": 57441647, "comment_id": 101361432, "body": "1. No, there&#39;s no such thing as a dynamically sized array in Go. 2. You&#39;re not using an array at all. You&#39;re using a slice. 3. Slices <i>are</i> dynamically sized."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1565445302, "post_id": 57441647, "comment_id": 101361631, "body": "<a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">tour.golang.org/moretypes/15</a>"}], "answers": [{"tags": [], "owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "is_accepted": false, "score": 4, "last_activity_date": 1565439092, "last_edit_date": 1565439092, "creation_date": 1565438461, "answer_id": 57441960, "question_id": 57441647, "link": "https://stackoverflow.com/questions/57441647/dynamically-sized-array-in-golang/57441960#57441960", "title": "Dynamically sized Array in golang?", "body": "<p>You should use <a href=\"https://tour.golang.org/moretypes/15\" rel=\"nofollow noreferrer\">append</a> function.</p>\n\n<blockquote>\n  <p>var a []int</p>\n</blockquote>\n\n<p>is a slice, you can think of it as a \"dynamic array\". In order to add elements to it, you should use append method. In your code, you used array semantics. </p>\n\n<pre><code>a = append(a, iter.Val)\n</code></pre>\n\n<p>You can create your slice with a predefined number of elements if you know upfront how many elements you are going to have in your slice.</p>\n\n<p><code>a := make([]int, 10)</code></p>\n\n<p>this will create a slice with 10 elements in it.</p>\n"}, {"tags": [], "owner": {"reputation": 146, "user_id": 2768070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4tmoj.jpg?s=128&g=1", "display_name": "Surjit R", "link": "https://stackoverflow.com/users/2768070/surjit-r"}, "is_accepted": false, "score": 0, "last_activity_date": 1565438541, "creation_date": 1565438541, "answer_id": 57441972, "question_id": 57441647, "link": "https://stackoverflow.com/questions/57441647/dynamically-sized-array-in-golang/57441972#57441972", "title": "Dynamically sized Array in golang?", "body": "<p>Go arrays are fixed in size, but thanks to the builtin append method, we get dynamic behavior. The fact that append returns an object, really highlights the fact that a new array will be created if necessary. The growth algorithm that append uses is to double the existing capacity.</p>\n\n<pre><code>numbers := make([]int, 0)\nnumbers = append(numbers, 1)\nnumbers = append(numbers, 2)\nfmt.Println(len(numbers)) // == 2\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 6414013, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3979f5aaf06920075f3492695450c37e?s=128&d=identicon&r=PG&f=1", "display_name": "Rohit Parab", "link": "https://stackoverflow.com/users/6414013/rohit-parab"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3573, "favorite_count": 0, "closed_date": 1565451076, "answer_count": 2, "score": 0, "last_activity_date": 1565439092, "creation_date": 1565435806, "last_edit_date": 1565437018, "question_id": 57441647, "link": "https://stackoverflow.com/questions/57441647/dynamically-sized-array-in-golang", "closed_reason": "Duplicate", "title": "Dynamically sized Array in golang?", "body": "<p>I would like to know if there is any way by which I can create dynamically sized array to avoid runtime error in the code below.</p>\n\n<p>Error:</p>\n\n<blockquote>\n  <p>panic: runtime error: index out of range in Go</p>\n</blockquote>\n\n<p>Code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>/**\n * Definition for singly-linked list.\n * type ListNode struct {\n *     Val int\n *     Next *ListNode\n * }\n */\nfunc nextLargerNodes(head *ListNode) []int {\n\n    var a []int\n    var pha int\n    hNum := 0\n    currNode := head\n    pha = 0\n    for currNode.Next != nil {\n        iter := currNode.Next\n        hNum = currNode.Val\n        //phb = pha + 1\n        for(iter.Next != nil){\n            if hNum &lt; iter.Val {\n                hNum = iter.Val\n                break\n            } else if hNum == iter.Val{\n                hNum = 0\n                break\n            }\n\n            iter = iter.Next\n        }\n        a[pha] = iter.Val\n        pha++\n        hNum = 0\n        currNode = currNode.Next\n    }\n    return a\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1565433009, "post_id": 57441284, "comment_id": 101359037, "body": "Why do you want to use reflection? A simple type switch seems much more logical."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1565433034, "post_id": 57441284, "comment_id": 101359049, "body": "And yes, whether you use type assertions or reflections, you will have a lot of redundant code. Go doesn&#39;t support generics."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1565434645, "post_id": 57441284, "comment_id": 101359380, "body": "prefer type switch for automatic code optimization by the compiler. Even with reflect you will have to perform some kind of type assertions, so its not interesting in that case."}, {"owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565438873, "post_id": 57441284, "comment_id": 101360234, "body": "@Flimzy Then I know why we need generics, thank you."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565444247, "post_id": 57441284, "comment_id": 101361403, "body": "Well, I know why some people want generics. I still dread the day they&#39;re added to the language."}], "answers": [{"tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 1, "last_activity_date": 1565526113, "last_edit_date": 1565526113, "creation_date": 1565482851, "answer_id": 57446523, "question_id": 57441284, "link": "https://stackoverflow.com/questions/57441284/how-could-i-define-a-safe-division-using-interface-and-reflect/57446523#57446523", "title": "How could I define a safe division using interface and reflect?", "body": "<p>As you noted in <a href=\"https://stackoverflow.com/questions/57441284/how-could-i-define-a-safe-division-using-interface-and-reflect#comment101360234_57441284\">a comment</a>, now you know why (some) people want generics in Go. :-)</p>\n\n<p>For this particular case, you're probably better off just writing a <code>safeDivideInt</code> function:</p>\n\n<pre><code>// a/b, but 0 if b == 0\nfunc safeDivideInt(a, b int64) int64 {\n    if b == 0 {\n        return 0\n    }\n    return a / b\n}\n</code></pre>\n\n<p>and a similar <code>safeDivideUint</code> function (using <code>uint64</code>) ... and, if you need it,<sup>1</sup> a <code>safeDivideFloat</code> function, e.g.:</p>\n\n<pre><code>func safeDivideFloat(a, b float64) float64 {\n    // decide if you want 0/0 handled differently\n    // decide if you want to check for b being Inf or NaN\n    // etc.\n    if b == 0 {\n        return 0\n    }\n    return a / b\n}\n</code></pre>\n\n<p>and then yet again for complex, if you want.</p>\n\n<p>But: there's no easy way to make the Go compiler call one or the other for you.  You can write your interface-based function the way you did, and then do type-switching on the various arguments, but it gets quite long as you have to handle all possible combinations.  The combinatorial effect is painful no matter how you reduce it.  Using <code>reflect</code> and its type-kind interface does not help here as you still have five <code>int</code> types, five <code>uint</code> types (or six if you include <code>uintptr</code>), the two <code>float</code> types, and the two <code>complex</code> types.  (It's not clear to me that allowing either of the <code>Uintptr</code> or <code>UnsafePointer</code> <code>Kind</code>s in your divide function makes any sense at all.)</p>\n\n<p>It might, however, make more sense\u2014depending on context\u2014to define your own interface.  <a href=\"https://play.golang.org/p/nNF7hcOJUxy\" rel=\"nofollow noreferrer\">Here's a working toy example on the Go Playground</a>.  I didn't bother putting in Uint and Complex types.</p>\n\n<hr>\n\n<p><sup>1</sup>Note that a runtime 1.0 / 0.0 is <code>+Inf</code>.  The <a href=\"https://golang.org/ref/spec#Arithmetic_operators\" rel=\"nofollow noreferrer\">Go specification</a> says:</p>\n\n<blockquote>\n  <p>The result of a floating-point or complex division by zero is not specified beyond the IEEE-754 standard; whether a run-time panic occurs is implementation-specific. </p>\n</blockquote>\n\n<p>but IEEE-754 calls for Inf and NaN results by default, with exceptions being optional, so I assume this means that the default in Go is no exception raised, meaning \"no panic\", as well.  See, e.g., <a href=\"https://en.wikipedia.org/wiki/Floating-point_arithmetic#Dealing_with_exceptional_cases\" rel=\"nofollow noreferrer\">this Wikipedia entry</a> from which I quote a bit here:</p>\n\n<blockquote>\n  <p>Arithmetic exceptions are (by default) required to be recorded in \"sticky\" status flag bits. ... By default, an operation always returns a result according to specification without interrupting computation. For instance, 1/0 returns +\u221e, while also setting the divide-by-zero flag bit (this default of \u221e is designed so as to often return a finite result when used in subsequent operations and so be safely ignored). </p>\n</blockquote>\n"}], "owner": {"reputation": 493, "user_id": 8364553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d203cf51ae3926dca4c2c3afcf24948?s=128&d=identicon&r=PG&f=1", "display_name": "p1gd0g", "link": "https://stackoverflow.com/users/8364553/p1gd0g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 57446523, "answer_count": 1, "score": -2, "last_activity_date": 1565526113, "creation_date": 1565432542, "question_id": 57441284, "link": "https://stackoverflow.com/questions/57441284/how-could-i-define-a-safe-division-using-interface-and-reflect", "title": "How could I define a safe division using interface and reflect?", "body": "<p>I want to define a safe division like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func safeDivide(a, b interface{}) interface{} {\n    if b == 0 {\n        return 0\n    }\n    return a / b\n}\n</code></pre>\n\n<p>Obviously, this function does not work. we can not divide interface. One solution is to judge the type of input and do the division.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>switch reflect.ValueOf(x).Kind() {\n    case reflect.Int:\n    // balabala...\n</code></pre>\n\n<p>However it looks redundadnt, I must deal every case.</p>\n\n<p>So if I could use reflect to guarantee the type of inputs? I have tried reflect.TypeOf() but failed.</p>\n\n<p>By the way, I notice this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>a := uint32(0)\nifZero(a) // outputs \"no\"\n\nfunc ifZero(a interface{}) {\n    if a == 0 {\n        log.Println(\"yes\")\n        return\n    }\n    log.Println(\"no\")\n}\n</code></pre>\n\n<p>That means golang itself cannot deal the type issue, right?</p>\n"}, {"tags": ["git", "docker", "go", "nginx", "continuous-deployment"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565429980, "post_id": 57440918, "comment_id": 101358480, "body": "&quot;but this could technically never stop&quot; -- not true. Once the shutdown begins, no more connections are accepted. So your upper-bound is whatever your HTTP connection timeout is."}, {"owner": {"reputation": 3335, "user_id": 2768038, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/hxk9G.png?s=128&g=1", "display_name": "maxisme", "link": "https://stackoverflow.com/users/2768038/maxisme"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565430039, "post_id": 57440918, "comment_id": 101358493, "body": "How do you know that <code>Once the shutdown begins, no more connections are accepted.</code>?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1565430043, "post_id": 57440918, "comment_id": 101358494, "body": "The normal behavior is to start the new service, which begins accepting connections immediately, then start the graceful shutdown on the old service, which will finalize any pending requests, then die. I don&#39;t know how docker-compose handles that. Kubernetes does that by default."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565430055, "post_id": 57440918, "comment_id": 101358498, "body": "Because that&#39;s the definition of &quot;Graceful shutdown&quot; Any other behavior would, by definition, be a bug."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565430152, "post_id": 57440918, "comment_id": 101358516, "body": "And incidentally, graceful shutdown is now supported in the standard library since Go 1.8. No need for third-party tools any more. See <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\">here</a>. The documentation for which states <code>Once Shutdown has been called on a server, it may not be reused; future calls to methods such as Serve will return ErrServerClosed</code>"}, {"owner": {"reputation": 3335, "user_id": 2768038, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/hxk9G.png?s=128&g=1", "display_name": "maxisme", "link": "https://stackoverflow.com/users/2768038/maxisme"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1565430717, "post_id": 57440918, "comment_id": 101358622, "body": "Awesome thank you for that. Okay if a user is uploading a large file lets say - this will delay the closing for a long amount of time! So I am looking to start routing the traffic to the new container with the updated code."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565445836, "post_id": 57440918, "comment_id": 101361738, "body": "&quot;If a user is uploading a large file this will delay the closing for a long amount of time!&quot; Erm, yes. This is either acceptable to you or it isn&#39;t. There is no technical solution here."}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 0, "last_activity_date": 1565461802, "last_edit_date": 1565461802, "creation_date": 1565461448, "answer_id": 57444665, "question_id": 57440918, "link": "https://stackoverflow.com/questions/57440918/how-to-update-docker-web-app-without-killing-connections/57444665#57444665", "title": "How to update docker web app without killing connections?", "body": "<p>Using a single host machine (as indicated by the use of docker-compose) while being concerned about high availability seems VERY odd to me. More on that later.</p>\n\n<blockquote>\n  <p><strong>ATTENTION</strong> The following is simplified, vastly in parts. Furthermore, the terminology is off here and there for the sake of simplicity.</p>\n</blockquote>\n\n<p>However, there is a notion of a service, which is available both <a href=\"https://docs.docker.com/engine/swarm/how-swarm-mode-works/services/\" rel=\"nofollow noreferrer\">for docker swarm</a> and <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\" rel=\"nofollow noreferrer\">for Kubernetes</a>. A service is a virtual loadbalancer/transparent reverse proxy with awareness of its backends which can be backed by a basically arbitrary number of containers or pods, in Kubernetes parlay (henceforth shortened to containers, since this is not technically false for Kubernetes, either). Those containers of course each run your application. The engine is aware of wether a container is shutting down or becomes unavailable and routes requests to containers which are alive. So far, so good.</p>\n\n<p>Now, both engines have a different notion, which is called \u201erolling updates\u201c. What actually happens there is that <em>if</em> you have your service backed by more than one container is something like this:</p>\n\n<blockquote>\n  <p>Hi, I am your orchestration engine!\n  Uh, you want to update the image for the containers backing service X?\n  Lets see... Well, X has two backing containers, so we can do a rolling\n  update. Uh, a new request for the service: Sending it to the second\n  container. While it is processed, I fire up a container with the new\n  image... Takes a while... There it is! Sending all new requests to the\n  updated container. Now shutting down the first of the old containers... Down! Firing up a second container with the new image...\n  Done! Great, now sending all new requests to the updated containers.\n  Trying to stop the remaining old container... Waiting till it processed\n  the request, but at most 30s, then I\u2018ll kill it... Ah, not required,\n  already shut down...</p>\n  \n  <p>I am pleased to inform you that I successfully updated service X to use new containers with the shiny new version of your application!</p>\n</blockquote>\n\n<h3>Little secret</h3>\n\n<p>docker-compose should <em>technically</em> be able to do the same, if you scale up your service to > 1 and then change the compose file and then do a </p>\n\n<pre><code>docker-compose up\n</code></pre>\n\n<p>However, all this fuzz about not loosing a connection and then running on a single machine seems like trying to install a battleship cannon on a rowing boat. My advice: if your service actually uses ephemeral containers (if you use a mount in any way, shape or form you most likely do not), use docker swarm. Otherwise, use Kubernetes. While it\u2018s learning curve might be a bit steep (in the beginning, it flattens out pretty quickly), it is worth it in more complicated setups.</p>\n\n<p><strong>Edit</strong> Keeping individual <em>sessions</em> including current uploads is a totally different thing and while not entirely impossible, requires rather sophisticated reverse proxies and/or equally sophisticated application setup. Usually, it is easier to announce a maintenance window.</p>\n"}], "owner": {"reputation": 3335, "user_id": 2768038, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/hxk9G.png?s=128&g=1", "display_name": "maxisme", "link": "https://stackoverflow.com/users/2768038/maxisme"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 68, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565461802, "creation_date": 1565429153, "last_edit_date": 1565429948, "question_id": 57440918, "link": "https://stackoverflow.com/questions/57440918/how-to-update-docker-web-app-without-killing-connections", "title": "How to update docker web app without killing connections?", "body": "<p>I have a <code>docker-compose.yml</code> which has two services: a database and my Go app. My CI/CD pipeline calls the server that is hosting this docker container and runs this bash script:</p>\n\n<pre><code>git fetch &amp;&gt; /dev/null\ndiffs=$(git diff master origin/master)\n\nif [ ! -z \"$diffs\" ]\nthen\n    echo \"Pulling code from GitHub...\"\n    git checkout master\n    git pull origin master\n\n    # update server\n    docker-compose up --build -d\n\n    # kill all unused docker containers\n    docker system prune -f\nelse\n    echo \"Already up to date\"\nfi\n</code></pre>\n\n<p>The problem with this is that if there are any outstanding http connections to my container they will be terminated. I have used <code>\"gopkg.in/tylerb/graceful.v1\"</code> to wait for outstanding connections to finish before terminating but this could technically never stop if clients kept making separate overlapping requests.</p>\n\n<p>This service is behind an nginx reverse proxy:</p>\n\n<pre><code>upstream goapp {\n    server 127.0.0.1:8080;\n}\n</code></pre>\n\n<p>An idea I had would be to deploy the docker app on a new port (not sure if possible using docker-compose) and then tell nginx to add a new server to the <code>upstream</code> (e.g <code>server 127.0.0.1:8081;) for all new incoming connections. Then allow the container on</code>8080<code>to gracefully close (then somehow delete from the</code>upstream`). Is this possible or is there a better way to do this?</p>\n"}, {"tags": ["json", "go", "duckling"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1565424124, "post_id": 57440395, "comment_id": 101357458, "body": "Since you&#39;re making two different requests and getting two different responses you should have two different structs, now you don&#39;t have to if you don&#39;t want to, but that&#39;s the most sensible approach in my opinion."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565424362, "post_id": 57440395, "comment_id": 101357505, "body": "... if you decide you want to stuff the two separate response types into a single struct type you can use the <code>json.Number</code> type. <a href=\"https://play.golang.com/p/Uvo6-awBs1L\" rel=\"nofollow noreferrer\">play.golang.com/p/Uvo6-awBs1L</a>"}], "owner": {"reputation": 1198, "user_id": 1406177, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/9d9dd48e5fd672255278b435bd63b661?s=128&d=identicon&r=PG", "display_name": "user1406177", "link": "https://stackoverflow.com/users/1406177/user1406177"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 48, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565423698, "creation_date": 1565423698, "question_id": 57440395, "link": "https://stackoverflow.com/questions/57440395/parsing-inconsitent-json-structure", "title": "Parsing inconsitent json structure", "body": "<p>I am using <a href=\"https://github.com/facebook/duckling\" rel=\"nofollow noreferrer\">duckling</a> as a tool for date/time and unit extraction. When I send a request like <code>today</code>, I am getting (some fields have  been removed for readability):</p>\n\n<pre><code>{\"body\":\"today\", \"value\": {\"value\":\"2019-08-10T00:00:00.000-07:00\", \"grain\":\"day\", \"type\":\"value\"}, \"dim\":\"time\"}\n</code></pre>\n\n<p>Thus, I created these structs:</p>\n\n<pre><code>type DucklingEntry struct {\n    Body string `json:\"body\"`\n    Dim string `json:\"dim\"`\n    Value DucklingValue `json:\"value\"`\n}\n\ntype DucklingValue struct {\n    Value string `json:\"value\"`\n    Grain string `json:\"grain\"`\n    Type string `json:\"type\"`\n}\n</code></pre>\n\n<p>When I send a request with the text value <code>6 euro</code>, I am getting:</p>\n\n<pre><code>{\"body\":\"6 euro\", \"value\": {\"value\":6, \"type\":\"value\", \"unit\":\"EUR\"}, \"dim\":\"amount-of-money\"}\n</code></pre>\n\n<p>As you can see, the inner <code>value</code> field now contains an integer instead of a string. When I parse the json string using the shown struct, the inner <code>value</code> value will be <code>\"\"</code>.</p>\n\n<p>How can I account for such an inconsistent json response?</p>\n"}, {"tags": ["go", "kubernetes", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 9246260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e16440287c4d646d994450e0ac4c8e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tanmay Shrivastava", "link": "https://stackoverflow.com/users/9246260/tanmay-shrivastava"}, "edited": false, "score": 0, "creation_date": 1565422406, "post_id": 57440027, "comment_id": 101357135, "body": "I will try this out , I knew that containers inside a pod can only access the localhost therefore wanted a way to map to it ,if there is any helpful resource that I could use to understand your solution better would be appreciated , thank you"}], "tags": [], "owner": {"reputation": 43208, "user_id": 78722, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf611565f0b79abd0b3dc200ad867661?s=128&d=identicon&r=PG", "display_name": "coderanger", "link": "https://stackoverflow.com/users/78722/coderanger"}, "is_accepted": false, "score": 0, "last_activity_date": 1565420052, "creation_date": 1565420052, "answer_id": 57440027, "question_id": 57439990, "link": "https://stackoverflow.com/questions/57439990/how-to-make-one-pod-communicate-with-the-other-pods-localhost/57440027#57440027", "title": "How to make one pod communicate with the other pod&#39;s localhost", "body": "<p>You cannot, you need to use a kubernetes Service object and then dns to get the IP of the proxy to the other pod. Pods share localhost within themselves, between containers of the same pod, but that\u2019s it.</p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 5035962, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IxbBN.png?s=128&g=1", "display_name": "Micha\u0142 Bie\u0144", "link": "https://stackoverflow.com/users/5035962/micha%c5%82-bie%c5%84"}, "is_accepted": false, "score": 0, "last_activity_date": 1565425734, "creation_date": 1565425734, "answer_id": 57440583, "question_id": 57439990, "link": "https://stackoverflow.com/questions/57439990/how-to-make-one-pod-communicate-with-the-other-pods-localhost/57440583#57440583", "title": "How to make one pod communicate with the other pod&#39;s localhost", "body": "<p>The most standard solution for this problem is to forget about connecting to localhost, then create ClusterIP service connected to the selected server pod in the same namespace:\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: server-service\n  labels:\n    app: your-label\nspec:\n  type: ClusterIP\n  ports:\n  - port: 8090\n    targetPort: 8090\n    protocol: TCP\n  selector:\n    app: your-label\n</pre></code></p>\n\n<p>Remember to use the same <code>metadata.labels.app</code> value in your pod description, otherwise the two will not be connected to each other.<br>\nIf you have your cluster configured properly, and CoreDNS up and running, you should be able to access the server using <code>server-service:8090</code> if you are running your client and server pods in the same namespace.</p>\n"}, {"comments": [{"owner": {"reputation": 59, "user_id": 9246260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e16440287c4d646d994450e0ac4c8e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tanmay Shrivastava", "link": "https://stackoverflow.com/users/9246260/tanmay-shrivastava"}, "edited": false, "score": 0, "creation_date": 1566056334, "post_id": 57440867, "comment_id": 101539789, "body": "thanks for the suggestion ,but i am still struggling with this , i have created this service and server pod , but my client pod still gives me  Error in client :rpc error: code = Unavailable desc = all SubConns are in TransientFailure, latest connection error: connection error: desc = &quot;transport: Error while dialing dial tcp :8090: connect: connection refused&quot;"}, {"owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "reply_to_user": {"reputation": 59, "user_id": 9246260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e16440287c4d646d994450e0ac4c8e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tanmay Shrivastava", "link": "https://stackoverflow.com/users/9246260/tanmay-shrivastava"}, "edited": false, "score": 0, "creation_date": 1566202272, "post_id": 57440867, "comment_id": 101567644, "body": "Looks like you need to add the name of the service to the code you connection code you with in the question. <code>grpc.Dial(&quot;grpc-service:8090&quot;, grpc.WithInsecure())</code>"}], "tags": [], "owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "is_accepted": true, "score": 1, "last_activity_date": 1566202311, "last_edit_date": 1566202311, "creation_date": 1565428621, "answer_id": 57440867, "question_id": 57439990, "link": "https://stackoverflow.com/questions/57439990/how-to-make-one-pod-communicate-with-the-other-pods-localhost/57440867#57440867", "title": "How to make one pod communicate with the other pod&#39;s localhost", "body": "<p><code>localhost</code> can only be used to address the group of containers running in a single Pod. </p>\n\n<p>Pod to Pod communications should go via a <a href=\"https://kubernetes.io/docs/concepts/services-networking/service/\" rel=\"nofollow noreferrer\">Service</a>. </p>\n\n<p>The following example service will forward traffic to any Pods labelled with <code>app: grpc-app</code></p>\n\n<pre><code>apiVersion: v1\nkind: Service\nmetadata:\n  name: grpc-service\nspec:\n  selector:\n    app: grpc-app\n  ports:\n    - protocol: TCP\n      port: 8090\n      targetPort: 8090\n</code></pre>\n\n<p>You will then have a DNS hostname to access the service with. </p>\n\n<p><code>grpc-service.&lt;namespace&gt;.svc.&lt;cluster-domain&gt;</code>\nwhich is usually<br> <code>grpc-service.default.svc.cluster.local</code></p>\n\n<pre><code>func main() {\n    conn, err := grpc.Dial(\"name-of-your-grpc-service:8090\", grpc.WithInsecure())\n    if err != nil {\n        log.Fatalf(\"did not connect :%v\", err)\n    }\n    cli := proto.NewPingClient(conn)\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 9246260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e16440287c4d646d994450e0ac4c8e9f?s=128&d=identicon&r=PG&f=1", "display_name": "Tanmay Shrivastava", "link": "https://stackoverflow.com/users/9246260/tanmay-shrivastava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 834, "favorite_count": 1, "accepted_answer_id": 57440867, "answer_count": 3, "score": 1, "last_activity_date": 1566202311, "creation_date": 1565419782, "last_edit_date": 1565441728, "question_id": 57439990, "link": "https://stackoverflow.com/questions/57439990/how-to-make-one-pod-communicate-with-the-other-pods-localhost", "title": "How to make one pod communicate with the other pod&#39;s localhost", "body": "<p>I have implemented a gRPC client server in Go. I have now set them up in Kubernetes as client and server pods where the client connects to the server. I've set this cluster up using vagrant (centos/7) on my PC. My issue is that the client wants to hit the port 8090 (sever serves on this port) and send a message to the server, but as they are in different pods the client cannot hit localhost 8090 and therefore the pod fails. How do I solve this problem?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    conn, err := grpc.Dial(\":8090\", grpc.WithInsecure())\n    if err != nil {\n        log.Fatalf(\"did not connect :%v\", err)\n    }\n    cli := proto.NewPingClient(conn)\n</code></pre>\n\n<p>as seen it tries to dial 8090, but not able to map it to the localhost of the server pod.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1565414331, "post_id": 57439164, "comment_id": 101355949, "body": "<a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Passing_arguments_to_..._parameters</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1565415652, "post_id": 57439164, "comment_id": 101356106, "body": "... just to add to the above comment: you should do the same with <code>Info</code>&#39;s <code>args</code> value. Also in your <code>Infow</code> implementation you&#39;re turning each argument into a <code>reflect.Value</code> seemingly for no reason, unless you have an actual reason, do <i>not</i> do that, it is not required by <code>zap</code>&#39;s <code>Infow</code>, and it is wasteful."}, {"owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "edited": false, "score": 0, "creation_date": 1565451204, "post_id": 57439164, "comment_id": 101362964, "body": "Folks, maybe you can add an example of how I can wrap sugar.Infow method?  I&#39;ve tried passing <code>keyAndValues</code> through without using <code>reflect</code>, but the error is <code>DPANIC\tzap&#47;sugar.go:179\tIgnored key without a value.\t{&quot;ignored&quot;: [&quot;env&quot;,&quot;HI&quot;]}</code>"}], "answers": [{"tags": [], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "is_accepted": false, "score": 0, "last_activity_date": 1565454190, "creation_date": 1565454190, "answer_id": 57443814, "question_id": 57439164, "link": "https://stackoverflow.com/questions/57439164/factory-pattern-in-go-wrapper/57443814#57443814", "title": "factory pattern in GO (wrapper)", "body": "<p>The devil lies in details.  As mentioned in the <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">docs</a>, the following is correct:</p>\n\n<pre><code>func (l *logger) Infow(msg string, keysAndValues ...interface{}) {\n    l.zapInstance.Infow(msg, keysAndValues...)\n}\n</code></pre>\n"}], "owner": {"reputation": 12410, "user_id": 650424, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/17b6cb58e7de35e82f094681aa5321c5?s=128&d=identicon&r=PG", "display_name": "Cmag", "link": "https://stackoverflow.com/users/650424/cmag"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 680, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565454190, "creation_date": 1565409064, "last_edit_date": 1565424888, "question_id": 57439164, "link": "https://stackoverflow.com/questions/57439164/factory-pattern-in-go-wrapper", "title": "factory pattern in GO (wrapper)", "body": "<p>As a learning exercise, I set out to write a simple wrapper to wrap <code>\"go.uber.org/zap\"</code>, and maybe add some metrics (statsD) to each time my logging function is called to make this worthwhile.</p>\n\n<p>The <code>.Info</code> implementation works as expected.</p>\n\n<p>What is interesting, <code>.Infow</code> does not work.  I can not seem to get this to work for <code>...interface{}</code> types, and am getting the error:</p>\n\n<pre><code>2019-08-09T23:46:27.250-0400    DPANIC  zap/sugar.go:179    Ignored key without a value.    {\"ignored\": [{},{}]}\n</code></pre>\n\n<p>Full Implementation:</p>\n\n<pre><code>package ilogger\n\nimport (\n    \"reflect\"\n\n    \"go.uber.org/zap\"\n)\n\ntype Logger interface {\n    NewLogger(env string) logger\n}\n\ntype logger struct {\n    zapInstance zap.SugaredLogger\n}\n\nfunc NewLogger(env string) *logger {\n    z := NewZapLogger(env)\n    return &amp;logger{\n        zapInstance: *z,\n    }\n}\n\nfunc NewZapLogger(env string) *zap.SugaredLogger {\n    var zapInstance *zap.Logger\n    if env == \"production\" {\n        zapInstance, _ = zap.NewProduction()\n    } else {\n        zapInstance, _ = zap.NewDevelopment()\n    }\n    defer zapInstance.Sync() // flushes buffer, if any\n    return zapInstance.Sugar()\n}\n\n// Info uses fmt.Sprint to construct and log a message.\nfunc (l *logger) Info(args ...interface{}) {\n    l.zapInstance.Info(args)\n}\n\n// Infow logs a message with some additional context. The variadic key-value\n// pairs are treated as they are in With.\nfunc (l *logger) Infow(msg string, keysAndValues ...interface{}) {\n    things := make([]reflect.Value, len(keysAndValues))\n    for k, in := range keysAndValues {\n        things[k] = reflect.ValueOf(in)\n    }\n    l.zapInstance.Infow(msg, things)\n}\n</code></pre>\n\n<p>How do i pass <code>...interface{}</code> to zap properly?</p>\n\n<p>Source Documentation:</p>\n\n<p><a href=\"http://chrisarges.net/2016/05/20/creating-a-function-wrapper-in-golang.html\" rel=\"nofollow noreferrer\">article1</a>\n<a href=\"https://www.sohamkamani.com/blog/golang/2018-06-20-golang-factory-patterns/\" rel=\"nofollow noreferrer\">article2</a></p>\n"}, {"tags": ["mysql", "go", "google-cloud-platform"], "answers": [{"comments": [{"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "edited": false, "score": 0, "creation_date": 1565449275, "post_id": 57439412, "comment_id": 101362487, "body": "Fairly new to go... as you can see. Sorry for such a simple question. Thank you for your answer!"}, {"owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "reply_to_user": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "edited": false, "score": 0, "creation_date": 1565453310, "post_id": 57439412, "comment_id": 101363433, "body": "I am new to Go also. I wrote an article on the resources I used to learn Go. <a href=\"https://www.jhanley.com/google-cloud-and-go-my-journey-to-learn-a-new-language-in-30-days/\" rel=\"nofollow noreferrer\">jhanley.com/&hellip;</a>"}, {"owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "edited": false, "score": 0, "creation_date": 1565502983, "post_id": 57439412, "comment_id": 101371023, "body": "Wow, thanks, John! This seems like a really succinct and comprehensive resource. I&#39;m trying to connect to a mysql database in AppEngine and having difficulty, so you&#39;re tutorial may be apt!"}], "tags": [], "owner": {"reputation": 43265, "user_id": 8016720, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bXsod.png?s=128&g=1", "display_name": "John Hanley", "link": "https://stackoverflow.com/users/8016720/john-hanley"}, "is_accepted": true, "score": 0, "last_activity_date": 1565412715, "creation_date": 1565412715, "answer_id": 57439412, "question_id": 57439106, "link": "https://stackoverflow.com/questions/57439106/config-for-golang-returns-non-name-error/57439412#57439412", "title": "Config for GoLang Returns &quot;non-name&quot; error", "body": "<p>Change this line of code:</p>\n\n<pre><code>cfg.DBName := \"mythril\"\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>cfg.DBName = \"mythril\"\n</code></pre>\n\n<p>The <code>:=</code> operator declares a new variable and assigns it a value. This is called \"Short Variable Declarations\". Since <code>DBName</code> is part of the structure <code>cfg</code> you are using the wrong operator. The correct operator to use is the assignment operator <code>=</code>.</p>\n"}], "owner": {"reputation": 176, "user_id": 8651748, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-LkQCVfzSNlg/AAAAAAAAAAI/AAAAAAAAAAs/tnR2NGifmB4/photo.jpg?sz=128", "display_name": "Daniel Connelly", "link": "https://stackoverflow.com/users/8651748/daniel-connelly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 57439412, "answer_count": 1, "score": -1, "last_activity_date": 1565412715, "creation_date": 1565408218, "question_id": 57439106, "link": "https://stackoverflow.com/questions/57439106/config-for-golang-returns-non-name-error", "title": "Config for GoLang Returns &quot;non-name&quot; error", "body": "<p>I am having trouble compiling code Google-Cloud offers on connecting to a mysql database remotely using Golang.</p>\n\n<p>The code is a direct copy-paste from here: <code>https://cloud.google.com/sql/docs/mysql/connect-external-app#go</code>. One may also look here: <code>https://github.com/GoogleCloudPlatform/cloudsql-proxy/blob/master/proxy/dialers/mysql/hook_test.go</code>.</p>\n\n<p>I've tried providing a second variable to the first line below, but there is an error as only one value is returned by the mysql function.</p>\n\n<p>The troublesome code is on the second line, possibly due to the first line.</p>\n\n<pre><code>cfg := mysql.Cfg(\"haveibeenexploited:us-west1:hibe\", \"username\", \"password\")\ncfg.DBName := \"mythril\"\ndb, err := mysql.DialCfg(cfg)\n</code></pre>\n\n<p><code>searchcontract/searchcontract.go:67:5: non-name cfg.DBName on left side of :=</code> is the error message I get.</p>\n"}, {"tags": ["reactjs", "docker", "go", "nginx"], "comments": [{"owner": {"reputation": 3559, "user_id": 2717397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ur8zJ.jpg?s=128&g=1", "display_name": "Enix", "link": "https://stackoverflow.com/users/2717397/enix"}, "edited": false, "score": 0, "creation_date": 1565402023, "post_id": 57438522, "comment_id": 101354683, "body": "I think you have wrongly used <code>rewrite</code> directive, to truncate <code>&#47;api&#47;</code> prefix before forwarding request to your <code>gin</code> app, however your <code>gin</code> app does include the <code>api</code> prefix."}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "reply_to_user": {"reputation": 3559, "user_id": 2717397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ur8zJ.jpg?s=128&g=1", "display_name": "Enix", "link": "https://stackoverflow.com/users/2717397/enix"}, "edited": false, "score": 0, "creation_date": 1565402863, "post_id": 57438522, "comment_id": 101354773, "body": "I thought <code>api := router.Group(&quot;&#47;api&quot;)</code> indicates <code>&#47;api&#47;</code> for api request."}, {"owner": {"reputation": 3559, "user_id": 2717397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ur8zJ.jpg?s=128&g=1", "display_name": "Enix", "link": "https://stackoverflow.com/users/2717397/enix"}, "edited": false, "score": 0, "creation_date": 1565403167, "post_id": 57438522, "comment_id": 101354814, "body": "yes, but the url <code>&#47;api&#47;ariticles</code> have been rewrite to <code>&#47;articles</code> before passing to <code>gin</code>. The last fourth line in your log have told you that <code>gin</code> could not found path for <code>&#47;articles</code>."}, {"owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "reply_to_user": {"reputation": 3559, "user_id": 2717397, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Ur8zJ.jpg?s=128&g=1", "display_name": "Enix", "link": "https://stackoverflow.com/users/2717397/enix"}, "edited": false, "score": 0, "creation_date": 1565407430, "post_id": 57438522, "comment_id": 101355225, "body": "Issue is resolved by removing <code>rewrite &#47;api&#47;(.*) &#47;$1 break;</code>. Thanks so much."}], "answers": [{"tags": [], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "is_accepted": true, "score": 0, "last_activity_date": 1565416247, "creation_date": 1565416247, "answer_id": 57439670, "question_id": 57438522, "link": "https://stackoverflow.com/questions/57438522/request-to-api-servergolang-via-nginx-failed-and-returned-404-error/57439670#57439670", "title": "Request to api server(Golang) via nginx failed and returned 404 error", "body": "<p>As Enix suggested on comment, after removing <code>rewrite</code> directive, issue is resolved.</p>\n\n<p><code>rewrite /api/(.*) /$1 break;</code></p>\n"}], "owner": {"reputation": 193, "user_id": 11766408, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec295cea34bc4a92fe14a67082d53407?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc", "link": "https://stackoverflow.com/users/11766408/jpskgc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 239, "favorite_count": 0, "accepted_answer_id": 57439670, "answer_count": 1, "score": -1, "last_activity_date": 1565416247, "creation_date": 1565398329, "last_edit_date": 1565401962, "question_id": 57438522, "link": "https://stackoverflow.com/questions/57438522/request-to-api-servergolang-via-nginx-failed-and-returned-404-error", "title": "Request to api server(Golang) via nginx failed and returned 404 error", "body": "<p>I'm setting up nginx in docker environment.<br>\nWhen I try to access to api server via nginx port, request returns 404 error.<br></p>\n\n<p>Here is the stack.</p>\n\n<pre><code>\u30fbclient: react/axios\n\u30fbapi: golang/gin\n\u30fbweb server: nginx\n\u30fbdb: mysql\n\u30fbcontainer: docker\n\u30fbci-tool: travis\n\u30fbdeploy: aws elastic beanstalk\n</code></pre>\n\n<p>Entire source code is here:<br>\n<a href=\"https://github.com/jpskgc/article\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article</a></p>\n\n<pre><code>article\n  \u251c client\n  \u2502  \u2514 nginx\n  \u2502      \u2514 default.conf\n  \u251c api\n  \u251c nginx\n  \u2502   \u2514 default.conf\n  \u2514 docker-compose.yml\n</code></pre>\n\n<p>Here is <code>docker-compose.yml</code>.</p>\n\n<pre><code>//docker-compose.yml\nversion: '3'\nservices:\n  nginx:\n    restart: always\n    build:\n      dockerfile: Dockerfile.dev\n      context: ./nginx\n    ports:\n      - '3050:80'\n    depends_on:\n      - client\n      - api\n  api:\n    build:\n      dockerfile: Dockerfile.dev\n      context: ./api\n    volumes:\n      - ./api:/app\n    depends_on:\n      - db\n    tty: true\n    environment:\n      - AWS_ACCESS_KEY_ID\n      - AWS_SECRET_ACCESS_KEY\n      - MYSQL_USER\n      - MYSQL_PASSWORD\n      - MYSQL_HOST\n  client:\n    build:\n      dockerfile: Dockerfile.dev\n      context: ./client\n    volumes:\n      - /app/node_modules\n      - ./client:/app\n</code></pre>\n\n<p>Here is <code>default.conf</code>.</p>\n\n<pre><code>//default.conf\nupstream client {\n  server client:3000;\n}\n\nupstream api {\n  server api:2345;\n}\n\nserver {\n  listen 80;\n\nlocation / {\n  proxy_pass http://client;\n}\n\nlocation /sockjs-node {\n  proxy_pass http://client;\n  proxy_http_version 1.1;\n  proxy_set_header Upgrade $http_upgrade;\n  proxy_set_header Connection \"Upgrade\";\n}\n\nlocation /api {\n  rewrite /api/(.*) /$1 break;\n  proxy_pass http://api;\n  }\n}\n</code></pre>\n\n<p>Also there is <code>default.conf</code> in client.</p>\n\n<pre><code>server {\n  listen 3000;\n\n  location / {\n    root /usr/share/nginx/html;\n    index index.html index.htm;\n    try_files $uri $uri/ /index.html;\n  }\n}\n</code></pre>\n\n<p>I expect nginx reverse proxy to port 2345 api server.<br>\nBut the actual returns 404 response.</p>\n\n<pre><code>nginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:06 +0000] \"GET / HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:06 +0000] \"GET /static/js/bundle.js HTTP/1.1\" 304 0 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:07 +0000] \"GET /static/js/0.chunk.js HTTP/1.1\" 304 0 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:07 +0000] \"GET /static/js/main.chunk.js HTTP/1.1\" 304 0 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:07 +0000] \"GET /static/js/bundle.js.map HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:08 +0000] \"GET /static/js/0.chunk.js.map HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:08 +0000] \"GET /static/js/main.chunk.js.map HTTP/1.1\" 304 0 \"-\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\napi_1     | [GIN] 2019/08/09 - 22:19:09 | 404 |      41.937\u00b5s |      172.23.0.5 | GET      /articles\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:09 +0000] \"GET /api/articles HTTP/1.1\" 404 18 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:10 +0000] \"GET /sockjs-node/info?t=1565389150444 HTTP/1.1\" 200 90 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\nnginx_1   | 172.23.0.1 - - [09/Aug/2019:22:19:10 +0000] \"GET /manifest.json HTTP/1.1\" 304 0 \"http://localhost:3050/\" \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_14_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/76.0.3809.100 Safari/537.36\" \"-\"\n</code></pre>\n\n<p>Also when accessing to actual deployed url, it returns <code>502 Bad Gateway</code> now.<br>\n<a href=\"http://multidocker-env.vwnrixavuv.ap-northeast-1.elasticbeanstalk.com/api/articles\" rel=\"nofollow noreferrer\">http://multidocker-env.vwnrixavuv.ap-northeast-1.elasticbeanstalk.com/api/articles</a></p>\n"}, {"tags": ["mysql", "azure", "go", "ssl"], "answers": [{"tags": [], "owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "is_accepted": true, "score": 0, "last_activity_date": 1565645385, "creation_date": 1565645385, "answer_id": 57468487, "question_id": 57438448, "link": "https://stackoverflow.com/questions/57438448/bad-connection-with-mysql-connection-string-with-tls/57468487#57468487", "title": "Bad connection with MySQL connection string with TLS", "body": "<p>The db was mssql and not mysql. My bad. The port # should have given it away</p>\n"}], "owner": {"reputation": 155, "user_id": 6759337, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xmkBv.png?s=128&g=1", "display_name": "PeggyScott", "link": "https://stackoverflow.com/users/6759337/peggyscott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 389, "favorite_count": 0, "closed_date": 1565699590, "accepted_answer_id": 57468487, "answer_count": 1, "score": 1, "last_activity_date": 1565648246, "creation_date": 1565397130, "last_edit_date": 1565648246, "question_id": 57438448, "link": "https://stackoverflow.com/questions/57438448/bad-connection-with-mysql-connection-string-with-tls", "closed_reason": "Not suitable for this site", "title": "Bad connection with MySQL connection string with TLS", "body": "<p>I am unable to connect to my MySQL database on Azure using Go. I am seeing:</p>\n\n<pre><code>API server listening at: 127.0.0.1:XXXXX\n[mysql] 2019/08/09 16:42:17 packets.go:36: read tcp XXX.XXX.X.XX:XXXXX-&gt;XX.XX.XXX.XXX:1433: read: connection reset by peer\n[mysql] 2019/08/09 16:42:23 packets.go:36: read tcp XXX.XXX.X.XX:XXXXX-&gt;XX.XX.XXX.XXX:1433: read: connection reset by peer\n[mysql] 2019/08/09 16:42:29 packets.go:36: read tcp XXX.XXX.X.XX:XXXXX-&gt;XX.XX.XXX.XXX:1433: read: connection reset by peer\npanic: driver: bad connection\n\ngoroutine 1 [running]:\ndb.ConnectToDB(0x134c7aa, 0x5, 0xc0000e6000, 0x9b)\n    /Users/myuser/go/src/db/db-connection.go:113 +0x249\nmain.main()\n    /Users/myuser/go/src/mydbapp/main.go:12 +0x58\n</code></pre>\n\n<p>I tried instructions at <a href=\"https://docs.microsoft.com/en-us/azure/mysql/connect-go\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/mysql/connect-go</a></p>\n\n<pre><code>package db\n\nimport (\n\u00a0\u00a0\u00a0\u00a0\"database/sql\"\n\u00a0\u00a0\u00a0\u00a0\"fmt\"\n\u00a0\u00a0\u00a0\u00a0\"os\"\n\n\u00a0\u00a0\u00a0\u00a0_ \"github.com/go-sql-driver/mysql\"\n\u00a0\u00a0\u00a0\u00a0_ \"github.com/lib/pq\"\n)\n\n\nfunc ConnectToMydb() {\n\n\u00a0\u00a0\u00a0\u00a0mysqlInfo := fmt.Sprintf(\"myusername@myservernameshort:mypassword@tcp\" +\n\u00a0\u00a0\u00a0\u00a0\"(myservenameshort.database.windows.net:1433)/mydbname?\" +\n\u00a0\u00a0\u00a0\u00a0\"&amp;allowNativePasswords=true&amp;tls=true&amp;timeout=30s\"\n)\n\n\u00a0\u00a0\u00a0\u00a0db, err := sql.Open(\"mysql\", mysqlInfo)\n\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0panic(err)\n\u00a0\u00a0\u00a0\u00a0}\n\u00a0\u00a0\u00a0\u00a0defer db.Close()\n\n\u00a0\u00a0\u00a0\u00a0err = db.Ping()\n\u00a0\u00a0\u00a0\u00a0if err != nil {\n\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0\u00a0panic(err)\n\u00a0\u00a0\u00a0\u00a0}\n\n\u00a0\u00a0\u00a0\u00a0fmt.Println(\"Successfully connected mydb!\")\n}\n</code></pre>\n\n<p>My JDBC equivalent connection string is as follows:</p>\n\n<pre><code>jdbc:sqlserver://myservernameshort.database.windows.net:1433;database=mydbname;encrypt=true;trustServerCertificate=false;hostNameInCertificate=*.database.windows.net;loginTimeout=30\n</code></pre>\n\n<p>and that works.</p>\n\n<p>The instructions at the following link were not clear if I need to go that route:\n<a href=\"https://godoc.org/github.com/go-sql-driver/mysql#RegisterTLSConfig\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/go-sql-driver/mysql#RegisterTLSConfig</a></p>\n\n<p>Please guide how I can proceed/ if you need more information/ what I could try</p>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-dataflow", "apache-beam"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565558386, "post_id": 57439515, "comment_id": 101381941, "body": "Thanks for your answer, but for google dataflow, a google cloud tempLocation has to be used even when running local test,  <code>pipeline.getOptions().setTempLocation(&quot;gs:&#47;&#47;xxxx&quot;)</code> and it works fine locally. We are seeing the temp files for local jobs in &quot;gs://&quot; folder."}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565558707, "post_id": 57439515, "comment_id": 101381994, "body": "You means that when you run it locally, you use gs:// and that works? And that don&#39;t work on dataflow?"}, {"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565628571, "post_id": 57439515, "comment_id": 101403710, "body": "Yes when I run my dataflow pipeline locally, I use gs:// and that works(because my dataflow pipeline read from and write to BQ, I need a temporary location in google storage). But when I run it on google platform , I got this &quot; No filesystem found for scheme gs&quot; error."}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565641151, "post_id": 57439515, "comment_id": 101408670, "body": "Just to be sure to not mix up, the temporary location is in GCS, thus you pass this param at your runner. However, about the file URL passed in the <code>FileSystems.getFileSystemInternal()</code> method, is it also a gs:// file prefix in your local environment ?"}, {"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565650282, "post_id": 57439515, "comment_id": 101411315, "body": "FileSystems.getFileSystemInternal() is build in Beam sdks library. I didn&#39;t handle it. But yes I am using &quot;gs://xxxx&quot; as tempLocation in local environment."}, {"owner": {"reputation": 1046, "user_id": 4696015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/855f6bec333197714ad5fc2b6fdb1315?s=128&d=identicon&r=PG&f=1", "display_name": "chamikara", "link": "https://stackoverflow.com/users/4696015/chamikara"}, "edited": false, "score": 0, "creation_date": 1565657649, "post_id": 57439515, "comment_id": 101412475, "body": "Is it possible that &#39;beam-sdks-java-extensions-google-cloud-platform-core-&lt;versi&zwnj;&#8203;on&gt;.jar&#39; which contains &#39;GcsFileSystemRegistrar&#39; not available your CLASSPATH somehow when running using Dataflow runner ? <code>Filesystem</code>s are loaded by looking for <code>FileSystemRegistrar</code> implementations in the CLASSPATH (at pipeline submission and when starting Dataflow workers). All classes/jars in your local CLASSPATH get staged by Dataflow."}, {"owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "reply_to_user": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565724560, "post_id": 57439515, "comment_id": 101439664, "body": "@MingMing could you provide part of code that create the issue ? Anonymise and with only the relevant part."}, {"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "reply_to_user": {"reputation": 1046, "user_id": 4696015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/855f6bec333197714ad5fc2b6fdb1315?s=128&d=identicon&r=PG&f=1", "display_name": "chamikara", "link": "https://stackoverflow.com/users/4696015/chamikara"}, "edited": false, "score": 0, "creation_date": 1565736210, "post_id": 57439515, "comment_id": 101443268, "body": "@chamikara Yes, that&#39;s probably the reason, we are trying to build Uber jar using shadow plugin, hope this will fix the issue. Thanks."}, {"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1565736329, "post_id": 57439515, "comment_id": 101443298, "body": "@guillaumeblaquiere Code that created the are in google dataflow library.     ``` static FileSystem getFileSystemInternal(String scheme) {         String lowerCaseScheme = scheme.toLowerCase();         Map&lt;String, FileSystem&gt; schemeToFileSystem = (Map)SCHEME_TO_FILESYSTEM.get();         FileSystem rval = (FileSystem)schemeToFileSystem.get(lowerCaseScheme);         if (rval == null) {             throw new IllegalArgumentException(&quot;No filesystem found for scheme &quot; + scheme);         } else {             return rval;         }     }```"}, {"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "reply_to_user": {"reputation": 1046, "user_id": 4696015, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/855f6bec333197714ad5fc2b6fdb1315?s=128&d=identicon&r=PG&f=1", "display_name": "chamikara", "link": "https://stackoverflow.com/users/4696015/chamikara"}, "edited": false, "score": 0, "creation_date": 1565741320, "post_id": 57439515, "comment_id": 101444260, "body": "@chamikara We use Shadow plugin to make a Uber jar and problem got solved. Thanks."}], "tags": [], "owner": {"reputation": 31223, "user_id": 11372593, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-FQBr5NRaPHA/AAAAAAAAAAI/AAAAAAAABb0/XuGqOq18jyg/photo.jpg?sz=128", "display_name": "guillaume blaquiere", "link": "https://stackoverflow.com/users/11372593/guillaume-blaquiere"}, "is_accepted": false, "score": 0, "last_activity_date": 1565415134, "last_edit_date": 1565415134, "creation_date": 1565414301, "answer_id": 57439515, "question_id": 57438349, "link": "https://stackoverflow.com/questions/57438349/no-filesystem-found-for-scheme-gs-when-running-dataflow-in-google-cloud-platfo/57439515#57439515", "title": "&quot;No filesystem found for scheme gs&quot; when running dataflow in google cloud platform", "body": "<p>It's normal. On your computer, you are using internal file with your tests (/.... In Linux, c:... In Windows). However, Google cloud storage isn't a an internal file system (btw it's not a file system) and thus the \"gs://\" can't be interpreted.</p>\n\n<p>Try <code>TextIO.read.from(...)</code>.</p>\n\n<p>You can use it for <a href=\"https://beam.apache.org/releases/javadoc/2.2.0/org/apache/beam/sdk/io/TextIO.Read.html#from-java.lang.String-\" rel=\"nofollow noreferrer\">internal and external files like GCS</a> . </p>\n\n<p>However, I experienced an issue, months ago on Windows environment, when I developed in Windows. <code>C:</code> wasn't a known scheme (same error as yours).\nIt's possible that works now (I'm no longer on Windows, I can't test). Else, you have this workaround pattern: set a variable in your config object and perform a test on it like:</p>\n\n<pre><code>If (environment config variable is local)\n    p.apply(FileSystems.getFileSystemInternal...);\nElse \n    p.apply(TextIO.read.from(...));\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "edited": false, "score": 0, "creation_date": 1567712394, "post_id": 57793659, "comment_id": 102055410, "body": "Yes building fat jar incorrectly is exactly the problem.  We have fixed this problem by using shadow plug in to build the fat jar. Thanks."}, {"owner": {"reputation": 704, "user_id": 848850, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/501356e972dfc4acd2eaa4548e346abd?s=128&d=identicon&r=PG", "display_name": "nsandersen", "link": "https://stackoverflow.com/users/848850/nsandersen"}, "edited": false, "score": 1, "creation_date": 1604330822, "post_id": 57793659, "comment_id": 114307903, "body": "I got that to work by adding the transformer <code>&lt;transformer implementation=&quot;org.apache.maven.plugins.shade.resource.Serv&zwnj;&#8203;icesResourceTransfor&zwnj;&#8203;mer&quot;&#47;&gt;</code> described here: <a href=\"https://maven.apache.org/plugins/maven-shade-plugin/examples/resource-transformers.html#ServicesResourceTransformer\" rel=\"nofollow noreferrer\">maven.apache.org/plugins/maven-shade-plugin/examples/&hellip;</a>"}], "tags": [], "owner": {"reputation": 4374, "user_id": 949327, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64c8e18207e90f50845cec28d2414060?s=128&d=identicon&r=PG", "display_name": "Kenn Knowles", "link": "https://stackoverflow.com/users/949327/kenn-knowles"}, "is_accepted": true, "score": 3, "last_activity_date": 1567620040, "creation_date": 1567620040, "answer_id": 57793659, "question_id": 57438349, "link": "https://stackoverflow.com/questions/57438349/no-filesystem-found-for-scheme-gs-when-running-dataflow-in-google-cloud-platfo/57793659#57793659", "title": "&quot;No filesystem found for scheme gs&quot; when running dataflow in google cloud platform", "body": "<p>This may be caused by a couple of issues if you build a \"fat jar\" that bundles all of your dependencies.</p>\n\n<ol>\n<li>You must include the dependency <a href=\"https://mvnrepository.com/artifact/org.apache.beam/beam-sdks-java-extensions-google-cloud-platform-core\" rel=\"nofollow noreferrer\"><code>org.apache.beam:google-cloud-platform-core</code></a> to have the Beam GCS filesystem.</li>\n<li>Inside your far jar, you must preserve the <code>META-INF/services/org.apache.beam.sdk.io.FileSystemRegistrar</code> file with a line <code>org.apache.beam.sdk.extensions.gcp.storage.GcsFileSystemRegistrar</code>. You can find this file in the jar from step 1. You will probably have many files with the same name in your dependencies, registering different Beam filesystems. You need to configure maven or gradle to combine these as part of your build or they will overwrite each other and not work properly.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 7469337, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f8c27a0a8213b4bf0a210bc5ecbf4e2b?s=128&d=identicon&r=PG&f=1", "display_name": "Raman", "link": "https://stackoverflow.com/users/7469337/raman"}, "is_accepted": false, "score": 2, "last_activity_date": 1611757294, "creation_date": 1611757294, "answer_id": 65921048, "question_id": 57438349, "link": "https://stackoverflow.com/questions/57438349/no-filesystem-found-for-scheme-gs-when-running-dataflow-in-google-cloud-platfo/65921048#65921048", "title": "&quot;No filesystem found for scheme gs&quot; when running dataflow in google cloud platform", "body": "<p>There is also one more reason for this exception.\nMake sure you create pipeline (e.g. <code>Pipeline.create(options)</code>) before you try to access files.</p>\n"}, {"tags": [], "owner": {"reputation": 4514, "user_id": 2640467, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/7UJJQ.jpg?s=128&g=1", "display_name": "Luillyfe", "link": "https://stackoverflow.com/users/2640467/luillyfe"}, "is_accepted": false, "score": 0, "last_activity_date": 1615282063, "last_edit_date": 1615282063, "creation_date": 1614027729, "answer_id": 66323402, "question_id": 57438349, "link": "https://stackoverflow.com/questions/57438349/no-filesystem-found-for-scheme-gs-when-running-dataflow-in-google-cloud-platfo/66323402#66323402", "title": "&quot;No filesystem found for scheme gs&quot; when running dataflow in google cloud platform", "body": "<p>[GOLANG] In my case it was solved by applying the below imports for side-effects</p>\n<pre><code>import (\n_ &quot;github.com/apache/beam/sdks/go/pkg/beam/io/filesystem/gcs&quot;\n_ &quot;github.com/apache/beam/sdks/go/pkg/beam/io/filesystem/local&quot;\n_ &quot;github.com/apache/beam/sdks/go/pkg/beam/io/filesystem/memfs&quot;\n)\n</code></pre>\n"}], "owner": {"reputation": 43, "user_id": 6330567, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-hNze74HTdSU/AAAAAAAAAAI/AAAAAAAAB-U/0CfoA9eGchU/photo.jpg?sz=128", "display_name": "Ming Ming", "link": "https://stackoverflow.com/users/6330567/ming-ming"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1789, "favorite_count": 2, "accepted_answer_id": 57793659, "answer_count": 4, "score": 4, "last_activity_date": 1615282063, "creation_date": 1565395713, "last_edit_date": 1614027770, "question_id": 57438349, "link": "https://stackoverflow.com/questions/57438349/no-filesystem-found-for-scheme-gs-when-running-dataflow-in-google-cloud-platfo", "title": "&quot;No filesystem found for scheme gs&quot; when running dataflow in google cloud platform", "body": "<p>I am running my google dataflow job in Google Cloud Platform(GCP). \nWhen I run this job locally it worked well, but when running it on GCP, I got this error \n\"java.lang.IllegalArgumentException: No filesystem found for scheme gs\".\nI have access to that google cloud URI, I can upload my jar file to that URI and I can see some temporary file for my local job. </p>\n\n<p>My Job id in GCP:</p>\n\n<p>2019-08-08_21_47_27-162804342585245230 (beam version:2.12.0)</p>\n\n<p>2019-08-09_16_41_15-11728697820819900062 (beam version:2.14.0)</p>\n\n<p>I have tried beam version of 2.12.0 and 2.14.0, both of them have the same error.</p>\n\n<pre><code>\njava.lang.IllegalArgumentException: No filesystem found for scheme gs\n    at org.apache.beam.sdk.io.FileSystems.getFileSystemInternal(FileSystems.java:456)\n    at org.apache.beam.sdk.io.FileSystems.matchNewResource(FileSystems.java:526)\n    at org.apache.beam.sdk.io.gcp.bigquery.BigQueryHelpers.resolveTempLocation(BigQueryHelpers.java:689)\n    at org.apache.beam.sdk.io.gcp.bigquery.BigQuerySourceBase.extractFiles(BigQuerySourceBase.java:125)\n    at org.apache.beam.sdk.io.gcp.bigquery.BigQuerySourceBase.split(BigQuerySourceBase.java:148)\n    at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.splitAndValidate(WorkerCustomSources.java:284)\n    at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplitTyped(WorkerCustomSources.java:206)\n    at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplitWithApiLimit(WorkerCustomSources.java:190)\n    at org.apache.beam.runners.dataflow.worker.WorkerCustomSources.performSplit(WorkerCustomSources.java:169)\n    at org.apache.beam.runners.dataflow.worker.WorkerCustomSourceOperationExecutor.execute(WorkerCustomSourceOperationExecutor.java:78)\n    at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.executeWork(BatchDataflowWorker.java:412)\n    at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.doWork(BatchDataflowWorker.java:381)\n    at org.apache.beam.runners.dataflow.worker.BatchDataflowWorker.getAndPerformWork(BatchDataflowWorker.java:306)\n    at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.doWork(DataflowBatchWorkerHarness.java:135)\n    at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.call(DataflowBatchWorkerHarness.java:115)\n    at org.apache.beam.runners.dataflow.worker.DataflowBatchWorkerHarness$WorkerThread.call(DataflowBatchWorkerHarness.java:102)\n    at java.util.concurrent.FutureTask.run(FutureTask.java:266)\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142)\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617)\n    at java.lang.Thread.run(Thread.java:745)\n</code></pre>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565395191, "post_id": 57438134, "comment_id": 101353869, "body": "Are you asking how to send a message from a client to a server on s websocket connection?  Is the client using the Gorilla package or something else?"}, {"owner": {"reputation": 162, "user_id": 4755352, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-nT0E-FaJwZY/AAAAAAAAAAI/AAAAAAAAENM/To5HQC46OlI/photo.jpg?sz=128", "display_name": "Rishi Anand", "link": "https://stackoverflow.com/users/4755352/rishi-anand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565398497, "post_id": 57438134, "comment_id": 101354288, "body": "I am able to send the msg from client-&gt;server and vice versa but how to send the acknowledgement that client or server has received the message."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565404352, "post_id": 57438134, "comment_id": 101354920, "body": "Send an acknowledgment message just like any other message. What is the reason that you need to send acknowledgement messages separate from the HTTP requests and responses sent over the connection?"}, {"owner": {"reputation": 162, "user_id": 4755352, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-nT0E-FaJwZY/AAAAAAAAAAI/AAAAAAAAENM/To5HQC46OlI/photo.jpg?sz=128", "display_name": "Rishi Anand", "link": "https://stackoverflow.com/users/4755352/rishi-anand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565481637, "post_id": 57438134, "comment_id": 101369055, "body": "I want to invoke HTTP endpoints at client-side using WebSockets. I couldn&#39;t find any way to it. So, I am wrapping all required data like endpoint, payload, etc as a JSON and sending it to the client from server. Now, the client which is running in the private network will make rest call to HTTP endpoint which is enclosed in the message and will return the data to the server. So, this response will be packaged in acknowledgment which is sent to server and server can identify the exact response."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565487062, "post_id": 57438134, "comment_id": 101369523, "body": "Assign a unique id to the request on the server, include that id in the request message, echo the id back to the server in the response message, server uses id to correlate response with request."}, {"owner": {"reputation": 162, "user_id": 4755352, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-nT0E-FaJwZY/AAAAAAAAAAI/AAAAAAAAENM/To5HQC46OlI/photo.jpg?sz=128", "display_name": "Rishi Anand", "link": "https://stackoverflow.com/users/4755352/rishi-anand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565579736, "post_id": 57438134, "comment_id": 101384630, "body": "Yes, thought of that solution. BTW thanks a lot (y)"}, {"owner": {"reputation": 162, "user_id": 4755352, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-nT0E-FaJwZY/AAAAAAAAAAI/AAAAAAAAENM/To5HQC46OlI/photo.jpg?sz=128", "display_name": "Rishi Anand", "link": "https://stackoverflow.com/users/4755352/rishi-anand"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565645289, "post_id": 57438134, "comment_id": 101409975, "body": "I was looking for another solution where I don&#39;t need to maintain such logics for filtering response in server."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1565656712, "post_id": 57438134, "comment_id": 101412319, "body": "It should take a few lines of code to implement the feature."}], "owner": {"reputation": 162, "user_id": 4755352, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh4.googleusercontent.com/-nT0E-FaJwZY/AAAAAAAAAAI/AAAAAAAAENM/To5HQC46OlI/photo.jpg?sz=128", "display_name": "Rishi Anand", "link": "https://stackoverflow.com/users/4755352/rishi-anand"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 278, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1565392999, "creation_date": 1565392999, "question_id": 57438134, "link": "https://stackoverflow.com/questions/57438134/how-to-send-acknowledgement-to-a-message-to-server-from-client-when-using-gorill", "title": "How to send acknowledgement to a message to server from client when using gorilla-websockets in go?", "body": "<p>I want to invoke HTTP endpoints at client-side using WebSockets. I am wrapping all required data like endpoint, payload, etc as a JSON and sending it to the client from server. \nNow, the client which is running in the private network will make rest call to HTTP endpoint which is enclosed in the message and will return the data to the server.</p>\n\n<p>I am not able to figure out the way to send the acknowledgment to the server for a message.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565521223, "post_id": 57438123, "comment_id": 101374031, "body": "WRT using <code>go test -benchmem</code>, I prefer and suggest writing relevant benchmarks with early calls to <a href=\"https://golang.org/pkg/testing/#B.ReportAllocs\" rel=\"nofollow noreferrer\"><code>b.ReportAllocs()</code></a>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1565435074, "last_edit_date": 1565435074, "creation_date": 1565392879, "answer_id": 57438123, "question_id": 57437958, "link": "https://stackoverflow.com/questions/57437958/why-is-strings-builder-is-slower-than-fmt-sprint-for-appending-string-in-my-test/57438123#57438123", "title": "Why is strings.Builder is slower than fmt.Sprint for appending string in my test program?", "body": "<blockquote>\n  <p><code>main_test.go</code>:</p>\n\n<pre><code>func BenchmarkStringsBuilder_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.StringsBuilder()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkStringsBuilder_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.StringsBuilder()\n        }\n        b.StopTimer()\n}\n</code></pre>\n</blockquote>\n\n<p>Your first error is that your code doesn't compile.</p>\n\n<pre><code>BenchmarkStringsBuilder_128 redeclared in this block\n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>go test -v -bench=.</p>\n</blockquote>\n\n<p>Your second error is not using <code>go test</code> option <code>-benchmem</code>.</p>\n\n<pre><code>$ go version\ngo version devel +9c1f14f376 Fri Aug 9 20:26:42 2019 +0000 linux/amd64\n\n$ go test -bench=. -benchmem\n\nBenchmarkFmtSprint_32-8                  5116165   207 ns/op       64 B/op   4 allocs/op\nBenchmarkStringsBuilder_32-8            34339864    37.1 ns/op     32 B/op   1 allocs/op\nBenchmarkSliceAppendString_32-8         12525960    85.5 ns/op    160 B/op   3 allocs/op\nBenchmarkSliceAppendBytes_32-8          17084019    62.0 ns/op     96 B/op   2 allocs/op\nBenchmarkFmtSprint_128-8                 5681800   205 ns/op       64 B/op   4 allocs/op\nBenchmarkStringsBuilder_128-8           26086238    46.3 ns/op    128 B/op   1 allocs/op\nBenchmarkSliceAppendString_128-8         9424910   126 ns/op      544 B/op   3 allocs/op\nBenchmarkSliceAppendBytes_128-8         13260948    88.7 ns/op    384 B/op   2 allocs/op\nBenchmarkFmtSprint_1024-8                5536604   205 ns/op       64 B/op   4 allocs/op\nBenchmarkStringsBuilder_1024-8           8897110   133 ns/op     1024 B/op   1 allocs/op\nBenchmarkSliceAppendString_1024-8        2764279   433 ns/op     3456 B/op   3 allocs/op\nBenchmarkSliceAppendBytes_1024-8        13479661    88.6 ns/op    384 B/op   2 allocs/op\n</code></pre>\n\n<hr>\n\n<p>You may find this function is faster than your functions.</p>\n\n<pre><code>import (\n    \"strconv\"\n)\n\ntype FmtC struct {\n    Field1 uint32\n    Field2 [5]byte\n}\n\nfunc (c FmtC) String() string {\n    s := make([]byte, 0, 32)\n    s = append(s, \"{Field1:\"...)\n    s = strconv.AppendUint(s, uint64(c.Field1), 10)\n    s = append(s, \" Field2:\"...)\n    s = append(s, c.Field2[:]...)\n    s = append(s, \"}\"...)\n    return string(s)\n}\n</code></pre>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 1, "accepted_answer_id": 57438123, "answer_count": 1, "score": 1, "last_activity_date": 1565521696, "creation_date": 1565391328, "last_edit_date": 1565521696, "question_id": 57437958, "link": "https://stackoverflow.com/questions/57437958/why-is-strings-builder-is-slower-than-fmt-sprint-for-appending-string-in-my-test", "title": "Why is strings.Builder is slower than fmt.Sprint for appending string in my test program?", "body": "<p>I'm trying to optimize speed of a <code>String()</code> function of struct <code>FmtC</code>. Based on following benchmark.</p>\n\n<ul>\n<li>If I pre-allocate 1024\u00a0bytes with <code>strings.Builder</code>, it is slower (624\u00a0ns) than <code>fmt.Sprint</code> (437\u00a0ns).</li>\n<li>If I pre-allocate 32\u00a0bytes, <code>strings.Builder</code> is faster (74.8\u00a0ns) but it is not useful if <code>FmtC</code> contains more member fields.</li>\n<li>If I pre-allocate 1024\u00a0bytes by slice append method it is slowest (2337\u00a0ns).</li>\n</ul>\n\n<p>go version: go1.12.7 linux/amd64.</p>\n\n<p>go test -v -bench=. -benchmem</p>\n\n<pre><code>BenchmarkFmtSprint_32-2                  3000000           435 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_32-2            20000000            74.8 ns/op        32 B/op          1 allocs/op\nBenchmarkSliceAppendString_32-2         10000000           213 ns/op         160 B/op          3 allocs/op\nBenchmarkSliceAppendBytes_32-2          10000000           143 ns/op          96 B/op          2 allocs/op\nBenchmarkFmtSprint_128-2                 3000000           437 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_128-2           10000000           125 ns/op         128 B/op          1 allocs/op\nBenchmarkSliceAppendString_128-2         3000000           478 ns/op         544 B/op          3 allocs/op\nBenchmarkSliceAppendBytes_128-2          5000000           312 ns/op         384 B/op          2 allocs/op\nBenchmarkFmtSprint_1024-2                3000000           437 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_1024-2           2000000           624 ns/op        1024 B/op          1 allocs/op\nBenchmarkSliceAppendString_1024-2         500000          2337 ns/op        3456 B/op          3 allocs/op\nBenchmarkSliceAppendBytes_1024-2         5000000           310 ns/op         384 B/op          2 allocs/op\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"strconv\"\n        \"strings\"\n)\n\ntype FmtC struct {\n        Field1 uint32\n        Field2 [5]byte\n}\n\nvar preAllocatedSize = 1024\n\nfunc (c FmtC) FmtSprint() string {\n        return fmt.Sprint(\"{Field1:\", c.Field1, \" Field2:\",\n                string(c.Field2[:]), \"}\")\n}\nfunc (c FmtC) StringsBuilder() string {\n        var s strings.Builder\n        s.Grow(preAllocatedSize) // output length width less than 1024 bytes\n        s.WriteString(\"{Field1:\")\n        s.WriteString(strconv.FormatUint(uint64(c.Field1), 10))\n        s.WriteString(\" Field2:\")\n        s.Write(c.Field2[:])\n        s.WriteString(\"}\")\n        return s.String()\n}\nfunc (c FmtC) SliceAppendString() string {\n        s := make([]byte, preAllocatedSize)\n        s = append(s, \"{Field1:\"...)\n        s = strconv.AppendUint(s, uint64(c.Field1), 10)\n        s = append(s, \" Field2:\"...)\n        s = append(s, c.Field2[:]...)\n        s = append(s, \"}\"...)\n        return string(s)\n}\nfunc (c FmtC) SliceAppendBytes() []byte {\n        s := make([]byte, preAllocatedSize)\n        s = append(s, \"{Field1:\"...)\n        s = strconv.AppendUint(s, uint64(c.Field1), 10)\n        s = append(s, \" Field2:\"...)\n        s = append(s, c.Field2[:]...)\n        s = append(s, \"}\"...)\n        return s\n}\nfunc main() {\n}\n</code></pre>\n\n<p>main_test.go</p>\n\n<pre><code>package main\n\nimport (\n        \"testing\"\n)\n\nvar c = FmtC{5, [5]byte{'h', 'e', 'l', 'l', 'o'}}\n\nfunc BenchmarkFmtSprint_32(b *testing.B) {\n        preAllocatedSize = 32\n        for n := 0; n &lt; b.N; n++ {\n                c.FmtSprint()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkStringsBuilder_32(b *testing.B) {\n        preAllocatedSize = 32\n        for n := 0; n &lt; b.N; n++ {\n                c.StringsBuilder()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendString_32(b *testing.B) {\n        preAllocatedSize = 32\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendString()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendBytes_32(b *testing.B) {\n        preAllocatedSize = 32\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendBytes()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkFmtSprint_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.FmtSprint()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkStringsBuilder_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.StringsBuilder()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendString_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendString()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendBytes_128(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendBytes()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkFmtSprint_1024(b *testing.B) {\n        preAllocatedSize = 1024\n        for n := 0; n &lt; b.N; n++ {\n                c.FmtSprint()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkStringsBuilder_1024(b *testing.B) {\n        preAllocatedSize = 1024\n        for n := 0; n &lt; b.N; n++ {\n                c.StringsBuilder()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendString_1024(b *testing.B) {\n        preAllocatedSize = 1024\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendString()\n        }\n        b.StopTimer()\n}\nfunc BenchmarkSliceAppendBytes_1024(b *testing.B) {\n        preAllocatedSize = 128\n        for n := 0; n &lt; b.N; n++ {\n                c.SliceAppendBytes()\n        }\n        b.StopTimer()\n}\n</code></pre>\n\n<p>(Edit:) After changing the mistake of <code>s := make([]byte, preAllocatedSize)</code> to <code>s := make([]byte, 0, preAllocatedSize)</code>, the result is: only pre-allocated 1024\u00a0bytes version is slower than <code>fmt.Sprint</code> in this simple test.</p>\n\n<pre><code>BenchmarkFmtSprint_32-2                  3000000           432 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_32-2            20000000            75.2 ns/op        32 B/op          1 allocs/op\nBenchmarkSliceAppendString_32-2         20000000           112 ns/op          64 B/op          2 allocs/op\nBenchmarkSliceAppendBytes_32-2          20000000            64.2 ns/op        32 B/op          1 allocs/op\nBenchmarkFmtSprint_128-2                 3000000           437 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_128-2           10000000           123 ns/op         128 B/op          1 allocs/op\nBenchmarkSliceAppendString_128-2        10000000           162 ns/op         160 B/op          2 allocs/op\nBenchmarkSliceAppendBytes_128-2         20000000           110 ns/op         128 B/op          1 allocs/op\nBenchmarkFmtSprint_1024-2                3000000           429 ns/op          64 B/op          4 allocs/op\nBenchmarkStringsBuilder_1024-2           2000000           626 ns/op        1024 B/op          1 allocs/op\nBenchmarkSliceAppendString_1024-2        2000000           653 ns/op        1056 B/op          2 allocs/op\nBenchmarkSliceAppendBytes_1024-2        10000000           110 ns/op         128 B/op          1 allocs/op\n</code></pre>\n"}, {"tags": ["html", "go"], "comments": [{"owner": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "edited": false, "score": 0, "creation_date": 1565387601, "post_id": 57437477, "comment_id": 101352504, "body": "You could things like too deeply nested tags, wrong html entities or an fully empty input"}, {"owner": {"reputation": 552, "user_id": 2510992, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b7cb3e685e2c319d0ca6fa555a460f2d?s=128&d=identicon&r=PG", "display_name": "CreationTribe", "link": "https://stackoverflow.com/users/2510992/creationtribe"}, "edited": false, "score": 0, "creation_date": 1565387602, "post_id": 57437477, "comment_id": 101352506, "body": "perhaps starting with closing tags then ending with the opening tag will yield an error? Or staggering tags that shouldn&#39;t be staggered? &lt;span&gt;&lt;div&gt;&lt;/span&gt;&lt;/div&gt; or &lt;table&gt;&lt;td&gt;&lt;div&gt;&lt;tr&gt;&lt;/td&gt;&lt;/table&gt;&lt;/tr&gt;&lt;/td&gt;&lt;/div&gt; ? Maybe even create a randomization program to throw random tags in mixed with random data, and give it a few runs through. You&#39;ll certainly end up with some error-yielding nonsense."}, {"owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "reply_to_user": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "edited": false, "score": 0, "creation_date": 1565387879, "post_id": 57437477, "comment_id": 101352566, "body": "@Ferrybig : note that the 1st element in the input array is an empty string, and the 2nd one would, I think, but invalid outside of a tag; I&#39;m willing to try deep nesting, but do you know how deep is &quot;too deeply&quot; nested?"}, {"owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "reply_to_user": {"reputation": 552, "user_id": 2510992, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b7cb3e685e2c319d0ca6fa555a460f2d?s=128&d=identicon&r=PG", "display_name": "CreationTribe", "link": "https://stackoverflow.com/users/2510992/creationtribe"}, "edited": false, "score": 0, "creation_date": 1565387983, "post_id": 57437477, "comment_id": 101352582, "body": "@CreationTribe : I like your ideas for staggered tags, and added them to my Go Playground example, but they oddly passed muster, too"}, {"owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "reply_to_user": {"reputation": 15921, "user_id": 1542723, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8a969ba62fc77da0a20654caffbe234?s=128&d=identicon&r=PG", "display_name": "Ferrybig", "link": "https://stackoverflow.com/users/1542723/ferrybig"}, "edited": false, "score": 0, "creation_date": 1565388085, "post_id": 57437477, "comment_id": 101352602, "body": "@Ferrybig : in an earlier test, I had also tried <code>&amp;nope;</code>, but it also didn&#39;t cause an <code>err</code>"}, {"owner": {"reputation": 69587, "user_id": 42585, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/upFCW.jpg?s=128&g=1", "display_name": "Alohci", "link": "https://stackoverflow.com/users/42585/alohci"}, "edited": false, "score": 0, "creation_date": 1565398625, "post_id": 57437477, "comment_id": 101354301, "body": "A full compliant html 5 parser (which the go parser claims to be) won&#39;t error for any input byte stream."}, {"owner": {"reputation": 552, "user_id": 2510992, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b7cb3e685e2c319d0ca6fa555a460f2d?s=128&d=identicon&r=PG", "display_name": "CreationTribe", "link": "https://stackoverflow.com/users/2510992/creationtribe"}, "reply_to_user": {"reputation": 69587, "user_id": 42585, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/upFCW.jpg?s=128&g=1", "display_name": "Alohci", "link": "https://stackoverflow.com/users/42585/alohci"}, "edited": false, "score": 0, "creation_date": 1565410517, "post_id": 57437477, "comment_id": 101355573, "body": "@Alohci Do you have a reference for that? So the Golang HTML5 parser just won&#39;t throw an error/exception?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1565419323, "post_id": 57437477, "comment_id": 101356628, "body": "You don&#39;t have to come up with invalid input. An io.Reader implementation that returns an error should do the trick."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565522641, "post_id": 57437477, "comment_id": 101374338, "body": "To further what @Peter said, I had a look at the code (I recommend doing so whenever you have this kind of question; Go code tends to be easy to read) and without doing an extensive review, the only setting of the internal <code>Tokenizer.err</code> I spotted where to the error returned by the reader."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 0, "creation_date": 1565536583, "post_id": 57437477, "comment_id": 101377271, "body": "From what I can see in the code (<a href=\"https://github.com/golang/net/tree/ca1201d0/html\" rel=\"nofollow noreferrer\">github.com/golang/net/tree/ca1201d0/html</a>), an error is returned if an <code>ErrorToken</code> is returned when parsing a token from the input (<a href=\"https://github.com/golang/net/blob/ca1201d0/html/parse.go#L2280\" rel=\"nofollow noreferrer\">github.com/golang/net/blob/ca1201d0/html/parse.go#L2280</a>). However, it is unclear to me how to get a <code>Token</code> of type <code>ErrorToken</code>."}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 0, "creation_date": 1565536654, "post_id": 57437477, "comment_id": 101377292, "body": "A comment in the code (<a href=\"https://github.com/golang/net/blob/ca1201d0/html/token.go#L135\" rel=\"nofollow noreferrer\">github.com/golang/net/blob/ca1201d0/html/token.go#L135</a>) states that it seems to be possible : <i>For example, if the HTML text input was just &quot;plain&quot;, then the first Next call would set z.err to io.EOF but return a TextToken, and all subsequent Next calls would return an ErrorToken</i>. I don&#39;t understand the &quot;<i>was just &quot;plain&quot;</i>&quot; part, but if someone have an idea, maybe we can find an input able to make <code>html.Parse()</code> return an error."}], "answers": [{"comments": [{"owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "edited": false, "score": 0, "creation_date": 1565626488, "post_id": 57452918, "comment_id": 101402893, "body": "yes, this helps a lot; with a small change to the code where I&#39;m actually doing this, I now inject the io.Reader, so that my production code can read the HTML and one of my unit tests can exercise the parse-error code path;  thanks!"}], "tags": [], "owner": {"reputation": 2815, "user_id": 123600, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0eeb220ccf249757b0960465f2b10631?s=128&d=identicon&r=PG", "display_name": "icio", "link": "https://stackoverflow.com/users/123600/icio"}, "is_accepted": true, "score": 2, "last_activity_date": 1565555496, "last_edit_date": 1565555496, "creation_date": 1565551364, "answer_id": 57452918, "question_id": 57437477, "link": "https://stackoverflow.com/questions/57437477/i-need-html-that-will-fail-parsing-by-html-parse/57452918#57452918", "title": "I need HTML that will fail parsing by html.Parse()", "body": "<p>From a quick read of <a href=\"https://github.com/golang/net/blob/master/html/token.go\" rel=\"nofollow noreferrer\">https://github.com/golang/net/blob/master/html/token.go</a>, it seems that the only returned errors can be:</p>\n\n<ul>\n<li>io.EOF once r is fully read successfully;</li>\n<li>any other errors returned by the underlying io.Reader; or</li>\n<li>html.ErrBufferExceeded</li>\n</ul>\n\n<p>It's not obvious to me after an initial read how trigger ErrBufferExceeded, but you could trigger an error from html.Parse by providing a dummy reader:</p>\n\n<pre><code>type ErrReader struct { Error error }\n\nfunc (e *ErrReader) Read([]byte) (int, error) {\n    return nil, e.Error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/s78HpfMLAI8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/s78HpfMLAI8</a></p>\n\n<p>Hope that helps</p>\n"}], "owner": {"reputation": 1544, "user_id": 7095433, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69e608c3fba680f67e2997cae63cf626?s=128&d=identicon&r=PG", "display_name": "landru27", "link": "https://stackoverflow.com/users/7095433/landru27"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 57452918, "answer_count": 1, "score": 2, "last_activity_date": 1565555496, "creation_date": 1565387280, "last_edit_date": 1565522909, "question_id": 57437477, "link": "https://stackoverflow.com/questions/57437477/i-need-html-that-will-fail-parsing-by-html-parse", "title": "I need HTML that will fail parsing by html.Parse()", "body": "<p>I am writing a Go function to read an HTML response body and extract the page title.  Overall, the function works just great, but I want to test the code path where the response body isn't proper HTML at all.  My simplistic attempts to create some invalid HTML for unit tests have come to naught.</p>\n\n<p>Apparently, and according to the <a href=\"https://godoc.org/golang.org/x/net/html#Parse\" rel=\"nofollow noreferrer\"><code>html.Parse</code> documentation</a>, this is because:</p>\n\n<blockquote>\n  <p>the HTML5 parsing algorithm [\u2026] is very complicated. The resultant tree can contain implicitly created nodes that have no explicit <code>&lt;tag&gt;</code> listed in r's data, and nodes' parents can differ from the nesting implied by a naive processing of start and end <code>&lt;tag&gt;</code>s. Conversely, explicit <code>&lt;tag&gt;</code>s in r's data can be silently dropped, with no corresponding node in the resulting tree.</p>\n</blockquote>\n\n<p>Here is some code demonstrating the sort of approach I've been taking:</p>\n\n<p><a href=\"https://play.golang.org/p/T5WjdtjNcqq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/T5WjdtjNcqq</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    inputs := []string{ \"\",\n        \"~\",\n        \"&lt;\",\n        \"&lt;ht\",\n        \"&lt;html\",\n        \"&lt;html&gt;\",\n        \"&lt;html&gt;&lt;\",\n        \"&lt;html&gt;&lt;titl\",\n        \"&lt;html&gt;&lt;title\",\n        \"&lt;html&gt;&lt;title&gt;\",\n        \"&lt;html&gt;&lt;title&gt;The C Progr\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/ti\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;&lt;\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;&lt;/\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;&lt;/ht\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;&lt;/html\",\n        \"&lt;html&gt;&lt;title&gt;The C Programming Language&lt;/title&gt;&lt;/html&gt;\",\n    }\n\n    for _, in := range inputs {\n        fmt.Printf(\"%s\\n\", in)\n\n        r := bytes.NewReader([]byte(in))\n        _, err := html.Parse(r)\n        if err != nil {\n            fmt.Printf(\"COULD NOT PARSE HTML\\n\")\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p>Silly me, I would have expected many of these to yield an error since at face value they are invalid HTML, but the above code sails through all of the input strings without <code>panic</code>'ing -- that is, with no non-<code>nil</code> <code>err</code> from <code>html.Parse()</code>.</p>\n\n<p>I suppose I am grateful for a lenient / tolerant HTML parser, but: Does anyone have an example of text that would yield an error when fed to Go's <code>html.Parse()</code>?</p>\n\n<p><strong>EDIT 1</strong></p>\n\n<p>Combining ideas from comments by Ferrybig and CreationTribe, I even tried a huge stream of random bytes:</p>\n\n<pre><code>    rand.Seed(time.Now().UnixNano())\n\n    in := make([]byte, 0)\n    for i := 0; i &lt; 2147483647; i++ {\n        in = append(in, byte(rand.Intn(255)))\n    }\n    fmt.Printf(\"len(in) : %d\\n\", len(in))\n\n    r := bytes.NewReader(in)\n    _, err := html.Parse(r)\n</code></pre>\n\n<p>\u2026 and it still did not error.</p>\n\n<p>Is there no input that will cause <code>html.Parse()</code> to error out?</p>\n"}, {"tags": ["linux", "go", "netflow"], "owner": {"reputation": 11, "user_id": 11591576, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-hDvr-LvkUzI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfwlNpmQ5LSz7pHaa8XHc1rraC8Ug/mo/photo.jpg?sz=128", "display_name": "\u0412\u0438\u043a\u0442\u043e\u0440 \u041b\u043e\u0433\u0438\u043d\u043e\u0432", "link": "https://stackoverflow.com/users/11591576/%d0%92%d0%b8%d0%ba%d1%82%d0%be%d1%80-%d0%9b%d0%be%d0%b3%d0%b8%d0%bd%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1565373977, "creation_date": 1565373977, "question_id": 57435190, "link": "https://stackoverflow.com/questions/57435190/how-to-read-dump-flow-capture-from-go", "title": "How to read dump flow-capture from GO?", "body": "<p>The capture stream adds netflow v5 dumps to the server, when reading it from GO it is either simply impossible to read, because the first two bytes are not a version of netflow, or if I transfer the packet to 11 arrays, it gives the packet completely or also gives an error if it tries example output that should be, example output:\n<code>\n0.0.0.10\n157.121.64.85\n138.166.72.38\n107.207.29.71\n108.177.99.171\n243.117.126.147</code>\nBut netflow writes addresses in a dump which are behind NAT.\nWhen working with flow-tools everything is displayed correctly, used various libraries to unmarshal into the structure, but the output is the same everywhere, the one indicated above.</p>\n\n<pre><code>    go func() {\n    for f := range fileNamesCatalog{\n      file, err := ioutil.ReadFile(f)\n      if err != nil{\n        fmt.Errorf(\"Failed open file %v\", f)\n        continue\n      }\n      decoder := netflow.NewDecoder(session.New())\n      body, err := decoder.Read(bytes.NewReader(file[11:]))\n      switch packet := body.(type) {\n      case *netflow5.Packet:\n        filter(packet,net.ParseIP(\"157.121.64.85\"),packetsChannel)\n      }\n\n    }\n     }()\n\n</code></pre>\n\n<p>I am using two packages:\n<a href=\"https://github.com/tehmaze/netflow\" rel=\"nofollow noreferrer\">https://github.com/tehmaze/netflow</a>\n<a href=\"https://github.com/VerizonDigital/vflow\" rel=\"nofollow noreferrer\">https://github.com/VerizonDigital/vflow</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1565358994, "post_id": 57431604, "comment_id": 101341249, "body": "the link is saying that the directory is not found"}], "answers": [{"comments": [{"owner": {"reputation": 17, "user_id": 3163024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/691a1643203dbcb8cd284a1446b438d1?s=128&d=identicon&r=PG&f=1", "display_name": "swamydkv", "link": "https://stackoverflow.com/users/3163024/swamydkv"}, "edited": false, "score": 0, "creation_date": 1565361758, "post_id": 57431887, "comment_id": 101342815, "body": "Going to url <a href=\"https://www.3gpp.org/ftp//Specs/archive/29_series/29.512/\" rel=\"nofollow noreferrer\">3gpp.org/ftp//Specs/archive/29_series/29.512</a> lists all the files, and when I copy the link it give me <a href=\"https://www.3gpp.org/ftp/Specs/archive/29_series/29.512/29512-f20.zip\" rel=\"nofollow noreferrer\">3gpp.org/ftp/Specs/archive/29_series/29.512/29512-f20.zip</a>, also the file gets downloaded."}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "reply_to_user": {"reputation": 17, "user_id": 3163024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/691a1643203dbcb8cd284a1446b438d1?s=128&d=identicon&r=PG&f=1", "display_name": "swamydkv", "link": "https://stackoverflow.com/users/3163024/swamydkv"}, "edited": false, "score": 0, "creation_date": 1565361882, "post_id": 57431887, "comment_id": 101342888, "body": "So change the url to reflect what you want for instance <a href=\"https://www.3gpp.org/ftp/Specs/archive/29_series/29.512/29512-000.zip\" rel=\"nofollow noreferrer\">3gpp.org/ftp/Specs/archive/29_series/29.512/29512-000.zip</a>, <a href=\"https://www.3gpp.org/ftp/Specs/archive/29_series/29.512/29512-010.zip\" rel=\"nofollow noreferrer\">3gpp.org/ftp/Specs/archive/29_series/29.512/29512-010.zip</a>, etc..."}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 2, "last_activity_date": 1565359855, "creation_date": 1565359855, "answer_id": 57431887, "question_id": 57431604, "link": "https://stackoverflow.com/questions/57431604/download-zip-files-using-url/57431887#57431887", "title": "Download zip files using URL", "body": "<p>http.get can allow to download whatever files. But the link of the question points to a file that is not found. No error is thrown, but the status code is not 200 (ok). The status code of the response has to be checked before proceeding and creating the file got from the response.</p>\n\n<pre><code>func main() {\n    specUrl := \"https://www.3gpp.org/ftp//Specs/archive/29_series/29.512/29.512-f20.zip\"\n    resp, err := http.Get(specUrl)\n    if err != nil {\n        fmt.Printf(\"err: %s\", err)\n    }\n\n\n    defer resp.Body.Close()\n    fmt.Println(\"status\", resp.Status)\n    if resp.StatusCode != 200 {\n        return\n    }\n\n    // Create the file\n    out, err := os.Create(\"test.zip\")\n    if err != nil {\n        fmt.Printf(\"err: %s\", err)\n    }\n    defer out.Close()\n\n    // Write the body to file\n    _, err = io.Copy(out, resp.Body)\n    fmt.Printf(\"err: %s\", err)\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 3163024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/691a1643203dbcb8cd284a1446b438d1?s=128&d=identicon&r=PG&f=1", "display_name": "swamydkv", "link": "https://stackoverflow.com/users/3163024/swamydkv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1209, "favorite_count": 0, "closed_date": 1565724335, "accepted_answer_id": 57431887, "answer_count": 1, "score": 0, "last_activity_date": 1565438125, "creation_date": 1565358838, "last_edit_date": 1565438125, "question_id": 57431604, "link": "https://stackoverflow.com/questions/57431604/download-zip-files-using-url", "closed_reason": "Needs details or clarity", "title": "Download zip files using URL", "body": "<p>Trying to download zip file from the below URL:</p>\n\n<p><a href=\"https://www.3gpp.org/ftp//Specs/archive/29_series/29.512/29.512-f20.zip\" rel=\"nofollow noreferrer\">https://www.3gpp.org/ftp//Specs/archive/29_series/29.512/29.512-f20.zip</a></p>\n\n<p>I tried downloading using <code>http.Get</code> in Go:</p>\n\n<pre><code>resp, err := http.Get(specUrl)\nif err != nil {\n    return err\n}\n</code></pre>\n\n<p>Need help in downloading the zip file.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565354253, "post_id": 57429942, "comment_id": 101338291, "body": "Side note: why are you doing <code>i = a</code> and <code>i = b</code>? Just put <code>a</code> and <code>b</code> directly into the <code>Printf</code> calls."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565354546, "post_id": 57429942, "comment_id": 101338477, "body": "With an individual variables that are byte arrays or slices you can use <code>fmt.Printf</code> with a <code>%s</code> or <code>%q</code> formatting verb to output a string. For a type containing such fields you could implement <code>fmt.Stringer</code> or <code>fmt.Formatter</code> directly on that type (i.e. on <code>FmtA</code> and <code>FmtB</code>). Which (<code>Byte#</code> types or outer type formatting) is easier/nicer may be a matter of opinion; unless you already want/need formatting for the outer type."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565356027, "post_id": 57429942, "comment_id": 101339393, "body": "also side note: it seems like you&#39;re using aliasing (<code>type T = U</code>) arbitrarily here. Unless you&#39;ve intended to use aliasing for some specific reason, do not do that, just define the struct type like any other type, like your byte-array type."}, {"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565356588, "post_id": 57429942, "comment_id": 101339744, "body": "@DaveC because the coming data is variable type, I use interface{} to accept it.  I just want to print out the structure and try to use %+v feature."}, {"owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1565356700, "post_id": 57429942, "comment_id": 101339813, "body": "@mkopriva, I&#39;ve edited, just use (type T U) instead of (type T = U)"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565359544, "post_id": 57431045, "comment_id": 101341584, "body": "Although you can use reflection for this, reflection should be the last resort, it&#39;s slow, complicated, hard to read, easy to get wrong, etc."}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565360147, "post_id": 57431045, "comment_id": 101341973, "body": "@DaveC, I agree reflection can be complex to use but it might be the right tool for this since the question was explicitly asking for a way to avoid defining the &quot;String&quot; for each type, so this function would be generic. Also please note fmt.Print needs to also use reflection to iterate the fields, so probably this will not be slower for this particular case. In any case, just giving a response with a possible option here."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 1, "last_activity_date": 1565357042, "creation_date": 1565357042, "answer_id": 57431045, "question_id": 57429942, "link": "https://stackoverflow.com/questions/57429942/how-to-pretty-print-a-structure-with-byte-array-as-string/57431045#57431045", "title": "How to pretty print a structure with byte array as string?", "body": "<p>You could create a utility function that would take any struct, inspect the fields using reflection and format them accordingly (use the default for fields that are not byte arrays, but force byte arrays to print as strings).</p>\n\n<p>Like for example:</p>\n\n<pre><code>func Struct2String(theStruct interface{}) string {\n    reflectV := reflect.ValueOf(theStruct)\n    structType := reflectV.Type()\n    b := &amp;bytes.Buffer{}\n    b.WriteString(\"{\")\n    for i := 0; i &lt; reflectV.NumField(); i++ {\n        if i &gt; 0 {\n            b.WriteString(\" \")\n        }\n        b.WriteString(structType.Field(i).Name)\n        b.WriteString(\": \")\n        fieldValue := reflectV.Field(i)\n        fieldType := reflectV.Field(i).Type()\n        fieldKind := reflectV.Field(i).Kind()\n        if (fieldKind == reflect.Slice || fieldKind == reflect.Array) &amp;&amp; fieldType.Elem().Kind() == reflect.Uint8 {\n            fmt.Fprintf(b, \"%s\", fieldValue)\n        } else {\n            fmt.Fprint(b, fieldValue)\n        }\n    }\n    b.WriteString(\"}\")\n    return b.String()\n}\n</code></pre>\n\n<p>Here you can see the example running with the structs you have defined in a Go playground:</p>\n\n<p><a href=\"https://play.golang.org/p/zGZM5S8UMWZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zGZM5S8UMWZ</a></p>\n"}], "owner": {"reputation": 11839, "user_id": 730346, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/86187a52f1e2f64890194d0451748ce5?s=128&d=identicon&r=PG", "display_name": "Daniel YC Lin", "link": "https://stackoverflow.com/users/730346/daniel-yc-lin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 355, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1565361548, "creation_date": 1565353197, "last_edit_date": 1565356502, "question_id": 57429942, "link": "https://stackoverflow.com/questions/57429942/how-to-pretty-print-a-structure-with-byte-array-as-string", "title": "How to pretty print a structure with byte array as string?", "body": "<p>I'm trying to decode dynamic structures from network data, here is simplified version. The <code>FmtA</code> is <code>[3]byte</code>, and required to print as string. So, here is my stupid implementation by defining a <code>Bytes3</code> data type. \nIf use this method, I should define <code>Bytes6</code>, <code>Bytes4</code>, <code>Bytes2</code>.</p>\n\n<p>Is there any better method to print all byte arrays as strings instead of byte arrays?</p>\n\n<pre><code>package main                                                                                                                                                           \n\nimport \"fmt\"                                                                    \n\ntype Bytes3 [3]byte                                                             \ntype FmtA struct {                                                            \n        Field1 Bytes3                                                           \n        Field2 [6]byte                                                          \n        Field3 uint8                                                            \n}                                                                               \ntype FmtB struct {                                                            \n        Field1 uint16                                                           \n        Field2 [4]byte                                                          \n        Field3 [2]byte                                                          \n}                                                                               \n\nfunc (b Bytes3) String() string {                                               \n        v := [3]byte(b)                                                         \n        return string(v[:])                                                     \n}                                                                               \nfunc main() {                                                                   \n        a := FmtA{[3]byte{'a', 'b', 'c'}, [6]byte{'d', 'e', 'f', 'g', 'h', 'i'},\n                36}                                                             \n        b := FmtB{42, [4]byte{'a', 'b', 'c', 'd'}, [2]byte{'e', 'f'}}           \n        var i interface{}   // simulate the received variable type                                                     \n        i = a                                                                   \n        fmt.Printf(\"a=%+v\\n\", i)                                                \n        i = b                                                                   \n        fmt.Printf(\"b=%+v\\n\", i)                                                \n        // Output:                                                              \n        // a={Field1:abc Field2:[100 101 102 103 104 105] Field3:36}            \n        // b={Field1:42 Field2:[97 98 99 100] Field3:[101 102]}                 \n}\n</code></pre>\n"}, {"tags": ["go", "zip", "archive", "httpserver"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1565351116, "post_id": 57429256, "comment_id": 101336476, "body": "Use the <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Stream\" rel=\"nofollow noreferrer\">Stream method</a> or the <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Writer\" rel=\"nofollow noreferrer\">ResponseWriter</a> directly."}], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1565390490, "post_id": 57434338, "comment_id": 101353071, "body": "Why writing the zip to a buffer when you can write it to <code>w</code>?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1565439285, "post_id": 57434338, "comment_id": 101360304, "body": "As @MarkusWMahlberg said, you should move the <code>zip.NewWriter</code> call to within the function closure and have it go directly to <code>w</code> without creating or using a <code>bytes.Buffer</code> or calling the final <code>io.Copy</code>. They way you have it there is no point streaming since the compression is fully completed in memory before writing anything to HTTP connection."}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 1, "creation_date": 1565457228, "post_id": 57434338, "comment_id": 101364371, "body": "It makes sense to use the <code>io.writer</code> provided by the stream closure to create the zip archive"}, {"owner": {"reputation": 4523, "user_id": 2998877, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/be042cb19c34a4685d70997d44827b1a?s=128&d=identicon&r=PG&f=1", "display_name": "Spark.Bao", "link": "https://stackoverflow.com/users/2998877/spark-bao"}, "edited": false, "score": 1, "creation_date": 1599443761, "post_id": 57434338, "comment_id": 112767212, "body": "Works fine for me, thank you! By the way, there is a small error in the code, I think we should use <code>filename=\\&quot;filename.zip\\&quot;</code> instead of <code>filename=&#39;filename.zip&#39;</code>."}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 5, "last_activity_date": 1565602390, "last_edit_date": 1565602390, "creation_date": 1565369694, "answer_id": 57434338, "question_id": 57429256, "link": "https://stackoverflow.com/questions/57429256/how-to-generate-zip-7z-archive-on-the-fly-in-a-http-server-using-gin/57434338#57434338", "title": "How to generate zip / 7z archive on the fly in a HTTP server using Gin?", "body": "<p>Using the <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.Stream\" rel=\"noreferrer\">stream method</a> and <a href=\"https://golang.org/pkg/archive/zip/#example_Writer\" rel=\"noreferrer\">archive/zip</a> you can create zip on the fly and stream them to the server. </p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n\n    \"archive/zip\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\nfunc main() {\n\n    r := gin.Default()\n    r.GET(\"/\", func(c *gin.Context) {\n\n        c.Writer.Header().Set(\"Content-type\", \"application/octet-stream\")\n        c.Stream(func(w io.Writer) bool {\n\n            // Create a zip archive.\n            ar := zip.NewWriter(w)\n\n            file1, _ := os.Open(\"filename1\")\n            file2, _ := os.Open(\"filename2\")\n            c.Writer.Header().Set(\"Content-Disposition\", \"attachment; filename='filename.zip'\")\n\n            f1, _ := ar.Create(\"filename1\")\n            io.Copy(f1, file1)\n            f2, _ := ar.Create(\"filename2\")\n            io.Copy(f2, file2)\n\n            ar.Close()\n\n            return false\n        })\n    })\n    r.Run()\n}\n</code></pre>\n\n<p>By using directly ResponseWriter</p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"os\"\n\n    \"archive/zip\"\n\n    \"github.com/gin-gonic/gin\"\n)\n\n\nfunc main() {\n\n    r := gin.Default()\n    r.GET(\"/\", func(c *gin.Context) {\n        c.Writer.Header().Set(\"Content-type\", \"application/octet-stream\")\n        c.Writer.Header().Set(\"Content-Disposition\", \"attachment; filename='filename.zip'\")\n        ar :=  zip.NewWriter(c.Writer)\n        file1, _ := os.Open(\"filename1\")\n        file2, _ := os.Open(\"filename2\")\n        f1, _ := ar.Create(\"filename1\")\n        io.Copy(f1, file1)\n        f2, _ := ar.Create(\"filename1\")\n        io.Copy(f1, file2)\n        ar.Close()\n    })\n    r.Run()\n}\n</code></pre>\n"}], "owner": {"reputation": 15070, "user_id": 388427, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/a43a07bc90818154ff9c8d4af7c23502?s=128&d=identicon&r=PG", "display_name": "Sergey", "link": "https://stackoverflow.com/users/388427/sergey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 858, "favorite_count": 3, "accepted_answer_id": 57434338, "answer_count": 1, "score": 3, "last_activity_date": 1565602390, "creation_date": 1565350643, "last_edit_date": 1565439003, "question_id": 57429256, "link": "https://stackoverflow.com/questions/57429256/how-to-generate-zip-7z-archive-on-the-fly-in-a-http-server-using-gin", "title": "How to generate zip / 7z archive on the fly in a HTTP server using Gin?", "body": "<p>I use <a href=\"https://github.com/gin-gonic/gin\" rel=\"nofollow noreferrer\">Gin</a> to create a HTTP server and I want to give a dynamically generated zip archive to the user.</p>\n\n<p>Theoretically I could first generate a zip file on a file system and then serve it. But that is really a bad way (to wait 5 mins before starting download). I want start giving it to a user immediately and push content as it is generated.</p>\n\n<p>I've found DataFromReader (<a href=\"https://gin-gonic.com/docs/examples/serving-data-from-reader/\" rel=\"nofollow noreferrer\">example</a>) but ContentLength is not known until archive is done.</p>\n\n<pre><code>func DownloadEndpoint(c *gin.Context) {\n    ...\n    c.DataFromReader(\n        http.StatusOK,\n        ContentLength,\n        ContentType,\n        Body,\n        map[string]string{\n            \"Content-Disposition\": \"attachment; filename=\\\"archive.zip\\\"\"),\n        },\n    )\n}\n</code></pre>\n\n<p>How can I do that?</p>\n"}]