[{"tags": ["xml", "go", "xml-parsing"], "answers": [{"comments": [{"owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "edited": false, "score": 0, "creation_date": 1551309783, "post_id": 54915740, "comment_id": 96598308, "body": "Thanks a lot, your explanation is very clear, I&#39;m taking my first steps with the language and find this to be a nice data-wrangling exercise."}], "tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": true, "score": 7, "last_activity_date": 1551307652, "creation_date": 1551307652, "answer_id": 54915740, "question_id": 54915307, "link": "https://stackoverflow.com/questions/54915307/error-unmarshaling-a-simple-xml-in-golang/54915740#54915740", "title": "Error unmarshaling a simple xml in Golang", "body": "<p>You have a specific line in your code that returns an error</p>\n\n<pre><code>xml.Unmarshal(byteValue, &amp;articles)\n</code></pre>\n\n<p>If you change that to</p>\n\n<pre><code>err = xml.Unmarshal(byteValue, &amp;articles)\nif err != nil {\n    fmt.Println(err.Error())\n}\n</code></pre>\n\n<p>You'll see an error being reported: <code>xml: encoding \"ISO-8859-1\" declared but Decoder.CharsetReader is nil</code>. As a best practice, you should always check for errors being returned.</p>\n\n<p>To fix that, you can either remove the encoding attribute (<code>encoding=\"ISO-8859-1\"</code>) from the XML or change the code of your unmarshalling a bit:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n\n    \"golang.org/x/text/encoding/charmap\"\n)\n\n// Contains the array of articles in the dblp xml\ntype Dblp struct {\n    XMLName xml.Name  `xml:\"dblp\"`\n    Dblp    []Article `xml:\"article\"`\n}\n\n// Contains the article element tags and attributes\ntype Article struct {\n    XMLName xml.Name `xml:\"article\"`\n    Key     string   `xml:\"key,attr\"`\n    Year    string   `xml:\"year\"`\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"dblp.xml\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Successfully Opened TestDblp.xml\")\n    // defer the closing of our xmlFile so that we can parse it later on\n    defer xmlFile.Close()\n\n    var articles Dblp\n    decoder := xml.NewDecoder(xmlFile)\n    decoder.CharsetReader = makeCharsetReader\n    err = decoder.Decode(&amp;articles)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    for i := 0; i &lt; len(articles.Dblp); i++ {\n        fmt.Println(\"Entered loop\")\n        fmt.Println(\"get title: \" + articles.Dblp[i].Key)\n        fmt.Println(\"get year: \" + articles.Dblp[i].Year)\n    }\n}\n\nfunc makeCharsetReader(charset string, input io.Reader) (io.Reader, error) {\n    if charset == \"ISO-8859-1\" {\n        // Windows-1252 is a superset of ISO-8859-1, so should do here\n        return charmap.Windows1252.NewDecoder().Reader(input), nil\n    }\n    return nil, fmt.Errorf(\"Unknown charset: %s\", charset)\n}\n</code></pre>\n\n<p>running the above program results in:</p>\n\n<pre><code>Successfully Opened TestDblp.xml\nEntered var\nEntered loop\nget title: journals/cacm/Gentry10\nget year: 2010\nEntered loop\nget title: journals/cacm/Gentry10\nget year: 2010\n</code></pre>\n"}], "owner": {"reputation": 199, "user_id": 1161712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/327027b3c0936d1ab3bd104a27e0f6db?s=128&d=identicon&r=PG", "display_name": "orestisf", "link": "https://stackoverflow.com/users/1161712/orestisf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 931, "favorite_count": 2, "accepted_answer_id": 54915740, "answer_count": 1, "score": 1, "last_activity_date": 1551307652, "creation_date": 1551305481, "question_id": 54915307, "link": "https://stackoverflow.com/questions/54915307/error-unmarshaling-a-simple-xml-in-golang", "title": "Error unmarshaling a simple xml in Golang", "body": "<p>I'm trying to write a very simple parser in Go for a large xml file (the <a href=\"https://dblp.uni-trier.de/\" rel=\"nofollow noreferrer\">dblp.xml</a>), an excerpt of which is below:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"ISO-8859-1\"?&gt;\n&lt;!DOCTYPE dblp SYSTEM \"dblp.dtd\"&gt;\n&lt;dblp&gt;\n    &lt;article key=\"journals/cacm/Gentry10\" mdate=\"2010-04-26\"&gt;\n        &lt;author&gt;Craig Gentry&lt;/author&gt;\n        &lt;title&gt;Computing arbitrary functions of encrypted data.&lt;/title&gt;\n        &lt;pages&gt;97-105&lt;/pages&gt;\n        &lt;year&gt;2010&lt;/year&gt;\n        &lt;volume&gt;53&lt;/volume&gt;\n        &lt;journal&gt;Commun. ACM&lt;/journal&gt;\n        &lt;number&gt;3&lt;/number&gt;\n        &lt;ee&gt;http://doi.acm.org/10.1145/1666420.1666444&lt;/ee&gt;\n        &lt;url&gt;db/journals/cacm/cacm53.html#Gentry10&lt;/url&gt;\n    &lt;/article&gt;\n\n    &lt;article key=\"journals/cacm/Gentry10\" mdate=\"2010-04-26\"&gt;\n        &lt;author&gt;Craig Gentry Number2&lt;/author&gt;\n        &lt;title&gt;Computing arbitrary functions of encrypted data.&lt;/title&gt;\n        &lt;pages&gt;97-105&lt;/pages&gt;\n        &lt;year&gt;2010&lt;/year&gt;\n        &lt;volume&gt;53&lt;/volume&gt;\n        &lt;journal&gt;Commun. ACM&lt;/journal&gt;\n        &lt;number&gt;3&lt;/number&gt;\n        &lt;ee&gt;http://doi.acm.org/10.1145/1666420.1666444&lt;/ee&gt;\n        &lt;url&gt;db/journals/cacm/cacm53.html#Gentry10&lt;/url&gt;\n    &lt;/article&gt;\n&lt;/dblp&gt;\n</code></pre>\n\n<p>My code is as follows and it looks like there's something going on at <code>xml.Unmarshal(byteValue, &amp;articles)</code>, as I cannot get any of the xml's values in the output. Can you help me with what is wrong with my code?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\n// Contains the array of articles in the dblp xml\ntype Dblp struct {\n    XMLName xml.Name  `xml:\"dblp\"`\n    Dblp    []Article `xml:\"article\"`\n}\n\n// Contains the article element tags and attributes\ntype Article struct {\n    XMLName xml.Name `xml:\"article\"`\n    Key     string   `xml:\"key,attr\"`\n    Year    string   `xml:\"year\"`\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"TestDblp.xml\")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"Successfully Opened TestDblp.xml\")\n    // defer the closing of our xmlFile so that we can parse it later on\n    defer xmlFile.Close()\n\n    // read our opened xmlFile as a byte array.\n    byteValue, _ := ioutil.ReadAll(xmlFile)\n\n    var articles Dblp\n    fmt.Println(\"Entered var\")\n    // we unmarshal our byteArray which contains our\n    // xmlFiles content into 'users' which we defined above\n    xml.Unmarshal(byteValue, &amp;articles)\n\n    for i := 0; i &lt; len(articles.Dblp); i++ {\n        fmt.Println(\"Entered loop\")\n        fmt.Println(\"get title: \" + articles.Dblp[i].Key)\n        fmt.Println(\"get year: \" + articles.Dblp[i].Year)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["go", "interface", "switch-statement", "slice"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1551292912, "post_id": 54911849, "comment_id": 96591348, "body": "This is a very common question and at the moment I can&#39;t find the definitive answer, but in short, <code>[]someType</code> cannot be used where <code>[]someInterface</code> is expected, even if <code>someType</code> implements <code>someInterface</code>. For this reason, <code>[]int</code> does not match <code>[]interface{}</code> in your <code>switch</code> statement."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551293210, "post_id": 54911849, "comment_id": 96591494, "body": "<a href=\"https://stackoverflow.com/a/12994852/965900\">stackoverflow.com/a/12994852/965900</a>"}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 0, "last_activity_date": 1551293832, "creation_date": 1551293832, "answer_id": 54912633, "question_id": 54911849, "link": "https://stackoverflow.com/questions/54911849/golang-switch-case-on-slice-interfaces/54912633#54912633", "title": "Golang Switch Case on Slice Interfaces", "body": "<blockquote>\n  <p>Is there any way to get testVar5 to hit the []interface{} case?</p>\n</blockquote>\n\n<p>No. See e.g. <a href=\"https://golang.org/doc/faq#convert_slice_of_interface\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#convert_slice_of_interface</a></p>\n"}, {"tags": [], "owner": {"reputation": 86, "user_id": 9093211, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-N4edBLXflDg/AAAAAAAAAAI/AAAAAAAAABo/dEWBDn1w4rk/photo.jpg?sz=128", "display_name": "Thomas Milox", "link": "https://stackoverflow.com/users/9093211/thomas-milox"}, "is_accepted": false, "score": 1, "last_activity_date": 1551294595, "creation_date": 1551294595, "answer_id": 54912818, "question_id": 54911849, "link": "https://stackoverflow.com/questions/54911849/golang-switch-case-on-slice-interfaces/54912818#54912818", "title": "Golang Switch Case on Slice Interfaces", "body": "<p>you can use the <code>reflect</code> package like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n    \"reflect\"\n)\n\ntype Test struct {\n    t      interface{}\n}\n\nfunc main() {\n    testVar1 := big.NewInt(0)\n    testVar2 := int64(1)\n    testVar3 := []byte(\"test\")\n    testVar4 := true\n    testVar5 := []int{1, 2, 3, 4}\n    var testVar6 Test\n\n    Issue(testVar1)\n    Issue(testVar2)\n    Issue(testVar3)\n    Issue(testVar4)\n    Issue(testVar5)\n    Issue(testVar6)\n}\n\nfunc Issue(t interface{}) {\n    switch t.(type) {\n    case *big.Int:\n        fmt.Println(\"*big.Int\")\n    case int8, int16, int32, int64:\n        fmt.Println(\"int8, int16, int32, int64\")\n    case []byte:\n        fmt.Println(\"[]byte\")\n    case bool:\n        fmt.Println(\"bool\")\n    case interface{}:\n        rt := reflect.TypeOf(t)\n        switch rt.Kind() {\n        case reflect.Slice:\n            fmt.Println(\"Slice\")\n        case reflect.Array:\n            fmt.Println(\"Array\")\n        default:\n            fmt.Println(\"interface{}\")\n        }\n    default:\n        fmt.Println(\"unsupported type\")\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 8610613, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c714e1561c22f9b7f87c6d1982e9b9e6?s=128&d=identicon&r=PG&f=1", "display_name": "dutterbutter", "link": "https://stackoverflow.com/users/8610613/dutterbutter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 0, "accepted_answer_id": 54912633, "answer_count": 2, "score": -1, "last_activity_date": 1551294595, "creation_date": 1551290711, "question_id": 54911849, "link": "https://stackoverflow.com/questions/54911849/golang-switch-case-on-slice-interfaces", "title": "Golang Switch Case on Slice Interfaces", "body": "<p><strong>Is it possible to differentiate between <code>[]interface{}</code> and <code>interface{}</code> in a switch case?</strong></p>\n\n<p>Trying to create a decoding function in which you can pass in different types and then a switch case determines the type and then proceed to decode that particular type. Although I am having issues when the type passed is a <code>[]interface{}</code>. </p>\n\n<p>I have been experimenting with the <code>reflect</code> package but no luck thus far.\nSee code snippet and playground link below.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\ntype Test struct {\n    t      interface{}\n}\n\nfunc main() {\n    testVar1 := big.NewInt(0)\n    testVar2 := int64(1)\n    testVar3 := []byte(\"test\")\n    testVar4 := true\n    testVar5 := []int{1, 2, 3, 4}\n    var testVar6 Test\n\n    Issue(testVar1)\n    Issue(testVar2)\n    Issue(testVar3)\n    Issue(testVar4)\n    Issue(testVar5)\n    Issue(testVar6)\n}\n\nfunc Issue(t interface{}) {\n    switch t.(type) {\n    case *big.Int:\n        fmt.Println(\"*big.Int\")\n    case int8, int16, int32, int64:\n        fmt.Println(\"int8, int16, int32, int64\")\n    case []byte:\n        fmt.Println(\"[]byte\")\n    case bool:\n        fmt.Println(\"bool\")\n    case []interface{}:\n        fmt.Println(\"how to get testVar5 to print here\")\n        fmt.Println(\"[]interface{}\")\n    case interface{}:\n        fmt.Println(\"interface{}\")\n    default:\n        fmt.Println(\"unsupported type\")\n    }\n}\n</code></pre>\n\n<p>Results:</p>\n\n<pre><code>*big.Int\nint8, int16, int32, int64\n[]byte\nbool\ninterface{}\ninterface{}\n</code></pre>\n\n<p><strong>Is there any way to get <code>testVar5</code> to hit the <code>[]interface{}</code> case?</strong></p>\n\n<p><a href=\"https://play.golang.org/p/U0dJF9CEbTX\" rel=\"nofollow noreferrer\">https://play.golang.org/p/U0dJF9CEbTX</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1551290169, "post_id": 54911562, "comment_id": 96590038, "body": "The signature should be <code>func(w *glfw.Window, width int, height int)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 420, "user_id": 5747844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c47f253367f6ff02da1fe8f521a77057?s=128&d=identicon&r=PG&f=1", "display_name": "nissefors", "link": "https://stackoverflow.com/users/5747844/nissefors"}, "is_accepted": true, "score": 3, "last_activity_date": 1551290195, "creation_date": 1551290195, "answer_id": 54911703, "question_id": 54911562, "link": "https://stackoverflow.com/questions/54911562/how-to-use-callback-function-from-a-golang-library/54911703#54911703", "title": "How to use callback function from a golang library?", "body": "<p><a href=\"https://github.com/go-gl/glfw/blob/2484f3e51bc432ea9f7daa182e418d5522201176/v3.2/glfw/window.go\" rel=\"nofollow noreferrer\">https://github.com/go-gl/glfw/blob/2484f3e51bc432ea9f7daa182e418d5522201176/v3.2/glfw/window.go</a></p>\n\n<pre><code>type FramebufferSizeCallback func(w *Window, width int, height int)\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>func fbCallback(window *glfw.Window, width int32, height int32)\n</code></pre>\n\n<p>Your function doesn't have the same signature, it is using int32 instead of int.</p>\n"}], "owner": {"reputation": 475, "user_id": 6157177, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/e5d2dc0489b99395aa3ceb0cf794df7b?s=128&d=identicon&r=PG&f=1", "display_name": "John", "link": "https://stackoverflow.com/users/6157177/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 675, "favorite_count": 0, "accepted_answer_id": 54911703, "answer_count": 1, "score": 2, "last_activity_date": 1551290195, "creation_date": 1551289704, "question_id": 54911562, "link": "https://stackoverflow.com/questions/54911562/how-to-use-callback-function-from-a-golang-library", "title": "How to use callback function from a golang library?", "body": "<p>I'm still relatively new to Go and I've decided to try some OpenGL since there exists a Go library which provides bindings for this. As part of setting up OpenGL I need to use the Go <a href=\"https://github.com/go-gl/glfw\" rel=\"nofollow noreferrer\">glfw library</a>. I need to use the glfw library function <a href=\"https://godoc.org/github.com/go-gl/glfw/v3.2/glfw#Window.SetFramebufferSizeCallback\" rel=\"nofollow noreferrer\">SetFramebufferSizeCallback</a> which requires an argument of type <a href=\"https://godoc.org/github.com/go-gl/glfw/v3.2/glfw#FramebufferSizeCallback\" rel=\"nofollow noreferrer\">FrameBuffersizeCallback</a>; so I essentially need to pass a function that matches that type's signature which I believe I have done. However, I keep getting the following error:</p>\n\n<blockquote>\n  <p>./main.go:43:35: cannot use fbCallback (type func(*glfw.Window, int32, int32)) as type glfw.FramebufferSizeCallback in argument to window.SetFramebufferSizeCallback</p>\n</blockquote>\n\n<p>And I'm really not sure why this is happening. I've checked that my glfw version matches the documentation; I've checked the code for the implementation on github and my machine and it is all consistent. So I have no clue what I'm doing wrong. Here is my code, it shouldn't do anything interesting if built, but demonstrates the error:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/go-gl/gl/v3.3-core/gl\"\n    \"github.com/go-gl/glfw/v3.2/glfw\"\n    \"log\"\n    \"runtime\"\n)\n\nfunc fbCallback(window *glfw.Window, width int32, height int32) {\n    gl.Viewport(0, 0, width, height)\n}\n\nfunc init() {\n    runtime.LockOSThread()\n}\n\nfunc main() {\n    err := glfw.Init()\n    if err != nil {\n        panic(err)\n    }\n\n    defer glfw.Terminate()\n\n    glfw.WindowHint(glfw.ContextVersionMajor, 3)\n    glfw.WindowHint(glfw.ContextVersionMinor, 3)\n    glfw.WindowHint(glfw.OpenGLProfile, glfw.OpenGLCoreProfile)\n\n    window, err := glfw.CreateWindow(640, 480, \"Testing\", nil, nil)\n\n    if err != nil {\n        panic(err)\n    }\n\n    window.MakeContextCurrent()\n\n    if err := gl.Init(); err != nil {\n        log.Fatalln(err)\n    }\n\n    gl.Viewport(0, 0, 800, 600)\n    window.SetFramebufferSizeCallback(fbCallback) //Does not work\n}\n</code></pre>\n\n<p>My understanding of how this should really work is demonstrated in the following short program which works. I'd be happy for someone to point out why this short example works and the above does not. I may have some holes in my understanding.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype callback func(int, int) int\n\nfunc sum(x int, y int) int {\n    return x + y\n}\n\nfunc useCallback(cb callback) {\n    result := cb(2, 3)\n    fmt.Println(result)\n}\n\nfunc main() {\n    useCallback(sum)\n}\n</code></pre>\n"}, {"tags": ["apache", "go", "https", "webserver", "reverse-proxy"], "comments": [{"owner": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 1, "creation_date": 1551304365, "post_id": 54910531, "comment_id": 96596462, "body": "Not quite enough information to know for sure, but I&#39;m betting your reverse proxy is maintaining a persistent connection to the apache2 server, preventing <code>tcp</code> and <code>ssl</code> handshake overhead with each request."}, {"owner": {"reputation": 23, "user_id": 3397505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EFK6S.png?s=128&g=1", "display_name": "Vhelium", "link": "https://stackoverflow.com/users/3397505/vhelium"}, "reply_to_user": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551337626, "post_id": 54910531, "comment_id": 96605566, "body": "Good idea. But wouldn&#39;t the reverse proxy have the same issue (as it handles the same requests as the webserver would)?  It&#39;s hard to believe for me that golang&#39;s implementation is more efficient than apache. Any suggestions where/how I could gather more info? Thanks!"}, {"owner": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551360184, "post_id": 54910531, "comment_id": 96617989, "body": "My comment is assuming the go proxy is running on localhost, and that apache2 is some remote server. If that is true, then the first request after starting the proxy may be the same speed, but subsequent requests would utilize the proxy&#39;s persisted connection, and avoid some overhead. The connection overhead from the browser to the proxy is negligible, if it&#39;s running on localhost, as I&#39;ve presumed."}, {"owner": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551360866, "post_id": 54910531, "comment_id": 96618379, "body": "I just noticed that the request sizes are significantly smaller on the apache requests. Apache is likely doing gzip compression of your resources by default, and that could also add to overhead. Check the <code>http</code> headers between the proxy and apache, and see what the contents of <code>accept-encoding</code> header are."}, {"owner": {"reputation": 23, "user_id": 3397505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EFK6S.png?s=128&g=1", "display_name": "Vhelium", "link": "https://stackoverflow.com/users/3397505/vhelium"}, "reply_to_user": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551439217, "post_id": 54910531, "comment_id": 96649783, "body": "Thanks the idea, I looked into the encoding and it is consistent over both cases (see updated answer). The webservice that acts as the reverse proxy sits on the server itself. I added an image to elaborate."}, {"owner": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551447392, "post_id": 54910531, "comment_id": 96654344, "body": "The diagram is very helpful. My initial assumptions were wrong. My best guess at this point is that the proxy is doing a better job allowing the browser to do pipelining. You&#39;re doing a <i>lot</i> of <code>GET</code> requests, and if apache is requiring a new <code>TCP</code> connection for each, and the proxy is not, that would explain the overhead."}, {"owner": {"reputation": 23, "user_id": 3397505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EFK6S.png?s=128&g=1", "display_name": "Vhelium", "link": "https://stackoverflow.com/users/3397505/vhelium"}, "reply_to_user": {"reputation": 2267, "user_id": 2639647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fc746964582ffff4760c1e7493c13189?s=128&d=identicon&r=PG", "display_name": "Travis Hegner", "link": "https://stackoverflow.com/users/2639647/travis-hegner"}, "edited": false, "score": 0, "creation_date": 1551463221, "post_id": 54910531, "comment_id": 96662774, "body": "I did more testing and I come to think, as you said, the webservice written in go handles this case more efficient than apache (in it&#39;s default configuration). Most likely it won&#39;t scale as well but I&#39;m only testing on few clients so I can&#39;t judge that. Thanks for the help on this!"}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 3397505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EFK6S.png?s=128&g=1", "display_name": "Vhelium", "link": "https://stackoverflow.com/users/3397505/vhelium"}, "edited": false, "score": 0, "creation_date": 1551439334, "post_id": 54937507, "comment_id": 96649846, "body": "Thanks for the answer - The proxy isn&#39;t doing any caching itself, only forwarding (see code snipped). While ssl might be a bottleneck it should be consistent over both cases right? Since I connect to apache and to the webservice using https in both cases."}], "tags": [], "owner": {"reputation": 43, "user_id": 7855432, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f20a28c577089a4ef9e9010ff8e17b4?s=128&d=identicon&r=PG&f=1", "display_name": "\u6797\u5c11\u5cf0", "link": "https://stackoverflow.com/users/7855432/%e6%9e%97%e5%b0%91%e5%b3%b0"}, "is_accepted": false, "score": 0, "last_activity_date": 1551410982, "creation_date": 1551410982, "answer_id": 54937507, "question_id": 54910531, "link": "https://stackoverflow.com/questions/54910531/https-request-served-by-apache2-slower-than-via-reverse-proxy/54937507#54937507", "title": "HTTPS request served by Apache2 slower than via Reverse Proxy", "body": "<p>As far as i can see. There are two possible reasons. </p>\n\n<ol>\n<li>The apache reverse proxy handled some cache contain static file like images, css or javascript.</li>\n<li>When you browse a https url. A process named \"ssl certificate uninstall\" will happen, and it can cause huge server load. So if the web application and the ssl certificate are deployed on the same server, the load may cause high-latency. Generally, we use a special device named load-balancer to uninstall ssl certificate, Just like a reverse proxy.</li>\n</ol>\n"}], "owner": {"reputation": 23, "user_id": 3397505, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EFK6S.png?s=128&g=1", "display_name": "Vhelium", "link": "https://stackoverflow.com/users/3397505/vhelium"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 424, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551463319, "creation_date": 1551286099, "last_edit_date": 1551463319, "question_id": 54910531, "link": "https://stackoverflow.com/questions/54910531/https-request-served-by-apache2-slower-than-via-reverse-proxy", "title": "HTTPS request served by Apache2 slower than via Reverse Proxy", "body": "<p><strong>My situation:</strong><br>\nA website is hosted using a default apache2 installation on an ubuntu server.\nServed on port 443 using HTTPS and a self-signed certificate (for developping).</p>\n\n<p>Now I have a simple service written in golang that listens at port 8080 and acts as a Reverse Proxy to take https requests, forward them to apache locally and return the response back to the client. This webservice doesn't cache any files and only forwards requests.<br>\nCode: <a href=\"https://play.golang.org/p/tnfKVWyLuZQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tnfKVWyLuZQ</a></p>\n\n<p><strong>My \"problem\":</strong><br>\nCalling apache directly, i.e. <code>https://foo.com/bar/</code> is remarkably slower (200-400ms) than calling the website through my reverse proxy, i.e. <code>https://foo.com:8080/bar/</code></p>\n\n<p>Why is it slower to call apache2 directly? I expected to have overhead using a reverse proxy, not a speedup. -> Comparison for example page: <a href=\"https://i.imgur.com/TqznM2v.png\" rel=\"nofollow noreferrer\">https://i.imgur.com/TqznM2v.png</a></p>\n\n<hr>\n\n<p><strong>UPDATE</strong>: Sketch to show the current setup:\n<a href=\"https://i.stack.imgur.com/yto4h.png\" rel=\"nofollow noreferrer\">Current Setup</a></p>\n\n<p><strong>Regarding the encoding</strong>: The Encoding is consistent in both situations: Encoding header and Content-Length is in both cases (Situation 1 vs 2) the same, the client also receives the file size. Not sure why in the HAR Viewer it only displays the uncompressed size in the second case. If checking in Chrome I can see the compressed size in both case.</p>\n\n<p><strong>Update #2</strong>: I came to the conclusion that the golang implementation handles multiple requests from the same client in a short time more efficiently than apache2 in it's default configuration. Sicne I only test with few clients I can't say how well it scales - I imagine the webservice will fall behind when under load.<br>\nI see this as closed, thanks all for the help.</p>\n"}, {"tags": ["go", "youtube"], "owner": {"reputation": 31, "user_id": 8306538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b0d6b4a3ee59fd3167f8f9fde292aa7?s=128&d=identicon&r=PG&f=1", "display_name": "Jonathan Cremer", "link": "https://stackoverflow.com/users/8306538/jonathan-cremer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1551283566, "creation_date": 1551283566, "question_id": 54909694, "link": "https://stackoverflow.com/questions/54909694/add-end-cards-to-a-youtube-video-using-the-youtube-data-api-v3", "title": "Add (end-)cards to a Youtube video using the Youtube Data API V3", "body": "<p>is it currently possible to add cards and endcards to a youtube video using the Youtube Data API V3?</p>\n\n<p>I know it wasn't able to add the oldschool annotations to a video using an API, a developer answered that there won't be any option to do so and those are deprecated now anyways.</p>\n\n<p>There are the invideoPromotion(also deprecated according to the API documentation) features present in the API, but due to the lack of information I am not entirely sure what I can achieve with that.\n(<a href=\"https://developers.google.com/youtube/v3/docs/channels#resource\" rel=\"nofollow noreferrer\">https://developers.google.com/youtube/v3/docs/channels#resource</a>)</p>\n\n<p>Do I have to update a channel just so I can add some annotations to one single video?</p>\n\n<p>Is it even possible to add proper annotations to a video or can i only add the watermark?</p>\n\n<p>I've searched for hours on end, without finding a definitive answer or an example of how I am supposed to add annotations to a video.</p>\n\n<p>I use a Go-server to upload Videos and thumbnails for my clients and would love a feature where they don't have to insert the annotations by hand after the video is uploaded.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551279587, "post_id": 54907364, "comment_id": 96583638, "body": "<code>http.NewRequest</code> is for issuing requests using <code>http.Client</code>. For direct tests like this you should use <a href=\"https://golang.org/pkg/net/http/httptest/#NewRequest\" rel=\"nofollow noreferrer\"><code>httptest.NewRequest</code></a> instead as it is built for this purpose."}, {"owner": {"reputation": 91, "user_id": 10358755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51159558241ef0a8369e1b4973adce4f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Rod", "link": "https://stackoverflow.com/users/10358755/jose-rod"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551281767, "post_id": 54907364, "comment_id": 96584997, "body": "thanks for pointing this out, I made the adjustment to my answer. What does this change entail for testing though if I may ask?"}], "tags": [], "owner": {"reputation": 91, "user_id": 10358755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51159558241ef0a8369e1b4973adce4f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Rod", "link": "https://stackoverflow.com/users/10358755/jose-rod"}, "is_accepted": true, "score": 1, "last_activity_date": 1551281665, "last_edit_date": 1551281665, "creation_date": 1551276642, "answer_id": 54907364, "question_id": 54906849, "link": "https://stackoverflow.com/questions/54906849/testing-an-error-returned-via-json-http-responce-in-go/54907364#54907364", "title": "Testing an error returned via json http responce in Go", "body": "<blockquote>\n  <p>My problem is now testing this as I'm out of my depth, as this is my\n  first Go program.</p>\n</blockquote>\n\n<p>So you want to do some end-to-end testing. In your test files you could do something like this.</p>\n\n<pre><code>req := httptest.NewRequest(\"POST\", \"my/v1/endpoint\", bytes.NewBuffer(payload))\nresponseRecorder = httptest.NewRecorder()\nrouter.ServeHTTP(responseRecorder, request)\n</code></pre>\n\n<p>Take a look at <a href=\"https://golang.org/pkg/net/http/httptest/#NewRequest\" rel=\"nofollow noreferrer\">httptest.NewRequest</a> and <a href=\"https://golang.org/pkg/net/http/httptest/#ResponseRecorder\" rel=\"nofollow noreferrer\">httptest.ResponseRecorder</a>.</p>\n\n<p>Essentially you need to set up your router, personally I use mux and make requests to it just as you would if you were a real consumer of your API.\nYour responseRecorder after the request will have fields like Code for reading the response code and things like Body for reading the response body among other fields.</p>\n\n<p>e.g.</p>\n\n<pre><code>if responseRecorder.Code != 200{\n    t.FailNow()\n}\n</code></pre>\n"}], "owner": {"reputation": 65, "user_id": 8705862, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155804846443824/picture?type=large", "display_name": "Adam Robinson", "link": "https://stackoverflow.com/users/8705862/adam-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 251, "favorite_count": 0, "accepted_answer_id": 54907364, "answer_count": 1, "score": -1, "last_activity_date": 1551281665, "creation_date": 1551274924, "last_edit_date": 1551275675, "question_id": 54906849, "link": "https://stackoverflow.com/questions/54906849/testing-an-error-returned-via-json-http-responce-in-go", "title": "Testing an error returned via json http responce in Go", "body": "<p>I'm currently working on an image handler in Go which is intended to reject the upload of unsupported files. My intentions are for the Go program to return an error back via the servers http.ResponceWritter detailing which case for rejection has been met, as json, for the upload service to use. </p>\n\n<p>How errors are set up in the server code:</p>\n\n<pre><code>type Error struct {\n    ImgHandlerError `json:\"error\"`\n}\n\ntype ImgHandlerError struct {\n    Message string `json:\"message\"`\n    Code    string `json:\"code\"`\n}\n\nfunc MakeError(message, code string) *Error {\n    errorMessage := &amp;Error{\n        ImgHandlerError: ImgHandlerError{\n            Message: message,\n            Code:    code,\n        },\n    }\n    return errorMessage\n}\n\nfunc ThrowErr(errorMessage Error, writer http.ResponseWriter) {\n\n    jData, err := json.Marshal(errorMessage)\n       if err != nil  {\n    }\n\n    writer.Header().Set(\"Content-Type\", \"application/json\")\n    writer.WriteHeader(http.StatusForbidden)\n    writer.Write(jData)\n\n    return\n\n}\n</code></pre>\n\n<p>How an error is generated and written as a HTTP response:</p>\n\n<pre><code>errorMes := *MakeError(\"PSD files are not supported\", \"DEF-IMG-0006\")\nThrowErr(errorMes, res)\n</code></pre>\n\n<p>Currently this works as expected, for example when a .psd is uploaded the current HTTP response comes back as JSON.</p>\n\n<p><code>{\"error\":{\"message\":\"PSD files are not supported\",\"code\":\"DEF-IMG-0006\"}}</code></p>\n\n<p>My problem is now testing this as I'm out of my depth, as this is my first Go program. I'm using the Ginko test suite. I've tried setting up the <code>http.ResponseRecorder</code> (as I think thats where the solution lies) in the test suite but I'm having no luck. Also of my current tests in the test suite only test functions which don't require the <code>writer http.ResponseWriter</code> as a param so I'm not sure if I need to start a server in the test suite to have a response writer to read from.</p>\n\n<p>Any help is greatly appreciated </p>\n"}, {"tags": ["ssl", "go", "rabbitmq"], "comments": [{"owner": {"reputation": 6400, "user_id": 1466825, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6b420d86764ffe237a2fdc52e28b73f4?s=128&d=identicon&r=PG", "display_name": "Luke Bakken", "link": "https://stackoverflow.com/users/1466825/luke-bakken"}, "edited": false, "score": 0, "creation_date": 1551285546, "post_id": 54905227, "comment_id": 96587558, "body": "Start here: <a href=\"https://www.rabbitmq.com/troubleshooting-ssl.html\" rel=\"nofollow noreferrer\">rabbitmq.com/troubleshooting-ssl.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 49, "user_id": 5265083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46416c5ab75baf98974c972faae63381?s=128&d=identicon&r=PG&f=1", "display_name": "mongoose", "link": "https://stackoverflow.com/users/5265083/mongoose"}, "is_accepted": false, "score": 2, "last_activity_date": 1551629919, "creation_date": 1551629919, "answer_id": 54970923, "question_id": 54905227, "link": "https://stackoverflow.com/questions/54905227/rabbitmq-tls-connection-golang/54970923#54970923", "title": "RabbitMQ - Tls Connection - Golang", "body": "<p>I solved this issue by adding to the hosts file full_machine_name from the connection string to RabbitMQ with appropriate IP address: amqps://connection_string_to_RabbitMQ@full_machine_name:5671</p>\n"}], "owner": {"reputation": 49, "user_id": 5265083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46416c5ab75baf98974c972faae63381?s=128&d=identicon&r=PG&f=1", "display_name": "mongoose", "link": "https://stackoverflow.com/users/5265083/mongoose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551629919, "creation_date": 1551269568, "question_id": 54905227, "link": "https://stackoverflow.com/questions/54905227/rabbitmq-tls-connection-golang", "title": "RabbitMQ - Tls Connection - Golang", "body": "<p>I configured RabbitMQ connection using follow link:\n<a href=\"https://github.com/streadway/amqp/blob/master/examples_test.go\" rel=\"nofollow noreferrer\">https://github.com/streadway/amqp/blob/master/examples_test.go</a></p>\n\n<p>Certificate I created according to the instructions here:\n<a href=\"https://www.rabbitmq.com/ssl.html#enabling-tls-paths\" rel=\"nofollow noreferrer\">https://www.rabbitmq.com/ssl.html#enabling-tls-paths</a></p>\n\n<p>I use RabbitMQ 3.7.0 installed in docker.\nAfter the call amqp.DialTLS I receive \"Bad certificate\" error on the server side (in the docker logs).</p>\n\n<p>I suppose that the problem is that certificate should contain the server name and if so, which server name should I set in the certificate if RabbitMQ is installed inside docker?</p>\n\n<p>Besides, any other ideas?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551285165, "post_id": 54905147, "comment_id": 96587294, "body": "The error will show you exactly where the nil pointer dereference happens. Where is that in the code?"}], "answers": [{"tags": [], "owner": {"reputation": 1047, "user_id": 10443472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/051b4da9def21dd0ff5e10f383a96c94?s=128&d=identicon&r=PG", "display_name": "retgits", "link": "https://stackoverflow.com/users/10443472/retgits"}, "is_accepted": false, "score": 1, "last_activity_date": 1551309269, "creation_date": 1551309269, "answer_id": 54915997, "question_id": 54905147, "link": "https://stackoverflow.com/questions/54905147/invalid-memory-address-or-nil-pointer-dereference-in-golang/54915997#54915997", "title": "Invalid memory address or nil pointer dereference in golang", "body": "<p>If you look at the console where the error is shown, I guess it'll show something like <code>posts.go:9</code>. On that line, you're trying to execute a database query but at that point in time, the connection to the database has already been closed.</p>\n\n<p>In your <code>db.go</code> you have the line</p>\n\n<pre><code>db, err := sql.Open(\"mysql\",\"root:@/posts\")\n</code></pre>\n\n<p>That line creates two variables for the scope of the function and assigns the values to it. By the time the function finishes, there is nothing left that uses the scoped variable <code>db</code> so the connection is closed. Because you've used the <code>:=</code> new variables have been created and you haven't assigned it to the <code>var db *sql.DB</code>.</p>\n\n<p>As a quick fix, you can change the first part of the DbConn method to</p>\n\n<pre><code>var err error\ndb, err = sql.Open(\"mysql\", \"root@/posts\")\n</code></pre>\n\n<p><em>I've added a line for a new variable of type error and the assign now assigns the values to existing variables as opposed to creating new ones (<code>=</code> vs <code>:=</code>)</em></p>\n"}], "owner": {"reputation": 101, "user_id": 11105561, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/404b5442eef9c2cc97292b61d9482d2f?s=128&d=identicon&r=PG&f=1", "display_name": "Ana be", "link": "https://stackoverflow.com/users/11105561/ana-be"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 476, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1551381048, "creation_date": 1551269265, "last_edit_date": 1551381048, "question_id": 54905147, "link": "https://stackoverflow.com/questions/54905147/invalid-memory-address-or-nil-pointer-dereference-in-golang", "title": "Invalid memory address or nil pointer dereference in golang", "body": "<p>I'm new to go lang, I loved it so far but I came across this problem when ever I run the application : </p>\n\n<blockquote>\n  <p>invalid memory address or nil pointer dereference </p>\n</blockquote>\n\n<p>What should I do to fix the problem?</p>\n\n<p>Here is the main file <code>syntax.go</code>:</p>\n\n<pre><code>package main\n\n    import (\n        \"blog/models\"\n        \"fmt\"\n        \"net/http\"\n    )\n\n    func main() {\n       models.DbConn()\n\n       http.HandleFunc(\"/books\", postsIndex)\n       http.ListenAndServe(\":3000\", nil)\n\n    }\n    func postsIndex(w http.ResponseWriter, r *http.Request) {\n        if r.Method != \"GET\" {\n            http.Error(w, http.StatusText(405), 405)\n            return\n        }\n        bks, err := models.AllPosts()\n        if err != nil {\n            http.Error(w, http.StatusText(500), 500)\n            return\n        }\n        for _, bk := range bks {\n            fmt.Fprintf(w, \"%s, %s\", bk.Title, bk.Description)\n        }\n    }\n</code></pre>\n\n<p>and this the database connection <code>db.go</code>:</p>\n\n<pre><code>package models\n\nimport (\n    \"fmt\"\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n    \"log\"\n)\nvar db *sql.DB\nfunc DbConn() {\n    db, err := sql.Open(\"mysql\",\"root:@/posts\")\n\n    if err != nil {\n        log.Fatal(err)\n    }else {\n        fmt.Printf(\"this is working\")\n    }\n    defer db.Close()\n}\n</code></pre>\n\n<p>and this the file to get the posts  <code>posts.go</code>:</p>\n\n<pre><code>package models\n\ntype Post struct {\n\n    Title  string\n    Description string\n\n}\n\nfunc AllPosts() ([]*Post, error) {\n    rows, err := db.Query(\"SELECT * FROM posts\")\n    if err != nil {\n        return nil, err\n    }\n    defer rows.Close()\n\n    bks := make([]*Post, 0)\n    for rows.Next() {\n        bk := new(Post)\n        err := rows.Scan(&amp;bk.Title, &amp;bk.Description )\n        if err != nil {\n            return nil, err\n        }\n        bks = append(bks, bk)\n    }\n    if err = rows.Err(); err != nil {\n        return nil, err\n    }\n    return bks, nil\n}\n</code></pre>\n"}, {"tags": ["go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 147, "user_id": 10308347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16pI7.jpg?s=128&g=1", "display_name": "Eduardo Albuquerque", "link": "https://stackoverflow.com/users/10308347/eduardo-albuquerque"}, "edited": false, "score": 0, "creation_date": 1551346419, "post_id": 54905264, "comment_id": 96609697, "body": "Thanks so much! You gave me the key word. My antivirus ran my main.go two times, when I disabled it works fine."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1551269686, "creation_date": 1551269686, "answer_id": 54905264, "question_id": 54904988, "link": "https://stackoverflow.com/questions/54904988/two-insertion-instead-of-one-with-mgo/54905264#54905264", "title": "Two insertion instead of one with mgo", "body": "<p>Your code inserts a single document only. If it would insert 2, properties (except the <code>_id</code> field) would be identical / same.</p>\n\n<p>And your 2 documents have different <code>time</code> field, thus they are from 2 different runs.</p>\n\n<p>So what you see is the result of 2 different runs (2 seconds away from each other), either by you or by your IDE.</p>\n"}], "owner": {"reputation": 147, "user_id": 10308347, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16pI7.jpg?s=128&g=1", "display_name": "Eduardo Albuquerque", "link": "https://stackoverflow.com/users/10308347/eduardo-albuquerque"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 54905264, "answer_count": 1, "score": 0, "last_activity_date": 1551269686, "creation_date": 1551268701, "question_id": 54904988, "link": "https://stackoverflow.com/questions/54904988/two-insertion-instead-of-one-with-mgo", "title": "Two insertion instead of one with mgo", "body": "<p>Im new in Golang and Im building a Golang CRUD using mgo framework to practice. When I insert one element using mgo, is inserted two times instead of one time, I ckecked it in MongoDB Compass Community. This is my <a href=\"https://github.com/edualb/MongoDB-Connection-With-Golang\" rel=\"nofollow noreferrer\">repository</a></p>\n\n<p>This is a picture showing how is being saved in my database:</p>\n\n<p><a href=\"https://i.stack.imgur.com/0ZJKB.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0ZJKB.png\" alt=\"enter image description here\"></a></p>\n\n<p>Can anybody help me? </p>\n"}, {"tags": ["go", "structure"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551286033, "post_id": 54904637, "comment_id": 96587882, "body": "If you&#39;re looking for anything that defines <code>GenerateStats(ctime time.Time)</code>, that&#39;s what an <code>interface</code> is. Have you gone through any documentation like <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a> or the <a href=\"https://tour.golang.org/welcome/1\" rel=\"nofollow noreferrer\">Tour of Go</a>?"}], "answers": [{"tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 0, "last_activity_date": 1551268820, "creation_date": 1551268820, "answer_id": 54905019, "question_id": 54904637, "link": "https://stackoverflow.com/questions/54904637/how-to-create-a-function-to-accept-any-call-from-any-object-of-any-structure/54905019#54905019", "title": "how to create a function to accept any call from any object of any structure?", "body": "<p>Unfortunately go doesn't have generics and the answer to your question is - it's impossible.\n<br>The only thing you can do here is create regular function and pass object into function as parameter.</p>\n"}], "owner": {"reputation": 1, "user_id": 11124765, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-u-XJbSkP2QI/AAAAAAAAAAI/AAAAAAAAACE/-QUw0dhqSIc/photo.jpg?sz=128", "display_name": "sourav kumar", "link": "https://stackoverflow.com/users/11124765/sourav-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 1, "score": -4, "last_activity_date": 1551271568, "creation_date": 1551267574, "last_edit_date": 1551271568, "question_id": 54904637, "link": "https://stackoverflow.com/questions/54904637/how-to-create-a-function-to-accept-any-call-from-any-object-of-any-structure", "title": "how to create a function to accept any call from any object of any structure?", "body": "<p>In golang I am trying to create a function which I want to call it with an object of a structure.</p>\n\n<p>How can I make the function accept calls from all types of structures.</p>\n\n<p>calling function:</p>\n\n<pre><code>func (this PortStatsHandler) triggerSampler(counter int) {\n     portstatob.GenerateStats(ctime) //portstatob is an object.\n\n}\n</code></pre>\n\n<p>function:</p>\n\n<pre><code>func (this *PortStats) GenerateStats(ctime time.Time) {\n\n}\n</code></pre>\n\n<p>Now it's accepting only objects of <code>PortStats</code> but not any structure. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5296, "user_id": 418066, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/38yuw.png?s=128&g=1", "display_name": "Biffen", "link": "https://stackoverflow.com/users/418066/biffen"}, "edited": false, "score": 0, "creation_date": 1551351453, "post_id": 54903082, "comment_id": 96612866, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/4736/learning-regular-expressions\">Learning Regular Expressions</a>"}], "owner": {"reputation": 643, "user_id": 5046220, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/d6703018e7d190e03c461a2ea5c162b6?s=128&d=identicon&r=PG&f=1", "display_name": "supriya", "link": "https://stackoverflow.com/users/5046220/supriya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1183, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1551351371, "creation_date": 1551262672, "last_edit_date": 1551262747, "question_id": 54903082, "link": "https://stackoverflow.com/questions/54903082/negate-entire-string-in-golang-regex", "title": "Negate entire string in golang regex", "body": "<p>I want to write a regex where I want to negate entire string.</p>\n\n<p>I tried - <code>inventory/[^getData]</code>(assumming it will check getData string not to be present in expression)</p>\n\n<p>I want \"inventory/getData\" to fail above regex match whereas \"inventory/get\" to pass regex match. Basically want to negate string \"getData\"\nHow can I do this?</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551263068, "post_id": 54902664, "comment_id": 96573531, "body": "have you tried to install <code>which</code> or you don&#39;t want to depend on it in general ?"}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1551263449, "post_id": 54902664, "comment_id": 96573789, "body": "Do you mean this image: <a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">hub.docker.com/_/golang</a>? (Because the one you&#39;ve shared doesn&#39;t have the <code>go</code> binary). A quick test with <code>golang:1.12-alpine</code>: <code>which go</code> gives <code>&#47;usr&#47;local&#47;go&#47;bin&#47;go</code>."}, {"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "reply_to_user": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 1, "creation_date": 1551263684, "post_id": 54902664, "comment_id": 96573928, "body": "@tgogos This is indeed correct, I have amended the link, thanks. Maybe the alpine specifically isn&#39;t the issue then, but relying on <code>which</code>. Thanks, I&#39;ve updated the question to remove the alpine, it was my finding from an alternative alpine. The question still stands :)"}, {"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "reply_to_user": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551263723, "post_id": 54902664, "comment_id": 96573959, "body": "@MostafaHussein I need to not depend on <code>which</code> in general."}, {"owner": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551263992, "post_id": 54902664, "comment_id": 96574122, "body": "You might already tried this <a href=\"https://tip.golang.org/pkg/os/#Executable\" rel=\"nofollow noreferrer\">tip.golang.org/pkg/os/#Executable</a> Does it work as expected ?"}, {"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "reply_to_user": {"reputation": 8517, "user_id": 2336650, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/lpq4b.jpg?s=128&g=1", "display_name": "Mostafa Hussein", "link": "https://stackoverflow.com/users/2336650/mostafa-hussein"}, "edited": false, "score": 0, "creation_date": 1551264048, "post_id": 54902664, "comment_id": 96574167, "body": "@MostafaHussein This returns the path of the <i>file</i>, after building it could be something in <code>&#47;tmp</code>, but it&#39;s not the path to the <code>go</code> executable."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 4, "creation_date": 1551265942, "post_id": 54902664, "comment_id": 96575376, "body": "Use <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\">exec.LookPath</a>"}, {"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1551266074, "post_id": 54902664, "comment_id": 96575457, "body": "@Peter Excellent, this works! Many thanks - fancy putting it in an answer? I&#39;d be happy to upvote and tick :-)"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551284335, "post_id": 54904048, "comment_id": 96586785, "body": "You&#39;re not executing a shell built-in if you&#39;re not executing a shell, though <code>&#47;usr&#47;bin&#47;type</code> does do the same thing. Doesn&#39;t <a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\"><code>exec.LookPath</code></a> do what you want?"}], "tags": [], "owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551265576, "creation_date": 1551265576, "answer_id": 54904048, "question_id": 54902664, "link": "https://stackoverflow.com/questions/54902664/programatically-and-reliably-retrieve-the-path-to-the-go-executable-in-container/54904048#54904048", "title": "Programatically and reliably retrieve the path to the go executable in container without &#39;which&#39; with Go", "body": "<p>I don't expect this to be the best answer, but it is one that I just found. I was hoping for more of a go-specific one, but in the meantime <a href=\"https://ss64.com/bash/type.html\" rel=\"nofollow noreferrer\">type</a> in linux is a default built-in one available in bash and sh (alpine).</p>\n\n<p>You can test this yourself by running <code>type type</code> which yields:</p>\n\n<blockquote>\n  <p>type is a shell builtin</p>\n</blockquote>\n\n<p>The usage in <code>go</code> would look like this:</p>\n\n<pre><code>b, err := exec.Command(\"type\", \"go\").Output()\n\nif err != nil {\n    /* 'type' is not available on the O/S */\n}\n\ngoPath := strings.TrimPrefix(strings.TrimSuffix(string(b), \"\\n\"), \"go is \")\n</code></pre>\n\n<p>The reason the <code>Trim</code> functions are required is because the output would look like this:</p>\n\n<blockquote>\n  <p>go is /usr/local/go/bin/go\\n</p>\n</blockquote>\n\n<p>This isn't the nicest way of going about it, but it works.</p>\n"}, {"comments": [{"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "edited": false, "score": 0, "creation_date": 1551289275, "post_id": 54911397, "comment_id": 96589599, "body": "Thanks a lot Peter!"}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 1, "last_activity_date": 1551289101, "creation_date": 1551289101, "answer_id": 54911397, "question_id": 54902664, "link": "https://stackoverflow.com/questions/54902664/programatically-and-reliably-retrieve-the-path-to-the-go-executable-in-container/54911397#54911397", "title": "Programatically and reliably retrieve the path to the go executable in container without &#39;which&#39; with Go", "body": "<p>From the <a href=\"https://linux.die.net/man/1/which\" rel=\"nofollow noreferrer\">man page of <code>which</code></a>:</p>\n\n<blockquote>\n  <p>Which takes one or more arguments. For each of its arguments it prints to stdout the full path of the executables that would have been executed when this argument had been entered at the shell prompt. It does this by searching for an executable or script in the directories listed in the environment variable PATH using the same algorithm as bash(1).</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/pkg/os/exec/#LookPath\" rel=\"nofollow noreferrer\">Go's <code>os/exec.LookPath</code> function</a> is very close to this functionality:</p>\n\n<blockquote>\n  <p>LookPath searches for an executable named file in the directories named by the PATH environment variable. If file contains a slash, it is tried directly and the PATH is not consulted. The result may be an absolute path or a path relative to the current directory.</p>\n</blockquote>\n\n<p>Use <a href=\"https://golang.org/pkg/path/filepath/#Abs\" rel=\"nofollow noreferrer\"><code>path/filepath.Abs</code></a> if you need a guaranteed absolute path.</p>\n"}], "owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 1, "accepted_answer_id": 54911397, "answer_count": 2, "score": 0, "last_activity_date": 1551289101, "creation_date": 1551261498, "last_edit_date": 1551263693, "question_id": 54902664, "link": "https://stackoverflow.com/questions/54902664/programatically-and-reliably-retrieve-the-path-to-the-go-executable-in-container", "title": "Programatically and reliably retrieve the path to the go executable in container without &#39;which&#39; with Go", "body": "<p>How can I retrieve the path to the <code>go</code> binary in a container that does not have <code>which</code> <em>programatically</em>?</p>\n\n<p>One option would be to execute <code>which go</code> as follows:</p>\n\n<pre><code>bytes, err := exec.Command(\"which\", \"go\").Output()\n</code></pre>\n\n<p>However, I would like to not depend on <code>which</code> being available. Does go provide any in-built mechanism to retrieve this and if not, what is the alternative apart from having the user pass in the path themselves?</p>\n"}, {"tags": ["sql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": true, "score": 1, "last_activity_date": 1551291451, "creation_date": 1551291451, "answer_id": 54912051, "question_id": 54902257, "link": "https://stackoverflow.com/questions/54902257/dynamic-column-search-in-multiple-tables-with-gorm-golang/54912051#54912051", "title": "Dynamic column search in multiple tables with gorm golang", "body": "<p>Even though you are preloading, you are still required to explicitly use joins when filtering and ordering on columns on other tables. Preloading is used to eagerly load the data to map into your models, not to join tables.</p>\n\n<p>Chain on something like this:</p>\n\n<pre><code>.Joins(\"LEFT JOIN rfm.robot_models AS robot_models ON robot_models.id = robots.robot_model_id\")\n</code></pre>\n\n<p>I'm not positive if you can use the <code>AS</code> keyword using this technique, but if not, it should be easy enough to adjust your query accordingly.</p>\n"}], "owner": {"reputation": 59, "user_id": 9764715, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dL1Mq.jpg?s=128&g=1", "display_name": "Vinayak", "link": "https://stackoverflow.com/users/9764715/vinayak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1207, "favorite_count": 3, "accepted_answer_id": 54912051, "answer_count": 1, "score": 2, "last_activity_date": 1551328316, "creation_date": 1551260324, "last_edit_date": 1551328316, "question_id": 54902257, "link": "https://stackoverflow.com/questions/54902257/dynamic-column-search-in-multiple-tables-with-gorm-golang", "title": "Dynamic column search in multiple tables with gorm golang", "body": "<p>My scenario is i have a grid with search option where user can select the column and can do the search, the grid data is coming from various tables. I have attached a sample screen of grid.</p>\n\n<p><a href=\"https://i.stack.imgur.com/0c2Jg.png\" rel=\"nofollow noreferrer\">User Screen</a></p>\n\n<p>So i'm trying to create a dynamic query for search but the problem is i can able to search only in main table (schema.Robot) not in Preload tables. whenever i trying to search data data from Preload tables let say from RobotModel table that time getting below error</p>\n\n<p><strong>pq: missing FROM-clause entry for table \"robot_models\"</strong></p>\n\n<p>Here is my go code</p>\n\n<pre><code>func (r *RobotsRepository) GetRobotsSummary(listParams viewmodel.ListParams, companyID uint) ([]*schema.Robot, int, error) {\nmrobots := []*schema.Robot{}\nvar count int\nvar order string\nif listParams.SortColumn == \"\" {\n    listParams.SortColumn = \"id\"\n    listParams.SortOrder = 1\n} else {\n    listParams.SortColumn = util.Underscore(listParams.SortColumn)\n}\nif listParams.SortOrder == 0 {\n    order = \"ASC\"\n} else {\n    order = \"DESC\"\n}\n\nvar searchQuery string\nif listParams.SearchText != \"\" {\n    switch listParams.SearchColumn {\n    case \"Robot\":\n        listParams.SearchColumn = \"name\"\n    case \"Model\":\n        listParams.SearchColumn = \"robot_models.name\"\n    }\n    searchQuery = listParams.SearchColumn +\" LIKE '%\"+ listParams.SearchText +\"%' and Company_ID = \" + fmt.Sprint(companyID)\n}else{\n    searchQuery = \"Company_ID = \" + fmt.Sprint(companyID)\n}   \n\norderBy := fmt.Sprintf(\"%s %s\", listParams.SortColumn, order)\n\nerr := r.Conn.\n    Preload(\"RobotModel\", func(db *gorm.DB) *gorm.DB {\n        return db.Select(\"ID,Name\")\n    }).\n    Preload(\"Task\", func(db *gorm.DB) *gorm.DB {\n        return db.Where(\"Task_Status in ('In-Progress','Pending')\").Select(\"ID, Task_Status\")\n    }).\n    Preload(\"CreatedUser\", func(db *gorm.DB) *gorm.DB {\n        return db.Select(\"ID,Display_Name\")\n    }).\n    Preload(\"UpdatedUser\", func(db *gorm.DB) *gorm.DB {\n        return db.Select(\"ID,Display_Name\")\n    }).\n    Where(searchQuery).\n    Order(orderBy).\n    Offset(listParams.PageSize * (listParams.PageNo - 1)).\n    Limit(listParams.PageSize).\n    Find(&amp;mrobots).Error\n\nr.Conn.Model(&amp;schema.Robot{}).Where(searchQuery).Count(&amp;count)\n\nreturn mrobots, count, err \n}\n</code></pre>\n\n<p>In searchQuery variable i'm storing my dynamic query.\nMy question is how can i search data for preload table columns</p>\n\n<p>Here is the sql query which i'm trying to achieve using gorm</p>\n\n<pre><code>SELECT robots.id,robots.name,robot_models.name as \nmodel_name,count(tasks.task_status) as task_on_hand,\nrobots.updated_at,users.user_name as updated_by\nFROM rfm.robots as robots\nleft join rfm.tasks as tasks on tasks.robot_id = robots.id and \ntasks.task_status in ('In-Progress','Pending') \nleft join rfm.robot_models as robot_models on robot_models.id = \nrobots.robot_model_id \nleft join rfm.users as users on users.id = robots.updated_by \nWHERE robot_models.name::varchar like '%RNR%' and robots.deleted_at is null \nGROUP BY robots.id,robot_models.name,users.user_name \nORDER BY task_on_hand DESC LIMIT 2 OFFSET 0\n</code></pre>\n\n<p>and sorry for bad English!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4194, "user_id": 2671470, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/1503382632/picture?type=large", "display_name": "Muhammad Dyas Yaskur", "link": "https://stackoverflow.com/users/2671470/muhammad-dyas-yaskur"}, "edited": false, "score": 2, "creation_date": 1551259214, "post_id": 54901846, "comment_id": 96571064, "body": "What is your hosting control panel? most of the shared hosting doesn&#39;t support to  run your own binary,  you need to run your own binary on the system to use golang. it&#39;s better to use VPS."}, {"owner": {"reputation": 918, "user_id": 9812239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "OriHero", "link": "https://stackoverflow.com/users/9812239/orihero"}, "reply_to_user": {"reputation": 4194, "user_id": 2671470, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/1503382632/picture?type=large", "display_name": "Muhammad Dyas Yaskur", "link": "https://stackoverflow.com/users/2671470/muhammad-dyas-yaskur"}, "edited": false, "score": 0, "creation_date": 1551259807, "post_id": 54901846, "comment_id": 96571413, "body": "<code>cPanel</code> if you mean that!"}], "answers": [{"comments": [{"owner": {"reputation": 918, "user_id": 9812239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "OriHero", "link": "https://stackoverflow.com/users/9812239/orihero"}, "edited": false, "score": 0, "creation_date": 1551262865, "post_id": 54902574, "comment_id": 96573390, "body": "As I expected. Guess I will buy a VPS server for that"}], "tags": [], "owner": {"reputation": 728, "user_id": 3348617, "user_type": "registered", "profile_image": "https://graph.facebook.com/1475953069/picture?type=large", "display_name": "zdebra", "link": "https://stackoverflow.com/users/3348617/zdebra"}, "is_accepted": true, "score": 6, "last_activity_date": 1551261285, "creation_date": 1551261285, "answer_id": 54902574, "question_id": 54901846, "link": "https://stackoverflow.com/questions/54901846/golang-how-to-deploy-a-website-to-hosting/54902574#54902574", "title": "Golang how to deploy a website to hosting", "body": "<p>Golang is a compiled language. The output of your compiled source code is a binary that could be executed directly on Operating System (that is compiled for) without needing any other software. The compiled binary itself contains a webserver consuming http requests. That's the main difference from interpreted languages like PHP is, where a webserver (Apache, Nginx) is needed to translate incoming requests to a protocol that PHP understands. See <a href=\"https://stackoverflow.com/a/2089297/3348617\">this</a> answer for more information. </p>\n\n<blockquote>\n  <p>I tried adding .htaccess file but no success</p>\n</blockquote>\n\n<p>The <code>.htaccess</code> file is the Apache webserver configuration file, which you don't need for running a compiled webserver application.</p>\n\n<blockquote>\n  <p>Is it normal to deploy my Golang website to hosting? Or should I buy a\n  server?</p>\n</blockquote>\n\n<p>The website hosting providers expect you to run PHP or any other application that understands CGI protocol. </p>\n\n<p>You should proceed similarly as for any other compiled language in order to host your golang webapp: buy a server (VPS) from classic hosting providers or use a public cloud provider. </p>\n\n<p>Another option for you would be to use a managed platform like Google's <a href=\"https://cloud.google.com/appengine/\" rel=\"noreferrer\">App Engine</a> is. It requires you to deploy golang source code and it manages everything else for you. It might save you some devops hassle.</p>\n"}], "owner": {"reputation": 918, "user_id": 9812239, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "OriHero", "link": "https://stackoverflow.com/users/9812239/orihero"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4818, "favorite_count": 1, "accepted_answer_id": 54902574, "answer_count": 1, "score": 0, "last_activity_date": 1551261285, "creation_date": 1551259052, "question_id": 54901846, "link": "https://stackoverflow.com/questions/54901846/golang-how-to-deploy-a-website-to-hosting", "title": "Golang how to deploy a website to hosting", "body": "<p>I have bought hosting from <a href=\"https://reg.ru\" rel=\"nofollow noreferrer\">reg.ru</a>. I have compiled my website and put it in a subdomain. When I run my app it runs fine without errors. But when I enter that subdomain my website does not respond. I tried adding <code>.htaccess</code> file but no success. Is it normal to deploy my <code>Golang</code> website to hosting? Or should I buy a server? Can I tell that hosting to serve request of that subdomain from my application?</p>\n"}, {"tags": ["go", "types", "interface", "type-assertion"], "comments": [{"owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "edited": false, "score": 0, "creation_date": 1551257688, "post_id": 54901390, "comment_id": 96570196, "body": "You will have to check the actual type and handle the different cases separately. Note that there are a lot of numeric types in Go so many cases to consider."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1551258492, "creation_date": 1551258492, "answer_id": 54901699, "question_id": 54901390, "link": "https://stackoverflow.com/questions/54901390/golang-sum-of-an-interface/54901699#54901699", "title": "Golang - Sum of an [...]interface{}", "body": "<p>The <code>+</code> operator is not defined on values of type <code>interface{}</code>. You have to get a value of type <code>int</code> out of the <code>interface{}</code> values before you can work with it as a number.</p>\n\n<p>For that, you may use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a>. See this example:</p>\n\n<pre><code>s := []interface{}{1, 2, 3, \"invalid\"}\n\nsum := 0\nfor _, v := range s {\n    if i, ok := v.(int); ok {\n        sum += i\n    } else {\n        fmt.Println(\"Not int:\", v)\n    }\n}\nfmt.Println(\"Sum:\", sum)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/-EPGDkY1ysY\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Not int: invalid\nSum: 6\n</code></pre>\n\n<p>The above example only handles <code>int</code> numbers, and nothing else. If you want to \"support\" multiple number types, a more convenient way would be to use a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"nofollow noreferrer\">type switch</a>:</p>\n\n<pre><code>s := []interface{}{1, int32(2), int8(3), \"invalid\"}\n\nsum := 0\nfor _, v := range s {\n    switch i := v.(type) {\n    case int:\n        sum += i\n    case int32:\n        sum += int(i)\n    case int8:\n        sum += int(i)\n    default:\n        fmt.Println(\"Not int:\", v)\n    }\n}\nfmt.Println(\"Sum:\", sum)\n</code></pre>\n\n<p>Output is the same. Try this one on the <a href=\"https://play.golang.org/p/HKToK4ZZJhI\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 418, "user_id": 7626856, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c62884a97a8ec51395c574d77c422c3c?s=128&d=identicon&r=PG&f=1", "display_name": "Clemson", "link": "https://stackoverflow.com/users/7626856/clemson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2894, "favorite_count": 0, "accepted_answer_id": 54901699, "answer_count": 1, "score": 0, "last_activity_date": 1551258704, "creation_date": 1551257390, "last_edit_date": 1551258704, "question_id": 54901390, "link": "https://stackoverflow.com/questions/54901390/golang-sum-of-an-interface", "title": "Golang - Sum of an [...]interface{}", "body": "<p>I have created a generic data structure, with a name and a generic array in Golang.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype NamedArray struct {\n  Name string\n  values []interface{}\n}\n\nfunc main() {\n  data := [...]int{1, 2, 3, 4, 5}\n  interfaced_data := make([]interface{}, len(data))\n  for i, v := range data{\n    interfaced_data[i] = v\n  }\n  int_arr := NamedArray{Name: \"Int Array\", values: interfaced_data}\n  fmt.Println(int_arr)\n  // fmt.Println(int_arr.Sum()) -- uncomment to run Sum\n\n  data_float := [...]float64{0.1, 0.2, 0.3, 0.4, 0.5}\n  interfaced_data_float := make([]interface{}, len(data_float))\n  for i, v := range data_float{\n    interfaced_data_float[i] = v\n  }\n  float_arr := NamedArray{Name: \"Float Array\", values: interfaced_data_float}\n  fmt.Println(float_arr)\n  // fmt.Println(int_arr.Sum()) -- uncomment to run Sum\n}\n</code></pre>\n\n<p>Now I want to define a method which allows me to sum all the values in the array. I know that they are numeric (though whether they are <code>int</code> or <code>float</code> is dependant on context) but I am having some serious trouble. </p>\n\n<pre><code>func (arr NamedArray) Sum() interface{} {\n  data := arr.values\n  sum := 0\n  for i, v := range data {\n    sum += v\n  }\n  return sum\n}\n</code></pre>\n\n<p>I can't seem to make this work, though. When I uncomment lines 18 and 27 (<code>fmt.Println(int_arr.Sum()</code> and <code>fmt.Println(int_arr.Sum()</code>) and try to run the code I get </p>\n\n<pre><code>34:9: invalid operation: sum += v (mismatched types int and interface {})\n</code></pre>\n\n<p>During compilation. </p>\n\n<p>Does anyone know how to add generic types, given we know that they are numeric?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["string", "go", "indexing"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1551258009, "last_edit_date": 1592644375, "creation_date": 1551257515, "answer_id": 54901422, "question_id": 54901242, "link": "https://stackoverflow.com/questions/54901242/slice-doesnt-panic-on-length-but-it-panics-while-getting-value-for-index-equals/54901422#54901422", "title": "Slice doesn&#39;t panic on length but it panics while getting value for index equals length", "body": "<p><strong>TLDR; In an index expression the index must be less than the length, and in a slice expression the length is a valid index.</strong></p>\n<p>In an <a href=\"https://golang.org/ref/spec#Index_expressions\" rel=\"nofollow noreferrer\">index expression</a> the index must be <em>in range</em>, else it panics. The index is in range if <code>0 &lt;= i &lt; length</code>. Quoting from the spec:</p>\n<blockquote>\n<p>In the index expression <code>a[x]</code>...</p>\n<p>If <code>a</code> is not a map:</p>\n<ul>\n<li>the index <code>x</code> is in range if <code>0 &lt;= x &lt; len(a)</code>, otherwise it is <em>out of range</em></li>\n</ul>\n</blockquote>\n<p>And:</p>\n<blockquote>\n<p>For a of <a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">string type</a>:</p>\n<ul>\n<li>if <code>x</code> is out of range at run time, a <a href=\"https://golang.org/ref/spec#Run_time_panics\" rel=\"nofollow noreferrer\">run-time panic</a> occurs</li>\n</ul>\n</blockquote>\n<p>Your <code>str</code> string variable stores a <code>string</code> value which has a single byte: <code>'a'</code>. Indexing starts at zero, so that single byte has index <code>0</code>. Its length is <code>1</code>, so there is no element at index <code>1</code>.</p>\n<p>In a <a href=\"https://golang.org/ref/spec#Slice_expressions\" rel=\"nofollow noreferrer\">slice expression</a>:</p>\n<blockquote>\n<p><code>a[low : high]</code></p>\n<p>For arrays or strings, the indices are in range if <code>0 &lt;= low &lt;= high &lt;= len(a)</code>, otherwise they are out of range.</p>\n</blockquote>\n<p>In a slice expression the length is a valid index. So in your case indexing <code>str</code> like <code>str[1:]</code> will result in an empty string: <code>&quot;&quot;</code>:</p>\n<blockquote>\n<p>In a slice expression <code>a[low : high]</code>...</p>\n<p>The result has indices starting at <code>0</code> and length equal to <code>high - low</code>.</p>\n<p>A missing <code>low</code> index defaults to zero; a missing <code>high</code> index defaults to the length of the sliced operand.</p>\n</blockquote>\n<p>So <code>str[1:]</code> is the same as <code>str[1:len(str)]</code> which is <code>str[1:1]</code>. The result string will have a length of <code>high - low = 1 - 1 = 0</code>: the empty <code>string</code>.</p>\n"}], "owner": {"reputation": 123, "user_id": 3458295, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/826e33c9b1bca10ce2a77d597f0e5a81?s=128&d=identicon&r=PG&f=1", "display_name": "ragrawal", "link": "https://stackoverflow.com/users/3458295/ragrawal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1551258168, "creation_date": 1551256919, "last_edit_date": 1551258168, "question_id": 54901242, "link": "https://stackoverflow.com/questions/54901242/slice-doesnt-panic-on-length-but-it-panics-while-getting-value-for-index-equals", "title": "Slice doesn&#39;t panic on length but it panics while getting value for index equals length", "body": "<p>I have a <code>string</code>, and when I want to get the value at <code>i</code> index it panics, but when I slice out of the same <code>string</code> keeping lower index value as length then it doesn't panic. Wanted to know how 1 and 2 differs?</p>\n\n<pre><code>func main() {\n    str := \"a\"\n    fmt.Println(str[1])  // 1 this panics\n    fmt.Println(str[1:]) // 2 this doesn't\n}\n</code></pre>\n"}, {"tags": ["docker", "go"], "answers": [{"tags": [], "owner": {"reputation": 8871, "user_id": 2295964, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/c00fadf5a477a8f770e91fdd7b356e76?s=128&d=identicon&r=PG", "display_name": "Yan Foto", "link": "https://stackoverflow.com/users/2295964/yan-foto"}, "is_accepted": true, "score": 1, "last_activity_date": 1551256581, "creation_date": 1551256581, "answer_id": 54901161, "question_id": 54901116, "link": "https://stackoverflow.com/questions/54901116/how-an-app-in-docker-container-access-db-in-windows/54901161#54901161", "title": "How an app in docker container access DB in windows?", "body": "<p>Using <a href=\"https://docs.docker.com/storage/volumes/\" rel=\"nofollow noreferrer\">docker volumes</a> and by using the <code>-v</code> or <code>--mount</code> flag when you start your container.</p>\n\n<p>A modified example from the Docker docs:</p>\n\n<pre><code>$ docker run -d \\\n  --mount source=myvol2,target=/app \\\n  nginx:latest\n</code></pre>\n\n<p>you just need to replace <code>nginx:latext</code> with your image name and adapt <code>source</code> and <code>target</code> as you need.</p>\n\n<p>Another example (also from the docs) using <code>-v</code> and mounting in read-only mode:</p>\n\n<pre><code>$ docker run -d \\\n  -v nginx-vol:/usr/share/nginx/html:ro \\\n  nginx:latest\n</code></pre>\n"}], "owner": {"reputation": 57, "user_id": 9716692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1947922611894394/picture?type=large", "display_name": "user9716692", "link": "https://stackoverflow.com/users/9716692/user9716692"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25, "favorite_count": 0, "accepted_answer_id": 54901161, "answer_count": 1, "score": -2, "last_activity_date": 1551256581, "creation_date": 1551256449, "question_id": 54901116, "link": "https://stackoverflow.com/questions/54901116/how-an-app-in-docker-container-access-db-in-windows", "title": "How an app in docker container access DB in windows?", "body": "<p>OS: Windows server 2016</p>\n\n<p>I have an App wrote in Go and put in a docker container. The App has to access \"D:\\test.db\". How can I do that?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 6, "creation_date": 1551280136, "post_id": 54900613, "comment_id": 96583977, "body": "Just want to point out that it might be more intuitive and readable to write this as <code>rate.Every(time.Second &#47; 40)</code> instead of converting 40 req/sec to ms/req first."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1581107767, "post_id": 54900613, "comment_id": 106333077, "body": "The docs already define <a href=\"https://godoc.org/golang.org/x/time/rate#Limit\" rel=\"nofollow noreferrer\">Limit</a>  <i>as number of events per second</i> - so why not simply <code>rate.Limit(40)</code>?"}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1581330385, "post_id": 54900613, "comment_id": 106382645, "body": "Opinion based:  I would suggest that <code>rate.Limit(40)</code> may be possible, but without reading the docs it&#39;s also possible to mis-understand this as the limiter is limited to 40 requests total."}, {"owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "edited": false, "score": 0, "creation_date": 1581509642, "post_id": 54900613, "comment_id": 106456807, "body": "<i>MY</i> comment was opinion based.. not the docs or the response."}], "tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 7, "last_activity_date": 1551254296, "creation_date": 1551254296, "answer_id": 54900613, "question_id": 54900121, "link": "https://stackoverflow.com/questions/54900121/rate-limit-function-40-second-with-golang-org-x-time-rate/54900613#54900613", "title": "Rate limit function 40/second with &quot;golang.org/x/time/rate&quot;", "body": "<p>Reading the docs here; <a href=\"https://godoc.org/golang.org/x/time/rate#NewLimiter\" rel=\"noreferrer\">link</a></p>\n\n<p>You can see that the first param to <code>NewLimiter</code> is of type <code>rate.Limit</code>.</p>\n\n<p>If you want 40 requests / second then that translates into a rate of 1 requests every 25ms.</p>\n\n<p>You can create that by doing:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>limiter := rate.NewLimiter(rate.Every(25 * time.Millisecond), 2)\n</code></pre>\n\n<p>Side note:</p>\n\n<ul>\n<li>In generate a context <code>ctx</code> should not be stored on a struct and should be per-request. It would appear that <code>Client</code> will be reused, thus you could pass a context to the <code>RateLimitFunc()</code> or where ever appropriate instead of storing a single context on the client struct.</li>\n</ul>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3111, "favorite_count": 2, "accepted_answer_id": 54900613, "answer_count": 1, "score": 5, "last_activity_date": 1551254296, "creation_date": 1551252323, "question_id": 54900121, "link": "https://stackoverflow.com/questions/54900121/rate-limit-function-40-second-with-golang-org-x-time-rate", "title": "Rate limit function 40/second with &quot;golang.org/x/time/rate&quot;", "body": "<p>I'm trying to use \"golang.org/x/time/rate\" to build a function which blocks until a token is free. Is this the correct way to use the library to rate limit blocks of code to 40 requests per second, with a bucket size of 2. </p>\n\n<pre><code>type Client struct {\n    limiter        *rate.Limiter\n    ctx context.Context\n}\n\nfunc NewClient() *Client {\n    c :=Client{}\n    c.limiter = rate.NewLimiter(40, 2)\n    c.ctx = context.Background()\n    return &amp;c\n}\n\nfunc (client *Client) RateLimitFunc() {\n\n    err := client.limiter.Wait(client.ctx)\n    if err != nil {\n        fmt.Printf(\"rate limit error: %v\", err)\n    }\n}\n</code></pre>\n\n<p>To rate limit a block of code I call</p>\n\n<pre><code>RateLimitFunc()\n</code></pre>\n\n<p>I don't want to use a ticker as I want the rate limiter to take into account the length of time the calling code runs for.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3984, "user_id": 4121573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kxnXk.png?s=128&g=1", "display_name": "Adonis", "link": "https://stackoverflow.com/users/4121573/adonis"}, "edited": false, "score": 0, "creation_date": 1551271245, "post_id": 54899550, "comment_id": 96578452, "body": "Either you need to use the correct certificate, or create an insecure connection to your HTTPS Server, a bit like this: <a href=\"https://stackoverflow.com/a/12122718/4121573\">stackoverflow.com/a/12122718/4121573</a>"}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "reply_to_user": {"reputation": 3984, "user_id": 4121573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kxnXk.png?s=128&g=1", "display_name": "Adonis", "link": "https://stackoverflow.com/users/4121573/adonis"}, "edited": false, "score": 0, "creation_date": 1551274652, "post_id": 54899550, "comment_id": 96580507, "body": "@Adonis Yeah, enabling the possibility of <code>InsecureSkipVerify</code> getting turned on in our production code is not an option. How would I &quot;use the correct certificate&quot;? That is basically what I&#39;m asking for in my original question."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551280343, "post_id": 54899550, "comment_id": 96584113, "body": "Can you clarify your situation? From the question it sounds like you&#39;re trying to use use <code>httptest.NewTLSServer</code> to serve secure traffic in production."}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551280726, "post_id": 54899550, "comment_id": 96584373, "body": "@Adrian No, I am definitely not trying to use it in production. I am trying to mock outside production components while testing the real calls of the production component in the project. Since the other production components it communicates with in its calls use HTTPS, I need the mock server from <code>NewTLSServer</code> to also use HTTPS."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551281208, "post_id": 54899550, "comment_id": 96584675, "body": "The test server is a test server, not a real server. You can make test calls to the test server, and they work (as you&#39;ve seen). If you want to make <i>real</i> TLS calls, you&#39;ll have to use a <i>real</i> TLS server with a real certificate."}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551287376, "post_id": 54899550, "comment_id": 96588641, "body": "@Adrian Well, I think the line is a bit blurry here. Obviously they are trying to mock out part of the TLS process or <code>NewTLSServer</code> wouldn&#39;t exist. I think the job isn&#39;t quite done because there is no way to connect to the server without explicitly having access to its code. You can access the test HTTP server without having access to its code. All you need is its URL. It makes since to me that the test HTTPS server should work analogously."}, {"owner": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 2, "creation_date": 1551320680, "post_id": 54899550, "comment_id": 96600790, "body": "@ChrisRedford I never tried to generate my own certificate (or use a valid certificate) for the httptest. But, in theory, you might be able to <code>ts := NewUnstartedServer</code> instead of <code>ts := NewTLSServer</code>. Then, you can tweak the <code>ts.TLS</code> which is a <code>https:&#47;&#47;golang.org&#47;pkg&#47;crypto&#47;tls&#47;#Config</code> (you would load another certificate). Then you can <code>ts.StartTLS()</code> (since it was a &quot;unstarted server&quot;). Aw, do not forget to <code>defer ts.Close()</code>.   As I said, I never tried, but it might work."}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "reply_to_user": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1551404944, "post_id": 54899550, "comment_id": 96637760, "body": "@JamilloSantos This gets me part of the way there. I tried generating my own <code>.key</code> and <code>.crt</code> using <a href=\"https://github.com/denji/golang-tls\" rel=\"nofollow noreferrer\">this method</a>. However, I then hit the error <code>cannot validate certificate for 127.0.0.1 because it doesn&#39;t contain any IP SANs http</code>"}, {"owner": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1551492432, "post_id": 54899550, "comment_id": 96671607, "body": "@ChrisRedford Are you generating the certificate to what host? If you generate your certificate, it will be self signed, the same the <code>NewTLSServer</code> does."}, {"owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "reply_to_user": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1551505972, "post_id": 54899550, "comment_id": 96673530, "body": "@JamilloSantos Got to the bottom of it all in my self-answer. Thanks for your <code>NewUnstartedServer</code> contribution."}], "answers": [{"comments": [{"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 0, "creation_date": 1613411491, "post_id": 54955508, "comment_id": 117061714, "body": "The &quot;Keychain Access&quot; part is unfortunate (as in, the entry can be used to compromise security on other parts of your system). It&#39;d be much better for your code to use a blank certificate pool and add only your test CA to it, instead of trying to use the system certificate pool at all. I do this even for production servers (letting the ops folks administering them choose whether to use the system pool or pass in an explicit CA cert set)."}], "tags": [], "owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "is_accepted": true, "score": 3, "last_activity_date": 1551507156, "last_edit_date": 1551507156, "creation_date": 1551504248, "answer_id": 54955508, "question_id": 54899550, "link": "https://stackoverflow.com/questions/54899550/create-https-test-server-for-any-client/54955508#54955508", "title": "Create HTTPS test server for any client", "body": "<p>As of Go 1.11, this simply isn't possible to accomplish fully within a <code>_test.go</code> program, due to the mechanics of HTTPS.</p>\n\n<p>However, you can do a single certificate signing and generation of <code>server.crt</code> and <code>server.key</code> files, then reference them in your <code>_test.go</code> programs from a local directory indefinitely.</p>\n\n<h1>One-time <code>.crt</code> and <code>.key</code> generation</h1>\n\n<p>This is an abridged, slightly streamlined version of the steps specified in Daksh Shah's Medium article, <a href=\"https://medium.freecodecamp.org/how-to-get-https-working-on-your-local-development-environment-in-5-minutes-7af615770eec\" rel=\"nofollow noreferrer\">How to get HTTPS working on your local development environment in 5 minutes</a>, which will work on a Mac.</p>\n\n<p>In the directory where you want your <code>server.crt</code> and <code>server.key</code> files, create the two configuration files</p>\n\n<h2><code>server.csr.cnf</code></h2>\n\n<pre><code>[req]\ndefault_bits = 2048\nprompt = no\ndefault_md = sha256\ndistinguished_name = dn\n\n[dn]\nC=US\nST=RandomState\nL=RandomCity\nO=RandomOrganization\nOU=RandomOrganizationUnit\nemailAddress=hello@example.com\nCN = localhost\n</code></pre>\n\n<p>and</p>\n\n<h2><code>v3.ext</code></h2>\n\n<pre><code>authorityKeyIdentifier=keyid,issuer\nbasicConstraints=CA:FALSE\nkeyUsage = digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment\nsubjectAltName = @alt_names\n\n[alt_names]\nDNS.1 = localhost\nIP.1 = 127.0.0.1\n</code></pre>\n\n<p>Then enter the following commands in that directory</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>openssl genrsa -des3 -out rootCA.key 2048 \n# create a passphrase\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>openssl req -x509 -new -nodes -key rootCA.key -sha256 -days 1024 -out rootCA.pem -config server.csr.cnf\n# enter passphrase\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>openssl req -new -sha256 -nodes -out server.csr -newkey rsa:2048 -keyout server.key -config server.csr.cnf\n</code></pre>\n\n<pre class=\"lang-sh prettyprint-override\"><code>openssl x509 -req -in server.csr -CA rootCA.pem -CAkey rootCA.key -CAcreateserial -out server.crt -days 500 -sha256 -extfile v3.ext\n# enter passphrase\n</code></pre>\n\n<p>Finally, make your system trust the certificate you used to sign the files by running </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>open rootCA.pem\n</code></pre>\n\n<p>This should open the certificate in the Keychain Acces app, where it will be found in the section <em>Certificates</em> and named <code>localhost</code>. Then to <strong>Always Trust</strong> it</p>\n\n<ul>\n<li>Press enter to open its window</li>\n<li>Press space to twirl down <em>Trust</em></li>\n<li>Change \"When using this certificate:\" to <em>Always Trust</em></li>\n<li>Close the window and authenticate your decision</li>\n</ul>\n\n<p><strong>Note:</strong> I have tried many permutations of <code>security add-trusted-cert</code> from the command line and, despite the fact that it adds the cert to the keychain and marks it as \"Always Trust\", my Go programs just won't trust it. Only the GUI method puts the system in a state that my Go programs will trust the cert.</p>\n\n<p>Any Go programs you run locally using HTTPS will now trust servers you run using <code>server.crt</code> and <code>server.key</code>.</p>\n\n<h1>Running the server</h1>\n\n<p>You can create <code>*httptest.Server</code> instances that use these credentials with</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func NewLocalHTTPSTestServer(handler http.Handler) (*httptest.Server, error) {\n    ts := httptest.NewUnstartedServer(handler)\n    cert, err := tls.LoadX509KeyPair(\"server.crt\", \"server.key\")\n    if err != nil {\n        return nil, err\n    }\n    ts.TLS = &amp;tls.Config{Certificates: []tls.Certificate{cert}}\n    ts.StartTLS()\n    return ts, nil\n}\n</code></pre>\n\n<p>Here is an example usage:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestLocalHTTPSserver(t *testing.T) {\n    ts, err := NewLocalHTTPSTestServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fmt.Fprint(w, \"Hello, client\")\n    }))\n    assert.Nil(t, err)\n    defer ts.Close()\n\n    res, err := http.Get(ts.URL)\n    assert.Nil(t, err)\n\n    greeting, err := ioutil.ReadAll(res.Body)\n    res.Body.Close()\n    assert.Nil(t, err)\n\n    assert.Equal(t, \"Hello, client\", string(greeting))\n}\n</code></pre>\n"}], "owner": {"reputation": 14367, "user_id": 130427, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/6gMyw.jpg?s=128&g=1", "display_name": "Chris Redford", "link": "https://stackoverflow.com/users/130427/chris-redford"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1024, "favorite_count": 0, "accepted_answer_id": 54955508, "answer_count": 1, "score": 2, "last_activity_date": 1551507156, "creation_date": 1551249896, "last_edit_date": 1551250593, "question_id": 54899550, "link": "https://stackoverflow.com/questions/54899550/create-https-test-server-for-any-client", "title": "Create HTTPS test server for any client", "body": "<p>The server created by <a href=\"https://tip.golang.org/pkg/net/http/httptest/#example_NewTLSServer\" rel=\"nofollow noreferrer\">NewTLSServer</a> can validate calls for a client that is explicitly created from it:</p>\n\n<pre><code>ts := httptest.NewTLSServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Hello, client\")\n}))\ndefer ts.Close()\n\nclient := ts.Client()\nres, err := client.Get(ts.URL)\n</code></pre>\n\n<p>in the line <code>client := ts.Client()</code>.</p>\n\n<p>However, I have a production program that I want to set to use <code>ts.URL</code> as its host. I am getting</p>\n\n<pre><code>x509: certificate signed by unknown authority\n</code></pre>\n\n<p>errors when I call it.</p>\n\n<p>How can I set <code>ts</code> up to authenticate with the client like a normal HTTPS server?</p>\n"}, {"tags": ["pointers", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1551245884, "post_id": 54898660, "comment_id": 96565463, "body": "You need to loop over <code>[]*ProductPrice</code>, i.e. pointers, to be able to modify them, else what you see inside the loop is a copy of each slice element as you already know. Or use indexing <code>productPrices[i].UnitPrice = ...</code>."}, {"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551246271, "post_id": 54898660, "comment_id": 96565587, "body": "@mkopriva could you show me an example? I&#39;m not sure how to refactor to what you suggest?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551246631, "post_id": 54898660, "comment_id": 96565689, "body": "<a href=\"https://play.golang.com/p/vIumBqIVmh8\" rel=\"nofollow noreferrer\">play.golang.com/p/vIumBqIVmh8</a> or <a href=\"https://play.golang.com/p/ST2qb0-JYC6\" rel=\"nofollow noreferrer\">play.golang.com/p/ST2qb0-JYC6</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551247246, "post_id": 54898660, "comment_id": 96565867, "body": "@mkopriva Your comments belong in an answer."}], "answers": [{"comments": [{"owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "edited": false, "score": 1, "creation_date": 1551259304, "post_id": 54900408, "comment_id": 96571115, "body": "Thanks for your guidance! Works perfectly."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1551253486, "creation_date": 1551253486, "answer_id": 54900408, "question_id": 54898660, "link": "https://stackoverflow.com/questions/54898660/loop-over-a-slice-of-structs-and-update-value/54900408#54900408", "title": "Loop over a slice of structs and update value", "body": "<p>Anytime you're dealing with values that you know you'll need to modify, it is best, at least in my opinion, to use pointers. They'll make your life easier.</p>\n\n<p>So instead of:</p>\n\n<pre><code>func getProductPricesFromDatabase(instance string) []ProductPrice {\n    // ...\n    var productPrices []ProductPrice\n\n    for rows.Next() {\n        var product = ProductPrice{}\n\n        // ...\n    }    \n    return productPrices\n}\n</code></pre>\n\n<p>I would recommend you refactor your code to:</p>\n\n<pre><code>func getProductPricesFromDatabase(instance string) []*ProductPrice {\n    // ...\n    var productPrices []*ProductPrice\n\n    for rows.Next() {\n        var product = new(ProductPrice)\n\n        // ...\n    }    \n    return productPrices\n}\n</code></pre>\n\n<p>Now do the same with <code>getContractProductPricesFromDatabase</code> and finally update the argument types to your <code>processProductPricesFromDatabase</code> function:</p>\n\n<pre><code>func processProductPricesFromDatabase(productPrices []*ProductPrice, contractProductPrices []*ContractProductPrice) []*ProductPrice {\n    // Loop over contact prices and update relevant product prices\n    for _, contractPrice := range contractProductPrices {\n        for _, product := range productPrices {\n            if contractPrice.AppliesTo == product.Sku {\n                product.UnitPrice = contractPrice.PricingAdjustmentValue\n            }\n        }\n    }\n    return productPrices\n}\n</code></pre>\n\n<hr>\n\n<p>As an alternative, if you want to keep using non-pointer types, you can directly modify the values referenced by the slice by indexing into it.</p>\n\n<pre><code>func processProductPricesFromDatabase(productPrices []ProductPrice, contractProductPrices []ContractProductPrice) []ProductPrice {\n    // Loop over contact prices and update relevant product prices\n\n    for _, contractPrice := range contractProductPrices {\n\n        for i, _ := range productPrices {\n            if contractPrice.AppliesTo == productPrices[i].Sku {\n                productPrices[i].UnitPrice = contractPrice.PricingAdjustmentValue\n            }\n        }\n    }\n\n    return productPrices\n}\n</code></pre>\n"}], "owner": {"reputation": 13599, "user_id": 1739852, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f706bb09511d498a29b2c2264dc37f9f?s=128&d=identicon&r=PG", "display_name": "James", "link": "https://stackoverflow.com/users/1739852/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 617, "favorite_count": 0, "accepted_answer_id": 54900408, "answer_count": 1, "score": 0, "last_activity_date": 1551253486, "creation_date": 1551245627, "question_id": 54898660, "link": "https://stackoverflow.com/questions/54898660/loop-over-a-slice-of-structs-and-update-value", "title": "Loop over a slice of structs and update value", "body": "<p>I am getting data from source A and storing it in a slice of structs like so:</p>\n\n<pre><code>type ProductPrice struct {\n    Type          string\n    Sku           string\n    UnitPrice     string\n    PriceList     string\n    standardPrice string\n    specialPrice  string\n    specialStart  string\n    specialEnd    string\n    pricingUnit   string\n    categoryCode  string\n    isOnSpecial   bool\n}\n\nfunc getProductPricesFromDatabase(instance string) []ProductPrice {\n    rows, err := myDBConnection.Query(// My query here)\n\n    if err != nil {\n        log.Fatal(\"There was an issue with the query for product price: \", err)\n    }\n\n    defer rows.Close()\n\n    var productPrices []ProductPrice\n\n    for rows.Next() {\n        var product = ProductPrice{}\n        err := rows.Scan(\n            &amp;product.Type,\n            &amp;product.Sku,\n            &amp;product.standardPrice,\n            &amp;product.specialPrice,\n            &amp;product.specialStart,\n            &amp;product.specialEnd,\n            &amp;product.pricingUnit,\n            &amp;product.PriceList,\n            &amp;product.categoryCode,\n        )\n        if err != nil {\n            log.Fatal(\"product price scan error: \", err)\n        }\n\n        productPrices = append(productPrices, product)\n    }\n\n    return productPrices\n}\n</code></pre>\n\n<p>I am then getting some data from source B and storing it in a slice of structs like so:</p>\n\n<pre><code>type ContractProductPrice struct {\n    CustID                 string\n    PriceBy                string\n    AppliesTo              string\n    PriceList              string\n    StartDate              string\n    EndDate                string\n    PricingAdjustmentType  string\n    PricingAdjustmentValue string\n    UseLowest              string\n}\n\nfunc getContractProductPricesFromDatabase(instance string) []ContractProductPrice {\n    rows, err := myDBConnection.Query(// My query here)\n\n    if err != nil {\n        log.Fatal(\"There was an issue with the query for contract product price: \", err)\n    }\n\n    defer rows.Close()\n\n    var contractProductPrices []ContractProductPrice\n\n    for rows.Next() {\n        var product = ContractProductPrice{}\n        err := rows.Scan(\n            &amp;product.CustID,\n            &amp;product.PriceBy,\n            &amp;product.AppliesTo,\n            &amp;product.PriceList,\n            &amp;product.StartDate,\n            &amp;product.EndDate,\n            &amp;product.PricingAdjustmentType,\n            &amp;product.PricingAdjustmentValue,\n            &amp;product.UseLowest,\n        )\n        if err != nil {\n            log.Fatal(\"contract product price scan error: \", err)\n        }\n        contractProductPrices = append(contractProductPrices, product)\n    }\n\n    return contractProductPrices\n}\n</code></pre>\n\n<p>After getting the data from source B, I am wanting to update the slice of structs from source A with some data from source B.</p>\n\n<pre><code>productPrices := getProductPricesFromDatabase(instance)\ncontractProductPrices := getContractProductPricesFromDatabase(instance)\n\nprocessedProductPrices := processProductPricesFromDatabase(productPrices, contractProductPrices)\n\nfunc processProductPricesFromDatabase(productPrices []ProductPrice, contractProductPrices []ContractProductPrice) []ProductPrice {\n    // Loop over contact prices and update relevant product prices\n    for _, contractPrice := range contractProductPrices {\n        for _, product := range productPrices {\n            if contractPrice.AppliesTo == product.Sku {\n                product.UnitPrice = contractPrice.PricingAdjustmentValue\n            }\n        }\n    }\n\n    return productPrices\n}\n</code></pre>\n\n<p>However, after this runs, the unit prices in <code>processedProductPrices</code> is still empty.</p>\n\n<p>From my searching, I understand what the issue is; Go passes by value and so I am not updating the original memory address and so the values are not changing.\nHowever, I do not understand/know what I need to change to fix this given I am working with a slice of structs rather than a simpler example of a slice of number/strings etc.</p>\n\n<p>How can I update <code>productPrices</code> so that when I return it, <code>processedProductPrices</code> is equal to the updated <code>productPrices</code> slice of structs?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 40344, "user_id": 1796579, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14d3685f0765c738fd90c7ec71fa9ba?s=128&d=identicon&r=PG", "display_name": "Henry", "link": "https://stackoverflow.com/users/1796579/henry"}, "edited": false, "score": 1, "creation_date": 1551244615, "post_id": 54898365, "comment_id": 96565089, "body": "If you are asking if it can be done the answer is &quot;yes&quot;. If you ask what should be done the answer is opinion based and therefore out of scope."}], "answers": [{"tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 8, "last_activity_date": 1594048193, "last_edit_date": 1594048193, "creation_date": 1551244414, "answer_id": 54898436, "question_id": 54898365, "link": "https://stackoverflow.com/questions/54898365/do-you-think-you-can-do-reuse-of-err-variables/54898436#54898436", "title": "Do you think you can do reuse of err variables?", "body": "<p>Its very common to reuse <code>err</code> variable especially with the s<em>hort variable declaration</em> format.<br />\nMostly when you get an <code>err</code> at any point, you handle that and return/panic immediately.</p>\n<p>So if you have code like:</p>\n<pre><code>func foo() error{\n   a, err := f1()\n   if err != nil{\n     return err\n   }\n\n   //... do something with a\n\n  //if we are here we know err is nil, so we can reuse it easily without any information getting lost\n  b, err := f2()\n  if err != nil{\n    return err\n  }\n   //... do something with b\n\n  return nil\n}\n</code></pre>\n<p>then its very ok to reuse <code>err</code></p>\n"}], "owner": {"reputation": 97, "user_id": 2400477, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b9b8b78e6c512179cef4c57e57d1873?s=128&d=identicon&r=PG", "display_name": "junpayment", "link": "https://stackoverflow.com/users/2400477/junpayment"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1134, "favorite_count": 0, "closed_date": 1551256596, "accepted_answer_id": 54898436, "answer_count": 1, "score": 1, "last_activity_date": 1594048193, "creation_date": 1551243923, "question_id": 54898365, "link": "https://stackoverflow.com/questions/54898365/do-you-think-you-can-do-reuse-of-err-variables", "closed_reason": "Opinion-based", "title": "Do you think you can do reuse of err variables?", "body": "<p>For example, in such cases the err variable will finish its role soon on the spot, so I do not think it is necessary to define multiple names.</p>\n\n<pre><code>package main\n\nfunc main() {\n    foo, errFoo := foo()\n    if errFoo != nil {\n        panic(errFoo)\n    }\n\n    bar, errBar := bar()\n    if errBar != nil {\n        panic(errFoo)\n    }\n}\n</code></pre>\n\n<p>So I change the code as follows.</p>\n\n<pre><code>package main\n\nfunc main() {\n    foo, err := foo()\n    if err != nil {\n        panic(err)\n    }\n\n    bar, err := bar()\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>What kind of rules do you guys do?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 1, "last_activity_date": 1551254853, "creation_date": 1551254853, "answer_id": 54900733, "question_id": 54897213, "link": "https://stackoverflow.com/questions/54897213/how-to-pass-flag-values-to-subcommands-in-golang-urfave-cli/54900733#54900733", "title": "How to pass flag values to subcommands in golang urfave cli", "body": "<p>Each command can optionally specify a 'subcommand'. The subcommand is of type <code>Command</code>, which allows for nested / composing commands together.</p>\n\n<p>To achieve something like:</p>\n\n<pre><code>cli-tool command1 command2 --command2flag\n</code></pre>\n\n<p>you could have a commands structure like:</p>\n\n<pre><code>app := &amp;cli.App{\n    //...\n    Commands: []*cli.Command{\n      {\n        Name:    \"command1\",\n        Usage:   // ...\n        Action:  //...\n        SubCommand: []cli.Command{\n           {\n               Name: \"command2\"\n               Flags: []cli.Flag{\n                  cli.StringFlag{\n                     Name: \"command2flag\"\n                     // ...\n                  },\n               },\n           },\n        },\n      },\n    //...\n    }\n\n</code></pre>\n\n<p>You can see here that command2 is nested in command1's subcommands. And the flags for command2 will only apply to command2. This is an example of a local flag.</p>\n\n<p>Global flags would apply to <em>every</em> command and subcommand. This could be useful for somekind of config that the cli tool might need to use for all commands. e.g. the server address to talk to etc.</p>\n"}], "owner": {"reputation": 23, "user_id": 10943948, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9f85L.png?s=128&g=1", "display_name": "caesarchad", "link": "https://stackoverflow.com/users/10943948/caesarchad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 979, "favorite_count": 0, "accepted_answer_id": 54900733, "answer_count": 1, "score": 1, "last_activity_date": 1551254853, "creation_date": 1551235214, "question_id": 54897213, "link": "https://stackoverflow.com/questions/54897213/how-to-pass-flag-values-to-subcommands-in-golang-urfave-cli", "title": "How to pass flag values to subcommands in golang urfave cli", "body": "<p>I am using urfave at <a href=\"https://github.com/urfave/cli\" rel=\"nofollow noreferrer\">https://github.com/urfave/cli</a>\nto create a CLI with two subcommands.\nI am able to create a CLI with a subcommand,\nbut I really have no idea how to define the flags.\nWhat's the difference between the global flag and local flag?</p>\n"}, {"tags": ["node.js", "go", "grpc", "grpc-node"], "answers": [{"comments": [{"owner": {"reputation": 1180, "user_id": 2857193, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1PnWH.jpg?s=128&g=1", "display_name": "James Tan", "link": "https://stackoverflow.com/users/2857193/james-tan"}, "edited": false, "score": 0, "creation_date": 1590918380, "post_id": 54897597, "comment_id": 109857402, "body": "does this work with localhost? if we use localhost, do we need to add port number to the simple-host ?"}, {"owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "reply_to_user": {"reputation": 1180, "user_id": 2857193, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1PnWH.jpg?s=128&g=1", "display_name": "James Tan", "link": "https://stackoverflow.com/users/2857193/james-tan"}, "edited": false, "score": 0, "creation_date": 1591118172, "post_id": 54897597, "comment_id": 109932206, "body": "@JamesTan I would think so, because it needs a hostname. If you can resolve localhost to the desired ip address, you should be good. Also, the certs should use &quot;localhost&quot; and not the ip address"}, {"owner": {"reputation": 1180, "user_id": 2857193, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/1PnWH.jpg?s=128&g=1", "display_name": "James Tan", "link": "https://stackoverflow.com/users/2857193/james-tan"}, "edited": false, "score": 0, "creation_date": 1591334171, "post_id": 54897597, "comment_id": 110021382, "body": "the &lt;IP&gt;:&lt;PORT&gt; need to be the actual destination, which could be localhost, but for the options , we need to specify the tls generated cert domain (simple-host) which could be secure.example.com"}], "tags": [], "owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "is_accepted": true, "score": 2, "last_activity_date": 1551238348, "creation_date": 1551238348, "answer_id": 54897597, "question_id": 54897030, "link": "https://stackoverflow.com/questions/54897030/grpc-golang-server-and-nodejs-client-tls-connect-failed/54897597#54897597", "title": "GRPC Golang Server and NodeJS client. TLS connect failed", "body": "<p>So the issue was that the certificate couldn't hold IP address as the hostname. It should have a name and not an IP - fixed it by providing a name and overriding the target name.</p>\n\n<pre><code>const options = {\n  'grpc.ssl_target_name_override' : 'simple-host',\n  'grpc.default_authority': 'simple-host'\n};\nvar client = new log_proto.LogData('&lt;IP&gt;:&lt;PORT&gt;',ssl_creds,options); \n</code></pre>\n"}], "owner": {"reputation": 605, "user_id": 3691226, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uRnZk.jpg?s=128&g=1", "display_name": "Tjs", "link": "https://stackoverflow.com/users/3691226/tjs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1026, "favorite_count": 1, "accepted_answer_id": 54897597, "answer_count": 1, "score": 3, "last_activity_date": 1551371834, "creation_date": 1551233719, "last_edit_date": 1551371834, "question_id": 54897030, "link": "https://stackoverflow.com/questions/54897030/grpc-golang-server-and-nodejs-client-tls-connect-failed", "title": "GRPC Golang Server and NodeJS client. TLS connect failed", "body": "<p>Everything works fine when I don't use TLS. But when I do, it does not connect. More details:</p>\n\n<p>I have configured the Golang GRPC server exactly like how this blog says <a href=\"https://bbengfort.github.io/programmer/2017/03/03/secure-grpc.html\" rel=\"nofollow noreferrer\">https://bbengfort.github.io/programmer/2017/03/03/secure-grpc.html</a> in Mutual TLS with Certificate Authority section. The server is up and running just fine. </p>\n\n<p>Now I have a client written in NodeJS, trying to send some data through grpc. I have configured the NodeJS like below:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>var PROTO_PATH = __dirname + '/protos/log.proto';\r\nvar grpc = require('grpc');\r\nvar protoLoader = require('@grpc/proto-loader');\r\nvar packageDefinition = protoLoader.loadSync(\r\n    PROTO_PATH,\r\n    {keepCase: true,\r\n     longs: String,\r\n     enums: String,\r\n     defaults: true,\r\n     oneofs: true\r\n    });\r\n    \r\nvar ssl_creds = grpc.credentials.createSsl(fs.readFileSync('ssl/ca.crt'), fs.readFileSync('ssl/client.key'), fs.readFileSync('ssl/client.crt'));\r\n\r\nvar log_proto = grpc.loadPackageDefinition(packageDefinition).log;\r\nvar client = new log_proto.LogData('&lt;IP&gt;:&lt;PORT&gt;',ssl_creds); </code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I created the certificates like how it is mentioned here: <a href=\"https://github.com/grpc/grpc/issues/6757\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/issues/6757</a>. Ofcourse, i did see this comment: <a href=\"https://github.com/grpc/grpc/issues/6757#issuecomment-264617793\" rel=\"nofollow noreferrer\">https://github.com/grpc/grpc/issues/6757#issuecomment-264617793</a>. </p>\n\n<p>I am still seeing the error when I run NodeJS client:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>{ Error: 14 UNAVAILABLE: Connect Failed\r\nat Object.exports.createStatusError (/app/node_modules/grpc/src/common.js:91:15)\r\nat Object.onReceiveStatus (/app/node_modules/grpc/src/client_interceptors.js:1204:28)\r\nat InterceptingListener._callNext (/app/node_modules/grpc/src/client_interceptors.js:568:42)\r\nat InterceptingListener.onReceiveStatus (/app/node_modules/grpc/src/client_interceptors.js:618:8)\r\nat callback (/app/node_modules/grpc/src/client_interceptors.js:845:24)\r\ncode: 14,\r\nmetadata: Metadata { _internal_repr: {} },\r\ndetails: 'Connect Failed' }</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Certificate details:\nSSLv3\nTLSv1.2</p>\n\n<p>EDIT:</p>\n\n<p>I added env variable GRPC_VERBOSITY as DEBUG and found the following: <code>Peer name &lt;IP&gt; is not in peer certificate</code></p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551280715, "post_id": 54896988, "comment_id": 96584366, "body": "The <a href=\"https://golang.org/pkg/expvar/\" rel=\"nofollow noreferrer\"><code>expvar</code></a> package is available specifically for in-app metrics."}], "answers": [{"tags": [], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "is_accepted": false, "score": 3, "last_activity_date": 1551235532, "creation_date": 1551235532, "answer_id": 54897245, "question_id": 54896988, "link": "https://stackoverflow.com/questions/54896988/count-number-of-queries-on-database-in-golang/54897245#54897245", "title": "Count number of queries on database in Golang?", "body": "<p>No easy solution that I'm aware of.</p>\n\n<p>You could wrap your db in your own struct, and then implement <code>Exec()</code> or whichever function you use directly on that struct. Your function would just call the database one, and count it however you see fit.</p>\n\n<p>A similar example, but with a logger, can be found here:\n<a href=\"https://stackoverflow.com/questions/29270501/how-to-log-queries-to-database-drivers\">How to log queries to database drivers?</a></p>\n"}, {"comments": [{"owner": {"reputation": 7007, "user_id": 10195153, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VnLka.jpg?s=128&g=1", "display_name": "danblack", "link": "https://stackoverflow.com/users/10195153/danblack"}, "edited": false, "score": 0, "creation_date": 1551240136, "post_id": 54897790, "comment_id": 96564080, "body": "Also see <a href=\"http://brendanjryan.com/golang/profiling/2018/02/28/profiling-go-applications.html\" rel=\"nofollow noreferrer\">flame graphs in go programs</a>. You&#39;ll quickly see calls in the go application that are waiting on SQL responses but also see time consuming areas of your application."}], "tags": [], "owner": {"reputation": 7007, "user_id": 10195153, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VnLka.jpg?s=128&g=1", "display_name": "danblack", "link": "https://stackoverflow.com/users/10195153/danblack"}, "is_accepted": false, "score": 4, "last_activity_date": 1551239632, "creation_date": 1551239632, "answer_id": 54897790, "question_id": 54896988, "link": "https://stackoverflow.com/questions/54896988/count-number-of-queries-on-database-in-golang/54897790#54897790", "title": "Count number of queries on database in Golang?", "body": "<p>In order to find bottlenecks I would suggest going straight to the MySQL database and enabling the slow query log and slowly setting the <a href=\"https://dev.mysql.com/doc/refman/5.7/en/server-system-variables.html#sysvar_long_query_time\" rel=\"nofollow noreferrer\">long_query_time</a> down to a low millisecond value.</p>\n\n<p>Use tools like <a href=\"https://www.percona.com/doc/percona-toolkit/LATEST/pt-query-digest.html\" rel=\"nofollow noreferrer\">pt-query-digest</a> to help digest these to get a frequency of like queries. Attack those as slow queries that need fixing and then set a lower value.</p>\n\n<p>The actual count of the queries on each isn't actually that useful.</p>\n\n<p>When attacking the problem from a go point of view measuring the API response time of each interface will help you look holisticly at the service.</p>\n"}], "owner": {"reputation": 145, "user_id": 3935590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cbb84d74dbde1c9f6595498b20394c96?s=128&d=identicon&r=PG&f=1", "display_name": "wellthatssomething", "link": "https://stackoverflow.com/users/3935590/wellthatssomething"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1551239632, "creation_date": 1551233454, "question_id": 54896988, "link": "https://stackoverflow.com/questions/54896988/count-number-of-queries-on-database-in-golang", "title": "Count number of queries on database in Golang?", "body": "<p>I am attempting to count the number of queries that are run against the database in a request against my Golang API server. This is in order to optimize + find bottlenecks in our API.</p>\n\n<p>An example of how to do this in Django is <a href=\"https://stackoverflow.com/questions/19556139/get-sql-query-count-during-a-django-shell-session\">here</a>.</p>\n\n<p>Any idea if there is a simple way to do this in Golang?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1551229004, "post_id": 54896411, "comment_id": 96561776, "body": "Yes, <code>go get</code> will automatically fetch packages using import statements.  Yes, the module system will use go.mod files."}, {"owner": {"reputation": 605, "user_id": 2453393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jwMD1.jpg?s=128&g=1", "display_name": "Dan Sherwin", "link": "https://stackoverflow.com/users/2453393/dan-sherwin"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551231089, "post_id": 54896411, "comment_id": 96562154, "body": "Thank you ThunderCat.  So knowing that, would you say it would probably be good practice to not use many dependencies unless really needed?  For example, I was about to get and install Logrus to do some debug logging which could be turned off when published but it would still be a dependency and so would still be fetched, even though in production it wouldnt be used. So probably not a good practice to use something like that would you say?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1551232110, "post_id": 54896411, "comment_id": 96562370, "body": "That&#39;s a matter of opinion. Given <a href=\"https://godoc.org/github.com/sirupsen/logrus?importers\" rel=\"nofollow noreferrer\">the number of packages that import Logrus</a>, many package authors have no issue with the dependency.  I personally would try to make do with the standard log package rather than adding the dependency."}, {"owner": {"reputation": 605, "user_id": 2453393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jwMD1.jpg?s=128&g=1", "display_name": "Dan Sherwin", "link": "https://stackoverflow.com/users/2453393/dan-sherwin"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551232389, "post_id": 54896411, "comment_id": 96562434, "body": "Yep.  I agree, and is what I have done here, just needed the validation for my thought process and you provided that.  Thank you sir for your help.  Greatly appreciated."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 8768906, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eOPws.jpg?s=128&g=1", "display_name": "Lucas Henrique", "link": "https://stackoverflow.com/users/8768906/lucas-henrique"}, "is_accepted": false, "score": 0, "last_activity_date": 1551298888, "creation_date": 1551298888, "answer_id": 54913858, "question_id": 54896411, "link": "https://stackoverflow.com/questions/54896411/publishing-golang-package-and-dependencies/54913858#54913858", "title": "Publishing Golang Package and dependencies", "body": "<p>No need to worry about this because <code>go get</code> will do it for you.</p>\n"}], "owner": {"reputation": 605, "user_id": 2453393, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/jwMD1.jpg?s=128&g=1", "display_name": "Dan Sherwin", "link": "https://stackoverflow.com/users/2453393/dan-sherwin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1551298888, "creation_date": 1551228832, "last_edit_date": 1551229000, "question_id": 54896411, "link": "https://stackoverflow.com/questions/54896411/publishing-golang-package-and-dependencies", "title": "Publishing Golang Package and dependencies", "body": "<p>How do you deal package dependencies? For example, say I have a package that I want to publish for all to use, and in developing that package I am using 3rd party packages. For this example lets say <code>github.com/gorilla/websocket</code> is one and <code>github.com/sirupsen/logrus</code> is another one. Will the go tools automatically see my \u201cincludes\u201d and go get these packages? Do I have to put it my description that you need to have these installed before my package will work? Should I include them in my own sources somehow (which I doubt but not leaving anything out)? What is the recommended way to handle this? One thing to note is that I am using the Go 1.11 modules system so I do have my dependencies listed in my go.mod file. Is that enough?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3126, "user_id": 85010, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/5a1b964e34cc2b1d3e233fa387b791b0?s=128&d=identicon&r=PG", "display_name": "fiskeben", "link": "https://stackoverflow.com/users/85010/fiskeben"}, "is_accepted": true, "score": 2, "last_activity_date": 1551361692, "last_edit_date": 1551361692, "creation_date": 1551278856, "answer_id": 54908067, "question_id": 54896077, "link": "https://stackoverflow.com/questions/54896077/how-to-get-list-of-dns-servers-for-system-resolver/54908067#54908067", "title": "How to get list of DNS servers for system resolver", "body": "<p>The <a href=\"https://golang.org/pkg/net/#Resolver\" rel=\"nofollow noreferrer\">Resolver type</a> in the <code>net</code> package lets you resolve DNS names but it doesn't seem to export the DNS servers it uses.</p>\n\n<p><a href=\"https://github.com/ruby/ruby/blob/trunk/lib/resolv.rb#L983\" rel=\"nofollow noreferrer\">Ruby parses <code>/etc/resolv.conf</code></a> so I guess you'll have to do that yourself or see if you can find a package that does it for you.</p>\n\n<p><em>Update: I made <a href=\"https://github.com/fiskeben/resolv\" rel=\"nofollow noreferrer\">a small library</a> to do sort of the same as Ruby's DNS class. Hope it helps.</em></p>\n"}], "owner": {"reputation": 472, "user_id": 1749063, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95a062888a771d43986f20df9250e82d?s=128&d=identicon&r=PG", "display_name": "Stanislav German-Evtushenko", "link": "https://stackoverflow.com/users/1749063/stanislav-german-evtushenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "accepted_answer_id": 54908067, "answer_count": 1, "score": 0, "last_activity_date": 1578387832, "creation_date": 1551225737, "last_edit_date": 1578387832, "question_id": 54896077, "link": "https://stackoverflow.com/questions/54896077/how-to-get-list-of-dns-servers-for-system-resolver", "title": "How to get list of DNS servers for system resolver", "body": "<p>In Ruby I can get the list of DNS servers like this:</p>\n\n<pre><code>require 'resolv'\nResolv::DNS::Config.default_config_hash[:nameserver]\n</code></pre>\n\n<p>How to do the same in Go?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1551224514, "post_id": 54895793, "comment_id": 96560759, "body": "Do you have to capture <code>MYSTRING=</code> and then use a backreference in the replacement pattern? Can you hardcode <code>MYSTRING=</code>?"}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1551224870, "post_id": 54895793, "comment_id": 96560865, "body": "Yes I can hardcore <code>MYSTRING=</code>."}, {"owner": {"reputation": 8643, "user_id": 1718554, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/n3jD1.jpg?s=128&g=1", "display_name": "Luke Joshua Park", "link": "https://stackoverflow.com/users/1718554/luke-joshua-park"}, "edited": false, "score": 0, "creation_date": 1551225990, "post_id": 54895793, "comment_id": 96561137, "body": "There <a href=\"https://stackoverflow.com/questions/1732348/regex-match-open-tags-except-xhtml-self-contained-tags/1732454#1732454\">comes a time</a> when regular expressions are no longer the best solution to a problem..."}], "answers": [{"comments": [{"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1551226867, "post_id": 54896002, "comment_id": 96561354, "body": "Sorry, I think I might have worded my question a bit too confusingly. I meant to say that I need the <code>MYSTRING=*</code> replaced with <code>MYSTRING=stringofmychoice</code> after a <b>certain</b> string has appeared, not after it has appeared a certain number of times. In the example above, that <b>certain</b> string would be <code>bar</code>. I want to find a string, <code>bar</code>, and change the <code>MYSTRING=*</code> into  <code>MYSTRING=barstring</code> after it."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1551226979, "post_id": 54896002, "comment_id": 96561373, "body": "@thestateofmay That does not change much."}, {"owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1551228206, "post_id": 54896002, "comment_id": 96561621, "body": "Would it be possibly to greedily use the matching between <code>bar</code> and <code>MYSTRING=</code> instead? I&#39;m trying something like <code>re := regexp.MustCompile(&quot;(bar).(MYSTRING=).*&quot;)</code> but it&#39;s not working."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "reply_to_user": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "edited": false, "score": 0, "creation_date": 1551257696, "post_id": 54896002, "comment_id": 96570199, "body": "@thestateofmay <code>re := regexp.MustCompile(&quot;((?s:bar.*?MYSTRING=)).*&quot;)</code>. Not sure what you mean though. If you plan to use it as a 1-regex solution, <a href=\"https://regex101.com/r/L3sXFB/1\" rel=\"nofollow noreferrer\">watch out</a>. Since there is no lookahead support, it is difficult to come up with a working and readable regex for this."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 1, "last_activity_date": 1551227321, "last_edit_date": 1551227321, "creation_date": 1551225151, "answer_id": 54896002, "question_id": 54895793, "link": "https://stackoverflow.com/questions/54895793/golang-regex-match-and-replace-first-occurrence-after-a-certain-string/54896002#54896002", "title": "Golang Regex match and replace first occurrence after a certain string", "body": "<p>You may use <a href=\"https://golang.org/pkg/regexp/#Regexp.ReplaceAllStringFunc\" rel=\"nofollow noreferrer\"><code>ReplaceAllStringFunc</code></a> and use a regex like</p>\n\n<pre><code>(?m)^bar:(?:\\n\\s{4}.*)+\n</code></pre>\n\n<p>See the <a href=\"https://regex101.com/r/GgEMnB/1\" rel=\"nofollow noreferrer\">regex demo</a>. It will match a <code>bar</code> block indented with four whitespaces. Then, after a match is obtained, you may use a regular <code>ReplaceAllString</code> on the match.</p>\n\n<p>See the <a href=\"https://play.golang.org/p/hYdtCMG4ss6\" rel=\"nofollow noreferrer\">Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nconst sample = `foo:\n    blahblah\n    MYSTRING=*\nbar:\n    blah\n    blah\n    MYSTRING=*`\n\nfunc main() {\n    re := regexp.MustCompile(`(?m)^bar:(?:\\n\\s{4}.*)+`)\n    re_2 := regexp.MustCompile(`(MYSTRING=).*`)\n    s := re.ReplaceAllStringFunc(sample, func(m string) string {\n                return re_2.ReplaceAllString(m, `${1}stringofmychoice`)\n        })\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Here, the second occurrence is changed in the <code>bar</code> block:</p>\n\n<pre><code>foo:\n    blahblah\n    MYSTRING=*\nbar:\n    blah\n    blah\n    MYSTRING=stringofmychoice\n</code></pre>\n"}], "owner": {"reputation": 1606, "user_id": 7242490, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/259444dba6bc0f46688d3522a93cd82c?s=128&d=identicon&r=PG&f=1", "display_name": "bli00", "link": "https://stackoverflow.com/users/7242490/bli00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 627, "favorite_count": 0, "accepted_answer_id": 54896002, "answer_count": 1, "score": 1, "last_activity_date": 1551227321, "creation_date": 1551223657, "last_edit_date": 1551224070, "question_id": 54895793, "link": "https://stackoverflow.com/questions/54895793/golang-regex-match-and-replace-first-occurrence-after-a-certain-string", "title": "Golang Regex match and replace first occurrence after a certain string", "body": "<p>Following up on my previous <a href=\"https://stackoverflow.com/questions/54795852/golang-regex-replace-between-strings/54795889#54795889\">question</a> about using Golang's regex to replace between strings. I now have a bit of complexity added to it. Here is what the contexts of my file looks like:</p>\n\n<pre><code>foo:\n    blahblah\n    MYSTRING=*\nbar:\n    blah\n    blah\n    MYSTRING=*\n</code></pre>\n\n<p>I need to replace what's between <code>MYSTRING=</code> and <code>\\n</code> with a string of my choice (like previous stated in the original post). I can do that with:</p>\n\n<pre><code>var re = regexp.MustCompile(`(MYSTRING=).*`)\ns := re.ReplaceAllString(content, `${1}stringofmychoice`)\n</code></pre>\n\n<p>But now I need to match and replace only after a certain occurrence. So that the contents of my file can look something like this:</p>\n\n<pre><code>foo:\n    blahblah\n    MYSTRING=foostring\nbar:\n    blah\n    blah\n    MYSTRING=barstring\n</code></pre>\n\n<p><code>ReplaceAllString</code> obviously replaces everything, which is not what I want. Is there a way to only match and replace the first occurrence after a certain string?</p>\n\n<hr>\n\n<p>For a bit of background about all of this. I'm trying to write a program to edit the contents of a given <code>docker-compose.yml</code> file and its environment variables. I need to edit the environment variable <code>MYSTRING</code> differently depending on what service it's listed under. In the example above, the two different services would be <code>foo</code> and <code>bar</code>.</p>\n"}, {"tags": ["go", "serverless-framework"], "answers": [{"comments": [{"owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "edited": false, "score": 1, "creation_date": 1551221818, "post_id": 54894748, "comment_id": 96559925, "body": "Will that however push go dependencies into my projects folder? I have a number of non-Go projects in that Projects folder. What I\u2019m attempting to do is have a Go base where dependencies are installed then setup workspaces for each project as needed. Does that make much sense?"}, {"owner": {"reputation": 1348, "user_id": 1363520, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/dd01041b737eca45a9c5d01d234d3b9c?s=128&d=identicon&r=PG", "display_name": "Som Poddar", "link": "https://stackoverflow.com/users/1363520/som-poddar"}, "reply_to_user": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "edited": false, "score": 0, "creation_date": 1551376767, "post_id": 54894748, "comment_id": 96627672, "body": "GOPATH is relative and should help resolve dependencies for exported paths. Have one workspace and point the <code>gopath</code> to it. Git clone as many projects as you want under the workspace. Any standard dependency manager can pick up from there (like <code>dep</code>)."}], "tags": [], "owner": {"reputation": 1348, "user_id": 1363520, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/dd01041b737eca45a9c5d01d234d3b9c?s=128&d=identicon&r=PG", "display_name": "Som Poddar", "link": "https://stackoverflow.com/users/1363520/som-poddar"}, "is_accepted": false, "score": 0, "last_activity_date": 1551218036, "creation_date": 1551218036, "answer_id": 54894748, "question_id": 54894526, "link": "https://stackoverflow.com/questions/54894526/installing-serverless-with-aws-go-dep-not-working/54894748#54894748", "title": "Installing serverless with aws-go-dep not working", "body": "<p><a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"nofollow noreferrer\">This documentation</a> can help you to set up Go specific development environment.</p>\n\n<p>In short, you need to set two variables - <code>GOPATH</code> &amp; <code>GOROOT</code>.</p>\n\n<p>Here is what your <code>.profile</code> should look like ...</p>\n\n<pre><code># this is mac os specific\n\nexport GOPATH=$HOME/Projects\n\n# set goroot\nexport GOROOT=/usr/local/opt/go/libexec\n\n# set path\nexport PATH=$PATH:$GOPATH/bin\nexport PATH=$PATH:$GOROOT/bin\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "is_accepted": true, "score": 1, "last_activity_date": 1551368548, "creation_date": 1551368548, "answer_id": 54929370, "question_id": 54894526, "link": "https://stackoverflow.com/questions/54894526/installing-serverless-with-aws-go-dep-not-working/54929370#54929370", "title": "Installing serverless with aws-go-dep not working", "body": "<p>To resolve the issue, I ended up giving up on creating a custom workspace and just making my GOPATH point to one consistent folder. GOROOT was pointed to /usr/local/opt/go/libexec (seems to be where Brew installs Go).</p>\n\n<p>Small rant: Go's setup experience is <em>terrible</em>. I get the fact that it's meant to have opinions, but something as simple as workspace placement and setting up paths...this should be taken care of by the installation process and make clearer to the developer installing the build tools. Booo!</p>\n"}, {"tags": [], "owner": {"reputation": 1539, "user_id": 6406690, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HbNWl.jpg?s=128&g=1", "display_name": "Tobiah Rex", "link": "https://stackoverflow.com/users/6406690/tobiah-rex"}, "is_accepted": false, "score": 0, "last_activity_date": 1612917095, "creation_date": 1612917095, "answer_id": 66129271, "question_id": 54894526, "link": "https://stackoverflow.com/questions/54894526/installing-serverless-with-aws-go-dep-not-working/66129271#66129271", "title": "Installing serverless with aws-go-dep not working", "body": "<p>You can make a symlink within <code>$GOPATH/src/github.com/*</code> and point it to your existing project directory.</p>\n<p><strong>Create</strong> the symlink:</p>\n<pre><code>~ &gt;&gt; ln -s $HOME/code/example-project $GOPATH/src/github.com/example-project\n</code></pre>\n<p><strong>Verify</strong> it worked</p>\n<pre><code>~/go/src/github.com &gt;&gt; ls -l\ntotal 0\ndrwxr-xr-x  3 trex  staff  96 Feb  9 10:20 google\nlrwxr-xr-x  1 trex  staff  30 Feb  9 15:58 example-project -&gt; /Users/trex/code/example-project\n</code></pre>\n<p>Now you can go about your business in the <code>example-project</code> with things like</p>\n<pre><code>~ code/example-project &gt;&gt; make \n</code></pre>\n"}], "owner": {"reputation": 1192, "user_id": 1213186, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/d9eabf15c471c4eb5158034e943711ce?s=128&d=identicon&r=PG", "display_name": "ddibiase", "link": "https://stackoverflow.com/users/1213186/ddibiase"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 54929370, "answer_count": 3, "score": 1, "last_activity_date": 1612917095, "creation_date": 1551217092, "question_id": 54894526, "link": "https://stackoverflow.com/questions/54894526/installing-serverless-with-aws-go-dep-not-working", "title": "Installing serverless with aws-go-dep not working", "body": "<p>I'm just getting starting with Golang and Serverless. I've basically gone through these steps on MacOS:</p>\n\n<ol>\n<li>brew install golang</li>\n<li>brew install dep</li>\n<li>npm install -g serverless</li>\n<li>mkdir ~/Projects/testproject</li>\n<li>Added <code>export GOPATH=\"$GOPATH:~/Projects/testproject\"</code> to <code>~/.profile</code></li>\n<li>serverless create -t aws-go-dep -p myservice within the testprojects folder</li>\n<li>Run make and get this weird error:</li>\n</ol>\n\n<pre><code>unable to create lock pkg/dep/sm.lock: Lockfiles must be given as absolute path names\nmake: *** [build] Error 1\n</code></pre>\n\n<p>Not sure what I'm doing wrong. Also I followed the blog article for getting setup with the example: <a href=\"https://serverless.com/blog/framework-example-golang-lambda-support/\" rel=\"nofollow noreferrer\">https://serverless.com/blog/framework-example-golang-lambda-support/</a></p>\n\n<p>According to <code>go env</code> my path is: <code>GOPATH=\":/Users/ddibiase-macbook/go:/Users/ddibiase-macbook/Projects/centive/api\"</code></p>\n\n<p>There isn't much helpful documentation online to get through this :-/</p>\n"}, {"tags": ["json", "go", "openweathermap"], "answers": [{"tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 1, "last_activity_date": 1551220491, "last_edit_date": 1551220491, "creation_date": 1551215140, "answer_id": 54894081, "question_id": 54893668, "link": "https://stackoverflow.com/questions/54893668/go-openweathermap-forecast-return-type/54894081#54894081", "title": "Go openweathermap forecast return type", "body": "<p>Data that you need are already decoded in you <code>w</code> param, but you need to type assert to correct Weather type. In your case because you are using <code>type=5</code> you should use <code>owm.Forecast5WeatherData</code>. Then your main will look like this.</p>\n\n<pre><code>func main() {\n    apiKey := \"XXXX\"\n    w, err := owm.NewForecast(\"5\", \"C\", \"en\", apiKey)\n    if err != nil {\n        log.Fatal(err)\n    }\n    w.DailyByName(\"London\", 3)\n\n    if val, ok := w.ForecastWeatherJson.(*owm.Forecast5WeatherData); ok {\n\n        fmt.Println(val)\n        fmt.Println(val.City)\n        fmt.Println(val.Cnt)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 10381688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mLbqP.png?s=128&g=1", "display_name": "ctrl", "link": "https://stackoverflow.com/users/10381688/ctrl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 54894081, "answer_count": 1, "score": 0, "last_activity_date": 1551220491, "creation_date": 1551213328, "last_edit_date": 1551217308, "question_id": 54893668, "link": "https://stackoverflow.com/questions/54893668/go-openweathermap-forecast-return-type", "title": "Go openweathermap forecast return type", "body": "<p>I am new to go and I am trying to build a little weather app using OpenWeatherMap \nand the go-package by briandowns.</p>\n\n<p>I have no problem with reading the current weather \nbut I have trouble processing the results of the forecast methods.</p>\n\n<pre><code>func main() {\n    apiKey := \"XXXX\"\n    w, err := owm.NewForecast(\"5\", \"C\", \"en\", apiKey)\n    if err != nil {\n        log.Fatal(err)\n    }\n    w.DailyByName(\"London\", 1)\n\n    data := w.ForecastWeatherJson\n    fmt.Println(data)\n}\n</code></pre>\n\n<p>where the apiKey needs to be replaced by a valid one (which one can get for free upon registration).</p>\n\n<p>My problem is to extract the information from the ForecastWeatherJson.\nIt is defined as:</p>\n\n<pre><code>type ForecastWeatherJson interface {\n    Decode(r io.Reader) error\n}\n</code></pre>\n\n<p>in the forecast.go file.</p>\n\n<p>With Decode defined as:</p>\n\n<pre><code>func (f *Forecast5WeatherData) Decode(r io.Reader) error {\n    if err := json.NewDecoder(r).Decode(&amp;f); err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>in forecast5.go.</p>\n\n<p>I really do not know where to start as I did not find a documented example which showed processing the data except for other languages (so I guess it s a go specific problem).\nI saw how it can be done in e.g. python but in the go case the return type is not clear to me.</p>\n\n<p>Any hints or links to examples are appreciated.</p>\n"}, {"tags": ["http", "web", "go", "post", "server"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1551211383, "post_id": 54893097, "comment_id": 96555524, "body": "you don&#39;t check errors from <code>ioutil.WriteFile</code>. You ignore errors from <code>ioutil.ReadAll</code> either. Out of curiosity, does this program ever finish? <code>http.ListenAndServe</code> is blocking isn&#39;t it?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1551212201, "post_id": 54893097, "comment_id": 96555884, "body": "The reason you haven&#39;t found much information about it is because it&#39;s a very unusual way to test something. Tests should be in tests, using the <a href=\"https://golang.org/pkg/testing\" rel=\"nofollow noreferrer\"><code>testing</code></a> package, not in <code>main()</code>. Tests of HTTP services should use <a href=\"https://golang.org/pkg/net/http/httptest\" rel=\"nofollow noreferrer\"><code>httptest</code></a>."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1551212714, "last_edit_date": 1551212714, "creation_date": 1551211699, "answer_id": 54893306, "question_id": 54893097, "link": "https://stackoverflow.com/questions/54893097/how-to-send-http-request-in-golang-to-my-own-server/54893306#54893306", "title": "how to send http request in golang to my own server", "body": "<p>The client code is not executed.  The call<code>http.ListenAndServe(\":8080\", r)</code> runs the server.  The function only returns when there was an error running the server. If the function does return, then <code>log.Fatal</code> will exit the process.</p>\n\n<p>One fix is to run the server in a goroutine.  This will allow main goroutine to continue executing to the client code.</p>\n\n<pre><code>go func() {\n    log.Fatal(http.ListenAndServe(\":8080\", r))\n}()\n</code></pre>\n\n<p>This may not fix the problem because there's no guarantee that server will run before the client makes the request. Fix this issue by creating the listening socket in the main function and running the server in a goroutine. </p>\n\n<pre><code>ln, err := net.Listen(\"tcp\", \":8080\")\nif err != nil {\n    log.Fatal(err)\n}\ngo func() {\n    log.Fatal(http.Serve(ln, r))\n}()\n... client code as before\n</code></pre>\n\n<p>If the goal if this code is testing, then use <a href=\"https://godoc.org/net/http/httptest#Server\" rel=\"nofollow noreferrer\">httptest.Server</a>. The example in the documentation show show to use the test server.</p>\n"}], "owner": {"reputation": 319, "user_id": 5133042, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/126ff3b430c27bf9aca89682b9a26cc4?s=128&d=identicon&r=PG&f=1", "display_name": "11thHeaven", "link": "https://stackoverflow.com/users/5133042/11thheaven"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551212714, "creation_date": 1551210875, "question_id": 54893097, "link": "https://stackoverflow.com/questions/54893097/how-to-send-http-request-in-golang-to-my-own-server", "title": "how to send http request in golang to my own server", "body": "<p>I'm writing a simple webserver in golang that gets/creates/edits/deletes a simple text file. I've written the function handlers and I'd like to test them by sending a request to the appropriate url and checking to see what happens. My code is as below:</p>\n\n<pre><code>func createHandler(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    name := vars[\"name\"]\n    body, _ := ioutil.ReadAll(r.Body)\n    fmt.Fprint(w, name)\n    ioutil.WriteFile(name, []byte(body), 0644)\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/textFiles/{name}\", createHandler).Methods(\"POST\")\n    log.Fatal(http.ListenAndServe(\":8080\", r))\n\n    var url = \"http://localhost:8080/textFiles/testFile.txt\"\n    var text = []byte(`{\"title\":\"this is an example.\"}`)\n    req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(text))\n    if err != nil {\n        panic(err)\n    }\n\n    client := &amp;http.Client{}\n    client.Do(req)\n}\n</code></pre>\n\n<p>Once this code is run, however, no new file is created. I've been googling but I can't find anything on this type of problem, where I'm sending a request to the server that I'm building within the same file. Help appreciated.</p>\n"}, {"tags": ["amazon-web-services", "go"], "comments": [{"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1551208870, "post_id": 54892511, "comment_id": 96554429, "body": "Maybe you can use a dummy call and <code>recover</code>? This way you can at least catch the error on something you know should work in most cases."}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1551211724, "post_id": 54892511, "comment_id": 96555680, "body": "I was also mentally going down this path..  We use the least privilege model though so I&#39;m wondering which service I can make a call to that every account should have access to?"}, {"owner": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 1, "creation_date": 1551220157, "post_id": 54892511, "comment_id": 96559337, "body": "Try getting the user id like <a href=\"https://stackoverflow.com/q/33332050/492773\">stackoverflow.com/q/33332050/492773</a>"}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "reply_to_user": {"reputation": 28120, "user_id": 492773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4c30dea4ed3e1c2efc5e877f1f3c971?s=128&d=identicon&r=PG", "display_name": "kichik", "link": "https://stackoverflow.com/users/492773/kichik"}, "edited": false, "score": 0, "creation_date": 1551221155, "post_id": 54892511, "comment_id": 96559677, "body": "@kichik I ended up testing by listing a known S3 bucket this instance will privedges for. I had the code on hand, but I feel like iam.currentUser as you mentioned would be better."}, {"owner": {"reputation": 3400, "user_id": 6901690, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/d9QRH.png?s=128&g=1", "display_name": "razimbres", "link": "https://stackoverflow.com/users/6901690/razimbres"}, "edited": false, "score": 0, "creation_date": 1551223717, "post_id": 54892511, "comment_id": 96560522, "body": "Check this other question: <a href=\"https://stackoverflow.com/questions/33068055/boto3-python-and-how-to-handle-errors\" title=\"boto3 python and how to handle errors\">stackoverflow.com/questions/33068055/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1551212422, "post_id": 54893441, "comment_id": 96556010, "body": "funny enough, this is exactly what I was trying, but it just prints the invalid access key id that was provided:  // log which AWS API Key is being used \tsvc := s3.New(Sess) \tcredentials, err := svc.Config.Credentials.Get() \tfmt.Printf(&quot;Using Access Key ID: (%v)\\n&quot;, credentials.AccessKeyID)"}, {"owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "edited": false, "score": 0, "creation_date": 1551221241, "post_id": 54893441, "comment_id": 96559713, "body": "Credentials.Get() is just a test that the credentials can be loaded (environment variables, shared config, instance profile, etc). Unfortunately it can&#39;t determine if the credentials are invalid (as far as I know)"}], "tags": [], "owner": {"reputation": 1, "user_id": 11121473, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-DgygVappdWw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcc_ehMp1Atka453GltgpvaVIWWEg/mo/photo.jpg?sz=128", "display_name": "user11121473", "link": "https://stackoverflow.com/users/11121473/user11121473"}, "is_accepted": false, "score": 0, "last_activity_date": 1551212274, "creation_date": 1551212274, "answer_id": 54893441, "question_id": 54892511, "link": "https://stackoverflow.com/questions/54892511/go-aws-testing-for-invalid-login/54893441#54893441", "title": "Go AWS testing for invalid login", "body": "<p>So you would have to check for invalid errors after making a call to aws. Try and use <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/credentials/#Credentials.Get\" rel=\"nofollow noreferrer\">Credentials.Get()</a> and see if <code>err != nil</code></p>\n"}, {"tags": [], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "is_accepted": true, "score": 0, "last_activity_date": 1551388145, "last_edit_date": 1551388145, "creation_date": 1551221576, "answer_id": 54895477, "question_id": 54892511, "link": "https://stackoverflow.com/questions/54892511/go-aws-testing-for-invalid-login/54895477#54895477", "title": "Go AWS testing for invalid login", "body": "<p>Here's what I ended up doing.  Test that credentials are loaded, test a known service such as an S3 bucket this application needs access to.  </p>\n\n<pre><code>// login to AWS\nAWSProfile := \"default\"\nfmt.Printf(\"Using AWS Profile: %v\\n\", instance.Config.AWS.AWSProfile)\nSess, err := session.NewSessionWithOptions(session.Options{\n    Profile: AWSProfile,\n})\nif err != nil {\n    return fmt.Errorf(\"Error logging into AWS: %v\", err.Error())\n}\n\n// attempt to load config (e.g. env variables, shared config, instance profile) \n// log which AWS API Key is being used\nsvc := s3.New(Sess)\ncredentials, err := svc.Config.Credentials.Get()\nif err != nil {\n    return errors.New(\"Error logging into AWS. Check Credentials.\")\n}\nfmt.Printf(\"Using Access Key ID: (%v)\\n\", credentials.AccessKeyID)\nbucketName := \"s3bucketname\"\n\n// test the login can access a typical aws service (s3) and known bucket \nparams := &amp;s3.ListObjectsInput {\n    Bucket: aws.String(bucketName),\n}\nresp, _ := svc.ListObjects(params)\n\nif len(resp.Contents) &lt; 1 {\n    return nil, fmt.Errorf(\"Error logging into AWS. Can not access bucket (%v). Check Credentials.\", bucketName)\n}\n</code></pre>\n"}], "owner": {"reputation": 938, "user_id": 4192486, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/5Rj0W.png?s=128&g=1", "display_name": "buildmaestro", "link": "https://stackoverflow.com/users/4192486/buildmaestro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 426, "favorite_count": 0, "accepted_answer_id": 54895477, "answer_count": 2, "score": 0, "last_activity_date": 1551388145, "creation_date": 1551208331, "question_id": 54892511, "link": "https://stackoverflow.com/questions/54892511/go-aws-testing-for-invalid-login", "title": "Go AWS testing for invalid login", "body": "<p>Using Golang with go-aws-sdk and having some issues catching invalid session credentials.</p>\n\n<p>Using the shared credential files in ~/.aws/{config, credentials}</p>\n\n<pre><code>Sess, err := session.NewSessionWithOptions(session.Options{\n    Profile: instance.Config.AWS.AWSProfile,\n})\n</code></pre>\n\n<p>Works fine when the credentials are valid, but if I use an invalid aws_access_key_id in the credentials file, I need a way to detect this with my AWSLogin() func.</p>\n\n<p>What's happening is any subsequent calls to an AWS service raises a panic when using Sess above. </p>\n\n<p>How can I detect a failed login with the above NewSessionWithOptions() method?</p>\n\n<p>UPDATE: yes, the error type is nil, so the following is of no use:</p>\n\n<pre><code> if err != nil {\n        return nil, fmt.Errorf(\"Error logging into AWS: %v\", err.Error())\n    }\n</code></pre>\n"}, {"tags": ["c++", "go", "swig"], "comments": [{"owner": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1551208493, "post_id": 54892416, "comment_id": 96554230, "body": "my first guess would be <code>PV_DEVICE_API</code>. What is it?"}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "reply_to_user": {"reputation": 61303, "user_id": 4117728, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/66831ed13ffd9c497541220ec45c15c3?s=128&d=identicon&r=PG&f=1", "display_name": "largest_prime_is_463035818", "link": "https://stackoverflow.com/users/4117728/largest-prime-is-463035818"}, "edited": false, "score": 0, "creation_date": 1551208761, "post_id": 54892416, "comment_id": 96554359, "body": "@user463035818  I think you are correct. PV_DEVICE_API is #define PV_DEVICE_API __declspec( dllimport )"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1551208781, "post_id": 54892416, "comment_id": 96554369, "body": "<code>#define __PV_DEVICE_GEV_H__</code> That idenfitifer is reserved. By using it, your programs behaviour will be undefined. You should use another header guard."}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1551209204, "post_id": 54892416, "comment_id": 96554596, "body": "@eerorika Are you suggesting to replace #define _PV_DEVICE_GEV_H with, for example, #define PVDEVICEGEV_H ?"}, {"owner": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1551209303, "post_id": 54892416, "comment_id": 96554632, "body": "@DanielRamsey The latter is not reserved. Should be fine as long as that macro isn&#39;t used by any other file that you include. <code>_PV_DEVICE_GEV_H</code> is reserved just like the original was."}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "reply_to_user": {"reputation": 178960, "user_id": 2079303, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6cf7f63e49a75376e0f761c8abeb6d5a?s=128&d=identicon&r=PG", "display_name": "eerorika", "link": "https://stackoverflow.com/users/2079303/eerorika"}, "edited": false, "score": 0, "creation_date": 1551210375, "post_id": 54892416, "comment_id": 96555120, "body": "@eerorika gotcha, unfortunately I still get the same error after the changes but ill look into this more"}], "owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551207829, "creation_date": 1551207829, "question_id": 54892416, "link": "https://stackoverflow.com/questions/54892416/pvdevicegev-h5-error-syntax-error-in-input1-c-to-go-using-swig", "title": "PvDeviceGEV.h(5) Error: Syntax error in input(1) --- C++ to Go using SWIG", "body": "<p>I get the error described in the question topic. Here are the files below. </p>\n\n<p>PvDeviceGEV.h</p>\n\n<pre><code>  #ifndef __PV_DEVICE_GEV_H__\n  #define __PV_DEVICE_GEV_H__\n  #include \"PvDevice.h\"\n\n  class PV_DEVICE_API PvDeviceGEV : public PvDevice  &lt;- error message points here\n  {\n     public:\n        PvDeviceGEV();\n        virtual ~PvDeviceGEV();\n        PvResult SetStreamDestination( const PvString &amp;aIPAddress, uint16_t aDataPort, uint32_t aChannel = 0 ); \n  };\n #endif // __PV_DEVICE_GEV_H__\n</code></pre>\n\n<p>I have Camera.swigcxx as follows</p>\n\n<pre><code>%module connectionRecovery_module\n%{\n#include \"ConnectionRecovery.h\"\n#include \"PvDevice.h\"\n#include \"PvDeviceGEV.h\"\n%}\n%include \"ConnectionRecovery.h\"\n%include \"PvDevice.h\"\n%include \"PvDeviceGEV.h\"\n</code></pre>\n\n<p>I dont have the .cpp files as they are locked in a DLL. Let me know if you need more information as to how to fix this error. I think I have to adjust the .swigcxx file but I am not sure. Thank you!</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 2, "creation_date": 1551204941, "post_id": 54891678, "comment_id": 96552522, "body": "What is your goal?"}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "reply_to_user": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1551219904, "post_id": 54891678, "comment_id": 96559242, "body": "I want to know why runtime.clone traped successfully. It goes against &quot;kernel expects&quot; obviously."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1551223264, "post_id": 54891678, "comment_id": 96560350, "body": "Go doesn&#39;t use glibc."}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1551232338, "post_id": 54891678, "comment_id": 96562421, "body": "Yes, go runtime.clone invokes syscall as glibc."}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1551891334, "post_id": 54891678, "comment_id": 96809270, "body": "@peterSO It&#39;s more <a href=\"https://stackoverflow.com/a/41721182/1168212\">&quot;yes or no\u2014it depends&quot;</a> situation. OP included source code where dependencies to <code>glibc</code> are defined and asked why they were definded this way and not another"}], "answers": [{"comments": [{"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1552360692, "post_id": 55031403, "comment_id": 96969450, "body": "I had a hope that OP will return. But we have only 2 days left and I think your answer is correct. So: reward for you!"}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1552501846, "post_id": 55031403, "comment_id": 97038273, "body": "I return, a little surprise, i thought nobody will care this post. Now i make it clear that R8, R9, R12 is not for raw clone syscall but for passing parameters to child. This also enhanced my understanding about &quot;The raw clone() system call corresponds more closely to fork(2)&quot;. Thanks."}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "reply_to_user": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "edited": false, "score": 0, "creation_date": 1552577726, "post_id": 55031403, "comment_id": 97072261, "body": "@api I&#39;m glad that you checked answer yourself and cleared my doubts,  because I myself wrote <code>asm</code>  many years ago.  &quot;i thought nobody will care this post&quot; - there are people exists who thinks that this question is very good"}, {"owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "reply_to_user": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1552583325, "post_id": 55031403, "comment_id": 97075981, "body": "@AlexYu stackoverflow is a marvelous place :)"}], "tags": [], "owner": {"reputation": 10230, "user_id": 2427222, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4h1qN.png?s=128&g=1", "display_name": "ymonad", "link": "https://stackoverflow.com/users/2427222/ymonad"}, "is_accepted": true, "score": 7, "last_activity_date": 1551910143, "last_edit_date": 1551910143, "creation_date": 1551902977, "answer_id": 55031403, "question_id": 54891678, "link": "https://stackoverflow.com/questions/54891678/why-golang-clone-syscall-abi-is-diffent-from-linux-kernel-clone-on-x86-64/55031403#55031403", "title": "Why golang clone syscall abi is diffent from linux kernel clone on x86-64", "body": "<h3>Reason why DX and R10 are zero</h3>\n\n<p>According to the <a href=\"http://man7.org/linux/man-pages/man2/clone.2.html\" rel=\"noreferrer\">manpage of clone</a>, these are used only when <code>CLONE_PARENT_SETTID</code>, <code>CLONE_CHILD_SETTID</code> is set.</p>\n\n<blockquote>\n  <p>CLONE_PARENT_SETTID (since Linux 2.5.49)\n                Store the child thread ID at the location ptid in the parent's\n                memory.  (In Linux 2.5.32-2.5.48 there was a flag CLONE_SETTID\n                that did this.)  The store operation completes before clone()\n                returns control to user space.</p>\n  \n  <p>CLONE_CHILD_SETTID (since Linux 2.5.49)\n                Store the child thread ID at the location ctid in the child's\n                memory.  The store operation completes before clone() returns\n                control to user space.</p>\n</blockquote>\n\n<p>DX and R10 corresponds to <code>ptid</code> and <code>ctid</code> in this manpage (<a href=\"http://blog.rchapman.org/posts/Linux_System_Call_Table_for_x86_64/\" rel=\"noreferrer\">Reference</a>).</p>\n\n<p>Actually, this flag is not set when calling runtime.clone() from os_linux.go: <a href=\"https://github.com/golang/go/blob/52e2126a5ee7c1123ded51874ec0fe0394eabd0a/src/runtime/os_linux.go#L132-L137\" rel=\"noreferrer\">Source</a>.</p>\n\n<p>The reason they don't need tid is maybe because it's not a library such as pthread which user does something complicated using tid. </p>\n\n<h3>What R8, R9, and R12 are used for</h3>\n\n<p>In short, R8, R9 and R12 are not used by system call but used to construct the stack after it.</p>\n\n<p>Note that R8 and R9 are passed as argument to system call, but not used by clone (see the reason below), and R12 is preserved after system call, it is safe to use these registers after system call. (<a href=\"https://stackoverflow.com/questions/18024672/what-registers-are-preserved-through-a-linux-x86-64-function-call\">Reference</a>)</p>\n\n<p>Let's see the detail. </p>\n\n<p>internally runtime.clone is called as follows: <a href=\"https://github.com/golang/go/blob/52e2126a5ee7c1123ded51874ec0fe0394eabd0a/src/runtime/os_linux.go#L158\" rel=\"noreferrer\">Source</a></p>\n\n<pre><code>func newosproc(mp *m) {\n    stk := unsafe.Pointer(mp.g0.stack.hi)\n    ....\n    ret := clone(cloneFlags, stk, unsafe.Pointer(mp), unsafe.Pointer(mp.g0), unsafe.Pointer(funcPC(mstart)))\n    ....\n}\n</code></pre>\n\n<p>Reading <a href=\"https://golang.org/doc/asm\" rel=\"noreferrer\">Quick Guide to Go's Assembler</a>, and the code OP posted, you can see that R8 is pointer to <code>mp</code>, and R9 is pointer to <code>mp.g0</code> and R12 is pointer to some function which you want to call in the <code>clone</code>ed thread. (structure of <code>m</code> and <code>g</code> looks like this: <a href=\"https://github.com/golang/go/blob/52e2126a5ee7c1123ded51874ec0fe0394eabd0a/src/runtime/runtime2.go#L404\" rel=\"noreferrer\">Source</a> and this: <a href=\"https://github.com/golang/go/blob/52e2126a5ee7c1123ded51874ec0fe0394eabd0a/src/runtime/runtime2.go#L339\" rel=\"noreferrer\">Source</a>\n).</p>\n\n<p>R8 is argument to clone which indicates tls(thread local storage), but it is not used unless <code>CLONE_SETTLS</code> is set: <a href=\"https://github.com/torvalds/linux/blob/8dcd175bc3d50b78413c56d5b17d4bddd77412ef/arch/x86/kernel/process_64.c#L436\" rel=\"noreferrer\">Source</a></p>\n\n<p>R9 is generally used as 6th argument to system call, but clone does not use it because it only uses 5 arguments(<a href=\"https://github.com/torvalds/linux/blob/542d0e583b7b366527175b2b5fc0aad262fa33b0/kernel/fork.c#L2310-L2336\" rel=\"noreferrer\">Source</a>).</p>\n\n<p>R12 is a register which is preserved after system call.</p>\n\n<p>So finally let's see the <a href=\"https://github.com/golang/go/blob/1650f1ba0b964a06a242c3318e85b3b46f010614/src/runtime/sys_linux_amd64.s#L540\" rel=\"noreferrer\">source</a> of runtime.clone. The important thing is after the <code>SYSCALL</code>. They are doing some stack setup using R8 and R9 in the child thread which is created, and finally calling R12.</p>\n\n<pre><code>// int32 clone(int32 flags, void *stk, M *mp, G *gp, void (*fn)(void));\nTEXT runtime\u00b7clone(SB),NOSPLIT,$0\n    MOVL    flags+0(FP), DI\n    MOVQ    stk+8(FP), SI\n    MOVQ    $0, DX\n    MOVQ    $0, R10\n\n    // Copy mp, gp, fn off parent stack for use by child.\n    // Careful: Linux system call clobbers CX and R11.\n    MOVQ    mp+16(FP), R8\n    MOVQ    gp+24(FP), R9\n    MOVQ    fn+32(FP), R12\n\n    MOVL    $SYS_clone, AX\n    SYSCALL\n\n    // In parent, return.\n    CMPQ    AX, $0\n    JEQ 3(PC)\n    MOVL    AX, ret+40(FP)\n    RET\n\n    // In child, on new stack.\n    MOVQ    SI, SP\n\n    // If g or m are nil, skip Go-related setup.\n    CMPQ    R8, $0    // m\n    JEQ nog\n    CMPQ    R9, $0    // g\n    JEQ nog\n\n    // Initialize m-&gt;procid to Linux tid\n    MOVL    $SYS_gettid, AX\n    SYSCALL\n    MOVQ    AX, m_procid(R8)\n\n    // Set FS to point at m-&gt;tls.\n    LEAQ    m_tls(R8), DI\n    CALL    runtime\u00b7settls(SB)\n\n    // In child, set up new stack\n    get_tls(CX)\n    MOVQ    R8, g_m(R9)\n    MOVQ    R9, g(CX)\n    CALL    runtime\u00b7stackcheck(SB)\n\nnog:\n    // Call fn\n    CALL    R12\n\n//(omitted)\n</code></pre>\n"}], "owner": {"reputation": 175, "user_id": 11120912, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pFWJF.jpg?s=128&g=1", "display_name": "api", "link": "https://stackoverflow.com/users/11120912/api"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 3, "accepted_answer_id": 55031403, "answer_count": 1, "score": 6, "last_activity_date": 1551910143, "creation_date": 1551204720, "last_edit_date": 1551544065, "question_id": 54891678, "link": "https://stackoverflow.com/questions/54891678/why-golang-clone-syscall-abi-is-diffent-from-linux-kernel-clone-on-x86-64", "title": "Why golang clone syscall abi is diffent from linux kernel clone on x86-64", "body": "<p>The linux kernel clone abi definition at glibc/sysdeps/unix/sysv/linux/x86_64/clone.S:</p>\n\n<pre><code>The kernel expects:\nrax: system call number\nrdi: flags\nrsi: child_stack\nrdx: TID field in parent\nr10: TID field in child\nr8: thread pointer\n</code></pre>\n\n<p>And the golang clone syscall at go1.11.5/src/runtime/sys_linux_amd64.s:</p>\n\n<pre><code>// int32 clone(int32 flags, void *stk, M *mp, G *gp, void (*fn)(void));\nTEXT runtime\u00b7clone(SB),NOSPLIT,$0\n    MOVL    flags+0(FP), DI\n    MOVQ    stk+8(FP), SI\n    MOVQ    $0, DX\n    MOVQ    $0, R10\n\n    // Copy mp, gp, fn off parent stack for use by child.\n    // Careful: Linux system call clobbers CX and R11.\n    MOVQ    mp+16(FP), R8\n    MOVQ    gp+24(FP), R9\n    MOVQ    fn+32(FP), R12\n\n    MOVL    $SYS_clone, AX\n    SYSCALL\n</code></pre>\n\n<p>So why DX, R10, R8 do not keep to clone-syscall promise?\nAt the other hand, R9 and R12 seems to be needless.</p>\n\n<p>Please help me.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551201434, "post_id": 54890809, "comment_id": 96550707, "body": "<a href=\"https://www.youtube.com/watch?v=LSzR0VEraWw\" rel=\"nofollow noreferrer\">youtube.com/watch?v=LSzR0VEraWw</a>"}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 3, "creation_date": 1551208345, "post_id": 54890870, "comment_id": 96554181, "body": "Also useful to catch the reason for a context cancelation via: <code>req.Context().Err()</code> in the cleanup section."}], "tags": [], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "is_accepted": true, "score": 4, "last_activity_date": 1552307369, "last_edit_date": 1552307369, "creation_date": 1551201432, "answer_id": 54890870, "question_id": 54890809, "link": "https://stackoverflow.com/questions/54890809/how-to-use-request-context-instead-of-closenotifier/54890870#54890870", "title": "How to use request.Context instead of CloseNotifier?", "body": "<p>It seems rather simple actually. <a href=\"https://www.sohamkamani.com/blog/golang/2018-06-17-golang-using-context-cancellation/\" rel=\"nofollow noreferrer\">From this blogpost</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Handler(res http.ResonseWriter, req *http.Request) {\n    ctx := req.Context()\n\n    someLogic();\n    select {\n        case &lt;-ctx.Done():\n            someCleanup(ctx.Err())\n            return;\n        default:\n    }\n    someOtherLogic();\n}\n</code></pre>\n"}], "owner": {"reputation": 32310, "user_id": 101152, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/17e922b50957d152280d6140c6756444?s=128&d=identicon&r=PG", "display_name": "Karel B&#237;lek", "link": "https://stackoverflow.com/users/101152/karel-b%c3%adlek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 809, "favorite_count": 2, "accepted_answer_id": 54890870, "answer_count": 1, "score": 5, "last_activity_date": 1552307369, "creation_date": 1551201234, "question_id": 54890809, "link": "https://stackoverflow.com/questions/54890809/how-to-use-request-context-instead-of-closenotifier", "title": "How to use request.Context instead of CloseNotifier?", "body": "<p>I am using CloseNotifier in my application, in a code that looks like this</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func Handler(res http.ResonseWriter, req *http.Request) {\n    notify := res.(CloseNotifier).CloseNotify()\n\n    someLogic();\n    select {\n        case &lt;-notify:\n            someCleanup()\n            return;\n        default:\n    }\n    someOtherLogic();\n}\n</code></pre>\n\n<p>I have noticed CloseNotifier is now deprecated. <a href=\"https://golang.org/src/net/http/server.go?s=7899:8020#L208\" rel=\"noreferrer\">From source code</a>:</p>\n\n<pre><code>// Deprecated: the CloseNotifier interface predates Go's context package.\n// New code should use Request.Context instead.\n</code></pre>\n\n<p>However, I am not sure how to use Request.Context exactly here.</p>\n"}, {"tags": ["go", "build", "dependencies"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551199143, "post_id": 54890161, "comment_id": 96549442, "body": "<code>-x</code> should work the same wether you&#39;re using modules or not"}], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "edited": false, "score": 0, "creation_date": 1551250574, "post_id": 54890460, "comment_id": 96567132, "body": "I need something that i can compare. Neither &quot;go list -f &quot;{{.ImportPath}} {{.Deps}}&quot; ./...&quot; or &quot;go list ./...&quot; doesn&#39;t give me package versions.  &quot;go list -m all&quot; do the job for module version."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "edited": false, "score": 0, "creation_date": 1551251123, "post_id": 54890460, "comment_id": 96567363, "body": "@AlexanderKochetkov There is no recorded package version in <code>GOPATH</code> mode, <code>go get</code> always gets the latest commit on <code>master</code> branch."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "edited": false, "score": 0, "creation_date": 1551251377, "post_id": 54890460, "comment_id": 96567453, "body": "@AlexanderKochetkov So think of this way: if packages in your <code>GOPATH</code> are up-to-date, and if your module uses a different version than the latest of master, there is always a chance they will behave differently."}, {"owner": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "edited": false, "score": 0, "creation_date": 1551271322, "post_id": 54890460, "comment_id": 96578502, "body": "Finally i solve my problem, by forcing all go.mod versions to master. For example &quot;google.golang.org/grpc master&quot;. So, by default go fills it with something else i guess."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "edited": false, "score": 0, "creation_date": 1551272637, "post_id": 54890460, "comment_id": 96579317, "body": "@AlexanderKochetkov In module mode, go does not choose the master, the version selection strategy is linked in the answer and is described here: <a href=\"https://github.com/golang/go/wiki/Modules#version-selection\" rel=\"nofollow noreferrer\">Module version selection</a>. In short, the highest version is chosen that suits all modules."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1551205849, "last_edit_date": 1551205849, "creation_date": 1551199948, "answer_id": 54890460, "question_id": 54890161, "link": "https://stackoverflow.com/questions/54890161/how-to-get-go-detailed-build-logs-with-all-used-packages-in-gopath-and-go-modu/54890460#54890460", "title": "How to get Go detailed build logs, with all used packages in GOPATH and &quot;go module&quot; mode?", "body": "<p>For listing installed packages using <code>GOPATH</code>, please see this old thread: <a href=\"https://stackoverflow.com/questions/28166249/how-to-list-installed-go-packages/28166550#28166550\">How to list installed go packages</a></p>\n\n<p>The following applies to the new module mode.</p>\n\n<h3>At compile / build time</h3>\n\n<p>You may use the <code>go list -m all</code> command to view final versions that will be used in a build for all direct and indirect dependencies (<a href=\"https://github.com/golang/go/wiki/Modules#daily-workflow\" rel=\"nofollow noreferrer\">source</a>). You can read more details about this here: <a href=\"https://github.com/golang/go/wiki/Modules#version-selection\" rel=\"nofollow noreferrer\">Modules: Version Selection</a>.</p>\n\n<h3>At runtime</h3>\n\n<p>At runtime (from your application) you may use the <a href=\"https://golang.org/pkg/runtime/debug/#ReadBuildInfo\" rel=\"nofollow noreferrer\"><code>debug.ReadBuildInfo()</code></a> function:</p>\n\n<blockquote>\n  <p>ReadBuildInfo returns the build information embedded in the running binary. The information is available only in binaries built with module support.</p>\n</blockquote>\n\n<p>Note: <code>debug.ReadBuildInfo()</code> was only added in <a href=\"https://golang.org/doc/go1.12#runtime/debug\" rel=\"nofollow noreferrer\">Go 1.12</a> (released just a day ago).</p>\n\n<p>Example getting and printing build info (recursively). Easiest is to JSON-marshal the build info:</p>\n\n<pre><code>bi, ok := debug.ReadBuildInfo()\nif !ok {\n    fmt.Println(\"Getting build info failed (not in module mode?)!\")\n    return\n}\n\nenc := json.NewEncoder(os.Stdout)\nenc.SetIndent(\"\", \"  \")\nif err := enc.Encode(bi); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<h2>Example output</h2>\n\n<p>Example output for a project which has a single dependency: <code>github.com/globalsign/mgo</code>).</p>\n\n<p>Running <code>go list -m all</code>:</p>\n\n<pre><code>mytest\ngithub.com/globalsign/mgo v0.0.0-20181015135952-eeefdecb41b8\n</code></pre>\n\n<p>Getting and JSON-marshaling the build info at runtime:</p>\n\n<pre><code>{\n  \"Path\": \"mytest\",\n  \"Main\": {\n    \"Path\": \"mytest\",\n    \"Version\": \"(devel)\",\n    \"Sum\": \"\",\n    \"Replace\": null\n  },\n  \"Deps\": [\n    {\n      \"Path\": \"github.com/globalsign/mgo\",\n      \"Version\": \"v0.0.0-20181015135952-eeefdecb41b8\",\n      \"Sum\": \"h1:DujepqpGd1hyOd7aW59XpK7Qymp8iy83xq74fLr21is=\",\n      \"Replace\": null\n    }\n  ]\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 4471623, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-buYMuiXITg4/AAAAAAAAAAI/AAAAAAAAAHQ/gf4wHV8jJHw/photo.jpg?sz=128", "display_name": "Alexander Kochetkov", "link": "https://stackoverflow.com/users/4471623/alexander-kochetkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1704, "favorite_count": 1, "accepted_answer_id": 54890460, "answer_count": 1, "score": 3, "last_activity_date": 1551205849, "creation_date": 1551198993, "question_id": 54890161, "link": "https://stackoverflow.com/questions/54890161/how-to-get-go-detailed-build-logs-with-all-used-packages-in-gopath-and-go-modu", "title": "How to get Go detailed build logs, with all used packages in GOPATH and &quot;go module&quot; mode?", "body": "<p>I have situation with a project.</p>\n\n<p>It behave different when i use go module, outside GOPATH, and \"go get\" inside GOPATH. In both cases build goes without errors.</p>\n\n<p>But GPRC connection behaves differently. Gives timeout in \"go mod\" case, works fine with \"go get\".</p>\n\n<p>I suspect that go uses different set of packages. I need full list of used packages with versions in both modes to compare. How can i access it?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551191982, "post_id": 54887770, "comment_id": 96544996, "body": "could you plz tell me why must buffered channel ? my original intention seems doesn&#39;t necessarily have to use buffered channel. like, as long as there is a <code>oneResult</code> value, just calculate a <code>result *=n</code> in range over channel."}, {"owner": {"reputation": 1721, "user_id": 3625217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e04c2f250002971ff233b86a0e25354?s=128&d=identicon&r=PG", "display_name": "Jess&#233; Catrinck", "link": "https://stackoverflow.com/users/3625217/jess%c3%a9-catrinck"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551208495, "post_id": 54887770, "comment_id": 96554231, "body": "You need the buffer to add <i>multiple</i> values to the channel <code>oneResult</code> then when you loop through it you will get all these values. See here: <a href=\"http://devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-golang/#anameunbuf_ch_send_doneasendingtoanunbufferedchannelreturnsassoonasthetargetreceiverisready\" rel=\"nofollow noreferrer\">devs.cloudimmunity.com/gotchas-and-common-mistakes-in-go-gol&zwnj;&#8203;ang/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1721, "user_id": 3625217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e04c2f250002971ff233b86a0e25354?s=128&d=identicon&r=PG", "display_name": "Jess&#233; Catrinck", "link": "https://stackoverflow.com/users/3625217/jess%c3%a9-catrinck"}, "is_accepted": false, "score": 1, "last_activity_date": 1551191311, "creation_date": 1551191311, "answer_id": 54887770, "question_id": 54887502, "link": "https://stackoverflow.com/questions/54887502/deadlock-in-range-over-channel-in-pipeline-with-multiple-waitgroups/54887770#54887770", "title": "Deadlock in range over channel in pipeline with multiple waitgroups", "body": "<p>You need to add a buffer to the variable <code>oneResult</code></p>\n\n<p><a href=\"https://i.stack.imgur.com/bstJu.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/bstJu.png\" alt=\"enter image description here\"></a></p>\n\n<p>Explanation: <a href=\"https://www.rapidloop.com/blog/golang-channels-tips-tricks.html\" rel=\"nofollow noreferrer\">https://www.rapidloop.com/blog/golang-channels-tips-tricks.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551199923, "post_id": 54890220, "comment_id": 96549876, "body": "Thanks so much, your answer makes me much clearer. It&#39;s a bit complex, but good to know things on this problem. Is there any book covered such &quot;circular dependency&quot; issue caused by wait group?"}, {"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551200924, "post_id": 54890220, "comment_id": 96550443, "body": "<a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>, the Fan-out Fan-in part mentioned a closer with WaitGroup, this is the main issue for my problem I think"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551201163, "post_id": 54890220, "comment_id": 96550560, "body": "I&#39;m not sure if &quot;circular dependency&quot; is the right term to be honest, and also I don&#39;t know of any books/articles that address deadlocks specifically under such circumstances. But it seems to me that there are two main reasons why a deadlock could occur, either you&#39;re sending to a channel without receiving from it, or you&#39;re receiving from a channel without sending to it. This can happen if you forgot to write the code to receive/send, or you didn&#39;t forget writing it but that piece of code is not being executed because it&#39;s blocked by something somewhere, like in your case by <code>wg2.Wait</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551211593, "post_id": 54890220, "comment_id": 96555613, "body": "@Jess&#233;Catrinck Please correct me if I&#39;m wrong, but the buffered channel only allows you to fill it up before it&#39;s ever received from. It doesn&#39;t make the program parallel nor concurrent. And in your example you&#39;re still just waiting with <code>wg2</code> until you fill up the buffer, keeping the <code>range oneResult</code> loop idle unnecessarily. And even if you would move <code>wg2</code> into its own goroutine to activate the loop then you would just get the same effect as with the unbuffered channel making the buffered one pointless."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551211615, "post_id": 54890220, "comment_id": 96555625, "body": "@Jess&#233;Catrinck <a href=\"https://play.golang.com/p/YHeQ3JH8YCx\" rel=\"nofollow noreferrer\">This</a> feels more concurrent than <a href=\"https://play.golang.com/p/92N_JLO8Hcz\" rel=\"nofollow noreferrer\">this</a>. Am I wrong?"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1551200100, "last_edit_date": 1551200100, "creation_date": 1551199229, "answer_id": 54890220, "question_id": 54887502, "link": "https://stackoverflow.com/questions/54887502/deadlock-in-range-over-channel-in-pipeline-with-multiple-waitgroups/54890220#54890220", "title": "Deadlock in range over channel in pipeline with multiple waitgroups", "body": "<p>The deadlock isn't on the range-over-channel loop. If you run the code on <a href=\"https://play.golang.com/p/Vqi2SLg-Flm\" rel=\"nofollow noreferrer\">playground</a> you'll see at the top of the stacktrace that the error is caused by <code>wg2.Wait</code> (line 88 on playground and pointed to by the stacktrace). Also in the stacktrace you can see all the goroutines that haven't finished because of the deadlock, this is because <code>oneResult&lt;-t</code> never completes, so none of the goroutines started in the loop ever finish.</p>\n\n<p>So the main problem is here:</p>\n\n<pre><code>wg2.Wait()\nclose(oneResult)\n\n// ...\n\nfor n := range oneResult{\n// ...\n</code></pre>\n\n<p>Also looping over a closed channel is not what you want, I assume. However even if you didn't close the channel, that loop would never start because <code>wg2.Wait()</code> will wait until its <em>done</em>.</p>\n\n<pre><code>oneResult &lt;- t\nwg2.Done()\n</code></pre>\n\n<p>But it will never be done because it relies on the loop to be already running. The line <code>oneResult &lt;- t</code> will not complete unless there's someone on the other side receiving from that channel, which is your loop, however that range-over-channel loop is still waiting for <code>wg2.Wait()</code> to complete.</p>\n\n<p>So essentially you have a \"circular dependency\" between the channel's sender and receiver.</p>\n\n<p>To fix the issue you need to allow the loop to start receiving from the channel while still making sure that channel's closed when done. You can do thing by wrapping the two wait-and-close lines into their own goroutine.</p>\n\n<p><a href=\"https://play.golang.com/p/rwwCFVszZ6Q\" rel=\"nofollow noreferrer\">https://play.golang.com/p/rwwCFVszZ6Q</a></p>\n"}], "owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 54890220, "answer_count": 2, "score": 2, "last_activity_date": 1551200100, "creation_date": 1551190509, "last_edit_date": 1551199330, "question_id": 54887502, "link": "https://stackoverflow.com/questions/54887502/deadlock-in-range-over-channel-in-pipeline-with-multiple-waitgroups", "title": "Deadlock in range over channel in pipeline with multiple waitgroups", "body": "<p>I'm practicing a challenge to calculate factorials by splitting calculations into 100 groups concurrently, I solved lots of issue on WaitGroups, but still in the <code>calculateFactorial</code> function I got the deadlock on range over channel part. \nWish someone could point the issue here, thank you.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    var wg sync.WaitGroup\n    wg.Add(2)\n    in := make (chan int)\n    out := make (chan float64)\n\n\n\n    out = calculateFactorial(genConcurrentGroup(in, &amp;wg), &amp;wg)\n\n    go func() {\n        in &lt;- 10\n        close(in)\n    }()\n\n    fmt.Println(&lt;-out)\n\n    wg.Wait()\n\n\n}\n\n//split input number into groups\n//the result should be a map of [start number, number in group]\n//this is not heavy task so run in one go routine\nfunc genConcurrentGroup(c chan int, wg *sync.WaitGroup) chan map[int]int{\n    out := make(chan map[int]int)\n\n    go func() {\n        //100 groups\n        total:= &lt;- c\n        wg.Done()\n        //element number in group\n        elemNumber := total / 100\n        extra := total % 100\n        result := make(map[int]int)\n        if elemNumber&gt;0{\n            //certain 100 groups\n            for i:=1 ;i&lt;=99;i++{\n                result[(i-1) * elemNumber + 1] = elemNumber\n            }\n            result[100] = extra + elemNumber\n        }else{\n            //less than 100\n            for i:=1;i&lt;=total;i++{\n                result[i] = 1\n            }\n        }\n\n        out &lt;- result\n        close(out)\n    }()\n    return out\n}\n\n//takes in all numbers to calculate multiply result\n//this could be heavy so can do it 100 groups together\nfunc calculateFactorial(nums chan map[int]int, wg *sync.WaitGroup) chan float64{\n    out := make(chan float64)\n\n\n    go func() {\n        total:= &lt;- nums\n        wg.Done()\n        fmt.Println(total)\n\n        oneResult := make(chan float64)\n\n        var wg2 sync.WaitGroup\n        wg2.Add(len(total))\n\n        for k,v := range total{\n            fmt.Printf(\"%d %d \\n\",k,v)\n            go func(k int, v int) {\n                t := 1.0\n                for i:=0;i&lt;v;i++{\n                    t = t * (float64(k) + float64(i))\n                }\n                fmt.Println(t)\n                oneResult &lt;- t\n                wg2.Done()\n            }(k,v)\n        }\n\n        wg2.Wait()\n        close(oneResult)\n\n        result := 1.0\n        for n := range oneResult{  //DEADLOCK HERE! Why?\n            result *= n\n        }\n\n\n        fmt.Printf(\"Result: %f\\n\",result)\n\n        out &lt;- result\n\n    }()\n    return out\n}\n</code></pre>\n\n<p><strong>Update</strong>:</p>\n\n<p>Thanks to Jess\u00e9 Catrinck's answer which fixed the issue in the above code by simply change the <code>oneResult</code> to a buffered channel. However in <a href=\"https://stackoverflow.com/a/15144455/921082\">https://stackoverflow.com/a/15144455/921082</a> there's a quote </p>\n\n<blockquote>\n  <p>You should never add buffering merely to fix a deadlock. If your\n  program deadlocks, it's far easier to fix by starting with zero\n  buffering and think through the dependencies. Then add buffering when\n  you know it won't deadlock.</p>\n</blockquote>\n\n<p>So could anyone please help me figure out how to not to use buffered channel for this? Is it possible?</p>\n\n<p>Furthermore, I did some research on what exactly causes a deadlock.</p>\n\n<p>Some quote like from <a href=\"https://stackoverflow.com/a/18660709/921082\">https://stackoverflow.com/a/18660709/921082</a>,</p>\n\n<blockquote>\n  <p>If the channel is unbuffered, the sender blocks until the receiver has\n  received the value. If the channel has a buffer, the sender blocks\n  only until the value has been copied to the buffer; if the buffer is\n  full, this means waiting until some receiver has retrieved a value.</p>\n  \n  <p>Said otherwise :</p>\n  \n  <ol>\n  <li><p>when a channel is full, the sender waits for another goroutine to make\n  some room by receiving </p></li>\n  <li><p>you can see an unbuffered channel as an always full one : there must be another goroutine to take what the sender sends.</p></li>\n  </ol>\n</blockquote>\n\n<p>So in my original situation, what is probably causing the deadlock is maybe :</p>\n\n<ol>\n<li><p>the range over channel is not receiving  ?</p></li>\n<li><p>the range over channel is not receiving on a separated go routine. ?</p></li>\n<li><p>the <code>oneResult</code> is not properly closed, so range over channel doesn't know where's the end?</p></li>\n</ol>\n\n<p>for number 3, I don't know if there's anything wrong about closing the <code>oneResult</code> before range over, since this pattern appears on many examples on the internet. If it is number 3, could it be something wrong in the wait group?</p>\n\n<p>I got another article very similar to my situation <a href=\"https://robertbasic.com/blog/buffered-vs-unbuffered-channels-in-golang/\" rel=\"nofollow noreferrer\">https://robertbasic.com/blog/buffered-vs-unbuffered-channels-in-golang/</a>, in its \n second lesson learned, he uses a <code>for { select {} }</code> infinite loop as an alternative to range over, it seems solved his problem.</p>\n\n<pre><code> go func() {\n        for{\n            select {\n            case p := &lt;-pch:\n                findcp(p)\n            }\n        }\n    }()\n</code></pre>\n\n<blockquote>\n  <p>Lesson number 2 \u2014 an unbuffered channel can\u2019t hold on to values (yah,\n  it\u2019s right there in the name \u201cunbuffered\u201d), so whatever is sent to\n  that channel, it must be received by some other code right away. That\n  receiving code must be in a different goroutine because one goroutine\n  can\u2019t do two things at the same time: it can\u2019t send and receive; it\n  must be one or the other.</p>\n</blockquote>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 3, "creation_date": 1551184516, "post_id": 54885313, "comment_id": 96540245, "body": "In your &quot;talking&quot; function, are you dialing a connection in an infinite loop without ever closing? That sounds problematic."}, {"owner": {"reputation": 1, "user_id": 10852155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nj7au.png?s=128&g=1", "display_name": "ThreeOneFourTwo", "link": "https://stackoverflow.com/users/10852155/threeonefourtwo"}, "reply_to_user": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1551185097, "post_id": 54885313, "comment_id": 96540597, "body": "I have experimented with <code>conn.Close()</code> and <code>defer conn.Close()</code> neither of which appeared to have any effect. Since I&#39;m sending a lot of messages it seemed sensible to keep the connections open. Although I can&#39;t claim to be an expert in networking..."}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1551185420, "post_id": 54885313, "comment_id": 96540776, "body": "Try dial the connection out of the loop and defer close it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551187723, "post_id": 54885313, "comment_id": 96542173, "body": "You also cannot discard a <code>bufio.Reader</code> if you want to continue using the connection."}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 10852155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nj7au.png?s=128&g=1", "display_name": "ThreeOneFourTwo", "link": "https://stackoverflow.com/users/10852155/threeonefourtwo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551191820, "creation_date": 1551191820, "answer_id": 54887909, "question_id": 54885313, "link": "https://stackoverflow.com/questions/54885313/conn-closing-randomly-and-without-warning-in-go/54887909#54887909", "title": "Conn closing randomly and without warning in Go", "body": "<p>So it appears that making a connection and THEN waiting for something to be put in the channel is causing the problem. If you instead wait for something to be put into the channel THEN (once something is removed form the channel) make the connection (and close the connection as suggested by @leaf bebop) the code runs fine every time. (see below)</p>\n\n<pre><code>func client(myNode Node, nbour Node, myChannel chan string) {\nfor {\n// this loop controls the sending of algorithm messages\n\n// useful info for the user\n//fmt.Println(\"CLIENT awaiting message to send\")\n\n// the message to send out of the channel\nmessageToSend := &lt;-myChannel\n\nconn, err = net.Dial(\"tcp\", nbour.ip+\":\"+nbour.port)\n\n// send the message\nconn.Write([]byte(messageToSend))\nconn.Close()\n\nfmt.Println(\"CLIENT SENT ALG MESSAGE = \" + messageToSend + \"to \" + nbour.ip + \":\" + nbour.port)\n\n// useful information for the user\n//fmt.Printf(\"CLIENT Message text: \" + messageToSend. + \"\\n\")\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 1, "user_id": 10852155, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Nj7au.png?s=128&g=1", "display_name": "ThreeOneFourTwo", "link": "https://stackoverflow.com/users/10852155/threeonefourtwo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1551208443, "creation_date": 1551183140, "last_edit_date": 1551208443, "question_id": 54885313, "link": "https://stackoverflow.com/questions/54885313/conn-closing-randomly-and-without-warning-in-go", "title": "Conn closing randomly and without warning in Go", "body": "<p>I'm building an echo algorithm in go with multiple initiators, essentially I have three functions \"talk\", \"listen\" and \"run algorithm\". \"talk\" sends data to neighbours, \"listen\" received data from neighbours, both of these use channels. These channels are monitored within the \"run algorithm\" functions which decides what to send and to whom.</p>\n\n<p>Essentially this:</p>\n\n<pre><code>func server(s Node, myChannel chan string){\nfmt.Printf(\"SERVER Launching server... %s:%s \\n\", s.ip, s.port)\n\n// Start listening\n\n// We do not stop listening until the surrounding function returns (finishes)\nln, _ := net.Listen(\"tcp\", s.ip+\":\"+s.port)\nfor {\n\n    // Accept connections\n    fmt.Println(\"SERVER waiting at ln.Accept()\")\n    conn, err := ln.Accept()\n\n    if err != nil {\n        panic(err)\n    }\n\n    //fmt.Println(\"SERVER connection accepted\")\n\n    // Read received message\n    fmt.Println(\"SERVER awaiting message\")\n    message, err := bufio.NewReader(conn).ReadString('\\n')\n    fmt.Println(\"SERVER message received = \" + message)\n    if err != nil {\n        fmt.Println(\"the server is broken\")\n        panic(err)\n    }\n\n    if err == nil {\n\n        // If the mmessage is not empty, then print it in the shell\n\n        if string(message) != \"\" {\n            fmt.Println(\"SERVER message put in channel\")\n            myChannel &lt;- message\n\n        }\n    }\n}\n</code></pre>\n\n<p>And the talking function as this:</p>\n\n<pre><code>func client(myNode Node, nbour Node, myChannel chan string) {\n    for {\n    // this loop controls the sending of algorithm messages\n\n    conn, err = net.Dial(\"tcp\", nbour.ip+\":\"+nbour.port)\n\n    // useful info for the user\n    //fmt.Println(\"CLIENT awaiting message to send\")\n\n    // the the message to send out of the channel\n    messageToSend := &lt;-myChannel\n\n    // send the message\n    conn.Write([]byte(messageToSend))\n\n    fmt.Println(\"CLIENT SENT ALG MESSAGE = \" + messageToSend + \"to \" + nbour.ip + \":\" + nbour.port)\n\n    // useful information for the user\n    //fmt.Printf(\"CLIENT Message text: \" + messageToSend. + \"\\n\")\n\n\n}\n</code></pre>\n\n<p>The problem is that these connections work find for the first few messages, then at some arbitrary point one node sends a message and the neighbour does not receive it and everything stops.</p>\n\n<p>Thus my question is why do connections arbitrarily stop, is there a setting somewhere to tell them how long to stay open, or how many messages to send? Or is the above code the wrong was of achieving this goal (although like I say it works fine sometimes, in fact sometimes the algorithm completes perfectly, then I run exactly the same code again and it gets stuck waiting for messages to arrive).</p>\n"}, {"tags": ["sql", "go", "filter", "go-gorm"], "comments": [{"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551235282, "post_id": 54884669, "comment_id": 96563091, "body": "Did you try taking that out of the preload clause, and instead, use joins and where functions?"}, {"owner": {"reputation": 65, "user_id": 4553948, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/929327770424291/picture?type=large", "display_name": "Chris", "link": "https://stackoverflow.com/users/4553948/chris"}, "reply_to_user": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551235428, "post_id": 54884669, "comment_id": 96563118, "body": "can i do it with just preload only"}, {"owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1551382240, "post_id": 54884669, "comment_id": 96630261, "body": "What&#39;s the issue with the query that&#39;s being generated? Can you show the SQL that you&#39;d like to receive?"}, {"owner": {"reputation": 65, "user_id": 4553948, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/929327770424291/picture?type=large", "display_name": "Chris", "link": "https://stackoverflow.com/users/4553948/chris"}, "reply_to_user": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1552470493, "post_id": 54884669, "comment_id": 97017910, "body": "query that i want maybe something like this."}, {"owner": {"reputation": 65, "user_id": 4553948, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/929327770424291/picture?type=large", "display_name": "Chris", "link": "https://stackoverflow.com/users/4553948/chris"}, "reply_to_user": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "edited": false, "score": 0, "creation_date": 1552470496, "post_id": 54884669, "comment_id": 97017911, "body": "SELECT *  FROM [trnJualMst]  inner join trnjualdtl on [trnJualMst].trnjualmstoid = trnjualdtl.trnjualmstoid inner join mstitem on mstitem.itemoid = trnjualdtl.itemoid WHERE trnjualdtl.trnjualmstoid in (1,2,3) and  ([itemoid] IN (87,85,18,12,75,22,19,37,44,36,28,29,92,54,34)) AND (itemdesc like &#39;%keju%&#39;)"}], "owner": {"reputation": 65, "user_id": 4553948, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/929327770424291/picture?type=large", "display_name": "Chris", "link": "https://stackoverflow.com/users/4553948/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551392992, "creation_date": 1551181042, "last_edit_date": 1551392992, "question_id": 54884669, "link": "https://stackoverflow.com/questions/54884669/how-to-preload-using-where-not-filtering-data", "title": "How to preload using where not filtering data", "body": "<p>how to work with gorm with preload and filtering i have stuck for some time, maybe can help me</p>\n\n<pre><code>type JualmstModel struct {\n    Trnjualmstoid int            `json:\"jualid\"`\n    Trnno         string         `json:\"jualno\"`\n    JualdtlModel  []JualdtlModel `gorm:\"foreignkey:Trnjualmstoid;association_foreignkey:Trnjualmstoid\"`\n}\n\ntype JualdtlModel struct {\n    Trnjualdtloid          int       `json:\"jualdtlid\"`\n    Trnjualmstoid          int       `json:\"jualid\"`\n    Item                   ItemModel `gorm:\"foreignkey:itemoid;association_foreignkey:itemoid\"`\n    Itemoid                int       `json:\"Itemoid\"`\n}\n\ntype ItemModel struct {\n    Itemoid  string `json:\"itemid\"`\n    Itemdesc string `json:\"itemdesc\"`\n}\n</code></pre>\n\n<p>here is the model</p>\n\n<pre><code>DB.Find(b).\n        Preload(\"JualdtlModel.Item\", \"itemdesc like ?\", \"%\"+menu+\"%\").\n        Find(b)\n</code></pre>\n\n<p>here the result</p>\n\n<pre><code> \"jualid\": 1,\n      \"jualno\": \"INV/201902/0001\",\n      \"JualdtlModel\": [\n        {\n          \"jualdtlid\": 1,\n          \"jualid\": 1,\n          \"Item\": {\n            \"itemid\": \"22\",\n            \"itemdesc\": \"+ KEJU\"\n          },\n          \"Itemoid\": 22\n        },\n        {\n          \"jualdtlid\": 2,\n          \"jualid\": 1,\n          \"Item\": {\n            \"itemid\": \"\",\n            \"itemdesc\": \"\"\n          },\n          \"Itemoid\": 87\n        },\n</code></pre>\n\n<p>i want to filter the item with some menu item, but when i add filter item it not filter all of my query </p>\n\n<p>here debug result</p>\n\n<pre><code>SELECT * FROM [trnJualMst] \n\nSELECT * FROM [trnJualDtl]  WHERE ([trnjualmstoid] IN (1,2,3)) \n\nSELECT * FROM [mstItem]  WHERE ([itemoid] IN (87,85,18,12,75,22,19,37,44,36,28,29,92,54,34)) AND (itemdesc like '%keju%')\n</code></pre>\n\n<p>What can I do so I can only load item that in filter?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "edited": false, "score": 0, "creation_date": 1551190712, "post_id": 54886189, "comment_id": 96544094, "body": "Thanks, sort of solved the issue in the first function, but I still have problem. plz look at <a href=\"https://stackoverflow.com/questions/54887502/deadlock-in-range-over-channel-in-pipeline-with-multiple-waitgroups\" title=\"deadlock in range over channel in pipeline with multiple waitgroups\">stackoverflow.com/questions/54887502/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1721, "user_id": 3625217, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5e04c2f250002971ff233b86a0e25354?s=128&d=identicon&r=PG", "display_name": "Jess&#233; Catrinck", "link": "https://stackoverflow.com/users/3625217/jess%c3%a9-catrinck"}, "is_accepted": false, "score": 0, "last_activity_date": 1551186228, "creation_date": 1551186228, "answer_id": 54886189, "question_id": 54884099, "link": "https://stackoverflow.com/questions/54884099/deadlock-when-passing-channel-as-argument-in-pipline/54886189#54886189", "title": "deadlock when passing channel as argument in pipline", "body": "<p><strong>1. <code>total:= &lt;- c  //DEADLOCK HERE! Why?</code></strong></p>\n\n<p>You need to add a buffer to your <code>in</code> channel because there is nobody receiving when you send the value.</p>\n\n<p><a href=\"https://i.stack.imgur.com/WuqKc.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/WuqKc.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>2. <code>total := &lt;-nums //DEADLOCK HERE! Why?</code></strong></p>\n\n<p>You need to add a <code>sync.WaitGroup</code> to wait for all goroutines to end and then you can close your channel to loop over it.</p>\n\n<p><a href=\"https://i.stack.imgur.com/F1GoU.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/F1GoU.png\" alt=\"enter image description here\"></a></p>\n\n<p><strong>Complete code without deadlocks:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    in := make(chan int, 1)\n\n    in &lt;- 1005\n    out := calculateFacotorial(genConcurrentGroup(in))\n\n    fmt.Println(&lt;-out)\n\n}\n\n//split input number into groups\n//the result should be a map of [start number, number in group]\n//this is not heavy task so run in one go routine\nfunc genConcurrentGroup(c chan int) chan map[int]int {\n    out := make(chan map[int]int)\n\n    go func() {\n        //100 groups\n        total := &lt;-c //DEADLOCK HERE! Why?\n        //element number in group\n        elemNumber := total / 100\n        extra := total % 100\n        result := make(map[int]int)\n        if elemNumber &gt; 0 {\n            //certain 100 groups\n            for i := 1; i &lt;= 99; i++ {\n                result[(i-1)*elemNumber+1] = elemNumber\n            }\n            result[100] = extra + elemNumber\n        } else {\n            //less than 100\n            for i := 1; i &lt;= total; i++ {\n                result[i] = 1\n            }\n        }\n\n        out &lt;- result\n        close(out)\n    }()\n    return out\n}\n\n//takes in all numbers to calculate multiply result\n//this could be heavy so can do it 100 groups together\nfunc calculateFacotorial(nums chan map[int]int) chan float64 {\n    out := make(chan float64)\n    total := &lt;-nums //DEADLOCK HERE! Why?\n\n    go func() {\n        oneResult := make(chan float64, len(total))\n\n        var wg sync.WaitGroup\n        wg.Add(len(total))\n\n        for k, v := range total {\n            go func() {\n                t := 1.0\n                for i := 0; i &lt; v; i++ {\n                    t *= float64(k) + float64(i)\n                }\n                oneResult &lt;- t\n                wg.Done()\n            }()\n        }\n\n        wg.Wait()\n\n        close(oneResult)\n\n        result := 1.0\n        for n := range oneResult {\n            result *= n\n        }\n\n        out &lt;- result\n\n    }()\n    return out\n}\n</code></pre>\n"}], "owner": {"reputation": 2803, "user_id": 921082, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/0770877b86732beed2e809a6f7797f65?s=128&d=identicon&r=PG", "display_name": "tomriddle_1234", "link": "https://stackoverflow.com/users/921082/tomriddle-1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 64, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551186228, "creation_date": 1551179151, "question_id": 54884099, "link": "https://stackoverflow.com/questions/54884099/deadlock-when-passing-channel-as-argument-in-pipline", "title": "deadlock when passing channel as argument in pipline", "body": "<p>I'm coding a practice to split number into 100 groups and calculate factorial concurrently, however my code gives me deadlock.</p>\n\n<p>I think the issue could be the pipeline chain initiation. Since all the functions are taking in channels as argument, I'm not clear about why the go func in main doesn't pass the given <code>in</code> channel value to <code>genConcurrentGroup</code> function when this line <code>total:= &lt;- c</code> happens.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    in := make (chan int)\n    out := make (chan float64)\n\n    go func() {\n        in &lt;- 1005\n        out = calculateFacotorial(genConcurrentGroup(in))\n    }()\n\n    fmt.Println(&lt;-in)\n    fmt.Println(&lt;-out)\n\n}\n\n//split input number into groups\n//the result should be a map of [start number, number in group]\n//this is not heavy task so run in one go routine\nfunc genConcurrentGroup(c chan int) chan map[int]int{\n    out := make(chan map[int]int)\n\n    go func() {\n        //100 groups\n        total:= &lt;- c  //DEADLOCK HERE! Why?\n        //element number in group\n        elemNumber := total / 100\n        extra := total % 100\n        result := make(map[int]int)\n        if elemNumber&gt;0{\n            //certain 100 groups\n            for i:=1 ;i&lt;=99;i++{\n                result[(i-1) * elemNumber + 1] = elemNumber\n            }\n            result[100] = extra + elemNumber\n        }else{\n            //less than 100\n            for i:=1;i&lt;=total;i++{\n                result[i] = 1\n            }\n        }\n\n        out &lt;- result\n        close(out)\n    }()\n    return out\n}\n\n//takes in all numbers to calculate multiply result\n//this could be heavy so can do it 100 groups together\nfunc calculateFacotorial(nums chan map[int]int) chan float64{\n    out := make(chan float64)\n    total:= &lt;- nums //DEADLOCK HERE! Why?\n\n    go func() {\n\n        oneResult := make(chan float64)\n\n        for k,v := range total{\n            go func() {\n                t := 1.0\n                for i:=0;i&lt;v;i++{\n                    t *= float64(k) + float64(i)\n                }\n                oneResult &lt;- t\n            }()\n        }\n        result := 1.0\n        for n := range oneResult{\n            result *= n\n        }\n\n        close(oneResult)\n    }()\n    return out\n}\n</code></pre>\n"}, {"tags": ["authentication", "go", "grpc", "grpc-web"], "comments": [{"owner": {"reputation": 143, "user_id": 3993712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tYXFb.jpg?s=128&g=1", "display_name": "Peter Kozhevnikov", "link": "https://stackoverflow.com/users/3993712/peter-kozhevnikov"}, "edited": false, "score": 0, "creation_date": 1551192292, "post_id": 54883895, "comment_id": 96545212, "body": "Yes, is reasonable. gRPC available ws (<a href=\"https://github.com/grpc/grpc-web/issues/24\" rel=\"nofollow noreferrer\">github.com/grpc/grpc-web/issues/24</a>). I make communication example between frontend(react, grpc-web) and backend(golang, grpcweb, grpcwebproxy). It&#39;s work, but not all reasons. How send event to frontend? Now I create example with pure ws to communicate by protobuff (react, ws, gorilla/ws). In this case I use Token-based authentication (token is inside request message, other fields is oneof request kind)."}, {"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1557408729, "post_id": 54883895, "comment_id": 98761478, "body": "I&#39;m struggling with this issue too? Have you found any better solutions? I have a couple of other solutions but I&#39;m not sure if they are reasonable."}, {"owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "reply_to_user": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1557411124, "post_id": 54883895, "comment_id": 98762906, "body": "@Varcorb Sadly not. We&#39;ve built a hacked-up version of the session-based authentication (for speed, because the infra already exists). I&#39;m not happy with it though, and we&#39;ve planned to spin out a separate front-end proxy using explicit token-based auth as soon as possible."}, {"owner": {"reputation": 1317, "user_id": 7565450, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/qgWFA.jpg?s=128&g=1", "display_name": "Varcorb", "link": "https://stackoverflow.com/users/7565450/varcorb"}, "edited": false, "score": 0, "creation_date": 1557434720, "post_id": 54883895, "comment_id": 98774393, "body": "@CosmicOssifrage I was able to get grpc-web (using go as the server) to set an httponly; secure cookie on my client browser. I had to go through a lot of hoops. envoy won&#39;t send the set-cookie header to the browser but it will send it to nginx which nginx will send it to the browser."}], "owner": {"reputation": 3896, "user_id": 1113760, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2305795c77659396611129c962beb8a?s=128&d=identicon&r=PG", "display_name": "Cosmic Ossifrage", "link": "https://stackoverflow.com/users/1113760/cosmic-ossifrage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2566, "favorite_count": 4, "answer_count": 0, "score": 6, "last_activity_date": 1551178574, "creation_date": 1551178574, "question_id": 54883895, "link": "https://stackoverflow.com/questions/54883895/securely-exposing-a-grpc-service-with-authentication-using-grpc-web", "title": "Securely exposing a gRPC service with authentication using gRPC-web", "body": "<p>We are using Improbable's <a href=\"https://github.com/improbable-eng/grpc-web\" rel=\"noreferrer\">gRPC-Web library</a> to expose a gRPC service (implemented in Go) to a Javascript client running in-browser. This service will sit alongside an existing front-end Go service which hosts a REST-based API. The existing service uses session-based authentication to authenticate its users (session cookies + XSRF protection with <a href=\"https://github.com/OWASP/CheatSheetSeries/blob/master/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.md#double-submit-cookie\" rel=\"noreferrer\">double-submit cookies</a>, which are also verified using some per-session server-side state).</p>\n\n<p>The front-end Go service hosts various API endpoints which are either handled locally or fulfilled by proxying the request to other services. All endpoints are exposed via a Gin middleware handler chain, which implements the aforementioned session authentication and XSRF protection checks. It has been proposed that we host gRPC-Web's <a href=\"https://github.com/improbable-eng/grpc-web/tree/ebef475aee9558e615643bd7c669ef39cf0999e0/go/grpcwebproxy\" rel=\"noreferrer\">gogrpcproxy component</a> behind this existing middleware to expose our gRPC service to the world.</p>\n\n<p>I am interested in ensuring the approach for authenticating the incoming gRPC-Web requests is secure. The following methods have been proposed:</p>\n\n<ul>\n<li><p><strong>Token-based authentication</strong> \u2013 i.e. passing bearer tokens in the gRPC request metadata, which are verified by the back-end gRPC service. This matches the authentication model by which native gRPC calls would be authenticated if gRPC-Web was not involved.</p>\n\n<p>In this model, gRPC-Web's responsibility is the implementation of the transport abstraction between browser and server, and marshalling requests to/from the native gRPC representation; authentication is delegated to the backing gRPC service. The gRPC-Web proxy is hosted as a separate endpoint external to the existing REST API.</p></li>\n<li><p><strong>Session-based authentication</strong> \u2013 re-use of the existing session authentication middleware. In this model, the grpcweb proxy server is hosted behind the Gin handler chain. Gin performs its usual checks to verify existence of the relevant cookies and XSRF headers prior to admitting the request.</p>\n\n<p>This approach re-uses much of the existing authentication logic. However, it requires the passing of the XSRF header to ensure the request is admitted by the Gin middleware. This is possible in the current implementation by setting request metadata, which is (currently) implemented by setting headers on the outbound HTTP request. However, it is unclear to me whether this:</p>\n\n<ul>\n<li>is appropriate, as it appears to be a layer violation by exploiting the implementation detail that metadata is currently passed as HTTP headers. This is not documented and could conceivably change;</li>\n<li>is compatible with gRPC-Web's websocket transport, which does not appear to propagate metadata into headers, as the websocket transport is dialled prior to any requests being transmitted;</li>\n<li>suffers potential security issues in future, as the long-lived gRPC-Web transport connection to the front-end service is only authenticated by the front-end proxy when first established, rather than continually on every request (unless the gRPC service also validates the request metadata).</li>\n</ul></li>\n</ul>\n\n<p>My understanding is that gRPC-Web seeks to emulate the gRPC transport between a browser and server, so accordingly implements no specific authentication logic. The standard gRPC mechanisms for passing authentication details make no allowance for implicit session-based state, so my preference is the token-based approach.</p>\n\n<p>Is this a reasonable analysis of the available options?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551178415, "post_id": 54883657, "comment_id": 96536617, "body": "how are you initialising the DB? What is restify/database pkg?"}, {"owner": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1551178427, "post_id": 54883657, "comment_id": 96536623, "body": "It seems to be that <code>database.DB</code> is not initialized."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "edited": false, "score": 0, "creation_date": 1551178843, "post_id": 54883657, "comment_id": 96536863, "body": "@SauravPrakash hello! Can you check my post again please?! I add code of restify/database pkg. It&#39;s not third-party pkg. Do you have any ideas now?"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 961, "user_id": 1775688, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/I2f0b.png?s=128&g=1", "display_name": "Jota Santos", "link": "https://stackoverflow.com/users/1775688/jota-santos"}, "edited": false, "score": 0, "creation_date": 1551179065, "post_id": 54883657, "comment_id": 96537011, "body": "@JamilloSantos I am successfully connected to PostgreSQL database. In <code>main.go</code> file I use such code <code>database.Open()</code> and after that I use <code>defer database.Close()</code>. It show me successfull message. Can you check my post again please?! I add code of <code>restify&#47;database pkg</code>."}], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 1, "creation_date": 1551180209, "post_id": 54884209, "comment_id": 96537739, "body": "Thank you! :) In my case I changed <code>:=</code> symbol to <code>=</code> as you adviced. In the same time I removed <code>var err error</code> code cause it was unnecessary. Now it works."}], "tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 1, "last_activity_date": 1551180003, "last_edit_date": 1551180003, "creation_date": 1551179486, "answer_id": 54884209, "question_id": 54883657, "link": "https://stackoverflow.com/questions/54883657/runtime-error-invalid-memory-address-or-nil-pointer-dereference-2/54884209#54884209", "title": "runtime error: invalid memory address or nil pointer dereference (2)", "body": "<p>It seems the problem is when DB is assigned here:</p>\n\n<pre><code>DB, err := sql.Open(\"postgres\", dbURL) \n</code></pre>\n\n<p>The DB gets defined in a new scope and hence this creates a local variable rather than setting the pkg level variable.\nHence the code <code>Open()</code> establishes a connection to DB.  </p>\n\n<p>Try with this:</p>\n\n<pre><code>var err error\nDB, err = sql.Open(\"postgres\", dbURL) \n</code></pre>\n\n<p>Here is the official quote:  </p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may redeclare variables provided they were originally declared earlier in the same block (or the parameter lists if the block is the function body) with the same type, and at least one of the non-blank variables is new. As a consequence, redeclaration can only appear in a multi-variable short declaration. Redeclaration does not introduce a new variable; it just assigns a new value to the original.</p>\n</blockquote>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1187, "favorite_count": 0, "closed_date": 1551181723, "accepted_answer_id": 54884209, "answer_count": 1, "score": -1, "last_activity_date": 1551180106, "creation_date": 1551177842, "last_edit_date": 1551180106, "question_id": 54883657, "link": "https://stackoverflow.com/questions/54883657/runtime-error-invalid-memory-address-or-nil-pointer-dereference-2", "closed_reason": "Duplicate", "title": "runtime error: invalid memory address or nil pointer dereference (2)", "body": "<p>I am new in <strong>Go</strong> and need help!</p>\n\n<p>In PostgreSQL database I have table called <code>factors</code>. This table has 2 column (<code>factor_id</code> and <code>factor_name</code>). Right now I am successfully connected to PostgreSQL database from Go application.</p>\n\n<p>When I am tring to make query based GET request in console I see error.</p>\n\n<pre><code>http://localhost:8000/api/factors/?limit=5&amp;offset=1\n</code></pre>\n\n<p>Where I make mistake? Please help me to fix the problem.</p>\n\n<p><strong>controllers/factors.go</strong>:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"restify/models\"\n    \"restify/utils\"\n)\n\nvar GetFactors = func(res http.ResponseWriter, req *http.Request) {\n    data := models.Factors{}\n\n    err := models.GetFactors(&amp;data, req.URL.Query().Get(\"limit\"), req.URL.Query().Get(\"offset\"))\n    if err != nil {\n        fmt.Println(err.Error())\n        http.Error(res, err.Error(), 500)\n        return\n    }\n\n    out, err := json.Marshal(data)\n    if err != nil {\n        fmt.Println(err.Error())\n        http.Error(res, err.Error(), 501)\n        return\n    }\n\n    resp := make(map[string]interface{})\n\n    resp[\"Dictionaries\"] = string(out)\n\n    utils.Respond(res, resp)\n\n}\n</code></pre>\n\n<p><strong>models/factors.go</strong>:</p>\n\n<pre><code>package models\n\nimport (\n    \"fmt\"\n    \"restify/database\"\n)\n\ntype Factor struct {\n    FactorID int `json:\"factor_id\"`\n    FactorName string `json:\"factor_name\"`\n}\n\ntype Factors struct {\n    Array[]Factor\n}\n\nfunc GetFactors(data *Factors, limit string, offset string) error {\n    rows, err := database.DB.Query(`SELECT * FROM factors ORDER BY factor_id LIMIT ` + limit + ` OFFSET ` + offset + `;`)\n    if err != nil {\n        fmt.Println(err)\n        return err\n    }\n    defer rows.Close()\n    for rows.Next() {\n        var id int\n        var name string\n        model := Factor{}\n        err = rows.Scan(&amp;id, &amp;name)\n        if err != nil {\n            fmt.Println(err)\n            return err\n        }\n        model.FactorID = id\n        model.FactorName = name\n        data.Array = append(data.Array, model)\n    }\n    err = rows.Err()\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p><strong>ERROR:</strong></p>\n\n<pre><code>2019/02/26 16:25:55 http: panic serving [::1]:20932: runtime error: invalid memory address or nil pointer dereference\ngoroutine 11 [running]:\nnet/http.(*conn).serve.func1(0xc0002badc0)\n    C:/Go/src/net/http/server.go:1746 +0xd7\npanic(0x6dad20, 0x970890)\n    C:/Go/src/runtime/panic.go:513 +0x1c7\ndatabase/sql.(*DB).conn(0x0, 0x78a500, 0xc0000100a8, 0x10000c000339801, 0x0, 0xc000339898, 0xc000339830)\n    C:/Go/src/database/sql/sql.go:1081 +0x41\ndatabase/sql.(*DB).query(0x0, 0x78a500, 0xc0000100a8, 0xc000356040, 0x3a, 0x0, 0x0, 0x0, 0xc000356001, 0x3a, ...)\n    C:/Go/src/database/sql/sql.go:1514 +0x6d\ndatabase/sql.(*DB).QueryContext(0x0, 0x78a500, 0xc0000100a8, 0xc000356040, 0x3a, 0x0, 0x0, 0x0, 0x5, 0xc000356040, ...)\n    C:/Go/src/database/sql/sql.go:1496 +0xda\ndatabase/sql.(*DB).Query(0x0, 0xc000356040, 0x3a, 0x0, 0x0, 0x0, 0x8, 0xc00034e016, 0x1)\n    C:/Go/src/database/sql/sql.go:1510 +0x89\nrestify/models.GetFactors(0xc000339b28, 0xc00034e016, 0x1, 0xc00034e01e, 0x1, 0x0, 0x0)\n    C:/Users/NNogerbek/go/src/restify/models/factors.go:18 +0xf6\nrestify/controllers.glob..func1(0x78a2c0, 0xc00035a000, 0xc000332200)\n    C:/Users/NNogerbek/go/src/restify/controllers/factors.go:14 +0xd3\nnet/http.HandlerFunc.ServeHTTP(0x74da58, 0x78a2c0, 0xc00035a000, 0xc000332200)\n    C:/Go/src/net/http/server.go:1964 +0x4b\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc0002fc180, 0x78a2c0, 0xc00035a000, 0xc000310300)\n    C:/Users/NNogerbek/go/src/github.com/gorilla/mux/mux.go:212 +0xd7\ngithub.com/gorilla/handlers.(*cors).ServeHTTP(0xc0001f2120, 0x78a2c0, 0xc00035a000, 0xc000310300)\n    C:/Users/NNogerbek/go/src/github.com/gorilla/handlers/cors.go:54 +0xa95\nnet/http.serverHandler.ServeHTTP(0xc000056b60, 0x78a2c0, 0xc00035a000, 0xc000310300)\n    C:/Go/src/net/http/server.go:2741 +0xb2\nnet/http.(*conn).serve(0xc0002badc0, 0x78a4c0, 0xc000340040)\n    C:/Go/src/net/http/server.go:1847 +0x64d\ncreated by net/http.(*Server).Serve\n    C:/Go/src/net/http/server.go:2851 +0x2fc\n</code></pre>\n\n<p><strong>database/database.go</strong>:</p>\n\n<pre><code>package database\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"github.com/joho/godotenv\"\n    _ \"github.com/lib/pq\"\n    \"log\"\n    \"restify/utils\"\n)\n\nvar DB *sql.DB\n\n/*\nFunction: \"Connect\".\n\nDescription:\nThe main task of the function is to initialize database connection.\n*/\nfunc Open() () {\n    // Load environment variables from \".env\" file.\n    err := godotenv.Load(\".env\")\n    if err != nil {\n        panic(err)\n    }\n\n    // Initialize database related variables.\n    dbUser := utils.CheckEnvironmentVariable(\"PostgreSQL_USER\")\n    dbPassword := utils.CheckEnvironmentVariable(\"PostgreSQL_PASSWORD\")\n    dbHost := utils.CheckEnvironmentVariable(\"PostgreSQL_HOST\")\n    dbName := utils.CheckEnvironmentVariable(\"PostgreSQL_DATABASE_NAME\")\n\n    // Defining connection string for PostgreSQL database.\n    dbURL := fmt.Sprintf(\"user=%s password=%s host=%s dbname=%s sslmode=disable\", dbUser, dbPassword, dbHost, dbName)\n\n    // Create PostgreSQL database connection pool.\n    DB, err := sql.Open(\"postgres\", dbURL)\n    if err != nil {\n        panic(err)\n    }\n\n    // Ping PostgreSQL database to make sure it's alive.\n    err = DB.Ping()\n    if err != nil {\n        panic(err)\n    }\n\n    log.Println(\"REST API web service successfully connected to remote PostgreSQL database.\")\n}\n\n/*\nFunction: \"Disconnect\"\n\nDescription:\nThe main task of the function is to disconnect database connection.\n*/\nfunc Close() error {\n    return DB.Close()\n}\n</code></pre>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551174942, "post_id": 54882618, "comment_id": 96534641, "body": "You must typeassert like you did for birds."}, {"owner": {"reputation": 43, "user_id": 783744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGjYy.png?s=128&g=1", "display_name": "tjoe", "link": "https://stackoverflow.com/users/783744/tjoe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1551220672, "post_id": 54882618, "comment_id": 96559498, "body": "Thank you all, I was not used to the <code>interface{}</code> thing, it makes sense now."}], "answers": [{"tags": [], "owner": {"reputation": 1627, "user_id": 4007003, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0a1eb5a369aae01bcd84544bf749d2d7?s=128&d=identicon&r=PG&f=1", "display_name": "Saurav Prakash", "link": "https://stackoverflow.com/users/4007003/saurav-prakash"}, "is_accepted": true, "score": 5, "last_activity_date": 1551174921, "creation_date": 1551174921, "answer_id": 54882771, "question_id": 54882618, "link": "https://stackoverflow.com/questions/54882618/cannot-range-over-eagle-type-interface-with-encoding-json/54882771#54882771", "title": "cannot range over eagle (type interface {}) with &quot;encoding/json&quot;", "body": "<p>There are few issues:</p>\n\n<pre><code>eagle := birds[\"eagle\"] //eagle is of type interface{}\n</code></pre>\n\n<p>so cast it into map:</p>\n\n<pre><code>eagle := birds[\"eagle\"].(map[string]interface{})\n</code></pre>\n\n<p>Now you can iterate over it:</p>\n\n<pre><code>for key, value := range eagle { \n        for _, e := range value.([]interface{}){\n         fmt.Println(key, e.(string))\n        }\n    }\n</code></pre>\n\n<p>value is again interface here.  So first cast to []interface{} and then to string.<br>\nHere is the full working code:\n<a href=\"https://play.golang.org/p/Bdnwit1wBYh\" rel=\"noreferrer\">https://play.golang.org/p/Bdnwit1wBYh</a></p>\n"}], "owner": {"reputation": 43, "user_id": 783744, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xGjYy.png?s=128&g=1", "display_name": "tjoe", "link": "https://stackoverflow.com/users/783744/tjoe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1858, "favorite_count": 1, "accepted_answer_id": 54882771, "answer_count": 1, "score": -1, "last_activity_date": 1551174924, "creation_date": 1551174488, "question_id": 54882618, "link": "https://stackoverflow.com/questions/54882618/cannot-range-over-eagle-type-interface-with-encoding-json", "title": "cannot range over eagle (type interface {}) with &quot;encoding/json&quot;", "body": "<p>I have the following code, I would like range over all the elements or access one element like <code>birds[\"eagle\"[\"quote\"][2]</code> but I cannot figure it out</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\nfunc main() {\n    birdJson := `{\"birds\": {\"pigeon\": {\"quotes\": \"love the pigeons\"}, \"eagle\": {\"quotes\": [\"bird of prey\", \"soar like an eagle\", \"eagle has no fear\"]}}}`\n\n    var result map[string]interface{}\n    json.Unmarshal([]byte(birdJson), &amp;result)\n    birds := result[\"birds\"].(map[string]interface{})\n\n    fmt.Printf(\"%v\\n\",birds)\n    eagle := birds[\"eagle\"]\n\n    for key, value := range eagle {\n        fmt.Println(key, value.(string))\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Nwb0f6cuDUG\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n"}, {"tags": ["numpy", "go", "implementation", "absolute"], "answers": [{"comments": [{"owner": {"reputation": 384, "user_id": 9327848, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210596712787152/picture?type=large", "display_name": "Eden Trainor", "link": "https://stackoverflow.com/users/9327848/eden-trainor"}, "edited": false, "score": 0, "creation_date": 1551199063, "post_id": 54884041, "comment_id": 96549398, "body": "Thank you! That was a very detailed and thorough answer. I now know stuff about I didn&#39;t realise I needed to know! So that&#39;s really helped out more than I thought. So, if I understand correctly, the main difference with each of these is that they deal with different data types, but essentially they (almost) all do a very low level and fast for loop over an array and compare each element to 0?"}, {"owner": {"reputation": 52185, "user_id": 1782792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e8dde1ee800b9687983617bbea3cb9b?s=128&d=identicon&r=PG&f=1", "display_name": "jdehesa", "link": "https://stackoverflow.com/users/1782792/jdehesa"}, "reply_to_user": {"reputation": 384, "user_id": 9327848, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210596712787152/picture?type=large", "display_name": "Eden Trainor", "link": "https://stackoverflow.com/users/9327848/eden-trainor"}, "edited": false, "score": 0, "creation_date": 1551200531, "post_id": 54884041, "comment_id": 96550213, "body": "@EdenTrainor Well, yes, in general terms, you could say that."}], "tags": [], "owner": {"reputation": 52185, "user_id": 1782792, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7e8dde1ee800b9687983617bbea3cb9b?s=128&d=identicon&r=PG&f=1", "display_name": "jdehesa", "link": "https://stackoverflow.com/users/1782792/jdehesa"}, "is_accepted": true, "score": 4, "last_activity_date": 1551178986, "creation_date": 1551178986, "answer_id": 54884041, "question_id": 54882191, "link": "https://stackoverflow.com/questions/54882191/numpy-how-does-np-abs-actually-work-under-the-hood/54884041#54884041", "title": "Numpy: How does np.abs actually work under the hood?", "body": "<p>NumPy source code can be tricky to navigate, because it has so many functions for so many data types. You can find the C-level source code for the absolute value function in the file <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/src/umath/scalarmath.c.src#L505-L554\" rel=\"nofollow noreferrer\"><code>scalarmath.c.src</code></a>. This file is actually a template with function definitions that are later replicated by the build system for several data types. Note each function is the \"kernel\" that is run for each element of the array (looping through the array is done somewhere else). The functions are always called <code>&lt;name of the type&gt;_ctype_absolute</code>, where <code>&lt;name of the type&gt;</code> is the data type it applies to and is generally templated. Let's go through them.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>/**begin repeat\n * #name = ubyte, ushort, uint, ulong, ulonglong#\n */\n\n#define @name@_ctype_absolute @name@_ctype_positive\n\n/**end repeat**/\n</code></pre>\n\n<p>This one is for unsigned types. In this case, the absolute value is the same as <a href=\"https://docs.scipy.org/doc/numpy/reference/generated/numpy.positive.html\" rel=\"nofollow noreferrer\"><code>np.positive</code></a>, which just copies the value without doing anything (it is what you get if you have an array <code>a</code> and you do <code>+a</code>).</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>/**begin repeat\n * #name = byte, short, int, long, longlong#\n * #type = npy_byte, npy_short, npy_int, npy_long, npy_longlong#\n */\nstatic void\n@name@_ctype_absolute(@type@ a, @type@ *out)\n{\n    *out = (a &lt; 0 ? -a : a);\n}\n/**end repeat**/\n</code></pre>\n\n<p>This one is for signed integers. Pretty straightforward.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>/**begin repeat\n * #name = float, double, longdouble#\n * #type = npy_float, npy_double, npy_longdouble#\n * #c = f,,l#\n */\nstatic void\n@name@_ctype_absolute(@type@ a, @type@ *out)\n{\n    *out = npy_fabs@c@(a);\n}\n/**end repeat**/\n</code></pre>\n\n<p>This is for floating-point values. Here <code>npy_fabsf</code>, <code>npy_fabs</code> and <code>npy_fabsl</code> functions are used. These are declared in <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/include/numpy/npy_math.h\" rel=\"nofollow noreferrer\"><code>npy_math.h</code></a>, but defined through templated C code in <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/src/npymath/npy_math_internal.h.src#L455-L471\" rel=\"nofollow noreferrer\"><code>npy_math_internal.h.src</code></a>, essentially calling the <a href=\"https://en.cppreference.com/w/c/numeric/math/fabs\" rel=\"nofollow noreferrer\">C/C99 counterparts</a> (unless C99 is not available, <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/src/npymath/npy_math_internal.h.src#L353-L396\" rel=\"nofollow noreferrer\">in which case <code>fabsf</code> and <code>fabsl</code> are emulated with <code>fabs</code></a>). You might think that the previous code should work as well for floating-point types, but actually these are more complicated, since they have things like NaN, infinity or signed zeros, so it is better to use the standard C functions that deal with everything reliably.</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>static void\nhalf_ctype_absolute(npy_half a, npy_half *out)\n{\n    *out = a&amp;0x7fffu;\n}\n</code></pre>\n\n<p>This is actually not templated, it is the absolute value function for <a href=\"https://en.wikipedia.org/wiki/Half-precision_floating-point_format\" rel=\"nofollow noreferrer\">half-precision floating-point values</a>. Turns out you can change sign by just doing that bitwise operation (set the first bit to 0), since half-precision is simpler (if more limited) than other floating-point types (it's usually the same for those, but with special cases).</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>/**begin repeat\n * #name = cfloat, cdouble, clongdouble#\n * #type = npy_cfloat, npy_cdouble, npy_clongdouble#\n * #rtype = npy_float, npy_double, npy_longdouble#\n * #c = f,,l#\n */\nstatic void\n@name@_ctype_absolute(@type@ a, @rtype@ *out)\n{\n    *out = npy_cabs@c@(a);\n}\n/**end repeat**/\n</code></pre>\n\n<p>This last one is for complex types. These use <code>npy_cabsf</code>, <code>npycabs</code> and <code>npy_cabsl</code> functions, again declared in <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/include/numpy/npy_math.h\" rel=\"nofollow noreferrer\"><code>npy_math.h</code></a> but in this case template-implemented in <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/src/npymath/npy_math_complex.c.src#L1776-L1789\" rel=\"nofollow noreferrer\"><code>npy_math_complex.c.src</code></a> using <a href=\"https://en.cppreference.com/w/c/numeric/complex/cabs\" rel=\"nofollow noreferrer\">C99 functions</a> (unless that is not available, in which case it is <a href=\"https://github.com/numpy/numpy/blob/v1.16.1/numpy/core/src/npymath/npy_math_complex.c.src#L153-L159\" rel=\"nofollow noreferrer\">emulated with <code>np.hypot</code></a>).</p>\n"}], "owner": {"reputation": 384, "user_id": 9327848, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210596712787152/picture?type=large", "display_name": "Eden Trainor", "link": "https://stackoverflow.com/users/9327848/eden-trainor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 829, "favorite_count": 2, "accepted_answer_id": 54884041, "answer_count": 1, "score": 3, "last_activity_date": 1551288490, "creation_date": 1551173161, "last_edit_date": 1551288490, "question_id": 54882191, "link": "https://stackoverflow.com/questions/54882191/numpy-how-does-np-abs-actually-work-under-the-hood", "title": "Numpy: How does np.abs actually work under the hood?", "body": "<p>I'm trying to implement my own absolute function for gonum dense vectors in Go. I'm wandering if there's a better way of getting the absolute value of an array than squaring and then square rooting?</p>\n\n<p>My main issue is that I've had to implement my own element wise Newtonian square-root function on these vectors and there's a balance between implementation speed and accuracy. If I could avoid using this square-root function I'd be happy.</p>\n"}, {"tags": ["c++", "go", "cgo", "seh"], "comments": [{"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551171211, "post_id": 54881516, "comment_id": 96532333, "body": "If you have a simple C++ program that calls <code>GetEngineObject</code>, does it work, or does it crash as well? Where does this <code>GetEngineObject</code> function come from? What does it do? Can you debug and possibly fix problems in it?"}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551171668, "post_id": 54881516, "comment_id": 96532592, "body": "I haven&#39;t run it just from C++, but I can try it. It is a proprietary library, I just have the header and dll. It does all sorts of things, not just loading the &quot;engine&quot;, but also checks the licence key (the <code>sn</code> param) with a licence server, initializes the engine (loads some data from the disk), and maybe other things too.  How can I debug it? Can I use Visual Studio, or somehow the mingw&#39;s gdb?"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551171832, "post_id": 54881516, "comment_id": 96532677, "body": "Then if the crash is inside <code>GetEngineObject</code> you can&#39;t really debug it. You have to make sure that you&#39;re calling it correctly with valid arguments, and then create a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a> that you can send with a bug-report to the makers of the DLL."}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551172915, "post_id": 54881516, "comment_id": 96533303, "body": "I can try, but it is strange, that on win8 it works, and on win10 and win2016 it makes the  same <code>Exception 0x40010006</code> (<code>DBG_PRINTEXCEPTION_C</code>)."}, {"owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "reply_to_user": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551176925, "post_id": 54881516, "comment_id": 96535797, "body": "I&#39;ve tried to run the function from C. Compiled the <code>lib.cpp</code> to lib.o with <code>g++</code> and have written a <code>test.c</code> where I just call the <code>LoadEngine</code> function from <code>lib.h</code> and it works. Maybe there is something about how go links the library?"}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551177193, "post_id": 54881516, "comment_id": 96535980, "body": "Then start by making sure that the string argument is passed correctly. If it is then look closer how you build your Go application and how you link with the C++ code. Beyond that I can&#39;t help you more myself."}, {"owner": {"reputation": 361191, "user_id": 440558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/9ZYta.jpg?s=128&g=1", "display_name": "Some programmer dude", "link": "https://stackoverflow.com/users/440558/some-programmer-dude"}, "edited": false, "score": 0, "creation_date": 1551177331, "post_id": 54881516, "comment_id": 96536059, "body": "You may also want to edit your question to say that calling <code>GetEngineObject</code> from a C or C++ program works as expected. And remember that editing pushes your question back onto the front-page, so careful and gradual improvement of the question over a day or two should give it more exposure."}], "answers": [{"tags": [], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "is_accepted": true, "score": 0, "last_activity_date": 1551269120, "creation_date": 1551269120, "answer_id": 54905113, "question_id": 54881516, "link": "https://stackoverflow.com/questions/54881516/golang-cgo-exception-0x40010006/54905113#54905113", "title": "Golang CGO Exception 0x40010006", "body": "<p>For some reason on win10+ it would raise the <code>DBG_PRINTEXCEPTION_C</code>. Which is caused by the <code>OutputDebugStringW</code> and no debugger is listening.</p>\n\n<p>I think normally it would be done with microsoft's <a href=\"https://docs.microsoft.com/en-us/cpp/cpp/try-except-statement?view=vs-2017\" rel=\"nofollow noreferrer\">__try and __except</a>, but in MinGW is just __try1 and __except1, which I think only works on 32bit systems (very little documentation is to that)</p>\n\n<p>But I found, that you can add a <a href=\"https://docs.microsoft.com/sk-sk/windows/desktop/Debug/vectored-exception-handling\" rel=\"nofollow noreferrer\">Exception Handler</a></p>\n\n<p>so now lib.cpp:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;Engine.h&gt; //the library\n#ifdef _WIN32\n#include &lt;windows.h&gt;\n\nLONG WINAPI VectoredHandler(struct _EXCEPTION_POINTERS *ExceptionInfo) {\n   UNREFERENCED_PARAMETER(ExceptionInfo);  \n   return EXCEPTION_CONTINUE_EXECUTION;  //just continue\n}\n#endif\n\n\nvoid* LoadEngine(char *sn) {\n#ifdef _WIN32\n  PVOID handler = AddVectoredContinueHandler(1, VectoredHandler);\n#endif\n  Engine *e;\n  GetEngineObject(sn, &amp;e);\n#ifdef _WIN32\n  RemoveVectoredContinueHandler(handler); \n#endif\n  return (void*) e;\n}\n</code></pre>\n\n<p>Because using the library starts with loading the engine and ends with unloading it, and the engine is a singleton, I've just made the <code>PVOID handler</code> also a global singleton and the <code>AddVectoredContinueHandler</code> is in <code>LoadEngine</code> and <code>RemoveVectoredContinueHandler</code> is in <code>UnloadEngine</code>.</p>\n"}], "owner": {"reputation": 2892, "user_id": 685395, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/85df783760deaebcd9050a5d49da0b65?s=128&d=identicon&r=PG", "display_name": "microo8", "link": "https://stackoverflow.com/users/685395/microo8"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 295, "favorite_count": 0, "accepted_answer_id": 54905113, "answer_count": 1, "score": 1, "last_activity_date": 1551269120, "creation_date": 1551170909, "last_edit_date": 1551179667, "question_id": 54881516, "link": "https://stackoverflow.com/questions/54881516/golang-cgo-exception-0x40010006", "title": "Golang CGO Exception 0x40010006", "body": "<p>Im trying to run a function from a dll using cgo. The library is in c++ so I created a C header here are the functions defined and a <code>.cpp</code> file where is the implementation.</p>\n\n<p>lib.h:</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>#ifdef __cplusplus\nextern \"C\" {\n#endif\n\nvoid* LoadEngine(char*);\n\n#ifdef __cplusplus\n}\n#endif\n\n</code></pre>\n\n<p>lib.cpp:</p>\n\n<pre class=\"lang-cpp prettyprint-override\"><code>#include &lt;Engine.h&gt; //the library\n\nvoid* LoadEngine(char *sn) {\n  Engine *e;\n  GetEngineObject(sn, &amp;e); //function from the dll, here it fails\n  return (void*) e;\n}\n</code></pre>\n\n<p>then calling it with:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\n/*\n#include \"lib.h\"\n*/\nimport \"C\"\n\nfunc main() {\n  e := C.LoadEngine(C.CString(\"foobar\")\n  ...\n}\n</code></pre>\n\n<p>I have <code>go1.12 windows/amd64</code>\nand <code>mingw-w64-posix-seh</code></p>\n\n<p>tried also <code>mingw-w64-posix-sjlj</code>, <code>mingw-w64-win32-seh</code>, <code>mingw-w64-win32-sjlj</code>, but the result is the same, or it doesn't compile at all</p>\n\n<p>compiling it just with <code>go build</code> and:</p>\n\n<pre><code>#cgo windows CFLAGS: -IC:/Engine/Inc\n#cgo windows CPPFLAGS: -IC:/Engine/Inc\n#cgo windows LDFLAGS: -LC:/Engine/Bin64 -lEngine -lEngineObj -lole32 -loleaut32 -luuid\n\n</code></pre>\n\n<p>On win8 it runs ok, but on win10+ it doesn't work, if the function gets to calling the <code>GetEngineObject</code> which is from the dll, it fails with:</p>\n\n<pre><code>Exception 0x40010006 0x1 0x8deb90 0x7ffbc9ada388\nPC=0x7ffbc9ada388\n\nruntime: unknown pc 0x7ffbc9ada388\nstack: frame={sp:0x8dea80, fp:0x0} stack=[0x0,0x8dfdf0)\n00000000008de980:  0000000002000002  000000002a080321\n00000000008de990:  0000000090000191  0000000000000321\n00000000008de9a0:  0000000500000008  0000000500000000\n00000000008de9b0:  feeefeeefeeefeee  00000000024c0150\n00000000008de9c0:  0000000000000000  0000000000000000\n00000000008de9d0:  00000000024c0000  00007ffbccb730ac\n00000000008de9e0:  0000000002680000  00000000024c1e30\n00000000008de9f0:  00000000026a2d90  00000000026ad480\n00000000008dea00:  0000000000000df1  0000000000000000\n00000000008dea10:  0000000000000df1  0000000000000df1\n00000000008dea20:  0000000000001bf8  0000000000000000\n00000000008dea30:  0000000090000191  0000000000000003\n00000000008dea40:  0000bcc3daf1f4cb  00000000026a2d00\n00000000008dea50:  0000000000000000  000002fffb442d78\n00000000008dea60:  0000000000000000  00000000008dfb00\n00000000008dea70:  0000000000000020  00007ffbc9ada388\n00000000008dea80: &lt;00000000024c0000  000000002fbe1490\n00000000008dea90:  00000000008df970  00000000ffffffff\n00000000008deaa0:  0000000040010006  0000000000000000\n00000000008deab0:  00007ffbc9ada388  0000000000000002\n00000000008deac0:  0000000000000001  00000000008deb90\n00000000008dead0:  00000000001b0150  0000000000800000\n00000000008deae0:  00000000026ad480  0000000000000000\n00000000008deaf0:  00000000001b10b0  0000000000690000\n00000000008deb00:  00000000024c0000  00007ffbccbbcafa\n00000000008deb10:  00000000024c0000  00007ffbccb76ff8\n00000000008deb20:  00000000026a2d90  00000000026a9c30\n00000000008deb30:  0000000000000000  0000000000000001\n00000000008deb40:  00002c98037a65f6  000000000000001f\n00000000008deb50:  00000000026a9430  000000002fd8a367\n00000000008deb60:  0000000000006000  00000000024c0000\n00000000008deb70:  0000000000000df1  0000000000000000\nruntime: unknown pc 0x7ffbc9ada388\nstack: frame={sp:0x8dea80, fp:0x0} stack=[0x0,0x8dfdf0)\n00000000008de980:  0000000002000002  000000002a080321\n00000000008de990:  0000000090000191  0000000000000321\n00000000008de9a0:  0000000500000008  0000000500000000\n00000000008de9b0:  feeefeeefeeefeee  00000000024c0150\n00000000008de9c0:  0000000000000000  0000000000000000\n00000000008de9d0:  00000000024c0000  00007ffbccb730ac\n00000000008de9e0:  0000000002680000  00000000024c1e30\n00000000008de9f0:  00000000026a2d90  00000000026ad480\n00000000008dea00:  0000000000000df1  0000000000000000\n00000000008dea10:  0000000000000df1  0000000000000df1\n00000000008dea20:  0000000000001bf8  0000000000000000\n00000000008dea30:  0000000090000191  0000000000000003\n00000000008dea40:  0000bcc3daf1f4cb  00000000026a2d00\n00000000008dea50:  0000000000000000  000002fffb442d78\n00000000008dea60:  0000000000000000  00000000008dfb00\n00000000008dea70:  0000000000000020  00007ffbc9ada388\n00000000008dea80: &lt;00000000024c0000  000000002fbe1490\n00000000008dea90:  00000000008df970  00000000ffffffff\n00000000008deaa0:  0000000040010006  0000000000000000\n00000000008deab0:  00007ffbc9ada388  0000000000000002\n00000000008deac0:  0000000000000001  00000000008deb90\n00000000008dead0:  00000000001b0150  0000000000800000\n00000000008deae0:  00000000026ad480  0000000000000000\n00000000008deaf0:  00000000001b10b0  0000000000690000\n00000000008deb00:  00000000024c0000  00007ffbccbbcafa\n00000000008deb10:  00000000024c0000  00007ffbccb76ff8\n00000000008deb20:  00000000026a2d90  00000000026a9c30\n00000000008deb30:  0000000000000000  0000000000000001\n00000000008deb40:  00002c98037a65f6  000000000000001f\n00000000008deb50:  00000000026a9430  000000002fd8a367\n00000000008deb60:  0000000000006000  00000000024c0000\n00000000008deb70:  0000000000000df1  0000000000000000\n\ngoroutine 1 [syscall]:\npath/to/package._Cfunc_LoadEngine(0x23a2c20, 0x0)\n        _cgo_gotypes.go:518 +0x51\npath/to/package.Load(0x4d05ad, 0x1d, 0x0, 0x0, 0x0)\n        C:/Users/microo8/Documents/workspace/src/path/to/package/fre.go:55 +0x89\nmain.main()\n        W:/Workspace/src/path/to/package/test/test.go:12 +0x41\nrax     0x3e00003e\nrbx     0x2fbe1490\nrcx     0xfffffffffffffffe\nrdi     0xffffffff\nrsi     0x8df970\nrbp     0x20\nrsp     0x8dea80\nr8      0x2fca2793\nr9      0x3a0f4c0\nr10     0x2fca2701\nr11     0x26aadb0\nr12     0x8dfb00\nr13     0x0\nr14     0x2fffb442d78\nr15     0x0\nrip     0x7ffbc9ada388\nrflags  0x202\ncs      0x33\nfs      0x53\ngs      0x2b\n</code></pre>\n\n<p>I've also tried to catch the exception with mingw's <code>__try1</code> and <code>__except1</code> but it fails anyways. Tried different mingw versions, using <code>-ldflags=\"-linkmode internal\"</code> but this doesn't compile and <code>-ldflags=\"-linkmode external\"</code> makes also this exception.</p>\n\n<p><em>EDIT:</em> also tried to call the <code>LoadEngine</code> function (from <code>lib.h</code>) from a C program and it works fine. Compiled the <code>lib.cpp</code> with <code>g++</code> to <code>lib.o</code>. And linked it to <code>test.c</code> where I just called the <code>LoadEngine</code> just from <code>main</code> function. So maybe there is something wrong how go links the library to cgo?</p>\n"}, {"tags": ["go", "oauth-2.0", "contacts", "alexa-for-business"], "answers": [{"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 0, "last_activity_date": 1551472784, "last_edit_date": 1551472784, "creation_date": 1551206334, "answer_id": 54892063, "question_id": 54880002, "link": "https://stackoverflow.com/questions/54880002/is-it-possible-to-use-oauth-2-0-for-alexa-for-business/54892063#54892063", "title": "Is it possible to use OAuth 2.0 for Alexa for Business?", "body": "<p>Just heard from an Amazon rep that OAuth is not available for the Alexa for Business API due to several reasons. The API must be accessed using IAM credentials or delegate IAM permissions.</p>\n\n<p>Currently, a way to do this is to build a configuration page where users can supply their Access Key ID and Secret Access Key in the app configuration from the IAM console with the requisite <code>AlexaForBusinessFullAccess</code> policy.</p>\n\n<p>It may also be possible to have the app enabled using the A4B console and create an IAM role from \"Settings\" > \"AVS permissions\" where the user needs to input the \"AVS device maker's AWS account ID\" and \"Amazon ID\".</p>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 54892063, "answer_count": 1, "score": 0, "last_activity_date": 1551472784, "creation_date": 1551164500, "last_edit_date": 1551379743, "question_id": 54880002, "link": "https://stackoverflow.com/questions/54880002/is-it-possible-to-use-oauth-2-0-for-alexa-for-business", "title": "Is it possible to use OAuth 2.0 for Alexa for Business?", "body": "<p>I'm using the Alexa for Business (A4B) API successfully with an Access Key ID and Secret Access Key with the <code>AlexaForBusinessFullAccess</code> IAM policy. However, I'm interested in building an app that other A4B users can use without embedding their Key ID and Key into my app directly.</p>\n\n<p>Is there any way to create an Alexa for Business app that is authorized using an OAuth flow, like a standard Alexa skill?</p>\n\n<p>I'm specifically looking to sync contacts using various A4B contacts APIs including the following:</p>\n\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/a4b/latest/APIReference/API_CreateContact.html\" rel=\"nofollow noreferrer\">CreateContact</a></li>\n<li><a href=\"https://docs.aws.amazon.com/a4b/latest/APIReference/API_DeleteContact.html\" rel=\"nofollow noreferrer\">DeleteContact</a></li>\n</ul>\n\n<p>Information on the API is here but I didn't see anything for OAuth here.</p>\n\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/a4b/latest/APIReference/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/a4b/latest/APIReference/</a></li>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/</a></li>\n</ul>\n\n<p>Some information on auth is here:</p>\n\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/aws/session/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/aws/session/</a></li>\n</ul>\n\n<p>I'm using Go but appreciate any info.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551159799, "post_id": 54878991, "comment_id": 96527500, "body": "In Go you cannot declare methods in one package on types that were defined in another package. To be able to declare <code>GetFactors</code> you would have to move <code>Application</code> into the <code>controllers</code> package."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1551159976, "post_id": 54878991, "comment_id": 96527566, "body": "Go also disallows cyclic imports, e.g. if package A imports package B, then package B cannot import package A, so just keep that in mind when you&#39;re refactor your design."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551160181, "post_id": 54878991, "comment_id": 96527641, "body": "Hello! I am tring to adhere DRY (don&#39;t repeat yourself) concept. So use <code>Application</code> struct in both files are not good idea for my opinion. As variant in <code>factors.go</code> file I changed package name at top as <code>package main</code>. I don&#39;t know why <code>factors.go</code> file don&#39;t see <code>Application</code> struct although both files are in the same package. Do you have any ideas?"}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551160222, "post_id": 54878991, "comment_id": 96527651, "body": "@mkopriva I think the main issue here is that go cannot import package main, and <code>Application</code> can be placed in any package other than <code>main</code>, then it can be used by import that package."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "reply_to_user": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "edited": false, "score": 0, "creation_date": 1551161279, "post_id": 54878991, "comment_id": 96527995, "body": "@cgcgbcbc from different answers I just got confused. I tried to change package name in <code>factors.go</code> file. It didn&#39;t work for me. So can I import <code>main</code> package in <code>factors.go</code> file?"}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "edited": false, "score": 2, "creation_date": 1551161465, "post_id": 54878991, "comment_id": 96528061, "body": "@NurzhanNogerbek <code>main</code> package <b>cannot</b> be imported by other package. You can move <code>Application</code> to package <code>controllers</code>, or create another package, for example, <code>package app</code>. Then you import package controllers or app where you will use <code>Application</code>"}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551162678, "post_id": 54878991, "comment_id": 96528460, "body": "Ok, I created <code>application</code> folder. Inside that folder I created <code>application.go</code> file. Package name is <code>application</code>. How I can call <code>Application</code> struct in <code>factors.go</code> file? Can you show right way please?"}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "edited": false, "score": 1, "creation_date": 1551169285, "post_id": 54878991, "comment_id": 96531341, "body": "@NurzhanNogerbek, reference it using <code>application.Application</code>, just like what you have written in your post: <code>http.ResponseWriter</code>, which reference a type <code>ResponseWriter</code> in package <code>http</code>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1551169331, "post_id": 54878991, "comment_id": 96531367, "body": "@NurzhanNogerbek The best advice is: Start simple, do not complicate your solution by forcing the solution under some random concepts like DRY or SOLID or WHATNOT until you understand how to do this in Go."}], "answers": [{"tags": [], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "is_accepted": true, "score": 2, "last_activity_date": 1551178661, "creation_date": 1551178661, "answer_id": 54883919, "question_id": 54878991, "link": "https://stackoverflow.com/questions/54878991/how-in-golang-use-struct-in-other-package-file/54883919#54883919", "title": "How in Golang use struct in other package file?", "body": "<p>Well, finally I decided to redesign the project structure.</p>\n\n<pre><code>main.go\nroutes\n    routes.go\ncontrollers\n    factors.go\nmodels\n    factors.go\n</code></pre>\n\n<p><strong>main.go</strong>:</p>\n\n<pre><code>import (\n    \"your_project_name/routes\"\n)\n\nfunc main()  {\n    // code\n    router := mux.NewRouter()\n    routes.Use(router)\n    // code\n}\n</code></pre>\n\n<p><strong>routes/routes.go</strong>:</p>\n\n<pre><code>package routes\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"your_application_name/controllers\"\n)\n\nfunc Use(router *mux.Router) {\n    router.HandleFunc(\"/api/factors\", controllers.GetFactors).Methods(\"GET\")\n}\n</code></pre>\n\n<p><strong>controllers/factors.go</strong>:</p>\n\n<pre><code>package controllers\n\nvar GetFactors = func(res http.ResponseWriter, req *http.Request) {\n    // code\n}\n</code></pre>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 0, "accepted_answer_id": 54883919, "answer_count": 1, "score": 1, "last_activity_date": 1551178661, "creation_date": 1551159199, "question_id": 54878991, "link": "https://stackoverflow.com/questions/54878991/how-in-golang-use-struct-in-other-package-file", "title": "How in Golang use struct in other package file?", "body": "<p>I am new in <strong>Golang</strong> and need some help.</p>\n\n<p>As you can see in the code below I am tring to create REST API in Golang. I use <code>mux</code> (Gorilla Mux) and <code>pq</code> (PostgreSQL driver) as third party libraries. Don't want to use ORM.</p>\n\n<p>Inside <code>application.go</code> file I have <code>InitializeRoutes</code> function with a list of all aviable routes. <code>GetFactors</code> function process one of these routes. I am tring to define <code>GetFactors</code> function logic in other file called <code>factors.go</code>. Inside <code>factors.go</code> file I want to use <code>Application</code> struct which was defined in <code>application.go</code>. How to make it correctly? Right now as you can see they are in different packages. For thats why <code>factors.go</code> file don't see <code>Application</code> struct.</p>\n\n<p><strong>Project structure</strong>:</p>\n\n<pre><code>main.go\napplication.go\ncontrollers\n    factors.go\n</code></pre>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>package main\n\nfunc main()  {\n    application := Application{}\n    application.Initialization()\n    application.Run(\"localhost:8000\")\n}\n</code></pre>\n\n<p><strong>application.go</strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"rest-api/configurations\"\n)\n\ntype Application struct {\n    Router *mux.Router\n    Database *sql.DB\n}\n\nfunc (application *Application) Initialization() {\n    var err error\n    application.Database, err = configurations.DatabaseConnection()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    application.Router = mux.NewRouter()\n    application.Router.StrictSlash(true)\n\n    application.InitializeRoutes()\n}\n\nfunc (application *Application) Run(address string) {\n    log.Fatal(http.ListenAndServe(address, application.Router))\n}\n\nfunc (application *Application) InitializeRoutes() {\n    application.Router.HandleFunc(\"/api/factors\", application.GetFactors).Methods(\"GET\")\n    // other code\n}\n</code></pre>\n\n<p><strong>controllers/factors.go</strong>:</p>\n\n<pre><code>package controllers\n\nimport (\n    \"net/http\"\n)\n\nfunc (application *Application) GetFactors(rw http.ResponseWriter, request *http.Request) {\n    // code\n}\n</code></pre>\n"}, {"tags": ["go", "graphql", "vue-apollo"], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "edited": false, "score": 0, "creation_date": 1551166999, "post_id": 54878037, "comment_id": 96530267, "body": "Thank you for the response.  I believe the only thing holding me from solving this now is how to get the <code>rBody.Variables</code>.  That is, go is informing me that type <code>reqBody</code> doesn&#39;t have a field <code>Variables</code>.  I&#39;ve been searching for a while to no avail; do you know explicitly how to retrieve the variables from an http.Request?"}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "reply_to_user": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "edited": false, "score": 0, "creation_date": 1551167742, "post_id": 54878037, "comment_id": 96530611, "body": "@EnigmaTaco what is the type declaration of struct reqBody? It is possible that you need declare this field in reqBody."}, {"owner": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "edited": false, "score": 0, "creation_date": 1551170452, "post_id": 54878037, "comment_id": 96531919, "body": "reqBody only has one field: <code>type reqBody struct {Query string </code>json:&quot;query&quot;<code>}</code> (I believe this is from the <code>http</code> package).  I suppose my confusion right now is &quot;How do I take my variables from my POST request (made with apollo) and put them into a variable of type <code>map[string]interface</code> to pass to <code>ExecuteQuery</code> from your answer?&quot;"}, {"owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "reply_to_user": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "edited": false, "score": 0, "creation_date": 1551174233, "post_id": 54878037, "comment_id": 96534162, "body": "@EnigmaTaco I don&#39;t think it is from <code>http</code> package, if so, it should be named <code>ReqBody</code>. However, note that <code>json.NewDecoder(r.Body).Decode(&amp;rBody)</code> does not require <code>rBody</code> be a certain type, you can declare your own type, for example <code>MyReqBody</code>, which has the desired field, then use it as the type of <code>rBody</code> and it will have those values after decoding <code>r.Body</code>"}, {"owner": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "edited": false, "score": 0, "creation_date": 1551204509, "post_id": 54878037, "comment_id": 96552328, "body": "You were absolutely right!  I apologize as I&#39;m still quite new to Go.  I just needed to add the field <code>Variables map[string]interface{} `json:&quot;variables&quot;`</code> to the struct <code>reqBody</code> (which I incorrectly though was built into the http package), then passed <code>rBody.Variables</code> to my <code>ExecuteQuery</code> function as in your answer."}], "tags": [], "owner": {"reputation": 519, "user_id": 2581091, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/66f370089ac9ea8c0c90633420667a1a?s=128&d=identicon&r=PG", "display_name": "cgcgbcbc", "link": "https://stackoverflow.com/users/2581091/cgcgbcbc"}, "is_accepted": true, "score": 0, "last_activity_date": 1551168397, "last_edit_date": 1551168397, "creation_date": 1551151780, "answer_id": 54878037, "question_id": 54877017, "link": "https://stackoverflow.com/questions/54877017/vue-apollo-variables-are-not-added-to-graphql-query-or-i-am-not-correctly-acce/54878037#54878037", "title": "Vue Apollo: variables are not added to graphql query, or I am not correctly accepting them on the backend (Golang)", "body": "<p>For your question, the data receiving in your backend is correct, the query itself does not contain the query parameter, the query parameter is sent via <code>variables</code> key.</p>\n\n<p>The response issue is this line <code>result := gql.ExecuteQuery(rBody.Query, *s.GqlSchema)</code>.\n<code>variables</code> from the request body need also be passed to <code>ExecuteQuery</code>. An example implementation using <code>graphql-go/graphql</code> <code>Do</code> function can be</p>\n\n<pre><code>func executeQuery(query string, schema graphql.Schema, variables map[string]interface{}) *graphql.Result {\n    result := graphql.Do(graphql.Params{\n        Schema:        schema,\n        RequestString: query,\n        VariableValues: variables\n    })\n    if len(result.Errors) &gt; 0 {\n        fmt.Printf(\"errors: %v\", result.Errors)\n    }\n    return result\n}\n</code></pre>\n\n<p>And an example of type <code>reqBody</code> can be</p>\n\n<pre><code>type reqBody struct {\n    Query string\n    Variables map[string]interface{}\n}\n</code></pre>\n\n<p>Then <code>json.NewDecoder(r.Body).Decode(&amp;rBody)</code> will automatically set Query and Variables</p>\n"}], "owner": {"reputation": 13, "user_id": 11116667, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9816ce3dbf5eeef878b20b67cc3c5618?s=128&d=identicon&r=PG&f=1", "display_name": "EnigmaTaco", "link": "https://stackoverflow.com/users/11116667/enigmataco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 600, "favorite_count": 0, "accepted_answer_id": 54878037, "answer_count": 1, "score": 1, "last_activity_date": 1551204809, "creation_date": 1551142944, "last_edit_date": 1551204809, "question_id": 54877017, "link": "https://stackoverflow.com/questions/54877017/vue-apollo-variables-are-not-added-to-graphql-query-or-i-am-not-correctly-acce", "title": "Vue Apollo: variables are not added to graphql query, or I am not correctly accepting them on the backend (Golang)", "body": "<p>I cannot seem to get variables in a graphql query made with apollo into the query body to be accepted into backend server.</p>\n\n<p>I have a simple vue frontend and go backend.  In a vue-component I have the following query:</p>\n\n<pre><code>apollo: {\n    entry: {\n      query: gql`\n        query variables($userID: Int){\n          entries(userID: $userID) {\n            id,\n            value,\n            timeStamp\n          }\n        }\n      `,\n      variables() {\n        return {\n          userID: 2\n        }\n      },\n\n      update: data =&gt; data,\n    }\n  }\n}\n</code></pre>\n\n<p>On my go backend I nave the handler function for all POST requests</p>\n\n<pre><code>// GraphQL returns an http.HandlerFunc for our /graphql endpoint\nfunc (s *Server) GraphQL() http.HandlerFunc {\n    return func(w http.ResponseWriter, r *http.Request) {\n        //Allow CORS here By * or specific origin\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\n        w.Header().Set(\"Access-Control-Allow-Headers\", \"Content-Type\")\n        // Check to ensure query was provided in the request body\n        if r.Body == nil {\n            http.Error(w, \"Must provide graphql query in request body\", 400)\n            return\n        }\n\n        var rBody reqBody\n        // Decode the request body into rBody\n        err := json.NewDecoder(r.Body).Decode(&amp;rBody)\n        if err != nil {\n            http.Error(w, \"Error parsing JSON request body\", 400)\n        }\n\n        fmt.Println(rBody.Query)\n\n        // Execute graphql query\n        result := gql.ExecuteQuery(rBody.Query, *s.GqlSchema)\n\n        // render.JSON comes from the chi/render package and handles\n        // marshalling to json, automatically escaping HTML and setting\n        // the Content-Type as application/json.\n        render.JSON(w, r, result)\n    }\n}\n</code></pre>\n\n<p>When I run the query, I am returned {\"entries\" : null}.  When I print out the query that was sent to my go server, I get the following:</p>\n\n<pre><code>query variables($userID: Int) {\n  entries(userID: $userID) {\n    id\n    value\n    timeStamp\n    __typename\n  }\n}\n</code></pre>\n\n<p>In line 2 of this I would hope to see entries(userID: 2).  Indeed, if I remove the variables from my query made in vue, and hardcode the userID in the query, everything works.</p>\n\n<p>I checked to make sure the variable is being sent in someway, which if I look at the POST request made it has the following in the parameters:</p>\n\n<pre><code>operationName   variables\nquery   query variables($userID: Int) { entries(userID: $userID) { id value timeStamp __typename } }\nvariables   {\u2026}\nuserID  2\n</code></pre>\n\n<p>Am I not accepting the data correctly on my backend, as the variable userID is being sent in the POST request?</p>\n\n<p><strong>Solution:</strong> Thanks to @cgcgbcbc for the solution.  My <code>reqBody</code> struct was the following:</p>\n\n<pre><code>type reqBody struct {\n    Query     string                 `json:\"query\"`\n}\n</code></pre>\n\n<p>When it should be:</p>\n\n<pre><code>type reqBody struct {\n    Query     string                 `json:\"query\"`\n    Variables map[string]interface{} `json:\"variables\"`\n}\n</code></pre>\n\n<p>Then I just needed to pass <code>rBody.Variables</code> to my <code>ExecuteQuery</code> function as in his solution.</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 381813, "user_id": 1863229, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/4sh1l.png?s=128&g=1", "display_name": "Tim Biegeleisen", "link": "https://stackoverflow.com/users/1863229/tim-biegeleisen"}, "edited": false, "score": 0, "creation_date": 1551143476, "post_id": 54876997, "comment_id": 96524049, "body": "To ask the obvious, have tried putting a backslash before the <code>?</code> ?"}, {"owner": {"reputation": 71, "user_id": 3168703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bae5ebdee158aab9f0bed5b24ff9ded?s=128&d=identicon&r=PG", "display_name": "Pedro Piter", "link": "https://stackoverflow.com/users/3168703/pedro-piter"}, "edited": false, "score": 0, "creation_date": 1551146333, "post_id": 54876997, "comment_id": 96524599, "body": "I tried backslash before the ? (sigle and double backslash) and none of them worked.  In the database the table pages has some rows with the value  &#39;my.url.com?param=23/&#39; in  the column url"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "edited": false, "score": 0, "creation_date": 1551146850, "post_id": 54876997, "comment_id": 96524727, "body": "Do you have problems querying those without a question mark?"}, {"owner": {"reputation": 7007, "user_id": 10195153, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VnLka.jpg?s=128&g=1", "display_name": "danblack", "link": "https://stackoverflow.com/users/10195153/danblack"}, "edited": false, "score": 1, "creation_date": 1551147974, "post_id": 54876997, "comment_id": 96524942, "body": "Guess - make the url value a parameter in the prepared statement and then pass the url as a parameter in <code>Query()</code>"}, {"owner": {"reputation": 458695, "user_id": 20860, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/iavmP.jpg?s=128&g=1", "display_name": "Bill Karwin", "link": "https://stackoverflow.com/users/20860/bill-karwin"}, "edited": false, "score": 3, "creation_date": 1551147982, "post_id": 54876997, "comment_id": 96524945, "body": "<code>stmt.Query()</code> really should not replace any <code>&#39;?&#39;</code> that is inside an SQL string literal, that is within the single-quotes. In SQL, parameter placeholders are treated as a literal ? character if they are part of an SQL string literal. I think you are mistaken, and the content in your database is simply not matching the pattern you&#39;re searching for."}, {"owner": {"reputation": 71, "user_id": 3168703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bae5ebdee158aab9f0bed5b24ff9ded?s=128&d=identicon&r=PG", "display_name": "Pedro Piter", "link": "https://stackoverflow.com/users/3168703/pedro-piter"}, "edited": false, "score": 0, "creation_date": 1551176021, "post_id": 54876997, "comment_id": 96535297, "body": "There were blank spaces in the database, that&#39;s why it didn&#39;t retrieve any row."}], "owner": {"reputation": 71, "user_id": 3168703, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0bae5ebdee158aab9f0bed5b24ff9ded?s=128&d=identicon&r=PG", "display_name": "Pedro Piter", "link": "https://stackoverflow.com/users/3168703/pedro-piter"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 809, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1551166864, "creation_date": 1551142743, "last_edit_date": 1551166864, "question_id": 54876997, "link": "https://stackoverflow.com/questions/54876997/using-question-mark-within-query-in-golang", "title": "Using question mark within query in golang", "body": "<p>I'm creating a query to select rows with a given URL.</p>\n\n<p>I'm using this code to create the query and retrieve the data</p>\n\n<pre><code>  pages_query := `\n            SELECT id\n            FROM   pages\n            WHERE  url = 'my.url.com?param=23/'`\n  stmt, err := datastore.DB.Prepare(pages_query)\n  rows, err := stmt.Query()\n\n</code></pre>\n\n<p>But it does not retrieve any data, though there are records matching that query in the database.</p>\n\n<p>I believe that is because the stmt.Query() replaces the '?' with none, but I haven't been able to scape it. </p>\n\n<p>How could I scape that question mark? </p>\n"}, {"tags": ["docker", "go", "dll", "go-build"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551143255, "post_id": 54876934, "comment_id": 96524010, "body": "What does it say when you try to execute the binary in docker?"}, {"owner": {"reputation": 111, "user_id": 2181037, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/41437f86312d1638322280b035a452d3?s=128&d=identicon&r=PG", "display_name": "wzf1943", "link": "https://stackoverflow.com/users/2181037/wzf1943"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551143517, "post_id": 54876934, "comment_id": 96524059, "body": "Nothing outputs"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551143699, "post_id": 54876934, "comment_id": 96524098, "body": "If there&#39;s no output, it doesn&#39;t seem like there&#39;s an error starting execution then. A static binary should run the same on most linux systems. You need to add some more debugging to see what&#39;s going on."}, {"owner": {"reputation": 111, "user_id": 2181037, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/41437f86312d1638322280b035a452d3?s=128&d=identicon&r=PG", "display_name": "wzf1943", "link": "https://stackoverflow.com/users/2181037/wzf1943"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551144128, "post_id": 54876934, "comment_id": 96524175, "body": "But run this binary in linux VM works well. Nothing weird happened"}, {"owner": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1551147988, "post_id": 54876934, "comment_id": 96524947, "body": "It seems like the &quot;targetBinary&quot; is missing a file type?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 999, "user_id": 1584308, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/YAV1v.png?s=128&g=1", "display_name": "hewiefreeman", "link": "https://stackoverflow.com/users/1584308/hewiefreeman"}, "edited": false, "score": 0, "creation_date": 1551205953, "post_id": 54876934, "comment_id": 96553019, "body": "@newplayer65: what is a &quot;file type&quot; and how could it be missing?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1551206096, "post_id": 54876934, "comment_id": 96553104, "body": "@wzf1943: the fact that it runs on another VM is further evidence that there&#39;s nothing wrong with the binary. You need add more debugging to figure why it&#39;s exiting early. What was the exit code? What does it do under strace? Does it require any particular files or resources form the system? If you want help with this, we need to have an <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>, or at least a lot more information."}], "owner": {"reputation": 111, "user_id": 2181037, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/41437f86312d1638322280b035a452d3?s=128&d=identicon&r=PG", "display_name": "wzf1943", "link": "https://stackoverflow.com/users/2181037/wzf1943"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551142102, "creation_date": 1551142102, "question_id": 54876934, "link": "https://stackoverflow.com/questions/54876934/how-to-use-go-build-to-create-a-dynamic-executable-binary-file-that-can-run-in-d", "title": "How to use go build to create a dynamic executable binary file that can run in docker container?", "body": "<p>I use cross compile to compile a linux version binary on Mac. </p>\n\n<pre><code>GOOS=linux GOARCH=amd64 go build\n</code></pre>\n\n<p>Also tried the other command that I found on stack overflow. </p>\n\n<pre><code>GOOS=linux GOARCH=amd64 CGO_ENABLED=0 go build -o targetBinary\n</code></pre>\n\n<p>This binary can run in Linux VM. But when I copy this binary to a linux docker container and run it. It can not run anymore. </p>\n\n<p>My docker file is like this</p>\n\n<pre><code>FROM oraclelinux:7.5\nCOPY targetBinary /\n</code></pre>\n\n<p>I also use ldd to check target and docker reports this result</p>\n\n<pre><code>[root@7578c118fe27 /]# ldd targetBinary\n    not a dynamic executable\n</code></pre>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 404, "user_id": 5716089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tqyYO.png?s=128&g=1", "display_name": "Kelly Flet", "link": "https://stackoverflow.com/users/5716089/kelly-flet"}, "edited": false, "score": 1, "creation_date": 1551138081, "post_id": 54876317, "comment_id": 96522794, "body": "That worked as expected, thanks. I hope others can find this useful as my search was unfruitful."}, {"owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "reply_to_user": {"reputation": 404, "user_id": 5716089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tqyYO.png?s=128&g=1", "display_name": "Kelly Flet", "link": "https://stackoverflow.com/users/5716089/kelly-flet"}, "edited": false, "score": 1, "creation_date": 1551177566, "post_id": 54876317, "comment_id": 96536162, "body": "@KellyFlet Glad to help; Nice rhyme there xD"}], "tags": [], "owner": {"reputation": 13022, "user_id": 230340, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/3591e9adea97943ab462c84b0745e110?s=128&d=identicon&r=PG", "display_name": "Zippo", "link": "https://stackoverflow.com/users/230340/zippo"}, "is_accepted": true, "score": 7, "last_activity_date": 1551137458, "creation_date": 1551137458, "answer_id": 54876317, "question_id": 54876209, "link": "https://stackoverflow.com/questions/54876209/find-all-documents-in-a-collection-with-mongo-go-driver/54876317#54876317", "title": "Find all documents in a collection with mongo go driver", "body": "<p>Try passing an empty <code>bson.D</code> instead of <code>nil</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>cursor, err := coll.Find(context.TODO(), bson.D{})\n</code></pre>\n\n<p>Also, <code>FindOptions</code> is optional.</p>\n\n<p>Disclaimer: I've never used the official driver, but there are a few examples at <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"noreferrer\">https://godoc.org/go.mongodb.org/mongo-driver/mongo</a></p>\n\n<p>Seems like their tutorial is outdated :/</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 8810911, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-JbQfe53jpBo/AAAAAAAAAAI/AAAAAAAAIFE/1WB0LqgogZQ/photo.jpg?sz=128", "display_name": "Isaac Muthui", "link": "https://stackoverflow.com/users/8810911/isaac-muthui"}, "is_accepted": false, "score": 6, "last_activity_date": 1569401058, "creation_date": 1569401058, "answer_id": 58094512, "question_id": 54876209, "link": "https://stackoverflow.com/questions/54876209/find-all-documents-in-a-collection-with-mongo-go-driver/58094512#58094512", "title": "Find all documents in a collection with mongo go driver", "body": "<p>Here is what I came up with using the official MongoDB driver for golang. I am using godotenv (<a href=\"https://github.com/joho/godotenv\" rel=\"noreferrer\">https://github.com/joho/godotenv</a>) to pass the database parameters.</p>\n\n<pre><code>//Find multiple documents\nfunc FindRecords() {\n    err := godotenv.Load()\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    //Get database settings from env file\n    //dbUser := os.Getenv(\"db_username\")\n    //dbPass := os.Getenv(\"db_pass\")\n    dbName := os.Getenv(\"db_name\")\n    docCollection := \"retailMembers\"\n\n    dbHost := os.Getenv(\"db_host\")\n    dbPort := os.Getenv(\"db_port\")\n    dbEngine := os.Getenv(\"db_type\")\n\n    //set client options\n    clientOptions := options.Client().ApplyURI(\"mongodb://\" + dbHost + \":\" + dbPort)\n    //connect to MongoDB\n    client, err := mongo.Connect(context.TODO(), clientOptions)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    //check the connection\n    err = client.Ping(context.TODO(), nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(\"Connected to \" + dbEngine)\n    db := client.Database(dbName).Collection(docCollection)\n\n    //find records\n    //pass these options to the Find method\n    findOptions := options.Find()\n    //Set the limit of the number of record to find\n    findOptions.SetLimit(5)\n    //Define an array in which you can store the decoded documents\n    var results []Member\n\n    //Passing the bson.D{{}} as the filter matches  documents in the collection\n    cur, err := db.Find(context.TODO(), bson.D{{}}, findOptions)\n    if err !=nil {\n        log.Fatal(err)\n    }\n    //Finding multiple documents returns a cursor\n    //Iterate through the cursor allows us to decode documents one at a time\n\n    for cur.Next(context.TODO()) {\n        //Create a value into which the single document can be decoded\n        var elem Member\n        err := cur.Decode(&amp;elem)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        results =append(results, elem)\n\n    }\n\n    if err := cur.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    //Close the cursor once finished\n    cur.Close(context.TODO())\n\n    fmt.Printf(\"Found multiple documents: %+v\\n\", results)\n\n\n}\n</code></pre>\n"}], "owner": {"reputation": 404, "user_id": 5716089, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tqyYO.png?s=128&g=1", "display_name": "Kelly Flet", "link": "https://stackoverflow.com/users/5716089/kelly-flet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9850, "favorite_count": 1, "accepted_answer_id": 54876317, "answer_count": 2, "score": 5, "last_activity_date": 1569401058, "creation_date": 1551136907, "question_id": 54876209, "link": "https://stackoverflow.com/questions/54876209/find-all-documents-in-a-collection-with-mongo-go-driver", "title": "Find all documents in a collection with mongo go driver", "body": "<p>I checked out the answer <a href=\"https://stackoverflow.com/questions/24681047/how-do-you-select-all-records-from-a-mongodb-collection-in-golang-using-mgo\">here</a> but this uses the old and unmaintained mgo. How can I find all documents in a collection using the mongo-go-driver?</p>\n\n<p>I tried passing a <code>nil</code> filter, but this does not return any documents and instead returns <code>nil</code>. I also checked the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/mongo\" rel=\"noreferrer\">documentation</a> but did not see any mention of returning all documents. Here is what I've tried with aforementioned result.</p>\n\n<pre><code>client, err := mongo.Connect(context.TODO(), \"mongodb://localhost:27017\")\ncoll := client.Database(\"test\").Collection(\"albums\")\nif err != nil { fmt.Println(err) }\n// we can assume we're connected...right?\nfmt.Println(\"connected to mongodb\")\n\nvar results []*Album\nfindOptions := options.Find()\ncursor, err := coll.Find(context.TODO(), nil, findOptions)\nif err != nil {\n   fmt.Println(err) // prints 'document is nil'\n}\n</code></pre>\n\n<p>Also, I'm about confused about why I need to specify <code>findOptions</code> when I've called the <code>Find()</code> function on the collection (or do I not need to specify?).</p>\n"}, {"tags": ["go", "alexa-for-business"], "answers": [{"tags": [], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "is_accepted": true, "score": 0, "last_activity_date": 1552084949, "last_edit_date": 1552084949, "creation_date": 1551132827, "answer_id": 54875508, "question_id": 54875481, "link": "https://stackoverflow.com/questions/54875481/how-to-list-contacts-for-alexa-for-business/54875508#54875508", "title": "How to list contacts for Alexa for Business?", "body": "<p>While there isn't a <code>ListContacts</code> API, the <code>SearchContacts</code> API can be used with an empty filter slice in <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/alexaforbusiness/#SearchContactsInput\" rel=\"nofollow noreferrer\"><code>SearchContactsInput</code></a> as follows:</p>\n\n<pre><code>resp, err := svc.SearchContacts(\n    &amp;alexaforbusiness.SearchContactsInput{})\n</code></pre>\n\n<ul>\n<li><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/alexaforbusiness/#AlexaForBusiness.SearchContacts\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/alexaforbusiness/#AlexaForBusiness.SearchContacts</a></li>\n</ul>\n\n<p>For testing purposes, it will also work to have a <code>Filter</code> with an empty <code>Values</code> slice, even if <code>Key</code> is populated.</p>\n"}], "owner": {"reputation": 11161, "user_id": 1908967, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/vPwiV.jpg?s=128&g=1", "display_name": "Grokify", "link": "https://stackoverflow.com/users/1908967/grokify"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 54875508, "answer_count": 1, "score": 0, "last_activity_date": 1552084949, "creation_date": 1551132715, "last_edit_date": 1551133130, "question_id": 54875481, "link": "https://stackoverflow.com/questions/54875481/how-to-list-contacts-for-alexa-for-business", "title": "How to list contacts for Alexa for Business?", "body": "<p>I'm using the AWS Alexa for Business Go SDK and while there are functions for <code>CreateContact</code>, <code>DeleteContact</code>, <code>GetContact</code>, <code>SearchContacts</code>, there isn't a function for <code>ListContacts</code> while there are List APIs for other objects <code>ListConferenceProviders</code>.</p>\n\n<p><a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/alexaforbusiness/\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/api/service/alexaforbusiness/</a></p>\n\n<p>How can one get a list of contacts for Alexa for Business?</p>\n"}, {"tags": ["c++", "go", "visual-studio-code", "swig", "stdafx.h"], "comments": [{"owner": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1551131483, "post_id": 54875174, "comment_id": 96520529, "body": "<b><i>What is the issue?</i></b> I think you are missing a compiler include path for <code>MFC</code> in your Visual Studio Code settings."}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "reply_to_user": {"reputation": 8811, "user_id": 487892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Leb5B.jpg?s=128&g=1", "display_name": "drescherjm", "link": "https://stackoverflow.com/users/487892/drescherjm"}, "edited": false, "score": 0, "creation_date": 1551131806, "post_id": 54875174, "comment_id": 96520644, "body": "@drescherjm do you know how I can access this?"}, {"owner": {"reputation": 28836, "user_id": 4581301, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5580eebb22e2c65c9b2325d2276d92a?s=128&d=identicon&r=PG&f=1", "display_name": "user4581301", "link": "https://stackoverflow.com/users/4581301/user4581301"}, "edited": false, "score": 0, "creation_date": 1551135785, "post_id": 54875174, "comment_id": 96522098, "body": "Before you put too much effort into this, are you using precompiled headers? If not, you may want to remove stdafx.h entirely."}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "edited": false, "score": 0, "creation_date": 1551136055, "post_id": 54875174, "comment_id": 96522179, "body": "Without stdafx.h, i get numerous errors in my program so i assume that i am using precompiled headers"}, {"owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "edited": false, "score": 0, "creation_date": 1551137254, "post_id": 54875174, "comment_id": 96522539, "body": "No i am not using .pch files"}], "owner": {"reputation": 147, "user_id": 10993065, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PZLWmOv3CZA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNmAN159G1YjShfR7djjUTcR0NtlA/mo/photo.jpg?sz=128", "display_name": "Daniel Ramsey", "link": "https://stackoverflow.com/users/10993065/daniel-ramsey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 555, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551132146, "creation_date": 1551131300, "last_edit_date": 1551132146, "question_id": 54875174, "link": "https://stackoverflow.com/questions/54875174/stdafx-h-fatal-error-afxwin-h-no-such-file-or-directory-works-for-2018-vs-co", "title": "stdafx.h: fatal error: afxwin.h: No such file or directory (Works for 2018 VS community but not VS code)", "body": "<p>I read up on a lot on this issue from other posts but I cant find anything specific to my situation.</p>\n\n<p>I have a large project in C++ that complies successfully in VS 2017 community. I am wrapping the same project in Go using SWIG through the program VS code.</p>\n\n<p>Now i get the error over line 1 in Go, \"package main\" </p>\n\n<pre><code># _/C_/Users/daramsey/Desktop/GoWrapC/CameraFinal/CameraFinal\nIn file included from ConnectionRecovery.h:2:0,\n             from ConnectionRecovery.cpp:1:\nstdafx.h:38:64: fatal error: afxwin.h: No such file or directory\ncompilation terminated.(undefined)\n</code></pre>\n\n<p>ConnectionRecovery.h looks like this:</p>\n\n<pre><code>#pragma once\n#include \"stdafx.h\"\n#include \"PvBaseLib.h\"\n#include \"PvBuffer.h\"\n#include \"PvBufferLib.h\"\n#include \"PvSystem.h\"\n#include \"PvTypes.h\"\n\nclass ConnectionRecoveryApp\n{\npublic:\n\n    ConnectionRecoveryApp();\n    ~ConnectionRecoveryApp();\n\n    void startCamera(PvString mConnectionID);\n    uint16_t * retrieveDataPointerPerBuffer(PvPipeline* mPipeline);\n    void stopCamera();\n    vector&lt;PvString&gt;  vectorOfCameras();\n\nprivate:\n\n    PvString mConnectionID;\n    PvDevice* mDevice;\n    PvStream* mStream;\n    PvPipeline* mPipeline;\n\n    int mHeight = 512;\n    int mWidth = 640;\n    bool mbSaveAsCSV;\n\n};\n</code></pre>\n\n<p>Inside my stdafx.h file (which is included header file in project), I find</p>\n\n<pre><code> #include &lt;afxwin.h&gt;         // MFC core and standard components\n #include &lt;afxext.h&gt;         // MFC extensions\n #include &lt;afxdisp.h&gt;        // MFC Automation classes\n #include &lt;afxdhtml.h&gt;\n #include &lt;afxmt.h&gt;\n</code></pre>\n\n<p>When i hit F12 key with my mouse hovering over afxwin.h, I am able to open the contents of the file. Therefore I am assuming that the code should not having an issue with opening the file. </p>\n\n<p>This is the json file for VS Code</p>\n\n<pre><code>{\n\"configurations\": [\n    {\n        \"name\": \"Win32\",\n        \"includePath\": [\n            \"${workspaceFolder}/**\"\n        ],\n        \"defines\": [\n            \"_DEBUG\",\n            \"UNICODE\",\n            \"_UNICODE\"\n        ],\n        \"windowsSdkVersion\": \"10.0.17763.0\",\n        \"compilerPath\": \"C:/Program Files (x86)/Microsoft Visual Studio/2017/Community/VC/Tools/MSVC/14.16.27023/bin/Hostx64/x64/cl.exe\",\n        \"cStandard\": \"c11\",\n        \"cppStandard\": \"c++17\",\n        \"intelliSenseMode\": \"msvc-x64\"\n    }\n],\n\"version\": 4\n}\n</code></pre>\n\n<p>What is the issue? Let me know if you need elaboration.</p>\n"}, {"tags": ["file", "go", "anagram"], "comments": [{"owner": {"reputation": 41, "user_id": 7675076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f831ab2f766478ccab31cbabdcfde2e?s=128&d=identicon&r=PG&f=1", "display_name": "strom73", "link": "https://stackoverflow.com/users/7675076/strom73"}, "edited": false, "score": 0, "creation_date": 1551125912, "post_id": 54873920, "comment_id": 96518033, "body": "Seems it is possible to use arrays, I misunderstood the challenge. Still, my question is still the same, how to read the file line-by-line into an array as fast as possible and also how to set the array as fast as possible?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1551126914, "post_id": 54873920, "comment_id": 96518495, "body": "It might help to use slice of strings instead of concatenating strings: <code>var txtlines = make(map[string][]string)</code>, <code>txtlines[v]  = append(txtlines[v], k)</code>."}, {"owner": {"reputation": 478, "user_id": 3491376, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lh2OC.png?s=128&g=1", "display_name": "Deadooshka", "link": "https://stackoverflow.com/users/3491376/deadooshka"}, "edited": false, "score": 0, "creation_date": 1551139335, "post_id": 54873920, "comment_id": 96523157, "body": "You need another file with sorted letters and corresponding words. That would be an optimization."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1551150735, "post_id": 54873920, "comment_id": 96525489, "body": "imho, you should ask <code>how to find the slowness in this program and how to fix them</code>. you should give a data file to work with. my guess, you ll need to strip all the facilities provided by the stdlib to improve performance, the result will worth the ugliness and complexity. later you might ask if the optimized program is the best one to handle 10 rows or 10 trillions of rows."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 7675076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f831ab2f766478ccab31cbabdcfde2e?s=128&d=identicon&r=PG&f=1", "display_name": "strom73", "link": "https://stackoverflow.com/users/7675076/strom73"}, "edited": false, "score": 0, "creation_date": 1551254594, "post_id": 54881186, "comment_id": 96568752, "body": "I was thinking of implementing some cases like comparison of word length to filter out the non-anagram words - problem is I&#39;m a beginner in Golang and implementing anytthing takes a lot of time : ). Thank you so much for this.   Would implementing goroutines improve the performance of anagrams finding? As I understand, IO probably can&#39;t be improved - it&#39;s limited by read speed and the anagram files are usually less than the default buffer size of bufio (about 1MB?). I&#39;m thinking of implementing goroutines for searching for the anagram match from the dict."}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1551742248, "post_id": 54881186, "comment_id": 96743565, "body": "If you are a beginner with the Go programming language, you should probably use ordinary goroutines from the runtime instead of implementing your own."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1551745284, "post_id": 54881186, "comment_id": 96744170, "body": "@JesseAmano: Your comment makes no sense. Goroutines are part of the Go programming language. See <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Go_statements</a>. Goroutines are taught as part of A Tour of Go, a first course course for Go progammers. See <a href=\"https://tour.golang.org\" rel=\"nofollow noreferrer\">tour.golang.org</a>, in particular <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">tour.golang.org/concurrency/1</a>."}, {"owner": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1551749380, "post_id": 54881186, "comment_id": 96745047, "body": "@peterSO Yes, goroutines are part of the language, so I recommend using them. Implementing your own would be silly, wouldn&#39;t it?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 665, "user_id": 6312602, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-J2fMlfN4Ghc/AAAAAAAAAAI/AAAAAAAAACc/IIPzG0rPYuA/photo.jpg?sz=128", "display_name": "Jesse Amano", "link": "https://stackoverflow.com/users/6312602/jesse-amano"}, "edited": false, "score": 0, "creation_date": 1551751546, "post_id": 54881186, "comment_id": 96745553, "body": "@JesseAmano: &quot;Implementing your own would be silly, wouldn&#39;t it?&quot; Nobody does that! Have you taken A Tour of Go? <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">tour.golang.org</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1551169631, "creation_date": 1551169631, "answer_id": 54881186, "question_id": 54873920, "link": "https://stackoverflow.com/questions/54873920/how-to-optimize-finding-anagrams-from-a-text-file-in-go/54881186#54881186", "title": "How to optimize finding anagrams from a text file in Go", "body": "<p><strong>TL;DR: peterSO is 10X faster than strom73</strong>. </p>\n\n<p>strom73:</p>\n\n<pre><code>$ go build strom73.go &amp;&amp; ./strom73 \"/usr/share/dict/words\" \"restful\"\nFound anagrams:  fluster,restful,\n2019/02/26 02:50:47 anagrams took 150.733904ms\n$ \n</code></pre>\n\n<p>peterSO:</p>\n\n<pre><code>$ go build peterso.go &amp;&amp; ./peterso \"/usr/share/dict/words\" \"restful\"\nFound anagrams:  [restful fluster]\n2019/02/26 02:50:52 anagrams took 15.093098ms\n$ \n</code></pre>\n\n<hr>\n\n<blockquote>\n  <p>How to optimize finding anagrams from a text file in Go</p>\n  \n  <p>I am trying to solve a coding challenge where one must print all\n  anagrams from a text file matching the input string. Program must\n  execute as fast as possible.</p>\n  \n  <p>Currently, I have it down to about 160ms.</p>\n</blockquote>\n\n<p>No test cases are provided.</p>\n\n<hr>\n\n<p>The XY problem is asking about your attempted solution rather than your actual problem: <a href=\"http://xyproblem.info/\" rel=\"noreferrer\">The XY Problem</a>.</p>\n\n<hr>\n\n<p>If we look at <a href=\"https://en.wikipedia.org/wiki/Anagram\" rel=\"noreferrer\">Wikipedia - Anagram</a> we see: An anagram is a word or phrase formed by rearranging the letters of a different word or phrase, typically using all the original letters exactly once. Examples, \"restful\" = \"fluster\", \"funeral\" = \"real fun\", \"rail safety\" = \"fairy tales\". </p>\n\n<p>To solve this problem in Go, we use the Go testing package benchmark facility to measure performance. For example, a sum of letter values, a sort of letter values, and the overall algorithm. We relentlessly dissect each line of code for performance. We order the tests for anagrams starting with the cheapest. For example, sorting letters is expensive, so we first check the number of letters, then a simple sum of letters to filter out many non-anagrams cheaply.</p>\n\n<p>We need something to act as an anagram text file. The Linux word dictionary file (<code>/usr/share/dict/words</code>) is readily available, although it is limited to single words. It uses upper- and lower-case.</p>\n\n<p>Exhaustive benchmarking is exhausting. The law of dimminishing returns has set in. A ten-fold improvement in speed is good enough for now.</p>\n\n<hr>\n\n<p><code>peterso.go:</code></p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"sort\"\n    \"strings\"\n    \"time\"\n)\n\nfunc findAnagrams(find string, text io.Reader) []string {\n    find = strings.ToLower(find)\n    findSum := 0\n    findRunes := []rune(find)\n    j := 0\n    for i, r := range findRunes {\n        if r != ' ' {\n            findSum += int(r)\n            if i != j {\n                findRunes[j] = r\n            }\n            j++\n        }\n    }\n    findRunes = findRunes[:j]\n    sort.Slice(findRunes, func(i, j int) bool { return findRunes[i] &lt; findRunes[j] })\n    findStr := string(findRunes)\n\n    anagrams := []string{find}\n    s := bufio.NewScanner(text)\n    for s.Scan() {\n        word := strings.ToLower(s.Text())\n        wordSum := 0\n        wordRunes := []rune(word)\n        j := 0\n        for i, r := range wordRunes {\n            if r != ' ' {\n                wordSum += int(r)\n                if i != j {\n                    wordRunes[j] = r\n                }\n                j++\n            }\n        }\n        wordRunes = wordRunes[:j]\n        if len(wordRunes) != len(findRunes) {\n            continue\n        }\n        if wordSum != findSum {\n            continue\n        }\n        sort.Slice(wordRunes, func(i, j int) bool { return wordRunes[i] &lt; wordRunes[j] })\n        if string(wordRunes) == findStr {\n            if word != find {\n                anagrams = append(anagrams, word)\n            }\n        }\n    }\n    if err := s.Err(); err != nil {\n        panic(err)\n    }\n    return anagrams\n}\n\nfunc timeTrack(start time.Time, name string) {\n    elapsed := time.Since(start)\n    log.Printf(\"%s took %s\", name, elapsed)\n}\n\nfunc main() {\n    defer timeTrack(time.Now(), \"anagrams\")\n    textPath := os.Args[1]\n    findWord := os.Args[2]\n    text, err := os.Open(textPath)\n    if err != nil {\n        panic(err)\n    }\n    defer text.Close()\n    anagrams := findAnagrams(findWord, text)\n    fmt.Println(\"Found anagrams: \", anagrams)\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 7675076, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9f831ab2f766478ccab31cbabdcfde2e?s=128&d=identicon&r=PG&f=1", "display_name": "strom73", "link": "https://stackoverflow.com/users/7675076/strom73"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 2, "answer_count": 1, "score": 4, "last_activity_date": 1551169942, "creation_date": 1551125541, "last_edit_date": 1551169942, "question_id": 54873920, "link": "https://stackoverflow.com/questions/54873920/how-to-optimize-finding-anagrams-from-a-text-file-in-go", "title": "How to optimize finding anagrams from a text file in Go", "body": "<p>I am trying to solve a coding challenge where one must print all anagrams from a text file matching the input string. Program must execute as fast as possible. Working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"sort\"\n    \"strings\"\n    \"time\"\n)\n\nfunc timeTrack(start time.Time, name string) {\n    elapsed := time.Since(start)\n    log.Printf(\"%s took %s\", name, elapsed)\n}\n\nfunc SortString(w string) string {\n    s := strings.Split(w, \"\")\n    sort.Strings(s)\n    return strings.Join(s, \"\")\n}\n\nfunc FindWord(dict map[string]string, w string) {\n    if val, ok := dict[w]; ok {\n        fmt.Println(\"Found anagrams: \", val)\n    }\n}\n\nfunc main() {\n    defer timeTrack(time.Now(), \"factorial\")\n    file_fullpath := os.Args[1]\n    anagram_word := os.Args[2]\n\n    f, err := os.Open(file_fullpath)\n    defer f.Close()\n    if err != nil {\n        panic(err)\n    }\n\n    scanner := bufio.NewScanner(f)\n    scanner.Split(bufio.ScanLines)\n    var txtlines = make(map[string]string)\n\n    for scanner.Scan() {\n        k := scanner.Text()\n        v := SortString(k)\n        txtlines[v] += string(k) + \",\"\n    }\n\n    FindWord(txtlines, SortString(anagram_word))\n}\n</code></pre>\n\n<p>Currently, I have it down to about 160ms.</p>\n\n<p>Obviously using an Array would be more efficient than Map, but there is a requirement to print the original word to the console. </p>\n\n<p>Is there some way to improve the efficiency of creating the map?</p>\n"}, {"tags": ["go", "domain-driven-design", "cqrs", "value-objects"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1551126931, "post_id": 54873864, "comment_id": 96518506, "body": "This seems like it shifts a whole lot of what should be compile-time static logic into run-time dynamic logic, which is somewhat at odds with the general goals of Go, is going to come at significant efficiency cost, and causes you a significant increase in complexity with no clear benefit. Personally I would suggest looking at the underlying <i>goals</i> of DDD and finding ways to fit that into the ideology of Go, rather than trying to recreate a stereotypical OOP DDD implementation in the non-OOP context of Go."}, {"owner": {"reputation": 2616, "user_id": 4992212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cul0O.png?s=128&g=1", "display_name": "Tobias Theel", "link": "https://stackoverflow.com/users/4992212/tobias-theel"}, "edited": false, "score": 2, "creation_date": 1551134648, "post_id": 54873864, "comment_id": 96521722, "body": "You should have a look at <a href=\"https://about.sourcegraph.com/go/gophercon-2018-how-do-you-structure-your-go-apps\" rel=\"nofollow noreferrer\">this</a> There are also links to the example repo and the <a href=\"https://www.youtube.com/watch?v=oL6JBUk6tj0\" rel=\"nofollow noreferrer\">really great talk</a> (youtube link)"}, {"owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "reply_to_user": {"reputation": 2616, "user_id": 4992212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Cul0O.png?s=128&g=1", "display_name": "Tobias Theel", "link": "https://stackoverflow.com/users/4992212/tobias-theel"}, "edited": false, "score": 0, "creation_date": 1551137279, "post_id": 54873864, "comment_id": 96522548, "body": "@Tobias Theel: I&#39;ve seen that lecture multiple times, but she has skipped everything that has to do with validation, bringing me no closer to a solution to my problem."}, {"owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551138125, "post_id": 54873864, "comment_id": 96522806, "body": "@Adrian: Have been studying the &quot;Patterns, Principles and Practices of Domain-Driven Design - 1st Edition (2015)&quot; book by Scott Millett for the past few months. But you are right, making this fit idiomatic Go is not an easy task I must admit. I can&#39;t remember where I read it, but it was mentioned that Go wasn&#39;t a suitable language when models become complex. What is your take on that?"}, {"owner": {"reputation": 3430, "user_id": 6069012, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/bKlmM.png?s=128&g=1", "display_name": "Gavin", "link": "https://stackoverflow.com/users/6069012/gavin"}, "edited": false, "score": 2, "creation_date": 1551146703, "post_id": 54873864, "comment_id": 96524693, "body": "<a href=\"https://github.com/marcusolsson/goddd\" rel=\"nofollow noreferrer\">Here</a>&#39;s a repository I normally look to when asking similar questions. He also has a <a href=\"https://www.citerus.se/go-ddd/\" rel=\"nofollow noreferrer\">series of articles</a> and a <a href=\"https://www.youtube.com/watch?v=twcDf_Y2gXY\" rel=\"nofollow noreferrer\">talk on youtube</a> discussing the project."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1551190706, "post_id": 54873864, "comment_id": 96544088, "body": "To the comment &quot;Go wasn&#39;t a suitable language when models become complex,&quot; I would generally disagree, <i>if</i> you are able to segment the model into discrete packages and keep strong separation between them. If the shared model is quite large/complex, the implementation <i>can</i> become unwieldy in Go (though often this can be fixed by design improvements to create better separation). Because of its simplicity-first approach, Go is well-suited to microservices but a codebase can become harder to manage with true monoliths."}, {"owner": {"reputation": 2580, "user_id": 8295283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82e91e74e9091501247d9b71125c0eee?s=128&d=identicon&r=PG", "display_name": "Arnold Schrijver", "link": "https://stackoverflow.com/users/8295283/arnold-schrijver"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1614951237, "post_id": 54873864, "comment_id": 117549078, "body": "@Adrian I am also still OOP-minded Go noob I am afraid. Could you be more specific on the static vs. dynamic statement above? Are you referring to the way that what could be a single type is split into multiple parts (i.e. entity + value objects), constructed in various places and which only come together at runtime?"}], "answers": [{"comments": [{"owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "edited": false, "score": 1, "creation_date": 1618008073, "post_id": 66492270, "comment_id": 118481294, "body": "Thank you so much for your elaborate answer!"}], "tags": [], "owner": {"reputation": 2580, "user_id": 8295283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82e91e74e9091501247d9b71125c0eee?s=128&d=identicon&r=PG", "display_name": "Arnold Schrijver", "link": "https://stackoverflow.com/users/8295283/arnold-schrijver"}, "is_accepted": false, "score": 2, "last_activity_date": 1614947762, "last_edit_date": 1614947762, "creation_date": 1614945838, "answer_id": 66492270, "question_id": 54873864, "link": "https://stackoverflow.com/questions/54873864/golang-and-ddd-domain-modeling/66492270#66492270", "title": "Golang and DDD domain modeling", "body": "<p>First of all, as other commenters rightfully say, you have to look at the <em>goals</em> of DDD and decide whether the approach has merit. DDD adds some complexity to the architecture (most of that in the initial phase when structuring your project and base types) and the amount of boilerplate and ceremony you'll have to deal with after that.</p>\n<p>In many cases simpler designs, e.g. a CRUD approach, work best. Where DDD shines is in applications that are in themself more complex in terms of functionality and/or where the amount of features is expected to significantly grow over time. Technical advantages can come in terms of modularity, extensibility and testability, but - most importantly imho - providing a process in which you can take the non-technical stakeholders along and translate their wishes to code without losing them along the way.</p>\n<p>There's a great series of blog posts, the <a href=\"https://github.com/ThreeDotsLabs/wild-workouts-go-ddd-example\" rel=\"nofollow noreferrer\">Wild Workouts Go DDD Example</a>, that takes you along a refactoring process of a traditional Go CRUD-based REST API design to a full-blown DDD architecture, in several steps.</p>\n<p><a href=\"https://twitter.com/roblaszczak\" rel=\"nofollow noreferrer\">Robert Laszczak</a>, author of the series defines DDD as follows:</p>\n<blockquote>\n<p>Ensure that you solve <strong>valid problems</strong> in the <strong>optimal way</strong>. After that <strong>implement the solution in a way that your business will understand without any extra translation from technical language needed</strong>.</p>\n</blockquote>\n<p>And he sees Golang + DDD as the excellent way to write business applications.</p>\n<p>Key to understand here is to decide how far you want to go (no pun intended) with your design. The refactoring gradually introduces new architecture concepts, and at each of these steps you should decide if it is enough for your use case, weigh the pros and cons to go further. They start very KISS with a <a href=\"https://threedots.tech/post/ddd-lite-in-go-introduction/\" rel=\"nofollow noreferrer\">DDD Lite</a> version, and then later go further with CQRS, Clean Architecture, Microservices and even Event Sourcing.</p>\n<p>What I see in many projects is that they immediately go the Full Monty, creating overkill. Especially Microservices and Event Sourcing add <em>a lot of</em> (accidental) complexity.</p>\n<hr />\n<p>I am not well-versed in Go yet (actually quite new to the language), but'll give a stab at your options and offer some considerations. Maybe more experienced Go developers can correct me, where I go off-the-mark :)</p>\n<p>For my own project I am looking into a Clean Architecture (<a href=\"https://en.wikipedia.org/wiki/Hexagonal_architecture_(software)\" rel=\"nofollow noreferrer\">Ports &amp; Adapters</a>, <a href=\"https://en.wikipedia.org/wiki/Inversion_of_control\" rel=\"nofollow noreferrer\">Inversion of Control</a>) + <a href=\"https://en.wikipedia.org/wiki/Command%E2%80%93query_separation#Command_query_responsibility_segregation\" rel=\"nofollow noreferrer\">CQRS</a> + <a href=\"https://en.wikipedia.org/wiki/Domain-driven_design\" rel=\"nofollow noreferrer\">DDD</a> combination.</p>\n<p>The Wild Workouts example provides ample inspiration, but will need some tweaks and additions here and there.</p>\n<p>My goal is that in the codebase's folder structure developers should immediately recognize where features / use cases (epics, user stories, scenario's) reside, and have self-contained, fully consistent domains that directly reflect the <a href=\"https://en.wikipedia.org/wiki/Domain-driven_design#Concepts\" rel=\"nofollow noreferrer\">Ubiquitous Language</a> and are separately testable. Part of testing will be text-only <a href=\"https://en.wikipedia.org/wiki/Behavior-driven_development\" rel=\"nofollow noreferrer\">BDD</a> scripts that can be easily understood by customer and end-users.</p>\n<p>There will be some boilerplate involved, but - given the above - I think the pros outweigh the cons (if your application warrants DDD).</p>\n<p>Your Option #1 looks best to me, but with some additional observations (note: I will stick to your naming, which will make some of this seem overkill.. again it is the <em>ideas</em> that count).</p>\n<ul>\n<li>Instead of <code>Entity</code> I would say that <code>Realm</code> represents an <code>AggregateRoot</code>.</li>\n<li>This can be implicitly so, or it can inline a <code>base.AggregateRoot</code>.</li>\n<li>The aggregate root is the access point to the domain, and ensures its state is always consistent.</li>\n<li>Hence the internal state of <code>Realm</code> should be immutable. State changes occur via functions.</li>\n<li>Unless really trivial and not likely to change I'd implement <code>FriendlyName</code> value object in a separate file.</li>\n<li>Also part of the domain is a <code>RealmRepository</code> but this provides no more than an interface.</li>\n</ul>\n<p>Now I'm using CQRS, which is an extension to what's shown in your code snippets. In this:</p>\n<ul>\n<li>There might be a <code>ChangeFriendlyName</code> Command handler in the Application layer.</li>\n<li>The handler has access to a repository implementation e.g. <code>InMemRealmRepository</code>.</li>\n<li>Might pass a <code>CreateRealmParams</code> to the Command, which then does its validation.</li>\n<li>Handler logic might start by fetching a <code>Realm</code> aggregate from the database.</li>\n<li>Then constructs a new <code>FriendlyName</code> (can also encapsulate in a <code>Realm</code> function call).</li>\n<li>A function call to <code>Realm</code> updates state and queues a <code>FriendlyNameChanged</code> event.</li>\n<li>The command handler persists the changes to the InMemory database.</li>\n<li>Only if there were no errors the command handler invokes <code>Commit()</code> on the aggregate.</li>\n<li>One or more queued events are now published e.g via an <code>EventBus</code>, handled where needed.</li>\n</ul>\n<p>As for the code of Option #1 some changes (hope I'm doing this right) ..</p>\n<p>realm.go - Aggregate root</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type Realm struct {\n   base.AggregateRoot\n\n   friendlyName FriendlyName\n}\n\n// Change state via function calls. Not shown: event impl, error handling.\n// Even with CQRS having Events is entirely optional. You might implement\n// it solely to e.g. maintain an audit log.\nfunc (r *Realm) ChangeFriendlyName(name FriendlyName) {\n   r.friendlyName = name\n   \n   var ev = NewFriendlyNameChanged(r.id, name)\n\n   // Queue the event.\n   r.Apply(ev)\n}\n\n// You might use Params types and encapsulate value object creation,\n// but I'll pass value objects directly created in a command handler.\nfunc CreateRealm(id base.AID, name FriendlyName) (*Realm, error) {\n   ar := base.NewAggregateRoot(id)\n\n   // Might do some param validation here.\n\n   return &amp;Realm{\n       AggregateRoot: ar,\n       friendlyName: name,\n   }, nil\n}\n</code></pre>\n<p>friendlyname.go - Value object</p>\n<pre class=\"lang-golang prettyprint-override\"><code>type FriendlyName struct {\n    value string\n}\n\n// Domain error. Part of ubiquitous language.\nvar FriendlyNameInvalid = errors.New(&quot;invalid friendly name&quot;)\n\nfunc (n FriendlyName) String() string { return n.value }\n\nfunc NewFriendlyName(input string) (FriendlyName, error) {\n    if input == &quot;&quot; {\n        return FriendlyNameInvalid\n    }\n    // perhaps some regexp rule here...\n\n    return FriendlyName{value: input}, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 403, "user_id": 3902270, "user_type": "registered", "profile_image": "https://graph.facebook.com/100006418927672/picture?type=large", "display_name": "Karl Andresen", "link": "https://stackoverflow.com/users/3902270/karl-andresen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4273, "favorite_count": 2, "answer_count": 1, "score": 8, "last_activity_date": 1614947762, "creation_date": 1551125263, "last_edit_date": 1614945898, "question_id": 54873864, "link": "https://stackoverflow.com/questions/54873864/golang-and-ddd-domain-modeling", "title": "Golang and DDD domain modeling", "body": "<p>I've been studying domain-driven design lately and must say this type of architectural design triggers something in me. When I try to apply its concepts to my Go project I've encountered some obstacles. Following are some example methods, but I'm very uncertain which method to GO with.</p>\n\n<p>Excerpt of the project structure:</p>\n\n<pre><code>\u251c\u2500\u2500 api/\n\u251c\u2500\u2500 cmd/\n\u251c\u2500\u2500 internal/\n|   \u251c\u2500\u2500 base/\n|   |   \u251c\u2500\u2500 eid.go\n|   |   \u251c\u2500\u2500 entity.go\n|   |   \u2514\u2500\u2500 value_object.go\n|   \u251c\u2500\u2500 modules/\n|   |   \u251c\u2500\u2500 realm/\n|   |   |   \u251c\u2500\u2500 api/\n|   |   |   \u251c\u2500\u2500 domain/\n|   |   |   |   \u251c\u2500\u2500 realm/\n|   |   |   |   |   \u251c\u2500\u2500 service/\n|   |   |   |   |   \u251c\u2500\u2500 friendly_name.go\n|   |   |   |   |   \u251c\u2500\u2500 realm.go\n|   |   |   |   |   \u2514\u2500\u2500 realm_test.go\n|   |   |   |   \u2514\u2500\u2500 other_subdomain/\n|   |   |   \u2514\u2500\u2500 repository/\n|   |   |       \u251c\u2500\u2500 inmem/\n|   |   |       \u2514\u2500\u2500 postgres/\n</code></pre>\n\n<p>Common for all methods:</p>\n\n<pre><code>package realm // import \"git.int.xxxx.no/go/xxxx/internal/modules/realm/domain/realm\"\n\n// base contains common elements used by all modules\nimport \"git.int.xxxx.no/go/xxxx/internal/base\"\n</code></pre>\n\n<p>Method #1:</p>\n\n<pre><code>type Realm struct {\n   base.Entity\n\n   FriendlyName FriendlyName\n}\n\ntype CreateRealmParams struct {\n    FriendlyName string\n}\n\nfunc CreateRealm(id base.EID, params *CreateRealmParams) (*Realm, error) {\n   var err error\n   var r = new(Realm)\n\n   r.Entity = base.NewEntity(id)\n   r.FriendlyName, err = NewFriendlyName(params.FriendlyName)\n\n   return r, err\n}\n\ntype FriendlyName struct\u00a0{\n    value string\n}\n\nvar ErrInvalidFriendlyName = errors.New(\"invalid friendly name\")\n\nfunc (n FriendlyName) String() string { return n.value }\n\nfunc NewFriendlyName(input string) (FriendlyName, error) {\n    if input == \"\" {\n        return ErrInvalidFriendlyName\n    }\n    // perhaps some regexp rule here...\n\n    return FriendlyName{value: input}, nil\n}\n</code></pre>\n\n<p>With this method I think there will be much repeated code in the long run, but at least the FriendlyName value-object is immutable as per DDD requirements and opens up for more methods to be attached.</p>\n\n<p>Method #2:</p>\n\n<pre><code>type Realm struct {\n    base.Entity\n\n    FriendlyName string\n}\n\ntype CreateRealmParams struct {\n    FriendlyName string\n}\n\nfunc CreateRealm(id base.EID, params *CreateRealmParams) (*Realm, error) {\n    var err error\n\n    if err = validateFriendlyName(params.FriendlyName); err != nil {\n        return nil, err\n    }\n\n    entity := base.NewEntity(id)\n\n    return &amp;Realm{\n        Entity: entity,\n        FriendlyName: params.FriendlyName,\n    }, nil\n}\n</code></pre>\n\n<p>This must be the most common one I've come across examples out there, except for the validation that very many examples lack.</p>\n\n<p>Method #3:</p>\n\n<pre><code>type Realm struct {\n    base.Entity\n\n    friendlyName string\n}\n\ntype CreateRealmParams struct {\n    FriendlyName string\n}\n\nfunc CreateRealm(id base.EID, params *CreateRealmParams) (*Realm, error) {\n    var err error\n\n    if err = validateFriendlyName(friendlyName); err != nil {\n        return nil, err\n    }\n\n    entity := base.NewEntity(id)\n\n    return &amp;Realm{\n        Entity: entity,\n        friendlyName: friendlyName,\n    }, nil\n}\n\nfunc (r *Realm) FriendlyName() string { return r.friendlyName }\nfunc (r *Realm) SetFriendlyName(input string) error {\n    if err := validateFriendlyName(input); err != nil {\n        return err\n    }\n    r.friendlyName = input\n    return nil\n}\n</code></pre>\n\n<p>Here the friendly name type is just a string, but immutable. This structure reminds me of Java code...\nWhen looking up a realm, should the repository-layer use the setter methods from the domain model to construct the realm aggregate?\nI tried with a DTO implementation placed in the same package (dto_sql.go) that encoded/decoded to/from the realm aggregate, but it kind of felt wrong having that concern placed in the domain package.</p>\n\n<p>If you are facing the same issues as me, know about any other method or have anything to point out, I'll be very interested in hearing from you!</p>\n"}, {"tags": ["go", "go-interface"], "answers": [{"tags": [], "owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "is_accepted": true, "score": 2, "last_activity_date": 1551126469, "last_edit_date": 1551126469, "creation_date": 1551126148, "answer_id": 54874064, "question_id": 54873796, "link": "https://stackoverflow.com/questions/54873796/golang-get-values-from-interface/54874064#54874064", "title": "golang get values from interface{}", "body": "<p>I assume that your value <code>row.Key</code> is returned from somewhere as <code>interface{}</code>?</p>\n\n<p>If yes then in your <code>range rows</code> you can try to cast it to type <code>[]interface{}</code>. So your code should look something like this.</p>\n\n<pre><code>for _, row := range rows {\n    if val, ok := row.Key.([]interface{}); ok {\n        fmt.Println(val[1])\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1838, "user_id": 2876271, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zYl2m.png?s=128&g=1", "display_name": "davidbilla", "link": "https://stackoverflow.com/users/2876271/davidbilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1175, "favorite_count": 0, "accepted_answer_id": 54874064, "answer_count": 1, "score": 2, "last_activity_date": 1551126469, "creation_date": 1551124918, "question_id": 54873796, "link": "https://stackoverflow.com/questions/54873796/golang-get-values-from-interface", "title": "golang get values from interface{}", "body": "<p>I am iterating through the results returned from a couchDB.View and extracting the Key.</p>\n\n<pre><code>for _, row := range rows {\n        fmt.Printf(\"%v, %T\\n\", row.Key, row.Key)\n    }\n</code></pre>\n\n<p>The result of this is:</p>\n\n<pre><code>[nh001 mgr], []interface {}\n[nh002 nh], []interface {}\n</code></pre>\n\n<p>I need to read through this interface and get the 2nd value (\"mgr\" or \"nh\").</p>\n\n<p>I am not able to iterate over this as this is not a map. </p>\n"}, {"tags": ["go", "travis-ci", "webassembly"], "answers": [{"tags": [], "owner": {"reputation": 26, "user_id": 6258262, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c67708d92f8bdd00fb5ccce10666b54?s=128&d=identicon&r=PG&f=1", "display_name": "user6258262", "link": "https://stackoverflow.com/users/6258262/user6258262"}, "is_accepted": true, "score": 1, "last_activity_date": 1551336746, "last_edit_date": 1551336746, "creation_date": 1551335585, "answer_id": 54919732, "question_id": 54872686, "link": "https://stackoverflow.com/questions/54872686/travis-build-for-go-targeting-wasm/54919732#54919732", "title": "Travis build for go targeting Wasm", "body": "<p>It might be that you are missing <code>go_js_wasm_exec</code> in your <code>$PATH</code>, which is required when launching <code>go test</code> with <code>GOOS=js GOARCH=wasm</code>.</p>\n\n<p>It is located in the <code>misc/wasm</code> directory of the go SDK so this could fix your travis build:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>export PATH=\"$PATH:$(go env GOROOT)/misc/wasm\"\n</code></pre>\n\n<p>Note that you also need <code>node</code> in your <code>$PATH</code>.</p>\n\n<p>Another way that works for me is using the <code>-exec</code> option of <code>go test</code>:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GOOS=js GOARCH=wasm go test -exec=\"node $(go env GOROOT)/misc/wasm/wasm_exec\"\n</code></pre>\n\n<p>But it is only useful for giving additional options to node (not possible when using <code>go_js_wasm_exec</code>).</p>\n"}], "owner": {"reputation": 7704, "user_id": 2968101, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/kUEZQ.jpg?s=128&g=1", "display_name": "mfrachet", "link": "https://stackoverflow.com/users/2968101/mfrachet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 112, "favorite_count": 0, "accepted_answer_id": 54919732, "answer_count": 1, "score": 1, "last_activity_date": 1551336746, "creation_date": 1551119877, "last_edit_date": 1551154948, "question_id": 54872686, "link": "https://stackoverflow.com/questions/54872686/travis-build-for-go-targeting-wasm", "title": "Travis build for go targeting Wasm", "body": "<p>I'm building a go module targeting Wasm that I need to test.</p>\n\n<p><strong>Current configuration</strong></p>\n\n<p>The <code>travis.yml</code> config:</p>\n\n<pre><code>language: go\ngo:\n  - 1.11.x\nbefore_install:\n  - curl https://raw.githubusercontent.com/golang/dep/master/install.sh | sh\n  - dep ensure\n</code></pre>\n\n<p>And the following <code>makefile</code>:</p>\n\n<pre><code>all: deps test \ndeps:\n    GOOS=js GOARCH=wasm go get ./...\ntest: \n    GOOS=js GOARCH=wasm go test ./...\ntest-cover:\n    $(GOPATH)/bin/mockgen -source=dom/dom.go -destination=mock/dom.go -package=mock\n    $(GOPATH)/bin/mockgen -source=vnode.go -destination=mock/node.go -package=mock\n    GOOS=js GOARCH=wasm go test ./... -coverprofile=cover.out\n    go tool cover -html=cover.out\n</code></pre>\n\n<p>And my <code>go env</code>:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/marvinfrachet/Library/Caches/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/marvinfrachet/go\"\nGOPROXY=\"\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/t0/7bv6yclx1d913wtl6rdsvjtr0000gn/T/go-build435765871=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p><strong>The problem</strong></p>\n\n<p>On my build, I'm having the following error:</p>\n\n<pre><code>GOOS=js GOARCH=wasm go get ./...\nGOOS=js GOARCH=wasm go test ./...\nfork/exec /tmp/go-build540008292/b001/go-vdom-wasm.test: exec format error\nFAIL    github.com/mfrachet/go-vdom-wasm    0.004s\n?       github.com/mfrachet/go-vdom-wasm/dom    [no test files]\nfork/exec /tmp/go-build540008292/b118/helpers.test: exec format error\nFAIL    github.com/mfrachet/go-vdom-wasm/helpers    0.005s\n?       github.com/mfrachet/go-vdom-wasm/mock   [no test files]\n</code></pre>\n\n<p><a href=\"https://travis-ci.org/mfrachet/go-vdom-wasm\" rel=\"nofollow noreferrer\">https://travis-ci.org/mfrachet/go-vdom-wasm</a></p>\n\n<p>On a locale machine, it's working great and my tests all pass.</p>\n\n<p>I think the problem is due to the <code>GOOS=js</code> that doesn't seem to be understood.</p>\n"}, {"tags": ["amazon-web-services", "go", "mocking", "aws-sdk", "aws-sdk-go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551167158, "post_id": 54872392, "comment_id": 96530344, "body": "Re-implementing the logic with a different data storage, that&#39;s not a mock but an alternative implementation. When using mocks you don&#39;t have to deal with storage nor logic."}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551167318, "post_id": 54872392, "comment_id": 96530407, "body": "@mkopriva my package executes lots of API calls via the SDK: <code>lambda.GetFunction</code> to check if it exists, then <code>lambda.ListVersionsByFunction</code> to check the latest available version, then <code>lambda.ListAliases</code> then <code>lambda.CreateAlias</code> (if needed) etc. So I still need to mimic the logic in order to return some coherent output, otherwise testing is useless."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551167603, "post_id": 54872392, "comment_id": 96530547, "body": "If you want to mimic the logic, that&#39;s fine. What I tried to point out in the initial comment is that that&#39;s not a mock, if you want to mock the service you&#39;re doing it the wrong way, if you want to mimic the logic you&#39;re naming it the wrong way."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551168161, "post_id": 54872392, "comment_id": 96530812, "body": "Also if you gonna mimic the logic, you may have to consider writing tests for that as well, how else would you prove that the output it returns is correct? that the alternative behaves the same way as the real thing? Because if it doesn&#39;t behave the same but all the other tests that depend on the service pass without fail, what would that mean? Will they still pass when they use the real service?"}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551168256, "post_id": 54872392, "comment_id": 96530865, "body": "@mkopriva you&#39;re perfectly right. that&#39;s why I posted this question here: I thought of these things myself too and it seems like a huge overhead. That&#39;s why I am asking for a better idea"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1551168933, "post_id": 54872392, "comment_id": 96531205, "body": "Instead of the in-memory implementation using a real mock would be more practical I think. Define an <i>interface type</i> with the lambda methods that your app needs, then have all your types that depend on lambda proper depend on that interface instead, in production set it to the real service, in testing set it to a mock. You don&#39;t have to manually write the mock, you can use <a href=\"https://github.com/golang/mock\" rel=\"nofollow noreferrer\">github.com/golang/mock</a> to generate it. And there in the README you can also see how the mock&#39;s supposed to be used, how you set expectations and return values."}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551169383, "post_id": 54872392, "comment_id": 96531387, "body": "@mkopriva I will look into this and come back to you with what I&#39;ve done! seems like a very clever way! thanks!"}], "owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1772, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1551118713, "creation_date": 1551118713, "question_id": 54872392, "link": "https://stackoverflow.com/questions/54872392/mocking-the-aws-sdk-in-golang", "title": "Mocking the AWS SDK in Golang?", "body": "<p>I am in a situation where I need to mock huge parts of the Lambda, API Gateway and S3 SDK packages for unit testing.</p>\n\n<p>I initially thought this wouldn't be such a bad idea but right now having to implement some in-memory data storage and mimic the entire AWS logic for those services seems impossible (or at least really time consuming).</p>\n\n<p>So basically my mock-implementation looks something like this</p>\n\n<pre><code>package awsmock\n\ntype Lambda struct {\n    lambda.Lambda\n    data map[string]*LambdaFunction\n}\n\nfunc (svc *Lambda) CreateFunction(...) (...) {\n    // mimic the AWS logic but save to svc.data\n}\n\n// etc\n</code></pre>\n\n<p>Is there any better way you could think of when it comes to mocking AWS SDK? If there isn't, I could write a library and post it on Github so other can use it and improve it too, but I hope I can manage without reimplementing this.</p>\n"}, {"tags": ["go", "int", "sizeof"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 6, "creation_date": 1551109508, "post_id": 54869836, "comment_id": 96510152, "body": "See possible duplicate of <a href=\"https://stackoverflow.com/questions/44257522/how-to-get-memory-size-of-variable-in-golang/44258164#44258164\">How to get memory size of variable in golang?</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1551111355, "post_id": 54869836, "comment_id": 96511237, "body": "Binary data is usually read with the <a href=\"https://golang.org/pkg/encoding/binary/\" rel=\"nofollow noreferrer\">encoding/binary package</a> in Go. If that is an option you don&#39;t have to deal with struct sizes; the package handles that automatically."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 2, "creation_date": 1551111750, "post_id": 54869836, "comment_id": 96511449, "body": "How is the <code>Spectrum</code> Go <code>struct</code> defined?"}, {"owner": {"reputation": 145, "user_id": 5668470, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8ff780b9695e21972882b6fa38a206db?s=128&d=identicon&r=PG&f=1", "display_name": "Anders S", "link": "https://stackoverflow.com/users/5668470/anders-s"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1551168173, "post_id": 54869836, "comment_id": 96530820, "body": "@peterSO, the struct is taken from the C-definition straight and first defined as type INT int16, type CHAR byte. Then made the Spectrum struct like this     type Spectrums struct { \t    //\tchar\t\tverkid[30]; \t    verkID [30]CHAR \t    //\tint\t\tstreamnr \t    streamNr INT \t    //\tint\t\tcellinfo;\t \t    cellInfo INT      .... a.s.o.     }"}, {"owner": {"reputation": 145, "user_id": 5668470, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8ff780b9695e21972882b6fa38a206db?s=128&d=identicon&r=PG&f=1", "display_name": "Anders S", "link": "https://stackoverflow.com/users/5668470/anders-s"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551168841, "post_id": 54869836, "comment_id": 96531164, "body": "@icza thanks, They speak of traversing through the struct first and returning the size of the actual values, ? meaning the values from file or empty struct?? Or do I miss something here?... I&#39;ll give it a try to see"}, {"owner": {"reputation": 145, "user_id": 5668470, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8ff780b9695e21972882b6fa38a206db?s=128&d=identicon&r=PG&f=1", "display_name": "Anders S", "link": "https://stackoverflow.com/users/5668470/anders-s"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1551168993, "post_id": 54869836, "comment_id": 96531232, "body": "@Peter Yes that is true, however I want to read one specific struct from the file at specific position ie noOfStruct * datasize and extract the data"}, {"owner": {"reputation": 145, "user_id": 5668470, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8ff780b9695e21972882b6fa38a206db?s=128&d=identicon&r=PG&f=1", "display_name": "Anders S", "link": "https://stackoverflow.com/users/5668470/anders-s"}, "edited": false, "score": 0, "creation_date": 1551180977, "post_id": 54869836, "comment_id": 96538207, "body": "The only issue left with this, after testing, unsafe.Sizeof(struct) give me the correct size as a uintptr. I canprint the value with like fmt.Print(unsafe.Sizeof(struct)) but I haven&#39;t found a way to get the numeric value and multiply with another, say int16 value. Purpose is to seek a position within the file and use ReadAt(receiverAsByteArray, intFromWhatPosition) Or later on, to write struct on same position"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1551196408, "creation_date": 1551196408, "answer_id": 54889408, "question_id": 54869836, "link": "https://stackoverflow.com/questions/54869836/golang-how-to-extract-the-sizeof-struct-to-int/54889408#54889408", "title": "Golang How to extract the sizeof struct to int", "body": "<blockquote>\n  <p>I have a file written to in C with several structs. ie myStruct's Now\n  I want to read one struct of data from this file. In C i simple open a\n  file and move the fileptr number of structs * sizeofStruct.</p>\n  \n  <p>I haven't found a way to get the numeric value and multiply with\n  another, say int16 value. Purpose is to seek a position within the\n  file.</p>\n</blockquote>\n\n<hr>\n\n<p>You do the same thing in Go, using explicit conversions.</p>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    type S struct{ F int32 }\n    i16 := int16(42)\n    // The Go Programming Language Specification\n    // https://golang.org/ref/spec\n    // Numeric types\n    // Explicit conversions are required when different\n    // numeric types are mixed in an expression or assignment.\n    // func (f *File) Seek(offset int64, whence int) (ret int64, err error)\n    offset := int64(i16) * int64(unsafe.Sizeof(S{}))\n    fmt.Println(offset)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/YFyU11Lf2qc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/YFyU11Lf2qc</a></p>\n\n<p>Output:</p>\n\n<pre><code>168\n</code></pre>\n"}], "owner": {"reputation": 145, "user_id": 5668470, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/8ff780b9695e21972882b6fa38a206db?s=128&d=identicon&r=PG&f=1", "display_name": "Anders S", "link": "https://stackoverflow.com/users/5668470/anders-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1170, "favorite_count": 2, "answer_count": 1, "score": 0, "last_activity_date": 1551381103, "creation_date": 1551109413, "last_edit_date": 1551381103, "question_id": 54869836, "link": "https://stackoverflow.com/questions/54869836/golang-how-to-extract-the-sizeof-struct-to-int", "title": "Golang How to extract the sizeof struct to int", "body": "<p>I'm starting to learn golang but come across what I hope is a simple problem.</p>\n\n<p>I have a file written to in C with several structs. ie myStruct's\nNow I  want to read one struct of data from this file.</p>\n\n<p>In C I simple open a file and move the fileptr number of structs * sizeofStruct. Like this</p>\n\n<pre><code>int sizeofStruct = sizeof(myStruct)\nseek(filehandle, searchNo*sizeofStruct)\nread(filehandle, &amp;data, sizeofStruct)\n</code></pre>\n\n<p>This doesn't seem to be as simple in Golang as \"sizeof\"... rather multiple conversions ending up in uintptr... something, or reflect.int32()</p>\n\n<pre><code>var spect Spectrum // struct Spectrum\nconst SizeOfSpectrum = unsafe.Sizeof(spect)\n</code></pre>\n\n<p>I was hoping  SizeOfSpectrum would contain equal to <code>sizeof(spect)</code> in C</p>\n\n<p>Can you guys help me to get the size of a struct in an int variable?</p>\n"}, {"tags": ["go", "couchbase"], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 5, "last_activity_date": 1551126172, "creation_date": 1551126172, "answer_id": 54874071, "question_id": 54869703, "link": "https://stackoverflow.com/questions/54869703/couchbase-go-sdk-case-insensitive/54874071#54874071", "title": "Couchbase GO SDK case insensitive", "body": "<p>According to <a href=\"https://blog.couchbase.com/couchbase-full-text-cbft-for-content-management/\" rel=\"noreferrer\">this</a> blog post:  </p>\n\n<blockquote>\n  <p>Full-Text Searches are case insensitive and use the match query\n  expression. In order to perform FTS, you must create Full-Text Index\n  on appropriate properties. You can create an index on one or more\n  properties. </p>\n</blockquote>\n\n<p>You are using the cbft package (Couchbase Full Text), and probably you haven't set the Full-Text index on the appropriate properties (Town).<br>\nFor setting up the index, read carefully <a href=\"https://docs.couchbase.com/server/6.0/fts/fts-creating-indexes.html\" rel=\"noreferrer\">the documentation</a>.</p>\n"}], "owner": {"reputation": 181, "user_id": 8098544, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a49f5016b496a8e5eec53a38eac15e4f?s=128&d=identicon&r=PG", "display_name": "Ben Rolfe", "link": "https://stackoverflow.com/users/8098544/ben-rolfe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 55, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1551126172, "creation_date": 1551108991, "question_id": 54869703, "link": "https://stackoverflow.com/questions/54869703/couchbase-go-sdk-case-insensitive", "title": "Couchbase GO SDK case insensitive", "body": "<p>I'm running this code which is <strong>case sensitive</strong>:</p>\n\n<pre><code>cbft.NewMatchQuery(\"London\").Field(\"Town\")\n</code></pre>\n\n<p>How can I make the search <strong>case insensitive</strong>, so that searching for \"London\" or \"london\" would match \"London\" in the Couchbase database?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551110837, "post_id": 54867923, "comment_id": 96510976, "body": "Hello! Thank you for you answer. Can you check my post again please?! I think my <code>PostgreSQLDatabase</code> function and your <code>GetDB</code> function are close. They both return database object. If I want to run SQL query inside <code>GetFactors</code> controller, do I need to pass a database object to that controller to execute the sql query? Isn&#39;t it? It&#39;s not clear from your code how I can make sql query inside <code>GetFactors</code> controller."}, {"owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551111738, "post_id": 54867923, "comment_id": 96511443, "body": "funcs <code>PostgreSQLDatabase</code> &amp; <code>GetDB</code> must be separated. In <code>PostgreSQLDatabase</code> before <code>return db, nil</code> you have assign db value to <code>db</code> var from you package and return this value from func <code>GetDB</code>."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551115087, "post_id": 54867923, "comment_id": 96513331, "body": "Ok, I will separate them, no problem. What would be next? I will call <code>GetDB</code> function inside <code>GetFactors</code> controller, right? It steal unclear for me what would be inside <code>GetFactors</code> controller..."}], "tags": [], "owner": {"reputation": 14361, "user_id": 3612353, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/94f2502e42d2e474bfd81dba411fe66f?s=128&d=identicon&r=PG", "display_name": "cn007b", "link": "https://stackoverflow.com/users/3612353/cn007b"}, "is_accepted": false, "score": 1, "last_activity_date": 1551103293, "creation_date": 1551103293, "answer_id": 54867923, "question_id": 54867796, "link": "https://stackoverflow.com/questions/54867796/how-correctly-to-make-controllers-to-routes-in-golang/54867923#54867923", "title": "How correctly to make controllers to routes in Golang?", "body": "<p>Your func <code>GetFactors</code> must looks like:</p>\n\n<pre><code>func GetFactors(w http.ResponseWriter, r *http.Request) {}\n</code></pre>\n\n<p>and in main file you must have:</p>\n\n<pre><code>subrouter.HandleFunc(\"/factors\", controllers.GetFactors).Methods(\"GET\")\n</code></pre>\n\n<p>and with purpose to get DB connection you must have func like <code>GetDB</code> in your package <code>\"rest_api/configurations\"</code>.</p>\n\n<p>In <code>\"rest_api/configurations\"</code> you must have something like:</p>\n\n<pre><code>var db *PostgreSQLDatabase\n\nfunc init() {\n    var err error\n    db, err = configurations.PostgreSQLDatabase()\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc GetDB() *PostgreSQLDatabase {\n  return db\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551111180, "post_id": 54868175, "comment_id": 96511153, "body": "Hello! Thank you for your answer. I am not sure is it best practice what I am tring to do. As you can see I pass database object to <code>GetFactors</code> function. I make it only with one task. I want to run SQL query inside <code>GetFactors</code> controller. How do you think is it correct what I am tring to do or you can advice more elegant way?"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551112404, "post_id": 54868175, "comment_id": 96511828, "body": "I think it&#39;s good design because it is avoid declaration of global variable(db in this case), there is also another option, you can define a struct with database and declare GetFactors on that method."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551114730, "post_id": 54868175, "comment_id": 96513146, "body": "Unfortunately it&#39;s not clear for me your another option. Can you show me little example please?"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": false, "score": 2, "last_activity_date": 1551116133, "last_edit_date": 1592644375, "creation_date": 1551104216, "answer_id": 54868175, "question_id": 54867796, "link": "https://stackoverflow.com/questions/54867796/how-correctly-to-make-controllers-to-routes-in-golang/54868175#54868175", "title": "How correctly to make controllers to routes in Golang?", "body": "<p>There is no correct way, it mostly opinion-based.</p>\n<p>The semantic of HandlerFunc function should be like <code>func(w http.ResponseWriter, r *http.Request)</code>, in order to pass database you can use closures, here is an example.</p>\n<h3>main.go</h3>\n<pre><code>// ... some code here \nsubrouter.HandleFunc(&quot;/factors&quot;, controllers.GetFactors(db)).Methods(&quot;GET&quot;)\n// ... some code here\n</code></pre>\n<h3>controllers/factors.go</h3>\n<pre><code>func GetFactors(db *sql.DB) http.HandlerFunc {\n  return http.HandlerFunc(func(w http.ResponseWriter, req *http.Request) {\n    // some code\n  })\n}\n</code></pre>\n<p>Another option:</p>\n<p>I'm not quite sure about this, but you can adjucts it to your needs. Initialize a <code>Controller</code> struct and pass db to it:</p>\n<h3>main.go</h3>\n<pre><code>// ... some code here \ndb, err := configurations.PostgreSQLDatabase()\nif err != nil {\n    log.Fatal(err)\n}\nctrl := controllers.Controller{DB: db}\nsubrouter.HandleFunc(&quot;/factors&quot;, ctrl.GetFactors).Methods(&quot;GET&quot;)\n// ... some code here\n</code></pre>\n<p>Denote a method on the Controller struct.\nDefine a struct in the controllers</p>\n<h3>controllers/factors.go</h3>\n<pre><code>type Controller struct {\n  DB *PostgreSQLDatabase\n}\n\nfunc (c Controller) GetFactors(w http.ResponseWriter, req *http.Request) {\n    // some code\n    // c.DB.MySqlMethod()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551155549, "post_id": 54872175, "comment_id": 96526434, "body": "Hello! Thank you for your answer. I think your advised more structured way. I have one more question. Lets say I want to put <code>GetFactors</code> function in a separate file. How I need to pass <code>Router</code> struct which is inside <code>router.go</code> file?!"}, {"owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551155787, "post_id": 54872175, "comment_id": 96526476, "body": "Typically I would put the <code>Router</code> struct and its methods (i.e <code>GetFactors</code>) into its own <code>router</code> package. Then you can put them in separate files so long as they have the same package name at the top of the file. Since <code>GetFactors</code> has the <code>Router</code> struct as its receiver you wouldn&#39;t need to explicitly pass it to <code>GetFactors</code>."}, {"owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551156944, "post_id": 54872175, "comment_id": 96526719, "body": "In the future it would be too much functions inside <code>router.go</code> file for each route. It will swell. I don&#39;t want to keep everything in one file. Lets say I create <code>controllers</code> folder (<code>package controllers</code>). Inside that folder create <code>factors.go</code> file and put next code: <code>func (r *Router) GetFactors(w http.ResponseWriter, req *http.Request) {}</code> Golang don&#39;t see <code>r *Router</code> struct. Don&#39;t know how to solve this problem."}, {"owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "reply_to_user": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "edited": false, "score": 0, "creation_date": 1551157137, "post_id": 54872175, "comment_id": 96526751, "body": "<code>Router</code> and <code>GetFactors</code> need to be in the same package, but do not need to be in the same file. Create a <code>controllers</code> folder, then have a <code>router.go</code> and a <code>factors.go</code> file in that folder each with <code>package controllers</code> at the top, then <code>GetFactors</code> can see Router, but wont need to be in the same file."}], "tags": [], "owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "is_accepted": true, "score": 1, "last_activity_date": 1551117799, "creation_date": 1551117799, "answer_id": 54872175, "question_id": 54867796, "link": "https://stackoverflow.com/questions/54867796/how-correctly-to-make-controllers-to-routes-in-golang/54872175#54872175", "title": "How correctly to make controllers to routes in Golang?", "body": "<p>A pattern I like to use is to define your own <code>Router</code> struct that has a <code>mux.Router</code> as a field as well as encapsulates things like your database connection, application config and etc.</p>\n\n<p>I find doing it this way makes it easily update your routes when they require different resources and development proceeds.</p>\n\n<p>First create a router object that takes in the database connection on creation and makes it available to all routes you wish to use.</p>\n\n<p><strong>router.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"database/sql\"\n\n    \"github.com/gorilla/mux\"\n)\n\ntype Router struct {\n    router *mux.Router\n    db *sql.DB\n}\n\nfunc NewRouter(db *sql.DB) (*Router, error) {\n    router := mux.NewRouter()\n    router.StrictSlash(true)\n    subrouter := router.PathPrefix(\"/api\").Subrouter()\n\n    r := &amp;Router{\n        router: router,\n        db: db,\n    }\n\n    subrouter.HandleFunc(\"/factors\", r.GetFactors).Methods(http.MethodGet)\n\n    return r, nil\n}\n\nfunc (r *Router) GetFactors(w http.ResponseWriter, req *http.Request) {\n    // Now you can access your database via `r.db`\n}\n\n// Needed so we can pass our custom router to ListenAndServe.\nfunc (r *Router) ServeHTTP(w http.ResponseWriter, req *http.Request) {\n    r.router.ServeHTTP(w, req)\n}\n</code></pre>\n\n<p>Then in <code>main.go</code> you can simply create your custom router, passing it your database connection. Then the custom router can be passed directly to <code>ListenAndServe</code>.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"rest_api/configurations\"\n    \"rest_api/controllers\"\n)\n\nfunc main()  {\n    db, err := configurations.PostgreSQLDatabase()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    router, err := NewRouter(db)\n    if err != nil {\n        log.Fatalf(\"error initializing router: %v\", err)\n    }\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n</code></pre>\n\n<p>Hopefully this helps.</p>\n"}], "owner": {"reputation": 3585, "user_id": 4332480, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/dda076eb310c8a597201a2563d07e0d1?s=128&d=identicon&r=PG&f=1", "display_name": "Nurzhan Nogerbek", "link": "https://stackoverflow.com/users/4332480/nurzhan-nogerbek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2322, "favorite_count": 3, "accepted_answer_id": 54872175, "answer_count": 3, "score": 2, "last_activity_date": 1551117799, "creation_date": 1551102876, "last_edit_date": 1551110289, "question_id": 54867796, "link": "https://stackoverflow.com/questions/54867796/how-correctly-to-make-controllers-to-routes-in-golang", "title": "How correctly to make controllers to routes in Golang?", "body": "<p>I am new in <strong>Golang</strong> and need some help. I am tring to create REST API web service without ORM.</p>\n\n<p>Right now I am successfully connected to <strong>PostgreSQL</strong> database. In database I have table which called <code>factors</code>. I want to create CRUD operations. The problem is with controllers logic.</p>\n\n<p><strong>main.go</strong>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/gorilla/mux\"\n    \"log\"\n    \"net/http\"\n    \"rest_api/configurations\"\n    \"rest_api/controllers\"\n)\n\nfunc main()  {\n    db, err := configurations.PostgreSQLDatabase()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    router := mux.NewRouter()\n\n    router.StrictSlash(true)\n\n    subrouter := router.PathPrefix(\"/api\").Subrouter()\n\n    subrouter.HandleFunc(\"/factors\", controllers.GetFactors(db)).Methods(\"GET\")\n\n    log.Fatal(http.ListenAndServe(\":8000\", router))\n}\n</code></pre>\n\n<p><strong>models/factors.go</strong>:</p>\n\n<pre><code>package models\n\ntype Factor struct {\n    ID int `json:\"id\"`\n    Name string `json:\"name\"`\n}\n</code></pre>\n\n<p>How correctly looks like the <code>GetFactors</code> controller? Can someone show me please. For instance I pass <code>db</code> object to <code>GetFactors</code> controller as in the example below. Unfortunately it seems like it's incorrect.</p>\n\n<p><strong>controllers/factors.go</strong>:</p>\n\n<pre><code>func GetFactors(db *sql.DB, w http.ResponseWriter, req *http.Request) {\n    // some code\n}\n</code></pre>\n\n<p><strong>configurations/PostgreSQL.go</strong>:</p>\n\n<pre><code>func PostgreSQLDatabase() (*sql.DB, error) {\n    // Load environment variables from \".env\" file.\n    err := godotenv.Load(\".env\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // Initialize database-related variables.\n    dbUser := os.Getenv(\"PostgreSQL_USER\")\n    dbPassword := os.Getenv(\"PostgreSQL_PASSWORD\")\n    dbHost := os.Getenv(\"PostgreSQL_HOST\")\n    dbName := os.Getenv(\"PostgreSQL_DB_NAME\")\n    dbURL := fmt.Sprintf(\"user=%s password=%s host=%s dbname=%s sslmode=disable\", dbUser, dbPassword, dbHost, dbName)\n\n    // Create PostgreSQL database connection pool.\n    db, err := sql.Open(\"postgres\", dbURL)\n    if err != nil {\n        return nil, err\n    }\n\n    // Ping PostgreSQL database to make sure it's alive.\n    err = db.Ping()\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        log.Println(\"Web service successfully connected to remote PostgreSQL database.\")\n    }\n\n    return db, nil\n}\n</code></pre>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "edited": false, "score": 0, "creation_date": 1551103250, "post_id": 54867768, "comment_id": 96506089, "body": "great thanks, did was not sure is one to one, so didn&#39;t check mysql docu. Thanks!"}], "tags": [], "owner": {"reputation": 27828, "user_id": 5563083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab25f269dc3fd3b4a657ddd27cf8f349?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Spiegel", "link": "https://stackoverflow.com/users/5563083/paul-spiegel"}, "is_accepted": true, "score": 1, "last_activity_date": 1551102781, "creation_date": 1551102781, "answer_id": 54867768, "question_id": 54867531, "link": "https://stackoverflow.com/questions/54867531/go-sql-rowsaffected-with-on-duplicate-key-update/54867768#54867768", "title": "Go: sql RowsAffected with ON DUPLICATE KEY UPDATE", "body": "<p><code>mysql_affected_rows()</code> is the equivalent of the SQL function <a href=\"https://dev.mysql.com/doc/refman/8.0/en/information-functions.html#function_row-count\" rel=\"nofollow noreferrer\">ROW_COUNT()</a>.</p>\n\n<p>For <code>INSERT .. ON DUPLICATE KEY UPDATE</code> the documentation states:</p>\n\n<blockquote>\n  <p>For <code>INSERT ... ON DUPLICATE KEY UPDATE</code> statements, the affected-rows\n  value per row is 1 if the row is inserted as a new row, 2 if an\n  existing row is updated, and 0 if an existing row is set to its\n  current values. If you specify the <code>CLIENT_FOUND_ROWS</code> flag, the\n  affected-rows value is 1 (not 0) if an existing row is set to its\n  current values.</p>\n</blockquote>\n"}], "owner": {"reputation": 2072, "user_id": 1195266, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/6c5Fj.jpg?s=128&g=1", "display_name": "Macilias", "link": "https://stackoverflow.com/users/1195266/macilias"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 54867768, "answer_count": 1, "score": 0, "last_activity_date": 1551102781, "creation_date": 1551101948, "question_id": 54867531, "link": "https://stackoverflow.com/questions/54867531/go-sql-rowsaffected-with-on-duplicate-key-update", "title": "Go: sql RowsAffected with ON DUPLICATE KEY UPDATE", "body": "<p>I struggle to find some proper documentation which describes the semantic of the RowsAffected value other than that:</p>\n\n<blockquote>\n  <p>RowsAffected returns the number of rows affected by an update, insert, or delete. Not every database or database driver may support this.</p>\n</blockquote>\n\n<p>I'm using a query with  ON DUPLICATE KEY UPDATE and the value of RowsAffected is 2 after an update. Is it because it reduces to execution to delete and insert?</p>\n\n<p>The server is an MySql server Ver 8.0.12 for osx10.13 on x86_64</p>\n"}, {"tags": ["json", "file", "go", "file-writing"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101204, "post_id": 54867225, "comment_id": 96504773, "body": "&quot;I will need to add <code>[]</code> scopes by hand before reading&quot; - why? Can&#39;t you parse each line separately and populate your array one by one?"}, {"owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101353, "post_id": 54867225, "comment_id": 96504863, "body": "@SergioTulentsev I mean to be able to simply <code>Unmarshal</code> it into some go struct"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101469, "post_id": 54867225, "comment_id": 96504928, "body": "It is an array, though (and not a struct)?"}, {"owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101686, "post_id": 54867225, "comment_id": 96505071, "body": "@SergioTulentsev slice of structs)"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101740, "post_id": 54867225, "comment_id": 96505103, "body": "Ah, so why not unmarshal lines one by one and fill your slice?"}, {"owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1551101862, "post_id": 54867225, "comment_id": 96505184, "body": "@SergioTulentsev that&#39;s a way) let&#39;s consider that I want to know the answer for educational purpose)"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1551103323, "last_edit_date": 1551103323, "creation_date": 1551101760, "answer_id": 54867467, "question_id": 54867225, "link": "https://stackoverflow.com/questions/54867225/changing-the-last-character-of-a-file/54867467#54867467", "title": "Changing the last character of a file", "body": "<p>You don't need to wrap the JSON objects into an array, you can just write them as-is. You may use <a href=\"https://golang.org/pkg/encoding/json/#Encoder\" rel=\"nofollow noreferrer\"><code>json.Encoder</code></a> to write them to the file, and you may use <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\"><code>json.Decoder</code></a> to read them. <code>Encoder.Encode()</code> and <code>Decoder.Decode()</code> encode and decode individual JSON values from a stream.</p>\n\n<p>To prove it works, see this simple example:</p>\n\n<pre><code>const src = `{\"id\":\"1\"}{\"id\":\"2\"}{\"id\":\"3\"}`\ndec := json.NewDecoder(strings.NewReader(src))\n\nfor {\n    var m map[string]interface{}\n    if err := dec.Decode(&amp;m); err != nil {\n        if err == io.EOF {\n            break\n        }\n        panic(err)\n    }\n    fmt.Println(\"Read:\", m)\n}\n</code></pre>\n\n<p>It outputs (try it on the <a href=\"https://play.golang.org/p/hX47k4-06FF\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>Read: map[id:1]\nRead: map[id:2]\nRead: map[id:3]\n</code></pre>\n\n<p>When writing to / reading from a file, pass the <a href=\"https://golang.org/pkg/os/#File\" rel=\"nofollow noreferrer\"><code>os.File</code></a> to <a href=\"https://golang.org/pkg/encoding/json/#NewEncoder\" rel=\"nofollow noreferrer\"><code>json.NewEncoder()</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#NewDecoder\" rel=\"nofollow noreferrer\"><code>json.NewDecoder()</code></a>.</p>\n\n<p>Here's a complete demo which creates a temporary file, uses <code>json.Encoder</code> to write JSON objects into it, then reads them back with <code>json.Decoder</code>:</p>\n\n<pre><code>objs := []map[string]interface{}{\n    map[string]interface{}{\"id\": \"1\"},\n    map[string]interface{}{\"id\": \"2\"},\n    map[string]interface{}{\"id\": \"3\"},\n}\n\nfile, err := ioutil.TempFile(\"\", \"test.json\")\nif err != nil {\n    panic(err)\n}\n\n// Writing to file:\nenc := json.NewEncoder(file)\nfor _, obj := range objs {\n    if err := enc.Encode(obj); err != nil {\n        panic(err)\n    }\n}\n\n// Debug: print file's content\nfmt.Println(\"File content:\")\nif data, err := ioutil.ReadFile(file.Name()); err != nil {\n    panic(err)\n} else {\n    fmt.Println(string(data))\n}\n\n// Reading from file:\nif _, err := file.Seek(0, io.SeekStart); err != nil {\n    panic(err)\n}\ndec := json.NewDecoder(file)\nfor {\n    var obj map[string]interface{}\n    if err := dec.Decode(&amp;obj); err != nil {\n        if err == io.EOF {\n            break\n        }\n        panic(err)\n    }\n    fmt.Println(\"Read:\", obj)\n}\n</code></pre>\n\n<p>It outputs (try it on the <a href=\"https://play.golang.org/p/wXhLnN7Clyw\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>File content:\n{\"id\":\"1\"}\n{\"id\":\"2\"}\n{\"id\":\"3\"}\n\nRead: map[id:1]\nRead: map[id:2]\nRead: map[id:3]\n</code></pre>\n"}], "owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 54867467, "answer_count": 1, "score": 1, "last_activity_date": 1551103323, "creation_date": 1551101012, "last_edit_date": 1551102557, "question_id": 54867225, "link": "https://stackoverflow.com/questions/54867225/changing-the-last-character-of-a-file", "title": "Changing the last character of a file", "body": "<p>I want to continuously write json objects to a file. To be able to read it, I need to wrap them into an array. I don't want to read the whole file, for simple appending. So what I' doing now:</p>\n\n<pre><code>comma := []byte(\", \")\n    file, err := os.OpenFile(erp.TransactionsPath, os.O_WRONLY|os.O_APPEND|os.O_CREATE, 0666)\n    if err != nil {\n        return err\n    }\n    transaction, err := json.Marshal(t)\n    if err != nil {\n        return err\n    }\n    transaction = append(transaction, comma...)\n    file.Write(transaction)\n</code></pre>\n\n<p>But with this implementation I will need to add <code>[]</code>scopes by hand(or via some script) before reading. How can I add an object before closing scope on each writing?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1551103627, "creation_date": 1551103627, "answer_id": 54868012, "question_id": 54867062, "link": "https://stackoverflow.com/questions/54867062/golang-converting-yyyymmdd-hrmmss-i-e-i-am-getting-date-in-string-and-the/54868012#54868012", "title": "Golang : converting yyyy:MM:dd hr:mm:ss i.e I am getting date in string and the same date need to be parse to save in mysql db", "body": "<pre><code>layout := \"2006-01-02 15:04:05\"\nfmt.Println(t.Format(layout))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>2018-10-11 13:10:47\n</code></pre>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    layout := \"2006-01-02 15:04:05\"\n    str := \"2018-10-11 13:10:47\"\n    t, err := time.Parse(layout, str)\n\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(t)\n    fmt.Println(t.Format(layout))\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/NuloBCXBdhH\" rel=\"nofollow noreferrer\">https://play.golang.org/p/NuloBCXBdhH</a></p>\n\n<p>Output:</p>\n\n<pre><code>2018-10-11 13:10:47 +0000 UTC\n2018-10-11 13:10:47\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 59, "user_id": 9099092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b6708e550f071d626236bab18aef38f?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas 07", "link": "https://stackoverflow.com/users/9099092/tejas-07"}, "edited": false, "score": 0, "creation_date": 1551186746, "post_id": 54871662, "comment_id": 96541610, "body": "Thank you  Adrian this is the most generic answer"}, {"owner": {"reputation": 59, "user_id": 9099092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b6708e550f071d626236bab18aef38f?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas 07", "link": "https://stackoverflow.com/users/9099092/tejas-07"}, "edited": false, "score": 0, "creation_date": 1551551007, "post_id": 54871662, "comment_id": 96684239, "body": "Hi Adrian the output is type string instead of mysq tiime/time.time. I am extracting string date from .csv &amp; storing in mysql datetime."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 59, "user_id": 9099092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b6708e550f071d626236bab18aef38f?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas 07", "link": "https://stackoverflow.com/users/9099092/tejas-07"}, "edited": false, "score": 0, "creation_date": 1551574186, "post_id": 54871662, "comment_id": 96689751, "body": "just convert you text time repesentation to time.Time, with time.Parse(timeLayout, csvTextTime)"}], "tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": -1, "last_activity_date": 1551115827, "creation_date": 1551115827, "answer_id": 54871662, "question_id": 54867062, "link": "https://stackoverflow.com/questions/54867062/golang-converting-yyyymmdd-hrmmss-i-e-i-am-getting-date-in-string-and-the/54871662#54871662", "title": "Golang : converting yyyy:MM:dd hr:mm:ss i.e I am getting date in string and the same date need to be parse to save in mysql db", "body": "<p>How about useing <code>DateFormatToLayout(\"yyyy-MM-dd hh:mm:ss\")</code> utility method to convert ISO date style to time layout</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/viant/toolbox\"\n    \"time\"\n)\n\nfunc main() {\n    timeLayout := toolbox.DateFormatToLayout(\"yyyy-MM-dd hh:mm:ss\")\n    fmt.Printf(\"%s\\n\", time.Now().Format(timeLayout))\n}\n</code></pre>\n\n<p><a href=\"https://github.com/viant/toolbox/#time-utilities\" rel=\"nofollow noreferrer\">Time Utils</a></p>\n"}], "owner": {"reputation": 59, "user_id": 9099092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b6708e550f071d626236bab18aef38f?s=128&d=identicon&r=PG&f=1", "display_name": "Tejas 07", "link": "https://stackoverflow.com/users/9099092/tejas-07"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1871, "favorite_count": 2, "answer_count": 2, "score": -1, "last_activity_date": 1551115827, "creation_date": 1551100452, "question_id": 54867062, "link": "https://stackoverflow.com/questions/54867062/golang-converting-yyyymmdd-hrmmss-i-e-i-am-getting-date-in-string-and-the", "title": "Golang : converting yyyy:MM:dd hr:mm:ss i.e I am getting date in string and the same date need to be parse to save in mysql db", "body": "<pre><code>layout := \"2006-01-02 15:04:05\"\n    str := \"2018-10-11 13:10:47\"\n    t, err := time.Parse(layout, str)\n\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(t)\n</code></pre>\n\n<blockquote>\n  <p>I am getting output as 2018-10-11 13:10:47 +0000 UTC, but I want to\n  store in mysql db as 2018-10-11 13:10:47. How do I parse exactly for\n  mysql datetime?</p>\n</blockquote>\n"}, {"tags": ["go", "swig"], "answers": [{"tags": [], "owner": {"reputation": 469, "user_id": 2444805, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/48c704620a01a883fbae02e1751827b4?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/2444805/jason"}, "is_accepted": false, "score": 1, "last_activity_date": 1551105910, "creation_date": 1551105910, "answer_id": 54868679, "question_id": 54866503, "link": "https://stackoverflow.com/questions/54866503/cant-build-a-go-module-built-with-swig-due-to-missing-include-path/54868679#54868679", "title": "Can&#39;t build a go module built with Swig due to missing include path", "body": "<p>Exporting CPLUS_INCLUDE_PATH to the required include path fixed this.</p>\n"}], "owner": {"reputation": 469, "user_id": 2444805, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/48c704620a01a883fbae02e1751827b4?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/2444805/jason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1551105910, "creation_date": 1551098650, "last_edit_date": 1551103816, "question_id": 54866503, "link": "https://stackoverflow.com/questions/54866503/cant-build-a-go-module-built-with-swig-due-to-missing-include-path", "title": "Can&#39;t build a go module built with Swig due to missing include path", "body": "<p>In my swig interface file I use includes such as:</p>\n\n<pre><code>%{\n    #include \"lib-cpp/types/lists/linked-list.hpp\"\n%}\n%include \"lib-cpp/types/lists/linked-list.hpp\"\n</code></pre>\n\n<p>However when I run go install I get:</p>\n\n<pre><code>navdb_go_client_wrap.cxx:258:14: fatal error: 'lib-cpp/types/lists/linked-list.hpp' file not found\n</code></pre>\n\n<p>How do I specify an include directory for go install?</p>\n"}, {"tags": ["go", "redis"], "answers": [{"tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": true, "score": 2, "last_activity_date": 1551105264, "creation_date": 1551105264, "answer_id": 54868494, "question_id": 54866485, "link": "https://stackoverflow.com/questions/54866485/does-redigo-reconnects-to-the-server/54868494#54868494", "title": "Does redigo reconnects to the server?", "body": "<p>No, your assumption is not correct. Using the <code>Dial</code> function it returns a single connection when the server terminates the connection, the client is not able to reconnect.<br>\nYou should use <code>redis.Pool</code> and it should be able to auto-reconnect when you ask for a new connection, the function is: <code>pool.Get()</code></p>\n"}, {"tags": [], "owner": {"reputation": 2338, "user_id": 1213885, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1e39a4c25252ea2ccc058a0c8a5176f4?s=128&d=identicon&r=PG", "display_name": "Shashwat", "link": "https://stackoverflow.com/users/1213885/shashwat"}, "is_accepted": false, "score": 0, "last_activity_date": 1551336481, "creation_date": 1551336481, "answer_id": 54919922, "question_id": 54866485, "link": "https://stackoverflow.com/questions/54866485/does-redigo-reconnects-to-the-server/54919922#54919922", "title": "Does redigo reconnects to the server?", "body": "<p><code>redisConnection.Err()</code> returns a non nil value if the connection is not usable. We can <code>Dial</code> again in that case.</p>\n"}], "owner": {"reputation": 2338, "user_id": 1213885, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/1e39a4c25252ea2ccc058a0c8a5176f4?s=128&d=identicon&r=PG", "display_name": "Shashwat", "link": "https://stackoverflow.com/users/1213885/shashwat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 438, "favorite_count": 0, "accepted_answer_id": 54868494, "answer_count": 2, "score": 0, "last_activity_date": 1551336481, "creation_date": 1551098592, "question_id": 54866485, "link": "https://stackoverflow.com/questions/54866485/does-redigo-reconnects-to-the-server", "title": "Does redigo reconnects to the server?", "body": "<p>I am using <a href=\"https://github.com/gomodule/redigo\" rel=\"nofollow noreferrer\">Redigo</a> to connect to redis server through golang.</p>\n\n<pre><code>redisConnection, err = redis.Dial(\"tcp\", \"...\")\nredisConnection.Do(..., ...)\n</code></pre>\n\n<p>If I restart my server, I am unable to execute any command using the same <code>redisConnection</code>. Shouldn't it reconnect when I execute <code>Do</code> again?</p>\n"}, {"tags": ["mongodb", "go", "polymorphism", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 836, "user_id": 170637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mFEYvK3lfMY/AAAAAAAAAAI/AAAAAAAAH3w/WuYcTTUB2Oc/photo.jpg?sz=128", "display_name": "Olivier G&#233;rardin", "link": "https://stackoverflow.com/users/170637/olivier-g%c3%a9rardin"}, "edited": false, "score": 0, "creation_date": 1551104557, "post_id": 54865985, "comment_id": 96506941, "body": "First thanks for your detailed answer!  It was intentional to skip error handling to keep the code more readable, but in doing so I might have missed a useful error message... I have changed my code to pass pt.Interface() instead of pt to Unmarshal and it works as expected.  Of course marshalling-unmarshalling is not the most efficient way to handle this, but I had thought of it as an easy way to do it. I will look into more efficient alternatives now :)"}, {"owner": {"reputation": 836, "user_id": 170637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mFEYvK3lfMY/AAAAAAAAAAI/AAAAAAAAH3w/WuYcTTUB2Oc/photo.jpg?sz=128", "display_name": "Olivier G&#233;rardin", "link": "https://stackoverflow.com/users/170637/olivier-g%c3%a9rardin"}, "edited": false, "score": 0, "creation_date": 1551104568, "post_id": 54865985, "comment_id": 96506948, "body": "As for including the type in the ID, I&#39;m not fond of this as I think IDs should not convey any business meaning and should be kept totally transparent. It would also mean that each persistable struct must have an &quot;id&quot; field, whereas in my solution only the Wrapper needs to have it..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 836, "user_id": 170637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mFEYvK3lfMY/AAAAAAAAAAI/AAAAAAAAH3w/WuYcTTUB2Oc/photo.jpg?sz=128", "display_name": "Olivier G&#233;rardin", "link": "https://stackoverflow.com/users/170637/olivier-g%c3%a9rardin"}, "edited": false, "score": 1, "creation_date": 1551104777, "post_id": 54865985, "comment_id": 96507084, "body": "@OlivierG&#233;rardin It&#39;s not uncommon to include the entity kind (or type) in the key (or ID) itself. A good example of this is the Google Cloud Datastore entity keys (<a href=\"https://cloud.google.com/appengine/docs/standard/java/datastore/creating-entity-keys\" rel=\"nofollow noreferrer\">see here</a>)."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1551097569, "last_edit_date": 1551097569, "creation_date": 1551096813, "answer_id": 54865985, "question_id": 54865657, "link": "https://stackoverflow.com/questions/54865657/go-mongodb-polymorphic-queries/54865985#54865985", "title": "Go + MongoDB: polymorphic queries", "body": "<p>First, you should always check returned errors, always. <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#Marshal\" rel=\"nofollow noreferrer\"><code>bson.Marshal()</code></a> and <a href=\"https://godoc.org/github.com/globalsign/mgo/bson#Unmarshal\" rel=\"nofollow noreferrer\"><code>bson.Unmarshal()</code></a> return errors which you don't check. Doing so reveals why it doesn't work:</p>\n\n<blockquote>\n  <p>unmarshal can't deal with struct values. Use a pointer</p>\n</blockquote>\n\n<p><code>pt</code> is of type <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> (which happens to be a struct), not something you should pass to <code>bson.Unmarshal()</code>. You should pass e.g. a pointer to a struct value you want to unmarshal into (which will be wrapped in an <code>interface{}</code> value). So call <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> on the value returned by <a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\"><code>reflect.New()</code></a>:</p>\n\n<pre><code>pt := reflect.New(t).Interface()\n</code></pre>\n\n<p>You can pass this to <code>bson.Unmarshal()</code>:</p>\n\n<pre><code>bsonBytes, err := bson.Marshal(m)\nif err != nil {\n    panic(err)\n}\nif err = bson.Unmarshal(bsonBytes, pt); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>(In your real code you want to do something else than panic, this is just to show you should always check errors!)</p>\n\n<p>Also note that it is possible to directly convert maps to structs (directly meaning without marshaling and unmarshaling). You may implement it by hand or use a ready 3rd party lib. For details, see <a href=\"https://stackoverflow.com/questions/26744873/converting-map-to-struct\">Converting map to struct</a></p>\n\n<p>Also note that there are more clever ways to solve what you want to do. You could store the type in the ID itself, so if you have the ID, you can construct a value of the type to unmarshal into the query result, so you could skip this whole process. It would be a lot more simple and a lot more efficient.</p>\n\n<p>For example you could use the following ID structure:</p>\n\n<pre><code>&lt;type&gt;-&lt;id&gt;\n</code></pre>\n\n<p>For example:</p>\n\n<pre><code>my.package.S1-123\n</code></pre>\n\n<p>When fetching / loading this document, you could use reflection to create a value of <code>my.package.S1</code>, and unmarshal into that directly (pass that to <code>Query.One()</code>).</p>\n"}, {"tags": [], "owner": {"reputation": 836, "user_id": 170637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mFEYvK3lfMY/AAAAAAAAAAI/AAAAAAAAH3w/WuYcTTUB2Oc/photo.jpg?sz=128", "display_name": "Olivier G&#233;rardin", "link": "https://stackoverflow.com/users/170637/olivier-g%c3%a9rardin"}, "is_accepted": false, "score": 0, "last_activity_date": 1551113741, "last_edit_date": 1551113741, "creation_date": 1551105390, "answer_id": 54868532, "question_id": 54865657, "link": "https://stackoverflow.com/questions/54865657/go-mongodb-polymorphic-queries/54868532#54868532", "title": "Go + MongoDB: polymorphic queries", "body": "<p>As per @icza 's comments, here's a modified version of <code>getById()</code> that actually works:</p>\n\n<pre><code>func getById(coll *mgo.Collection, id interface{}) (*I, error) {\n    // read wrapper\n    wrapper := Wrapper{}\n    err := coll.Find(bson.M{\"_id\": id}).One(&amp;wrapper)\n    if err != nil {\n        return nil, err\n    }\n\n    // obtain Type from registry\n    t := typeregistry.GetType(wrapper.TypeKey)\n\n    // get a pointer to a new value of this type\n    pt := reflect.New(t)\n\n    // populate value using wrapper.Val\n    err = mapstructure.Decode(wrapper.V, pt.Interface())\n    if err != nil {\n        return nil, err\n    }\n\n    // return the value as *I\n    i := pt.Elem().Interface().(I)\n    return &amp;i, nil\n}\n</code></pre>\n\n<p>Conversion from <code>bson.M</code> to the struct is handled by <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/mapstructure</a> instead of marshalling-unmarshaling.</p>\n"}], "owner": {"reputation": 836, "user_id": 170637, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-mFEYvK3lfMY/AAAAAAAAAAI/AAAAAAAAH3w/WuYcTTUB2Oc/photo.jpg?sz=128", "display_name": "Olivier G&#233;rardin", "link": "https://stackoverflow.com/users/170637/olivier-g%c3%a9rardin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 532, "favorite_count": 0, "accepted_answer_id": 54865985, "answer_count": 2, "score": 2, "last_activity_date": 1551113741, "creation_date": 1551095726, "last_edit_date": 1551105654, "question_id": 54865657, "link": "https://stackoverflow.com/questions/54865657/go-mongodb-polymorphic-queries", "title": "Go + MongoDB: polymorphic queries", "body": "<p>(sorry this question turned out longer than I had thought...)</p>\n\n<p>I'm using Go and MongoDB with the mgo driver. I'm trying to persist and retrieve different structs (implementing a common interface) in the same MongoDB collection. I'm coming from the Java world (where this is very easily done with Spring with literally no config) and I'm having a hard time doing something similar with Go.\nI have read every last related article or post or StackExchange question I could find, but still I haven't found a complete solution. This includes:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/18340031/unstructured-mongodb-collections-with-mgo\">Unstructured MongoDB collections with mgo</a></li>\n<li><a href=\"https://stackoverflow.com/questions/7850140/how-do-you-create-a-new-instance-of-a-struct-from-its-type-at-run-time-in-go\">How do you create a new instance of a struct from its type at run time in Go?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/40879748/golang-reflect-get-type-representation-from-name\">Golang reflect: Get Type representation from name?</a></li>\n</ul>\n\n<p>Here's a simplified setup I use for testing. Suppose two structs <code>S1</code> and <code>S2</code>, implementing a common interface <code>I</code>. <code>S2</code> has an implicit field of type <code>S1</code>, meaning that structure-wise <code>S2</code> embeds a <code>S1</code> value, and that type-wise <code>S2</code> implements <code>I</code>. </p>\n\n<pre><code>type I interface {\n    f1()\n}\n\ntype S1 struct {\n    X int\n}\n\ntype S2 struct {\n    S1\n    Y int\n}\n\nfunc (*S1) f1() {\n    fmt.Println(\"f1\")\n}\n</code></pre>\n\n<p>Now I can save an instance of <code>S1</code> or <code>S2</code> easily using <code>mgo.Collection.Insert()</code>, but to properly populate a value using <code>mgo.Collection.Find().One()</code> for example, I need to pass a pointer to an existing value of <code>S1</code> or <code>S2</code>, which means I already know the type of the object I want to read!!\nI want to be able to retrieve a document from the MongoDB collection without knowing if it's a <code>S1</code>, or a <code>S2</code>, or in fact any object that implements <code>I</code>.</p>\n\n<p>Here's where I am so far: instead of directly saving the object I want to persist, I save a <code>Wrapper</code> struct that holds the MongoDB id, an identifier of the type, and the actual value. The type identifier is a concatenation of <em>packageName</em> + \".\" + <em>typeName</em>, and it is used to lookup the type in a type registry, since there is no native mechanism to map from a type name to a Type object in Go. This means I need to register the types that I want to be able to persist and retrieve, but I could live with that. Here's how it goes:</p>\n\n<pre><code>typeregistry.Register(reflect.TypeOf((*S1)(nil)).Elem())\ntyperegistry.Register(reflect.TypeOf((*S2)(nil)).Elem())\n</code></pre>\n\n<p>Here's the code for the type registry:</p>\n\n<pre><code>var types map[string]reflect.Type\n\nfunc init() {\n    types = make(map[string]reflect.Type)\n}\n\nfunc Register(t reflect.Type) {\n    key := GetKey(t)\n    types[key] = t\n}\n\nfunc GetKey(t reflect.Type) string {\n    key := t.PkgPath() + \".\" + t.Name()\n    return key\n}\n\nfunc GetType(key string) reflect.Type {\n    t := types[key]\n    return t\n}\n</code></pre>\n\n<p>The code for saving an object is quite straightforward:</p>\n\n<pre><code>func save(coll *mgo.Collection, s I) (bson.ObjectId, error) {\n    t := reflect.TypeOf(s)\n    wrapper := Wrapper{\n        Id:      bson.NewObjectId(),\n        TypeKey: typeregistry.GetKey(t),\n        Val:     s,\n    }\n    return wrapper.Id, coll.Insert(wrapper)\n}\n</code></pre>\n\n<p>The code for retrieving an object is a bit more tricky:</p>\n\n<pre><code>func getById(coll *mgo.Collection, id interface{}) (*I, error) {\n    // read wrapper\n    wrapper := Wrapper{}\n    err := coll.Find(bson.M{\"_id\": id}).One(&amp;wrapper)\n    if err != nil {\n        return nil, err\n    }\n\n    // obtain Type from registry\n    t := typeregistry.GetType(wrapper.TypeKey)\n\n    // get a pointer to a new value of this type\n    pt := reflect.New(t)\n\n    // FIXME populate value using wrapper.Val (type bson.M)\n    // HOW ???\n\n    // return the value as *I\n    i := pt.Elem().Interface().(I)\n    return &amp;i, nil\n}\n</code></pre>\n\n<p>This partially works as the returned object is typed correctly, but what i can't figure out is how to populate the value <code>pt</code> with the data retrieved from MongoDB which is stored in <code>wrapper.Val</code> as a <code>bson.M</code>.</p>\n\n<p>I have tried the following but it doesn't work:</p>\n\n<pre><code>m := wrapper.Val.(bson.M)\nbsonBytes, _ := bson.Marshal(m)\nbson.Unmarshal(bsonBytes, pt)\n</code></pre>\n\n<p>So basically the remaining problem is: how to populate an unknown structure from a <code>bson.M</code> value? I'm sure there has to be an easy solution...\nThanks in advance for any help.</p>\n\n<p>Here's a Github gist with all the code: <a href=\"https://gist.github.com/ogerardin/5aa272f69563475ba9d7b3194b12ae57\" rel=\"nofollow noreferrer\">https://gist.github.com/ogerardin/5aa272f69563475ba9d7b3194b12ae57</a></p>\n"}, {"tags": ["go", "logging"], "comments": [{"owner": {"reputation": 37, "user_id": 7662152, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rpjHDiSUzjw/AAAAAAAAAAI/AAAAAAAAABo/3Qj1rwBDplg/photo.jpg?sz=128", "display_name": "Madhuri Desai", "link": "https://stackoverflow.com/users/7662152/madhuri-desai"}, "edited": false, "score": 0, "creation_date": 1551091426, "post_id": 54864399, "comment_id": 96499260, "body": "I have been referring to <a href=\"https://godoc.org/github.com/alecthomas/log4go\" rel=\"nofollow noreferrer\">godoc.org/github.com/alecthomas/log4go</a> this site"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 7662152, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rpjHDiSUzjw/AAAAAAAAAAI/AAAAAAAAABo/3Qj1rwBDplg/photo.jpg?sz=128", "display_name": "Madhuri Desai", "link": "https://stackoverflow.com/users/7662152/madhuri-desai"}, "edited": false, "score": 0, "creation_date": 1551093135, "post_id": 54864716, "comment_id": 96500264, "body": "Logrus does not support writing into two different logs file right? Even i was using Logrus, i moved to log4go because there was requirement to write logs in two different files"}, {"owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "reply_to_user": {"reputation": 37, "user_id": 7662152, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rpjHDiSUzjw/AAAAAAAAAAI/AAAAAAAAABo/3Qj1rwBDplg/photo.jpg?sz=128", "display_name": "Madhuri Desai", "link": "https://stackoverflow.com/users/7662152/madhuri-desai"}, "edited": false, "score": 0, "creation_date": 1551093252, "post_id": 54864716, "comment_id": 96500308, "body": "Did you take a look to <a href=\"https://github.com/rifflock/lfshook\" rel=\"nofollow noreferrer\">lfshook</a>? It should solve your problem"}, {"owner": {"reputation": 37, "user_id": 7662152, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rpjHDiSUzjw/AAAAAAAAAAI/AAAAAAAAABo/3Qj1rwBDplg/photo.jpg?sz=128", "display_name": "Madhuri Desai", "link": "https://stackoverflow.com/users/7662152/madhuri-desai"}, "edited": false, "score": 0, "creation_date": 1551093731, "post_id": 54864716, "comment_id": 96500559, "body": "Ifshook writes to different files based on log levels. Am I correct? I need to log based on certain some decoding of bytes. Can i somehow specify that instead of log levels?"}], "tags": [], "owner": {"reputation": 6654, "user_id": 2606098, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/P2wJB.jpg?s=128&g=1", "display_name": "Tinwor", "link": "https://stackoverflow.com/users/2606098/tinwor"}, "is_accepted": false, "score": 0, "last_activity_date": 1551092510, "creation_date": 1551092510, "answer_id": 54864716, "question_id": 54864399, "link": "https://stackoverflow.com/questions/54864399/how-to-use-log4go-with-configuration-file/54864716#54864716", "title": "How to use log4go with configuration file?", "body": "<p>log4go is not well documented, I found some documentation in the <a href=\"https://code.google.com/archive/p/log4go/wikis/LogWriters.wiki\" rel=\"nofollow noreferrer\">original repository</a>.<br>\nIf you can, I'd use a different library like <a href=\"https://github.com/sirupsen/logrus\" rel=\"nofollow noreferrer\">logrus</a>, has a better documentation, examples and is actively developed.</p>\n"}, {"tags": [], "owner": {"reputation": 361, "user_id": 4296604, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-XIWi_RQN2rc/AAAAAAAAAAI/AAAAAAAAAA4/gb9rJ74hXSk/photo.jpg?sz=128", "display_name": "Chen Keinan", "link": "https://stackoverflow.com/users/4296604/chen-keinan"}, "is_accepted": false, "score": 0, "last_activity_date": 1565782652, "creation_date": 1565782652, "answer_id": 57493938, "question_id": 54864399, "link": "https://stackoverflow.com/questions/54864399/how-to-use-log4go-with-configuration-file/57493938#57493938", "title": "How to use log4go with configuration file?", "body": "<p>The easy way is to use the logConfig xml, for example: </p>\n\n<pre><code>&lt;code&gt;\n    &lt;logging&gt;\n    &lt;filter enabled=\"true\"&gt;\n      &lt;tag&gt;stdout&lt;/tag&gt;\n      &lt;type&gt;console&lt;/type&gt;\n      &lt;!-- level is (:?FINEST|FINE|DEBUG|TRACE|INFO|WARNING|ERROR) --&gt;\n      &lt;level&gt;INFO&lt;/level&gt;\n      &lt;/filter&gt;\n      &lt;filter enabled=\"true\"&gt;\n            &lt;tag&gt;file&lt;/tag&gt;\n            &lt;type&gt;file&lt;/type&gt;\n            &lt;level&gt;INFO&lt;/level&gt;\n            &lt;property name=\"filename\"&gt;&lt;log file Path&gt;&lt;/property&gt;\n\n            &lt;!--\n              %T - Time (15:04:05 MST)\n              %t - Time (15:04)\n              %D - Date (2006/01/02)\n              %d - Date (01/02/06)\n              %L - Level (FNST, FINE, DEBG, TRAC, WARN, EROR, CRIT)\n              %S - Source\n              %M - Message\n              It ignores unknown format strings (and removes them)\n              Recommended: \"[%D %T] [%L] (%S) %M\"\n            --&gt;\n            &lt;property name=\"format\"&gt;[%D %T] [%L] (%S) %M&lt;/property&gt;\n            &lt;property name=\"rotate\"&gt;true&lt;/property&gt; &lt;!-- true enables log rotation, otherwise append --&gt;\n            &lt;property name=\"maxsize\"&gt;10M&lt;/property&gt; &lt;!-- \\d+[KMG]? Suffixes are in terms of 2**10 --&gt;\n            &lt;property name=\"maxlines\"&gt;0K&lt;/property&gt; &lt;!-- \\d+[KMG]? Suffixes are in terms of thousands --&gt;\n            &lt;property name=\"daily\"&gt;true&lt;/property&gt; &lt;!-- Automatically rotates when a log message is written after midnight --&gt;\n            &lt;property name=\"maxbackup\"&gt;10&lt;/property&gt; &lt;!-- Max backup for logs rotation --&gt;\n      &lt;/filter&gt;\n    &lt;/logging&gt;\n</code></pre>\n\n<p></p>\n\n<p>Personally, I preferred zarolog : <a href=\"https://github.com/rs/zerolog\" rel=\"nofollow noreferrer\">https://github.com/rs/zerolog</a></p>\n"}], "owner": {"reputation": 37, "user_id": 7662152, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-rpjHDiSUzjw/AAAAAAAAAAI/AAAAAAAAABo/3Qj1rwBDplg/photo.jpg?sz=128", "display_name": "Madhuri Desai", "link": "https://stackoverflow.com/users/7662152/madhuri-desai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 637, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1565782652, "creation_date": 1551091394, "question_id": 54864399, "link": "https://stackoverflow.com/questions/54864399/how-to-use-log4go-with-configuration-file", "title": "How to use log4go with configuration file?", "body": "<p>I have been trying to use log4go in golang. But I could not find a proper example where log4go configuration properties were used like rotation,maxSize etc to create a logger. Can somebody provide a example? I have referred to many sites.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1551087090, "post_id": 54863062, "comment_id": 96496796, "body": "You need to export getRoutes to be able to use it outside of its package. Change getRoutes to GetRoutes. First uppercase letter makes an identifier in Go exported."}, {"owner": {"reputation": 7599, "user_id": 170961, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/1e252d94e2b6093fc408baec2c7e5065?s=128&d=identicon&r=PG", "display_name": "matiit", "link": "https://stackoverflow.com/users/170961/matiit"}, "edited": false, "score": 1, "creation_date": 1551087172, "post_id": 54863062, "comment_id": 96496840, "body": "Only capitalized function names are being exported, moreover, show us how you build project."}, {"owner": {"reputation": 49, "user_id": 5212311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BlwtY.jpg?s=128&g=1", "display_name": "fredy setiawan", "link": "https://stackoverflow.com/users/5212311/fredy-setiawan"}, "edited": false, "score": 0, "creation_date": 1551087375, "post_id": 54863062, "comment_id": 96496961, "body": "wow it&#39;s work just capitalized make it wrong?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551087417, "post_id": 54863062, "comment_id": 96496987, "body": "<a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Exported_identifiers</a>"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 0, "creation_date": 1551087418, "post_id": 54863062, "comment_id": 96496988, "body": "Show the project directory structure please."}], "answers": [{"tags": [], "owner": {"reputation": 66, "user_id": 8565944, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4f3d058a473fae75663280447f043e9?s=128&d=identicon&r=PG&f=1", "display_name": "bally", "link": "https://stackoverflow.com/users/8565944/bally"}, "is_accepted": true, "score": 3, "last_activity_date": 1551087248, "creation_date": 1551087248, "answer_id": 54863144, "question_id": 54863062, "link": "https://stackoverflow.com/questions/54863062/ask-import-undefined-go/54863144#54863144", "title": "ask import undefined Go", "body": "<p>function start with lower case is an unexport function. An unexport function can be used only inside the package. You have to export getRoute function by changing the function name to <strong>GetRoute</strong>.</p>\n"}], "owner": {"reputation": 49, "user_id": 5212311, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BlwtY.jpg?s=128&g=1", "display_name": "fredy setiawan", "link": "https://stackoverflow.com/users/5212311/fredy-setiawan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 54863144, "answer_count": 1, "score": -6, "last_activity_date": 1551087248, "creation_date": 1551086987, "question_id": 54863062, "link": "https://stackoverflow.com/questions/54863062/ask-import-undefined-go", "title": "ask import undefined Go", "body": "<p>i have problem about import on go lang. How to call package routes and function getRoute(my own function) on golang?</p>\n\n<p>my main package is </p>\n\n<pre><code>package main\nimport(\n    \"github.com/majalah/apps/routes\"\n)\nfunc main() {\n    routes.getRoute()\n}\n</code></pre>\n\n<p>and my routes package inside apps and folder routes</p>\n\n<pre><code>package routes\n\nfunc getRoute() {\n\n}\n</code></pre>\n\n<p>it's always error</p>\n\n<pre><code>4.2 imported and not used \"routes\"\n8.2 undefined \"routes\"\n</code></pre>\n"}, {"tags": ["windows", "go", "winapi", "etw"], "answers": [{"comments": [{"owner": {"reputation": 579, "user_id": 1027467, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/594c29c61ddc19f99241d167a3982961?s=128&d=identicon&r=PG", "display_name": "Nedo", "link": "https://stackoverflow.com/users/1027467/nedo"}, "edited": false, "score": 0, "creation_date": 1551137681, "post_id": 54874380, "comment_id": 96522686, "body": "Unfortunately, I already tried by converting the array to slice, but all I get is a slice with bizarre lengths of invalid entries (attempting to index the slice leads to unexpected fault address panic)"}], "tags": [], "owner": {"reputation": 91, "user_id": 10358755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51159558241ef0a8369e1b4973adce4f?s=128&d=identicon&r=PG&f=1", "display_name": "Jose Rod", "link": "https://stackoverflow.com/users/10358755/jose-rod"}, "is_accepted": false, "score": 0, "last_activity_date": 1551127453, "creation_date": 1551127453, "answer_id": 54874380, "question_id": 54862758, "link": "https://stackoverflow.com/questions/54862758/dealing-with-unsized-arrays-in-go-and-windows-api/54874380#54874380", "title": "Dealing with unsized arrays in Go and Windows API", "body": "<p>So you want a variable sized array in Go? Use a slice?</p>\n\n<pre><code>EventPropertyInfoArray [1]EventPropertyInfo\n</code></pre>\n\n<p>Would be</p>\n\n<pre><code>EventPropertyInfoArray []EventPropertyInfo\n</code></pre>\n\n<p>If you have a rough idea of a maximum it could hold you could make an array using make something like this, but this wouldn't help you out in declaring a struct:</p>\n\n<pre><code>EventPropertyInfoArray = make([]EventPropertyInfo, len, capacity)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 579, "user_id": 1027467, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/594c29c61ddc19f99241d167a3982961?s=128&d=identicon&r=PG", "display_name": "Nedo", "link": "https://stackoverflow.com/users/1027467/nedo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551170999, "creation_date": 1551170999, "answer_id": 54881535, "question_id": 54862758, "link": "https://stackoverflow.com/questions/54862758/dealing-with-unsized-arrays-in-go-and-windows-api/54881535#54881535", "title": "Dealing with unsized arrays in Go and Windows API", "body": "<p>After lots of trial and error, I managed to get the right slice from the backing array through standard technique for turning arrays into slices:</p>\n\n<pre><code> properties := (*[1 &lt;&lt; 30]EventPropertyInfo)(unsafe.Pointer(&amp;trace.EventPropertyInfoArray[0]))[:trace.PropertyCount:trace.PropertyCount] \n</code></pre>\n"}], "owner": {"reputation": 579, "user_id": 1027467, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/594c29c61ddc19f99241d167a3982961?s=128&d=identicon&r=PG", "display_name": "Nedo", "link": "https://stackoverflow.com/users/1027467/nedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 106, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1551170999, "creation_date": 1551085873, "last_edit_date": 1551126173, "question_id": 54862758, "link": "https://stackoverflow.com/questions/54862758/dealing-with-unsized-arrays-in-go-and-windows-api", "title": "Dealing with unsized arrays in Go and Windows API", "body": "<p>What is the idiomatic way to deal with unsized arrays in Go? I'm working on the ETW wrappers and the <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/tdh/nf-tdh-tdhgeteventinformation\" rel=\"nofollow noreferrer\">TdhGetEventInformation</a> function fills in the provided memory buffer with event information. The event metadata is represented by <a href=\"https://docs.microsoft.com/en-us/windows/desktop/api/tdh/ns-tdh-_trace_event_info\" rel=\"nofollow noreferrer\">TRACE_EVENT_INFO</a> structure, which has an array member declared as:</p>\n\n<pre><code>EVENT_PROPERTY_INFO EventPropertyInfoArray[ANYSIZE_ARRAY];\n</code></pre>\n\n<p>I'm calling the <code>TdhGetEventInformation</code> function in a way that the provided buffer has enough space to populate event properties array:</p>\n\n<pre><code>var bufferSize uint32 = 4096\nbuffer := make([]byte, bufferSize)\n\ntdhGetEventInformation.Call(\n   uintptr(unsafe.Pointer(eventRecord)),\n   0, 0, \n   uintptr(unsafe.Pointer(&amp;buffer[0])),\n   uintptr(unsafe.Pointer(&amp;bufferSize)),\n)\n</code></pre>\n\n<p>However, since I'm tempting to model the Go counterpart struct with <code>EventPropertyInfoArray</code> field as</p>\n\n<pre><code>EventPropertyInfoArray [1]EventPropertyInfo\n</code></pre>\n\n<p>the compiler is not able to re dimension the array according to the number of available properties for each event, so I end up with one-array item. </p>\n\n<p>Do you have any smart ideas on how handle this edge case?</p>\n\n<p>Thanks in advance</p>\n"}, {"tags": ["google-app-engine", "go", "trace", "stackdriver"], "comments": [{"owner": {"reputation": 421, "user_id": 456157, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/76giS.jpg?s=128&g=1", "display_name": "Askar", "link": "https://stackoverflow.com/users/456157/askar"}, "edited": false, "score": 0, "creation_date": 1551124462, "post_id": 54859976, "comment_id": 96517406, "body": "Try to add <code>trace.ApplyConfig(trace.Config{DefaultSampler: trace.AlwaysSample()})</code>"}], "answers": [{"tags": [], "owner": {"reputation": 399, "user_id": 515508, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6caa904a0954f9f8a9f56aab518f842?s=128&d=identicon&r=PG", "display_name": "ymotongpoo", "link": "https://stackoverflow.com/users/515508/ymotongpoo"}, "is_accepted": false, "score": 0, "last_activity_date": 1551227720, "creation_date": 1551227720, "answer_id": 54896302, "question_id": 54859976, "link": "https://stackoverflow.com/questions/54859976/stackdriver-trace-with-google-app-engine-go-1-11-runtime/54896302#54896302", "title": "Stackdriver Trace with Google App Engine Go 1.11 runtime", "body": "<p>As written in the reply comment in the original question, can you try the config for sampling?: <code>trace.AlwaysSample()</code></p>\n\n<p>You can find some comments about sampling rate in <a href=\"https://opencensus.io/quickstart/go/tracing/#configure-sampler\" rel=\"nofollow noreferrer\">OpenCensus Trace documentation</a> and <a href=\"https://godoc.org/go.opencensus.io/trace#Config\" rel=\"nofollow noreferrer\">godoc of OpenCensus Trace library</a>:</p>\n\n<blockquote>\n  <p>By default, traces will be sampled relatively rarely. To change the sampling frequency for your entire program, call ApplyConfig. Use a ProbabilitySampler to sample a subset of traces, or use AlwaysSample to collect a trace on every run:</p>\n</blockquote>\n"}], "owner": {"reputation": 2000, "user_id": 220825, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/74b32bb23d8db691db6c0226d97a707c?s=128&d=identicon&r=PG&f=1", "display_name": "jckdnk111", "link": "https://stackoverflow.com/users/220825/jckdnk111"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 111, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551249609, "creation_date": 1551072412, "last_edit_date": 1551249609, "question_id": 54859976, "link": "https://stackoverflow.com/questions/54859976/stackdriver-trace-with-google-app-engine-go-1-11-runtime", "title": "Stackdriver Trace with Google App Engine Go 1.11 runtime", "body": "<p>I would like to get Stackdriver Trace to work on the new <a href=\"https://cloud.google.com/appengine/docs/standard/go111/\" rel=\"nofollow noreferrer\">Go 1.11 standard runtime on Google App Engine</a>. This is all still labeled as beta so maybe it just doesn't quite work yet. However, I followed the <a href=\"https://cloud.google.com/trace/docs/setup/go\" rel=\"nofollow noreferrer\">step-by-step directions</a> and it isn't working. I deployed the code (almost) exactly as it is listed in the link and my traces are flat (i.e. doesn't include the waterfall view I would expect with the incoming request at the top and the outgoing request nested underneath). </p>\n\n<p>Sample code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    \"contrib.go.opencensus.io/exporter/stackdriver\"\n    \"contrib.go.opencensus.io/exporter/stackdriver/propagation\"\n    \"go.opencensus.io/plugin/ochttp\"\n    \"go.opencensus.io/trace\"\n)\n\nfunc main() {\n    // Create and register a OpenCensus Stackdriver Trace exporter.\n    exporter, err := stackdriver.NewExporter(stackdriver.Options{\n        ProjectID: os.Getenv(\"GOOGLE_CLOUD_PROJECT\"),\n    })\n    if err != nil {\n        log.Fatal(err)\n    }\n    trace.RegisterExporter(exporter)\n\n    client := &amp;http.Client{\n        Transport: &amp;ochttp.Transport{\n            // Use Google Cloud propagation format.\n            Propagation: &amp;propagation.HTTPFormat{},\n        },\n    }\n\n    handler := http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        req, _ := http.NewRequest(\"GET\", \"https://www.google.com/robots.txt\", nil)\n\n        // The trace ID from the incoming request will be\n        // propagated to the outgoing request.\n        req = req.WithContext(r.Context())\n\n        // The outgoing request will be traced with r's trace ID.\n        resp, err := client.Do(req)\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer resp.Body.Close()\n\n        fmt.Fprint(w, \"OK\")\n    })\n    http.Handle(\"/foo\", handler)\n    log.Fatal(http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), &amp;ochttp.Handler{}))\n}\n</code></pre>\n\n<p>Sample trace:\n<a href=\"https://i.stack.imgur.com/T4VdQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/T4VdQ.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1887, "user_id": 6514989, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7cc849ff19574490024b6e12ef33c82b?s=128&d=identicon&r=PG&f=1", "display_name": "nail fei", "link": "https://stackoverflow.com/users/6514989/nail-fei"}, "edited": false, "score": 0, "creation_date": 1551077139, "post_id": 54860006, "comment_id": 96492201, "body": "I replace all relevant throw to panic in hash.go and hash_fast.go. but the recover handler still not be invoked."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 1887, "user_id": 6514989, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7cc849ff19574490024b6e12ef33c82b?s=128&d=identicon&r=PG&f=1", "display_name": "nail fei", "link": "https://stackoverflow.com/users/6514989/nail-fei"}, "edited": false, "score": 0, "creation_date": 1551079799, "post_id": 54860006, "comment_id": 96493275, "body": "The concurrent access checks are in map.go."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1551072625, "creation_date": 1551072625, "answer_id": 54860006, "question_id": 54859858, "link": "https://stackoverflow.com/questions/54859858/why-recover-dont-work-when-writes-global-map-in-golang/54860006#54860006", "title": "why recover dont work when writes global map in golang", "body": "<p>The <code>recover()</code> function handles panics. </p>\n\n<p>When the runtime detects a concurrent map access, the runtime exits the process with a call to <a href=\"https://github.com/golang/go/blob/585c9e8412540b10be5154d019828a1a27f7b4c4/src/runtime/panic.go#L673\" rel=\"nofollow noreferrer\">fatalthrow</a>. </p>\n\n<p>The runtime does not panic in this situation, therefore the recover handler is not invoked.</p>\n"}], "owner": {"reputation": 1887, "user_id": 6514989, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7cc849ff19574490024b6e12ef33c82b?s=128&d=identicon&r=PG&f=1", "display_name": "nail fei", "link": "https://stackoverflow.com/users/6514989/nail-fei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 154, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1551077170, "creation_date": 1551071651, "last_edit_date": 1551077170, "question_id": 54859858, "link": "https://stackoverflow.com/questions/54859858/why-recover-dont-work-when-writes-global-map-in-golang", "title": "why recover dont work when writes global map in golang", "body": "<p>I have a global map, and I use many goroutines to write map concurrently without without limit. Then this of course will cause panic. So I add recover method in order to deal with panic. But it seemed they make no difference.\n<br> my code as below:</p>\n\n<pre><code>var m = make(map[int]int)\n\nfunc main(){\n    defer func(){\n        if err:=recover();err!=nil{\n            fmt.Printf(\"=====recover in main:%s\\n\",err)\n        }\n    }()\n    count := 1000\n    for i:=0;i&lt;count;i++{\n        go AddEle()\n    }\n}\n\nfunc AddEle(){\n    defer func(){\n        if err:=recover();err!=nil{\n            fmt.Printf(\"====recover in child goroutines:%s\",err)\n        }\n    }()\n    for i:=1;i&lt;1000;i++{\n        m[i] = i\n    }\n}\n</code></pre>\n\n<p>and the output as below:<br></p>\n\n<pre><code> fatal error: concurrent map writesc\n goroutine 5 [running]:\n    runtime.throw(0x666514, 0x15)\n/usr/local/go/src/runtime/panic.go:605 +0x95 fp=0xc42002ff48 \nsp=0xc42002ff28 pc=0x42b2a5\nruntime.mapassign_fast64(0x61c360, 0xc42007cbd0, 0x1, 0x0)\n    /usr/local/go/src/runtime/hashmap_fast.go:519 +0x3d2 \nfp=0xc42002ffa8 sp=0xc42002ff48 pc=0x40dbb2\n    main.AddEle()\n    /home/geek/go/work/src/web/main.go:34 +0x6a fp=0xc42002ffe0 \nsp=0xc42002ffa8 pc=0x5e257a\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2337 +0x1 fp=0xc42002ffe8 \nsp=0xc42002ffe0 pc=0x458821\ncreated by main.main\n    c/home/geek/go/work/src/web/main.go:22 +0x5at.\n</code></pre>\n\n<p>so I want to know why recover dont make effect.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "edited": false, "score": 0, "creation_date": 1551071822, "post_id": 54859658, "comment_id": 96490543, "body": "do you mean <code>c:=append(*comb, i)</code> add i to comb firstly, and then decide whether it&#39;s necessary to create a new slice for c?"}, {"owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "edited": false, "score": 0, "creation_date": 1551168221, "post_id": 54859658, "comment_id": 96530839, "body": "Thanks for sharing the blog, I have finished reading it, and it helps a lot. But one more thing, when I print the address of the slices in result:  <code>0xc000018260ath, 0xc000018260ath, 0xc000018280ath, 0xc0000182a0ath, 0xc0000182c0ath</code>  the first and the second shared the same address, but others did not, I can&#39;t figure   out the reason"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "edited": false, "score": 0, "creation_date": 1551326342, "post_id": 54859658, "comment_id": 96602003, "body": "@kasheemlew I have updated my answer to address that."}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 2, "last_activity_date": 1551510419, "last_edit_date": 1551510419, "creation_date": 1551070325, "answer_id": 54859658, "question_id": 54859510, "link": "https://stackoverflow.com/questions/54859510/golang-combination-generation-made-an-error/54859658#54859658", "title": "golang combination generation made an error", "body": "<p>This is a common mistake when using <code>append</code>.</p>\n\n<p>When your code runs <code>c:=append(*comb,i)</code>, it tries to first use the allocated memory in the underlying array to add a new item and only create a new slice when it failed to do so. This is what changes the <code>[1 2 3 4]</code> to <code>[1 2 3 5]</code> - because they share the same underlying memory.</p>\n\n<p>To fix this, copy when you want to append into result:</p>\n\n<pre><code>now := make([]int,len(*comb))\ncopy(now,*comb)\n*result = append(*result,now)\n</code></pre>\n\n<p>Or use a shortcut of copying:</p>\n\n<pre><code>*result = append(*result, append([]int{},*comb...))\n</code></pre>\n\n<p>Update:</p>\n\n<p>To understand what I mean by underlying memory, one should understandd the internal model of Go's slice.</p>\n\n<p>In Go, a slice has a data structure called <code>SliceHeader</code> which is accessible through <code>reflect</code> package and is what being referred to when you use <code>unsafe.Sizeof</code> and taking address.</p>\n\n<p>The <code>SliceHeader</code> taking cares of three elements: <code>Len</code>,<code>Cap</code> and a <code>Ptr</code>. The fisrt two is trivail: they are what <code>len()</code> and <code>cap()</code> is for. The last one is a <code>uintptr</code> that points to the memory of the data the slice is containing.</p>\n\n<p>When you shallow-copy a slice, a new <code>SliceHeader</code> is created but with the same content, including <code>Ptr</code>. So the underlying memory is not copied, but shared.</p>\n"}], "owner": {"reputation": 165, "user_id": 5841205, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh5.googleusercontent.com/-GPjXyaF0z-I/AAAAAAAAAAI/AAAAAAAAAA0/w5mis91lU3Q/photo.jpg?sz=128", "display_name": "klew", "link": "https://stackoverflow.com/users/5841205/klew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 1, "accepted_answer_id": 54859658, "answer_count": 1, "score": 2, "last_activity_date": 1551510419, "creation_date": 1551069032, "question_id": 54859510, "link": "https://stackoverflow.com/questions/54859510/golang-combination-generation-made-an-error", "title": "golang combination generation made an error", "body": "<p>I'm dealing with a programming problem </p>\n\n<blockquote>\n  <p>Given two integers n and k, return all possible combinations of k numbers out of 1 ... n.</p>\n</blockquote>\n\n<p>and with input n = 5, k = 4, the output should be [[1,2,3,4],[1,2,3,5],[1,2,4,5],[1,3,4,5],[2,3,4,5]], the following is my golang solution</p>\n\n<pre><code>func combine(n int, k int) [][]int {\n    result := [][]int{}\n    comb := []int{}\n    subcom(0, k, n, &amp;comb, &amp;result)\n    return result\n}\n\nfunc subcom(s, k, n int, comb *[]int, result *[][]int) {\n    if k &gt; 0 {\n        for i := s + 1; i &lt;= n-k+1; i++ {\n            c := append(*comb, i)\n            subcom(i, k-1, n, &amp;c, result)\n        }\n    } else {\n        *result = append(*result, *comb)\n    }\n}\n</code></pre>\n\n<p>I think my solution is right, but it return [[1 2 3 5] [1 2 3 5] [1 2 4 5] [1 3 4 5] [2 3 4 5]]. </p>\n\n<p>After debugging, I found [1 2 3 4] was added to the result slice at the beginning, but later changed to [1 2 3 5], resulting in the repetition of two [1 2 3 5]s. But I can't figure out what's wrong here. </p>\n"}, {"tags": ["go", "tcp", "server"], "comments": [{"owner": {"reputation": 674, "user_id": 7285457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b81fc46ff4c9fe4c9d7c61942277b3?s=128&d=identicon&r=PG", "display_name": "Pizza lord", "link": "https://stackoverflow.com/users/7285457/pizza-lord"}, "edited": false, "score": 0, "creation_date": 1551091941, "post_id": 54859509, "comment_id": 96499579, "body": "do you have any open ports on the server and is the go http server running on those?"}], "answers": [{"tags": [], "owner": {"reputation": 90, "user_id": 4245000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/72f80c0289616c419d09ee5b4a475da3?s=128&d=identicon&r=PG&f=1", "display_name": "mdemir", "link": "https://stackoverflow.com/users/4245000/mdemir"}, "is_accepted": false, "score": 0, "last_activity_date": 1551128431, "creation_date": 1551128431, "answer_id": 54874588, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost/54874588#54874588", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>You are trying to output to console. Did you try to send it as a response?</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(fmt.Sprintf(\"Hi there, I love %s!\", r.URL.Path[1:])));\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 505, "user_id": 1183970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7ad5c0ce9ed28f329c608db3f3a76f4?s=128&d=identicon&r=PG", "display_name": "Renato", "link": "https://stackoverflow.com/users/1183970/renato"}, "is_accepted": false, "score": 0, "last_activity_date": 1551226853, "creation_date": 1551226853, "answer_id": 54896206, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost/54896206#54896206", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>No if you don't specify the host part of the address the server will listen on every available unicast address and every available anycast address of the system. So I would guess a problem in name resolution or routing.</p>\n"}, {"tags": [], "owner": {"reputation": 666, "user_id": 6529383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c903894822f1d97d7bf90bb15492268?s=128&d=identicon&r=PG", "display_name": "river", "link": "https://stackoverflow.com/users/6529383/river"}, "is_accepted": false, "score": 0, "last_activity_date": 1551988417, "creation_date": 1551988417, "answer_id": 55051835, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost/55051835#55051835", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>Your problem is that your server is listening on tcp6 stack. Try to explicitly use tcp with \u201c0.0.0.0:6789\u201d instead of just port \u201c:6789\u201d</p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "is_accepted": true, "score": 0, "last_activity_date": 1552535297, "creation_date": 1552535297, "answer_id": 55154690, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost/55154690#55154690", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>This is due to Linux listen rules.\nThere is a reject all rule on my rules.</p>\n\n<pre><code># listen rules\nsudo iptables -L INPUT --line-numbers\nsudo iptables -D INPUT 8\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 968, "user_id": 3988964, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/38XEF.jpg?s=128&g=1", "display_name": "Prakhar", "link": "https://stackoverflow.com/users/3988964/prakhar"}, "is_accepted": false, "score": 1, "last_activity_date": 1562688967, "creation_date": 1562688967, "answer_id": 56956780, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost/56956780#56956780", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>This has nothing to do with your code. It is a typical firewall issue. </p>\n\n<ul>\n<li>By default (on *nix platform) all the incoming traffic is blocked and all outgoing is allowed. You need to open the ports on your OS to allow incoming traffic to hit your servers. try installing <code>ufw</code> utility and run <code>sudo ufw allow 30175</code></li>\n<li>From the question, it seems your server is using tcp6. Ideally, it should not cause the problem because tcp6 is supposed to support both IPV4 as well as IPV6. But I would recommend you to downgrade it to tcp, if that makes sense.</li>\n</ul>\n"}], "owner": {"reputation": 63, "user_id": 8686497, "user_type": "registered", "profile_image": "https://graph.facebook.com/539120089752831/picture?type=large", "display_name": "Junchi Liu", "link": "https://stackoverflow.com/users/8686497/junchi-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3825, "favorite_count": 0, "accepted_answer_id": 55154690, "answer_count": 5, "score": 1, "last_activity_date": 1562688967, "creation_date": 1551069030, "last_edit_date": 1551907389, "question_id": 54859509, "link": "https://stackoverflow.com/questions/54859509/golang-http-server-http-listenandserve-only-works-for-localhost", "title": "golang http server http.ListenAndServe only works for localhost?", "body": "<p>I tied to implement an HTTP server in Azure Linux VM using golang. Below is the simple golang server code, listening on port 30175. And there is no firewall on that port. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n    log.Fatal(http.ListenAndServe(\":30175\", nil))\n}\n</code></pre>\n\n<p>The result of sudo netstat -tlnp is:</p>\n\n<pre><code>Active Internet connections (only servers)\nProto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name\ntcp        0      0 0.0.0.0:21              0.0.0.0:*               LISTEN      1605/vsftpd     \ntcp        0      0 127.0.0.1:3350          0.0.0.0:*               LISTEN      1873/xrdp-sesman\ntcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      1697/sshd       \ntcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      1379/cupsd      \ntcp        0      0 127.0.0.1:6010          0.0.0.0:*               LISTEN      4879/8          \ntcp        0      0 127.0.0.1:6011          0.0.0.0:*               LISTEN      15507/9         \ntcp        0      0 0.0.0.0:3389            0.0.0.0:*               LISTEN      1859/xrdp       \ntcp        0      0 0.0.0.0:8000            0.0.0.0:*               LISTEN      2112/python     \ntcp6       0      0 :::22                   :::*                    LISTEN      1697/sshd       \ntcp6       0      0 ::1:631                 :::*                    LISTEN      1379/cupsd      \ntcp6       0      0 ::1:6010                :::*                    LISTEN      4879/8          \ntcp6       0      0 ::1:6011                :::*                    LISTEN      15507/9         \ntcp6       0      0 :::30175                :::*                    LISTEN      46595/HttpHandler\n</code></pre>\n\n<p>I can get response only in localhost, but no response from remote server:</p>\n\n<pre><code>curl localhost:30175\nHi there, I love !\n</code></pre>\n\n<pre><code>curl serveripaddress:30175\nnot working\n</code></pre>\n"}, {"tags": ["go", "bson", "mongo-go"], "answers": [{"comments": [{"owner": {"reputation": 50, "user_id": 1918374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2864860858c18ab595a7f654e17318f9?s=128&d=identicon&r=PG", "display_name": "Ubuntu Man", "link": "https://stackoverflow.com/users/1918374/ubuntu-man"}, "edited": false, "score": 0, "creation_date": 1551071475, "post_id": 54859783, "comment_id": 96490453, "body": "Thanks, it works now. But how come only lowercase tags worked when I first tried it?"}, {"owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "reply_to_user": {"reputation": 50, "user_id": 1918374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2864860858c18ab595a7f654e17318f9?s=128&d=identicon&r=PG", "display_name": "Ubuntu Man", "link": "https://stackoverflow.com/users/1918374/ubuntu-man"}, "edited": false, "score": 1, "creation_date": 1551083686, "post_id": 54859783, "comment_id": 96495026, "body": "It&#39;s because bson made a guess on how they should be unmarshaled"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 6, "last_activity_date": 1551071220, "creation_date": 1551071220, "answer_id": 54859783, "question_id": 54859426, "link": "https://stackoverflow.com/questions/54859426/failed-to-decode-camelcase-fields-using-mongo-go-driver/54859783#54859783", "title": "Failed to decode camelcase fields using mongo-go-driver", "body": "<p>No, it is not failing decode camel-case fields. It is failing to parse struct tags.</p>\n\n<p>As per <a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"noreferrer\">doc</a>:</p>\n\n<blockquote>\n  <p>By convention, tag strings are a concatenation of optionally space-separated key:\"value\" pairs. Each key is a non-empty string consisting of non-control characters other than space (U+0020 ' '), quote (U+0022 '\"'), and colon (U+003A ':'). Each value is quoted using U+0022 '\"' characters and Go string literal syntax. </p>\n</blockquote>\n\n<p>You should remove the space after <code>json:</code> and <code>bson:</code>.</p>\n"}], "owner": {"reputation": 50, "user_id": 1918374, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/2864860858c18ab595a7f654e17318f9?s=128&d=identicon&r=PG", "display_name": "Ubuntu Man", "link": "https://stackoverflow.com/users/1918374/ubuntu-man"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 706, "favorite_count": 0, "accepted_answer_id": 54859783, "answer_count": 1, "score": -1, "last_activity_date": 1551071220, "creation_date": 1551068256, "last_edit_date": 1551070518, "question_id": 54859426, "link": "https://stackoverflow.com/questions/54859426/failed-to-decode-camelcase-fields-using-mongo-go-driver", "title": "Failed to decode camelcase fields using mongo-go-driver", "body": "<p>I'm using a struct like so</p>\n\n<pre><code>type User struct {\n    Username  string    `json: \"username\" bson: \"username\"`\n    FirstName string    `json: \"firstName\" bson: \"firstName\"`\n    LastName  string    `json: \"lastName\" bson: \"lastName\"`\n    Email     string    `json: \"email\" bson: \"email\"`\n    Gender    string    `json: \"gender\" bson: \"gender\"`\n    Password  string    `json: \"password\" bson: \"password\"`\n    Enabled   bool      `json: \"enabled\" bson: \"enabled\"`\n    BirthDate time.Time `json: \"birthDate\" bson: \"birthDate\"`\n    CreatedAt time.Time `json: \"createdAt\" bson: \"createdAt\"`\n    UpdatedAt time.Time `json: \"updatedAt\" bson: \"updatedAt\"`\n    collection *mongo.Collection\n}\n</code></pre>\n\n<p>Then query data using</p>\n\n<pre><code>func (u *User) FindByUsername(userName string) error {\n    var ctx, _ = context.WithTimeout(context.Background(), 10*time.Second)\n    filter := bson.M{\"username\": userName}\n    err := u.collection.FindOne(ctx, filter).Decode(&amp;u)\n    return err\n}\n</code></pre>\n\n<p>The result that I'm getting is</p>\n\n<pre><code>{\"Username\":\"jbond\",\"FirstName\":\"\",\"LastName\":\"\",\"Email\":\"email@gmail.com\",\"Gender\":\"Male\",\"Password\":\"\",\"Enabled\":true,\"BirthDate\":\"0001-01-01T00:00:00Z\",\"CreatedAt\":\"0001-01-01T00:00:00Z\",\"UpdatedAt\":\"0001-01-01T00:00:00Z\"}\n</code></pre>\n\n<p>Most data are populated except for camel-case fields, and when I query from the console the data are there</p>\n\n<pre><code>&gt; db.users.find().pretty()\n{\n    \"_id\" : ObjectId(\"xxxxxxxxxxxxxxxxxxxxxxxx\"),\n    \"username\" : \"jbond\",\n    \"firstName\" : \"James\",\n    \"lastName\" : \"Bond\",\n    \"email\" : \"email@gmail.com\",\n    \"password\" : \"\",\n    \"enabled\" : true,\n    \"gender\" : \"Male\",\n    \"birthDate\" : {\n        \"type\" : {\n            \"code\" : \"function Date() {\\n    [native code]\\n}\"\n        }\n    },\n    \"createdAt\" : {\n        \"type\" : {\n            \"code\" : \"function Date() {\\n    [native code]\\n}\"\n        },\n        \"default\" : {\n            \"code\" : \"function now() {\\n    [native code]\\n}\"\n        }\n    },\n    \"updatedAt\" : {\n        \"type\" : {\n            \"code\" : \"function Date() {\\n    [native code]\\n}\"\n        },\n        \"default\" : {\n            \"code\" : \"function now() {\\n    [native code]\\n}\"\n        }\n    }\n}\n</code></pre>\n\n<p>I don't understand why should it all be lowercase. Or am I missing something?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1551084964, "post_id": 54858615, "comment_id": 96495639, "body": "Ah that makes total sense. How did I miss it!"}], "tags": [], "owner": {"reputation": 29582, "user_id": 1427098, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Bvdm0.jpg?s=128&g=1", "display_name": "Darshan Rivka Whittle", "link": "https://stackoverflow.com/users/1427098/darshan-rivka-whittle"}, "is_accepted": true, "score": 9, "last_activity_date": 1551078377, "last_edit_date": 1551078377, "creation_date": 1551060980, "answer_id": 54858615, "question_id": 54858555, "link": "https://stackoverflow.com/questions/54858555/anonymous-type-declaration-works-differently-via-var-vs/54858615#54858615", "title": "Anonymous type declaration works differently via &quot;var&quot; vs &quot;:=&quot;", "body": "<p><code>var v struct{}</code> gives <code>v</code> type <code>struct{}</code> but doesn't explicitly set a value, so it gets the zero value <code>{}</code>.</p>\n\n<p><code>t := struct{}</code> isn't a complete expression.  You'd need <code>t := struct{}{}</code> to create <code>t</code> with type <code>struct {}</code> and give it the value <code>{}</code>.</p>\n\n<p>In other words, <code>struct{}</code> is a type, but creating <code>t</code> with <code>:=</code> needs a value, not just a type on the right side.  <code>struct{}{}</code> is how you write the literal form of an anonymous empty struct.</p>\n"}], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 54858615, "answer_count": 1, "score": 1, "last_activity_date": 1551078377, "creation_date": 1551060389, "question_id": 54858555, "link": "https://stackoverflow.com/questions/54858555/anonymous-type-declaration-works-differently-via-var-vs", "title": "Anonymous type declaration works differently via &quot;var&quot; vs &quot;:=&quot;", "body": "<p>While declaring a variable with anonymous type in Go, I'm seeing <code>var v</code> versus <code>v:=</code> syntaxes work differently. Imagine we're declaring an empty anonymous struct type instance and assign it to a variable.</p>\n\n<p>This works:</p>\n\n<pre><code>func main() {\n    var  v struct {}\n    _ = v\n</code></pre>\n\n<p>But this does not:</p>\n\n<pre><code>func main() {\n    t := struct{}\n    _ = t\n}\n</code></pre>\n\n<p>compiling this gives the following error (<a href=\"https://play.golang.org/p/MgbttbBVmYE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MgbttbBVmYE</a>):</p>\n\n<pre><code>prog.go:8:7: type struct {} is not an expression\n</code></pre>\n\n<p>Why is this the case?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1551060286, "post_id": 54858529, "comment_id": 96488383, "body": "have you tried <a href=\"https://github.com/golang/go/wiki/SliceTricks#reversing\" rel=\"nofollow noreferrer\">github.com/golang/go/wiki/SliceTricks#reversing</a>"}, {"owner": {"reputation": 51, "user_id": 9147426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61d7498a3b7e3fbb9c68336a5447068?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Charles", "link": "https://stackoverflow.com/users/9147426/liu-charles"}, "reply_to_user": {"reputation": 9542, "user_id": 8068625, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4spqa.png?s=128&g=1", "display_name": "Henry Woody", "link": "https://stackoverflow.com/users/8068625/henry-woody"}, "edited": false, "score": 0, "creation_date": 1551063222, "post_id": 54858529, "comment_id": 96488886, "body": "I know the a,b=b,a trick. But that is for specific type of slice....my function here is a arbitrary type of slice, so I need to use the reflect package...I think things are different....maybe I am wrong...thanks"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1551065669, "post_id": 54858529, "comment_id": 96489341, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/28058278/how-do-i-reverse-a-slice-in-go\">How do I reverse a slice in go?</a>"}, {"owner": {"reputation": 51, "user_id": 9147426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61d7498a3b7e3fbb9c68336a5447068?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Charles", "link": "https://stackoverflow.com/users/9147426/liu-charles"}, "edited": false, "score": 0, "creation_date": 1551067516, "post_id": 54858529, "comment_id": 96489660, "body": "oh,thanks.My mistake. I should add comment in your answer.Actually I want to know the situation if the argument is pointer of slice (swapper won&#39;t work).And the answer in my question helped me. thank you"}, {"owner": {"reputation": 51, "user_id": 9147426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61d7498a3b7e3fbb9c68336a5447068?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Charles", "link": "https://stackoverflow.com/users/9147426/liu-charles"}, "edited": false, "score": 0, "creation_date": 1551072280, "post_id": 54858529, "comment_id": 96490675, "body": "Sorry, It is just a exercise I found in internet.Thanks for your further guidance."}], "answers": [{"tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": false, "score": 1, "last_activity_date": 1551064628, "creation_date": 1551064628, "answer_id": 54859033, "question_id": 54858529, "link": "https://stackoverflow.com/questions/54858529/golang-reverse-a-arbitrary-slice/54859033#54859033", "title": "Golang reverse a arbitrary slice", "body": "<p>Your code works fine. To use <code>reflect.Swapper</code>, just pass <code>s.Interface()</code> into it:</p>\n\n<pre><code>var Reverse = func(slice interface{}) {\n    s := reflect.ValueOf(slice)\n    // if s is a pointer of slice\n    if s.Kind() == reflect.Ptr {\n        s = s.Elem()\n    }\n    swp := reflect.Swapper(s.Interface())\n    for i,j :=0,s.Len() - 1; i&lt;j; i,j = i+1,j-1 {\n        swp(i,j)\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/DSq_iZRZX4b\" rel=\"nofollow noreferrer\">https://play.golang.org/p/DSq_iZRZX4b</a></p>\n"}], "owner": {"reputation": 51, "user_id": 9147426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f61d7498a3b7e3fbb9c68336a5447068?s=128&d=identicon&r=PG&f=1", "display_name": "Liu Charles", "link": "https://stackoverflow.com/users/9147426/liu-charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 387, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551064628, "creation_date": 1551060092, "question_id": 54858529, "link": "https://stackoverflow.com/questions/54858529/golang-reverse-a-arbitrary-slice", "title": "Golang reverse a arbitrary slice", "body": "<pre><code>var Reverse = func(slice interface{}) {\n    s := reflect.ValueOf(slice)\n    // if s is a pointer of slice\n    if s.Kind() == reflect.Ptr {\n        s = s.Elem()\n    }\n    i := 0\n    j := s.Len() - 1\n    for i &lt; j {\n        x, y := s.Index(i).Interface(), \n           s.Index(j).Interface()\n        s.Index(i).Set(reflect.ValueOf(y))\n        s.Index(j).Set(reflect.ValueOf(x))\n        i++\n        j--\n    }\n}\n</code></pre>\n\n<p>I found this way works.But it is not elegant....\nI know there is a method \"Swapper\" in reflect package. But I don't know how to make it work if the argument of above function is a pointer of slice.</p>\n\n<p>Really appreciate.</p>\n"}, {"tags": ["docker", "go", "docker-compose", "hyperledger-fabric", "hyperledger"], "comments": [{"owner": {"reputation": 458, "user_id": 10198856, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-3ix7iBPDwgw/AAAAAAAAAAI/AAAAAAAAADU/XDXnc8eUL-c/photo.jpg?sz=128", "display_name": "Alexander Yammine", "link": "https://stackoverflow.com/users/10198856/alexander-yammine"}, "edited": false, "score": 0, "creation_date": 1551053773, "post_id": 54857472, "comment_id": 96487179, "body": "Post the peer logs: <code>docker container logs peer0.org1.example.com:7051</code>"}, {"owner": {"reputation": 330, "user_id": 9363203, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T8bMl.jpg?s=128&g=1", "display_name": "Bibek Koirala", "link": "https://stackoverflow.com/users/9363203/bibek-koirala"}, "edited": false, "score": 0, "creation_date": 1551065231, "post_id": 54857472, "comment_id": 96489261, "body": "Can you please check the versions of pr-requisities?"}, {"owner": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551074133, "post_id": 54857472, "comment_id": 96491206, "body": "I have added working links to the logs."}, {"owner": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551075841, "post_id": 54857472, "comment_id": 96491725, "body": "I have also added specific versions"}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551078360, "post_id": 54860904, "comment_id": 96492669, "body": "Thanks for the suggestion, I have made backup of my samples folder and chmoded -R it to 777 for test purposes (horrible security risk, I know!). Nothing changed. As for memory, I have 20 GB free on the Linux partition I am running my dockers on (should be plenty right? I never found any memory requirements for running the Fabric and the total of all docker images amount to about 2.5 GB.)"}, {"owner": {"reputation": 23, "user_id": 11104705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a823baf85000055c47d29dbe97b889?s=128&d=identicon&r=PG&f=1", "display_name": "Aboubakar Ko&#239;ta", "link": "https://stackoverflow.com/users/11104705/aboubakar-ko%c3%afta"}, "reply_to_user": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551081348, "post_id": 54860904, "comment_id": 96493951, "body": "So no problem with the memory and the permissions, fine."}, {"owner": {"reputation": 23, "user_id": 11104705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a823baf85000055c47d29dbe97b889?s=128&d=identicon&r=PG&f=1", "display_name": "Aboubakar Ko&#239;ta", "link": "https://stackoverflow.com/users/11104705/aboubakar-ko%c3%afta"}, "reply_to_user": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551081885, "post_id": 54860904, "comment_id": 96494179, "body": "As you pointed out, the go version (go1.10.4) is strange, maybe you have another version installed? If so, perhaps it should be removed and reinstall Fabric again?"}, {"owner": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "edited": false, "score": 0, "creation_date": 1551088862, "post_id": 54860904, "comment_id": 96497780, "body": "I found out that I had the gopath set improperly. I since removed all other installations of go and reinstalled 1.11. I subsequently set the correct gopath and path variables. When running <code>go version</code> in the first-network folder I now get the right version! The problem persists however, I will update the question accordingly."}], "tags": [], "owner": {"reputation": 23, "user_id": 11104705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/93a823baf85000055c47d29dbe97b889?s=128&d=identicon&r=PG&f=1", "display_name": "Aboubakar Ko&#239;ta", "link": "https://stackoverflow.com/users/11104705/aboubakar-ko%c3%afta"}, "is_accepted": false, "score": 0, "last_activity_date": 1551077612, "creation_date": 1551077612, "answer_id": 54860904, "question_id": 54857472, "link": "https://stackoverflow.com/questions/54857472/unable-to-join-peers-to-channel-in-hyperledger-first-network-setup/54860904#54860904", "title": "Unable to join peers to channel in Hyperledger First Network setup", "body": "<p>I will suggest you to check two things: the memory available and the permissions in the \"first-network\" directory.</p>\n"}], "owner": {"reputation": 37, "user_id": 9217421, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d3e6017ea32a753bfaaf7dee566e14a?s=128&d=identicon&r=PG&f=1", "display_name": "Rens van der Veldt", "link": "https://stackoverflow.com/users/9217421/rens-van-der-veldt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 815, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1565004434, "creation_date": 1551049642, "last_edit_date": 1551129105, "question_id": 54857472, "link": "https://stackoverflow.com/questions/54857472/unable-to-join-peers-to-channel-in-hyperledger-first-network-setup", "title": "Unable to join peers to channel in Hyperledger First Network setup", "body": "<p>I am following a tutorial on <a href=\"https://hyperledger-fabric.readthedocs.io/en/latest/build_network.html\" rel=\"nofollow noreferrer\">the Hyperledger fabric site</a> and after installing all the perquisites (latest versions) on a Linux 18.04 installation I run into an error.</p>\n\n<p>I am trying to run the given ./byfn script to \"Build Your First Network\". After a fresh install I run the commands as follows:</p>\n\n<pre><code>./byfn generate\n./byfn up\n</code></pre>\n\n<p>At which point everything performs as expected untill the following error occurs 5 times in a row (after which the run exits with an Error):</p>\n\n<pre><code>+ peer channel join -b mychannel.block\n+ res=1\n+ set +x\nError: error getting endorser client for channel: endorser client failed to connect to peer0.org1.example.com:7051: failed to create new connection: context deadline exceeded\npeer0.org1 failed to join the channel, Retry after 3 seconds\n</code></pre>\n\n<p>I have tried various things like:</p>\n\n<ul>\n<li>Increasing the timeout to allow for longer connection times</li>\n<li>I have down-ed the network and upped it again</li>\n<li>Full re-installations of required packages and the fabric-samples</li>\n<li>Removed all docker volumes/images/containers</li>\n</ul>\n\n<p>I came across some sources mentioning that it might have to do with the peers not being able to connect to each other. Which I tried to fix with a manual docker connect of each peer to the byfn docker network, no success there. I can see the orderer running but the peers that attempted to join the network exited with an error:</p>\n\n<pre><code>docker container ls -a\nCONTAINER ID        IMAGE                               COMMAND             CREATED             STATUS                      PORTS                    NAMES\n99570e191542        hyperledger/fabric-tools:latest     \"/bin/bash\"         24 seconds ago      Up 23 seconds                                        cli\n340d1225a913        hyperledger/fabric-peer:latest      \"peer node start\"   30 seconds ago      Exited (2) 24 seconds ago                            peer0.org1.example.com\nfabe017751a0        hyperledger/fabric-peer:latest      \"peer node start\"   30 seconds ago      Exited (2) 25 seconds ago                            peer1.org2.example.com\nf81a639f29f6        hyperledger/fabric-peer:latest      \"peer node start\"   30 seconds ago      Exited (2) 26 seconds ago                            peer1.org1.example.com\n0f91080db681        hyperledger/fabric-peer:latest      \"peer node start\"   30 seconds ago      Exited (2) 27 seconds ago                            peer0.org2.example.com\nc491adc91320        hyperledger/fabric-orderer:latest   \"orderer\"           30 seconds ago      Up 28 seconds               0.0.0.0:7050-&gt;7050/tcp   orderer.example.com\n</code></pre>\n\n<p>This shows that the nodes exited with an error code, they all look the same, look below for a docker logs of the peer node.</p>\n\n<p>So my final question is: How do I get the \"First Network\" Hyperledger sample peers to successfully join the channel?</p>\n\n<p>Thanks in advance!</p>\n\n<p><strong>Update 1</strong></p>\n\n<p>I chose a bad code dump! Please use these links for logs/outputs.</p>\n\n<ul>\n<li><a href=\"http://snippi.com/s/y0xii7p\" rel=\"nofollow noreferrer\">Full ./byfn up output</a></li>\n<li><a href=\"http://snippi.com/s/fhmoz5h\" rel=\"nofollow noreferrer\">Docker log output for peer0</a></li>\n</ul>\n\n<p><strong>Update 2</strong></p>\n\n<p>So I have been trying various things, it seems to not be a go related error but simply a \"connection\" error where go crashes upon trying to connect a peer to the channel. So the main question at hand is: Why are my docker instances not properly connecting to the channel?</p>\n\n<p><strong>Update 3</strong></p>\n\n<p>I have used Amazon Web Services to launch a Linux instance and re-created all my installation steps on this \"fresh\" instance. Everything worked on the first go (pun intended). Therefore I must conclude that it had to do with either my network settings or personal setup as these are the only parameters that changed.</p>\n\n<p>As this works for me for now I will work with that. I am still open to suggestions and will keep an eye on this post!</p>\n\n<p><strong>Package versions</strong></p>\n\n<ul>\n<li><p>Hyperledger Fabric 1.4.0</p></li>\n<li><p>Docker version 18.09.2, build 6247962</p></li>\n<li><p>docker-compose version 1.13.0, build 1719ceb</p></li>\n<li><p>go version go1.11 linux/amd64</p></li>\n<li><p>npm: '6.4.1',</p></li>\n<li><p>node -v: v8.15.0 </p></li>\n</ul>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1551107106, "post_id": 54855758, "comment_id": 96508567, "body": "<i>Questions seeking debugging help (&quot;why isn&#39;t this code working?&quot;) must include the desired behavior, a specific problem or error and the shortest code necessary to reproduce <b>it in the question itself</b>.</i>"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1551039171, "last_edit_date": 1551039171, "creation_date": 1551038649, "answer_id": 54855992, "question_id": 54855758, "link": "https://stackoverflow.com/questions/54855758/how-to-make-golang-print-all-the-fields-in-json/54855992#54855992", "title": "How to make golang print all the fields in JSON?", "body": "<p>Put the fruit in a basket.</p>\n\n<p>The difference between the expected output and actual output is that the array is wrapped with an object in the expected output. Modify the corresponding Go types to match the structure of the expected output.</p>\n\n<pre><code>var data = struct{ Basket []Fruit }{Basket: fruits}\ndat, err := json.MarshalIndent(&amp;data, \"\", \"  \")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7g9HDZ38XxU\" rel=\"nofollow noreferrer\">https://play.golang.org/p/7g9HDZ38XxU</a></p>\n\n<p>Alternatively, change the existing <code>Basket</code> type to match the JSON and use that:</p>\n\n<pre><code>type Basket struct {\n    Basket []Fruit\n}\n\n...\n\ndat, err := json.MarshalIndent(&amp;Basket{Basket:fruit}, \"\", \"  \")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": false, "score": 1, "last_activity_date": 1551041249, "last_edit_date": 1551041249, "creation_date": 1551038965, "answer_id": 54856034, "question_id": 54855758, "link": "https://stackoverflow.com/questions/54855758/how-to-make-golang-print-all-the-fields-in-json/54856034#54856034", "title": "How to make golang print all the fields in JSON?", "body": "<p>In your printJSON function you were just printing out the slide of fruits the basket. Creating and printing a basket struct and adding a JSON tag to the field Basket achieves what you want:</p>\n\n<p><a href=\"https://play.golang.org/p/aJcbP97CDGt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/aJcbP97CDGt</a></p>\n\n<pre><code>type Basket struct {\n    Fruits []Fruit `json:\"Basket\"`\n}\n\n// Prints the output in JSON format.\nfunc printJSON() {\n    dat, err := json.MarshalIndent(Basket{fruits}, \"\", \"  \")\n\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Println(\"This is printJSON().\")\n    fmt.Println(string(dat))\n}\n</code></pre>\n"}], "owner": {"reputation": 332, "user_id": 3510093, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/94cd3c49ac0024a6727f7a3d63bb40a5?s=128&d=identicon&r=PG&f=1", "display_name": "sedawkgrep", "link": "https://stackoverflow.com/users/3510093/sedawkgrep"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 338, "favorite_count": 0, "accepted_answer_id": 54855992, "answer_count": 2, "score": -2, "last_activity_date": 1551041249, "creation_date": 1551037186, "question_id": 54855758, "link": "https://stackoverflow.com/questions/54855758/how-to-make-golang-print-all-the-fields-in-json", "title": "How to make golang print all the fields in JSON?", "body": "<p>I'm still learning Go (coming from Python) and I'm trying to automate a task in AWS. I have this requirement at work that I need to write the JSON output to a file but I'm struggling how to print all the fields in my struct. I'm missing the <code>Basket</code> field.</p>\n\n<p>I want it to be printed like this:</p>\n\n<pre><code>{\n  \"Basket\": [\n    {\n      \"Name\": \"Apple\",\n      \"Color\": \"Red\"\n    },\n    {\n      \"Name\": \"Banana\",\n      \"Color\": \"Yellow\"\n    }\n  ]\n}\n</code></pre>\n\n<p>But I'm only getting this:</p>\n\n<pre><code>[\n  {\n    \"Name\": \"Apple\",\n    \"Color\": \"Red\"\n  },\n  {\n    \"Name\": \"Banana\",\n    \"Color\": \"Yellow\"\n  }\n]\n</code></pre>\n\n<p>You can find my code here in <a href=\"https://play.golang.org/p/mMblVoOg_u8\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 7169905, "user_type": "registered", "profile_image": "https://graph.facebook.com/1881269332105064/picture?type=large", "display_name": "Sabri Boughanmi", "link": "https://stackoverflow.com/users/7169905/sabri-boughanmi"}, "edited": false, "score": 0, "creation_date": 1551049127, "post_id": 54854429, "comment_id": 96486292, "body": "hi ^^ yes it&#39;s a good idea but how can i know if a link is already been/being processed by the producer before putting it into the pool without using a map ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 45, "user_id": 7169905, "user_type": "registered", "profile_image": "https://graph.facebook.com/1881269332105064/picture?type=large", "display_name": "Sabri Boughanmi", "link": "https://stackoverflow.com/users/7169905/sabri-boughanmi"}, "edited": false, "score": 0, "creation_date": 1551049718, "post_id": 54854429, "comment_id": 96486410, "body": "@SabriBoughanmi You put all URLs once on the channel. If your input might contain the same URL multiple times, yes, the producer should build a map of them, but since the producer should be a single goroutine, you don&#39;t need any fancy solution or synchronization here."}, {"owner": {"reputation": 45, "user_id": 7169905, "user_type": "registered", "profile_image": "https://graph.facebook.com/1881269332105064/picture?type=large", "display_name": "Sabri Boughanmi", "link": "https://stackoverflow.com/users/7169905/sabri-boughanmi"}, "edited": false, "score": 0, "creation_date": 1551050677, "post_id": 54854429, "comment_id": 96486613, "body": "ah ok i got it ^_^ so only the producer will be able to start Downloading Goroutines to fix goroutine sync problem and can also manage a map to return results in case of duplicated URLs."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1551028483, "creation_date": 1551028483, "answer_id": 54854429, "question_id": 54854200, "link": "https://stackoverflow.com/questions/54854200/how-can-i-await-a-single-goroutine-response-on-multiple-other-goroutines/54854429#54854429", "title": "How can i Await a Single Goroutine Response on Multiple other Goroutines?", "body": "<p>What I would to to solve your task is I would use a goroutine pool for this. There would be a producer which sends URLs on a channel, and the worker goroutines would range over this channel to receive URLs to handle (fetch). Once a URL is \"done\", the same worker goroutine could also save it into database, or deliver the result on a result channel for a \"collector\" goroutine which could done the save sequentially should it be a requirement.</p>\n\n<p>This construction by design makes sure every URL sent on the channel is received by only one worker goroutine, so you do not need any other synchronization (which you would need in case of using a shared map). For more about channels, see <a href=\"https://stackoverflow.com/questions/39826692/what-are-golang-channels-used-for/39826883#39826883\">What are golang channels used for?</a></p>\n\n<p>Go favors communication between goroutines (channels) over shared variables. Quoting from <a href=\"https://golang.org/doc/effective_go.html#sharing\" rel=\"nofollow noreferrer\">Effective Go: Share by communicating</a>:</p>\n\n<blockquote>\n  <p>Do not communicate by sharing memory; instead, share memory by communicating.</p>\n</blockquote>\n\n<p>For an example how you can create worker pools, see <a href=\"https://stackoverflow.com/questions/38170852/is-this-an-idiomatic-worker-thread-pool-in-go/38172204#38172204\">Is this an idiomatic worker thread pool in Go?</a></p>\n"}], "owner": {"reputation": 45, "user_id": 7169905, "user_type": "registered", "profile_image": "https://graph.facebook.com/1881269332105064/picture?type=large", "display_name": "Sabri Boughanmi", "link": "https://stackoverflow.com/users/7169905/sabri-boughanmi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 87, "favorite_count": 0, "accepted_answer_id": 54854429, "answer_count": 1, "score": 0, "last_activity_date": 1551028483, "creation_date": 1551027040, "question_id": 54854200, "link": "https://stackoverflow.com/questions/54854200/how-can-i-await-a-single-goroutine-response-on-multiple-other-goroutines", "title": "How can i Await a Single Goroutine Response on Multiple other Goroutines?", "body": "<p>Hi guys im passing from Python3 to Go so im trying to rewrite a lib ive created to get a better performance.</p>\n\n<p>im facing a problem due to the fact that im noob in Golang XD, im using a limited API to download hundreds of jsons and i want to use as less as possible requests when i can. \nso while downloading those jsons some of the URLs used are duplicated and the first idea i got is passing a map[stringLink]*myJsonReceived between my downloading functions ( goroutines ) and each goroutine before downloading checks if the link is already being processed by another one, so instead of requesting it again and waste Bandwidth + API Calls it should just wait for the Other goroutine to finish downloading it and get it from the dictionary.</p>\n\n<p>I have few options :</p>\n\n<p>1) the goroutine have to check if the link is within the map if so,it checks every 0.05s if the Pointer within the dictionary is still nil or contains the json. ( probably the badest way but it works )</p>\n\n<p>2) change the map passed between goroutines to (map[stringlink]chan myjson) its probably the most efficient way but i have no idea how to send a single message to a channel and receive it by multiple awaiting Goroutines.</p>\n\n<p>3) i can use the Option (2) by adding a counter to the struct and each time a goroutine founds that the url is already requested, it just add +1 to the counter  and await the response from the channel,when the downloading goroutine completes it will send X messages to the channel. but this way will make me add too much LOCKs to the map which is a waste of performance.</p>\n\n<p>Note: i need the map at the end of all functions execution to save the downloaded Jsons into my database to never download them again.</p>\n\n<p>Thank you all in advance for your help.</p>\n"}, {"tags": ["go", "type-assertion"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1551025945, "post_id": 54853991, "comment_id": 96479544, "body": "<a href=\"https://play.golang.org/p/q4hlv8aQmGU\" rel=\"nofollow noreferrer\">play.golang.org/p/q4hlv8aQmGU</a> ?"}, {"owner": {"reputation": 1172, "user_id": 790879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d7a3157c1f5c5d19c58d092f9714bd2?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/790879/kevin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551026177, "post_id": 54853991, "comment_id": 96479616, "body": "without reflection it is not possible, isn&#39;t it?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551026247, "post_id": 54853991, "comment_id": 96479639, "body": "You could use type assertion instead of reflection if you know what kind of slice, however if any kind of slice, then no, not without reflection."}, {"owner": {"reputation": 1172, "user_id": 790879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d7a3157c1f5c5d19c58d092f9714bd2?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/790879/kevin"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1551026292, "post_id": 54853991, "comment_id": 96479653, "body": "ok, i don&#39;t know the concrete type. thx!"}], "answers": [{"tags": [], "owner": {"reputation": 1172, "user_id": 790879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d7a3157c1f5c5d19c58d092f9714bd2?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/790879/kevin"}, "is_accepted": true, "score": 1, "last_activity_date": 1551026763, "creation_date": 1551026763, "answer_id": 54854156, "question_id": 54853991, "link": "https://stackoverflow.com/questions/54853991/golang-type-assertion-for-pointer-to-slice/54854156#54854156", "title": "Golang type assertion for pointer to slice", "body": "<p>[The text of this answer was originally written by <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a>]</p>\n\n<pre><code>func loadData(collection interface{}) error {\n    rv := reflect.ValueOf(collection)\n    if rv.Kind() == reflect.Ptr &amp;&amp; rv.Elem().Kind() == reflect.Slice {\n        return nil  \n    }\n    return errors.New(\"Invalid collection type, need pointer to slice.\")\n}\n</code></pre>\n"}], "owner": {"reputation": 1172, "user_id": 790879, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d7a3157c1f5c5d19c58d092f9714bd2?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/790879/kevin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 54854156, "answer_count": 1, "score": 1, "last_activity_date": 1551026763, "creation_date": 1551025644, "question_id": 54853991, "link": "https://stackoverflow.com/questions/54853991/golang-type-assertion-for-pointer-to-slice", "title": "Golang type assertion for pointer to slice", "body": "<p>Is there a better way for that?</p>\n\n<pre><code>var collection []string\nanyFunc(&amp;collection) // valid\nanyFunc(collection) // invalid\nanyFunc(nil) // invalid\nanyFunc(\"test\") // invalid\n\nfunc anyFunc(collection interface{}) error {\n    rv := reflect.ValueOf(collection)\n    if rv.Kind() != reflect.Ptr || rv.IsNil() || reflect.Indirect(reflect.ValueOf(collection)).Kind() != reflect.Slice {\n        return errors.New(\"Invalid collection type, need pointer to slice.\")\n    }\n    return nil\n}\n</code></pre>\n\n<p>Full example at <a href=\"https://play.golang.org/p/WytOtXmf56N\" rel=\"nofollow noreferrer\">play.golang.org</a></p>\n"}, {"tags": ["go", "testing", "race-condition", "goroutine", "data-race"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551020691, "post_id": 54853014, "comment_id": 96478059, "body": "Can you explain what more you need to know? The errors show precisely where you have concurrent reads and writes for the first data race, and concurrent writes in the second. Please include the code in question as well."}, {"owner": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1551021993, "post_id": 54853014, "comment_id": 96478416, "body": "Just got thrown off by the trace. @mkopriva helped out with deciphering the trace. Will try it out and should be all set. I suppose you could say that I haven&#39;t ever dealt with a race before so I had some trouble understanding what it meant. But I understand now."}], "answers": [{"comments": [{"owner": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "edited": false, "score": 1, "creation_date": 1551021942, "post_id": 54853213, "comment_id": 96478394, "body": "Thanks that no helps. I guess I just got thrown off by the long trace that I didn&#39;t understand what to look for. I will add a RWMutex to the task struct and use it in the methods."}, {"owner": {"reputation": 58, "user_id": 6200999, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89248307b2d70b47ca3bf3cb4fe2e6e7?s=128&d=identicon&r=PG&f=1", "display_name": "Jarri Abidi", "link": "https://stackoverflow.com/users/6200999/jarri-abidi"}, "edited": false, "score": 1, "creation_date": 1600915579, "post_id": 54853213, "comment_id": 113241802, "body": "Go idiom: Don&#39;t communicate by sharing data. Share data by communicating.  (translation: use channels, not mutexes)"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1551021043, "last_edit_date": 1551021043, "creation_date": 1551020722, "answer_id": 54853213, "question_id": 54853014, "link": "https://stackoverflow.com/questions/54853014/cannot-understand-go-test-race-race-data-warning-stack-trace/54853213#54853213", "title": "Cannot understand go test -race : RACE: DATA WARNING stack trace", "body": "<p>As far as I can understand it:</p>\n\n<p><code>Read at 0x00c0000f8d68 by goroutine 8:</code> and <code>Previous write at 0x00c0000f8d68 by goroutine 7</code></p>\n\n<p>means that both goroutines <code>8</code> and <code>7</code> are reading from and writing to the same location. If you look at the lines pointed to by the error:</p>\n\n<p><code>goroutine 8</code> on <a href=\"https://github.com/nitishm/vegeta-server/blob/48e02d5a5c4432207144c66e9d116e2568af60eb/internal/dispatcher/task.go#L116\" rel=\"nofollow noreferrer\"><code>116</code></a>:</p>\n\n<pre><code>if t.status != models.AttackResponseStatusRunning {\n</code></pre>\n\n<p><code>goroutine 7</code> on <a href=\"https://github.com/nitishm/vegeta-server/blob/48e02d5a5c4432207144c66e9d116e2568af60eb/internal/dispatcher/task.go#L107\" rel=\"nofollow noreferrer\"><code>107</code></a>:</p>\n\n<pre><code>t.status = models.AttackResponseStatusRunning\n</code></pre>\n\n<p>You can see that the goroutines are accessing the <code>task</code>'s state without any synchronization and that, as you already know, can cause a race condition.</p>\n\n<p>So if your program allows access to a single task by multiple goroutines you need to ensure that no data race occurs by using a mutex lock for example.</p>\n"}], "owner": {"reputation": 751, "user_id": 3657373, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/baHlx.jpg?s=128&g=1", "display_name": "nitimalh", "link": "https://stackoverflow.com/users/3657373/nitimalh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1157, "favorite_count": 0, "accepted_answer_id": 54853213, "answer_count": 1, "score": 1, "last_activity_date": 1551023161, "creation_date": 1551019457, "last_edit_date": 1551023161, "question_id": 54853014, "link": "https://stackoverflow.com/questions/54853014/cannot-understand-go-test-race-race-data-warning-stack-trace", "title": "Cannot understand go test -race : RACE: DATA WARNING stack trace", "body": "<p>I ran into a DATA RACE warning while testing my project, and was wondering if anyone would be kind enough to help me decipher the problem. I have never attempted testing go routines in the past and am finding it hard to wrap my head around data races.</p>\n\n<p>I have provided a link in the description to the open issue, with the trace in the issue description.</p>\n\n<p>I would really appreciate some help, just from the aspect of learning to debug similar issues and writing better tests for go routines in the future.</p>\n\n<p><a href=\"https://github.com/nitishm/vegeta-server/issues/52\" rel=\"nofollow noreferrer\">https://github.com/nitishm/vegeta-server/issues/52</a></p>\n\n<p>A snippet of the trace is provided below as well</p>\n\n<pre><code>=== RUN   Test_dispatcher_Cancel_Error_completed\nINFO[0000] creating new dispatcher                       component=dispatcher\nINFO[0000] starting dispatcher                           component=dispatcher\nINFO[0000] dispatching new attack                        ID=d63a79ac-6f51-486e-845d-077c8c76168a Status=scheduled component=dispatcher\n==================\nWARNING: DATA RACE\nRead at 0x00c0000f8d68 by goroutine 8:\n  vegeta-server/internal/dispatcher.(*task).Complete()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:116 +0x61\n  vegeta-server/internal/dispatcher.run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:213 +0x17a\n\nPrevious write at 0x00c0000f8d68 by goroutine 7:\n  vegeta-server/internal/dispatcher.(*task).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:107 +0x12a\n  vegeta-server/internal/dispatcher.(*dispatcher).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher.go:109 +0xb5f\n\nGoroutine 8 (running) created at:\n  vegeta-server/internal/dispatcher.(*task).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:105 +0x11c\n  vegeta-server/internal/dispatcher.(*dispatcher).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher.go:109 +0xb5f\n\nGoroutine 7 (running) created at:\n  vegeta-server/internal/dispatcher.Test_dispatcher_Cancel_Error_completed()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher_test.go:249 +0x545\n  testing.tRunner()\n      /usr/local/go/src/testing/testing.go:827 +0x162\n==================\n==================\nWARNING: DATA RACE\nWrite at 0x00c0000f8d98 by goroutine 8:\n  vegeta-server/internal/dispatcher.(*task).SendUpdate()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:164 +0x70\n  vegeta-server/internal/dispatcher.(*task).Complete()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:128 +0x20e\n  vegeta-server/internal/dispatcher.run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:213 +0x17a\n\nPrevious write at 0x00c0000f8d98 by goroutine 7:\n  vegeta-server/internal/dispatcher.(*task).SendUpdate()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:164 +0x70\n  vegeta-server/internal/dispatcher.(*task).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:109 +0x15d\n  vegeta-server/internal/dispatcher.(*dispatcher).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher.go:109 +0xb5f\n\nGoroutine 8 (running) created at:\n  vegeta-server/internal/dispatcher.(*task).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/task.go:105 +0x11c\n  vegeta-server/internal/dispatcher.(*dispatcher).Run()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher.go:109 +0xb5f\n\nGoroutine 7 (running) created at:\n  vegeta-server/internal/dispatcher.Test_dispatcher_Cancel_Error_completed()\n      /Users/nitishm/vegeta-server/internal/dispatcher/dispatcher_test.go:249 +0x545\n  testing.tRunner()\n      /usr/local/go/src/testing/testing.go:827 +0x162\n==================\nINFO[0002] canceling attack                              ID=d63a79ac-6f51-486e-845d-077c8c76168a ToCancel=true component=dispatcher\nERRO[0002] failed to cancel task                         ID=d63a79ac-6f51-486e-845d-077c8c76168a ToCancel=true component=dispatcher error=\"cannot cancel task d63a79ac-6f51-486e-845d-077c8c76168a with status completed\"\nWARN[0002] gracefully shutting down the dispatcher       component=dispatcher\n--- FAIL: Test_dispatcher_Cancel_Error_completed (2.01s)\n    testing.go:771: race detected during execution of test\n</code></pre>\n"}, {"tags": ["performance", "amazon-web-services", "go", "aws-lambda"], "answers": [{"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1551054007, "creation_date": 1551054007, "answer_id": 54857938, "question_id": 54852752, "link": "https://stackoverflow.com/questions/54852752/fast-resend-response-in-golang-lambda/54857938#54857938", "title": "Fast Resend Response in golang lambda", "body": "<p>You can handle the response in many different way</p>\n\n<ul>\n<li><p>If lambda implements additional search response handling, it might be worth  defining the response data type contract with respective marshaling/unmarshaling and additional handling logic.</p></li>\n<li><p>If lambda functionality is to only proxy response from ES search, you may just passed search response payload ([]byte) directly to APIGatewayProxyResponse.Body as []byte and may need to base64 if the payload has binary data.</p></li>\n</ul>\n\n<p>Code:</p>\n\n<pre><code>func handleRequest(ctx context.Context, apiRequest events.APIGatewayProxyRequest) (events.APIGatewayProxyResponse, error) {\n    request, err := newSearchRequest(apiRequest)\n    if err != nil {\n        return handleError(err)\n    }\n    responseBody, err := proxySearch(ctx, request)\n    if err != nil {\n        return handleError(err)\n    }\n    return events.APIGatewayProxyResponse{\n        StatusCode: http.StatusOK,\n        Body:       string(responseBody),\n    }, nil\n}\n\nfunc proxySearch(ctx context.Context, searchRequest SearchRequest) ([]byte, error) {\n    // ... some data preparation and client initalisation\n    resp, err := ctxhttp.Post(ctx, &amp;client, url, \"application/json\", buffer)\n    if err != nil {\n        return nil, err\n    }\n    responseBody, err := ioutil.ReadAll(resp.Body)\n    return responseBody, err\n}\n</code></pre>\n"}], "owner": {"reputation": 844, "user_id": 3521098, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/c9b0243aa390cc2f9d25ed5e22e09669?s=128&d=identicon&r=PG", "display_name": "Solorad", "link": "https://stackoverflow.com/users/3521098/solorad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 115, "favorite_count": 0, "accepted_answer_id": 54857938, "answer_count": 1, "score": 0, "last_activity_date": 1551054007, "creation_date": 1551017651, "question_id": 54852752, "link": "https://stackoverflow.com/questions/54852752/fast-resend-response-in-golang-lambda", "title": "Fast Resend Response in golang lambda", "body": "<p>I have golang lambda that prepares ES request, send it to external system and returns its response. Currently, I haven't found a better approach than an unmarshalling response to <code>interface{}</code>.  </p>\n\n<pre><code>func HandleRequest(ctx context.Context, searchRequest SearchRequest) (interface{}, error) {\n    // ... some data preparation and client initalisation\n    resp, err := ctxhttp.Post(ctx, &amp;client, url, \"application/json\", buffer)\n    if err != nil {\n        return \"\", err\n    }\n    var k interface{}\n    all, err := ioutil.ReadAll(resp.Body)\n    err = json.Unmarshal(all, &amp;k)\n    return k, err\n}\n</code></pre>\n\n<p>I'm not sure it is the fastest and the most performant way to forward response due to that extra <code>ReadAll</code> and <code>Unmarshall</code>. Is there a more performant approach?\nI looked at <code>events.APIGatewayProxyResponse{}</code>, but <code>body</code> in it - string and same manipulations are needed</p>\n"}, {"tags": ["for-loop", "go", "types"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551015908, "post_id": 54852331, "comment_id": 96476759, "body": "Also: don&#39;t you want the loop to go from <code>0..63</code> both inclusive? That would require <code>i &lt; 64</code> loop condition."}, {"owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1551016171, "post_id": 54852331, "comment_id": 96476832, "body": "@icza Yeah, sure. Typo"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1551016472, "last_edit_date": 1551016472, "creation_date": 1551015495, "answer_id": 54852460, "question_id": 54852331, "link": "https://stackoverflow.com/questions/54852331/how-to-handle-type-of-an-iterator/54852460#54852460", "title": "How to handle type of an iterator?", "body": "<p>You may declare <code>getRank()</code> to take a value of type <code>uint8</code>, and also you may use a typed constant when declaring the loop variable, so <code>i</code> will be of type <code>uint8</code>:</p>\n\n<pre><code>func generateBoard() {\n    for i := uint8(0); i &lt; 64; i++ {\n        fmt.Println(getRank(i)) // Valid\n    }\n}\n\nfunc getRank(i uint8) uint8 {\n    return i / 8\n}\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/mmaOqf3XLOH\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<p>You could also use the shift operator instead of dividing by 8:</p>\n\n<pre><code>func getRank(i uint8) uint8 {\n    return i &gt;&gt; 3\n}\n</code></pre>\n\n<p>But this is a micro-optimization that is most likely recognized and used by the compiler too. So use whichever is more expressive in your context.</p>\n"}], "owner": {"reputation": 67, "user_id": 11083943, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/080678835a931aec2dacea9c22870579?s=128&d=identicon&r=PG&f=1", "display_name": "Sailor Moon", "link": "https://stackoverflow.com/users/11083943/sailor-moon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 54852460, "answer_count": 1, "score": 0, "last_activity_date": 1551087559, "creation_date": 1551014714, "last_edit_date": 1551087559, "question_id": 54852331, "link": "https://stackoverflow.com/questions/54852331/how-to-handle-type-of-an-iterator", "title": "How to handle type of an iterator?", "body": "<p>I have the following piece of code:</p>\n\n<pre><code>func generateBoard() {\n    for i := 0; i &lt; 64; i++ {\n\n    }\n}\n\nfunc getRank(i int) uint8 {\n    return i / 8\n}\n</code></pre>\n\n<p>In the loop I want to call <code>getRank(i)</code>. I want <code>getRank</code> return <code>uint8</code> cause it's the least integer type and I don't need more. The problem is that I can't divide <code>int</code> by <code>uint8</code>. I don't want to cast <code>i</code> to <code>uint8</code> cause it might be expensive(possibly even an allocation happens there). Also I don't want to declare <code>i</code> as <code>uint8</code> before the loop like:</p>\n\n<pre><code>var i uint8\nfor i = 0; i &lt; 64; i++ {\n</code></pre>\n\n<p>Cause I believe that on the low level initializing iterator in the loop is pretty optimized and  declaring an iterator before would be also not the best solution.<br>\nWhat would be the best implementation of this?</p>\n"}, {"tags": ["go", "stdin"], "comments": [{"owner": {"reputation": 10593, "user_id": 4621513, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/uCfJK.png?s=128&g=1", "display_name": "mkrieger1", "link": "https://stackoverflow.com/users/4621513/mkrieger1"}, "edited": false, "score": 0, "creation_date": 1550999987, "post_id": 54850390, "comment_id": 96472993, "body": "What exactly are you inputting? What does the error flag returned by <code>Atoi</code>, that you\u2019re discarding, say?"}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 9941700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--j-8_VYAcnk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq1ErqlPJs9IHecP1IUlFib3MeYdiw/mo/photo.jpg?sz=128", "display_name": "Mudit Jha", "link": "https://stackoverflow.com/users/9941700/mudit-jha"}, "edited": false, "score": 0, "creation_date": 1551001514, "post_id": 54850486, "comment_id": 96473381, "body": "Thanks for your help! Stupidly enough, I didnt at all consider the implication of putting a _ in the code. Also, is this the conventional way to take in input from stdin in Go i.e. using the NewReader function from the bufio package and then after reading the input, trim the\\n?"}, {"owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "edited": false, "score": 0, "creation_date": 1551001594, "post_id": 54850486, "comment_id": 96473401, "body": "I added an alternative which doesn&#39;t require to trim. :)"}], "tags": [], "owner": {"reputation": 10410, "user_id": 2450507, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/qNPPb.jpg?s=128&g=1", "display_name": "Nicholas", "link": "https://stackoverflow.com/users/2450507/nicholas"}, "is_accepted": true, "score": 4, "last_activity_date": 1551001532, "last_edit_date": 1551001532, "creation_date": 1551000233, "answer_id": 54850486, "question_id": 54850390, "link": "https://stackoverflow.com/questions/54850390/type-conversion-of-a-string-read-from-stdin-to-int-is-giving-me-a-0/54850486#54850486", "title": "Type conversion of a string read from stdin to int is giving me a 0", "body": "<p>If you change your code a little you'll see that <code>strconv.Atoi(input)</code> is returning an error. I hope you've now learned an important lesson about how Go does error handling.</p>\n\n<blockquote>\n  <p>Error is: strconv.Atoi: parsing \"1\\n\": invalid syntax</p>\n</blockquote>\n\n<pre><code>out, err := strconv.Atoi(input)\nif err != nil {\n    fmt.Printf(\"Error is: %v\\n\", err)\n}\n</code></pre>\n\n<p>One way to fix this is by trimming <code>input</code> using <a href=\"https://golang.org/pkg/strings/#TrimSuffix\" rel=\"nofollow noreferrer\">strings.TrimSuffix()</a>:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nfmt.Print(\"Enter a number\")\ninput, _ := reader.ReadString('\\n')\ninput = strings.TrimSuffix(input, \"\\n\")\nfmt.Printf(\"Type of the entered value is %T\\n\", input)\nfmt.Println(input)\nout, err := strconv.Atoi(input)\nif err != nil {\n    fmt.Printf(\"Error is: %v\\n\", err)\n}\nfmt.Printf(\"Type now is: %T\\n\", out)\nfmt.Printf(\"Value now is %d\\n\", out)\nfmt.Println(out)\n</code></pre>\n\n<p>You can also use the <a href=\"https://golang.org/pkg/bufio/#Scanner\" rel=\"nofollow noreferrer\">Scanner</a>, which doesn't require you to remove the <code>\\n</code>:</p>\n\n<pre><code>scanner := bufio.NewScanner(os.Stdin)\nfmt.Print(\"Enter a number\")\nscanner.Scan()\ninput := scanner.Text()\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9941700, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/--j-8_VYAcnk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq1ErqlPJs9IHecP1IUlFib3MeYdiw/mo/photo.jpg?sz=128", "display_name": "Mudit Jha", "link": "https://stackoverflow.com/users/9941700/mudit-jha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 340, "favorite_count": 0, "accepted_answer_id": 54850486, "answer_count": 1, "score": 0, "last_activity_date": 1551002755, "creation_date": 1550999441, "last_edit_date": 1551002755, "question_id": 54850390, "link": "https://stackoverflow.com/questions/54850390/type-conversion-of-a-string-read-from-stdin-to-int-is-giving-me-a-0", "title": "Type conversion of a string read from stdin to int is giving me a 0", "body": "<p>Code:</p>\n\n<pre><code>reader := bufio.NewReader(os.Stdin)\nfmt.Print(\"Enter a number\")\ninput,_ := reader.ReadString('\\n')\nfmt.Printf(\"Type of the entered value is %T\\n\",input)\nfmt.Println(input)\nout,_ := strconv.Atoi(input)\nfmt.Printf(\"Type now is: %T\\n\", out)\nfmt.Printf(\"Value now is %d\\n\",out)\nfmt.Println(out)\n</code></pre>\n\n<p>Complete beginner to Golang. I was trying to solve one of the problems from r/dailyprogrammer. I took the snippet to read the input from SO, as well as the strconv.Atoi function. The examples for this function make sense but when I apply it to the input I read from stdin, it gives me 0.</p>\n"}, {"tags": ["debugging", "go", "visual-studio-code", "windows-subsystem-for-linux"], "comments": [{"owner": {"reputation": 1, "user_id": 11093429, "user_type": "registered", "profile_image": "https://graph.facebook.com/648291515603683/picture?type=large", "display_name": "iGaisin", "link": "https://stackoverflow.com/users/11093429/igaisin"}, "edited": false, "score": 0, "creation_date": 1550999057, "post_id": 54850295, "comment_id": 96472801, "body": "GoLand JetBrains too not work debugging"}, {"owner": {"reputation": 1, "user_id": 11093429, "user_type": "registered", "profile_image": "https://graph.facebook.com/648291515603683/picture?type=large", "display_name": "iGaisin", "link": "https://stackoverflow.com/users/11093429/igaisin"}, "edited": false, "score": 0, "creation_date": 1551021323, "post_id": 54850295, "comment_id": 96478233, "body": "most likely problem in WSL"}, {"owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 0, "creation_date": 1551029491, "post_id": 54850295, "comment_id": 96480628, "body": "Are you waiting the necessary time? First time you run it it may take some minutes to have a response."}, {"owner": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 0, "creation_date": 1551166028, "post_id": 54850295, "comment_id": 96529850, "body": "Any feedback @iGaisin?"}, {"owner": {"reputation": 1, "user_id": 11093429, "user_type": "registered", "profile_image": "https://graph.facebook.com/648291515603683/picture?type=large", "display_name": "iGaisin", "link": "https://stackoverflow.com/users/11093429/igaisin"}, "reply_to_user": {"reputation": 527, "user_id": 335472, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/3eec49d54e643c464a5d9e42c8dd5c59?s=128&d=identicon&r=PG", "display_name": "Joao Henrique", "link": "https://stackoverflow.com/users/335472/joao-henrique"}, "edited": false, "score": 0, "creation_date": 1551283938, "post_id": 54850295, "comment_id": 96586525, "body": "@joao-henrique I waited a lot of time, about while the movie was going"}], "owner": {"reputation": 1, "user_id": 11093429, "user_type": "registered", "profile_image": "https://graph.facebook.com/648291515603683/picture?type=large", "display_name": "iGaisin", "link": "https://stackoverflow.com/users/11093429/igaisin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1551011961, "creation_date": 1550998630, "last_edit_date": 1551011961, "question_id": 54850295, "link": "https://stackoverflow.com/questions/54850295/how-to-debug-in-vscode", "title": "How to debug in VSCode", "body": "<p>I have a problem with the Golang debugger in Visual Studio Code.\nMy launch.json:</p>\n\n<pre><code>\"configurations\": [\n    {\n        \"name\": \"Launch\",\n        \"type\": \"go\",\n        \"request\": \"launch\",\n        \"mode\": \"debug\",\n        \"program\": \"${workspaceRoot}\",\n        \"port\": 2345,\n        \"host\": \"127.0.0.1\",\n        \"env\": {},\n        \"args\": []\n    }\n]\n</code></pre>\n\n<p>I put a breakpoint, I launch the debugger, it start up and write to the Debug Console:</p>\n\n<pre><code>API server listening at: 127.0.0.1:2345\n</code></pre>\n\n<p>and nothing else happens!</p>\n\n<p>Thanks in advance for your help!</p>\n"}, {"tags": ["go", "boxfuse"], "answers": [{"tags": [], "owner": {"reputation": 30791, "user_id": 350428, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/2d505d3fd867e284a384986533c2e5f8?s=128&d=identicon&r=PG", "display_name": "Axel Fontaine", "link": "https://stackoverflow.com/users/350428/axel-fontaine"}, "is_accepted": false, "score": 0, "last_activity_date": 1551038902, "creation_date": 1551038902, "answer_id": 54856021, "question_id": 54850161, "link": "https://stackoverflow.com/questions/54850161/how-to-include-config-files-in-a-boxfuse-image-golang-app/54856021#54856021", "title": "How to include config files in a boxfuse image (golang app)?", "body": "<p>If you need to package more than just the x64 binary, you can use Boxfuse's support for generic Linux x64 apps instead, where you can supply a tar.tg file: <a href=\"https://boxfuse.com/docs/payloads/linux-x64\" rel=\"nofollow noreferrer\">https://boxfuse.com/docs/payloads/linux-x64</a></p>\n"}], "owner": {"reputation": 43, "user_id": 1319286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b7fe125490a56872498dfb4b74b503e?s=128&d=identicon&r=PG", "display_name": "cosmiczilch", "link": "https://stackoverflow.com/users/1319286/cosmiczilch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 22, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1551038902, "creation_date": 1550997523, "question_id": 54850161, "link": "https://stackoverflow.com/questions/54850161/how-to-include-config-files-in-a-boxfuse-image-golang-app", "title": "How to include config files in a boxfuse image (golang app)?", "body": "<p>I am working on a golang server and i want to include some config files in the fused image. However, i am unable to find any documentation that can point me in the right direction.\nThanks!</p>\n"}, {"tags": ["go", "parameter-passing"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 2, "creation_date": 1550982777, "post_id": 54848463, "comment_id": 96469894, "body": "See <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#pass-values\" rel=\"nofollow noreferrer\">Pass Values</a> and <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#receiver-type\" rel=\"nofollow noreferrer\">Receiver Types</a> for recommendations."}], "answers": [{"comments": [{"owner": {"reputation": 3650, "user_id": 5387794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c76efa31a04b23c99d0b964a474491c?s=128&d=identicon&r=PG&f=1", "display_name": "kovac", "link": "https://stackoverflow.com/users/5387794/kovac"}, "edited": false, "score": 0, "creation_date": 1550984209, "post_id": 54848868, "comment_id": 96470112, "body": "So even in the 2 case, what is actually passed is the value of the pointer to the concreate type and no copying of the concrete type happens?"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "reply_to_user": {"reputation": 3650, "user_id": 5387794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c76efa31a04b23c99d0b964a474491c?s=128&d=identicon&r=PG&f=1", "display_name": "kovac", "link": "https://stackoverflow.com/users/5387794/kovac"}, "edited": false, "score": 0, "creation_date": 1550984564, "post_id": 54848868, "comment_id": 96470171, "body": "when passing a value there is always a copy involved, either copying a pointer or concrete value.  Since the interface is already a pointer to a concrete type, no concrete type copying happens"}], "tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1550985955, "last_edit_date": 1550985955, "creation_date": 1550984005, "answer_id": 54848868, "question_id": 54848463, "link": "https://stackoverflow.com/questions/54848463/passing-by-value-or-passing-by-reference-is-more-efficient-in-golang/54848868#54848868", "title": "Passing by value or passing by reference is more efficient in GoLang?", "body": "<p>When passing interface type as a parameter, pass it by value, \nnote that interface type itself would be a pointer to concrete type.</p>\n\n<p>When it comes to the performance side, using interface comes with the price too, \nit simply cannot be inlined.</p>\n\n<p>I guess it is fine to use interface with dozen calls per request/entry point, \nbut if an app has to make thousands+ invocations,  benchmark your code first before making a call.</p>\n"}], "owner": {"reputation": 3650, "user_id": 5387794, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7c76efa31a04b23c99d0b964a474491c?s=128&d=identicon&r=PG&f=1", "display_name": "kovac", "link": "https://stackoverflow.com/users/5387794/kovac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 501, "favorite_count": 1, "accepted_answer_id": 54848868, "answer_count": 1, "score": 1, "last_activity_date": 1550985955, "creation_date": 1550979118, "question_id": 54848463, "link": "https://stackoverflow.com/questions/54848463/passing-by-value-or-passing-by-reference-is-more-efficient-in-golang", "title": "Passing by value or passing by reference is more efficient in GoLang?", "body": "<p>Let's say I have a struct implementing an interface like below:</p>\n\n<pre><code>type IFace interface {\n   Method1()\n   Method2()\n   Method3()\n} \n\n\ntype Face struct {\n  Prop1 string\n  Prop2 int\n}\n\n\n// IFace implementation here...\n</code></pre>\n\n<p>Now if I have method that accepts <code>IFace</code> is it better to design it to accept a pointer to that interface of value?</p>\n\n<ol>\n<li>Accept pointer:</li>\n</ol>\n\n<pre><code>func DummyMethod(f *IFace) {\n   (*f).Method1()\n}\n</code></pre>\n\n<ol start=\"2\">\n<li>By value:</li>\n</ol>\n\n<pre><code>    func DummyMethod(f IFace){\n      f.Method1()\n    }\n</code></pre>\n\n<p>My first guess is since these are structs, probably it's better to pass by value? Or is there a rule of thumb considering the size and nature of the struct when to start passing a pointer?</p>\n\n<p>Also, when we are adding methods to a struct is it better to pass a pointer to the struct or it's value?</p>\n"}, {"tags": ["sql-server", "go", "postman", "go-gorm"], "comments": [{"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550972654, "post_id": 54847894, "comment_id": 96468399, "body": "Hi @derata - the reason you&#39;re not receiving an answer to this question, despite having asked it a number of times, is that its not clear from your question exactly what the issue is. If you are getting an SQL error then we need to see both the definition of the SQL SP <i>AND</i> the exact data you are passing to it. As best I can tell from the above you&#39;re receiving the correct data in your post, but then breaking it before sending it to SQL. Please clarify."}, {"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550972832, "post_id": 54847894, "comment_id": 96468429, "body": "And as per your last identical question I don&#39;t think its an SQL issue, I think its the way you are building the inputs to the SQL SP. Please correct me if I am wrong. There is no point tagging technologies if they are clearly not part of the issue."}, {"owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "reply_to_user": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550975851, "post_id": 54847894, "comment_id": 96468863, "body": "@DaleBurrell  converting data type datetimeoffset to datetime, I have try many way using time.format  and time.parse , but result still same , result is  &#39;0001-01-01 00:00:00&#39;, &#39;0001-01-01 00:00:00&#39; , thank you for your advice"}, {"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550976001, "post_id": 54847894, "comment_id": 96468891, "body": "In that case, please create the <i>smallest</i> code sample you can which reproduces the error - rather than having a large code block where most of it isn&#39;t necessary <a href=\"https://stackoverflow.com/help/mcve\">stackoverflow.com/help/mcve</a>"}, {"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550976153, "post_id": 54847894, "comment_id": 96468913, "body": "Are you totally sure you even have a datetimeoffset? The data you have shown as your input appears to be a regular datetime already? Do you actually need to convert it?"}, {"owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "reply_to_user": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550976540, "post_id": 54847894, "comment_id": 96468983, "body": "@DaleBurrell when I&#39;m not using convert still get same result , I comment variabel t , b , and I change t,b in db.raw with smsblats.WillBeSentDate, smsblats.SentDate , still get same result and error say mssql: Error converting data type datetimeoffset to datetime. you can check my wrong input in postman body for WillBeSentDate and SentDate in here : <a href=\"https://imgur.com/a/kjRSDPB\" rel=\"nofollow noreferrer\">imgur.com/a/kjRSDPB</a>"}, {"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1550977982, "post_id": 54847894, "comment_id": 96469209, "body": "Sorry I don&#39;t know anything about the technologies you are using. But try this <a href=\"https://stackoverflow.com/questions/25845172/parsing-date-string-in-golang\" title=\"parsing date string in golang\">stackoverflow.com/questions/25845172/&hellip;</a>"}, {"owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "reply_to_user": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1551005189, "post_id": 54847894, "comment_id": 96474193, "body": "@DaleBurrell hey check my store procedure, maybe I wrong create store procedure"}, {"owner": {"reputation": 15914, "user_id": 1127428, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pSzU4.jpg?s=128&g=1", "display_name": "Dale K", "link": "https://stackoverflow.com/users/1127428/dale-k"}, "edited": false, "score": 0, "creation_date": 1551034765, "post_id": 54847894, "comment_id": 96482298, "body": "Parameters say <code>datetime</code> as your error said. You might need to contact <code>go-gorm</code> directly for assistance."}], "owner": {"reputation": 43, "user_id": 11054195, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-L48F98yK5bk/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNUhcNEG3FiT1USUQGZLL3FhhC6RQ/mo/photo.jpg?sz=128", "display_name": "dera ta", "link": "https://stackoverflow.com/users/11054195/dera-ta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 222, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559505408, "creation_date": 1550971478, "last_edit_date": 1559505408, "question_id": 54847894, "link": "https://stackoverflow.com/questions/54847894/converter-datetimeoffset-to-datetime-in-golang", "title": "Converter datetimeoffset to datetime in golang?", "body": "<p>I have problem with converting a <code>datetimeoffset</code> to <code>datetime</code>. I have tried to insert into my database using postman with method post in body. But the result is <code>EXEC SMSBlast2Procedure '9', '087871723282', 'adsbjkadhdhad', '0001-01-01 00:00:00', '0001-01-01 00:00:00' , 'asjdasjgdjasgdjsad', '2019-02-24 08:17:54'</code> , where in postman I am inputting like picture below :</p>\n\n<p><a href=\"https://i.stack.imgur.com/EVsM7.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n\n<p>respon json like picture below :</p>\n\n<p><a href=\"https://i.stack.imgur.com/LNH5R.png\" rel=\"nofollow noreferrer\">enter image description here</a></p>\n\n<p>but when I check in console result WillBeSentDate is 0001-01-01 00:00:00 and 0001-01-01 00:00:00, why ?</p>\n\n<p>Here my code to datetimeoffset to datetime.</p>\n\n<pre><code>    json.NewDecoder(r.Body).Decode(&amp;smsblats)\n\n    var count int64 = 0\n    db.Debug().Table(\"SMSBlast2\").Count(&amp;count)\n    count++\n    fmt.Println(count)\n\n   formatWill, _ := time.Parse(time.RFC3339, smsblats.WillBeSentDate.String())\n   formatSent, _ := time.Parse(time.RFC3339, smsblats.SentDate.String())\n\n\n    db.Debug().Raw(\"EXEC SMSBlast2Procedure ?, ?, ?, ?, ? , ?, ?\",\n        count,\n        smsblats.MobilePhone,\n        smsblats.Output,\n        formatWill,\n        formatSent,\n        smsblats.Status,\n        time.Now()).Scan(smsblats)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    w.Header().Set(\"Response-Code\", \"00\")\n    w.Header().Set(\"Response-Desc\", \"Success\")\n    json.NewEncoder(w).Encode(smsblats)\n</code></pre>\n\n<p>What wrong with my code? The error says </p>\n\n<blockquote>\n  <p>Error converting data type datetimeoffset to datetime </p>\n</blockquote>\n\n<p>I'm using SQL Server for database, a stored procedure like this:</p>\n\n<pre><code>SET ANSI_NULLS ON\nGO\nSET QUOTED_IDENTIFIER ON\nGO\n\nALTER PROCEDURE [dbo].[SMSBlast2Procedure]\n    (@sequenceid INT,\n     @mobilephone VARCHAR(20),\n     @output VARCHAR(20),\n     @willbesentdate DATETIME,\n     @sentdate DATETIME, \n     @status VARCHAR(60),\n     @dtmupd DATETIME)\nAS\n    INSERT INTO SMSBlast2 (SequenceID, MobilePhone, Output, WillBeSentDate, SentDate, Status, DtmUpd) \n    VALUES (@sequenceid, @mobilephone, @output, @willbesentdate, @sentdate, @status, @dtmupd)\n</code></pre>\n"}, {"tags": ["docker", "go", "nginx"], "comments": [{"owner": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "edited": false, "score": 0, "creation_date": 1550970895, "post_id": 54847680, "comment_id": 96468139, "body": "can you reach chat:900 via curl on the nginx container/vm ?"}, {"owner": {"reputation": 229, "user_id": 6823641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-1Zth726Csog/AAAAAAAAAAI/AAAAAAAACJI/nQOgWCOvz5M/photo.jpg?sz=128", "display_name": "Conor Burke", "link": "https://stackoverflow.com/users/6823641/conor-burke"}, "reply_to_user": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "edited": false, "score": 0, "creation_date": 1550973413, "post_id": 54847680, "comment_id": 96468508, "body": "@gipsy I get same thing I get when I hit it in browser: 404 page not found"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1550974572, "post_id": 54847680, "comment_id": 96468687, "body": "Show your server code."}, {"owner": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "edited": false, "score": 1, "creation_date": 1550976110, "post_id": 54847680, "comment_id": 96468904, "body": "@ConorBurke So that seems to be the problem , debug that first. Try a simple server first and make it work."}, {"owner": {"reputation": 229, "user_id": 6823641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-1Zth726Csog/AAAAAAAAAAI/AAAAAAAACJI/nQOgWCOvz5M/photo.jpg?sz=128", "display_name": "Conor Burke", "link": "https://stackoverflow.com/users/6823641/conor-burke"}, "reply_to_user": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "edited": false, "score": 0, "creation_date": 1550977782, "post_id": 54847680, "comment_id": 96469174, "body": "Server code was messed up, incorrect function call.  Thanks for your help @gipsy"}], "owner": {"reputation": 229, "user_id": 6823641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh5.googleusercontent.com/-1Zth726Csog/AAAAAAAAAAI/AAAAAAAACJI/nQOgWCOvz5M/photo.jpg?sz=128", "display_name": "Conor Burke", "link": "https://stackoverflow.com/users/6823641/conor-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 78, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550969234, "creation_date": 1550968927, "last_edit_date": 1550969234, "question_id": 54847680, "link": "https://stackoverflow.com/questions/54847680/nginx-upstream-not-serving-up-go-server", "title": "Nginx Upstream Not Serving Up Go Server", "body": "<p>I am trying to hit a Go chat server through an Nginx proxy, but the Nginx upstream does not seem to be working.  It does serve up my client just fine (a React app) but I can not seem to hit the Go server (chat). I am new to using Nginx, do you see a missing config or something?  The upstreams are all separate Docker containers.</p>\n\n<pre><code>upstream client {\n  server client:3000;\n}\n\nupstream api {\n  server api:7777;\n}\n\nupstream chat {\n  server chat:9000;\n}\n\nserver {\n  listen 80;\n\n  location /chat {\n    proxy_pass http://chat;\n  }\n\n  location / {\n    proxy_pass http://client;\n  }\n\n  location /sockjs-node {\n    proxy_pass http://client;\n    proxy_http_version 1.1;\n    proxy_set_header Upgrade $http_upgrade;\n    proxy_set_header Connection \"Upgrade\";\n  }\n\n  location /oracle {\n    proxy_pass http://api;\n  }\n\n  location /api/payment {\n    proxy_pass http://api;\n  }\n\n  location /signin {\n    proxy_pass http://api;\n  }\n\n  location /register {\n    proxy_pass http://api;\n  }\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose"], "answers": [{"comments": [{"owner": {"reputation": 1610, "user_id": 6482759, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/093bf0a6f8df3309217c5c6824065435?s=128&d=identicon&r=PG&f=1", "display_name": "bellackn", "link": "https://stackoverflow.com/users/6482759/bellackn"}, "edited": false, "score": 0, "creation_date": 1565957457, "post_id": 54847404, "comment_id": 101515229, "body": "I guess you can mark this question as solved then. :)"}], "tags": [], "owner": {"reputation": 9259, "user_id": 1815412, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/13eb7cacf20e7789e9ebd5e814c42cb5?s=128&d=identicon&r=PG", "display_name": "Maximus S", "link": "https://stackoverflow.com/users/1815412/maximus-s"}, "is_accepted": false, "score": 2, "last_activity_date": 1550965809, "creation_date": 1550965809, "answer_id": 54847404, "question_id": 54847107, "link": "https://stackoverflow.com/questions/54847107/docker-compose-up-doesnt-build/54847404#54847404", "title": "docker-compose up doesn&#39;t build", "body": "<p>The key was to use <code>--build</code> option in <code>docker-compose up</code>.\nI expected <code>docker-compose up</code> to rebuild every time, but it just starts the container once it has been built and created from before.</p>\n"}], "owner": {"reputation": 9259, "user_id": 1815412, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/13eb7cacf20e7789e9ebd5e814c42cb5?s=128&d=identicon&r=PG", "display_name": "Maximus S", "link": "https://stackoverflow.com/users/1815412/maximus-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 731, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1550965809, "creation_date": 1550962821, "question_id": 54847107, "link": "https://stackoverflow.com/questions/54847107/docker-compose-up-doesnt-build", "title": "docker-compose up doesn&#39;t build", "body": "<p>I am trying to build and run a golang app with docker-compose.\nHere are my settings:</p>\n\n<pre><code>./docker/Dockerfile\n./main.go\nMakefile\n</code></pre>\n\n<p>Makefile</p>\n\n<pre><code>compose:\n        env GOOS=linux GOARCH=amd64 GOARM=7 go build\n        cd docker &amp;&amp; docker-compose up\n</code></pre>\n\n<p>./docker/Dockerfile</p>\n\n<pre><code>FROM golang:1.11\n\nCOPY app .\nCMD [\"./app\"]\n</code></pre>\n\n<p>./docker/docker-compose.yml</p>\n\n<pre><code>version: '3'\nservices:\n    app:\n        build:\n            context: ../\n            dockerfile: ./docker/Dockerfile\n        env_file: ./app.env\n        ports:\n            - '9292:8000'\n</code></pre>\n\n<p>I run the following command, expecting to build a new binary and run it inside a Docker container.</p>\n\n<pre><code>$make compose\n</code></pre>\n\n<p>It runs great, but if I run the same command after updating <code>main.go</code> the new binary isn't copied to docker container. The docker container seems to use the previous binary (i.e. the first binary that was copied when the container was first constructed).</p>\n\n<p>Can someone explain why this is happening and what should I do to fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1550957047, "post_id": 54845866, "comment_id": 96465491, "body": "No, it is not safe. The two snippets evaluate to different values for the input  -1.1."}, {"owner": {"reputation": 24913, "user_id": 1300910, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/se92W.jpg?s=128&g=1", "display_name": "huysentruitw", "link": "https://stackoverflow.com/users/1300910/huysentruitw"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1550958891, "post_id": 54845866, "comment_id": 96465899, "body": "You&#39;re right, didn&#39;t think about that, however in the code I&#39;m porting, the <code>frac</code> value is always positive, so it&#39;s probably safe to use the C# <code>Math.Round</code> equivalent."}], "owner": {"reputation": 24913, "user_id": 1300910, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/se92W.jpg?s=128&g=1", "display_name": "huysentruitw", "link": "https://stackoverflow.com/users/1300910/huysentruitw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1550953555, "creation_date": 1550953555, "question_id": 54845866, "link": "https://stackoverflow.com/questions/54845866/is-it-safe-to-use-math-round-instead-of-this-modf-ceil-floor-combo", "title": "Is it safe to use math.Round instead of this Modf/Ceil/Floor combo", "body": "<p>I'm in the progress of converting <a href=\"https://github.com/boombuler/barcode/blob/master/qr/versioninfo.go#L278\" rel=\"nofollow noreferrer\">some Go code</a> to C# and am wondering if the following piece of code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, x := math.Modf(frac)\nif x &gt;= 0.5 {\n    frac = math.Ceil(frac)\n} else {\n    frac = math.Floor(frac)\n}\n</code></pre>\n\n<p>would be any different to this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>frac = math.Round(frac)\n</code></pre>\n\n<p>I know rounding can sometimes be tricky so I wonder if the first snippit acts as a workaround for something.</p>\n"}, {"tags": ["go", "viper"], "answers": [{"tags": [], "owner": {"reputation": 80, "user_id": 5058103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91c1845a30ad7ed9264cbb244a9f51a5?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandr Charkov", "link": "https://stackoverflow.com/users/5058103/aleksandr-charkov"}, "is_accepted": false, "score": 0, "last_activity_date": 1550945735, "creation_date": 1550945735, "answer_id": 54844614, "question_id": 54844546, "link": "https://stackoverflow.com/questions/54844546/how-to-unmarshal-golang-viper-snake-case-values/54844614#54844614", "title": "How to unmarshal Golang Viper snake_case values", "body": "<p>Solved with this</p>\n\n<pre><code>CryptoId string `mapstructure:\"crypto_id\"`\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/questions/38955605/reading-a-slice-of-maps-with-golang-viper\">Reading a slice of maps with Golang Viper</a></p>\n"}], "owner": {"reputation": 80, "user_id": 5058103, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91c1845a30ad7ed9264cbb244a9f51a5?s=128&d=identicon&r=PG&f=1", "display_name": "Aleksandr Charkov", "link": "https://stackoverflow.com/users/5058103/aleksandr-charkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 347, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1550945735, "creation_date": 1550945350, "question_id": 54844546, "link": "https://stackoverflow.com/questions/54844546/how-to-unmarshal-golang-viper-snake-case-values", "title": "How to unmarshal Golang Viper snake_case values", "body": "<p>How to viper.unmarshal(&amp;c) with Golang and Viper library a snake_case fields: </p>\n\n<pre><code>CryptoId string `json:\"crypto_id\"`\n</code></pre>\n\n<p>Currently I'm getting \"\" empty value.</p>\n"}, {"tags": ["go", "vips"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1550945755, "post_id": 54844282, "comment_id": 96462386, "body": "Are you sure it&#39;s the Go program that uses the memory? Does that usage include filesystem caches, for instance? Do you know how that&#39;s measured? What does top show?"}, {"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1550948058, "post_id": 54844282, "comment_id": 96463012, "body": "Yes I&#39;m measuring it with Top as well, as we speak the process is still using 38.2% according to top. It&#39;s the same case when I monitor it with docker stats and running it inside a container. I&#39;ve added at screenshot of top in my repo."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1550948491, "post_id": 54844282, "comment_id": 96463145, "body": "Related, does this explain it? <a href=\"https://stackoverflow.com/questions/37382600/cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Cannot free memory once occupied by bytes.Buffer</a>"}, {"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1550949131, "post_id": 54844282, "comment_id": 96463321, "body": "I&#39;ve read that post before, and decided to change bimg to a pure a go image resizing library (which is ways more memory demanding than libvips). And as the post explained, the memory was released back to the os eventually, and I could also force it with debug.FreeOSMemory().   This is not the case with bimg, so that&#39;s why I&#39;m asking if this is general cgo behaviour."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1550950328, "post_id": 54844282, "comment_id": 96463739, "body": "CGO behavior is the same as C. Have you tried freeing the cache that vips uses?"}, {"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1550959622, "post_id": 54844282, "comment_id": 96466075, "body": "There are three functions the library offers, bimg.VipsCacheSetMaz, bimg.VipsCacheSetMaxMem and bimg.VipsCacheDropAll. I&#39;ve used them all, and also there is a handy function for displaying memory info stats from libvips. It displays: {Memory:0 MemoryHighwater:6407072309 Allocations:0}."}, {"owner": {"reputation": 106, "user_id": 4937534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-r0mFsUDSE1Y/AAAAAAAAAAI/AAAAAAAAAAA/VjKye4cKOiY/photo.jpg?sz=128", "display_name": "Fu Jiantao", "link": "https://stackoverflow.com/users/4937534/fu-jiantao"}, "edited": false, "score": 0, "creation_date": 1560231909, "post_id": 54844282, "comment_id": 99656439, "body": "@hamochi, do you solve the problem, we are having a similiar problem, I&#39;m not sure whether it&#39;s caused by vips, pprof shows the memory usage is ok, but the system report the memory is increasing."}], "answers": [{"comments": [{"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1551033301, "post_id": 54851974, "comment_id": 96481819, "body": "Thank you very much for this explanation. I will run my process for a few hours and see how it goes. I&#39;d wished it freed back the memory to the OS, because that would help me scale upp my service easier, but I there are other ways to work around that. Libvips is still so ridiculously fast and memory efficient compared to other libraries and I will stick to it for sure."}, {"owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1551196778, "post_id": 54851974, "comment_id": 96548083, "body": "I ran my process longer, for 17 hours. First time the memory increased until it crashed. The second time it was more stable, it increase to 78% and was around there until it stopped resizing (17 hours later) and dropped to around 65%. It seems stable enough, I just have to make sure it restarts in case it crashes again."}, {"owner": {"reputation": 7702, "user_id": 894763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d013c9681666f0a68a6c1c00ff4d603?s=128&d=identicon&r=PG", "display_name": "jcupitt", "link": "https://stackoverflow.com/users/894763/jcupitt"}, "reply_to_user": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "edited": false, "score": 0, "creation_date": 1551279487, "post_id": 54851974, "comment_id": 96583566, "body": "I added a py program to show libvips memuse. I see a steady 40mb or so here."}], "tags": [], "owner": {"reputation": 7702, "user_id": 894763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d013c9681666f0a68a6c1c00ff4d603?s=128&d=identicon&r=PG", "display_name": "jcupitt", "link": "https://stackoverflow.com/users/894763/jcupitt"}, "is_accepted": false, "score": 1, "last_activity_date": 1551279447, "last_edit_date": 1551279447, "creation_date": 1551012111, "answer_id": 54851974, "question_id": 54844282, "link": "https://stackoverflow.com/questions/54844282/memory-not-being-released-back-to-os/54851974#54851974", "title": "Memory not being released back to OS", "body": "<p>There's a libvips thing to track and debug reference counts -- you could try enabling that and see if you have any leaks.</p>\n\n<p><a href=\"https://libvips.github.io/libvips/API/current/libvips-vips.html#vips-leak-set\" rel=\"nofollow noreferrer\">https://libvips.github.io/libvips/API/current/libvips-vips.html#vips-leak-set</a></p>\n\n<p>Though from your comment above about bimg memory stats, it sounds like it's probably all OK.</p>\n\n<p>It's easy to test libvips memory from Python. I made this small  program:</p>\n\n<pre><code>#!/usr/bin/python3\n\nimport pyvips\nimport sys\n\n# disable libvips operation caching ... without this, it'll cache all the\n# thumbnail operations and we'll just be testing the jpg write\npyvips.cache_set_max(0)\n\nfor i in range(0, 10000):\n    print(\"loop {} ...\".format(i))\n    for filename in sys.argv[1:]:\n        # thumbnail to fit 128x128 box\n        image = pyvips.Image.thumbnail(filename, 128)\n        thumb = image.write_to_buffer(\".jpg\")\n</code></pre>\n\n<p>ie. repeatedly thumbnail a set of source images. I ran it like this:</p>\n\n<pre><code>$ for i in {1..100}; do cp ~/pics/k2.jpg $i.jpg; done\n$ ../fing.py *\n</code></pre>\n\n<p>And watched RES in top. I saw:</p>\n\n<pre><code>loop | RES (kb)\n  -- | --\n 100 | 39220\n 250 | 39324\n 300 | 39276\n 400 | 39316\n 500 | 39396\n 600 | 39464\n 700 | 39404\n1000 | 39420\n</code></pre>\n\n<p>As long as you have no refcount leaks, I think what you are seeing is expected behaviour. Linux processes can only release pages at the end of the heap back to the OS (have a look at the brk and sbrk sys calls):</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Sbrk\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Sbrk</a></p>\n\n<p>Now imagine if 1) libvips allocates 6GB, 2) the Go runtime allocates 100kb, 3) libvips releases 6GB. Your libc (the thing in your process that will call sbrk and brk on your behalf) can't hand the 6GB back to the OS because of the 100kb alloc at the end of the heap. Some malloc implementations have better memory fragmentation behaviour than others, but the default linux one is pretty good.</p>\n\n<p>In practice, it doesn't matter. malloc will reuse holes in your memory space, and even if it doesn't, they will get paged out anyway under memory pressure and won't end up eating RAM. Try running your process for a few hours, and watch RES. You should see it creep up, but then stabilize.</p>\n\n<p>(I'm not at all a kernel person, the above is just my understanding, corrections very welcome of course)</p>\n"}, {"tags": [], "owner": {"reputation": 106, "user_id": 4937534, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-r0mFsUDSE1Y/AAAAAAAAAAI/AAAAAAAAAAA/VjKye4cKOiY/photo.jpg?sz=128", "display_name": "Fu Jiantao", "link": "https://stackoverflow.com/users/4937534/fu-jiantao"}, "is_accepted": false, "score": 0, "last_activity_date": 1560319639, "creation_date": 1560319639, "answer_id": 56555623, "question_id": 54844282, "link": "https://stackoverflow.com/questions/54844282/memory-not-being-released-back-to-os/56555623#56555623", "title": "Memory not being released back to OS", "body": "<p>The problem is in the resize code:</p>\n\n<pre><code>_, err = bimg.NewImage(buffer).Resize(width, height)\n</code></pre>\n\n<p>The image is gobject and need unref explicitly to release the memory, try:</p>\n\n<pre><code>image, err = bimg.NewImage(buffer).Resize(width, height)\ndefer C.g_object_unref(C.gpointer(image))\n</code></pre>\n"}], "owner": {"reputation": 37, "user_id": 9266147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/af99f68b3f97f9c4fbee353aeb5b8139?s=128&d=identicon&r=PG&f=1", "display_name": "hamochi", "link": "https://stackoverflow.com/users/9266147/hamochi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 440, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1560319639, "creation_date": 1550943692, "question_id": 54844282, "link": "https://stackoverflow.com/questions/54844282/memory-not-being-released-back-to-os", "title": "Memory not being released back to OS", "body": "<p>I've created an image resizing server that creates a few different thumbnails of and image that you upload to it. I'm using the package <a href=\"https://github.com/h2non/bimg\" rel=\"nofollow noreferrer\">https://github.com/h2non/bimg</a> for resizing, which is using libvips with c-bindings.</p>\n\n<p>Before going to production I've started to stress test my app with jmeter and upload 100 images to it concurrently for a few times after each other and noticed that the memory is not being released back to the OS.</p>\n\n<p>To illustrate the problem I've written a few lines of code that reads 100 images and resize them (without saving them anywhere) and then waits for 10 minutes. It repeats like this for 5 times</p>\n\n<p>My code and memory/CPU graph can be found here:\n<a href=\"https://github.com/hamochi/bimg-memory-issue\" rel=\"nofollow noreferrer\">https://github.com/hamochi/bimg-memory-issue</a></p>\n\n<p>It's clear that the memory is being reused for ever cycle, otherwise it should have doubled (I think). But it's never released back to the OS.</p>\n\n<p>Is this a general behaviour for cgo? Or bimg that is doing something weird. Or is it just my code that is faulty?</p>\n\n<p>Thank you very much for any help you can give!</p>\n"}, {"tags": ["html", "go", "import"], "answers": [{"comments": [{"owner": {"reputation": 694, "user_id": 5132860, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/QGgxk.png?s=128&g=1", "display_name": "Nori", "link": "https://stackoverflow.com/users/5132860/nori"}, "edited": false, "score": 0, "creation_date": 1551000061, "post_id": 54845409, "comment_id": 96473021, "body": "Thnaks! It&#39;s works by <code>net_html &quot;golang.org&#47;x&#47;net&#47;html&quot;</code>. When I do it I had another error , so I didn&#39;t realize import problem was solved!"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1550950450, "creation_date": 1550950450, "answer_id": 54845409, "question_id": 54844158, "link": "https://stackoverflow.com/questions/54844158/import-error-golang-org-x-net-html-with-html/54845409#54845409", "title": "import error : golang.org/x/net/html with html", "body": "<p>Using <code>_ \"golang.org/x/net/html\"</code> you import the package but you cut-off all access to it, this is used only when you need the imported package to perform some initialization and nothing else.</p>\n\n<p>Using <code>net_html \"golang.org/x/net/html\"</code> is ok and is exactly what you should do in this case. If you're still getting the <em>\"html redeclared as imported package ...\"</em> error then there might be an issue with the IDE you are using, but generally the Go compiler will not complain and your code should run without problems.</p>\n\n<p>To see for yourself that it works in a normal environment go to the following link and try running the program and you'll see that it compiles and executes.\n<a href=\"https://play.golang.com/p/jRdWucKjQ_0\" rel=\"nofollow noreferrer\">https://play.golang.com/p/jRdWucKjQ_0</a></p>\n\n<p>And here's a version with the same kind of error as the one that you're getting. <a href=\"https://play.golang.com/p/H5AFpXKJOBy\" rel=\"nofollow noreferrer\">https://play.golang.com/p/H5AFpXKJOBy</a></p>\n\n<hr>\n\n<p>So if <code>net_html \"golang.org/x/net/html\"</code> doesn't fix the <em>\"html redeclared as imported package ...\"</em> error, then try providing more info about your environment, like what IDE you're using, what version of Go you've installed, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 3946844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a009e3977ce79045ae3ef45343d3944a?s=128&d=identicon&r=PG", "display_name": "Radhi Fadlillah", "link": "https://stackoverflow.com/users/3946844/radhi-fadlillah"}, "is_accepted": false, "score": 1, "last_activity_date": 1550969600, "creation_date": 1550969600, "answer_id": 54847752, "question_id": 54844158, "link": "https://stackoverflow.com/questions/54844158/import-error-golang-org-x-net-html-with-html/54847752#54847752", "title": "import error : golang.org/x/net/html with html", "body": "<p>When you use multiple package with same name, as you've experienced, Go will complain that the imported package name has been declared before.</p>\n\n<p>To avoid this issue, you have to import the package with custom <code>PackageName</code> like this :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"html\"\n    xhtml \"golang.org/x/net/html\"\n)\n</code></pre>\n\n<p>Then you can use public methods and structs from <code>golang.org/x/net/html</code> by accessing it via <code>xhtml</code> like this :</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"html\"\n\n    xhtml \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    // this will use `html` package\n    htmlEscape := html.EscapeString(\"&lt; &amp;\")\n\n    // and this will use `golang.org/x/net/html` package\n    xHtmlEscape := xhtml.EscapeString(\"&lt; &amp;\")\n}\n\n</code></pre>\n\n<p>For more detail, you might want to check the Go <a href=\"https://golang.org/ref/spec#Import_declarations\" rel=\"nofollow noreferrer\">spec</a>.</p>\n"}], "owner": {"reputation": 694, "user_id": 5132860, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/QGgxk.png?s=128&g=1", "display_name": "Nori", "link": "https://stackoverflow.com/users/5132860/nori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 709, "favorite_count": 0, "accepted_answer_id": 54845409, "answer_count": 2, "score": 0, "last_activity_date": 1550969600, "creation_date": 1550942987, "last_edit_date": 1550943062, "question_id": 54844158, "link": "https://stackoverflow.com/questions/54844158/import-error-golang-org-x-net-html-with-html", "title": "import error : golang.org/x/net/html with html", "body": "<p>I'm using \"html\" and \"golang.org/x/net/html\" in golang.</p>\n\n<p><a href=\"https://i.stack.imgur.com/slp82.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/slp82.png\" alt=\"enter image description here\"></a></p>\n\n<p>It's got error by same name.So I named other name like this.</p>\n\n<pre><code>net_html \"golang.org/x/net/html\"\n</code></pre>\n\n<p>and also I tried like this </p>\n\n<pre><code>_ \"golang.org/x/net/html\"\n</code></pre>\n\n<p>But it wasn't effect for me.</p>\n\n<p>Do you know how to solve this problem?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 0, "creation_date": 1550941529, "post_id": 54843871, "comment_id": 96461032, "body": "<code>.Seek(0,0)</code> doesn&#39;t rewind?"}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "reply_to_user": {"reputation": 32193, "user_id": 2908724, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/1xBJR.png?s=128&g=1", "display_name": "bishop", "link": "https://stackoverflow.com/users/2908724/bishop"}, "edited": false, "score": 0, "creation_date": 1550941567, "post_id": 54843871, "comment_id": 96461043, "body": "On files only. Isn\u2019t that right?"}], "answers": [{"comments": [{"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "edited": false, "score": 0, "creation_date": 1550952705, "post_id": 54844017, "comment_id": 96464392, "body": "Do you have any other recommendation on my situation, please? Is it a good practice to use readers/writers like this?"}, {"owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "reply_to_user": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "edited": false, "score": 2, "creation_date": 1550953874, "post_id": 54844017, "comment_id": 96464704, "body": "@Victor: I think it&#39;s fairly common to use interfaces for tests, wherein you substitute concrete things like files for &quot;mock&quot; things like byte buffers."}, {"owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "edited": false, "score": 0, "creation_date": 1550957169, "post_id": 54844017, "comment_id": 96465515, "body": "<code>bytes.Reader</code> does not implement <code>Write</code> as far as I can see in the docs? What is to be done in this situation?"}], "tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 4, "last_activity_date": 1550942005, "creation_date": 1550942005, "answer_id": 54844017, "question_id": 54843871, "link": "https://stackoverflow.com/questions/54843871/how-should-i-go-about-reusing-a-stream-in-go/54844017#54844017", "title": "How should I go about reusing a stream in Go?", "body": "<p>Did you consider using the <code>io.ReadWriteSeeker</code> interface instead?</p>\n\n<p><code>bytes.Reader</code> implements <code>Seek</code></p>\n"}], "owner": {"reputation": 10846, "user_id": 1673776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/0llsY.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/1673776/victor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 54844017, "answer_count": 1, "score": 2, "last_activity_date": 1550957203, "creation_date": 1550940969, "last_edit_date": 1550957203, "question_id": 54843871, "link": "https://stackoverflow.com/questions/54843871/how-should-i-go-about-reusing-a-stream-in-go", "title": "How should I go about reusing a stream in Go?", "body": "<p>I have a struct <code>Artifact</code> and the following two functions of interest:</p>\n\n<pre><code>type Artifact struct {\n    Name string\n    ZipFile io.ReadWriter\n}\n\nfunc New(name string, files []string, zipArchiveStream io.ReadWriter) *Artifact {}\nfunc (a *Artifact) Upload() error {}\n</code></pre>\n\n<p>So here's the problem: before passing that <code>io.ReadWriter</code> around, I was using the file name. There are three operations I need to do with the zip file:</p>\n\n<ol>\n<li>Add the necessary files to it (i.e. Write)</li>\n<li>Re-read it to calculate the SHA256 sum (i.e. Seek, Read)</li>\n<li>Upload it to an S3 bucket (i.e. Seek, Read)</li>\n</ol>\n\n<p>Well so before, when using the file name, I opened, closed, re-opened etc. for every operation. I started writing the unit tests however, and I realized my code was not really <em>testable</em> so I decided I would use <code>io.ReadWriter</code> so I could open files in real code usage, and pass buffers in testing.</p>\n\n<p>The problem right now is that after the stream is read, its internal pointer needs to be reset in order to perform a second read (i.e. calculating the checksum, then uploading), but as far as I have read, streams cannot be rewinded. How should I approach this problem? because it seems like some is conceptually wrong with my current approach.</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 3984, "user_id": 4121573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/kxnXk.png?s=128&g=1", "display_name": "Adonis", "link": "https://stackoverflow.com/users/4121573/adonis"}, "edited": false, "score": 1, "creation_date": 1551107499, "post_id": 54843353, "comment_id": 96508853, "body": "Perhaps a bad example, however Spring can do it directly at the entrypoint level, plus I imagine that you might want to catch any wrong input as soon as possible (thus in the entrypoint) rather than having to go into the service and go back up the stack again in such a case."}], "owner": {"reputation": 1612, "user_id": 637531, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/GgtXs.jpg?s=128&g=1", "display_name": "vansanblch", "link": "https://stackoverflow.com/users/637531/vansanblch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 34, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1550937566, "creation_date": 1550937566, "question_id": 54843353, "link": "https://stackoverflow.com/questions/54843353/is-it-service-or-entrypoint-who-should-transform-request-data-into-domain-model", "title": "Is it service or entrypoint who should transform request data into domain model", "body": "<p>I have a simple microservice build with go-kit and protocol buffers. And I have a question about where should I transform request into business-ish data.</p>\n\n<p>For instance, I have following protobuf</p>\n\n<pre><code>import \"google/protobuf/empty.proto\";\n\nservice Location {\n  rpc DeleteLocation(DeleteLocationRequest) returns (google.protobuf.Empty) {};\n}\n\nmessage DeleteLocationRequest {\n  string locationUID = 1;\n}\n</code></pre>\n\n<p>A request has uid to delete as a string; however, I would like to use my custom struct</p>\n\n<pre><code>type LocationUID struct {\n    uuid.UUID\n}\n</code></pre>\n\n<p>So, I'm wondering where it's better to transform incoming string into domain object.</p>\n\n<p><strong>Should I do it inside entrypoint?</strong> Get data from reqeust, transform it into LocationUID and then call service with business logic to perform a required action.</p>\n\n<p><strong>Or is it better to place inside service?</strong> Pass the whole request object from entrypoint into a service and then, inside service, get reqired data, transform it, validate (and return an error if data is invalid)</p>\n"}, {"tags": ["go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 230015, "user_id": 8206, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/fc761ccaf6c0d7d977e2959f9bfebd06?s=128&d=identicon&r=PG", "display_name": "Eli Bendersky", "link": "https://stackoverflow.com/users/8206/eli-bendersky"}, "is_accepted": true, "score": 7, "last_activity_date": 1550937965, "last_edit_date": 1550937965, "creation_date": 1550937573, "answer_id": 54843354, "question_id": 54843269, "link": "https://stackoverflow.com/questions/54843269/slice-declarations-like-02/54843354#54843354", "title": "Slice declarations like [0:2]", "body": "<p>Slice bounds are <a href=\"https://stackoverflow.com/questions/13066884/what-is-half-open-range-and-off-the-end-value\">half open</a>, this is very standard for many programming languages. One advantage is that it makes the length of the range apparent (2-0=2). Specifically, it's common to do this:</p>\n\n<pre><code>s[start:start+len]\n</code></pre>\n\n<p>And it's obvious that this selects <code>len</code> elements from the slice, starting with <code>start</code>. If the range would be fully closed (both bounds included), there would have to be a lot of <code>-1</code>s in code to deal with slicing and subslicing.</p>\n\n<p>It works similarly in C++ ranges and Python, etc. Here's some reasoning from a <a href=\"https://stackoverflow.com/a/9963438/8206\">C++ answer</a>, attributed to Dijkstra:</p>\n\n<ul>\n<li><p>You want the size of the range to be a simple difference end \u2212 begin;</p></li>\n<li><p>including the lower bound is more \"natural\" when sequences degenerate to empty ones, and also because the alternative (excluding the lower bound) would require the existence of a \"one-before-the-beginning\" sentinel value.</p></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "edited": false, "score": 0, "creation_date": 1550940604, "post_id": 54843360, "comment_id": 96460757, "body": "thank you, I did not understand the idea behind a &quot;half-open range&quot;. havent seen this in php and c before..."}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "reply_to_user": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "edited": false, "score": 0, "creation_date": 1550946757, "post_id": 54843360, "comment_id": 96462653, "body": "@ABSimon: C does the same with arrays. <code>int a[10]</code> creates elements 0-9."}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 1, "creation_date": 1550946802, "post_id": 54843360, "comment_id": 96462663, "body": "@ZanLynx I think that&#39;s because of the length and not half - openness"}], "tags": [], "owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "is_accepted": false, "score": 1, "last_activity_date": 1550937595, "creation_date": 1550937595, "answer_id": 54843360, "question_id": 54843269, "link": "https://stackoverflow.com/questions/54843269/slice-declarations-like-02/54843360#54843360", "title": "Slice declarations like [0:2]", "body": "<blockquote>\n  <p>A slice is formed by specifying two indices, a low and high bound,\n  separated by a colon:</p>\n  \n  <p><code>a[low : high]</code></p>\n  \n  <p>This selects a half-open range which includes the first\n  element, but excludes the last one.</p>\n</blockquote>\n\n<p>This is from Golang's page on slices <a href=\"https://tour.golang.org/moretypes/7\" rel=\"nofollow noreferrer\">https://tour.golang.org/moretypes/7</a></p>\n"}], "owner": {"reputation": 571, "user_id": 5727581, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/9e5874b115166d204073fbb1d730f29c?s=128&d=identicon&r=PG&f=1", "display_name": "ABSimon", "link": "https://stackoverflow.com/users/5727581/absimon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 67, "favorite_count": 0, "accepted_answer_id": 54843354, "answer_count": 2, "score": 4, "last_activity_date": 1554653048, "creation_date": 1550936870, "last_edit_date": 1554653048, "question_id": 54843269, "link": "https://stackoverflow.com/questions/54843269/slice-declarations-like-02", "title": "Slice declarations like [0:2]", "body": "<p>I don't understand slice declarations in Go.</p>\n\n<p>For, me a declaration for the first and second element of an array must be 0:1.\nBut it is 0:2. Why? How should I read this, from zero to 2 minus 1 (all the time)?</p>\n\n<pre><code>var slice = array[0:2]  \n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-functions"], "comments": [{"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1550953574, "post_id": 54842789, "comment_id": 96464629, "body": "See here: <a href=\"https://cloud.google.com/functions/docs/writing/#functions-writing-file-structuring-go\" rel=\"nofollow noreferrer\">cloud.google.com/functions/docs/writing/&hellip;</a>"}, {"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "reply_to_user": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1551088425, "post_id": 54842789, "comment_id": 96497558, "body": "@DazWilkin I tried to follow the guide, but without success. I updated my question with additional info."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1551108265, "post_id": 54842789, "comment_id": 96509361, "body": "I&#39;ll try this out today (am PST). If I can&#39;t resolve it, I&#39;ll ask Engineering. Kudos for the clearly-explained question and repro!"}], "answers": [{"comments": [{"owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 1, "creation_date": 1551171799, "post_id": 54872211, "comment_id": 96532655, "body": "Thanks for taking time to reproduce the issue and solve it :) FI, I&#39;ve noticed that in the <i>Cloud Function</i> &gt; <i>Function Details</i> &gt; <i>source</i> tab of the GCP Console, files from the subfolder (<code>shared</code>) are not shown. But anyway, this is just a detail, as we can get the full source code by downloading the zip."}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "reply_to_user": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "edited": false, "score": 1, "creation_date": 1551195210, "post_id": 54872211, "comment_id": 96547129, "body": "You&#39;re welcome! A good feature request. While the console may not permit browsing, it should acknowledge the additional files"}], "tags": [], "owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "is_accepted": true, "score": 2, "last_activity_date": 1551117951, "creation_date": 1551117951, "answer_id": 54872211, "question_id": 54842789, "link": "https://stackoverflow.com/questions/54842789/deploy-google-cloud-function-when-source-code-contains-multiple-levels-directori/54872211#54872211", "title": "Deploy Google Cloud Function when source code contains multiple levels/directories", "body": "<p>OK. It works for me with some changes.</p>\n\n<p>I'm <em>using</em> <code>GOPATH</code> and so am prefixing with <code>GO111MODULE=on</code>. If you are outside of <code>GOPATH</code>, I think you can just drop the <code>GO111MODULE=on</code> environment setting.</p>\n\n<p>Starting with directories and <code>.go</code> files only (no <code>.mod</code> files).</p>\n\n<p>My path is <code>github.com/DazWilkin/cloudfuncs</code>.</p>\n\n<p>IIUC you will need to -- minimally -- prefix module paths with <code>example.com</code>.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package function\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"github.com/DazWilkin/cloudfuncs/shared\"\n)\n\nfunc HelloFreddie(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, shared.Hello())\n}\n</code></pre>\n\n<p>Then, from within my <code>cloudfuncs</code> directory:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>GO111MODULE=on go mod init github.com/DazWilkin/test\n</code></pre>\n\n<p>Results in a <code>go.mod</code>:</p>\n\n<pre><code>module github.com/DazWilkin/cloudfuncs\n\ngo 1.11\n</code></pre>\n\n<p>There is <em>no</em> <code>go.mod</code> file in <code>.../cloudfuncs/shared</code>.</p>\n\n<p>Then I deploy using:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>gcloud functions deploy HelloFreddie \\\n--region=us-central1 \\\n--entry-point=HelloFreddie \\\n--runtime=go111 \\\n--source=$PWD/cloudfuncs \\\n--project=${PROJECT} \\\n--trigger-http\n</code></pre>\n\n<p>You can see the result here:\n<a href=\"https://us-central1-dazwilkin-190225-54842789.cloudfunctions.net/HelloFreddie\" rel=\"nofollow noreferrer\">https://us-central1-dazwilkin-190225-54842789.cloudfunctions.net/HelloFreddie</a></p>\n"}], "owner": {"reputation": 6111, "user_id": 7804058, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BuRRt.png?s=128&g=1", "display_name": "norbjd", "link": "https://stackoverflow.com/users/7804058/norbjd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1301, "favorite_count": 0, "accepted_answer_id": 54872211, "answer_count": 1, "score": 1, "last_activity_date": 1551117951, "creation_date": 1550933330, "last_edit_date": 1551088388, "question_id": 54842789, "link": "https://stackoverflow.com/questions/54842789/deploy-google-cloud-function-when-source-code-contains-multiple-levels-directori", "title": "Deploy Google Cloud Function when source code contains multiple levels/directories", "body": "<p>I want to <a href=\"https://cloud.google.com/functions/docs/deploying/\" rel=\"nofollow noreferrer\">deploy a Google Cloud Function</a>, written in Go, with a code structure containing a subdirectory, like this :</p>\n\n<pre><code>function\n\u251c\u2500\u2500 module1\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 go.mod\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 module1.go\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 entrypoint.go\n</code></pre>\n\n<p>But when I deploy the function, using the GCP console or <code>gcloud</code> command :</p>\n\n<pre><code># from function/ directory\ngcloud functions deploy myfunction --runtime go111 [...]\n</code></pre>\n\n<p>Only <code>go.mod</code> and <code>entrypoint.go</code> are uploaded (I checked on the <em>Source</em> tab of <em>Function details</em> in the GCP Console). Thus the function fails to deploy, because obviously <code>entrypoint.go</code> use methods from <code>module1/module1.go</code>.</p>\n\n<p>The same happens if the source is a <code>.zip</code> (containing multiple directories) on Google Cloud Storage :</p>\n\n<pre><code>gcloud functions deploy myfunction \\\n    --runtime go111 \\\n    --source gs://${BUCKET}/function.zip [...]\n</code></pre>\n\n<p>Is it possible to deploy functions using a code structure with subdirectories? I don't know if the same happens for other runtimes (Python, NodeJS), or if the problem is specific to Go.</p>\n\n<h3>Edit</h3>\n\n<p>I tried to follow this guide : <a href=\"https://cloud.google.com/functions/docs/writing/#functions-writing-file-structuring-go\" rel=\"nofollow noreferrer\">https://cloud.google.com/functions/docs/writing/#functions-writing-file-structuring-go</a> (2nd point : <em>A package at the root of your project that imports code from a sub-package and exports one or more functions</em>), as suggested in the comments, but without success. Here's the structure I used (works in local) :</p>\n\n<pre><code>.\n\u251c\u2500\u2500 function.go\n\u251c\u2500\u2500 go.mod\n\u2514\u2500\u2500 shared\n    \u251c\u2500\u2500 go.mod\n    \u2514\u2500\u2500 shared.go\n</code></pre>\n\ngo.mod\n\n<pre><code>module testcloudfunction\n\nrequire testcloudfunction/shared v0.0.0\n\nreplace testcloudfunction/shared =&gt; ./shared\n</code></pre>\n\nfunction.go\n\n<pre><code>package function\n\nimport (\n    \"fmt\"\n\n    \"testcloudfunction/shared\"\n)\n\nfunc HelloWorld(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, shared.Hello())\n}\n</code></pre>\n\nshared/go.mod\n\n<pre><code>module testcloudfunction/shared\n</code></pre>\n\nshared/shared.go\n\n<pre><code>package shared\n\nfunc Hello() string {\n    return \"Hello World!\"\n}\n</code></pre>\n"}, {"tags": ["json", "go", "encoding", "marshalling"], "answers": [{"tags": [], "owner": {"reputation": 2764, "user_id": 3521116, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0feed05aa5a4174d4210276c06fbadc6?s=128&d=identicon&r=PG&f=1", "display_name": "warl0ck", "link": "https://stackoverflow.com/users/3521116/warl0ck"}, "is_accepted": false, "score": 1, "last_activity_date": 1550931262, "creation_date": 1550931262, "answer_id": 54842505, "question_id": 54842307, "link": "https://stackoverflow.com/questions/54842307/encoding-struct-to-json-go/54842505#54842505", "title": "Encoding struct to json Go", "body": "<p>First of all I think you are going wrong on how to create a <code>struct in go</code>, as you can easily convert them to json.</p>\n\n<p>You should be first making a proper struct then do <code>json.marshal(Test)</code> to convert it to proper json like:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    type TestArray struct {\n        ArrayText string `json:\"array_text,omitempty\"`\n    }\n    type MainStructure struct {\n        Text  string      `json:\"text,omitempty\"`\n        Array []TestArray `json:\"test_array,omitmepty\"`\n    }\n\n    Test := MainStructure{\n        Text: \"test\",\n        Array: []TestArray{\n            TestArray{ArrayText: \"test1\"},\n            TestArray{ArrayText: \"test2\"},\n        }}\n    bytes, err := json.Marshal(Test)\n    if err != nil {\n        fmt.Println(\"eror marshalling\")\n    } else {\n        fmt.Println(string(bytes))\n    }\n}\n</code></pre>\n\n<p>Check this out on <a href=\"https://play.golang.org/p/cEHU3pidq26\" rel=\"nofollow noreferrer\">play.golang.org</a></p>\n"}, {"tags": [], "owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "is_accepted": false, "score": 0, "last_activity_date": 1550931581, "creation_date": 1550931581, "answer_id": 54842552, "question_id": 54842307, "link": "https://stackoverflow.com/questions/54842307/encoding-struct-to-json-go/54842552#54842552", "title": "Encoding struct to json Go", "body": "<p>I could not get the point you wanted to use <code>bytes.Buffer</code> if your objective is just to put the result into the console. Assuming the point is:</p>\n\n<ol>\n<li>Create a struct instance (corresponding to a JSON object)</li>\n<li>Emit it in the screen</li>\n</ol>\n\n<p>The following code can help you:</p>\n\n<pre><code>package main\n\nimport \"encoding/json\"\nimport \"fmt\"\n\ntype MainStructure struct {\n    Text  string      `json:\"text,omitempty\"`\n    Array []TestArray `json:\"test_array,omitmepty\"`\n}\n\ntype TestArray struct {\n    ArrayText string `json:\"array_text,omitempty\"`\n}\n\nfunc main() {\n    Test := MainStructure{\n        Text: \"test\",\n        Array: []TestArray{\n            TestArray{\"test1\"},\n            TestArray{\"test2\"},\n        },\n    }\n\n    res, _ := json.MarshalIndent(Test, \"\", \"\\t\")\n    fmt.Println(string(res))\n}\n</code></pre>\n\n<p><code>json.MarshalIndent</code> is used to make result pretty-formatted, if you bother it.</p>\n"}, {"tags": [], "owner": {"reputation": 36, "user_id": 3946844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a009e3977ce79045ae3ef45343d3944a?s=128&d=identicon&r=PG", "display_name": "Radhi Fadlillah", "link": "https://stackoverflow.com/users/3946844/radhi-fadlillah"}, "is_accepted": true, "score": 1, "last_activity_date": 1550933203, "creation_date": 1550933203, "answer_id": 54842776, "question_id": 54842307, "link": "https://stackoverflow.com/questions/54842307/encoding-struct-to-json-go/54842776#54842776", "title": "Encoding struct to json Go", "body": "<p>To encode a struct to JSON string, there are three ways that provided by standard library :</p>\n\n<ul>\n<li>Using <a href=\"https://golang.org/pkg/encoding/json/#Encoder\" rel=\"nofollow noreferrer\"><code>Encoder</code></a> which convert struct to JSON string, then write it to <code>io.Writer</code>. This one usually used if you want to send JSON data as HTTP request, or saving the JSON string to a file.</li>\n<li>Using <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>Marshal</code></a> which simply convert struct to bytes, which can be easily converted to string.</li>\n<li>Using <a href=\"https://golang.org/pkg/encoding/json/#MarshalIndent\" rel=\"nofollow noreferrer\"><code>MarshalIndent</code></a> which works like <code>Marshal</code>, except it's also prettify the output. This is what you want for your problem right now.</li>\n</ul>\n\n<p>To compare between those three methods, you can use this code (<a href=\"https://play.golang.org/p/AC_4qccHTFL\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype MainStructure struct {\n    Text  string      `json:\"text,omitempty\"`\n    Array []TestArray `json:\"test_array,omitempty\"`\n}\n\ntype TestArray struct {\n    ArrayText string `json:\"array_text,omitempty\"`\n}\n\nfunc main() {\n    Test := MainStructure{\n        Text: \"test\",\n        Array: []TestArray{\n            {ArrayText: \"test1\"},\n            {ArrayText: \"test2\"},\n        },\n    }\n\n    // Using marshal indent\n    btResult, _ := json.MarshalIndent(&amp;Test, \"\", \"  \")\n    fmt.Println(\"Using Marshal Indent:\\n\" + string(btResult))\n\n    // Using marshal\n    btResult, _ = json.Marshal(&amp;Test)\n    fmt.Println(\"\\nUsing Marshal:\\n\" + string(btResult))\n\n    // Using encoder\n    var buffer bytes.Buffer\n    json.NewEncoder(&amp;buffer).Encode(&amp;Test)\n    fmt.Println(\"\\nUsing Encoder:\\n\" + buffer.String())\n}\n</code></pre>\n\n<p>The output will look like this :</p>\n\n<pre><code>Using Marshal Indent:\n{\n  \"text\": \"test\",\n  \"test_array\": [\n    {\n      \"array_text\": \"test1\"\n    },\n    {\n      \"array_text\": \"test2\"\n    }\n  ]\n}\n\nUsing Marshal:\n{\"text\":\"test\",\"test_array\":[{\"array_text\":\"test1\"},{\"array_text\":\"test2\"}]}\n\nUsing Encoder:\n{\"text\":\"test\",\"test_array\":[{\"array_text\":\"test1\"},{\"array_text\":\"test2\"}]}\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user7781073"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4488, "favorite_count": 0, "accepted_answer_id": 54842776, "answer_count": 3, "score": -2, "last_activity_date": 1550933203, "creation_date": 1550929918, "question_id": 54842307, "link": "https://stackoverflow.com/questions/54842307/encoding-struct-to-json-go", "title": "Encoding struct to json Go", "body": "<p>I have an issue encoding struct to json my code is<pre>\ntype MainStructure struct {\n    Text  string      <code>json:\"text,omitempty\"</code>\n    Array []TestArray <code>json:\"test_array,omitmepty\"</code>\n}</p>\n\n<p>type TestArray struct {\n    ArrayText string <code>json:\"array_text,omitempty\"</code>\n}</p>\n\n<p>func main() {\n    Test := MainStructure{\n        Text: \"test\",\n        Array: [\n            {\n                ArrayText: \"test1\"\n            },\n            {\n                ArrayText: \"test2\"\n            }\n        ]\n    }\n    body := new(bytes.Buffer)\n    json.NewEncoder(body).Encode(&amp;Test)\n    fmt.Println(string([]byte(body)))\n}</pre></p>\n\n<p>the wanted result should be</p>\n\n<pre>\n{\n    \"text\": \"test\",\n    \"test_array\": [\n        {\n            \"array_text\": \"test1\"\n        },\n        {\n            \"array_text\": \"test2\"\n        }\n    ]\n}\n</pre>\n\n<p>I do not mind if it's \"Marshal\" or \"encoding/json\"</p>\n"}, {"tags": ["go", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 2616, "user_id": 689718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c3d56867b527233cc06a60015328b11?s=128&d=identicon&r=PG", "display_name": "Alexander van Trijffel", "link": "https://stackoverflow.com/users/689718/alexander-van-trijffel"}, "edited": false, "score": 0, "creation_date": 1550928988, "post_id": 54842145, "comment_id": 96457654, "body": "Yes. That&#39;s what I was looking for. Thanks!"}], "tags": [], "owner": {"reputation": 5521, "user_id": 9143962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/488e46850036ab6203c41bf5f9c2c31d?s=128&d=identicon&r=PG&f=1", "display_name": "leaf bebop", "link": "https://stackoverflow.com/users/9143962/leaf-bebop"}, "is_accepted": true, "score": 1, "last_activity_date": 1550928679, "creation_date": 1550928679, "answer_id": 54842145, "question_id": 54841662, "link": "https://stackoverflow.com/questions/54841662/how-to-retrieve-full-html-of-a-child-element-with-goquery/54842145#54842145", "title": "How to retrieve full HTML of a child element with goquery?", "body": "<p>What you want is actually outer HTML, and you can get it by calling <a href=\"https://godoc.org/github.com/PuerkitoBio/goquery#OuterHtml\" rel=\"nofollow noreferrer\"><code>goquery.OuterHTML</code></a> function. As per document:</p>\n\n<blockquote>\n<pre><code>func OuterHtml(s *Selection) (string, error)\n</code></pre>\n  \n  <p>OuterHtml returns the outer HTML rendering of the first item in the\n  selection - that is, the HTML including the first element's tag and\n  attributes.</p>\n  \n  <p>Unlike InnerHtml, this is a function and not a method on the\n  Selection, because this is not a jQuery method (in javascript-land,\n  this is a property provided by the DOM).</p>\n</blockquote>\n\n<p>So just change the line to:</p>\n\n<pre><code>html, _ := goquery.OuterHTML(s)\n</code></pre>\n"}], "owner": {"reputation": 2616, "user_id": 689718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7c3d56867b527233cc06a60015328b11?s=128&d=identicon&r=PG", "display_name": "Alexander van Trijffel", "link": "https://stackoverflow.com/users/689718/alexander-van-trijffel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 749, "favorite_count": 0, "accepted_answer_id": 54842145, "answer_count": 1, "score": 1, "last_activity_date": 1550928679, "creation_date": 1550925263, "question_id": 54841662, "link": "https://stackoverflow.com/questions/54841662/how-to-retrieve-full-html-of-a-child-element-with-goquery", "title": "How to retrieve full HTML of a child element with goquery?", "body": "<p>Why does the following test fail?</p>\n\n<pre><code>func TestGetFirstElementHtml(t *testing.T) {\n    test := `&lt;speak&gt;&lt;p&gt;My paragraph&lt;/p&gt;&lt;/speak&gt;`\n    doc, _ := goquery.NewDocumentFromReader(strings.NewReader(test))\n    var childrenHtml []string\n    doc.Find(\"speak\").Children().Each(func(i int, s *goquery.Selection) {\n        html, _ := s.Html()\n        childrenHtml = append(childrenHtml, html)\n    })\n    if childrenHtml[0] != \"&lt;p&gt;My paragraph&lt;/p&gt;\" {\n        t.Fatalf(\"First element html is not valid: '%s'\", childrenHtml[0])\n    }\n}\n</code></pre>\n\n<p>This is the test result:</p>\n\n<pre><code>=== FAIL: . TestGetFirstElementHtml (0.00s)\n    main_test.go:45: First element html is not valid: 'My paragraph'\n</code></pre>\n\n<p>In other words, how can I retrieve the full HTML of the first child of  given that I cannot predict what kind html element that child is? </p>\n"}]