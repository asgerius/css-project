[{"tags": ["android", "go", "pthreads", "cross-compiling"], "answers": [{"tags": [], "owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "is_accepted": true, "score": 0, "last_activity_date": 1496969913, "creation_date": 1496969913, "answer_id": 44447716, "question_id": 44424331, "link": "https://stackoverflow.com/questions/44424331/compiling-go-to-android-invalid-signature-of-pthread-key-create/44447716#44447716", "title": "Compiling go to Android: invalid signature of pthread_key_create", "body": "<p>The compiler command is incomplete. You can use <code>gomobile build -x</code> to see how to invoke the compiler correctly, remember you might need to quote the parameters correctly in your shell.</p>\n\n<p>An example of a correct command:</p>\n\n<p><code>GOMOBILE=/home/janus/go/pkg/gomobile GOPATH=$HOME/go ANDROID_HOME=/home/janus/Desktop/android-sdk-linux GOOS=android GOARCH=arm CC=$ANDROID_HOME/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/clang CXX=$ANDROID_HOME/ndk-bundle/toolchains/llvm/prebuilt/linux-x86_64/bin/clang++ CGO_CFLAGS=\"-target armv7a-none-linux-androideabi --sysroot $ANDROID_HOME/ndk-bundle/platforms/android-15/arch-arm -gcc-toolchain $ANDROID_HOME/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 -I$GOMOBILE/include\" CGO_CPPFLAGS=\"-target armv7a-none-linux-androideabi --sysroot $ANDROID_HOME/ndk-bundle/platforms/android-15/arch-arm -gcc-toolchain $ANDROID_HOME/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 -I$GOMOBILE/include\" CGO_LDFLAGS=\"-target armv7a-none-linux-androideabi --sysroot $ANDROID_HOME/ndk-bundle/platforms/android-15/arch-arm -gcc-toolchain $ANDROID_HOME/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64 -L$ANDROID_HOME/ndk-bundle/platforms/android-15/arch-arm/usr/lib -L$GOMOBILE/lib/arm\" CGO_ENABLED=1 GOARM=7 go build -pkgdir=$GOMOBILE/pkg_android_arm -buildmode=c-shared</code></p>\n"}], "owner": {"reputation": 17430, "user_id": 309483, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d797538504a367f277d19bd8369e9a19?s=128&d=identicon&r=PG", "display_name": "Janus Troelsen", "link": "https://stackoverflow.com/users/309483/janus-troelsen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 155, "favorite_count": 0, "accepted_answer_id": 44447716, "answer_count": 1, "score": 0, "last_activity_date": 1496969913, "creation_date": 1496878155, "question_id": 44424331, "link": "https://stackoverflow.com/questions/44424331/compiling-go-to-android-invalid-signature-of-pthread-key-create", "title": "Compiling go to Android: invalid signature of pthread_key_create", "body": "<pre><code>CGO_CFLAGS=\"--sysroot=android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/\" CGO_ENABLED=1 CC=android-sdk-linux/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++ CXX=android-sdk-linux/ndk-bundle/toolchains/arm-linux-androideabi-4.9/prebuilt/linux-x86_64/bin/arm-linux-androideabi-g++ \\                \n    GOOS=android GOARCH=arm go build -buildmode=c-archive --ldflags=\"--sysroot=android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/\"\n# runtime/cgo\n/usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c: In function 'void inittls(void**, void**)':\n/usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c:30:34: error: invalid conversion from 'void*' to 'void (*)(void*)' [-fpermissive]\n  err = pthread_key_create(&amp;k, nil);\n                                  ^\nIn file included from /usr/lib/go-1.8/src/runtime/cgo/gcc_android_arm.c:5:0:\n/home/janus/Desktop/android-sdk-linux/ndk-bundle/platforms/android-9/arch-arm/usr/include/pthread.h:265:5: note: initializing argument 2 of 'int pthread_key_create(pthread_key_t*, void (*)(void*))'\n int pthread_key_create(pthread_key_t *key, void (*destructor_function)(void *));\n</code></pre>\n\n<p>The same issue occurs with recent API levels like 22.</p>\n\n<p>I am using the golang-1.8-go package mentioned on <a href=\"https://github.com/golang/go/wiki/Ubuntu\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Ubuntu</a></p>\n"}, {"tags": ["multithreading", "go", "concurrency", "locking"], "answers": [{"comments": [{"owner": {"reputation": 69, "user_id": 1335614, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74624bcb3ba1e02531ab1f4608020022?s=128&d=identicon&r=PG", "display_name": "shidsun", "link": "https://stackoverflow.com/users/1335614/shidsun"}, "edited": false, "score": 0, "creation_date": 1496875920, "post_id": 44423823, "comment_id": 75846394, "body": "Thank you very much for your precise answer! :-) It is very helpful, and I admit that the easiest way is to use a <code>Mutex</code>. But, according to my limited experience, handling concurrency problems using message passing, if possible, is far easier than using shared-memory solutions. I&#39;m trying to know if it is possible to solve the problem without using semaphores or mutexes, and just employ golang channels, and now I see that it&#39;s totally fine to use a <code>Mutex</code>."}, {"owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "reply_to_user": {"reputation": 69, "user_id": 1335614, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74624bcb3ba1e02531ab1f4608020022?s=128&d=identicon&r=PG", "display_name": "shidsun", "link": "https://stackoverflow.com/users/1335614/shidsun"}, "edited": false, "score": 0, "creation_date": 1496883054, "post_id": 44423823, "comment_id": 75848328, "body": "Hi @shidsun, I&#39;m not sure if I understand your question then :), perhaps some psuedo code would help? In anycase, my suggestion is to avoid array&#39;s altogether, (if you want to only use channels) and try storing the data in <code>chan</code>s."}], "tags": [], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "is_accepted": false, "score": 2, "last_activity_date": 1496882992, "last_edit_date": 1592644375, "creation_date": 1496874853, "answer_id": 44423823, "question_id": 44423746, "link": "https://stackoverflow.com/questions/44423746/two-way-communication-through-channels-in-golang/44423823#44423823", "title": "two way communication through channels in golang", "body": "<p>The <code>sync</code> package includes a Mutex lock, <code>sync.Mutex</code>, which can be locked and unlocked from any goroutine in a threadsafe way. Instead of using a channel to send a command to lock something, how about just using a mutex lock from the sender?</p>\n<pre><code>mutex := new(sync.Mutex)\nsensitiveData := make([]string, 0)\n// when someone wants to operate on a sensitiveData,\n// ...\nmutex.Lock()\noperate(sensitiveData)\nmutex.Unlock()\n</code></pre>\n<p>When you say how does the sender become aware of the result, I think you're talking about how does the handler receive the result -- that would be with a <code>chan</code>. You can send data through channels.</p>\n<p><strong>Alternatively</strong>, if you just want to be <em>aware</em>, a semaphore, <code>sync.WaitGroup</code> might do the job. This struct can be <code>Add()</code>ed to, and then the sender can <code>wg.Wait()</code> until the handler calls <code>wg.Done()</code>, which will indicate to the sender (which is waiting) that the handler is done doing such and such.</p>\n<hr>\n<p>If your question is about whether to use locks or channels, the <a href=\"https://github.com/golang/go/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">wiki</a> has a terse answer:</p>\n<blockquote>\n<p>A common Go newbie mistake is to over-use channels and goroutines just because it's possible, and/or because it's fun. Don't be afraid to use a sync.Mutex if that fits your problem best. Go is pragmatic in letting you use the tools that solve your problem best and not forcing you into one style of code.</p>\n<p>As a general guide, though:</p>\n<p>Channel: passing ownership of data, distributing units of work, communicating async results<br />\nMutex: caches, state</p>\n</blockquote>\n<hr>\n<p>If you absolutely want to avoid anything but <code>chan</code>s :), try not altering the sensitive array to begin with. Rather, use channels to send data to different goroutines, at each step processing the data, and then funneling the processed data into a final type goroutine. That is, avoid using an array at all and store the data in <code>chan</code>s.</p>\n<p>As the motto goes,</p>\n<blockquote>\n<p>Do not communicate by sharing memory; instead, share memory by communicating.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 0, "last_activity_date": 1496905934, "last_edit_date": 1496905934, "creation_date": 1496903303, "answer_id": 44428179, "question_id": 44423746, "link": "https://stackoverflow.com/questions/44423746/two-way-communication-through-channels-in-golang/44428179#44428179", "title": "two way communication through channels in golang", "body": "<p>If you want to prevent race conditions then <code>sync</code> primitives should work just fine, as described in @Nevermore's answer. It leaves the code much more readable and easier to reason about.</p>\n\n<p>However, if you want channels to perform syncing for you, you can always try something like below:</p>\n\n<pre><code>// A global, shared channel used as a lock. Capacity of 1 allows for only\n// one thread to access the protected resource at a time.\nvar lock = make(chan struct{}, 1)\n\n\n// Operate performs the access/modification on the protected resource.\nfunc Operate(f func() error) error {\n    lock &lt;- struct{}{}\n    defer func() { &lt;- lock }()\n    return f()\n}\n</code></pre>\n\n<p>To use this <code>Operate</code>, pass in a closure that accesses the protected resource.</p>\n\n<pre><code>// Some value that requires concurrent access.\nvar arr = []int{1, 2, 3, 4, 5}\n\n// Used to sync up goroutines.\nvar wg sync.WaitGroup\nwg.Add(len(arr))\n\nfor i := 0; i &lt; len(arr); i++ {\n    go func(j int) {\n        defer wg.Done()\n\n        // Access to arr remains protected.\n        Operate(func () error {\n            arr[j] *= 2\n            return nil\n        })\n\n    }(i)\n}\nwg.Wait()\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/Drh-yJDVNh\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Drh-yJDVNh</a></p>\n\n<p>Or you can entirely bypass <code>Operate</code> and use <code>lock</code> directly for more readability:</p>\n\n<pre><code>go func(j int) {\n    defer wg.Done()\n\n    lock &lt;- struct{}{}\n    defer func() { &lt;- lock }()\n\n    arr[j] *= 2\n}(i)\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/me3K6aIoR7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/me3K6aIoR7</a></p>\n\n<p>As you can see, <code>arr</code> access is protected using a channel here.</p>\n"}, {"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": -1, "last_activity_date": 1496929065, "creation_date": 1496929065, "answer_id": 44437294, "question_id": 44423746, "link": "https://stackoverflow.com/questions/44423746/two-way-communication-through-channels-in-golang/44437294#44437294", "title": "two way communication through channels in golang", "body": "<p>The other questions have covered locking well, but I wanted to address the other part of the question around using channels to send a response back to a caller. There is a not-uncommon pattern in Go of sending a response channel with the request. For example, you might send commands to a handler over a channel; these commands would be a <code>struct</code> with implementation-specific details, and the struct would include a channel for sending the result back, typed to the result type. Each command sent would include a new channel, which the handler would use to send back the response, and then close. To illustrate:</p>\n\n<pre><code>type Command struct {\n    // command parameters etc\n    Results chan Result\n}\n\ntype Result struct {\n    // Whatever a result is in this case\n}\n\nvar workQueue = make(chan Command)\n\n// Example for executing synchronously\nfunc Example(param1 string, param2 int) Result {\n    workQueue &lt;- Command{\n        Param1: param1,\n        Param2: param2,\n        Results: make(chan Result),\n    }\n    return &lt;- Results\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 1335614, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/74624bcb3ba1e02531ab1f4608020022?s=128&d=identicon&r=PG", "display_name": "shidsun", "link": "https://stackoverflow.com/users/1335614/shidsun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2927, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1496929065, "creation_date": 1496874384, "question_id": 44423746, "link": "https://stackoverflow.com/questions/44423746/two-way-communication-through-channels-in-golang", "title": "two way communication through channels in golang", "body": "<p>I have several functions that I want them to be executed atomically since they deal with sensitive data structures. Suppose the following scenario:\nThere are two functions: <code>lock(sth)</code> and <code>unlock(sth)</code> that can be called anytime by a goroutine to lock or unlock <code>sth</code> in a global array. I was thinking about having a command channel so that goroutines send <code>lock</code> and <code>unlock</code> commands into the channel, and on the receive side of the channel, some kind of <code>handler</code> handles <code>lock</code>, <code>unlock</code> requests, sequentially, by grabbing commands from the channel. That's fine, but what if the <code>handler</code> wants to send the result back to the requester? Is it possible to do so use golang channels? I know that it is possible to use some kind of lock mechanism like mutex, but I was wondering if it's possible to use channels for such use-case? I saw somewhere that it is recommended to use channel instead of goland low-level lock structs.</p>\n\n<p>In a single sentence:</p>\n\n<p>In a channel with the capacity of 1, I want the receiver side to be able to reply back to the goroutine which sent the message. </p>\n\n<p>or equivalently:</p>\n\n<p>A goroutine sends something to a channel; the message is received by another goroutine and handled leading to some result; how does the sender become aware of the result?</p>\n"}, {"tags": ["ssl", "curl", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496863334, "post_id": 44420891, "comment_id": 75840731, "body": "Sounds like curl&#39;s CA bundle is out of date. The URL in the error message details how to fix this."}, {"owner": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496863837, "post_id": 44420891, "comment_id": 75841015, "body": "I have solved the issue. I checked my nginx config files and it turns out that it uses the fullchain.pem as the certificate rather than cert.pem. Easy assumption to make but solved now. Hope this helps any one else who has this problem."}], "owner": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 316, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1496863217, "creation_date": 1496862410, "last_edit_date": 1496863217, "question_id": 44420891, "link": "https://stackoverflow.com/questions/44420891/golang-tls-accepted-by-browser-but-not-by-curl", "title": "Golang TLS Accepted by browser but not by curl", "body": "<p>I'm creating a web app and normally I use nginx and lets encrypt for my SSL certificates, and that always works fine. I have nginx redirect the traffic to a different local server depending on the subdomain.</p>\n\n<p>However, I decided that I wanted to try use golang's <a href=\"https://golang.org/pkg/net/http/#ListenAndServeTLS\" rel=\"nofollow noreferrer\">ListenAndServeTLS</a> function. So I set up my handles as normal and generated some signed certificates through lets encrypt and passed the file locations for the cert and the key to the ListenAndServeTLS function.</p>\n\n<p>Now, for some reason, when accessing the site from a browser, I get no problems, it verifies the certificates and informs me that my connection is secure but using curl, I get the following response</p>\n\n<pre><code>$ curl https://...\ncurl: (60) SSL certificate problem: unable to get local issuer certificate\nMore details here: https://curl.haxx.se/docs/sslcerts.html\n\ncurl performs SSL certificate verification by default, using a \"bundle\"\n of Certificate Authority (CA) public keys (CA certs). If the default\n bundle file isn't adequate, you can specify an alternate file\n using the --cacert option.\nIf this HTTPS server uses a certificate signed by a CA represented in\n the bundle, the certificate verification probably failed due to a\n problem with the certificate (it might be expired, or the name might\n not match the domain name in the URL).\nIf you'd like to turn off curl's verification of the certificate, use\n the -k (or --insecure) option.\nHTTPS-proxy has similar options --proxy-cacert and --proxy-insecure.\n</code></pre>\n\n<p>I have never had this problem with nginx and I'm just wondering if anyone has any advice or has had this issue before and knows how to solve it. </p>\n"}, {"tags": ["go", "import", "package", "main"], "comments": [{"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "edited": false, "score": 1, "creation_date": 1496863160, "post_id": 44420826, "comment_id": 75840622, "body": "Without knowing the specifics, it sounds like you should have the webserver be under &quot;package webserver&quot; and the tcp server under &quot;package tcpserver&quot;. You can then spin up a go program importing those two libraries. I do not believe you are able to import another package&#39;s &quot;main&quot; while you are inside &quot;package main&quot; already."}], "answers": [{"comments": [{"owner": {"reputation": 6929, "user_id": 5749914, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/WvtTa.png?s=128&g=1", "display_name": "Warlike Chimpanzee", "link": "https://stackoverflow.com/users/5749914/warlike-chimpanzee"}, "edited": false, "score": 1, "creation_date": 1506298903, "post_id": 44421114, "comment_id": 79749351, "body": "See also <a href=\"https://groups.google.com/forum/#!topic/Golang-nuts/frh9zQPEjUk\" rel=\"nofollow noreferrer\">groups.google.com/forum/#!topic/Golang-nuts/frh9zQPEjUk</a> for discussion."}, {"owner": {"reputation": 5668, "user_id": 2023745, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/cc8256640c8046280c734a84b4be3f1d?s=128&d=identicon&r=PG", "display_name": "TheRealFakeNews", "link": "https://stackoverflow.com/users/2023745/therealfakenews"}, "edited": false, "score": 0, "creation_date": 1614206089, "post_id": 44421114, "comment_id": 117318634, "body": "@Adrian What if you have something you need to initialize in <code>main</code>, such as a logger (<a href=\"https://pkg.go.dev/go.uber.org/zap#example-package-Presets\" rel=\"nofollow noreferrer\">pkg.go.dev/go.uber.org/zap#example-package-Presets</a>)? You cannot have that in a utility package, for example, because you can&#39;t run <code>main()</code>."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 56, "last_activity_date": 1496863150, "creation_date": 1496863150, "answer_id": 44421114, "question_id": 44420826, "link": "https://stackoverflow.com/questions/44420826/access-main-package-from-other-package/44421114#44421114", "title": "Access main package from other package", "body": "<p>You cannot <code>import</code> the <code>main</code> package. Any shared code should go in a separate package, which can be imported by <code>main</code> (and other packages).</p>\n"}], "owner": {"reputation": 2539, "user_id": 2735398, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/74d4d7c1aba9dfac3331aaf8178465d5?s=128&d=identicon&r=PG&f=1", "display_name": "Jan Wytze", "link": "https://stackoverflow.com/users/2735398/jan-wytze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13046, "favorite_count": 3, "accepted_answer_id": 44421114, "answer_count": 1, "score": 28, "last_activity_date": 1591772270, "creation_date": 1496862174, "last_edit_date": 1591772270, "question_id": 44420826, "link": "https://stackoverflow.com/questions/44420826/access-main-package-from-other-package", "title": "Access main package from other package", "body": "<p>I want to access the main package from another package, but this is impossible because the main file isn't in a directory. I already tried putting the main file in a directory, but when I try to import it I get this error:<br>\n<code>import \"../main\" is a program, not an importable package</code></p>\n\n<p>The reason that I want this because I have a tcp server and a webserver that work together. The webserver can get the tcp server via the main package and the tcp server can get the webserver via the main package.</p>\n\n<p>I already got it working with the webserver and tcpserver reading from each other(without the main package in the middle), but I want to keep some parts of the application at one place.</p>\n\n<p>Is the the thing I want possible(Via the main package)? Or is it just stupid.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1496866207, "post_id": 44420451, "comment_id": 75842326, "body": "Typical for Go: Write several lines, each lines doing one thing instead of one monster line doing everything."}], "answers": [{"comments": [{"owner": {"reputation": 83, "user_id": 1869799, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/3cb96517ed0d66c2dcecf094bd42e7b2?s=128&d=identicon&r=PG", "display_name": "learner", "link": "https://stackoverflow.com/users/1869799/learner"}, "edited": false, "score": 0, "creation_date": 1496877116, "post_id": 44420797, "comment_id": 75846796, "body": "I guess I was looking for a way to do it in a single line, but looks like there isnt a way."}], "tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 2, "last_activity_date": 1496862052, "creation_date": 1496862052, "answer_id": 44420797, "question_id": 44420451, "link": "https://stackoverflow.com/questions/44420451/golang-initialize-member-with-struct-itself-for-sync-mutex-and-sync-cond/44420797#44420797", "title": "golang initialize member with struct itself for sync.Mutex and sync.Cond", "body": "<p>You can create a new instance first, and then refer to the embedded field:</p>\n\n<pre><code>type SomeThing struct {\n    sync.Mutex\n    cv  *sync.Cond\n    num int\n}\n\nfunc NewSomething() *SomeThing {\n    st := &amp;SomeThing{}\n    st.cv = sync.NewCond(&amp;st.Mutex)\n    return st\n}\n</code></pre>\n\n<p>GoPlay here: <a href=\"https://play.golang.org/p/BlnHMi1EKT\" rel=\"nofollow noreferrer\">https://play.golang.org/p/BlnHMi1EKT</a></p>\n"}], "owner": {"reputation": 83, "user_id": 1869799, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/3cb96517ed0d66c2dcecf094bd42e7b2?s=128&d=identicon&r=PG", "display_name": "learner", "link": "https://stackoverflow.com/users/1869799/learner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496862052, "creation_date": 1496860877, "question_id": 44420451, "link": "https://stackoverflow.com/questions/44420451/golang-initialize-member-with-struct-itself-for-sync-mutex-and-sync-cond", "title": "golang initialize member with struct itself for sync.Mutex and sync.Cond", "body": "<p>Here is go code:</p>\n\n<pre><code>type someThing struct {\n    sync.Mutex\n    cv      *sync.Cond\n    num     int\n}\n\nfunc NewSomething() *someThing {\n    // how do you do this ?\n    return &amp;someThing{cv:sync.NewCond(sync.Mutex)}\n}\n</code></pre>\n\n<p>This code fails to compile:</p>\n\n<pre><code>sync.Mutex (type) is not an expression\n</code></pre>\n\n<p>So basically the question is how to refer to the struct itself (because it has an embedded member sync.Mutex) while initializing it ? (c++ has <em>this</em>, for example). </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1496856289, "post_id": 44419068, "comment_id": 75836836, "body": "<code>httptransport.DecodeRequestFunc(makePostEndpoint(svc))</code>?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496856323, "post_id": 44419068, "comment_id": 75836854, "body": "The error points to line 124, and there&#39;s only a couple dozen lines of code quoted. Can you at least mark which line is 124 in your sample?"}, {"owner": {"reputation": 1484, "user_id": 652890, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a8b98e420be5deb62abf74b84682e729?s=128&d=identicon&r=PG", "display_name": "allthenutsandbolts", "link": "https://stackoverflow.com/users/652890/allthenutsandbolts"}, "edited": false, "score": 0, "creation_date": 1496861040, "post_id": 44419068, "comment_id": 75839391, "body": "httptransport.NewServer is line 124."}], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1507541419, "post_id": 44420553, "comment_id": 80235324, "body": "thanks for info. helped to resolve same problem fast)"}], "tags": [], "owner": {"reputation": 1484, "user_id": 652890, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a8b98e420be5deb62abf74b84682e729?s=128&d=identicon&r=PG", "display_name": "allthenutsandbolts", "link": "https://stackoverflow.com/users/652890/allthenutsandbolts"}, "is_accepted": false, "score": 1, "last_activity_date": 1496861168, "creation_date": 1496861168, "answer_id": 44420553, "question_id": 44419068, "link": "https://stackoverflow.com/questions/44419068/compilation-error-with-go-kit/44420553#44420553", "title": "Compilation Error with go Kit", "body": "<p>I found the issue. There is a newer version of go kit  in which the signature of the NewServer has changed. Context has been removed and hence. I just had to remove the ctx and everything compiled.</p>\n"}], "owner": {"reputation": 1484, "user_id": 652890, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/a8b98e420be5deb62abf74b84682e729?s=128&d=identicon&r=PG", "display_name": "allthenutsandbolts", "link": "https://stackoverflow.com/users/652890/allthenutsandbolts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1496861168, "creation_date": 1496856036, "question_id": 44419068, "link": "https://stackoverflow.com/questions/44419068/compilation-error-with-go-kit", "title": "Compilation Error with go Kit", "body": "<p>I cloned a project which uses go-kit, when I try to compile the project, I get an compilation error which is something like </p>\n\n<pre><code>./main.go:124: cannot use makePostEndpoint(svc) (type endpoint.Endpoint) as type \"github.com/go-kit/kit/transport/http\".DecodeRequestFunc in argument to \"github.com/go-k\nit/kit/transport/http\".NewServer\n</code></pre>\n\n<p>The snippet of code is as below</p>\n\n<pre><code>func main() {\n    ctx := context.Background()\n    svc := cayleyService{}\n\n    postHandler := httptransport.NewServer(\n        ctx,\n        makePostEndpoint(svc),\n        decodePostRequest,\n        encodeResponse,\n    )\n}\n\nfunc makeGetEndpoint(svc CayleyService) endpoint.Endpoint {\n    return func(ctx context.Context, request interface{}) (interface{}, error) {\n        req := request.(getRequest)\n        v, err := svc.Get(req.Qu)\n        if err != nil {\n            return getResponse{v, err.Error()}, nil\n        }\n        return getResponse{v, \"\"}, nil\n    }\n}\n</code></pre>\n\n<p>I have version 1.8.1 of golang installed.</p>\n"}, {"tags": ["go", "gorilla"], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1496855446, "creation_date": 1496855446, "answer_id": 44418893, "question_id": 44418576, "link": "https://stackoverflow.com/questions/44418576/register-golang-gorilla-mux-routes-in-external-package/44418893#44418893", "title": "Register Golang gorilla/mux routes in external package", "body": "<blockquote>\n  <p>It's not working since it's not even loading \"handlers/handler_one.go\"</p>\n</blockquote>\n\n<p>Do you mean that the <code>init</code> function in <code>handlers/handler_one.go</code> is not being executed?</p>\n\n<p>That would be expected since in the code you pasted you are not importing that package anywhere.</p>\n\n<p>Try importing that package in your <code>main.go</code>.</p>\n\n<p>You can import as <code>_</code> if the only reason for importing it would be for the <code>init</code> function to run.</p>\n"}], "owner": {"reputation": 374, "user_id": 4833237, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/b99a13ba5d3fc3b181d50e97e606896d?s=128&d=identicon&r=PG&f=1", "display_name": "Maklaus", "link": "https://stackoverflow.com/users/4833237/maklaus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 745, "favorite_count": 0, "accepted_answer_id": 44418893, "answer_count": 1, "score": 2, "last_activity_date": 1496855446, "creation_date": 1496854303, "question_id": 44418576, "link": "https://stackoverflow.com/questions/44418576/register-golang-gorilla-mux-routes-in-external-package", "title": "Register Golang gorilla/mux routes in external package", "body": "<p>In my API I'm going to have a lot of completely separate handlers for each path like \"/api/v1/handler_one\" and \"/api/v1/handler_two\". I'm trying to put every handler in it's own package to make it easier to maintain.</p>\n\n<p>I added an example. It's not working since it's not even loading \"handlers/handler_one.go\". What am I missing?</p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"git/myapp/router\"\n)\n\nfunc main() {\n\n  myRouter := router.APIRouter\n\n    srv := &amp;http.Server{\n        Handler: myRouter,\n        Addr:    \"0.0.0.0:8080\",\n    }\n\n    log.Fatal(srv.ListenAndServe())\n}\n</code></pre>\n\n<p>router/router.go</p>\n\n<pre><code>package router\n\nimport (\n    \"github.com/gorilla/mux\"\n)\n\nvar Router = mux.NewRouter().StrictSlash(true)\nvar APIRouter = Router.PathPrefix(\"/api/v1\").Subrouter()\n</code></pre>\n\n<p>handlers/handler_one.go</p>\n\n<pre><code>package handler_one\n\nimport (\n    \"git/myapp/router\"\n)\n\ntype Route struct {\n    Name        string\n    Method      string\n    Pattern     string\n    HandlerFunc http.HandlerFunc\n}\n\ntype APIRoutes []Route\n\nvar apiRoutes = APIRoutes{\n    Route{ \"OneIndex\", \"GET\", \"/one\", OneIndex, },\n}\n\nfunc init() {\n    // Register routes\n    for _, route := range apiRoutes {\n        var handler http.Handler\n\n        handler = route.HandlerFunc\n        handler = Logger(handler, route.Name)\n\n        router.APIRouter.\n            Methods(route.Method).Path(route.Pattern).Name(route.Name).Handler(handler)\n    }\n}\n\n// OneIndex is handling the requests to /api/v1/one\nfunc OneIndex(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n    w.WriteHeader(http.StatusOK)\n\n  fmt.Println(\"Doing something...\")\n}\n</code></pre>\n"}, {"tags": ["file", "go", "io", "reader"], "answers": [{"comments": [{"owner": {"reputation": 67, "user_id": 8126874, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e495242d2b08ca95225832f8175faa8c?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Piao", "link": "https://stackoverflow.com/users/8126874/jason-piao"}, "edited": false, "score": 0, "creation_date": 1496854417, "post_id": 44418411, "comment_id": 75835863, "body": "Will the length of the byte array equal how many bytes the line is?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 67, "user_id": 8126874, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e495242d2b08ca95225832f8175faa8c?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Piao", "link": "https://stackoverflow.com/users/8126874/jason-piao"}, "edited": false, "score": 0, "creation_date": 1496854911, "post_id": 44418411, "comment_id": 75836125, "body": "Yes. Quoting the documentation I linked from my answer, &quot;ReadBytes reads until the first occurrence of delim in the input, returning a slice containing the data up to and including the delimiter.&quot;"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 0, "last_activity_date": 1496853673, "creation_date": 1496853673, "answer_id": 44418411, "question_id": 44418361, "link": "https://stackoverflow.com/questions/44418361/golang-dynamic-sizing-slice-when-reading-a-file-using-buffo-read/44418411#44418411", "title": "Golang dynamic sizing slice when reading a file using buffo.read", "body": "<p>If you want to read line by line, and you're using a buffered reader, use the buffered reader's <a href=\"https://golang.org/pkg/bufio/#Reader.ReadBytes\" rel=\"nofollow noreferrer\">ReadBytes method</a>.</p>\n\n<pre><code>line,err := reader.ReadBytes('\\n')\n</code></pre>\n\n<p>This will give you a full line, one line at a time, regardless of byte length.</p>\n"}], "owner": {"reputation": 67, "user_id": 8126874, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e495242d2b08ca95225832f8175faa8c?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Piao", "link": "https://stackoverflow.com/users/8126874/jason-piao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1006, "favorite_count": 0, "accepted_answer_id": 44418411, "answer_count": 1, "score": 1, "last_activity_date": 1496853673, "creation_date": 1496853524, "question_id": 44418361, "link": "https://stackoverflow.com/questions/44418361/golang-dynamic-sizing-slice-when-reading-a-file-using-buffo-read", "title": "Golang dynamic sizing slice when reading a file using buffo.read", "body": "<p>I have a problem where, I need to use bufio.read to read a tsv file line by line and I need to record how many bytes each line Ive read is. </p>\n\n<p>The problem is, It seems like I can't just initialize an empty slice and pass it into bufio.read and expect the slice to contain the entire line of the file. </p>\n\n<pre><code>file, _ := os.Open(\"file.tsv\")\n\nreader := bufio.NewReader(file)\n\nb := make([]byte, 10)\nfor {\n    bytesRead, err:= reader.Read(b)\n    fmt.Println(bytesRead, b)\n    if err != nil {\n        break\n    }\n}\n</code></pre>\n\n<p>So, for this example, since I specified the slice to be 10 bytes, the reader will read at most 10 bytes even if the line is bigger than 10 bytes.</p>\n\n<p>However:</p>\n\n<pre><code>file, _ := os.Open(\"file.tsv\")\n\nreader := bufio.NewReader(file)\n\nb := byte{} //or var b []byte\nfor {\n    bytesRead, err:= reader.Read(b)\n    fmt.Println(bytesRead, b)\n    if err != nil {\n        break\n    }\n}\n</code></pre>\n\n<p>This will always read 0 bytes and I assume its because the buffer is length 0 or capacity 0. </p>\n\n<p>How do I read a file Line by line, save the entire line in a variable or buffer, and return exactly how many bytes Ive read?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "unicode", "escaping"], "answers": [{"tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": false, "score": 2, "last_activity_date": 1496853674, "creation_date": 1496853674, "answer_id": 44418412, "question_id": 44418260, "link": "https://stackoverflow.com/questions/44418260/escape-unicode-in-golang/44418412#44418412", "title": "Escape unicode in golang", "body": "<p>Perhaps you can use <a href=\"https://golang.org/pkg/strconv/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote</code></a>? (But be careful... that does more than just replace <code>\\u</code> sequences.)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    input := `processSpecification=Sp\\u00e9cification du processus`\n    fmt.Println(input)\n    fmt.Println(strconv.Unquote(\"\\\"\" + input + \"\\\"\"))\n}\n\n// Output:\n// processSpecification=Sp\\u00e9cification du processus\n// processSpecification=Sp\u00e9cification du processus\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Uq4vIdNyya\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Uq4vIdNyya</a></p>\n"}], "owner": {"reputation": 49, "user_id": 7235552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9ff61a869155e213990b7f9fa23cbefd?s=128&d=identicon&r=PG&f=1", "display_name": "q.b", "link": "https://stackoverflow.com/users/7235552/q-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7341, "favorite_count": 0, "closed_date": 1496856174, "answer_count": 1, "score": 0, "last_activity_date": 1496856224, "creation_date": 1496853130, "question_id": 44418260, "link": "https://stackoverflow.com/questions/44418260/escape-unicode-in-golang", "closed_reason": "Duplicate", "title": "Escape unicode in golang", "body": "<p>I'm trying to read a file containing unicode and display it as normal string:</p>\n\n<p>example.txt</p>\n\n<p>processSpecification=Sp\\u00e9cification du processus</p>\n\n<p>materialDomain=Domaine mat\\u00e9riel</p>\n\n<p>Expected result:</p>\n\n<p>processSpecification=Sp\u00e9cification du processus</p>\n\n<p>materialDomain=Domaine mat\u00e9riel</p>\n\n<p>Actual result:</p>\n\n<p>processSpecification=Sp\\u00e9cification du processus</p>\n\n<p>materialDomain=Domaine mat\\u00e9riel</p>\n\n<p>I foundhow to do this in 5 min in python : \nfor decodedLine in open('Z:\\m1msgcatalog\\PLMVocabulary_ds6w_fr.properties', 'r', encoding='unicode-escape'):\n    print(decodedLine)</p>\n\n<p>but I don't get how to do this in golang</p>\n"}, {"tags": ["go", "count", "maps"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496852339, "post_id": 44417913, "comment_id": 75834679, "body": "In the second example, you keep iterating after you find a match, which is needless if the input is sorted. If <code>row != distinct &amp;&amp; count &gt; 0</code> you can break, because that would be the first non-match after finding a match, and there can&#39;t be any more matches after that if the input is sorted."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496852700, "post_id": 44417913, "comment_id": 75834893, "body": "What&#39;s the purpose of having two arrays? The map already guarantees distinct keys, why not just use that?"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1496864280, "post_id": 44418231, "comment_id": 75841304, "body": "Map access by key is usually O(1) in case of hashmaps."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1496864904, "post_id": 44418231, "comment_id": 75841651, "body": "O(1)... ish? The Go spec makes no statement on performance. I guess I should say &quot;<i>no worse than</i> O(log(n)) for the map access or O(n*log(n)) in total&quot;. Also some of the iterations won&#39;t just be lookups, they&#39;ll be inserts, which tend to take a little longer due to rebalancing etc. Regardless... way faster than O(n^2) for sure."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 7, "last_activity_date": 1496853059, "creation_date": 1496853059, "answer_id": 44418231, "question_id": 44417913, "link": "https://stackoverflow.com/questions/44417913/count-distinct-values-in-array-performance-tips/44418231#44418231", "title": "Count distinct values in array - performance tips", "body": "<p>Without more context, I would dump the separate array of distinct values - generating it takes time, and using it necessitates the nested loop. Assuming there's no other purpose to the second array, I'd use something like:</p>\n\n<pre><code>counter := make( map[string]int )    \nfor _, row := range StrArray {\n    counter[row]++\n} \n</code></pre>\n\n<p>If you need the list of distinct strings without the counts for some separate purpose, you can easily get it afterward:</p>\n\n<pre><code>distinctStrings := make([]string, len(counter))\ni := 0\nfor k := range counter {\n    distinctStrings[i] = k\n    i++\n}\n</code></pre>\n\n<p>Iterating the array of distinct strings is O(n), while map access by key is O(log(n)). That takes your overall from O(n^2) to O(n*log(n)), which should be a significant improvement with larger datasets. But, as with any optimization: test, measure, analyze, optimize.</p>\n"}], "owner": {"reputation": 196, "user_id": 3178094, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/f6791749fbab91811ea3a8bff38dbb86?s=128&d=identicon&r=PG&f=1", "display_name": "mik", "link": "https://stackoverflow.com/users/3178094/mik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3098, "favorite_count": 0, "accepted_answer_id": 44418231, "answer_count": 1, "score": 1, "last_activity_date": 1550062507, "creation_date": 1496852060, "last_edit_date": 1550062507, "question_id": 44417913, "link": "https://stackoverflow.com/questions/44417913/count-distinct-values-in-array-performance-tips", "title": "Count distinct values in array - performance tips", "body": "<p>I'm having some issues optimizing a go map.<br>\nI want to generate a frequency table (count distinct occurrences) in an array of strings. My code holds nicely for small arrays, but as I start working with 100k+ structures -with many distinct values- it just isn't performant enough.</p>\n\n<p>Right now, my approach is to generate an array with the distinct values, compare values and increasing the counter variable (mapped to the string). </p>\n\n<pre><code>    counter := make( map[string]int )    \n    for _, distinct := range distinctStrArray{\n        for _, row := range StrArray{\n            if (row == distinct){\n                counter[distinct]++\n            }  \n        } \n    }\n</code></pre>\n\n<p>I've tried another approach, where with the input array previously sorted (to minimize the number of changes to the map). This is a bit faster. </p>\n\n<pre><code>    count:=0\n    for _, distinct := range distinctStrArray{\n        for _, row := range StrArray{\n            if (row == distinct){\n                count++\n            }  \n        } \n    counter[distinct] += count\n    count= 0\n    } \n</code></pre>\n\n<p>Do you have any suggestion of what I can do to optimize a simple <em>count(distinct)</em> type problem...? I'm open to anything.<br>\nthanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1496848876, "post_id": 44416645, "comment_id": 75832388, "body": "What are &quot;some actions&quot;? Are you seeking back to <code>(0, 0)</code> before calling <code>Truncate</code>? (unrelated, you can&#39;t defer before checking the error, or you&#39;ll panic if there is an error. Also, something that looks like <code>checkError(error)</code> is usually not a good pattern in Go)."}, {"owner": {"reputation": 4842, "user_id": 1226169, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KMGQ4.png?s=128&g=1", "display_name": "Vit Kos", "link": "https://stackoverflow.com/users/1226169/vit-kos"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496859565, "post_id": 44416645, "comment_id": 75838565, "body": "No I wasn&#39;t. Thanks for the hints, very useful for the newcomer to go :)"}], "answers": [{"comments": [{"owner": {"reputation": 4842, "user_id": 1226169, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KMGQ4.png?s=128&g=1", "display_name": "Vit Kos", "link": "https://stackoverflow.com/users/1226169/vit-kos"}, "edited": false, "score": 0, "creation_date": 1496859755, "post_id": 44416790, "comment_id": 75838679, "body": "Good point,  will check this out.  Considered the Truncate function to work similarly to what php does. Guess this is the problem \ud83d\ude0a"}, {"owner": {"reputation": 4842, "user_id": 1226169, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KMGQ4.png?s=128&g=1", "display_name": "Vit Kos", "link": "https://stackoverflow.com/users/1226169/vit-kos"}, "edited": false, "score": 0, "creation_date": 1496904134, "post_id": 44416790, "comment_id": 75854764, "body": "Yeah, this was it! Thanx for the hint."}, {"owner": {"reputation": 485, "user_id": 7813242, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5e24d95f2782513437fe63ffaf8ee19?s=128&d=identicon&r=PG&f=1", "display_name": "wpedrak", "link": "https://stackoverflow.com/users/7813242/wpedrak"}, "edited": false, "score": 0, "creation_date": 1618582756, "post_id": 44416790, "comment_id": 118652941, "body": "On linux, <code>(File).Truncate</code> is backed by <code>syscall.Ftruncate</code> which requires file to be open for write <a href=\"https://linux.die.net/man/2/ftruncate\" rel=\"nofollow noreferrer\">linux.die.net/man/2/ftruncate</a>. What follows, you will get error by calling it on file opened for read only. As an alternative, you can use <code>unix.Truncate(path string, length int64)</code> which only requires file to be writable (it don&#39;t have to be open)."}], "tags": [], "owner": {"reputation": 1511, "user_id": 495504, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ee8d8278b0394be64c52abc8d7c4ca17?s=128&d=identicon&r=PG", "display_name": "Eric Pauley", "link": "https://stackoverflow.com/users/495504/eric-pauley"}, "is_accepted": true, "score": 29, "last_activity_date": 1582914766, "last_edit_date": 1582914766, "creation_date": 1496848949, "answer_id": 44416790, "question_id": 44416645, "link": "https://stackoverflow.com/questions/44416645/how-do-i-truncate-and-completely-rewrite-a-file-without-having-leading-zeros/44416790#44416790", "title": "How do I truncate and completely rewrite a file without having leading zeros?", "body": "<p>See the <a href=\"https://golang.org/pkg/os/#File.Truncate\" rel=\"noreferrer\">documentation on <code>Truncate</code></a>:</p>\n\n<blockquote>\n  <p>Truncate changes the size of the file. <strong>It does not change the I/O offset</strong>. If there is an error, it will be of type *PathError. </p>\n</blockquote>\n\n<p>So you also need to seek to the beginning of the file before you write:</p>\n\n<pre><code>configFile.Truncate(0)\nconfigFile.Seek(0,0)\n</code></pre>\n\n<p>As shorthand, use the flag <code>os.O_TRUNC</code> when calling <code>os.OpenFile</code> to truncate on open.</p>\n"}, {"tags": [], "owner": {"reputation": 22099, "user_id": 828366, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/V8V1N.jpg?s=128&g=1", "display_name": "Francesco Casula", "link": "https://stackoverflow.com/users/828366/francesco-casula"}, "is_accepted": false, "score": 2, "last_activity_date": 1589887156, "creation_date": 1589887156, "answer_id": 61889771, "question_id": 44416645, "link": "https://stackoverflow.com/questions/44416645/how-do-i-truncate-and-completely-rewrite-a-file-without-having-leading-zeros/61889771#61889771", "title": "How do I truncate and completely rewrite a file without having leading zeros?", "body": "<p>I'd like to show an alternative for cases where you may just want to truncate the file, then another option may be the following:</p>\n\n\n\n<pre><code>func truncate(filename string, perm os.FileMode) error {\n    f, err := os.OpenFile(filename, os.O_TRUNC, perm)\n    if err != nil {\n        return fmt.Errorf(\"could not open file %q for truncation: %v\", filename, err)\n    }\n    if err = f.Close(); err != nil {\n        return fmt.Errorf(\"could not close file handler for %q after truncation: %v\", filename, err)\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 4842, "user_id": 1226169, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/KMGQ4.png?s=128&g=1", "display_name": "Vit Kos", "link": "https://stackoverflow.com/users/1226169/vit-kos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12896, "favorite_count": 5, "accepted_answer_id": 44416790, "answer_count": 2, "score": 9, "last_activity_date": 1612763260, "creation_date": 1496848552, "last_edit_date": 1612763260, "question_id": 44416645, "link": "https://stackoverflow.com/questions/44416645/how-do-i-truncate-and-completely-rewrite-a-file-without-having-leading-zeros", "title": "How do I truncate and completely rewrite a file without having leading zeros?", "body": "<p>When truncating a file it seems to be adding additional zero bytes to the start:</p>\n\n<pre><code>configFile, err := os.OpenFile(\"./version.json\", os.O_RDWR, 0666)\ndefer configFile.Close()\ncheck(err)\n//some actions happen here\nconfigFile.Truncate(0)\nconfigFile.Write(js)\nconfigFile.Sync()\n</code></pre>\n\n<p>As a result the file has the contents I write with a section of <code>0</code> bytes at the beginning.</p>\n\n<p>How do I truncate and completely rewrite a file without having leading zeros?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1496845748, "post_id": 44415349, "comment_id": 75829908, "body": "No. What&#39;s wrong with having the slice as normal field in the struct?"}, {"owner": {"reputation": 41, "user_id": 1637116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/585c73949c13592aabb8f2d70f3345b9?s=128&d=identicon&r=PG", "display_name": "pgier", "link": "https://stackoverflow.com/users/1637116/pgier"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496851479, "post_id": 44415349, "comment_id": 75834122, "body": "It just seemed like a common use case to have a list which also has some metadata attached, so I was wondering if there was a shorthand way of writing myItemList.Item[0]."}], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 1637116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/585c73949c13592aabb8f2d70f3345b9?s=128&d=identicon&r=PG", "display_name": "pgier", "link": "https://stackoverflow.com/users/1637116/pgier"}, "edited": false, "score": 0, "creation_date": 1496851731, "post_id": 44415489, "comment_id": 75834291, "body": "Ok, so it looks like the answer to the first question (can you combine struct and slice) is &quot;no&quot;.  And the answer to the second question (recommended way to handle this use case) is just to use a normal struct containing a slice and don&#39;t try to take a shortcut :)"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 4, "last_activity_date": 1496845749, "creation_date": 1496845749, "answer_id": 44415489, "question_id": 44415349, "link": "https://stackoverflow.com/questions/44415349/go-lang-is-it-possible-to-create-a-struct-that-can-also-be-used-as-a-slice/44415489#44415489", "title": "Go lang is it possible to create a struct that can also be used as a slice?", "body": "<p>The recommended thing to do is to simply access the slice as a struct field:</p>\n\n<pre><code>type Item struct {\n    Name string\n}\n\ntype ItemList struct {\n    PackDate time.Time\n    Items    []Item\n}\n</code></pre>\n\n<p>Accessing the values:</p>\n\n<pre><code>myItemList.Items[0].Name\nmyItemList.PackDate\n</code></pre>\n\n<p>Iterating over the slice:</p>\n\n<pre><code>for _, item := range myItemList.Items {\n    // do something with item.Name\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1496846071, "creation_date": 1496846071, "answer_id": 44415620, "question_id": 44415349, "link": "https://stackoverflow.com/questions/44415349/go-lang-is-it-possible-to-create-a-struct-that-can-also-be-used-as-a-slice/44415620#44415620", "title": "Go lang is it possible to create a struct that can also be used as a slice?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Item struct {\n    Name string\n}\n\ntype ItemList struct {\n    PackDate time.Time\n    Items    []Item\n}\n\nfunc main() {\n    list := ItemList{\n        PackDate: time.Now(),\n        Items:    []Item{{Name: \"John\"}, {Name: \"Jane\"}},\n    }\n    fmt.Println(list)\n    fmt.Println(list.PackDate)\n    fmt.Println(list.Items[1].Name)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{2009-11-10 23:00:00 +0000 UTC [{John} {Jane}]}\n2009-11-10 23:00:00 +0000 UTC\nJane\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 1637116, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/585c73949c13592aabb8f2d70f3345b9?s=128&d=identicon&r=PG", "display_name": "pgier", "link": "https://stackoverflow.com/users/1637116/pgier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 44415489, "answer_count": 2, "score": 0, "last_activity_date": 1496846071, "creation_date": 1496845357, "question_id": 44415349, "link": "https://stackoverflow.com/questions/44415349/go-lang-is-it-possible-to-create-a-struct-that-can-also-be-used-as-a-slice", "title": "Go lang is it possible to create a struct that can also be used as a slice?", "body": "<p>Is it possible to have a struct in go that can also be accessed as a slice?\nSo, for example, I'd want something like this:</p>\n\n<pre><code>type Item struct {\n    Name string\n}\n\ntype ItemList struct {\n    PackDate time.Time\n    []Item\n}\n</code></pre>\n\n<p>And then I could access an Item in the ItemList as a slice.</p>\n\n<pre><code>myItemList[0].Name  \n</code></pre>\n\n<p>Or access the members of ItemList in the normal struct way.</p>\n\n<pre><code>myItemList.PackDate\n</code></pre>\n\n<p>If this is not possible, are there any recommended patterns for handling a sort of slice with metadata like this in go? </p>\n"}, {"tags": ["c", "sockets", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1496843561, "post_id": 44414462, "comment_id": 75828071, "body": "Not necessarily related, but you don&#39;t need to allocate a new buffer for every read,. You do need to check <code>nr</code> before you check for <code>io.EOF</code>. Also setting <code>SO_SNDBUF</code> on the Go connection isn&#39;t going to effect the receive buffer. Note that getting the fd from the Go connection dup&#39;ed the file descriptor and put in into blocking mode."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1496843563, "post_id": 44414462, "comment_id": 75828074, "body": "You need to drop the <code>goto</code> statements or improve the logic.  When you get <code>EAGAIN</code> your code will rapidly spin through three of them.  You also never reset <code>poll_count</code>."}, {"owner": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 1, "creation_date": 1496843640, "post_id": 44414462, "comment_id": 75828133, "body": "And <code>write()</code> returns <code>ssize_t</code>, <b>not</b> <code>int</code>."}, {"owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496844027, "post_id": 44414462, "comment_id": 75828450, "body": "@JimB the client does not close the socket after sending the data. Therefore, I&#39;m sending an initial count first and then sending the data from the client to the server. So when I allocate a huge []byte, then the <code>conn.Read</code> blocks, till EOF is received and EOF won&#39;t be received, as the socket won&#39;t be closed. Is other thoughts on this? Regarding <code>SO_SNDBUF</code>, I removed it now."}, {"owner": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 1, "creation_date": 1496844051, "post_id": 44414462, "comment_id": 75828466, "body": "in &#39;C client writing&#39; this statement: <code>buffer += result;</code> should NOT be there.  It causes blocks of data to be skipped during this statement: <code>if ((result = write(fd, &amp;buffer[written], to_write - written)) &lt; 0) {</code>"}, {"owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "reply_to_user": {"reputation": 27420, "user_id": 4756299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e38adc5559df095cfe10c664916e8ffa?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew Henle", "link": "https://stackoverflow.com/users/4756299/andrew-henle"}, "edited": false, "score": 0, "creation_date": 1496844121, "post_id": 44414462, "comment_id": 75828522, "body": "@AndrewHenle I have set the poll timeout to -1, so that I really wait in the poll till the socket becomes available. But my original code was, as you have said, to have timeout as 0 and it did spin rapidly between these three and was thrown out. The <code>poll_count</code> is reset above the while loop, that is missing from what I pasted here."}, {"owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "reply_to_user": {"reputation": 15485, "user_id": 3629249, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000228362830/picture?type=large", "display_name": "user3629249", "link": "https://stackoverflow.com/users/3629249/user3629249"}, "edited": false, "score": 0, "creation_date": 1496844229, "post_id": 44414462, "comment_id": 75828621, "body": "@user3629249 Awesome. That was the problem... ah!! I first added it at the end and then I forgot and added it again at the top. Thanks buddy!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496844251, "post_id": 44414462, "comment_id": 75828643, "body": "@JAamish: you re-allocate <code>tmp</code> on every loop - you don&#39;t need to do that. You could allocate it once, or just read directly into <code>buf</code>. I&#39;m just commenting on the correctness, since you <i>must</i> check <code>nr</code> before you check the error; that&#39;s simply how using an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a> is documented."}, {"owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496844292, "post_id": 44414462, "comment_id": 75828683, "body": "@JimB I&#39;m must check nr for &gt; 0, you mean"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496844327, "post_id": 44414462, "comment_id": 75828724, "body": "@JAamish: yes, that&#39;s correct."}], "answers": [{"tags": [], "owner": {"reputation": 428, "user_id": 8092543, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BOOdr.png?s=128&g=1", "display_name": "sebito91", "link": "https://stackoverflow.com/users/8092543/sebito91"}, "is_accepted": false, "score": 0, "last_activity_date": 1496896960, "last_edit_date": 1496896960, "creation_date": 1496896130, "answer_id": 44426655, "question_id": 44414462, "link": "https://stackoverflow.com/questions/44414462/o-nonblock-sock-stream-limited-to-8192/44426655#44426655", "title": "O_NONBLOCK SOCK_STREAM limited to 8192", "body": "<p>What I would do is read the data straight into a <code>bytes.Buffer</code> similar to the answer listed here:</p>\n\n<p><a href=\"https://stackoverflow.com/a/24343240/8092543\">https://stackoverflow.com/a/24343240/8092543</a></p>\n\n<p><a href=\"https://golang.org/pkg/io/#Copy\" rel=\"nofollow noreferrer\">https://golang.org/pkg/io/#Copy</a></p>\n\n<p>The beauty of the <code>io.Copy</code> is that it consumes a Writer + Reader interface, which are satisfied nicely but your <code>bytes.Buffer</code> (io.Writer) and your <code>conn.Read</code> (io.Reader). Replace your entire block with something like...</p>\n\n<pre><code>var buf bytes.Buffer\ncount, err := io.Copy(buf, conn)\nif err != nil { \n    return nil, fmt.Errorf(\"error during conn read: %v\", err)\n}\n\nreturn buf.Bytes(), nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "is_accepted": false, "score": 0, "last_activity_date": 1496898984, "creation_date": 1496898984, "answer_id": 44427170, "question_id": 44414462, "link": "https://stackoverflow.com/questions/44414462/o-nonblock-sock-stream-limited-to-8192/44427170#44427170", "title": "O_NONBLOCK SOCK_STREAM limited to 8192", "body": "<p>This is normal behaviour. A non-blocking write can only transfer as much data as will fit into the socket send buffer. If you get a short count, you need to either loop or select on writability and retry. A blocking write on the other hand always transfers the entire data.</p>\n\n<p>Setting the send buffer size may not do anything on Unix domain sockets.</p>\n"}], "owner": {"reputation": 415, "user_id": 7844239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5f4592b2e5235c0a47eb851d1a58d942?s=128&d=identicon&r=PG&f=1", "display_name": "J Aamish", "link": "https://stackoverflow.com/users/7844239/j-aamish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1496898984, "creation_date": 1496843102, "last_edit_date": 1496898867, "question_id": 44414462, "link": "https://stackoverflow.com/questions/44414462/o-nonblock-sock-stream-limited-to-8192", "title": "O_NONBLOCK SOCK_STREAM limited to 8192", "body": "<p>I'm writing from c program into a <code>SOCK_STREAM</code> of a Unix Domain Socket that is being listened from a go program, using <code>net.Listen(\"unix\", sockname)</code>. When I set the socket to <code>O_NONBLOCK</code> using <code>fcntl()</code>, I see that the C program writes only 8192 bytes in the first write. After it fails, I monitor and write back the remaining data, but the read data on my server is not valid in this case.</p>\n\n<p>When I do not use <code>O_NONBLOCK</code>, then the whole of 8762 bytes are written in a single write and everything works as expected.</p>\n\n<p><strong>C Client Socket Connection</strong></p>\n\n<pre><code>    if ( (fd = socket(AF_UNIX, SOCK_STREAM, 0)) == -1) {\n        return;\n    }\n   int flags = fcntl(fd, F_GETFL, 0);\n   flags = flags|O_NONBLOCK;\n   fcntl(fd, F_SETFL, flags);\n   ...\n    if (connect(fd, (struct sockaddr*)&amp;addr, sizeof(addr)) == -1) {\n        return;\n    }\n</code></pre>\n\n<p><strong>C Client Writing</strong></p>\n\n<pre><code>        while (written &lt; to_write) {\n            int result;\n            if ((result = write(fd, &amp;buffer[written], to_write - written)) &lt; 0) {\n                if (errno == EINTR) {\n                    continue;\n                }\n                if (errno == EAGAIN) {\n                    struct pollfd pfd = { .fd = fd, .events = POLLOUT };\n                    poll_count++;\n                    if (poll_count &gt; 3) {\n                        goto end;\n                    }\n                    if ((poll(&amp;pfd, 1, -1) &lt;= 0) &amp;&amp; (errno != EAGAIN)) {\n                        goto end;\n                    }\n                    continue;\n                }\nend:\n                return written ? written : result;\n            }\n            written += result;\n            buffer += result;\n        }\n</code></pre>\n\n<p><strong>Go Server Reading</strong></p>\n\n<pre><code>buf := make([]byte, 0, count)\nvar tmpsize int32\nfor {\n    if count &lt;= 0 {\n        break\n    }\n\n    if count &gt; 100 {\n        tmpsize = 100\n    } else {\n        tmpsize = count\n    }\n\n    tmp := make([]byte, tmpsize)\n    nr, err = conn.Read(tmp)\n    if err != nil {\n        return\n    }\n\n    buf = append(buf, tmp[:nr]...)\n    count = count - int32(nr)\n}\n</code></pre>\n\n<p>What am I missing here. I'm running it on OSX. I also tried setting the <code>SO_SNDBUF</code> in the Go Server to 10000, but it does not help</p>\n\n<pre><code>err = syscall.SetsockoptInt(int(fd.Fd()), syscall.SOL_SOCKET, syscall.SO_SNDBUF, 10000)\nif err != nil {\n    return\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go", "go-gorm", "pgbouncer"], "comments": [{"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1496833156, "post_id": 44409920, "comment_id": 75820228, "body": "<a href=\"https://pgbouncer.github.io/faq.html#how-to-use-prepared-statements-with-transaction-pooling\" rel=\"nofollow noreferrer\">pgbouncer.github.io/&hellip;</a> do you use prepared statements?"}, {"owner": {"reputation": 493, "user_id": 6808807, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60101ba596459260ae1bbb9112592965?s=128&d=identicon&r=PG&f=1", "display_name": "M.Mike", "link": "https://stackoverflow.com/users/6808807/m-mike"}, "reply_to_user": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1496838239, "post_id": 44409920, "comment_id": 75823963, "body": "I use <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm</a>  lib as query.It supposed to use prepared statememt,I view the pgbouncer doc.it disabled prepared statements in the client,so if I want to use transaction pooling,I have to try another way?(my english is not well)@Vao Tsun"}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 0, "creation_date": 1496840032, "post_id": 44409920, "comment_id": 75825309, "body": "I suppose. you either use prepared statements. or pooling in session mode"}], "owner": {"reputation": 493, "user_id": 6808807, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60101ba596459260ae1bbb9112592965?s=128&d=identicon&r=PG&f=1", "display_name": "M.Mike", "link": "https://stackoverflow.com/users/6808807/m-mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 389, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1496892971, "creation_date": 1496830887, "last_edit_date": 1496892971, "question_id": 44409920, "link": "https://stackoverflow.com/questions/44409920/query-errors-in-transaction-model-use-with-pgbouncer", "title": "query errors in transaction model use with pgbouncer", "body": "<p>I use pgbouncer as pg  connection pool,if I set pool_mode=Transaction in pgbouncer.ini,my app happens error when query db(app writed with go)\uff1a</p>\n\n<pre><code>(pq: bind message supplies 19 parameters, but prepared statement \"\" requires 20)\n(pq: bind message supplies 22 parameters, but prepared statement \"\" requires 20\n(pq: bind message supplies 22 parameters, but prepared statement \"\" requires 19)\n(pq: bind message supplies 6 parameters, but prepared statement \"\" requires 22)\n</code></pre>\n\n<p>But  I modify pool_mode=Session,It runs ok.\nwhat may be wrong if I set the pool_mode = Transaction .</p>\n"}, {"tags": ["arrays", "go", "byte"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1496830016, "post_id": 44409010, "comment_id": 75817947, "body": "0x10 equals 16; you meant to do <code>\\xA</code>."}, {"owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1496833713, "post_id": 44409010, "comment_id": 75820594, "body": "Yes it&#39;s truth! Thank you @TimCooper"}], "answers": [{"tags": [], "owner": {"reputation": 276, "user_id": 3765983, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f70c742be2770195f6f99ca26f1dd5de?s=128&d=identicon&r=PG&f=1", "display_name": "Heissenberger", "link": "https://stackoverflow.com/users/3765983/heissenberger"}, "is_accepted": false, "score": 3, "last_activity_date": 1496829106, "creation_date": 1496829106, "answer_id": 44409230, "question_id": 44409010, "link": "https://stackoverflow.com/questions/44409010/how-can-i-remove-a-byte-of-type-byte/44409230#44409230", "title": "How can I remove a byte of type []byte", "body": "<p>There is no such built-in method to do this, but you can still do it like this:</p>\n\n<pre><code>cmd := []int{1, 2, 3, 3, 5, 6, 7, 8}\nexpected := cmd[:len(cmd)-1])\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1496833458, "last_edit_date": 1496833458, "creation_date": 1496832761, "answer_id": 44410622, "question_id": 44409010, "link": "https://stackoverflow.com/questions/44409010/how-can-i-remove-a-byte-of-type-byte/44410622#44410622", "title": "How can I remove a byte of type []byte", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc main() {\n    b := []byte{50, 48, 50, 53, 10}\n    fmt.Println(b)\n    b = bytes.TrimSuffix(b, []byte{10}) // Line Feed\n    fmt.Println(b)\n\n    b = []byte{50, 48, 50, 53, 10}\n    fmt.Println(b)\n    b = bytes.TrimSuffix(b, []byte(\"\\n\")) // Line Feed\n    fmt.Println(b)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[50 48 50 53 10]\n[50 48 50 53]\n[50 48 50 53 10]\n[50 48 50 53]\n</code></pre>\n"}], "owner": {"reputation": 251, "user_id": 7923990, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ad61ca14b98f6cde3a7109b252c544c?s=128&d=identicon&r=PG&f=1", "display_name": "icarbajo", "link": "https://stackoverflow.com/users/7923990/icarbajo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 1, "accepted_answer_id": 44410622, "answer_count": 2, "score": 1, "last_activity_date": 1496840075, "creation_date": 1496828561, "last_edit_date": 1496840075, "question_id": 44409010, "link": "https://stackoverflow.com/questions/44409010/how-can-i-remove-a-byte-of-type-byte", "title": "How can I remove a byte of type []byte", "body": "<p>I have a variable <code>cmd</code> that returns <code>[50 48 ... 50 53 10]</code></p>\n\n<p>It's possible to remove any bytes of this var? In my case, I want to remove the last byte [10] == LF (Line Feed) to obtain: <code>[50 48 ... 50 53]</code></p>\n\n<p>P.S.: I have not found any similar question because the function <code>bytes.Trim(cmd, \"\\x10\")</code> does not work for me, or maybe, I don't use it fine...</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "is_accepted": false, "score": 1, "last_activity_date": 1496827044, "creation_date": 1496827044, "answer_id": 44408463, "question_id": 44408089, "link": "https://stackoverflow.com/questions/44408089/not-able-to-fetch-values-from-struct-type-channel-in-go-lang/44408463#44408463", "title": "not able to fetch values from struct type channel in Go lang", "body": "<p>Change:</p>\n\n<pre><code>a, b := &lt;-jobs.id, &lt;-jobs.waitime\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>job := &lt;-jobs\na, b := job.id, job.waitime\n</code></pre>\n\n<p><code>jobs</code> is a channel not a Vertex.</p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 4, "last_activity_date": 1496827161, "creation_date": 1496827161, "answer_id": 44408511, "question_id": 44408089, "link": "https://stackoverflow.com/questions/44408089/not-able-to-fetch-values-from-struct-type-channel-in-go-lang/44408511#44408511", "title": "not able to fetch values from struct type channel in Go lang", "body": "<p>Couple of things are wrong with your code.</p>\n\n<p>First, you can't access struct members directly off the channel. That is, this line is wrong:</p>\n\n<pre><code>a, b := &lt;-jobs.id, &lt;-jobs.waitime\n</code></pre>\n\n<p><code>jobs</code> is a channel. It does not have any members called <code>id</code> or <code>waittime</code>. These are the members of the struct <code>Vertex</code> it's supposed to transfer. Change this line to:</p>\n\n<pre><code>job := &lt;-jobs\na, b := job.id, job.waitime\n</code></pre>\n\n<p>But now, your code declares <code>b</code> but does not use it. To fix, uncomment the call to <code>time.Sleep</code>:</p>\n\n<pre><code>time.Sleep(time.Sleep(time.Duration(b))) !INCORRECT CALL\n</code></pre>\n\n<p>But this call is completely wrong. <code>time.Sleep</code> expects an argument of type <code>time.Duration</code> and returns nothing. To fix, make the following changes:</p>\n\n<pre><code>time.Sleep(time.Duration(b) * time.Millisecond)\n</code></pre>\n\n<p>This should get your code running.</p>\n"}], "owner": {"reputation": 340, "user_id": 6464746, "user_type": "registered", "accept_rate": 22, "profile_image": "https://lh6.googleusercontent.com/-75L-hYPbdcQ/AAAAAAAAAAI/AAAAAAAAAKo/siHtIEA6B0g/photo.jpg?sz=128", "display_name": "Yash Goel", "link": "https://stackoverflow.com/users/6464746/yash-goel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 628, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1496827161, "creation_date": 1496826032, "question_id": 44408089, "link": "https://stackoverflow.com/questions/44408089/not-able-to-fetch-values-from-struct-type-channel-in-go-lang", "title": "not able to fetch values from struct type channel in Go lang", "body": "<p>With reference to <a href=\"https://gobyexample.com/worker-pools\" rel=\"nofollow noreferrer\"> this</a> example, i want to add a pre-defined delay between job initialization and termination. I have stored the data i.e. jobid and waittime in map. Then i have copied the entire map in a channel of same struct type as map. But i am not able to fetch the map values in go routine calls. Please help me, I am new to Go.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Vertex struct {\nid, waitime int\n}\n\nvar m = map[int]Vertex{\n1:  {1, 1000},\n2:  {2, 2000},\n3:  {3, 1000},\n4:  {4, 2000},\n5:  {5, 1000},\n6:  {6, 2000},\n7:  {7, 1000},\n8:  {8, 2000},\n9:  {9, 1000},\n10: {10, 2000},\n}\n\nfunc worker(w int, jobs &lt;-chan Vertex, results chan&lt;- int) {\nfor j := 1; j &lt;= len(m); j++ {\n    a, b := &lt;-jobs.id, &lt;-jobs.waitime\n    fmt.Println(\"worker\", w, \"started job\", a)\n    //time.Sleep(time.Sleep(time.Duration(b)))\n    fmt.Println(\"worker\", w, \"finished job\", a)\n    results &lt;- j * 2\n  }\n}\n\nfunc main() {\n//n := 5\njobs := make(chan Vertex, 100)\nresults := make(chan int, 100)\n\nfor w := 1; w &lt;= 5; w++ {\n    go worker(w, jobs, results)\n}\nfmt.Println(len(m))\nfor j := 1; j &lt;= len(m); j++ {\n    jobs &lt;- m[j]\n}\n//close(jobs)\n\nfor a := 1; a &lt;= len(m); a++ {\n    &lt;-results\n}\n}\n</code></pre>\n"}, {"tags": ["file", "go", "path"], "answers": [{"comments": [{"owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "edited": false, "score": 0, "creation_date": 1496860821, "post_id": 44412248, "comment_id": 75839261, "body": "os.SameFile seems like exactly what I&#39;m looking for! Thanks for the working code - I&#39;m not sure I need something that sophisticated but this looks like a good approach nonetheless."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 1, "last_activity_date": 1496838241, "last_edit_date": 1496838241, "creation_date": 1496837347, "answer_id": 44412248, "question_id": 44407006, "link": "https://stackoverflow.com/questions/44407006/determine-if-path-is-inside-another-path-in-go/44412248#44412248", "title": "Determine if path is inside another path in Go", "body": "<p>IMHO, path handling is rather complicated if you want to support all platforms that is supported by <code>golang</code>. Bellow is the solution that I've implemented so far (probably not the simplest one). Notes:</p>\n\n<ol>\n<li>It supports generalized action rather than only <code>os.Remove</code></li>\n<li>Instead of string-based path comparison, function <a href=\"https://golang.org/pkg/os/#SameFile\" rel=\"nofollow noreferrer\"><code>os.SameFile</code></a> is used to test whether two files/directories are equal. </li>\n<li>In the implementation, at first all candidate paths are visited and added to <code>visitedPaths</code> slice. Then, if no error occurs, an <code>action</code> is perform to each candidate path.</li>\n</ol>\n\n<p><a href=\"https://gist.github.com/ipsusila/7b1a7ae180f80b5db426cae8a51f465e\" rel=\"nofollow noreferrer\">The code</a>:</p>\n\n<pre><code>package pathwalker\n\nimport (\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\ntype PathAction func(PathInfo) error\ntype PathInfo struct {\n    FileInfo os.FileInfo\n    FullPath string\n}\ntype PathWalker struct {\n    pathName     string\n    basePath     string\n    visitedPaths []PathInfo\n    lastFi       os.FileInfo\n}\n\n//NewPathWalker creates PathWalker instance\nfunc NewPathWalker(pathName, basePath string) *PathWalker {\n    return &amp;PathWalker{\n        pathName: pathName,\n        basePath: basePath,\n    }\n}\n\nfunc (w *PathWalker) visit() (bool, error) {\n    //Make sure path ends with separator\n    basePath := filepath.Clean(w.basePath + string(filepath.Separator))\n    baseInfo, err := os.Lstat(basePath)\n    if err != nil {\n        return false, err\n    }\n\n    //clean path name\n    fi, err := os.Lstat(w.pathName)\n    if err != nil {\n        return false, err\n    } else if fi.IsDir() {\n        //When pathname is a directory, remove latest separator\n        sep := string(filepath.Separator)\n        cleanPath := filepath.Clean(w.pathName + sep)\n        w.pathName = strings.TrimRight(cleanPath, sep)\n    } else {\n        w.pathName = filepath.Clean(w.pathName)\n    }\n    return w.doVisit(w.pathName, baseInfo)\n}\n\n//visit path recursively\nfunc (w *PathWalker) doVisit(pathName string, baseInfo os.FileInfo) (bool, error) {\n    //Get file info\n    fi, err := os.Lstat(pathName)\n    if err != nil {\n        return false, err\n    }\n\n    //Stop when basePath equal to pathName\n    if os.SameFile(fi, baseInfo) {\n        return true, nil\n    }\n\n    //Top directory reached, but does not match baseInfo\n    if w.lastFi != nil &amp;&amp; os.SameFile(w.lastFi, fi) {\n        return false, nil\n    }\n    w.lastFi = fi\n\n    //Append to visited path list\n    w.visitedPaths = append(w.visitedPaths, PathInfo{fi, pathName})\n\n    //Move to upper path\n    up := filepath.Dir(pathName)\n    if up == \".\" {\n        return false, nil\n    }\n\n    //Visit upper directory\n    return w.doVisit(up, baseInfo)\n}\n\n//Walk perform action then return number of proceed paths and error\nfunc (w *PathWalker) Walk(act PathAction) (int, error) {\n    n := 0\n    ok, err := w.visit()\n    if err != nil {\n        return 0, err\n    } else if ok &amp;&amp; act != nil {\n        for _, pi := range w.visitedPaths {\n            err := act(pi)\n            if err != nil {\n                return n, err\n            }\n            n++\n        }\n    }\n    return n, nil\n}\n\n//VisitedPaths return list of visited paths\nfunc (w *PathWalker) VisitedPaths() []PathInfo {\n    return w.visitedPaths\n}\n</code></pre>\n\n<p>Then if you want to remove file and parent directory under <code>basePath</code>, you can do:</p>\n\n<pre><code>func remove(pathName, basePath string) {\n    act := func(p pathwalker.PathInfo) error {\n        if p.FileInfo.IsDir() {\n            fmt.Printf(\"  Removing directory=%s\\n\", p.FullPath)\n            return os.Remove(p.FullPath)\n        }\n\n        fmt.Printf(\"  Removing file=%s\\n\", p.FullPath)\n        return os.Remove(p.FullPath)\n    }\n\n    pw := pathwalker.NewPathWalker(pathName, basePath)\n    n, err := pw.Walk(act)\n    fmt.Printf(\"Removed: %d/%d, err=%v\\n\", n, len(pw.VisitedPaths()), err)\n}\n</code></pre>\n\n<p>If you just want to test whether a path is inside another path, you can do:</p>\n\n<pre><code>n, err := pathwalker.NewPathWalker(fileName, basePath).Walk(nil)\nif n &gt; 0 &amp;&amp; err != nil {\n    //is inside another path\n}\n</code></pre>\n"}], "owner": {"reputation": 8698, "user_id": 961810, "user_type": "registered", "accept_rate": 69, "profile_image": "https://lh3.googleusercontent.com/-sx37srgARV4/AAAAAAAAAAI/AAAAAAAAAhw/XUlBN6N5Y6E/photo.jpg?sz=128", "display_name": "Brad Peabody", "link": "https://stackoverflow.com/users/961810/brad-peabody"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 996, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496838241, "creation_date": 1496822867, "question_id": 44407006, "link": "https://stackoverflow.com/questions/44407006/determine-if-path-is-inside-another-path-in-go", "title": "Determine if path is inside another path in Go", "body": "<p>I would like to delete all path components for a file up to (but not including) an overall base directory.</p>\n\n<p>Example:\n/overall/basedir/a/b/c/file</p>\n\n<p>I want to remove \"file\" and then remove \"c\", \"b\" and then \"a\" if possible (directories not empty).  I do <em>not</em> want to unlink \"basedir\" or \"overall\".</p>\n\n<p>filepath.HasPrefix would seem to be a good option but it's apparently deprecated: <a href=\"https://golang.org/pkg/path/filepath/#HasPrefix\" rel=\"nofollow noreferrer\">https://golang.org/pkg/path/filepath/#HasPrefix</a></p>\n\n<p>What I have now is:</p>\n\n<pre><code>p := THEPATH\n\n// attempt to remove file and all parent directories up to the basedir\n// FIXME: HasPrefix is apparently bad.. a better idea?\nfor filepath.HasPrefix(p, baseDir) {\n    err := os.Remove(p)\n    if err != nil {\n        break\n    }\n    // climb up one\n    p = filepath.Dir(p)\n}\n</code></pre>\n\n<p>Looking for a succinct and reliable way that works on all Go supported platforms.</p>\n"}, {"tags": ["go", "scanf"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496828640, "post_id": 44406814, "comment_id": 75816904, "body": "I think it is quite difficult to implement the scanner (even your own) for example when the struct has a <code>string</code> member, since the <code>(S)printf</code> will not escape the value. As an example, the <code>struct {s string}{&quot; f:3&quot;}</code>, will be printed as <code>{s: f:3}</code>, which is the same as the printed version of <code>struct{s string, f int}{&quot;&quot;, 3}</code> (comma is added in the <code>struct</code> for clarity)."}], "answers": [{"comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1496857642, "post_id": 44417475, "comment_id": 75837562, "body": "Sure, json was my first option, but that part is somewhat performance-sensitive, so I ended up using <a href=\"https://golang.org/pkg/encoding/gob/\" rel=\"nofollow noreferrer\"><code>gob</code></a>."}], "tags": [], "owner": {"reputation": 1511, "user_id": 495504, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ee8d8278b0394be64c52abc8d7c4ca17?s=128&d=identicon&r=PG", "display_name": "Eric Pauley", "link": "https://stackoverflow.com/users/495504/eric-pauley"}, "is_accepted": false, "score": 2, "last_activity_date": 1496850761, "creation_date": 1496850761, "answer_id": 44417475, "question_id": 44406814, "link": "https://stackoverflow.com/questions/44406814/fmt-sscanf-for-structs/44417475#44417475", "title": "fmt.Sscanf for structs", "body": "<p>Unfortunately the <code>fmt</code> package doesn't produce strictly parseable output. Thankfully go has other packages for marshaling data which should be just as easy to use.</p>\n\n<p>I'd recommend <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json</code></a> for something simple:</p>\n\n<pre><code>s, err := json.Marshal(data)\n// Check err\nerr = json.Unmarshal(s, data)\n</code></pre>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json</code></a> will produce output which is somewhat similar to printf, but conforming to a standard which ensures it can be parsed. If your goal is to parse data that exists only in <code>Printf</code>'d form you may be out of luck.</p>\n"}], "owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 607, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496850761, "creation_date": 1496822346, "question_id": 44406814, "link": "https://stackoverflow.com/questions/44406814/fmt-sscanf-for-structs", "title": "fmt.Sscanf for structs", "body": "<p>I have data which was previously serialized as <code>fmt.Sprintf(\"%+v\", d)</code>, <code>d</code> being a <code>struct</code> instance. Is there a way to scan it back? My naive attempt of using <code>fmt.Sscanf()</code> below is failing (<a href=\"https://play.golang.org/p/AfscLorFFG\" rel=\"nofollow noreferrer\">Go Playground</a>).</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype data struct {\n    f int\n}\n\nfunc main() {\n    x := data{1}\n    s := fmt.Sprintf(\"%+v\", x)\n    var y data\n    n, err := fmt.Sscanf(s, \"%+v\", &amp;y)\n    fmt.Printf(\"s=%s, n=%d, err=%+v, y=%+v\\n\", s, n, err, y)\n}\n</code></pre>\n\n<p>The output is:</p>\n\n<pre><code>s={f:1}, n=0, err=can't scan type: *main.data, y={f:0}\n</code></pre>\n\n<p>Is there a way to scan the struct back?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1496824711, "creation_date": 1496824711, "answer_id": 44407622, "question_id": 44406213, "link": "https://stackoverflow.com/questions/44406213/cant-put-value-into-map/44407622#44407622", "title": "Can&#39;t put value into map", "body": "<p>The problem is related to the type of <code>children</code> map. You are using <code>node</code> values in this map. As a result, you get new values every time you access a key and the changes are not reflected into the original 'parent' node.</p>\n\n<p>The fault lies with this line:</p>\n\n<pre><code>child, ok := mm[v]\n</code></pre>\n\n<p><code>child</code> is a <em>new variable</em> that is equal to the value of <code>node</code> <code>mm[v]</code>. The changes you make happen to this value while the <code>node</code> value in <code>mm</code> remains unchanged.</p>\n\n<p>To fix this problem, you can use <code>*node</code> for values in <code>children</code>:</p>\n\n<pre><code>type node struct {\n    end      bool\n    char     string\n    children map[int32]*node\n}\n</code></pre>\n\n<p>And fix the code accordingly:</p>\n\n<pre><code>// ...\nmm := current.children\nif nil == mm {\n    mm = make(map[int32]*node)\n    current.children = mm\n}\nchild, ok := mm[v]\nif !ok {\n    child = &amp;node{false, string(v), nil}\n    mm[v] = child\n}\ncurrent = child\n// ...\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/XcmPY4Nx-O\" rel=\"nofollow noreferrer\">https://play.golang.org/p/XcmPY4Nx-O</a></p>\n"}], "owner": {"reputation": 309, "user_id": 2865969, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/9xeMy.png?s=128&g=1", "display_name": "Pitty", "link": "https://stackoverflow.com/users/2865969/pitty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 44407622, "answer_count": 1, "score": 1, "last_activity_date": 1496824711, "creation_date": 1496820523, "question_id": 44406213, "link": "https://stackoverflow.com/questions/44406213/cant-put-value-into-map", "title": "Can&#39;t put value into map", "body": "<p>I just learn golang, and want to build an struct like this.</p>\n\n<pre><code>{end:false map[\"h\":{false \"h\" map[\"e\":{true \"e\" map[]}]}\n           \"s\":{false \"s\" map[\"h\":{false \"h\" map[\"e\":{true \"e\" map[]}]}]}\n]}\n</code></pre>\n\n<p>Follow is the code I write:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\ntype node struct {\n    end      bool\n    char     string\n    children map[int32]node\n}\n\nfunc addKeyword(root *node, key string) {\n    current := root\n    for _, v := range key {\n        mm := current.children\n        if nil == mm || len(mm) == 0 {\n            mm = make(map[int32]node)\n            current.children = mm\n        }\n        child, ok := mm[v]\n        if !ok {\n            child = node{false, string(v), nil}\n            mm[v] = child\n        }\n        current = &amp;child\n    }\n    current.end = true\n}\n\nfunc main() {\n    root := new(node)\n    addKeyword(root, \"he\")\n    addKeyword(root, \"she\")\n    fmt.Println(root)\n}\n</code></pre>\n\n<p>I get result is:</p>\n\n<pre><code>{end:false map[\"h\":{false \"h\" map[]}\n           \"s\":{false \"s\" map[]}\n]}\n</code></pre>\n\n<p>I don't know why second level struct not append to root object.</p>\n"}, {"tags": ["pointers", "go", "casting", "type-conversion"], "answers": [{"comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1496821520, "post_id": 44406439, "comment_id": 75811965, "body": "This works and it&#39;s the method I am using while I was waiting for an answer, but my linter is giving me a message saying <code>call of Connection copies lock value ssh.Client</code>"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1496821686, "post_id": 44406439, "comment_id": 75812073, "body": "What line is it complaining about?"}, {"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1496821856, "post_id": 44406439, "comment_id": 75812177, "body": "<a href=\"https://play.golang.org/p/dY3xcXpHif\" rel=\"nofollow noreferrer\">play.golang.org/p/dY3xcXpHif</a> Lines 23 and 28  Or in your example, the <code>SendCommand()</code> line"}, {"owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "reply_to_user": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1496850327, "post_id": 44406439, "comment_id": 75833371, "body": "But that code differs in important ways (e.g. doesn&#39;t take a pointer to <code>SendCommand</code>)."}], "tags": [], "owner": {"reputation": 54533, "user_id": 94559, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ab13b7f135315a91b9ef13e073354d90?s=128&d=identicon&r=PG&f=1", "display_name": "user94559", "link": "https://stackoverflow.com/users/94559/user94559"}, "is_accepted": false, "score": 1, "last_activity_date": 1496821143, "creation_date": 1496821143, "answer_id": 44406439, "question_id": 44406077, "link": "https://stackoverflow.com/questions/44406077/golang-invalid-receiver-type-in-method-func/44406439#44406439", "title": "Golang Invalid Receiver Type in Method Func", "body": "<p>This is the best I can come up with:</p>\n\n<pre><code>type Connection ssh.Client\n\nfunc (conn *Connection) SendCommand() ([]byte, error) {\n    (*ssh.Client)(conn).NewSession()\n</code></pre>\n\n<p>Note that I've changed the type to <em>not</em> be a pointer type (but then I've made a pointer receiver for <code>SendCommand</code>). I'm not sure there's any way to create a function with a pointer type as a receiver.</p>\n"}, {"comments": [{"owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "edited": false, "score": 0, "creation_date": 1496853872, "post_id": 44412899, "comment_id": 75835584, "body": "Works perfectly. <code>return Connection{conn}, nil</code> should be changed to <code>return &amp;Connection{conn}, nil</code>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 27, "last_activity_date": 1496854372, "last_edit_date": 1496854372, "creation_date": 1496839182, "answer_id": 44412899, "question_id": 44406077, "link": "https://stackoverflow.com/questions/44406077/golang-invalid-receiver-type-in-method-func/44412899#44412899", "title": "Golang Invalid Receiver Type in Method Func", "body": "<p>You can't declare a new type with a pointer TypeSpec. Also declaring a new type is used specifically to remove the entire method set, so you won't have any of the original methods from the <code>*ssh.Client</code>.</p>\n\n<p>What you want is to use composition by embedding the <code>*ssh.Client</code> in your own struct type:</p>\n\n<pre><code>type Connection struct {\n    *ssh.Client\n}\n\nfunc Connect(addr, user, password string) (*Connection, error) {\n    sshConfig := &amp;ssh.ClientConfig{\n        User: user,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(password),\n        },\n        HostKeyCallback: ssh.HostKeyCallback(func(hostname string, remote net.Addr, key ssh.PublicKey) error { return nil }),\n    }\n\n    conn, err = ssh.Dial(\"tcp\", addr, sshConfig)\n    if err != nil {\n        return nil, err\n    }\n\n    return &amp;Connection{conn}, nil\n}\n\nfunc (conn *Connection) SendCommand() ([]byte, error) {\n    session, err := conn.NewSession()\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 3063057, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4e990fb637e35fe5d61f795bec01542?s=128&d=identicon&r=PG&f=1", "display_name": "Shiva1978", "link": "https://stackoverflow.com/users/3063057/shiva1978"}, "is_accepted": false, "score": 1, "last_activity_date": 1596917283, "creation_date": 1596917283, "answer_id": 63319792, "question_id": 44406077, "link": "https://stackoverflow.com/questions/44406077/golang-invalid-receiver-type-in-method-func/63319792#63319792", "title": "Golang Invalid Receiver Type in Method Func", "body": "<p>Another option is to use type aliasing to achieve the desired behavior.  I was trying to do something &quot;clever&quot; for readability:</p>\n<pre><code>type foo struct {\n    i int\n}\n\ntype foo_ptr = *foo\n\ntype foo_ptr_slice = []foo_ptr\ntype foo_ptr_map = map[string]foo_ptr\ntype foo_ptr_slice_map = map[string]foo_ptr_slice\n\nfunc (r foo_ptr) dump() {\n    fmt.Printf(&quot;%d\\n&quot;, r.i)\n}\n\nfunc main() {\n    // need a map of slice of pointers\n    var m foo_ptr_map\n\n    m = make(foo_ptr_map, 0)\n\n    m[&quot;test&quot;] = &amp;foo{i: 1}\n\n    var m2 foo_ptr_slice_map\n\n    m2 = make(foo_ptr_slice_map, 0)\n    m2[&quot;test&quot;] = make(foo_ptr_slice, 0, 10)\n\n    m2[&quot;test&quot;] = append(m2[&quot;test&quot;], &amp;foo{i: 2})\n\n    fmt.Printf(&quot;%d\\n&quot;, m[&quot;test&quot;].i)\n    fmt.Printf(&quot;%d\\n&quot;, m2[&quot;test&quot;][0].i)\n    m[&quot;test&quot;].dump()\n}\n</code></pre>\n<p>I acknowledge that type aliasing is used for large-scale refactoring but this seems like a very good use for readability sake.</p>\n"}], "owner": {"reputation": 8073, "user_id": 4988637, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/aXgMC.jpg?s=128&g=1", "display_name": "Acidic9", "link": "https://stackoverflow.com/users/4988637/acidic9"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15078, "favorite_count": 2, "accepted_answer_id": 44412899, "answer_count": 3, "score": 8, "last_activity_date": 1596917283, "creation_date": 1496820122, "question_id": 44406077, "link": "https://stackoverflow.com/questions/44406077/golang-invalid-receiver-type-in-method-func", "title": "Golang Invalid Receiver Type in Method Func", "body": "<p>I'm trying to make a simple package to send SSH commands to a server.</p>\n\n<p>I have the following code:</p>\n\n<pre><code>type Connection *ssh.Client\n\nfunc Connect(addr, user, password string) (conn Connection, err error) {\n    sshConfig := &amp;ssh.ClientConfig{\n        User: user,\n        Auth: []ssh.AuthMethod{\n            ssh.Password(password),\n        },\n        HostKeyCallback: ssh.HostKeyCallback(func(hostname string, remote net.Addr, key ssh.PublicKey) error { return nil }),\n    }\n\n    conn, err = ssh.Dial(\"tcp\", addr, sshConfig)\n    return\n}\n\nfunc (conn Connection) SendCommand() ([]byte, error) {\n    session, err := (*ssh.Client)(conn).NewSession()\n    // ...\n}\n</code></pre>\n\n<p>My problem is on the two lines <code>func (conn Connection) SendCommand() ([]byte, error)</code> and <code>session, err := (*ssh.Client)(conn).NewSession()</code>.</p>\n\n<p>I can't figure out how to use the methods available for <code>*ssh.Client</code> from my overlaying <code>Connection</code> type.</p>\n\n<p>I understand that I need to do some conversion, and using <code>ssh.Client(*conn).NewSession()</code> would work, but it copies the values of the <code>*ssh.Client</code> which doesn't seem to be the right method.</p>\n\n<p>What should do to access the methods available for a <code>*ssh.Client</code> when working with my custom <code>type Connection *ssh.Client</code> type?</p>\n"}, {"tags": ["go", "vim"], "answers": [{"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506685567, "post_id": 44405401, "comment_id": 79930667, "body": "There are a bunch of ways to just prevent the file from loading. There&#39;s no need to move or remove any files."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1496817988, "creation_date": 1496817988, "answer_id": 44405401, "question_id": 44404052, "link": "https://stackoverflow.com/questions/44404052/how-to-turn-off-all-vim-settings-for-golang/44405401#44405401", "title": "how to turn off all vim settings for golang?", "body": "<p>Considering that <a href=\"http://vimdoc.sourceforge.net/htmldoc/syntax.html\" rel=\"nofollow noreferrer\">the vim documentation</a> states</p>\n\n<blockquote>\n  <p>The syntax and highlighting commands for one language are normally stored in\n  a syntax file.<br>\n  The name convention is: \"<code>{name}.vim</code>\".  Where <code>{name}</code> is the\n  name of the language, or an abbreviation</p>\n</blockquote>\n\n<p>If you can find a <code>go.vim</code> file (<a href=\"https://github.com/fatih/vim-go/blob/master/syntax/go.vim\" rel=\"nofollow noreferrer\">similar to this one</a>) and delete it (or move it), that should disable the syntax highlighting just for Go.</p>\n"}, {"comments": [{"owner": {"reputation": 259, "user_id": 6398020, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2fc9cc1619a0b712df3032f6b9772c2a?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio", "link": "https://stackoverflow.com/users/6398020/mauricio"}, "edited": false, "score": 1, "creation_date": 1496856255, "post_id": 44414567, "comment_id": 75836817, "body": "Thanks that was what i needed"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1506685543, "post_id": 44414567, "comment_id": 79930657, "body": "You can also set <code>b:current_syntax</code> to prevent loading the file, or use <code>hi clear</code>. This has the advantage that you can stll add some syntax later on if you want."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1496843386, "creation_date": 1496843386, "answer_id": 44414567, "question_id": 44404052, "link": "https://stackoverflow.com/questions/44404052/how-to-turn-off-all-vim-settings-for-golang/44414567#44414567", "title": "how to turn off all vim settings for golang?", "body": "<p>Add the following line to your <a href=\"http://vimhelp.appspot.com/starting.txt.html#vimrc\" rel=\"nofollow noreferrer\">vimrc</a> file:</p>\n\n<pre><code>autocmd FileType go setlocal syntax=OFF\n</code></pre>\n"}], "owner": {"reputation": 259, "user_id": 6398020, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2fc9cc1619a0b712df3032f6b9772c2a?s=128&d=identicon&r=PG&f=1", "display_name": "Mauricio", "link": "https://stackoverflow.com/users/6398020/mauricio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 220, "favorite_count": 1, "accepted_answer_id": 44414567, "answer_count": 2, "score": 1, "last_activity_date": 1496843386, "creation_date": 1496812561, "last_edit_date": 1496818174, "question_id": 44404052, "link": "https://stackoverflow.com/questions/44404052/how-to-turn-off-all-vim-settings-for-golang", "title": "how to turn off all vim settings for golang?", "body": "<p>How could I turn off syntax highlighting in vim, but only for Go?  </p>\n\n<p>I've seen a few posts about just turning off the red-highlighting for white space but that's not quite what I'm looking for. </p>\n"}, {"tags": ["json", "go", "marshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1496802963, "post_id": 44402160, "comment_id": 75804810, "body": "Here&#39;s an approximation in the playground: <a href=\"https://play.golang.org/p/9R9Yo8IemD\" rel=\"nofollow noreferrer\">play.golang.org/p/9R9Yo8IemD</a>  It works as expected.  Does MarshalIndent return an error?"}, {"owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1496804376, "post_id": 44402160, "comment_id": 75805159, "body": "Good approximation. No, MashalIndent does not return an error."}, {"owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1496811643, "post_id": 44402160, "comment_id": 75806895, "body": "So, I&#39;m currently passing in a *CreateInstance. When I deref it, it works."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496842469, "post_id": 44402160, "comment_id": 75827260, "body": "No, this is more like what&#39;s happening: <a href=\"https://play.golang.org/p/6RCsQ3AM03\" rel=\"nofollow noreferrer\">play.golang.org/p/6RCsQ3AM03</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "edited": false, "score": 0, "creation_date": 1496863408, "post_id": 44414202, "comment_id": 75840779, "body": "Hey thank you! Unfortunately, trying to &quot;compose them in a different manner&quot; is a bit difficult since we want to expose a JSON config schema to users. Embedding is nicer than an inner compute.Instance instance or pointer in the JSON config, since an inner compute.Instance would require a nested object."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1496842378, "creation_date": 1496842378, "answer_id": 44414202, "question_id": 44402160, "link": "https://stackoverflow.com/questions/44402160/go-json-marshalling-nested-struct-incorrectly-omitting-outer-fields/44414202#44414202", "title": "Go: JSON marshalling nested struct; incorrectly omitting outer fields", "body": "<p>A <code>compute.Instance</code> is a <code>json.Marshaler</code>, so by embedding that type you are in essence giving your <code>CreateInstance</code> the <code>MarshalJSON</code> method from <code>compute.Instance</code>, which of course isn't going to output any of the fields in your <code>CreateInstance</code> struct.</p>\n\n<p>You could define your own <code>MarshalJSON</code> method, and try to marshal the <code>Instance</code> manually or re-assign it to a new type that will use the default json output, but the API may be relying on the internal <code>MarshalJSON</code> behavior, so that's not guaranteed to be compatible, currently or with future versions.</p>\n\n<p>Embedding types for json marshaling is is best avoided because it's all too easy to create confusing bugs like this. I would try to compose them in a different manner.</p>\n"}], "owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 44414202, "answer_count": 1, "score": 0, "last_activity_date": 1496842378, "creation_date": 1496799650, "last_edit_date": 1496839239, "question_id": 44402160, "link": "https://stackoverflow.com/questions/44402160/go-json-marshalling-nested-struct-incorrectly-omitting-outer-fields", "title": "Go: JSON marshalling nested struct; incorrectly omitting outer fields", "body": "<p>I'm trying to marshal nested structs. See a NON-FUNCTIONING example <a href=\"https://play.golang.org/p/7TeQO2pWsx\" rel=\"nofollow noreferrer\">here</a> (I can't import \"compute\" and \"pretty\" in the Go playground, but I've recreated my test logic and pasted the output).</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n\n    \"github.com/kylelemons/godebug/pretty\"\n    compute \"google.golang.org/api/compute/v1\"\n)\n\ntype CreateInstance struct {\n    compute.Instance\n\n    // Additional metadata to set for the instance.\n    Metadata map[string]string `json:\"metadata,omitempty\"`\n    // OAuth2 scopes to give the instance. If none are specified\n    // https://www.googleapis.com/auth/devstorage.read_only will be added.\n    Scopes []string `json:\",omitempty\"`\n\n    // StartupScript is the Sources path to a startup script to use in this step.\n    // This will be automatically mapped to the appropriate metadata key.\n    StartupScript string `json:\",omitempty\"`\n    // Project to create the instance in, overrides workflow Project.\n    Project string `json:\",omitempty\"`\n    // Zone to create the instance in, overrides workflow Zone.\n    Zone string `json:\",omitempty\"`\n    // Should this resource be cleaned up after the workflow?\n    NoCleanup bool\n    // Should we use the user-provided reference name as the actual resource name?\n    ExactName bool\n\n    // The name of the disk as known internally to Daisy.\n    daisyName string\n}\n\nfunc main() {\n    ci := &lt;a *CreateInstance part of a larger data structure&gt;\n    j, _ := json.MarshalIndent(ci, \"\", \"  \")\n    fmt.Println(string(j))\n    pretty.Print(ci)  # Pretty prints the struct.\n}\n\n\n##### OUTPUT #####\n{\n  \"disks\": [\n    {\n      \"source\": \"disk\"\n    }\n  ],\n  \"machineType\": \"${machine_type}\",\n  \"name\": \"${instance_name}\"\n}\n{Instance:      {CanIpForward:      false,\n                 CpuPlatform:       \"\",\n                 CreationTimestamp: \"\",\n                 Description:       \"\",\n                 Disks:             [{AutoDelete:        false,\n                                      Boot:              false,\n                                      DeviceName:        \"\",\n                                      DiskEncryptionKey: nil,\n                                      Index:             0,\n                                      InitializeParams:  nil,\n                                      Interface:         \"\",\n                                      Kind:              \"\",\n                                      Licenses:          [],\n                                      Mode:              \"\",\n                                      Source:            \"disk\",\n                                      Type:              \"\",\n                                      ForceSendFields:   [],\n                                      NullFields:        []}],\n                 Id:                0,\n                 Kind:              \"\",\n                 MachineType:       \"${machine_type}\",\n                 Metadata:          nil,\n                 Name:              \"${instance_name}\",\n                 NetworkInterfaces: [],\n                 Scheduling:        nil,\n                 SelfLink:          \"\",\n                 ServiceAccounts:   [],\n                 Status:            \"\",\n                 StatusMessage:     \"\",\n                 Tags:              nil,\n                 Zone:              \"\",\n                 ServerResponse:    {HTTPStatusCode: 0,\n                                     Header:         {}},\n                 ForceSendFields:   [],\n                 NullFields:        []},\n Metadata:      {},\n Scopes:        [],\n StartupScript: \"\",\n Project:       \"\",\n Zone:          \"\",\n NoCleanup:     false,\n ExactName:     false}\n</code></pre>\n\n<p>Basically, I have a struct, CreateInstance, that embeds an Instance struct from the <a href=\"https://godoc.org/google.golang.org/api/compute/v1#Instance\" rel=\"nofollow noreferrer\">Google Compute Engine API client lib</a>. CreateInstance also has two bool fields with no JSON tags, ExactName and NoCleanup.</p>\n\n<p>When I try to marshal a CreateInstance, ExactName and NoCleanup are omitted, be they true or false.</p>\n"}, {"tags": ["ssl", "go", "websocket", "openssl", "tls1.2"], "comments": [{"owner": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1496797200, "post_id": 44401356, "comment_id": 75803472, "body": "<b><i><code>CN=www.example.com</code></i></b> is probably wrong. Hostnames always go in the <i>SAN</i>. If its present in the <i>CN</i>, then it must be present in the <i>SAN</i> too (you have to list it twice in this case). For more rules and reasons, see <a href=\"http://stackoverflow.com/a/21340898/608639\">How do you sign Certificate Signing Request with your Certification Authority</a> and <a href=\"http://stackoverflow.com/q/10175812/608639\">How to create a self-signed certificate with openssl?</a> You will also need to place the self-signed certificate in the appropriate trust store."}, {"owner": {"reputation": 8175, "user_id": 376742, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/314c5e634c0b24fd63b70bf62a83f4cc?s=128&d=identicon&r=PG", "display_name": "ssk", "link": "https://stackoverflow.com/users/376742/ssk"}, "reply_to_user": {"reputation": 82953, "user_id": 608639, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/aPIhh.jpg?s=128&g=1", "display_name": "jww", "link": "https://stackoverflow.com/users/608639/jww"}, "edited": false, "score": 0, "creation_date": 1496898519, "post_id": 44401356, "comment_id": 75852042, "body": "@jww thanks for the pointers. I followed step-by-step:  <a href=\"https://jamielinux.com/docs/openssl-certificate-authority/sign-server-and-client-certificates.html#create-a-certificate\" rel=\"nofollow noreferrer\">jamielinux.com/docs/openssl-certificate-authority/&hellip;</a> Created a root cert and then an intermedia. I used the intermedia to sign the cert for my website. I still get the unknown certificate error."}], "answers": [{"tags": [], "owner": {"reputation": 8175, "user_id": 376742, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/314c5e634c0b24fd63b70bf62a83f4cc?s=128&d=identicon&r=PG", "display_name": "ssk", "link": "https://stackoverflow.com/users/376742/ssk"}, "is_accepted": true, "score": 1, "last_activity_date": 1496959438, "creation_date": 1496959438, "answer_id": 44446281, "question_id": 44401356, "link": "https://stackoverflow.com/questions/44401356/ssl-tls-with-websockets-server-go-lang/44446281#44446281", "title": "SSL/TLS with Websockets Server - go lang", "body": "<p>I ended up obtaining the certs from: <a href=\"https://certbot.eff.org/#ubuntuxenial-other\" rel=\"nofollow noreferrer\">https://certbot.eff.org/#ubuntuxenial-other</a></p>\n\n<pre><code>certbot certonly --standalone -d example.com -d www.example.com\n</code></pre>\n\n<p>I had to use fullchain.pem instead of cert.pem for this collider to work:</p>\n\n<p><a href=\"https://github.com/webrtc/apprtc/issues/442\" rel=\"nofollow noreferrer\">https://github.com/webrtc/apprtc/issues/442</a></p>\n"}], "owner": {"reputation": 8175, "user_id": 376742, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/314c5e634c0b24fd63b70bf62a83f4cc?s=128&d=identicon&r=PG", "display_name": "ssk", "link": "https://stackoverflow.com/users/376742/ssk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1512, "favorite_count": 0, "accepted_answer_id": 44446281, "answer_count": 1, "score": 2, "last_activity_date": 1496959438, "creation_date": 1496792721, "last_edit_date": 1496793964, "question_id": 44401356, "link": "https://stackoverflow.com/questions/44401356/ssl-tls-with-websockets-server-go-lang", "title": "SSL/TLS with Websockets Server - go lang", "body": "<p>I am using collider (<a href=\"https://github.com/webrtc/apprtc/tree/master/src/collider\" rel=\"nofollow noreferrer\">https://github.com/webrtc/apprtc/tree/master/src/collider</a> -a websockets server in go) and I am trying to add SSL/TLS support. For which I generated self-signed certificates:</p>\n\n<pre><code>openssl req -x509 -newkey rsa:4096 -keyout key.pem -out cert.pem -days 365\n\nEnter PEM pass phrase:\nVerifying - Enter PEM pass phrase:\nCountry Name (2 letter code) [AU]:US\nState or Province Name (full name) [Some-State]:CA\nLocality Name (eg, city) []:\nOrganization Name (eg, company) [Internet Widgits Pty Ltd]:testwebsite.com\nOrganizational Unit Name (eg, section) []:Engineering\nCommon Name (e.g. server FQDN or YOUR name) []:www.testwebsite.com\nEmail Address []:testwebsite@gmail.com\n</code></pre>\n\n<p>When I run the collider, I see this error:</p>\n\n<pre><code>2017/06/05 21:25:50 Error Run: crypto/tls: failed to parse private key\n</code></pre>\n\n<p>When I generate using (based on <a href=\"http://www.kaihag.com/https-and-go/\" rel=\"nofollow noreferrer\">http://www.kaihag.com/https-and-go/</a>):</p>\n\n<pre><code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout key.pem -out cert.pem\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>2017/06/05 22:11:31 http: TLS handshake error from &lt;some-ip&gt;:1082: remote error: unknown certificate\n</code></pre>\n\n<p>How to fix this? </p>\n\n<p><strong>Note:</strong> collider uses golang.org/x/net/websocket</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1496839636, "post_id": 44400971, "comment_id": 75824974, "body": "nothing weird in [regid] I guess?"}, {"owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1496840790, "post_id": 44400971, "comment_id": 75825928, "body": "@RickyA no, just a normal 12 digital ID."}], "answers": [{"tags": [], "owner": {"reputation": 3097, "user_id": 1187140, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/6c6b52fb03d3429a66270984e2affbbf?s=128&d=identicon&r=PG", "display_name": "Adrien BARRAL", "link": "https://stackoverflow.com/users/1187140/adrien-barral"}, "is_accepted": false, "score": 3, "last_activity_date": 1505477936, "creation_date": 1505477936, "answer_id": 46239427, "question_id": 44400971, "link": "https://stackoverflow.com/questions/44400971/failure-to-push-docker-image-to-ecr-w-docker-go-sdk/46239427#46239427", "title": "Failure to Push Docker Image to ECR w/ Docker Go SDK", "body": "<p>I had the same problem, and I solved it giving an arbitrary RegistryAuth to the docker push option.</p>\n\n<p>So the following code works :</p>\n\n<pre><code>closer, err = dockerClient.ImagePush(context.Background(), privateTagName,\n                                     types.ImagePushOptions{\n                    All: true,\n                    RegistryAuth:\"123\",\n                })\nif err != nil{\n  panic(err)\n}\nio.Copy(os.Stdout, closer)\ncloser.Close()\n</code></pre>\n\n<p>I read in <a href=\"https://github.com/moby/moby/issues/10983\" rel=\"nofollow noreferrer\">this post</a> that giving any value to RegistryAuth could work.</p>\n"}], "owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 932, "favorite_count": 0, "answer_count": 1, "score": 5, "last_activity_date": 1505477936, "creation_date": 1496789937, "last_edit_date": 1496841115, "question_id": 44400971, "link": "https://stackoverflow.com/questions/44400971/failure-to-push-docker-image-to-ecr-w-docker-go-sdk", "title": "Failure to Push Docker Image to ECR w/ Docker Go SDK", "body": "<p>I'm using the docker client SDK for Go and I'm running to an issue with pushing images to my AWS ECR.</p>\n\n<p>Here is the gist of my func</p>\n\n<pre><code>import (\n    \"github.com/docker/docker/api/types\"\n    dockerclient \"github.com/docker/docker/client\"\n)\nfunc doPush(target string) {\n    envCli, err := dockerclient.NewEnvClient()\n    if err != nil {\n        panic(err)\n    }\n\n    rc, err := envCli.ImagePush(\n        context.Background(),\n        target,\n        types.ImagePushOptions{})\n    if err != nil {\n        panic(err)\n    }\n    defer rc.Close()\n}\n</code></pre>\n\n<p>My image is tagged something like [regid].dkr.ecr.us-east-1.amazonaws.com/demo:latest but I get the following error:</p>\n\n<blockquote>\n  <p>invalid reference format</p>\n</blockquote>\n\n<p>If I remove the [:tag] from the image name, it works until I get a</p>\n\n<blockquote>\n  <p>Error response from daemon: Bad parameters and missing X-Registry-Auth: EOF</p>\n</blockquote>\n"}, {"tags": ["email", "go", "package"], "answers": [{"comments": [{"owner": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "edited": false, "score": 0, "creation_date": 1496851309, "post_id": 44400404, "comment_id": 75834034, "body": "Perfect, thank you! As a go beginner (this is really my first project), how could I have discovered this on my own? I don&#39;t want to have to ask a bunch of dumb questions on SO. :)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "edited": false, "score": 1, "creation_date": 1496855074, "post_id": 44400404, "comment_id": 75836210, "body": "@Charles: you&#39;ll get the hang of interpreting the compiler errors pretty quick, and they are usually quite good (though the usual missing brace can still throw things pretty far off). <code>undefined: Dialer</code> means there&#39;s no <code>Dialer</code> in your package, and since it&#39;s not something you intended to declare yourself, it must be the wrong type. Since everything from an imported package must always be prefixed with the package identifier, a <code>Dialer</code> from <code>gomail</code> must be referenced as <code>gomail.Dialer</code>."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1496786446, "last_edit_date": 1496786446, "creation_date": 1496786109, "answer_id": 44400404, "question_id": 44400384, "link": "https://stackoverflow.com/questions/44400384/creating-a-new-dialer-with-gomail-v2/44400404#44400404", "title": "Creating a new *Dialer with gomail.v2", "body": "<p><code>*Dialer</code> and <code>*gomail.Dialer</code> are 2 different types. The specific error is because you don't have a <code>Dialer</code> type defined in your package, but you need to match the types in the signature, not just the name. Since <code>gomail.NewDialer</code> returns a <code>*gomail.Dialer</code>, use:</p>\n\n<pre><code>func MyDialer() *gomail.Dialer {\n</code></pre>\n"}], "owner": {"reputation": 10150, "user_id": 341362, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/deb483e59f08e28083464e8e35a352db?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/341362/charles"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 469, "favorite_count": 0, "accepted_answer_id": 44400404, "answer_count": 1, "score": 0, "last_activity_date": 1496786446, "creation_date": 1496785979, "question_id": 44400384, "link": "https://stackoverflow.com/questions/44400384/creating-a-new-dialer-with-gomail-v2", "title": "Creating a new *Dialer with gomail.v2", "body": "<p>I'm using <a href=\"https://godoc.org/gopkg.in/gomail.v2\" rel=\"nofollow noreferrer\">gomail.v2</a> to send emails, and my code works fine. After composing a message <code>msg</code> I can just run</p>\n\n<pre><code>import (\"gopkg.in/gomail.v2\")\n\n  ...\n  d := gomail.NewDialer(\"smtp.example.com\", 25, \"username\", \"password\")\n  return d.DialAndSend(msg)\n}\n</code></pre>\n\n<p>Of course I'd like to generalize this past a particular username and password and separate it into its own function, so I stubbed it out:</p>\n\n<pre><code>import (\"gopkg.in/gomail.v2\")\n\n  ...\n  d := MyDialer()\n  return d.DialAndSend(msg)\n}\n\nfunc MyDialer() *Dialer {\n  return gomail.NewDialer(\"smtp.example.com\", 25, \"username\", \"password\")\n}\n</code></pre>\n\n<p>But go croaks, complaining that it doesn't know about Dialer.</p>\n\n<blockquote>\n  <p>.\\email.go:42: undefined: Dialer</p>\n</blockquote>\n\n<p>Why is this? I'm using the same return type as <code>NewDialer</code>, which doesn't cause any problems.</p>\n\n<pre><code>func NewDialer(host string, port int, username, password string) *Dialer\n</code></pre>\n\n<p>What am I missing? I ran</p>\n\n<blockquote>\n  <p>go get -u gopkg.in/gomail.v2</p>\n</blockquote>\n\n<p>to make sure I wasn't somehow running an out of date version of the package, but no luck there.</p>\n"}, {"tags": ["authentication", "go", "oauth-2.0", "authorization"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1496780150, "post_id": 44398216, "comment_id": 75797966, "body": "From a simple web search, there seems to be a variety of Go OAuth2 server libraries to choose from. Read through a few of their READMEs, pick one that looks like it will work for you, and just try using it. Post a concrete question if you run into trouble."}], "answers": [{"comments": [{"owner": {"reputation": 409, "user_id": 3927977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b285cfec1dae5a6da430dcdf8aee2a3f?s=128&d=identicon&r=PG&f=1", "display_name": "LuisFerrolho", "link": "https://stackoverflow.com/users/3927977/luisferrolho"}, "edited": false, "score": 0, "creation_date": 1498501226, "post_id": 44426276, "comment_id": 76513298, "body": "The idea was not to implement an OAuth2 provider at all. The idea was to use the jwt package from that lib to achieve authentication and authorization with my own database and users. Since I didn&#39;t find any example with this package, I ended up using this lib: <a href=\"https://github.com/dgrijalva/jwt-go\" rel=\"nofollow noreferrer\">github.com/dgrijalva/jwt-go</a> ."}], "tags": [], "owner": {"reputation": 409, "user_id": 3152168, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/32de182081b9b54fd383d40fef3e079b?s=128&d=identicon&r=PG", "display_name": "AniSkywalker", "link": "https://stackoverflow.com/users/3152168/aniskywalker"}, "is_accepted": false, "score": 0, "last_activity_date": 1496893607, "creation_date": 1496893607, "answer_id": 44426276, "question_id": 44398216, "link": "https://stackoverflow.com/questions/44398216/oauth2-golang-own-database-and-users/44426276#44426276", "title": "Oauth2 Golang - Own database and users", "body": "<p>Have you explored solutions such as <a href=\"https://github.com/ory/hydra\" rel=\"nofollow noreferrer\">ory/hydra</a>, which will handle everything OAuth2/OpenID related and let you handle user authentication?</p>\n\n<p>Implementing your own OAuth2 provider is dangerous territory. It only takes one misread RFC and BOOM! Security vulnerability. It's typically better to entrust that responsibility to established security experts or lasting projects as opposed to home-grown remedies.</p>\n\n<p>Of course, this isn't to say that everybody needs to jump onto the hype train and use this cool new software. In fact, I would urge the opposite: if you are a competent security analyst and feel comfortable writing an OAuth2/OpenID Connect implementation, go right ahead! But us normal people who don't want our hair to gray before we are thirty will use existing technologies to our advantage.</p>\n\n<p><a href=\"https://i.stack.imgur.com/hxEqO.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hxEqO.jpg\" alt=\"So Trump must have been busy working with webRTC.\"></a></p>\n"}], "owner": {"reputation": 409, "user_id": 3927977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b285cfec1dae5a6da430dcdf8aee2a3f?s=128&d=identicon&r=PG&f=1", "display_name": "LuisFerrolho", "link": "https://stackoverflow.com/users/3927977/luisferrolho"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 898, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1496893607, "creation_date": 1496776931, "question_id": 44398216, "link": "https://stackoverflow.com/questions/44398216/oauth2-golang-own-database-and-users", "title": "Oauth2 Golang - Own database and users", "body": "<p>I'm building a web application in Golang, and at the moment I'm struggling with the authentication/authorization mechanisms.</p>\n\n<p>I want to deploy this app to different platforms (browsers, androids, etc). To achieve this I chosed to use oauth 2.0, namely this lib: <a href=\"https://github.com/golang/oauth2\" rel=\"nofollow noreferrer\">https://github.com/golang/oauth2</a> .</p>\n\n<p>The problem I'm facing is how to achieve this with my own database and users. The lib has a jwt package (<a href=\"https://github.com/golang/oauth2/tree/master/jwt\" rel=\"nofollow noreferrer\">https://github.com/golang/oauth2/tree/master/jwt</a>) and also has a package clientcredentials (<a href=\"https://github.com/golang/oauth2/blob/master/clientcredentials/clientcredentials.go\" rel=\"nofollow noreferrer\">https://github.com/golang/oauth2/blob/master/clientcredentials/clientcredentials.go</a>) that can be used for 2-legged Oauth 2.0, but I have no idea how to achieve this, and can't find any example showing it. Which package should I use? The token should be set when user sends a POST with its credentials at <a href=\"http://example.domain/login\" rel=\"nofollow noreferrer\">http://example.domain/login</a>.</p>\n\n<p>Can someone provide me some hints / show me a simple example?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 8121509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7369b5d2df06ae10dd32f6e489b4b7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/8121509/ben"}, "edited": false, "score": 0, "creation_date": 1496779521, "post_id": 44398497, "comment_id": 75797628, "body": "Thank you for the information! I will try your solution and compare it with the related questions as per @eugenioy &#39;s, comment.  p.s. Thank you for the encouraging words!"}, {"owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "reply_to_user": {"reputation": 21, "user_id": 8121509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7369b5d2df06ae10dd32f6e489b4b7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/8121509/ben"}, "edited": false, "score": 0, "creation_date": 1496780597, "post_id": 44398497, "comment_id": 75798206, "body": "No problem! Make sure to upvote answers that contribute to your question, and &quot;select&quot; an answer if appropriate!"}, {"owner": {"reputation": 21, "user_id": 8121509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7369b5d2df06ae10dd32f6e489b4b7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/8121509/ben"}, "edited": false, "score": 0, "creation_date": 1496788003, "post_id": 44398497, "comment_id": 75801185, "body": "I upvoted both responses since they were both helpful, however, because my reputation is below 15, stackoverflow told me it would not show up publicly."}], "tags": [], "owner": {"reputation": 1954, "user_id": 4746361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/365515b57884ad8e8ad13e1050981839?s=128&d=identicon&r=PG&f=1", "display_name": "william.taylor.09", "link": "https://stackoverflow.com/users/4746361/william-taylor-09"}, "is_accepted": false, "score": 0, "last_activity_date": 1496777952, "creation_date": 1496777952, "answer_id": 44398497, "question_id": 44397771, "link": "https://stackoverflow.com/questions/44397771/how-do-i-assign-embedded-interface-to-object-in-golang/44398497#44398497", "title": "How do I assign embedded interface to object in golang", "body": "<p>There's a couple of different ways to do this, but the most straightforward is to embed type Baz with Bar. Baz can now multiply() and has two fields (a, b). Your code would look something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {\n    b []*Baz\n}\n\ntype Baz struct {\n    Bar\n    a, b int\n}\n\ntype Bar interface {\n    Multiply() int\n}\n\nfunc (baz *Baz) Multiply() int {\n    return baz.a * baz.b\n}\n\nfunc NewFoo(bar []*Baz) *Foo {\n    return &amp;Foo{b: bar}\n}\nfunc NewBaz() []*Baz {\n    bazes := make([]*Baz, 2)\n    bazes[0] = &amp;Baz{a: 1, b: 2}\n    bazes[1] = &amp;Baz{a: 3, b: 4}\n    return bazes\n}\n\nfunc main() {\n    baz := NewBaz()\n    foo := NewFoo(baz)\n    for _, f := range foo.b {\n        fmt.Println(\"Foo.Multiply \", f.Multiply())\n    }\n}\n</code></pre>\n\n<p>GoPlay here:\n<a href=\"https://play.golang.org/p/lia0ZS81TO\" rel=\"nofollow noreferrer\">https://play.golang.org/p/lia0ZS81TO</a></p>\n\n<p>Great first question, by the way.</p>\n"}, {"comments": [{"owner": {"reputation": 21, "user_id": 8121509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7369b5d2df06ae10dd32f6e489b4b7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/8121509/ben"}, "edited": false, "score": 0, "creation_date": 1496779307, "post_id": 44398699, "comment_id": 75797502, "body": "thanks for the explanation and reply! I will take a look at the related questions and see if I the alternatives are a better choice for my use case."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 0, "last_activity_date": 1496778755, "creation_date": 1496778755, "answer_id": 44398699, "question_id": 44397771, "link": "https://stackoverflow.com/questions/44397771/how-do-i-assign-embedded-interface-to-object-in-golang/44398699#44398699", "title": "How do I assign embedded interface to object in golang", "body": "<p>The error you are getting:</p>\n\n<blockquote>\n  <p>cannot use baz (type []*Baz) as type []Bar</p>\n</blockquote>\n\n<p>Is because Go won't let you assign an array of Baz to an array of Bar, even when it'd let you assign a Baz to a Bar variable.</p>\n\n<p>To see this in a more simple form, this works fine:</p>\n\n<pre><code>var oneBaz *Baz = &amp;Baz{a: 1, b: 2} \nvar oneBar Bar = oneBaz\n</code></pre>\n\n<p>Because the type Baz satisfies the Bar interface and you can assign a Baz object to a Bar variable.</p>\n\n<p>But this does not work (even if it'd looks like it could work):</p>\n\n<pre><code>var bazArray []*Baz = make([]*Baz, 2)\nvar barArray []Bar = bazArray\n</code></pre>\n\n<p>It will throw the same error you are seeing.</p>\n\n<p>In order to make this work, you'd probably need to implement one of the solutions listed in this related question:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/12753805/type-converting-slices-of-interfaces-in-go\">Type converting slices of interfaces in go</a></p>\n"}], "owner": {"reputation": 21, "user_id": 8121509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7369b5d2df06ae10dd32f6e489b4b7a2?s=128&d=identicon&r=PG&f=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/8121509/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 890, "favorite_count": 0, "closed_date": 1496789418, "answer_count": 2, "score": 2, "last_activity_date": 1496789777, "creation_date": 1496775311, "last_edit_date": 1496789777, "question_id": 44397771, "link": "https://stackoverflow.com/questions/44397771/how-do-i-assign-embedded-interface-to-object-in-golang", "closed_reason": "Duplicate", "title": "How do I assign embedded interface to object in golang", "body": "<p>I am attempting to assign an array of structs of type Baz to an array of interfaces of type Bar embedded in a second struct of type Foo. I have not been able to find the exact information here or elsewhere googling. I have provided a minimum working example.</p>\n\n<p>I get the following error:</p>\n\n<p>$ go run main.go</p>\n\n<p>./main.go:38: cannot use baz (type []*Baz) as type []Bar in argument to NewFoo</p>\n\n<p>My apologies if my code is not idiomatic go and also if I have not confirmed exactly to standards for posting questions, this is my first post.</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n)\ntype Foo struct {\n    b []Bar\n}\n\n\n\ntype Baz struct {\n    a, b int\n}\n\ntype Bar interface {\n    Multiply() int\n}\n\nfunc (baz *Baz) Multiply() int{\n    return baz.a * baz.b\n}\n\nfunc NewFoo(bar []Bar) *Foo{\n    return &amp;Foo{b: bar}\n}\nfunc NewBaz() []*Baz {\n    bazes := make([]*Baz, 2)\n    bazes[0] = &amp;Baz{a: 1, b: 2}\n    bazes[1] = &amp;Baz{a: 3, b: 4}\n    return bazes\n}\n\nfunc main() {\n\n    baz := NewBaz()\n    foo := NewFoo(baz)\n    for _, f := range foo.b {\n        fmt.Println(\"Foo.Multiply \", f.Multiply())\n    }\n}\n</code></pre>\n\n<p>UPDATE: I approved the duplicate vote after further reading and understanding the suggested related posts. Thank you to those who pointed me in that direction. For future interested readers, my final implementation consistent with my use case is as follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Foo struct {\n    b []Bar\n}\n\ntype Baz struct {\n    a, b int\n}\n\ntype Bar interface { //\n    Multiply() int\n}\n\nfunc (baz *Baz) Multiply() int {\n    return baz.a * baz.b\n}\n\nfunc NewFoo(bar []*Baz) *Foo{\n    f := &amp;Foo{}\n    f.b = make([]Bar, 2)\n    fmt.Println(\"len(bar) \", len(bar), \"len(f.b)\", len(f.b) )\n    for i, _ := range f.b {\n        f.b[i] = bar[i]\n\n    }\n    return f\n}\n\nfunc MakeBaz() []*Baz {\n    bazes := make([]*Baz, 2)\n    bazes[0] = NewBaz(1, 2)\n    bazes[1] = NewBaz(3, 4)\n    return bazes\n}\n\nfunc NewBaz(aa, bb int) *Baz {\n    return &amp;Baz{a: aa, b: bb}\n}\n\nfunc main() {\n    baz := MakeBaz()\n    foo := NewFoo(baz)\n    fmt.Printf(\"%v\\n\", foo)\n    for _, f := range foo.b {\n        fmt.Println(\"Foo.Multiply \", f.Multiply())\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-dataflow"], "answers": [{"tags": [], "owner": {"reputation": 467, "user_id": 1017244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/234694902b3069308c08e0bc614966d4?s=128&d=identicon&r=PG&f=1", "display_name": "user01380121", "link": "https://stackoverflow.com/users/1017244/user01380121"}, "is_accepted": true, "score": 3, "last_activity_date": 1496771380, "creation_date": 1496771380, "answer_id": 44396616, "question_id": 44396155, "link": "https://stackoverflow.com/questions/44396155/create-job-from-dataflow-template-from-go-app/44396616#44396616", "title": "Create job from Dataflow template from Go app", "body": "<p>Using <a href=\"https://github.com/google/google-api-go-client/\" rel=\"nofollow noreferrer\">Auto-generated Google APIs for Go</a> is only recommended if there is a <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go\" rel=\"nofollow noreferrer\">Google Client Library for Go</a> developed for the service you are calling. There is not a client library yet for Dataflow.</p>\n\n<p>To launch a Dataflow template from a Go app using default credentials:</p>\n\n<pre><code>ctx := context.Background()\noauthClient, err := google.DefaultClient(ctx, dataflow.CloudPlatformScope)\n\ndataflowService, err := dataflow.New(oauthClient)\n\nif err != nil {\n  panic(err)\n}\n\ntemplateRequest := dataflow.CreateJobFromTemplateRequest{\n  GcsPath: \"gcs path to template here\",\n  JobName: \"choose a unique job name here\",\n  Parameters: map[string]string{\n    \"parameters\": \"for job\",\n  },\n}\n\nresult, err := dataflowService.Projects.Templates.Create(\"project id\", &amp;templateRequest).Do()\n\nif err != nil {\n  panic(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 467, "user_id": 1017244, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/234694902b3069308c08e0bc614966d4?s=128&d=identicon&r=PG&f=1", "display_name": "user01380121", "link": "https://stackoverflow.com/users/1017244/user01380121"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 549, "favorite_count": 0, "accepted_answer_id": 44396616, "answer_count": 1, "score": 0, "last_activity_date": 1496871502, "creation_date": 1496769775, "last_edit_date": 1496871502, "question_id": 44396155, "link": "https://stackoverflow.com/questions/44396155/create-job-from-dataflow-template-from-go-app", "title": "Create job from Dataflow template from Go app", "body": "<p>I'm trying to launch a Dataflow job from an existing template, via a Go app. </p>\n\n<p>So far, I've brought in <code>google.golang.org/api/dataflow/v1b3</code> and created a <code>CreateJobFromTemplateRequest</code> with the job info.</p>\n\n<p>How can I now execute that request using the built-in service account credentials in Compute Engine?</p>\n"}, {"tags": ["go", "gopath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496769852, "post_id": 44395946, "comment_id": 75792158, "body": "Can you just put the packages in some other path? Why put the source if the GloriousMomolith, if you don&#39;t want it to be associated?"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496770260, "post_id": 44395946, "comment_id": 75792357, "body": "I want it to be associated. But the actual GloriousMomolith name is arbitrary and is different in different environments. Its just a location where I cloned the repo. So I don&#39;t want to hard-coded it anywhere."}], "answers": [{"comments": [{"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 0, "creation_date": 1496770346, "post_id": 44396164, "comment_id": 75792396, "body": "I did not realize I could have multiple paths in my $GOPATH. Thanks for the advice. I am thinking that I will have services/src/servicename and add ~/GloriousMomolith/services to my GOPATH."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496771894, "post_id": 44396164, "comment_id": 75793273, "body": "Keep in mind that, while having multiple paths in your <code>$GOPATH</code> is possible, it tends to muck with things.  The <i>intent</i> of the <code>$GOPATH</code> is to be a singular directory for all of your projects, any many tools and instructions assume you only have a single path in that variable and/or won&#39;t play nicely with paths after the first (for example, <code>go get</code> always installs to the first path in the variable, with no option to alter that behavior)."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1496769796, "creation_date": 1496769796, "answer_id": 44396164, "question_id": 44395946, "link": "https://stackoverflow.com/questions/44395946/how-to-add-go-code-into-an-existing-project/44396164#44396164", "title": "How to add go code into an existing project", "body": "<p>You can add a Go source directory to your project.  For example:</p>\n\n<pre><code>~/\n   GloriousMomolith/\n      thedjangoapp/\n      src/\n         services/\n            someservice/\n               service.go\n</code></pre>\n\n<p>Set <code>GOPATH</code> to <code>$HOME/GloriousMomolith:$HOME</code>.</p>\n\n<p>You can now import relative to the the <code>src</code> directory:</p>\n\n<pre><code>import (\n   \"services/someservice\"\n)\n</code></pre>\n"}], "owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 44396164, "answer_count": 1, "score": 0, "last_activity_date": 1496769796, "creation_date": 1496769028, "question_id": 44395946, "link": "https://stackoverflow.com/questions/44395946/how-to-add-go-code-into-an-existing-project", "title": "How to add go code into an existing project", "body": "<p>I am pretty new to go. We are currently splitting some microservices off of our monolithic Django+python web app and we have decided to do at least some of them in go. The problem is that the sources for the services are supposed to live in the same repo as the main app. So I have all the python code in ~/GloriousMomolith/thedjangoapp and split off services in ~/GloriousMomolith/services/some-service-name.</p>\n\n<p>I could move ~/GloriousMonolith under ~/src (I have $GOPATH set to $HOME), but then every time I refer to a go package I create I would have to do <code>import GloriousMomolith/services/someservice/somepackage</code>. I want to avoid that. At the very least, I want to avoid having <code>GloriousMomolith</code> part hard-coded anywhere. Any suggestions?</p>\n"}, {"tags": ["go", "function-pointers", "member-function-pointers"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 1, "last_activity_date": 1496770183, "creation_date": 1496770183, "answer_id": 44396276, "question_id": 44395698, "link": "https://stackoverflow.com/questions/44395698/how-exactly-are-function-values-function-pointers-implemented-in-go/44396276#44396276", "title": "How exactly are function values (&#39;function pointers&#39;) implemented in Go?", "body": "<p>The \"New Implementation\" section of <a href=\"http://golang.org/s/go11func\" rel=\"nofollow noreferrer\">the design document</a> describes how function pointers are represented.</p>\n"}], "owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496770183, "creation_date": 1496767982, "last_edit_date": 1496768224, "question_id": 44395698, "link": "https://stackoverflow.com/questions/44395698/how-exactly-are-function-values-function-pointers-implemented-in-go", "title": "How exactly are function values (&#39;function pointers&#39;) implemented in Go?", "body": "<p>From <a href=\"http://golang.org/pkg/reflect/#Value.Pointer\" rel=\"nofollow noreferrer\">the documentation for <code>reflect.Value.Pointer()</code></a>:</p>\n\n<blockquote>\n  <p>If v's Kind is Func, the returned pointer is an underlying code pointer, but not necessarily enough to identify a single function uniquely. The only guarantee is that the result is zero if and only if v is a nil func Value.</p>\n</blockquote>\n\n<p>It seems clear that function-valued variables must contain more than just a  code pointer.  Given that Go supports method pointers, this is hardly surprising - but what is the actual underlying implementation?</p>\n\n<p>(And how does it differ, if at all, for function values created using reflection?  See comment <a href=\"http://golang.org/src/reflect/value.go?s=38217:38249#L1238\" rel=\"nofollow noreferrer\">in the source for Value.Pointer()</a>.)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 201, "user_id": 1279946, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd2fe1e6db314efe2c3e2b357246ce4f?s=128&d=identicon&r=PG", "display_name": "House.Lee", "link": "https://stackoverflow.com/users/1279946/house-lee"}, "edited": false, "score": 2, "creation_date": 1604531918, "post_id": 44394873, "comment_id": 114378822, "body": "This doesn&#39;t seem to be true anymore? I did some tests, the goroutine will be normally released. It&#39;s not the goroutine that being leaked but the child context. Without canceling the context, all child contexts will remain in memory until the parent context is canceled. <a href=\"https://play.golang.org/p/8lJ7nQOj45Y\" rel=\"nofollow noreferrer\">play.golang.org/p/8lJ7nQOj45Y</a>"}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 45, "last_activity_date": 1496765108, "creation_date": 1496765108, "answer_id": 44394873, "question_id": 44393995, "link": "https://stackoverflow.com/questions/44393995/what-happens-if-i-dont-cancel-a-context/44394873#44394873", "title": "What happens if I don&#39;t cancel a Context?", "body": "<p>If you fail to cancel the context, the <a href=\"https://golang.org/src/context/context.go?s=9162:9288\" rel=\"noreferrer\">goroutine that WithCancel or WithTimeout created</a> will be retained in memory indefinitely (until the program shuts down), causing a memory leak.  If you do this a lot, your memory will balloon significantly.  It's best practice to use a <code>defer cancel()</code> immediately after calling <code>WithCancel()</code> or <code>WithTimeout()</code></p>\n"}, {"tags": [], "owner": {"reputation": 193, "user_id": 4436000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ab4a9122d4dc626e243e741e3bc6c12?s=128&d=identicon&r=PG&f=1", "display_name": "user4436000", "link": "https://stackoverflow.com/users/4436000/user4436000"}, "is_accepted": false, "score": 17, "last_activity_date": 1614099217, "last_edit_date": 1614099217, "creation_date": 1511536699, "answer_id": 47476101, "question_id": 44393995, "link": "https://stackoverflow.com/questions/44393995/what-happens-if-i-dont-cancel-a-context/47476101#47476101", "title": "What happens if I don&#39;t cancel a Context?", "body": "<p>If you use <code>WithCancel</code>, the <em>goroutine</em> will be held indefinitely in memory. However, if you use <code>WithDeadline</code> or <code>WithTimeout</code> without calling cancel, the <em>goroutine</em> will only be held until the timer expires.</p>\n<p>This is still not best practice though, it's always best to call cancel as soon as you're done with the resource.</p>\n"}], "owner": {"reputation": 3127, "user_id": 842860, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/oOCwG.png?s=128&g=1", "display_name": "stackoverflower", "link": "https://stackoverflow.com/users/842860/stackoverflower"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11634, "favorite_count": 10, "accepted_answer_id": 44394873, "answer_count": 2, "score": 33, "last_activity_date": 1614099217, "creation_date": 1496762647, "last_edit_date": 1496771015, "question_id": 44393995, "link": "https://stackoverflow.com/questions/44393995/what-happens-if-i-dont-cancel-a-context", "title": "What happens if I don&#39;t cancel a Context?", "body": "<p>I have the following code:</p>\n\n<pre><code>func Call(ctx context.Context, payload Payload) (Response, error) {\n    req, err := http.NewRequest(...) // Some code that creates request from payload\n    ctx, cancel = context.withTimeout(ctx, time.Duration(3) * time.Second)\n    defer cancel()\n    return http.DefaultClient.Do(req)\n}\n</code></pre>\n\n<p>What would happen if I didn't put <code>defer cancel()</code> in there?  <code>go vet</code> warned this</p>\n\n<blockquote>\n  <p>the cancel function returned by context.WithTimeout should be called, not discarded, to avoid a context leak</p>\n</blockquote>\n\n<p>How will the context be leaked and what impact will this have?  Thanks</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496756787, "post_id": 44391358, "comment_id": 75783302, "body": "Why is this in a <code>for{}</code> loop? That&#39;s why it&#39;s running forever, you&#39;ve told it explicitly to loop forever."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1496756791, "post_id": 44391358, "comment_id": 75783307, "body": "You&#39;re dispatching an infinite number of goroutines as fast as your system can schedule them. You also have a data race around <code>page</code>, so the value you&#39;re requesting is meaningless. What is the goal here with concurrency?"}, {"owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496757058, "post_id": 44391358, "comment_id": 75783493, "body": "@JimB please see the edit."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1496757211, "post_id": 44391358, "comment_id": 75783605, "body": "@rhillhouse: if you don&#39;t know how many results there will be until you make each request, you can&#39;t very well make them concurrently."}], "owner": {"reputation": 1501, "user_id": 6414477, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6a2c251e715864f098ebf4b4057848b1?s=128&d=identicon&r=PG&f=1", "display_name": "rhillhouse", "link": "https://stackoverflow.com/users/6414477/rhillhouse"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1496760436, "creation_date": 1496755717, "last_edit_date": 1496756986, "question_id": 44391358, "link": "https://stackoverflow.com/questions/44391358/trouble-with-goroutines", "title": "Trouble with goroutines", "body": "<p>I am having trouble understanding channels and goroutines. What I am trying to do is, to continue \"paging\" until there are no more results(<code>len(matches.Matches) == 0</code>). Instead of breaking out of the infinite loop, my <code>page</code> values run well into the 100000.</p>\n\n<pre><code>func main() {\n    results := make(chan []*shodan.HostData)\n    var wg sync.WaitGroup\n\n\n    shodanClient := authorizeShodanApi(\"redacted\")\n\n    page := 0\n    for {\n        wg.Add(1)\n        go func() {\n            matches, _ := shodanClient.GetHostsForQuery(&amp;shodan.HostQueryOptions{\n                Query: \"country:AL port:8080 'HTTP/1.1 200 OK' 'http server 1.0'\",\n                Page: page,\n            })\n            defer wg.Done()\n            if len(matches.Matches) == 0{\n                fmt.Println(\"DONE\")\n                return\n            }\n            results &lt;- matches.Matches\n        }()\n        page++\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>How can I break the loop as soon as there are no more results?</p>\n\n<p>EDIT:\nReason for <code>for{}</code>: Shodan return 100 results per page, but I have no way of knowing how many pages of results there are. Thats why I used a <code>for{}</code> loop, and was hoping to break from the loop as soon as there are no more values (meaning no more pages). <code>page</code>, together with the following code:</p>\n\n<pre><code>matches, _ := shodanClient.GetHostsForQuery(&amp;shodan.HostQueryOptions{\n                Query: \"country:AL port:8080 'HTTP/1.1 200 OK' 'http server 1.0'\",\n                Page: page,\n            })\n</code></pre>\n\n<p>Should fire off a request to the shodan API to the specific page. This is also why I would like concurrency.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1496755598, "post_id": 44391148, "comment_id": 75782384, "body": "Dial takes an IP address, not a URL. The path portion is not part of the address."}], "answers": [{"tags": [], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "is_accepted": true, "score": 2, "last_activity_date": 1496782508, "creation_date": 1496782508, "answer_id": 44399665, "question_id": 44391148, "link": "https://stackoverflow.com/questions/44391148/unable-to-make-a-udp-request/44399665#44399665", "title": "Unable to make a UDP request", "body": "<p>So you'll need to send it to the <code>IP</code> address and <code>port</code> as provided by the <code>.torrent</code> metafile (<code>announce</code> field).</p>\n\n<p>And once you open the <code>net.Conn</code> you can <code>conn.Write()</code> to the socket and similarly <code>conn.Read()</code> </p>\n\n<p>So you've just about gotten i:</p>\n\n<pre><code>    conn, err := net.Dial(\"udp\", announceAddr:Port)\n</code></pre>\n\n<p>When connecting with <code>HTTP</code>, yeah you use the <code>/announce</code> endpoint, but not with <code>UDP</code></p>\n\n<p>The <a href=\"http://www.bittorrent.org/beps/bep_0015.html\" rel=\"nofollow noreferrer\">specs</a> explain how many bytes to read and write (it is fixed at first, but later dynamic when it comes to reading the peer list). I've found this link, rather, the most useful: <a href=\"https://github.com/naim94a/udpt/wiki/The-BitTorrent-UDP-tracker-protocol\" rel=\"nofollow noreferrer\">https://github.com/naim94a/udpt/wiki/The-BitTorrent-UDP-tracker-protocol</a></p>\n"}], "owner": {"reputation": 552, "user_id": 3282666, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd3291df7602ea60aa75cafe806b0f75?s=128&d=identicon&r=PG&f=1", "display_name": "user3282666", "link": "https://stackoverflow.com/users/3282666/user3282666"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 44399665, "answer_count": 1, "score": 1, "last_activity_date": 1496782508, "creation_date": 1496755173, "question_id": 44391148, "link": "https://stackoverflow.com/questions/44391148/unable-to-make-a-udp-request", "title": "Unable to make a UDP request", "body": "<p>I am trying to build a BitTorrent client in go. I need to make UDP requests to connect to the various trackers. For this I use the <code>net</code> package and do this:</p>\n\n<pre><code>net.Dial(\"udp\", \"udp://hostname:1337/announce\")\n</code></pre>\n\n<p>I get a \"too many colons in address\" error. </p>\n\n<p>If I try this:</p>\n\n<pre><code>net.Dial(\"udp\", \"hostname:1337/announce\")\n</code></pre>\n\n<p>I get a \"nodename nor servname provided, or not known\" error.</p>\n\n<p>How do I fix this?</p>\n"}, {"tags": ["elasticsearch", "go"], "answers": [{"tags": [], "owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "is_accepted": true, "score": 0, "last_activity_date": 1496760293, "creation_date": 1496760293, "answer_id": 44393134, "question_id": 44390244, "link": "https://stackoverflow.com/questions/44390244/golang-how-to-construct-a-struct-for-elasticsearch-pipeline-attachment/44393134#44393134", "title": "Golang: How to construct a struct for Elasticsearch pipeline attachment", "body": "<p>I'm able to do this successfully,</p>\n\n<p>I have constructed structs like this:</p>\n\n<pre><code>type AS struct {\n    Description string `json:\"description\"`\n    Processors []ASP `json:\"processors\"`\n}\n\ntype ASP struct {\n    Attachment ASPA `json:\"attachment\"`\n}\n\ntype ASPA struct {\n    Field string `json:\"field\"`\n    IndexedChars int64 `json:\"indexed_chars\"`\n}\n\nattachment := &amp;AS{\n    Description: \"Process documents\",\n    Processors: []ASP{\n        ASP{\n            Attachment: ASPA{\n                Field: \"thedata\",\n                IndexedChars: -1,\n            },\n        },\n    },\n}\n</code></pre>\n\n<p>Then I sent a put request similar to this \n<a href=\"https://github.com/DaddyOh/golang-samples/blob/master/httpClient.go\" rel=\"nofollow noreferrer\">https://github.com/DaddyOh/golang-samples/blob/master/httpClient.go</a></p>\n\n<p>I got the result:</p>\n\n<pre><code>{\"acknowledged\":true}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 176, "user_id": 6243470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/335981a22c1733a215e5d47f9efd8ff6?s=128&d=identicon&r=PG&f=1", "display_name": "Ami", "link": "https://stackoverflow.com/users/6243470/ami"}, "is_accepted": false, "score": 0, "last_activity_date": 1496766171, "creation_date": 1496766171, "answer_id": 44395201, "question_id": 44390244, "link": "https://stackoverflow.com/questions/44390244/golang-how-to-construct-a-struct-for-elasticsearch-pipeline-attachment/44395201#44395201", "title": "Golang: How to construct a struct for Elasticsearch pipeline attachment", "body": "<p>you can use <a href=\"https://github.com/sohlich/elogrus\" rel=\"nofollow noreferrer\">logrus</a> package which has elastic search hook and is simple enough.</p>\n"}], "owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 416, "favorite_count": 0, "accepted_answer_id": 44393134, "answer_count": 2, "score": 1, "last_activity_date": 1496766171, "creation_date": 1496752730, "last_edit_date": 1496753050, "question_id": 44390244, "link": "https://stackoverflow.com/questions/44390244/golang-how-to-construct-a-struct-for-elasticsearch-pipeline-attachment", "title": "Golang: How to construct a struct for Elasticsearch pipeline attachment", "body": "<p>I'm constructing a struct to send a put message to Elasticsearch for pipeline attachment.</p>\n\n<p>This is the json that I'm supposed to send it to ES:</p>\n\n<pre><code>PUT _ingest/pipeline/attachment \n{   \n    \"description\": \"Process documents\",   \n    \"processors\": [\n        {\n            \"attachment\": {\n                \"field\": \"thedata\",\n                \"indexed_chars\": -1\n            }\n        },\n        {\n            \"set\": {\n                \"field\": \"attachment.title\",\n                \"value\": \"{{ title }}\"\n            }\n        },\n        {\n            \"set\": {\n                \"field\": \"attachment.author\",\n                \"value\": \"{{ author }}\"\n            }\n        },\n        {\n            \"set\": {\n                \"field\": \"attachment.url\",\n                \"value\": \"{{ url }}\"\n            }\n        },\n        {\n            \"set\": {\n                \"field\": \"attachment.cover\",\n                \"value\": \"{{ cover }}\"\n            }\n        },\n        {\n            \"set\": {\n                \"field\": \"attachment.page\",\n                \"value\": \"{{ page }}\"\n            }\n        }\n    ] \n}\n</code></pre>\n\n<p>Do I really need to make a struct and marshal it in order to put the message? (I'm coming from Python). Setting up pipeline is a single time process.</p>\n\n<p>I'm constructing structs like this in Go:</p>\n\n<pre><code>type AS struct {\n    Description string\n\n}\n\ntype ASP struct {\n    Processors \n}\n\ntype ASPA struct {\n    Attachment []ASPAF `json:\"attachment\"`\n}\n\ntype ASPAF struct {\n    Field string `json:\"field\"`\n    IndexedChars uint64 `json:\"indexed_chars\"`\n}\n\ntype ASPS struct {\n    Set []ASPSF `json:\"set\"`\n}\n\ntype ASPSF struct {\n    Field string `json:\"field\"`\n    Value string `json:\"value\"`\n}\n</code></pre>\n\n<p>If you can see the code, I'm stuck at <code>ASP struct</code> and <code>AS struct</code> <strong>for processors and rounding up as attachment struct with description</strong>.</p>\n\n<p>Could someone guide me? I'm not even sure if I'm right with the above structs.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496749898, "post_id": 44388292, "comment_id": 75778090, "body": "You can not mix the standard mux (<code>http.DefaultServerMux</code>) and <code>gorilla&#47;mux</code>. You should pass <code>gorilla router</code> as the second argument of <code>http.ListenAndServe</code> if you wan&#39;t to replace the standard one. How is your controller&#39;s paths will look like?"}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496750532, "post_id": 44388292, "comment_id": 75778485, "body": "@putu What I did now was added a default <code>r := mux.NewRouter()</code> in the <code>main package</code> and handled <code>&#47;v1&#47;</code> as the <code>controllers.V1Router()</code> and I&#39;m getting a nil pointer error. I did add <code>r</code> to replace the <code>nil</code> in <code>ListenAndServe</code>."}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496750875, "post_id": 44388292, "comment_id": 75778715, "body": "@putu Okay, that was my mistake - I had an error while debugging. Fixing everything the way it was I get the same error."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496754153, "post_id": 44388292, "comment_id": 75781270, "body": "My first comment may be not 100% correct. You can mix it, <i>but</i>  it only works if you register it through <code>http.Handle(&quot;&#47;&quot;, controllers.V1Router)</code> or passing it as second argument of <code>http.ListenAndServe</code>. The sub-router for <code>&#47;v1</code> must be created using <a href=\"https://godoc.org/github.com/gorilla/mux#Route.Subrouter\" rel=\"nofollow noreferrer\"><code>Route.Subrouter</code></a>, e.g. <code>v1 := V1Router.PathPrefix(&quot;&#47;v1&quot;).Subrouter()</code>, then register base controller to <code>v1</code>."}, {"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496754292, "post_id": 44388292, "comment_id": 75781366, "body": "@putu, the first part of your comment - is that not the same solution as my first attempt?"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496758881, "post_id": 44388292, "comment_id": 75784813, "body": "No, it&#39;s not. I try to explained it in the answer."}], "answers": [{"comments": [{"owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "edited": false, "score": 0, "creation_date": 1496766118, "post_id": 44391691, "comment_id": 75790045, "body": "Thanks! This was a great explanation. I&#39;ve edited my structure and it&#39;s working great. :)"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 1, "last_activity_date": 1496760809, "last_edit_date": 1496760809, "creation_date": 1496756524, "answer_id": 44391691, "question_id": 44388292, "link": "https://stackoverflow.com/questions/44388292/sharing-a-gorilla-mux-router-across-packages/44391691#44391691", "title": "Sharing a gorilla/mux router across packages", "body": "<p>Gorilla <code>mux.Router</code> is supposed to be used to create mapping between a set of predefined rules (e.g. host, path, protocol, scheme, etc...) and it's handler (<code>http.Handler</code> or <code>http.HandlerFunc</code>). Gorilla mux can be used to replace standard server mux. If you combine <code>gorilla/mux</code> with built in http server mux as your original question, i.e.</p>\n\n<pre><code>func main () {\n    http.Handle(\"/v1\", controllers.V1Router)\n    if err := http.ListenAndServe(\":8000\", nil); err != nil {\n        log.Fatal(\"Serving error.\")\n    }\n}\n</code></pre>\n\n<p>what actually happen when a client access <code>/v1</code> is <code>controllers.V1Router</code> will be called with request path <code>/v1</code> passed to <code>V1Router1</code>. In the <code>controllers.V1Router</code>, you defined that <code>/</code> will be handled by <code>BaseHandler</code>. However, since incoming request path is <code>/v1</code>, it won't match to your routing table. If you want to define sub routing, you can do as follows (this is what I mean in first comment):</p>\n\n<pre><code>func main () {\n    r := mux.NewRouter()\n    v1 := r.PathPrefix(\"/v1\").Subrouter()\n    controllers.RegisterHandlers(v1)\n\n    if err := http.ListenAndServe(\":8000\", r); err != nil {\n        log.Fatal(\"Serving error.\")\n    }\n}\n</code></pre>\n\n<p>Then in the controllers (<code>base.controllers.go</code>) define</p>\n\n<pre><code>//Register handlers and it's sub router\nfunc RegisterHandlers(r *mux.Router) {\n    //base handler, i.e. /v1\n    r.StrictSlash(true)\n    r.HandleFunc(\"/\", BaseHandler)\n\n    //example sub-router, i.e. /v1/example\n    ex := r.PathPrefix(\"/example\").Subrouter()\n    ex.HandleFunc(\"/\", ExampleHandler)\n\n    //other handlers...\n}\n</code></pre>\n"}], "owner": {"reputation": 1759, "user_id": 1370060, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/12135517e119f348d7efbc18407cba18?s=128&d=identicon&r=PG", "display_name": "Nick Corin", "link": "https://stackoverflow.com/users/1370060/nick-corin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1407, "favorite_count": 0, "accepted_answer_id": 44391691, "answer_count": 1, "score": 0, "last_activity_date": 1496760809, "creation_date": 1496747058, "last_edit_date": 1496751126, "question_id": 44388292, "link": "https://stackoverflow.com/questions/44388292/sharing-a-gorilla-mux-router-across-packages", "title": "Sharing a gorilla/mux router across packages", "body": "<p>I'm having some issues with implementing a slight MVC design with gorilla/mux.</p>\n\n<p>The layout of the modules is as follows:</p>\n\n<pre><code>main.go\n-- controllers\n---- base.controller.go\n---- example.controller.go\n-- models\n---- base.model.go\n---- example.controller.go\n</code></pre>\n\n<p>All the files in <code>controllers</code> is in the <code>controllers</code> package, same with <code>models</code> and then the <code>main.go</code> is the <code>main</code> package.</p>\n\n<p>Currently I'm just trying to get the <code>Base Controller</code> to be able to be shared with the <code>main package</code> which is working, although it's throwing some errors when trying to implement routes. The build is not throwing any errors, but the routes are not available. If I implement the <code>Walk</code> function in the Gorilla/Mux documentation to print out all the registered routes for the <code>mux.Router</code> then it gives me this error:</p>\n\n<blockquote>\n  <p>&amp;{%!!(MISSING)s(*mux.Router=&amp;{  [0xc4200901b0] map[] true\n  false false false}) %!!(MISSING)s(http.HandlerFunc=0xc8df0)\n  [%!!(MISSING)s(*mux.routeRegexp=&amp;{/ false false true false\n  0xc420095360 / [] []})] %!!(MISSING)s(*mux.routeRegexpGroup=&amp;{\n  0xc420016240 []}) %!!(MISSING)s(bool=true) %!!(MISSING)s(bool=false)\n  %!!(MISSING)s(bool=false)  %!!(MISSING)s(bool=false)  \n  %!!(MISSING)s(mux.BuildVarsFunc=)}</p>\n</blockquote>\n\n<p>The reasoning for the global <code>var V1Router *mux.Router</code> is firstly to access it in the <code>main package</code> and also to create subrouters in the other controllers.</p>\n\n<p>I am fairly new to <code>Go</code>, but I'm trying my best to learn the best practices! Any help would be greatly appreciated!</p>\n\n<p>Example code below:</p>\n\n<p><code>base.controllers.go</code></p>\n\n<pre><code>package controllers\n\nimport (\n        \"fmt\"\n        \"bytes\"\n        \"net/http\"\n        \"github.com/gorilla/mux\"\n)\n\nvar V1Router *mux.Router\n\nfunc init () {\n    V1Router = mux.NewRouter()\n    V1Router.StrictSlash(true)\n    V1Router.HandleFunc(\"/\", BaseHandler)    \n}\n\n// Base route to access the API Documentation.\nfunc BaseHandler (w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello, Gophers!\")\n}\n</code></pre>\n\n<p><code>main.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"github.com/projectrepo/project/models\"\n    \"github.com/projectrepo/project/controllers\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main () {\n    http.Handle(\"/v1\", controllers.V1Router)\n    if err := http.ListenAndServe(\":8000\", nil); err != nil {\n        log.Fatal(\"Serving error.\")\n    }\n}\n</code></pre>\n\n<p>In response to the comments, I tried this solution with the same result:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"github.com/projectrepo/project/models\"\n    \"github.com/projectrepo/project/controllers\"\n    \"github.com/gorilla/mux\"\n)\n\nfunc main () {\n    r := mux.NewRouter()\n    r.Handle(\"/v1\", controllers.V1Router)\n    if err := http.ListenAndServe(\":8000\", r); err != nil {\n        log.Fatal(\"Serving error.\")\n    }\n}\n</code></pre>\n"}, {"tags": ["json", "go", "unmarshalling"], "comments": [{"owner": {"reputation": 86959, "user_id": 1735406, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IF9uS.png?s=128&g=1", "display_name": "Maroun", "link": "https://stackoverflow.com/users/1735406/maroun"}, "edited": false, "score": 1, "creation_date": 1496738395, "post_id": 44385203, "comment_id": 75770287, "body": "What are you trying to do exactly? What&#39;s your expected output?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1496738494, "creation_date": 1496738494, "answer_id": 44385285, "question_id": 44385203, "link": "https://stackoverflow.com/questions/44385203/cannot-unmarshal-object-into-go-value-of-type-uint8/44385285#44385285", "title": "Cannot unmarshal object into Go value of type []uint8", "body": "<p>You have 2 JSON inputs, and you're trying to unmarshal one into the other. That doesn't make any sense.</p>\n\n<p>Model your JSON input (the object) with a type (struct), and unmarshal into that. For example:</p>\n\n<pre><code>type Obj struct {\n    Num  float64  `json:\"num\"`\n    Strs []string `json:\"strs\"`\n}\n\nfunc main() {\n    byt := []byte(`{\"num\":6.13,\"strs\":[\"a\",\"b\"]}`)\n\n    var obj Obj\n    if err := json.Unmarshal(byt, &amp;obj); err != nil {\n        panic(err)\n    }\n    fmt.Println(obj)\n\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/NJrNBUogGn\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>{6.13 [a b]}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 86959, "user_id": 1735406, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/IF9uS.png?s=128&g=1", "display_name": "Maroun", "link": "https://stackoverflow.com/users/1735406/maroun"}, "is_accepted": false, "score": 2, "last_activity_date": 1496738547, "creation_date": 1496738547, "answer_id": 44385299, "question_id": 44385203, "link": "https://stackoverflow.com/questions/44385203/cannot-unmarshal-object-into-go-value-of-type-uint8/44385299#44385299", "title": "Cannot unmarshal object into Go value of type []uint8", "body": "<p>I think you meant to do something like this:</p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var dat interface{}\n    byt := []byte(`{\"num\":6.13,\"strs\":[\"a\",\"b\"]}`)\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n    fmt.Println(dat)\n}\n</code></pre>\n\n<p>What you were trying to do makes no sense, since you're trying to unmarshal two JSON objects one into another.</p>\n"}], "owner": {"reputation": 313, "user_id": 2929925, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/ead5d98179d08112d9008e507384878b?s=128&d=identicon&r=PG&f=1", "display_name": "rahul", "link": "https://stackoverflow.com/users/2929925/rahul"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6770, "favorite_count": 0, "accepted_answer_id": 44385285, "answer_count": 2, "score": 1, "last_activity_date": 1496738571, "creation_date": 1496738228, "last_edit_date": 1496738571, "question_id": 44385203, "link": "https://stackoverflow.com/questions/44385203/cannot-unmarshal-object-into-go-value-of-type-uint8", "title": "Cannot unmarshal object into Go value of type []uint8", "body": "<p>I am fairly new to Go. I have the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\nfunc main() {\n\n    byt := []byte(`{\"num\":6.13,\"strs\":[\"a\",\"b\"]}`)\n    dat := []byte(`{\"num\":7.13,\"strs\":[\"c\",\"d\"]}`)\n    if err := json.Unmarshal(byt, &amp;dat); err != nil {\n        panic(err)\n    }\n    fmt.Println(dat)\n\n}\n</code></pre>\n\n<p>Getting the error:</p>\n\n<blockquote>\n  <p>cannot \"unmarshal object into Go value of type []uint8\".</p>\n</blockquote>\n\n<p>How can I fix this please?</p>\n"}, {"tags": ["go", "garbage-collection"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1496738207, "post_id": 44384864, "comment_id": 75770167, "body": "All values that are not reachable from the GC roots are candidates for the collection."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1496739828, "post_id": 44384864, "comment_id": 75771202, "body": "The garbage collector (GC) is precise and works properly. It does not matter what your code does. One something becomes garbage it will be collected."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1496755875, "creation_date": 1496755875, "answer_id": 44391421, "question_id": 44384864, "link": "https://stackoverflow.com/questions/44384864/will-garbage-collect-the-parent-class-if-one-child-is-in-use/44391421#44391421", "title": "Will garbage collect the parent class if one child is in use?", "body": "<p>Yes, it will be garbage collected once there is enough memory pressure to trigger garbage collection (assuming it's even put on the heap; anything allocated to the stack doesn't need to be garbage collected, as the entire stack is deallocated when no longer in use). The garbage collector will deallocate anything with no remaining references. After your processing finishes, the only thing with a reference is the <code>[]float32</code>. If that were instead a slice of structs, and those structs had a pointer back to the parent object, that would prevent the parent being collected.</p>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1496755875, "creation_date": 1496737273, "last_edit_date": 1496737952, "question_id": 44384864, "link": "https://stackoverflow.com/questions/44384864/will-garbage-collect-the-parent-class-if-one-child-is-in-use", "title": "Will garbage collect the parent class if one child is in use?", "body": "<p>I am thinking, when I create a <code>System struct</code>, the builder system will cost much memory, but the result is simple, so if I return a <strong>address</strong> of result, will garbage know that it can collect the builder system memory?</p>\n\n<p><strong>How to test this?</strong></p>\n\n<p>I simulate the situation like this:</p>\n\n<pre><code>// Builder is used to build `System`, and it will cost much memory\ntype Builder struct {\n    aux    [][]int\n    system *System\n}\n\n// System is the result of `Builder.build`, this is relatively simple\ntype System struct {\n    avg []float32\n}\n\nfunc NewSystem() *System {\n    builder := &amp;Builder{system: &amp;System{}}\n    builder.build()\n\n    return builder.system\n}\n\nfunc (builder *Builder) build() {\n    // mock initialize\n    maxCnt := 10000\n    builder.aux = make([][]int, maxCnt)\n    for i := range builder.aux {\n        builder.aux[i] = make([]int, maxCnt)\n        for j := range builder.aux[i] {\n            builder.aux[i][j] = rand.Intn(maxCnt)\n        }\n    }\n    builder.system.avg = make([]float32, len(builder.aux))\n    for i, col := range builder.aux {\n        var sum float32\n        for _, row := range col {\n            sum += float32(row)\n        }\n\n        builder.system.avg[i] = sum / float32(len(builder.aux))\n    }\n}\n\nfunc TestMem(t *testing.T) {\n    system := NewSystem()\n    // I want to know can garbage know that the memory cost by builder is able to be collected\n    fmt.Println(\"do many things with system\")\n    fmt.Println(system.avg)\n}\n</code></pre>\n"}, {"tags": ["go", "cross-platform", "gomobile"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1496762547, "post_id": 44382115, "comment_id": 75787670, "body": "My guess is you are best off to use a kind of serialize/deserialize step at the boundary."}, {"owner": {"reputation": 694, "user_id": 2463472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94951a17712ce069f2ea3b686836a6f2?s=128&d=identicon&r=PG", "display_name": "saurabh", "link": "https://stackoverflow.com/users/2463472/saurabh"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1496813748, "post_id": 44382115, "comment_id": 75807641, "body": "@RickyA Thanks. True that&#39;s the last option I have if there is no inbuilt support coming soon."}, {"owner": {"reputation": 1765, "user_id": 332798, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d47656e20ff5e42f125fc5ea0fd636c6?s=128&d=identicon&r=PG", "display_name": "tmm1", "link": "https://stackoverflow.com/users/332798/tmm1"}, "edited": false, "score": 1, "creation_date": 1514880973, "post_id": 44382115, "comment_id": 83087405, "body": "Here is the gomobile project issue about this feature: <a href=\"https://github.com/golang/go/issues/13445\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/13445</a>"}], "answers": [{"tags": [], "owner": {"reputation": 103, "user_id": 2141756, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5B1Za.png?s=128&g=1", "display_name": "Roman Vasilyev", "link": "https://stackoverflow.com/users/2141756/roman-vasilyev"}, "is_accepted": false, "score": 0, "last_activity_date": 1572544540, "last_edit_date": 1572544540, "creation_date": 1572544050, "answer_id": 58648801, "question_id": 44382115, "link": "https://stackoverflow.com/questions/44382115/golang-gomobile-tool-for-cross-platform-slices-of-struct-return-type/58648801#58648801", "title": "Golang - GoMobile tool for cross platform slices of struct return type", "body": "<p>I think currently nobody works on gomobile slice interface implementation.\nYou might want to check this convenience project.</p>\n\n<p><a href=\"https://github.com/scisci/go-mobile-collection\" rel=\"nofollow noreferrer\">https://github.com/scisci/go-mobile-collection</a></p>\n\n<p>and here is a simple example how you can share slice outside without any projects:</p>\n\n<pre><code>type MyType struct {\n        Id       int64\n        Name     string\n}\n\nvar (\n        items []MyType\n)\n\nfunc GetItemsCount() int {\n        return len(items)\n}\n\nfunc GetItem(i int) *MyItem {\n        if i &gt;= 0 &amp;&amp; i &lt; len(items) {\n                return &amp;items[i]\n        }\n        return nil\n}\n</code></pre>\n\n<p>In case of threads I'm usually adding mutex in code.</p>\n\n<p>We sharing our business logic (everything what we can move out from mobile native code) and it works perfect.\nUsing <code>gomobile 1.13</code> in <code>bind</code> mode. Only one WORKING solution for iOS/Android effective crossplatform development. React is good but takes more space.\nReally like Swift, but ~40mb lib deps in mobile app kills it. Using it in our apps: <a href=\"https://play.google.com/store/apps/details?id=com.lonje\" rel=\"nofollow noreferrer\">https://play.google.com/store/apps/details?id=com.lonje</a> and upcoming iOS release: <a href=\"https://apps.apple.com/us/app/lonje-anonymous-chat-video/id1215525783\" rel=\"nofollow noreferrer\">https://apps.apple.com/us/app/lonje-anonymous-chat-video/id1215525783</a></p>\n"}], "owner": {"reputation": 694, "user_id": 2463472, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/94951a17712ce069f2ea3b686836a6f2?s=128&d=identicon&r=PG", "display_name": "saurabh", "link": "https://stackoverflow.com/users/2463472/saurabh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 894, "favorite_count": 2, "answer_count": 1, "score": 5, "last_activity_date": 1572544540, "creation_date": 1496727690, "question_id": 44382115, "link": "https://stackoverflow.com/questions/44382115/golang-gomobile-tool-for-cross-platform-slices-of-struct-return-type", "title": "Golang - GoMobile tool for cross platform slices of struct return type", "body": "<p>During the journey of cross-platform mobile app development, I came across Golang which is having a GoMobile command line tool which generates language bindings that make it possible to call Go functions from Java and Objective-C. However, there are some restriction on the types used in an exported function/method as documented here: <a href=\"https://godoc.org/golang.org/x/mobile/cmd/gobind#hdr-Type_restrictions\" rel=\"noreferrer\">https://godoc.org/golang.org/x/mobile/cmd/gobind#hdr-Type_restrictions</a></p>\n\n<p>So any idea about the work in progress to support slices of struct (Array of struct) in the data types used in exported functions</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1496747482, "last_edit_date": 1496747482, "creation_date": 1496723772, "answer_id": 44381489, "question_id": 44381350, "link": "https://stackoverflow.com/questions/44381350/what-does-scan-advances-the-scanner-to-the-next-token-mean-in-gos-bufio-scann/44381489#44381489", "title": "What does &quot;Scan advances the Scanner to the next token&quot; mean in Go&#39;s bufio.Scanner?", "body": "<p>The token is defined by the scanner's <a href=\"https://godoc.org/bufio#SplitFunc\" rel=\"nofollow noreferrer\">split function</a>. Scan() returns when the split function finds a token or there's an error.</p>\n\n<p>The String() and Bytes() methods both return the current token. The String() method <a href=\"https://github.com/golang/go/blob/2d86f4942868c1309051062237cf4d424d588e9c/src/bufio/scan.go#L107\" rel=\"nofollow noreferrer\">returns a copy of the token</a>. The Bytes() method does not allocate memory and <a href=\"https://github.com/golang/go/blob/2d86f4942868c1309051062237cf4d424d588e9c/src/bufio/scan.go#L101\" rel=\"nofollow noreferrer\">returns a slice</a> that may use a backing array that's overwritten on a subsequent call to Scan().</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/SliceTricks#copy\" rel=\"nofollow noreferrer\">Copy the slice</a> returned from Bytes() to avoid this issue:</p>\n\n<pre><code>for scanner.Scan() {\n    bs = append(bs, append([]byte(nil), scanner.Bytes()...))\n}\n</code></pre>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 44381489, "answer_count": 1, "score": 0, "last_activity_date": 1496862452, "creation_date": 1496722792, "last_edit_date": 1496862452, "question_id": 44381350, "link": "https://stackoverflow.com/questions/44381350/what-does-scan-advances-the-scanner-to-the-next-token-mean-in-gos-bufio-scann", "title": "What does &quot;Scan advances the Scanner to the next token&quot; mean in Go&#39;s bufio.Scanner?", "body": "<p>According to <a href=\"https://golang.org/pkg/bufio/#Scanner.Scan\" rel=\"nofollow noreferrer\"><code>Scanner.scan documents</code></a>, <code>Scan()</code> <strong>advances the Scanner to the next token</strong>, but what does that mean? I find that <code>Scanner.Text</code> and <code>Scanner.Bytes</code> can be different, which is puzzling.</p>\n\n<p>This code doesn't always cause an error, but as the file becomes larger it does:</p>\n\n<pre><code>func TestScanner(t *testing.T) {\n    path := \"/tmp/test.txt\"\n    f, err := os.Open(path)\n    if err != nil {\n        panic(fmt.Sprint(\"failed to open \", path))\n    }\n    defer f.Close()\n    scanner := bufio.NewScanner(f)\n\n    bs := make([][]byte, 0)\n    for scanner.Scan() {\n        bs = append(bs, scanner.Bytes())\n    }\n\n    f, err = os.Open(path)\n    if err != nil {\n        panic(fmt.Sprint(\"failed to open \", path))\n    }\n    defer f.Close()\n    scanner = bufio.NewScanner(f)\n    ss := make([]string, 0)\n    for scanner.Scan() {\n        ss = append(ss, scanner.Text())\n    }\n\n    for i, b := range bs {\n        if string(b) != ss[i] {\n            t.Errorf(\"expect %s, got %s\", ss[i], string(b))\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1633, "user_id": 1757417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1aa37323f7419cdca7d483ff77ae2357?s=128&d=identicon&r=PG", "display_name": "Junchen", "link": "https://stackoverflow.com/users/1757417/junchen"}, "edited": false, "score": 0, "creation_date": 1496727883, "post_id": 44380935, "comment_id": 75764492, "body": "Thank you for the solution and for pointing me to the right literature!"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1496720036, "last_edit_date": 1496720036, "creation_date": 1496719662, "answer_id": 44380935, "question_id": 44380836, "link": "https://stackoverflow.com/questions/44380836/insert-into-a-map-as-a-field-of-map-in-golang/44380935#44380935", "title": "Insert into a map as a field of map in golang", "body": "<p>The <code>Init</code> method receiver <code>(fb foobar)</code> is a value. It should be a pointer <code>(fb *foobar)</code>. For example,</p>\n\n<pre><code>package main\n\ntype profile map[string]float64\n\ntype foobar struct {\n    foo profile\n    bar map[string]profile\n}\n\nfunc (fb *foobar) Init() {\n    fb.foo = make(profile)\n    fb.bar = make(map[string]profile)\n}\n\nfunc (fb foobar) Set() {\n    fb.bar[\"foo1\"] = make(profile)\n}\n\nfunc main() {\n    test := foobar{}\n    test.Init()\n    test.Set()\n}\n</code></pre>\n\n<p>Reference:</p>\n\n<p><a href=\"https://golang.org/doc/faq#methods_on_values_or_pointers\" rel=\"nofollow noreferrer\">Should I define methods on values or pointers?</a></p>\n"}], "owner": {"reputation": 1633, "user_id": 1757417, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1aa37323f7419cdca7d483ff77ae2357?s=128&d=identicon&r=PG", "display_name": "Junchen", "link": "https://stackoverflow.com/users/1757417/junchen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2339, "favorite_count": 1, "accepted_answer_id": 44380935, "answer_count": 1, "score": 1, "last_activity_date": 1496720036, "creation_date": 1496718863, "question_id": 44380836, "link": "https://stackoverflow.com/questions/44380836/insert-into-a-map-as-a-field-of-map-in-golang", "title": "Insert into a map as a field of map in golang", "body": "<p>I am trying to create a struct, one of whose fields is a map. However, I cannot initialize it with a method and then insert a value with another method. It reports error </p>\n\n<blockquote>\n  <p>panic: assignment to entry in nil map</p>\n</blockquote>\n\n<p>Coming from a Python background, I am confused on what I missed.</p>\n\n<p>Here is the goal playground <a href=\"https://play.golang.org/p/Vp3vl9Ow41\" rel=\"nofollow noreferrer\">snippet</a></p>\n\n<pre><code>package main\n\ntype profile map[string]float64\n\ntype foobar struct {\n    foo profile\n    bar map[string]profile\n}\n\nfunc (fb foobar) Init() {\n    fb.foo = make(profile)\n    fb.bar = make(map[string]profile)\n}\n\nfunc (fb foobar) Set() {\n    fb.bar[\"foo1\"] = make(profile)\n}\n\nfunc main() {\n    test := foobar{}\n    test.Init()\n    test.Set()\n}\n</code></pre>\n"}, {"tags": ["go", "google-cloud-platform", "google-cloud-storage"], "comments": [{"owner": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 0, "creation_date": 1496738757, "post_id": 44380835, "comment_id": 75770512, "body": "I got it too looks like some latest commit broke this library..."}, {"owner": {"reputation": 1794, "user_id": 6804645, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pjsvJ.png?s=128&g=1", "display_name": "JosMac", "link": "https://stackoverflow.com/users/6804645/josmac"}, "edited": false, "score": 0, "creation_date": 1496746292, "post_id": 44380835, "comment_id": 75775590, "body": "Now it seems to be OK again - deployment is working and issue on github for this problem was closed"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 3400323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7887c55ee414d6574196321b05535ce?s=128&d=identicon&r=PG&f=1", "display_name": "stran12", "link": "https://stackoverflow.com/users/3400323/stran12"}, "is_accepted": false, "score": 0, "last_activity_date": 1496854543, "creation_date": 1496854543, "answer_id": 44418639, "question_id": 44380835, "link": "https://stackoverflow.com/questions/44380835/golang-google-storage-copy-error/44418639#44418639", "title": "golang google storage copy error", "body": "<p>Answering my own question here, but there was a commit that broke the install. I filed a Github issue and they seemed to have fixed it. <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/issues/266\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/issues/266</a></p>\n"}], "owner": {"reputation": 11, "user_id": 3400323, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7887c55ee414d6574196321b05535ce?s=128&d=identicon&r=PG&f=1", "display_name": "stran12", "link": "https://stackoverflow.com/users/3400323/stran12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 190, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1558151716, "creation_date": 1496718858, "last_edit_date": 1558151716, "question_id": 44380835, "link": "https://stackoverflow.com/questions/44380835/golang-google-storage-copy-error", "title": "golang google storage copy error", "body": "<p>I get an error when trying to install google cloud storage SDK for Golang.</p>\n\n<pre><code>go get -u cloud.google.com/go/storage\n\n# cloud.google.com/go/storage\n../../../../cloud.google.com/go/storage/copy.go:81: cannot use \nres.TotalBytesRewritten (type int64) as type uint64 in argument to c.ProgressFunc\n../../../../cloud.google.com/go/storage/copy.go:81: cannot use \nres.ObjectSize (type int64) as type uint64 in argument to c.ProgressFunc\n</code></pre>\n\n<p>Has this happened to anyone else? How did you resolve this issue? Thank you in advance!</p>\n"}, {"tags": ["json", "go", "nested", "polymorphism", "unmarshalling"], "comments": [{"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 0, "creation_date": 1496740263, "post_id": 44380095, "comment_id": 75771499, "body": "maybe help <a href=\"https://stackoverflow.com/questions/32428797/unmarshal-to-a-interface-type\" title=\"unmarshal to a interface type\">stackoverflow.com/questions/32428797/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 5, "last_activity_date": 1496715190, "creation_date": 1496715190, "answer_id": 44380339, "question_id": 44380095, "link": "https://stackoverflow.com/questions/44380095/polymorphic-json-unmarshalling-of-embedded-structs/44380339#44380339", "title": "Polymorphic JSON unmarshalling of embedded structs", "body": "<p>Go's only polymorphism is interfaces. Embedding does not offer polymorphism.</p>\n\n<p>If you're trying to unmarshal JSON where you can't assume what type one of the fields is going to be, you can use a field of type <code>interface{}</code> along with type assertions, <code>fmt.Sprint</code>, or reflection. Which you should use depends on the particular use case - once you've got the value, what are you going to do with it? At some point you have to care if it's an <code>int</code> or a <code>string</code>, which will determine how you handle the value.</p>\n"}, {"comments": [{"owner": {"reputation": 2187, "user_id": 687647, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/RnuWl.jpg?s=128&g=1", "display_name": "Software Prophets", "link": "https://stackoverflow.com/users/687647/software-prophets"}, "edited": false, "score": 0, "creation_date": 1618064898, "post_id": 44380511, "comment_id": 118491893, "body": "As written, the else is never executed. The return err after the call to err := json.Unmarshal(js, &amp;v) causes the if/else not to occur when the data contents is not numeric (e.g., &quot;hi&quot;). With it present, the else (b.Y = v.Y.String()) never occurs. Additionally, the assignment of b.X doesn&#39;t happen. In the playground example, &quot;me&quot; is missing in the output because of this. Still, the example is helpful, so thanks @putu."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": false, "score": 2, "last_activity_date": 1496716861, "last_edit_date": 1496716861, "creation_date": 1496716528, "answer_id": 44380511, "question_id": 44380095, "link": "https://stackoverflow.com/questions/44380095/polymorphic-json-unmarshalling-of-embedded-structs/44380511#44380511", "title": "Polymorphic JSON unmarshalling of embedded structs", "body": "<p>As pointed by Adrian, Go does not support polymorphism through struct embedding. <code>interface{}</code> is the only way to hold any type of golang variable. However, in your case you can implement custom <code>Unmarshaler</code> to decode the JSON stream to a struct utilizing <code>json.Number</code> or <code>interface{}</code>.  Below is implementation using <code>json.Number</code>. For more generic <code>interface{}</code> version, you can implement it as suggested by Adrian. </p>\n\n<pre><code>func (b *B) UnmarshalJSON(js []byte) error {\n    //First: decode stream to anonymous struct\n    v := struct {\n        X string\n        Y json.Number\n    }{}\n\n    err := json.Unmarshal(js, &amp;v)\n    if err != nil {\n        return err\n    }\n\n    //Depends on the v.Y value, choose the holder variable\n    //If it's convertible to number, assign to A.Y\n    //otherwise, assign it to b.Y\n    b.X = v.X\n    if fv, err := v.Y.Float64(); err == nil {\n        b.A.Y = int(fv)\n    } else {\n        b.Y = v.Y.String()\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Working example can be found in <a href=\"https://play.golang.org/p/zOc3DMbYbY\" rel=\"nofollow noreferrer\">The Go Playground</a>.</p>\n"}], "owner": {"reputation": 1690, "user_id": 1436495, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d02ac35277cff6137edc0aa48a0e58cf?s=128&d=identicon&r=PG", "display_name": "crunk1", "link": "https://stackoverflow.com/users/1436495/crunk1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2515, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1496746510, "creation_date": 1496712879, "last_edit_date": 1496746510, "question_id": 44380095, "link": "https://stackoverflow.com/questions/44380095/polymorphic-json-unmarshalling-of-embedded-structs", "title": "Polymorphic JSON unmarshalling of embedded structs", "body": "<p>Here is an example (see also <a href=\"https://play.golang.org/p/or7z4Xc8tN\" rel=\"nofollow noreferrer\">https://play.golang.org/p/or7z4Xc8tN</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype A struct {\n    X string\n    Y int\n}\n\ntype B struct {\n    A\n    Y string \n}\n\nfunc main() {\n    data := []byte(`{\"X\": \"me\", \"Y\": \"hi\"}`)\n    b := &amp;B{}\n    json.Unmarshal(data, b)\n    fmt.Println(b)\n    fmt.Println(b.A)\n\n    b = &amp;B{}\n    data = []byte(`{\"X\": \"me\", \"Y\": 123}`)\n    json.Unmarshal(data, b)\n    fmt.Println(b)\n    fmt.Println(b.A)\n}\n</code></pre>\n\n<p>Which outputs:</p>\n\n<pre><code>&amp;{{me 0} hi}\n{me 0}\n&amp;{{me 0} }\n{me 0}\n</code></pre>\n\n<p>Is there a way to polymorphically unmarshal the field Y to either an int or a string? Or even unmarshal into A.Y at all since B.Y is defined?</p>\n\n<p>I know some might suggest unmarshalling with something like <code>json.Unmarshall(data, &amp;b.A)</code>, but I don't know if I can fit that into my current design.</p>\n"}, {"tags": ["go", "directory", "iteration", "directory-structure"], "answers": [{"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1496754799, "post_id": 44385800, "comment_id": 75781779, "body": "Bravo! You&#39;ve made it more simpler than I thought! Thanks!"}, {"owner": {"reputation": 866, "user_id": 3109648, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/47adb31375d41364cdeb9b4cdfdb8a2f?s=128&d=identicon&r=PG&f=1", "display_name": "Ryan Chou", "link": "https://stackoverflow.com/users/3109648/ryan-chou"}, "edited": false, "score": 0, "creation_date": 1513933225, "post_id": 44385800, "comment_id": 82846190, "body": "Excellent Implementation~"}], "tags": [], "owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "is_accepted": true, "score": 6, "last_activity_date": 1496739973, "creation_date": 1496739973, "answer_id": 44385800, "question_id": 44380054, "link": "https://stackoverflow.com/questions/44380054/how-to-iterate-through-directory-ordered-based-on-the-file-time/44385800#44385800", "title": "How to Iterate through directory, ordered based on the file time", "body": "<p>I think, you should implement it by yourself, because <code>filepath.Walk</code> doesn't allow you to set order.</p>\n\n<p>Look at <a href=\"https://github.com/golang/go/blob/34b455da4484dee20e8c355b50d24680224b58f2/src/path/filepath/path.go#L393\" rel=\"noreferrer\">Walk</a> method. It calls <a href=\"https://github.com/golang/go/blob/34b455da4484dee20e8c355b50d24680224b58f2/src/path/filepath/path.go#L350\" rel=\"noreferrer\">walk</a>, which is relying on file names from <a href=\"https://github.com/golang/go/blob/34b455da4484dee20e8c355b50d24680224b58f2/src/path/filepath/path.go#L408\" rel=\"noreferrer\">readDirNames</a>. So basically, you should make your own <code>Walk</code> method with another <code>readDirNames</code> logic.</p>\n\n<p>Here's how you get files in the order of last-modified date (note, that I'm ignoring errors):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"sort\"\n)\n\ntype ByModTime []os.FileInfo\n\nfunc (fis ByModTime) Len() int {\n    return len(fis)\n}\n\nfunc (fis ByModTime) Swap(i, j int) {\n    fis[i], fis[j] = fis[j], fis[i]\n}\n\nfunc (fis ByModTime) Less(i, j int) bool {\n    return fis[i].ModTime().Before(fis[j].ModTime())\n}\n\nfunc main() {\n    f, _ := os.Open(\"/\")\n    fis, _ := f.Readdir(-1)\n    f.Close()\n    sort.Sort(ByModTime(fis))\n\n    for _, fi := range fis {\n        fmt.Println(fi.Name())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1722, "favorite_count": 1, "accepted_answer_id": 44385800, "answer_count": 1, "score": 3, "last_activity_date": 1496755078, "creation_date": 1496712537, "last_edit_date": 1496755078, "question_id": 44380054, "link": "https://stackoverflow.com/questions/44380054/how-to-iterate-through-directory-ordered-based-on-the-file-time", "title": "How to Iterate through directory, ordered based on the file time", "body": "<p>Go provides a directory iteration functionality out of the box,  with <code>filepath.Walk</code> in the <code>path/filepath</code> package. </p>\n\n<p>However, <code>filepath.Walk</code> <a href=\"https://godoc.org/path/filepath#Walk\" rel=\"nofollow noreferrer\">walks the file tree in lexical order</a>. How can I walks the file tree in the order of last-modified date? Thx</p>\n\n<p><strong>PS</strong> (after accepting the answer) I think the Go <code>filepath.Walk</code> function should provide a way for people to provide the sorting themselves, like the following answer, in which accepting <code>type ByModTime</code> is all it take for people to sort the files themselves themselves. </p>\n"}, {"tags": ["regex", "go", "text", "replace"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 7987022, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4MVH5DSPUqA/AAAAAAAAAAI/AAAAAAAAADY/iMrRXhLM7hk/photo.jpg?sz=128", "display_name": "Daniel Furman", "link": "https://stackoverflow.com/users/7987022/daniel-furman"}, "edited": false, "score": 1, "creation_date": 1496795466, "post_id": 44382863, "comment_id": 75803100, "body": "Thank you so much! This is exactly what I was looking for."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1496730804, "creation_date": 1496730804, "answer_id": 44382863, "question_id": 44380031, "link": "https://stackoverflow.com/questions/44380031/regexp-replace-all-symbols-excluding-and/44382863#44382863", "title": "Regexp replace all symbols excluding # and @", "body": "<p>Capture the symbols you need to keep and replace with <code>$1</code> backreference to restore the captured part in the resulting string:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    s := \"^Hello, my #friend @\u0414\u0430\u043d\u0438\u0438\u043b%% \u4e2d\u82f1 \u5b57 \u5178!!.\"\n    re := regexp.MustCompile(`([#@])|[\\p{P}\\p{S}\\d]`)\n    s = re.ReplaceAllString(s, \"$1\")\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/LLUEtpmUby\" rel=\"nofollow noreferrer\">this Go demo</a> printing <code>Hello my #friend @\u0414\u0430\u043d\u0438\u0438\u043b \u4e2d\u82f1 \u5b57 \u5178</code>.</p>\n\n<p>Note that <code>^</code> does not belong to the <code>\\p{P}</code>  category, thus, I added <code>\\p{S}</code> one.</p>\n\n<p>The pattern is <code>([#@])|[\\p{P}\\p{S}\\d]</code>, see <a href=\"https://regex101.com/r/VQ2ZZh/1\" rel=\"nofollow noreferrer\">its online demo</a>.</p>\n\n<p><strong>Details</strong>:</p>\n\n<ul>\n<li><code>([#@])</code> - Capturing group 1 (referred to with <code>$1</code> / <code>${1}</code> from the replacement pattern) matching a <code>#</code> or <code>@</code></li>\n<li><code>|</code> - or </li>\n<li><code>[\\p{P}\\p{S}\\d]</code> - a punctuation, symbol or digit char.</li>\n</ul>\n"}], "owner": {"reputation": 43, "user_id": 7987022, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4MVH5DSPUqA/AAAAAAAAAAI/AAAAAAAAADY/iMrRXhLM7hk/photo.jpg?sz=128", "display_name": "Daniel Furman", "link": "https://stackoverflow.com/users/7987022/daniel-furman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 44382863, "answer_count": 1, "score": 2, "last_activity_date": 1496731078, "creation_date": 1496712355, "last_edit_date": 1496731078, "question_id": 44380031, "link": "https://stackoverflow.com/questions/44380031/regexp-replace-all-symbols-excluding-and", "title": "Regexp replace all symbols excluding # and @", "body": "<p>I am not super confident with using regexp, but my end goal is to have something that is removing all symbols excluding <code>@</code> and <code>#</code>.</p>\n\n<p>What I have now is <strong><code>[\\\\p{P}\\\\d]</code></strong>.\nIt works fine but it also removes <code>@</code> and <code>#</code> which I need to keep.</p>\n\n<p>Here is the sample input string:</p>\n\n<pre><code>^Hello, my #friend @\u0414\u0430\u043d\u0438\u0438\u043b%% \u4e2d\u82f1 \u5b57 \u5178!!.\n</code></pre>\n\n<p>that I am trying to change into</p>\n\n<pre><code>Hello my #friend @\u0414\u0430\u043d\u0438\u0438\u043b \u4e2d\u82f1 \u5b57 \u5178\n</code></pre>\n"}, {"tags": ["arrays", "postgresql", "go"], "comments": [{"owner": {"reputation": 880, "user_id": 336441, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66bfa71ab98c964d1876cde3f175cc86?s=128&d=identicon&r=PG", "display_name": "Davinel", "link": "https://stackoverflow.com/users/336441/davinel"}, "reply_to_user": {"reputation": 5185, "user_id": 2180770, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/i1yKC.jpg?s=128&g=1", "display_name": "Melvin", "link": "https://stackoverflow.com/users/2180770/melvin"}, "edited": false, "score": 0, "creation_date": 1496714922, "post_id": 44379851, "comment_id": 75761195, "body": "@Melvin &quot;expected struct but got slice&quot;. I&#39;am querying only one row. So it is not it."}], "answers": [{"comments": [{"owner": {"reputation": 880, "user_id": 336441, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66bfa71ab98c964d1876cde3f175cc86?s=128&d=identicon&r=PG", "display_name": "Davinel", "link": "https://stackoverflow.com/users/336441/davinel"}, "edited": false, "score": 1, "creation_date": 1496754875, "post_id": 44385791, "comment_id": 75781833, "body": "Thank you. That is exactly what I needed."}], "tags": [], "owner": {"reputation": 5185, "user_id": 2180770, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/i1yKC.jpg?s=128&g=1", "display_name": "Melvin", "link": "https://stackoverflow.com/users/2180770/melvin"}, "is_accepted": true, "score": 13, "last_activity_date": 1496739951, "creation_date": 1496739951, "answer_id": 44385791, "question_id": 44379851, "link": "https://stackoverflow.com/questions/44379851/get-postgresql-array-into-struct-with-structscan/44385791#44385791", "title": "Get postgresql array into struct with StructScan", "body": "<p>Try using <code>pq.StringArray</code> type for []string</p>\n\n<pre><code>type MyStruct struct {\n    Id   int\n    Data pq.StringArray\n}\n</code></pre>\n"}], "owner": {"reputation": 880, "user_id": 336441, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/66bfa71ab98c964d1876cde3f175cc86?s=128&d=identicon&r=PG", "display_name": "Davinel", "link": "https://stackoverflow.com/users/336441/davinel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2586, "favorite_count": 2, "accepted_answer_id": 44385791, "answer_count": 1, "score": 4, "last_activity_date": 1568447213, "creation_date": 1496710732, "last_edit_date": 1568447213, "question_id": 44379851, "link": "https://stackoverflow.com/questions/44379851/get-postgresql-array-into-struct-with-structscan", "title": "Get postgresql array into struct with StructScan", "body": "<p>Test data:</p>\n\n<pre><code>CREATE TABLE test (id int, data text[])\nINSERT INTO test(id, data) VALUES(1, '{a,b,c}')\n</code></pre>\n\n<p>Go Code. First - one that is working just fine:</p>\n\n<pre><code>func main() {\n  db, _ := sqlx.Open(\"postgres\", \"user=postgres dbname=test sslmode=disable\")\n  var id int\n  var asSlice []string\n  err := db.QueryRowx(`SELECT id, data FROM test WHERE data @&gt; ARRAY['b']`).Scan(&amp;id, pq.Array(&amp;asSlice))\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Println(id, asSlice)\n}\n</code></pre>\n\n<p>I get <code>1 [a b c]</code> as expected.\nBut here I manually assign results to the variables</p>\n\n<p>Now, to the part that is not working - using StructScan</p>\n\n<pre><code>type MyStruct struct {\n    Id   int\n    Data []string\n}\n\nfunc main() {\n    db, _ := sqlx.Open(\"postgres\", \"user=postgres dbname=test sslmode=disable\")\n    var testStruct MyStruct\n    err := db.QueryRowx(`SELECT id, data FROM test WHERE data @&gt; ARRAY['b']`).StructScan(&amp;testStruct)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(testStruct)\n}\n\nsql: Scan error on column index 1: unsupported Scan, storing driver.Value type []uint8 into type *[]string\n</code></pre>\n\n<p>I guess that means that sqlx does not know about PostgreSQL arrays and does not use <code>pq.Array</code> internally. </p>\n\n<p>What should I do about it? Maybe I am doing something wrong? Or maybe I should apply <code>pq.Array</code> manually? If so - how?</p>\n"}, {"tags": ["go", "version", "powerpc"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1496696178, "post_id": 44377492, "comment_id": 75756042, "body": "Sounds like you&#39;re not running this line: <code>export PATH=$PATH:&#47;usr&#47;local&#47;go&#47;bin</code>.  Go has to be in your path in order for the <code>go</code> command to mean anything to the OS."}, {"owner": {"reputation": 31, "user_id": 6406563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba071945b922d55047f49faaccc443e0?s=128&d=identicon&r=PG&f=1", "display_name": "Var Kar Cher", "link": "https://stackoverflow.com/users/6406563/var-kar-cher"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496696441, "post_id": 44377492, "comment_id": 75756147, "body": "I&#39;m actually trying to not install it in <code>&#47;usr&#47;local</code> therefore I am trying to do the following two lines that appear in the step-by-step guide: <code>export GOROOT=$HOME&#47;go</code>, <code>export PATH=$PATH:$GOROOT&#47;bin</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496696970, "post_id": 44377492, "comment_id": 75756359, "body": "Don&#39;t go by random, possibly out of date blog posts, just check the official documentation: <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>. If you&#39;ve installed it and the <code>go</code> binary isn&#39;t found, it just means you haven&#39;t properly updated your PATH."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496697271, "post_id": 44377492, "comment_id": 75756481, "body": "Where did you install Go at?  Is it actually <i>installed</i> at <code>$HOME&#47;go</code>?"}, {"owner": {"reputation": 31, "user_id": 6406563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba071945b922d55047f49faaccc443e0?s=128&d=identicon&r=PG&f=1", "display_name": "Var Kar Cher", "link": "https://stackoverflow.com/users/6406563/var-kar-cher"}, "edited": false, "score": 0, "creation_date": 1496698503, "post_id": 44377492, "comment_id": 75756955, "body": "Reinstalled and now I get  <code>-bash: &#47;home&#47;cherukr2&#47;go&#47;bin&#47;go: cannot execute binary file: Exec format error</code>  I am pretty sure this error has to do with this being the wrong version for the Minski machine. Do you know what version I should be using by any chance?"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1496699749, "post_id": 44377492, "comment_id": 75757467, "body": "@VarKarCher: Try <a href=\"https://storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz\" rel=\"nofollow noreferrer\">storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1496699788, "post_id": 44377492, "comment_id": 75757484, "body": "If you meant you have a &quot;Minksy&quot; machine, which IIRC has a Power8 cpu, installing the amd64 architecture is not going to work. Download the appropriate ppc version, or follow the directions for building from source: <a href=\"https://golang.org/doc/install/source\" rel=\"nofollow noreferrer\">golang.org/doc/install/source</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1496699957, "post_id": 44377492, "comment_id": 75757559, "body": "@JimB: Go officially supports the Linux OS and the ppc64le architecture: System requirements <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a>"}, {"owner": {"reputation": 31, "user_id": 6406563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba071945b922d55047f49faaccc443e0?s=128&d=identicon&r=PG&f=1", "display_name": "Var Kar Cher", "link": "https://stackoverflow.com/users/6406563/var-kar-cher"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1496700183, "post_id": 44377492, "comment_id": 75757640, "body": "@peterSO, it worked. That was what I was looking for. Thank You"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 3, "last_activity_date": 1496701389, "last_edit_date": 1496701389, "creation_date": 1496701073, "answer_id": 44378550, "question_id": 44377492, "link": "https://stackoverflow.com/questions/44377492/powerpc-version-of-go/44378550#44378550", "title": "PowerPC version of Go", "body": "<p><a href=\"https://golang.org/dl/\" rel=\"nofollow noreferrer\">Go Downloads</a></p>\n\n<p>PowerPC architecture: ppc64le (64-bit PowerPC little-endian). For example, for Go 1.8.3,</p>\n\n<p>go1.8.3.linux-ppc64le.tar.gz: <a href=\"https://storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz\" rel=\"nofollow noreferrer\">https://storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz</a></p>\n"}], "owner": {"reputation": 31, "user_id": 6406563, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba071945b922d55047f49faaccc443e0?s=128&d=identicon&r=PG&f=1", "display_name": "Var Kar Cher", "link": "https://stackoverflow.com/users/6406563/var-kar-cher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1744, "favorite_count": 1, "accepted_answer_id": 44378550, "answer_count": 1, "score": 2, "last_activity_date": 1496701389, "creation_date": 1496695917, "last_edit_date": 1496701204, "question_id": 44377492, "link": "https://stackoverflow.com/questions/44377492/powerpc-version-of-go", "title": "PowerPC version of Go", "body": "<p>I just got access to a powerful Minski IBM machine (Linux) and intend on running some go scripts on it. I have gone through a lot of the versions of golang and tried installing and using them on the machine but none of them seem to work. Is there some special version of GO that I need that is specially designed to work on this powerful computer.</p>\n\n<p>I have now tried installing about 4 or 5 different versions but still keep getting:</p>\n\n<pre><code>The program 'go' is currently not installed. To run 'go' please ask your administrator to install the package 'golang-go'\n</code></pre>\n\n<p>I was told that there is no need for an administrator to do a system wide install and to just install golang on my machine.</p>\n\n<p>I have been using this step-by-step to install GO on this machine:\n<a href=\"https://www.digitalocean.com/community/tutorials/how-to-install-go-1-6-on-ubuntu-14-04\" rel=\"nofollow noreferrer\">https://www.digitalocean.com/community/tutorials/how-to-install-go-1-6-on-ubuntu-14-04</a></p>\n\n<p>I do not have root access on this machine, just FYI</p>\n\n<p><strong>EDIT:</strong>\nProblem solved</p>\n\n<p>Had to use: </p>\n\n<pre><code>curl -O storage.googleapis.com/golang/go1.8.3.linux-ppc64le.tar.gz\n</code></pre>\n"}, {"tags": ["go", "error-handling", "lib"], "comments": [{"owner": {"reputation": 1273, "user_id": 2287427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b12dacf80e8ab397c3fdcd4f0d49c32d?s=128&d=identicon&r=PG", "display_name": "Dave S", "link": "https://stackoverflow.com/users/2287427/dave-s"}, "edited": false, "score": 0, "creation_date": 1496696125, "post_id": 44377454, "comment_id": 75756024, "body": "Like everything &quot;it depends.&quot;  If you throw it yourself it should be an exception that can be caught, not an error.  Either way the behavior needs to be documented.  Catchable exception vs. returned error depends on language, other libraries, the audience."}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "reply_to_user": {"reputation": 1273, "user_id": 2287427, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b12dacf80e8ab397c3fdcd4f0d49c32d?s=128&d=identicon&r=PG", "display_name": "Dave S", "link": "https://stackoverflow.com/users/2287427/dave-s"}, "edited": false, "score": 0, "creation_date": 1496696291, "post_id": 44377454, "comment_id": 75756078, "body": "i added the language i use as a tag, but as Golang is awefully fond of <code>if err != nil</code> i was thinking of maybe just returning an <code>error.New()</code> ?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496696896, "post_id": 44377454, "comment_id": 75756328, "body": "You never panic in libraries."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496714794, "post_id": 44377454, "comment_id": 75761172, "body": "The standard in Go is to return an error for anything expected or recoverable, and panic only in the event of an unexpected, unrecoverable error (almost never). Follow the lead set by the standard library."}], "answers": [{"tags": [], "owner": {"reputation": 1511, "user_id": 495504, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/ee8d8278b0394be64c52abc8d7c4ca17?s=128&d=identicon&r=PG", "display_name": "Eric Pauley", "link": "https://stackoverflow.com/users/495504/eric-pauley"}, "is_accepted": false, "score": 2, "last_activity_date": 1497893889, "last_edit_date": 1497893889, "creation_date": 1496930679, "answer_id": 44437957, "question_id": 44377454, "link": "https://stackoverflow.com/questions/44377454/how-to-throw-errors-in-a-lib/44437957#44437957", "title": "How to throw errors in a lib", "body": "<p>I recommend reading over The Go Blog article <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">Error Handling and Go</a> and <a href=\"https://golang.org/doc/effective_go.html#errors\" rel=\"nofollow noreferrer\">Effective Go</a> on errors, which take a look at the power of Go's error type.</p>\n\n<p>In general panics are okay to use within a library/package, but they should not propagate outside of the package unless there is a fatal error. In other words, developers should never have to write code that expects panics form your library.</p>\n\n<p>You can use panics internally if managing the propagation of errors is tedious. In that case you can wrap your public functions with a defer/recover handler which passes the error </p>\n\n<pre><code>func Function() (err error) {\n    defer func() {\n        if r := recover(); r != nil {\n            err = r.(error)\n        }\n    }()\n    // Do stuff\n    panic(errors.New(\"Error Message\"))\n}\n</code></pre>\n\n<p>This sample is adapted from the <code>json</code> package of the standard library, where internal panics are used to clean up complicated nested error handling.</p>\n"}], "owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 427, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1497893889, "creation_date": 1496695753, "last_edit_date": 1496696222, "question_id": 44377454, "link": "https://stackoverflow.com/questions/44377454/how-to-throw-errors-in-a-lib", "title": "How to throw errors in a lib", "body": "<p>I am currently building a small lib for reading / writing / moving files around concurrently.\nWhile doing this i ran into the problem of error handling which lead me to think:</p>\n\n<p><strong>should i throw an error inside the lib and have the user's entire app crash, or return an error message for the user to handle ?</strong></p>\n\n<p>I would like to know which is best for the given situation and why.</p>\n"}, {"tags": ["regex", "string", "go", "quotes"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user557597"}, "edited": false, "score": 0, "creation_date": 1496703196, "post_id": 44376517, "comment_id": 75758605, "body": "The problem is quotes are paired and being between letters has nothing to do with it unless letters are a delimiter for quotes. Even that is moot since in <code>aadsfsdf&quot;&quot;&quot;&quot;asdf</code>, nothing changes."}], "answers": [{"comments": [{"owner": {"reputation": 554, "user_id": 1978082, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ufVuL.jpg?s=128&g=1", "display_name": "HenioJR", "link": "https://stackoverflow.com/users/1978082/heniojr"}, "edited": false, "score": 0, "creation_date": 1496692771, "post_id": 44376663, "comment_id": 75754417, "body": "var a was a bad example. My var a = &quot;\\&quot;test1\\&quot;,\\&quot;test2\\&quot;,\\&quot;tes\\&quot;t3\\&quot;&quot;. I want to only quote insite test3."}], "tags": [], "owner": {"reputation": 313, "user_id": 282716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0b27576457715ccbe6caed72584f9ba2?s=128&d=identicon&r=PG", "display_name": "Andrius", "link": "https://stackoverflow.com/users/282716/andrius"}, "is_accepted": false, "score": 0, "last_activity_date": 1496693762, "last_edit_date": 1496693762, "creation_date": 1496692457, "answer_id": 44376663, "question_id": 44376517, "link": "https://stackoverflow.com/questions/44376517/remove-quotes-between-letters/44376663#44376663", "title": "Remove quotes between letters", "body": "<p>In your example you define a string variable so the outer quotes are not part of the actual string. If you would do <code>fmt.Println(\"bus\\\"zipcode\")</code> the output on the screen would be <code>bus\"zipcode</code>. If your goal is to replace quotes in a string with a space then you need to replace the quote not with an empty string as you do, but rather with a space - <code>s = strings.Replace(s, \"\\\"\", \" \", -1)</code>. Though if you want to remove the quotes entirely you can do something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc RemoveQuotes(s string) string {\n    result := \"\"\n    arr := strings.Split(s, \",\")\n    for i:=0;i&lt;len(arr);i++ {\n       sub := strings.Replace(arr[i], \"\\\"\", \"\", -1)\n       result = fmt.Sprintf(\"%s,\\\"%s\\\"\", result, sub)\n    }\n\n    return result[1:]\n}\n\nfunc main() {\n    a:= \"\\\"test1\\\",\\\"test2\\\",\\\"tes\\\"t3\\\"\"\n    fmt.Println(RemoveQuotes(a))\n}\n</code></pre>\n\n<p>Note however that this is not very efficient, but I assume it's more about learning how to do it in this case.</p>\n"}, {"comments": [{"owner": {"reputation": 554, "user_id": 1978082, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ufVuL.jpg?s=128&g=1", "display_name": "HenioJR", "link": "https://stackoverflow.com/users/1978082/heniojr"}, "edited": false, "score": 0, "creation_date": 1496694449, "post_id": 44376945, "comment_id": 75755208, "body": "Thanks for answer @Gerep . But your code retorn &quot;test1,test2,test3&quot;, I&#39;d like to &quot;test1&quot;,&quot;test2&quot;,&quot;test3&quot;."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "is_accepted": false, "score": 0, "last_activity_date": 1496693629, "creation_date": 1496693629, "answer_id": 44376945, "question_id": 44376517, "link": "https://stackoverflow.com/questions/44376517/remove-quotes-between-letters/44376945#44376945", "title": "Remove quotes between letters", "body": "<p>I am not sure about what you need when you commented <code>I want to only quote inside test3</code>.</p>\n\n<p>This code is removing the quotes from the inside, as you did, but it is adding the quotes with <code>fmt.Sprintf()</code></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    var a = \"\\\"test1\\\",\\\"test2\\\",\\\"tes\\\"t3\\\"\"\n    fmt.Println(RemoveQuotes(a))\n}\n\nfunc RemoveQuotes(s string) string {\n    s = strings.Replace(s, \"\\\"\", \"\", -1) //here I removed all quotes. I'd like to remove only quotes between letters\n\n    return fmt.Sprintf(`\"%s\"`, s)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/dKB9DwYXZp\" rel=\"nofollow noreferrer\">https://play.golang.org/p/dKB9DwYXZp</a></p>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 3, "last_activity_date": 1496694774, "creation_date": 1496694774, "answer_id": 44377226, "question_id": 44376517, "link": "https://stackoverflow.com/questions/44376517/remove-quotes-between-letters/44377226#44377226", "title": "Remove quotes between letters", "body": "<p>You may use a simple <code>\\b\"\\b</code> regex that matches a double quote only when preceded <em>and</em> followed with word boundaries:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    var a = \"\\\"test1\\\",\\\"test2\\\",\\\"tes\\\"t3\\\"\"\n    fmt.Println(RemoveQuotes(a))\n}\n\nfunc RemoveQuotes(s string) string {\n    re := regexp.MustCompile(`\\b\"\\b`)\n    return re.ReplaceAllString(s, \"\")\n}\n</code></pre>\n\n<p>See the <a href=\"https://play.golang.org/p/3WS3Bgxr-E\" rel=\"nofollow noreferrer\">Go demo</a> printing <code>\"test1\",\"test2\",\"test3\"</code>.</p>\n\n<p>Also, see the <a href=\"https://regex101.com/r/AjJPLy/1\" rel=\"nofollow noreferrer\">online regex demo</a>.</p>\n"}], "owner": {"reputation": 554, "user_id": 1978082, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ufVuL.jpg?s=128&g=1", "display_name": "HenioJR", "link": "https://stackoverflow.com/users/1978082/heniojr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 44377226, "answer_count": 3, "score": 0, "last_activity_date": 1496694774, "creation_date": 1496691788, "question_id": 44376517, "link": "https://stackoverflow.com/questions/44376517/remove-quotes-between-letters", "title": "Remove quotes between letters", "body": "<p>In golang, how can I remove quotes between two letters, like that:</p>\n\n<pre><code>import (\n    \"testing\"\n)\n\nfunc TestRemoveQuotes(t *testing.T) {\n    var a = \"bus\\\"zipcode\"\n    var mockResult = \"bus zipcode\"\n    a = RemoveQuotes(a)\n\n    if a != mockResult {\n        t.Error(\"Error or TestRemoveQuotes: \", a)\n    }\n}\n</code></pre>\n\n<p>Function:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc RemoveQuotes(s string) string {\n    s = strings.Replace(s, \"\\\"\", \"\", -1) //here I removed all quotes. I'd like to remove only quotes between letters\n\n    fmt.Println(s)\n\n    return s\n}\n</code></pre>\n\n<p>For example:</p>\n\n<blockquote>\n  <p>\"bus\"zipcode\" = \"bus zipcode\"</p>\n</blockquote>\n"}, {"tags": ["go", "protocol-buffers", "code-completion", "bazel"], "answers": [{"tags": [], "owner": {"reputation": 26173, "user_id": 1891, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/c40d475927f7a86639ec54aa32517572?s=128&d=identicon&r=PG", "display_name": "Jay Conrod", "link": "https://stackoverflow.com/users/1891/jay-conrod"}, "is_accepted": false, "score": 4, "last_activity_date": 1496759967, "creation_date": 1496759967, "answer_id": 44392998, "question_id": 44375665, "link": "https://stackoverflow.com/questions/44375665/bazel-build-protobuf-and-code-completion/44392998#44392998", "title": "Bazel build, protobuf and code completion", "body": "<p>I'm one of the engineers working on the Go rules for Bazel. Unfortunately, I don't have a good answer for you right now, but this issue is on our radar, and the Go team is working on a general long-term solution. I've filed <a href=\"https://github.com/bazelbuild/rules_go/issues/512\" rel=\"nofollow noreferrer\">bazelbuild/rules_go#512</a> on our GitHub repo to track this issue, and I'll update this answer when we have a better solution.</p>\n\n<p>The problem is Bazel stores generated code and other artifacts in its own internal directory that editors aren't aware of. We're designing and building a new workspace abstraction mechanism that will allow tools (editors, IDEs, tools like guru) to understand all of sources, generated files, packages, imports, and other metadata in a repository without needing to integrate directly with Bazel or other build systems.</p>\n\n<p>As a temporary workaround, try generating the .pb.go files manually with protoc. You can check those files into your repository but not include them in your BUILD files. This should make editors and IDEs aware of the generated files, but you'll still produce new, up-to-date versions of them when you compile.</p>\n"}, {"tags": [], "owner": {"reputation": 1620, "user_id": 1305362, "user_type": "registered", "accept_rate": 45, "profile_image": "https://i.stack.imgur.com/Wo49Y.jpg?s=128&g=1", "display_name": "Zebra Propulsion Lab", "link": "https://stackoverflow.com/users/1305362/zebra-propulsion-lab"}, "is_accepted": false, "score": 0, "last_activity_date": 1531718398, "creation_date": 1531718398, "answer_id": 51354997, "question_id": 44375665, "link": "https://stackoverflow.com/questions/44375665/bazel-build-protobuf-and-code-completion/51354997#51354997", "title": "Bazel build, protobuf and code completion", "body": "<p>I ran into the same issue with <a href=\"https://buckbuild.com/\" rel=\"nofollow noreferrer\">Buck</a> too, and implemented a <a href=\"https://github.com/facebook/buck/pull/1927\" rel=\"nofollow noreferrer\">workaround</a> to have Buck copying generated code to <code>vendor</code> folder.</p>\n\n<p>Looking forward to the workspace abstraction mechanism in Go though.</p>\n"}], "owner": {"reputation": 373, "user_id": 6181757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/10006386199dbe8b8dadb58862c5941b?s=128&d=identicon&r=PG", "display_name": "Andrija \u010cehko", "link": "https://stackoverflow.com/users/6181757/andrija-%c4%8cehko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1488, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1531718398, "creation_date": 1496688375, "question_id": 44375665, "link": "https://stackoverflow.com/questions/44375665/bazel-build-protobuf-and-code-completion", "title": "Bazel build, protobuf and code completion", "body": "<p>When using <a href=\"https://bazel.build/\" rel=\"nofollow noreferrer\">Bazel</a> to build a project that contains <code>.proto</code> files, we can use, for example, <code>go_binary</code> and <code>go_proto_library</code> rules to create a binary. The generated binary will work as expected, but the code generated from the <code>.proto</code> files is not in the working directory.</p>\n\n<p>As a result, code completion in editors and IDEs will not work. Even worse, they will often print errors about invalid import statements.</p>\n\n<p>This is an example using protocol buffers, but there are probably other similar cases, such as using third party dependencies.</p>\n\n<p>How is this usually handled?</p>\n"}, {"tags": ["arrays", "go", "initialization", "idioms"], "comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496689958, "post_id": 44375648, "comment_id": 75753022, "body": "Why not use a global var instead of a constant?  I mean, you don&#39;t get the &quot;constant&quot; protection, but as long as the variable isn&#39;t exported, only your own package could mess with it anyway."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1496692248, "last_edit_date": 1496692248, "creation_date": 1496690080, "answer_id": 44376097, "question_id": 44375648, "link": "https://stackoverflow.com/questions/44375648/workaround-for-lack-of-support-for-array-constants/44376097#44376097", "title": "Workaround for lack of support for array constants?", "body": "<p>The idiomatic approach is to use a package level variable:</p>\n\n<pre><code>var facename = []string{\"top\", \"bottom\", \"left\", \"right\", \"front\", \"back\"}\n\nfunc foo() {\n    // ...\n    fmt.Println(facename[f])\n    // ...\n}\n</code></pre>\n\n<p>It's also idiomatic to use a slice instead of an array in this situation.</p>\n"}, {"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691062, "post_id": 44376292, "comment_id": 75753573, "body": "Incidentally, this won&#39;t compile, since the <code>String()</code> method does not have a guaranteed return value.  If the given <code>Face</code> is not in the iota list (ie you manually created it, as in <code>var f = Face(25)</code>, no case will be matched, and thus String() will not have a return.  The compiler blocks this, as there&#39;s a valid decision tree in which a return value is not present."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691130, "post_id": 44376292, "comment_id": 75753603, "body": "Also, your iotas are not of type Face in this example, so String() cannot be called on them.  You need the first iota line to be <code>FaceTop Face = iota</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691211, "post_id": 44376292, "comment_id": 75753648, "body": "Good catch on both counts - the second is from too many edits. The first is because I usually have a separate zero value for my enums I can use as a semi-valid default case, like <code>FaceNone</code> or something, so that zeroes don&#39;t equate to any &quot;real&quot; value, but I don&#39;t have full visibility into OP&#39;s use case."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691321, "post_id": 44376292, "comment_id": 75753711, "body": "In most cases, I actually have the 0 iota be <code>Invalid</code>, so that a statement like <code>var f Face; f.String()</code> doesn&#39;t return valid data, and it&#39;s clear that the variable wasn&#39;t created using an iota constant."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691468, "post_id": 44376292, "comment_id": 75753787, "body": "The difference between 0 being called <code>Invalid</code> and <code>None</code> is down to semantics and personal preference; if having no value isn&#39;t valid, then the semantic difference disappears (none == invalid), and it&#39;s purely personal preference."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1496691531, "post_id": 44376292, "comment_id": 75753819, "body": "And actually in his example <code>switch</code> he defaults to <code>unknown</code> which is another (roughly equivalent) option to None or Invalid."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1496691132, "last_edit_date": 1496691132, "creation_date": 1496690893, "answer_id": 44376292, "question_id": 44375648, "link": "https://stackoverflow.com/questions/44375648/workaround-for-lack-of-support-for-array-constants/44376292#44376292", "title": "Workaround for lack of support for array constants?", "body": "<p>It may not be a good fit, but it <em>appears</em> your use case is basically an enum with string equivalents. For this I usually do something along the lines of:</p>\n\n<pre><code>type Face uint8\n\nconst (\n    FaceTop Face = iota\n    FaceBottom\n    FaceLeft\n    FaceRight\n    FaceFront\n    FaceBack\n)\n\nfunc (f Face) String() string {\n    switch f {\n    case FaceTop: return \"top\"\n    case FaceBottom: return \"bottom\"\n    case FaceLeft: return \"left\"\n    case FaceRight: return \"right\"\n    case FaceFront: return \"front\"\n    case FaceBack: return \"back\"\n    default: return \"\"  // Or add an error return, or add a zero value to the enum\n    }\n}\n\nfunc ParseFace(in string) (Face,error) {\n    switch in {\n    case \"top\": return FaceTop,nil\n    case \"bottom\": return FaceBottom,nil\n    case \"left\": return FaceLeft,nil\n    case \"right\": return FaceRight,nil\n    case \"front\": return FaceFront,nil\n    case \"back\": return FaceBack,nil\n    default: return \"\",errors.New(\"invalid face name\"+in)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "closed_date": 1496695152, "answer_count": 2, "score": -2, "last_activity_date": 1496692248, "creation_date": 1496688293, "question_id": 44375648, "link": "https://stackoverflow.com/questions/44375648/workaround-for-lack-of-support-for-array-constants", "closed_reason": "Duplicate", "title": "Workaround for lack of support for array constants?", "body": "<p>Go doesn't have array constants.</p>\n\n<p>My application receives messages containing several types of numeric codes which I need to display as phrases. </p>\n\n<p>If array contants existed I could do something like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func foo() {\n   ...\n   fmt.Println(facename[f])\n   ...\n}\nconst facename [...]string = \"top\", \"bottom\", \"left\", \"right\", \"front\", \"back\"\n</code></pre>\n\n<p>But of course there's no way to do this. The first way around this that occurs to me, and maybe a reasonable efficient one is to use a <code>switch</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func foo() {\n   ...\n   name := \"unknown\"\n   switch f {\n   case 0:\n      name = \"top\"\n   case 1:\n      name = \"bottom\"\n   case 2:\n      name = \"left\"\n   case 3:\n      name = \"right\"\n   case 4:\n      name = \"front\"\n   case 5:\n      name = \"back\"\n   }\n   fmt.Println(name)\n   ...\n}\n</code></pre>\n\n<p>The above is rather tedious if the number of values gets to be twenty or more.</p>\n\n<p>It seems the most concise way is something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func foo() {\n   ...\n   fmt.Println(strings.Split(facenames,\",\")[f])\n   ...\n}\nconst facenames = \"top,bottom,left,right,front,back\"\n</code></pre>\n\n<p>I will also have to check that the index is in range of course. \nAlthough efficiency isn't a concern at the moment, it bugs me that\nI'm using <code>strings.Split()</code> more than I want to.</p>\n\n<p>Is there another way that is either idiomatic or both concise and efficient?</p>\n"}, {"tags": ["go", "arguments"], "answers": [{"comments": [{"owner": {"reputation": 535, "user_id": 4243929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-EYd2u4koXNA/AAAAAAAAAAI/AAAAAAAAAY8/U_XHAUwPmGA/photo.jpg?sz=128", "display_name": "Christian Riese", "link": "https://stackoverflow.com/users/4243929/christian-riese"}, "edited": false, "score": 0, "creation_date": 1496685985, "post_id": 44374878, "comment_id": 75751003, "body": "Damn, thank you! You should read the error message before asking... thanks again!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 535, "user_id": 4243929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-EYd2u4koXNA/AAAAAAAAAAI/AAAAAAAAAY8/U_XHAUwPmGA/photo.jpg?sz=128", "display_name": "Christian Riese", "link": "https://stackoverflow.com/users/4243929/christian-riese"}, "edited": false, "score": 1, "creation_date": 1496686092, "post_id": 44374878, "comment_id": 75751055, "body": "Error messages usually have the answer, but it&#39;s not always clear what they&#39;re telling you..."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 5, "last_activity_date": 1496685364, "creation_date": 1496685364, "answer_id": 44374878, "question_id": 44374829, "link": "https://stackoverflow.com/questions/44374829/error-in-gos-slices-exercise/44374878#44374878", "title": "Error in Go&#39;s slices exercise", "body": "<p><code>pic.Show</code> takes a single argument of type <code>func(int, int) [][]uint8</code> - you need to pass it a function. You're passing the <em>result of executing</em> a <code>func(int, int) [][]uint8</code>, i.e. a <code>[][]uint8</code>. What you want would be:</p>\n\n<pre><code>pic.Show(Pic)\n</code></pre>\n\n<p>Passing in your function <code>Pic</code> itself, which meets the requirements.</p>\n"}], "owner": {"reputation": 535, "user_id": 4243929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh5.googleusercontent.com/-EYd2u4koXNA/AAAAAAAAAAI/AAAAAAAAAY8/U_XHAUwPmGA/photo.jpg?sz=128", "display_name": "Christian Riese", "link": "https://stackoverflow.com/users/4243929/christian-riese"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 44374878, "answer_count": 1, "score": 1, "last_activity_date": 1496685364, "creation_date": 1496685191, "question_id": 44374829, "link": "https://stackoverflow.com/questions/44374829/error-in-gos-slices-exercise", "title": "Error in Go&#39;s slices exercise", "body": "<p>I'm trying to solve the slices exercise. My current solution is</p>\n\n<pre><code>package main\n\nimport \"golang.org/x/tour/pic\"\n\nfunc Pic(dx, dy int) [][]uint8 {\n    picture := make([][]uint8, dy)\n\n    x := dx\n\n    for iy := 0; iy &lt; dy; iy++ {\n        picture[iy] = make([]uint8, dx)\n\n        for ix := 0; ix &lt; dx; ix++ {\n            x = (x+dy)/2\n            picture[iy][ix] = uint8(x)\n        }\n    }\n\n    return picture\n}\n\nfunc main() {\n    pic.Show(Pic(1,2))\n}\n</code></pre>\n\n<p>But I'm getting the following error</p>\n\n<blockquote>\n  <p>tmp/sandbox931798243/main.go:23: cannot use Pic(1, 2) (type [][]uint8)\n  as type func(int, int) [][]uint8 in argument to pic.Show</p>\n</blockquote>\n\n<p>What am I doing wrong? Might that be a bug with the sandbox?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1496675652, "creation_date": 1496675652, "answer_id": 44372105, "question_id": 44371865, "link": "https://stackoverflow.com/questions/44371865/json-cannot-unmarshal-array-into-go-value-of-type-main-posts/44372105#44372105", "title": "json: cannot unmarshal array into Go value of type main.Posts", "body": "<p>That JSON is, at its root, an array. You're trying to unmarshal it into an object, which contains, as a field, an array - hence the error that you passed an object when the JSON is an array. You want to pass an array (or slice, really), as in:</p>\n\n<pre><code>type Post struct {\n    UserId int `json:\"userId\"`\n    ID int `json:\"id\"`\n    Title string `json:\"title\"`\n    Body string `json:\"body\"`\n}\n\n//...\n\nvar posts []Post\nerr := json.Unmarshal([]byte(content), &amp;posts)\n\n// Check err, do stuff with posts\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 205, "user_id": 2232794, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/sBlS3.jpg?s=128&g=1", "display_name": "htkaya", "link": "https://stackoverflow.com/users/2232794/htkaya"}, "is_accepted": true, "score": 3, "last_activity_date": 1496675795, "creation_date": 1496675795, "answer_id": 44372148, "question_id": 44371865, "link": "https://stackoverflow.com/questions/44371865/json-cannot-unmarshal-array-into-go-value-of-type-main-posts/44372148#44372148", "title": "json: cannot unmarshal array into Go value of type main.Posts", "body": "<p>Posts is an array of Post struct but you defined Post as array it is your first mistake, also Unmarshal doesn't returns result it returns only error and fills given parameter.</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"encoding/json\"\n)\n\ntype Post struct {\n        UserId int `json:\"userId\"`\n        ID int `json:\"id\"`\n        Title string `json:\"title\"`\n        Body string `json:\"body\"`\n}\n\ntype Posts []Post\n\n\nfunc main (){\n    resp, err := http.Get(\"https://jsonplaceholder.typicode.com/posts\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    content, _ := ioutil.ReadAll(resp.Body)\n\n    var posts Posts\n\n    err = json.Unmarshal(content, &amp;posts)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    fmt.Println(posts[0].Body)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 393, "user_id": 1950386, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/ZIEO0.jpg?s=128&g=1", "display_name": "htunc", "link": "https://stackoverflow.com/users/1950386/htunc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3495, "favorite_count": 0, "accepted_answer_id": 44372148, "answer_count": 2, "score": 2, "last_activity_date": 1496675795, "creation_date": 1496674921, "question_id": 44371865, "link": "https://stackoverflow.com/questions/44371865/json-cannot-unmarshal-array-into-go-value-of-type-main-posts", "title": "json: cannot unmarshal array into Go value of type main.Posts", "body": "<p>I'm trying to read a json file with golang but i'm getting this error. \nI've checked almost every question about it but still couldnt get it. </p>\n\n<p>Here's the example json file: \n<a href=\"https://jsonplaceholder.typicode.com/posts\" rel=\"nofollow noreferrer\">https://jsonplaceholder.typicode.com/posts</a></p>\n\n<p>And my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"log\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"encoding/json\"\n)\n\ntype Posts struct {\n    Post []struct{\n        UserId int `json:\"userId\"`\n        ID int `json:\"id\"`\n        Title string `json:\"title\"`\n        Body string `json:\"body\"`\n    }\n}\n\nfunc main (){\n    resp, err := http.Get(\"https://jsonplaceholder.typicode.com/posts\")\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    content, _ := ioutil.ReadAll(resp.Body)\n\n    var posts Posts\n\n    parsed := json.Unmarshal([]byte(content), &amp;posts)\n\n    //fmt.Println(string(content))\n\n    fmt.Println(parsed)\n\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface"], "comments": [{"owner": {"reputation": 1536, "user_id": 6691722, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8e0d7ea4dc27c23764c2ec07207f08d?s=128&d=identicon&r=PG", "display_name": "0rka", "link": "https://stackoverflow.com/users/6691722/0rka"}, "edited": false, "score": 0, "creation_date": 1496672010, "post_id": 44370277, "comment_id": 75742963, "body": "When changing <code>* FilterInterface</code> to <code>FilterInterface</code> The line <code>_ = filtermap.AddFilter(fieldfilter)</code> now raises this: <b>cannot use fieldfilter (type coreinterfaces.FieldFilter) as type coreinterfaces.FilterInterface in argument to filtermap.AddFilter: coreinterfaces.FieldFilter does not implement coreinterfaces.FilterInterface (Filter method has pointer receiver)</b> However when changing the line to <code>_ = filtermap.AddFilter(&amp;fieldfilter)</code> it works. What happens here? why is that?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1496675394, "post_id": 44370277, "comment_id": 75745076, "body": "Because the methods that implement the interface have pointer receivers. Passing a value, it does not implement the interface; passing a pointer, it does, because the methods then apply. Generally speaking, when dealing with interfaces, you pass a pointer to a struct to a function that expects an interface. You almost never want a pointer to an interface in any scenario."}, {"owner": {"reputation": 1536, "user_id": 6691722, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8e0d7ea4dc27c23764c2ec07207f08d?s=128&d=identicon&r=PG", "display_name": "0rka", "link": "https://stackoverflow.com/users/6691722/0rka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496675739, "post_id": 44370277, "comment_id": 75745286, "body": "I understand your point, but by changing the parameter value from <code>* FilterInterface</code> to a struct that implements this interface, this breaks the idea of passing interfaces to functions. What I wanted to accomplish is not being bound to what struct I was passing, but rather <b>any</b> struct that implements the interface I&#39;m interested to use. Any code changes you might think be more efficient or up to standards for me to do? I&#39;ll be glad to use some code review services :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1496677096, "post_id": 44370277, "comment_id": 75746100, "body": "Your function should accept an interface argument (not pointer to interface). The caller should pass in a pointer to a struct that implements the interface. This does not &quot;break the idea of passing interfaces to functions&quot; - the function still takes an interface, you&#39;re passing in a concretion which implements the interface."}], "answers": [{"comments": [{"owner": {"reputation": 817, "user_id": 32122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2c929be789dc669b2901330ebdb5a9?s=128&d=identicon&r=PG", "display_name": "WPWoodJr", "link": "https://stackoverflow.com/users/32122/wpwoodjr"}, "edited": false, "score": 0, "creation_date": 1519089346, "post_id": 44372954, "comment_id": 84757084, "body": "&quot;This is because you&#39;re storing a copy of the original structure in the interface, so pointer methods would have unexpected effects (ie. unable to alter the original structure)&quot; - this doesn&#39;t make sense as the reason for the limitation.  After all, the only copy may have been stored in the interface all along."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1519142948, "post_id": 44372954, "comment_id": 84784082, "body": "Your answer there makes no sense.  You&#39;re assuming that the location at which the concrete type stored in the interface does not change when you change what&#39;s stored there, which is not the case, and that should be obvious if you&#39;re storing something with a different memory layout.  What you&#39;re not getting about my pointer comment is that a pointer receiver method on a concrete type can <i>always</i> modify the receiver it is being called on.  A value stored in an interface forces a copy that you cannot then get a reference to, so pointer receivers <i>cannot</i> modify the original, period."}], "tags": [], "owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "is_accepted": true, "score": 184, "last_activity_date": 1571124563, "last_edit_date": 1571124563, "creation_date": 1496678497, "answer_id": 44372954, "question_id": 44370277, "link": "https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion/44372954#44372954", "title": "&quot;&lt;type&gt; is pointer to interface, not interface&quot; confusion", "body": "<p>So you're confusing two concepts here.  A pointer to a struct and a pointer to an interface are not the same.  An interface can store either a struct directly <em>or</em> a pointer to a struct.  In the latter case, you still just use the interface directly, <em>not</em> a pointer to the interface.  For example:</p>\n\n<pre><code>type Fooer interface {\n    Dummy()\n}\n\ntype Foo struct{}\n\nfunc (f Foo) Dummy() {}\n\nfunc main() {\n    var f1 Foo\n    var f2 *Foo = &amp;Foo{}\n\n    DoFoo(f1)\n    DoFoo(f2)\n}\n\nfunc DoFoo(f Fooer) {\n    fmt.Printf(\"[%T] %+v\\n\", f, f)\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>[main.Foo] {}\n[*main.Foo] &amp;{}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/I7H_pv5H3Xl\" rel=\"noreferrer\">https://play.golang.org/p/I7H_pv5H3Xl</a></p>\n\n<p>In both cases, the <code>f</code> variable in <code>DoFoo</code> is just an interface, <em>not</em> a pointer to an interface.  However, when storing <code>f2</code>, the interface <em>holds</em> a pointer to a <code>Foo</code> structure.</p>\n\n<p>Pointers to interfaces are almost <em>never</em> useful.  In fact, the Go runtime was specifically changed a few versions back to no longer automatically dereference interface pointers (like it does for structure pointers), to discourage their use.  In the overwhelming majority of cases, a pointer to an interface reflects a misunderstanding of how interfaces are supposed to work.</p>\n\n<p>However, there is a limitation on interfaces.  If you pass a structure directly into an interface, only <em>value</em> methods of that type (ie. <code>func (f Foo) Dummy()</code>, not <code>func (f *Foo) Dummy()</code>) can be used to fulfill the interface.  This is because you're storing a copy of the original structure in the interface, so pointer methods would have unexpected effects (ie. unable to alter the original structure).  Thus the default rule of thumb is to <strong>store pointers to structures in interfaces</strong>, unless there's a compelling reason not to.</p>\n\n<p>Specifically with your code, if you change the AddFilter function signature to:</p>\n\n<pre><code>func (fp *FilterMap) AddFilter(f FilterInterface) uuid.UUID\n</code></pre>\n\n<p>And the GetFilterByID signature to:</p>\n\n<pre><code>func (fp *FilterMap) GetFilterByID(i uuid.UUID) FilterInterface\n</code></pre>\n\n<p>Your code will work as expected.  <code>fieldfilter</code> is of type <code>*FieldFilter</code>, which fullfills the <code>FilterInterface</code> interface type, and thus <code>AddFilter</code> will accept it.</p>\n\n<p>Here's a couple of good references for understanding how methods, types, and interfaces work and integrate with each other in Go:</p>\n\n<ul>\n<li><a href=\"https://medium.com/@agileseeker/go-interfaces-pointers-4d1d98d5c9c6\" rel=\"noreferrer\">https://medium.com/@agileseeker/go-interfaces-pointers-4d1d98d5c9c6</a></li>\n<li><a href=\"https://www.goinggo.net/2014/05/methods-interfaces-and-embedded-types.html\" rel=\"noreferrer\">https://www.goinggo.net/2014/05/methods-interfaces-and-embedded-types.html</a></li>\n<li><a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">https://blog.golang.org/laws-of-reflection</a></li>\n</ul>\n"}, {"comments": [{"owner": {"reputation": 36339, "user_id": 30946, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/350f30695a2ab75b99d3fce947e856b9?s=128&d=identicon&r=PG", "display_name": "jcollum", "link": "https://stackoverflow.com/users/30946/jcollum"}, "edited": false, "score": 1, "creation_date": 1606947107, "post_id": 54395288, "comment_id": 115121529, "body": "This one helped me faster than the more detailed answer above, +1; I wish go used the <code>IThing</code> style of interface naming -- <code>___er</code> isn&#39;t clear enough for me to be able to spot an interface quickly"}], "tags": [], "owner": {"reputation": 8699, "user_id": 1726083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/757452f7cd7ba2347c667ef9298ceadb?s=128&d=identicon&r=PG", "display_name": "Daniel Farrell", "link": "https://stackoverflow.com/users/1726083/daniel-farrell"}, "is_accepted": false, "score": 6, "last_activity_date": 1548647094, "creation_date": 1548647094, "answer_id": 54395288, "question_id": 44370277, "link": "https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion/54395288#54395288", "title": "&quot;&lt;type&gt; is pointer to interface, not interface&quot; confusion", "body": "<pre><code>GetFilterByID(i uuid.UUID) *FilterInterface\n</code></pre>\n\n<p>When I get this error, it's usually because I'm specifying a pointer to an interface instead of an interface ( that will actually be a pointer to my struct that fulfills the interface ).  </p>\n\n<p>There's a valid use for *interface{...} but more commonly I just am thinking 'this is a pointer' instead of 'this is an interface which happens to be a pointer in the code I'm writing'</p>\n\n<p>Just throwing it out there because the accepted answer, though detailed, didn't help me troubleshoot.</p>\n"}], "owner": {"reputation": 1536, "user_id": 6691722, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/d8e0d7ea4dc27c23764c2ec07207f08d?s=128&d=identicon&r=PG", "display_name": "0rka", "link": "https://stackoverflow.com/users/6691722/0rka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63070, "favorite_count": 29, "accepted_answer_id": 44372954, "answer_count": 2, "score": 132, "last_activity_date": 1607162609, "creation_date": 1496669872, "last_edit_date": 1607162609, "question_id": 44370277, "link": "https://stackoverflow.com/questions/44370277/type-is-pointer-to-interface-not-interface-confusion", "title": "&quot;&lt;type&gt; is pointer to interface, not interface&quot; confusion", "body": "<p>I have this problem which seems a bit weird to me. Take a look at this snippet of code:</p>\n<pre><code>package coreinterfaces\n\ntype FilterInterface interface {\n    Filter(s *string) bool\n}\n\ntype FieldFilter struct {\n    Key string\n    Val string\n}\n\nfunc (ff *FieldFilter) Filter(s *string) bool {\n    // Some code\n}\n\ntype FilterMapInterface interface {\n    AddFilter(f *FilterInterface) uuid.UUID     \n    RemoveFilter(i uuid.UUID)                   \n    GetFilterByID(i uuid.UUID) *FilterInterface\n}\n\ntype FilterMap struct {\n    mutex   sync.Mutex\n    Filters map[uuid.UUID]FilterInterface\n}\n\nfunc (fp *FilterMap) AddFilter(f *FilterInterface) uuid.UUID {\n    // Some code\n}\n\nfunc (fp *FilterMap) RemoveFilter(i uuid.UUID) {\n    // Some code\n}\n\nfunc (fp *FilterMap) GetFilterByID(i uuid.UUID) *FilterInterface {\n    // Some code\n}\n</code></pre>\n<p>On some other package, I have the following code:</p>\n<pre><code>func DoFilter() {\n    fieldfilter := &amp;coreinterfaces.FieldFilter{Key: &quot;app&quot;, Val: &quot;152511&quot;}\n    filtermap := &amp;coreinterfaces.FilterMap{}\n    _ = filtermap.AddFilter(fieldfilter) // &lt;--- Exception is raised here\n}\n</code></pre>\n<p>The run-time won't accept the line mentioned because</p>\n<blockquote>\n<p>&quot;cannot use fieldfilter (type *coreinterfaces.FieldFilter) as type\n*coreinterfaces.FilterInterface in argument to fieldint.AddFilter:\n*coreinterfaces.FilterInterface is pointer to interface, not interface&quot;</p>\n</blockquote>\n<p>However, when changing the code to:</p>\n<pre><code>func DoBid() error {\n    bs := string(b)\n    var ifilterfield coreinterfaces.FilterInterface\n    fieldfilter := &amp;coreinterfaces.FieldFilter{Key: &quot;app&quot;, Val: &quot;152511&quot;}\n    ifilterfield = fieldfilter\n    filtermap := &amp;coreinterfaces.FilterMap{}\n    _ = filtermap.AddFilter(&amp;ifilterfield)\n}\n</code></pre>\n<p>Everything is alright and when debugging the application it really seems to include</p>\n<p>I'm a bit confused on this topic. When looking at other blog posts and stack overflow threads discussing this exact same issue (for example - <a href=\"https://www.goinggo.net/2014/05/methods-interfaces-and-embedded-types.html\" rel=\"noreferrer\">This</a>, or\n<a href=\"https://stackoverflow.com/questions/40823315/go-x-does-not-implement-y-method-has-a-pointer-receiver\">This</a>) the first snippet which raises this exception should work, because both fieldfilter and fieldmap are initialized as pointers to interfaces, rather than value of interfaces. I haven't been able to wrap my head around what actually happens here that I need to change in order for me not to declare a FieldInterface and assign the implementation for that interface. There must be an elegant way to do this.</p>\n"}, {"tags": ["go", "goroutine", "channels"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496665841, "post_id": 44368901, "comment_id": 75738875, "body": "As a comment since it&#39;s not related to the q - since WriteC is already called as a goroutine, why does it start another goroutine to call <code>writeWorker</code>?"}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496666004, "post_id": 44368901, "comment_id": 75738976, "body": "As you might want to add multiple instances of <code>writeC</code> in other parts of your code that are not related to each other."}], "answers": [{"comments": [{"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1496665876, "post_id": 44368984, "comment_id": 75738901, "body": "i have indeed noticed that, and tried adding <code>return</code> statements after each push to a channel. This however does not solve the problem."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1496665993, "post_id": 44368984, "comment_id": 75738970, "body": "Updated - spotted a second issue."}, {"owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "edited": false, "score": 0, "creation_date": 1496666166, "post_id": 44368984, "comment_id": 75739090, "body": "thank you very much. the second issue solved my problem."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1496665977, "last_edit_date": 1496665977, "creation_date": 1496665785, "answer_id": 44368984, "question_id": 44368901, "link": "https://stackoverflow.com/questions/44368901/channel-never-dies-although-closed/44368984#44368984", "title": "Channel never dies although closed", "body": "<p>You only read from <code>operationOutcomes</code> up to <code>writeOpCount</code> times, even though in <code>writeWorker</code> each execution can result in up to 3 messages being written on that channel (none of your error cases causes the function to return, to it continues processing). Because it's unbuffered and it stops being read, at some point the workers writing to it can no longer add messages and so lock forever.</p>\n\n<p>Also, since you only call <code>WriteC</code> once and it does not loop, it will only ever read and process one message from the <code>inputs</code>. If <code>writeOpCount</code> is > 1, then it will lock forever within the first loop when it tries to queue a second message.</p>\n"}], "owner": {"reputation": 1004, "user_id": 4901806, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/Cy6qw.jpg?s=128&g=1", "display_name": "duck", "link": "https://stackoverflow.com/users/4901806/duck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 44368984, "answer_count": 1, "score": 1, "last_activity_date": 1496665977, "creation_date": 1496665488, "question_id": 44368901, "link": "https://stackoverflow.com/questions/44368901/channel-never-dies-although-closed", "title": "Channel never dies although closed", "body": "<p>In the following code, i am trying to write all files that are sent to the <code>inputs</code> channel and send a corresponding response over the <code>operationOutcomes</code> channel</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport(\n    lr \"github.com/fabulousduck/librarian\"\n    \"fmt\"\n)\n\nfunc main() {\n    writeOpCount := 100;\n    operationOutcomes, inputs := make(chan lr.WriteOpResponse), make(chan lr.WriteOp)\n    go lr.WriteC(inputs, operationOutcomes)\n\n    for i := 0; i &lt; writeOpCount; i++ {\n        inputs &lt;- lr.WriteOp{ Dest: `../exampleFiles/createdFiles/{i}.txt`, Content: `Invoice #{i}` }\n    }\n\n    close(inputs)  \n\n    for i := 0; i &lt; writeOpCount; i++ {\n        writeResult := &lt;-operationOutcomes\n        fmt.Println(\"Response from write operation : \", writeResult.Msg, \"err \", writeResult.Err, \"bytes written : \", writeResult.BytesWritten)\n    }\n\n    close(operationOutcomes)\n}\n</code></pre>\n\n<p><strong>librarian.go</strong>\n    package librarian</p>\n\n<pre><code>import(\n    \"os\"\n    \"fmt\"\n)\n\ntype WriteOp struct {\n    Dest, Content string\n}\n\ntype WriteOpResponse struct {\n    Msg error\n    Err bool\n    BytesWritten int\n}\n\nfunc WriteC (inputChannel &lt;-chan WriteOp, outputChannel chan&lt;- WriteOpResponse) {\n    workOp :=  &lt;-inputChannel\n    go writeWorker(workOp, outputChannel)\n}\n\nfunc writeWorker (job WriteOp, outGoing chan&lt;- WriteOpResponse) {\n    file, err := os.OpenFile(job.Dest, os.O_RDWR, 0666)\n    if err != nil {\n        fmt.Println(\"err : \", err)\n        outGoing &lt;- WriteOpResponse{ Msg: err, Err: true, BytesWritten: 0 }\n    }\n    bytesWritten , err := file.WriteString(job.Content)\n    if err != nil {\n        outGoing &lt;- WriteOpResponse{ Msg: err, Err: true, BytesWritten: 0 }\n    }\n    outGoing &lt;- WriteOpResponse{ Msg: nil, Err: false, BytesWritten: bytesWritten } \n}\n</code></pre>\n\n<p>This throws a deadlock in both cases when there is and isn't an error, even though i am closing both channels when i am done with them ?</p>\n"}, {"tags": ["azure", "go"], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 1, "last_activity_date": 1496689773, "creation_date": 1496689773, "answer_id": 44376030, "question_id": 44368841, "link": "https://stackoverflow.com/questions/44368841/go-azure-calling-a-method-return-undefined/44376030#44376030", "title": "Go + Azure: Calling a method return undefined", "body": "<p>The function you're trying to use doesn't exist (<a href=\"https://godoc.org/github.com/Azure/azure-sdk-for-go/arm/notificationhubs\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/Azure/azure-sdk-for-go/arm/notificationhubs</a>).</p>\n\n<p>You're probably trying to use the function <a href=\"https://godoc.org/github.com/Azure/azure-sdk-for-go/arm/notificationhubs#GroupClient.Get\" rel=\"nofollow noreferrer\"><code>GroupClient.Get</code></a>; if that's the case, you need to get an object of type <code>GroupClient</code> and then call the function <code>Get</code> on it.</p>\n"}, {"tags": [], "owner": {"reputation": 260, "user_id": 3761716, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iY3GQ.jpg?s=128&g=1", "display_name": "MarStr", "link": "https://stackoverflow.com/users/3761716/marstr"}, "is_accepted": false, "score": 0, "last_activity_date": 1496857138, "creation_date": 1496857138, "answer_id": 44419378, "question_id": 44368841, "link": "https://stackoverflow.com/questions/44368841/go-azure-calling-a-method-return-undefined/44419378#44419378", "title": "Go + Azure: Calling a method return undefined", "body": "<p>@cd1 is correct! The Get method doesn't belong directly to namespace that you've imported, but rather a client that exists in that namespace. In order to interact with NotificationsHub in this manner, instantiate a <code>GroupClient</code> then run a <code>Get</code> command.</p>\n\n<pre><code>import (\n    hubs \"github.com/Azure/azure-sdk-for-go/arm/notificationshub\"\n)\n\nfunc main() {\n    // Implementation details of your program ...\n    client := hubs.NewGroupClient(\"&lt;YOUR SUBSCRIPTION ID&gt;\")\n    client.Authorizer = // Your initialized Service Principal Token\n\n    results, err := client.Get(\"&lt;RESOURCE GROUP NAME&gt;\", \"&lt;NAMESPACE NAME&gt;\", \"&lt;NOTIFICATION HUB NAME&gt;\")\n    if err != nil {\n        return\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 263, "user_id": 3462064, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/31e3c8e0db60fcce7e136db6e40f15bb?s=128&d=identicon&r=PG&f=1", "display_name": "user3462064", "link": "https://stackoverflow.com/users/3462064/user3462064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 44376030, "answer_count": 2, "score": 0, "last_activity_date": 1496857138, "creation_date": 1496665282, "question_id": 44368841, "link": "https://stackoverflow.com/questions/44368841/go-azure-calling-a-method-return-undefined", "title": "Go + Azure: Calling a method return undefined", "body": "<p>Am trying to use Go Azure SDK to call the notification hub api </p>\n\n<p>I have installed the SDK and imported to the GO file :</p>\n\n<pre><code>package hub\n\nimport (\n\n    \"fmt\"\n\n    \"github.com/Azure/azure-sdk-for-go/arm/notificationhubs\"\n)\n\nfunc GetHub() {\n    if resourceType, err := notificationhubs.Get(\"sourceGroupName\", \"NameSpaceValue\", \"NameOfTheHub\"); err != nil {\n        fmt.Println(\"Error occured\")\n        return\n    }\n    fmt.Println(\"Success\")\n\n}\n</code></pre>\n\n<p>However when am trying to runt he code i got this error </p>\n\n<pre><code>undefined: notificationhubs.Get\n</code></pre>\n\n<p>And am not sure what it means since my IDE don't complain about importing the Azure SDK so am assuming the SDK is imported correctly.</p>\n"}, {"tags": ["go", "programmatically"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "edited": false, "score": 1, "creation_date": 1496663372, "post_id": 44368080, "comment_id": 75737475, "body": "I don&#39;t think you can get more then what the help shows you. You can call it using the <code>os&#47;exec</code> package."}], "answers": [{"comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1598485893, "post_id": 44399544, "comment_id": 112477787, "body": "The first argument to exec.Command is the name of the program.  The name of the program is <code>go</code>, not <code>go run lib&#47;main.go</code>.  See the @Stephen&#39;s answer for correct way to run the go command."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8067560"}, "is_accepted": false, "score": -1, "last_activity_date": 1496781963, "creation_date": 1496781963, "answer_id": 44399544, "question_id": 44368080, "link": "https://stackoverflow.com/questions/44368080/programmatic-way-to-call-go-tools/44399544#44399544", "title": "Programmatic way to call go tools", "body": "<p>Within another go program it is possible to execute console commands using the <code>os/exec</code> package like so:</p>\n\n<pre><code>func main (){\n   cmd := exec.Command(\"go run lib/main.go\")\n   if err := cmd.Run(); err != nil{\n       log.Fatal(err)\n   }\n}\n</code></pre>\n\n<p>I don't see this being very useful though.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 5738660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c3d611d454d3e9ff122b2e3bc3aa596b?s=128&d=identicon&r=PG&f=1", "display_name": "Stephen ", "link": "https://stackoverflow.com/users/5738660/stephen"}, "is_accepted": false, "score": 1, "last_activity_date": 1575992680, "creation_date": 1575992680, "answer_id": 59270882, "question_id": 44368080, "link": "https://stackoverflow.com/questions/44368080/programmatic-way-to-call-go-tools/59270882#59270882", "title": "Programmatic way to call go tools", "body": "<p>If you're trying to run build programmatically you can also use the <code>os/exec</code> package.</p>\n\n<pre><code>func runBuild() {\n    cmd := exec.Command(\"go\", \"build\", \"./main.go\")\n    err := cmd.Run()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p>You can pass other flags too. E.g: the buildmode flag</p>\n\n<pre><code>cmd := exec.Command(\"go\", \"build\", \"-buildmode=plugin\", \"./main.go\")\n</code></pre>\n\n<p>Reference: <a href=\"https://golang.org/pkg/os/exec/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/exec/</a></p>\n"}], "owner": {"reputation": 812, "user_id": 632689, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/684756f13f562481b9e3006770ef01e2?s=128&d=identicon&r=PG", "display_name": "anselm", "link": "https://stackoverflow.com/users/632689/anselm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 0, "answer_count": 2, "score": 4, "last_activity_date": 1575992680, "creation_date": 1496662564, "question_id": 44368080, "link": "https://stackoverflow.com/questions/44368080/programmatic-way-to-call-go-tools", "title": "Programmatic way to call go tools", "body": "<p>Is there a way to call the Go tools (like <code>go build</code>) programmatically from within another Go program with a library call and to get more structured output compared to the text output from the command line invocation?</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496666500, "post_id": 44366219, "comment_id": 75739317, "body": "This seems like an incompatibility between latest mgo and MongoDB 3.0.2. You can <a href=\"https://github.com/go-mgo/mgo/issues\" rel=\"nofollow noreferrer\">file a bug report</a> with mgo project."}, {"owner": {"reputation": 77, "user_id": 3715832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06a916c22108f0a8668e91440dc9515f?s=128&d=identicon&r=PG&f=1", "display_name": "T.L", "link": "https://stackoverflow.com/users/3715832/t-l"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496671270, "post_id": 44366219, "comment_id": 75742429, "body": "@Adrian, thanks for the response. I will fill an issue there."}], "owner": {"reputation": 77, "user_id": 3715832, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/06a916c22108f0a8668e91440dc9515f?s=128&d=identicon&r=PG&f=1", "display_name": "T.L", "link": "https://stackoverflow.com/users/3715832/t-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 80, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496656312, "creation_date": 1496656312, "question_id": 44366219, "link": "https://stackoverflow.com/questions/44366219/error-queryoptions-is-not-a-valid-argument-to-updateuser-is-returned-when-cre", "title": "Error &quot;$queryOptions is not a valid argument to updateUser&quot; is returned when create a new user by using the mgo package", "body": "<p>One my MongoDB client program has been working well for a MongoDB 3.2 master-slave cluster for a long time.\nBut now, a problem shows up when it connects to a MongoDB 3.0.2 sharding cluster.</p>\n\n<p>When the program creates a new user for a new database, the error \"$queryOptions is not a valid argument to updateUser\" is always returned at the following code:</p>\n\n<pre><code>    err = newdb.UpsertUser(&amp;mgo.User{\n        Username: newusername,\n        Password: newpassword,\n        Roles: []mgo.Role{\n            mgo.RoleReadWrite,\n        },\n    })\n</code></pre>\n\n<p>Can anyone provide some hints?</p>\n\n<p>btw, the mgo package is the latest one.</p>\n"}, {"tags": ["go", "testify"], "answers": [{"comments": [{"owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1496658749, "post_id": 44365321, "comment_id": 75734919, "body": "I tried that before posting but it just generates the following error: &quot;assert: mock: I don&#39;t know what to return because the method call was unexpected.&quot;"}, {"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "reply_to_user": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1497010546, "post_id": 44365321, "comment_id": 75911362, "body": "I think that might be because your method takes the receiver by value so only a copy of the mock is being updated. Try using a pointer receiver. I&#39;ve updated my answer."}], "tags": [], "owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "is_accepted": false, "score": 2, "last_activity_date": 1497010416, "last_edit_date": 1497010416, "creation_date": 1496653334, "answer_id": 44365321, "question_id": 44365009, "link": "https://stackoverflow.com/questions/44365009/assertcalled-always-fails-with-testify-library/44365321#44365321", "title": "AssertCalled always fails with testify library", "body": "<p>Looking at the <a href=\"https://godoc.org/github.com/stretchr/testify/mock#Mock.Called\" rel=\"nofollow noreferrer\">documentation of testify</a> I think you have to explicitly call <code>func (*Mock) Called</code> to tell the mock object that a method has been called.</p>\n\n<pre><code>func (m *Foo) Bar() {\n    m.Called()\n}\n</code></pre>\n\n<p>There are <a href=\"https://github.com/stretchr/testify/blob/master/mock/mock_test.go\" rel=\"nofollow noreferrer\">some examples</a> in the testify tests.</p>\n"}, {"comments": [{"owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "edited": false, "score": 0, "creation_date": 1497190025, "post_id": 44484256, "comment_id": 75963437, "body": "Thanks, I replied on GitHub too :)"}, {"owner": {"reputation": 500, "user_id": 8179980, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gdLiUYmHXcs/AAAAAAAAAAI/AAAAAAAAAqM/rRL0v6nAIrQ/photo.jpg?sz=128", "display_name": "Andres Gardiol", "link": "https://stackoverflow.com/users/8179980/andres-gardiol"}, "edited": false, "score": 0, "creation_date": 1611950810, "post_id": 44484256, "comment_id": 116624174, "body": "Thanks you very much!"}], "tags": [], "owner": {"reputation": 161, "user_id": 5285360, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4P6IP.jpg?s=128&g=1", "display_name": "Dom Corvasce", "link": "https://stackoverflow.com/users/5285360/dom-corvasce"}, "is_accepted": true, "score": 9, "last_activity_date": 1497186859, "creation_date": 1497186859, "answer_id": 44484256, "question_id": 44365009, "link": "https://stackoverflow.com/questions/44365009/assertcalled-always-fails-with-testify-library/44484256#44484256", "title": "AssertCalled always fails with testify library", "body": "<p>I tried with this and works:</p>\n\n<pre><code>type Foo struct {                                                                                                                                                    \n    mock.Mock                                                                                                                                                          \n}                                                                                                                                                                    \n\nfunc (m *Foo) Bar() {                                                                                                                                                \n    m.Called()                                                                                                                                                         \n}                                                                                                                                                                    \n\nfunc TestFoo(t *testing.T) {                                                                                                                                         \n    m := &amp;Foo{}                                                                                                                                                        \n    m.On(\"Bar\").Return(nil)                                                                                                                                            \n\n    m.Bar()                                                                                                                                                            \n    m.AssertCalled(t, \"Bar\")                                                                                                                                           \n}\n</code></pre>\n\n<p>As stated by <strong>Chris Drew</strong>, you've to use a receiver pointer on <em>Bar</em> method's declaration.</p>\n\n<p>Additionally, you've to istantiate a new structure as pointer and mock the method to return a value.</p>\n"}], "owner": {"reputation": 2705, "user_id": 1501456, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/660e626ccb2d55bc2f3ca14940fb882e?s=128&d=identicon&r=PG", "display_name": "Buzzy", "link": "https://stackoverflow.com/users/1501456/buzzy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4466, "favorite_count": 1, "accepted_answer_id": 44484256, "answer_count": 2, "score": 7, "last_activity_date": 1497186859, "creation_date": 1496652176, "last_edit_date": 1496655704, "question_id": 44365009, "link": "https://stackoverflow.com/questions/44365009/assertcalled-always-fails-with-testify-library", "title": "AssertCalled always fails with testify library", "body": "<p>I am using testify to test my code and I want to check if a function was called.</p>\n\n<p>I am doing the following:</p>\n\n<pre><code>type Foo struct {\n    mock.Mock\n}\n\nfunc (m Foo) Bar() {\n\n}\n\nfunc TestFoo(t *testing.T) {\n    m := Foo{}\n    m.Bar()\n    m.AssertCalled(t, \"Bar\")\n}\n</code></pre>\n\n<p>The error I am getting:</p>\n\n<pre><code>Error:      Should be true\nMessages:   The \"Bar\" method should have been called with 0 argument(s), but was not.\n\nmock.go:419: []\n</code></pre>\n\n<p>I call function \"Bar\" and immediately ask if it was called but it returns false.\nWhat am I doing wrong?\nWhat is the proper way to test if a function was called with testify?</p>\n"}, {"tags": ["xml", "go", "xml-parsing", "unmarshalling"], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user745235"}, "is_accepted": true, "score": 0, "last_activity_date": 1496666481, "creation_date": 1496666481, "answer_id": 44369171, "question_id": 44364959, "link": "https://stackoverflow.com/questions/44364959/golangxml-unmarshall-not-working-as-expected/44369171#44369171", "title": "Golang:xml unmarshall not working as expected", "body": "<p>The problem here is that you are using <code>attr</code> where you shouldn't.</p>\n\n<p>You are treating the <code>XMLEntry</code> and <code>XMLLink</code> tags as attributes.</p>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 44369171, "answer_count": 1, "score": 0, "last_activity_date": 1496666481, "creation_date": 1496651977, "last_edit_date": 1496652303, "question_id": 44364959, "link": "https://stackoverflow.com/questions/44364959/golangxml-unmarshall-not-working-as-expected", "title": "Golang:xml unmarshall not working as expected", "body": "<p>response getting in xml format:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\r\n&lt;feed xmlns=\"http://www.w3.org/2005/Atom\" xmlns:openSearch=\"http://a9.com/-/spec/opensearch/1.1/\"&gt;\r\n&lt;id&gt;https://sites.google.com/feeds/activity/site/siteName&lt;/id&gt;\r\n&lt;updated&gt;2009-09-10T05:24:23.120Z&lt;/updated&gt;\r\n&lt;title&gt;Activity&lt;/title&gt;\r\n&lt;link rel=\"alternate\" type=\"text/html\" href=\"http://sites.google.com/site/siteName/system/app/pages/recentChanges\"/&gt;\r\n&lt;link rel=\"http://schemas.google.com/g/2005#feed\" type=\"application/atom+xml\"\r\n  href=\"https://sites.google.com/feeds/activity/site/siteName\"/&gt;\r\n&lt;link rel=\"self\" type=\"application/atom+xml\"\r\n  href=\"https://sites.google.com/feeds/activity/site/siteName\"/&gt;\r\n&lt;generator version=\"1\" uri=\"http://sites.google.com\"&gt;Google Sites&lt;/generator&gt;\r\n&lt;openSearch:startIndex&gt;1&lt;/openSearch:startIndex&gt;\r\n&lt;entry xmlns:gd=\"http://schemas.google.com/g/2005\" gd:etag=\"W/&amp;quot;CU4GQ3szfSl7ImA9WxNRFUg.&amp;quot;\"&gt;\r\n&lt;id&gt;https://sites.google.com/feeds/activity/site/siteName/940375996952876062&lt;/id&gt;\r\n&lt;updated&gt;2009-09-10T03:38:42.585Z&lt;/updated&gt;\r\n&lt;category scheme=\"http://schemas.google.com/g/2005#kind\" term=\"http://schemas.google.com/sites/2008#deletion\" label=\"deletion\"/&gt;\r\n&lt;title&gt;home&lt;/title&gt;\r\n&lt;summary type=\"xhtml\"&gt;\r\n  &lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;User deleted &lt;a href=\"http://sites.google.com/site/siteName/home\"&gt;home&lt;/a&gt;\r\n&lt;/div&gt;\r\n&lt;/summary&gt;\r\n&lt;link rel=\"http://schemas.google.com/sites/2008#revision\" type=\"application/atom+xml\"\r\n  href=\"https://sites.google.com/feeds/revision/site/siteName/5409745539831916487\"/&gt;\r\n&lt;link rel=\"http://schemas.google.com/sites/2008#current\" type=\"application/atom+xml\"\r\n  href=\"https://sites.google.com/feeds/content/site/siteName/5409745539831916487\"/&gt;\r\n&lt;link rel=\"self\" type=\"application/atom+xml\"\r\n  href=\"https://sites.google.com/feeds/activity/site/siteName/940375996952876062\"/&gt;\r\n&lt;author&gt;\r\n  &lt;name&gt;User&lt;/name&gt;\r\n  &lt;email&gt;user@gmail.com&lt;/email&gt;\r\n&lt;/author&gt;\r\n&lt;/entry&gt;\r\n&lt;entry xmlns:gd=\"http://schemas.google.com/g/2005\" gd:etag=\"W/&amp;quot;CU8DQn45fyl7ImA9WxNRFUg.&amp;quot;\"&gt;\r\n  &lt;id&gt;https://sites.google.com/feeds/activity/site/siteName/7165439066235480082&lt;/id&gt;\r\n  &lt;updated&gt;2009-09-10T03:37:53.027Z&lt;/updated&gt;\r\n  &lt;category scheme=\"http://schemas.google.com/g/2005#kind\"\r\n    term=\"http://schemas.google.com/sites/2008#edit\" label=\"edit\"/&gt;\r\n  &lt;title&gt;home&lt;/title&gt;\r\n  &lt;summary type=\"xhtml\"&gt;\r\n    &lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;User2 edited &lt;a href=\"http://sites.google.com/site/siteName/home\"&gt;home&lt;/a&gt;\r\n  &lt;/div&gt;\r\n  &lt;/summary&gt;\r\n  &lt;link rel=\"http://schemas.google.com/sites/2008#revision\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/revision/site/siteName/5409745539831916487\"/&gt;\r\n  &lt;link rel=\"http://schemas.google.com/sites/2008#current\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/content/site/siteName/5409745539831916487\"/&gt;\r\n  &lt;link rel=\"self\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/activity/site/siteName/7165439066235480082\"/&gt;\r\n  &lt;author&gt;\r\n    &lt;name&gt;User&lt;/name&gt;\r\n    &lt;email&gt;user@gmail.com&lt;/email&gt;\r\n  &lt;/author&gt;\r\n&lt;/entry&gt;\r\n&lt;entry xmlns:gd=\"http://schemas.google.com/g/2005\" gd:etag=\"W/&amp;quot;CU8AR3s4cSl7ImA9WxNRFUg.&amp;quot;\"&gt;\r\n  &lt;id&gt;https://sites.google.com/feeds/activity/site/siteName/127448462987345884&lt;/id&gt;\r\n  &lt;updated&gt;2009-09-10T03:37:26.539Z&lt;/updated&gt;\r\n  &lt;category scheme=\"http://schemas.google.com/g/2005#kind\"\r\n    term=\"http://schemas.google.com/sites/2008#creation\" label=\"creation\"/&gt;\r\n  &lt;title&gt;home&lt;/title&gt;\r\n  &lt;summary type=\"xhtml\"&gt;\r\n    &lt;div xmlns=\"http://www.w3.org/1999/xhtml\"&gt;User3 created &lt;a href=\"http://sites.google.com/site/siteName/home\"&gt;home&lt;/a&gt;\r\n  &lt;/div&gt;\r\n  &lt;/summary&gt;\r\n  &lt;link rel=\"http://schemas.google.com/sites/2008#revision\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/revision/site/siteName/5409745539831916487\"/&gt;\r\n  &lt;link rel=\"http://schemas.google.com/sites/2008#current\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/content/site/siteName/5409745539831916487\"/&gt;\r\n  &lt;link rel=\"self\" type=\"application/atom+xml\"\r\n    href=\"https://sites.google.com/feeds/activity/site/siteName/127448462987345884\"/&gt;\r\n  &lt;author&gt;\r\n    &lt;name&gt;User3&lt;/name&gt;\r\n    &lt;email&gt;user3@gmail.com&lt;/email&gt;\r\n  &lt;/author&gt;\r\n&lt;/entry&gt;\r\n&lt;/feed&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>In GO i using following structure and code to decode</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>type XMLLink struct {\r\n\tXMLName xml.Name `xml:\"link\"`\r\n\tRel     string   `xml:\"rel,attr\"`\r\n\tHref    string   `xml:\"rel,href\"`\r\n}\r\ntype XMLEntry struct {\r\n\tXMLName xml.Name  `xml:\"entry\"`\r\n\tLink    []XMLLink `xml:\"link,attr\"`\r\n}\r\ntype XMLFeed struct {\r\n\tXMLName xml.Name   `xml:\"feed\"`\r\n\tEntry   []XMLEntry `xml:\"entry,attr\"`\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>here i want to decode only link tag under entry tag.\nfollowing is the code i using to decode the xml into necessary values</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>var feed XMLFeed\r\n//response got from http request is expected xml here which is already men tioned above\r\nbodyBytes, _ := ioutil.ReadAll(response.Body)\r\n\t\t\terr := xml.Unmarshal(bodyBytes, &amp;feed)\r\n\t\t\tif err != nil {\r\n\t\t\t\tlog.Fatalf(\"Unable to unmarshall\", err)\r\n\t\t\t}\r\n\t\t\tfmt.Println(\"number of entries:\", feed)</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>but here output is only\n <strong>number of entries: {{<a href=\"http://www.w3.org/2005/Atom\" rel=\"nofollow noreferrer\">http://www.w3.org/2005/Atom</a> feed} []}</strong>\ndont know what is going wrong here please suggest any changes to make this work fine</p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 1290, "user_id": 2483507, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eIUqf.jpg?s=128&g=1", "display_name": "Joffutt4", "link": "https://stackoverflow.com/users/2483507/joffutt4"}, "edited": false, "score": 2, "creation_date": 1496664304, "post_id": 44364619, "comment_id": 75737955, "body": "Are you having the context timeout or is the goroutine finishing its work and calling the cancelFn() when you see this leak?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1496667104, "post_id": 44364619, "comment_id": 75739684, "body": "<code>WithCancel</code>, <code>WithTimeout</code>, and <code>WithDeadline</code> all say the same thing in <a href=\"https://golang.org/pkg/context/#WithTimeout\" rel=\"nofollow noreferrer\">their docs</a>: &quot;code should call cancel as soon as the operations running in this Context complete&quot;. If you&#39;re not calling cancel, you may wind up with a leak."}, {"owner": {"reputation": 9581, "user_id": 807239, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fcjpR.jpg?s=128&g=1", "display_name": "Daniel Ribeiro", "link": "https://stackoverflow.com/users/807239/daniel-ribeiro"}, "edited": false, "score": 0, "creation_date": 1496721745, "post_id": 44364619, "comment_id": 75762618, "body": "I am calling the cancelFn"}], "owner": {"reputation": 9581, "user_id": 807239, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/fcjpR.jpg?s=128&g=1", "display_name": "Daniel Ribeiro", "link": "https://stackoverflow.com/users/807239/daniel-ribeiro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 373, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1496655296, "creation_date": 1496650757, "last_edit_date": 1496655296, "question_id": 44364619, "link": "https://stackoverflow.com/questions/44364619/context-withtimeout-seems-to-not-release-the-goroutines-created-internally", "title": "context.WithTimeout seems to not release the goroutines created internally", "body": "<p>I have a simple implementation that uses <code>context.WithTimeout</code>, more or less like:</p>\n\n<pre><code>ctx, cancelFn := context.WithTimeout(context.Background(), time.Duration(time.Minute*1))\n\ngo func() {\n    // do something\n    cancelFn()\n}()\n\nselect {\n    case &lt;-ctx.Done():\n        // ...\n        return\n}\n</code></pre>\n\n<p>When I monitor the number of currently existing goroutines (using <code>runtime.NumGoroutines()</code>), it seems that whenever the <code>WithTimeout()</code> function gets called, it internally creates a goroutine to keep track of the time and eventually cancel the context (which makes sense, if you look at the internals (<a href=\"https://github.com/golang/go/blob/master/src/context/context.go#L401\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/context/context.go#L401</a> and <a href=\"https://github.com/golang/go/blob/master/src/time/sleep.go#L170\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/time/sleep.go#L170</a>).</p>\n\n<p>However, when the context is finished and the case statement is reached, the goroutine is not being released. It seems that it keeps running forever and the resources are not released properly.</p>\n\n<p>If I change the implementation to use a simpler version of a timeout, <strong>without</strong> the <code>context.WithTimeout()</code>, more or less like:</p>\n\n<pre><code>select {\n    case &lt;-time.After(time.Minute*1):\n        // ...\n        return\n}\n</code></pre>\n\n<p>Then the number of goroutines is the expected in the first place and nothing seems to leak.</p>\n\n<p>What could be the problem? What am I missing?</p>\n"}, {"tags": ["postgresql", "sockets", "go", "connection-timeout", "go-iris"], "answers": [{"comments": [{"owner": {"reputation": 493, "user_id": 6808807, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60101ba596459260ae1bbb9112592965?s=128&d=identicon&r=PG&f=1", "display_name": "M.Mike", "link": "https://stackoverflow.com/users/6808807/m-mike"}, "edited": false, "score": 0, "creation_date": 1496659786, "post_id": 44366675, "comment_id": 75735559, "body": "It is helplessness that increase the  max_client_conn in pgbouncer.ini.The memcache also reported that connect timeout"}, {"owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "reply_to_user": {"reputation": 493, "user_id": 6808807, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60101ba596459260ae1bbb9112592965?s=128&d=identicon&r=PG&f=1", "display_name": "M.Mike", "link": "https://stackoverflow.com/users/6808807/m-mike"}, "edited": false, "score": 0, "creation_date": 1496661582, "post_id": 44366675, "comment_id": 75736572, "body": "Try to do next thing: run 2 copies of your application and stress test only one of them. After it will start throwing errors, start to work with second copy of application. In this way you&#39;ll know, if it&#39;s problem of your application (2nd copy runs well), or you reach some OS or PgBouncer/Memcached limitations (2nd copy fails quickly)."}], "tags": [], "owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "is_accepted": false, "score": 0, "last_activity_date": 1496657702, "creation_date": 1496657702, "answer_id": 44366675, "question_id": 44364233, "link": "https://stackoverflow.com/questions/44364233/getsockopt-connection-timed-out/44366675#44366675", "title": "getsockopt: connection timed out", "body": "<p>Check your <a href=\"https://pgbouncer.github.io/config.html\" rel=\"nofollow noreferrer\">PgBouncer config</a>. Try to increase <code>max_client_conn</code> option. Then experiment with concurrency level and requests count during stress test. Another possible issue can be that you don't return connections to pool.</p>\n"}], "owner": {"reputation": 493, "user_id": 6808807, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/60101ba596459260ae1bbb9112592965?s=128&d=identicon&r=PG&f=1", "display_name": "M.Mike", "link": "https://stackoverflow.com/users/6808807/m-mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1053, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1501673847, "creation_date": 1496649245, "last_edit_date": 1501673847, "question_id": 44364233, "link": "https://stackoverflow.com/questions/44364233/getsockopt-connection-timed-out", "title": "getsockopt: connection timed out", "body": "<p>I rewrite my project from python tornado to go(use iris framework). The basic function tested ok. When I test under high concurrence.the app always stops a while and then comes out the errors:</p>\n\n<pre><code>(dial tcp 192.168.1.229:6543: getsockopt: connection timed out)\n</code></pre>\n\n<p>the 6543 port is the postgresql port used with pgbouncer...the pgbouncer and postgresl process runs Ok.</p>\n\n<p>Also, I find that the memcache connect time out sometimes(the memcache process is still working).</p>\n\n<p>Does this happen because too many connections? Or some connections not \nclosed on time?\nHow can I avoid this problem?</p>\n"}, {"tags": ["windows", "go", "command-line-interface"], "comments": [{"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496648398, "post_id": 44363911, "comment_id": 75729334, "body": "I&#39;m pretty sure there&#39;s some Windows API for finding the Startup folder, which would be a much better way than try to locate it yourself."}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496650090, "post_id": 44363911, "comment_id": 75730125, "body": "The correct way would be to use the <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb762188.aspx\" rel=\"nofollow noreferrer\"><code>SHGetKnownFolderPath</code> function</a> with a <a href=\"https://msdn.microsoft.com/library/windows/desktop/dd378457.aspx\" rel=\"nofollow noreferrer\"><code>KNOWNFOLDERID</code></a> of either <a href=\"https://msdn.microsoft.com/library/windows/desktop/dd378457.aspx#FOLDERID_CommonStartup\" rel=\"nofollow noreferrer\"><code>FOLDERID_CommonStartup</code></a> or <a href=\"https://msdn.microsoft.com/library/windows/desktop/dd378457.aspx#FOLDERID_Startup\" rel=\"nofollow noreferrer\"><code>FOLDERID_Startup</code></a> depending on which Startup folder you are interested in."}, {"owner": {"reputation": 43, "user_id": 4940673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AwvRj.png?s=128&g=1", "display_name": "JackMordaunt", "link": "https://stackoverflow.com/users/4940673/jackmordaunt"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496650292, "post_id": 44363911, "comment_id": 75730206, "body": "I had a look at <code>SHGetKnownFolderPath</code>, it says &quot;minimum supported client: windows vista&quot;, does that mean this function will not work on XP?"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496650390, "post_id": 44363911, "comment_id": 75730257, "body": "Note that the concept of <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb776911.aspx\" rel=\"nofollow noreferrer\"><i>Known Folders</i></a> and thus  <code>SHGetKnownFolderPath</code> was introduced in Vista, so for XP, you have to fall back on the deprecated <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb762181.aspx\" rel=\"nofollow noreferrer\"><code>SHGetFolderPath</code> function</a> with a <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb762494.aspx\" rel=\"nofollow noreferrer\"><code>CSIDL</code></a> of either <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb762494.aspx#CSIDL_COMMON_STARTUP\" rel=\"nofollow noreferrer\"><code>CSIDL_COMMON_STARTUP</code></a> or \u2026"}, {"owner": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496650428, "post_id": 44363911, "comment_id": 75730286, "body": "\u2026 <a href=\"https://msdn.microsoft.com/library/windows/desktop/bb762494.aspx#CSIDL_STARTUP\" rel=\"nofollow noreferrer\"><code>CSIDL_STARTUP</code></a>. (Actually, note that there are about 6 different Startup folders on older Windows versions.)"}, {"owner": {"reputation": 43, "user_id": 4940673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AwvRj.png?s=128&g=1", "display_name": "JackMordaunt", "link": "https://stackoverflow.com/users/4940673/jackmordaunt"}, "reply_to_user": {"reputation": 335867, "user_id": 2988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ed181f8c80df53d2b67a4f4fff088ed4?s=128&d=identicon&r=PG", "display_name": "J&#246;rg W Mittag", "link": "https://stackoverflow.com/users/2988/j%c3%b6rg-w-mittag"}, "edited": false, "score": 0, "creation_date": 1496651954, "post_id": 44363911, "comment_id": 75731130, "body": "Thanks for the help. So should I attempt to call <code>SHGetKnownFolderPath</code> and if that panics I must be on XP, so fall back to <code>SHGetFolderPath</code>? I just tried to use the deprecated one on win10 and it panicked &quot;specified procedure can&#39;t be found&quot;, that is with the Shell32.dll."}], "answers": [{"tags": [], "owner": {"reputation": 191, "user_id": 6747557, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IN5Me.jpg?s=128&g=1", "display_name": "Adamar", "link": "https://stackoverflow.com/users/6747557/adamar"}, "is_accepted": false, "score": 4, "last_activity_date": 1496749346, "last_edit_date": 1496749346, "creation_date": 1496691915, "answer_id": 44376544, "question_id": 44363911, "link": "https://stackoverflow.com/questions/44363911/detect-windows-version-in-go/44376544#44376544", "title": "Detect windows version in Go", "body": "<p>Why not use the windows registry?</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/sys/windows/registry\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/sys/windows/registry</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36998532/how-to-return-a-default-value-from-windows-registry-with-golang\">How to return a default value from windows/registry with golang</a></p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/sys/windows/registry\"\n    \"log\"\n    \"fmt\"\n)\n\nfunc main() {\n\n    k, err := registry.OpenKey(registry.LOCAL_MACHINE, `SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion`, registry.QUERY_VALUE)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer k.Close()\n\n    cv, _, err := k.GetStringValue(\"CurrentVersion\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"CurrentVersion: %s\\n\", cv)\n\n    pn , _, err := k.GetStringValue(\"ProductName\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"ProductName: %s\\n\", pn)\n\n    maj, _, err := k.GetIntegerValue(\"CurrentMajorVersionNumber\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"CurrentMajorVersionNumber: %d\\n\", maj)\n\n    min, _, err := k.GetIntegerValue(\"CurrentMinorVersionNumber\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"CurrentMinorVersionNumber: %d\\n\", min)\n\n    cb, _, err := k.GetStringValue(\"CurrentBuild\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"CurrentVersion: %s\\n\", cb)    \n}\n</code></pre>\n\n<p>This returns:</p>\n\n<pre><code>PS C:\\Users\\Adamar\\Desktop&gt; .\\WindowsVersion.exe\nCurrentVersion: 6.3\nProductName: Windows Server 2016 Standard Evaluation\nCurrentMajorVersionNumber: 10\nCurrentMinorVersionNumber: 0\nCurrentVersion: 14393\n</code></pre>\n\n<p>Although in the newest version of windows you have to read the following keys to get the version: CurrentMajorVersionNumber &amp; CurrentMinorVersionNumber</p>\n"}, {"comments": [{"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1552833713, "post_id": 46228513, "comment_id": 97152452, "body": "this returns <code>6.2</code> even in windows 10."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "reply_to_user": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1584360776, "post_id": 46228513, "comment_id": 107404855, "body": "@majidarif You are right, GetVersion does not work, I updated my answer. Please consider removing your comment as it is now misleading for future readers."}, {"owner": {"reputation": 2712, "user_id": 2267932, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fb8389c99a599092b185844a3d0599a5?s=128&d=identicon&r=PG", "display_name": "MarSoft", "link": "https://stackoverflow.com/users/2267932/marsoft"}, "edited": false, "score": 0, "creation_date": 1616018074, "post_id": 46228513, "comment_id": 117875594, "body": "The <code>RtlGetVersion</code> is missing from the <code>gonutz&#47;w32</code> library, at least in its current version (a6f5759)"}, {"owner": {"reputation": 2712, "user_id": 2267932, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fb8389c99a599092b185844a3d0599a5?s=128&d=identicon&r=PG", "display_name": "MarSoft", "link": "https://stackoverflow.com/users/2267932/marsoft"}, "edited": false, "score": 0, "creation_date": 1616019719, "post_id": 46228513, "comment_id": 117876133, "body": "You will need to use <code>github.com&#47;gonutz&#47;w32&#47;v2</code> which <i>does</i> include this function. Updated the code in answer."}], "tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1616065768, "last_edit_date": 1616065768, "creation_date": 1505424510, "answer_id": 46228513, "question_id": 44363911, "link": "https://stackoverflow.com/questions/44363911/detect-windows-version-in-go/46228513#46228513", "title": "Detect windows version in Go", "body": "<p>If you want to get the Windows version, use the <a href=\"https://github.com/gonutz/w32\" rel=\"nofollow noreferrer\">w32 library</a>, a pure Go Win32 API wrapper.</p>\n<p>It has w32.RtlGetVersion() which returns a struct containing (besides other things) MajorVersion and MinorVersion. These will report the correct Windows version that the program is running on.</p>\n<p>You cannot rely on the function w32.GetVersion(). Theoretically you could use <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/ms724832(v=vs.85).aspx\" rel=\"nofollow noreferrer\">this Windows version table</a> to know where you are but GetVersion only works for applications that have a correct manifest file which says that the program is for Windows 10. If you just compile with <code>go build</code> without a manifest file, GetVersion will still report Windows 8 (Windows version 6.2).</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/gonutz/w32/v2&quot;\n)\n\nfunc main() {\n    v := w32.RtlGetVersion()\n    fmt.Println(v.MajorVersion, v.MinorVersion)\n}\n</code></pre>\n<p>Note however, as others have stated correctly, that you should really be using the appropriate Win32 API functions to get the special folders in your case.</p>\n"}], "owner": {"reputation": 43, "user_id": 4940673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AwvRj.png?s=128&g=1", "display_name": "JackMordaunt", "link": "https://stackoverflow.com/users/4940673/jackmordaunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2955, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1616065768, "creation_date": 1496647944, "question_id": 44363911, "link": "https://stackoverflow.com/questions/44363911/detect-windows-version-in-go", "title": "Detect windows version in Go", "body": "<p>Is there anyway to detect if the host operating system is XP, Vista, 7, 8, or 10?\n<code>runtime.GOOS</code> just returns \"windows\".</p>\n\n<p>The reason for this is because I'm trying to manipulate files in the startup folder.</p>\n\n<p>On windows vista, 7, 8, 10 it's located at: </p>\n\n<p><code>%appdata%\\Roaming\\Microsoft\\Windows\\Start Menu\\Programs\\Startup</code></p>\n\n<p>On windows XP it's located at:</p>\n\n<p><code>Documents and Settings\\%username%\\Start Menu\\Programs\\Startup</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "is_accepted": true, "score": 1, "last_activity_date": 1496649801, "creation_date": 1496649801, "answer_id": 44364375, "question_id": 44363096, "link": "https://stackoverflow.com/questions/44363096/how-long-should-golang-graceful-http-shutdown-take/44364375#44364375", "title": "How long should Golang graceful HTTP shutdown take?", "body": "<blockquote>\n  <p>waiting indefinitely for connections to return to idle</p>\n</blockquote>\n\n<p>refers to HTTP Handlers that have already been called as part of incoming connections. All these handlers need to be closed / returned, usually by calling <a href=\"https://golang.org/pkg/net/http/#ResponseWriter\" rel=\"nofollow noreferrer\"><code>w.Write or w.WriteHeader</code></a></p>\n"}], "owner": {"reputation": 2549, "user_id": 181509, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/bc38deaf59377e15ec390fa1c7903393?s=128&d=identicon&r=PG", "display_name": "EmpireJones", "link": "https://stackoverflow.com/users/181509/empirejones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 682, "favorite_count": 0, "accepted_answer_id": 44364375, "answer_count": 1, "score": 2, "last_activity_date": 1497938328, "creation_date": 1496644893, "last_edit_date": 1497938328, "question_id": 44363096, "link": "https://stackoverflow.com/questions/44363096/how-long-should-golang-graceful-http-shutdown-take", "title": "How long should Golang graceful HTTP shutdown take?", "body": "<p>According to <a href=\"https://golang.org/pkg/net/http/#Server.Shutdown\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Server.Shutdown</a></p>\n\n<blockquote>\n  <p>Shutdown gracefully shuts down the server without interrupting any active connections. Shutdown works by first closing all open listeners, then closing all idle connections, and then waiting indefinitely for connections to return to idle and then shut down. If the provided context expires before the shutdown is complete, then the context's error is returned.</p>\n</blockquote>\n\n<p>What does \"then waiting indefinitely for connections to return to idle and then shut down\" mean exactly? Should I expect that the context timeout should typically occur before this graceful shutdown finishes, given a timeout on the order of seconds?</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 432, "user_id": 3211679, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Mynwy.jpg?s=128&g=1", "display_name": "Gutyn", "link": "https://stackoverflow.com/users/3211679/gutyn"}, "edited": false, "score": 0, "creation_date": 1496638423, "post_id": 44361866, "comment_id": 75725435, "body": "The problem is with the &#39;iso&#39; it is dynamic, I get that from an API call and I never know what new isos I will get."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496666851, "post_id": 44361866, "comment_id": 75739523, "body": "This doesn&#39;t make any sense - BTC_BCN is the name of the field that <i>contains this struct</i>, not the name of a field <i>in this struct</i>."}], "tags": [], "owner": {"reputation": 39, "user_id": 1107128, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/564dc5548f32651077cbbbfce02fccc7?s=128&d=identicon&r=PG", "display_name": "tab1293", "link": "https://stackoverflow.com/users/1107128/tab1293"}, "is_accepted": false, "score": 1, "last_activity_date": 1496638480, "last_edit_date": 1496638480, "creation_date": 1496638345, "answer_id": 44361866, "question_id": 44361778, "link": "https://stackoverflow.com/questions/44361778/go-decode-json-string/44361866#44361866", "title": "Go decode json string", "body": "<p>You are trying to decode in to a map containing your crypto object. This is incorrect. Create the mappings in the struct definition like so:</p>\n\n<pre><code>type Crypto struct {\n    iso           string  `json:\"BTC_BCN\"` //this is the key (ex: BTC_BCN)\n    id            int     `json:\"id\"`\n    last          float64 `json:\"las\"`\n    ...\n}\n\ncrypto := &amp;Crypto{}\nerr = json.NewDecoder(reader).Decode(crypto)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 341, "user_id": 529321, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e974ce23b1f3016285b373fcba49c310?s=128&d=identicon&r=PG", "display_name": "skomp", "link": "https://stackoverflow.com/users/529321/skomp"}, "edited": false, "score": 1, "creation_date": 1496694742, "post_id": 44361889, "comment_id": 75755364, "body": "Regarding floats in strings: a tag can help: <code>{... Last float64 `json:&quot;last,string&quot;`...</code>}, this also allows you to keep the names in the json separated from the names in the struct."}], "tags": [], "owner": {"reputation": 9424, "user_id": 1248913, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ced76ce8952257b480f8b1c96ab0a79?s=128&d=identicon&r=PG", "display_name": "Roy Lee", "link": "https://stackoverflow.com/users/1248913/roy-lee"}, "is_accepted": true, "score": 2, "last_activity_date": 1496710021, "last_edit_date": 1496710021, "creation_date": 1496638506, "answer_id": 44361889, "question_id": 44361778, "link": "https://stackoverflow.com/questions/44361778/go-decode-json-string/44361889#44361889", "title": "Go decode json string", "body": "<pre><code>//Crypto is the currency object\ntype Crypto struct {\n    Iso           string //this is the key (ex: BTC_BCN)\n    Id            int\n    Last          string\n    LowestAsk     string\n    HighestBid    string\n    PercentChange string\n    BaseVolume    string\n    QuoteVolume   string\n    IsFrozen      int\n    High24hr      string\n    Low24hr       string\n}\n</code></pre>\n\n<p>You need to to export the fields by capitalising first character. On top of that, your <code>float64</code> datas are in type: <code>string</code>,hence either you read as string or format before assign to object  <code>Crypto</code>.</p>\n\n<hr>\n\n<p><strong>Updated:</strong></p>\n\n<p>As pointed by @skomp, you may use a tag to annotate the type you're receiving from json file.</p>\n\n<pre><code>type Crypto struct {\n    CryptoKey\n    Id            int\n    Last          float64 `json:\"last,string\"`\n    LowestAsk     float64 `json:\"lowestAsk,string\"`\n    HighestBid    float64 `json:\"highestBid,string\"`\n    PercentChange float64 `json:\"percentChange,string\"`\n    BaseVolume    float64 `json:\"baseVolume,string\"`\n    QuoteVolume   float64 `json:\"quoteVolume,string\"`\n    IsFrozen      int\n    High24hr      float64 `json:\"high24hr,string\"`\n    Low24hr       float64 `json:\"low24hr,string\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 432, "user_id": 3211679, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Mynwy.jpg?s=128&g=1", "display_name": "Gutyn", "link": "https://stackoverflow.com/users/3211679/gutyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 136, "favorite_count": 1, "accepted_answer_id": 44361889, "answer_count": 2, "score": 1, "last_activity_date": 1496710021, "creation_date": 1496637685, "question_id": 44361778, "link": "https://stackoverflow.com/questions/44361778/go-decode-json-string", "title": "Go decode json string", "body": "<p>discovered that go json decoding is a big pain in the butt so please help.\nHere's my json:</p>\n\n<pre><code> {  \n   \"BTC_BCN\":{  \n      \"id\":7,\n      \"last\":\"0.00000156\",\n      \"lowestAsk\":\"0.00000156\",\n      \"highestBid\":\"0.00000155\",\n      \"percentChange\":\"0.01960784\",\n      \"baseVolume\":\"4920.84786257\",\n      \"quoteVolume\":\"3016048494.19305944\",\n      \"isFrozen\":\"0\",\n      \"high24hr\":\"0.00000183\",\n      \"low24hr\":\"0.00000145\"\n   },\n   \"BTC_BELA\":{  \n      \"id\":8,\n      \"last\":\"0.00008847\",\n      \"lowestAsk\":\"0.00008848\",\n      \"highestBid\":\"0.00008847\",\n      \"percentChange\":\"-0.00405268\",\n      \"baseVolume\":\"169.66498061\",\n      \"quoteVolume\":\"1981232.44495809\",\n      \"isFrozen\":\"0\",\n      \"high24hr\":\"0.00008995\",\n      \"low24hr\":\"0.00008120\"\n   }, ...\n}\n</code></pre>\n\n<p>So I need to put that in a type that I created</p>\n\n<pre><code>//Crypto is the currency object\ntype Crypto struct {\n    iso           string //this is the key (ex: BTC_BCN)\n    id            int\n    last          float64\n    lowestAsk     float64\n    highestBid    float64\n    percentChange float64\n    baseVolume    float64\n    quoteVolume   float64\n    isFrozen      int\n    high24hr      float64\n    low24hr       float64\n}\n</code></pre>\n\n<p>and here is what I did so far, but I ended up with the keys in place and an empty value</p>\n\n<pre><code>func main() {\n    // sendEmail(\"Some text\")\n    currencies := getCurrencies()\n    if currencies == nil {\n        return\n    }\n    fmt.Println(len(currencies))\n\n}\n\nfunc getCurrencies() map[string]Crypto {\n    curList := make(map[string]Crypto)\n    resp, err := http.Get(\"https://poloniex.com/public?command=returnTicker\")\n    // fmt.Println(err)\n    if err != nil {\n        sendEmail(\"Error getting data from poloniex \" + err.Error())\n        return nil\n    }\n    body, readErr := ioutil.ReadAll(resp.Body)\n    reader := strings.NewReader(string(body))\n    jsonErr := json.NewDecoder(reader).Decode(&amp;curList)\n    // fmt.Printf(\"curList is : %#v\\n\", curList)\n    // fmt.Printf(\"body is : %s\\n\", string(body))\n    if readErr != nil {\n        fmt.Printf(\"readErr: %s\\n\", readErr.Error())\n    }\n    if jsonErr != nil {\n        fmt.Printf(\"jsonErr: %s\\n\", jsonErr.Error())\n    }\n    for k, v := range curList {\n        fmt.Println(\"k:\", k, \"v:\", v)\n    }\n    defer resp.Body.Close()\n    return curList\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>k: BTC_MAID v: {0 0 0 0 0 0 0 0 0 0}\nk: BTC_NOTE v: {0 0 0 0 0 0 0 0 0 0}\nk: BTC_VRC v: {0 0 0 0 0 0 0 0 0 0}\nk: BTC_DOGE v: {0 0 0 0 0 0 0 0 0 0}...\n</code></pre>\n\n<p>Please excuse my stupid question but I've spent days on it and I think I am missing something.\nCheers.</p>\n"}, {"tags": ["image", "go", "png", "rgba"], "comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496689263, "post_id": 44360964, "comment_id": 75752678, "body": "When I test I get <code>[254 254 254 254 255 255 255 255 ...]</code>. On what kind of computer are you running your code?"}, {"owner": {"reputation": 63, "user_id": 6426128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4eJd2.png?s=128&g=1", "display_name": "jijigogo", "link": "https://stackoverflow.com/users/6426128/jijigogo"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496690132, "post_id": 44360964, "comment_id": 75753111, "body": "@md2perpe arch linux x86_64 on a lenovo laptop with an intel i5-3210M (don&#39;t know if that&#39;s the info you were asking for). Did you try to decode the image to check if the values are correct ? Because if I do fmt.Println(rgba) after encoding everything seems ok, but when I open the image it has wrong colors. Decoding the image once again shows the wrong values on the rgba."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496690496, "post_id": 44360964, "comment_id": 75753299, "body": "Then you are running on the same kind of processor as I am (x86_64), so there should not be a difference due to different endians."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496690575, "post_id": 44360964, "comment_id": 75753331, "body": "How are you printing the slice?"}, {"owner": {"reputation": 63, "user_id": 6426128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4eJd2.png?s=128&g=1", "display_name": "jijigogo", "link": "https://stackoverflow.com/users/6426128/jijigogo"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496691088, "post_id": 44360964, "comment_id": 75753584, "body": "@md2perpe I&#39;m printing the whole image.RGBA. It prints the slice, the max and min coordinates (and a number that idk what it means)."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496692034, "post_id": 44360964, "comment_id": 75754057, "body": "That number is the <i>stride</i>. As I understand it, it&#39;s the length in bytes of one row in the image. <a href=\"https://golang.org/src/image/image.go#L59\" rel=\"nofollow noreferrer\">golang.org/src/image/image.go#L59</a>"}], "owner": {"reputation": 63, "user_id": 6426128, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4eJd2.png?s=128&g=1", "display_name": "jijigogo", "link": "https://stackoverflow.com/users/6426128/jijigogo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 426, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1496666878, "creation_date": 1496630321, "last_edit_date": 1496666878, "question_id": 44360964, "link": "https://stackoverflow.com/questions/44360964/modifying-png-alpha-channel-with-go-breaks-the-image-color", "title": "Modifying png alpha channel with Go breaks the image color", "body": "<p>I'm trying to change png RGBA values with Go's image/png package. I have no problems modifying R, G or B but when I alter alpha values the image \"breaks\", other values change with no apparent pattern.</p>\n\n<p>Nothing of this happens if I leave alpha channel untouched.</p>\n\n<p>I decode the png this way:</p>\n\n<pre><code>img, err := png.Decode(file)\nif (err != nil) {\n    log.Fatal(err)\n}\ndefer file.Close()\n\nrgba := image.NewRGBA(img.Bounds())\ndraw.Draw(rgba, rgba.Bounds(), img, image.Point{0,0}, draw.Src)\n</code></pre>\n\n<p>And then this way I modify and encode the image:</p>\n\n<pre><code>rgba.Pix[0] = uint8(254)  // red channel of 1st pixel\nrgba.Pix[1] = uint8(254)  // green channel of 1st pixel\nrgba.Pix[2] = uint8(254)  // blue channel of 1st pixel\nrgba.Pix[3] = uint8(254)  // alpha channel of 1st pixel\n\nnew_file, err := os.Create(\"new.png\")\nif (err != nil) {\n    log.Fatal(err)\n}\ndefer new_file.Close()\n\npng.Encode(new_file, rgba)\n</code></pre>\n\n<p>this is 2x2 solid white image's pixel slice</p>\n\n<pre><code>[255 255 255 255 255 255 255 255 255 255 255 255 255 255 255 255]\n</code></pre>\n\n<p>and this is the same slice after the change</p>\n\n<pre><code>[255 255 255 254 255 255 255 254 255 255 255 255 255 255 255 255]\n</code></pre>\n\n<p>and I only modified the first pixel. I'm clueless about what might be happening.</p>\n\n<p>Thanks in advance :)</p>\n\n<hr>\n\n<p>EDIT 1</p>\n\n<p>Making this change over the same white 2x2 image</p>\n\n<pre><code>[255 254 254 254 254 255 255 254 254 254 254 254 254 254 255 255]\n</code></pre>\n\n<p>with both rgba.SetRGBA and rgba.Pix way, I end up with this</p>\n\n<pre><code>[0 254 254 254 254 0 0 254 254 254 254 254 254 254 255 255]\n</code></pre>\n"}, {"tags": ["pointers", "go"], "comments": [{"owner": {"reputation": 1447, "user_id": 6101419, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh5.googleusercontent.com/-i7UE6w9zuc8/AAAAAAAAAAI/AAAAAAAAAeU/A7Hw5rvVpYc/photo.jpg?sz=128", "display_name": "Enrico Borba", "link": "https://stackoverflow.com/users/6101419/enrico-borba"}, "edited": false, "score": 2, "creation_date": 1496620146, "post_id": 44359916, "comment_id": 75721687, "body": "It seems that the memory to hold a <code>Student</code> is not allocated. Try <code>var newStudent *Student := new(Student)</code>"}, {"owner": {"reputation": 83, "user_id": 5902381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-ryQHRPr1cTA/AAAAAAAAAAI/AAAAAAAAAH0/ocl8QbWfa3k/photo.jpg?sz=128", "display_name": "Umutcan Ert&#252;rk", "link": "https://stackoverflow.com/users/5902381/umutcan-ert%c3%bcrk"}, "reply_to_user": {"reputation": 1447, "user_id": 6101419, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh5.googleusercontent.com/-i7UE6w9zuc8/AAAAAAAAAAI/AAAAAAAAAeU/A7Hw5rvVpYc/photo.jpg?sz=128", "display_name": "Enrico Borba", "link": "https://stackoverflow.com/users/6101419/enrico-borba"}, "edited": false, "score": 0, "creation_date": 1496620525, "post_id": 44359916, "comment_id": 75721774, "body": "it s work. Thanks a lot."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 5, "last_activity_date": 1496641275, "last_edit_date": 1496641275, "creation_date": 1496620517, "answer_id": 44359968, "question_id": 44359916, "link": "https://stackoverflow.com/questions/44359916/golang-pointer-definition/44359968#44359968", "title": "Golang pointer definition", "body": "<p>You need to allocate memory for the <code>Student</code> <code>struct</code>. For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Student struct {\n    Name string\n}\n\nfunc main() {\n    var newStudent *Student\n\n    newStudent = new(Student)\n    newStudent.Name = \"John\"\n    fmt.Println(*newStudent)\n\n    newStudent = &amp;Student{}\n    newStudent.Name = \"Jane\"\n    fmt.Println(*newStudent)\n\n    newStudent = &amp;Student{Name: \"Jill\"}\n    fmt.Println(*newStudent)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{John}\n{Jane}\n{Jill}\n</code></pre>\n"}], "owner": {"reputation": 83, "user_id": 5902381, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh6.googleusercontent.com/-ryQHRPr1cTA/AAAAAAAAAAI/AAAAAAAAAH0/ocl8QbWfa3k/photo.jpg?sz=128", "display_name": "Umutcan Ert&#252;rk", "link": "https://stackoverflow.com/users/5902381/umutcan-ert%c3%bcrk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 1, "accepted_answer_id": 44359968, "answer_count": 1, "score": 1, "last_activity_date": 1496641275, "creation_date": 1496619947, "last_edit_date": 1496620886, "question_id": 44359916, "link": "https://stackoverflow.com/questions/44359916/golang-pointer-definition", "title": "Golang pointer definition", "body": "<p>Guys I have Student struct and I am trying to create Student item as *Student. I get <strong>invalid memory address or nil pointer dereference</strong> error.</p>\n\n<pre><code>var newStudent *Student\nnewStudent.Name = \"John\"\n</code></pre>\n\n<p>I m creating like that. When I try to set any variable, I am getting same error. What did I wrong?</p>\n"}, {"tags": ["string", "pointers", "go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 21, "last_activity_date": 1496620635, "last_edit_date": 1496620635, "creation_date": 1496620178, "answer_id": 44359942, "question_id": 44359812, "link": "https://stackoverflow.com/questions/44359812/set-nil-string-pointer-to-empty-string/44359942#44359942", "title": "Set nil string pointer to empty string", "body": "<p>String literals are not <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"noreferrer\">addressable</a>.</p>\n\n<p>Take the address of variable containing the empty string:</p>\n\n<pre><code>s := \"\"\nt.value = &amp;s\n</code></pre>\n\n<p>or use new:</p>\n\n<pre><code>t.value = new(string)\n</code></pre>\n"}], "owner": {"reputation": 1560, "user_id": 7238194, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46497aa6a9bfc3011e601e06c564449?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy P", "link": "https://stackoverflow.com/users/7238194/jimmy-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9530, "favorite_count": 0, "accepted_answer_id": 44359942, "answer_count": 1, "score": 8, "last_activity_date": 1536581892, "creation_date": 1496618887, "last_edit_date": 1536581892, "question_id": 44359812, "link": "https://stackoverflow.com/questions/44359812/set-nil-string-pointer-to-empty-string", "title": "Set nil string pointer to empty string", "body": "<p>How do I set the referenced value of a string pointer in a type to the empty string?\nConsider this example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Test struct {\n    value *string\n}\n\nfunc main() {\n    t := Test{nil}\n    if t.value == nil {\n        // I want to set the pointer's value to the empty string here\n    }\n\n    fmt.Println(t.value)\n}\n</code></pre>\n\n<p>I've tried all combinations of the <code>&amp;</code> and <code>*</code> operators to no avail:</p>\n\n<pre><code>t.value = &amp;\"\"\nt.value = *\"\"\n&amp;t.value = \"\"\n*t.value = \"\"\n</code></pre>\n\n<p>Obviously some of those are silly, but I didn't see the harm in trying. \nI also tried using <code>reflect</code> and <code>SetString</code>:</p>\n\n<pre><code>reflect.ValueOf(t.value).SetString(\"\")\n</code></pre>\n\n<p>and this gives a compilation error</p>\n\n<blockquote>\n  <p>panic: reflect: reflect.Value.SetString using unaddressable value</p>\n</blockquote>\n\n<p>I'm assuming that's because strings in Go are immutable?</p>\n"}, {"tags": ["go", "yaml"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 2, "creation_date": 1496608400, "post_id": 44358437, "comment_id": 75718877, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29544146/go-unmarshaling-yaml-into-struct\">Go Unmarshaling YAML into struct</a>"}, {"owner": {"reputation": 809, "user_id": 2856410, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7e8b34fda50be6c760126e850800914c?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan", "link": "https://stackoverflow.com/users/2856410/nathan"}, "edited": false, "score": 0, "creation_date": 1496608506, "post_id": 44358437, "comment_id": 75718903, "body": "Tried that, <code>hostOrigin string </code>yaml:&quot;host_origin&quot;`` and changed my yaml to <code>host_origin: testing</code>, no difference though."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1496609440, "post_id": 44358437, "comment_id": 75719136, "body": "Simply changing <code>hostOrigin string</code> to <code>HostOrigin string</code> in the Go file and <code>host_origin</code> to <code>hostorigin</code> in the YAML file fixed it for me. I was also able to still use the original <code>hostOrigin</code> in the YAML by adding the <code>yaml:&quot;hostOrigin&quot;</code> struct tag to the newly renamed <code>HostOrigin</code> field in the Go file."}, {"owner": {"reputation": 809, "user_id": 2856410, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7e8b34fda50be6c760126e850800914c?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan", "link": "https://stackoverflow.com/users/2856410/nathan"}, "edited": false, "score": 1, "creation_date": 1496610902, "post_id": 44358437, "comment_id": 75719560, "body": "Strange, that worked. Thanks!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1496667496, "post_id": 44358437, "comment_id": 75739952, "body": "Not strange. Same as with JSON, only <i>exported fields</i> (those starting with a capital letter) will be unmarshaled."}], "owner": {"reputation": 809, "user_id": 2856410, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/7e8b34fda50be6c760126e850800914c?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan", "link": "https://stackoverflow.com/users/2856410/nathan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1219, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496607866, "creation_date": 1496607866, "question_id": 44358437, "link": "https://stackoverflow.com/questions/44358437/yaml-unmarshal-wont-parse-yaml-to-struct", "title": "Yaml Unmarshal won&#39;t parse YAML to struct", "body": "<p>I'm trying to load a config file into a struct in Go. I'm getting no errors thrown, but my structure isn't modified at all. The way I'm doing it matches most examples I found online so I'm not really sure what's wrong.</p>\n\n<pre><code>type Config struct {\n  hostOrigin string\n}\n\nconst configName string = \"config.yml\"\n\nfunc readConfig() (Config, error) {\n  config := Config{}\n\n  file, err := ioutil.ReadFile(configName)\n  if err != nil {\n    return config, err\n  }\n\n  fmt.Println(string(file))\n\n  err = yaml.Unmarshal(file, &amp;config)\n  if err != nil {\n    return config, err\n  }\n\n  spew.Dump(config)\n  ...\n}\n</code></pre>\n\n<p>My output is:</p>\n\n<pre><code>---\nhostOrigin: testing\n\n(main.Config) {\n hostOrigin: (string) \"\"\n}\n</code></pre>\n\n<p>The file data is being output correctly, so it looks like the file is being read fine. But the structure isn't filled in.</p>\n"}, {"tags": ["go", "luajit", "musl"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1496630984, "post_id": 44358275, "comment_id": 75723777, "body": "How if you change the <code>LDFLAGS</code> to <code>#cgo LDFLAGS: -L&#47;usr&#47;local&#47;lib -lluajit-5.1</code>?"}, {"owner": {"reputation": 421, "user_id": 1011543, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c9b5da400fe5a7e17a019a55ee52e622?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011543/michael"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496653058, "post_id": 44358275, "comment_id": 75731760, "body": "@putu Edited my question to show result after this modification. Thank you for comment!"}], "answers": [{"tags": [], "owner": {"reputation": 421, "user_id": 1011543, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c9b5da400fe5a7e17a019a55ee52e622?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011543/michael"}, "is_accepted": true, "score": 0, "last_activity_date": 1496654772, "creation_date": 1496654772, "answer_id": 44365728, "question_id": 44358275, "link": "https://stackoverflow.com/questions/44358275/build-static-binary-with-cgo-luajit-and-musl/44365728#44365728", "title": "Build static binary with cgo, LuaJIT and musl", "body": "<p><a href=\"https://stackoverflow.com/users/6207052/\" title=\"@putu\">@putu</a> pointed me to the right direction, all I had to do was tune <code>CFLAGS</code> to include <code>musl</code>.</p>\n\n<p>Cleaned up <code>C</code> comment in <code>lua.go</code>:</p>\n\n<pre><code>/*\n#cgo CFLAGS: -I/usr/include/luajit-2.0 -I/usr/local/musl/include/\n#cgo LDFLAGS: -L/usr/local/lib -lluajit-5.1\n#include &lt;lua.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"golua.h\"\n*/\nimport \"C\"\n</code></pre>\n\n<p>Looks like everything builds just fine:</p>\n\n<pre><code>$ CC=\"/usr/local/musl/bin/musl-gcc\" go build --ldflags '-linkmode external -extldflags \"-static\"' basic.go\n$ file basic\nbasic: ELF 64-bit LSB executable, x86-64, version 1 (SYSV), statically linked, not stripped\n$ ./basic \nHello World!\ntest2 arg: 42\nfrom bottom: 42\nhello world! from go!\nhello world! from go!\nhello world! from go!\nCiao [string \"test2(42)\"]:1: attempt to call global 'test2' (a nil value)\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 1011543, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/c9b5da400fe5a7e17a019a55ee52e622?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011543/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1699, "favorite_count": 0, "accepted_answer_id": 44365728, "answer_count": 1, "score": 4, "last_activity_date": 1496654772, "creation_date": 1496606561, "last_edit_date": 1496652099, "question_id": 44358275, "link": "https://stackoverflow.com/questions/44358275/build-static-binary-with-cgo-luajit-and-musl", "title": "Build static binary with cgo, LuaJIT and musl", "body": "<p>After reading <a href=\"https://dominik.honnef.co/posts/2015/06/go-musl/\" rel=\"nofollow noreferrer\" title=\"Statically compiled Go programs, always, even with cgo, using musl\"><em>Statically compiled Go programs, always, even with cgo, using musl</em></a> I'm trying to use described method to statically link <a href=\"http://luajit.org/\" rel=\"nofollow noreferrer\" title=\"LuaJIT\">LuaJIT</a>. </p>\n\n<ul>\n<li>Using <a href=\"https://github.com/aarzilli/golua\" rel=\"nofollow noreferrer\">https://github.com/aarzilli/golua</a> go bindings</li>\n<li>Assuming <a href=\"https://www.musl-libc.org/\" rel=\"nofollow noreferrer\" title=\"musl\">musl</a> and <a href=\"https://github.com/aarzilli/golua\" rel=\"nofollow noreferrer\" title=\"golua\">golua</a> are already installed</li>\n</ul>\n\n<p>Go code I try to build:</p>\n\n<pre><code>package main\n\nimport \"github.com/aarzilli/golua/lua\"\nimport \"fmt\"\n\nfunc test(L *lua.State) int {\n    fmt.Println(\"hello world! from go!\")\n    return 0\n}\n\nfunc test2(L *lua.State) int {\n    arg := L.CheckInteger(-1)\n    argfrombottom := L.CheckInteger(1)\n    fmt.Print(\"test2 arg: \")\n    fmt.Println(arg)\n    fmt.Print(\"from bottom: \")\n    fmt.Println(argfrombottom)\n    return 0\n}\n\nfunc main() {\n    L := lua.NewState()\n    defer L.Close()\n    L.OpenLibs()\n\n    L.GetField(lua.LUA_GLOBALSINDEX, \"print\")\n    L.PushString(\"Hello World!\")\n    L.Call(1, 0)\n\n    L.PushGoFunction(test)\n    L.PushGoFunction(test)\n    L.PushGoFunction(test)\n    L.PushGoFunction(test)\n\n    L.PushGoFunction(test2)\n    L.PushInteger(42)\n    L.Call(1, 0)\n\n    L.Call(0, 0)\n    L.Call(0, 0)\n    L.Call(0, 0)\n\n    // this will fail as we didn't register test2 function\n    err := L.DoString(\"test2(42)\")\n\n    fmt.Printf(\"Ciao %v\\n\", err)\n}\n</code></pre>\n\n<p>Build command with parameters and output:</p>\n\n<pre><code>$ CC=\"/usr/local/musl/bin/musl-gcc\" go build --ldflags '-linkmode external -extldflags \"-static\"' basic.go\n# command-line-arguments\n/usr/local/go/pkg/tool/linux_amd64/link: running /usr/local/musl/bin/musl-gcc failed: exit status 1\n/usr/bin/ld: cannot find -lluajit-5.1\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Using <code>LD_DEBUG=all</code> I can get <a href=\"https://gist.github.com/anonymous/776297075dcc080a20ffe435902f3f57\" rel=\"nofollow noreferrer\" title=\"more information\">more information</a> (8000+ lines).</p>\n\n<p>My question: <strong>what is the problem and how to solve it</strong>? I think there can be some hint <a href=\"https://stackoverflow.com/questions/38785691/trying-to-build-static-cgo-executable-with-oracle-libraries-on-linux-ubuntu\" title=\"here\">here</a> but I can't quite grasp it.</p>\n\n<p>I took following steps:</p>\n\n<h2>1. Build static LuaJIT library with musl.</h2>\n\n<pre><code>$ make STATIC_CC=\"/usr/local/musl/bin/musl-gcc\" CCOPT=\"-static -fPIC\" BUILDMODE=\"static\"\n...\n==== Successfully built LuaJIT 2.0.4 ====\n</code></pre>\n\n<h2>2. Build dynamic LuaJIT library with musl.</h2>\n\n<pre><code>$ make DYNAMIC_CC=\"/usr/local/musl/bin/musl-gcc\" BUILDMODE=\"dynamic\"\n...\n==== Successfully built LuaJIT 2.0.4 ====\n</code></pre>\n\n<h2>3. Check build.</h2>\n\n<pre><code>$ find . -iname *.a -o -iname *.so\n./src/libluajit.a\n./src/libluajit.so\n</code></pre>\n\n<h2>4. Install it.</h2>\n\n<pre><code>$ sudo make install\n...\n==== Successfully installed LuaJIT 2.0.4 to /usr/local ====\n</code></pre>\n\n<h2>5. Check installation.</h2>\n\n<pre><code>$ pkg-config luajit --cflags\n-I/usr/include/luajit-2.0\n$ pkg-config luajit --libs\n-lluajit-5.1\n</code></pre>\n\n<h2>6. Modify golua <code>lua.go</code> file to use hardcoded <code>cgo</code> parameters.</h2>\n\n<p>I had problems overriding those values so I simply modify source code.</p>\n\n<p>old <code>C</code> comment with <code>cgo</code> parameters:</p>\n\n<pre><code>/*\n#cgo CFLAGS: -I ${SRCDIR}/lua\n#cgo llua LDFLAGS: -llua\n#cgo luaa LDFLAGS: -llua -lm -ldl\n#cgo linux,!llua,!luaa LDFLAGS: -llua5.1\n#cgo darwin,!luaa pkg-config: lua5.1\n#cgo freebsd,!luaa LDFLAGS: -llua-5.1\n#cgo windows,!llua LDFLAGS: -L${SRCDIR} -llua -lmingwex -lmingw32\n#include &lt;lua.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"golua.h\"\n*/\nimport \"C\"\n</code></pre>\n\n<p>new:</p>\n\n<pre><code>/*\n#cgo CFLAGS: -I/usr/include/luajit-2.0 -I${SRCDIR}/lua\n#cgo LDFLAGS: -lluajit-5.1\n#include &lt;lua.h&gt;\n#include &lt;stdlib.h&gt;\n#include \"golua.h\"\n*/\nimport \"C\"\n</code></pre>\n\n<h2>7. Build some example</h2>\n\n<p>As shown at the beggining of question.</p>\n\n<h3>Where LuaJIT got installed:</h3>\n\n<pre><code>$ find / -iname libluajit* 2&gt; /dev/null\n/usr/local/lib/libluajit-5.1.so.2\n/usr/local/lib/libluajit-5.1.a\n/usr/local/lib/libluajit-5.1.so\n/usr/local/lib/libluajit-5.1.so.2.0.4\n/usr/lib/libluajit-5.1.so.2.0.5\n/usr/lib/libluajit-5.1.so.2\n/usr/lib/libluajit-5.1.a\n/usr/lib/libluajit-5.1.so\n/usr/lib/libluajit.s\n</code></pre>\n\n<hr>\n\n<h2>EDIT 1</h2>\n\n<p>I've followed <a href=\"https://stackoverflow.com/users/6207052/\" title=\"putu\">@putu's</a> comment and changed <code>#cgo LDFLAGS</code> to</p>\n\n<pre><code>#cgo LDFLAGS: -L/usr/local/lib -lluajit-5.1\n</code></pre>\n\n<p>now I have</p>\n\n<pre><code>$ CC=\"/usr/local/musl/bin/musl-gcc\" go build --ldflags '-linkmode external -extldflags \"-static -fPIC\"' basic.go\n# command-line-arguments\n/usr/local/go/pkg/tool/linux_amd64/link: running /usr/local/musl/bin/musl-gcc failed: exit status 1\n/tmp/go-link-916770907/000000.o: In function `printf':\n/usr/include/x86_64-linux-gnu/bits/stdio2.h:104: undefined reference to `__printf_chk'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n"}, {"tags": ["go", "controls"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1496595849, "post_id": 44356300, "comment_id": 75715271, "body": "Typo? Use <code>for toFixed(p, 5) != toFixed(v, 5) {</code>"}, {"owner": {"reputation": 201, "user_id": 8110961, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a09095bc90351d3dc20539671cb0ef98?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/8110961/jack"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1496597346, "post_id": 44356300, "comment_id": 75715745, "body": "Thats right.  Thanks for fixing it for me."}], "answers": [{"tags": [], "owner": {"reputation": 929, "user_id": 8109026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jomoj.jpg?s=128&g=1", "display_name": "Raed Shomali", "link": "https://stackoverflow.com/users/8109026/raed-shomali"}, "is_accepted": false, "score": 0, "last_activity_date": 1496667942, "creation_date": 1496667942, "answer_id": 44369650, "question_id": 44356300, "link": "https://stackoverflow.com/questions/44356300/condition-validation-in-for-loop/44369650#44369650", "title": "Condition validation in for loop", "body": "<p>You should be checking for inequality <code>!=</code> in your <code>for</code> condition.</p>\n\n<p>I modified your code and it seems to be working fine now:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    fmt.Println(Sqrt(9))\n}\n\nfunc Sqrt(x float64) float64 {\n    v := float64(1)\n    p := float64(0)\n\n    for toFixed(p, 5) != toFixed(v, 5) {\n        p = v\n        v -= (v*v - x) / (2 * v)\n    }\n\n    return v\n}\n\nfunc toFixed(num float64, precision int) float64 {\n    output := math.Pow(10, float64(precision))\n    return float64(round(num*output)) / output\n}\n\nfunc round(num float64) int {\n    return int(num + math.Copysign(0.5, num))\n}\n</code></pre>\n"}], "owner": {"reputation": 201, "user_id": 8110961, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a09095bc90351d3dc20539671cb0ef98?s=128&d=identicon&r=PG&f=1", "display_name": "Jack", "link": "https://stackoverflow.com/users/8110961/jack"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496667942, "creation_date": 1496593990, "last_edit_date": 1496614599, "question_id": 44356300, "link": "https://stackoverflow.com/questions/44356300/condition-validation-in-for-loop", "title": "Condition validation in for loop", "body": "<p>my below code to get square root works fine</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    fmt.Println(Sqrt(9))\n}\n\nfunc Sqrt(x float64) float64 {\n    v := float64(1)\n    p := float64(0)\n\n    for {\n        p = v\n        v -= (v*v - x) / (2 * v)\n        fmt.Println(toFixed(p, 5), toFixed(v, 5))\n        if toFixed(p, 5) == toFixed(v, 5) { \n            break\n        }\n    }\n\n    return v\n}\n\nfunc toFixed(num float64, precision int) float64 {\n    output := math.Pow(10, float64(precision))\n    return float64(round(num*output)) / output\n}\n\nfunc round(num float64) int {\n    return int(num + math.Copysign(0.5, num))\n}\n</code></pre>\n\n<p>but if I change the for loop in Sqrt function and remove if break from the loop like below then control flow do not get into for loop and Sqrt() function quits with value as 1.</p>\n\n<pre><code>for toFixed(p, 5) == toFixed(v, 5) {\n    p = v\n    v -= (v*v - x) / (2 * v)\n    fmt.Println(toFixed(p, 5), toFixed(v, 5))\n}\n</code></pre>\n\n<p>Can you please suggest issue in above code?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "unicode", "utf-8"], "answers": [{"comments": [{"owner": {"reputation": 1560, "user_id": 7238194, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46497aa6a9bfc3011e601e06c564449?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy P", "link": "https://stackoverflow.com/users/7238194/jimmy-p"}, "edited": false, "score": 0, "creation_date": 1496574423, "post_id": 44353232, "comment_id": 75708695, "body": "I see it works on the playground, but when I copy it into my own environment I&#39;m getting a compilation error: <code>enc.SetEscapeHTML undefined (type *json.Encoder has no field or method SetEscapeHTML)</code>. I&#39;m using Go 1.6.2 if that changes anything"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 1560, "user_id": 7238194, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46497aa6a9bfc3011e601e06c564449?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy P", "link": "https://stackoverflow.com/users/7238194/jimmy-p"}, "edited": false, "score": 0, "creation_date": 1496574901, "post_id": 44353232, "comment_id": 75708818, "body": "Could be that the method is unavailable in <code>1.6.2</code>. Try checking your version&#39;s docs as described here: <a href=\"https://stackoverflow.com/questions/32487704/go-packages-documentation-for-a-previous-version\" title=\"go packages documentation for a previous version\">stackoverflow.com/questions/32487704/&hellip;</a>"}, {"owner": {"reputation": 1560, "user_id": 7238194, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46497aa6a9bfc3011e601e06c564449?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy P", "link": "https://stackoverflow.com/users/7238194/jimmy-p"}, "edited": false, "score": 0, "creation_date": 1496575150, "post_id": 44353232, "comment_id": 75708879, "body": "Hmm, yep. The docs have no mention of <code>SetEscapeHTML</code> and don&#39;t offer any other alternatives."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1496577947, "post_id": 44353232, "comment_id": 75709653, "body": "SetEscapeHTML was added in Go 1.7."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1496578989, "post_id": 44353232, "comment_id": 75709954, "body": "Since json library does this to only three characters, you can try something like this: <a href=\"https://stackoverflow.com/questions/24656624/golang-display-character-not-ascii-like-not-0026\" title=\"golang display character not ascii like not 0026\">stackoverflow.com/questions/24656624/&hellip;</a>"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 8, "last_activity_date": 1496573345, "creation_date": 1496573345, "answer_id": 44353232, "question_id": 44353109, "link": "https://stackoverflow.com/questions/44353109/decode-marshalled-json-unicode/44353232#44353232", "title": "Decode Marshalled JSON unicode", "body": "<p>This is intended behavior. From the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"noreferrer\">docs</a>:</p>\n\n<blockquote>\n  <p>String values encode as JSON strings coerced to valid UTF-8, replacing\n  invalid bytes with the Unicode replacement rune. The angle brackets\n  \"&lt;\" and \">\" are escaped to \"\\u003c\" and \"\\u003e\" to keep some browsers\n  from misinterpreting JSON output as HTML. Ampersand \"&amp;\" is also\n  escaped to \"\\u0026\" for the same reason. This escaping can be disabled\n  using an Encoder that had SetEscapeHTML(false) called on it.</p>\n</blockquote>\n\n<p>You can get the required result by using an <code>Encoder</code> and calling <code>SetEscapeHTML(false)</code> on it:</p>\n\n<pre><code>func main() {\n    body := \"&lt;html&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;\"\n\n    obj := JSON{body}\n\n    enc := json.NewEncoder(os.Stdout)\n    enc.SetEscapeHTML(false)\n    enc.Encode(obj)\n}\n</code></pre>\n\n<p>Working example: <a href=\"https://play.golang.org/p/lMNCJ16dIo\" rel=\"noreferrer\">https://play.golang.org/p/lMNCJ16dIo</a></p>\n"}, {"tags": [], "owner": {"reputation": 104432, "user_id": 53212, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e0fbce15f81d6308656931250db267a1?s=128&d=identicon&r=PG", "display_name": "thomasrutter", "link": "https://stackoverflow.com/users/53212/thomasrutter"}, "is_accepted": false, "score": 0, "last_activity_date": 1496623714, "creation_date": 1496623714, "answer_id": 44360302, "question_id": 44353109, "link": "https://stackoverflow.com/questions/44353109/decode-marshalled-json-unicode/44360302#44360302", "title": "Decode Marshalled JSON unicode", "body": "<p>By the way, here's the reason for the compiler error.</p>\n\n<p>json.Marshal returns a byte slice (<code>[]byte</code>), not a string.</p>\n\n<p>When you iterate over a byte slice using <code>range</code>, you are not iterating over its <em>runes</em> but over single bytes at a time.  You can't use <code>DecodeRune()</code> on a byte value - it expects a rune, which is a 32-bit integer value representing a Unicode code point.  This is what you'd get if you iterate using <code>range</code> on a <em>string</em>.</p>\n\n<p>Now, from what you are wanting to achieve, it doesn't look like you want DecodeRune at all.</p>\n\n<p>The other answer adequately describes how to tell the JSON encode not to escape <code>&lt;</code> and <code>&gt;</code> characters ie</p>\n\n<pre><code>enc := json.NewEncoder(os.Stdout)\nenc.SetEscapeHTML(false)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "is_accepted": false, "score": 2, "last_activity_date": 1532861097, "creation_date": 1532861097, "answer_id": 51579491, "question_id": 44353109, "link": "https://stackoverflow.com/questions/44353109/decode-marshalled-json-unicode/51579491#51579491", "title": "Decode Marshalled JSON unicode", "body": "<p>Another solution to achieve this is to simply replace those escaped characters into unescaped UTF-8 characters. (I used to do this to make non-English letters to be human readable in JSON.)</p>\n\n<p>You can use the <a href=\"https://golang.org/pkg/encoding/json/#Quote\" rel=\"nofollow noreferrer\"><code>strconv.Quote()</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Unquote\" rel=\"nofollow noreferrer\"><code>strconv.Unquote()</code></a> to do the conversion.</p>\n\n<pre><code>func _UnescapeUnicodeCharactersInJSON(_jsonRaw json.RawMessage) (json.RawMessage, error) {\n    str, err := strconv.Unquote(strings.Replace(strconv.Quote(string(_jsonRaw)), `\\\\u`, `\\u`, -1))\n    if err != nil {\n        return nil, err\n    }\n    return []byte(str), nil\n}\n\nfunc main() {\n    // Both are valid JSON.\n    var jsonRawEscaped json.RawMessage   // json raw with escaped unicode chars\n    var jsonRawUnescaped json.RawMessage // json raw with unescaped unicode chars\n\n    // '\\u263a' == '\u263a'\n    jsonRawEscaped = []byte(`{\"HelloWorld\": \"\\uC548\\uB155, \\uC138\\uC0C1(\\u4E16\\u4E0A). \\u263a\"}`) // \"\\\\u263a\"\n    jsonRawUnescaped, _ = _UnescapeUnicodeCharactersInJSON(jsonRawEscaped)                        // \"\u263a\"\n\n    fmt.Println(string(jsonRawEscaped))   // {\"HelloWorld\": \"\\uC548\\uB155, \\uC138\\uC0C1(\\u4E16\\u4E0A). \\u263a\"}\n    fmt.Println(string(jsonRawUnescaped)) // {\"HelloWorld\": \"\uc548\ub155, \uc138\uc0c1(\u4e16\u4e0a). \u263a\"}\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/pUsrzrrcDG-\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pUsrzrrcDG-</a></p>\n\n<p>I hope this helps.</p>\n"}], "owner": {"reputation": 1560, "user_id": 7238194, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c46497aa6a9bfc3011e601e06c564449?s=128&d=identicon&r=PG&f=1", "display_name": "Jimmy P", "link": "https://stackoverflow.com/users/7238194/jimmy-p"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4668, "favorite_count": 0, "accepted_answer_id": 44353232, "answer_count": 3, "score": 1, "last_activity_date": 1532861097, "creation_date": 1496572500, "last_edit_date": 1496625511, "question_id": 44353109, "link": "https://stackoverflow.com/questions/44353109/decode-marshalled-json-unicode", "title": "Decode Marshalled JSON unicode", "body": "<p>I think the quickest way to explain my problem is with an <a href=\"https://play.golang.org/p/UbtCdVv-kv\" rel=\"nofollow noreferrer\">example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype JSON struct {\n    Body string\n}\n\nfunc main() {\n    body := \"&lt;html&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;\"\n\n    obj := JSON{body}\n\n    result, _ := json.Marshal(obj)\n    fmt.Println(string(result))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<blockquote>\n  <p>{\"Body\":\"\\u003chtml\\u003e\\u003cbody\\u003eHello World\\u003c/body\\u003e\\u003c/html\\u003e\"}</p>\n</blockquote>\n\n<p>I'd like the result to be a utf8-encoded string that reads the same as it went in. How can I achieve this? I tried to use <code>utf8.DecodeRune,</code> in a loop:</p>\n\n<pre><code>str := \"\"\n\nfor _, res := range result {\n    decoded, _ := utf8.DecodeRune(res)\n    str += string(decoded)\n}\n</code></pre>\n\n<p>but that causes a <a href=\"https://play.golang.org/p/1ErAJ4geF0\" rel=\"nofollow noreferrer\">compilation error</a></p>\n\n<blockquote>\n  <p>main.go:21: cannot use res (type byte) as type []byte in argument to utf8.DecodeRune</p>\n</blockquote>\n\n<p>And calling <code>DecodeRune</code> on the marshalled object returns the <a href=\"https://play.golang.org/p/Z_aSPTLu6A\" rel=\"nofollow noreferrer\">first character</a>, as you'd expect</p>\n\n<blockquote>\n  <p>{</p>\n</blockquote>\n\n<p>Edit: I'm  using Go 1.6.2, which apparently doesn't have <code>SetEscapeHTML</code> for whatever reason. </p>\n"}, {"tags": ["ubuntu", "go", "ubuntu-16.04"], "answers": [{"comments": [{"owner": {"reputation": 2173, "user_id": 735539, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/454864d28e37b7a2f790a1edfa4ca02e?s=128&d=identicon&r=PG", "display_name": "DivinesLight", "link": "https://stackoverflow.com/users/735539/divineslight"}, "edited": false, "score": 0, "creation_date": 1521446149, "post_id": 44354397, "comment_id": 85716110, "body": "Thank you, it worked for me   &quot;sudo apt remove golang-1.9-race-detector-runtime&quot;"}], "tags": [], "owner": {"reputation": 752, "user_id": 7496656, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zMGuk.jpg?s=128&g=1", "display_name": "Jan Zerebecki", "link": "https://stackoverflow.com/users/7496656/jan-zerebecki"}, "is_accepted": true, "score": 2, "last_activity_date": 1496581480, "creation_date": 1496581480, "answer_id": 44354397, "question_id": 44353007, "link": "https://stackoverflow.com/questions/44353007/dpkg-error-processing-archive-var-cache-apt-archives-golang-1-6-go-1-6-2-0ubun/44354397#44354397", "title": "dpkg: error processing archive /var/cache/apt/archives/golang-1.6-go_1.6.2-0ubuntu5~16.04.2_amd64.deb (--unpack):", "body": "<p>That is a bug in the packaging in Ubuntu. This was already reported here: <a href=\"https://bugs.launchpad.net/ubuntu/+source/golang-1.6/+bug/1691834\" rel=\"nofollow noreferrer\">https://bugs.launchpad.net/ubuntu/+source/golang-1.6/+bug/1691834</a></p>\n\n<p>It is likely that as a workaround you can first uninstall golang-1.6-race-detector-runtime, then running <code>apt-get install</code> might work.</p>\n"}], "owner": {"reputation": 197, "user_id": 7995484, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/bc8536b73ceadb9415a083decb90ce09?s=128&d=identicon&r=PG&f=1", "display_name": "JosephCenk", "link": "https://stackoverflow.com/users/7995484/josephcenk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2181, "favorite_count": 0, "accepted_answer_id": 44354397, "answer_count": 1, "score": 2, "last_activity_date": 1496581480, "creation_date": 1496571632, "question_id": 44353007, "link": "https://stackoverflow.com/questions/44353007/dpkg-error-processing-archive-var-cache-apt-archives-golang-1-6-go-1-6-2-0ubun", "title": "dpkg: error processing archive /var/cache/apt/archives/golang-1.6-go_1.6.2-0ubuntu5~16.04.2_amd64.deb (--unpack):", "body": "<p>When I am running sudo apt-get -f install, it shows dpkg: error processing. \nPlease find the complete logs below and advise how to solve this. \nI am running VB 5.0.10 with Ubuntu 16.04 and already installed go 1.8 and its working fine</p>\n\n<pre><code>sudo apt-get -f install\nReading package lists... Done\nBuilding dependency tree       \nReading state information... Done\nCorrecting dependencies... Done\nThe following packages were automatically installed and are no longer required:\n  bridge-utils containerd gir1.2-cogl-1.0 gir1.2-freedesktop:i386 gir1.2-gdkpixbuf-2.0:i386 gir1.2-glib-2.0:i386\n  gir1.2-pango-1.0:i386 libc6-dev:i386 libcaca-dev libcairo-gobject2:i386 libcairo-script-interpreter2:i386 libdmx-dev libdmx1\n  libedata-cal-1.2-28 libepoxy-dev libexpat1-dev:i386 libfontconfig1-dev:i386 libfontenc-dev libfreetype6-dev:i386 libfribidi-dev\n  libfs-dev libfs6 libgeocode-glib0 libgirepository-1.0-1:i386 libglu1-mesa-dev libgmp-dev libgmpxx4ldbl libgweather-common\n  libharfbuzz-gobject0:i386 libharfbuzz-icu0:i386 libice-dev:i386 libice6:i386 libicu55:i386 libilmbase12 libjpeg-turbo8-dev\n  liblzo2-2:i386 libopenexr22 libpangox-1.0-0 libpciaccess-dev libpcre16-3:i386 libpcre3-dev:i386 libpcre32-3:i386\n  libpcrecpp0v5:i386 libpng12-dev:i386 libsdl1.2debian libslang2-dev libsm-dev:i386 libsm6:i386 libvte-common libxaw7-dev\n  libxcb-render0-dev:i386 libxcb-shm0-dev:i386 libxext-dev:i386 libxfont-dev libxkbfile-dev libxmu-dev libxmu-headers libxmuu-dev\n  libxpm-dev libxrender-dev:i386 libxres-dev libxss-dev libxt-dev libxv-dev libxvmc-dev libxxf86dga-dev linux-headers-4.4.0-64\n  linux-headers-4.4.0-64-generic linux-headers-4.4.0-66 linux-headers-4.4.0-66-generic linux-headers-4.4.0-67\n  linux-headers-4.4.0-67-generic linux-headers-4.4.0-70 linux-headers-4.4.0-70-generic linux-headers-4.4.0-71\n  linux-headers-4.4.0-71-generic linux-headers-4.4.0-72 linux-headers-4.4.0-72-generic linux-image-4.4.0-64-generic\n  linux-image-4.4.0-66-generic linux-image-4.4.0-67-generic linux-image-4.4.0-70-generic linux-image-4.4.0-71-generic\n  linux-image-4.4.0-72-generic linux-image-extra-4.4.0-64-generic linux-image-extra-4.4.0-66-generic\n  linux-image-extra-4.4.0-67-generic linux-image-extra-4.4.0-70-generic linux-image-extra-4.4.0-71-generic\n  linux-image-extra-4.4.0-72-generic linux-libc-dev:i386 mir-client-platform-mesa-dev nettle-dev par2 python-cairo python-gobject-2\n  runc ubuntu-fan x11proto-bigreqs-dev x11proto-dmx-dev x11proto-dri3-dev x11proto-fonts-dev x11proto-present-dev\n  x11proto-resource-dev x11proto-scrnsaver-dev x11proto-video-dev x11proto-xcmisc-dev x11proto-xf86bigfont-dev x11proto-xf86dga-dev\n  x11proto-xf86dri-dev zlib1g-dev:i386\nUse 'sudo apt autoremove' to remove them.\nThe following additional packages will be installed:\n  golang-1.6-go\nSuggested packages:\n  bzr\nThe following packages will be upgraded:\n  golang-1.6-go\n1 upgraded, 0 newly installed, 0 to remove and 2 not upgraded.\n44 not fully installed or removed.\nNeed to get 0 B/20.3 MB of archives.\nAfter this operation, 3,072 B of additional disk space will be used.\nDo you want to continue? [Y/n] y \n(Reading database ... 453044 files and directories currently installed.)\nPreparing to unpack .../golang-1.6-go_1.6.2-0ubuntu5~16.04.2_amd64.deb ...\nUnpacking golang-1.6-go (1.6.2-0ubuntu5~16.04.2) over (1.6.2-0ubuntu5~16.04) ...\ndpkg: error processing archive /var/cache/apt/archives/golang-1.6-go_1.6.2-0ubuntu5~16.04.2_amd64.deb (--unpack):\n trying to overwrite '/usr/lib/go-1.6/src', which is also in package golang-1.6-race-detector-runtime 0.0+svn252922-0ubuntu1\nErrors were encountered while processing:\n /var/cache/apt/archives/golang-1.6-go_1.6.2-0ubuntu5~16.04.2_amd64.deb\nE: Sub-process /usr/bin/dpkg returned an error code (1)\n</code></pre>\n"}, {"tags": ["go", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "is_accepted": false, "score": 1, "last_activity_date": 1496580834, "creation_date": 1496580834, "answer_id": 44354314, "question_id": 44352688, "link": "https://stackoverflow.com/questions/44352688/golang-gin-how-to-disable-the-found-link-on-http-redirect/44354314#44354314", "title": "Golang/gin: How to disable the &quot;Found.&quot; link on HTTP redirect", "body": "<p>Yeah, looks like it's a Go thing and you can't disable it.\nI suggest you to write your own <code>Redirect</code> structure like <code>render.Redirect</code> from Gin (you can embed it in your new structure to avoid some copy pasting):</p>\n\n<p><a href=\"https://github.com/gin-gonic/gin/blob/master/render/redirect.go\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin/blob/master/render/redirect.go</a></p>\n\n<p>Write your own <code>Render</code> method for new structure based on code from <code>net/http</code> and then use redirect like this:</p>\n\n<p><a href=\"https://github.com/gin-gonic/gin/blob/32cab500ecc71d2975f5699c8a65c6debb29cfbe/context.go#L476\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin/blob/32cab500ecc71d2975f5699c8a65c6debb29cfbe/context.go#L476</a></p>\n\n<p>I think it's the simplest way to bypass such <code>net/http</code> redirect behavior.</p>\n"}], "owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 641, "favorite_count": 2, "answer_count": 1, "score": 1, "last_activity_date": 1496580834, "creation_date": 1496569129, "question_id": 44352688, "link": "https://stackoverflow.com/questions/44352688/golang-gin-how-to-disable-the-found-link-on-http-redirect", "title": "Golang/gin: How to disable the &quot;Found.&quot; link on HTTP redirect", "body": "<p>I'm using gin framework and I'm redirecting signin to home page when the user is already signed in. It shows this html element on the home page.</p>\n\n<pre><code>&lt;a href=\"/signin\"&gt;Found&lt;/a&gt; \".\"\n</code></pre>\n\n<p>How to disable that element from the app?</p>\n\n<p>This is my app code.</p>\n\n<pre><code>func GetSignIn(c *gin.Context) {\n    // Get session from cookie. Check if email exists\n    // redirect to Home page else show signin page.\n    session := sessions.Default(c)\n    if session.Get(\"email\") != nil {\n        fmt.Println(session.Get(\"email\"))\n        c.Redirect(302, \"/\")\n    }\n    c.HTML(200, \"signin.html\", \"\")\n}\n</code></pre>\n\n<p>It seems like, it's a Go thing\n<a href=\"https://github.com/golang/go/blob/master/src/net/http/server.go#L2014\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/net/http/server.go#L2014</a></p>\n\n<p>But I'm not sure, how to disable it. Would be great if someone guide me.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["sqlite", "go", "go-gin"], "comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1496589414, "post_id": 44352656, "comment_id": 75713125, "body": "Did you try my solution?"}], "answers": [{"comments": [{"owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "edited": false, "score": 0, "creation_date": 1496578282, "post_id": 44353326, "comment_id": 75709753, "body": "I&#39;ve updated the question. I&#39;m using go-sqlite3. When I pass &amp;db, it tells (undefined: GetHomePage, undefined: *SQLITE.DB). I&#39;m not sure which instance should I mention. Could you update your answer based on this? Thanks!"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "reply_to_user": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "edited": false, "score": 0, "creation_date": 1496578459, "post_id": 44353326, "comment_id": 75709800, "body": "I&#39;ve never used it. Check the type of <code>db</code> with <code>fmt.Println(reflect.TypeOf(db))</code> after importing <code>&quot;reflect&quot;</code> and then change  <code>*SQLite.DB</code> to the proper returned type. Giving a fast view to the library it might be <code>sqldb  *SQLiteConn</code> or <code>sqldb  *SQLiteContext</code>."}], "tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": false, "score": 2, "last_activity_date": 1496578807, "last_edit_date": 1496578807, "creation_date": 1496574001, "answer_id": 44353326, "question_id": 44352656, "link": "https://stackoverflow.com/questions/44352656/golang-gin-how-to-pass-db-to-router-functions/44353326#44353326", "title": "Golang/gin: How to Pass db to router functions", "body": "<p>Let's say you have your sql client initialized in <code>db</code>, then, you can pass it to different routes with</p>\n\n<pre><code>r.GET(\"/\", GetHomePageHandler(&amp;db))\n</code></pre>\n\n<p>And in your GetHomePageHandler:</p>\n\n<pre><code>func GetHomePageHandler(sqldb *SQLiteConn) func (*gin.Context) {\n    return  func (*gin.Context) {\n      . . .\n    }\n}\n</code></pre>\n\n<p>Where <code>*SQLiteConn</code> is the type of your sql db instance. I don't know which package you are currently using so this is just an example.</p>\n\n<p>You can find also a more elegant way of solving it <a href=\"https://stackoverflow.com/a/43696494/4684539\">in this answer</a>,</p>\n"}], "owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 964, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1496578807, "creation_date": 1496568817, "last_edit_date": 1496577831, "question_id": 44352656, "link": "https://stackoverflow.com/questions/44352656/golang-gin-how-to-pass-db-to-router-functions", "title": "Golang/gin: How to Pass db to router functions", "body": "<p>I'm using <strong>gin framework</strong>. And I'm opening the sqlite database in the main function like this</p>\n\n<pre><code>func main() {\n...\ndb, err := sql.Open(\"sqlite3\", \"./libreread.db\")\nCheckError(err)\ndefer db.Close()\n...\n}\n</code></pre>\n\n<p>And I have these router handlers in the main function.</p>\n\n<pre><code>...\nr.GET(\"/\", GetHomePage)\nr.GET(\"/signin\", GetSignIn)\nr.POST(\"/signin\", PostSignIn)\n...\n</code></pre>\n\n<p>How to pass that db value through the router handler func <code>PostSignin(c *gin.Context)</code> ?</p>\n\n<p>So that I could avoid opening and closing the database each time in the functions.</p>\n\n<p><strong>UPDATE: I'm using go-sqlite3 package.</strong></p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10112, "user_id": 396567, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/XKKMJ.jpg?s=128&g=1", "display_name": "Michael Hausenblas", "link": "https://stackoverflow.com/users/396567/michael-hausenblas"}, "edited": false, "score": 1, "creation_date": 1496565796, "post_id": 44352094, "comment_id": 75706543, "body": "You can have a look at how the Kubernetes API Server is doing it in the <code>DefaultBuildHandlerChain</code>, as we described in <a href=\"https://blog.openshift.com/kubernetes-deep-dive-api-server-part-1/\" rel=\"nofollow noreferrer\">blog.openshift.com/kubernetes-deep-dive-api-server-part-1</a>"}, {"owner": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "edited": false, "score": 1, "creation_date": 1496574165, "post_id": 44352094, "comment_id": 75708619, "body": "My recommendation is to have a look at some insightful REST API design principles like <a href=\"https://martinfowler.com/articles/richardsonMaturityModel.html\" rel=\"nofollow noreferrer\">Richardson Maturity Model</a> before actually designing RESTful APIs."}, {"owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "reply_to_user": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "edited": false, "score": 0, "creation_date": 1496583457, "post_id": 44352094, "comment_id": 75711255, "body": "how do I implements those theories? @Jermin"}, {"owner": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "edited": false, "score": 0, "creation_date": 1496649844, "post_id": 44352094, "comment_id": 75730021, "body": "After you are done with your design you could use <a href=\"https://github.com/julienschmidt/httprouter\" rel=\"nofollow noreferrer\">HTTPRouter</a>, or <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">Gorilla Mux</a> just to mention a few. But I guess my comment was more of an existential question than a solution. Why would you want such a feature? Isn&#39;t there a better way to do this?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "edited": false, "score": 0, "creation_date": 1496669093, "post_id": 44352094, "comment_id": 75740969, "body": "Second @JerminBazazian note - by the name alone, <code>getUserdata</code> implies an RPC API, not a REST API."}, {"owner": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496674783, "post_id": 44352094, "comment_id": 75744748, "body": "@Adrian but the first sentence talks about REST not RPC. And I am not sure if you noticed by there is a reason that Richardson Maturity Model is called <b>Maturity Model</b> and not just <b>Model</b>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "edited": false, "score": 0, "creation_date": 1496675257, "post_id": 44352094, "comment_id": 75745008, "body": "Yes, I know. I was agreeing with you, hence &quot;second @JerminBazazian note&quot;."}, {"owner": {"reputation": 1802, "user_id": 1319362, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/8acce433e0c03d71994aff02877606cd?s=128&d=identicon&r=PG", "display_name": "Jermin Bazazian", "link": "https://stackoverflow.com/users/1319362/jermin-bazazian"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496730502, "post_id": 44352094, "comment_id": 75765713, "body": "@Adrian, oops my bad"}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1496669634, "creation_date": 1496669634, "answer_id": 44370207, "question_id": 44352094, "link": "https://stackoverflow.com/questions/44352094/golang-hierarchical-routing/44370207#44370207", "title": "Golang hierarchical routing", "body": "<p>Your first (outmost) call to <code>http.HandleFunc</code> is correct - it maps a route to a handler function. The rest of the code implies a misunderstanding of how that works, though. The handler function will be called when a request matching that route comes in; when a handling a request is not the time to register additional routes, because route registration is not request-specific, and it's too late to modify the routing table for the current request. The last call makes even less sense: you can't register a route based on whether the current request is authorized. As soon as one authorized request comes in, that route will be registered for all <em>future</em> requests, regardless of whether those requests are authorized, and will not make any different for the current request.</p>\n\n<p>What you want, most likely, is to replace both of the nested calls to <code>http.HandleFunc</code> with calls to handler methods, e.g.:</p>\n\n<pre><code>func main(){\n    http.HandleFunc(\"/api/\", func(rw, req){\n        if strings.HasPrefix(req.URL.Path, \"/api/authorization\") {\n            doAuthorization(rw,req)\n        }\n    }\n}\n\nfunc doAuthorization(rw http.ResponseWriter, req *http.Request) {\n    if authPassed &amp;&amp; strings.HasPrefix(req.URL.Path, \"/api/authorization/getUserdata\") {\n        getUserFunction(rw,req)\n    }\n}\n</code></pre>\n\n<p>Or, alternatively, use the router for all of it:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/api\", doApi)\n    http.HandleFunc(\"/api/authorization\", doAuthorization)\n    http.HandleFunc(\"/api/authorization/getUserdata\", getUserFunction)\n}\n\nfunc doApi(rw, req) {\n    // Whatever you'd do for a call to \"/api\" itself\n}\n\nfunc doAuthorization(rw http.ResponseWriter, req *http.Request) {\n    // Whatever you'd do for a call to \"/api/authorization\" itself\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 376, "user_id": 6618366, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IbooN.jpg?s=128&g=1", "display_name": "Alejandro", "link": "https://stackoverflow.com/users/6618366/alejandro"}, "is_accepted": false, "score": 0, "last_activity_date": 1497275838, "last_edit_date": 1497275838, "creation_date": 1497275533, "answer_id": 44501162, "question_id": 44352094, "link": "https://stackoverflow.com/questions/44352094/golang-hierarchical-routing/44501162#44501162", "title": "Golang hierarchical routing", "body": "<p>Time ago I did a Web Application with <a href=\"https://gin-gonic.github.io/gin/\" rel=\"nofollow noreferrer\">Gin Web Framework</a>. \nIt\u2019s based in a Radix Tree algorithm. \nIt's also extremely readable, fast to understand and create web APIs. \nHope this hepls.</p>\n"}], "owner": {"reputation": 545, "user_id": 3763112, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/bea14956d83fe906ba4bafcea761250d?s=128&d=identicon&r=PG&f=1", "display_name": "Angger", "link": "https://stackoverflow.com/users/3763112/angger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 628, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1497275838, "creation_date": 1496564158, "question_id": 44352094, "link": "https://stackoverflow.com/questions/44352094/golang-hierarchical-routing", "title": "Golang hierarchical routing", "body": "<p>I want to make RESTful API which has multi layer route like :</p>\n\n<pre><code>/api/auhtorization/getUserdata\n</code></pre>\n\n<p>where <strong>api</strong> stands for webservice name,\n<strong>auhtorization</strong> stands for a function to check validation of token.\nand <strong>getUserdata</strong> stands for a function that get specific user data ( if only request past authorization level )</p>\n\n<pre><code>func main(){\n   http.HandleFunc(\"api/\", func(rw, req){\n      http.HandleFunc(\"authorization/\", func(){\n\n         if (auth passed)\n         {\n            http.HandleFunc(\"getUserdata\", getUserFunction())\n         }\n\n      })\n\n   })\n}\n</code></pre>\n\n<p>I know above code isn't a good example but I seek for best practice or framework for doing this.\nAny answer will be highly appreciated!</p>\n"}, {"tags": ["go", "concurrency", "channel"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 25, "last_activity_date": 1496556206, "last_edit_date": 1496556206, "creation_date": 1496555668, "answer_id": 44351176, "question_id": 44351159, "link": "https://stackoverflow.com/questions/44351159/using-pointer-to-channel/44351176#44351176", "title": "Using pointer to channel", "body": "<p>It usually not good practice to use pointers to channels.</p>\n\n<p>The size of a channel value is equal to the size of a pointer. The size is independent of the number of values in the channel. </p>\n\n<p>You do not reduce copying by using a pointer to a channel because copying the pointer has the same cost as copying the channel.</p>\n"}, {"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 9, "creation_date": 1496660472, "post_id": 44367183, "comment_id": 75735956, "body": "&quot;five categories of value that are passed by reference&quot; --- actually everything in Go is passed by value. <a href=\"https://golang.org/doc/faq#pass_by_value\" rel=\"nofollow noreferrer\">golang.org/doc/faq#pass_by_value</a> &quot;As in all languages in the C family, everything in Go is passed by value.&quot;"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1496755609, "post_id": 44367183, "comment_id": 75782391, "body": "Yes that&#39;s true, perhaps I was over-simplifying: the five categories are all reference types and copying a reference (or passing a reference parameter) does not copy the thing it refers to. One might argue that saying everything is passed by value is an over-simplification in a different sense. I need to understand whether changes I make to a parameter I&#39;m passed will have any effect beyond the scope of the value."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1578996343, "post_id": 44367183, "comment_id": 105612094, "body": "There are six categories of value passed by reference; I&#39;ve added functions to the list. (thanks to @human)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579090546, "post_id": 44367183, "comment_id": 105648834, "body": "There are no any categories: everything is passed as a value."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579102509, "post_id": 44367183, "comment_id": 105655527, "body": "Yes and no. See my earlier reply. Just because the formality is pass by value doesn&#39;t mean you can ignore the effect of modifying a reference value."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579131571, "post_id": 44367183, "comment_id": 105667696, "body": "There is no such thing as reference value. They all are just values with no special properties. Which of them do you think needs a special treatment?"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579275279, "post_id": 44367183, "comment_id": 105723232, "body": "Yes there is. What is the side effect of a function that takes an int value then modifies that int? Nothing. What is the side effect of a function that takes a map value then modifies the map? The caller&#39;s map is altered."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579276848, "post_id": 44367183, "comment_id": 105723990, "body": "Example mutation of a map parameter: <a href=\"https://play.golang.org/p/3DGkAdIOC0l\" rel=\"nofollow noreferrer\">play.golang.org/p/3DGkAdIOC0l</a>. The int is not modified outside <code>modifyInt</code> because it is passed by value as-is. The map <i>is</i> modified. Although the map is also passed by value, because it is a reference type (as I call it), its content is altered by <code>modifyMap</code>."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579289851, "post_id": 44367183, "comment_id": 105729749, "body": "You only confuse beginners: if you don&#39;t treat map special - you have less to learn and remember. Map is a structure that holds a pointer to its data storage. As simple as that. No references, no magic \ud83e\udd37 The same story with slices and arrays: see - no need to remember they are special, isn&#39;t it convenient?"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579289974, "post_id": 44367183, "comment_id": 105729806, "body": "&quot;then modifies that int&quot; --- you don&#39;t modify an int, you override a variable value: that&#39;s where you miss a point and bring magic to explain the behaviour. See, maps are not passed by reference: <a href=\"https://play.golang.org/p/oOYHC5S1gOC\" rel=\"nofollow noreferrer\">play.golang.org/p/oOYHC5S1gOC</a> If they were - the value outside would be a <code>foo: bar</code>"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579381796, "post_id": 44367183, "comment_id": 105749851, "body": "This discussion is pointless because we have different terminologies. The map parameter in your example is not a pointer to a map, so obviously it does not change the external value. That was not the point I was making."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579419102, "post_id": 44367183, "comment_id": 105755626, "body": "&quot;so obviously it does not change the external value&quot; --- that&#39;s right, but if it was a reference - it would have been changing. &quot;because we have different terminologies&quot; --- that&#39;s correct, you use a term that is not well defined, that&#39;s why your explanation is confusing (because it makes assumptions nobody else is aware of). You may have a look at <a href=\"https://en.wikipedia.org/wiki/Evaluation_strategy#Call_by_sharing\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Evaluation_strategy#Call_by_sharing</a> if you want to improve your answer. &quot;it does not change the external value&quot; --- that&#39;s correct, you use it in your example though: <a href=\"https://play.golang.org/p/3DGkAdIOC0l\" rel=\"nofollow noreferrer\">play.golang.org/p/3DGkAdIOC0l</a> (line 20)"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579419299, "post_id": 44367183, "comment_id": 105755656, "body": "<a href=\"https://play.golang.org/p/3DGkAdIOC0l\" rel=\"nofollow noreferrer\">play.golang.org/p/3DGkAdIOC0l</a> --- have a look at your example again: you&#39;re appealing between statements 20 and 16. Do you not see those are <i>different</i>? That&#39;s why I provided <a href=\"https://play.golang.org/p/oOYHC5S1gOC\" rel=\"nofollow noreferrer\">play.golang.org/p/oOYHC5S1gOC</a> which you than called &quot;obviously does not change&quot;. My point here: if you want to prove something, your examples should be consistent: as long as <code>v = 7</code> is valid to prove something, so should be <code>m = map[string]string{&quot;foo&quot;: &quot;bar&quot;}</code> too"}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 17, "last_activity_date": 1578996277, "last_edit_date": 1578996277, "creation_date": 1496659410, "answer_id": 44367183, "question_id": 44351159, "link": "https://stackoverflow.com/questions/44351159/using-pointer-to-channel/44367183#44367183", "title": "Using pointer to channel", "body": "<p>In Go, there are six categories of value that are passed by reference rather than by value. These are pointers, slices, maps, channels, interfaces and functions.</p>\n\n<p>Copying a reference value and copying a pointer should be considered equal in terms of what the CPU has to actually do (at least as a good approximation).</p>\n\n<p>So it is almost never useful to use pointers to channels, just like it is rarely useful to use pointers to maps.</p>\n\n<p>Because your channel carries maps, the channel is a reference type and so are the maps, so all the CPU is doing is copying pointers around the heap. In the case of the channel, it also does goroutine synchronisation too.</p>\n\n<p>For further reading, open <a href=\"https://golang.org/doc/effective_go.html\" rel=\"noreferrer\">Effective Go</a> and search the page for the word 'reference'.</p>\n"}, {"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1578996207, "post_id": 59726801, "comment_id": 105612024, "body": "Thanks for the correction - I missed functions as values. I&#39;ll correct the original post."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1579090576, "post_id": 59726801, "comment_id": 105648847, "body": "They all are passed by values."}, {"owner": {"reputation": 1480, "user_id": 5992714, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UVj07.jpg?s=128&g=1", "display_name": "human", "link": "https://stackoverflow.com/users/5992714/human"}, "edited": false, "score": 0, "creation_date": 1579134974, "post_id": 59726801, "comment_id": 105668324, "body": "Absolutely, they are all passed by value. But the value is the address itself. Will update the answer to be clear"}], "tags": [], "owner": {"reputation": 1480, "user_id": 5992714, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UVj07.jpg?s=128&g=1", "display_name": "human", "link": "https://stackoverflow.com/users/5992714/human"}, "is_accepted": false, "score": 4, "last_activity_date": 1616666572, "last_edit_date": 1616666572, "creation_date": 1578969403, "answer_id": 59726801, "question_id": 44351159, "link": "https://stackoverflow.com/questions/44351159/using-pointer-to-channel/59726801#59726801", "title": "Using pointer to channel", "body": "<p>Everything in Golang is passed by value. Even pointers are a type and assigned the value of the memory address. So they are values too.</p>\n<p>(Extending Rick's answer) There are actually <strong>six</strong> types that hold pointer values and a pointer to these (i.e. a pointer to a pointer) types doesn't help anyway:</p>\n<ol>\n<li>pointers</li>\n<li>slices</li>\n<li>maps</li>\n<li>channels</li>\n<li>interfaces</li>\n<li>function</li>\n</ol>\n"}], "owner": {"reputation": 7377, "user_id": 2652524, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/f59a118231057a2afd3d02f2b0be8ce1?s=128&d=identicon&r=PG", "display_name": "Gujarat Santana", "link": "https://stackoverflow.com/users/2652524/gujarat-santana"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9678, "favorite_count": 2, "accepted_answer_id": 44351176, "answer_count": 3, "score": 15, "last_activity_date": 1616666572, "creation_date": 1496555438, "question_id": 44351159, "link": "https://stackoverflow.com/questions/44351159/using-pointer-to-channel", "title": "Using pointer to channel", "body": "<p>Is it good practice to use pointer to channel? For example I read the data concurrently and pass those data <code>map[string]sting</code> using channel  and process this channel inside <code>getSameValues()</code>.</p>\n\n<pre><code>func getSameValues(results *chan map[string]string) []string {\n    var datas = make([]map[string]string, len(*results))\n    i := 0\n    for values := range *results {\n        datas[i] = values\n        i++\n    }\n}\n</code></pre>\n\n<p>The reason I do this is because the <code>chan map[string]string</code> there will be around millions of data inside the map and it will be more than one map. </p>\n\n<p>So I think it would be a good approach if I can pass pointer to the function so that it will not copy the data to save some resource of memory.</p>\n\n<p>I didn't find a good practice in <a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"noreferrer\">effective go</a>. So I'm kinda doubt about my approach here. </p>\n"}, {"tags": ["json", "http", "go", "get", "httprequest"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496533857, "post_id": 44349115, "comment_id": 75701530, "body": "I suggest you to use JSON format (or maybe <a href=\"https://github.com/hjson/hjson-go\" rel=\"nofollow noreferrer\">human JSON</a>). However, the object notation in your question is not a valid JSON. If you can&#39;t change the format, you need to implement your own parser."}, {"owner": {"reputation": 357, "user_id": 2765757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78f2fdbb026f088d3503121ef822e10d?s=128&d=identicon&r=PG&f=1", "display_name": "Storm", "link": "https://stackoverflow.com/users/2765757/storm"}, "reply_to_user": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496534190, "post_id": 44349115, "comment_id": 75701577, "body": "@putu Sorry for the lousy question, I didn&#39;t have a JSON string to copy-paste so I hastily typed it out. It should be valid JSON. So can I just do something like json.Unmarshall(response.FormValue(&quot;mods&quot;))? I&#39;ll test it out."}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 0, "creation_date": 1496535909, "post_id": 44349115, "comment_id": 75701835, "body": "Yes, test it out. If you face any problem, you can update the question, or post another question."}], "answers": [{"tags": [], "owner": {"reputation": 1787, "user_id": 200584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/38ecc20d32bfba3ff6cc8fe620237f09?s=128&d=identicon&r=PG", "display_name": "Nate", "link": "https://stackoverflow.com/users/200584/nate"}, "is_accepted": false, "score": 0, "last_activity_date": 1496542598, "creation_date": 1496542598, "answer_id": 44350197, "question_id": 44349115, "link": "https://stackoverflow.com/questions/44349115/how-to-retrieve-object-from-go-http-request/44350197#44350197", "title": "How to retrieve object from Go http.Request?", "body": "<p>Check out the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">encoding/json</a> package. In Go, you have to marshal and unmarshal your Go structures into and out of their encoding. It isn't quick an easy, but it's an good modern solution for a strictly typed language like Go.</p>\n\n<p>In your case, you'll want to create a struct that matches the structure of the json you are trying to extract, and then unmarshal the json into a variable of the struct type you created.</p>\n"}, {"comments": [{"owner": {"reputation": 1787, "user_id": 200584, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/38ecc20d32bfba3ff6cc8fe620237f09?s=128&d=identicon&r=PG", "display_name": "Nate", "link": "https://stackoverflow.com/users/200584/nate"}, "edited": false, "score": 1, "creation_date": 1496602367, "post_id": 44353086, "comment_id": 75717366, "body": "JSON-to-Go... what I time saver this will be. Upvote!"}], "tags": [], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "is_accepted": true, "score": 2, "last_activity_date": 1496572350, "creation_date": 1496572350, "answer_id": 44353086, "question_id": 44349115, "link": "https://stackoverflow.com/questions/44349115/how-to-retrieve-object-from-go-http-request/44353086#44353086", "title": "How to retrieve object from Go http.Request?", "body": "<p>Let's say you want to fetch a set of <a href=\"https://api.github.com/users?since=135\" rel=\"nofollow noreferrer\">github users</a> and want to print their nicknames (<code>Login</code> field in <code>api.github.com</code>).</p>\n\n<p>Given a User array example:</p>\n\n<pre><code>[{\n  \"login\": \"simonjefford\",\n  \"id\": 136,\n  \"avatar_url\": \"https://avatars1.githubusercontent.com/u/136?v=3\",\n  \"gravatar_id\": \"\",\n  \"url\": \"https://api.github.com/users/simonjefford\",\n  \"html_url\": \"https://github.com/simonjefford\",\n  \"followers_url\": \"https://api.github.com/users/simonjefford/followers\",\n  \"following_url\": \"https://api.github.com/users/simonjefford/following{/other_user}\",\n  \"gists_url\": \"https://api.github.com/users/simonjefford/gists{/gist_id}\",\n  \"starred_url\": \"https://api.github.com/users/simonjefford/starred{/owner}{/repo}\",\n  \"subscriptions_url\": \"https://api.github.com/users/simonjefford/subscriptions\",\n  \"organizations_url\": \"https://api.github.com/users/simonjefford/orgs\",\n  \"repos_url\": \"https://api.github.com/users/simonjefford/repos\",\n  \"events_url\": \"https://api.github.com/users/simonjefford/events{/privacy}\",\n  \"received_events_url\": \"https://api.github.com/users/simonjefford/received_events\",\n  \"type\": \"User\",\n  \"site_admin\": false\n}]\n</code></pre>\n\n<p>You need a proper struct to handle it:</p>\n\n<pre><code>type Users []struct {\n  Login string `json:\"login\"`\n  ID int `json:\"id\"`\n  AvatarURL string `json:\"avatar_url\"`\n  GravatarID string `json:\"gravatar_id\"`\n  URL string `json:\"url\"`\n  HTMLURL string `json:\"html_url\"`\n  FollowersURL string `json:\"followers_url\"`\n  FollowingURL string `json:\"following_url\"`\n  GistsURL string `json:\"gists_url\"`\n  StarredURL string `json:\"starred_url\"`\n  SubscriptionsURL string `json:\"subscriptions_url\"`\n  OrganizationsURL string `json:\"organizations_url\"`\n  ReposURL string `json:\"repos_url\"`\n  EventsURL string `json:\"events_url\"`\n  ReceivedEventsURL string `json:\"received_events_url\"`\n  Type string `json:\"type\"`\n  SiteAdmin bool `json:\"site_admin\"`\n}\n</code></pre>\n\n<p>I suggest you to use <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">json-to-go</a> to have a nice a clean struct given a json.</p>\n\n<p>Then you can do the following:</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"encoding/json\"\n  \"net/http\"\n  \"log\"\n  \"io/ioutil\"\n)\n\nfunc main() {\n\n  response, err := http.Get(\"https://api.github.com/users?since=135\")\n  if err != nil {\n     log.Fatal(err)\n  } else {\n\n    defer response.Body.Close()\n    users := UnmarshalUsers(response)\n    for _, u := range users {\n        //Print each user's Login nickname\n        fmt.Println(u.Login)\n    }\n\n  }\n\n}\n</code></pre>\n\n<p>Where <code>UnmarshalUsers</code> is</p>\n\n<pre><code>func UnmarshalUsers(r *http.Response) Users {\n    body, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n        panic(err)\n    }\n    var users Users\n    err = json.Unmarshal(body, &amp;users)\n    if err != nil {\n        panic(err)\n    }\n\n    return users\n}\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 2765757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/78f2fdbb026f088d3503121ef822e10d?s=128&d=identicon&r=PG&f=1", "display_name": "Storm", "link": "https://stackoverflow.com/users/2765757/storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 169, "favorite_count": 0, "accepted_answer_id": 44353086, "answer_count": 2, "score": -1, "last_activity_date": 1496572350, "creation_date": 1496529179, "question_id": 44349115, "link": "https://stackoverflow.com/questions/44349115/how-to-retrieve-object-from-go-http-request", "title": "How to retrieve object from Go http.Request?", "body": "<p>I have a working app that recieves HTTP GET parameters. They've been Strings and ints until now and it has worked fine getting each field using</p>\n\n<pre><code>http.Request.FormValue(\"field\")\n</code></pre>\n\n<p>But now I've added an array of simple objects in the parameters and I don't know how to transform it to a slice of Go structs.</p>\n\n<p>The array in question is</p>\n\n<pre><code>mods:[{\n    name : x,\n    max : 1,\n    min : 2\n },{\n    name:y,...\n }]\n</code></pre>\n\n<p>So I'm not sure how to proceed to map it to a Go struct. Should I create the struct first and map the result of r.FormValue using JSON?</p>\n"}, {"tags": ["go", "stdout", "stdin"], "answers": [{"comments": [{"owner": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "edited": false, "score": 0, "creation_date": 1496815838, "post_id": 44380000, "comment_id": 75808571, "body": "Hmm ok. Can&#39;t test it at the moment but it looks like that client2 can only output once you send a message. I&#39;ll play with the idea."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "edited": false, "score": 0, "creation_date": 1496855846, "post_id": 44380000, "comment_id": 75836614, "body": "I dont think that terminal/console is not suitable for asynchronous IO operations. Alternative solution is ncurses or termbox.."}, {"owner": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "edited": false, "score": 0, "creation_date": 1496859593, "post_id": 44380000, "comment_id": 75838578, "body": "I&#39;m thinking as in my situation, messages are a lot more likely to be received than sent, I might just have a single terminal program for getting messages then another program for sending them. Thanks for your efforts. I did look at termbox but it feels like a lot of effort for not a huge problem."}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "reply_to_user": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "edited": false, "score": 0, "creation_date": 1496870588, "post_id": 44380000, "comment_id": 75844432, "body": "It should be &quot;I dont think that terminal/console suitable for asynchronous IO operations&quot;. Also you can see updated answer.."}], "tags": [], "owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "is_accepted": false, "score": 0, "last_activity_date": 1496870451, "last_edit_date": 1496870451, "creation_date": 1496712027, "answer_id": 44380000, "question_id": 44348513, "link": "https://stackoverflow.com/questions/44348513/simple-message-client-golang/44380000#44380000", "title": "Simple Message Client golang", "body": "<p>It seems like IO race condition. Your goroutine is not synced with main. Btw ScanLines do the same for you. Consider this:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    scanner := bufio.NewScanner(os.Stdin)\n    msgQ := make(chan string)\n\n    defer close(msgQ)\n\n    go func() {\n        for {\n            // Prompt the user for a message\n            fmt.Print(\"client1: \")\n            msg, ok := &lt;-msgQ\n            if !ok {\n                return\n            }\n            fmt.Println(\"\\rclient1 said: \" + msg)\n            // Write the message over the current line\n            fmt.Println(\"client2: Hello\")\n        }\n    }()\n\n\n    // Scan os.Stdin, splitting on bytes\n    for scanner.Scan() {\n        msgQ &lt;- scanner.Text()\n    }\n\n}\n</code></pre>\n\n<p><strong>EDIT:</strong> According to comments, this code shows what is wrong with that idea. When you write something and dont hit ENTER, client2 overwrites current line.. You can save(CTRL-U) and restore(CTRL-Y) current line but I did not find either ANSI signature or Signal to call it programatically.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n\n    scanner := bufio.NewScanner(os.Stdin)\n    sendQ := make(chan struct{})\n\n    defer close(sendQ)\n\n    //simulate local client1 console\n    go func() {\n        for {\n            fmt.Print(\"client1: \")\n            select {\n            case _, ok := &lt;-sendQ:\n                if !ok {\n                    return\n                }\n            case &lt;-time.After(5 * time.Second):\n                fmt.Printf(\"\\r\\033[K\") // delete current line from right\n                fmt.Println(\"client2: Hello\")\n            }\n        }\n    }()\n\n    for scanner.Scan() {\n        sendQ &lt;- struct{}{}\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 153, "user_id": 7486702, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9354e445bc2151d3eeac15cb5eb7d11?s=128&d=identicon&r=PG&f=1", "display_name": "Conrad Ludgate", "link": "https://stackoverflow.com/users/7486702/conrad-ludgate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 696, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1496870451, "creation_date": 1496523600, "question_id": 44348513, "link": "https://stackoverflow.com/questions/44348513/simple-message-client-golang", "title": "Simple Message Client golang", "body": "<p>So I've started a project which involves modules sending and receiving messages from a server via websockets. However I wanted a simple way for me to interact and send messages to the modules.</p>\n\n<p>So I have the program ask for my message in a goroutine, when I hit enter, it sends the message and prompts me for another. In the main goroutine it will wait until it receives a message and when it does, write over the current line and replace what was on the line before on a new line.</p>\n\n<p>There is only one problem, however. It don't know how to keep my input to place on the new line. In my testing with the following example, it seems that os.Stdin.Read halts until it receives a new-line character.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    // Input Buffer\n    var msg string\n\n    scanner := bufio.NewScanner(os.Stdin)\n    scanner.Split(bufio.ScanBytes)\n\n    go func() {\n        for {\n            // Prompt the user for a message\n            fmt.Print(\"client1: \")\n\n            // Scan os.Stdin, splitting on bytes\n            for scanner.Scan() {\n                if scanner.Text() == \"\\n\" {\n                    break\n                } else {\n                    // If the character is not \\n, add to the input buffer\n                    msg += scanner.Text()\n                }\n            }\n\n            // Do something with the input buffer then clear it\n            fmt.Println(msg)\n            msg = \"\"\n        }\n    }()\n\n    for {\n        select {\n        // Receive a message from a client\n        case &lt;-time.After(5 * time.Second):\n            // Write the message over the current line\n            fmt.Println(\"\\rclient2: Hello\")\n\n            // Prompt the user again for their message\n            // proving the current input buffer\n            fmt.Print(\"client1: \" + msg)\n        }\n    }\n}\n</code></pre>\n\n<p>An example output:</p>\n\n<pre><code>client1: Hello!\nHello!\nclient2: Hello\nclient1: Bye!\nBye!\nclient2: Hello\nclient2: Hello // Was \"client1: Good \" before being overwritten\nclient1: Bye!\nGood Bye!\n</code></pre>\n\n<p>Any ideas are greatly appreciated. Thank you in advanced.</p>\n"}, {"tags": ["go", "go-gin"], "answers": [{"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496538772, "post_id": 44349462, "comment_id": 75702184, "body": "I think it worth mentioning that one also need to check if the resulted normalized path is within the expected directory, otherwise one might request <code>&#47;book&#47;cover&#47;..&#47;..&#47;..&#47;..&#47;..&#47;..&#47;..&#47;etc&#47;passwd</code>"}, {"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1496547323, "post_id": 44349462, "comment_id": 75703363, "body": "@zerkms Thank you, you&#39;re correct. I&#39;ve updated the answer."}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 2, "last_activity_date": 1496547243, "last_edit_date": 1496547243, "creation_date": 1496532814, "answer_id": 44349462, "question_id": 44347100, "link": "https://stackoverflow.com/questions/44347100/golang-alternative-for-python-flask-send-from-directory/44349462#44349462", "title": "Golang alternative for python/flask send_from_directory()", "body": "<p>Use gin's <a href=\"https://godoc.org/github.com/gin-gonic/gin#Context.File\" rel=\"nofollow noreferrer\"><code>Context.File</code></a> to serve file content. This method internally calls <a href=\"https://golang.org/pkg/net/http/#ServeFile\" rel=\"nofollow noreferrer\">http.ServeFile</a> builtin function. The code snippets will be:</p>\n\n<pre><code>import \"path/filepath\"\n\n\n// ...\nrouter := gin.Default()\n// ... \n\nrouter.GET(\"/book/cover/:filename\", func(c *gin.Context) {\n    rootDir := \"/uploads/img/\"\n    name := c.Param(\"filename\")\n    filePath, err :=  filepath.Abs(rootDir + name)\n    if err != nil {\n        c.AbortWithStatus(404)\n    }\n\n    //Only allow access to file/directory under rootDir\n    //The following code is for ilustration since HasPrefix is deprecated.\n    //Replace with correct one when https://github.com/golang/dep/issues/296 fixed\n    if !filepath.HasPrefix(filePath, rootDir) {\n        c.AbortWithStatus(404)\n    }\n\n    c.File(filePath)\n})\n</code></pre>\n\n<p><strong>Update</strong></p>\n\n<p>As pointed by zerkms, the path name <strong>must be sanitized</strong> before passing it <code>Context.File</code>. Simple sanitizer is added in the snippet. Please adapt to your needs. </p>\n"}], "owner": {"reputation": 2054, "user_id": 615120, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/xoAHa.jpg?s=128&g=1", "display_name": "rnk", "link": "https://stackoverflow.com/users/615120/rnk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 683, "favorite_count": 1, "accepted_answer_id": 44349462, "answer_count": 1, "score": 1, "last_activity_date": 1496547243, "creation_date": 1496513356, "last_edit_date": 1496514009, "question_id": 44347100, "link": "https://stackoverflow.com/questions/44347100/golang-alternative-for-python-flask-send-from-directory", "title": "Golang alternative for python/flask send_from_directory()", "body": "<p>I have this image urls:</p>\n\n<pre><code>/book/cover/Computer_Science.png\n</code></pre>\n\n<p>but the location of the image actually exists under</p>\n\n<pre><code>/uploads/img/Computer_Science.png\n</code></pre>\n\n<p>I'm using <strong>Gin framework</strong>. Is there any command like Flask's <code>send_from_directory()</code> in Gin or in in-built Golang functions?</p>\n\n<p>If not could you share a snippet of how to do it?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "scanf", "gofmt"], "answers": [{"tags": [], "owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "is_accepted": false, "score": 1, "last_activity_date": 1496514201, "creation_date": 1496514201, "answer_id": 44347210, "question_id": 44347093, "link": "https://stackoverflow.com/questions/44347093/go-equivalent-of-cs-negated-scansets/44347210#44347210", "title": "Go equivalent of C&#39;s negated scansets", "body": "<p>You could always go for regular expressions;</p>\n\n<pre><code>re := regexp.MustCompile(`(\\w+), (\\w+)`)\ninput := \"aaaa, bbbb\"\nfmt.Printf(\"%#v\\n\", re.FindStringSubmatch(input))\n// Prints []string{\"aaaa, bbbb\", \"aaaa\", \"bbbb\"}\n</code></pre>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "is_accepted": true, "score": 2, "last_activity_date": 1496548927, "creation_date": 1496548927, "answer_id": 44350662, "question_id": 44347093, "link": "https://stackoverflow.com/questions/44347093/go-equivalent-of-cs-negated-scansets/44350662#44350662", "title": "Go equivalent of C&#39;s negated scansets", "body": "<p>Go doesn't support this directly like C, partially because you should be reading a line and using something like <code>strings.FieldsFunc</code>. But that's naturally a very simplistic view. For data formatted in a homogeneous manner, you could use <code>bufio.Scanner</code> to essentially do the same thing with any <code>io.Reader</code>. However, if you had to deal with something like this format:</p>\n\n<pre><code>// Name; email@domain\n//\n// Anything other than ';' is valid for name.\n// Anything before '@' is valid for email.\n// For domain, only A-Z, a-z, and 0-9, as well as '-' and '.' are valid.\nsscanf(\"%[^;]; %[^@]@%[-.\" ALNUM \"]\", name, email, domain);\n</code></pre>\n\n<p>then you'd run into trouble because you're now dealing with a particular state. In such a case, you might prefer working with <code>bufio.Reader</code> to manually parse things. There's also the option of implementing <code>fmt.Scanner</code>. Here's some sample code to give you an idea of how easy it can be to implement <code>fmt.Scanner</code>:</p>\n\n<pre><code>// Scanset acts as a filter when scanning strings.\n// The zero value of a Scanset will discard all non-whitespace characters.\ntype Scanset struct {\n    ps        *string\n    delimFunc func(rune) bool\n}\n\n// Create a new Scanset to filter delimiter characters.\n// Once f(delimChar) returns false, scanning will end.\n// If s is nil, characters for which f(delimChar) returns true are discarded.\n// If f is nil, !unicode.IsSpace(delimChar) is used\n// (i.e. read until unicode.IsSpace(delimChar) returns true).\nfunc NewScanset(s *string, f func(r rune) bool) *Scanset {\n    return &amp;Scanset{\n        ps:        s,\n        delimFunc: f,\n    }\n}\n\n// Scan implements the fmt.Scanner interface for the Scanset type.\nfunc (s *Scanset) Scan(state fmt.ScanState, verb rune) error {\n    if verb != 'v' &amp;&amp; verb != 's' {\n        return errors.New(\"scansets only work with %v and %s verbs\")\n    }\n    tok, err := state.Token(false, s.delimFunc)\n    if err != nil {\n        return err\n    }\n    if s.ps != nil {\n        *s.ps = string(tok)\n    }\n    return nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Y2vLSOk7ob\" rel=\"nofollow noreferrer\">Playground example</a></p>\n\n<p>It's not C's scansets, but it's close enough. As mentioned, you should be validating your data anyway, even with formatted input, because formatting lacks context (and adding it while dealing with formatting violates the KISS principle and worsens the readability of your code).</p>\n\n<p>For example, a short regex like <code>[A-Za-z]([A-Za-z0-9-]?.)[A-Za-z0-9]</code> isn't enough to validate a domain name, and a simplistic scanset would simply be the equivalent of <code>[A-Za-z0-9.-]</code>. The scanset, however, would be enough to scan the string from a file or whatever other reader you might be using, but it wouldn't be enough to validate the string alone. For that, a regex or even a proper library would be a much better option.</p>\n"}], "owner": {"reputation": 2978, "user_id": 4141980, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/mEvKF.jpg?s=128&g=1", "display_name": "Jo&#227;o Almeida", "link": "https://stackoverflow.com/users/4141980/jo%c3%a3o-almeida"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 143, "favorite_count": 0, "accepted_answer_id": 44350662, "answer_count": 2, "score": 1, "last_activity_date": 1496548927, "creation_date": 1496513326, "last_edit_date": 1496514324, "question_id": 44347093, "link": "https://stackoverflow.com/questions/44347093/go-equivalent-of-cs-negated-scansets", "title": "Go equivalent of C&#39;s negated scansets", "body": "<p>What is the way to mimick the negated scansets that exist in C?</p>\n\n<p>For an example input string: <code>aaaa, bbbb</code> </p>\n\n<p>In go using:</p>\n\n<pre><code>fmt.Sscanf(input, \"%s, %s\", &amp;str1, &amp;str2)\n</code></pre>\n\n<p>The result is only <code>str1</code> being set as: <code>aaaa,</code></p>\n\n<p>In C one could use a format string as <code>\"%[^,], %s\"</code> to avoid this problem, is there a way to accomplish this in go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1496509910, "post_id": 44346572, "comment_id": 75695754, "body": "What do you mean &quot;it didn&#39;t work&quot;?"}, {"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1496510180, "post_id": 44346572, "comment_id": 75695841, "body": "You can refer to interfaces from other packages just like anything else (<code>interfaces.Shaper</code> in your case). I don&#39;t see any real problem in this question as such; you should clarify what problem you have (preferably through a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">minimal reproducible example</a>)."}, {"owner": {"reputation": 243, "user_id": 2238922, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6ea1d9a41bdae736adbf70623a7a7c7b?s=128&d=identicon&r=PG", "display_name": "Sanketh", "link": "https://stackoverflow.com/users/2238922/sanketh"}, "edited": false, "score": 1, "creation_date": 1496511360, "post_id": 44346572, "comment_id": 75696221, "body": "I have explained a bit more about the issue i face. I think that this is a minimal complete and verifiable example. could you please explain with code about referring or implementing the interface with example in this context? Thanks in advance."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496511828, "post_id": 44346572, "comment_id": 75696379, "body": "You don&#39;t need to import an interface to implement it. In Go a type matches any interface that specifies a subset of the methods defined for the type."}, {"owner": {"reputation": 243, "user_id": 2238922, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6ea1d9a41bdae736adbf70623a7a7c7b?s=128&d=identicon&r=PG", "display_name": "Sanketh", "link": "https://stackoverflow.com/users/2238922/sanketh"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1496512482, "post_id": 44346572, "comment_id": 75696573, "body": "@md2perpe I understand that go implements interfaces implicitly, does this mean rectangle.go automatically implements shaper.go even though it is in a different package?"}, {"owner": {"reputation": 445, "user_id": 8018505, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b91738cee0a49bbbf95faf11cf9bc5a?s=128&d=identicon&r=PG&f=1", "display_name": "Paul Coleman", "link": "https://stackoverflow.com/users/8018505/paul-coleman"}, "edited": false, "score": 1, "creation_date": 1496512635, "post_id": 44346572, "comment_id": 75696611, "body": "You do not need to import the interface. Where you implement an interface is not important - only where it is used. There is more information on interfaces <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">here</a>  and <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1496514165, "post_id": 44346572, "comment_id": 75697045, "body": "@Sanketh Yes, the interface neither has to be in the same package nor be imported for a type to implement it."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1496563316, "post_id": 44346572, "comment_id": 75705985, "body": "Related, introduction to interfaces: <a href=\"https://stackoverflow.com/questions/39092925/why-are-interfaces-needed-in-golang/39100038#39100038\">Why are interfaces needed in Golang?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4252, "user_id": 1119779, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4cbc4488855b0421943b57de0a9018c2?s=128&d=identicon&r=PG", "display_name": "imagineerThat", "link": "https://stackoverflow.com/users/1119779/imagineerthat"}, "edited": false, "score": 1, "creation_date": 1522382772, "post_id": 44347823, "comment_id": 86144675, "body": "I often see this suggestion not being followed. For instance, in net/http, handler interface requires ServeHTTP, and is implemented by ServeMux and HandlerFunc. <a href=\"https://golang.org/pkg/net/http/#ServeMux.ServeHTTP\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#ServeMux.ServeHTTP</a>"}, {"owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "edited": false, "score": 1, "creation_date": 1522483288, "post_id": 44347823, "comment_id": 86179075, "body": "Its true that the ServerMux implements the http.Handler interface but at the same time this type <i>uses</i> the interface to let the caller inject the handler interface she wants (e.g. via the ServeMux.Handle(\u2026) function."}, {"owner": {"reputation": 11490, "user_id": 3317808, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6c8272382fcd9841919bc1f8709d25a0?s=128&d=identicon&r=PG&f=1", "display_name": "overexchange", "link": "https://stackoverflow.com/users/3317808/overexchange"}, "edited": false, "score": 0, "creation_date": 1553795110, "post_id": 44347823, "comment_id": 97528300, "body": "Do you also recommend reading <a href=\"https://dave.cheney.net/2016/08/20/solid-go-design\" rel=\"nofollow noreferrer\">dave.cheney.net/2016/08/20/solid-go-design</a>?"}], "tags": [], "owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "is_accepted": false, "score": 15, "last_activity_date": 1496518296, "creation_date": 1496518296, "answer_id": 44347823, "question_id": 44346572, "link": "https://stackoverflow.com/questions/44346572/how-to-implement-interface-from-a-different-package-in-golang/44347823#44347823", "title": "How to implement interface from a different package in golang?", "body": "<p>There is an excellent <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#interfaces\" rel=\"noreferrer\">section in the go wiki</a> about interfaces:</p>\n\n<blockquote>\n  <p>Go interfaces generally belong in the package that uses values of the interface type, not the package that implements those values. The implementing package should return concrete (usually pointer or struct) types: that way, new methods can be added to implementations without requiring extensive refactoring.</p>\n</blockquote>\n\n<p>This also has the advantage that it reduces coupling between packages (by not forcing anybody to import your package just for the interface) and it generally leads to smaller interfaces (by allowing people to consume only a subset of the interface that you would have built).</p>\n\n<p>If you are new to go I highly recommend reading the \"Go Code Review Comments\" wiki article I linked and if you have some more time also <a href=\"https://golang.org/doc/effective_go.html\" rel=\"noreferrer\">Effective Go</a>. Happy hacking!</p>\n"}, {"tags": [], "owner": {"reputation": 62, "user_id": 8023512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e66cae00dc87683472083bdece62886b?s=128&d=identicon&r=PG&f=1", "display_name": "Lan Quach", "link": "https://stackoverflow.com/users/8023512/lan-quach"}, "is_accepted": false, "score": 0, "last_activity_date": 1496527560, "creation_date": 1496527560, "answer_id": 44348953, "question_id": 44346572, "link": "https://stackoverflow.com/questions/44346572/how-to-implement-interface-from-a-different-package-in-golang/44348953#44348953", "title": "How to implement interface from a different package in golang?", "body": "<p>Let's say you have a function that uses a <code>Shaper</code>. You can test the function with a <code>rectangle</code>, and by doing so ensuring the implementation:</p>\n\n<pre><code>func DoStuff(s Shaper) {\n    s.Area()\n}\n\nfunc TestDoStuff(t *testing.T) {\n    var s Shaper = rectangle{length: 5, width: 3}\n    DoStuff(s)\n    // assertion\n}\n</code></pre>\n\n<p>If <code>rectangle</code> does not implement <code>Shaper</code>, you'll get an error like this:</p>\n\n<pre><code>cannot use rectangle literal (type rectangle) as type Shaper in assignment:\nrectangle does not implement Shaper (missing Area method)\n</code></pre>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#interfaces\" rel=\"nofollow noreferrer\">Effective Go</a>:</p>\n\n<p><code>Interfaces in Go provide a way to specify the behavior of an object: if something can do this, then it can be used here.</code></p>\n"}], "owner": {"reputation": 243, "user_id": 2238922, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/6ea1d9a41bdae736adbf70623a7a7c7b?s=128&d=identicon&r=PG", "display_name": "Sanketh", "link": "https://stackoverflow.com/users/2238922/sanketh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20472, "favorite_count": 3, "answer_count": 2, "score": 16, "last_activity_date": 1496527560, "creation_date": 1496509835, "last_edit_date": 1496512434, "question_id": 44346572, "link": "https://stackoverflow.com/questions/44346572/how-to-implement-interface-from-a-different-package-in-golang", "title": "How to implement interface from a different package in golang?", "body": "<p>I am beginner in golang and was trying interfaces. I want to keep interfaces in a separate packages so that I can use it to implement this in various other packages, also provide it to other teams (.a file) so that they can implement custom plugins. Please see example below on what I would like to achieve.</p>\n\n<pre><code>--- Folder structure ---\ngitlab.com/myproject/\n                  interfaces/\n                            shaper.go\n                  shapes/\n                        rectangle.go\n                        circle.go\n\n---- shaper.go ---\npackage interfaces\n\ntype Shaper interface{\n\n    Area() int\n\n}\n</code></pre>\n\n<p>How do I ensure that the rectangle.go implements shaper interface?\nI understand that go implements interfaces implicitly, does this mean rectangle.go automatically implements shaper.go even though it is in a different package?</p>\n\n<p>I tried it like below, but when I run gofmt tool, it removes the import because it is unused.</p>\n\n<pre><code>--- rectangle.go ---\npackage shapes\n\nimport \"gitlab.com/myproject/interfaces\"\n\ntype rectangle struct{\n\n  length int\n  width int\n}\n\nfunc (r rectangle) Area() int {\n return r.length * r.width\n}\n</code></pre>\n\n<p>Thanks in advance.</p>\n"}, {"tags": ["go", "conventions"], "comments": [{"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1496512220, "post_id": 44346123, "comment_id": 75696496, "body": "Perhaps you want to create two types <code>BacktrackSolver</code> and <code>PermuteSolver</code> that both have the method <code>Solve()</code>. That would help against the name clash."}], "answers": [{"tags": [], "owner": {"reputation": 2065, "user_id": 645974, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dBQ9J.png?s=128&g=1", "display_name": "Friedrich Gro&#223;e", "link": "https://stackoverflow.com/users/645974/friedrich-gro%c3%9fe"}, "is_accepted": true, "score": 1, "last_activity_date": 1496520219, "creation_date": 1496520219, "answer_id": 44348099, "question_id": 44346123, "link": "https://stackoverflow.com/questions/44346123/what-is-the-convention-for-organising-interfaces-and-their-implementations-in-a/44348099#44348099", "title": "What is the convention for organising interfaces and their implementations in a Go project?", "body": "<p>You would generally define different types that implement your <code>Solver</code> interface and then define the <code>Solve</code> function on those types.</p>\n\n<pre><code>func (s *BackTrackSolver) Solve() { \u2026 }\nfunc (s *PermutateSolver) Solve() { \u2026 }\n</code></pre>\n\n<p>Because the types have distinct names there is no name clash. \nYou can try it out online in <a href=\"https://play.golang.org/p/39Mgo9rkSh\" rel=\"nofollow noreferrer\">the go playground</a>.</p>\n\n<p>About your package convention question: I think a good approach is to start with all code in a single package and only export the types and functions you actually want to expose to your callers. Then later when you your <a href=\"https://en.wikipedia.org/wiki/Cohesion_(computer_science)\" rel=\"nofollow noreferrer\">code cohesion</a> drops you should start splitting out code into multiple packages.</p>\n\n<p>Also have a look at the \"Organizing Go code\" article from the <a href=\"https://blog.golang.org/organizing-go-code\" rel=\"nofollow noreferrer\">go blog</a>, subsection \"What to put into a package\" (short read).</p>\n"}], "owner": {"reputation": 2001, "user_id": 1533273, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/aPqEY.jpg?s=128&g=1", "display_name": "clD", "link": "https://stackoverflow.com/users/1533273/cld"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 44348099, "answer_count": 1, "score": 2, "last_activity_date": 1521349418, "creation_date": 1496507207, "last_edit_date": 1521349418, "question_id": 44346123, "link": "https://stackoverflow.com/questions/44346123/what-is-the-convention-for-organising-interfaces-and-their-implementations-in-a", "title": "What is the convention for organising interfaces and their implementations in a Go project?", "body": "<p>What is the convention for organising interfaces and their implementations in a Go project?</p>\n\n<p>I am new to Go and creating a small project, I currently have this folder structure:</p>\n\n<pre><code>src/\n    my-repo/\n        solve/\n            backtracksolve.go\n            permutatesolve.go\n            ...\n            solver.go\n\n... (some repositories and packages omitted for brevity) ...\n</code></pre>\n\n<p><code>backtracksolve</code> and <code>permutatesolve</code> both implement the interface <code>solver</code> so it make sense to keep them in the same package as the interface and other implementations of that interface, coming from Java/C# this is a common convention for example, <code>java.util</code> contains interfaces such as <code>Set</code>, <code>Map</code>, <code>List</code>, while also having implementations such as <code>HashSet</code>, <code>HashMap</code> and <code>ArrayList</code>.</p>\n\n<p>However in Go because they both implement a <code>func Solve()</code> and both in the <code>package solve</code> there is <code>redeclared exception</code>.</p>\n\n<p>Is it the convention to create a sub directory for each implementation (below) or something completely different?</p>\n\n<pre><code>src/\n    my-repo/\n        solve/\n            backtrack/\n                backtracksolve.go\n            permutation/\n                permutatesolve.go\n\n            solver.go\n</code></pre>\n"}, {"tags": ["json", "csv", "web", "go", "streaming"], "comments": [{"owner": {"reputation": 3837, "user_id": 1227008, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/KFxYT.jpg?s=128&g=1", "display_name": "Yandry Pozo", "link": "https://stackoverflow.com/users/1227008/yandry-pozo"}, "edited": false, "score": 0, "creation_date": 1496520109, "post_id": 44346048, "comment_id": 75698572, "body": "if you need a global counter I recommend you this <a href=\"https://golang.org/pkg/expvar/#Int\" rel=\"nofollow noreferrer\">golang.org/pkg/expvar/#Int</a>"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5404829"}, "edited": false, "score": 0, "creation_date": 1496553726, "post_id": 44346501, "comment_id": 75704229, "body": "Thanks abhink, I liked your good Solution :) This Almost Solved my problem. Actually I was trying to make simulation of sensors (continuously generating data every 2 seconds) using a golang server and csv data"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 0, "last_activity_date": 1496509496, "creation_date": 1496509496, "answer_id": 44346501, "question_id": 44346048, "link": "https://stackoverflow.com/questions/44346048/csv-to-json-using-golang-some-data-is-skipped-while-printing-in-web-browser/44346501#44346501", "title": "CSV to JSON using Golang - some data is skipped while printing in Web Browser", "body": "<p>There's a race condition in your handler on accesses made to <code>i</code>. Multiple goroutines will execute the <code>i = i + 1</code> statement resulting in several possible values for <code>i</code>. Use of a mutex should fix the issue:</p>\n\n<pre><code>// ...\n\nvar i int = 0\nvar m sync.Mutex\n\n// ...\n\nfunc StreamDataHandler(res http.ResponseWriter, req *http.Request, p      httprouter.Params) {\n    // ...\n\n    m.Lock()\n    defer m.Unlock()\n    i = i + 1\n\n    // ...\n}\n</code></pre>\n\n<p>However, if you want to continuously fetch the values using http Get, a better solution would be to include last index fetched in the response and add this value (after incrementing it, for example) as a request parameter in the next request to indicate the next required index. This way you don't need to maintain <code>i</code> in your handler. </p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5404829"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1042, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1553490735, "creation_date": 1496506779, "question_id": 44346048, "link": "https://stackoverflow.com/questions/44346048/csv-to-json-using-golang-some-data-is-skipped-while-printing-in-web-browser", "title": "CSV to JSON using Golang - some data is skipped while printing in Web Browser", "body": "<p>I have read one excel csv file using Golang and wanted to print them to web browser as JSON Data for every GET request you make,But every time I print the JSON Data in Web browser some data gets skipped. I have double checked those data are in csv file but not getting printed in web browser. Any help you can suggest me ? Thanks in advance</p>\n\n<pre><code>package main\n\nimport (\n\"encoding/csv\"\n\"encoding/json\"\n\"fmt\"\n\"github.com/julienschmidt/httprouter\"\n\"net/http\"\n\"os\"\n)\n\nvar csvData [][]string\nvar Record IRIS\nvar i int = 0\n\nfunc init() {\n    csvFile, err := os.Open(\"IRIS.csv\")\n    if err != nil {\n       fmt.Println(err)\n     }\n\n    reader := csv.NewReader(csvFile)\n    reader.FieldsPerRecord = -1\n    csvData, _ = reader.ReadAll()\n\n    if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n    }\n        defer csvFile.Close()\n}\n type IRIS struct {\n    ID          string\n    SepalLength string\n    SepalWidth  string\n    PetalLength string\n    PetalWidth  string\n    Species     string\n }\n\nfunc main() {\n    router := httprouter.New()\n    router.GET(\"/stream/content/data\", StreamDataHandler)\n    fmt.Println(http.ListenAndServe(\"127.0.0.1:9090\", router))\n}\nfunc StreamDataHandler(res http.ResponseWriter, req *http.Request, p      httprouter.Params) {\n    res.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n\n    // read data from CSV file\n    Record.ID = csvData[i][0]\n    Record.SepalLength = csvData[i][1]\n    Record.SepalWidth = csvData[i][2]\n    Record.PetalLength = csvData[i][3]\n    Record.PetalWidth = csvData[i][4]\n    Record.Species = csvData[i][5]\n\n    jsondata, err := json.Marshal(Record) // convert to JSON\n\n    if err != nil {\n            fmt.Println(err)\n            os.Exit(1)\n    }\n\n    i = i + 1\n\n    fmt.Fprintf(res, string(jsondata))\n    return\n}\n</code></pre>\n\n<p>OUTPUT:</p>\n\n<p>{\"ID\":\"2\",\"SepalLength\":\"4.9\",\"SepalWidth\":\"3\",\"PetalLength\":\"1.4\",\"PetalWidth\":\"0.2\",\"Species\":\"setosa\"}</p>\n\n<p>{\"ID\":\"6\",\"SepalLength\":\"5.4\",\"SepalWidth\":\"3.9\",\"PetalLength\":\"1.7\",\"PetalWidth\":\"0.4\",\"Species\":\"setosa\"}</p>\n\n<p>{\"ID\":\"7\",\"SepalLength\":\"5.7\",\"SepalWidth\":\"4.4\",\"PetalLength\":\"1.5\",\"PetalWidth\":\"0.4\",\"Species\":\"setosa\"}</p>\n\n<p>.\n.\n.</p>\n\n<p><strong>Why this is happening ?</strong> </p>\n\n<p><strong>I actually wanted to print all the values (without skipping any) like streaming of data every 2 second from Excel CSV file</strong> </p>\n"}, {"tags": ["json", "http", "go", "rounding"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 3, "creation_date": 1496488951, "post_id": 44343308, "comment_id": 75689640, "body": "&quot;how to easily read and average the values of an array of JSONs&quot; &quot;I also want to round my result to 1 decimal point,&quot; --- these are <i>3 independent</i> tasks. Which one you have issues with?"}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496489349, "post_id": 44343308, "comment_id": 75689727, "body": "All 3. My code above does those 3 tasks, but it took over 30 lines. How do I simplify this? I&#39;m a Ruby developer who could have probably done all this in 3 lines of code. This was painful."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496491227, "post_id": 44343308, "comment_id": 75690262, "body": "Go is not as concise as some other languages, get used to it."}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496493536, "post_id": 44343308, "comment_id": 75690921, "body": "Your comment doesn&#39;t help. Can you simplify my code? I&#39;m sure my way is longer and clumsier than it should be."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1496493645, "post_id": 44343308, "comment_id": 75690957, "body": "I&#39;m sure you cannot make it shorter without losing readability. Go chooses verbosity over expressiveness."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1496495846, "post_id": 44343308, "comment_id": 75691620, "body": "Ask one question at a time."}], "answers": [{"comments": [{"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496500719, "post_id": 44345011, "comment_id": 75692920, "body": "Oh my God, you are the best! Thank you thank you thank you, sir!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1496509900, "post_id": 44345011, "comment_id": 75695752, "body": "@peterSO You&#39;re right, forgot about it. Fixed. Thanks."}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496512880, "post_id": 44345011, "comment_id": 75696681, "body": "Unfortunately, your <code>Round()</code> function has a problem. When I try \tstarttime = &quot;201706031105&quot; and endtime = &quot;201706031200&quot;, I get Average Price = 2.9000000000000004, not 2.9.  When I do starttime = &quot;201706021300&quot; and endtime = &quot;201706031400&quot;, I get Average Price = 3.9000000000000004, not 3.9."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 1, "creation_date": 1496513755, "post_id": 44345011, "comment_id": 75696937, "body": "@RaymondGan The <code>Round()</code> function has no problems, this is because the decimal numbers <code>2.9</code> and <code>3.9</code> cannot be represented exactly in binary system with finite number of bits (<code>float64</code> has &quot;only&quot; 64 bits). This exact issue is mentioned and described in the linked answer: <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a>. Please read through the complete answer. Solution is simple: print the result like <code>fmt.Printf(&quot;%.1f\\n&quot;, someFloatValue)</code>."}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496513932, "post_id": 44345011, "comment_id": 75696987, "body": "What if I want to save it in the database as 2.9 and 3.9, float64 type? Yes, Printf can easily show a certain number of decimals, but I want the actual saved numbers to be the right format."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 1, "creation_date": 1496514628, "post_id": 44345011, "comment_id": 75697174, "body": "@RaymondGan The IEEE-754 standard is not capable of storing certain decimal numbers precisely. There&#39;s nothing you can do about it. If you want to store exact numbers, multiply them by 10 (as you rounded to 1 decimal digit) and store it as an <code>int</code>, or store the decimal number as a <code>string</code>."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496514776, "post_id": 44345011, "comment_id": 75697215, "body": "@RaymondGan That answer you linked and claim it&#39;s too much work: that answer shows like 4 or 5 different ways how to do it. Obviously you only need to pick 1 (out of that 5), which will be a &quot;tiny&quot; (acceptable) amount of work."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1496514826, "post_id": 44345011, "comment_id": 75697232, "body": "@icza: You give a &quot;rounding function for positive numbers&quot;. What about negative prices? &quot;Negative Prices: With real-time hourly market prices, it is possible for the price of electricity to be negative for short periods of time.&quot; <a href=\"https://hourlypricing.comed.com/live-prices/\" rel=\"nofollow noreferrer\">hourlypricing.comed.com/live-prices</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1496514892, "post_id": 44345011, "comment_id": 75697259, "body": "@peterSO The version that handles both positive and negative numbers is in my linked answer: <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a>. Maybe I should include that version. Doing it now."}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496514933, "post_id": 44345011, "comment_id": 75697272, "body": "Ah, I see! Thank you for your answer: <a href=\"https://stackoverflow.com/questions/41159492/format-float-in-golang-html-template\" title=\"format float in golang html template\">stackoverflow.com/questions/41159492/&hellip;</a>  I did <code>{{printf &quot;%.1f&quot; $record.Avgprice}}</code> on <a href=\"https://github.com/rayning0/griddy/blob/master/views/prices.tpl\" rel=\"nofollow noreferrer\">github.com/rayning0/griddy/blob/master/views/prices.tpl</a> and it correctly changed all my answers on the page to 1 decimal point."}, {"owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "edited": false, "score": 0, "creation_date": 1496518102, "post_id": 44345011, "comment_id": 75698124, "body": "Thank you @icza, for your excellent answers!  This applies to my question: <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Decoder.Decode</a>  See my revised solution, with detailed comments: <a href=\"https://github.com/rayning0/griddy/blob/master/controllers/default.go\" rel=\"nofollow noreferrer\">github.com/rayning0/griddy/blob/master/controllers/default.g&zwnj;&#8203;o</a>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1496514954, "last_edit_date": 1496514954, "creation_date": 1496500445, "answer_id": 44345011, "question_id": 44343308, "link": "https://stackoverflow.com/questions/44343308/how-to-average-values-of-an-array-of-jsons-then-round-to-1-decimal-point/44345011#44345011", "title": "How to average values of an array of JSONs, then round to 1 decimal point", "body": "<p>Your code can be simplified in several points, and while you said \"rounding\" you did \"truncating\" in the end which is not the same.</p>\n\n<p>One important thing: if an error is encountered, you should return early and not continue, as that will only be the source of additional errors or even runtime panics. See at the end.</p>\n\n<h3>Unmarshaling JSON</h3>\n\n<p>Easier would be to use <a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\"><code>json.Decoder</code></a>, decoding right from the response body (which implements <code>io.Reader</code>).</p>\n\n<p>Also note to simplify parsing floats given as <code>string</code> values in JSON, a better option would be to use <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\"><code>json.Number</code></a>.</p>\n\n<p>Parsing can be as simple as this:</p>\n\n<pre><code>var prices []map[string]json.Number\nif err := json.NewDecoder(response.Body).Decode(&amp;prices); err != nil {\n    fmt.Println(err)\n    return\n}\n</code></pre>\n\n<h3>Calculating sum</h3>\n\n<p>Calculating sum can also be simplified: there is no need to keep track of <code>size</code>, as that is simply the length of the map:</p>\n\n<pre><code>sum := 0.0\nfor _, p := range prices {\n    f, _ := p[\"price\"].Float64()\n    sum += f\n}\n</code></pre>\n\n<p>Note that if you want to handle errors in a way to simply exclude it from the sum (and not return with an error), only then would you need to count valid numbers.</p>\n\n<h3>Rounding</h3>\n\n<p>Multiplying by 10 and then dividing by 10 is <em>truncating</em> and not <em>rounding</em>. For rounding, you should add <code>0.5</code> between those 2 operations. For details, see this answer: <a href=\"https://stackoverflow.com/questions/39544571/golang-round-to-nearest-0-05/39544897#39544897\">Golang Round to Nearest 0.05</a></p>\n\n<p>So a correct rounding function that properly rounds both positive and negative numbers to arbitrary unit:</p>\n\n<pre><code>func Round(x, unit float64) float64 {\n    if x &gt; 0 {\n        return float64(int64(x/unit+0.5)) * unit\n    }\n    return float64(int64(x/unit-0.5)) * unit\n}\n</code></pre>\n\n<p>So the result:</p>\n\n<pre><code>avg := Round(sum/float64(len(prices)), 0.1)\n</code></pre>\n\n<h3>The complete solution with error handling</h3>\n\n<p>Since your <code>getAvgPrice()</code> can fail at multiple points, you should definitely add an error return value too.</p>\n\n<p>This is the complete solution with proper error handling:</p>\n\n<pre><code>func getAvgPrice(starttime, endtime string) (float64, error) {\n    response, err := http.Get(\"https://hourlypricing.comed.com/api?type=5minutefeed&amp;datestart=\" + starttime + \"&amp;dateend=\" + endtime)\n    if err != nil {\n        return 0, err\n    }\n    defer response.Body.Close()\n\n    var prices []map[string]json.Number\n    if err := json.NewDecoder(response.Body).Decode(&amp;prices); err != nil {\n        return 0, err\n    }\n\n    sum := 0.0\n    for _, p := range prices {\n        f, err := p[\"price\"].Float64()\n        if err != nil {\n            return 0, err\n        }\n        sum += f\n    }\n\n    return Round(sum/float64(len(prices)), 0.1), nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3333, "user_id": 2175188, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/b853c420676ac96087ded21212aa4ffa?s=128&d=identicon&r=PG", "display_name": "Raymond Gan", "link": "https://stackoverflow.com/users/2175188/raymond-gan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496518044, "creation_date": 1496488531, "last_edit_date": 1496518044, "question_id": 44343308, "link": "https://stackoverflow.com/questions/44343308/how-to-average-values-of-an-array-of-jsons-then-round-to-1-decimal-point", "title": "How to average values of an array of JSONs, then round to 1 decimal point", "body": "<p>I'm new to Go and can't figure out how to simply read and average the values of an array of JSONs. I also want to round my result to 1 decimal point, but Go has no <code>Round()</code> function. Here's the data:</p>\n\n<pre><code>[\n    {\"millisUTC\":\"1496424000000\",\"price\":\"7.6\"},\n    {\"millisUTC\":\"1496423700000\",\"price\":\"7.5\"},\n    {\"millisUTC\":\"1496423400000\",\"price\":\"9.1\"},\n    {\"millisUTC\":\"1496423100000\",\"price\":\"9.2\"},\n    {\"millisUTC\":\"1496422800000\",\"price\":\"10.0\"}\n]\n</code></pre>\n\n<p>I want to get the prices and average them, rounding to 1 decimal point. Yet it took me over 30 lines of code, when (as a Ruby developer) it would usually take me 3 lines. How do I simplify this? My code takes in 2 parameters, <code>starttime</code> and <code>endtime</code>, and calls an API: <a href=\"https://github.com/rayning0/griddy/blob/master/controllers/default.go\" rel=\"nofollow noreferrer\">https://github.com/rayning0/griddy/blob/master/controllers/default.go</a></p>\n\n<pre><code>type arrayOfMaps []map[string]string\n\nfunc getAvgPrice(starttime, endtime string) float64 {\n    response, err := http.Get(\"https://hourlypricing.comed.com/api?type=5minutefeed&amp;datestart=\" + starttime + \"&amp;dateend=\" + endtime)\n\n   if err != nil {\n        fmt.Println(err)\n    }\n    defer response.Body.Close()\n\n    energyJSON, err := ioutil.ReadAll(response.Body)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    var energyPrices arrayOfMaps\n    err = json.Unmarshal(energyJSON, &amp;energyPrices)\n\n    fmt.Println(\"Energy prices between\", starttime, \"and\", endtime)\n    fmt.Println(energyPrices)\n\n    var sum float64\n    var size int\n    for _, p := range energyPrices {\n        price, _ := strconv.ParseFloat(p[\"price\"], 64)\n        sum += price\n        size++\n    }\n    avg := Truncate(sum / float64(size))\n    fmt.Println(\"Average price:\", avg)\n    return avg\n}\n\n//Truncate a float to 1 level of precision\nfunc Truncate(some float64) float64 {\n    return float64(int(some*10)) / 10\n}\n</code></pre>\n\n<hr>\n\n<p>Edited, thanks to excellent help from @icza!</p>\n\n<p>This applies to my question: <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Decode\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Decoder.Decode</a></p>\n\n<p>See my revised solution, with detailed comments: <a href=\"https://github.com/rayning0/griddy/blob/master/controllers/default.go\" rel=\"nofollow noreferrer\">https://github.com/rayning0/griddy/blob/master/controllers/default.go</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2345, "user_id": 2102087, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0382d81dd8afcfa8058df1bdb27fe197?s=128&d=identicon&r=PG", "display_name": "Denis V", "link": "https://stackoverflow.com/users/2102087/denis-v"}, "edited": false, "score": 0, "creation_date": 1496491854, "post_id": 44342940, "comment_id": 75690440, "body": "You are totally right! I tried to avoid it with in and out, but missed that with fn! Thank you very much, I couldn&#39;t sleep because of that! :D"}], "tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 3, "last_activity_date": 1496485888, "creation_date": 1496485888, "answer_id": 44342940, "question_id": 44341662, "link": "https://stackoverflow.com/questions/44341662/golang-pipelining-channels-works-as-a-separate-function-but-doesnt-work-as-a/44342940#44342940", "title": "golang pipelining channels - works as a separate function, but doesn&#39;t work as a part of main function", "body": "<p>You're using a capture variable <code>fn</code> across <code>goroutine</code>, in which the variable will be overridden during iteration. What is seen by all <code>goroutines</code> is the latest job in the <code>funcs</code>. Change your code in <code>Pipe</code> function to the following:</p>\n\n<pre><code>for _, fn := range funcs {\n    out = make(chan interface{})\n    wg.Add(1)\n    go func(f job, inx, outx chan interface{}) {\n        f(inx, outx)\n        close(outx)\n        wg.Done()\n    }(fn, in, out)\n\n    in = out\n}\n</code></pre>\n\n<p>It's one of <a href=\"https://github.com/golang/go/wiki/CommonMistakes\" rel=\"nofollow noreferrer\">common mistake</a> in golang. </p>\n"}], "owner": {"reputation": 2345, "user_id": 2102087, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0382d81dd8afcfa8058df1bdb27fe197?s=128&d=identicon&r=PG", "display_name": "Denis V", "link": "https://stackoverflow.com/users/2102087/denis-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 1, "accepted_answer_id": 44342940, "answer_count": 1, "score": 0, "last_activity_date": 1496485888, "creation_date": 1496475897, "question_id": 44341662, "link": "https://stackoverflow.com/questions/44341662/golang-pipelining-channels-works-as-a-separate-function-but-doesnt-work-as-a", "title": "golang pipelining channels - works as a separate function, but doesn&#39;t work as a part of main function", "body": "<p>I'm new to go, and at the moment I'm trying to understand how channel synchronisation works. I'm solving a test task that requires me to build a pipeline from channels. I wrote two similar solutions, but one of this doesn't work for an unknown reason (for me).</p>\n\n<p>This doesn't work (the go-routines are started from the function directly):</p>\n\n<p><a href=\"https://play.golang.org/p/EHceKjZZ-G\" rel=\"nofollow noreferrer\">https://play.golang.org/p/EHceKjZZ-G</a></p>\n\n<p>This works (the go-routines are started from a separate function):</p>\n\n<p><a href=\"https://play.golang.org/p/QysTAVxbVc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/QysTAVxbVc</a></p>\n\n<p>I'm totally lost, I don't see the difference and can't understand why the first example doesn't work. Does any one have any idea?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 1, "creation_date": 1496486103, "post_id": 44341203, "comment_id": 75688880, "body": "Take a look at <a href=\"https://stackoverflow.com/questions/27945310/why-do-i-need-to-use-http-stripprefix-to-access-my-static-files\">Why do I need to use http.StripPrefix to access my static files?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 1209538, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1777de319efe52999139231273746dc9?s=128&d=identicon&r=PG", "display_name": "joncalhoun", "link": "https://stackoverflow.com/users/1209538/joncalhoun"}, "is_accepted": true, "score": 3, "last_activity_date": 1496493703, "creation_date": 1496493703, "answer_id": 44344046, "question_id": 44341203, "link": "https://stackoverflow.com/questions/44341203/is-http-stripprefix-necessary-when-serving-static-files-in-go/44344046#44344046", "title": "Is http.StripPrefix necessary when serving static files in Go?", "body": "<p>No it is not required, but if you DO NOT use it the path used to find the file will include the prefix. This is clearer with an example, so imagine your folder structure was:</p>\n\n<pre><code>main.go\nstatic/\n  styles.css\n</code></pre>\n\n<p>And you serve the files with:</p>\n\n<pre><code>http.Handle(\"/static/\", http.FileServer(http.Dir(\"\")))\n</code></pre>\n\n<p>Then a user requesting the file at <code>yoursite.com/static/styles.css</code> would get the styles.css file in the static dir. But for this to work your paths must line up perfectly.</p>\n\n<p>Most people prefer to do the following instead:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"static\"))\nhttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n</code></pre>\n\n<p>Because they could change their URL path to be something like <code>/assets/</code> without needing to rename the static dir (or vise versa - change the local dir structure w/out updating the URL path).</p>\n\n<p>TL;DR - Path prefix isn't required but is useful to break any requirements of URL paths and local directory structure matching perfectly.</p>\n"}], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 626, "favorite_count": 0, "accepted_answer_id": 44344046, "answer_count": 1, "score": 2, "last_activity_date": 1496493703, "creation_date": 1496472640, "question_id": 44341203, "link": "https://stackoverflow.com/questions/44341203/is-http-stripprefix-necessary-when-serving-static-files-in-go", "title": "Is http.StripPrefix necessary when serving static files in Go?", "body": "<p>What's wrong with <code>http.Handle(\"/static/\", http.FileServer(http.Dir(\"\")))</code>?</p>\n\n<p>The shortest example I can find looks like this:</p>\n\n<pre><code>fs := http.FileServer(http.Dir(\"static\"))\nhttp.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n</code></pre>\n\n<p>Is <code>http.StripPrefix</code> necessary?</p>\n"}, {"tags": ["http", "go", "websocket", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 8051878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a981aaa91aebb638fd8b99f1c73fe3de?s=128&d=identicon&r=PG", "display_name": "LostGoneAndNotFound", "link": "https://stackoverflow.com/users/8051878/lostgoneandnotfound"}, "edited": false, "score": 0, "creation_date": 1496560680, "post_id": 44345955, "comment_id": 75705468, "body": "That actually did the trick. Good thinking. I am aware that goroutines are advertised as lightweight but as a person with a background in C, efficiency is always in back of my mind. How does this scale in case of hundreds of connected clients? Surely it must not be negligible to have a hundreds of goroutines or not to have them."}, {"owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "reply_to_user": {"reputation": 63, "user_id": 8051878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a981aaa91aebb638fd8b99f1c73fe3de?s=128&d=identicon&r=PG", "display_name": "LostGoneAndNotFound", "link": "https://stackoverflow.com/users/8051878/lostgoneandnotfound"}, "edited": false, "score": 0, "creation_date": 1496561274, "post_id": 44345955, "comment_id": 75705576, "body": "Yes, goroutines are lightweight. You can run hundreds of thousands of them. So, it&#39;s normal to run few goroutines to serve one client. Read this question for explanations: <a href=\"https://stackoverflow.com/questions/8509152/max-number-of-goroutines\" title=\"max number of goroutines\">stackoverflow.com/questions/8509152/max-number-of-goroutines</a> Also, you can take some ideas from this project: <a href=\"https://github.com/centrifugal/centrifugo\" rel=\"nofollow noreferrer\">github.com/centrifugal/centrifugo</a> It solves tasks, similar to yours."}], "tags": [], "owner": {"reputation": 887, "user_id": 8099995, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WLnoV.png?s=128&g=1", "display_name": "berserkk", "link": "https://stackoverflow.com/users/8099995/berserkk"}, "is_accepted": true, "score": 3, "last_activity_date": 1496506181, "creation_date": 1496506181, "answer_id": 44345955, "question_id": 44340192, "link": "https://stackoverflow.com/questions/44340192/net-http-concurrency-and-message-passing-between-coroutines/44345955#44345955", "title": "net/http: concurrency and message passing between coroutines", "body": "<p>When you upgrade HTTP connection to a WebSocket connection using Gorilla, it hijacks that connection and net/http server stops serving it. This means, that you can't rely on a net/http events from that moment.</p>\n\n<p>Check this: <a href=\"https://github.com/gorilla/websocket/issues/123\" rel=\"nofollow noreferrer\">https://github.com/gorilla/websocket/issues/123</a></p>\n\n<p>So, what you can do here is to start new goroutine for every new WebSocket connection, which will read data from this connection and write a message to a <code>quit</code> channel on a failure.</p>\n"}], "owner": {"reputation": 63, "user_id": 8051878, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a981aaa91aebb638fd8b99f1c73fe3de?s=128&d=identicon&r=PG", "display_name": "LostGoneAndNotFound", "link": "https://stackoverflow.com/users/8051878/lostgoneandnotfound"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 224, "favorite_count": 0, "accepted_answer_id": 44345955, "answer_count": 1, "score": 1, "last_activity_date": 1496506181, "creation_date": 1496463335, "question_id": 44340192, "link": "https://stackoverflow.com/questions/44340192/net-http-concurrency-and-message-passing-between-coroutines", "title": "net/http: concurrency and message passing between coroutines", "body": "<p>I am working on a REST API server and one of the features of the server is being able to notify arbitrary number of client via a websocket when a new resource is created or an existing one is modified.</p>\n\n<p>I have a custom action router to bind an URL to a function and <em>gorillas</em>'s implementation of websocket library. For IPC I have decided to rely on channels as it appears to be <strong>the</strong> idiomatic way to communicate between coroutines. Also it behaves like a pipe which is a concept I am familiar with.</p>\n\n<p>A prototype for a function <code>Create</code> looks like this:</p>\n\n<pre><code>func Create (res http.ResponseWriter, req *http.Request, userdata interface {}) (int, string, interface {})\n</code></pre>\n\n<p>As a <code>userdata</code> an instance of a structure <code>PipeSet</code> is passed. It is a map that is shared between all coroutines where a key is an address (<em>a pointer to</em>) of a <code>Pipe</code> and value the same thing. The rationale here is to speed up a lookup process when deleting.</p>\n\n<pre><code>type Pipe chan string                                                           \n\ntype PipeSet struct {                                                           \n    sync.Mutex                                                                  \n    Pipes map [*Pipe] *Pipe                                                     \n}                                                                               \n\nfunc NewPipe () Pipe {                                                          \n    return make (Pipe)                                                          \n}                                                                               \n\nfunc NewPipeSet () PipeSet {                                                    \n    var newSet PipeSet                                                      \n    newSet.Pipes = make (map[*Pipe] *Pipe)                                  \n    return newSet                                                           \n}                                                                               \n\nfunc (o *PipeSet) AddPipe (pipe *Pipe) {                                        \n    o.Lock ()                                                                   \n    o.Pipes[pipe] = pipe                                                        \n    o.Unlock ()                                                                 \n}                                                                               \n\nfunc (o *PipeSet) ForeachPipe (f func (pipe Pipe)) {                            \n    o.Lock ()                                                                   \n    for k := range (o.Pipes) {                                                  \n        f (*o.Pipes[k])                                                         \n    }                                                                           \n    o.Unlock ()                                                                 \n}                                                                               \n\nfunc (o *PipeSet) DeletePipe (pipe *Pipe) {                                     \n    o.Lock ()                                                                   \n    delete (o.Pipes, pipe)                                                      \n    o.Unlock ()                                                                 \n}\n</code></pre>\n\n<p>When a client connects via websocket a new channel (a <code>Pipe</code>) is created and added to a shared <code>PipeSet</code>. Then if a new resource is created a coroutine goes through an entire <code>PipeSet</code> sending a message to each <code>Pipe</code>. The message is then forwarded to a connected clients on the other side.</p>\n\n<h3>A problem area</h3>\n\n<p>I am unable to detect whether client's websocket connection is still <em>there</em>. I need to know that to determine whether I should remove a <code>Pipe</code> from the <code>PipeSet</code>. I am relying on <code>CloseNotifier</code> in this case. It never fires.</p>\n\n<p>The code looks like this (excerpt):</p>\n\n<pre><code>var upgrader = websocket.Upgrader {\n    CheckOrigin: func (r *http.Request) bool { return true },\n}\n\nconn, err := upgrader.Upgrade (res, req, nil)\n\nif err != nil {\n    marker.MarkError (err)\n    return http.StatusBadRequest, \"\", nil\n}\n\ndefer conn.Close ()\n\nexitStatus = http.StatusOK\npipe := genstore.NewPipe ()\nquit := res.(http.CloseNotifier).CloseNotify ()\n\ngenStore.WSChannels.AddPipe (&amp;pipe)\n\nfor {\n    log.Printf (\"waiting for a message\")\n\n    select {\n        case wsMsg = &lt;-pipe:\n            log.Printf (\"got a message: %s (num pipes %d)\", wsMsg, len (genStore.WSChannels.Pipes))\n\n            if err = conn.WriteMessage (websocket.TextMessage, []byte (wsMsg)); err != nil {\n                marker.MarkError (err)\n                goto egress\n            }\n\n        case &lt;-quit:\n            log.Printf (\"quit...\")\n            goto egress\n    }\n}\n\negress:\ngenStore.WSChannels.DeletePipe (&amp;pipe)\n</code></pre>\n"}, {"tags": ["go", "http2"], "comments": [{"owner": {"reputation": 25813, "user_id": 62612, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/886132d118e6db4b08dc816c2b7026f6?s=128&d=identicon&r=PG", "display_name": "Gravis", "link": "https://stackoverflow.com/users/62612/gravis"}, "edited": false, "score": 0, "creation_date": 1496451998, "post_id": 44339285, "comment_id": 75682197, "body": "If I ignore the assertion, and try to push anyway, I get a Panic: 2017-06-03_01:05:22.85073 Pushing CSS -------------------- 2017-06-03_01:05:22.85087 2017/06/03 01:05:22 http2: panic serving 172.18.0.1:43268: runtime error: invalid memory address or nil pointer dereference 2017-06-03_01:05:22.85088 goroutine 86 [running]: 2017-06-03_01:05:22.85088 net/http.(*http2serverConn).runHandler.func1(0xc42000c038, 0xc42015ffaf, 0xc420133880) 2017-06-03_01:05:22.85090       /usr/local/Cellar/go/1.8.3/libexec/src/net/http/h2_bundle.go&zwnj;&#8203;:4604 +0x190"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496507198, "post_id": 44339285, "comment_id": 75694934, "body": "Ignoring the assertion is guaranteed not to work."}], "answers": [{"tags": [], "owner": {"reputation": 25813, "user_id": 62612, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/886132d118e6db4b08dc816c2b7026f6?s=128&d=identicon&r=PG", "display_name": "Gravis", "link": "https://stackoverflow.com/users/62612/gravis"}, "is_accepted": false, "score": 0, "last_activity_date": 1496452197, "creation_date": 1496452197, "answer_id": 44339315, "question_id": 44339285, "link": "https://stackoverflow.com/questions/44339285/http-2-request-but-push-not-support/44339315#44339315", "title": "HTTP/2 request, but push not support", "body": "<p>Nevermind, I found it, it's because I'm using negroni: <a href=\"https://github.com/urfave/negroni/issues/173\" rel=\"nofollow noreferrer\">https://github.com/urfave/negroni/issues/173</a></p>\n"}], "owner": {"reputation": 25813, "user_id": 62612, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/886132d118e6db4b08dc816c2b7026f6?s=128&d=identicon&r=PG", "display_name": "Gravis", "link": "https://stackoverflow.com/users/62612/gravis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 375, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496452197, "creation_date": 1496451910, "question_id": 44339285, "link": "https://stackoverflow.com/questions/44339285/http-2-request-but-push-not-support", "title": "HTTP/2 request, but push not support", "body": "<p>I'm starting to play with go http/2 push, and the examples are not working for me.\nThe request is in http/2 (I can see \"Version: HTTP/2.0\" in firefox, and I have an extension to tell if the server is using http/2).\nYet, something like:</p>\n\n<pre><code>http.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    if pusher, ok := w.(http.Pusher); ok {\n        // Push is supported.\n        if err := pusher.Push(\"/app.js\", nil); err != nil {\n            log.Printf(\"Failed to push: %v\", err)\n        }\n    } else {\n      fmt.Println(\"Push not supported\")\n    }\n    // ...\n})\n</code></pre>\n\n<p>Always displays \"Push not supported\".\nAny hint to debug that?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["function", "go", "webrtc", "collider", "apprtc"], "comments": [{"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 1, "creation_date": 1496451392, "post_id": 44339166, "comment_id": 75682116, "body": "Are you sure you are importing your code and not the original?"}], "answers": [{"tags": [], "owner": {"reputation": 8175, "user_id": 376742, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/314c5e634c0b24fd63b70bf62a83f4cc?s=128&d=identicon&r=PG", "display_name": "ssk", "link": "https://stackoverflow.com/users/376742/ssk"}, "is_accepted": true, "score": 1, "last_activity_date": 1496688300, "creation_date": 1496688300, "answer_id": 44375650, "question_id": 44339166, "link": "https://stackoverflow.com/questions/44339166/go-lang-too-many-arguments-in-call/44375650#44375650", "title": "go lang too many arguments in call", "body": "<p>I finally fixed it before uninstalling go. </p>\n\n<p>I removed the /usr/local/go folder and reinstalled. </p>\n\n<p><strong>Note:</strong> collider folder in /usr/local/go/collider had my changes previously and still collidermain didn't link properly with it. Must have been a cached build intermediates?</p>\n"}], "owner": {"reputation": 8175, "user_id": 376742, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/314c5e634c0b24fd63b70bf62a83f4cc?s=128&d=identicon&r=PG", "display_name": "ssk", "link": "https://stackoverflow.com/users/376742/ssk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1521, "favorite_count": 0, "accepted_answer_id": 44375650, "answer_count": 1, "score": 1, "last_activity_date": 1496688300, "creation_date": 1496450358, "question_id": 44339166, "link": "https://stackoverflow.com/questions/44339166/go-lang-too-many-arguments-in-call", "title": "go lang too many arguments in call", "body": "<p>I am enhancing this Golang project: <a href=\"https://github.com/webrtc/apprtc/blob/master/src/collider/collider/collider.go\" rel=\"nofollow noreferrer\">https://github.com/webrtc/apprtc/blob/master/src/collider/collider/collider.go</a></p>\n\n<p>I added new parameters to the Run method:</p>\n\n<pre><code>// Run starts the collider server and blocks the thread until the program exits.\nfunc (c *Collider) Run(p int, useTls bool, cert string, key string) {\n    http.Handle(\"/ws\", websocket.Handler(c.wsHandler))\n    http.HandleFunc(\"/status\", c.httpStatusHandler)\n    http.HandleFunc(\"/\", c.httpHandler)\n\n    var e error\n</code></pre>\n\n<p>and it is invoked from main.go:</p>\n\n<p><a href=\"https://github.com/webrtc/apprtc/blob/master/src/collider/collidermain/main.go\" rel=\"nofollow noreferrer\">https://github.com/webrtc/apprtc/blob/master/src/collider/collidermain/main.go</a></p>\n\n<pre><code>// run the program\nfunc (p *program) run() {\n    configuration := InitConfiguration()\n\n    log.Printf(\"Running collider: tls = %t, port = %d, room_server=%s\", \n                configuration.Tls, configuration.Port, configuration.RoomServer)\n\n    c := collider.NewCollider(configuration.RoomServer)\n    c.Run(configuration.Port, configuration.Tls, configuration.Cert, configuration.Key)\n}\n</code></pre>\n\n<p>For some reasons I keep getting the below error:</p>\n\n<pre><code>/usr/local/go/src/collidermain/main.go:84: too many arguments in call to c.Run\n</code></pre>\n\n<p>I cross checked the src in: \n/usr/local/go/src/collider\n/usr/local/go/src/collidermain</p>\n\n<p>Everything is fine. Not sure why this error keeps happening.</p>\n\n<p>Any thoughts?</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "edited": false, "score": 2, "creation_date": 1496448717, "post_id": 44338582, "comment_id": 75681696, "body": "As stated in <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">the documentation</a> and also mentioned in the answer, the reference time is <code>01&#47;02 03:04:05PM &#39;06 -0700</code>. Did you see the pattern? It&#39;s nicely ordered from <code>01</code> to <code>07</code>. Additional &quot;rule&quot;, when expressing hour in <code>24-hour style</code>, replace <code>03</code> with <code>15</code> which is another representation of <code>03 PM</code>."}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1496447371, "creation_date": 1496447371, "answer_id": 44338853, "question_id": 44338582, "link": "https://stackoverflow.com/questions/44338582/how-do-you-convert-month-dd-yyyy-to-yyyy-mm-dd-in-go/44338853#44338853", "title": "How do you convert &quot;Month dd, yyyy&quot; to yyyy-mm-dd in Go?", "body": "<p>You just need to parse the time using the input layout and then print it using the output layout. The layout always specifies how the reference time (Mon Jan 2 15:04:05 MST 2006) would look in the given format. I think this is what you want:</p>\n\n<pre><code>func main() {\n    value := \"April 20, 1996\"\n    layout := \"January 2, 2006\"\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n    fmt.Println(\"time:\", t.Format(\"2006-01-02\"))\n}\n</code></pre>\n\n<p>See <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/time/</a> for more information.</p>\n"}], "owner": {"reputation": 725, "user_id": 1340135, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/19c77ec6e88f9ee85488d72fbeef0b64?s=128&d=identicon&r=PG", "display_name": "Kaah", "link": "https://stackoverflow.com/users/1340135/kaah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "accepted_answer_id": 44338853, "answer_count": 1, "score": -2, "last_activity_date": 1496447371, "creation_date": 1496444943, "question_id": 44338582, "link": "https://stackoverflow.com/questions/44338582/how-do-you-convert-month-dd-yyyy-to-yyyy-mm-dd-in-go", "title": "How do you convert &quot;Month dd, yyyy&quot; to yyyy-mm-dd in Go?", "body": "<p>I need to convert for example \"April 20, 1996\" to 1996-04-20. I have tried the following code but I have a feeling that I am doing it in reverse somehow.</p>\n\n<pre><code>func main() {\n    value  := \"April 20, 1996\"\n    layout := \"January 1, 1996\"\n    t, _ := time.Parse(layout, value)\n    fmt.Println(t)\n    mydate, _ := time.Parse(\"2006-01-02\", \"2016-07-08\")\n    fmt.Println(\"time:\", mydate.Format(\"April 20, 1996 (MST)\"))\n}\n</code></pre>\n"}, {"tags": ["go", "ocaml"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496436282, "post_id": 44337071, "comment_id": 75678225, "body": "Go does not have function-local static variables. If you want to share a mutable value between executions of a function, it must be a global variable. You can use function-local constants for immutable values, but constants are limited to the built-in types."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496436404, "post_id": 44337071, "comment_id": 75678271, "body": "You could also make the variable a member of a struct, and convert the function to a method on that struct, depending on your use case. You would still need to ensure the same instance of the struct was re-used. Personally I would just use a global though."}], "answers": [{"comments": [{"owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "edited": false, "score": 0, "creation_date": 1496757106, "post_id": 44337351, "comment_id": 75783522, "body": "You can also bind the resulting closure to a global variable, and then you can use it like other functions (see my answer)."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1496437114, "creation_date": 1496437114, "answer_id": 44337351, "question_id": 44337071, "link": "https://stackoverflow.com/questions/44337071/precomputing-simple-values-for-a-function-in-go/44337351#44337351", "title": "Precomputing simple values for a function in Go", "body": "<p>Not familiar with Ocaml so not 100% sure if this Go example is what you are looking for, but you can define a function in Go which can pre-calculate some stuff and then return an anonymous function that internally uses the pre-calculated values.</p>\n\n<p>For example, if you do this:</p>\n\n<pre><code>func matcher(pattern string) func(string) bool {\n    regExp := regexp.MustCompile(pattern)\n    return func(s string) bool {\n        return regExp.MatchString(s)\n    }\n}\n</code></pre>\n\n<p>And then create one of these functions by doing:</p>\n\n<pre><code>myMatcher := matcher(\"123\")\n</code></pre>\n\n<p>You can then call <code>myMatcher(\"something\")</code> multiple times, and the regexp expression will not be compiled each time since it was already compiled when calling the <code>matcher</code> function.</p>\n\n<p>Here's a working Go playground with this:</p>\n\n<p><a href=\"https://play.golang.org/p/m3vBrYn4Dg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/m3vBrYn4Dg</a></p>\n"}, {"tags": [], "owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "is_accepted": false, "score": 0, "last_activity_date": 1496444491, "creation_date": 1496444491, "answer_id": 44338523, "question_id": 44337071, "link": "https://stackoverflow.com/questions/44337071/precomputing-simple-values-for-a-function-in-go/44338523#44338523", "title": "Precomputing simple values for a function in Go", "body": "<p>I think a closure (similar to what @eugenioy already answered with) is the closest you are going to get.</p>\n\n<pre><code>func main() {\n    userGroupTemplate := renderPage()\n    fmt.Println(userGroupTemplate(\"sberry\", \"StackOverflow\"))\n    fmt.Println(userGroupTemplate(\"user1030453\", \"StackOverflow\"))\n}\n\nfunc renderPage() func(user, group string) string {\n    templ := \"user: %s, group: %s\"\n    fmt.Println(\"template is created\")\n    return func(user, group string) string {\n        return fmt.Sprintf(templ, user, group)\n    }\n}\n</code></pre>\n\n<p><strong>OUTPUT</strong></p>\n\n<pre><code>template is created\nuser: sberry, group: StackOverflow\nuser: user1030453, group: StackOverflow\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "is_accepted": false, "score": 0, "last_activity_date": 1496757023, "creation_date": 1496757023, "answer_id": 44391887, "question_id": 44337071, "link": "https://stackoverflow.com/questions/44337071/precomputing-simple-values-for-a-function-in-go/44391887#44391887", "title": "Precomputing simple values for a function in Go", "body": "<p>In addition to the other answers here, note that once you define a closure, you can bind it to a global variable and treat it like other functions.\nHere is eugenioy's <a href=\"https://stackoverflow.com/a/44337351/124319\">answer</a> slightly modified :</p>\n\n<pre><code>var scan = matcher(\"123\")\n\nfunc main() {\n    fmt.Println(scan(\"456\"))\n    fmt.Println(scan(\"123\"))\n}\n</code></pre>\n\n<p>Here, <code>scan</code> is a global closure, which is very close to what you did in OCaml.</p>\n\n<p><a href=\"https://play.golang.org/p/Lc0SC53b-0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Lc0SC53b-0</a></p>\n"}], "owner": {"reputation": 857, "user_id": 1030453, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/dcc819c9bce12893784f16bd63f581db?s=128&d=identicon&r=PG", "display_name": "chrismamo1", "link": "https://stackoverflow.com/users/1030453/chrismamo1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 44337351, "answer_count": 3, "score": 2, "last_activity_date": 1496757023, "creation_date": 1496435819, "question_id": 44337071, "link": "https://stackoverflow.com/questions/44337071/precomputing-simple-values-for-a-function-in-go", "title": "Precomputing simple values for a function in Go", "body": "<p>I just started using Go for a simple web programming project, but I can't quite figure out how to accomplish simple pre-computation local to a single function. This is something I do quite frequently in OCaml, e.g.:</p>\n\n<pre><code>(* maybe render_page is a handler function for an HTTP server or something *)\nlet render_page =\n  (* let's say that Template.prepare takes a template string and returns its compiled representation *)\n  let templ = Template.prepare \"user: {{.}}, group: {{.}}\" in\n  (* return an anonymous function *)\n  fun user group -&gt;\n    templ [user; group]\n</code></pre>\n\n<p>For those unfamiliar with OCaml, what's happening above is I'm binding the name <code>render_page</code> to a function that takes two parameters and presumably returns a web page, but internally I'm first creating a local binding to <code>templ</code> (this binding is only visible within the definition of <code>render_page</code>, and the computation only happens once) and then using that binding within an anonymous function, which is the actual value bound to <code>render_page</code>. So when you call <code>render_page</code>, <code>templ</code> isn't recompiled every time: it's just fetched from the closure environment.</p>\n\n<p>Is there a common pattern for accomplishing something like this in Go? I'd like to avoid global variables as much as possible. I'm aware that \"global\" variables may be confined to a package's name space, which is what I'm currently doing, but I'd like to restrict the visibility of these precomputed expressions to just the functions in which they're needed.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 68294, "user_id": 854246, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpTof.png?s=128&g=1", "display_name": "Joseph Marikle", "link": "https://stackoverflow.com/users/854246/joseph-marikle"}, "edited": false, "score": 0, "creation_date": 1496425098, "post_id": 44334512, "comment_id": 75672942, "body": "is <code>str</code> always a character class or is it potentially more broad?"}, {"owner": {"reputation": 658033, "user_id": 548225, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/dab08478b226280d4a30894c9a7ed719?s=128&d=identicon&r=PG", "display_name": "anubhava", "link": "https://stackoverflow.com/users/548225/anubhava"}, "edited": false, "score": 0, "creation_date": 1496425132, "post_id": 44334512, "comment_id": 75672954, "body": "What is your regex flavor?"}, {"owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 0, "creation_date": 1496425187, "post_id": 44334512, "comment_id": 75672981, "body": "The user can give anything."}, {"owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "edited": false, "score": 1, "creation_date": 1496425206, "post_id": 44334512, "comment_id": 75672989, "body": "Writing in Golang"}, {"owner": {"reputation": 68294, "user_id": 854246, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cpTof.png?s=128&g=1", "display_name": "Joseph Marikle", "link": "https://stackoverflow.com/users/854246/joseph-marikle"}, "edited": false, "score": 3, "creation_date": 1496425337, "post_id": 44334512, "comment_id": 75673068, "body": "So why not run the expression against two separate regexes? Why does it have to be combined?  If this is for validation, you can just run it twice against user input first and then against the slash for the second pass."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1496444096, "post_id": 44334512, "comment_id": 75680795, "body": "Just note that <code>[^&#47;]</code> will also match <code>[a-z]</code>."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1496444828, "post_id": 44334512, "comment_id": 75680950, "body": "and you may use <code>(?:[^&#47;]|[a-z])</code>"}, {"owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1496468927, "post_id": 44334512, "comment_id": 75684733, "body": "@Wiktor Stribi\u017cew, 1) The <code>[a-z]</code> is user-supplied and will vary (otherwise one could simply use <code>[a-z]</code>). 2) <code>(?:[^&#47;]|[a-z])</code> matches <code>!</code>, so that&#39;s not right."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1496477745, "post_id": 44334512, "comment_id": 75686675, "body": "@Travis Use <code>`^(?:[^&#47;]|[a-z])+$`</code>"}], "answers": [{"tags": [], "owner": {"reputation": 320781, "user_id": 589924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/b2cf53d5a3d25f95c0db4e025aed4153?s=128&d=identicon&r=PG", "display_name": "ikegami", "link": "https://stackoverflow.com/users/589924/ikegami"}, "is_accepted": false, "score": 0, "last_activity_date": 1496470157, "last_edit_date": 1496470157, "creation_date": 1496425304, "answer_id": 44334628, "question_id": 44334512, "link": "https://stackoverflow.com/questions/44334512/regex-to-require-both-and-another-user-defined-regex/44334628#44334628", "title": "Regex to require both [^/] and another user-defined regex", "body": "<p>Best to do the checks separately.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"regexp\"\n\nfunc main() {\n    str := \"test\"\n    user_provided_pattern := \"^[a-z]+\\\\z\"\n\n    matched := false\n    matched_slash, _ := regexp.MatchString(\"/\", str)\n    if !matched_slash {\n       matched_user, err := regexp.MatchString(user_provided_pattern, str)\n       if err != nil {\n          panic(err)\n       }\n\n       if matched_user {\n          matched = true\n       }\n    }\n\n    fmt.Println(matched)\n}\n</code></pre>\n\n<p><em>This is my first go program &mdash;I've never even seen a go program before&mdash; so please excuse any oddities.</em></p>\n"}], "owner": {"reputation": 2810, "user_id": 5808504, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/821bb6654d488185345d86bde0a586ef?s=128&d=identicon&r=PG&f=1", "display_name": "twharmon", "link": "https://stackoverflow.com/users/5808504/twharmon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1496470157, "creation_date": 1496424901, "last_edit_date": 1496425596, "question_id": 44334512, "link": "https://stackoverflow.com/questions/44334512/regex-to-require-both-and-another-user-defined-regex", "title": "Regex to require both [^/] and another user-defined regex", "body": "<p>Suppose a user gave <code>str = \"[a-z]\"</code>. How can I match <code>[^/]</code> <em>and</em> <code>[a-z]</code>? </p>\n\n<p>I want some thing like <code>\"/[^/]&amp;\" + str + \"/\"</code>. It should match <code>asdf</code> but not <code>a/sdf</code>.</p>\n"}, {"tags": ["arrays", "xml", "go", "encoding", "children"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1496423331, "post_id": 44334020, "comment_id": 75672043, "body": "In your sample code, <code>Test.CustProfile.Address</code> is a slice, which is why you&#39;re getting an undefined error trying to read <code>marshalTest.CustProfile.Address.PrimaryAddress</code> - you have to specify an element of the slice to operate on. In your sample, each element of the slice has both a <code>PrimaryAddress</code> and <code>SecondaryAddress</code>, which I don&#39;t think is what you&#39;re trying to do. However, I don&#39;t know any way to do what you&#39;re describing using <code>xml.Unmarshal</code> directly; you&#39;ll have to do some manipulation to get there."}, {"owner": {"reputation": 65, "user_id": 6411846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff3900263ac2f7104755c29904d0d74f?s=128&d=identicon&r=PG&f=1", "display_name": "xPeaWhyTee", "link": "https://stackoverflow.com/users/6411846/xpeawhytee"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496501773, "post_id": 44334020, "comment_id": 75693225, "body": "Hi @Adrian, what type of manipulation are you referring to? I&#39;m really new to Go so I don&#39;t know the extent of what all can be done. Thanks"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1496503537, "post_id": 44334020, "comment_id": 75693748, "body": "Unmarshal it as two members of the same type, then add both to a slice of the type after unmarshaling."}], "answers": [{"tags": [], "owner": {"reputation": 65, "user_id": 6411846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff3900263ac2f7104755c29904d0d74f?s=128&d=identicon&r=PG&f=1", "display_name": "xPeaWhyTee", "link": "https://stackoverflow.com/users/6411846/xpeawhytee"}, "is_accepted": true, "score": 0, "last_activity_date": 1496677092, "creation_date": 1496677092, "answer_id": 44372521, "question_id": 44334020, "link": "https://stackoverflow.com/questions/44334020/golang-unmarshal-same-level-xml-elements-into-array/44372521#44372521", "title": "Golang Unmarshal same level XML elements into array", "body": "<p>I was able to use a combination of xml parsing with <a href=\"https://github.com/antchfx/xquery\" rel=\"nofollow noreferrer\">Xquery</a> and json parsing with <a href=\"https://github.com/Jeffail/gabs\" rel=\"nofollow noreferrer\">Gabs</a> to manually construct the struct I wanted. Probably not the cleanest solution but it allowed me to customize the struct to the degree I wanted.</p>\n"}], "owner": {"reputation": 65, "user_id": 6411846, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ff3900263ac2f7104755c29904d0d74f?s=128&d=identicon&r=PG&f=1", "display_name": "xPeaWhyTee", "link": "https://stackoverflow.com/users/6411846/xpeawhytee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 467, "favorite_count": 0, "accepted_answer_id": 44372521, "answer_count": 1, "score": 0, "last_activity_date": 1496677092, "creation_date": 1496422836, "question_id": 44334020, "link": "https://stackoverflow.com/questions/44334020/golang-unmarshal-same-level-xml-elements-into-array", "title": "Golang Unmarshal same level XML elements into array", "body": "<p>I have XML that I would like to unmarshal the address info into its on array as part of my struct:</p>\n\n<pre><code>&lt;customer&gt;\n    ...\n    &lt;dob&gt;1990-10-01&lt;/dob&gt;\n    &lt;address1&gt;555 Hollywood Blvd&lt;/address1&gt;\n    &lt;city&gt;Hollywood&lt;/city&gt;\n    &lt;state&gt;CA&lt;/state&gt;\n    &lt;zipCode&gt;99999&lt;/zipCode&gt;\n    &lt;alternateAddress1&gt;575 Hollywood St&lt;/alternateAddress1&gt;\n    &lt;alternateCity&gt;Los Angeles&lt;/alternateCity&gt;\n    &lt;alternateState&gt;CA&lt;/alternateState&gt;\n    &lt;alternateZipCode&gt;12345&lt;/alternateZipCode&gt;\n    ....\n&lt;/customer&gt;\n</code></pre>\n\n<p>My attempt at a struct:</p>\n\n<pre><code>    type Test struct {\n      CustProfile struct {\n        DOB string `xml:\"birthDate\" json:\"dob\"`\n        Address []struct {\n            PrimaryAddress struct {\n                Street string `xml:\"address1\" json:\"line1\"`\n                City string `xml:\"city\" json:\"city\"`\n                State string `xml:\"state\" json:\"state\"`\n                ZipCode string `xml:\"zipCode\" json:\"zip\"`\n                IsPrimaryAddress string `json:\"isPrimaryAddress\"`\n            }\n            AlternateAddress struct {\n                Street string `xml:\"alternateAddress1\" json:\"line1\"`\n                City string `xml:\"alternateCity\" json:\"city\"`\n                State string `xml:\"alternateState\" json:\"state\"`\n                ZipCode string `xml:\"alternateZipCode\" json:\"zip\"`\n                IsPrimaryAddress string `json:\"isPrimaryAddress\"`\n            }\n        } `json:\"address\"`\n    } `xml:\"customer\" json:\"custProfile\"`\n  }\n</code></pre>\n\n<p>So I'm having a couple of issues here. The first issue is that all the elements are in the same level and from what I figured out so far, since the CustProfile struct is already associated with the <strong>customer</strong> parent element, I'm not able to reference any child elements inside the Address struct because the path would be <strong>customer->?>city,state,etc</strong> which will always return null since that path doesn't exist. </p>\n\n<p>The second issue is the way I'm trying to define a default string for <strong>IsPrimaryAddress</strong>. I tried doing something like this but I'm getting an undefined error.</p>\n\n<pre><code>var marshalTest Test\n...\nmarshalTest.CustProfile.Address.PrimaryAddress.IsPrimaryAddress = \"Y\";\nmarshalTest.CustProfile.Address.AlternateAddress.IsPrimaryAddress = \"N\";\n</code></pre>\n\n<p>Is it possible to unmarshal this XML into a struct that results in the struct below?</p>\n\n<pre><code>{\n  \"custProfile\": {\n    \"dob\": \"1990-10-01\",\n    \"address\": [\n      {\n        \"line1\": \"555 Hollywood Blvd\",\n        \"city\": \"HOLLYWOOD\",\n        \"state\": \"CA\",\n        \"zip\": \"99999\",\n        \"isPrimaryAddress\": \"Y\"\n      },\n      {\n        \"line1\": \"575 Hollywood St\",\n        \"city\": \"LOS ANGELES\",\n        \"state\": \"CA\",\n        \"zip\": \"12345\",\n        \"isPrimaryAddress\": \"N\"\n      }\n    ]\n}\n</code></pre>\n\n<p>I'm not at all that familiar with XML encoding in Go and the best I've been able to manage is this:</p>\n\n<pre><code> {\n      \"custProfile\": {\n        \"dob\": \"1990-10-01\",\n        \"address\": null\n      }\n }\n</code></pre>\n\n<p>Any help would be greatly appreciated. Thanks</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 62, "user_id": 8023512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e66cae00dc87683472083bdece62886b?s=128&d=identicon&r=PG&f=1", "display_name": "Lan Quach", "link": "https://stackoverflow.com/users/8023512/lan-quach"}, "is_accepted": true, "score": 3, "last_activity_date": 1496425275, "creation_date": 1496425275, "answer_id": 44334620, "question_id": 44333467, "link": "https://stackoverflow.com/questions/44333467/can-i-use-another-variable-as-a-key-in-golang-templates/44334620#44334620", "title": "Can I use another variable as a key in Golang templates?", "body": "<p>You can use the <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\">index</a> function to access a map.</p>\n\n<pre><code>{{ range .Database }} \n    {{ index $.Status . }}\n{{ end }}\n</code></pre>\n\n<p>See <a href=\"https://play.golang.org/p/cJebtPvRMX\" rel=\"nofollow noreferrer\">play</a>.</p>\n"}], "owner": {"reputation": 373, "user_id": 5641538, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/8b268f431d5fa6d9f3fc10e059d995a2?s=128&d=identicon&r=PG&f=1", "display_name": "devinov", "link": "https://stackoverflow.com/users/5641538/devinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 130, "favorite_count": 0, "accepted_answer_id": 44334620, "answer_count": 1, "score": 1, "last_activity_date": 1496425275, "creation_date": 1496420666, "last_edit_date": 1496421006, "question_id": 44333467, "link": "https://stackoverflow.com/questions/44333467/can-i-use-another-variable-as-a-key-in-golang-templates", "title": "Can I use another variable as a key in Golang templates?", "body": "<p>I have a data structure that is sometihng like:</p>\n\n<pre><code>map[string]SomeStructure\n</code></pre>\n\n<p>I have another struct that encapsulates the above plus additional variables and other structs and that's what gets sent to the template:</p>\n\n<pre><code>type page struct {\n    Status   map[string]SomeStructure\n    Database  []string\n}\n</code></pre>\n\n<p>In my template file I want to be able to do something like</p>\n\n<pre><code>{{ range index .Database}} \n    {{ .Status \"KEY\".MemberVariableOfSomeStructure }}\n{{ end }}\n</code></pre>\n\n<p>Except I want the \"KEY\" to be dynamic based on the iterating .Database value.</p>\n"}, {"tags": ["go", "filepath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1496413994, "post_id": 44331078, "comment_id": 75666787, "body": "You can&#39;t determine the absolute path on a system when you&#39;re not on that system. Are you looking for something more like <a href=\"https://golang.org/pkg/path/#Clean\" rel=\"nofollow noreferrer\"><code>path.Clean</code></a>?"}], "answers": [{"comments": [{"owner": {"reputation": 1121, "user_id": 3561450, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/bcefd147a156cfbd6c48263b2fdeceda?s=128&d=identicon&r=PG", "display_name": "rion18", "link": "https://stackoverflow.com/users/3561450/rion18"}, "edited": false, "score": 0, "creation_date": 1496431437, "post_id": 44331759, "comment_id": 75676017, "body": "<code>filepath.ToSlash</code> is the closest I got to do what I wanted. In the end, a filepath like C:/project/test was created. Just a matter of removing the semicolon and prepending /. Thanks."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1496415025, "creation_date": 1496415025, "answer_id": 44331759, "question_id": 44331078, "link": "https://stackoverflow.com/questions/44331078/can-i-force-filepath-abs-to-give-path-deisgned-for-another-os/44331759#44331759", "title": "Can I force filepath.Abs to give path deisgned for another OS?", "body": "<p>As @JimB noted, converting a relative path to an absolute path is not only OS-specific, it's context-specific: the same relative path on different systems (regardless of OS) can yield different paths; in fact, even on <em>the same system</em>, converting relative to absolute from different working directories can yield different paths. Again as @JimB noted, you can use <a href=\"https://golang.org/pkg/path/#Clean\" rel=\"nofollow noreferrer\"><code>path.Clean</code></a> to remove any unnecessary or reduntant relative path components (e.g. turn <code>/dir/../otherDir/./subDir/</code> into <code>/otherDir/subDir/</code>), but that's the closest you'll get to anything not context-sensitive.</p>\n\n<p>If you just want to convert the <em>representation</em>, there's <a href=\"https://golang.org/pkg/path/filepath/#ToSlash\" rel=\"nofollow noreferrer\"><code>filepath.ToSlash</code></a> which will replace all platform-specific separators with forward slashes. If you're trying to re-use a path across systems, you could run <code>ToSlash</code> on the input, store the \"generic\" path using forward slashes, then on the target system use <a href=\"https://golang.org/pkg/path/filepath/#FromSlash\" rel=\"nofollow noreferrer\"><code>filepath.FromSlash</code></a> to convert it back to the platform-specific path separator.</p>\n"}], "owner": {"reputation": 1121, "user_id": 3561450, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/bcefd147a156cfbd6c48263b2fdeceda?s=128&d=identicon&r=PG", "display_name": "rion18", "link": "https://stackoverflow.com/users/3561450/rion18"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 44331759, "answer_count": 1, "score": 0, "last_activity_date": 1496415025, "creation_date": 1496412837, "question_id": 44331078, "link": "https://stackoverflow.com/questions/44331078/can-i-force-filepath-abs-to-give-path-deisgned-for-another-os", "title": "Can I force filepath.Abs to give path deisgned for another OS?", "body": "<p>I currently am working on Windows. I use the following code to get an absolute path for a relative path.</p>\n\n<pre><code>absolutePath, err := filepath.Abs(relativePath)\n</code></pre>\n\n<p>The output for this is <code>C:\\project\\test</code>. Is there any way to \"trick\" <code>filepath.Abs</code> to have a Linux style absolute path, whether it's <code>/project/test</code> or <code>/d/project/test/</code>? Thanks!</p>\n"}, {"tags": ["go", "struct", "channel", "channels"], "answers": [{"comments": [{"owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "edited": false, "score": 0, "creation_date": 1496410881, "post_id": 44330212, "comment_id": 75664798, "body": "Thanks for the response! I had thought about the third example, but if I make the struct member directional, how would I read from it in the receiver side? Wouldn&#39;t that make it impossible?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "edited": false, "score": 0, "creation_date": 1496410996, "post_id": 44330212, "comment_id": 75664867, "body": "The receiver would have to keep its own copy of the channel which is either not directional, or receive-only, the same as you would have to with your original example passing a directional channel directly to the function."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1496410304, "creation_date": 1496410304, "answer_id": 44330212, "question_id": 44330146, "link": "https://stackoverflow.com/questions/44330146/golang-channel-in-a-struct-can-it-be-directional-when-passed-to-a-function/44330212#44330212", "title": "Golang channel in a struct: Can it be directional when passed to a function?", "body": "<p>A couple of ways, depending on your particular situation:</p>\n\n<ul>\n<li>Pass the channel instead of the struct, and make the channel parameter directional as in your first example</li>\n<li>Don't expose the channel directly, just expose a struct method to write to it (if there's no method to read from it, it's effectively directional)</li>\n<li>Make the channel struct member directional:</li>\n</ul>\n\n<p>E.g.</p>\n\n<pre><code>type myStruct struct {\n    c chan &lt;- bool\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 3, "last_activity_date": 1496411902, "last_edit_date": 1496411902, "creation_date": 1496411342, "answer_id": 44330549, "question_id": 44330146, "link": "https://stackoverflow.com/questions/44330146/golang-channel-in-a-struct-can-it-be-directional-when-passed-to-a-function/44330549#44330549", "title": "Golang channel in a struct: Can it be directional when passed to a function?", "body": "<p>On top of @Adrian's suggestions, if you have to ensure one way communication on a channel, you can always use an anonymous function:</p>\n\n<pre><code>for a:=0; a &lt;=2; a++{\n  go func f(ch &lt;-string) {\n    SomeFunc(ch)\n  }(slcChanStruct[a].chMessages)\n}\n</code></pre>\n\n<p>Note that you'll have to pass the channel to <code>SomeFunc</code> instead of the struct.</p>\n\n<p>If you still want to perform both way communication on your channel, you can re assign the channel to a one directional type:</p>\n\n<pre><code>type ChanStruct struct {\n    chMessages chan string\n}\n\ntype ChanStructRecv struct {\n    chMessages &lt;-chan string\n}\n\n// Update SomeFunc type:\n\nfunc SomeFunc(s ChanStructRecv) {\n  // ...\n}\n</code></pre>\n\n<p>Finally, the loop can be modified similarly:</p>\n\n<pre><code>for a:=0; a &lt;=2; a++{\n  go func f(s ChanStruct) {\n    var sr ChanStructRecv\n    sr.chMessages = s.chMessages\n    SomeFunc(sr)\n  }(slcChanStruct[a])\n}\n</code></pre>\n"}], "owner": {"reputation": 2731, "user_id": 74361, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/adca63afb01fa2d56850114c337476fb?s=128&d=identicon&r=PG", "display_name": "Bart Silverstrim", "link": "https://stackoverflow.com/users/74361/bart-silverstrim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 19245, "favorite_count": 0, "accepted_answer_id": 44330549, "answer_count": 2, "score": 5, "last_activity_date": 1496411902, "creation_date": 1496410063, "question_id": 44330146, "link": "https://stackoverflow.com/questions/44330146/golang-channel-in-a-struct-can-it-be-directional-when-passed-to-a-function", "title": "Golang channel in a struct: Can it be directional when passed to a function?", "body": "<p>When passing a channel to a function, I know you can specify the direction that channel may use the channel for; for example,</p>\n\n<pre><code>func MyFunc(ch chan&lt;- string) {\n    ch &lt;- \"Hello\"\n}\n</code></pre>\n\n<p>\"ch\" can only be used by MyFunc to send strings to a receiver elsewhere and MyFunc cannot listen for messages from ch.</p>\n\n<p>To simplify creating a dynamic number of channels to some number of goroutines, I created a struct containing channels.</p>\n\n<pre><code>type ChanStruct struct {\n    chMessages chan string\n}\n</code></pre>\n\n<p>Then I instantiate a structs:</p>\n\n<pre><code>var slcChanStruct []ChanStruct\nfor a:= 0; a &lt;=2; a++ {\n    var tmpChanStruct ChanStruct\n    tmpChanStruct.chMessages = make(chan string)\n    slcChanStruct = append(slcChanStruct, tmpChanStruct)\n}\n</code></pre>\n\n<p>Now I have 3 structs I can individually read/write with a channel by ranging over a slice of structs. But when I send them off to goroutines:</p>\n\n<pre><code>for a:=0; a &lt;=2; a++{\n    go SomeFunc(slcChanStruct[a])\n}\n</code></pre>\n\n<p>...is there a way to add a bit of safety by specifying that the goroutines can only, for example, send using the ChanStruct.ch channel?</p>\n\n<p>NOTE the reason I was doing this is that if I don't know how many channels I'll need for a parallel set of processes (the number of processes are passed as a command line argument) using a struct with channels means I can create a slice that can be passed to any number of goroutines and directly access them individually by ranging over them; before, I had to create a set number of channels if I wanted to individually read from a number of goroutines. I'd like to add some safety to this by specifying that processes can only use a channel a certain way, like I could when using individual channels (individual channels mean I can do something like telling a particular goroutine to quit without other goroutines intercepting it). Is there a more idiomatic way to do this if I can't add directionality to functions using the channel in a struct?</p>\n"}, {"tags": ["multithreading", "go", "parallel-processing"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1496408340, "post_id": 44329504, "comment_id": 75663125, "body": "Three&#39;s no reason to call <code>w.Write</code> in a goroutine -- the writes are all going to the same connection, so they need to be sequential anyways."}, {"owner": {"reputation": 3609, "user_id": 3763102, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2439148d94bddcda4415797c8f6afefa?s=128&d=identicon&r=PG", "display_name": "gipsy", "link": "https://stackoverflow.com/users/3763102/gipsy"}, "edited": false, "score": 0, "creation_date": 1496412293, "post_id": 44329504, "comment_id": 75665657, "body": "You are adding <code>generateThreadsNum</code> into the WaitGroup but invoking 2 times as many <code>gorotines</code> and calling <code>Done()</code> only in half of them.. I am not sure if that is the cause of your problem"}, {"owner": {"reputation": 9, "user_id": 8103271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5aef68d83c2ccdeeda40fa252051f39e?s=128&d=identicon&r=PG&f=1", "display_name": "Ubik", "link": "https://stackoverflow.com/users/8103271/ubik"}, "edited": false, "score": 0, "creation_date": 1496412804, "post_id": 44329504, "comment_id": 75665984, "body": "Thank you! Yes, its a mistake and I totally forgot about that. But its irrelevant to question."}, {"owner": {"reputation": 17595, "user_id": 41455, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4788a6e08db703f60f249356c95d5775?s=128&d=identicon&r=PG", "display_name": "superfell", "link": "https://stackoverflow.com/users/41455/superfell"}, "edited": false, "score": 1, "creation_date": 1496413917, "post_id": 44329504, "comment_id": 75666715, "body": "each request needs its own channel &amp; waitGroup, you can&#39;t share them across invocations of the handler."}], "owner": {"reputation": 9, "user_id": 8103271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5aef68d83c2ccdeeda40fa252051f39e?s=128&d=identicon&r=PG&f=1", "display_name": "Ubik", "link": "https://stackoverflow.com/users/8103271/ubik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 62, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1496408069, "creation_date": 1496408069, "question_id": 44329504, "link": "https://stackoverflow.com/questions/44329504/variable-of-goroutine-does-not-have-time-to-sign-up", "title": "Variable of goroutine does not have time to sign up", "body": "<p>This piece of code gets an array with strings and should mix it and make a response (both multithreaded).\nThe problem is that the text of the answer is randomly cutted. This is probably due to the fact that the variable \"dump\" does not have time to sign up completely. If it is wrapped in mutexes, the text is returned full, but threads are blocked and the program is executed for a long time. Please help!    </p>\n\n<pre><code>const url = \"https://yandex.ru/referats/write/?t=astronomy+mathematics\"\nconst parseThreadsNum = 10\nconst generateThreadsNum = 1000\n\nfunc startServer(wg *sync.WaitGroup) {\nfmt.Println(\"Server started\")\nch := make(chan []byte, generateThreadsNum)\n\nhttp.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n    wg.Add(generateThreadsNum)\n    rawText := multiparseText() // text parsing\n    prettyText := prettifyText(rawText) // truncates commas, dots etc. Return []string\n    for i := 0; i &lt; generateThreadsNum; i++ {\n        go func() {\n            dump, _ := json.Marshal(shuffle(&amp;prettyText)) //shuffle mixes array randomly\n            ch &lt;- dump\n        }()\n        go func() {\n            w.Write(&lt;-ch)\n            defer wg.Done()\n        }()\n    }\n    fmt.Println(\"Text generated\")\n    wg.Wait()\n})\nlog.Fatal(http.ListenAndServe(\":8081\", nil))\n}\n\nfunc main() {\nvar wg sync.WaitGroup\nruntime.GOMAXPROCS(runtime.NumCPU())\nstartServer(&amp;wg)\n\n}\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1496406991, "post_id": 44327560, "comment_id": 75662319, "body": "Your best bet for unit testing Postgres stored procedures is to use <a href=\"http://pgtap.org/\" rel=\"nofollow noreferrer\">pgTAP</a>."}], "answers": [{"tags": [], "owner": {"reputation": 1107, "user_id": 3955438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076351be18e9ecd9e5af894cbfca298e?s=128&d=identicon&r=PG&f=1", "display_name": "viru", "link": "https://stackoverflow.com/users/3955438/viru"}, "is_accepted": false, "score": 0, "last_activity_date": 1539814207, "creation_date": 1539814207, "answer_id": 52864327, "question_id": 44327560, "link": "https://stackoverflow.com/questions/44327560/how-to-mock-sql-update-in-go/52864327#52864327", "title": "How to mock sql update in go", "body": "<p>I've used the following package</p>\n\n<blockquote>\n  <p>import (sql \"database/sql\")</p>\n</blockquote>\n\n<p>this enables me to check the following, </p>\n\n<p><code>....\nvar rows sql.Result\n...\n&lt;execute query &gt;\n... \nrows.RowsAffected()\n</code></p>\n\n<p>rows.RowsAffected() provides the number of rows updated.</p>\n"}], "owner": {"reputation": 37, "user_id": 4637131, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5e5caae2ff7554cf0c7ad53343de24b7?s=128&d=identicon&r=PG&f=1", "display_name": "edward cullen", "link": "https://stackoverflow.com/users/4637131/edward-cullen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 947, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1539814207, "creation_date": 1496402046, "last_edit_date": 1496402202, "question_id": 44327560, "link": "https://stackoverflow.com/questions/44327560/how-to-mock-sql-update-in-go", "title": "How to mock sql update in go", "body": "<p>I'm trying to write a unit test for updating record in postgresql in golang</p>\n\n<p>database function is</p>\n\n<pre><code>CREATE OR REPLACE FUNCTION test.update(param_id text, param_data jsonb, id2 text) RETURNS void AS\n$$\nBEGIN\n    UPDATE test.test_table\n    SET data = param_data,\n    WHERE id = (SELECT id FROM test.test_table2 WHERE name = id2)\nEND;\n$$\nLANGUAGE plpgsql;\n</code></pre>\n\n<p>Unit test is </p>\n\n<pre><code>rows := sqlmock.NewRows([]string{\"result\"}).AddRow(\"\")\n\nmock.ExpectBegin()\nmock.ExpectQuery(fmt.Sprintf(\"SELECT %v.update(.+)\", schema)).WithArgs(1, data).WillReturnRows(rows)\nmock.ExpectCommit()\n</code></pre>\n\n<p>Do I also need to mock the select query inside?  How can I mock a void function?</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1496403597, "last_edit_date": 1496403597, "creation_date": 1496398310, "answer_id": 44326377, "question_id": 44325232, "link": "https://stackoverflow.com/questions/44325232/are-tests-executed-in-parallel-in-go-or-one-by-one/44326377#44326377", "title": "Are tests executed in parallel in Go or one by one?", "body": "<p>It's really easy to test it:</p>\n\n<pre><code>func Test1(t *testing.T) {\n    fmt.Println(\"Test1 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test1 end\")\n}\n\nfunc Test2(t *testing.T) {\n    fmt.Println(\"Test2 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test2 end\")\n}\n\nfunc Test3(t *testing.T) {\n    fmt.Println(\"Test3 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test3 end\")\n}\n</code></pre>\n\n<p>Running it with <code>go test</code>, the output shows it's sequential:</p>\n\n<pre><code>Test1 start\nTest1 end\nTest2 start\nTest2 end\nTest3 start\nTest3 end\n</code></pre>\n\n<p>So normal tests are executed one after the other, sequentially, but don't forget that order is not defined: <a href=\"https://stackoverflow.com/questions/31201858/how-to-run-golang-tests-sequentially/31204016#31204016\">How to run golang tests sequentially?</a></p>\n\n<p>Also note that a test function can mark itself eligible for parallel execution, paralell with other tests that also do the same using the <a href=\"https://golang.org/pkg/testing/#T.Parallel\" rel=\"noreferrer\"><code>T.Parallel()</code></a> method:</p>\n\n<blockquote>\n  <p>Parallel signals that this test is to be run in parallel with (and only with) other parallel tests.</p>\n</blockquote>\n\n<p>So if we modify the above testing code to:</p>\n\n<pre><code>func Test1(t *testing.T) {\n    t.Parallel()\n    fmt.Println(\"Test1 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test1 end\")\n}\n\nfunc Test2(t *testing.T) {\n    t.Parallel()\n    fmt.Println(\"Test2 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test2 end\")\n}\n\nfunc Test3(t *testing.T) {\n    fmt.Println(\"Test3 start\")\n    time.Sleep(time.Second * 2)\n    fmt.Println(\"Test3 end\")\n}\n</code></pre>\n\n<p>Running it again with <code>go test</code>, the output is:</p>\n\n<pre><code>Test3 start\nTest3 end\nTest1 start\nTest2 start\nTest2 end\nTest1 end\n</code></pre>\n\n<p>What does this prove? The order of tests is not defined, <code>Test3</code> was executed first this time. And then <code>Test1</code> and <code>Test2</code> were run <em>parallel</em>.</p>\n\n<p>There are some testing flags that control parallel execution. For example the <code>-parallel</code> flag specifies how many of these may run parallel. If you execute it with <code>go test -parallel=1</code>, the output will again become sequential, but the order will be <code>Test3</code>, <code>Test1</code>, <code>Test2</code>.</p>\n\n<p>Also note that <a href=\"https://golang.org/doc/go1.7#testing\" rel=\"noreferrer\">Go 1.7 introduced subtests and subbenchmarks</a>. You can read more about this in blog post <a href=\"https://blog.golang.org/subtests\" rel=\"noreferrer\">Using Subtests and Sub-benchmarks</a>:</p>\n\n<blockquote>\n  <p>In Go 1.7, the <code>testing</code> package introduces a Run method on the <a href=\"https://golang.org/pkg/testing/#T.Run\" rel=\"noreferrer\">T</a> and <a href=\"https://golang.org/pkg/testing/#B.Run\" rel=\"noreferrer\">B</a> types that allows for the creation of subtests and sub-benchmarks. The introduction of subtests and sub-benchmarks enables better handling of failures, fine-grained control of which tests to run from the command line, control of parallelism, and often results in simpler and more maintainable code.</p>\n</blockquote>\n\n<p>Subtests and subbenchmarks may run parallel, and there are a number of flags that may control their execution, e.g. <code>-parallel</code>, <code>-p</code>, <code>-cpu</code>. Run <code>go help testflag</code> to see the complete list of testing flags.</p>\n"}, {"comments": [{"owner": {"reputation": 1063, "user_id": 82180, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/636d75539216567531f83493b67ec479?s=128&d=identicon&r=PG", "display_name": "Charles", "link": "https://stackoverflow.com/users/82180/charles"}, "edited": false, "score": 1, "creation_date": 1589431890, "post_id": 53602451, "comment_id": 109293062, "body": "See also: <a href=\"https://coderwall.com/p/rwgo_a/go-test-package-in-parallel\" rel=\"nofollow noreferrer\">coderwall.com/p/rwgo_a/go-test-package-in-parallel</a>,  <a href=\"https://github.com/golang/go/issues/11521\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/11521</a>, and <a href=\"https://www.reddit.com/r/golang/comments/777f99/parallel_tests_on_package_level/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/777f99/&hellip;</a>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user684934"}, "is_accepted": false, "score": 11, "last_activity_date": 1543873834, "creation_date": 1543873834, "answer_id": 53602451, "question_id": 44325232, "link": "https://stackoverflow.com/questions/44325232/are-tests-executed-in-parallel-in-go-or-one-by-one/53602451#53602451", "title": "Are tests executed in parallel in Go or one by one?", "body": "<p>By default, all the tests <strong>within</strong> a package are run sequentially.</p>\n\n<p>Also by default, all of the <strong>sets of tests</strong> are run in parallel.  </p>\n\n<p>This may cause issues if you use defaults and have different packages that test against a common persistence layer (like a rdbms).  If you have issues with this case, then running <code>go test ./... -p 1</code> will prevent different test suites from running concurrently.</p>\n"}], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5509, "favorite_count": 3, "accepted_answer_id": 44326377, "answer_count": 2, "score": 8, "last_activity_date": 1543873834, "creation_date": 1496395161, "question_id": 44325232, "link": "https://stackoverflow.com/questions/44325232/are-tests-executed-in-parallel-in-go-or-one-by-one", "title": "Are tests executed in parallel in Go or one by one?", "body": "<p>I have a Go file with unit tests and some of them use a common variable. Another global variable is used in the code that I'm testing. All of this can cause a problem. </p>\n\n<p>In Go when we execute tests that are located in the same file how does they run? In parallel or next one will not start before previous one is finished ? </p>\n"}, {"tags": ["dictionary", "go", "struct", "julia"], "comments": [{"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 2, "creation_date": 1496409818, "post_id": 44324800, "comment_id": 75664096, "body": "Hello again, Fred!  See <a href=\"https://stackoverflow.com/a/44311316/5075720\">Stefan&#39;s answer from your question yesterday</a>.  As <a href=\"https://stackoverflow.com/a/44326922/5075720\">Michael K. Borregaard points out</a>, it has to do with the fact that, even for immutable structs, <code>hash(a::MyT) == hash(b::MyT)</code> does not automatically imply <code>isequals(a::MyT, b::MyT)</code>."}, {"owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "reply_to_user": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1496410765, "post_id": 44324800, "comment_id": 75664714, "body": "Thanks @PaSTE ! Do you think that the solution I wrote, with a separate unique key array, is the best ?"}, {"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1496429678, "post_id": 44324800, "comment_id": 75675230, "body": "&quot;Best&quot; is difficult to evaluate.  If you are comfortable with the code and it serves your purposes, then who am I to say this is not best for you?  I think the solution you wrote might be cumbersome and memory-inefficient if the number of keys becomes large.  On top of that, <code>ExistsKey</code>, as written, runs in O(N) time, while looking up by hash value runs in roughly O(1) time.  Unless you know you have a very small number of keys to deal with, I would suggest implementing <code>hash</code> and <code>isequals</code> (or <code>==</code>), as <a href=\"https://stackoverflow.com/a/44331242/5075720\">given below</a>."}], "answers": [{"comments": [{"owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1496406252, "post_id": 44326922, "comment_id": 75661863, "body": "Thank you @Michael K. Borregaard. It means that I have to construct a separate array of keys. It is much easier in GO :  _, ok := dic[MyT{&quot;Bob&quot;, 10}] works perfectly."}, {"owner": {"reputation": 7009, "user_id": 2540037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uB7zs.jpg?s=128&g=1", "display_name": "Michael K. Borregaard", "link": "https://stackoverflow.com/users/2540037/michael-k-borregaard"}, "reply_to_user": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1496412895, "post_id": 44326922, "comment_id": 75666035, "body": "I think it is a common observation that some objectives are easier in some languages :-) The julian-ideomatic way to do this would be to define a new method for <code>==</code> that dispatches on your type."}, {"owner": {"reputation": 7009, "user_id": 2540037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uB7zs.jpg?s=128&g=1", "display_name": "Michael K. Borregaard", "link": "https://stackoverflow.com/users/2540037/michael-k-borregaard"}, "reply_to_user": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1496412981, "post_id": 44326922, "comment_id": 75666093, "body": "I&#39;ve edited the answer to suggest another approach as well that is more similar to what you know from Go."}], "tags": [], "owner": {"reputation": 7009, "user_id": 2540037, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/uB7zs.jpg?s=128&g=1", "display_name": "Michael K. Borregaard", "link": "https://stackoverflow.com/users/2540037/michael-k-borregaard"}, "is_accepted": false, "score": 2, "last_activity_date": 1496413093, "last_edit_date": 1496413093, "creation_date": 1496399935, "answer_id": 44326922, "question_id": 44324800, "link": "https://stackoverflow.com/questions/44324800/how-to-use-haskey-and-in-functions-with-complex-dictionnary-keys-in-julia/44326922#44326922", "title": "How to use haskey() and in() functions with complex dictionnary keys in Julia?", "body": "<p>You're creating a new object in the <code>haskey</code> call. But two objects created by <code>MyT(\"Tom\", 191)</code> are just two different MyT objects with the same field values.</p>\n\n<p>Instead, do</p>\n\n<pre><code>key1 = MyT(\"Tom\", 191)\na = Dict(key1 =&gt; 1)\nhaskey(a, key1)\n</code></pre>\n\n<p>see also</p>\n\n<pre><code>key2 = MyT(\"Tom\", 191)\nkey1 == key2 # false\n</code></pre>\n\n<p>A julia-ideomatic way to deal with this would be to define an <code>==</code> method for MyT objects, so two objects are equal if they have the same field values. That would allow you to use them like you do.</p>\n\n<p>It depends whether you need the type to be complex. Another easy and performant way to do what you want is to use a Tuple as the key: </p>\n\n<pre><code>a = Dict((\"Tom\", 191) =&gt; 1)\nhaskey(a, (\"Tom\", 191)) # true\na[(\"Tom\", 191)] # 1\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 0, "creation_date": 1496477572, "post_id": 44331242, "comment_id": 75686634, "body": "@Matt.B. , could you explain how did you obtain this address &quot;0x7d6979235cb005d0&quot; and what it means ? Thanks !"}, {"owner": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "reply_to_user": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "edited": false, "score": 1, "creation_date": 1496504677, "post_id": 44331242, "comment_id": 75694138, "body": "Yup, I just did a <code>rand(UInt64)</code>.  The value itself isn&#39;t significant; it just needs to be somewhat unique so you don&#39;t end up hashing <code>MyT(&quot;Jo&quot;,315)</code> the same as the tuple <code>(&quot;Jo&quot;, 315)</code> or someone else&#39;s <code>YourT(&quot;Jo&quot;,315)</code>.  Grabbing a random number is a great way to do that."}], "tags": [], "owner": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "is_accepted": true, "score": 6, "last_activity_date": 1496413374, "creation_date": 1496413374, "answer_id": 44331242, "question_id": 44324800, "link": "https://stackoverflow.com/questions/44324800/how-to-use-haskey-and-in-functions-with-complex-dictionnary-keys-in-julia/44331242#44331242", "title": "How to use haskey() and in() functions with complex dictionnary keys in Julia?", "body": "<p>You just need to teach your <code>MyT</code> type that you want it to consider equality in terms of its composite fields:</p>\n\n<pre><code>julia&gt; immutable MyT\n           A::String\n           B::Int64\n       end\n       import Base: ==, hash\n       ==(x::MyT, y::MyT) = x.A == y.A &amp;&amp; x.B == y.B\n       hash(x::MyT, h::UInt) = hash(x.A, hash(x.B, hash(0x7d6979235cb005d0, h)))\n\njulia&gt; a = Dict(MyT(\"Tom\",191)=&gt;1,MyT(\"Bob\",20)=&gt;1,MyT(\"Jo\",315)=&gt;1,MyT(\"Luc\",493)=&gt;1)\nDict{MyT,Int64} with 4 entries:\n  MyT(\"Jo\", 315)  =&gt; 1\n  MyT(\"Luc\", 493) =&gt; 1\n  MyT(\"Tom\", 191) =&gt; 1\n  MyT(\"Bob\", 20)  =&gt; 1\n\njulia&gt; haskey(a, MyT(\"Tom\",191))\ntrue\n\njulia&gt; in((MyT(\"Tom\",191) =&gt; 1), a)\ntrue\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "edited": false, "score": 1, "creation_date": 1496414967, "post_id": 44331622, "comment_id": 75667376, "body": "or, skip the whole type stuff and use tuples to begin with :p"}, {"owner": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "edited": false, "score": 1, "creation_date": 1496417524, "post_id": 44331622, "comment_id": 75668945, "body": "This kind of piece-meal method extension is really fragile and will likely lead to frustration.  You&#39;re effectively teaching <i>some</i> of the Dict machinery that you want your type to act like tuples, but not all of it.  Check out <code>methodswith(Dict, true)</code> to see everything you&#39;d need to change, including <code>getindex</code>, <code>setindex!</code>, <code>push!</code>, \u2026."}, {"owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "reply_to_user": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "edited": false, "score": 0, "creation_date": 1496417547, "post_id": 44331622, "comment_id": 75668962, "body": "Matt&#39;s solution is the canonical one, I hasten to add (as implied by the documentation for <code>isequal</code> and <code>hash</code>). Just mentioning the tuple point here out of sheer interest. :)"}, {"owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "reply_to_user": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "edited": false, "score": 0, "creation_date": 1496417568, "post_id": 44331622, "comment_id": 75668975, "body": "@MattB. hah, just beat me to it :D"}, {"owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "reply_to_user": {"reputation": 28436, "user_id": 176071, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/88b8fe9e9bc03bd33208830fa612dc50?s=128&d=identicon&r=PG", "display_name": "mbauman", "link": "https://stackoverflow.com/users/176071/mbauman"}, "edited": false, "score": 0, "creation_date": 1496417773, "post_id": 44331622, "comment_id": 75669116, "body": "@MattB. yes I agree. In fact, I think you should mention this in your answer! (i.e. that your suggestion is the canonical way as recommended by the documentation, respecting the Dict interface and requiring no other overloading)"}], "tags": [], "owner": {"reputation": 18197, "user_id": 4183191, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/8ce0d78cc78f51ee79cec5088effe3ed?s=128&d=identicon&r=PG", "display_name": "Tasos Papastylianou", "link": "https://stackoverflow.com/users/4183191/tasos-papastylianou"}, "is_accepted": false, "score": 0, "last_activity_date": 1496416695, "last_edit_date": 1496416695, "creation_date": 1496414599, "answer_id": 44331622, "question_id": 44324800, "link": "https://stackoverflow.com/questions/44324800/how-to-use-haskey-and-in-functions-with-complex-dictionnary-keys-in-julia/44331622#44331622", "title": "How to use haskey() and in() functions with complex dictionnary keys in Julia?", "body": "<p>My approach would be similar to Matt's, but a bit simpler(?). Tuples are perfectly valid dictionary keys, so I would simply overload the relevant functions to convert your type back and forth to a tuple:</p>\n\n\n\n<pre class=\"lang-julia prettyprint-override\"><code>julia&gt; immutable M; A::String; B::Int64; end\njulia&gt; import Base: =&gt;, haskey, in\njulia&gt; =&gt;(a::M, b) = (a.A, a.B)=&gt;b\njulia&gt; haskey(a::Dict, b::M) = haskey(a, (b.A, b.B))\njulia&gt; in(a::Pair{M, Int64}, b::Int64) = in((a.first.A,a.first.B)=&gt;a.second,b)\n</code></pre>\n\n<p>\n\n<pre class=\"lang-julia prettyprint-override\"><code>julia&gt; a = Dict(M(\"Dick\", 10)=&gt;1, M(\"Harry\", 20)=&gt;2)\nDict{Tuple{String,Int64},Int64} with 2 entries:\n  (\"Dick\", 10)  =&gt; 1\n  (\"Harry\", 20) =&gt; 2\n\njulia&gt; haskey(a, M(\"Dick\", 10))\ntrue\n\njulia&gt; in(M(\"Dick\", 10)=&gt;1, a)\ntrue\n</code></pre>\n\n<blockquote>\n  <p>\"Compared to Julia, Go is more straightforward for this problem\"</p>\n</blockquote>\n\n<p>True. It also happens to be more error-prone (depending on your perspective). If you wanted to differentiate between two objects (used as keys) that do <em>not</em> correspond to the same object in memory, then Go's approach of simply testing 'value equality' would have landed you in trouble here (though one could argue 'value equality' generally makes more sense when comparing 'keys').</p>\n"}, {"comments": [{"owner": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1496429980, "post_id": 44333559, "comment_id": 75675379, "body": "By the way, I&#39;m glad you brought up <code>&quot;foo&quot; !== &quot;foo&quot;</code>.  This feature bit me in an analysis not too long ago.  While I understand the reasons from an implementation point of view, <code>&quot;foo&quot; !== &quot;foo&quot;</code> just feels like it&#39;s more trouble on the support side than it&#39;s worth on the implementation side..."}, {"owner": {"reputation": 27400, "user_id": 659248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21aeae1f260365557523718bc19640f7?s=128&d=identicon&r=PG", "display_name": "StefanKarpinski", "link": "https://stackoverflow.com/users/659248/stefankarpinski"}, "reply_to_user": {"reputation": 3063, "user_id": 5075720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-kNyMGvaELDs/AAAAAAAAAAI/AAAAAAAAVnw/P1Rt8TFE2gc/photo.jpg?sz=128", "display_name": "PaSTE", "link": "https://stackoverflow.com/users/5075720/paste"}, "edited": false, "score": 0, "creation_date": 1496439548, "post_id": 44333559, "comment_id": 75679495, "body": "Yes, it would be good to have <code>&quot;foo&quot; === &quot;foo&quot;</code>, but that goes hand-in-hand with making Strings genuinely immutable, which is currently not the case. Otherwise you&#39;re just making up the meaning of <code>===</code> which is not ok."}], "tags": [], "owner": {"reputation": 27400, "user_id": 659248, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/21aeae1f260365557523718bc19640f7?s=128&d=identicon&r=PG", "display_name": "StefanKarpinski", "link": "https://stackoverflow.com/users/659248/stefankarpinski"}, "is_accepted": false, "score": 3, "last_activity_date": 1496440072, "last_edit_date": 1496440072, "creation_date": 1496420936, "answer_id": 44333559, "question_id": 44324800, "link": "https://stackoverflow.com/questions/44324800/how-to-use-haskey-and-in-functions-with-complex-dictionnary-keys-in-julia/44333559#44333559", "title": "How to use haskey() and in() functions with complex dictionnary keys in Julia?", "body": "<p>There are lots of good answers here, I'd just like to add a subtlety: this is partly because <code>==</code> calls <code>===</code> rather than recursively calling <code>==</code> when checking for structural equality, and partly because equal (<code>==</code>) strings are not generally identical (<code>===</code>) currently. Specifically, the fact that <code>MyT(\"foo\", 1) != MyT(\"foo\", 1)</code> is because <code>\"foo\" !== \"foo\"</code>.</p>\n\n<p>Strings are only \"immutable by convention\" \u2013\u00a0they are technically mutable, but Julia doesn't expose APIs for mutating them and encourages you not to mutate them. You can, however, access their underlying bytes and mutate that, which allows you to write a program that distinguishes two strings by getting by mutating one and not the other. That means that they cannot be <code>===</code> in the sense of Henry Baker's <a href=\"http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.23.9999\" rel=\"nofollow noreferrer\">\"EGAL\" predicate</a> (also <a href=\"http://home.pipeline.com/~hbaker1/ObjectIdentity.html\" rel=\"nofollow noreferrer\">here</a>). If you have an immutable type with only \"primitive\" type fields, then this does not happen:</p>\n\n<pre><code>julia&gt; immutable MyT2 # `struct MyT2` in 0.6\n           A::Float64\n           B::Int\n       end\n\njulia&gt; x = MyT2(1, 1)\nMyT2(1.0, 1)\n\njulia&gt; y = MyT2(1, 1)\nMyT2(1.0, 1)\n\njulia&gt; x == y\ntrue\n\njulia&gt; x === y\ntrue\n</code></pre>\n\n<p>I have <a href=\"https://github.com/JuliaLang/julia/issues/4648\" rel=\"nofollow noreferrer\">already proposed</a> that we change this and have <code>==</code> recursively call <code>==</code>. This should be fixed, someone just needs to do the work. Moreover, in Julia 1.0 we could make Strings truly immutable rather than merely immutable by convention, and therefore have <code>\"foo\" === \"foo\"</code> be true. I've created <a href=\"https://github.com/JuliaLang/julia/issues/22193\" rel=\"nofollow noreferrer\">an issue</a> to discuss and track this change.</p>\n"}], "owner": {"reputation": 375, "user_id": 6056789, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/d8bfd94f1b34ad9b1f3bbc5acca74ca5?s=128&d=identicon&r=PG&f=1", "display_name": "Fred", "link": "https://stackoverflow.com/users/6056789/fred"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 531, "favorite_count": 1, "accepted_answer_id": 44331242, "answer_count": 4, "score": 3, "last_activity_date": 1496440072, "creation_date": 1496393957, "last_edit_date": 1496413265, "question_id": 44324800, "link": "https://stackoverflow.com/questions/44324800/how-to-use-haskey-and-in-functions-with-complex-dictionnary-keys-in-julia", "title": "How to use haskey() and in() functions with complex dictionnary keys in Julia?", "body": "<p>haskey() and in() functions are very useful to test the content of dictionaries in Julia :</p>\n\n<pre><code>julia&gt; dict = Dict(\"a\" =&gt; 1, \"b\" =&gt; 2, \"c\" =&gt; 3, \"d\" =&gt; 4, \"e\" =&gt; 5)\nDict{String,Int64} with 5 entries:\n  \"c\" =&gt; 3\n  \"e\" =&gt; 5\n  \"b\" =&gt; 2\n  \"a\" =&gt; 1\n  \"d\" =&gt; 4\n\njulia&gt; haskey(dict, \"a\")\ntrue\n\njulia&gt; in((\"a\" =&gt; 1), dict)\ntrue\n</code></pre>\n\n<p>but I was surprised by their behavior with complex keys :</p>\n\n<pre><code>julia&gt; immutable MyT\n           A::String\n           B::Int64\n       end\n\njulia&gt; a = Dict(MyT(\"Tom\",191)=&gt;1,MyT(\"Bob\",20)=&gt;1,MyT(\"Jo\",315)=&gt;1,MyT(\"Luc\",493)=&gt;1)\nDict{MyT,Int64} with 4 entries:\n  MyT(\"Tom\",191) =&gt; 1\n  MyT(\"Jo\",315)  =&gt; 1\n  MyT(\"Bob\",20)  =&gt; 1\n  MyT(\"Luc\",493) =&gt; 1\n\njulia&gt; keys(a)\nBase.KeyIterator for a Dict{MyT,Int64} with 4 entries. Keys:\n  MyT(\"Tom\",191)\n  MyT(\"Jo\",315)\n  MyT(\"Bob\",20)\n  MyT(\"Luc\",493)\n\njulia&gt; haskey(a, MyT(\"Tom\",191))\nfalse\n\njulia&gt; in((MyT(\"Tom\",191) =&gt; 1), a)\nfalse\n</code></pre>\n\n<p>What I did wrong ?\nThank you very much for your comments !</p>\n\n<p>Thanks to @Michael K. Borregaard, I can propose this solution :</p>\n\n<pre><code>a = Dict{MyT, Int64}()\n\nkeyArray = Array{MyT,1}()\nkeyArray = [MyT(\"Tom\",191),MyT(\"Bob\",20),MyT(\"Jo\",315),MyT(\"Luc\",493)]\n\nfor i in keyArray\n    a[i] = 1\nend\n\nprintln(a)\n# Dict(MyT(\"Tom\",191)=&gt;1,MyT(\"Tom\",191)=&gt;1,MyT(\"Luc\",493)=&gt;1,MyT(\"Jo\",315)=&gt;1,MyT(\"Luc\",493)=&gt;1,MyT(\"Bob\",20)=&gt;1,MyT(\"Jo\",315)=&gt;1,MyT(\"Bob\",20)=&gt;1)\n\nkeyArray[1]            # MyT(\"Tom\",191)\nhaskey(a, keyArray[1]) # true\n</code></pre>\n\n<p>But I have to store keys in a separate array. This means that can't warranty the unicity of the keys which is the strength of the dictionaries and why I choose to use it :(</p>\n\n<p>So I have to use another step :</p>\n\n<pre><code>unique(keyArray)\n</code></pre>\n\n<p>Another better solution :</p>\n\n<pre><code>function CompareKeys(k1::MyT, k2::MyT)\n    if k1.A == k2.A &amp;&amp;  k1.B == k2.B\n        return true\n    else \n        return false\n    end\nend\n\nfunction ExistKey(k::MyT, d::Dict{MyT, Int64})\n    for i in keys(d)\n        if CompareKeys(k, i)\n            return true\n        end\n    end\n    return false\nend\n\na = Dict(MyT(\"Tom\",191)=&gt;1,MyT(\"Bob\",20)=&gt;1,MyT(\"Jo\",315)=&gt;1,MyT(\"Luc\",493)=&gt;1)\n\nExistKey(MyT(\"Tom\",192),a) # false\n\nExistKey(MyT(\"Tom\",191),a) # true\n</code></pre>\n\n<p>Compared to Julia, Go is more straightforward for this problem :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyT struct {\n    A string\n    B int\n}\n\nfunc main() {\n\n    dic := map[MyT]int{MyT{\"Bob\", 10}: 1, MyT{\"Jo\", 21}: 1}\n\n    if _, ok := dic[MyT{\"Bob\", 10}]; ok {\n        fmt.Println(\"key exists\")\n    }\n}\n// answer is \"key exists\"\n</code></pre>\n"}]