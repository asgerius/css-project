[{"tags": ["go", "struct", "slice"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1532563904, "post_id": 51529220, "comment_id": 90026852, "body": "Try using a map: <a href=\"https://play.golang.org/p/Vb9lX2y275a\" rel=\"nofollow noreferrer\">play.golang.org/p/Vb9lX2y275a</a>"}], "answers": [{"comments": [{"owner": {"reputation": 513, "user_id": 3455715, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/vdJ4y.jpg?s=128&g=1", "display_name": "Pavarine", "link": "https://stackoverflow.com/users/3455715/pavarine"}, "edited": false, "score": 0, "creation_date": 1532577799, "post_id": 51529485, "comment_id": 90029459, "body": "Can I assume that &quot;looking&quot; a key in a map is a O(1) in terms of computational complexity?"}, {"owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "reply_to_user": {"reputation": 513, "user_id": 3455715, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/vdJ4y.jpg?s=128&g=1", "display_name": "Pavarine", "link": "https://stackoverflow.com/users/3455715/pavarine"}, "edited": false, "score": 0, "creation_date": 1532579000, "post_id": 51529485, "comment_id": 90029743, "body": "@Pavarine The <a href=\"https://stackoverflow.com/q/29677670/479863\">spec</a> doesn&#39;t guarantee that but you should be safe in assuming that it is a sensible implementation (i.e. amortized O(1))."}, {"owner": {"reputation": 513, "user_id": 3455715, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/vdJ4y.jpg?s=128&g=1", "display_name": "Pavarine", "link": "https://stackoverflow.com/users/3455715/pavarine"}, "edited": false, "score": 0, "creation_date": 1532579848, "post_id": 51529485, "comment_id": 90029937, "body": "Thank you for the insights, were very clarifyng, I picked the structs solution cause I tought it would be more performatic, even with the linear searchs ( I came from a naive C background), but now I intend to go with the map solution as it looks to be more efficient. Thanks"}], "tags": [], "owner": {"reputation": 394580, "user_id": 479863, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ArUCE.jpg?s=128&g=1", "display_name": "mu is too short", "link": "https://stackoverflow.com/users/479863/mu-is-too-short"}, "is_accepted": true, "score": 3, "last_activity_date": 1532566027, "creation_date": 1532566027, "answer_id": 51529485, "question_id": 51529220, "link": "https://stackoverflow.com/questions/51529220/golang-append-to-nested-slice/51529485#51529485", "title": "GoLang append to nested slice", "body": "<p>Your problem is that this:</p>\n\n<pre><code>for _ , queue := range T.Queues {\n</code></pre>\n\n<p>copies values from <code>T.Queues</code> into <code>queue</code>, then you take the address of that copy:</p>\n\n<pre><code>cur_queue = &amp;queue\n</code></pre>\n\n<p>and end up modifying the copy while leaving the <code>Queue</code> in the <code>T.Queues</code> slice alone.</p>\n\n<p>An easy solution would be to use the <code>for i := range ...</code> form of the loop and take the address of the <code>Queue</code> in the slice rather than the copy:</p>\n\n<pre><code>for i := range T.Queues {\n    if T.Queues[i].Name == queue_name {\n        found_queue = true\n        cur_queue = &amp;T.Queues[i]\n    }\n}\n</code></pre>\n\n<p>You could also use a slice of pointers and go back to your</p>\n\n<pre><code>for _ , queue := range T.Queues {\n</code></pre>\n\n<p>loop with <code>queue</code> already being a pointer.</p>\n\n<p>You might want to <code>break</code> out of the loop early once you've found something. If <code>T.Queues</code> is expected to be large you might want to switch to a map so that you don't have so many linear searches.</p>\n"}], "owner": {"reputation": 513, "user_id": 3455715, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/vdJ4y.jpg?s=128&g=1", "display_name": "Pavarine", "link": "https://stackoverflow.com/users/3455715/pavarine"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 841, "favorite_count": 0, "accepted_answer_id": 51529485, "answer_count": 1, "score": 2, "last_activity_date": 1532566027, "creation_date": 1532563057, "question_id": 51529220, "link": "https://stackoverflow.com/questions/51529220/golang-append-to-nested-slice", "title": "GoLang append to nested slice", "body": "<p>In GoLang, having the following structs and methods, I'm trying to append to a slice that belongs to a struct that is nested in another struct:</p>\n\n<pre><code>/* Tiers agent struct */\ntype Agent struct {\n    Registration string\n}\n\n/* Tiers queue struct */\ntype Queue struct {\n    Name string\n    Agents []Agent\n}\n\n/* Tiers struct */\ntype Tiers struct {\n    Queues []Queue\n}\n\nfunc (Q *Queue) AddAgent (agent_registration string) {\n\n    Q.Agents = append(Q.Agents, Agent{Registration: agent_registration})\n}\n\nfunc (T *Tiers) AddQueue(queue_name string, agent_registration string) {\n\n    var cur_queue *Queue\n\n    found_queue := false\n\n    /* Find queue by queue name */\n    for _ , queue := range T.Queues {\n        if queue.Name == queue_name {\n            found_queue = true\n            cur_queue = &amp;queue\n        }\n    }\n\n    /* If queue not found, create a new one */\n    if found_queue == false {\n        T.Queues = append(T.Queues, Queue{Name: queue_name})\n        cur_queue = &amp;(T.Queues[len(T.Queues)-1])\n    }\n\n    /* Add agent to queue (add tier) */\n    cur_queue.AddAgent(agent_registration)\n}\n</code></pre>\n\n<p>My business rule is that I'll receive lots of {queue_name, agent_name} pairs and I want to build a structure that groups all agents that shares the same 'queue_name'. So, in the end of day I want something like:</p>\n\n<p>Queue1: ['agent1', 'agent2', 'agent3', ...]\nQueue2: ['agent4', 'agent5', ...]</p>\n\n<p>I'm modeling this using the structs I've mentioned above. The problem is when I try to add agents to a queue only the last insertion persists. Example:</p>\n\n<pre><code>tiers.AddQueue('suport@default', '1000@default')\ntiers.AddQueue('suport@default', '1003@default')\ntiers.AddQueue('suport@default', '1001@default')\n</code></pre>\n\n<blockquote>\n  <p>Output: {[{support@default [{1001@default}]}]}</p>\n</blockquote>\n\n<p>When what I want is that the output be:</p>\n\n<blockquote>\n  <blockquote>\n    <p>Output: {[{support@default [{1000@default},{1003@default}, {1001@default}]}]}</p>\n  </blockquote>\n</blockquote>\n"}, {"tags": ["unit-testing", "testing", "go", "terraform"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532560866, "post_id": 51528928, "comment_id": 90026261, "body": "It looks straightforward, you&#39;re using <code>github.com&#47;stretchr&#47;testify&#47;assert</code> but you haven&#39;t installed it."}, {"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 1, "creation_date": 1532568336, "post_id": 51528928, "comment_id": 90027633, "body": "read up on <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a>"}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 1060312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4d5d27408ca3354ee9366bb984973e0c?s=128&d=identicon&r=PG&f=1", "display_name": "ItsNannerpuss", "link": "https://stackoverflow.com/users/1060312/itsnannerpuss"}, "is_accepted": true, "score": 0, "last_activity_date": 1532571983, "creation_date": 1532571983, "answer_id": 51530122, "question_id": 51528928, "link": "https://stackoverflow.com/questions/51528928/no-able-to-run-go-test-program-after-installing-go-lang/51530122#51530122", "title": "no able to run go test program after installing go lang", "body": "<p>Have you run <em>go get</em> to pull the dependency down into the path?</p>\n\n<pre><code>go get github.com/stretchr/testify/assert\n</code></pre>\n"}], "owner": {"reputation": 468, "user_id": 6105932, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/AIY7t.jpg?s=128&g=1", "display_name": "Rajkumar Purushothaman", "link": "https://stackoverflow.com/users/6105932/rajkumar-purushothaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 475, "favorite_count": 0, "accepted_answer_id": 51530122, "answer_count": 1, "score": -1, "last_activity_date": 1532571983, "creation_date": 1532560623, "question_id": 51528928, "link": "https://stackoverflow.com/questions/51528928/no-able-to-run-go-test-program-after-installing-go-lang", "title": "no able to run go test program after installing go lang", "body": "<p>I am getting the below error when trying to run a test written in Go. I have Golang and dep installed. I am new to Go and I am not sure what the issue is here.. Can someone please help me out?</p>\n\n<pre><code>xxxx-dxxxx:test xxxx$ go test\n# _/Users/xxxx/dev/xxxx/test/xxxx/test\napplication_cluster_test.go:10:2: cannot find package \"github.com/stretchr/testify/assert\" in any of:\n        /usr/local/Cellar/go/1.10.3/libexec/src/github.com/stretchr/testify/assert (from $GOROOT)\n        /Users/xxxx/go/src/github.com/stretchr/testify/assert (from $GOPATH)\nFAIL    _/Users/xxxx/dev/xxxx/test/xxxx/test [setup failed]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1532557869, "post_id": 51528468, "comment_id": 90025614, "body": "Assuming <code>s</code> is reflect.Value of an instance of <code>SomeType</code>, <code>s.Field(g).Field(0).Interface()</code> returns the value of the first (0th) field of those NullXxx struct types. E.g. <a href=\"https://play.golang.org/p/y4LFn2KJko3\" rel=\"nofollow noreferrer\">play.golang.org/p/y4LFn2KJko3</a>"}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1532558054, "post_id": 51528468, "comment_id": 90025649, "body": "Usually I&#39;d expect to see code more directly unmarshal into <code>SomeType</code>, and not use reflection at all.  Can you show a little bit more of the code; in particular where <code>s</code> comes from and how it relates to <code>SomeType</code>?"}, {"owner": {"reputation": 1169, "user_id": 879889, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/wLsC6.png?s=128&g=1", "display_name": "iamtoc", "link": "https://stackoverflow.com/users/879889/iamtoc"}, "edited": false, "score": 0, "creation_date": 1532558658, "post_id": 51528468, "comment_id": 90025781, "body": "mkopriva, ... .Field(0).Interface() worked nice! Exactly what I was looking for! Thank you. If you post it, I&#39;ll mark it as answered."}], "owner": {"reputation": 1169, "user_id": 879889, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/wLsC6.png?s=128&g=1", "display_name": "iamtoc", "link": "https://stackoverflow.com/users/879889/iamtoc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 119, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532557943, "creation_date": 1532557243, "last_edit_date": 1532557943, "question_id": 51528468, "link": "https://stackoverflow.com/questions/51528468/golang-dynamic-type-conversion", "title": "golang Dynamic Type Conversion", "body": "<p>From a snippet (not comprehensively functional here):   </p>\n\n<pre><code>type SomeType struct {\n    UserEmail   sql.NullString    `db:\"user_email\"`\n    RecID       sql.NullInt64     `db:\"rec_id\"`\n}\n\nfor g := 0; g &lt; s.NumField(); g++ {\n   f := s.Field(g)\n   tType = f.Type().String()\n\n   tType = strings.Replace(tType, `sql.Null`, ``, 1)\n   tType = strings.Replace(tType, `mysql.Null`, ``, 1)\n   tType = strings.Replace(tType, `decimal.NullDecimal`, `Decimal`, 1)\n   tType = strings.Replace(tType, `myTime`, `Time`, 1)\n\n   fmt.Println(g, typeOfT.Field(g).Name, tType, f)\n}\n</code></pre>\n\n<p>For normal output, I write UserEmail.String. If the .String is absent, then the output is:</p>\n\n<pre><code>   UserEmail String {johndoe@somecompany.com true}\n</code></pre>\n\n<p>How would I dynamically append the .String, or .Int64, depending on the data type, wherein that type extention actually functions to produce:</p>\n\n<pre><code>   UserEmail String johndoe@somecompany.com\n</code></pre>\n\n<p>Essentially turning the strings \"UserEmail\" and \"String\" into UserEmail.String</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "goroutine", "httprouter"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1532555441, "post_id": 51528137, "comment_id": 90024919, "body": "<i>&quot;How can I make the queue channel available to my request handler&quot;</i> by making it a global (not recommended), or by defining the handler as a struct and have the queue be a field of the struct, or using a closure."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 4, "creation_date": 1532555561, "post_id": 51528137, "comment_id": 90024949, "body": "<code>http.ListenAndServe</code> blocks until a server error occurs, and so all the code after it is idle, and will be executed only after http.ListenAndServe returns, therefore log.Printf is not executed."}, {"owner": {"reputation": 19550, "user_id": 2332336, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/FN0J5.jpg?s=128&g=1", "display_name": "Latheesan", "link": "https://stackoverflow.com/users/2332336/latheesan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532555631, "post_id": 51528137, "comment_id": 90024970, "body": "@mkopriva that makes sense. So, if i want to do simple debug output, what&#39;s the best method?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532555927, "post_id": 51528137, "comment_id": 90025075, "body": "Move your queue code above http.ListenAndServe."}, {"owner": {"reputation": 19550, "user_id": 2332336, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/FN0J5.jpg?s=128&g=1", "display_name": "Latheesan", "link": "https://stackoverflow.com/users/2332336/latheesan"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532556184, "post_id": 51528137, "comment_id": 90025157, "body": "@mkopriva I have tried that and still not getting anything in the stdout from <code>log.Printf()</code> call"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532556671, "post_id": 51528137, "comment_id": 90025314, "body": "Try moving the printf statement above listenandserve, if that doesn&#39;t output anything then try moving it all the way to the first line of the <code>main</code> func. If that doesn&#39;t work then that would suggest that some code you&#39;re not showing, maybe something you&#39;re importing is reseting the log package&#39;s default output. In which case remove that or overwrite it with <a href=\"https://golang.org/pkg/log/#SetOutput\" rel=\"nofollow noreferrer\">golang.org/pkg/log/#SetOutput</a> passing os.Stdout as the argument."}], "answers": [{"tags": [], "owner": {"reputation": 122, "user_id": 3585147, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/08d38063a2f4d4f0525fc071d4d0ea11?s=128&d=identicon&r=PG&f=1", "display_name": "DarkPhoton", "link": "https://stackoverflow.com/users/3585147/darkphoton"}, "is_accepted": true, "score": 1, "last_activity_date": 1532557687, "creation_date": 1532557687, "answer_id": 51528541, "question_id": 51528137, "link": "https://stackoverflow.com/questions/51528137/working-with-goroutine-in-a-rest-api-getting-undefined-error/51528541#51528541", "title": "Working with goroutine in a rest api - getting undefined error", "body": "<p>Couple of things are wrong, first your main function is not ordered correctly, you want to initialize you channel and start workers before you run <code>err := http.ListenAndServe(apiServerPort, r)</code> so something like this</p>\n\n<pre><code>func main() {\n    var queueSize = 10\n    queue := make(ActionQueue, queueSize)\n    for i := 0; i &lt; queueSize; i++ {\n        go worker(queue)\n    }\n    log.Printf(\"Started %d queue workers\", queueSize)\n\n    // routers and stuff...\n}\n</code></pre>\n\n<p>Then <code>queue</code> variable is not defined in the <code>test()</code> function, which is why you are getting <code>./main.go:46:2: undefined: queue</code>. You could fix it with a higher order function e.g.</p>\n\n<pre><code>func test(queue ActionQueue) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n        successResponse(w, http.StatusOK, \"Hello World\")\n        queue &lt;- func() {\n            log.Println(\"Hello from queue worker, initiated by api call\")\n        }\n    }\n}\n</code></pre>\n\n<p>and then just bind it to the route with <code>r.GET(\"/test\", test(queue))</code></p>\n"}], "owner": {"reputation": 19550, "user_id": 2332336, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/FN0J5.jpg?s=128&g=1", "display_name": "Latheesan", "link": "https://stackoverflow.com/users/2332336/latheesan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 402, "favorite_count": 0, "accepted_answer_id": 51528541, "answer_count": 1, "score": 0, "last_activity_date": 1532557687, "creation_date": 1532555141, "question_id": 51528137, "link": "https://stackoverflow.com/questions/51528137/working-with-goroutine-in-a-rest-api-getting-undefined-error", "title": "Working with goroutine in a rest api - getting undefined error", "body": "<p>I am learning GO and wanted to make a simple rest API.</p>\n\n<p>What I want to do is fire off a goroutine after handling the api request and do the work asynchronously in the background.</p>\n\n<p>Here's my implementation so far:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/julienschmidt/httprouter\"\n)\n\n// APIResponse represents common structure of every api call response\ntype APIResponse struct {\n    Status string `json:\"status\"`\n    Error  string `json:\"error,omitempty\"`\n    Data   string `json:\"data,omitempty\"`\n}\n\n// Action represents what could be passed to the goroutine\ntype Action = func()\n\n// ActionQueue represents a buffered channel\ntype ActionQueue = chan Action\n\nfunc main() {\n    r := httprouter.New()\n    r.GET(\"/test\", test)\n\n    var apiServerPort = \":80\"\n    err := http.ListenAndServe(apiServerPort, r)\n    if err != nil {\n        log.Fatal(\"ListenAndServe:\", err)\n    } else {\n        log.Printf(\"Started server on port %s\", apiServerPort)\n    }\n\n    var queueSize = 10\n    queue := make(ActionQueue, queueSize)\n    for i := 0; i &lt; queueSize; i++ {\n        go worker(queue)\n    }\n    log.Printf(\"Started %d queue workers\", queueSize)\n}\n\nfunc test(w http.ResponseWriter, r *http.Request, p httprouter.Params) {\n    successResponse(w, http.StatusOK, \"Hello World\")\n    queue &lt;- func() {\n        log.Println(\"Hello from queue worker, initiated by api call\")\n    }\n}\n\nfunc successResponse(w http.ResponseWriter, statusCode int, successData string) {\n    sendResponse(w, statusCode, \"\", successData)\n}\n\nfunc errorResponse(w http.ResponseWriter, statusCode int, errorData string) {\n    sendResponse(w, statusCode, errorData, \"\")\n}\n\nfunc sendResponse(w http.ResponseWriter, statusCode int, errorData string, responseData string) {\n    w.WriteHeader(statusCode)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    json.NewEncoder(w).Encode(&amp;APIResponse{Status: http.StatusText(statusCode), Error: errorData, Data: responseData})\n}\n\nfunc worker(queue ActionQueue) {\n    for action := range queue {\n        action()\n    }\n}\n</code></pre>\n\n<p>When I try to run this code, I am getting the following error (on this line <code>queue &lt;- func() { ... }</code>):</p>\n\n<blockquote>\n  <p>./main.go:46:2: undefined: queue</p>\n</blockquote>\n\n<p>How can I make the <code>queue</code> channel available to my request handler (i.e. httprouter GET request handler func)?</p>\n\n<p>Secondly, I cannot see the output from my <code>log.Printf()</code> calls in the console output (stdout), e.g. server status message when the app runs. Any ideas why?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532555258, "post_id": 51528092, "comment_id": 90024854, "body": "When you try <code>curl</code> do you see the same thing as in postman or as in Go?"}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532555790, "post_id": 51528092, "comment_id": 90025030, "body": "@mkopriva I do see. For some reason I&#39;m getting a lot of PHPSESSID from the server, but since I don&#39;t have control over the server, I&#39;m just worried about the <code>au</code> cookie."}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532556514, "post_id": 51528092, "comment_id": 90025268, "body": "Sorry, I do see the same thing as in Postman. I can see the <code>Set-Cookie: au=&lt;AUTH_TOKEN&gt;; expires=Wed, 08-Aug-2018 21:55:25 GMT; path=&#47;</code> when <code>curl</code> in verbose mode."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532557067, "post_id": 51528092, "comment_id": 90025421, "body": "In Go if you do <code>log.Println(resp.Header[&quot;Set-Cookie&quot;])</code> is the <code>au</code> there?"}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532557175, "post_id": 51528092, "comment_id": 90025451, "body": "No, it only shows <code>2018&#47;07&#47;26 00:18:37 [PHPSESSID=&lt;PHP_TOKEN&gt;; path=&#47;; HttpOnly]</code>."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532558306, "post_id": 51528092, "comment_id": 90025703, "body": "I&#39;m out of ideas in that case."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532577781, "post_id": 51528092, "comment_id": 90029451, "body": "Are you sure that username and password are correct? Perhaps the login just doesn&#39;t succeed. Have you checked that the body is as expected?"}, {"owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "edited": false, "score": 0, "creation_date": 1532595089, "post_id": 51528092, "comment_id": 90037128, "body": "I&#39;m completely sure. Today I saw the <code>au</code> cookie doesn&#39;t have the <code>HttpOnly</code> field. This might be related."}], "answers": [{"tags": [], "owner": {"reputation": 1813, "user_id": 510850, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/oS3Cn.png?s=128&g=1", "display_name": "&#193;lvaro Guimar&#227;es", "link": "https://stackoverflow.com/users/510850/%c3%81lvaro-guimar%c3%a3es"}, "is_accepted": true, "score": 1, "last_activity_date": 1532606995, "creation_date": 1532606995, "answer_id": 51538537, "question_id": 51528092, "link": "https://stackoverflow.com/questions/51528092/golang-http-postparam-not-showing-all-cookies-in-the-response/51538537#51538537", "title": "Golang http.PostParam not showing all Cookies in the Response", "body": "<p>You probably have an HTTP redirection (302 or 301).</p>\n\n<p>Try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n)\n\nfunc main() {\n    params := url.Values{}\n    params.Add(\"data[User][username]\", \"test\")\n    params.Add(\"data[User][password]\", \"test\")\n\n    client := &amp;http.Client{\n        CheckRedirect: func(req *http.Request, via []*http.Request) error {\n            return http.ErrUseLastResponse\n        },\n    }\n    resp, err := client.PostForm(\"http://example.com\", params)\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(resp.Cookies())\n}\n</code></pre>\n\n<p>In the overview of the net/http package <a href=\"https://golang.org/pkg/net/http/#pkg-overview\" rel=\"nofollow noreferrer\">documentation</a> you have an example on how to control the redirection policy.</p>\n\n<p>Good luck.</p>\n"}], "owner": {"reputation": 543, "user_id": 2526070, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/9c144ba38a87cf2ce8493c71eee66518?s=128&d=identicon&r=PG", "display_name": "Lucas Beier", "link": "https://stackoverflow.com/users/2526070/lucas-beier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 331, "favorite_count": 1, "accepted_answer_id": 51538537, "answer_count": 1, "score": 1, "last_activity_date": 1532606995, "creation_date": 1532554879, "question_id": 51528092, "link": "https://stackoverflow.com/questions/51528092/golang-http-postparam-not-showing-all-cookies-in-the-response", "title": "Golang http.PostParam not showing all Cookies in the Response", "body": "<p>I'm studying Golang and I'm trying to reach an endpoint (which I don't have control).</p>\n\n<p>That's the code I wrote:</p>\n\n<pre><code>params := url.Values{}\nparams.Add(\"data[User][username]\", &lt;THE_USERNAME&gt;)\nparams.Add(\"data[User][password]\", &lt;THE_PASSWORD&gt;)\nresp, _ := http.PostForm(&lt;LOGIN_URL&gt;, params)\n\nfmt.Println(resp.Cookies())\n</code></pre>\n\n<p>The <code>Println</code> prints <code>[PHPSESSID=&lt;ID&gt;; Path=/; HttpOnly]</code>.</p>\n\n<p>When doing the same request in Postman</p>\n\n<pre><code>POST /login HTTP/1.1\nHost: &lt;HOST&gt;\nContent-Type: application/x-www-form-urlencoded\nCache-Control: no-cache\nPostman-Token: 399a42af-00f2-4340-b7fa-1ae1fa295b62\n\n&lt;PARAM_DATA&gt;\n</code></pre>\n\n<p>I can see two cookies being set in the response, the <code>PHPSESSID</code> (which I guess is the same in Golang) and <code>au</code> (which is the token I need in order to authenticate against the server).</p>\n\n<p>I'm not sure what I'm doing wrong and why I cannot see the <code>au</code> Cookie when calling the endpoint using the Golang code.</p>\n\n<p>Any guess?</p>\n"}, {"tags": ["ubuntu", "go", "gopath"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532553601, "post_id": 51527786, "comment_id": 90024259, "body": "judging by the error, there&#39;s no files in those directories. Are they empty? Did you fetch them with <code>go get</code>?"}, {"owner": {"reputation": 311, "user_id": 10124213, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YVAWMvreu5w/AAAAAAAAAAI/AAAAAAAAAJI/HVpKcyNDj7k/photo.jpg?sz=128", "display_name": "P A S H", "link": "https://stackoverflow.com/users/10124213/p-a-s-h"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532553915, "post_id": 51527786, "comment_id": 90024370, "body": "@JimB I cloned the files straight from my existing repo that works on my local machine. Those directories definitely have many .go files in them"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532555116, "post_id": 51527786, "comment_id": 90024801, "body": "So what is your GOPATH set to? And what is actually in that directory?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532555116, "post_id": 51527786, "comment_id": 90024803, "body": "Is GOPATH in your repo? If so, are you sure they&#39;re checked in, because each of those packages would normally be it&#39;s own git repo, in order for <code>go get</code> to work."}], "owner": {"reputation": 311, "user_id": 10124213, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YVAWMvreu5w/AAAAAAAAAAI/AAAAAAAAAJI/HVpKcyNDj7k/photo.jpg?sz=128", "display_name": "P A S H", "link": "https://stackoverflow.com/users/10124213/p-a-s-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 411, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1532613826, "creation_date": 1532553415, "last_edit_date": 1532613826, "question_id": 51527786, "link": "https://stackoverflow.com/questions/51527786/no-buildable-go-source-files-when-attempting-to-go-get", "title": "No buildable Go Source Files when attempting to go get", "body": "<p>I'm in the process of deploying my go fileserver on an ubuntu server, but when I run go get cms-web-server from my $GOPATH directory, I get the following error:</p>\n\n<pre><code>src/cms-web-server/main.go:18:2: no buildable Go source files in $GOPATH/src/github.com/codegangsta/negroni\nsrc/cms-web-server/main.go:19:2: no buildable Go source files in $GOPATH/src/github.com/gorilla/mux\nsrc/cms-web-server/main.go:14:6: no buildable Go source files in $GOPATH/src/github.com/mattn/go-sqlite3\n</code></pre>\n\n<p>It's weird because it seems like my GOPATH is set correctly. Could there be issues with the packages I'm using?</p>\n"}, {"tags": ["go", "system-calls", "mmap"], "comments": [{"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1532550019, "post_id": 51526913, "comment_id": 90022651, "body": "Another process is writing into the virtual memory of your process? That&#39;s not normally possible. I think you are misunderstanding what the <code>mmap</code> syscall does."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "edited": false, "score": 0, "creation_date": 1532550760, "post_id": 51526913, "comment_id": 90022988, "body": "@MarcoBonelli: <code>MAP_SHARED</code> allows sharing between processes. From the <code>mmap</code> man page: <code>Updates to the mapping are visible to other processes mapping the same region</code>"}, {"owner": {"reputation": 47633, "user_id": 3889449, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/eb07e0f09deb982a1a0deedca7a5c002?s=128&d=identicon&r=PG", "display_name": "Marco Bonelli", "link": "https://stackoverflow.com/users/3889449/marco-bonelli"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532552907, "post_id": 51526913, "comment_id": 90023969, "body": "@JimB oh, that&#39;s my bad, didn&#39;t know about <code>MAP_SHARED</code>, thank you for the information."}], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 2, "last_activity_date": 1532552162, "last_edit_date": 1532552162, "creation_date": 1532551720, "answer_id": 51527425, "question_id": 51526913, "link": "https://stackoverflow.com/questions/51526913/read-a-growing-mmap-file-in-go/51527425#51527425", "title": "Read a growing mmap file in Go", "body": "<p><code>syscall.Mmap()</code> is just a thin wrapper over C <code>mmap(2)</code> so it will behave the same. The memory region you get back can be updated by other processes if you've used the <code>syscall.MAP_SHARED</code> flag (and the other process did too). You don't have to do anything else except remember to call <code>syscall.Munmap()</code> when you're finished. It's probably a good candidate for <code>defer</code>ing, depending on what you're doing.</p>\n\n<p>But, if someone is writing to the shared space and growing it beyond the region you mapped, then you'll have to map it again. It doesn't resize itself automatically.</p>\n"}], "owner": {"reputation": 435, "user_id": 10061533, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-Fv61VUShbCs/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rTOnJlSCJr_asOOUez6u2WFiAdCQ/mo/photo.jpg?sz=128", "display_name": "Cubey Mew", "link": "https://stackoverflow.com/users/10061533/cubey-mew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532552162, "creation_date": 1532549368, "question_id": 51526913, "link": "https://stackoverflow.com/questions/51526913/read-a-growing-mmap-file-in-go", "title": "Read a growing mmap file in Go", "body": "<p>I want to read a mmap file in golang.</p>\n\n<p>Another process is writing things into it so its size is growing while reading.</p>\n\n<p>I am using</p>\n\n<pre><code>syscall.Mmap(fd int, offset int64, length int, prot int, flags int)\n</code></pre>\n\n<p>which will return a byte array.</p>\n\n<p>Do I need to keep doing <code>syscall.Mmap</code> to read the updated mmap? Any better way?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1532548628, "post_id": 51526637, "comment_id": 90022022, "body": "You should pass a pointer func groupRules(validationRules *[]string)"}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1532548806, "post_id": 51526637, "comment_id": 90022111, "body": "@Uvelichitel I don&#39;t think so. You dont need to pass a pointer when sending a slice since it gets deferred by default. Also, as I commented on my note, if I to_be_added is a string instead of a []string it works perfectly"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532548982, "post_id": 51526637, "comment_id": 90022197, "body": "@MatiasBarrios: slices are values like everything else, and if you want to modify the argument you need a pointer to it. You can overwrite values within the slice, but the slice value is only a copy."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1532548989, "post_id": 51526637, "comment_id": 90022200, "body": "Use the same approach <code>append</code> does, return the new slice and reassign it to the original variable."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532549188, "post_id": 51526637, "comment_id": 90022299, "body": "@JimB I actually tried using a pointer. Here is the reason why I cannot and should not : <a href=\"https://stackoverflow.com/questions/21278023/golang-cannot-range-over-pointer-to-slice\" title=\"golang cannot range over pointer to slice\">stackoverflow.com/questions/21278023/&hellip;</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532549958, "post_id": 51526637, "comment_id": 90022619, "body": "@MatiasBarrios: that&#39;s not relevant here. Appending to an array modifies it, so you need a pointer in order for that to be reflected outside the function."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532550436, "post_id": 51526637, "comment_id": 90022844, "body": "<a href=\"https://play.golang.org/p/E_1GH6r4f87\" rel=\"nofollow noreferrer\">play.golang.org/p/E_1GH6r4f87</a>"}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532550666, "post_id": 51526637, "comment_id": 90022940, "body": "@mkopriva Check this : <a href=\"https://play.golang.org/p/rTlrh_SbKkK\" rel=\"nofollow noreferrer\">play.golang.org/p/rTlrh_SbKkK</a> . As soon as I try to slice one of those pointers, it fails. And I need to split the slice in order to accomplish this. Thats why I am insisting in that I cannot use this approach. If you can somehow modify my code using pointers and getting it to work Ill slute you and admit I was wrong"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532550737, "post_id": 51526637, "comment_id": 90022967, "body": "<a href=\"https://play.golang.org/p/ZZKFwve1TNi\" rel=\"nofollow noreferrer\">play.golang.org/p/ZZKFwve1TNi</a> the <code>s[:]</code> is evaluated first, so Go thinks you&#39;re trying to slice a pointer, use parens to change the order of evaluation. Or do it in two steps <a href=\"https://play.golang.org/p/nmQPiPpwruW\" rel=\"nofollow noreferrer\">play.golang.org/p/nmQPiPpwruW</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532551532, "post_id": 51526637, "comment_id": 90023352, "body": "or do what most Go code does, and return the new slice rather than taking a pointer to a slice."}, {"owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532552087, "post_id": 51526637, "comment_id": 90023594, "body": "@JimB Nor the pointers or the &quot;just pass it&quot; worked. So I actually ended up doing exactly that and now it works."}], "answers": [{"tags": [], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "is_accepted": false, "score": 1, "last_activity_date": 1532552150, "creation_date": 1532552150, "answer_id": 51527504, "question_id": 51526637, "link": "https://stackoverflow.com/questions/51526637/replace-a-single-string-in-a-slice-for-a-group-of-strings/51527504#51527504", "title": "Replace a single string in a slice for a group of strings", "body": "<p>So, my lack of Go experience or the bad code I write lead me to this :</p>\n\n<pre><code>func groupRules(validationRules []string) []string{\n    var tmp_slice []string\n    for _ ,rulename := range validationRules {\n        if succeeded, to_be_added := translateRule(rulename) ; succeeded == true{\n            tmp_slice = append(tmp_slice,to_be_added...)\n        }else{\n            tmp_slice = append(tmp_slice,rulename)\n        }\n    }\n    return tmp_slice\n}\nfunc translateRule(rule string) ( bool , []string ) {\n    if rule == \"rs_full\" {\n        return true,[]string{\"sapo\",\"rana\",\"tigre\"}\n    }\n    return false,nil\n}\n</code></pre>\n\n<p>Now it works flawlessly.</p>\n\n<p>Thank you all.</p>\n"}], "owner": {"reputation": 3680, "user_id": 7723882, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/6aUwy.png?s=128&g=1", "display_name": "Matias Barrios", "link": "https://stackoverflow.com/users/7723882/matias-barrios"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1532613841, "creation_date": 1532548151, "last_edit_date": 1532613841, "question_id": 51526637, "link": "https://stackoverflow.com/questions/51526637/replace-a-single-string-in-a-slice-for-a-group-of-strings", "title": "Replace a single string in a slice for a group of strings", "body": "<p>I want to have a slice of strings, and when certain strings are found, they are replaced by a group of related strings.</p>\n\n<p>For instance, if I have this :</p>\n\n<pre><code>[]string{\"A\",\"FROM_B_TO_E\",\"F\"}\n</code></pre>\n\n<p>After my method runs I want to have :</p>\n\n<pre><code>[]string{\"A\",\"B\",\"C\",\"D\",\"E\",\"F\"}\n</code></pre>\n\n<p>I came up with this code, the thing is, although I can print my <strong>to_be_added</strong> slice just before actually adding it, for some reason it does not work. It does work however if I change my <strong>translateRule</strong> so instead of returning a slice of string it only returns a single string :</p>\n\n<pre><code>  func groupRules(validationRules []string){\n        for index,rulename := range validationRules {\n            if succeeded, to_be_added := translateRule(rulename) ; succeeded == true{\n                fmt.Println(\"Entro! \", to_be_added)\n                validationRules = append(append(validationRules[:index],to_be_added...), validationRules[index+1:]...)\n            }\n        }\n    }\n    func translateRule(rule string) ( bool , []string ) {\n        if rule == \"rs_full\" {\n            return true,[]string{\"sapo\",\"rana\"}\n        }\n        return false,nil\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 814, "user_id": 8229192, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/obcNu.jpg?s=128&g=1", "display_name": "FullStackDeveloper", "link": "https://stackoverflow.com/users/8229192/fullstackdeveloper"}, "edited": false, "score": 0, "creation_date": 1532547407, "post_id": 51526409, "comment_id": 90021499, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/35130116/golang-convert-float-to-hex-string\">Golang: Convert float to hex string</a>"}, {"owner": {"reputation": 4490, "user_id": 1870400, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/86a511ab70d0d94c77746a4d27c66fdf?s=128&d=identicon&r=PG", "display_name": "user1870400", "link": "https://stackoverflow.com/users/1870400/user1870400"}, "reply_to_user": {"reputation": 814, "user_id": 8229192, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/obcNu.jpg?s=128&g=1", "display_name": "FullStackDeveloper", "link": "https://stackoverflow.com/users/8229192/fullstackdeveloper"}, "edited": false, "score": 2, "creation_date": 1532547477, "post_id": 51526409, "comment_id": 90021532, "body": "That link doesn&#39;t show how to convert to c99 standard ?"}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1532557435, "last_edit_date": 1532557435, "creation_date": 1532549965, "answer_id": 51527053, "question_id": 51526409, "link": "https://stackoverflow.com/questions/51526409/how-to-convert-float64-to-c99-hex-string-in-golang/51527053#51527053", "title": "How to convert float64 to c99 hex string in Golang?", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    f := new(big.Float).SetFloat64(-561.2863)\n    fmt.Println(f)\n    t := f.Text('p', 0)\n    fmt.Println(t)\n    g, ok := new(big.Float).SetString(t)\n    if !ok {\n        fmt.Println(\"error\")\n    }\n    fmt.Println(g)\n    c, ok := new(big.Float).SetString(\"-0x1.18a4a57a786c2p9\")\n    if !ok {\n        fmt.Println(\"error\")\n    }\n    fmt.Println(c)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/9BygKkJcNbm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9BygKkJcNbm</a></p>\n\n<p>Output:</p>\n\n<pre><code>-561.2863\n-0x.8c5252bd3c361p+10\n-561.2862999999999829\n-561.2862999999999829\n</code></pre>\n\n<hr>\n\n<p>Or, simply,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    f64 := -561.2863\n    fmt.Println(f64)\n    s := new(big.Float).SetFloat64(f64).Text('p', 0)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/MR2AxtlBcqv\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MR2AxtlBcqv</a></p>\n\n<p>Output:</p>\n\n<pre><code>-561.2863\n-0x.8c5252bd3c361p+10\n</code></pre>\n\n<hr>\n\n<p>In C,</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main() {\n    double f = -561.2863;\n    printf(\"%f %a\\n\", f, f);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>-561.286300 -0x1.18a4a57a786c2p+9\n</code></pre>\n"}], "owner": {"reputation": 4490, "user_id": 1870400, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/86a511ab70d0d94c77746a4d27c66fdf?s=128&d=identicon&r=PG", "display_name": "user1870400", "link": "https://stackoverflow.com/users/1870400/user1870400"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 212, "favorite_count": 1, "accepted_answer_id": 51527053, "answer_count": 1, "score": -1, "last_activity_date": 1532557435, "creation_date": 1532547177, "question_id": 51526409, "link": "https://stackoverflow.com/questions/51526409/how-to-convert-float64-to-c99-hex-string-in-golang", "title": "How to convert float64 to c99 hex string in Golang?", "body": "<p>How to convert float64 to hex string(that follows c99 standard) in Golang?</p>\n\n<p><code>-561.2863</code> to <code>-0x1.18a4a57a786c2p9</code></p>\n"}, {"tags": ["c", "go", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532545867, "post_id": 51525876, "comment_id": 90020864, "body": "Don&#39;t return a Go slice to C code, since C code doesn&#39;t know what a Go slice is. Give it a an array pointer just like you would in plain C."}, {"owner": {"reputation": 53, "user_id": 4196220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wG0t.jpg?s=128&g=1", "display_name": "Alain Gilbert", "link": "https://stackoverflow.com/users/4196220/alain-gilbert"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532546123, "post_id": 51525876, "comment_id": 90020991, "body": "I tried a lot of different things. I cannot figure it out. I know I should not return a slice, I should probably return an unsafe.Pointer or something similar. But I think it will be easier for other people to understand what I&#39;m trying to do with this example. If you have any example of how to do it, I would really appreciate it :)"}], "answers": [{"comments": [{"owner": {"reputation": 53, "user_id": 4196220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wG0t.jpg?s=128&g=1", "display_name": "Alain Gilbert", "link": "https://stackoverflow.com/users/4196220/alain-gilbert"}, "edited": false, "score": 0, "creation_date": 1532559037, "post_id": 51526362, "comment_id": 90025888, "body": "It&#39;s nice that the code can compile with <code>go run</code>, but if you separate the C code in it&#39;s own file, and you compile the shared library... you&#39;ll get a runtime error <code>panic: runtime error: cgo result has Go pointer</code>."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1532547458, "last_edit_date": 1532547458, "creation_date": 1532546993, "answer_id": 51526362, "question_id": 51525876, "link": "https://stackoverflow.com/questions/51525876/use-go-slice-in-c/51526362#51526362", "title": "Use Go slice in C", "body": "<blockquote>\n  <p>Use Go slice in C</p>\n</blockquote>\n\n<hr>\n\n<p>Here's an example of C printing a Go <code>byte</code> slice:</p>\n\n<pre><code>package main\n\n/*\n#include &lt;stdio.h&gt;\n\nvoid printbuf(size_t len, unsigned char *buf) {\n    printf(\"%lu [\", len);\n    if (!buf) {\n        len = 0;\n    }\n    size_t maxwidth = 16;\n    size_t width = len &lt;= maxwidth ? len : maxwidth;\n    for (size_t i = 0; i &lt; width; i++) {\n        if (i &gt; 0) {\n            printf(\" \");\n        }\n        printf(\"%02X\", buf[i]);\n    }\n    if (width &lt; len) {\n        printf(\" ...\");\n    }\n    printf(\"]\\n\");\n}\n*/\nimport \"C\"\n\nfunc cbuf(buf []byte) (size C.size_t, ptr *C.uchar) {\n    var bufptr *byte\n    if cap(buf) &gt; 0 {\n        bufptr = &amp;(buf[:1][0])\n    }\n    return C.size_t(len(buf)), (*C.uchar)(bufptr)\n}\n\nfunc main() {\n    buf := make([]byte, 24, 32)\n    for i := range buf {\n        buf[i] = byte(i)\n    }\n    bufsize, bufptr := cbuf(buf)\n    C.printbuf(bufsize, bufptr)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>24 [00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F ...]\n</code></pre>\n\n<hr>\n\n<p><code>func Test() []T</code>  has the wrong return values for C. Return a length and an array pointer, like <code>cbuf</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 0, "last_activity_date": 1532547071, "creation_date": 1532547071, "answer_id": 51526388, "question_id": 51525876, "link": "https://stackoverflow.com/questions/51525876/use-go-slice-in-c/51526388#51526388", "title": "Use Go slice in C", "body": "<p>To start, C doesn't know about the Go slice type, nor how to manipulate it, so you should return an array pointer just like you would in C.</p>\n\n<p>You also can't allocate the slice in Go then return a pointer to the allocated memory without some way to keep it from being GC'ed. In this example it's probably simpler to just allocate the array in C.</p>\n\n<pre><code>p := C.malloc(C.size_t(2))\n\n// make a slice for convenient indexing\narr := (*[1 &lt;&lt; 30]*T)(p)[:2:2]\narr[0] = &amp;T{C.int(1), C.CString(\"a\")}\narr[1] = &amp;T{C.int(2), C.CString(\"abc\")}\n\nreturn p\n</code></pre>\n\n<p>You will also of course need to handle the array size, which you could do with by combining it into a struct like you did for strings, or accept a second pointer parameter to set to the return size.</p>\n\n<p>Don't forget that since you are allocating the memory in C, you are also responsible for freeing it. This goes for both the <code>malloc</code> call, as well as for the <code>C.CString</code> arrays.</p>\n"}], "owner": {"reputation": 53, "user_id": 4196220, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9wG0t.jpg?s=128&g=1", "display_name": "Alain Gilbert", "link": "https://stackoverflow.com/users/4196220/alain-gilbert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1163, "favorite_count": 2, "answer_count": 2, "score": 1, "last_activity_date": 1532547458, "creation_date": 1532544875, "question_id": 51525876, "link": "https://stackoverflow.com/questions/51525876/use-go-slice-in-c", "title": "Use Go slice in C", "body": "<p>I'm trying to build a go shared library with a function that returns a slice.<br>\nHow can I use the slice from C code ?</p>\n\n<pre><code>package main\n\nimport \"C\"\n\ntype T struct {\n    A C.int\n    B *C.char\n}\n\n//export Test\nfunc Test() []T {\n    arr := make([]T, 0)\n    arr = append(arr, T{C.int(1), C.CString(\"a\")})\n    arr = append(arr, T{C.int(2), C.CString(\"abc\")})\n    return arr\n}\n\nfunc main() {}\n</code></pre>\n\n<p><code>go build -o lib.so -buildmode=c-shared main.go</code></p>\n\n<p>I now have a <code>lib.so</code> and a <code>lib.h</code></p>\n\n<p>What would be the C code to print the values of the array ?</p>\n\n<pre><code>#include &lt;stdio.h&gt;\n#include \"lib.h\"\n\ntypedef struct {\n  int   A;\n  char* B;\n} T;\n\nint main() {\n  GoSlice a = Test();\n  for (int i = 0; i &lt; 2; i++){\n    printf(\"%s\\n\", ((T *)a.data)[i].B);\n  }\n}\n</code></pre>\n\n<p><code>gcc -o main main.c ./lib.so</code></p>\n"}, {"tags": ["amazon-web-services", "go", "sdk"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532543828, "post_id": 51525479, "comment_id": 90019960, "body": "What is your question?"}, {"owner": {"reputation": 79, "user_id": 7447794, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gMJzNGupnvo/AAAAAAAAAAI/AAAAAAAAEUs/UNLT_zAU4Zk/photo.jpg?sz=128", "display_name": "Isaiah", "link": "https://stackoverflow.com/users/7447794/isaiah"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532546306, "post_id": 51525479, "comment_id": 90021059, "body": "My question is how do I print out the QR code to the screen?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532546987, "post_id": 51525479, "comment_id": 90021328, "body": "It returns the QR code as a PNG in raw bytes. If this is a CLI tool you could write that to a file with a &quot;.png&quot; extension, if this is a web app you can serve those bytes with the mime type &quot;image/png&quot;."}], "owner": {"reputation": 79, "user_id": 7447794, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-gMJzNGupnvo/AAAAAAAAAAI/AAAAAAAAEUs/UNLT_zAU4Zk/photo.jpg?sz=128", "display_name": "Isaiah", "link": "https://stackoverflow.com/users/7447794/isaiah"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 39, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532543223, "creation_date": 1532543223, "question_id": 51525479, "link": "https://stackoverflow.com/questions/51525479/golang-aws-sdk-createvirtualmfadevice-print-createvirtualmfadeviceoutput-qrcodep", "title": "Golang AWS SDK CreateVirtualMFADevice Print CreateVirtualMFADeviceOutput QRCodePNG", "body": "<p>I'm trying to make it easy for users to create their own Virtual MFA device and I get the results from CreateVirtualMFADevice function but I'm lost on how to print the QRCodePNG it self. When I print the results I just get the binary JSON results. Here is my code: </p>\n\n<pre><code>                reader := bufio.NewReader(os.Stdin)\n                fmt.Println(\"Enter name of new virtual device: \")\n                user, err := reader.ReadString('\\n')\n                if err != nil {\n                        fmt.Printf(\"Error: %v\\n\", err)\n                }\n                input := &amp;iam.CreateVirtualMFADeviceInput{\n                        VirtualMFADeviceName: aws.String(strings.TrimSpace(user)),\n                        //Path:                 aws.String(\"./QR_Code.png\"),\n                }\n                result, err := svc.CreateVirtualMFADevice(input)\n                if err != nil {\n                        if aerr, ok := err.(awserr.Error); ok {\n                                switch aerr.Code() {\n                                case iam.ErrCodeLimitExceededException:\n                                        fmt.Println(iam.ErrCodeLimitExceededException, aerr.Error())\n                                case iam.ErrCodeEntityAlreadyExistsException:\n                                        fmt.Println(iam.ErrCodeEntityAlreadyExistsException, aerr.Error())\n                                case iam.ErrCodeServiceFailureException:\n                                        fmt.Println(iam.ErrCodeServiceFailureException, aerr.Error())\ndefault:\n                                        fmt.Println(aerr.Error())\n                                }\n                        } else {\n                                // Print the error, cast err to awserr.Error to get the Code and\n                                // Message from an error.\n                                fmt.Println(err.Error())\n                        }\n                        return\n                }\n\nfmt.Println(result)\n</code></pre>\n\n<p>Here are the references to the SDK calls: \n<code>https://docs.aws.amazon.com/sdk-for-go/api/service/iam/#IAM.CreateVirtualMFADevice</code></p>\n\n<p>This is the output I get from fmt.Println(result)</p>\n\n<pre><code>Enter name of new virtual device:\nblah\nEnter QR code to google authenticator\n{\n  VirtualMFADevice: {\n    Base32StringSeed: &lt;binary&gt; len 64,\n    QRCodePNG: &lt;binary&gt; len 1619,\n    SerialNumber: \"arn:aws:iam::xxxxxxxxxxxxx:mfa/blah\"\n  }\n}\n</code></pre>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 1, "creation_date": 1532542209, "post_id": 51524698, "comment_id": 90019242, "body": "are you changing your session secret or session name on each build?"}, {"owner": {"reputation": 121, "user_id": 5982728, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/df759cb2958a8c64ff7c7ae0f878ba3e?s=128&d=identicon&r=PG&f=1", "display_name": "fritz", "link": "https://stackoverflow.com/users/5982728/fritz"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1532542953, "post_id": 51524698, "comment_id": 90019584, "body": "No they are both loaded from an env file"}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": false, "score": 0, "last_activity_date": 1532544377, "creation_date": 1532544377, "answer_id": 51525750, "question_id": 51524698, "link": "https://stackoverflow.com/questions/51524698/do-gorilla-cookie-sessions-persist-server-rebuilds/51525750#51525750", "title": "Do gorilla cookie sessions persist server rebuilds?", "body": "<p>The issue is most likely that you are \"sharing\" sessions.  A session should belong to one request.  But when you do:</p>\n\n<pre><code>var sessionPointer *sessions.Session; \n\n\nfunc initSession(r *http.Request) *sessions.Session {\n    if sessionPointer == nil { \n\n    } else{ \n        return sessionPointer; \n    }\n\n\n    temp, err := sessionStore.Get(r,os.Getenv(\"SESSION_NAME\"))\n\n    sessionPointer = temp;\n\n    // ...\n}\n</code></pre>\n\n<p>You are essentially saying \"if <em>any</em> session has been created, return it\".  This means that every request (and every user) will be getting the same session.  I'm not sure how they go about matching a request to a specific session, but I'd imagine that not calling <code>sessionStore.Get</code> each time you match it to a new request, eventually something gets set on the session that makes it no longer valid (because the session did not actually belong to that request).</p>\n\n<p>The good news is that there is <em>no reason</em> to cache the sessionPointer.  It's using a map internally anyways, and the lookup is essentially free.  I would change your code to:</p>\n\n<pre><code>func initSession(r *http.Request) *sessions.Session {\n    temp, err := sessionStore.Get(r,os.Getenv(\"SESSION_NAME\"))\n    if err != nil {\n        panic(err)\n    }\n    sessionPointer.Options = &amp;sessions.Options{\n        Path: \"/\",\n        MaxAge: 86400 * 1,\n        HttpOnly: false,\n    }\n    return sessionPointer\n}\n</code></pre>\n\n<p>and then I would think that everything would work as expected.</p>\n"}], "owner": {"reputation": 121, "user_id": 5982728, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/df759cb2958a8c64ff7c7ae0f878ba3e?s=128&d=identicon&r=PG&f=1", "display_name": "fritz", "link": "https://stackoverflow.com/users/5982728/fritz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532544377, "creation_date": 1532540015, "question_id": 51524698, "link": "https://stackoverflow.com/questions/51524698/do-gorilla-cookie-sessions-persist-server-rebuilds", "title": "Do gorilla cookie sessions persist server rebuilds?", "body": "<p>I am using the following code to pass the current session throughout my package. I am building with fresh which watches my files. It seems after build the cookies are no longer valid? I've tried both a cookie store and a mysql store. I have confirmed the cookies are still in the browser and the line items are still in the db. </p>\n\n<pre><code>var sessionStore = sessions.NewCookieStore([]byte(os.Getenv(\"SESSION_SECRET\")))\n\n\nvar sessionPointer *sessions.Session; \n\n\nfunc initSession(r *http.Request) *sessions.Session {\n\n\n    if sessionPointer == nil { \n\n    } else{ \n        return sessionPointer; \n    }\n\n\n    temp, err := sessionStore.Get(r,os.Getenv(\"SESSION_NAME\"))\n\n    sessionPointer = temp;\n\n    sessionPointer.Options = &amp;sessions.Options{\n\n        Path: \"/\",\n\n            MaxAge: 86400 * 1,\n\n            HttpOnly: false,\n\n    }\n\n    if err != nil {\n        panic(err)\n    }\n    return sessionPointer\n}\n</code></pre>\n"}, {"tags": ["go", "web", "handler"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532535213, "post_id": 51523254, "comment_id": 90015753, "body": "The correct way to return from a function is a <code>return</code> statement. Don&#39;t use panics for flow control. Put your logic into a function that returns an error (as opposed to directly into the handler), then you only have to write the error handling once."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532535234, "post_id": 51523254, "comment_id": 90015768, "body": "What do you mean &quot;return the handler itself&quot;? If you return from a handler, it stops processing that request. A handler has no real way to stop all other requests from processing (goroutines cannot be interrupted that way). You could have your program stop entirely using <code>os.Exit</code> I guess?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532535947, "post_id": 51523254, "comment_id": 90016112, "body": "I think you&#39;re asking if you can have a common function to do that error checking which will cause the caller (i.e., the handler) to return. You can&#39;t do that, and panicking isn&#39;t intended for general exception-style processing. If what you want to do is avoid repeating the code under <code>if err != nil</code>, you can put that code in a deferred function and just return at those points. One downside of that is that it may make the code more confusing, since the deferred action is defined somewhere else. You can also define that same function and call it explicitly before returning."}], "answers": [{"comments": [{"owner": {"reputation": 654, "user_id": 2867339, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/Ly1g1.jpg?s=128&g=1", "display_name": "Altenrion", "link": "https://stackoverflow.com/users/2867339/altenrion"}, "edited": false, "score": 0, "creation_date": 1557185629, "post_id": 51524565, "comment_id": 98671917, "body": "cloud programming - is a bad advice in 2K19"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": -1, "last_activity_date": 1532539506, "creation_date": 1532539506, "answer_id": 51524565, "question_id": 51523254, "link": "https://stackoverflow.com/questions/51523254/close-return-responsewriter-from-child-function-in-go/51524565#51524565", "title": "Close/return ResponseWriter from child function in Go", "body": "<p>You can't escape outermost function from innermost but you can at least compact code a bit by inverting control flow</p>\n\n<pre><code>err := dbSesstion.DB(dbsett.Name).C(dbsett.Collection).Find(nil).All(&amp;posts)\nif err == nil {\n    err = json.NewEncoder(w).Encode(posts)\n    if err == nil {\n        err = somethingelse()\n        if err == nil {\n            w.WriteHeader(http.StatusOK)\n            return //successfully\n        }\n    }\n}\nlog.Print(\"error: \", nil)\nw.WriteHeader(http.StatusInternalServerError) \n</code></pre>\n"}], "owner": {"reputation": 15, "user_id": 2415673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/373ae67c679b9b9a590f15455ba075d3?s=128&d=identicon&r=PG", "display_name": "kaloyang", "link": "https://stackoverflow.com/users/2415673/kaloyang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532539506, "creation_date": 1532534445, "last_edit_date": 1532535160, "question_id": 51523254, "link": "https://stackoverflow.com/questions/51523254/close-return-responsewriter-from-child-function-in-go", "title": "Close/return ResponseWriter from child function in Go", "body": "<p>I am new to Go and building web apps. An example of my handler is something like this: </p>\n\n<pre><code>func getAllPostsHandler(w http.ResponseWriter, r *http.Request) {\n    var posts []Post\n\n    dbSesstion := context.Get(r, \"database\").(*mgo.Session)\n    err := dbSesstion.DB(dbsett.Name).C(dbsett.Collection).Find(nil).All(&amp;posts)\n    if err != nil {\n        log.Print(\"error: \", nil)\n        w.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n    err = json.NewEncoder(w).Encode(posts)\n    if err != nil {\n        log.Print(\"error: \", nil)\n        w.WriteHeader(http.StatusInternalServerError)\n        return\n    }\n    w.WriteHeader(http.StatusOK)\n}\n</code></pre>\n\n<p>My handlers have a lot of repeating error checking like this:</p>\n\n<pre><code>if err != nil {\n    log.Print(\"error: \", nil)\n    w.WriteHeader(http.StatusInternalServerError)\n    return\n}\n</code></pre>\n\n<p>I want to make a function, which checks for error, print logs, write the response writer if neccessary, and return, but not only to the handler, but to stop all other response writings and return the handler itself. Is it possible to do so? I am thinking about panicing, but something tells me that its not the right way.</p>\n"}, {"tags": ["rest", "unit-testing", "go", "gorilla", "mux"], "comments": [{"owner": {"reputation": 5298, "user_id": 411645, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/f9f4ec02e1fe8245e1c9b0881c2b8c71?s=128&d=identicon&r=PG", "display_name": "Thomas Junk", "link": "https://stackoverflow.com/users/411645/thomas-junk"}, "edited": false, "score": 0, "creation_date": 1532531809, "post_id": 51521868, "comment_id": 90013739, "body": "How does the <code>HandleFunce</code> look like?"}, {"owner": {"reputation": 2233, "user_id": 795636, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Upxbt.jpg?s=128&g=1", "display_name": "Aleksej Vasinov", "link": "https://stackoverflow.com/users/795636/aleksej-vasinov"}, "edited": false, "score": 0, "creation_date": 1532531867, "post_id": 51521868, "comment_id": 90013784, "body": "I would log request URL and parse it with <i>url.ParseRequestURI</i> to get some info."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532533931, "post_id": 51521868, "comment_id": 90015093, "body": "log the error you are getting when creating a new request"}], "answers": [{"tags": [], "owner": {"reputation": 162, "user_id": 10029758, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nhzV8.jpg?s=128&g=1", "display_name": "MarcusOuelletus", "link": "https://stackoverflow.com/users/10029758/marcusouelletus"}, "is_accepted": false, "score": 2, "last_activity_date": 1532546259, "last_edit_date": 1532546259, "creation_date": 1532545713, "answer_id": 51526062, "question_id": 51521868, "link": "https://stackoverflow.com/questions/51521868/unable-to-read-variables-from-a-url-using-gorilla-mux-in-golang/51526062#51526062", "title": "Unable to read variables from a url using gorilla mux in golang", "body": "<p>Since you're using GET requests, you can use the http.Get function, it works as expected:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc handle(w http.ResponseWriter, r *http.Request) {\n    params := mux.Vars(r)\n    fmt.Println(params)\n}\n\nfunc main() {\n    m := mux.NewRouter()\n    m.HandleFunc(\"/products/{id}\", handle)\n    http.Handle(\"/\", m)\n    go func() {\n        http.ListenAndServe(\":8080\", nil)\n    }()\n    _, err := http.Get(\"http://localhost:8080/products/765\")\n    // Handle Error\n}\n</code></pre>\n\n<p>If you really want to use http.NewRequest, that function doesn't actually execute the request so here is what you would need:</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"product/5b5758f9931653c36bcaf0a0\", nil)\nclient := &amp;http.Client{}\nclient.Do(req)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 154, "user_id": 8913763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ICicn.jpg?s=128&g=1", "display_name": "VadimFilin", "link": "https://stackoverflow.com/users/8913763/vadimfilin"}, "edited": false, "score": 2, "creation_date": 1562681684, "post_id": 51598281, "comment_id": 100447462, "body": "This is not a solution."}], "tags": [], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "is_accepted": true, "score": 2, "last_activity_date": 1532967489, "creation_date": 1532967489, "answer_id": 51598281, "question_id": 51521868, "link": "https://stackoverflow.com/questions/51521868/unable-to-read-variables-from-a-url-using-gorilla-mux-in-golang/51598281#51598281", "title": "Unable to read variables from a url using gorilla mux in golang", "body": "<p>This solved the issue </p>\n\n<pre><code>req = mux.SetURLVars(req, map[string]string{\"id\": \"5b5758f9931653c36bcaf0a0\"})\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 712, "user_id": 8868419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/44a530d27369c9d4f6ecf421fe83d2b4?s=128&d=identicon&r=PG&f=1", "display_name": "Madeo", "link": "https://stackoverflow.com/users/8868419/madeo"}, "edited": false, "score": 0, "creation_date": 1616028838, "post_id": 59853724, "comment_id": 117878345, "body": "yep, this was the correct answer. Thanks!"}], "tags": [], "owner": {"reputation": 1422, "user_id": 2067448, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c9f8d350fe483d4de160a8d62c6b1141?s=128&d=identicon&r=PG", "display_name": "Raviteja", "link": "https://stackoverflow.com/users/2067448/raviteja"}, "is_accepted": false, "score": 1, "last_activity_date": 1579674059, "creation_date": 1579674059, "answer_id": 59853724, "question_id": 51521868, "link": "https://stackoverflow.com/questions/51521868/unable-to-read-variables-from-a-url-using-gorilla-mux-in-golang/59853724#59853724", "title": "Unable to read variables from a url using gorilla mux in golang", "body": "<p>Create the mux Router in a separate function in the source code and call that directly in your test.</p>\n\n<p>In Source code:</p>\n\n<pre><code>func Router() *mux.Router {\n  r := mux.NewRouter()\n  r.HandleFunc(\"/product/{id}\", productHandler)\n\n  return r\n}\n\nfunc main() {\nhttp.Handle(\"/\", Router())\n}\n</code></pre>\n\n<p>In Test:</p>\n\n<pre><code>func TestProductHandler(t *testing.T) {\n  r := http.NewRequest(\"GET\", \"product/5b5758f9931653c36bcaf0a0\", nil)\n  w := httptest.NewRecorder()\n\n  Router().ServeHTTP(w, r)\n}\n</code></pre>\n\n<p>Found the related solution in one of the google groups forums.\n<a href=\"https://groups.google.com/forum/#!msg/golang-nuts/Xs-Ho1feGyg/xg5amXHsM_oJ\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!msg/golang-nuts/Xs-Ho1feGyg/xg5amXHsM_oJ</a></p>\n"}], "owner": {"reputation": 2760, "user_id": 2639188, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c1a58be9b3e79cc22a37cad79a992438?s=128&d=identicon&r=PG", "display_name": "DoIt", "link": "https://stackoverflow.com/users/2639188/doit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1728, "favorite_count": 0, "accepted_answer_id": 51598281, "answer_count": 3, "score": 2, "last_activity_date": 1579674059, "creation_date": 1532530199, "question_id": 51521868, "link": "https://stackoverflow.com/questions/51521868/unable-to-read-variables-from-a-url-using-gorilla-mux-in-golang", "title": "Unable to read variables from a url using gorilla mux in golang", "body": "<p>I am trying to write a unit test using gotests and gomock to my restful service written in golang using gorilla but service fails to get variables from the url </p>\n\n<p>Here is my request</p>\n\n<pre><code>req, err := http.NewRequest(\"GET\", \"product/5b5758f9931653c36bcaf0a0\", nil)\n</code></pre>\n\n<p>actual endpoint is <code>product/{id}</code></p>\n\n<p>when I step into my service at the below code</p>\n\n<pre><code>params := mux.Vars(req)\n</code></pre>\n\n<p><code>params</code> map is empty when it should have <code>id</code> key mapped to <code>5b5758f9931653c36bcaf0a0</code></p>\n\n<p>Strange part is endpoint works fine from post man.</p>\n\n<p><strong>May I know whats wrong with the request?</strong></p>\n"}, {"tags": ["unit-testing", "go", "monkeypatching"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1532531867, "post_id": 51521539, "comment_id": 90013782, "body": "I wouldn&#39;t really consider a test reliable if you&#39;re using monkey patching like this. If you read that project&#39;s README you&#39;ll see <code>Monkey sometimes fails to patch a function if inlining is enabled</code> -- also note <code>Monkey is not threadsafe. Or any kind of safe.</code>. It&#39;s a neat experiment but there have to be better, safer ways to do what you want."}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 4, "creation_date": 1532537014, "post_id": 51521539, "comment_id": 90016603, "body": "<code>github.com&#47;bouk&#47;monkey</code> relies on reverse-engineering a code generation pattern which may or may not exist: Monkey Patching in Go : <a href=\"https://bou.ke/blog/monkey-patching-in-go/\" rel=\"nofollow noreferrer\">bou.ke/blog/monkey-patching-in-go</a>  As you have discovered, it&#39;s very fragile. Worse, it can give false positives and false negatives when testing and wrong results when executing."}], "answers": [{"tags": [], "owner": {"reputation": 1948, "user_id": 1924657, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/gumlg.jpg?s=128&g=1", "display_name": "Bryce", "link": "https://stackoverflow.com/users/1924657/bryce"}, "is_accepted": false, "score": 1, "last_activity_date": 1535080820, "creation_date": 1535080820, "answer_id": 51996975, "question_id": 51521539, "link": "https://stackoverflow.com/questions/51521539/monkey-patching-in-golang-fails-when-i-remove-fmt-println/51996975#51996975", "title": "Monkey patching in golang fails when I remove fmt.Println()", "body": "<p>This is caused by compiler's inline optimize, add <code>-gcflags=\"-N -I\"</code> will disable it.</p>\n"}], "owner": {"reputation": 55, "user_id": 9571108, "user_type": "registered", "profile_image": "https://graph.facebook.com/1413606428744551/picture?type=large", "display_name": "Claudiu Ardei", "link": "https://stackoverflow.com/users/9571108/claudiu-ardei"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1169, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1535080820, "creation_date": 1532529208, "question_id": 51521539, "link": "https://stackoverflow.com/questions/51521539/monkey-patching-in-golang-fails-when-i-remove-fmt-println", "title": "Monkey patching in golang fails when I remove fmt.Println()", "body": "<p>While writing a test I have to patch a method in order to check that it is called, this is my code:</p>\n\n<pre><code>import \"fmt\"\n\ntype myStruct struct {}\n\nfunc (myObject *myStruct) firstMethod() {\n    myObject.SecondMethod()\n}\nfunc (myObject *myStruct) SecondMethod() {\n    fmt.Println(\"Inside the original SecondMethod\") //test fails if I remove this\n}\n</code></pre>\n\n<p>and this is the test:</p>\n\n<pre><code>import (\n    \"reflect\"\n    \"testing\"\n    \"github.com/bouk/monkey\"\n    \"github.com/stretchr/testify/assert\"\n    \"fmt\"\n)\nfunc TestThatSecondMethodIsCalled(t *testing.T) {\n    myObject := &amp;myStruct{}\n\n    wasCalled := false\n    monkey.PatchInstanceMethod(\n        reflect.TypeOf(myObject),\n        \"SecondMethod\",\n        func(*myStruct) {\n            fmt.Println(\"Inside the replacement of SecondMethod\")\n            wasCalled = true\n        },\n    )\n\n    myObject.firstMethod()\n    assert.True(t, wasCalled)\n}\n</code></pre>\n\n<p>If I run the test like this, it will pass, but if I remove the <code>fmt.Println()</code> from SecondMethod, then the test fails (the test uses the original body of the method, not the patched one).</p>\n\n<p>Also if I use debugging from Goland, the test passes even if SecondMethod has an empty body.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "edited": false, "score": 0, "creation_date": 1532603863, "post_id": 51523810, "comment_id": 90042574, "body": "This doesn&#39;t really answer my question.  The issue here is that I want the context passed to <code>BindContext</code> to be user-configurable.  I can&#39;t know ahead of time what kind of context will be passed in.  Informally, the requirement here is to somehow &quot;merge&quot; two contexts (which I naively assumed was what <code>r.WithContext</code> achieved)."}], "tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": false, "score": 1, "last_activity_date": 1532611502, "last_edit_date": 1532611502, "creation_date": 1532536528, "answer_id": 51523810, "question_id": 51521279, "link": "https://stackoverflow.com/questions/51521279/how-do-i-pass-a-context-to-r-withcontext-while-retaining-values-of-the-original/51523810#51523810", "title": "How do I pass a Context to r.WithContext while retaining values of the original request context?", "body": "<p>You should not replace the context on incoming request with an unrelated context. For starters:</p>\n\n<blockquote>\n  <p>Package context defines the Context type, which carries deadlines, cancelation signals, and other request-scoped values across API boundaries and between processes.</p>\n</blockquote>\n\n<p><code>sigctx.New()</code> is called before any request happens and is therefore by definition not request scoped. Pretty much all code expects the request context to be canceled when a) the request finishes, or b) the client aborts the request (usually because it is no longer interested in the response). You are breaking that assumption by replacing the context. You are also removing any values that other middlewares may have added to the context earlier.</p>\n\n<p>It seems like you wish to abort requests on SIGINT or SIGTERM. You should <em>add</em> that cancelation condition to the request context instead of replacing it completely. Perhaps like so:</p>\n\n<pre><code>func BindContext(c context.Context) func(http.Handler) http.Handler {\n        return func(h http.Handler) http.Handler {\n                return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                        rCtx := r.Context()\n                        ctx, cancel := context.WithCancel(rCtx)\n\n                        go func() {\n                                select {\n                                case &lt;-c.Done(): // SIGINT/SIGTERM\n                                case &lt;-rCtx.Done(): // Request finished or client aborted\n                                }\n                                cancel()\n                        }()\n\n                        h.ServeHTTP(w, r.WithContext(ctx))\n                })\n        }\n}\n</code></pre>\n\n<p>Update:</p>\n\n<p>To let users configure the context, accept a function that derives a new context from the request context (although users might as well supply a middleware that does this directly):</p>\n\n<pre><code>func WithContext(new func(context.Context) context.Context) func(http.Handler) http.Handler {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            r = r.WithContext(new(r.Context()))\n\n            h.ServeHTTP(w, r)\n        })  \n    }   \n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "is_accepted": true, "score": 0, "last_activity_date": 1532610224, "creation_date": 1532610224, "answer_id": 51539535, "question_id": 51521279, "link": "https://stackoverflow.com/questions/51521279/how-do-i-pass-a-context-to-r-withcontext-while-retaining-values-of-the-original/51539535#51539535", "title": "How do I pass a Context to r.WithContext while retaining values of the original request context?", "body": "<p>It appears as though there is no out-of-the-box solution for this, but <code>github.com/SentimensRG/ctx</code> provides a <code>mergectx</code> subpackage specifically for this purpose.</p>\n\n<p>The solution is to use <a href=\"https://godoc.org/github.com/SentimensRG/ctx/mergectx#Mergehttps://godoc.org/github.com/SentimensRG/ctx/mergectx#Merge\" rel=\"nofollow noreferrer\"><code>mergectx.Merge</code></a>.</p>\n"}, {"tags": [], "owner": {"reputation": 7266, "user_id": 363448, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/1252402b941681ed179ed997878571f3?s=128&d=identicon&r=PG", "display_name": "ndequeker", "link": "https://stackoverflow.com/users/363448/ndequeker"}, "is_accepted": false, "score": 0, "last_activity_date": 1551178922, "creation_date": 1551178922, "answer_id": 54884017, "question_id": 51521279, "link": "https://stackoverflow.com/questions/51521279/how-do-i-pass-a-context-to-r-withcontext-while-retaining-values-of-the-original/54884017#54884017", "title": "How do I pass a Context to r.WithContext while retaining values of the original request context?", "body": "<p>I faced the same problem and was able to resolve this by creating the new context using <a href=\"https://godoc.org/github.com/go-chi/chi#NewRouteContext\" rel=\"nofollow noreferrer\">chi.NewRouteContext</a>.</p>\n\n<p>The request is being made using <code>httptest</code>. You can update the request its context using <code>r.WithContext</code>.</p>\n\n<p><strong>Example</strong></p>\n\n<pre><code>w := httptest.NewRecorder()\nr := httptest.NewRequest(\"GET\", \"/\", nil)\n\nrctx := chi.NewRouteContext()\nrctx.URLParams.Add(\"key\", \"value\")\n\nr = r.WithContext(context.WithValue(r.Context(), chi.RouteCtxKey, rctx))\n\nhandler := func(w http.ResponseWriter, r *http.Request) {\n    key := chi.URLParam(r, \"key\") // \"value\"\n}\n\nhandler(w, r)\n</code></pre>\n\n<p>See the folling Gist from aapolkovsky: <a href=\"https://gist.github.com/aapolkovsky/1375348cab941e36c62da24a32fbebe7\" rel=\"nofollow noreferrer\">https://gist.github.com/aapolkovsky/1375348cab941e36c62da24a32fbebe7</a></p>\n"}], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1259, "favorite_count": 1, "accepted_answer_id": 51539535, "answer_count": 3, "score": 0, "last_activity_date": 1551178922, "creation_date": 1532528434, "last_edit_date": 1532603939, "question_id": 51521279, "link": "https://stackoverflow.com/questions/51521279/how-do-i-pass-a-context-to-r-withcontext-while-retaining-values-of-the-original", "title": "How do I pass a Context to r.WithContext while retaining values of the original request context?", "body": "<h1>Problem statement</h1>\n\n<p>I want to tie the lifetime of an HTTP request to a context that was created outside the scope of the web application.  Thus, I wrote the following middleware (using <code>github.com/go-chi/chi</code>):</p>\n\n<pre><code>func BindContext(c context.Context) func(http.Handler) http.Handler {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            h.ServeHTTP(w, r.WithContext(c))\n        })\n    }\n}\n</code></pre>\n\n<p>The middleware is used in the following minimal test case:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"net/http\"\n\n    \"github.com/SentimensRG/ctx\"\n    \"github.com/SentimensRG/ctx/sigctx\"\n\n    \"github.com/go-chi/chi\"\n)\n\nfunc greet(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n}\n\nfunc BindContext(c context.Context) func(http.Handler) http.Handler {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            h.ServeHTTP(w, r.WithContext(c))\n        })\n    }\n}\n\nfunc main() {\n    r := chi.NewMux()\n    r.Use(BindContext(ctx.AsContext(sigctx.New())))\n    r.Get(\"/\", greet)\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>The handler panics with the following error:</p>\n\n<pre><code>2018/07/25 14:58:57 http: panic serving [::1]:56527: interface conversion: interface {} is nil, not *chi.Context\ngoroutine 35 [running]:\nnet/http.(*conn).serve.func1(0xc42014a0a0)\n        /usr/local/go/src/net/http/server.go:1726 +0xd0\npanic(0x12749c0, 0xc42014c200)\n        /usr/local/go/src/runtime/panic.go:502 +0x229\ngithub.com/go-chi/chi.(*Mux).routeHTTP(0xc4201180c0, 0x12fcf00, 0xc420166000, 0xc420160200)\n        /Users/lthibault/go/src/github.com/go-chi/chi/mux.go:400 +0x2f3\ngithub.com/go-chi/chi.(*Mux).(github.com/go-chi/chi.routeHTTP)-fm(0x12fcf00, 0xc420166000, 0xc420160200)\n        /Users/lthibault/go/src/github.com/go-chi/chi/mux.go:368 +0x48\nnet/http.HandlerFunc.ServeHTTP(0xc420142010, 0x12fcf00, 0xc420166000, 0xc420160200)\n        /usr/local/go/src/net/http/server.go:1947 +0x44\nmain.fail.func1.1(0x12fcf00, 0xc420166000, 0xc420160100)\n        /Users/lthibault/go/src/github.com/lthibault/mesh/cmd/scratch/main.go:22 +0x77\nnet/http.HandlerFunc.ServeHTTP(0xc420148000, 0x12fcf00, 0xc420166000, 0xc420160100)\n        /usr/local/go/src/net/http/server.go:1947 +0x44\ngithub.com/go-chi/chi.(*Mux).ServeHTTP(0xc4201180c0, 0x12fcf00, 0xc420166000, 0xc420160000)\n        /Users/lthibault/go/src/github.com/go-chi/chi/mux.go:81 +0x221\nnet/http.serverHandler.ServeHTTP(0xc420150000, 0x12fcf00, 0xc420166000, 0xc420160000)\n        /usr/local/go/src/net/http/server.go:2694 +0xbc\nnet/http.(*conn).serve(0xc42014a0a0, 0x12fd1c0, 0xc42014c080)\n        /usr/local/go/src/net/http/server.go:1830 +0x651\ncreated by net/http.(*Server).Serve\n        /usr/local/go/src/net/http/server.go:2795 +0x27b\n</code></pre>\n\n<h1>Inelegant solution</h1>\n\n<p>The problem appears to come from <a href=\"https://github.com/go-chi/chi/blob/master/mux.go#L400\" rel=\"nofollow noreferrer\">Mux.routeHTTP</a>, where an attempt is made to recover a <code>*chi.Context</code> from <code>r.Context()</code>.  It would appear that <code>r.WithContext</code> does not transfer values stored in the request context to the new context.</p>\n\n<p>The obvious (albeit ugly) fix is:</p>\n\n<pre><code>func BindContext(c context.Context) func(http.Handler) http.Handler {\n    return func(h http.Handler) http.Handler {\n        return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            rctx := r.Context().Value(chi.RouteCtxKey).(*chi.Context)\n            c = context.WithValue(c, chi.RouteCtxKey, rctx)\n            h.ServeHTTP(w, r.WithContext(c))\n        })\n    }\n}\n</code></pre>\n\n<p>This works, but leaves me feeling uneasy.  Do I really need to manually transfer each relevant value from <code>r.Context()</code> into the context being passed to <code>r.WithContext()</code>?</p>\n\n<p>There are several failure cases, here:</p>\n\n<ul>\n<li>What happens when there are many different values to be transferred?</li>\n<li>What happens when the context keys aren't exported (as is recommended in Go)?</li>\n<li>What happens if the original context terminates before the one I passed in?</li>\n</ul>\n\n<p>(In few words:  nothing good!)</p>\n\n<h1>My question is as follows</h1>\n\n<p>Is there a standard \"merge\" a context passed to <code>r.WithContext</code> with the exiting context in <code>r.Context</code>?</p>\n"}, {"tags": ["go", "http2"], "comments": [{"owner": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1532528652, "post_id": 51521141, "comment_id": 90011441, "body": "Can you show us what you&#39;ve tried / got so far?"}, {"owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "reply_to_user": {"reputation": 3384, "user_id": 3342835, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/7vBYI.jpg?s=128&g=1", "display_name": "li x", "link": "https://stackoverflow.com/users/3342835/li-x"}, "edited": false, "score": 0, "creation_date": 1532529779, "post_id": 51521141, "comment_id": 90012275, "body": "@lix thanks, I&#39;ve update the question post"}], "answers": [{"tags": [], "owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "is_accepted": true, "score": 2, "last_activity_date": 1532706714, "last_edit_date": 1532706714, "creation_date": 1532533068, "answer_id": 51522840, "question_id": 51521141, "link": "https://stackoverflow.com/questions/51521141/how-to-completely-disable-http-1-x-support/51522840#51522840", "title": "How to completely disable HTTP/1.x support", "body": "<p>After looking into Wireshark more closely I found the problem, it happens because the server didn't send any header frame, so the client cannot continue with more data. Just printing into <code>http.ResponseWriter</code> doesn't ensure its written into the network, it gets buffered instead, so we need to explicitly flush it. </p>\n\n<p>This fixes the problem:</p>\n\n<pre><code>--- main.go 2018-07-25 22:31:44.092823590 +0700\n+++ main2.go    2018-07-25 22:32:50.586179879 +0700\n@@ -43,6 +43,9 @@\n        return\n    }\n    w.Header().Set(\"Content-Type\", \"application/octet-stream\")\n+   w.WriteHeader(200)\n+   f.Flush()\n+\n    fmt.Fprintln(w, \"Hello World, Echo Server\")\n\n    buf := [1024]byte{}\n</code></pre>\n"}], "owner": {"reputation": 119, "user_id": 6039883, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6153802da4d7762f71874509f8c78a4?s=128&d=identicon&r=PG&f=1", "display_name": "win-t", "link": "https://stackoverflow.com/users/6039883/win-t"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 437, "favorite_count": 0, "accepted_answer_id": 51522840, "answer_count": 1, "score": 3, "last_activity_date": 1532706714, "creation_date": 1532528062, "last_edit_date": 1532614050, "question_id": 51521141, "link": "https://stackoverflow.com/questions/51521141/how-to-completely-disable-http-1-x-support", "title": "How to completely disable HTTP/1.x support", "body": "<p>I only want to support HTTP/2 for a new project, the client is not a browser so it's not a problem if we don't support HTTP/1.x at all.</p>\n\n<p>from what I see in <a href=\"http://golang.org/x/net/http2\" rel=\"nofollow noreferrer\">golang.org/x/net/http2</a>. I can use <code>tls.Listen</code> and pass the <code>net.Conn</code> to <code>http2.Server.ServeConn</code>.</p>\n\n<p>But I'm bit confused about how to use <code>http2.Transport</code> here, can anyone give me an example?</p>\n\n<p>Thanks</p>\n\n<p>UPDATE:</p>\n\n<p>This is the server part, pretty simple, it's an echo server</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"net\"\n    \"net/http\"\n\n    \"golang.org/x/net/http2\"\n)\n\nfunc main() {\n    l, err := net.Listen(\"tcp4\", \":1234\")\n    panicIfNotNil(err)\n\n    s := &amp;http2.Server{}\n    sopt := &amp;http2.ServeConnOpts{\n        BaseConfig: &amp;http.Server{},\n        Handler:    http.HandlerFunc(handler),\n    }\n    for {\n        c, err := l.Accept()\n        panicIfNotNil(err)\n        go serve(s, sopt, c)\n    }\n}\n\nfunc serve(s *http2.Server, sopt *http2.ServeConnOpts, c net.Conn) {\n    defer c.Close()\n    s.ServeConn(c, sopt)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    if r.ProtoMajor != 2 {\n        w.WriteHeader(500)\n        fmt.Fprintln(w, \"Not HTTP/2\")\n        return\n    }\n    f, ok := w.(http.Flusher)\n    if !ok {\n        w.WriteHeader(500)\n        fmt.Fprintln(w, \"Not Flusher\")\n        return\n    }\n    w.Header().Set(\"Content-Type\", \"application/octet-stream\")\n    fmt.Fprintln(w, \"Hello World, Echo Server\")\n\n    buf := [1024]byte{}\n    for {\n        n, err := r.Body.Read(buf[:])\n        if err == io.EOF {\n            break\n        }\n        panicIfNotNil(err)\n        _, err = w.Write(buf[:n])\n        f.Flush()\n        panicIfNotNil(err)\n    }\n}\n\nfunc panicIfNotNil(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>tested with <code>curl --http2-prior-knowledge http://127.0.0.1:1234 -d a=b -d c=d -d e=f</code></p>\n\n<p>for the client part, I'm still trying, I will update this post again when I got something.</p>\n\n<p>UPDATE:</p>\n\n<p>for the sake of simplicity, I don't use TLS here</p>\n\n<p>UPDATE: </p>\n\n<p>This is the client part</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n    \"io\"\n    \"net\"\n    \"net/http\"\n    \"net/url\"\n    \"time\"\n\n    \"golang.org/x/net/http2\"\n)\n\nfunc main() {\n    t := &amp;http2.Transport{\n        DialTLS: func(network, addr string, cfg *tls.Config) (net.Conn, error) {\n            return net.Dial(network, addr)\n        },\n        AllowHTTP: true,\n    }\n    c := &amp;http.Client{\n        Transport: t,\n    }\n\n    pr, pw := io.Pipe()\n    req := &amp;http.Request{\n        Method: \"POST\",\n        URL:    mustUrl(\"http://127.0.0.1:1234/\"),\n        Body:   pr,\n    }\n    resp, err := c.Do(req)\n    panicIfNotNil(err)\n    defer resp.Body.Close()\n    if resp.StatusCode != 200 {\n        panic(fmt.Errorf(\"Server return non 200, %d\", resp.StatusCode))\n    }\n\n    wchan := make(chan struct{})\n    go func() {\n        buf := [1024]byte{}\n        for {\n            n, err := resp.Body.Read(buf[:])\n            if err == io.EOF {\n                break\n            }\n            panicIfNotNil(err)\n            fmt.Printf(\"GOT DATA %s\\n\", string(buf[:n]))\n        }\n        close(wchan)\n    }()\n\n    time.Sleep(1 * time.Second)\n    pw.Write([]byte(\"hai AAA\"))\n    time.Sleep(1 * time.Second)\n    pw.Write([]byte(\"hai BBB\"))\n    time.Sleep(1 * time.Second)\n    pw.Write([]byte(\"hai CCC\"))\n    time.Sleep(1 * time.Second)\n    pw.Write([]byte(\"hai CCC\"))\n    time.Sleep(1 * time.Second)\n    pw.Close()\n\n    &lt;-wchan\n}\n\nfunc mustUrl(s string) *url.URL {\n    r, err := url.Parse(s)\n    panicIfNotNil(err)\n    return r\n}\n\nfunc panicIfNotNil(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>but somehow it doesn't work\nYou can see network traffic in <a href=\"https://imgur.com/EJV0uGI\" rel=\"nofollow noreferrer\">https://imgur.com/EJV0uGI</a></p>\n"}, {"tags": ["go", "concurrency", "channel"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 1, "creation_date": 1532527613, "post_id": 51520830, "comment_id": 90010692, "body": "Instead of adding to <code>wg</code> one by one, do something like <code>wg.Add(items)</code>after initialization of the WaitGroup. This is not what you are asking but this might create a hard to catch bug, as &quot;items+1&quot; different go routines are accessing the wg variable."}, {"owner": {"reputation": 835, "user_id": 1105727, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/Ys5Bh.jpg?s=128&g=1", "display_name": "Charles Bryant", "link": "https://stackoverflow.com/users/1105727/charles-bryant"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1532527929, "post_id": 51520830, "comment_id": 90010918, "body": "Thanks for that, I am not sure my example fully illustrates what I am doing, I will be reading quite large files, so it will be buffered line by line"}], "answers": [{"comments": [{"owner": {"reputation": 835, "user_id": 1105727, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/Ys5Bh.jpg?s=128&g=1", "display_name": "Charles Bryant", "link": "https://stackoverflow.com/users/1105727/charles-bryant"}, "edited": false, "score": 0, "creation_date": 1532634971, "post_id": 51523352, "comment_id": 90060894, "body": "Ah thanks for this example, I thought how I had used <code>sem &lt;- true</code> blocked go routines from being generated to the length of the channel and when the work had been completed I return into the channel to allow another go routine to be generated."}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 4, "last_activity_date": 1532534752, "creation_date": 1532534752, "answer_id": 51523352, "question_id": 51520830, "link": "https://stackoverflow.com/questions/51520830/golang-concurrency-processing-batches-of-items/51523352#51523352", "title": "Golang concurrency, processing batches of items", "body": "<p>Your code looks fine, you implement commonly used in Go pattern. The downside is - you spawn worker goroutine for every item. Spawning goroutine while cheap isn't free. Another approach is to spawn N workers and provide them items thru channel. Something like this</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    items := 100\n    concurrency := 10\n    in := make(chan int)\n    ret := make(chan error)\n\n    for x := 0; x &lt; concurrency; x++ {\n        go worker(in, ret)\n    }\n    go func() {\n        for x := 0; x &lt; items; x++ {\n            // loop over all items\n            in &lt;- x\n        }\n        close(in)\n    }()\n    for err := range ret {\n        if err != nil {\n            fmt.Println(err.Error())\n            break\n        }\n    }\n}\nfunc worker(in chan int, returnChan chan error) {\n    //fmt.Printf(\"PROCESSING (%v)\\n\", x)\n    for x := range in {\n        if x == 95 {\n            returnChan &lt;- fmt.Errorf(\"Something not right\")\n        } else {\n            returnChan &lt;- nil\n        }\n        time.Sleep(10 * time.Millisecond)\n    }\n    returnChan &lt;- fmt.Errorf(\"The End\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/V160Sn5OHgN\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 835, "user_id": 1105727, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/Ys5Bh.jpg?s=128&g=1", "display_name": "Charles Bryant", "link": "https://stackoverflow.com/users/1105727/charles-bryant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3821, "favorite_count": 1, "accepted_answer_id": 51523352, "answer_count": 1, "score": 0, "last_activity_date": 1532534752, "creation_date": 1532527172, "question_id": 51520830, "link": "https://stackoverflow.com/questions/51520830/golang-concurrency-processing-batches-of-items", "title": "Golang concurrency, processing batches of items", "body": "<p>I am writing a program to process millions of lines from a text file, 500k was taking 5seconds to validate the file, I wanted to speed this up.</p>\n\n<p>I wanted to loop over the items and process x of them async, then wait for the response to see whether I should continue.</p>\n\n<p>I have written some dummy code, I am not sure whether or not what I have written makes much sense, it just seems rather complicated, is there a simpler more elegant way of doing this.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n    // Need an object to loop over\n    // need a loop to read the response\n    items := 100000\n    concurrency := 20\n    sem := make(chan bool, concurrency)\n    returnChan := make(chan error)\n    finChan := make(chan bool)\n\n    var wg sync.WaitGroup\n\n    go func() {\n        for x := 0; x &lt; items; x++ {\n            // loop over all items\n            // only do maxitems at a time\n            wg.Add(1)\n            sem &lt;- true\n            go delayFunc(x, sem, returnChan, &amp;wg)\n        }\n        wg.Wait()\n        finChan &lt;- true\n    }()\n\n    var err error\n    finished := false\n    for {\n        select {\n        case err = &lt;-returnChan:\n            if err != nil {\n                break\n            }\n        case _ = &lt;-finChan:\n            finished = true\n            break\n        default:\n            continue\n        }\n\n        if err != nil || finished == true {\n            break\n        }\n    }\n    fmt.Println(err)\n}\n\nfunc delayFunc(x int, sem chan bool, returnChan chan error, wg *sync.WaitGroup) {\n    //fmt.Printf(\"PROCESSING (%v)\\n\", x)\n    time.Sleep(10 * time.Millisecond)\n    &lt;-sem // release the lock\n    wg.Done()\n    if x == 95000 {\n        returnChan &lt;- fmt.Errorf(\"Something not right\")\n    } else {\n        returnChan &lt;- nil\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "design-patterns", "concurrency"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526323, "post_id": 51520480, "comment_id": 90009701, "body": "The main thread (or whatever thread is reading the results) can read the results from the results channel while processing is ongoing, it doesn&#39;t have to wait for all the workers to finish to start handling results."}, {"owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526361, "post_id": 51520480, "comment_id": 90009735, "body": "Yes, but at some point it has to stop. How can I know when all workers are done working?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526487, "post_id": 51520480, "comment_id": 90009828, "body": "You know they&#39;re done by using a waitgroup. But you can use the waitgroup to choose when to <i>stop</i> looking for results rather than when to <i>start</i>."}, {"owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526738, "post_id": 51520480, "comment_id": 90010035, "body": "It&#39;s looks like a cleaver solution, but I&#39;ve just checked the docs and there is now way to query the value of the Wg. Maybe I shall using something like an AtomicInteger? Thank you in the mean time :)"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532527079, "post_id": 51520480, "comment_id": 90010293, "body": "Why would you need to query the value? Presumably you don&#39;t want to stop reading results until all the workers are finished, which is exactly what Done() is for."}, {"owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532527183, "post_id": 51520480, "comment_id": 90010377, "body": "Because <code>Done()</code> is a blocking call - I would do something like <code>while wg.value &gt; 0: receiveResults()</code>. Maybe you can add an answer with a small example so I can also accept it?"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1532527256, "post_id": 51520480, "comment_id": 90010433, "body": "You iterate (range) over channel until it is closed, so no need to know in advance how many items it contains."}, {"owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "edited": false, "score": 0, "creation_date": 1532527443, "post_id": 51520480, "comment_id": 90010578, "body": "<code>for i:= range chan</code> is a blocking call. It goes on until someone don&#39;t close the channel. And it should be closed by the thread who created it."}], "answers": [{"comments": [{"owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "edited": false, "score": 0, "creation_date": 1532527570, "post_id": 51520930, "comment_id": 90010665, "body": "that&#39;s great! Thank you very much"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1532527572, "last_edit_date": 1532527572, "creation_date": 1532527466, "answer_id": 51520930, "question_id": 51520480, "link": "https://stackoverflow.com/questions/51520480/concurrency-pattern-worker-with-variable-number-of-results/51520930#51520930", "title": "Concurrency pattern: worker with variable number of results", "body": "<p>You can do something like this:</p>\n\n<pre><code>go func() {\n    wg.Wait()\n    close(results)\n}()\n\nfor res := range results {\n    // Handle results\n}\n</code></pre>\n\n<p>When all your workers finish processing, close the results channel. The process that's reading results will finish and then exit the loop.</p>\n"}], "owner": {"reputation": 2327, "user_id": 2280212, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/IUER1.jpg?s=128&g=1", "display_name": "Federico Ponzi", "link": "https://stackoverflow.com/users/2280212/federico-ponzi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 51520930, "answer_count": 1, "score": 1, "last_activity_date": 1532527572, "creation_date": 1532526231, "last_edit_date": 1532526325, "question_id": 51520480, "link": "https://stackoverflow.com/questions/51520480/concurrency-pattern-worker-with-variable-number-of-results", "title": "Concurrency pattern: worker with variable number of results", "body": "<p>I want to create a worker pool in golang, to divide a big task in multiple jobs. </p>\n\n<p>The problem is that the routines may produce multiple output as a result for the computation, so I cannot know in advance how many times I shall iterate over the results channel.</p>\n\n<p>I know that I can use WaitGroup, but I was wondering if there is another pattern I can use, in order to let the main thread advanced on the computation and iterate over the results instead of waiting first every routine to be done.</p>\n\n<p>Another solution I thought, which is not very elegant to me, is to create a <code>Result</code> struct or return an array of results. Since I can count the number of works, I know how many results arrays I'm gonna receive.</p>\n"}, {"tags": ["go", "struct", "reflection", "compare"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526248, "post_id": 51520405, "comment_id": 90009653, "body": "&quot;does not work inside this function&quot; in what way? What problem are you having?"}, {"owner": {"reputation": 1, "user_id": 7410052, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211666428281475/picture?type=large", "display_name": "Carl Aquilina", "link": "https://stackoverflow.com/users/7410052/carl-aquilina"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532526804, "post_id": 51520405, "comment_id": 90010096, "body": "I was trying to convert the map[string]interface{} into a struct but am not experienced enough with reflection so, I could not initialise an object of type A and decode the values from object B into the newly initialised object."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532529085, "post_id": 51520405, "comment_id": 90011757, "body": "&quot;Cloud not&quot; why? What problem specifically are you having - i.e. what is the behavior you&#39;re getting and how is it different from the desired behavior?"}], "owner": {"reputation": 1, "user_id": 7410052, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211666428281475/picture?type=large", "display_name": "Carl Aquilina", "link": "https://stackoverflow.com/users/7410052/carl-aquilina"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 271, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532527797, "creation_date": 1532526002, "last_edit_date": 1532527797, "question_id": 51520405, "link": "https://stackoverflow.com/questions/51520405/how-to-compare-data-using-reflection-between-struct-and-mapstringinterface-i", "title": "How to compare data using Reflection between struct and map[string]interface{} in Golang", "body": "<p>I am trying to compare these two interfaces together as a function. It is working as far as I am concerned. I am sending a struct in A interface{} and map[string]interface{} in B, having the same values but when being compared with reflect they are not resulting to be the same. I would like to be able to convert the map[string]interface{} into a struct interface inside this function so that my tests can get shorter. I have tried using <a href=\"https://github.com/mitchellh/copystructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/copystructure</a>, but does not work inside this function.(from outside it works though:</p>\n\n<pre><code>var m map[string]interface{}\nvar something StructType\nerr := mapstructure.Decode(m, &amp;something)\n</code></pre>\n\n<p>if err....\nand then i send the something in the B interface)</p>\n\n<p>below is the function to compare the interfaces. You can copy and paste and see how it works for yourself</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"reflect\"\n)\n\ntype Something struct {\n    Name string\n    Age  int\n    Male bool\n    Cars []string\n}\n\nfunc main() {\n    var s Something\n    s.Name = \"joe\"\n    s.Male = true\n    s.Age = 20\n    s.Cars = []string{\"Fordd\", \"Chevy\", \"Mazda\"}\n    m := make(map[string]interface{})\n    m[\"Name\"] = \"joe\"\n    m[\"Male\"] = true\n    m[\"Age\"] = 20\n    m[\"Cars\"] = []string{\"Fordd\", \"Chevy\", \"Mazda\"}\n    //with map[string]interface{} although the same values it does not work\n    log.Println(\"Are these the same: \", CompareData(s, m))\n    //with struct of same type it works\n    var s2 Something\n    s2.Name = \"joe\"\n    s2.Male = true\n    s2.Age = 20\n    s2.Cars = []string{\"Fordd\", \"Chevy\", \"Mazda\"}\n    log.Println(\"Are these the same: \", CompareData(s, s2))\n\n    }\n\nfunc CompareData(A interface{}, B interface{}) bool {\n    a := reflect.ValueOf(A)\n    b := reflect.ValueOf(B)\n    akind := a.Kind().String()\n    bkind := a.Kind().String()\n    if akind == \"slice\" &amp;&amp; bkind == \"slice\" {\n        for i := 0; i &lt; a.Len(); i++ {\n            // log.Println(\"they are sliced\")\n            CompareData(a.Index(i).Interface(), b.Index(i).Interface())\n            // log.Println(\"\\n\", a.Index(i).Interface(), \"\\n\", b.Index(i).Interface())\n        }\n        // t.Fatal(\"this is a slice you need to iterate over the values\")\n    } else {\n        // log.Println(\"\\n\\n\", A, \"\\n\", B)\n        if !reflect.DeepEqual(a.Interface(), b.Interface()) {\n            log.Println(\"These should be equal\\nSuccessData:\\t\", a.Interface(), \"\\nData:\\t\\t\", b.Interface())\n            return false\n        }\n        // log.Println(\"\\nA:\\t\", A, \"\\nB:\\t\", B)\n    }\n    return true\n}\n</code></pre>\n"}, {"tags": ["go", "go-cdk"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1532524777, "post_id": 51519742, "comment_id": 90008550, "body": "Go cloud is an abstraction over the APIs for <i>using</i> cloud services, not for <i>provisioning</i> them. It is not a competitor to terraform/cloudformation."}], "answers": [{"comments": [{"owner": {"reputation": 2989, "user_id": 1963929, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4rVJ0.jpg?s=128&g=1", "display_name": "Claudiordgz", "link": "https://stackoverflow.com/users/1963929/claudiordgz"}, "edited": false, "score": 0, "creation_date": 1532525030, "post_id": 51519956, "comment_id": 90008726, "body": "&quot;So with go-cloud you could create a tool like terraform&quot;, thank you!"}], "tags": [], "owner": {"reputation": 20521, "user_id": 1135424, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/rvwBS.jpg?s=128&g=1", "display_name": "nbari", "link": "https://stackoverflow.com/users/1135424/nbari"}, "is_accepted": false, "score": 1, "last_activity_date": 1532524812, "creation_date": 1532524812, "answer_id": 51519956, "question_id": 51519742, "link": "https://stackoverflow.com/questions/51519742/how-is-state-handled-in-the-go-cloud/51519956#51519956", "title": "How is state handled in the go cloud?", "body": "<p><a href=\"https://github.com/google/go-cloud\" rel=\"nofollow noreferrer\">go-cloud</a>:</p>\n\n<blockquote>\n  <p>The Go Cloud Project is an initiative that will allow application developers to seamlessly deploy cloud applications on any combination of cloud providers. It does this by providing stable, idiomatic interfaces for common uses like storage and databases. Think database/sql for cloud products.</p>\n</blockquote>\n\n<p><a href=\"https://www.terraform.io/intro/index.html\" rel=\"nofollow noreferrer\">Terraform</a>:</p>\n\n<blockquote>\n  <p>Terraform is a tool for building, changing, and versioning infrastructure safely and efficiently. Terraform can manage existing and popular service providers as well as custom in-house solutions.</p>\n</blockquote>\n\n<p>So with <code>go-cloud</code> you could create a tool like <code>terraform</code> that, for now can provide generic APIs for:</p>\n\n<ul>\n<li>Unstructured binary (blob) storage</li>\n<li>Variables that change at runtime (configuration)</li>\n<li>Connecting to MySQL databases</li>\n<li>Server startup and diagnostics: request logging, tracing, and health checking</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 10913735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bc8885be0cce0ba3f97017e1b3ce4850?s=128&d=identicon&r=PG", "display_name": "user10913735", "link": "https://stackoverflow.com/users/10913735/user10913735"}, "is_accepted": false, "score": 3, "last_activity_date": 1547495366, "creation_date": 1547495366, "answer_id": 54188204, "question_id": 51519742, "link": "https://stackoverflow.com/questions/51519742/how-is-state-handled-in-the-go-cloud/54188204#54188204", "title": "How is state handled in the go cloud?", "body": "<p>Terraform wants to solve the problem of managing and provisioning Cloud services.</p>\n\n<p>Go Cloud wants to solve the problem of using Cloud services in application code.</p>\n\n<p>So, they work well together. For example, the Go Cloud sample guestbook app (<a href=\"https://github.com/google/go-cloud/tree/master/samples/guestbook\" rel=\"nofollow noreferrer\">https://github.com/google/go-cloud/tree/master/samples/guestbook</a>) uses Terraform to provision the resources needed to run the app on various Cloud providers; the application code in the sample has a small amount of provider-specific setup code, but the application logic itself is provider-agnostic.</p>\n"}], "owner": {"reputation": 2989, "user_id": 1963929, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/4rVJ0.jpg?s=128&g=1", "display_name": "Claudiordgz", "link": "https://stackoverflow.com/users/1963929/claudiordgz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1550251308, "creation_date": 1532524243, "last_edit_date": 1550251308, "question_id": 51519742, "link": "https://stackoverflow.com/questions/51519742/how-is-state-handled-in-the-go-cloud", "title": "How is state handled in the go cloud?", "body": "<p>In terraform we get a state file, and CloudFormation also has a notion of a working state. How does <a href=\"https://blog.golang.org/go-cloud\" rel=\"nofollow noreferrer\">go cloud</a> handle the state, do we have to create it ourselves?</p>\n\n<p>For more info on Go Cloud </p>\n\n<ul>\n<li><a href=\"https://github.com/google/go-cloud\" rel=\"nofollow noreferrer\">https://github.com/google/go-cloud</a></li>\n<li><a href=\"https://godoc.org/github.com/google/go-cloud\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/google/go-cloud</a></li>\n</ul>\n"}, {"tags": ["go", "compiler-optimization", "escape-analysis"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1532528066, "last_edit_date": 1532528066, "creation_date": 1532526112, "answer_id": 51520445, "question_id": 51518742, "link": "https://stackoverflow.com/questions/51518742/what-is-the-meaning-of-the-output-from-go-run-gcflags-m-xxx-go/51520445#51520445", "title": "What is the meaning of the output from &#39;go run -gcflags -m xxx.go&#39;", "body": "<blockquote>\n  <p>What does <code>escapes to heap</code> mean? Is it going to heap or not?</p>\n</blockquote>\n\n<p>This means the value indicated in the message <em>leaves the \"boundaries\"</em> of the function, and as such, it cannot be guaranteed what happens with it outside of the function, so if the value is a pointer or reference (but only then), the pointed or referenced value must be allocated on the heap.</p>\n\n<p><strong>You can think of <code>escapes to heap</code> as a debug message, it does not indicate that one of your variables is \"relocated\" to the heap.</strong></p>\n\n<p>So to put it simple, <em>\"escapes to heap\"</em> is analogous to the term: <em>\"it leaves the function\"</em>, or <em>\"it is passed outside of the function\"</em>.</p>\n\n<p>As an example this line:</p>\n\n<pre><code>./variable_heap_stack.go:16:24: *px escapes to heap\n</code></pre>\n\n<p>Says that the value <code>*px</code> is passed outside of the function, namely as an argument to <code>fmt.Printf()</code> in this line:</p>\n\n<pre><code>fmt.Printf(\"x: %d\\n\", *px)\n</code></pre>\n\n<blockquote>\n  <p><code>moved to heap</code>, this means move to heap, right? What's the difference with the above one?</p>\n</blockquote>\n\n<p>This indicates that the compiler decided to move the variable indicated in the message to the heap, because it might be referenced outside of the function, and thus it must survive the function. And since stack-allocated values may become invalid once you return from the function, for the indicated variable to be valid after the function returns, it must be on the heap.</p>\n\n<p><strong><code>Moved to heap</code> is a direct announcement that one of your variables was indeed \"relocated\" to the heap.</strong> Note: \"relocated\" means that the variable will be allocated on the heap in the first place, actual \"relocation\" will not happen in any case.</p>\n\n<blockquote>\n  <p>The <code>y</code> variable is local, no one refer to it after function returns, but there still got a line <code>y escapes to heap</code>, why was that?</p>\n</blockquote>\n\n<p>As mentioned before, this does not mean <code>y</code> is relocated to heap, it only means the value <code>y</code> is passed outside of the function, namely as a parameter to <code>fmt.Printf()</code> in this line:</p>\n\n<pre><code>fmt.Printf(\"y: %d\\n\", y)\n</code></pre>\n\n<p><code>y</code> will not be moved to heap just because of this, there is no need, as it is passed to <code>fmt.Printf()</code> by making a copy of its value, and <code>fmt.Printf()</code> will have no way of reaching your <code>y</code> local variable.</p>\n\n<p><strong>Tip:</strong></p>\n\n<p>You can get more details about optimization decisions and escape analysis by passing <code>-m</code> twice like this:</p>\n\n<pre><code>go run -gcflags='-m -m' variable_heap_stack.go\n</code></pre>\n\n<p>Then the output of this command will be:</p>\n\n<pre><code>./variable_heap_stack.go:8:6: can inline getPointerOfLocalVar as: func() *int { x := 10; return &amp;x }\n./variable_heap_stack.go:14:6: cannot inline heapStackTest: non-leaf function\n./variable_heap_stack.go:15:28: inlining call to getPointerOfLocalVar func() *int { x := 10; return &amp;x }\n./variable_heap_stack.go:22:6: cannot inline main: non-leaf function\n./variable_heap_stack.go:10:9: &amp;x escapes to heap\n./variable_heap_stack.go:10:9:         from ~r0 (return) at ./variable_heap_stack.go:10:2\n./variable_heap_stack.go:9:2: moved to heap: x\n./variable_heap_stack.go:16:24: *px escapes to heap\n./variable_heap_stack.go:16:24:        from ... argument (arg to ...) at ./variable_heap_stack.go:16:12\n./variable_heap_stack.go:16:24:        from *(... argument) (indirection) at ./variable_heap_stack.go:16:12\n./variable_heap_stack.go:16:24:        from ... argument (passed to call[argument content escapes]) at ./variable_heap_stack.go:16:12\n./variable_heap_stack.go:19:13: y escapes to heap\n./variable_heap_stack.go:19:13:        from ... argument (arg to ...) at ./variable_heap_stack.go:19:12\n./variable_heap_stack.go:19:13:        from *(... argument) (indirection) at ./variable_heap_stack.go:19:12\n./variable_heap_stack.go:19:13:        from ... argument (passed to call[argument content escapes]) at ./variable_heap_stack.go:19:12\n./variable_heap_stack.go:15:28: heapStackTest &amp;x does not escape\n./variable_heap_stack.go:16:12: heapStackTest ... argument does not escape\n./variable_heap_stack.go:19:12: heapStackTest ... argument does not escape\nx: 10\ny: 20\n</code></pre>\n"}], "owner": {"reputation": 16010, "user_id": 1568658, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/FPSGe.jpg?s=128&g=1", "display_name": "user218867", "link": "https://stackoverflow.com/users/1568658/user218867"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1806, "favorite_count": 0, "accepted_answer_id": 51520445, "answer_count": 1, "score": 1, "last_activity_date": 1532528203, "creation_date": 1532521204, "last_edit_date": 1532528203, "question_id": 51518742, "link": "https://stackoverflow.com/questions/51518742/what-is-the-meaning-of-the-output-from-go-run-gcflags-m-xxx-go", "title": "What is the meaning of the output from &#39;go run -gcflags -m xxx.go&#39;", "body": "<p>Trying to check whether a local variable is allocated on heap or stack in go program, and can't be sure the meaning of some output from go's gc.</p>\n\n<hr>\n\n<h2>Code</h2>\n\n<p><strong>variable_heap_stack.go:</strong></p>\n\n<pre><code>// variable heap &amp; stack learn,\n// run with:\n//  go run -gcflags -m xxx.go\npackage main\n\nimport \"fmt\"\n\nfunc getPointerOfLocalVar() *int {\n    x := 10 // go will put it into heap,\n    return &amp;x\n}\n\n// heap &amp; stack test,\nfunc heapStackTest() {\n    px := getPointerOfLocalVar()\n    fmt.Printf(\"x: %d\\n\", *px)\n\n    y := 20 // go will put it into stack,\n    fmt.Printf(\"y: %d\\n\", y)\n}\n\nfunc main() {\n    heapStackTest()\n}\n</code></pre>\n\n<p><strong>Execute:</strong></p>\n\n<blockquote>\n  <p>go run -gcflags -m variable_heap_stack.go</p>\n</blockquote>\n\n<p><strong>Output:</strong></p>\n\n<pre><code># command-line-arguments\n./variable_heap_stack.go:8:6: can inline getPointerOfLocalVar\n./variable_heap_stack.go:15:28: inlining call to getPointerOfLocalVar\n./variable_heap_stack.go:10:9: &amp;x escapes to heap\n./variable_heap_stack.go:9:6: moved to heap: x\n./variable_heap_stack.go:16:24: *px escapes to heap\n./variable_heap_stack.go:19:13: y escapes to heap\n./variable_heap_stack.go:15:28: heapStackTest &amp;x does not escape\n./variable_heap_stack.go:16:12: heapStackTest ... argument does not escape\n./variable_heap_stack.go:19:12: heapStackTest ... argument does not escape\nx: 10\ny: 20\n</code></pre>\n\n<hr>\n\n<h2>Questions</h2>\n\n<ul>\n<li>What does <code>escapes to heap</code> mean? Is it going to heap or not?</li>\n<li><code>moved to heap</code>, this means move to heap, right? What's the difference with the above one?</li>\n<li>The <code>y</code> variable is local, no one refer to it after function returns, but there still got a line <code>y escapes to heap</code>, why was that?</li>\n</ul>\n"}, {"tags": ["unit-testing", "go", "mocking", "testify"], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 0, "last_activity_date": 1532516903, "creation_date": 1532516903, "answer_id": 51517397, "question_id": 51517227, "link": "https://stackoverflow.com/questions/51517227/create-a-mock-function/51517397#51517397", "title": "Create a mock function", "body": "<p>The use of a colon here creates a new function-scoped variable with the same name:</p>\n\n<pre><code>connectDB := func(config *Config) string {\n    return \"Mock response\"\n}\n</code></pre>\n\n<p>Remove the colon to assign to the package variable.</p>\n"}, {"tags": [], "owner": {"reputation": 2233, "user_id": 795636, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Upxbt.jpg?s=128&g=1", "display_name": "Aleksej Vasinov", "link": "https://stackoverflow.com/users/795636/aleksej-vasinov"}, "is_accepted": false, "score": 1, "last_activity_date": 1532517851, "creation_date": 1532517851, "answer_id": 51517697, "question_id": 51517227, "link": "https://stackoverflow.com/questions/51517227/create-a-mock-function/51517697#51517697", "title": "Create a mock function", "body": "<p>@jrefior is correct, but I'd suggest to use interface for mocking. Of course, it's up to you, bet for me it is more clear, but more complicated code :)</p>\n\n<pre><code>// lack some fields :)\ntype Config struct {\n}\n\n// Use interface to call Connect method\ntype IConnection interface {\n    Connect(config *Config) string\n}\n\n// Real connection to DB\ntype Connection struct {\n}\n\nfunc (c Connection) Connect(config *Config) string {\n    return \"Inside the connect\"\n}\n\n// Mock connection\ntype MockConnection struct {\n}\n\nfunc (c MockConnection) Connect(config *Config) string {\n    return \"Mock connection\"\n}\n\n// Accepts interface to connect real or mock DB\nfunc Sample(con IConnection) {\n    log.Println(con.Connect(nil))\n}\n\n\nfunc main() {\n    realConnection := Connection{}\n    Sample(realConnection)\n\n    mockConnection := MockConnection{}\n    Sample(mockConnection)\n}\n</code></pre>\n"}], "owner": {"reputation": 1928, "user_id": 4364847, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/pcepW.png?s=128&g=1", "display_name": "MadzQuestioning", "link": "https://stackoverflow.com/users/4364847/madzquestioning"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 51517397, "answer_count": 2, "score": -1, "last_activity_date": 1532517851, "creation_date": 1532516234, "question_id": 51517227, "link": "https://stackoverflow.com/questions/51517227/create-a-mock-function", "title": "Create a mock function", "body": "<p>Hi I would like to test or Mock a certain function and return a Mock response for this. To demonstrate below is my code</p>\n\n<p><strong>Sample.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    log \"github.com/sirupsen/logrus\"\n)\n\nvar connectDB = Connect\n\nfunc Sample() {\n    config := NewConfig()\n    response := connectDB(config)\n    fmt.Println(response)\n    log.Info(response)\n}\n\nfunc Connect(config *Config) string {\n    return \"Inside the connect\"\n}\n</code></pre>\n\n<p>And my test is like this</p>\n\n<p><strong>Sample_test.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"testing\"\n)\n\nfunc TestSample(t *testing.T) {\n\n    oldConnect := connectDB\n    connectDB := func(config *Config) string {\n        return \"Mock response\"\n    }\n    defer func() { connectDB = oldConnect }()\n\n    Sample()\n}\n</code></pre>\n\n<p>So when running <strong>go test</strong> I was expecting to receive and output of <strong>Mock response</strong> but I'm still getting <strong>Inside the connect</strong>. Is there something I'm missing here?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1532520210, "post_id": 51515962, "comment_id": 90005330, "body": "What <i>exactly</i> is &quot;validate a international domain name&quot; ?"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532523115, "post_id": 51515962, "comment_id": 90007408, "body": "Do you simply want to know if it is formatted correctly, or if it exists in the DNS?"}, {"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "edited": false, "score": 0, "creation_date": 1532529194, "post_id": 51515962, "comment_id": 90011841, "body": "Formatted correctly without illegal characters or just jargon."}, {"owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "edited": false, "score": 0, "creation_date": 1532529312, "post_id": 51515962, "comment_id": 90011931, "body": "IDN &gt; <a href=\"https://en.wikipedia.org/wiki/Internationalized_domain_name\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Internationalized_domain_name</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1532531290, "post_id": 51515962, "comment_id": 90013340, "body": "You have to convert it to punycode for govalidator."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": false, "score": 0, "last_activity_date": 1532710124, "creation_date": 1532710124, "answer_id": 51562345, "question_id": 51515962, "link": "https://stackoverflow.com/questions/51515962/best-way-to-validate-international-domain-names-in-go/51562345#51562345", "title": "Best way to validate international domain names in Go", "body": "<p>One possible approach is to use the builtin functions <a href=\"https://golang.org/pkg/net/url/#Parse\" rel=\"nofollow noreferrer\"><code>url.Parse(string)</code></a> and <a href=\"https://golang.org/pkg/net/url/#URL.Hostname\" rel=\"nofollow noreferrer\"><code>url.Hostname()</code></a> along with a regular expression to match sequences of Unicode letters/numbers/marks separated by dots (as represented in the sample data set).</p>\n\n<p>For example:</p>\n\n<pre><code>var domainNamePattern = regexp.MustCompile(`^([\\p{L}\\p{M}\\p{N}_%+-]+\\.)+[\\p{L}\\p{M}\\p{N}]+$`)\n\nfunc main() {\n  ss := []string{\n    `https://evertpot.com/internationalized-domain-names-are-you-ready/`,\n    `http://bogus!.com`,\n    `https://foo1.bar2.com.gah.zip/`,\n    `http://\u0645\u062b\u0627\u0644.\u0625\u062e\u062a\u0628\u0627\u0631`,\n    `http://\u4f8b\u5b50.\u6d4b\u8bd5`,\n    `http://\u4f8b\u5b50.\u6e2c\u8a66`,\n    `http://\u03c0\u03b1\u03c1\u03ac\u03b4\u03b5\u03b9\u03b3\u03bc\u03b1.\u03b4\u03bf\u03ba\u03b9\u03bc\u03ae`,\n    `http://\u0909\u0926\u093e\u0939\u0930\u0923.\u092a\u0930\u0940\u0915\u094d\u0937\u093e`,\n    `http://\u4f8b\u3048.\u30c6\u30b9\u30c8`,\n    `http://\uc2e4\ub840.\ud14c\uc2a4\ud2b8`,\n    `http://\u0645\u062b\u0627\u0644.\u0622\u0632\u0645\u0627\u06cc\u0634\u06cc`,\n    `http://\u043f\u0440\u0438\u043c\u0435\u0440.\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435`,\n  }\n\n  for _, s := range ss {\n    u, err := url.Parse(s)\n    if err != nil || !domainNamePattern.MatchString(u.Hostname()) {\n      bogusPart := s\n      if err == nil {\n        bogusPart = u.Hostname()\n      }\n      fmt.Printf(\"ERROR: invalid URL or hostname %q\\n\", bogusPart)\n      continue\n    }\n    fmt.Printf(\"OK: hostname=%q\\n\", u.Hostname())\n  }\n}\n\n// OK: hostname=\"evertpot.com\"\n// ERROR: invalid URL or hostname \"bogus!.com\"\n// OK: hostname=\"foo1.bar2.com.gah.zip\"\n// OK: hostname=\"\u0645\u062b\u0627\u0644.\u0625\u062e\u062a\u0628\u0627\u0631\"\n// OK: hostname=\"\u4f8b\u5b50.\u6d4b\u8bd5\"\n// OK: hostname=\"\u4f8b\u5b50.\u6e2c\u8a66\"\n// OK: hostname=\"\u03c0\u03b1\u03c1\u03ac\u03b4\u03b5\u03b9\u03b3\u03bc\u03b1.\u03b4\u03bf\u03ba\u03b9\u03bc\u03ae\"\n// OK: hostname=\"\u0909\u0926\u093e\u0939\u0930\u0923.\u092a\u0930\u0940\u0915\u094d\u0937\u093e\"\n// OK: hostname=\"\u4f8b\u3048.\u30c6\u30b9\u30c8\"\n// OK: hostname=\"\uc2e4\ub840.\ud14c\uc2a4\ud2b8\"\n// OK: hostname=\"\u0645\u062b\u0627\u0644.\u0622\u0632\u0645\u0627\u06cc\u0634\u06cc\"\n// OK: hostname=\"\u043f\u0440\u0438\u043c\u0435\u0440.\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435\"\n</code></pre>\n\n<p>Of course, more care should be taken to build the regular expression in such a way that it conforms to any relevant specifications, but this example should be a good starting point.</p>\n"}], "owner": {"reputation": 457, "user_id": 4489733, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/10714df646d369c5a41225156d051cac?s=128&d=identicon&r=PG&f=1", "display_name": "mbudge", "link": "https://stackoverflow.com/users/4489733/mbudge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 810, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532710124, "creation_date": 1532512436, "last_edit_date": 1532690320, "question_id": 51515962, "link": "https://stackoverflow.com/questions/51515962/best-way-to-validate-international-domain-names-in-go", "title": "Best way to validate international domain names in Go", "body": "<p>What is the best way to validate international domain names in Go?</p>\n\n<p><a href=\"https://golang.org/pkg/net/?m=all#isDomainName\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/?m=all#isDomainName</a></p>\n\n<p><a href=\"https://golang.org/src/net/dnsclient.go?s=3444:3476#L109\" rel=\"nofollow noreferrer\">https://golang.org/src/net/dnsclient.go?s=3444:3476#L109</a></p>\n\n<p>Maybe copying this function which isn't exported from net package?</p>\n\n<p>We need to validate domains like icaan.org and example.(special characters)</p>\n\n<p>EDIT: IDN <a href=\"https://en.wikipedia.org/wiki/Internationalized_domain_name\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Internationalized_domain_name</a></p>\n\n<p>Already using govalidator which fails to validate IDN's as it doesn't handle unicode characters <a href=\"https://github.com/asaskevich/govalidator/blob/master/validator.go\" rel=\"nofollow noreferrer\">https://github.com/asaskevich/govalidator/blob/master/validator.go</a></p>\n\n<p>Here are some examples of IDN's</p>\n\n<ul>\n<li><a href=\"https://evertpot.com/internationalized-domain-names-are-you-ready/\" rel=\"nofollow noreferrer\">https://evertpot.com/internationalized-domain-names-are-you-ready/</a></li>\n<li><a href=\"http://%D9%85%D8%AB%D8%A7%D9%84.%D8%A5%D8%AE%D8%AA%D8%A8%D8%A7%D8%B1\" rel=\"nofollow noreferrer\">http://\u0645\u062b\u0627\u0644.\u0625\u062e\u062a\u0628\u0627\u0631</a> - Arabic.</li>\n<li><a href=\"http://%E4%BE%8B%E5%AD%90.%E6%B5%8B%E8%AF%95\" rel=\"nofollow noreferrer\">http://\u4f8b\u5b50.\u6d4b\u8bd5</a> - Chinese (simplified)</li>\n<li><a href=\"http://%E4%BE%8B%E5%AD%90.%E6%B8%AC%E8%A9%A6\" rel=\"nofollow noreferrer\">http://\u4f8b\u5b50.\u6e2c\u8a66</a> - Chinese (traditional)</li>\n<li><a href=\"http://%CF%80%CE%B1%CF%81%CE%AC%CE%B4%CE%B5%CE%B9%CE%B3%CE%BC%CE%B1.%CE%B4%CE%BF%CE%BA%CE%B9%CE%BC%CE%AE\" rel=\"nofollow noreferrer\">http://\u03c0\u03b1\u03c1\u03ac\u03b4\u03b5\u03b9\u03b3\u03bc\u03b1.\u03b4\u03bf\u03ba\u03b9\u03bc\u03ae</a> - greek</li>\n<li><a href=\"http://%E0%A4%89%E0%A4%A6\" rel=\"nofollow noreferrer\">http://\u0909\u0926</a>\u093e\u0939\u0930\u0923.\u092a\u0930\u0940\u0915\u094d\u0937\u093e Hindi</li>\n<li><a href=\"http://%E4%BE%8B%E3%81%88.%E3%83%86%E3%82%B9%E3%83%88\" rel=\"nofollow noreferrer\">http://\u4f8b\u3048.\u30c6\u30b9\u30c8</a> - Japanese</li>\n<li><a href=\"http://%EC%8B%A4%EB%A1%80.%ED%85%8C%EC%8A%A4%ED%8A%B8\" rel=\"nofollow noreferrer\">http://\uc2e4\ub840.\ud14c\uc2a4\ud2b8</a> - Korean</li>\n<li><a href=\"http://%D9%85%D8%AB%D8%A7%D9%84.%D8%A2%D8%B2%D9%85%D8%A7%DB%8C%D8%B4%DB%8C\" rel=\"nofollow noreferrer\">http://\u0645\u062b\u0627\u0644.\u0622\u0632\u0645\u0627\u06cc\u0634\u06cc</a> - Persian</li>\n<li><a href=\"http://%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80.%D0%B8%D1%81%D0%BF%D1%8B%D1%82%D0%B0%D0%BD%D0%B8%D0%B5\" rel=\"nofollow noreferrer\">http://\u043f\u0440\u0438\u043c\u0435\u0440.\u0438\u0441\u043f\u044b\u0442\u0430\u043d\u0438\u0435</a> - Russian</li>\n</ul>\n\n<p>Just seen the reference to punycode. </p>\n\n<p>Though all these punycode's are in the public suffix list <a href=\"https://publicsuffix.org/list/public_suffix_list.dat\" rel=\"nofollow noreferrer\">https://publicsuffix.org/list/public_suffix_list.dat</a></p>\n\n<p>:(</p>\n"}, {"tags": ["http", "go", "response", "goroutine"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532509658, "post_id": 51514982, "comment_id": 89998332, "body": "Once the response is written you can&#39;t change it. One thing you can do is use the data before sending the response and then change it afterwards"}, {"owner": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532514116, "post_id": 51514982, "comment_id": 90001372, "body": "thanx himanshu. More specifically when the json.NewEncoder().Encode line will execute in function?"}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "edited": false, "score": 0, "creation_date": 1532512671, "post_id": 51515210, "comment_id": 90000431, "body": "thanx @icza. But more specifically i want to that can we write response on &quot;w&quot; of json.NewEncode(w) before or in middle of  execution of the function so that complete code after that line should also be excuted but response should have been already written on &quot;w&quot;. (let me clear this that code after that point is not related to response)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "edited": false, "score": 0, "creation_date": 1532512766, "post_id": 51515210, "comment_id": 90000504, "body": "@RohitGhule Yes, and my suggested solution allows you to do just that."}, {"owner": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "edited": false, "score": 0, "creation_date": 1532520146, "post_id": 51515210, "comment_id": 90005277, "body": "Thank you @icza. It works exactly as per my requirement."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "edited": false, "score": 0, "creation_date": 1532520318, "post_id": 51515210, "comment_id": 90005411, "body": "@RohitGhule Then consider accepting and upvoting the answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1532513388, "last_edit_date": 1532513388, "creation_date": 1532510145, "answer_id": 51515210, "question_id": 51514982, "link": "https://stackoverflow.com/questions/51514982/how-to-send-response-to-the-client-before-executing-the-calculations-that-are-no/51515210#51515210", "title": "How to send response to the client before executing the calculations that are not required in response", "body": "<p>One way would be to do your additional work which is not required for the response in another goroutine:</p>\n\n<pre><code>func someHandler(w http.ResponseWriter, r *http.Request) {\n    go func() {\n        // Do anything here, this won't delay the response\n        // But don't touch the writer or request, as they may not be available here\n    }()\n\n    if err := json.NewEncoder(w).Encode(\"some data\"); err != nil {\n        log.Printf(\"Error sending response: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Note that in the launched gorotuine you can't use the <code>http.ResponseWriter</code> nor the <code>http.Request</code>, as they are only valid to use until you return from your handler. If you need something from them, you must make a copy of the needed parts before you launch the goroutine.</p>\n\n<p>If you want to complete the additional task before you return from the handler, you can still use a goroutine, and use a <code>sync.WaitGroup</code> to wait for it to complete and only then return from the handler. You may or may not flush the response:</p>\n\n<pre><code>func someHandler(w http.ResponseWriter, r *http.Request) {\n    wg := &amp;sync.WaitGroup{}\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n\n        // You may use the writer and request here\n    }()\n\n    if err := json.NewEncoder(w).Encode(\"some data\"); err != nil {\n        log.Printf(\"Error sending response: %v\", err)\n    }\n\n    // Optionally you may flush the data written so far (icnluding HTTP headers)\n    if flusher, ok := w.(http.Flusher); ok {\n        flusher.Flush()\n    }\n\n    wg.Wait()\n}\n</code></pre>\n\n<p>Note that here the goroutine is allowed to use the <code>http.ResponseWriter</code> and <code>http.Request</code>, because the handler does not return until the additional task is completed.</p>\n"}], "owner": {"reputation": 9, "user_id": 9973202, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-DpYOacbbTUk/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq16lA0hy7s6KkHbkU0Tfh7lqAfNig/mo/photo.jpg?sz=128", "display_name": "Rohit Ghule", "link": "https://stackoverflow.com/users/9973202/rohit-ghule"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 756, "favorite_count": 0, "accepted_answer_id": 51515210, "answer_count": 1, "score": 1, "last_activity_date": 1602573606, "creation_date": 1532509498, "last_edit_date": 1602573606, "question_id": 51514982, "link": "https://stackoverflow.com/questions/51514982/how-to-send-response-to-the-client-before-executing-the-calculations-that-are-no", "title": "How to send response to the client before executing the calculations that are not required in response", "body": "<p>Can we send response(or write on user side)with statement like:</p>\n\n<pre><code>json.NewEncoder(w).Encode(\"some data\")\n</code></pre>\n\n<p>in api before doing some calculation part which are not required in response but needed to store in database. I am thinking like we can give response in less time to the user and other part of function will be continue to work until the return statement.</p>\n\n<p>Correct me if I am thinking in wrong direction.</p>\n"}, {"tags": ["go", "divide-by-zero"], "comments": [{"owner": {"reputation": 16907, "user_id": 4832499, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/76532994f6efa8d7dc8a3bb5b7b262a8?s=128&d=identicon&r=PG&f=1", "display_name": "Passer By", "link": "https://stackoverflow.com/users/4832499/passer-by"}, "edited": false, "score": 0, "creation_date": 1532501571, "post_id": 51512496, "comment_id": 89993460, "body": "Constants aren&#39;t floats. There is no infinity constant, hence the error."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 0, "creation_date": 1532501717, "post_id": 51512496, "comment_id": 89993534, "body": "related: <a href=\"https://stackoverflow.com/q/13804255/263525\">stackoverflow.com/q/13804255/263525</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1532501796, "post_id": 51512496, "comment_id": 89993578, "body": "Why? Division by Zero doesn&#39;t make sense. If you want infinity, type math.Inf(1)."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1532502021, "post_id": 51512496, "comment_id": 89993686, "body": "Dividing b a literal 0 is a malformed program, thus a compiler error."}, {"owner": {"reputation": 128, "user_id": 6938528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e47378d6ec9953eef195f56b30fcef1?s=128&d=identicon&r=PG&f=1", "display_name": "jonathan-dev", "link": "https://stackoverflow.com/users/6938528/jonathan-dev"}, "edited": false, "score": 0, "creation_date": 1532502068, "post_id": 51512496, "comment_id": 89993710, "body": "but shouldn&#39;t I be able to compile this? Rust for examle compiles with compiler warnings."}, {"owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1532502272, "post_id": 51512496, "comment_id": 89993816, "body": "warnings are at best a code debt that all coders will have to ignore. Either it&#39;s OK, or it&#39;s an error."}, {"owner": {"reputation": 128, "user_id": 6938528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e47378d6ec9953eef195f56b30fcef1?s=128&d=identicon&r=PG&f=1", "display_name": "jonathan-dev", "link": "https://stackoverflow.com/users/6938528/jonathan-dev"}, "edited": false, "score": 0, "creation_date": 1532502552, "post_id": 51512496, "comment_id": 89993963, "body": "so it is kind of related to the philosophy of go. That there is one way to do certain things (go fmt)?"}], "answers": [{"tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 3, "last_activity_date": 1532519396, "last_edit_date": 1532519396, "creation_date": 1532501654, "answer_id": 51512572, "question_id": 51512496, "link": "https://stackoverflow.com/questions/51512496/go-float-zero-division-compiler-error/51512572#51512572", "title": "go float zero division compiler error", "body": "<p>Golang numeric consts are special. They're not directly mapped to any IEEE754 float type, and they're not able to store infinities or -0 for example.</p>\n\n<p>From <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">the documentation</a>:</p>\n\n<blockquote>\n  <p>Numeric constants represent exact values of arbitrary precision and do not overflow. Consequently, there are no constants denoting the IEEE-754 negative zero, infinity, and not-a-number values.</p>\n</blockquote>\n\n<p>This choice brings some power, as it reduces overflowing in constants:</p>\n\n<pre><code>var x float64 = 1e1000 / 1e999 // yes, this is 10\n</code></pre>\n\n<p>If you need an infinity value you may do</p>\n\n<pre><code>var x float64 = math.Inf(1)\n</code></pre>\n"}], "owner": {"reputation": 128, "user_id": 6938528, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9e47378d6ec9953eef195f56b30fcef1?s=128&d=identicon&r=PG&f=1", "display_name": "jonathan-dev", "link": "https://stackoverflow.com/users/6938528/jonathan-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1808, "favorite_count": 0, "accepted_answer_id": 51512572, "answer_count": 1, "score": 2, "last_activity_date": 1532519396, "creation_date": 1532501385, "question_id": 51512496, "link": "https://stackoverflow.com/questions/51512496/go-float-zero-division-compiler-error", "title": "go float zero division compiler error", "body": "<p>How does this behaviour sense? wouln't it make mor sense to just print an compiler warning instead of an error?</p>\n\n<pre><code>func main() {\nvar y float64 = 0.0\nvar x float64 = 4.0 / y\nfmt.Println(x)\n}\n</code></pre>\n\n<p>+Inf </p>\n\n<pre><code>func main() {\nvar x float64 = 4.0 / 0.0\nfmt.Println(x)\n}\n</code></pre>\n\n<p>prog.go:9:22: division by zero</p>\n"}, {"tags": ["go", "redis", "redigo"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1532501139, "post_id": 51512285, "comment_id": 89993233, "body": "Depends on the implementation of the <code>conn</code>&#39;s <code>Do</code> method."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532501717, "post_id": 51512285, "comment_id": 89993535, "body": "It is better not to ignore errors. But if you don&#39;t want to write this code snippet every time. Create a function to check error."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1532505073, "post_id": 51512285, "comment_id": 89995463, "body": "in that case you can t create helper function to check for error, &#39;cause you still have to return if there is an error."}], "answers": [{"tags": [], "owner": {"reputation": 39563, "user_id": 3160475, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8989da0a2c491338617b07df53e60c?s=128&d=identicon&r=PG", "display_name": "Itamar Haber", "link": "https://stackoverflow.com/users/3160475/itamar-haber"}, "is_accepted": true, "score": 3, "last_activity_date": 1532507162, "creation_date": 1532507162, "answer_id": 51514203, "question_id": 51512285, "link": "https://stackoverflow.com/questions/51512285/should-i-check-error-each-step-on-a-redis-multi-transaction/51514203#51514203", "title": "should I check error each step on a redis multi transaction?", "body": "<p>To transact, you need to <code>Send()</code> each command, and only <code>Do()</code> the EXEC. Error checking should be done for the <code>Do()</code> only, like so:</p>\n\n<pre><code>conn.Send(\"MULTI\")\nconn.Send(\"SET\", \"foo\", \"bar\")\n...\nreply, err := conn.Do(\"EXEC\")\nif err != nil {\n    ...\n}\n...\n</code></pre>\n"}], "owner": {"reputation": 400, "user_id": 1106612, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/46e840010ff434c4b4333dfc3f733af4?s=128&d=identicon&r=PG", "display_name": "ruandao", "link": "https://stackoverflow.com/users/1106612/ruandao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 249, "favorite_count": 0, "accepted_answer_id": 51514203, "answer_count": 1, "score": 1, "last_activity_date": 1532507162, "creation_date": 1532500575, "last_edit_date": 1532506684, "question_id": 51512285, "link": "https://stackoverflow.com/questions/51512285/should-i-check-error-each-step-on-a-redis-multi-transaction", "title": "should I check error each step on a redis multi transaction?", "body": "<p>should I check error each step on a redis multi transaction? if some error happen, was it mean, the release command will also return error?</p>\n\n<p>eg. can I :</p>\n\n<pre><code> conn.Do(\"multi\")\n conn.Do(\"set\", \"mm\", \"xx\")\n reply, err := conn.Do(\"exec\")\n if err != nil {\n      ....\n  }\n</code></pre>\n\n<p>or, should i :</p>\n\n<pre><code>  _, err := conn.Do(\"multi\")\n if err != nil {\n     ....\n     return\n }\n_, err := conn.Do(\"set\", \"mm\", \"xx\")\nif err != nil {\n     ....\n    return\n }\n reply, err := conn.Do(\"exec\")\nif err != nil {\n    ....\n   return\n }\n</code></pre>\n"}, {"tags": ["nginx", "go", "mattermost"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1532498188, "post_id": 51509478, "comment_id": 89991847, "body": "All-in-all, the error looks bad: as if someone did not check a connection actually succeeded and went on dereferencing a <code>nil</code> pointer."}, {"owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1532501532, "post_id": 51509478, "comment_id": 89993438, "body": "It&#39;s not as bad as it looks :-) It&#39;s just a starter demo app. The demo was set up for HTTP and I had a requirement to get it working under HTTPS."}], "answers": [{"tags": [], "owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "is_accepted": true, "score": 7, "last_activity_date": 1532484861, "last_edit_date": 1532484861, "creation_date": 1532481792, "answer_id": 51509617, "question_id": 51509478, "link": "https://stackoverflow.com/questions/51509478/what-is-the-protocol-for-a-secure-websocket/51509617#51509617", "title": "What is the protocol for a secure websocket?", "body": "<p>Normal websocket uses \"ws://example.com\"</p>\n\n<p>Secure websocket uses \"wss://example.com\"</p>\n\n<p>Note that some frameworks automatically handle this for you if you just leave off the ws: or wss: entirely.</p>\n"}], "owner": {"reputation": 4103, "user_id": 162358, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/I2kN6.jpg?s=128&g=1", "display_name": "Keith John Hutchison", "link": "https://stackoverflow.com/users/162358/keith-john-hutchison"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 441, "favorite_count": 0, "accepted_answer_id": 51509617, "answer_count": 1, "score": 1, "last_activity_date": 1532484861, "creation_date": 1532480496, "question_id": 51509478, "link": "https://stackoverflow.com/questions/51509478/what-is-the-protocol-for-a-secure-websocket", "title": "What is the protocol for a secure websocket?", "body": "<p>We've installed a Mattermost server and it works well.</p>\n\n<p>We can only connect via http. Https gives an error.</p>\n\n<p>The line of code that fails is </p>\n\n<pre><code>webSocketClient, err := model.NewWebSocketClient4(\"ws://mattermost.example.com\", client.AuthToken)\n\nmake run\ngo run   *.go\nMattermost Bot Sample\nServer detected and is running version 5.1.0\nWe failed to connect to the web socket\n    Error Details:\n        model.websocket_client.connect_fail.app_error\n        model.websocket_client.connect_fail.app_error\n        websocket: bad handshake\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x58 pc=0x13e1e55]\n</code></pre>\n\n<p>We opened up the http port 8065 and when we connect to port 8065, without ssl, it works.</p>\n\n<pre><code>webSocketClient, err := model.NewWebSocketClient4(\"ws://mattermost.example.com:8065\", client.AuthToken)\n</code></pre>\n\n<p>What is the protocol for a secure websocket?</p>\n"}, {"tags": ["go", "types"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1532470784, "creation_date": 1532470784, "answer_id": 51508322, "question_id": 51508246, "link": "https://stackoverflow.com/questions/51508246/changing-a-types-underlying-value-via-a-method-in-golang/51508322#51508322", "title": "Changing a Type&#39;s Underlying Value via a Method in Golang", "body": "<p>You're assigning a new pointer value to <code>f</code> instead of dereferencing it.</p>\n\n<p>Dereference <code>f</code> and assign a new string value:</p>\n\n<pre><code>func (f *Foo) ChangeMe() {\n    *f = Foo(\"Hello World\")\n}\n</code></pre>\n"}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 0, "accepted_answer_id": 51508322, "answer_count": 1, "score": 0, "last_activity_date": 1532470784, "creation_date": 1532470272, "question_id": 51508246, "link": "https://stackoverflow.com/questions/51508246/changing-a-types-underlying-value-via-a-method-in-golang", "title": "Changing a Type&#39;s Underlying Value via a Method in Golang", "body": "<p>Can an instance of a go type change its underlying value?  Thanks to a <a href=\"https://stackoverflow.com/questions/51507950/can-an-instance-of-a-go-type-change-its-underlying-value\">previous question</a> I know I can <a href=\"https://stackoverflow.com/questions/40953040/why-does-the-setage-method-not-set-the-age-correctly\">make my function's receiver a pointer and change struct fields</a> if my type is a struct.</p>\n\n<p>However, I'm interesting in changing the underlying type's value.  Consider a small program like this</p>\n\n<pre><code>type Foo string\n\nfunc (f *Foo) ChangeMe() {\n  val := Foo(\"Hello World\")\n  f = &amp;val\n  //fmt.Println(*f)\n}\n\nfunc main() {\n  f := Foo(\"Nope\")\n  f.ChangeMe()\n  fmt.Println(f)\n}\n</code></pre>\n\n<p>My naive assumption was \"OK, I've created a new <code>Foo(\"Hello World\")</code> and then pointed <code>f</code> at it.  Since receiver is a pointer (<code>*Foo</code>), this should change the value in <code>main()</code>.  </p>\n\n<p>However, this does not work.  The above program still prints out \"Nope\"</p>\n\n<p>Interested both in what my incorrect assumption about go are, and any techniques for achieving what I want to do. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1532467510, "post_id": 51507720, "comment_id": 89984544, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/29083806/how-do-i-do-enums-in-golang\">How do I do enums in golang?</a>"}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 2, "creation_date": 1532467562, "post_id": 51507720, "comment_id": 89984563, "body": "If this question is targeted towards Go users, you will have to explain what that code does and preferably show an attempt of your own first."}, {"owner": {"reputation": 20746, "user_id": 1233251, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/cI9GF.png?s=128&g=1", "display_name": "E_net4 says don&#39;t copy that", "link": "https://stackoverflow.com/users/1233251/e-net4-says-dont-copy-that"}, "edited": false, "score": 3, "creation_date": 1532467855, "post_id": 51507720, "comment_id": 89984686, "body": "Also, probably a useful note: Rust enums are actually sum types rather than C-style enums. The suggested duplicate target does not seem to address this."}, {"owner": {"reputation": 722, "user_id": 4854062, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ef4517def80967a55df56522c17789c?s=128&d=identicon&r=PG&f=1", "display_name": "sava", "link": "https://stackoverflow.com/users/4854062/sava"}, "edited": false, "score": 1, "creation_date": 1532467950, "post_id": 51507720, "comment_id": 89984711, "body": "I know how to use Go enums, and I don&#39;t think that&#39;s the way to go. I am interested in matching different types and since I am new to Go I am not sure whether I would use an empty struct as parent or an interface or something else entirely"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 5, "creation_date": 1532468035, "post_id": 51507720, "comment_id": 89984748, "body": "@SavvasSavvides if they all have a common subset of methods, use an explicit interface. Otherwise, use an empty interface. Either way: type switch is your friend."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 1, "creation_date": 1532468149, "post_id": 51507720, "comment_id": 89984809, "body": "something like this: <a href=\"https://play.golang.org/p/DPfbOKVyPk9\" rel=\"nofollow noreferrer\">play.golang.org/p/DPfbOKVyPk9</a>"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1532468306, "post_id": 51507720, "comment_id": 89984862, "body": "you can even make @dave&#39;s example more explicit by embedding his <code>WebEventInterface</code> (which I would call just <code>WebEvent</code> but that&#39;s neither here nor there) in each struct."}, {"owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 1, "creation_date": 1532468307, "post_id": 51507720, "comment_id": 89984863, "body": "Knowing the term &quot;sum type&quot; leads to blog posts <a href=\"https://medium.com/@haya14busa/sum-union-variant-type-in-go-and-static-check-tool-of-switch-case-handling-3bfc61618b1e\" rel=\"nofollow noreferrer\">like this one</a>."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1532503058, "post_id": 51507720, "comment_id": 89994254, "body": "Your question should be rewrote like: <i>How can I have a sum type equivalent in Go?</i>"}, {"owner": {"reputation": 722, "user_id": 4854062, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ef4517def80967a55df56522c17789c?s=128&d=identicon&r=PG&f=1", "display_name": "sava", "link": "https://stackoverflow.com/users/4854062/sava"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1532506292, "post_id": 51507720, "comment_id": 89996148, "body": "@Boiethios yea well, I did not choose the question, it was edited by &quot;moderators&quot; who also added the recommended duplicate answer which is in fact completely irrelevant."}, {"owner": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1532506390, "post_id": 51507720, "comment_id": 89996208, "body": "@SavvasSavvides You put the Rust tag in your question..."}, {"owner": {"reputation": 722, "user_id": 4854062, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ef4517def80967a55df56522c17789c?s=128&d=identicon&r=PG&f=1", "display_name": "sava", "link": "https://stackoverflow.com/users/4854062/sava"}, "reply_to_user": {"reputation": 25137, "user_id": 4498831, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/jDBV2.png?s=128&g=1", "display_name": "Boiethios", "link": "https://stackoverflow.com/users/4498831/boiethios"}, "edited": false, "score": 0, "creation_date": 1532507002, "post_id": 51507720, "comment_id": 89996601, "body": "@Boiethios Which was correctly removed. Were you talking about the tag or the title?"}], "answers": [{"tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 2, "last_activity_date": 1532468597, "creation_date": 1532468597, "answer_id": 51507951, "question_id": 51507720, "link": "https://stackoverflow.com/questions/51507720/what-would-be-the-idiomatic-way-of-achieving-rust-like-type-matching-in-go/51507951#51507951", "title": "What would be the idiomatic way of achieving Rust-like type matching in Go?", "body": "<p>If your WebEvents share a common functionality, define an explicit interface.</p>\n\n<pre><code>type WebEvent interface {\n    Foo()\n    Bar()\n}\n\ntype PageLoad struct{}\n\nfunc (*pl PageLoad) Foo() {\n    // do something\n}\n\nfunc (*pl PageLoad) Bar() {\n    // do something else\n}\n\nfunc Inspect(event WebEvent) {\n    switch event.(type) {\n    case PageLoad:\n        // inside this block you're operating on event.(PageLoad), not just event.(WebEvent)!\n    }\n}\n</code></pre>\n\n<p>Otherwise you can use an empty interface</p>\n\n<pre><code>type PageLoad struct{}  // optionally with methods as above\n\nfunc Inspect(event interface{}) {\n    switch event.(type) {\n    case PageLoad:\n        // similarly, in here event is a PageLoad, not an interface{}\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 722, "user_id": 4854062, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/8ef4517def80967a55df56522c17789c?s=128&d=identicon&r=PG&f=1", "display_name": "sava", "link": "https://stackoverflow.com/users/4854062/sava"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 0, "accepted_answer_id": 51507951, "answer_count": 1, "score": -2, "last_activity_date": 1532469017, "creation_date": 1532467370, "last_edit_date": 1532469017, "question_id": 51507720, "link": "https://stackoverflow.com/questions/51507720/what-would-be-the-idiomatic-way-of-achieving-rust-like-type-matching-in-go", "title": "What would be the idiomatic way of achieving Rust-like type matching in Go?", "body": "<p>I understand that Go does not support enums of the kind shown in the Rust example below. What would be the idiomatic way of achieving the same effect, i.e., perform matching on types, in Go? For example, would I use an empty struct or an interface?</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>enum WebEvent {\n    PageLoad,\n    KeyPress(char),\n}\n\nfn inspect(event: WebEvent) {\n    match event {\n        WebEvent::PageLoad =&gt; println!(\"page loaded\"),\n        WebEvent::KeyPress(c) =&gt; println!(\"pressed '{}'.\", c),\n    }\n}\n</code></pre>\n\n<p>Example taken from <a href=\"https://doc.rust-lang.org/rust-by-example/custom_types/enum.html\" rel=\"nofollow noreferrer\">Rust By Example</a>.</p>\n"}, {"tags": ["go", "dll"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 1, "last_activity_date": 1532467489, "creation_date": 1532467489, "answer_id": 51507748, "question_id": 51507398, "link": "https://stackoverflow.com/questions/51507398/how-can-i-find-procedure-from-a-dll-using-its-ordinal-value/51507748#51507748", "title": "How can I find procedure from a DLL using its ordinal value?", "body": "<p>There is <a href=\"https://github.com/golang/go/issues/16507\" rel=\"nofollow noreferrer\">a github issue here</a> for this, but it seems not to have been merged as of Go 1.10.3 (the version I am using right now).</p>\n\n<p>Anyway, the github issue links to <a href=\"https://go-review.googlesource.com/c/sys/+/70690/5/windows/syscall_windows.go#208\" rel=\"nofollow noreferrer\">a changeset with the respective function</a> from which I extracted the code to do what you want here:</p>\n\n<pre><code>var (\n    kernel32           = syscall.NewLazyDLL(\"kernel32.dll\")\n    procGetProcAddress = kernel32.NewProc(\"GetProcAddress\")\n)\n\n// GetProcAddressByOrdinal retrieves the address of the exported\n// function from module by ordinal.\nfunc GetProcAddressByOrdinal(module syscall.Handle, ordinal uintptr) (uintptr, error) {\n    r0, _, _ := syscall.Syscall(procGetProcAddress.Addr(), 2, uintptr(module), ordinal, 0)\n    proc := uintptr(r0)\n    if proc == 0 {\n        return 0, syscall.EINVAL\n    }\n    return proc, nil\n}\n</code></pre>\n\n<p>For completeness, here is the full example with which I tested this, using the Dependecy Walker I found that the first function in kernel32.dll is <code>AcquireSRWLockExclusive</code> and using the new function it shows that the proc addresses really match.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n)\n\nfunc main() {\n    dll, err := syscall.LoadDLL(\"kernel32.dll\")\n    check(err)\n\n    want, err := syscall.GetProcAddress(dll.Handle, \"AcquireSRWLockExclusive\")\n    check(err)\n    fmt.Println(want)\n\n    first, err := GetProcAddressByOrdinal(dll.Handle, 1)\n    check(err)\n    fmt.Println(first)\n}\n\nfunc check(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n\nvar (\n    kernel32           = syscall.NewLazyDLL(\"kernel32.dll\")\n    procGetProcAddress = kernel32.NewProc(\"GetProcAddress\")\n)\n\n// GetProcAddressByOrdinal retrieves the address of the exported\n// function from module by ordinal.\nfunc GetProcAddressByOrdinal(module syscall.Handle, ordinal uintptr) (uintptr, error) {\n    r0, _, _ := syscall.Syscall(procGetProcAddress.Addr(), 2, uintptr(module), ordinal, 0)\n    proc := uintptr(r0)\n    if proc == 0 {\n        return 0, syscall.EINVAL\n    }\n    return proc, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 372, "user_id": 2044647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nsoLl.png?s=128&g=1", "display_name": "Tecnologer", "link": "https://stackoverflow.com/users/2044647/tecnologer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 383, "favorite_count": 0, "accepted_answer_id": 51507748, "answer_count": 1, "score": 1, "last_activity_date": 1532467489, "creation_date": 1532465726, "last_edit_date": 1532466505, "question_id": 51507398, "link": "https://stackoverflow.com/questions/51507398/how-can-i-find-procedure-from-a-dll-using-its-ordinal-value", "title": "How can I find procedure from a DLL using its ordinal value?", "body": "<p>I'm trying to call procedure (without name) from a DLL using the ordinal value.</p>\n\n<p>I can use this DLL in C#, setting the <strong>ordinal value</strong> to the property <a href=\"https://msdn.microsoft.com/en-us/library/system.runtime.interopservices.dllimportattribute.entrypoint(v=vs.110).aspx\" rel=\"nofollow noreferrer\"><code>EntryPoint</code></a> of <code>DllImport</code>.</p>\n\n<blockquote>\n  <p>... or you can identify the entry point by its ordinal. Ordinals are prefixed with the # sign, for example, #1. [...]</p>\n</blockquote>\n\n<p>Example in C#:</p>\n\n<pre><code>[DllImport(\"dllname.dll\", EntryPoint = \"#3\", CharSet = CharSet.Unicode, SetLastError = true, CallingConvention = CallingConvention.StdCall)]\npublic static extern int DeviceList(ref IntPtr hDeviceList);\n</code></pre>\n\n<p>When try find the procedure with \"#\" sign in Go, it shows the the following error:</p>\n\n<blockquote>\n  <p>Failed to find #3 procedure in dllname.dll: The specified procedure could not be found.</p>\n</blockquote>\n\n<p>I used <a href=\"https://stackoverflow.com/a/6634722/2044647\"><code>dumpbin</code></a> to show the information of the DLL, no function has a name:</p>\n\n<p><a href=\"https://i.stack.imgur.com/tErCh.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/tErCh.png\" alt=\"dumpbin results\"></a></p>\n\n<p><strong>Is there a way to find a procedure with its ordinal value (like C#)?</strong></p>\n"}, {"tags": ["go", "nlp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1532463770, "post_id": 51506585, "comment_id": 89982925, "body": "Go&#39;s way is the obvious way: <a href=\"https://play.golang.org/p/XPTJ5q_-mSv\" rel=\"nofollow noreferrer\">play.golang.org/p/XPTJ5q_-mSv</a>"}, {"owner": {"reputation": 1376, "user_id": 5368759, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUB19ZQqehM/AAAAAAAAAAI/AAAAAAAAAkQ/t8XfIKGPO34/photo.jpg?sz=128", "display_name": "Fuyang Liu", "link": "https://stackoverflow.com/users/5368759/fuyang-liu"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532464337, "post_id": 51506585, "comment_id": 89983240, "body": "@Peter Thank you Peter, I am new to Go and I heard Go is easy to read. Just would like to get a better taste of Go doing stuff like these, as I am thinking about migrate some project from Java to Go. BTW is it possible to do regular expression operations  in Go?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1532464497, "post_id": 51506585, "comment_id": 89983307, "body": "<a href=\"https://golang.org/pkg/regexp/\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1532464663, "post_id": 51506585, "comment_id": 89983381, "body": "You should take the tour to get a feel for Go: <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">tour.golang.org</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1376, "user_id": 5368759, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUB19ZQqehM/AAAAAAAAAAI/AAAAAAAAAkQ/t8XfIKGPO34/photo.jpg?sz=128", "display_name": "Fuyang Liu", "link": "https://stackoverflow.com/users/5368759/fuyang-liu"}, "edited": false, "score": 0, "creation_date": 1532463976, "post_id": 51506850, "comment_id": 89983009, "body": "Thank you very much. It&#39;s pretty cool that you don&#39;t need to initialise all the zeros in map.  BTW, do you know if it is simple to do make this piece of code run on multiple cores of CPU? Let&#39;s say if the text is super long or there are just too many texts in a very long lists? I know in java one can perhaps uses parallelstream together with some lambdas to achieve that. How to do this in go and is it easy?  If it is not too difficult then I am thinking about migrating a project from java/kotlin in Go."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1532463631, "last_edit_date": 1532463631, "creation_date": 1532463298, "answer_id": 51506850, "question_id": 51506585, "link": "https://stackoverflow.com/questions/51506585/how-to-count-the-appearance-of-each-word-in-text/51506850#51506850", "title": "How to count the appearance of each word in text", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    text := \"This is a big apple tree. I love big big apple! 42\"\n    fields := strings.FieldsFunc(text, func(r rune) bool {\n        return !('a' &lt;= r &amp;&amp; r &lt;= 'z' || 'A' &lt;= r &amp;&amp; r &lt;= 'Z')\n    })\n    words := make(map[string]int)\n    for _, field := range fields {\n        words[strings.ToLower(field)]++\n    }\n    fmt.Println(words)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/6J-ptfCoJ8r\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6J-ptfCoJ8r</a></p>\n\n<p>Output:</p>\n\n<pre><code>map[tree:1 i:1 love:1 this:1 is:1 a:1 big:3 apple:2]\n</code></pre>\n"}], "owner": {"reputation": 1376, "user_id": 5368759, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EUB19ZQqehM/AAAAAAAAAAI/AAAAAAAAAkQ/t8XfIKGPO34/photo.jpg?sz=128", "display_name": "Fuyang Liu", "link": "https://stackoverflow.com/users/5368759/fuyang-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 851, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1532467552, "creation_date": 1532462168, "last_edit_date": 1532467552, "question_id": 51506585, "link": "https://stackoverflow.com/questions/51506585/how-to-count-the-appearance-of-each-word-in-text", "title": "How to count the appearance of each word in text", "body": "<p>Or the question could also be:\nWhat is the Go way of getting bags of words?</p>\n\n<p>For example, if the input is </p>\n\n<p><code>\"This is a big apple tree. I love big big apple! 42\"</code></p>\n\n<p>then how do I get an output of map with count of each word (and, if conveniently, do some simple string parsing along the way such as only keep letters and lower them):</p>\n\n<p><code>{this=1, is=1, a=1, big=3, apple=2, tree=1, i=1, love=1}</code></p>\n\n<hr>\n\n<p>The simple version of some Kotlin code can be like:</p>\n\n<pre><code>fun main(args: Array&lt;String&gt;) {\n    val inputText = \"This is a big apple tree. I love big big apple! 42\"\n\n    val map = inputText.replace(\"[^a-zA-Z]+\".toRegex(), \" \") // only keep letters\n            .trim()\n            .toLowerCase()\n            .split(\" \")\n            .groupingBy { it }\n            .eachCount()\n\n    println(map)\n}\n</code></pre>\n\n<p>gives output <code>{this=1, is=1, a=1, big=3, apple=2, tree=1, i=1, love=1}</code></p>\n\n<p>I would like to know what's the equivalent Golang way of doing something like this.\nHopefully it is fast, easy to read as well.</p>\n"}, {"tags": ["go", "mqtt"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1532460147, "post_id": 51505927, "comment_id": 89981207, "body": "Why don&#39;t you do <code>client.Subscribe(newTopic,...)</code> inside your MessageHandler func ? I&#39;m also curious whether it works or not."}, {"owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1532460474, "post_id": 51505927, "comment_id": 89981347, "body": "@atayenel Will this stop the subscription to <code>&quot;info&quot;</code> and subscribe solely to messages from <code>&quot;info_updates&quot;</code>? I can still give it a try."}, {"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1532461970, "post_id": 51505927, "comment_id": 89982082, "body": "I really don\u2019t know, that\u2019s why I\u2019m curious."}, {"owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "reply_to_user": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1532462739, "post_id": 51505927, "comment_id": 89982447, "body": "@atayenel Okay so I did <code>if integrationResult == &quot;unsuccessful&quot;{ \t\tclient.Subscribe(&quot;data_update&#47;&quot; + deviceID, 0, g) \t}</code> where <code>g</code> is a new <code>messagerHandler</code>. In the new handler I print out the received message from <code>&quot;info_updates&quot;</code> and currently it&#39;s not printing. I&#39;m not sure what the problem is exactly."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1532505806, "post_id": 51505927, "comment_id": 89995852, "body": "opinion based, if possible i would not dynamically subscribe / unsubscribe to a topic. I d be connected all times, i would compare new messages against the current state and do what s needed (requeue, process, forward etc)"}], "answers": [{"tags": [], "owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "is_accepted": false, "score": 0, "last_activity_date": 1532539353, "creation_date": 1532539353, "answer_id": 51524530, "question_id": 51505927, "link": "https://stackoverflow.com/questions/51505927/change-subscribing-topic-during-program-mqtt/51524530#51524530", "title": "Change subscribing topic during program MQTT", "body": "<p>In my <code>message.Handler</code>, I do:</p>\n\n<pre><code>if integrationResult == \"unsuccessful\"{\n        client.Subscribe(\"data_update/\" + deviceID, 0, g)\n    }\n</code></pre>\n\n<p>Where <code>g</code> is a new <code>message.Handler</code>. With this method, I not sure whether the first connection (subscription to <code>info</code>) is disconnected, or whether both connections are open. However, if you are just looking to get messages from a new topic, this a fine way.</p>\n"}], "owner": {"reputation": 341, "user_id": 10071695, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92a8f69678ab50576449ae3c4cdcc0b3?s=128&d=identicon&r=PG&f=1", "display_name": "Ruby", "link": "https://stackoverflow.com/users/10071695/ruby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 211, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532539353, "creation_date": 1532459293, "last_edit_date": 1532459751, "question_id": 51505927, "link": "https://stackoverflow.com/questions/51505927/change-subscribing-topic-during-program-mqtt", "title": "Change subscribing topic during program MQTT", "body": "<p>I have a MQTT Go program that is subscribed to the topic <code>\"info\"</code>, in which I receive a JSON message. I validate that JSON message, and if the validation is successful, I want to start subscribing to a new topic <code>\"info_updates\"</code>. Here is my <strong>subscribing</strong> code: </p>\n\n<pre><code>func Info(){\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt, syscall.SIGTERM)\n\n    opts := MQTT.NewClientOptions().AddBroker(\"tcp://test.mosquitto.org:1883\")\n\n    opts.SetDefaultPublishHandler(f)\n    topic := \"info\" //I want to be able to change this later to \"info_updates\"\n\n    opts.OnConnect = func(c MQTT.Client) {\n        if token := c.Subscribe(topic, 0, f); token.Wait() &amp;&amp; token.Error() != nil {\n            panic(token.Error())\n        }\n    }\n    // Creating new client\n    client := MQTT.NewClient(opts)\n    if token := client.Connect(); token.Wait() &amp;&amp; token.Error() != nil {\n        panic(token.Error())\n    } else {\n        fmt.Printf(\"Connected to server\\n\")\n    }\n    &lt;-c\n\n}\n</code></pre>\n\n<p>Here is the code where I validate the JSON (parts of it):</p>\n\n<pre><code>var f MQTT.MessageHandler = func(client MQTT.Client, msg MQTT.Message) {\nvar integrationResult string\n\n        if JSONValidate(msg.Payload())[0] == \"\"{ //sanity check = successful\n         integrationResult = \"successful\"\n        }else{ //sanity check = unsuccessful\n        integrationResult = \"unsuccessful\"\n        }\n\n//do something here to tell the first function to change subscribing topic if integrationResult = \"successful\"\n\n}\n</code></pre>\n\n<p><strong>Note:</strong> <code>func Info()</code> and <code>MQTT.MessageHandler</code> are in two seperate files. I am stumped on how I can communicate with <code>func Info()</code> to change the topic subscription. Thank you. </p>\n"}, {"tags": ["mongodb", "docker", "go"], "comments": [{"owner": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "edited": false, "score": 0, "creation_date": 1532457705, "post_id": 51505444, "comment_id": 89980047, "body": "Try <code>docker run --net=&quot;host&quot; -d -p 8080:8080 hell:4</code>"}, {"owner": {"reputation": 49, "user_id": 8420318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hz06_ai_rOk/AAAAAAAAAAI/AAAAAAAAAAA/7pvwVEZcmEU/photo.jpg?sz=128", "display_name": "Ahmad Al-Bassyiouni", "link": "https://stackoverflow.com/users/8420318/ahmad-al-bassyiouni"}, "reply_to_user": {"reputation": 2620, "user_id": 6489829, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a56125658a5592143ade081194b89d6f?s=128&d=identicon&r=PG&f=1", "display_name": "Jack Gore", "link": "https://stackoverflow.com/users/6489829/jack-gore"}, "edited": false, "score": 0, "creation_date": 1532457976, "post_id": 51505444, "comment_id": 89980184, "body": "I got: WARNING: Published ports are discarded when using host network mode, as well as a long hash code"}, {"owner": {"reputation": 3670, "user_id": 2135811, "user_type": "registered", "accept_rate": 57, "profile_image": "https://i.stack.imgur.com/hOk6P.jpg?s=128&g=1", "display_name": "Yuva Raj", "link": "https://stackoverflow.com/users/2135811/yuva-raj"}, "edited": false, "score": 0, "creation_date": 1532493180, "post_id": 51505444, "comment_id": 89990266, "body": "Does your MongoDB run in a container?"}], "answers": [{"comments": [{"owner": {"reputation": 49, "user_id": 8420318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hz06_ai_rOk/AAAAAAAAAAI/AAAAAAAAAAA/7pvwVEZcmEU/photo.jpg?sz=128", "display_name": "Ahmad Al-Bassyiouni", "link": "https://stackoverflow.com/users/8420318/ahmad-al-bassyiouni"}, "edited": false, "score": 0, "creation_date": 1532466989, "post_id": 51505863, "comment_id": 89984331, "body": "I just tried that and it didn&#39;t work. I basically made a flag from cmd and passed in my ip address, and the code linked it to the mgo.Dial(etc.). It looked like this <code>docker run -d -p 8080:8080 7b0bbcf671d1 --mongo-url=11.111.11.111</code> And my code accepted it like so: <code>flags.StringVar(&amp;ipAdd,&quot;mongo-url&quot;,&quot;localhost&quot;,&quot;url for mongoDB&quot;) mgo.Dial(ipAdd)</code>"}, {"owner": {"reputation": 49, "user_id": 8420318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hz06_ai_rOk/AAAAAAAAAAI/AAAAAAAAAAA/7pvwVEZcmEU/photo.jpg?sz=128", "display_name": "Ahmad Al-Bassyiouni", "link": "https://stackoverflow.com/users/8420318/ahmad-al-bassyiouni"}, "edited": false, "score": 0, "creation_date": 1532468885, "post_id": 51505863, "comment_id": 89985088, "body": "I also tried docker run -d -p 8080:8080 hell:4 --mongo-url=mongo:11.111.11.111/go/src/db"}], "tags": [], "owner": {"reputation": 319, "user_id": 1274577, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ETsm7.jpg?s=128&g=1", "display_name": "Atila Romero", "link": "https://stackoverflow.com/users/1274577/atila-romero"}, "is_accepted": false, "score": -1, "last_activity_date": 1532459052, "creation_date": 1532459052, "answer_id": 51505863, "question_id": 51505444, "link": "https://stackoverflow.com/questions/51505444/connect-to-a-mongodb-session-from-within-container/51505863#51505863", "title": "Connect to a mongoDB session from within container", "body": "<p>If your mongoDB server is running in your host machine, replace localhost by you host IP.</p>\n"}, {"tags": [], "owner": {"reputation": 66, "user_id": 6400008, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b17ac46aec183d57861da1288c70abb?s=128&d=identicon&r=PG&f=1", "display_name": "R. Daumann", "link": "https://stackoverflow.com/users/6400008/r-daumann"}, "is_accepted": false, "score": 2, "last_activity_date": 1532506651, "creation_date": 1532506651, "answer_id": 51514049, "question_id": 51505444, "link": "https://stackoverflow.com/questions/51505444/connect-to-a-mongodb-session-from-within-container/51514049#51514049", "title": "Connect to a mongoDB session from within container", "body": "<p>I think you should not try to connect to the MongoDB server running on your machine. Think about deploying the whole application lateron you want a MongoDB server running together with your service on some cloud or server. </p>\n\n<p>That problem could be solved by setting up an additional container and link it to your Go Web App. Docker compose can handle this. Just place a docker-compose.yml file in the directory you are executing your <code>docker build</code> in.</p>\n\n<pre><code>version: '3'\n  services:\n    myapp:\n      build: .\n      image: hell:4\n      ports:\n        - 8080:8080\n      links:\n        - mongodb\n      depends_on:\n        - mongodb\n  mongodb:\n    image: mongo:latest\n    ports:\n        - \"27017:27017\"\n    environment:\n        - MONGODB_USER=\"user\" \n        - MONGODB_PASS=\"pass\"\n</code></pre>\n\n<p>Something like this should do it (not tested). You have two services: One for your app that gets build according to your <code>Dockerfile</code> in the directory in which you currently are. Additionally it links to a service called <code>mongodb</code> defined below. The mongodb service is accessible via the service name <code>mongodb</code>.</p>\n"}], "owner": {"reputation": 49, "user_id": 8420318, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Hz06_ai_rOk/AAAAAAAAAAI/AAAAAAAAAAA/7pvwVEZcmEU/photo.jpg?sz=128", "display_name": "Ahmad Al-Bassyiouni", "link": "https://stackoverflow.com/users/8420318/ahmad-al-bassyiouni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1532506651, "creation_date": 1532457323, "last_edit_date": 1532458034, "question_id": 51505444, "link": "https://stackoverflow.com/questions/51505444/connect-to-a-mongodb-session-from-within-container", "title": "Connect to a mongoDB session from within container", "body": "<p>I'm new to learning how to use goLang to build microservices. I had a whole project up and running locally, but when I tried deploying it I ran into a problem. The session I was working with <code>(mgo.Dial(\"localhost\"))</code> was no longer working. When I put this into a docker image, it failed to connect to the local host, which makes sense, since the docker image builds it over a new OS (alpine in my case). I was wondering what I should do to get it to connect.</p>\n\n<p>To be clear, when I was researching this, most people wanted to connect to a mongoDB session that is a docker container, I want to connect to a mongoDB session from within a docker container. Also once I'm ready for deployment I'll be using StatefulSet with kubernetes if that changes anything.</p>\n\n<p>For example, this is what I want my program to be like:</p>\n\n<pre><code>sess, err := mgo.Dial(\"localhost\") //or whatever\nif err != nil {\n   fmt.Println(\"failed to connect\")\nelse {\n   fmt.Println(\"connected\")\n</code></pre>\n\n<p>What I tried doing:\nDockerfile: </p>\n\n<pre><code>FROM alpine:3.6\n\nCOPY /build/app /bin/\nEXPOSE 8080\n\nENTRYPOINT [\"/bin/app\"]\n</code></pre>\n\n<p>In terminal:</p>\n\n<pre><code>docker build -t hell:4 .\ndocker run -d -p 8080:8080 hell:4\n</code></pre>\n\n<p>And as you can expect, it says not connected. Also the port mapping is for the rest of the project, not this part.</p>\n\n<p>Thanks for your help!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532454435, "post_id": 51504706, "comment_id": 89978345, "body": "why don&#39;t you return the value from the function. You are doing it right way just return the value to get the struct and then use it as required."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1532454436, "post_id": 51504706, "comment_id": 89978346, "body": "There is no inheritance in Go (I&#39;m not sure what &quot;inheritance using an interface&quot; could mean, since interfaces implement a form of polymorphism). If you&#39;re looking for inheritance, you&#39;re trying to solve a problem with the wrong tools."}, {"owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "reply_to_user": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532454753, "post_id": 51504706, "comment_id": 89978485, "body": "@Himanshu This is a simplified example of what I&#39;m trying to do. I guess I could grab the values and return them in a map or something. It just seems wasteful when I&#39;m grabbing the same stuff from each struct but I have to copy paste it for each switch option."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532454993, "post_id": 51504706, "comment_id": 89978616, "body": "@jhall1990 This is not possible to check the underlying type of an interface without knowing what type it can contains and then using switch to check. So either you can use map with key as name and value as struct. That way you will know the struct on basis of key and pass it to the function."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 2, "creation_date": 1532456033, "post_id": 51504706, "comment_id": 89979204, "body": "If this is not your real use case, what is. It seems I misunderstood your question, could you elaborate so we are better able to help you?"}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1532460259, "creation_date": 1532460259, "answer_id": 51506157, "question_id": 51504706, "link": "https://stackoverflow.com/questions/51504706/dynamic-type-assertion-golang/51506157#51506157", "title": "Dynamic Type Assertion Golang", "body": "<p>Function structTest(val interface{}) in your code seems to be loosely typed. You pass it an untyped argument and expect it will satisfy some condition (will have field A), it looks strange in any typed language.</p>\n\n<p>Using an interface this kind of polymorphism, in Go, to my mind, can be expressed something like</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\ntype A string\ntype HasA interface {\n    PrintA()\n}\n\nfunc (a A) PrintA() { fmt.Println(a) }\n\ntype struct1 struct {\n    A\n    B string\n}\n\ntype struct2 struct {\n    A\n    C string\n}\n\ntype struct3 struct {\n    A\n    D string\n}\n\nfunc main() {\n    s1 := struct1{}\n    s1.A = \"A\"\n    structTest(s1)\n\n    s2 := struct2{}\n    s2.A = \"A\"\n    structTest(s2)\n\n    s3 := struct3{}\n    s3.A = \"A\"\n    structTest(s3)\n}\n\nfunc structTest(val HasA) {\n\n    switch val.(type) {\n    case struct1:\n        fmt.Println(\"val is struct1\")\n    case struct2:\n        fmt.Println(\"val is struct2\")\n    case struct3:\n        fmt.Println(\"val is struct3\")\n    default:\n        log.Panic(\"not sure what val is.\")\n    }\n\n    val.PrintA()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0v71E07FP1u\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 123, "user_id": 5649747, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df78fab916834fd9856009cf9d9f40?s=128&d=identicon&r=PG&f=1", "display_name": "Siddharth Shishulkar", "link": "https://stackoverflow.com/users/5649747/siddharth-shishulkar"}, "is_accepted": false, "score": 2, "last_activity_date": 1532463779, "creation_date": 1532463779, "answer_id": 51506950, "question_id": 51504706, "link": "https://stackoverflow.com/questions/51504706/dynamic-type-assertion-golang/51506950#51506950", "title": "Dynamic Type Assertion Golang", "body": "<blockquote>\n  <p>I would like to be able to pass in one of 3 known struct types into my function. Then figure out which struct type was passed in to type assert it. Finally I want to be able to access like attributes.</p>\n</blockquote>\n\n<p>You can use type assertions to do exactly that. Basic idea is, in any case of the type switch just use type assertion to get a concrete instance of the corresponding type and then you can call whatever properties that you wish.</p>\n\n<p>Take a look at the following example</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype test1 struct {\n    A, B string\n}\n\ntype test2 struct {\n    A, C string\n}\n\nfunc testType(val interface{}) {\n    switch val.(type) {\n    case test1:\n        t := val.(test1)\n        fmt.Println(t.B)\n        break\n    case test2:\n        t := val.(test2)\n        fmt.Println(t.C)\n        break\n    }\n}\n\nfunc main() {\n    t1, t2 := test1{B: \"hello\"}, test2{C: \"world\"}\n    testType(t1)\n    testType(t2)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9EAHsoqzj41\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}], "owner": {"reputation": 131, "user_id": 5692700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9b2969408288806ee76cbb4a400fbea?s=128&d=identicon&r=PG&f=1", "display_name": "jhall1990", "link": "https://stackoverflow.com/users/5692700/jhall1990"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2212, "favorite_count": 2, "answer_count": 2, "score": 4, "last_activity_date": 1532463779, "creation_date": 1532454228, "question_id": 51504706, "link": "https://stackoverflow.com/questions/51504706/dynamic-type-assertion-golang", "title": "Dynamic Type Assertion Golang", "body": "<p>I'm trying to convert an interface dynamically back to it's original struct but I am having issues accessing attributes of the struct after the conversion.</p>\n\n<p>Take this code for example.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n)\n\ntype struct1 struct {\n    A string\n    B string\n}\n\ntype struct2 struct {\n    A string\n    C string\n}\n\ntype struct3 struct {\n    A string\n    D string\n}\n\nfunc main() {\n    s1 := struct1{}\n    s1.A = \"A\"\n    structTest(s1)\n\n    s2 := struct2{}\n    s2.A = \"A\"\n    structTest(s2)\n\n    s3 := struct3{}\n    s3.A = \"A\"\n    structTest(s3)\n}\n\nfunc structTest(val interface{}) {\n    var typedVal interface{}\n\n    switch v := val.(type) {\n    case struct1:\n        fmt.Println(\"val is struct1\")\n    case struct2:\n        fmt.Println(\"val is struct2\")\n    case struct3:\n        fmt.Println(\"val is struct3\")\n    default:\n        log.Panic(\"not sure what val is.\")\n    }\n\n    fmt.Println(typedVal.A)\n}\n</code></pre>\n\n<p>I would like to be able to pass in one of 3 known struct types into my function. Then figure out which struct type was passed in to type assert it. Finally I want to be able to access like attributes. </p>\n\n<p>Basically I want to have some basic inheritance in my structs, but so far it seems that it is not possible to do this in go. I saw some posts mentioning inheritance using an interface, but my structs have no methods so I'm not sure how I would use an interface.</p>\n\n<p>Is something like this possible in go?</p>\n"}, {"tags": ["http", "go", "proxy", "goroutine"], "comments": [{"owner": {"reputation": 1672, "user_id": 338011, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IhgLu.jpg?s=128&g=1", "display_name": "Baptiste Mille-Mathias", "link": "https://stackoverflow.com/users/338011/baptiste-mille-mathias"}, "edited": false, "score": 0, "creation_date": 1532453710, "post_id": 51504430, "comment_id": 89977925, "body": "Hello, for working code but seeking for performance the question has to moved to <a href=\"https://codereview.stackexchange.com/\">codereview.stackexchange.com</a>. Regards"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532456986, "post_id": 51504430, "comment_id": 89979665, "body": "<a href=\"https://golang.org/pkg/io/#TeeReader\" rel=\"nofollow noreferrer\">golang.org/pkg/io/#TeeReader</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1532464201, "post_id": 51504430, "comment_id": 89983155, "body": "you can shaXX/md5 without keeping all in memory. there is no penalty performance in reading the body, otherwise you can t sum it. for sure you can implement the required pipeline system that does not consume more memory than number of client * buffer size. teereader is useful for this."}], "owner": {"reputation": 1, "user_id": 9260562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56242bd664dec98ca826fd4e5507b16c?s=128&d=identicon&r=PG&f=1", "display_name": "Phuong Vu", "link": "https://stackoverflow.com/users/9260562/phuong-vu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532691644, "creation_date": 1532453217, "last_edit_date": 1532691644, "question_id": 51504430, "link": "https://stackoverflow.com/questions/51504430/forward-proxy-reading-request-and-response-body", "title": "Forward proxy reading request and response body", "body": "<p>I am implementing a forward proxy in Go and I have 2 features that need to do:</p>\n\n<ul>\n<li>Limit upload and download with a maximum configurable size.</li>\n<li>Get md5 and sha256 of download file with a maximum configurable size for DLP purposes</li>\n</ul>\n\n<p>Both of these features require to read request and response body and processing that would affect largely in performance by causing high memory consumption and slow response time for client.</p>\n\n<p>Currently my flow is to <code>ioutil.ReadAll</code> request and response body, get the Body size, md5 and sha256 checksum the response body, finally if we do not blocking anything, put the body back to the origin one for the client</p>\n\n<p>I was wondering if there is any other best practice for handling these kind of things.</p>\n"}, {"tags": ["go", "graphics"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1532453510, "post_id": 51504171, "comment_id": 89977821, "body": "Is it possible? Yes. Pretty much anything is possible, considering that cgo is available."}], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 0, "last_activity_date": 1532455395, "creation_date": 1532455395, "answer_id": 51504979, "question_id": 51504171, "link": "https://stackoverflow.com/questions/51504171/could-i-add-a-caption-over-an-existing-image-using-go/51504979#51504979", "title": "Could I add a caption over an existing image using Go?", "body": "<p>You can use my <a href=\"https://github.com/gonutz/gofont\" rel=\"nofollow noreferrer\">gofont</a> library for that. See <a href=\"https://godoc.org/github.com/gonutz/gofont\" rel=\"nofollow noreferrer\">the documentation</a> for the minimal interface.</p>\n\n<p>You basically call <code>gofont.LoadFromFile(\"font.ttf\")</code> and on the returned <code>Font</code> object, you can set the <code>PixelHeight</code> and <code>R/G/B</code> values to control the draw output.</p>\n\n<p>Call <code>font.Write()</code> on the object to render text into your <code>draw.Image</code>. It is even possible to center text, using the returned x and y values returned by the function.</p>\n\n<p>The library is pure Go and should work on all platforms.</p>\n"}], "owner": {"reputation": 3699, "user_id": 4816175, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/697df6176ef55a7ea25f159e0fcdec38?s=128&d=identicon&r=PG", "display_name": "cool breeze", "link": "https://stackoverflow.com/users/4816175/cool-breeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 63, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1532455395, "creation_date": 1532452190, "question_id": 51504171, "link": "https://stackoverflow.com/questions/51504171/could-i-add-a-caption-over-an-existing-image-using-go", "title": "Could I add a caption over an existing image using Go?", "body": "<p>If I have font files (for different fonts), is it possible to create a caption over  image using Go?</p>\n"}, {"tags": ["go", "botframework"], "comments": [{"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 2, "creation_date": 1532449515, "post_id": 51503204, "comment_id": 89975521, "body": "You could just use the REST API."}, {"owner": {"reputation": 11112, "user_id": 320681, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/53b8e69b89ded4615a6db4a774073983?s=128&d=identicon&r=PG", "display_name": "ylluminate", "link": "https://stackoverflow.com/users/320681/ylluminate"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1532449898, "post_id": 51503204, "comment_id": 89975741, "body": "That&#39;s a good call. While discussing this with others it appears we missed the REST API: <a href=\"https://docs.microsoft.com/en-us/azure/bot-service/rest-api/bot-framework-rest-connector-api-reference\" rel=\"nofollow noreferrer\">docs.microsoft.com/en-us/azure/bot-service/rest-api/&hellip;</a>"}, {"owner": {"reputation": 1622, "user_id": 7794490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb802962d43e5c525380985f4c7b0092?s=128&d=identicon&r=PG&f=1", "display_name": "Steven G.", "link": "https://stackoverflow.com/users/7794490/steven-g"}, "edited": false, "score": 0, "creation_date": 1532639590, "post_id": 51503204, "comment_id": 90062850, "body": "There unfortunately is not a BotBuilder SDK for Go at this time. As Michael indicated, you can use the REST API to use the Bot Framework. Just to illustrate that it&#39;s possible, there is a 3rd party Ruby port <a href=\"https://github.com/tachyons/botframework-ruby\" rel=\"nofollow noreferrer\">here</a>. Also, if you&#39;d like, you can leave feedback on <a href=\"https://github.com/Microsoft/BotBuilder/issues/1214\" rel=\"nofollow noreferrer\">this issue</a> to indicate your interest in BotBuilder support for Go."}, {"owner": {"reputation": 11112, "user_id": 320681, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/53b8e69b89ded4615a6db4a774073983?s=128&d=identicon&r=PG", "display_name": "ylluminate", "link": "https://stackoverflow.com/users/320681/ylluminate"}, "reply_to_user": {"reputation": 1622, "user_id": 7794490, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb802962d43e5c525380985f4c7b0092?s=128&d=identicon&r=PG&f=1", "display_name": "Steven G.", "link": "https://stackoverflow.com/users/7794490/steven-g"}, "edited": false, "score": 0, "creation_date": 1532654434, "post_id": 51503204, "comment_id": 90066524, "body": "@StevenG, thanks. Given your position and understanding, could you please chime in here: <a href=\"https://github.com/42wim/matterbridge/issues/470\" rel=\"nofollow noreferrer\">github.com/42wim/matterbridge/issues/470</a>"}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 1945204, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dcab5c8d6dd78488d58c09bbea3ddb15?s=128&d=identicon&r=PG", "display_name": "Zodraz", "link": "https://stackoverflow.com/users/1945204/zodraz"}, "is_accepted": false, "score": 0, "last_activity_date": 1587682018, "creation_date": 1587682018, "answer_id": 61398227, "question_id": 51503204, "link": "https://stackoverflow.com/questions/51503204/is-go-able-to-be-used-for-the-botframework-sdk-or-does-it-require-porting/61398227#61398227", "title": "Is Go able to be used for the BotFramework SDK or does it require porting?", "body": "<p>As for January 2020 an implemntation has been provided (not officialy by MS):</p>\n\n<p><a href=\"https://www.infracloud.io/microsoft-bot-framwework-sdk-for-go/\" rel=\"nofollow noreferrer\">https://www.infracloud.io/microsoft-bot-framwework-sdk-for-go/</a></p>\n"}], "owner": {"reputation": 11112, "user_id": 320681, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/53b8e69b89ded4615a6db4a774073983?s=128&d=identicon&r=PG", "display_name": "ylluminate", "link": "https://stackoverflow.com/users/320681/ylluminate"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 140, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1587682018, "creation_date": 1532448530, "question_id": 51503204, "link": "https://stackoverflow.com/questions/51503204/is-go-able-to-be-used-for-the-botframework-sdk-or-does-it-require-porting", "title": "Is Go able to be used for the BotFramework SDK or does it require porting?", "body": "<p>I'm in need of using the BotFramework SDK to build a bridge from Skype to Mattermost. As I understand it, we're pretty much limited to using the BotFramework to accomplish this via their SDK, however C# and Node.js are not really an option for this presently in this case.  Is there a way to use Go already with the SDK or does some porting need to be done?</p>\n"}, {"tags": ["go", "data-science", "lapack", "blas", "scientific-computing"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532448706, "post_id": 51503180, "comment_id": 89975050, "body": "optimized packages like BLAS/LAPAC will usually be faster, but you have to test. There are a lot of packages available under gonum: <a href=\"https://godoc.org/gonum.org/v1/gonum\" rel=\"nofollow noreferrer\">godoc.org/gonum.org/v1/gonum</a>"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 1, "creation_date": 1532459634, "post_id": 51503180, "comment_id": 89980991, "body": "Cross-posted: Element-wise operations on slices : <a href=\"https://www.reddit.com/r/golang/comments/91h87u/elementwise_operations_on_slices/\" rel=\"nofollow noreferrer\">reddit.com/r/golang/comments/91h87u/&hellip;</a>"}], "owner": {"reputation": 45, "user_id": 10075237, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-O3dVqu3GwqA/AAAAAAAAAAI/AAAAAAAAADU/z4fyE3YpD_o/photo.jpg?sz=128", "display_name": "Aramus", "link": "https://stackoverflow.com/users/10075237/aramus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 212, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532455624, "creation_date": 1532448438, "question_id": 51503180, "link": "https://stackoverflow.com/questions/51503180/golang-element-wise-division-on-a-slice", "title": "Golang: Element-wise division on a slice", "body": "<p>Element-wise operations are faster in python(through numpy) and matlab (./) than using a for-loop. They use BLAS/LAPAC for this, i think.</p>\n\n<p>Currently im using a for-loop for iterating through a slice. Is it possible to get element-wise operations for slices? Will it be faster then?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1532447514, "post_id": 51502686, "comment_id": 89974272, "body": "There are no digit characters in the string <code>&quot;%s&quot;</code>."}], "answers": [{"tags": [], "owner": {"reputation": 132392, "user_id": 244128, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/300502d6109af88a009074c42ff56c73?s=128&d=identicon&r=PG", "display_name": "maerics", "link": "https://stackoverflow.com/users/244128/maerics"}, "is_accepted": true, "score": 2, "last_activity_date": 1532451697, "creation_date": 1532451697, "answer_id": 51504045, "question_id": 51502686, "link": "https://stackoverflow.com/questions/51502686/regexp-to-find-3-digit-int-in-string/51504045#51504045", "title": "Regexp to find 3 digit int in string", "body": "<p>Check the <a href=\"https://golang.org/pkg/regexp/#Regexp.FindString\" rel=\"nofollow noreferrer\">documentation for <code>regexp.FindString(string)</code></a> to make sure you've got the arguments right; you should be giving it the search string...</p>\n\n<pre><code>re := regexp.MustCompile(`\\d{3}`)\nsearch := \"Vlan xyz site number 777 \"\nmatch := re.FindString(search)\nfmt.Printf(\"OK: %q\\n\", match)\n// OK: \"777\"\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 7898063, "user_type": "registered", "profile_image": "https://graph.facebook.com/10212053749915935/picture?type=large", "display_name": "Scott Tee", "link": "https://stackoverflow.com/users/7898063/scott-tee"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 59, "favorite_count": 0, "accepted_answer_id": 51504045, "answer_count": 1, "score": 0, "last_activity_date": 1532451697, "creation_date": 1532446788, "last_edit_date": 1532450169, "question_id": 51502686, "link": "https://stackoverflow.com/questions/51502686/regexp-to-find-3-digit-int-in-string", "title": "Regexp to find 3 digit int in string", "body": "<p>I have a DNS query that is returning the fields I need, but now I need to parse a 3 digit number from the response.</p>\n\n<p>The reponse block I am parsing looks like this: </p>\n\n<pre><code>_ref: \"network/ZG5zLm5ldHdvcmskMTAuMC45MS4wLzI0LzA:10.0.91.0/24/default\"\n\ncomment: \"Vlan xyz site number 777 \"\n\nnetwork: \"10.0.91.0/24\"\n\nnetwork_view: \"default\"\n</code></pre>\n\n<p>This looked like the right regexp, but I'm not getting a response: </p>\n\n<pre><code>re := regexp.MustCompile(\"[0-9]+\")\nfmt.Println(re.FindAllString(\"%s\", -1))\n</code></pre>\n"}, {"tags": ["database", "postgresql", "go"], "comments": [{"owner": {"reputation": 1740, "user_id": 816210, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2edecdea009bff1d222caf02532855fb?s=128&d=identicon&r=PG", "display_name": "Thomas Berger", "link": "https://stackoverflow.com/users/816210/thomas-berger"}, "edited": false, "score": 0, "creation_date": 1532447192, "post_id": 51502669, "comment_id": 89974081, "body": "Can you please provide the statement executed? You should find it at least in the PostgreSQL Server logfile."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 3, "creation_date": 1532447343, "post_id": 51502669, "comment_id": 89974187, "body": "With postgres use positional parameters e.g. <code>($1, $2, $3, ...)</code>, not question marks. <code>?</code> are a mysql thing."}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1532448229, "post_id": 51502669, "comment_id": 89974733, "body": "@mkopriva: the syntax for parameters is defined by the language (and the driver) running the SQL statements. &quot;SQL&quot; itself has no notion of parameters PL/pgSQL uses indeed <code>$1</code>, but in Java (JDBC) you would need to use <code>?</code> as well."}, {"owner": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 2, "creation_date": 1532448254, "post_id": 51502669, "comment_id": 89974747, "body": "The first step in debugging something like this, is to try to run the statement manual with the SQL client of your choice that usually gives more details on the error"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 434877, "user_id": 330315, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/4b152262d9ba55197f609625358ff7e0?s=128&d=identicon&r=PG", "display_name": "a_horse_with_no_name", "link": "https://stackoverflow.com/users/330315/a-horse-with-no-name"}, "edited": false, "score": 2, "creation_date": 1532448427, "post_id": 51502669, "comment_id": 89974869, "body": "@a_horse_with_no_name I see, my bad for saying it&#39;s postgres/mysql dependent. But it is the case that the &quot;default&quot; drivers for postgres and mysql in Go, do indeed use <code>$N</code> and <code>?</code> respectively."}, {"owner": {"reputation": 2196, "user_id": 724485, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H9qYG.jpg?s=128&g=1", "display_name": "FearlessHyena", "link": "https://stackoverflow.com/users/724485/fearlesshyena"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566250352, "post_id": 51502669, "comment_id": 101589951, "body": "@mkopriva your comment about using ($1, $2, $3) indeed works!!!"}], "owner": {"reputation": 651, "user_id": 6119503, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/c823ba11dd321ef4f4964185f9941a5c?s=128&d=identicon&r=PG&f=1", "display_name": "JC1", "link": "https://stackoverflow.com/users/6119503/jc1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1566, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1532448302, "creation_date": 1532446737, "last_edit_date": 1532448302, "question_id": 51502669, "link": "https://stackoverflow.com/questions/51502669/postgresql-syntax-error-at-or-near", "title": "Postgresql - Syntax Error at or near &quot;,&quot;", "body": "<p>I'm trying to set up a prepared statement and execute it using the <code>database/sql</code> package, but it is giving me this error saying <code>2018/07/24 08:34:44 pq: syntax error at or near \",\"</code>, and I am not sure what I am doing wrong. </p>\n\n<pre><code>db, err := sql.Open(\"postgres\", connStr)\nif err != nil {\n    fmt.Errorf(\"error Connecting to DB\")\n}\n\ndefer db.Close()\n\nstmt, err := db.Prepare(`INSERT INTO \"TEST_TABLE\" (\"pid\", \"name\", \"brand\", \"sku\", url, price, image, \"dateInserted\", \"dateUpdated\") VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?) on conflict (\"pid\") do update set \"dateUpdated\" = EXCLUDED.\"dateUpdated\"`)\ndefer stmt.Close()\n\nif err != nil {\n    log.Fatal(err)\n}\n\n_, err = stmt.Exec(obj.Id, obj.Name, obj.Brand, obj.Sku, obj.Url, obj.Price.Regular, obj.Image, time.Now(), time.Now())\n\nif err != nil {\n    log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": ["shell", "go", "ssh", "pty"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532445729, "post_id": 51502276, "comment_id": 89973026, "body": "<code>io.Copy</code> doesn&#39;t wait for an EOF before it <i>starts</i> copying. It waits for an EOF to know that it&#39;s <i>done</i> copying."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1532445730, "post_id": 51502276, "comment_id": 89973027, "body": "If the output is line buffered, you could just use a scanner. Have you tried just calling <code>Read</code> directly?"}, {"owner": {"reputation": 111, "user_id": 9137052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0165e4b37ac88ceaedc18940b097d0d4?s=128&d=identicon&r=PG&f=1", "display_name": "Xander May", "link": "https://stackoverflow.com/users/9137052/xander-may"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532446581, "post_id": 51502276, "comment_id": 89973652, "body": "@Adrian But nothing appears in the buffers outside the function before it knows that its finished reading the file"}, {"owner": {"reputation": 111, "user_id": 9137052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0165e4b37ac88ceaedc18940b097d0d4?s=128&d=identicon&r=PG&f=1", "display_name": "Xander May", "link": "https://stackoverflow.com/users/9137052/xander-may"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532446774, "post_id": 51502276, "comment_id": 89973795, "body": "@JimB I have tried that using that, and I can, but it will still hang if there is nothing to read. My goal is that if there is nothing to read it will just return an empty string"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532447078, "post_id": 51502276, "comment_id": 89973997, "body": "@XanderMay; that&#39;s not how reading form a connection works. If there&#39;s nothing to read, it blocks until EOF."}, {"owner": {"reputation": 111, "user_id": 9137052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0165e4b37ac88ceaedc18940b097d0d4?s=128&d=identicon&r=PG&f=1", "display_name": "Xander May", "link": "https://stackoverflow.com/users/9137052/xander-may"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532452260, "post_id": 51502276, "comment_id": 89977053, "body": "@JimB Is there any way to see if there is something to read before trying to read it so that I can prevent a block? Or should I throw the reader into a concurrent thing and have it emit a notif whenever it gets something to read (this seems way too complicated but if its the only way...)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532452817, "post_id": 51502276, "comment_id": 89977381, "body": "@XanderMay: no, you can&#39;t see if there&#39;s anything to read, you block until the Read method returns. Concurrency in Go is quite simple, if you have other things to do while you read from the connection, handle the reading in a goroutine."}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1532456907, "post_id": 51502276, "comment_id": 89979631, "body": "instead of using Copy, implement custom byte copy function with terminator based (i.e., new line) or timeout based logic."}], "answers": [{"tags": [], "owner": {"reputation": 380, "user_id": 2562707, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/144239114cfd238694964d1d4a75666c?s=128&d=identicon&r=PG", "display_name": "Joshua Kolden", "link": "https://stackoverflow.com/users/2562707/joshua-kolden"}, "is_accepted": true, "score": 2, "last_activity_date": 1532483248, "creation_date": 1532483248, "answer_id": 51509737, "question_id": 51502276, "link": "https://stackoverflow.com/questions/51502276/golang-copy-from-os-file-without-hanging-on-waiting-for-eof/51509737#51509737", "title": "Golang copy from *os.file without hanging on waiting for EOF", "body": "<p>Think of <code>io.Copy</code> as a convenance function for bulk copying or streams, not the right tool for request/response patterns.</p>\n\n<p>Just accumulate bytes into messages by checking if it matches the message on every byte. Use the Read method directly.</p>\n\n<pre><code>func Expect(message string, r io.Reader) (resp string, err error) {\n    b := []byte{0} // 1 byte buffer\n    var n int\n\n    for err == nil {\n        n, err = r.Read(b)\n        if n == 0 {\n            continue\n        }\n        resp += string(b[0])\n        if strings.HasSuffix(resp, message) {\n            return resp, err\n        }\n    }\n\n    return resp, err\n}\n</code></pre>\n\n<p>In your example you could use this like:</p>\n\n<pre><code>resp, err := Expect(\"Prompt question? \", ptyI.pty)\n</code></pre>\n\n<p>Here's a demonstration of it in action with a simulated connection io.Reader: <a href=\"https://play.golang.org/p/8UJB5oR2mWV\" rel=\"nofollow noreferrer\">playground</a>.  </p>\n"}], "owner": {"reputation": 111, "user_id": 9137052, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0165e4b37ac88ceaedc18940b097d0d4?s=128&d=identicon&r=PG&f=1", "display_name": "Xander May", "link": "https://stackoverflow.com/users/9137052/xander-may"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1146, "favorite_count": 0, "accepted_answer_id": 51509737, "answer_count": 1, "score": 1, "last_activity_date": 1532483248, "creation_date": 1532445547, "question_id": 51502276, "link": "https://stackoverflow.com/questions/51502276/golang-copy-from-os-file-without-hanging-on-waiting-for-eof", "title": "Golang copy from *os.file without hanging on waiting for EOF", "body": "<p>I'm trying to copy from a file in go using <code>io.Copy</code>, which waits for an EOF before actually copying the bytes out of its internal buffer, correct? In my use case (PTY/SSH session) the EOF only comes when the session completes, which means I am flying blind the whole time until the session decides that its over. </p>\n\n<p>I've tried to use CopyN with 1 byte at a time which does work, but if I try to wait for a certain bit of text to come up and I copy one past what has been pushed to the file the code will hang and I lose the session. Is there a function to just \"read whats there\" and then stop, or a different marker (like EOF) that can tell copy to stop for now?</p>\n\n<p>I have also tried to read the contents of the file that ptyI.pty points to but it always returns 0 bytes so I cant check for updates there</p>\n\n<p>Here is the code that handles it as of right now:</p>\n\n<pre><code>type PtyInterface struct {\n    pty          *os.File\n    buf          *bytes.Buffer\n}\n\nfunc (ptyI *PtyInterface) PrivCmd(cmdStr string) (string, error) {\n\n    // Copy the command provided into the STDIN of the bash shell we opened with\n    // the earlier PtyInterface\n    _, _ = io.Copy(ptyI.pty, strings.NewReader(string(\"somecommand\")))\n\n    // Assuming everything has gone well, we wait for the prompt to appear\n\n    // We do this by running through individual bytes until the prompt is\n    // fully printed (otherwise we might try to send in the answer at the wrong time)\n    for !strings.HasSuffix(ptyI.buf.String(), \"Prompt question? \") {\n        _, _ = io.CopyN(ptyI.buf, ptyI.pty, 1)\n    }\n\n    // Once we hit the prompt we throw the answer into STDIN along with a newline\n    // and the bash shell should accept this and begin executing the command.\n    _, _ = io.Copy(ptyI.pty, strings.NewReader(string(\"answer\\n\")))\n\n    // If we dont throw an exit in there then the PTY will never receive an EOF marker and we'll\n    // hang on the next copy\n    _, _ = io.Copy(ptyI.pty, strings.NewReader(string(\"exit\\n\")))\n\n    // Now this copy will wait for an EOF\n    _, _ = io.Copy(ptyI.buf, ptyI.pty)\n\n    //Debug info to be printed after\n    fmt.Println(\"\\nBytes written to buffer (newone): \\n\" + ptyI.buf.String())\n\n    return ptyI.buf.String(), nil\n}\n</code></pre>\n"}, {"tags": ["git", "go", "vgo"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532442704, "post_id": 51500111, "comment_id": 89970740, "body": "Just in case you missed it: vgo <a href=\"https://groups.google.com/forum/m/#!topic/golang-dev/a5PqQuBljF4\" rel=\"nofollow noreferrer\">has been merged and will ship with Go 1.11</a> in August. You may want to hold off until then, or <a href=\"https://dave.cheney.net/2018/07/14/taking-go-modules-for-a-spin\" rel=\"nofollow noreferrer\">experiment with Go tip</a>."}], "answers": [{"tags": [], "owner": {"reputation": 11396, "user_id": 2768067, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hSTUv.png?s=128&g=1", "display_name": "Komu", "link": "https://stackoverflow.com/users/2768067/komu"}, "is_accepted": true, "score": 1, "last_activity_date": 1549454567, "last_edit_date": 1549454567, "creation_date": 1532524405, "answer_id": 51519803, "question_id": 51500111, "link": "https://stackoverflow.com/questions/51500111/vgo-and-private-repositories/51519803#51519803", "title": "Vgo and private repositories", "body": "<p>One way of solving this is via the <code>GOPROXY</code> environment variable which can be set to a local file.</p>\n\n<pre><code>export GOPROXY=file:///path/to/cache\n</code></pre>\n\n<p>for more information, look at; <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/testdata/mod/README\" rel=\"nofollow noreferrer\">https://github.com/golang/go/blob/master/src/cmd/go/testdata/mod/README</a></p>\n"}], "owner": {"reputation": 4364, "user_id": 77867, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/b74fd7e13c4bb9913db6c4ba5eca10f2?s=128&d=identicon&r=PG", "display_name": "Alekc", "link": "https://stackoverflow.com/users/77867/alekc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 344, "favorite_count": 0, "accepted_answer_id": 51519803, "answer_count": 1, "score": 2, "last_activity_date": 1549454567, "creation_date": 1532439529, "last_edit_date": 1592644375, "question_id": 51500111, "link": "https://stackoverflow.com/questions/51500111/vgo-and-private-repositories", "title": "Vgo and private repositories", "body": "<p>I am trying to introduce vgo to some of our company projects for dependency management, but I've encountered some issues related to private repository.</p>\n<p>Let's assume that we have following code structure:</p>\n<blockquote>\n<p>go/src/companyName/projectA/</p>\n<p>go/src/companyName/projectB/</p>\n<p>go/src/companyName/projectC/</p>\n</blockquote>\n<p>All three projects have different git repository and projectA imports projectB.</p>\n<p>With normal <code>go build</code> approach, as long as we had those directories in place (under git), all worked fine, however we cant't make it work with vgo wrapper.</p>\n<p>On <code>vgo build</code> following error is being thrown:</p>\n<blockquote>\n<p>companyName/projectA/ cannot find module providing package companyName/projectB/</p>\n</blockquote>\n<p>Which kind of make sense because with  <code>vgo get -v</code> I can see that vgo tries to get meta tags from <code>https://companyName</code> which cannot be exposed for company policy.</p>\n<p>What's the best way to tell to vgo to either use file system contents (if source files are already there) or to specity git repository for certain import paths?</p>\n"}, {"tags": ["go", "beego"], "comments": [{"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1532443670, "post_id": 51498838, "comment_id": 89971449, "body": "Looking at <a href=\"https://github.com/astaxie/beego/blob/cab8458c1c4a5a3b4bf5192922be620e6dede15b/orm/orm.go#L273\" rel=\"nofollow noreferrer\">the source</a>, you may want to play around with the depth argument for multiple relational records"}, {"owner": {"reputation": 134, "user_id": 10127906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0469e62fc1e9ad5d6f4c1da11e204036?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/10127906/artem"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1532445938, "post_id": 51498838, "comment_id": 89973186, "body": "Well, no, depth is something else (the doc is not that good to understand what is it). They use FieldByIndex to get just first field in struct. So, there is no way to do it by default. Probably my architecture is wrong, and it is not good way to have two or more references to same models."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1532446708, "post_id": 51498838, "comment_id": 89973751, "body": "Oh, just noticed -&gt; account links to transactions, transactions link back to account. If you want those to be automatically loaded, you have an issue with the circular nature of the relations. Yeah, I try to stay well away of the more complex relational schema&#39;s when working with go... microservices rarely require complex schema&#39;s anyway. Transactions/ledgers in one service, accounts in another etc..."}, {"owner": {"reputation": 134, "user_id": 10127906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0469e62fc1e9ad5d6f4c1da11e204036?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/10127906/artem"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1532447103, "post_id": 51498838, "comment_id": 89974014, "body": "Account has reversed relation, means in DB there is no relation in this direction. But Transactions is related to two Accounts in same time and in DB there are two fields. For example you send money from Account1 to Account2, so TargetAccount is Account2 and SourceAccount is Account1. Then I need to get all transactions related to Account1. And have to check all transactions and those two fields. LoadRelated can do this work but only for one field."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1532447226, "post_id": 51498838, "comment_id": 89974102, "body": "I got that, it&#39;s just that every account will therefore have any number of transactions related to it, and vice-versa. Getting one will load the other and back again -&gt; recursion. That&#39;s the problem with this kind of relational data + greedily fetching the related records. Hence my remark on microservices: break apart that DB into separate services managing a subset of the data, only load what you need, when you need it etc..."}], "owner": {"reputation": 134, "user_id": 10127906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0469e62fc1e9ad5d6f4c1da11e204036?s=128&d=identicon&r=PG&f=1", "display_name": "Artem", "link": "https://stackoverflow.com/users/10127906/artem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 160, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532437056, "creation_date": 1532435885, "last_edit_date": 1532437056, "question_id": 51498838, "link": "https://stackoverflow.com/questions/51498838/loadrelated-for-multiple-fields", "title": "LoadRelated for multiple fields", "body": "<p>Looking for a way how to load related items in case of multiple references.\nI have</p>\n\n<pre><code>type Accounts struct {\n    Id               string `orm:\"pk\"`\n    Transactions     []*Transactions     `orm:\"reverse(many)\"`\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>type Transactions struct {\n    Id            string    `orm:\"pk\"`\n    SourceAccount *Accounts  `orm:\"rel(fk);\"`\n    TargetAccount *Accounts  `orm:\"rel(fk);\"`\n}\n</code></pre>\n\n<p>When I'm doing </p>\n\n<pre><code>o := orm.NewOrm()\no.LoadRelated(account, \"Transactions\")\n</code></pre>\n\n<p>it loads Transactions only where SourceAccount refers to my account, but it doesn't return transactions where account was mentioned as TargetAccount. \nIf I change order like this:</p>\n\n<pre><code>type Transactions struct {\n    Id            string    `orm:\"pk\"`\n    TargetAccount *Accounts  `orm:\"rel(fk);\"`\n    SourceAccount *Accounts  `orm:\"rel(fk);\"`\n}\n</code></pre>\n\n<p>It loads transactions where account was mentioned as TargetAccount. So order is important :)\nIs there a way to load both by LoadRelated ?</p>\n"}, {"tags": ["url", "go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1532427654, "post_id": 51496133, "comment_id": 89960205, "body": "RawQuery from <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\">golang.org/pkg/net/url/#URL</a>. Remember: Always read the Go documentation first and read <i>all</i> <i>of</i> <i>it</i>."}], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1532428399, "last_edit_date": 1532428399, "creation_date": 1532427702, "answer_id": 51496189, "question_id": 51496133, "link": "https://stackoverflow.com/questions/51496133/get-query-string-as-it-is-passed/51496189#51496189", "title": "Get Query string as it is passed", "body": "<p>For url encoded string use <code>URL</code> struct of <code>url</code> package to get RawQuery as passed in the URI:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/url\"\n)\n\nfunc main() {\n    stringValue := \"long division \"\n    t := &amp;url.URL{Path: stringValue}\n    encodedString := t.String()\n    fmt.Println(encodedString)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/dyeAtAdc8p-\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n\n<p>In Golang spec for URL. It is stated:-</p>\n\n<blockquote>\n  <p>that the Path field is stored in decoded form: /%47%6f%2f becomes\n  /Go/. A consequence is that it is impossible to tell which slashes in\n  the Path were slashes in the raw URL and which were %2f. This\n  distinction is rarely important, but when it is, code must not use\n  Path directly. The Parse function sets both Path and RawPath in the\n  URL it returns, and URL's String method uses RawPath if it is a valid\n  encoding of Path, by calling the EscapedPath method.</p>\n</blockquote>\n\n<pre><code>type URL struct {\n        Scheme     string\n        Opaque     string    // encoded opaque data\n        User       *Userinfo // username and password information\n        Host       string    // host or host:port\n        Path       string    // path (relative paths may omit leading slash)\n        RawPath    string    // encoded path hint (see EscapedPath method)\n        ForceQuery bool      // append a query ('?') even if RawQuery is empty\n        RawQuery   string    // encoded query values, without '?'\n        Fragment   string    // fragment for references, without '#'\n}\n</code></pre>\n\n<p>For more information Check <a href=\"https://golang.org/pkg/net/url/#URL\" rel=\"nofollow noreferrer\">Golang spec</a> for <code>URL</code></p>\n"}], "owner": {"reputation": 23, "user_id": 9902349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/46f8b2aad0ad325d02ca5e9e6050be12?s=128&d=identicon&r=PG&f=1", "display_name": "SUNIL PRASAD", "link": "https://stackoverflow.com/users/9902349/sunil-prasad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 510, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1532428815, "creation_date": 1532427533, "last_edit_date": 1532428815, "question_id": 51496133, "link": "https://stackoverflow.com/questions/51496133/get-query-string-as-it-is-passed", "title": "Get Query string as it is passed", "body": "<p>I'm new to <code>Go</code>. My question is how to get URL encoded string on stdout.</p>\n\n<p>Below is the URL string I am using to hit an api.</p>\n\n<p><code>schooltubeapi/v1/channeldetails?channelName=long%20division%20</code>.  </p>\n\n<p>Below is the code that I am using to get RawQuery</p>\n\n<pre><code>url1 := ChannelName\nu, _ := url.Parse(url1)\nlog.Println(u)\nu.RawQuery = u.Query().Encode()\nlog.Println(u)\n</code></pre>\n\n<p><strong>[Output]</strong></p>\n\n<p><code>long division</code></p>\n\n<p><strong>[Expected]</strong></p>\n\n<p><code>long%20division%20</code></p>\n\n<p>I have searched alot But cannot found a similar problem with a solution.</p>\n"}, {"tags": ["pointers", "for-loop", "go", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 0, "last_activity_date": 1532423335, "last_edit_date": 1532423335, "creation_date": 1532409943, "answer_id": 51491026, "question_id": 51490801, "link": "https://stackoverflow.com/questions/51490801/method-does-not-change-the-value-of-object-if-the-object-is-in-a-slice/51491026#51491026", "title": "Method does not change the value of object if the object is in a slice", "body": "<p>Whenever you loop through the slice it creates a copy of original variable which is used as value and is incremented. But when you are using the <code>index</code> you are pointing to the value backed at that address which is than incremented and hence original value got changed.</p>\n\n<p>Print the value of both variable to see the changes as:</p>\n\n<pre><code>for i, each := range numbers {\n    each.Increment()\n    fmt.Println(each, numbers[i])\n}\n</code></pre>\n\n<p>you can also print the address of variable in a loop with the original value address to see that both variables have different address. Hence you are actually creating a local variable when iterating over <code>numbers</code>.</p>\n\n<pre><code>for i, each := range numbers {\n    each.Increment()\n    fmt.Printf(\"%p -- %p\\n\",&amp;each, &amp;numbers[i])\n}\n</code></pre>\n\n<p>Working Code to check address on <a href=\"https://play.golang.org/p/no330mQlgGM\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1532417542, "creation_date": 1532417542, "answer_id": 51492937, "question_id": 51490801, "link": "https://stackoverflow.com/questions/51490801/method-does-not-change-the-value-of-object-if-the-object-is-in-a-slice/51492937#51492937", "title": "Method does not change the value of object if the object is in a slice", "body": "<p>In your original version, the loop variable <code>each</code> is a copy of the <code>Number</code> struct. Notice that it is not a pointer to it, nor is it the copy of a pointer to it. That means, that there is a newly created <code>Number</code> in each iteration. You call a method on a pointer to this newly created instance, then it gets destroyed after the loop and your original data has not changed.</p>\n\n<p>If you would instead use <code>numbers := []*Number { ...</code> and iterate over that, the <code>each</code> variable would be the copy of a pointer to <code>Number</code>. Using copies of pointers is the same as using pointers, because the copy points to the same memory location, thus if you then call the method, the data in the slice wil change.</p>\n\n<p>For your edit: if you use <code>numbers[i]</code> then you reference the data inside the slice, obviously. As I stated above, the <code>for range</code> loop will create a copy of the items in its <code>each</code> variable.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1532418716, "last_edit_date": 1532418716, "creation_date": 1532418412, "answer_id": 51493190, "question_id": 51490801, "link": "https://stackoverflow.com/questions/51490801/method-does-not-change-the-value-of-object-if-the-object-is-in-a-slice/51493190#51493190", "title": "Method does not change the value of object if the object is in a slice", "body": "<p>This <code>for range</code> loop:</p>\n\n<pre><code>for _, each := range numbers {\n</code></pre>\n\n<p>iterates over the elements of the <code>numbers</code> slice, and in each iteration it assigns (<strong>copies</strong>) an element to the <code>each</code> loop variable.</p>\n\n<p>Since your <code>numbers</code> slices is of type <code>[]Number</code>, it will copy the <code>Number</code> struct into the <code>each</code> variable (whose type will be <code>Number</code>).</p>\n\n<p>Then you call the <code>Number.Increment()</code> method on this variable. Since <code>Increment()</code> has pointer receiver, this is a shorthand for <code>(&amp;each).Increment()</code>. So the address of this loop variable is taken and used as the receiver for the <code>Increment()</code> method. The <code>Increment()</code> method will properly change this loop variable, but this is independent, distinct, detached from the slice, so you are not modifying the element in the slice.</p>\n\n<p>When you do:</p>\n\n<pre><code>for i := 0; i &lt; len(numbers); i++ {\n    numbers[i].Increment()\n}\n</code></pre>\n\n<p>Elements of <code>numbers</code> are not copied here. This:</p>\n\n<pre><code>numbers[i].Increment()\n</code></pre>\n\n<p>Indexes the <code>numbers</code> slice, and since <code>Increment()</code> has a pointer receiver, the address of <code>numbers[i]</code> is taken and used, which is the address of the element <strong>in the slice</strong>. So here, you will modify the <code>Number</code> struct value of the slice.</p>\n\n<p>Note that you can also use <code>for range</code> here:</p>\n\n<pre><code>for i := range numbers {\n    numbers[i].Increment()\n}\n</code></pre>\n\n<p>The first iteration variable when ranging over a slice is the index.</p>\n\n<p>Also, if you would store pointers in your <code>numbers</code> slice (which would then have type of <code>[]*Number</code>), the same thing would happen, but in that case the <code>for range</code> would copy pointers, not structs, and the pointer in the loop variable would point to the same <code>Number</code> struct value as the pointer in the slice would, so that would also work with your first <code>for range</code> variant.</p>\n\n<p>All these are detailed in <a href=\"https://golang.org/ref/spec#For_statements\" rel=\"nofollow noreferrer\">Spec: For statements</a>, in the <em>For statements with range clause</em> subsection.</p>\n"}], "owner": {"reputation": 333, "user_id": 7352226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b7f77d9d96cfe301db80eb8265331a9?s=128&d=identicon&r=PG&f=1", "display_name": "fallaway", "link": "https://stackoverflow.com/users/7352226/fallaway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 1, "accepted_answer_id": 51493190, "answer_count": 3, "score": 0, "last_activity_date": 1532423335, "creation_date": 1532408637, "last_edit_date": 1532418727, "question_id": 51490801, "link": "https://stackoverflow.com/questions/51490801/method-does-not-change-the-value-of-object-if-the-object-is-in-a-slice", "title": "Method does not change the value of object if the object is in a slice", "body": "<p>Here is my program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Number struct {\n    val int\n}\n\nfunc (num * Number) Increment () {\n    num.val += 1\n}\n\nfunc (num Number) Value() int {\n    return num.val\n}\n\nfunc main() {\n    numbers := []Number {\n        {val: 12}, \n        {val: 7},\n        {val: 0},\n    }\n\n    for _, each := range numbers {\n        each.Increment()\n        fmt.Println(each.Value())\n    }\n\n    for _, each := range numbers {\n        fmt.Println(each.Value())\n    }\n}\n</code></pre>\n\n<p>Here is the output: </p>\n\n<pre><code>13\n8\n1\n12\n7\n0\n</code></pre>\n\n<p>First question: why does the <code>Increment()</code>method not update the value in the first for loop? I used pointer as the receiver so that <code>val</code> can be updated for sure, but why would the second <code>for</code> loop print out the original values of those <code>Number</code>s?</p>\n\n<p>Second question: what can be done so that when I iterate over a slice of <code>Number</code>s and invoke the <code>Increment()</code> method, all <code>Number</code>s are correctly incremented?</p>\n\n<p><strong>[Edit]</strong> I noticed that if I use index-based <code>for</code> loop and invoke the <code>Increment()</code> method, values will be correctly updated. Why?</p>\n\n<pre><code>for i := 0; i &lt; len(numbers); i++ {\n    numbers[i].Increment()\n}\n</code></pre>\n"}, {"tags": ["go", "aws-cognito"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1532628586, "post_id": 51490707, "comment_id": 90058063, "body": "Read somewhere that using the email as the username might make it work. Can you give it a try?"}, {"owner": {"reputation": 1674, "user_id": 535630, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/3XmuF.jpg?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/535630/ben"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1532647747, "post_id": 51490707, "comment_id": 90065223, "body": "In the configuration of the user pool I have selected the radio button that requires usernames to be email address or phone number, and under that selected that usernames but be email addresses.  So I believe all usernames are email addresses in my case."}, {"owner": {"reputation": 332, "user_id": 7063331, "user_type": "registered", "accept_rate": 86, "profile_image": "https://lh3.googleusercontent.com/-N1tQRvD4m0o/AAAAAAAAAAI/AAAAAAAAAFo/akwmqvDipw0/photo.jpg?sz=128", "display_name": "Sonny Jayet", "link": "https://stackoverflow.com/users/7063331/sonny-jayet"}, "edited": false, "score": 1, "creation_date": 1543937740, "post_id": 51490707, "comment_id": 94093448, "body": "Hi did you find something ?"}, {"owner": {"reputation": 1674, "user_id": 535630, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/3XmuF.jpg?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/535630/ben"}, "edited": false, "score": 0, "creation_date": 1544063932, "post_id": 51490707, "comment_id": 94146675, "body": "Nope haven&#39;t found a resolution and effectively put this on hold as it isn&#39;t critical at the moment.  Eventually I will try using a token based 2 factor authentication and see if that works."}, {"owner": {"reputation": 666, "user_id": 1969892, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/j8WAF.jpg?s=128&g=1", "display_name": "Brice", "link": "https://stackoverflow.com/users/1969892/brice"}, "edited": false, "score": 3, "creation_date": 1551369347, "post_id": 51490707, "comment_id": 96623723, "body": "Works for me when USERNAME = email but not when equals cognito Id."}, {"owner": {"reputation": 55, "user_id": 11898878, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-KKfAm-JPmj4/AAAAAAAAAAI/AAAAAAAAAAk/F99sJ0yJSpI/photo.jpg?sz=128", "display_name": "Taylor Belland", "link": "https://stackoverflow.com/users/11898878/taylor-belland"}, "edited": false, "score": 0, "creation_date": 1566705297, "post_id": 51490707, "comment_id": 101737549, "body": "The only thing I notice right off the bat is that you&#39;re converting statically typed strings to strings as well as types that are not. Could be one has to be passed as a []byte value rather than a string?"}, {"owner": {"reputation": 1428, "user_id": 851233, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/0961e8831ab014e07196df63abd1fa15?s=128&d=identicon&r=PG&f=1", "display_name": "mrosales", "link": "https://stackoverflow.com/users/851233/mrosales"}, "edited": false, "score": 0, "creation_date": 1614098541, "post_id": 51490707, "comment_id": 117278681, "body": "It&#39;s a small thing, but in your question, you didn&#39;t show the AWS responses. In the response to <code>AdminInitiateAuth</code>, is the challenge you receive back <code>SMS_MFA</code>? Its been awhile since I&#39;ve worked with Cognito at this level. One other gotcha that I&#39;ve hit before is that <code>SECRET_HASH</code> is required if your Cognito app has a secret enabled.  edit: I&#39;ve successfully used this lib for the SRP auth flow in Go too: <a href=\"https://github.com/alexrudd/cognito-srp\" rel=\"nofollow noreferrer\">github.com/alexrudd/cognito-srp</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1674, "user_id": 535630, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/3XmuF.jpg?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/535630/ben"}, "edited": false, "score": 0, "creation_date": 1591118526, "post_id": 62126387, "comment_id": 109932369, "body": "I don&#39;t see how the question is ambiguous.  Step 1 clearly indicates that I created the account with a username &amp; password.  I do not have phone for login.  I obviously have to set the phone number to request an SMS verification code for MFA, which I do in step 2.  And yes it is nothing but MFA in Cognito, and it does not work.  Having used Cognito for a while now my feeling is that it isn&#39;t ready for production use and would strongly recommend anyone reading this not to use it.  Aside from random bugs like this, being unable to make a backup of a user pool is a deal breaker."}], "tags": [], "owner": {"reputation": 13, "user_id": 1405932, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cb17076ad031f9b9a482304468d9cd5a?s=128&d=identicon&r=PG", "display_name": "darcwader", "link": "https://stackoverflow.com/users/1405932/darcwader"}, "is_accepted": false, "score": 0, "last_activity_date": 1590990623, "creation_date": 1590990623, "answer_id": 62126387, "question_id": 51490707, "link": "https://stackoverflow.com/questions/51490707/aws-cognitos-sms-multi-factor-authentication-returns-invalid-code-or-auth-state/62126387#62126387", "title": "AWS Cognito&#39;s SMS Multi Factor Authentication returns invalid code or auth state", "body": "<p>Your questions seems ambiguous.</p>\n\n<p>step 2 you are </p>\n\n<ol start=\"2\">\n<li>I set the phone number and request a verification code</li>\n<li>I verify the phone number</li>\n</ol>\n\n<p>this is nothing but MFA in Cognito. if you have configured the pool correctly. </p>\n\n<p>You cannot have both phone for login and MFA. that doesn't make sense. </p>\n\n<p>but if you have phone for login, then Cognito will send SMS every time with code. password is only for email logins. </p>\n"}], "owner": {"reputation": 1674, "user_id": 535630, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/3XmuF.jpg?s=128&g=1", "display_name": "Ben", "link": "https://stackoverflow.com/users/535630/ben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1680, "favorite_count": 1, "answer_count": 1, "score": 26, "last_activity_date": 1590990623, "creation_date": 1532408056, "last_edit_date": 1532804764, "question_id": 51490707, "link": "https://stackoverflow.com/questions/51490707/aws-cognitos-sms-multi-factor-authentication-returns-invalid-code-or-auth-state", "title": "AWS Cognito&#39;s SMS Multi Factor Authentication returns invalid code or auth state", "body": "<p>I am trying to implement authentication built on <code>Cognito</code> using their Go <code>SDK</code>. I have been able to get basic <code>username/password</code> authentication to work, but when I add in 2-factor authentication using <code>SMS</code> I am getting stuck.</p>\n\n<p>Steps to reproduce :</p>\n\n<ol>\n<li>I create the user with a username/password and email verification</li>\n<li>I validate the email address</li>\n<li>I set the phone number and request a verification code</li>\n<li>I verify the phone number</li>\n<li>I enable 2-factor authentication (via SMS)</li>\n<li>I try to sign in and receive the SMS_MFA challenge</li>\n<li>I receive the code on my phone and call AdminRespondToAuthChallenge</li>\n</ol>\n\n<p>Problem, I receive an <code>error</code> :</p>\n\n<pre><code>CodeMismatchException: Invalid code or auth state for the user.\nstatus code: 400, request id: 1513894e-8efa-11e8-a8f8-97e5e083c03b\n</code></pre>\n\n<p>The SMS verification code is certainly correct, so it seems that it must be something to do with the auth state.</p>\n\n<p>The calls to Cognito look like this:</p>\n\n<pre><code>c.cip.SignUp(&amp;cognitoidentityprovider.SignUpInput{\n        ClientId: aws.String(c.clientID),\n        Username: aws.String(username),\n        Password: aws.String(password),\n        UserAttributes: []*cognitoidentityprovider.AttributeType{\n            {\n                Name:  aws.String(\"email\"),\n                Value: aws.String(email),\n            },\n            {\n                Name:  aws.String(\"name\"),\n                Value: aws.String(fullName),\n            },\n        },\n    })\n\nc.cip.ConfirmSignUp(&amp;cognitoidentityprovider.ConfirmSignUpInput{\n    ClientId:         aws.String(c.clientID),\n    Username:         aws.String(username),\n    ConfirmationCode: aws.String(code),\n})\n\n\n//Add the phone number\nc.cip.AdminUpdateUserAttributes(&amp;cognitoidentityprovider.AdminUpdateUserAttributesInput{\n            UserPoolId: aws.String(c.userPoolID),\n            Username:   aws.String(username),\n            UserAttributes: []*cognitoidentityprovider.AttributeType{\n                {\n                    Name:  aws.String(\"phone_number\"),\n                    Value: aws.String(phoneNumber),\n                },\n            },\n        })\n\n//Request a verification code\nc.cip.GetUserAttributeVerificationCode(&amp;cognitoidentityprovider.GetUserAttributeVerificationCodeInput{\n    AccessToken:   aws.String(accessToken),\n    AttributeName: aws.String(\"phone_number\"),\n})\n\n//Verify the phone number\nc.cip.VerifyUserAttribute(&amp;cognitoidentityprovider.VerifyUserAttributeInput{\n    AccessToken:   aws.String(accessToken),\n    AttributeName: aws.String(\"phone_number\"),\n    Code:          aws.String(code),\n})\n\n//Enable SMS 2-factor auth c.cip.AdminSetUserSettings(&amp;cognitoidentityprovider.AdminSetUserSettingsInput{\n    UserPoolId: aws.String(c.userPoolID),\n    Username:   aws.String(username),\n    MFAOptions: []*cognitoidentityprovider.MFAOptionType{\n        &amp;cognitoidentityprovider.MFAOptionType{\n            AttributeName:  aws.String(\"phone_number\"),\n            DeliveryMedium: aws.String(\"SMS\"),\n        },\n    },\n})\n\nc.cip.AdminInitiateAuth(&amp;cognitoidentityprovider.AdminInitiateAuthInput{\n    ClientId:   aws.String(c.clientID),\n    UserPoolId: aws.String(c.userPoolID),\n    AuthFlow:   aws.String(\"ADMIN_NO_SRP_AUTH\"),\n    AuthParameters: map[string]*string{\n        \"USERNAME\": aws.String(username),\n        \"PASSWORD\": aws.String(password),\n    },\n})\n\nc.cip.AdminRespondToAuthChallenge(&amp;cognitoidentityprovider.AdminRespondToAuthChallengeInput{\n        ClientId:      aws.String(c.clientID),\n        UserPoolId:    aws.String(c.userPoolID),\n        ChallengeName: aws.String(\"SMS_MFA\"),\n        Session:       aws.String(session),\n        ChallengeResponses: map[string]*string{\n            \"USERNAME\":     aws.String(username),\n            \"SMS_MFA_CODE\": aws.String(code),\n        },\n    })\n</code></pre>\n\n<p>Doing a GetUser call shows the current state of the user:</p>\n\n<pre><code>User = {\n              Enabled: true,\n              MFAOptions: [{\n                  AttributeName: \"phone_number\",\n                  DeliveryMedium: \"SMS\"\n                }],\n              PreferredMfaSetting: \"SMS_MFA\",\n              UserAttributes: [\n                {\n                  Name: \"sub\",\n                  Value: \"bd2bb8bc-dfe6-4216-829c-5ae975ce24e5\"\n                },\n                {\n                  Name: \"email_verified\",\n                  Value: \"true\"\n                },\n                {\n                  Name: \"name\",\n                  Value: \"Ben Vogan\"\n                },\n                {\n                  Name: \"phone_number_verified\",\n                  Value: \"true\"\n                },\n                {\n                  Name: \"phone_number\",\n                  Value: \"&lt;redacted&gt;\"\n                },\n                {\n                  Name: \"email\",\n                  Value: \"&lt;redacted&gt;\"\n                }\n              ],\n              UserCreateDate: 2018-07-24 03:29:49 +0000 UTC,\n              UserLastModifiedDate: 2018-07-24 04:19:51 +0000 UTC,\n              UserMFASettingList: [\"SMS_MFA\"],\n              UserStatus: \"CONFIRMED\",\n              Username: \"bd2bb8bc-dfe6-4216-829c-5ae975ce24e5\"\n            }\n</code></pre>\n\n<p>I do not know if there is a way to query the user's auth state so that I can verify that.</p>\n\n<p>The AWS documentation and unhelpful errors are driving me insane so any help would be greatly appreciated!</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go", "encryption", "rsa"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532414806, "post_id": 51490348, "comment_id": 89952788, "body": "Next you should not discard the error from <code>ParsePKCS1PublicKey</code>."}], "answers": [{"tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 1, "last_activity_date": 1532413173, "creation_date": 1532413173, "answer_id": 51491721, "question_id": 51490348, "link": "https://stackoverflow.com/questions/51490348/golang-rsa-encryption-with-error-failed-to-parse-public-key/51491721#51491721", "title": "Golang RSA Encryption with error &quot;failed to parse public key&quot;", "body": "<p>You need to use <a href=\"https://golang.org/pkg/crypto/x509/#ParsePKIXPublicKey\" rel=\"nofollow noreferrer\">x509.ParsePKIXPublicKey</a>, check the error returned by the <code>Parse...</code> function, and perform a type check to make sure it is a RSA key before using it.</p>\n\n<p>Your code would become:</p>\n\n<pre><code>pkey, err := x509.ParsePKIXPublicKey(block.Bytes)\nif err != nil {\n    panic(err)\n}\n\nrsaKey, ok := pkey.(*rsa.PublicKey)\nif !ok {\n    log.Fatalf(\"got unexpected key type: %T\", pkey)\n}\n</code></pre>\n\n<p>Please don't skip errors. In this case, <code>ParsePKCS1PublicKey</code> would have returned something along the lines of <code>asn1: structure error: tags don't match ...</code> which indicates a bad format.</p>\n"}], "owner": {"reputation": 5, "user_id": 10125648, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-vU2DJkH1u3k/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7o0huutf1VZrGnTn6ta0b_JD83Q6Q/mo/photo.jpg?sz=128", "display_name": "htnew", "link": "https://stackoverflow.com/users/10125648/htnew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1289, "favorite_count": 0, "accepted_answer_id": 51491721, "answer_count": 1, "score": 0, "last_activity_date": 1532424984, "creation_date": 1532405457, "last_edit_date": 1532424984, "question_id": 51490348, "link": "https://stackoverflow.com/questions/51490348/golang-rsa-encryption-with-error-failed-to-parse-public-key", "title": "Golang RSA Encryption with error &quot;failed to parse public key&quot;", "body": "<p>I have a trouble when I just want to simply encrypt a short string.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/rsa\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"fmt\"\n    \"log\"\n)\n\nfunc main() {\n\n    var pwd = \"1234\"\n    var pwdB = []byte(pwd)\n\n    fmt.Println(pwd)\n    fmt.Println(pwdB)\n\n    const pemPublicKey = `-----BEGIN PUBLIC KEY-----\nMFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALE0I2XX+IzlhIfBx2KoYqcxlEU23oje\nPTJzJ7GoYyK4R5gCkWV6ltyLN5G+rNkfsAnTObqIJK+sQzcqmm9up88CAwEAAQ==\n-----END PUBLIC KEY-----`\n\n    fmt.Println(pemPublicKey)\n\n    block, _ := pem.Decode([]byte(pemPublicKey))\n    if block == nil {\n        panic(\"failed to parse PEM block containing the public key\")\n    }\n    fmt.Println(block)\n\n    pkey, _ := x509.ParsePKCS1PublicKey(block.Bytes)\n    if pkey == nil {\n        panic(\"failed to parse public key\")\n    }\n\n    fmt.Println(pkey)\n\n    in, err := rsa.EncryptPKCS1v15(rand.Reader, pkey, pwdB)\n    if err != nil {\n        log.Fatalf(\"encrypt: %s\", err)\n    }\n\n    fmt.Println(in)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wvK_P07nz3X\" rel=\"nofollow noreferrer\">playground link</a></p>\n\n<p>The error is :</p>\n\n<pre><code>panic: failed to parse public key\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox736400947/main.go:36 +0x4a0\n</code></pre>\n\n<p>It seems that is the process in Parsing the public key,\nbut I don't know what have I done wrong...\nWhat should I do next? Thanks :(</p>\n"}, {"tags": ["unit-testing", "go", "https", "client"], "answers": [{"tags": [], "owner": {"reputation": 939, "user_id": 4648046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/932ac0b92feea46110e78577f7047c74?s=128&d=identicon&r=PG&f=1", "display_name": "Eddy R.", "link": "https://stackoverflow.com/users/4648046/eddy-r"}, "is_accepted": true, "score": 2, "last_activity_date": 1532418873, "creation_date": 1532418873, "answer_id": 51493339, "question_id": 51490284, "link": "https://stackoverflow.com/questions/51490284/unit-testing-tls-client/51493339#51493339", "title": "Unit testing tls client", "body": "<p>Instead of using <code>NewTLSServer()</code> you want to:</p>\n\n<ul>\n<li>Create your test server via <a href=\"https://godoc.org/net/http/httptest#NewUnstartedServer\" rel=\"nofollow noreferrer\"><code>httptest.NewUnstartedServer()</code></a></li>\n<li>Create a <code>*tls.Config</code> much like you did in the code that sets up your <code>http.Client</code> in your <code>MakeDownloadRequest()</code></li>\n<li>Set the test server's <a href=\"https://godoc.org/net/http/httptest#Server\" rel=\"nofollow noreferrer\"><code>TLS</code></a> field to the <code>*tls.Config</code> created in the previous step</li>\n<li>Start the test server using its <a href=\"https://godoc.org/net/http/httptest#Server.StartTLS\" rel=\"nofollow noreferrer\"><code>StartTLS()</code></a> method</li>\n</ul>\n\n<p>Then your program should be able to call into your test server using those certificates.</p>\n"}], "owner": {"reputation": 337, "user_id": 5772695, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/pSKby.jpg?s=128&g=1", "display_name": "Aarvi", "link": "https://stackoverflow.com/users/5772695/aarvi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 637, "favorite_count": 0, "accepted_answer_id": 51493339, "answer_count": 1, "score": 2, "last_activity_date": 1532418873, "creation_date": 1532404988, "last_edit_date": 1532416221, "question_id": 51490284, "link": "https://stackoverflow.com/questions/51490284/unit-testing-tls-client", "title": "Unit testing tls client", "body": "<p>I have a function that makes an https request to a TLS server. I want to write unit tests to test the client function. I came across httptest.NewTLSServer that can be used to mock the server. But, how can I incorporate the certificates that the client uses instead of the default ones used in NewTLSServer?</p>\n\n<p>Following is the client function that makes the request:</p>\n\n<pre><code>func MakeDownloadRequest(url string) (*http.Response, error) {\n\n    caCert, err := ioutil.ReadFile(\"client/tlscerts/cert.pem\")\n    if err != nil {\n        return nil, err\n    }\n    caCertPool := x509.NewCertPool()\n    caCertPool.AppendCertsFromPEM(caCert)\n\n    cert, err := tls.LoadX509KeyPair(\"client/tlscerts/cert.pem\",\"client/tlscerts/key.pem\")\n    if err != nil {\n        return nil, err\n    }\n\n    client := &amp;http.Client{\n        Transport: &amp;http.Transport{\n            TLSClientConfig: &amp;tls.Config{\n                RootCAs:      caCertPool,\n                Certificates: []tls.Certificate{cert},\n            },\n        },\n    }\n\n    resp, err := client.Get(url)\n    if err != nil {\n        return nil, err\n    }\n    return resp, nil\n}\n</code></pre>\n\n<p>Server stub:</p>\n\n<pre><code>server := httptest.NewTLSServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        io.WriteString(w, \"Hello\")\n    }))\n</code></pre>\n\n<p>Using the server.URL to make requests gives me \"bad certificate\" error. How can I make both the client and server use the same certificate? </p>\n"}, {"tags": ["go", "closures"], "comments": [{"owner": {"reputation": 2129, "user_id": 1210278, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5120fc4e345db0d1a964888272073819?s=128&d=identicon&r=PG", "display_name": "Riking", "link": "https://stackoverflow.com/users/1210278/riking"}, "edited": false, "score": 3, "creation_date": 1532398399, "post_id": 51489323, "comment_id": 89947755, "body": "Looks like the <code>funcval</code> struct in runtime/runtime2.go would be of use."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1532402011, "post_id": 51489323, "comment_id": 89948378, "body": "The other question is about <i>how</i> the closures work in practice, but what you\u2019re asking is for implementation details from an undefined version of a particular Go compiler. While it may be interesting, I don\u2019t know if SO is the place to ask."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 5, "last_activity_date": 1532430883, "last_edit_date": 1532430883, "creation_date": 1532405471, "answer_id": 51490350, "question_id": 51489323, "link": "https://stackoverflow.com/questions/51489323/how-are-go-closures-layed-out-in-memory/51490350#51490350", "title": "How are Go closures layed out in memory?", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"noreferrer\">The Go Programming Language\n  Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Function_literals\" rel=\"noreferrer\">Function literals</a></p>\n  \n  <p>A function literal represents an anonymous function.</p>\n  \n  <p><code>FunctionLit = \"func\" Signature FunctionBody .</code></p>\n  \n  <p><code>func(a, b int, z float64) bool { return a*b &lt; int(z) }</code></p>\n  \n  <p>A function literal can be assigned to a variable or invoked directly.</p>\n\n<pre><code>f := func(x, y int) int { return x + y }\nfunc(ch chan int) { ch &lt;- ACK }(replyChan)\n</code></pre>\n  \n  <p>Function literals are closures: they may refer to variables defined in\n  a surrounding function. Those variables are then shared between the\n  surrounding function and the function literal, and they survive as\n  long as they are accessible.</p>\n</blockquote>\n\n<hr>\n\n<blockquote>\n  <p>Closures may refer to variables defined in\n  a surrounding function. Those variables are then shared between the\n  surrounding function and the function literal, and they survive as\n  long as they are accessible.</p>\n</blockquote>\n\n<p>Variables that survive a function call are put on the heap. In Go, closures are really that simple. </p>\n\n<hr>\n\n<p>For example,</p>\n\n<pre><code>func closure() func() *byte {\n    var b [4 * 1024]byte\n    return func() *byte {\n        return &amp;b[0]\n    }\n}\n</code></pre>\n\n<p>A <code>closure()</code> call is two heap allocations, one for 16 (= 8 + 8 on amd64) bytes</p>\n\n<pre><code>struct { F uintptr; b *[4096]byte }\n</code></pre>\n\n<p>and one for 4096 bytes</p>\n\n<pre><code>[4096]byte\n</code></pre>\n\n<p>for a total of 4112 bytes.</p>\n"}, {"tags": [], "owner": {"reputation": 1986, "user_id": 4511560, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/X7lzw.jpg?s=128&g=1", "display_name": "Tinkaal Gogoi", "link": "https://stackoverflow.com/users/4511560/tinkaal-gogoi"}, "is_accepted": false, "score": -1, "last_activity_date": 1570707761, "creation_date": 1570707761, "answer_id": 58322119, "question_id": 51489323, "link": "https://stackoverflow.com/questions/51489323/how-are-go-closures-layed-out-in-memory/58322119#58322119", "title": "How are Go closures layed out in memory?", "body": "<p>The golang FAQ might help: <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">https://golang.org/doc/faq#stack_or_heap</a></p>\n\n<p>How do I know whether a variable is allocated on the heap or the stack?</p>\n\n<p>From a correctness standpoint, you don't need to know. Each variable in Go exists as long as there are references to it. The storage location chosen by the implementation is irrelevant to the semantics of the language.</p>\n\n<p>The storage location does have an effect on writing efficient programs. When possible, the Go compilers will allocate variables that are local to a function in that function's stack frame. However, if the compiler cannot prove that the variable is not referenced after the function returns, then the compiler must allocate the variable on the garbage-collected heap to avoid dangling pointer errors. Also, if a local variable is very large, it might make more sense to store it on the heap rather than the stack.</p>\n\n<p>In the current compilers, if a variable has its address taken, that variable is a candidate for allocation on the heap. However, a basic escape analysis recognizes some cases when such variables will not live past the return from the function and can reside on the stack.</p>\n"}], "owner": {"reputation": 2129, "user_id": 1210278, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/5120fc4e345db0d1a964888272073819?s=128&d=identicon&r=PG", "display_name": "Riking", "link": "https://stackoverflow.com/users/1210278/riking"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1176, "favorite_count": 2, "answer_count": 2, "score": 3, "last_activity_date": 1570707761, "creation_date": 1532396936, "question_id": 51489323, "link": "https://stackoverflow.com/questions/51489323/how-are-go-closures-layed-out-in-memory", "title": "How are Go closures layed out in memory?", "body": "<p><em>For an explanation of closures in general, see <a href=\"https://stackoverflow.com/questions/111102/how-do-javascript-closures-work\">How do JavaScript closures work?</a></em></p>\n\n<p>How exactly are Go closures laid out in memory?</p>\n\n<p>Take, for example, the following function:</p>\n\n<pre><code>type M int\n\nfunc (m *M) Adder(amount int) func() {\n    return func() {\n        *m = *m + amount\n    }\n}\n</code></pre>\n\n<p>When our code calls <code>a := m.Adder()</code>, how much memory is allocated on the heap and what does it look like? How much memory does the returned <code>func()</code> value take up (wherever in memory it ends up being)?</p>\n"}, {"tags": ["docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 1350, "user_id": 3656968, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000202663021/picture?type=large", "display_name": "Kansuler", "link": "https://stackoverflow.com/users/3656968/kansuler"}, "edited": false, "score": 0, "creation_date": 1532418052, "post_id": 51489298, "comment_id": 89954755, "body": "You seem to understand the problem, isn&#39;t specifying <code>url := &quot;http:&#47;&#47;service2&#47;get&quot; </code> enough to make it work?"}, {"owner": {"reputation": 220, "user_id": 6249921, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-XV1jMLD7xtQ/AAAAAAAAAAI/AAAAAAAAAk4/-3WvXdUbV3U/photo.jpg?sz=128", "display_name": "Anshul Jindal", "link": "https://stackoverflow.com/users/6249921/anshul-jindal"}, "reply_to_user": {"reputation": 1350, "user_id": 3656968, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000202663021/picture?type=large", "display_name": "Kansuler", "link": "https://stackoverflow.com/users/3656968/kansuler"}, "edited": false, "score": 0, "creation_date": 1532420612, "post_id": 51489298, "comment_id": 89956102, "body": "Thanks it worked...I should have tried that in the first place only..I tried all other but not this.. Anyway thanks"}], "answers": [{"tags": [], "owner": {"reputation": 220, "user_id": 6249921, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-XV1jMLD7xtQ/AAAAAAAAAAI/AAAAAAAAAk4/-3WvXdUbV3U/photo.jpg?sz=128", "display_name": "Anshul Jindal", "link": "https://stackoverflow.com/users/6249921/anshul-jindal"}, "is_accepted": false, "score": 0, "last_activity_date": 1532420669, "creation_date": 1532420669, "answer_id": 51493879, "question_id": 51489298, "link": "https://stackoverflow.com/questions/51489298/get-query-from-one-dockerized-go-service-to-other-dockerized-go-services/51493879#51493879", "title": "Get Query from one Dockerized Go service to other Dockerized Go Services", "body": "<p>It worked if we use like this </p>\n\n<pre><code>url :=\"http://service2:9001/get\" // this is not working \nresponse, err := http.Get(url)\nif err != nil {\n    fmt.Printf(\"%s\", err)\n} else {\n //do something\n }\n</code></pre>\n"}], "owner": {"reputation": 220, "user_id": 6249921, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh4.googleusercontent.com/-XV1jMLD7xtQ/AAAAAAAAAAI/AAAAAAAAAk4/-3WvXdUbV3U/photo.jpg?sz=128", "display_name": "Anshul Jindal", "link": "https://stackoverflow.com/users/6249921/anshul-jindal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 54, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532420669, "creation_date": 1532396740, "question_id": 51489298, "link": "https://stackoverflow.com/questions/51489298/get-query-from-one-dockerized-go-service-to-other-dockerized-go-services", "title": "Get Query from one Dockerized Go service to other Dockerized Go Services", "body": "<p>I have some services built in Go and I ma deploying them using docker-compose. </p>\n\n<p>I have also linked the services, but now if I do a GET request from one application to other I get  <strong>unsupported protocol scheme</strong>. This is because I am using the service name in the URL without specifying any protocol. Linking and querying works fine with mongoDB but not with other services. </p>\n\n<p>Go service1 File</p>\n\n<pre><code>url :=\"service2/get\" // this is not working \nresponse, err := http.Get(url)\nif err != nil {\n    fmt.Printf(\"%s\", err)\n} else {\n //do something\n }\n</code></pre>\n\n<p>Docker-compose</p>\n\n<pre><code>  service1:\n    container_name: 'service1'\n    build: 'service1'\n    ports:\n      - '8080:8080'\n    depends_on:\n      - 'service2'\n    links:\n      - 'service2'\n  service2:\n    container_name: 'service2'\n    build: 'service2'\n    ports:\n      - '9001:9001'\n</code></pre>\n\n<p>Any suggestion how this can be done? </p>\n"}, {"tags": ["go", "oauth", "jwt", "box", "jwt-go"], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1532525109, "creation_date": 1532525109, "answer_id": 51520061, "question_id": 51489102, "link": "https://stackoverflow.com/questions/51489102/box-jwt-oauth-2-0-by-golang/51520061#51520061", "title": "BOX / JWT OAuth 2.0 by golang", "body": "<p>I believe that you need to actually pass an actual file id in place of \"FILE_ID\" in:</p>\n\n<p><code>req2, err := http.NewRequest(\"GET\", \"https://api.box.com/2.0/files/FILE_ID?fields=id,name\", nil)</code></p>\n\n<p>Based on reading the <a href=\"https://developer.box.com/reference\" rel=\"nofollow noreferrer\">API Reference</a></p>\n"}], "owner": {"reputation": 71, "user_id": 5207291, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kUkHO.png?s=128&g=1", "display_name": "Masahiro Yanou", "link": "https://stackoverflow.com/users/5207291/masahiro-yanou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 438, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1588507295, "creation_date": 1532394511, "last_edit_date": 1588507295, "question_id": 51489102, "link": "https://stackoverflow.com/questions/51489102/box-jwt-oauth-2-0-by-golang", "title": "BOX / JWT OAuth 2.0 by golang", "body": "<p>I want to upload image from my server without user. I made box application and setting.</p>\n\n<p>I try to create JWT token and got access token. after that, I try to get file information from my Box file. but this api return 404 status.</p>\n\n<p>I don't know where I missed. If you know, please help me.</p>\n\n<p>My code is follow as.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"time\"\n\n    \"encoding/json\"\n    \"github.com/dgrijalva/jwt-go\"\n    \"net/http\"\n    \"net/url\"\n    \"strings\"\n)\n\ntype BoxToken struct {\n    AccessToken  string   `json:\"access_token\"`\n    ExpiresIn    int      `json:\"expires_in\"`\n    RestrictedTo []string `json:\"restricted_to\"`\n    TokenType    string   `json:\"token_type\"`\n}\n\nfunc main() {\n    token := jwt.NewWithClaims(jwt.SigningMethodRS512, jwt.MapClaims{\n        \"iss\":          \"application client id\",\n        \"sub\":          \"enterprise id\",\n        \"box_sub_type\": \"enterprise\",\n        \"aud\":          \"https://api.box.com/oauth2/token\",\n        \"jti\":          \"unique id\",\n        \"exp\":          time.Now().Unix() + 60,\n    })\n    token.Header[\"kid\"] = \"public key id\"\n\n    privateKeyData, err := ioutil.ReadFile(\"private.key\")\n    if err != nil {\n        panic(err)\n    }\n\n    key, err := jwt.ParseRSAPrivateKeyFromPEM(privateKeyData)\n    if err != nil {\n        panic(err)\n    }\n\n    // Generate encoded token and send it as response.\n    tokenStr, err := token.SignedString(key)\n    if err != nil {\n        panic(err)\n    }\n\n    //fmt.Println(tokenStr)\n\n    values := url.Values{}\n    values.Add(\"grant_type\", \"urn:ietf:params:oauth:grant-type:jwt-bearer\")\n    values.Add(\"client_id\", \"application client id\")\n    values.Add(\"client_secret\", \"application client secret\")\n    values.Add(\"assertion\", tokenStr)\n\n    req, err := http.NewRequest(http.MethodPost, \"https://api.box.com/oauth2/token\", strings.NewReader(values.Encode()))\n    if err != nil {\n        panic(err)\n    }\n\n    client := http.DefaultClient\n\n    resp, err := client.Do(req)\n    if err != nil {\n        panic(err)\n    }\n    defer resp.Body.Close()\n\n    fmt.Println(resp.StatusCode)\n\n    responseBody, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        panic(err)\n    }\n\n    var boxToken BoxToken\n    if err := json.Unmarshal(responseBody, &amp;boxToken); err != nil {\n        panic(err)\n    }\n\n    req2, err := http.NewRequest(\"GET\", \"https://api.box.com/2.0/files/FILE_ID?fields=id,name\", nil)\n    if err != nil {\n        panic(err)\n    }\n\n    req2.Header.Add(\"Authorization\", `Bearer `+boxToken.AccessToken)\n\n    resp2, err := client.Do(req2)\n    if err != nil {\n        panic(err)\n    }\n    defer resp2.Body.Close()\n\n    fmt.Println(resp2.StatusCode)\n\n    responseBody2, err := ioutil.ReadAll(resp2.Body)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Println(string(responseBody2))\n}\n</code></pre>\n\n<p>and standard output is</p>\n\n<pre><code>404\n{\"type\":\"error\",\"status\":404,\"code\":\"not_found\",\"context_info\":{\"errors\":[{\"reason\":\"invalid_parameter\",\"name\":\"item\",\"message\":\"Invalid value 'f_${FILE_ID}'. 'item' with value 'f_${FILE_ID}' not found\"}]},\"help_url\":\"http:\\/\\/developers.box.com\\/docs\\/#errors\",\"message\":\"Not Found\",\"request_id\":\"3de39rftkndh2qqn\"}\n</code></pre>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1532388590, "post_id": 51488385, "comment_id": 89945860, "body": "The import path is &quot;github.com/gin-gonic/gin&quot;, not &quot;/home/ubuntu/goapi/src/github.com/roes/api/vendor/github.co&zwnj;&#8203;m/gin-gonic/gin&quot;"}, {"owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532389895, "post_id": 51488385, "comment_id": 89946107, "body": "yes, I don&#39;t understand this part. as I understand, it should call the Globally installed package, and I do have &quot;/home/ubuntu/goapi/src/github.com/roes/api/vendor/github.co&zwnj;&#8203;m/gin-gonic/gin&quot; except the (underscore at the front)"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1532391119, "post_id": 51488385, "comment_id": 89946347, "body": "In your folder structure you have <code>github.com&#47;rose</code>. In your error messages you have  <code>github.com&#47;roes</code>. Why?"}, {"owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "edited": false, "score": 0, "creation_date": 1532391698, "post_id": 51488385, "comment_id": 89946485, "body": "I don&#39;t know. I believe it look for all packages but not gin. the funny thing is I can load gin package in main.go tho."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1532391989, "post_id": 51488385, "comment_id": 89946550, "body": "That error message is only possible if your code says <code>import &quot;_&#47;home&#47;ubuntu&#47;goapi&#47;src&#47;github.com&#47;roes&#47;api&#47;vendor&#47;github.c&zwnj;&#8203;om&#47;gin-gonic&#47;gin&quot;</code>, which is wrong. Go wouldn&#39;t look in <code>$GOPATH&#47;src&#47;_home&#47;ubuntu&#47;...</code> otherwise."}, {"owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "edited": false, "score": 1, "creation_date": 1532465835, "post_id": 51488385, "comment_id": 89983874, "body": "does anyone know why there is an underscore? please. I can find the gin in the right path, same as above just not the underscore"}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "edited": false, "score": 0, "creation_date": 1532465519, "post_id": 51495441, "comment_id": 89983745, "body": "yeah, not about the go vendor path thing, the problem still exist"}], "tags": [], "owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "is_accepted": false, "score": -1, "last_activity_date": 1532425467, "creation_date": 1532425467, "answer_id": 51495441, "question_id": 51488385, "link": "https://stackoverflow.com/questions/51488385/golang-can-not-find-package-gin-in-sub-directory/51495441#51495441", "title": "golang can not find package gin in sub directory", "body": "<p>maybe I just miss out this step for every folder in the project folder. \n(very important)</p>\n\n<pre><code>  mkdir -p $GOPATH/src/github.com/myusername/project &amp;&amp; cd \"$_\" \n</code></pre>\n\n<p>I keep asking my friend Google, the answer is:  goVendor depend on the $GOPHATH a lot. \nthen I Create the controller folder with above command. so every folder too. no problem :) </p>\n\n<p><strong>Thank you to everyone Helping and Viewing</strong></p>\n"}, {"tags": [], "owner": {"reputation": 2764, "user_id": 5326634, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/agDBB.jpg?s=128&g=1", "display_name": "Siyaram Malav", "link": "https://stackoverflow.com/users/5326634/siyaram-malav"}, "is_accepted": false, "score": 1, "last_activity_date": 1570685501, "last_edit_date": 1570685501, "creation_date": 1570679652, "answer_id": 58315228, "question_id": 51488385, "link": "https://stackoverflow.com/questions/51488385/golang-can-not-find-package-gin-in-sub-directory/58315228#58315228", "title": "golang can not find package gin in sub directory", "body": "<p>If go mod is not enabled in root path of project then you have to enable go mod and install the package.</p>\n\n<p>For example , a package named \"/gin-gonic/gin\" is missing or you cannot find this.</p>\n\n<p>Please run this in src folder or parallel to github.com folder.</p>\n\n<pre><code>$ GO111MODULE=on go get -u github.com/gin-gonic/gin@v1.3.0\n</code></pre>\n\n<ol>\n<li>I am assuming your <strong>$GOPATH is Users/YourUserName/go</strong></li>\n</ol>\n\n<p>I hope this helps.</p>\n"}, {"tags": [], "owner": {"reputation": 604, "user_id": 6605210, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/45d992cccf0fb288a2fce9f1855e487d?s=128&d=identicon&r=PG&f=1", "display_name": "Max_Thom", "link": "https://stackoverflow.com/users/6605210/max-thom"}, "is_accepted": false, "score": 0, "last_activity_date": 1616072893, "creation_date": 1616072893, "answer_id": 66691754, "question_id": 51488385, "link": "https://stackoverflow.com/questions/51488385/golang-can-not-find-package-gin-in-sub-directory/66691754#66691754", "title": "golang can not find package gin in sub directory", "body": "<p>since Go v1.11, you can use go modules which let you create project with modules outside of the Go src/ folder. To do so, you can simply run the command <code>go build</code> at your root folder.</p>\n<p>This article explains it all: <a href=\"https://medium.com/mindorks/create-projects-independent-of-gopath-using-go-modules-802260cdfb51\" rel=\"nofollow noreferrer\">https://medium.com/mindorks/create-projects-independent-of-gopath-using-go-modules-802260cdfb51</a></p>\n<p>Gl &amp; Hf :D</p>\n"}], "owner": {"reputation": 25, "user_id": 1744294, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f105376a19a15a264052a23e4afb089?s=128&d=identicon&r=PG", "display_name": "Jerry H", "link": "https://stackoverflow.com/users/1744294/jerry-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2531, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1616072893, "creation_date": 1532387959, "last_edit_date": 1597308768, "question_id": 51488385, "link": "https://stackoverflow.com/questions/51488385/golang-can-not-find-package-gin-in-sub-directory", "title": "golang can not find package gin in sub directory", "body": "<p>I get the following error message:</p>\n<pre><code>controllers/user.go:4:2: cannot find package &quot;(underscore)/home/ubuntu/goapi/src/github.com/roes/api/vendor/github.com/gin-gonic/gin&quot; \nin any of: /usr/local/go/src/(underscore)/home/ubuntu/goapi/src/github.com/roes/api/vendor/github.com/gin-gonic/gin (from $GOROOT) \n     /home/ubuntu/goapi/src/_(underscore)/home/ubuntu/goapi/src/github.com/roes/api/vendor/github.com/gin-gonic/gin (from $GOPATH)\n</code></pre>\n<p>go env</p>\n<pre><code>GOPATH=&quot;/home/ubuntu/goapi&quot;\nGOROOT=&quot;/usr/local/go&quot;\n</code></pre>\n<p>folder structure</p>\n<pre><code>github.com/rose\n api\n  main.go // the loading gin is ok here\n  controller\n   |-user.go //with import ( &quot;github.com/gin-gonic/gin&quot; ) : error\n</code></pre>\n<p>go env looks Ok.</p>\n<p>Some more code:</p>\n<pre><code>  package controller\n\n  import (\n    &quot;github.com/gin-gonic/gin&quot;\n    &quot;net/http&quot;\n    //      &quot;github.com/astaxie/beego/orm&quot;\n    &quot;../database&quot;\n    &quot;../models&quot;\n  )\n\n  func init() {\n    database.ConnectToDb()\n    ORM = database.GetOrmObject()\n  }\n\n   //UserController ...\n   type UserController struct{}\n\n   func createUser(c *gin.Context) {\n</code></pre>\n<p>example resource: <a href=\"https://github.com/thearavind/go-gin-pg\" rel=\"nofollow noreferrer\">https://github.com/thearavind/go-gin-pg</a>, nothing wrong with this example. I just make it like MVC structure</p>\n<hr />\n<p>I did remove go.\nand install it again flow Linux version\n<a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">https://golang.org/doc/install</a>\nthen</p>\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n<p>then\n<a href=\"https://github.com/gin-gonic/gin#use-a-vendor-tool-like-govendor\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#use-a-vendor-tool-like-govendor</a>\nthe example code run ok.\nwhen I add controller folder with user.go with</p>\n<pre><code> import( &quot;github.com/gin-gonic/gin&quot;)\n</code></pre>\n<p>full code</p>\n<pre><code>  package controller\n  import( &quot;github.com/gin-gonic/gin&quot;)\n  func somestring(){\n    return &quot;hello world&quot;\n  }\n</code></pre>\n<p>in the main.go i use above</p>\n<pre><code>   curl https://raw.githubusercontent.com/gin-gonic/gin/master/examples/basic/main.go &gt; main.go\n    \n</code></pre>\n<p>add to import</p>\n<pre><code>    &quot;./controller&quot;\n    &quot;fmt&quot;\n</code></pre>\n<p>add to the main function</p>\n<pre><code>        user := new(controller.somestring)\n        fmt.Printf(user)\n</code></pre>\n<p>I understand this is not a good code for me, but will produce this error again, like so:</p>\n<pre><code> controller/user.go:4:2: cannot find package &quot;github.com/gin-gonic/gin&quot; in any of:\n/usr/local/go/src/github.com/gin-gonic/gin (from $GOROOT)\n/home/ubuntu/go/src/github.com/gin-gonic/gin (from $GOPATH)\n</code></pre>\n<p>(no underscore this time)</p>\n<p>No luck, reinstall go</p>\n<hr />\n<p>I am able to find the path, but not the underscore thing</p>\n<pre><code> 08:56:35 ~/go/src/github.com/jerry/core$ cd /home/ubuntu/go/src/github.com/jerry/core/vendor/github.com/gin-gonic/\n 08:56:45 ~/go/src/github.com/jerry/core/vendor/github.com/gin-gonic$\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "app-engine-flexible"], "answers": [{"tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": false, "score": 0, "last_activity_date": 1532385654, "last_edit_date": 1532385654, "creation_date": 1532383593, "answer_id": 51487800, "question_id": 51487639, "link": "https://stackoverflow.com/questions/51487639/using-app-engine-golang-flexible-environment-accesing-app-yaml-while-testing/51487800#51487800", "title": "Using App Engine golang flexible environment, accesing app.yaml while testing", "body": "<p>You will need to if/else based on whatever denotes dev vs live, then you can simply parse the yaml file to obtain and set these variables. For instance, one of my services (still running on standard mind you) is still using the old SDK where the version is required in the yaml. I parse it out like so:</p>\n\n<pre><code>import \"github.com/ghodss/yaml\" // or your choice\n\ntype AppVersion struct {\n    Version string `json:\"version\"`\n}\n\nfunc VersionID() (string, error) {\n    dat, err := ioutil.ReadFile(\"app.yaml\")\n    if err != nil {\n        return \"\", err\n    }\n    a := &amp;AppVersion{}\n    err = yaml.Unmarshal(dat, a)\n    if err != nil {\n        return \"\", err\n    }\n    return a.Version, nil\n}\n</code></pre>\n\n<p>Obviously this is then stored in a global so I don't have to open the file each time, but it wouldn't really matter if it's only parsed on local dev. Your case would probably best be served by <a href=\"https://godoc.org/os#Setenv\" rel=\"nofollow noreferrer\"><code>os.SetEnv</code></a> This is just one possible solution that works for me.</p>\n"}, {"tags": [], "owner": {"reputation": 1601, "user_id": 7650339, "user_type": "registered", "profile_image": "https://graph.facebook.com/10211714121623540/picture?type=large", "display_name": "I&#241;igo", "link": "https://stackoverflow.com/users/7650339/i%c3%b1igo"}, "is_accepted": true, "score": 0, "last_activity_date": 1532443033, "creation_date": 1532443033, "answer_id": 51501375, "question_id": 51487639, "link": "https://stackoverflow.com/questions/51487639/using-app-engine-golang-flexible-environment-accesing-app-yaml-while-testing/51501375#51501375", "title": "Using App Engine golang flexible environment, accesing app.yaml while testing", "body": "<p>For Google App Engine flexible, the dev server don't use \"app.yaml\", as the configuration is set locally. A workaround for this would be to set the environment variables before running the dev server. You can check this <a href=\"https://stackoverflow.com/questions/10856129/setting-an-environment-variable-before-a-command-in-bash-not-working-for-second\">question</a> for setting those variables just for that command.</p>\n"}], "owner": {"reputation": 23, "user_id": 1415923, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/062bca1c7fca0c9908b56731ace23761?s=128&d=identicon&r=PG", "display_name": "jcarlile", "link": "https://stackoverflow.com/users/1415923/jcarlile"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 0, "accepted_answer_id": 51501375, "answer_count": 2, "score": 0, "last_activity_date": 1532443033, "creation_date": 1532382500, "question_id": 51487639, "link": "https://stackoverflow.com/questions/51487639/using-app-engine-golang-flexible-environment-accesing-app-yaml-while-testing", "title": "Using App Engine golang flexible environment, accesing app.yaml while testing", "body": "<p>I am porting a golang service from App Engine standard environment to the flexible environment, and have a question about accessing app.yaml during development/testing.</p>\n\n<p>In my app.yaml I have a section where I set environment variables, that I later access in the code via os.GetEnv(...): </p>\n\n<pre><code>env_variables:\n  FORGE_CLIENT_ID: 'my-client-id'\n  FORGE_CLIENT_SECRET: 'my-client-secret'\n</code></pre>\n\n<p>In the App Engine standard environment, this runs fine, as I am using the app engine development server <code>dev-server.py</code>, which I believe takes care of reading the app.yaml file and making these environment variables available.</p>\n\n<p>However, in the flexible environment during development, the service is started simply with <code>go run *.go</code>, and the app doesn't seem to pick up any information in app.yaml, meaning I get an error that my environment variables are not set.</p>\n\n<p>I understand that app.yaml is used during deployment in the flexible environment, but I don't understand how or if it is used during development.  How do I access these environment variables from my development server?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["sql", "postgresql", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1532379069, "post_id": 51487035, "comment_id": 89943099, "body": "It&#39;s a variadic function: <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Passing_arguments_to_..._parameters</a>"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1532383960, "post_id": 51487035, "comment_id": 89944713, "body": "BTW, <code>sql.Open</code> is meant to open and maintain a connection pool to the database. You will want to <code>Open</code> it once, and reuse the handle it returns. The library itself will maintain the base connection and spin up/down any necessary additional connections."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1532386205, "post_id": 51487035, "comment_id": 89945288, "body": "Since you say you are learning Go, I&#39;ll add this as well. &quot;Don&#39;t Panic!&quot; is one of the Go mottos. In Go, you <b>handle</b> errors on the spot, or return them to the caller to handle. If your code ends up as a library some day and it panics, it terminates someone&#39;s program. Generally it is OK to Panic in your own <code>Main</code> function if something like a one-off <code>sql.Open</code> fails because that <b>is</b> something you would want to terminate your own program. It&#39;s something your application simply cannot function without."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1532386391, "post_id": 51487111, "comment_id": 89945330, "body": "Peek into the standard libraries often and you will learn much."}], "tags": [], "owner": {"reputation": 115, "user_id": 7242605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8FyO588yK8U/AAAAAAAAAAI/AAAAAAAAAYE/uEjuOg-R53c/photo.jpg?sz=128", "display_name": "Joe Sadaka", "link": "https://stackoverflow.com/users/7242605/joe-sadaka"}, "is_accepted": false, "score": 2, "last_activity_date": 1532379311, "creation_date": 1532379311, "answer_id": 51487111, "question_id": 51487035, "link": "https://stackoverflow.com/questions/51487035/golang-wrap-query-execution-in-postgres/51487111#51487111", "title": "Golang wrap query execution in postgres", "body": "<p>I figured it out by lookingin the source code of the SQL module and seeing how it was implemented in the db.Query() method.\nyou add the elipsis to the end of the slice argument to pass it through. Like params... </p>\n"}, {"tags": [], "owner": {"reputation": 372, "user_id": 2044647, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nsoLl.png?s=128&g=1", "display_name": "Tecnologer", "link": "https://stackoverflow.com/users/2044647/tecnologer"}, "is_accepted": true, "score": 1, "last_activity_date": 1532387990, "creation_date": 1532387990, "answer_id": 51488389, "question_id": 51487035, "link": "https://stackoverflow.com/questions/51487035/golang-wrap-query-execution-in-postgres/51488389#51488389", "title": "Golang wrap query execution in postgres", "body": "<p><a href=\"https://gobyexample.com/variadic-functions\" rel=\"nofollow noreferrer\">This</a> may help you</p>\n\n<blockquote>\n  <p>Variadic functions can be called in the usual way with individual arguments.\n  If you already have multiple args in a slice, apply them to a variadic function using <code>func(slice...)</code></p>\n</blockquote>\n\n<p>If you want send <code>data</code> from an slice, just add elipsis:</p>\n\n<pre><code>rows, err := db.Query(qstring, data...)\nif err != nil {\n   log.Fatal(err)\n}\n</code></pre>\n\n<p>If you has the values separated in different variables:</p>\n\n<pre><code>rows, err := db.Query(qstring, val1, val2, val3, valN)\nif err != nil {\n   log.Fatal(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 7242605, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-8FyO588yK8U/AAAAAAAAAAI/AAAAAAAAAYE/uEjuOg-R53c/photo.jpg?sz=128", "display_name": "Joe Sadaka", "link": "https://stackoverflow.com/users/7242605/joe-sadaka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 51488389, "answer_count": 2, "score": 0, "last_activity_date": 1532387990, "creation_date": 1532378976, "question_id": 51487035, "link": "https://stackoverflow.com/questions/51487035/golang-wrap-query-execution-in-postgres", "title": "Golang wrap query execution in postgres", "body": "<p>I am using the following code to wrap execution of aquery on a postgres database in a API I am building just to learn Go.</p>\n\n<pre><code>func QueryDB(qstring string) (*sql.Rows) {\n    psqlInfo := fmt.Sprintf(\"host=%s port=%d user=%s dbname=%s sslmode=disable\", host, port, user, dbname)\n    db, err := sql.Open(\"postgres\", psqlInfo)\n    if err != nil {\n      panic(err)\n    }\n    defer db.Close()\n\n    //Ping method opens the connection\n    err = db.Ping()\n    if err != nil {\n       panic(err)\n    }\n\n    //rows, err := db.Query(\"SELECT name FROM users WHERE age = $1\", age)\n    log.Printf(\"executing SQL %s\\n\",qstring)\n    rows, err := db.Query(qstring)\n    if err != nil {\n       log.Fatal(err)\n    }\n    return rows\n}\n</code></pre>\n\n<p>my question is as per the documentation the db.Query() method accepts a query strgin and ...interface{} arguments otherwise. tried adding a second argument \nparams ...interface{} to my function arguments and passing params as the second argument to the DB.Query method, and this doesn't work. it only seems to work if I specifically pull the arguments out of the interface slice.\nAny suggestions?</p>\n"}, {"tags": ["go", "graphql"], "comments": [{"owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "edited": false, "score": 1, "creation_date": 1532375484, "post_id": 51484714, "comment_id": 89941600, "body": "Can you add the details of <code>blogpostType</code> ?"}, {"owner": {"reputation": 1185, "user_id": 6907941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15451877a4ff142541b59b1d68212451?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Bergner", "link": "https://stackoverflow.com/users/6907941/jonas-bergner"}, "reply_to_user": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "edited": false, "score": 0, "creation_date": 1532377496, "post_id": 51484714, "comment_id": 89942521, "body": "edited and added the blogpostType :) @Aditya Singh"}, {"owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "edited": false, "score": 0, "creation_date": 1532379033, "post_id": 51484714, "comment_id": 89943083, "body": "I have added a working solution based on the updated type below."}], "answers": [{"comments": [{"owner": {"reputation": 1185, "user_id": 6907941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15451877a4ff142541b59b1d68212451?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Bergner", "link": "https://stackoverflow.com/users/6907941/jonas-bergner"}, "edited": false, "score": 1, "creation_date": 1532380961, "post_id": 51486404, "comment_id": 89943812, "body": "Thank you! I will check if that works for me tomorrow and will let you know! :)"}, {"owner": {"reputation": 1185, "user_id": 6907941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15451877a4ff142541b59b1d68212451?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Bergner", "link": "https://stackoverflow.com/users/6907941/jonas-bergner"}, "edited": false, "score": 0, "creation_date": 1533194700, "post_id": 51486404, "comment_id": 90259147, "body": "This worked. Graphql expected to get a slice, not an array. An important difference! Do you mind including in your answer, that the variable type made the difference?"}], "tags": [], "owner": {"reputation": 13358, "user_id": 3878940, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/v1J2L.jpg?s=128&g=1", "display_name": "Aditya Singh", "link": "https://stackoverflow.com/users/3878940/aditya-singh"}, "is_accepted": true, "score": 3, "last_activity_date": 1532378975, "last_edit_date": 1532378975, "creation_date": 1532376038, "answer_id": 51486404, "question_id": 51484714, "link": "https://stackoverflow.com/questions/51484714/golang-graphql-schema-field-unable-to-return-array/51486404#51486404", "title": "Golang graphql schema field unable to return array", "body": "<p>Based on your problem, I assumed and added some types to make the solution working as below. This example only queries for selected fields <code>id,title,body,author</code></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n\n    \"github.com/graphql-go/graphql\"\n)\n\nvar blogpostType = graphql.NewObject(graphql.ObjectConfig{\n    Name: \"Blogpost\",\n    Fields: graphql.Fields{\n        \"id\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.id, nil\n            },\n        },\n        \"title\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.title, nil\n            },\n        },\n        \"body\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.body, nil\n            },\n        },\n        \"created\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.created, nil\n            },\n        },\n        \"author\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.author, nil\n            },\n        },\n    },\n})\n\ntype Blogpost struct {\n    id      string\n    title   string\n    body    string\n    created string\n    author  string\n}\n\nfunc main() {\n    // Schema\n    fields := graphql.Fields{\n        \"blogpostsBetween\": &amp;graphql.Field{\n            Type: graphql.NewList(blogpostType),\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                // ... some more code ...\n                // what I return here was placed to demonstrate the error.\n                return []Blogpost{\n                    Blogpost{\n                        id:      \"new-post\",\n                        title:   \"new post\",\n                        body:    \"Lorem ipsum\",\n                        author:  \"John Doe\",\n                        created: \"12.12.2012\",\n                    },\n                }, nil\n            },\n            Args: graphql.FieldConfigArgument{\n                \"from\": &amp;graphql.ArgumentConfig{\n                    Type: graphql.String,\n                },\n                \"to\": &amp;graphql.ArgumentConfig{\n                    Type: graphql.String,\n                },\n            },\n        },\n    }\n    rootQuery := graphql.ObjectConfig{Name: \"RootQuery\", Fields: fields}\n    schemaConfig := graphql.SchemaConfig{Query: graphql.NewObject(rootQuery)}\n    schema, err := graphql.NewSchema(schemaConfig)\n    if err != nil {\n        log.Fatalf(\"failed to create new schema, error: %v\", err)\n    }\n\n    // Query\n    query := `\n            {\n                blogpostsBetween {\n                    id,\n                    title,\n                    body,\n                    author\n                }\n            }\n        `\n    params := graphql.Params{Schema: schema, RequestString: query}\n    r := graphql.Do(params)\n    if len(r.Errors) &gt; 0 {\n        log.Fatalf(\"failed to execute graphql operation, errors: %+v\", r.Errors)\n    }\n    rJSON, _ := json.Marshal(r)\n    fmt.Printf(\"%s \\n\", rJSON)\n}\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 6907941, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/15451877a4ff142541b59b1d68212451?s=128&d=identicon&r=PG&f=1", "display_name": "Jonas Bergner", "link": "https://stackoverflow.com/users/6907941/jonas-bergner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1285, "favorite_count": 1, "accepted_answer_id": 51486404, "answer_count": 1, "score": 1, "last_activity_date": 1532378975, "creation_date": 1532368596, "last_edit_date": 1532377458, "question_id": 51484714, "link": "https://stackoverflow.com/questions/51484714/golang-graphql-schema-field-unable-to-return-array", "title": "Golang graphql schema field unable to return array", "body": "<p>I am receiving this error when trying to get an array from a graphql query:</p>\n\n<pre><code>\"User Error: expected iterable, but did not find one for field RootQuery.blogpostsBetween.\"\n</code></pre>\n\n<p>which is odd, since it has worked perfectly fine just a few weeks ago having my Field configured like this:</p>\n\n<pre><code>\"blogpostsBetween\": &amp;graphql.Field{\n    Type: graphql.NewList(blogpostType),\n    Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                       // ... some more code ...\n                      // what I return here was placed to demonstrate the error.\n        return [5]Blogpost{}, err\n    },\n    Args: graphql.FieldConfigArgument{\n        \"from\": &amp;graphql.ArgumentConfig{\n            Type: graphql.String,\n        },\n        \"to\": &amp;graphql.ArgumentConfig{\n            Type: graphql.String,\n        },\n    },\n},\n</code></pre>\n\n<p>I am really confused on why this is not working anymore, because as I said, I'm quite sure I have not changed anything. But I'd be happy to be wrong.</p>\n\n<p>EDIT: details of blogpostType</p>\n\n<pre><code>var blogpostType = graphql.NewObject(graphql.ObjectConfig{\n    Name: \"Blogpost\",\n    Fields: graphql.Fields{\n        \"id\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.id, nil\n            },\n        },\n        \"title\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.title, nil\n            },\n        },\n        \"body\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.body, nil\n            },\n        },\n        \"created\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.created, nil\n            },\n        },\n        \"author\": &amp;graphql.Field{\n            Type: graphql.String,\n            Resolve: func(p graphql.ResolveParams) (interface{}, error) {\n                m := p.Source.(Blogpost)\n                return m.author, nil\n            },\n        },\n    },\n})\n</code></pre>\n"}, {"tags": ["string", "go", "split"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1532368015, "post_id": 51484505, "comment_id": 89938016, "body": "Have you looked at <code>strings.Split</code> (<a href=\"https://golang.org/pkg/strings/#Split\" rel=\"nofollow noreferrer\">golang.org/pkg/strings/#Split</a>)? Should be the first result if you googled how to split strings in go."}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532368529, "post_id": 51484505, "comment_id": 89938284, "body": "Yes I did. using strings.Split, i can split name and value by , but how to join them with {name:value} ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1532368590, "post_id": 51484505, "comment_id": 89938319, "body": "You&#39;re already joining them in the sample code you gave. It seems like you&#39;re trying to produce JSON-formatted output though, so I&#39;m not sure why you wouldn&#39;t just use <code>encoding&#47;json</code> to do so."}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532369340, "post_id": 51484505, "comment_id": 89938657, "body": "No its not json formatted, Its simple string"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532369697, "post_id": 51484505, "comment_id": 89938829, "body": "JSON is just a string, and the string you&#39;re already producing in the example code is valid JSON. Regardless... what is the issue you&#39;re having with the method you&#39;re already using?"}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532369987, "post_id": 51484505, "comment_id": 89938971, "body": "even then the output is as follows; {&quot;text&quot;:0,&quot;text&quot;:285}"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532370311, "post_id": 51484505, "comment_id": 89939125, "body": "OK? Could you clarify your question to indicate what output you need and how it&#39;s different from the output you&#39;re getting? The description and the code in the question don&#39;t match so it&#39;s hard to tell what your issue/question really is."}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532370621, "post_id": 51484505, "comment_id": 89939275, "body": "The expected output should be; Parameters: {&quot;text&quot;:&quot;0&quot;} Parameters: {&quot;text&quot;:&quot;285&quot;} Parameters: {&quot;text&quot;:&quot;404&quot;} Parameters: {&quot;text&quot;:&quot;6&quot;} Parameters: {&quot;text&quot;:&quot;24&quot;}"}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532370670, "post_id": 51484505, "comment_id": 89939302, "body": "Current output is Parameters : {&quot;text&quot;:0,&quot;text&quot;:285}"}, {"owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532370672, "post_id": 51484505, "comment_id": 89939306, "body": "Current output is Parameters : {&quot;text&quot;:0,&quot;text&quot;:285}"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1532372302, "post_id": 51484505, "comment_id": 89940127, "body": "<a href=\"https://play.golang.org/p/b5rffvBUwqd\" rel=\"nofollow noreferrer\">play.golang.org/p/b5rffvBUwqd</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532373181, "post_id": 51484505, "comment_id": 89940514, "body": "There is no way that the code you posted would be able to produce the output you gave in your comments."}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1532379826, "post_id": 51485548, "comment_id": 89943427, "body": "The condition should be: <code>i &lt; len(matchField) &amp;&amp; i &lt; len(matchValue)</code>."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 0, "last_activity_date": 1532372353, "creation_date": 1532372353, "answer_id": 51485548, "question_id": 51484505, "link": "https://stackoverflow.com/questions/51484505/string-split-in-golang/51485548#51485548", "title": "String split in golang", "body": "<p>You need to use <code>strings.Split</code> to create the array, instead of an array with a single element:</p>\n\n<p><a href=\"http://play.golang.org/p/b5rffvBUwqd\" rel=\"nofollow noreferrer\">play.golang.org/p/b5rffvBUwqd</a> </p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc main() {\n   var m string\n   matchField := strings.Split(\"index,index,index,index\", \",\")\n   matchValue := strings.Split(\"29,4,87,54\", \",\")\n\n   for i := 0 ; i &lt; len(matchField); i++ {\n        m = parameter(matchField[i], matchValue[i])\n        fmt.Printf(\"Parameters: %s\\n\", m)\n   }\n}\n\n\nfunc parameter(name string, value string) (matcher string) {\n    var result string\n    if name != \"\" || value != \"\" {\n            result = fmt.Sprintf(\"{\\\"%s\\\":\\\"%s\\\"}\", name, value)\n    }\n    return result\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 6460289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ce48cfad1c713deffe5e0fd7953db8d6?s=128&d=identicon&r=PG&f=1", "display_name": "Priyanka", "link": "https://stackoverflow.com/users/6460289/priyanka"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1658, "favorite_count": 0, "closed_date": 1532416427, "accepted_answer_id": 51485548, "answer_count": 1, "score": -1, "last_activity_date": 1532389877, "creation_date": 1532367801, "last_edit_date": 1532389877, "question_id": 51484505, "link": "https://stackoverflow.com/questions/51484505/string-split-in-golang", "closed_reason": "Needs details or clarity", "title": "String split in golang", "body": "<p>I have two arguments name and value, that I am trying to parse at runtime.</p>\n\n<p>At run time I am passing the following values:</p>\n\n<pre><code>name = text,text,text,text,text\nvalue = 0 ,285,404,6,24\n</code></pre>\n\n<p>Currently the output is as following;</p>\n\n<pre><code>Parameters: {\"text,text,text,text,text\":\"0,285,404,6,24\"}\n</code></pre>\n\n<p>when actually it must display as,</p>\n\n<pre><code>Parameters: {\"text\":\"0\"}\nParameters: {\"text\":\"285\"}\nParameters: {\"text\":\"404\"}\nParameters: {\"text\":\"6\"}\nParameters: {\"text\":\"24\"}\n</code></pre>\n\n<p>Following is my code;</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n   var m string\n   var matchField = []string{\"index,index,index,index\"}\n   var matchValue =[]string{\"29,4,87,54\"}\n\n   for i := 0 ; i &lt; 1 ; i++ {\n        m = parameter(matchField[i], matchValue[i])\n        fmt.Printf(\"Result: %s\\n\", m)\n   }\n}\n\n\nfunc parameter(name string, value string) (matcher string) {\n    var result string\n    if name != \"\" || value != \"\" {\n            result = fmt.Sprintf(\"{\\\"%s\\\":\\\"%s\\\"}\", name, value)\n    }\n    return result\n}\n</code></pre>\n\n<p>I wanted to know how to display the output accurately.</p>\n"}, {"tags": ["go", "visual-studio-code", "stack-trace"], "comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1532451699, "post_id": 51483314, "comment_id": 89976764, "body": "Oh, yeah, you are right. So any way to do it with VsCode? I&#39;m debugging Go code BTW."}, {"owner": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 1, "creation_date": 1532452054, "post_id": 51483314, "comment_id": 89976931, "body": "I typically just <code>go run</code> in the VSCode terminal, then stacktraces are output there"}, {"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "reply_to_user": {"reputation": 124932, "user_id": 2308683, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/eac16c9fc481cb6825f8b3a35f916b5c?s=128&d=identicon&r=PG", "display_name": "OneCricketeer", "link": "https://stackoverflow.com/users/2308683/onecricketeer"}, "edited": false, "score": 0, "creation_date": 1533049827, "post_id": 51483314, "comment_id": 90198696, "body": "Oh, I need to print out stack trace when I&#39;m debugging some complicated Go module so that I can know how I ended up there, even when no (crash) stacktraces are printed to the terminal."}], "answers": [{"tags": [], "owner": {"reputation": 188, "user_id": 9749861, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9dabca17e5dcffafb873bb17b4527c?s=128&d=identicon&r=PG&f=1", "display_name": "B.Z.", "link": "https://stackoverflow.com/users/9749861/b-z"}, "is_accepted": true, "score": 3, "last_activity_date": 1609282113, "creation_date": 1609282113, "answer_id": 65499791, "question_id": 51483314, "link": "https://stackoverflow.com/questions/51483314/vs-code-how-to-display-stack-trace/65499791#65499791", "title": "VS Code, how to display stack trace", "body": "<p>The stacktrace tab is not shown in your case.</p>\n<p>To show the panel:</p>\n<pre><code>  menu-&gt;&gt;View-&gt;&gt;Run\n</code></pre>\n<p>The CALL STACK will be shown on the left side panel by default.</p>\n"}], "owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3521, "favorite_count": 0, "accepted_answer_id": 65499791, "answer_count": 1, "score": 3, "last_activity_date": 1609435044, "creation_date": 1532362892, "last_edit_date": 1609435044, "question_id": 51483314, "link": "https://stackoverflow.com/questions/51483314/vs-code-how-to-display-stack-trace", "title": "VS Code, how to display stack trace", "body": "<p>How to display stack trace in VS Code?</p>\n<p>From <a href=\"https://docs.microsoft.com/en-us/windows-hardware/drivers/debugger/k--kb--kc--kd--kp--kp--kv--display-stack-backtrace-\" rel=\"nofollow noreferrer\">display stack trace in VS Code</a>,  it says,</p>\n<blockquote>\n<p>When you issue the k, kb, kp, kP, or kv command, a stack trace is displayed in a tabular format. If line loading is enabled, source modules and line numbers are also displayed.</p>\n</blockquote>\n<p>However, I am just not able to make it working. This is what I get when trying with the k, kb, kp, kP, or kv commands:</p>\n<pre><code>k\nUnable to eval expression: &quot;could not find symbol value for k&quot;\nFailed to eval expression:  {\n &quot;symbol&quot;: &quot;k&quot;,\n &quot;scope&quot;: {\n  &quot;goroutineID&quot;: 1,\n  &quot;frame&quot;: 0\n }\n} \n\nEval error: could not find symbol value for k\nkb\nUnable to eval expression: &quot;could not find symbol value for kb&quot;\nFailed to eval expression:  {\n &quot;symbol&quot;: &quot;kb&quot;,\n &quot;scope&quot;: {\n  &quot;goroutineID&quot;: 1,\n  &quot;frame&quot;: 0\n }\n} \n\nEval error: could not find symbol value for kb\n\n~. k c\nUnable to eval expression: &quot;1:1: illegal character U+007E '~'&quot;\nFailed to eval expression:  {\n &quot;symbol&quot;: &quot;~. k c&quot;,\n &quot;scope&quot;: {\n  &quot;goroutineID&quot;: 1,\n  &quot;frame&quot;: 0\n }\n} \n\nEval error: 1:1: illegal character U+007E '~'\n</code></pre>\n<p>So, how to display stack trace?</p>\n"}, {"tags": ["pointers", "go", "glfw", "cgo"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532361922, "post_id": 51483032, "comment_id": 89934943, "body": "<code>Values</code> is a slice, which contains a pointer. A Go slice isn&#39;t really useful in C, what do you intend to do with it?"}, {"owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532362008, "post_id": 51483032, "comment_id": 89934989, "body": "Well I intend to use the circular queue to store events from callback functions by retrieving it with getuserpointer and to avoid global variables, that&#39;s how i do it in C atleast"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1532374023, "post_id": 51483032, "comment_id": 89940907, "body": "Does the C code need to use the circular buffer, is it expecting a particular structure? If the C code uses the structure at all, it needs to be compatible with C. If you need to pass through an opaque structure, but need it implemented in Go, maybe using a package level variable, and encapsulating it in a separate package would suffice."}], "answers": [{"tags": [], "owner": {"reputation": 21281, "user_id": 1122645, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/mrljv.png?s=128&g=1", "display_name": "UmNyobe", "link": "https://stackoverflow.com/users/1122645/umnyobe"}, "is_accepted": false, "score": 3, "last_activity_date": 1532417874, "creation_date": 1532417874, "answer_id": 51493036, "question_id": 51483032, "link": "https://stackoverflow.com/questions/51483032/passing-go-pointer-to-cgo/51493036#51493036", "title": "Passing Go pointer to Cgo", "body": "<p>Solution is quite simple. You have to flatten what you provide to the C code. Rather than pass the circular queue, pass the data.</p>\n\n<pre><code>//C\nint mysterious_c_func(const char* values, front int32_t, back int32_t, capacity int32_t);\n\n// Go\ntype CircularQueue struct {\n    Values      []char //this can't possibly work with interface.\n    Front, Rear int32\n    Capacity    int32\n}\n...\nvar q CircularQueue\ndata := (*C.char)(unsafe.Pointer(q.values))\nC.mysterious_c_func(data, C.int(queue.Front), C.int(queue.Rear), C.int(queue.Capacity))\n</code></pre>\n\n<p>But the real problem is that you are trying to implement a complex data structure partially in C, partially in Go. Either implement the circula buffer</p>\n\n<ol>\n<li>in both languages and allow the construction from an array.</li>\n<li>only where you really need that concept. </li>\n</ol>\n"}], "owner": {"reputation": 684, "user_id": 5017647, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/af8091d51c64e0558d5b600a3cbde430?s=128&d=identicon&r=PG&f=1", "display_name": "Whiteclaws", "link": "https://stackoverflow.com/users/5017647/whiteclaws"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1064, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1532417874, "creation_date": 1532361871, "last_edit_date": 1532416570, "question_id": 51483032, "link": "https://stackoverflow.com/questions/51483032/passing-go-pointer-to-cgo", "title": "Passing Go pointer to Cgo", "body": "<p>I've been playing around with the GLFW bindings, and I'd like to pass a Queue structure to it, via glfw.SetUserPointer(...), </p>\n\n<p>As such, I pass a it like this:</p>\n\n<pre><code>type CircularQueue struct {\n    Values      []interface{}\n    Front, Rear int32\n    Capacity    int32\n}\n\nfunc newCircularQueue(capacity int32) *CircularQueue {\n    if capacity &lt; 1 {\n        log.Fatal(\"Capacity of Circular Queue Zero or Negative\")\n    }\n\n    queue := &amp;CircularQueue{Capacity: capacity}\n    queue.Values = make([]interface{}, capacity)\n    return queue\n}\n\n...\nevents := newCircularQueue(16)\nwindow.SetUserPointer(unsafe.Pointer(events))\n</code></pre>\n\n<p>But I get a runtime error, </p>\n\n<pre><code>panic: runtime error: cgo argument has Go pointer to Go pointer\n</code></pre>\n\n<p>I do some digging and it seems like... and I quote:</p>\n\n<pre><code>Go code may pass a Go pointer to C provided the Go memory to which it \npoints does not contain any Go pointers. The C code must preserve this \nproperty: it must not store any Go pointers in Go memory, even temporarily. \nWhen passing a pointer to a field in a struct, the Go memory in question is \nthe memory occupied by the field, not the entire struct. When passing a \npointer to an element in an array or slice, the Go memory in question is the \nentire array or the entire backing array of the slice. \n</code></pre>\n\n<p>But, my structure has no pointers in it, I'm confused :(</p>\n"}, {"tags": ["go", "struct", "yaml"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532360754, "post_id": 51482629, "comment_id": 89934217, "body": "What is the purpose to having types with identical structures that are all handled exactly the same way?"}, {"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1532360903, "post_id": 51482629, "comment_id": 89934320, "body": "Well, that was just an example, I didn&#39;t want to post my real code but those structures are differentes values and they are variable, those are not the same, i&#39;ll edit my post to avoid any confusion."}], "answers": [{"comments": [{"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532363211, "post_id": 51482783, "comment_id": 89935623, "body": "How could return the structure with their values filled and assign it to a structure, I mean something like this: <code>car := GetYamlData(Car)</code>  Return the .yaml filled with their values and assign it to a new structure object"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532364745, "post_id": 51482783, "comment_id": 89936395, "body": "You get the exact same behavior with the suggested solution above. Is there some particular reason to insist it be a return value instead of a reference parameter? Because that will drastically increase the complexity of the solution."}, {"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532366531, "post_id": 51482783, "comment_id": 89937296, "body": "Thanks Adrian, the code above is working but the values of the structure are not filled but looking in the interface, it is retrieving the data, i just need figure out how to assign those to the corresponding value of the structure."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532366626, "post_id": 51482783, "comment_id": 89937345, "body": "I&#39;m not sure I understand - you said it&#39;s filling in the values but it&#39;s not filling in the values? Which is it?"}, {"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532367051, "post_id": 51482783, "comment_id": 89937562, "body": "What I mean is fill the &quot;struct&quot; properties with the function &quot;GetYamlData&quot;, the interface contain the data from the .yaml file but I have to figure out how to assign the .yaml values to the structure properties."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532367116, "post_id": 51482783, "comment_id": 89937589, "body": "Pass the struct to the function, just like you would with <code>yaml.Unmarshal</code>, since it&#39;s just a wrapper of <code>yaml.Unmarshal</code>. Without seeing the code you&#39;re actually using, it&#39;s hard to offer any more advice."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532367259, "post_id": 51482783, "comment_id": 89937658, "body": "Added example usage to the answer, hope it helps."}, {"owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532367589, "post_id": 51482783, "comment_id": 89937806, "body": "That was terrific! that&#39;s what exactly what I wanted to do! Thanks Adrian."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "edited": false, "score": 0, "creation_date": 1532375500, "post_id": 51482783, "comment_id": 89941610, "body": "@JavierSalas Might I add my two cents. One of the beauties of Go, is that Go is written in Go. In cases like this, you can inspect the standard libraries&#39; code to &quot;see how it&#39;s done&quot;. Obviously, knowing where to look and what to look for is the more difficult part, but it&#39;s a great way to see what goes on &quot;under the hood&quot; and adapt your own code and coding behaviors."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1532367235, "last_edit_date": 1532367235, "creation_date": 1532361010, "answer_id": 51482783, "question_id": 51482629, "link": "https://stackoverflow.com/questions/51482629/how-to-send-any-structure-as-parameter-to-a-method-and-return-the-structure/51482783#51482783", "title": "How to send any structure as parameter to a method and return the structure?", "body": "<p>You can do it the exact same way <code>yaml.Unmarshal</code> does it, by taking in a value to unmarshal into:</p>\n\n<pre><code>func GetYamlData(i interface{}) {\n    yaml.Unmarshal(Filepath, i)    \n}\n</code></pre>\n\n<p>Example usage:</p>\n\n<pre><code>func main () {\n    var car Car\n    var motorcycle Motorcycle\n    var bus Bus\n    GetYamlData(&amp;car)\n    GetYamlData(&amp;motorcycle)\n    GetYamlData(&amp;bus)\n}\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 10123374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/253ef45474ba37378f0360a3c54a80e2?s=128&d=identicon&r=PG&f=1", "display_name": "Javier Salas", "link": "https://stackoverflow.com/users/10123374/javier-salas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 51482783, "answer_count": 1, "score": 0, "last_activity_date": 1532367235, "creation_date": 1532360498, "last_edit_date": 1532365727, "question_id": 51482629, "link": "https://stackoverflow.com/questions/51482629/how-to-send-any-structure-as-parameter-to-a-method-and-return-the-structure", "title": "How to send any structure as parameter to a method and return the structure?", "body": "<p>I'm new to Go and I'm seeing if there's a way to have a method that receives any structure as parameter.</p>\n\n<p>I have something like this in my code that is a function that does exactly the same for 5 structures and returns the same structure,  but I don't know if I can do that. I'm wondering if I can do something like this:</p>\n\n<pre><code>type Car struct {\n     Model   string `yaml:\"Model\"`\n     Color   string `yaml:\"Color\"`\n     Wheels  int    `yaml:Wheels\"`\n     Windows int    `yaml:\"Windows\"` \n}\n\ntype Motorcycle struct {\n     Model    string `yaml:\"Model\"`\n     Color    string `yaml:\"Color\"`\n     Wheels   int      `yaml:Wheels\"`\n}\n\ntype Bus struct {\n     Model      string `yaml:\"Model\"`\n     Color      string `yaml:\"Color\"`\n     Wheels     int    `yaml:Wheels\"`\n     Passengers int    `yaml:\"Passengers\"`\n}\n\nfunc main () {\n\n    car := GetYamlData(Car)\n    motorcycle := GetYamlData(Motorcycle)\n    Bus := GetYamlData(Bus)\n}\n\nfunc GetYamlData(struct anyStructure) (ReturnAnyStruct struct){\n\n       yaml.Unmarshal(yamlFile, &amp;anyStructure)\n\n       return anyStructure\n}\n</code></pre>\n\n<p>Is possible to do something like the code above? Actually what I have is something like this:</p>\n\n<pre><code>func main(){\n   car, _, _ := GetYamlData(\"car\")\n    _,motorcycle,_ := GetYamlData(\"motorcycle\")\n    _,_,bus := GetYamlData(\"bus\")\n }\n\nfunc GetYamlData(structureType string) (car *Car, motorcycle *Motorcycle, bus *Bus){\n\n switch structureType{\n\n        case \"car\":\n                yaml.Unmarshal(Filepath, car)\n        case \"motorcycle\":\n                yaml.Unmarshal(Filepath, motorcycle)\n        case \"bus\":\n                yaml.Unmarshal(Filepath, bus)\n }\n\n return car, motorcycle, bus\n\n}\n</code></pre>\n\n<p>With the time this will be increasing and it will return a lot of values and I don't want a lot of return values, is there a way to do it with the first code that I posted?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "edited": false, "score": 0, "creation_date": 1532356223, "post_id": 51480830, "comment_id": 89931156, "body": "Don&#39;t skip the error when unmarshaling. Your code gives an error <code>json: cannot unmarshal object into Go struct field Pipeline.Flows of type main.Flow</code>. That&#39;s the reason you are getting nil as output"}], "answers": [{"comments": [{"owner": {"reputation": 76, "user_id": 9948469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91b1d58babc1b8d3afe3473ace9e3e36?s=128&d=identicon&r=PG", "display_name": "shorez", "link": "https://stackoverflow.com/users/9948469/shorez"}, "edited": false, "score": 0, "creation_date": 1532362508, "post_id": 51481155, "comment_id": 89935266, "body": "Thanks for the suggestions. Could you illustrate them with examples?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1532355936, "creation_date": 1532355936, "answer_id": 51481155, "question_id": 51480830, "link": "https://stackoverflow.com/questions/51480830/marshalling-and-unmarshalling-struct-to-json-loses-information/51481155#51481155", "title": "Marshalling and Unmarshalling struct to json loses information", "body": "<p>When a struct field is of an interface type, <code>encoding/json</code> has no way to know what concrete type to use to unmarshal into it, so it skips it. Either use a concrete type in the definition, or prepopulate the interface field(s) with empty concrete instances that it can unmarshal into.</p>\n"}], "owner": {"reputation": 76, "user_id": 9948469, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91b1d58babc1b8d3afe3473ace9e3e36?s=128&d=identicon&r=PG", "display_name": "shorez", "link": "https://stackoverflow.com/users/9948469/shorez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 368, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1532355936, "creation_date": 1532354992, "question_id": 51480830, "link": "https://stackoverflow.com/questions/51480830/marshalling-and-unmarshalling-struct-to-json-loses-information", "title": "Marshalling and Unmarshalling struct to json loses information", "body": "<p>I'm trying to marshal a struct into json (works as expected) and directly unmarshalling it again, but it seems as if information gets lost.</p>\n\n<p>This is probably a design flaw in my application but as I'm a go beginner I don't know better. Help appreciated.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Flow interface {\n    Exec(input map[string]string) (output map[string]string, err error)\n}\n\ntype FlowData struct {\n    Static map[string]string\n    Output map[string]string\n}\n\ntype FooFlow struct {\n    Data FlowData\n}\n\nfunc (flow FooFlow) Exec(input map[string]string) (output map[string]string, err error) {\n    output = map[string]string{\"message\": flow.Data.Static[\"message\"]}\n    return output, nil\n}\n\ntype BarFlow struct {\n    Data FlowData\n}\n\nfunc (flow BarFlow) Exec(input map[string]string) (output map[string]string, err error) {\n    output = map[string]string{\"message\": flow.Data.Static[\"prefix\"] + \"_bar\"}\n    return output, nil\n}\n\ntype Pipeline struct {\n    Entrypoint string\n    Flows      map[string]Flow\n}\n\nfunc main() {\n    foo := FooFlow{\n        Data: FlowData{\n            Static: map[string]string{\"message\": \"foo\"},\n        },\n    }\n\n    bar := BarFlow{\n        Data: FlowData{\n            Static: map[string]string{\"prefix:\": \"baz\"},\n        },\n    }\n\n    pipe := Pipeline{\n        Entrypoint: \"foobar\",\n        Flows: map[string]Flow{\n            \"foo\": foo,\n            \"bar\": bar,\n        },\n    }\n\n    data, _ := json.Marshal(pipe)\n    fmt.Printf(\"pipe1: %+v\\n\", pipe)\n    fmt.Println(\"json:\", string(data))\n\n    var pipe2 Pipeline\n    json.Unmarshal(data, &amp;pipe2)\n    fmt.Printf(\"pipe2: %+v\\n\", pipe2)\n}\n</code></pre>\n\n<p>Executing this gives the following result:</p>\n\n<pre><code>pipe1: {Entrypoint:foobar Flows:map[foo:{Data:{Static:map[message:foo] Output:map[]}} bar:{Data:{Static:map[prefix::baz] Output:map[]}}]}\n\njson: {\"Entrypoint\":\"foobar\",\"Flows\":{\"bar\":{\"Data\":{\"Static\":{\"prefix:\":\"baz\"},\"Output\":null}},\"foo\":{\"Data\":{\"Static\":{\"message\":\"foo\"},\"Output\":null}}}}\n\npipe2: {Entrypoint:foobar Flows:map[bar:&lt;nil&gt; foo:&lt;nil&gt;]}\n</code></pre>\n\n<p>Apparently all information gets correctly marshalled into json. But the unmarshalling ignores the actual values of the Flows as just adds them to the map as <code>&lt;nil&gt;</code>.</p>\n\n<p>How to properly solve this?</p>\n"}, {"tags": ["json", "go", "type-conversion"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1532354711, "post_id": 51480660, "comment_id": 89930075, "body": "You&#39;re confusing type assertion with type conversion. Type assertion only succeeds when you assert to the actual underlying type. It cannot convert it to a different type."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1532354763, "post_id": 51480660, "comment_id": 89930117, "body": "Assertions are covered in the tour (<a href=\"https://tour.golang.org/methods/15\" rel=\"nofollow noreferrer\">tour.golang.org/methods/15</a>) and the spec (<a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Type_assertions</a>)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532354823, "post_id": 51480660, "comment_id": 89930166, "body": "Not to mention that the <code>json.Number</code> underlying type is <code>string</code> (look at the <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\">docs</a> <code>type Number string</code>). There&#39;s no way you could directly convert an integer to a string correctly anyway."}], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 0, "last_activity_date": 1532361465, "creation_date": 1532361465, "answer_id": 51482923, "question_id": 51480660, "link": "https://stackoverflow.com/questions/51480660/why-golang-json-number-cant-convert-int-or-string-int-like-10/51482923#51482923", "title": "why golang json number can&#39;t convert int or string int like &quot;10&quot;?", "body": "<p>Here's your example in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    number := 10\n    strNumber := \"10\"\n    test(number)\n    test(strNumber)\n}\n\nfunc test(i interface{}) {\n    var strNum string\n    switch x := i.(type) {\n    case int:\n        strNum = strconv.Itoa(x)\n    case string:\n        if _, err := strconv.ParseInt(x, 10, 64); err == nil {\n            strNum = x\n        }\n    }\n    jsonNum := json.Number(strNum)\n    fmt.Printf(\"%[1]v %[1]T\\n\", jsonNum)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/iDSxrORX9yc\" rel=\"nofollow noreferrer\">https://play.golang.org/p/iDSxrORX9yc</a></p>\n\n<p>Output:</p>\n\n<pre><code>10 json.Number\n10 json.Number\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8273333, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a322a00c699fe64ed5b27732f981a0ea?s=128&d=identicon&r=PG&f=1", "display_name": "Timmy", "link": "https://stackoverflow.com/users/8273333/timmy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 962, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1532361465, "creation_date": 1532354452, "question_id": 51480660, "link": "https://stackoverflow.com/questions/51480660/why-golang-json-number-cant-convert-int-or-string-int-like-10", "title": "why golang json number can&#39;t convert int or string int like &quot;10&quot;?", "body": "<p>I want convert interface value to number, but when interface is number or number string, it will not work, I do not know why we can't convert by this way?    </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    number := 10\n    strNumber := \"10\"\n    test(number)\n    test(strNumber)\n}\n\nfunc test(i interface{}) {\n    strNum, ok := i.(json.Number)\n    fmt.Println(strNum, ok, reflect.TypeOf(i))\n}\n</code></pre>\n\n<p>It will produce result like this:</p>\n\n<pre><code>   false int\n   false string\n</code></pre>\n"}, {"tags": ["json", "go", "struct"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1532348910, "post_id": 51478658, "comment_id": 89925915, "body": "The structure of the Go data structure must match the JSON. Your JSON is an object so marshal into a struct and not into a slice (which would be appropriate for a JSON array)."}], "answers": [{"comments": [{"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349073, "post_id": 51478793, "comment_id": 89926028, "body": "Well this removes the original error but now I get: <code>json: cannot unmarshal string into Go value of type main.Users exit status 1 </code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349160, "post_id": 51478793, "comment_id": 89926085, "body": "Let me check because I have tested in on Go playground it is working fine."}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349223, "post_id": 51478793, "comment_id": 89926134, "body": "Yea, but I need to get the json inside <code>getUserRandking</code> function. Appreciate if you can revamp the code."}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349373, "post_id": 51478793, "comment_id": 89926241, "body": "Well, it there: The code sample starts with <code>func getUserRandking() {...</code> How can you see it?"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 1, "creation_date": 1532349461, "post_id": 51478793, "comment_id": 89926294, "body": "@Babr, simply <code>return resp.Children</code> then."}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349478, "post_id": 51478793, "comment_id": 89926305, "body": "@Babr Can you print the output of <code>fmt.Println(string(body))</code>"}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349676, "post_id": 51478793, "comment_id": 89926447, "body": "@Himanshu, The result is like <code>&quot;{\\&quot;name\\&quot;:\\&quot;userslist\\&quot;,\\&quot;children\\&quot;:[{\\&quot;name\\&quot;:\\&quot;cat\\&quot;,\\&quot;v&zwnj;&#8203;alue\\&quot;:107,\\&quot;url\\&quot;:\\&zwnj;&#8203;&quot;http:&#47;&#47;example.com&#47;&zwnj;&#8203;1.jpg\\&quot;},...</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349782, "post_id": 51478793, "comment_id": 89926523, "body": "@Babr Please check updated code for returning <code>Children</code> Slice from <code>getUserRandking()</code> function"}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532349955, "post_id": 51478793, "comment_id": 89926641, "body": "Well by using <code>return users1.Children</code> I still get <code>json: cannot unmarshal string into Go value of type main.Users</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532350157, "post_id": 51478793, "comment_id": 89926774, "body": "@Babr Well Check Edited code according to your provided function code and see the result also the return type should match the returned result of the function"}, {"owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532350240, "post_id": 51478793, "comment_id": 89926831, "body": "Still the same issue: <code>func getUserRandking() []KVU {</code> with <code>return users1.Children</code> yeilds: <code>cannot unmarshal string into Go value of type main.Users</code>"}, {"owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "reply_to_user": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "edited": false, "score": 0, "creation_date": 1532350396, "post_id": 51478793, "comment_id": 89926954, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/176571/discussion-between-himanshu-and-babr\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 3, "last_activity_date": 1532358435, "last_edit_date": 1532358435, "creation_date": 1532348874, "answer_id": 51478793, "question_id": 51478658, "link": "https://stackoverflow.com/questions/51478658/json-cannot-unmarshal-string-into-go-value-of-type-main-kvu/51478793#51478793", "title": "json: cannot unmarshal string into Go value of type []main.KVU", "body": "<p>The error is because you have to create <code>Users</code> struct rather than <code>KUV</code> for unmarshalling the JSON. Since []KVU is a slice which will unmarshal the array of <code>children</code> which is an array of Objects. Also you need to parse the Json returned from the server to remove escape characters like <code>/</code>. Use <code>strconv.Unquote</code> to manage with escaped JSON.</p>\n\n<pre><code>func Unquote(s string) (string, error)\n</code></pre>\n\n<blockquote>\n  <p>Unquote interprets s as a single-quoted, double-quoted, or backquoted\n  Go string literal, returning the string value that s quotes. (If s is\n  single-quoted, it would be a Go character literal; Unquote returns the\n  corresponding one-character string.)</p>\n</blockquote>\n\n<p>Check below working Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\ntype KVU struct {\n    Key   string `json:\"name\"`\n    Value int    `json:\"value\"`\n    Url   string `json:\"url\"`\n}\n\ntype Users struct {\n    Name     string `json:\"name\"`\n    Children []KVU  `json:\"children\"`\n}\n\nfunc main() {\n    result := getUserRandking()\n    fmt.Println(result)\n}\n\nfunc getUserRandking() []KVU{\n    input := `\"{\\\"name\\\":\\\"userslist\\\",\\\"children\\\":[{\\\"name\\\":\\\"kachalmooferfer\\\",\\\"value\\\":444,\\\"url\\\":\\\"http://pbs.twimg.com/p\u200c\u200brofile_images/989898400609992704/UE8HiRVx_normal.jpg\\\"},{\\\"name\\\":\\\"patrick_jane7\u200c\u200b7\\\",\\\"value\\\":407,\\\"url\\\":\\\"http://pbs.twimg.com/profile_images/94467727094959308\u200c\u200b9/zv62U1ch_normal.jpg\\\"},{\\\"name\\\":\\\"Pensylvani\\\",\\\"value\\\":213,\\\"url\\\":\\\"http://\u200c\u200bpbs.twimg.com/profile_images/1018010357892198400/Rw06UWvY_normal.jpg\\\"}]}\"`\n    var val []byte = []byte(input)\n    jsonInput, err := strconv.Unquote(string(val))\n    if err !=nil{\n        fmt.Println(err)\n    }\n    var resp Users\n    json.Unmarshal([]byte(jsonInput), &amp;resp)\n    // Return below struct slice for Children from the function \n    return resp.Children\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/GEoTN2G9RnN\" rel=\"nofollow noreferrer\">Go Playground</a> Example</p>\n"}], "owner": {"reputation": 1327, "user_id": 7937129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef6f39a3eeb1a8f1d450374755da2370?s=128&d=identicon&r=PG&f=1", "display_name": "Babr", "link": "https://stackoverflow.com/users/7937129/babr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5033, "favorite_count": 1, "accepted_answer_id": 51478793, "answer_count": 1, "score": 2, "last_activity_date": 1532358435, "creation_date": 1532348445, "last_edit_date": 1532349560, "question_id": 51478658, "link": "https://stackoverflow.com/questions/51478658/json-cannot-unmarshal-string-into-go-value-of-type-main-kvu", "title": "json: cannot unmarshal string into Go value of type []main.KVU", "body": "<p>I'm new to golang and I'd like to get a json object into my code:</p>\n\n<pre><code>func getUserRandking() []KVU {    \n    url := \"http://127.0.0.1:8080/users\"\n\n    spaceClient := http.Client{         Timeout: time.Second * 10, \n    }\n\n    req, err := http.NewRequest(http.MethodGet, url, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req.Header.Set(\"User-Agent\", \"spacecount-tutorial\")\n\n    res, getErr := spaceClient.Do(req)\n    if getErr != nil {\n        log.Fatal(getErr)\n    }\n\n    body, readErr := ioutil.ReadAll(res.Body)\n    if readErr != nil {\n        log.Fatal(readErr)\n    }\n\n    var users1 []KVU\n    jsonErr := json.Unmarshal(body, &amp;users1)\n    if jsonErr != nil {\n        log.Fatal(jsonErr)\n    }\n\n    fmt.Println(users1)\n\n    return users1\n\n}\n</code></pre>\n\n<p>but I get this runtime error</p>\n\n<blockquote>\n  <p>json: cannot unmarshal string into Go value of type []main.KVU exit\n  status 1</p>\n</blockquote>\n\n<p>The json that I'm trying to import is like this:</p>\n\n<pre><code>{\n  \"name\": \"userslist\",\n  \"children\": [\n    {\n      \"name\": \"cat\",\n      \"value\": 1,\n      \"url\": \"http://example.com/1.jpg\"\n    },\n    {\n      \"name\": \"dog\",\n      \"value\": 2,\n      \"url\": \"http://example.com/2.jpg\"\n    }\n  ]\n}\n</code></pre>\n\n<p>I have tried different type definitions like <code>Users</code> below:</p>\n\n<pre><code>type KVU struct {\n    Key   string `json:\"name\"`\n    Value int    `json:\"value\"`\n    Url   string `json:\"url\"`\n}\n\ntype Users struct {\n    Name     string `json:\"name\"`\n    Children []KVU  `json:\"children\"`\n}\n</code></pre>\n\n<p>But that also leads to:</p>\n\n<blockquote>\n  <p>json: cannot unmarshal string into Go value of type []main.Users</p>\n</blockquote>\n\n<p>How can I fix this? </p>\n"}, {"tags": ["go", "test-coverage"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1532341453, "post_id": 51476225, "comment_id": 89921341, "body": "Do not run the compiled test binary but let <code>go test -cover</code> do the work."}, {"owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1532342005, "post_id": 51476225, "comment_id": 89921674, "body": "@Volker  my compile environment and test environment are in 2 different machines, test birnary is compiled on local machine, but  run in another remote server"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1532346618, "post_id": 51476225, "comment_id": 89924409, "body": "Why do you thin that the coverprofile is different from one machine to the other?"}, {"owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1532348178, "post_id": 51476225, "comment_id": 89925456, "body": "just cause test program even can not run in compile machine, there are so  many microservices relied on to run the test ,  which compile machine cannot provide"}], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "edited": false, "score": 0, "creation_date": 1532349284, "post_id": 51478346, "comment_id": 89926176, "body": "tried this before ,but not working\uff0c and an instereting result happened:  Issue SIGINT cannot  stop the program. I traced every executed line , after  MKrtEixt(0) -&gt;  mkrtExitWait.Done() -&gt; mkrtExitWait.Wait() -&gt; main.go return , but program still run ,  I guess it&#39;s related to  test birnary ,  if I go run main.go , SIGINT  is ok to stop the program"}, {"owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "edited": false, "score": 0, "creation_date": 1532349970, "post_id": 51478346, "comment_id": 89926649, "body": "os.Exit(0)  or  panic()  can stop the test program,   but  MKrtEixt(0)  cannot"}, {"owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "reply_to_user": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "edited": false, "score": 0, "creation_date": 1532350287, "post_id": 51478346, "comment_id": 89926866, "body": "I guess your <code>MKrtEixt</code> func has a bug then! I have been using this method, except that we have to stop http server inplace of calling os.Exit()"}, {"owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "edited": false, "score": 0, "creation_date": 1532395681, "post_id": 51478346, "comment_id": 89947235, "body": "I probably know the reason why main() return cannot stop the test program, when the test binary was built, there may have another main()  function added to execute the TestSystem() function\uff0c the TestSystem() then execute main() function I defined, which means the main() function we see is not the real main() fuction which run in master coroutine, so when it returns, master coroutine gets no effect , the whole program still run , only by execute os.Exit(0) , can we stop the program"}, {"owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "reply_to_user": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "edited": false, "score": 0, "creation_date": 1532421293, "post_id": 51478346, "comment_id": 89956450, "body": "In that case, do you think the answer given is correct one? I would suggest to edit answer/question to add your caveat. It might else somebody :-)"}], "tags": [], "owner": {"reputation": 1359, "user_id": 113316, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/4772c3b95b4065144bb7f26dd24eae37?s=128&d=identicon&r=PG", "display_name": "rajeshnair", "link": "https://stackoverflow.com/users/113316/rajeshnair"}, "is_accepted": false, "score": 0, "last_activity_date": 1532347341, "creation_date": 1532347341, "answer_id": 51478346, "question_id": 51476225, "link": "https://stackoverflow.com/questions/51476225/cannot-generate-go-coverage-file/51478346#51478346", "title": "Cannot generate go coverage file", "body": "<p>System testing is usually used when you are running some external tests on your testing </p>\n\n<p>This would mean you need to modify your main program to exit on certain intrrupts. SIGINT is most apt signal for your main program to exit as it confirms with POSIX signal compliance</p>\n\n<p>This can be done by adding following </p>\n\n<pre><code>        // Handle graceful shutdown of http server via OS Interrupt\n        quit := make(chan os.Signal)\n        signal.Notify(quit, os.Interrupt)\n\n        // Block a goroutine on Interrupt channel and close\n        // http server to exit gracefully\n        go func() {\n            &lt;-quit\n            log.Info(\"receive interrupt signal\")\n            MKrtEixt(0)\n        }() \n</code></pre>\n\n<p>So then your testing steps would be </p>\n\n<ol>\n<li>Bring up system-under-test </li>\n<li>Run external tests</li>\n<li>Issue SIGINT to system-under-test, once tests complete</li>\n<li>Collect the coverage files</li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "edited": false, "score": 0, "creation_date": 1549616524, "post_id": 51493155, "comment_id": 95974120, "body": "I am having the same issue. Can you please elaborate on your solution?"}, {"owner": {"reputation": 364, "user_id": 6173660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/abb2361f859a0ed3e7915135a5379426?s=128&d=identicon&r=PG&f=1", "display_name": "iam thadiyan", "link": "https://stackoverflow.com/users/6173660/iam-thadiyan"}, "edited": false, "score": 0, "creation_date": 1549616901, "post_id": 51493155, "comment_id": 95974320, "body": "I am having the same issue. I am calling main() from my _test.go file inside TestMain(). I have ensured that this is the only test i n my repo. But still no report. Can you please elaborate on your solution?"}, {"owner": {"reputation": 491, "user_id": 7655137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5203fc333c6443affb37aa2209267d71?s=128&d=identicon&r=PG&f=1", "display_name": "darkwing", "link": "https://stackoverflow.com/users/7655137/darkwing"}, "edited": false, "score": 0, "creation_date": 1560486543, "post_id": 51493155, "comment_id": 99759930, "body": "See my answer, I elaborated from this hint"}], "tags": [], "owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "is_accepted": false, "score": 2, "last_activity_date": 1532418298, "creation_date": 1532418298, "answer_id": 51493155, "question_id": 51476225, "link": "https://stackoverflow.com/questions/51476225/cannot-generate-go-coverage-file/51493155#51493155", "title": "Cannot generate go coverage file", "body": "<p>I figured out the reason why coverprofile cannot be genarated ..</p>\n\n<p>the main coroutine is started by test binary, it will wait util all test tasks finished, and finally genarate coveragefile.\nmain function test is one of tasks, so if main function execute os.Exit(0), coverage file will not be genarated. \nand In my test program,  when main function test task was over, there remains some other test tasks to execute, one of them was blocked by an I/O event without timeout, so it has nothing to do with the main function test task. </p>\n"}, {"tags": [], "owner": {"reputation": 491, "user_id": 7655137, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5203fc333c6443affb37aa2209267d71?s=128&d=identicon&r=PG&f=1", "display_name": "darkwing", "link": "https://stackoverflow.com/users/7655137/darkwing"}, "is_accepted": false, "score": 1, "last_activity_date": 1560490044, "last_edit_date": 1560490044, "creation_date": 1560486519, "answer_id": 56591384, "question_id": 51476225, "link": "https://stackoverflow.com/questions/51476225/cannot-generate-go-coverage-file/56591384#56591384", "title": "Cannot generate go coverage file", "body": "<p>The OP hinted at an answer but didn't really give one. The key is that in order for a coverage profile to be written the program needs to return execution to <code>TestMain</code> and cannot just call <code>os.Exit(0)</code></p>\n\n<p>So all that really needs to be done is a little handling code with a <code>return</code> from the main goroutine. Below is example code, it is run after compiling the test binary using:</p>\n\n<p><code>go test -c -covermode=count -cover -coverpkg ./...</code></p>\n\n<p>And then it is ran like this (the quotes were necessary in powershell on Windows but not cmd):</p>\n\n<p><code>testmain.test.exe \"-test.coverprofile\" coverage.cov systemTest</code></p>\n\n<p>I have found that for some reason the coverage file is only generated if my custom flag <code>systemTest</code> comes after the <code>-test.coverprofile coverage.cov</code> Here's a simple example:</p>\n\n<p>main.go:</p>\n\n<pre><code>func main() {\n    c := make(chan os.Signal, 1)\n    signal.Notify(c, os.Interrupt)\n    done := make(chan struct{})\n\n\n    go func() {\n        &lt;-c\n        done &lt;- struct{}{}\n    }()\n\n    go func() {\n        for {\n            // this is where your real program runs\n            fmt.Println(\"printing and sleeping\")\n            time.Sleep(1 * time.Second)\n        }\n    }()\n    &lt;-done\n    return\n}\n</code></pre>\n\n<p>main_test.go:</p>\n\n<pre><code>func TestMain(t *testing.T) {\n    run := false\n\n    for _, arg := range os.Args {\n        switch {\n        case arg == \"systemTest\":\n            run = true\n        }\n    }\n\n    if run {\n        main()\n        fmt.Println(\"returned from main\")\n    }\n}\n</code></pre>\n\n<p>Inspiration: <a href=\"https://www.cyphar.com/blog/post/20170412-golang-integration-coverage\" rel=\"nofollow noreferrer\">https://www.cyphar.com/blog/post/20170412-golang-integration-coverage</a>\nand <a href=\"https://www.elastic.co/blog/code-coverage-for-your-golang-system-tests\" rel=\"nofollow noreferrer\">https://www.elastic.co/blog/code-coverage-for-your-golang-system-tests</a></p>\n"}, {"tags": [], "owner": {"reputation": 1947, "user_id": 1156067, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/TUkXl.jpg?s=128&g=1", "display_name": "Elad Tabak", "link": "https://stackoverflow.com/users/1156067/elad-tabak"}, "is_accepted": false, "score": 1, "last_activity_date": 1572275030, "creation_date": 1572275030, "answer_id": 58593374, "question_id": 51476225, "link": "https://stackoverflow.com/questions/51476225/cannot-generate-go-coverage-file/58593374#58593374", "title": "Cannot generate go coverage file", "body": "<p>What solved it for me (and mentioned as part of @darkwing's answer) is the flags order.</p>\n\n<p>When I placed the <code>-test.coverprofile=coverage.cov</code> first, it worked, and the coverage.cov file was created.</p>\n\n<p>Note: I had to add the <code>=</code> sign between the flag name and value.</p>\n\n<p>Also I didn't need run it in a different go routine.</p>\n"}], "owner": {"reputation": 121, "user_id": 4952421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3D6P.jpg?s=128&g=1", "display_name": "bruce", "link": "https://stackoverflow.com/users/4952421/bruce"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1000, "favorite_count": 2, "answer_count": 4, "score": 4, "last_activity_date": 1572275030, "creation_date": 1532340336, "last_edit_date": 1532418405, "question_id": 51476225, "link": "https://stackoverflow.com/questions/51476225/cannot-generate-go-coverage-file", "title": "Cannot generate go coverage file", "body": "<p>I tried run a sytemTest in this article:\n<a href=\"https://www.elastic.co/blog/code-coverage-for-your-golang-system-tests\" rel=\"nofollow noreferrer\">https://www.elastic.co/blog/code-coverage-for-your-golang-system-tests</a></p>\n\n<p>so follow the tips\nfirst I create a system test file named main_test.go like this:</p>\n\n<pre><code>func TestSystem(t *testing.T) {\n    t.Logf(\"systemtest mod=%v\", *SystemTest)\n    if *SystemTest {\n        t.Log(\"runing system test....\")\n        main()\n    }\n}\n</code></pre>\n\n<p>when this unit test is executed, whole main function will be executed</p>\n\n<p>then I build a test birnary :</p>\n\n<pre><code>go test -c -covermode=count -coverpkg ./... -o main.test\n</code></pre>\n\n<p>and execute the test birnary file in my test environment</p>\n\n<pre><code>./main.test -systemTest  -test.coverprofile ./coverage.cov\n</code></pre>\n\n<p>because the program will listen and waiting for client's request, so it will not exit unless I exit manunal, which means the coverprofile won't be genarated</p>\n\n<p>so I start a timer to stop the program after 15 seconds...\nhowever when program exits , the coverprofile  still not genarated</p>\n\n<p>if test not call main, the coverprofile can be genarated normally</p>\n\n<p>See the main function </p>\n\n<pre><code>var mkrtExitWait sync.WaitGroup\nvar mkrtExitCode int\nvar mkrtRunning bool = false\n\nfunc MKrtRun() int {\n    mkrtExitWait.Add(1)\n    mkrtRunning = true\n    mkrtExitWait.Wait()\n    return mkrtExitCode\n}\nfunc MKrtExit(code int) {\n    if !mkrtRunning {\n        os.Exit(code)\n    } else {\n        mkrtRunning = false\n        mkrtExitCode = code\n        mkrtExitWait.Done()\n    }\n}\n\n\nfunc main() {\n    // listen and serve code \n    ......\n\n    if *SystemTest {  // a command flag \n        go func(){\n            time.Sleep(time.Second * 10)\n            MKrtExit(0)\n        }()\n    }\n    MKrtRun()\n}\n</code></pre>\n\n<p>I tried some ways to genrate coverage file as followed, but it's not working:</p>\n\n<ol>\n<li><p>send a client request to tell test server to execute os.Exit(0) when program is running</p></li>\n<li><p>send a client request to tell test server to execute panic() when program is running</p></li>\n<li><p>kill the process to force exit the program</p></li>\n</ol>\n\n<p>What's the problem?</p>\n\n<p>How can I generate coverage file?</p>\n"}, {"tags": ["http", "go", "server", "url-routing"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 2, "creation_date": 1532340268, "post_id": 51476107, "comment_id": 89920606, "body": "Inspect r.URL.Path in handler_over and act accordingly."}], "answers": [{"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 1, "last_activity_date": 1532345170, "creation_date": 1532345170, "answer_id": 51477680, "question_id": 51476107, "link": "https://stackoverflow.com/questions/51476107/setting-an-unknown-url-path-as-error-in-http-router/51477680#51477680", "title": "Setting an unknown URL path as error in HTTP router", "body": "<pre><code>func handler_over(w http.ResponseWriter, r *http.Request) {\n    // The \"/\" pattern matches everything, so we need to check\n    // that we're at the root here.\n    if r.URL.Path != \"/\" {\n        http.NotFound(w, req)\n        return\n    }\n    fmt.Fprintf(w, \"This is my server. Hello.\")\n}\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 10076329, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-EqZwubKY3zc/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7o1wH_fgsJoiN84cK5Cw8mgjbgn3g/mo/photo.jpg?sz=128", "display_name": "DavidB", "link": "https://stackoverflow.com/users/10076329/davidb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532352922, "creation_date": 1532339981, "last_edit_date": 1532352922, "question_id": 51476107, "link": "https://stackoverflow.com/questions/51476107/setting-an-unknown-url-path-as-error-in-http-router", "title": "Setting an unknown URL path as error in HTTP router", "body": "<p><strong>Problem:</strong><br></p>\n\n<p>I am having trouble finding the answer to a question, which there is a BIG possibility I do not know how to ask. <br></p>\n\n<p>I am having problem with Go Server. I do not have any big knowledge of go programming but I did make a server with it. This server will display a JSON file which will then be pulled my other HTML file which is now irrelevant. This works. My problem is the path to the server.<p>\n<strong>Code</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n    \"os\"\n    \"time\"\n)\n\ntype Event struct {\n    Start     time.Time `json:\"start\"`\n    End       time.Time `json:\"end\"`\n    Summary   string    `json:\"summary\"`\n    Organizer string    `json:\"organizer\"`\n    MeetURL   string    `json:\"meet_url\"`\n}\n\ntype EventSlice struct {\n    Events []Event `json:\"events\"`\n}\n\nfunc loadEvents(filename string) (EventSlice, error) {\n    // Open events file.\n    file, err := os.Open(filename)\n    if err != nil {\n        return EventSlice{}, err\n    }\n    var list EventSlice\n\n    // Parse events from json file to events slice.\n    err = json.NewDecoder(file).Decode(&amp;list)\n    if err != nil {\n        fmt.Println(\"Displays\", err)\n        return EventSlice{}, err\n    }\n    return list, nil\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    events, err := loadEvents(\"json.json\")\n    if err != nil {\n        fmt.Fprintln(w, err)\n    }\n\n    // Reduntant step in real life\n    err = json.NewEncoder(w).Encode(events)\n    if err != nil {\n        fmt.Fprintln(w, err)\n    }\n}\n\nfunc handler_over(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"This is my server. Hello.\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler_over)\n    http.HandleFunc(\"/events\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>And if I go run the server and then on this url change the path to example: <a href=\"http://0.0.0.0:8080/otherpath\" rel=\"nofollow noreferrer\">http://0.0.0.0:8080/otherpath</a>, it will still display function for handler_over. Which will display a string: <code>This is my server.Hello</code>. <p>\nWhat would I have to do, so when you change the URL to unknown path (which is not a path) that it will display an Error like 404 Page not found. In meaning, that only 2 paths will be recognisable on the server: \"/\" path and \"/events\" path.<p>\n<strong>Note</strong>\nThis question has already probably been asked before, but I do not know how to ask the question. Any help or redirections to the answers would be gladly appreciated.</p>\n"}, {"tags": ["docker", "go", "google-cloud-platform", "load-balancing", "google-kubernetes-engine"], "answers": [{"tags": [], "owner": {"reputation": 541, "user_id": 9980072, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4Kg562qIq4U/AAAAAAAAAAI/AAAAAAAAAAA/AB6qoq2Dr9sR386yOBYUUaV6MMsFgMqdZw/mo/photo.jpg?sz=128", "display_name": "Nur", "link": "https://stackoverflow.com/users/9980072/nur"}, "is_accepted": false, "score": 3, "last_activity_date": 1532649468, "creation_date": 1532649468, "answer_id": 51548998, "question_id": 51474928, "link": "https://stackoverflow.com/questions/51474928/gcp-load-balancer-502-server-error-failed-to-connect-to-backend/51548998#51548998", "title": "GCP Load Balancer: 502 Server Error, &quot;failed_to_connect_to_backend&quot;", "body": "<p>To troubleshoot 502 response from the Load Balancer due to  \"failed_to_connect_to_backend.\" I would check the followings:</p>\n\n<p>1) Usually, \"failed_to_connect_to_backend\" error message indicates that the load balancer is failing to connect to backends,  investigating URL map rules is also a good point to start. I would also suggest reviewing your Load Balancer's URL map to make sure that Host rules, Path matcher, and Path rules are correctly defined and comply with descriptions in <a href=\"https://cloud.google.com/load-balancing/docs/https/url-map\" rel=\"nofollow noreferrer\">this article</a>.</p>\n\n<p>2) Also check if the backend instances are exhausting their resources, If a backend server is overwhelmed, it will refuse incoming requests, potentially causing the load balancer to give up on it and return the specific 502 error you're experiencing. For Apache, you could use <a href=\"https://httpd.apache.org/docs/2.4/logs.html\" rel=\"nofollow noreferrer\">this link</a> and nginx <a href=\"http://nginx.org/en/docs/debugging_log.html\" rel=\"nofollow noreferrer\">this link</a>.  Also, check the output on how many established connections are present at any one time using 'netstat' and <a href=\"https://serverfault.com/questions/193600/how-to-get-a-linux-network-log#answer-805383\">watch command</a>.</p>\n\n<p>3) I would also recommend testing again with the HTTP(S) request directly to the instance, request the same URL that reporting 502. You might do this test in another VM instance in your VPC network. </p>\n"}, {"tags": [], "owner": {"reputation": 190, "user_id": 5972887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4ff91c7d72cdae0955c3a887f17b0bb?s=128&d=identicon&r=PG&f=1", "display_name": "Harris Tailor", "link": "https://stackoverflow.com/users/5972887/harris-tailor"}, "is_accepted": false, "score": 0, "last_activity_date": 1561596149, "creation_date": 1561596149, "answer_id": 56782557, "question_id": 51474928, "link": "https://stackoverflow.com/questions/51474928/gcp-load-balancer-502-server-error-failed-to-connect-to-backend/56782557#56782557", "title": "GCP Load Balancer: 502 Server Error, &quot;failed_to_connect_to_backend&quot;", "body": "<p>checking whether your backend block google's cloud cdn ip address or not.those addresses can be found here:<a href=\"https://cloud.google.com/compute/docs/faq#find_ip_range\" rel=\"nofollow noreferrer\">https://cloud.google.com/compute/docs/faq#find_ip_range</a></p>\n"}, {"tags": [], "owner": {"reputation": 3015, "user_id": 2296642, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/PRAw3.jpg?s=128&g=1", "display_name": "santiago arizti", "link": "https://stackoverflow.com/users/2296642/santiago-arizti"}, "is_accepted": false, "score": 0, "last_activity_date": 1589325345, "creation_date": 1589325345, "answer_id": 61763629, "question_id": 51474928, "link": "https://stackoverflow.com/questions/51474928/gcp-load-balancer-502-server-error-failed-to-connect-to-backend/61763629#61763629", "title": "GCP Load Balancer: 502 Server Error, &quot;failed_to_connect_to_backend&quot;", "body": "<p>this happened to me more than once, I was using apache in my servers, and the issue was not of CPU, but of configuration,</p>\n\n<p>I am using apache <code>mpm_event</code> in combination with <code>php-fpm</code> and there are many settings that will limit the max amount of requests that you want apache and fpm to allow.</p>\n\n<p>In my case I increased in Apache MPM config <code>MaxRequestWorkers</code> from the default 150 to 600, and in PHP FPM config <code>pm.max_children</code> to <code>80</code> (I don't remember what was the default here)</p>\n\n<p>This worked as expected, hope this helps you to extrapolate to your own stack.</p>\n"}], "owner": {"reputation": 101, "user_id": 7536698, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rjXtt.png?s=128&g=1", "display_name": "navelencia", "link": "https://stackoverflow.com/users/7536698/navelencia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3929, "favorite_count": 0, "answer_count": 3, "score": 8, "last_activity_date": 1589325345, "creation_date": 1532335997, "last_edit_date": 1561604902, "question_id": 51474928, "link": "https://stackoverflow.com/questions/51474928/gcp-load-balancer-502-server-error-failed-to-connect-to-backend", "title": "GCP Load Balancer: 502 Server Error, &quot;failed_to_connect_to_backend&quot;", "body": "<p>I have a dockerized Go application running on two GCP instances, everything works fine when using them with their individual external IPs, but when put through the load balancer, they're either slow to answer or it answers a <strong>502</strong> server error. The health checks seems to be ok, so I really don't understand.</p>\n\n<p>In the logs, the error thrown is</p>\n\n<blockquote>\n  <p>failed_to_connect_to_backend</p>\n</blockquote>\n\n<p>I've already seen other answers on this question, but none of them seems to provide an answer for my case. I cannot modify the way the application is served, so it doesn't seems to be a timeout thing.</p>\n"}, {"tags": ["go", "struct", "reflection"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1532334364, "post_id": 51474409, "comment_id": 89917195, "body": "You cannot call <code>uS.NumField</code> because <code>User</code> structure does not have a corresponding method."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1532334392, "post_id": 51474409, "comment_id": 89917209, "body": "You can&#39;t use <code>uS.NumField()</code> Because there is no <code>NumField</code> method defined on your custom <code>User</code> type--the same reason you can&#39;t call <code>uS.Foo()</code> or <code>uS.AnyOtherRandomMethod()</code>."}, {"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1532334551, "post_id": 51474409, "comment_id": 89917292, "body": "@zerkms @Flimzy then how <code>NumField()</code> actually works here? Does struct type is equal to <code>Value</code>?"}, {"owner": {"reputation": 1557, "user_id": 9312230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e9b3dcc612cd8349643900e1ca2b860?s=128&d=identicon&r=PG&f=1", "display_name": "ttomalak", "link": "https://stackoverflow.com/users/9312230/ttomalak"}, "edited": false, "score": 0, "creation_date": 1532334576, "post_id": 51474409, "comment_id": 89917306, "body": "And you can call <code>NumField()</code> after reflecting it because on <code>uSt</code> value your value is <code>Type</code> <a href=\"https://golang.org/pkg/reflect/#Type\" rel=\"nofollow noreferrer\">golang.org/pkg/reflect/#Type</a> returned by <code>reflect.TypeOf</code>"}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 2, "creation_date": 1532334747, "post_id": 51474409, "comment_id": 89917398, "body": "Reflection is really an advanced tool. If you don&#39;t feel comfortable with structs and methods - master them first. You would not need reflection unless you&#39;re doing something very wrong or very advanced: in the first case you&#39;d need to change the approach, in the second - you would know how to deal with it yourself."}], "answers": [{"tags": [], "owner": {"reputation": 457, "user_id": 609295, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/lPOCA.png?s=128&g=1", "display_name": "Dave Appleton", "link": "https://stackoverflow.com/users/609295/dave-appleton"}, "is_accepted": false, "score": 0, "last_activity_date": 1532335725, "creation_date": 1532335725, "answer_id": 51474846, "question_id": 51474409, "link": "https://stackoverflow.com/questions/51474409/why-go-reflect-numfield-is-only-available-on-the-type/51474846#51474846", "title": "Why Go reflect NumField() is only available on the type?", "body": "<p>NumField() is a function of reflected structs and can be applied on any struct once you have reflected it.</p>\n\n<p>It is NOT a function of User. You did not create any functions for User,\nso I did to try to clarify</p>\n\n<p><a href=\"https://play.golang.org/p/c8oGa_56YfE\" rel=\"nofollow noreferrer\">https://play.golang.org/p/c8oGa_56YfE</a></p>\n"}, {"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 3, "last_activity_date": 1532341466, "last_edit_date": 1532341466, "creation_date": 1532337751, "answer_id": 51475430, "question_id": 51474409, "link": "https://stackoverflow.com/questions/51474409/why-go-reflect-numfield-is-only-available-on-the-type/51475430#51475430", "title": "Why Go reflect NumField() is only available on the type?", "body": "<blockquote>\n  <p>TypeOf returns the <code>reflection Type</code> that represents the dynamic type of\n  i. If i is a nil interface value, TypeOf returns nil.</p>\n</blockquote>\n\n<p>From above statement it is clear that <code>TypeOf</code> returns <code>reflection Type</code></p>\n\n<pre><code>func TypeOf(i interface{}) Type // return reflection type\n</code></pre>\n\n<p>Reflection type is defined in Golang as</p>\n\n<blockquote>\n  <p>Type is the representation of a Go type. Type values are comparable,\n  such as with the == operator, so they can be used as map keys.</p>\n</blockquote>\n\n<p>Value is the reflection interface to a Go value which you are using for Numfield method as receiver. As @Flimzy described that for any other reflection method also you need to use reflection value.</p>\n\n<p>In your code:</p>\n\n<pre><code>uS := User{}\nuSt := reflect.TypeOf(uS)\n</code></pre>\n\n<p>First value <code>us</code> is assigned with User type struct. While second value <code>uSt</code> is assigned as <code>reflection Type</code> from the returned value of <code>reflect.TypeOf</code>. Check the type of each variable:</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"fmt\"\n)\n\ntype User struct {}\n\nfunc main() {   \n    uS := User{}\n    uSt := reflect.TypeOf(uS)\n    fmt.Printf(\"%T\\n\", uS) // Print the type of uS\n    fmt.Printf(\"%T\\n\", uSt)\n}\n</code></pre>\n\n<p><strong>Ouput</strong></p>\n\n<pre><code>main.User\n*reflect.rtype\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Ch7h7-04mS0\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n\n<p>For more information on how reflection works. Go through <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">Laws of Reflection</a></p>\n"}], "owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 839, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1532341466, "creation_date": 1532334068, "last_edit_date": 1532338719, "question_id": 51474409, "link": "https://stackoverflow.com/questions/51474409/why-go-reflect-numfield-is-only-available-on-the-type", "title": "Why Go reflect NumField() is only available on the type?", "body": "<p>I have the following Go code (<a href=\"https://play.golang.org/p/mOyRM-QDvT7\" rel=\"nofollow noreferrer\">play.golang.org</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"reflect\"\n    \"fmt\"\n)\n\ntype User struct {\n    name string\n    email string\n}\n\nfunc main() {   \n    uS := User{}\n    uSt := reflect.TypeOf(uS)   \n\n    fmt.Println( uSt )\n    fmt.Println( uSt.NumField() )\n    // fmt.Println( uS.NumField() ) // this doesn't work, why?\n\n}\n</code></pre>\n\n<p>I'm just curious here. Why we need to get the type of the struct first before calling <code>NumField()</code>?</p>\n\n<p>Why can't we just call it on the struct itself i.e. <code>uS.NumField()</code>?</p>\n\n<p>From <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\">docs</a>:</p>\n\n<pre><code>type Value struct {\n        // contains filtered or unexported fields\n}\n\nfunc (v Value) NumField() int\n</code></pre>\n\n<p>I'm not quite getting what is <code>Value</code> really means here. I do really appreciate concise explanation and examples.</p>\n"}, {"tags": ["docker", "go", "kubernetes", "websocket"], "owner": {"reputation": 21, "user_id": 6521016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/169c9dbb86ce1b951d5296989c3fc757?s=128&d=identicon&r=PG&f=1", "display_name": "Mosesyou", "link": "https://stackoverflow.com/users/6521016/mosesyou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 385, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1609697978, "creation_date": 1532326568, "last_edit_date": 1609697978, "question_id": 51472574, "link": "https://stackoverflow.com/questions/51472574/kubernetes-attach-pod-use-websocket", "title": "kubernetes attach pod use websocket", "body": "<p>I want make a web terminal by kubernetes client-go api, and now  i meet some problem.</p>\n\n<p>main\uff1a</p>\n\n<pre><code>func main() {\nflag.Parse()\nlog.SetFlags(0)\nhttp.HandleFunc(\"/ws\", echo)\nlog.Fatal(http.ListenAndServe(*addr, nil))\n}\n</code></pre>\n\n<p>struct&amp;handleFunc:</p>\n\n<pre><code>type Cmd struct {\n Conn   *websocket.Conn\n Stdin  io.Reader\n Stdout io.Writer\n Stderr io.Writer\n}\n\n\n\nfunc echo(w http.ResponseWriter, r *http.Request) {\n  cmd := Cmd{}\n  cmd.Stderr = ioutil.Discard\n\n  c, err := upgrader.Upgrade(w, r, nil)\n  if err != nil {\n    log.Print(\"upgrade:\", err)\n    return\n  }\n  cmd.Conn = c\n\n  cmd.handleClient()\n\n  }\nfunc (c *Cmd) handleClient() {\n//c.Stdout = os.Stdout\n//c.Stdin = os.Stdin\nvar read io.Reader\nvar write io.Writer\nc.Stdin = read\nc.Stdout = write\n\ngo func(rd io.Reader) {\n    for {\n        _, r, err := c.Conn.NextReader()\n        if err != nil {\n            fmt.Println(\"ReadErr:\", err)\n            c.Conn.Close()\n            return\n        }\n        rd = r\n\n    }\n}(read)\n\ngo func(wr io.Writer) {\n\n    w, err := c.Conn.NextWriter(1)\n    if err != nil {\n        fmt.Println(\"WriteErr:\", err)\n        c.Conn.Close()\n        return\n    }\n    wr = w\n\n}(write)\nerr := api.ExecOperator{}.ExecConsoleInContainer(\"1\", \"nginx-65899c769f-mkswf\", c.Stdin, c.Stdout, c.Stderr)\nif err != nil {\n    fmt.Println(\"ExecErr:\", err)\n    return\n  }\n}\n</code></pre>\n\n<p>api.ExecOperator{}.ExecConsoleInContainer() is a func invoke kubernetes exec api like <a href=\"https://github.com/kubernetes/kubernetes/blob/master/test/e2e/framework/exec_util.go\" rel=\"nofollow noreferrer\">kubernetes exec_util.go</a></p>\n\n<p>When i use the code  below\uff0ci can operate at the console\uff0cbut i dont know how to use websocket(gorilla/websocket) input and output to replace os.stdin and os.stdout,i tried to write some of the code above ,but it cant work.</p>\n\n<pre><code>c.Stdout = os.Stdout\nc.Stdin = os.Stdin\n</code></pre>\n"}, {"tags": ["jquery", "ajax", "reactjs", "go"], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "edited": false, "score": 0, "creation_date": 1532327738, "post_id": 51472786, "comment_id": 89913739, "body": "I got this error. Failed to load <a href=\"http://127.0.0.1:5000/login\" rel=\"nofollow noreferrer\">127.0.0.1:5000/login</a>: The value of the &#39;Access-Control-Allow-Origin&#39; header in the response must not be the wildcard &#39;*&#39; when the request&#39;s credentials mode is &#39;include&#39;. Origin &#39;<a href=\"http://127.0.0.1:8080\" rel=\"nofollow noreferrer\">127.0.0.1:8080</a>&#39; is therefore not allowed access. The credentials mode of requests initiated by the XMLHttpRequest is controlled by the withCredentials attribute."}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "edited": false, "score": 0, "creation_date": 1532327963, "post_id": 51472786, "comment_id": 89913843, "body": "@MuhammadShaaban does you server sent <code>CORS</code> headers? Looks like not."}, {"owner": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "edited": false, "score": 0, "creation_date": 1532328156, "post_id": 51472786, "comment_id": 89913959, "body": "I am using this line of echo golang in my api. e.Use(middleware.CORS())"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "reply_to_user": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "edited": false, "score": 0, "creation_date": 1532328221, "post_id": 51472786, "comment_id": 89913991, "body": "It&#39;s unclear what is this line doing, does it set valid headers?"}, {"owner": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "edited": false, "score": 0, "creation_date": 1532328537, "post_id": 51472786, "comment_id": 89914144, "body": "I think you solved main issue. I can resolve other. Thanks very much. I let you know soon"}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 1, "last_activity_date": 1532327878, "last_edit_date": 1532327878, "creation_date": 1532327504, "answer_id": 51472786, "question_id": 51472356, "link": "https://stackoverflow.com/questions/51472356/jquery-ajax-not-creating-golang-session-cockie/51472786#51472786", "title": "jquery ajax not creating golang session cockie", "body": "<p>You're missing ajax headers <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS?redirectlocale=en-US&amp;redirectslug=HTTP_access_control#Requests_with_credentials\" rel=\"nofollow noreferrer\">withCredentials</a></p>\n\n<p>For cross-domain scenario, 3 things need to happen:</p>\n\n<ul>\n<li>Client needs to set <code>withCredentials=true</code> for the xhr object </li>\n<li>Set <code>Access-Control-Allow-Credentials</code> both in the OPTIONS preflight request as well as the actual request </li>\n<li>Set the cookie as needed </li>\n</ul>\n\n<blockquote>\n  <p>The most interesting capability exposed by both XMLHttpRequest or\n  Fetch and CORS is the ability to make \"credentialed\" requests that are\n  aware of HTTP cookies and HTTP Authentication information. <strong>By default,\n  in cross-site XMLHttpRequest or Fetch invocations, browsers will not\n  send credentials.</strong></p>\n</blockquote>\n\n<pre><code>$.ajax({\n    type: \"POST\",\n    url:\"http://127.0.0.1:5000/login\", \n    data:credentials,\n    xhrFields: {\n      withCredentials: true\n   }\n})\n.done(function(data){\n    console.log(data);\n});\n</code></pre>\n"}], "owner": {"reputation": 39, "user_id": 9092613, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CHPPEho4SFA/AAAAAAAAAAI/AAAAAAAAARQ/X5vYVF4d3rk/photo.jpg?sz=128", "display_name": "Muhammad Shaaban", "link": "https://stackoverflow.com/users/9092613/muhammad-shaaban"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 149, "favorite_count": 0, "accepted_answer_id": 51472786, "answer_count": 1, "score": 0, "last_activity_date": 1532327878, "creation_date": 1532325520, "last_edit_date": 1532326106, "question_id": 51472356, "link": "https://stackoverflow.com/questions/51472356/jquery-ajax-not-creating-golang-session-cockie", "title": "jquery ajax not creating golang session cockie", "body": "<p>I am creating an creating login part for with preact, jquery and golang. I am using chrome for testing. The login API works fine with testing by postman written in golang. Here is code for this part</p>\n\n<pre><code>e.Use(session.Middleware(sessions.NewCookieStore([]byte(\"secret\"))))\n//e.Use(xrayWrapper(\"bonusapi\"))\n\ne.POST(\"/login\", func(c echo.Context) error {\n    sess, _ := session.Get(\"session\", c)\n    sess.Options = &amp;sessions.Options{\n        Path:     \"/\",\n        MaxAge:   86400 * 7,\n        HttpOnly: true,\n    }\n\n    if(sess.Values[\"auth\"] == true){\n        return c.String(http.StatusOK, \"Already Login\")\n    }else {\n        fmt.Println(sess.Values[\"auth\"])\n    }\n\n    if(c.FormValue(\"password\") == \"admin\" &amp;&amp; c.FormValue(\"username\") == \"admin\"){\n        sess.Values[\"auth\"] = true\n        sess.Save(c.Request(), c.Response())\n        fmt.Println(sess.Values[\"auth\"])\n        return c.String(http.StatusOK, \"Login session start\")\n    }else {\n        return c.String(http.StatusOK, \"Forbidden Access\")\n    }\n\n    //return c.String(http.StatusOK, )\n})\n</code></pre>\n\n<p>But it does not work when I use ajax request with jquery. I mean session cookies does do not work in ajax request. I am not sure what is the problem with it. Anyone can help, please. Here is my ajax request code which has a problem I think</p>\n\n<pre><code>var username = props[\"path\"][6].getElementById(\"username\").value.trim();\n    var password = props[\"path\"][6].getElementById(\"password\").value.trim();\n    var credentials = {\n        username: username,\n        password: password\n    }\n\n    var _this = this\n    $.ajax({\n        type: \"POST\",\n        url:\"http://127.0.0.1:5000/login\", \n        data:credentials\n    })\n    .done(function(data){\n        console.log(data);\n    });\n</code></pre>\n"}, {"tags": ["go", "tcp"], "answers": [{"comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 2, "creation_date": 1532324487, "post_id": 51472080, "comment_id": 89912452, "body": "... and therefore sleeps in blocking mode networking code are just literally a waste of time."}, {"owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "reply_to_user": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1532452070, "post_id": 51472080, "comment_id": 89976943, "body": "@EJP The sleep is my test code is just a way to ensure that data has been received. I understand that I would use channels and select in real code."}, {"owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "edited": false, "score": 0, "creation_date": 1532453201, "post_id": 51472080, "comment_id": 89977638, "body": "@Steffen-Ullrich In general what you&#39;re describing is true, however, I&#39;m dealing with an application-specific use case. In theory packet sizes are unreliable, but in practice a small hello packet of a few bytes will not be made smaller by any routers in the path and the application will not send more data until it receives the handshake response. The reason I need this functionality is for magic byte detection when multiplexing multiple protocols over a single port."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "reply_to_user": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "edited": false, "score": 0, "creation_date": 1532453302, "post_id": 51472080, "comment_id": 89977699, "body": "@CoolAJ86: in this case the question is answered by the part which explains that <code>bufConn.Buffered()</code> returns only how many data are <i>buffered</i> which is not the same as how many data are <i>able to read</i>. And if you need it for magic byte detection - why don&#39;t you just read the magic byte instead of checking how many data are possible to read?"}, {"owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "edited": false, "score": 0, "creation_date": 1532453988, "post_id": 51472080, "comment_id": 89978113, "body": "@SteffenUllrich Mostly because I&#39;m used to writing code in Node.js and, except when for very particular circumstances when pausing the network stream, there&#39;s a data event for each tcp packet. Aside from that, different protocols have different handshake styles and different &quot;magic bytes&quot; (SSH, TLS-SNI, HTTP, PROXY, proprietary protocols, etc) . In some cases the client sends the first packet, in other cases the server does (in which case only 1 such protocol could be supported). In some cases the magic bytes are the first 3 bytes, in other cases they require reading a length."}, {"owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "edited": false, "score": 0, "creation_date": 1532453999, "post_id": 51472080, "comment_id": 89978122, "body": "@SteffenUllrich In almost all cases all of the necessary information is within the first tcp packet, but the size of the packet is unknown."}, {"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1532454254, "post_id": 51472080, "comment_id": 89978256, "body": "<i>&quot;... there&#39;s a data event for each tcp packet.&quot;</i> - it&#39;s not. There is instead an event if data are available for read. These data might have actually come in multiple packets, especially if the packets arrived fast or if the previous processing was slow and multiple packets arrived while the previous input was still processed."}], "tags": [], "owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "is_accepted": false, "score": 4, "last_activity_date": 1532453192, "last_edit_date": 1532453192, "creation_date": 1532323867, "answer_id": 51472080, "question_id": 51472020, "link": "https://stackoverflow.com/questions/51472020/how-to-get-the-size-of-available-tcp-data/51472080#51472080", "title": "How to get the size of available TCP data?", "body": "<blockquote>\n  <p>I have a use case where I need to Peek at exactly the first TCP packet, whatever length it may be.</p>\n</blockquote>\n\n<p>TCP is a streaming protocol and not a datagram protocol like UDP.  This means packets are irrelevant from the perspective of TCP. They only exist temporarily on the wire. </p>\n\n<p>Any data the application sends will be put into the continuous send buffer and then packetized by the operating system for transport. This means multiple writes by the application can result in a single packet, a single write into multiple packets etc. If data are lost during transport (i.e. no ACK) the senders OS can even do a retransmit with differently sized packets. </p>\n\n<p>Similar packets received on the wire will be reassembled inside the OS kernel and will be put into the continuous read buffer. All packet boundaries which might have existed on the wire will be lost when doing this. Therefore no way exist for the application to find out where the packet boundary was. </p>\n\n<blockquote>\n<pre><code>    n = bufConn.Buffered()\n</code></pre>\n</blockquote>\n\n<p><code>bufConn</code> is not the OS socket buffer. <code>bufConn.Buffered()</code> will only see the data which are read from the underlying socket into the Go process but which are not yet retrieved by the application logic using <code>bufConn.Read()</code>: if you try to read a single byte with <code>bufConn.Read()</code> it will actually try to read more bytes from the underlying socket, return the single byte you've requested and keep the rest in the <code>bufConn</code> buffer for later reads. This is done to provide a more efficient interface for the application logic. If you don't want this don't use buffered I/O.</p>\n"}, {"comments": [{"owner": {"reputation": 89578, "user_id": 3081018, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Z2NYm.png?s=128&g=1", "display_name": "Steffen Ullrich", "link": "https://stackoverflow.com/users/3081018/steffen-ullrich"}, "edited": false, "score": 0, "creation_date": 1532454780, "post_id": 51504516, "comment_id": 89978510, "body": "After the <code>Peek</code> there might still be data in the operating systems socket buffer. <code>Peek</code> will not read more data than fit into the buffer of the <code>bufConn</code> object. This might not be relevant in your specific use case with small data though."}], "tags": [], "owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "is_accepted": true, "score": 0, "last_activity_date": 1532844072, "last_edit_date": 1532844072, "creation_date": 1532453532, "answer_id": 51504516, "question_id": 51472020, "link": "https://stackoverflow.com/questions/51472020/how-to-get-the-size-of-available-tcp-data/51504516#51504516", "title": "How to get the size of available TCP data?", "body": "<h1>Update: Can't be done with net.Conn</h1>\n\n<p>Actually, it is <em>not</em> possible to \"Peek\" at a <code>net.Conn</code> without reading. However <code>net.Conn</code> can be wrapped and that wrapper can be passed around anywhere <code>net.Conn</code> is accepted.</p>\n\n<p>See</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/26196813/peek-into-conn-without-reading-in-go\">Peek into Conn without reading in go</a></li>\n<li><a href=\"https://github.com/stevenjohnstone/sni/blob/master/sni.go\" rel=\"nofollow noreferrer\">https://github.com/stevenjohnstone/sni/blob/master/sni.go</a></li>\n</ul>\n\n<h1>Workable Half-Solution</h1>\n\n<p>The ideal solution would be to be able to Peek immediately on the first try. While searching around I did find some custom go TCP libraries... but I'm not feeling adventurous enough to try that yet.</p>\n\n<p>Building off of what @SteffenUllrich said, it turns out that <code>buffConn.Peek(1)</code> will cause the buffer to be filled with the available data. After that <code>buffConn.Buffered()</code> returns the expected number of bytes and it's possible to proceed with <code>buffConn.Peek(n)</code>:</p>\n\n<pre><code>// Cause the bufConn with the available data\nfirstByte, err = bufConn.Peek(1)\nif nil != err {\n    panic(err)\n}\n\n// Check the size now\nn = bufConn.Buffered()\nfmt.Fprintf(os.Stdout, \"Size of Buffered Data %d\\n\", n)\n\n// Peek the full amount of available data\nfirstPacket, err = bufConn.Peek(n)\nif nil != err {\n    panic(err)\n}\n</code></pre>\n\n<p>I thought I had tried this earlier and saw the buffer only filled with 1 byte, but reading the answer above caused me to create a specific test case to be sure, and it worked.</p>\n\n<h1>The Downside</h1>\n\n<p>This still requires a <code>Read()</code>/<code>Peek()</code> <em>before</em> knowing the size of the data.</p>\n\n<p>This means that for my particular case where a single protocol is supported which requires the server to send the first hello packet, I have to store state about the connection somewhere else such that if enough time has passed (say 250ms) without any data being received I know to now skip detection of the first packet Peek when it comes in.</p>\n"}], "owner": {"reputation": 63890, "user_id": 151312, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/0a8b345ddcfc5401f578c850442f1e1b?s=128&d=identicon&r=PG", "display_name": "coolaj86", "link": "https://stackoverflow.com/users/151312/coolaj86"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 2, "accepted_answer_id": 51504516, "answer_count": 2, "score": 0, "last_activity_date": 1532844072, "creation_date": 1532323486, "last_edit_date": 1532454736, "question_id": 51472020, "link": "https://stackoverflow.com/questions/51472020/how-to-get-the-size-of-available-tcp-data", "title": "How to get the size of available TCP data?", "body": "<h1>Problem</h1>\n\n<p>I have a use case where I need to <code>Peek</code> at exactly the first TCP packet, whatever length it may be.</p>\n\n<h1>Snippet</h1>\n\n<p>I would have expected this to work:</p>\n\n<pre><code>conn, err := sock.Accept()\nif nil != err {\n    panic(err)\n}\n\n// plenty of time for the first packet to arrive\ntime.Sleep(2500 * 1000000)\n\nbufConn := bufio.NewReader(conn)\nn := bufConn.Buffered()\nfmt.Fprintf(os.Stdout, \"Size of Buffered Data %d\\n\", n)\n</code></pre>\n\n<p>However, even though I am positive that the data has arrived it still shows that 0 bytes are buffered.</p>\n\n<h1>Full Test Application</h1>\n\n<p>Here's a full test program:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\nfunc main () {\n    addr := \":\" + strconv.Itoa(4080)\n    sock, err := net.Listen(\"tcp\", addr)\n    if nil != err {\n        panic(err)\n    }\n    conn, err := sock.Accept()\n    if nil != err {\n        panic(err)\n    }\n\n    bufConn := bufio.NewReader(conn)\n    var n int\n    for {\n        n = bufConn.Buffered()\n        fmt.Fprintf(os.Stdout, \"Size of Buffered Data %d\\n\", n)\n        if 0 != n {\n            break\n        }\n        time.Sleep(2500 * 1000000)\n    }\n    first, err := bufConn.Peek(n)\n    if nil != err {\n        panic(err)\n    }\n    fmt.Fprintf(os.Stdout, \"[Message] %s\\n\", first)\n}\n</code></pre>\n\n<h1>Testing</h1>\n\n<p>And how I've been testing:</p>\n\n<pre><code>telnet localhost 4080\n\nHello, World!\n</code></pre>\n\n<p>This works equally well:</p>\n\n<pre><code>echo \"Hello, World!\" | nc localhost -p 4080\n</code></pre>\n\n<p>However, if I call <code>Peek(14)</code> directly the data is obviously there.</p>\n\n<h1>Why?</h1>\n\n<p>I'm dealing with an application-specific use case - magic byte detection when multiplexing multiple protocols over a single port.</p>\n\n<p>In theory packet sizes are unreliable, but in practice a small hello packet of a few bytes will not be made smaller by any routers in the path and the application will not send more data until it receives the handshake response.</p>\n\n<h2>The Kicker</h2>\n\n<p>I'm supporting exactly one protocol that requires the server to send its hello packet first, which means that if after a wait of 250ms no packet has been received, the server will assume that this special protocol is being used and send its hello.</p>\n\n<p>Hence, it will be best if I can know if data exists in the underlying buffer without doing any <code>Read()</code> or <code>Peek()</code> beforehand.</p>\n"}, {"tags": ["go", "schema", "migrate", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1532331489, "post_id": 51471973, "comment_id": 89915656, "body": "The error is pretty self-explanatory: You can&#39;t use a slice as a type with sqlite3. What additional question do you have?"}, {"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1532343652, "post_id": 51471973, "comment_id": 89922661, "body": "You are correct. I had indeed removed that from the structure as well as the NewUser() function. Did not realize it made it back in. But the error remains the same - blank table name."}], "answers": [{"comments": [{"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1532343393, "post_id": 51472717, "comment_id": 89922507, "body": "OMG! your right, I did not realize that made it back into the code I placed here. I had removed that. However, it is out now again - I still get the exact same error. Table Name is blank."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "reply_to_user": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1532370245, "post_id": 51472717, "comment_id": 89939096, "body": "You shouldn&#39;t change the question asked if the answer leads to another issue. The answer should be marked and a new question opened."}, {"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 1, "creation_date": 1532372714, "post_id": 51472717, "comment_id": 89940318, "body": "Understood, but the question was not answered. As I stated, the exact same error exists, No table name. Looks like it was throwing that error before it parsed the fields and found the bad slice."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "reply_to_user": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1532374265, "post_id": 51472717, "comment_id": 89941017, "body": "Try not passing in an <code>interface{}</code> reference. Call the <code>AuthoMigrate</code> directly.  <code>db.AutoMigrate(&amp;UserAuth{})</code> or change your function to <code>func (d *Database) MigrateUserAuth(m UserAuth) {...</code>"}, {"owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1532377247, "post_id": 51472717, "comment_id": 89942407, "body": "Thanks for your time to answer Chris - that was the first thing I did, still blank table name. The m interface{} is coming through as models.UserAuth.  <i>update</i>  This is the answer. It does not like the interface. Using the &amp;models.UserAuth{} directly and removing the slice ... does indeed work. Solved."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "reply_to_user": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 1, "creation_date": 1532378400, "post_id": 51472717, "comment_id": 89942819, "body": "Good to hear. In <code>db := d.db.AutoMigrate(&amp;m)</code> you are passing in the address of the interface, which doesn&#39;t doesn&#39;t allow for the existing reflect code to obtain the name of the type."}, {"owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "reply_to_user": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "edited": false, "score": 0, "creation_date": 1532387145, "post_id": 51472717, "comment_id": 89945509, "body": "If this helped you out can you mark it as the answer to make it clear for others? Thanks"}], "tags": [], "owner": {"reputation": 4176, "user_id": 26849, "user_type": "registered", "accept_rate": 71, "profile_image": "https://lh3.googleusercontent.com/-tO7nkYt2C3Q/AAAAAAAAAAI/AAAAAAAAAr4/UstVddaB4E4/photo.jpg?sz=128", "display_name": "chris", "link": "https://stackoverflow.com/users/26849/chris"}, "is_accepted": true, "score": 3, "last_activity_date": 1532379368, "last_edit_date": 1532379368, "creation_date": 1532327255, "answer_id": 51472717, "question_id": 51471973, "link": "https://stackoverflow.com/questions/51471973/gorm-automigrate-and-createtable-not-working/51472717#51472717", "title": "Gorm AutoMigrate() and CreateTable() not working", "body": "<p>I am pretty sure that sqlite does not have a type for your AuthIPs ([]string). I am not sure if GORM allows for you to write custom Valuer and Scanner interface methods that would allow you to convert a string to an array and back again or not, but it's something you might want to check out.</p>\n\n<p>Update:\nChange <code>db := d.db.AutoMigrate(&amp;m)</code> to <code>db := d.db.AutoMigrate(m)</code> to allow for the reflection to get the type name.</p>\n\n<p>If you implement the <code>tabler</code> interface you can also better control the name of the table.</p>\n\n<p><a href=\"https://github.com/jinzhu/gorm/blob/master/scope.go#L305\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/master/scope.go#L305</a></p>\n\n<pre><code>type tabler interface {\n    TableName() string\n}\n</code></pre>\n"}], "owner": {"reputation": 308, "user_id": 1998155, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/naOHo.jpg?s=128&g=1", "display_name": "NlaakALD", "link": "https://stackoverflow.com/users/1998155/nlaakald"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9698, "favorite_count": 0, "accepted_answer_id": 51472717, "answer_count": 1, "score": 2, "last_activity_date": 1539070403, "creation_date": 1532323204, "last_edit_date": 1539070403, "question_id": 51471973, "link": "https://stackoverflow.com/questions/51471973/gorm-automigrate-and-createtable-not-working", "title": "Gorm AutoMigrate() and CreateTable() not working", "body": "<p>I have run through the related issues here and all over on google.</p>\n\n<p>I am using Gorm with SQLite3.</p>\n\n<p>Whenever I try to run either function on my struct, I get an error. When I debug and step through I see table name is \"\". Gorm is not getting my structs name which is models.UserAuth. If I call DropTable(models.UserAuth{}) to shows there is no table named user_auth (but at least it figured out the table name). When I browse the DB, of course there, are no tables.</p>\n\n<p>my struct is</p>\n\n<pre><code>type UserAuth struct {\n    gorm.Model\n    ProfileID int      `gorm:\"not null\" json:\"profile_id\"`\n    Username  string   `gorm:\"size:20;unique_index\" json:\"username\"`\n    Email     string   `gorm:\"type:varchar(100);unique_index\" json:\"email\"`\n    Password  string   `gorm:\"not null\" json:\"password\"`\n    Remember  bool     `gorm:\"not null\" json:\"remeber\"`\n    TwoFA     bool     `gorm:\"not null\" json:\"twofa\"`\n    Access    int      `gorm:\"not null\" json:\"access\"`\n    State     int      `gorm:\"not null\" json:\"state\"`\n    LastSeen  string   `gorm:\"not null\" json:\"lastseen\"``\n}\n</code></pre>\n\n<p>My COMMON migrate function is:</p>\n\n<pre><code>func (d *Database) Migrate(m interface{}) {\n    logEntry := fmt.Sprintf(\"Auto Migrating %s...\", reflect.TypeOf(m))\n\n    //d.db.DropTable(&amp;models.UserAuth{})\n    //d.db.CreateTable(&amp;models.UserAuth{})\n\n    // Do it the hard way\n    //if d.db.HasTable(&amp;m) == false {\n    // Create table for model `User`\n    //  d.db.CreateTable(&amp;m)\n    //  d.logThis.Info(fmt.Sprintf(\"%s %s with error %s\", logEntry, \"Failed\", d.db.Error))\n    //}\n\n    // Migrate the schema\n    db := d.db.AutoMigrate(&amp;m) //&lt;--- Line 84\n    if db != nil &amp;&amp; db.Error != nil {\n        //We have an error\n        d.logThis.Fatal(fmt.Sprintf(\"%s %s with error %s\", logEntry, \"Failed\", db.Error))\n    }\n    d.logThis.Info(fmt.Sprintf(\"%s %s\", logEntry, \"Success\"))\n}\n</code></pre>\n\n<p>And finally here is how it is being called:</p>\n\n<pre><code>app.Db.Migrate(models.UserAuth{})\n</code></pre>\n\n<p>Actual output with debug on:</p>\n\n<pre><code>({PathToProject}/database/database.go:84) \n[2018-07-23 06:12:24]  near \")\": syntax error \n\n({PathToProject}/database/database.go:84) \n[2018-07-23 06:12:24]  [0.99ms]  CREATE TABLE \"\" ( )  \n[0 rows affected or returned ] \n</code></pre>\n\n<p>FYI, the downvote was uncalled for - It is a legitimate issue as I have taken the gorm example on the document summary page and basically just changed the struct. And the struct is using the correct basic types (except for the slice that made it back into the code on the original post) and the error is not very helpful. I see there is a SYNTAX error before the blank table name error - but why? Did I give GORM a valid struct?</p>\n"}, {"tags": ["go", "jwt"], "answers": [{"tags": [], "owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "is_accepted": true, "score": 7, "last_activity_date": 1532324702, "creation_date": 1532324702, "answer_id": 51472209, "question_id": 51471802, "link": "https://stackoverflow.com/questions/51471802/how-to-generate-jwt-token-always-through-invalid-key-type-error/51472209#51472209", "title": "How to generate JWT token always through invalid key type error", "body": "<p>From the <a href=\"https://github.com/dgrijalva/jwt-go#signing-methods-and-key-types\" rel=\"noreferrer\">README</a>:</p>\n\n<blockquote>\n  <p>The ECDSA signing method (ES256,ES384,ES512) expect *ecdsa.PrivateKey for signing and *ecdsa.PublicKey for validation</p>\n</blockquote>\n\n<p>So use an elliptic curve key:</p>\n\n<pre><code>package main\n\nimport (\n        \"crypto/ecdsa\"\n        \"crypto/elliptic\"\n        \"crypto/rand\"\n        \"log\"\n\n        jwt \"github.com/dgrijalva/jwt-go\"\n)\n\nfunc main() {\n        key, err := ecdsa.GenerateKey(elliptic.P256(), rand.Reader)\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        claims := &amp;jwt.StandardClaims{\n                ExpiresAt: 15000,\n                Issuer:    \"test\",\n        }\n\n        token := jwt.NewWithClaims(jwt.SigningMethodES256, claims)\n\n        tokenString, err := token.SignedString(key)\n        if err != nil {\n                log.Fatal(err)\n        }\n\n        log.Println(tokenString)\n}\n</code></pre>\n\n<p>To store the generated key for later use with jwt.ParseECPrivateKeyFromPEM and jwt.ParseECPublicKeyFromPEM:</p>\n\n<pre><code>import (\n        \"crypto/ecdsa\"\n        \"crypto/x509\"\n        \"encoding/pem\"\n)\n\nfunc pemKeyPair(key *ecdsa.PrivateKey) (privKeyPEM []byte, pubKeyPEM []byte, err error) {\n        der, err := x509.MarshalECPrivateKey(key)\n        if err != nil {\n                return nil, nil, err\n        }\n\n        privKeyPEM = pem.EncodeToMemory(&amp;pem.Block{\n                Type:  \"EC PRIVATE KEY\",\n                Bytes: der,\n        })\n\n        der, err = x509.MarshalPKIXPublicKey(key.Public())\n        if err != nil {\n                return nil, nil, err\n        }\n\n        pubKeyPEM = pem.EncodeToMemory(&amp;pem.Block{\n                Type:  \"EC PUBLIC KEY\",\n                Bytes: der,\n        })\n\n        return\n}\n</code></pre>\n"}], "owner": {"reputation": 2501, "user_id": 3006967, "user_type": "registered", "accept_rate": 24, "profile_image": "https://www.gravatar.com/avatar/7cabe96a5dc1790ea68dd95ad8f7aca5?s=128&d=identicon&r=PG&f=1", "display_name": "user3006967", "link": "https://stackoverflow.com/users/3006967/user3006967"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1572, "favorite_count": 1, "accepted_answer_id": 51472209, "answer_count": 1, "score": 3, "last_activity_date": 1532331514, "creation_date": 1532322016, "last_edit_date": 1532331514, "question_id": 51471802, "link": "https://stackoverflow.com/questions/51471802/how-to-generate-jwt-token-always-through-invalid-key-type-error", "title": "How to generate JWT token always through invalid key type error", "body": "<p>I met this issue and really do not know how to resolve it, can anyone help to provide a working solution?</p>\n\n<pre><code>func GenerateJWT(name, role string) (string, error)  {\n    //create a singner for rsa 256\n    claims := &amp;jwt.StandardClaims{\n        ExpiresAt: 15000,\n        Issuer:    \"test\",\n    }\n\n    token :=jwt.NewWithClaims(jwt.SigningMethodES256, claims)\n    log.Println(\"generated toke is \")\n    log.Println(token)\n    tokenString, err := token.SignedString([]byte(\"secret\"))\n....\n}\n</code></pre>\n\n<p>Now I am alway having: </p>\n\n<blockquote>\n  <p>key is of invalid type</p>\n</blockquote>\n\n<p>error. I google a lot, and even for <code>jwt-go</code> library it self, they are providing exactly same solution, but why I kept having the </p>\n\n<blockquote>\n  <p>key is of invalid type</p>\n</blockquote>\n\n<p>error?</p>\n\n<p>Can anyone help to provide a working sample about how to generate <code>jwt</code> token in <code>go</code>?</p>\n"}, {"tags": ["json", "go", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 14451, "user_id": 1334561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LhV7w.jpg?s=128&g=1", "display_name": "Muhammad Soliman", "link": "https://stackoverflow.com/users/1334561/muhammad-soliman"}, "is_accepted": false, "score": 0, "last_activity_date": 1532316690, "last_edit_date": 1532316690, "creation_date": 1532315948, "answer_id": 51471181, "question_id": 51470259, "link": "https://stackoverflow.com/questions/51470259/how-to-pass-a-json-data-set-as-a-string-in-a-yaml-file/51471181#51471181", "title": "How to pass a JSON data set as a string in a YAML file?", "body": "<p>Define <code>test1</code>  as a <code>string</code> instead of <code>[]map[string]string</code>. you can use <a href=\"https://github.com/go-yaml/yaml\" rel=\"nofollow noreferrer\">go-yaml</a> for parsing and loading your data into your <code>struct</code>'s fields. hope I understood your question correctly, if not please leave a comment. here's a complete example (make sure to define your vars with capital letter in the beginning e.g. <code>Test1</code>)</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"gopkg.in/yaml.v2\"\n)\n\nfunc main() {\n    var data = `\n   test1: \"[{ 'a': 'abd', 'ases': 'cad', 'sx': 'sft' }]\"\n   test2: default\n   `\n\n    type T struct {\n        Test1 string\n        Test2 string\n    }\n    t := T{}\n    err := yaml.Unmarshal([]byte(data), &amp;t)\n    if err != nil {\n        log.Fatalf(\"error: %v\", err)\n    }\n\n    println(\"test1 value: \", t.Test1)\n}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 9738307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d1f05380da6300ef30e5e3206f712105?s=128&d=identicon&r=PG&f=1", "display_name": "pretty08", "link": "https://stackoverflow.com/users/9738307/pretty08"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1326, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1533204611, "creation_date": 1532305177, "last_edit_date": 1533204611, "question_id": 51470259, "link": "https://stackoverflow.com/questions/51470259/how-to-pass-a-json-data-set-as-a-string-in-a-yaml-file", "title": "How to pass a JSON data set as a string in a YAML file?", "body": "<p>how can i have a key in YAML format which accepts a json data as a string? I tried to put the json data in quotes but it reads as a list of map. </p>\n\n<pre><code>test1: '[{'a':'abd','asxs': 'csd','sx':'sft'}]'\ntest2: default\n</code></pre>\n\n<p>I want yaml to read 'test1' as string rather than a list of dicts/maps. how do i get it?</p>\n\n<p>I get below error:</p>\n\n<blockquote>\n  <p>Failed while parsing request input: field \"Request\" field \"string\" \n  can only parse list of bytes or characters, invalid element: \n  map[\"a\":\"abd\" \"asxs\":\"csd\" \"sx\":\"sft\"]</p>\n</blockquote>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 9500527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739f37bed8ede69bfefd3886860eda3e?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Tomasini", "link": "https://stackoverflow.com/users/9500527/ben-tomasini"}, "edited": false, "score": 0, "creation_date": 1532303729, "post_id": 51470104, "comment_id": 89908591, "body": "Thanks! Seems so simple, not sure how I missed that. I think I may have recurseivley sent in the result of <code>Elem()</code> as the <code>interface{}</code> type rather that as the <code>Value</code> itself."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": false, "score": 0, "last_activity_date": 1532303118, "creation_date": 1532303118, "answer_id": 51470104, "question_id": 51470090, "link": "https://stackoverflow.com/questions/51470090/how-do-i-use-reflect-fieldbyname-when-the-value-is-of-kind-reflect-ptr/51470104#51470104", "title": "How do I use reflect.FieldByName when the value is of kind reflect.Ptr", "body": "<p>Use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\">Elem()</a> to go from a <code>reflect.Ptr</code> to the value it points to.</p>\n"}], "owner": {"reputation": 23, "user_id": 9500527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/739f37bed8ede69bfefd3886860eda3e?s=128&d=identicon&r=PG&f=1", "display_name": "Ben Tomasini", "link": "https://stackoverflow.com/users/9500527/ben-tomasini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 470, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532331539, "creation_date": 1532302901, "last_edit_date": 1532331539, "question_id": 51470090, "link": "https://stackoverflow.com/questions/51470090/how-do-i-use-reflect-fieldbyname-when-the-value-is-of-kind-reflect-ptr", "title": "How do I use reflect.FieldByName when the value is of kind reflect.Ptr", "body": "<p>I have a <code>project</code> function which returns a slice containing the field values by name of each struct or map in an input slice. I am having trouble with case where the input slice contains pointers to structs. I have setup a recursive function to operate on the value, but need to know how to convert from kind <code>reflect.Ptr</code> to the underlying <code>reflect.Struct</code>. How is this done?  Any other design recommendations are appreciated. I am still a bit new to Go.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>func project(in []interface{}, property string) []interface{} {\n\n    var result []interface{}\n\n    var appendValue func(list []interface{}, el interface{})\n\n    appendValue = func(list []interface{}, el interface{}) {\n        v := reflect.ValueOf(el)\n        kind := v.Kind()\n        if kind == reflect.Ptr {\n\n            // How do I get the struct behind this ptr?\n            // appendValue(list, el)\n\n        } else if kind == reflect.Struct {\n            result = append(result, v.FieldByName(property).Interface())\n        } else if kind == reflect.Map {\n            result = append(result, el.(map[string]interface{})[property])\n        } else {\n            panic(\"Value must be a struct or map\")\n        }\n    }\n\n    for _, el := range in {\n        appendValue(result, el)\n    }\n\n    return result\n\n}\n</code></pre>\n\n<p>... and the test cases:</p>\n\n<pre><code>func Test_project(t *testing.T) {\n\n    cases := map[string]struct {\n        input    []interface{}\n        property string\n        expected []interface{}\n    }{\n        \"simple-map\": {\n            []interface{}{\n                map[string]interface{}{\n                    \"a\": \"a1\",\n                },\n            },\n            \"a\",\n            []interface{}{\"a1\"},\n        },\n        \"simple-struct\": {\n            []interface{}{\n                simpleStruct{\n                    A: \"a1\",\n                },\n            },\n            \"A\",\n            []interface{}{\"a1\"},\n        },\n        // THIS ONE FAILS\n        \"simple-struct-ptr\": {\n            []interface{}{\n                &amp;simpleStruct{\n                    A: \"a1\",\n                },\n            },\n            \"A\",\n            []interface{}{\"a1\"},\n        },\n    }\n\n    for k, v := range cases {\n\n        t.Run(k, func(t *testing.T) {\n            got := project(v.input, v.property)\n            if !reflect.DeepEqual(got, v.expected) {\n                t.Fatalf(\"Expected %+v, got %+v\", v.expected, got)\n            }\n        })\n    }\n}\n</code></pre>\n"}, {"tags": ["url", "go", "encode", "urlencode", "sign"], "comments": [{"owner": {"reputation": 8728, "user_id": 13144, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7d7f3a3ae79c647242de191255ce6a36?s=128&d=identicon&r=PG", "display_name": "Turnkey", "link": "https://stackoverflow.com/users/13144/turnkey"}, "edited": false, "score": 0, "creation_date": 1532365817, "post_id": 51469448, "comment_id": 89936963, "body": "Be sure to specify a timeout when you create a client, e.g.        client := &amp;http.Client {            Timeout: time.Second * 10,        }"}], "answers": [{"tags": [], "owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "is_accepted": false, "score": 1, "last_activity_date": 1532297724, "creation_date": 1532297724, "answer_id": 51469683, "question_id": 51469448, "link": "https://stackoverflow.com/questions/51469448/passing-20-into-a-string-to-be-encoded-as-a-url-without-it-converting-to-a-sp/51469683#51469683", "title": "Passing &quot;%20&quot; into a string to be encoded as a URL without it converting to a space?", "body": "<p>If you're trying to receive a literal <code>%20</code> on the server side, then encode the <code>%</code> sign. It encodes to <code>%25</code>. So your postdata becomes:</p>\n\n<pre><code>    data := \"&amp;jobTitle=Area%25%20Manager\"\n</code></pre>\n\n<p>But if this is happening, there is probably a problem on the server side where the postdata is being decoded twice.</p>\n"}], "owner": {"reputation": 9, "user_id": 9457728, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3ac0ef219c8ee36cad88177582501bfa?s=128&d=identicon&r=PG&f=1", "display_name": "tom", "link": "https://stackoverflow.com/users/9457728/tom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 189, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1532297724, "creation_date": 1532295348, "question_id": 51469448, "link": "https://stackoverflow.com/questions/51469448/passing-20-into-a-string-to-be-encoded-as-a-url-without-it-converting-to-a-sp", "title": "Passing &quot;%20&quot; into a string to be encoded as a URL without it converting to a space?", "body": "<p>I have the following code to post data to a site: <a href=\"https://play.golang.org/p/e1g0Nd1kDh0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/e1g0Nd1kDh0</a></p>\n\n<p>When I view the request in Fiddler, it shows as:</p>\n\n<pre><code>\"jobTitle=Area Manager\"\n</code></pre>\n\n<p>What I want it to do is send the string <em>exactly</em> as it is in the code (i.e. not encode the %20 to spaces), as it seems to be causing some confusion on the other side? An identical request made using a Python program works fine where the spaces are not added.</p>\n\n<p>I've tried escaping it by doubling the % signs, but it doesn't seem to work. Any help would be great.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["arrays", "json", "loops", "go", "iteration"], "answers": [{"comments": [{"owner": {"reputation": 1740, "user_id": 1611045, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/5Jlql.jpg?s=128&g=1", "display_name": "Anish", "link": "https://stackoverflow.com/users/1611045/anish"}, "edited": false, "score": 0, "creation_date": 1532293492, "post_id": 51469213, "comment_id": 89906940, "body": "I am looking to iterate each component as string, e.g. {&quot;species&quot;:&quot;pigeon&quot;,&quot;decription&quot;:&quot;likes to perch on rocks&quot;}"}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 1740, "user_id": 1611045, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/5Jlql.jpg?s=128&g=1", "display_name": "Anish", "link": "https://stackoverflow.com/users/1611045/anish"}, "edited": false, "score": 0, "creation_date": 1532297371, "post_id": 51469213, "comment_id": 89907617, "body": "I have edited the answer trying to accomplish yours very unusual goal"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 1, "last_activity_date": 1532297221, "last_edit_date": 1532297221, "creation_date": 1532293281, "answer_id": 51469213, "question_id": 51469123, "link": "https://stackoverflow.com/questions/51469123/iterate-on-array-of-json-objects/51469213#51469213", "title": "Iterate on array of JSON objects", "body": "<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype itemdata []struct {    //Precise definition of data structure\n    Species     string\n    Description string\n}\n\nfunc main() {\n    var birds itemdata\n    birdJson := `[{\"species\":\"pigeon\",\"description\":\"likes to perch on rocks\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"}]`\n\n    json.Unmarshal([]byte(birdJson), &amp;birds)\n    fmt.Println(len(birds))\n    fmt.Println(birds)\n    for i, bird := range birds {   //correct syntax for loop\n        fmt.Println(i)\n        fmt.Println(bird)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/4MMCdGD7fe3\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p>Edit:</p>\n\n<p>Your intent to iterate structural data as sequential strings looks very unusual. Sure you can, just construct Decoder and tokeniser.</p>\n\n<pre><code>type itemdata []json.RawMessage //delay unmarshaling of array items\nfunc main() {\n    var birds itemdata\n    birdJson := `[{\"species\":\"pigeon\",\"description\":\"likes to perch on rocks\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"}]`\n    json.Unmarshal([]byte(birdJson), &amp;birds)\n    fmt.Println(len(birds))\n    fmt.Println(birds)\n    for i, bird := range birds {\n        fmt.Println(i)\n        dec := json.NewDecoder(bytes.NewReader(bird)) //construct Decoder\n        for {\n            t, err := dec.Token()  //Tokenise\n            if err == io.EOF {\n                break\n            }\n            if _, ok := t.(json.Delim); !ok {\n                fmt.Println(t)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ujpRvq99ye9\" rel=\"nofollow noreferrer\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "is_accepted": false, "score": 1, "last_activity_date": 1532294796, "last_edit_date": 1532294796, "creation_date": 1532294365, "answer_id": 51469344, "question_id": 51469123, "link": "https://stackoverflow.com/questions/51469123/iterate-on-array-of-json-objects/51469344#51469344", "title": "Iterate on array of JSON objects", "body": "<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype bird struct{\n    Species string\n    Description string\n}\n\nfunc main() {\n    var birds []bird\n    birdJson := `[{\"species\":\"pigeon\",\"description\":\"likes to perch on rocks\"},\n                  {\"species\":\"eagle\",\"description\":\"bird of prey\"},\n                  {\"species\":\"falcon\",\"description\":\"yet another bird of prey\"}]`\n\n    json.Unmarshal([]byte(birdJson), &amp;birds)\n    fmt.Println(len(birds))\n    fmt.Printf(\"\\n%+v\\n\\n\", birds)\n    for i := range birds {\n        fmt.Printf(\"%d) %s: %s\\n\", i, birds[i].Species, birds[i].Description)\n    }\n}\n</code></pre>\n\n<p>With a correct syntax for looping:</p>\n\n<pre><code>for i,bird := range birds {\n    fmt.Printf(\"%d) %s: %s\\n\", i, bird.Species, bird.Description)\n}\n</code></pre>\n\n<p>EDIT: Is this what you meant?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype bird struct{\n    Species string `json:\"species\"`\n    Description string `json:\"description\"`\n}\n\nfunc main() {\n    var birds []bird\n    birdJson := `[{\"species\":\"pigeon\",\"description\":\"likes to perch on rocks\"},\n                  {\"species\":\"eagle\",\"description\":\"bird of prey\"},\n                  {\"species\":\"falcon\",\"description\":\"yet another bird of prey\"}]`\n\n    json.Unmarshal([]byte(birdJson), &amp;birds)\n    fmt.Println(len(birds))\n    fmt.Printf(\"\\n%+v\\n\\n\", birds)\n    for _,bird := range birds {\n        //fmt.Printf(\"%d) %s: %s\\n\", i, bird.Species, bird.Description)\n        b, _ := json.Marshal(bird)\n        fmt.Println(string(b))\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1740, "user_id": 1611045, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/5Jlql.jpg?s=128&g=1", "display_name": "Anish", "link": "https://stackoverflow.com/users/1611045/anish"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "accepted_answer_id": 51469213, "answer_count": 2, "score": -2, "last_activity_date": 1532312929, "creation_date": 1532292424, "last_edit_date": 1532312929, "question_id": 51469123, "link": "https://stackoverflow.com/questions/51469123/iterate-on-array-of-json-objects", "title": "Iterate on array of JSON objects", "body": "<p>I just started learning Go and I'm trying to iterate through each element of array of JSON objects.</p>\n\n<p>I tried the following.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype itemdata []string\n\nfunc main() {\n    var birds itemdata\n    birdJson := `[{\"species\":\"pigeon\",\"decription\":\"likes to perch on rocks\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"},{\"species\":\"eagle\",\"description\":\"bird of prey\"}]`\n\n    json.Unmarshal([]byte(birdJson), &amp;birds)\n    fmt.Println(len(birds))\n    fmt.Println(birds)\n    for i := range birds {\n        fmt.Println(i)\n        fmt.Println(birds[i])\n    }\n\n}\n</code></pre>\n\n<p>How can I iterate on each JSON object?</p>\n\n<p>Expected Output:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>0\n{\"species\":\"pigeon\",\"decription\":\"likes to perch on rocks\"}\n1\n{\"species\":\"eagle\",\"description\":\"bird of prey\"}\n2\n{\"species\":\"eagle\",\"description\":\"bird of prey\"}\n</code></pre>\n"}, {"tags": ["debugging", "variables", "go"], "answers": [{"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": true, "score": 2, "last_activity_date": 1532290951, "creation_date": 1532290951, "answer_id": 51468961, "question_id": 51468876, "link": "https://stackoverflow.com/questions/51468876/how-to-eliminate-global-variables/51468961#51468961", "title": "How to eliminate global variables", "body": "<p>If the debug flag only affects your logging, create a</p>\n\n<pre><code>type logger struct {\n    debug bool\n}\n</code></pre>\n\n<p>which captures that state, then make your <code>logHandler</code> a method <code>log(...)</code> of that type.</p>\n\n<p>This leaves the question where to create an instance of the <code>logger</code>. In the specific case of logging, which is often ubiquitous throughout the whole program, there are two possibilities that I can think of:</p>\n\n<p>1) Use a global log variable/function, i.e. create one <code>logger</code> at the beginning of the program, then use that globally everywhere. This means you can put it in your own <code>log</code> package for example, like the built-in <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\">package log</a> (which by the way you could also use but I see how you often need something else for logging).</p>\n\n<p>2) Again, have one <code>logger</code> instance but instead of making it globally available, pass it down to all the places you need to use it. Create it in your main and pass it to the sub-modules that need to use it. This is highly dependent on your code organization, sometimes it is easy to do this, sometimes not. In some cases, option 1) may work better for you.</p>\n"}], "owner": {"reputation": 135, "user_id": 6746717, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Y_vxMHCybSk/AAAAAAAAAAI/AAAAAAAAAFU/2oZypfKPxSU/photo.jpg?sz=128", "display_name": "Ilie Soltanici", "link": "https://stackoverflow.com/users/6746717/ilie-soltanici"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "accepted_answer_id": 51468961, "answer_count": 1, "score": 0, "last_activity_date": 1532331589, "creation_date": 1532290165, "last_edit_date": 1532331589, "question_id": 51468876, "link": "https://stackoverflow.com/questions/51468876/how-to-eliminate-global-variables", "title": "How to eliminate global variables", "body": "<p>I am just starting to learn go, and everywhere it is mentioned that for the best practices is recommended to avoid usage of global variables. I have this piece of code:</p>\n\n<pre><code>package main\n\nconst scriptVersion = \"1.1\"\nvar debug = 0\n\nfunc logHandler(t, e string) {\n    switch t {\n    case \"warning\":\n        fmt.Println(\"WARNING |\", e)\n    case \"error\":\n        fmt.Println(\"ERROR   |\", e)\n        os.Exit(\"1\")\n    case \"debug\":\n        if debug == 1 {\n            fmt.Println(\"DEBUG   |\", e)\n        }\n    default:\n        fmt.Println(\"INFO    |\", e)\n    }\n}\n\nfor userOptsValue := range os.Args { {\n        switch userOptsValue {\n        case \"-d\", \"--debug\":\n            d := &amp;debug\n            *d = 1\n            logHandler(\"debug\", \"Debug Enabled\")\n        case \"-v\", \"--version\":\n            logHandler(\"info\", \"Version \"+scriptVersion)\n        default:\n            logHandler(\"warning\", \"Unknown Option \"+userOptsValue+\",\"+\" ignoring\")\n        }\n    }\n</code></pre>\n\n<p>The idea is to activate debug action in the script by calling the script with -d or --debug arguments. How can I do the same but avoiding global variable \"var debug = 0\" ?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "edited": false, "score": 2, "creation_date": 1532284707, "post_id": 51468060, "comment_id": 89904786, "body": "This has already been answered here: <a href=\"https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve\" title=\"how to stop http listenandserve\">stackoverflow.com/questions/39320025/&hellip;</a>"}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532287475, "post_id": 51468060, "comment_id": 89905533, "body": "There are packages for graceful restart already, such as <a href=\"https://github.com/facebookgo/grace\" rel=\"nofollow noreferrer\">facebookgo/grace</a>. Don&#39;t reinvent the wheel."}, {"owner": {"reputation": 7445, "user_id": 1564365, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/2ff53772b33c8b0c305481ecb7e67141?s=128&d=identicon&r=PG", "display_name": "Kyslik", "link": "https://stackoverflow.com/users/1564365/kyslik"}, "reply_to_user": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 1, "creation_date": 1532288276, "post_id": 51468060, "comment_id": 89905739, "body": "@MichaelHampton <a href=\"https://2static.fjcdn.com/pictures/Reinvent+the+wheel_279779_5664999.jpg\" rel=\"nofollow noreferrer\">like this?</a> if OP is starting with Go it may be useful to reinvent everything for their own sake."}, {"owner": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "edited": false, "score": 1, "creation_date": 1532344392, "post_id": 51468060, "comment_id": 89923127, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/39320025/how-to-stop-http-listenandserve\">How to stop http.ListenAndServe()</a>"}, {"owner": {"reputation": 35, "user_id": 8998370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpYtV.jpg?s=128&g=1", "display_name": "Person Person", "link": "https://stackoverflow.com/users/8998370/person-person"}, "reply_to_user": {"reputation": 2427, "user_id": 3788261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d14c68ce6c53d9f94656f04bb750300?s=128&d=identicon&r=PG&f=1", "display_name": "ShrimpPhaser", "link": "https://stackoverflow.com/users/3788261/shrimpphaser"}, "edited": false, "score": 0, "creation_date": 1532372819, "post_id": 51468060, "comment_id": 89940364, "body": "@ShrimpPhaser I tried using the Close function but it closes the program"}], "answers": [{"tags": [], "owner": {"reputation": 4099, "user_id": 6376471, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/19290c0ab8b351cf10a7c0b1a9780b4c?s=128&d=identicon&r=PG", "display_name": "Zak", "link": "https://stackoverflow.com/users/6376471/zak"}, "is_accepted": true, "score": 1, "last_activity_date": 1532342023, "creation_date": 1532342023, "answer_id": 51476739, "question_id": 51468060, "link": "https://stackoverflow.com/questions/51468060/stop-server-without-exiting-program-golang/51476739#51476739", "title": "stop server without exiting program golang", "body": "<p>The problem here is that the main thread becomes unblocked when you call <code>server.Close()</code></p>\n\n<p>The main thread starts the server on it's very last line: <code>server.ListenAndServe()</code> but when the <code>/winrestart/</code> handler method gets called; this handler method calls <code>server.Close()</code>, which stops the server, and the original blocking call to <code>server.ListenAndServe()</code> becomes unblocked. The main goroutine exits, and the program exits.</p>\n\n<p>Runnable, simplified example showing this:</p>\n\n<p><a href=\"https://play.golang.org/p/RM1uNASBaC1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/RM1uNASBaC1</a></p>\n"}], "owner": {"reputation": 35, "user_id": 8998370, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PpYtV.jpg?s=128&g=1", "display_name": "Person Person", "link": "https://stackoverflow.com/users/8998370/person-person"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1327, "favorite_count": 0, "accepted_answer_id": 51476739, "answer_count": 1, "score": 1, "last_activity_date": 1532342023, "creation_date": 1532283951, "question_id": 51468060, "link": "https://stackoverflow.com/questions/51468060/stop-server-without-exiting-program-golang", "title": "stop server without exiting program golang", "body": "<p>I am using golang to run a simple server on <a href=\"http://localhost:8080\" rel=\"nofollow noreferrer\">http://localhost:8080</a>. I need a way to stop the server and restart a different server when a user accesses <a href=\"http://localhost:8080/winrestart\" rel=\"nofollow noreferrer\">http://localhost:8080/winrestart</a>. So far I have this:</p>\n\n<pre><code>package main\n\n\nimport (\n  \"net/http\" //serving files and stuff\n  \"log\"      //logging that the server is running and other stuff\n  \"fmt\"      //\"congrats on winning!\"\n)\n\n\nfunc main() {\n\n  //servemux\n  srvmx := http.NewServeMux()\n\n  //handlers that serve the home html file when called\n  fs := http.FileServer(http.Dir(\"./home/\"))\n  os := http.FileServer(http.Dir(\"./lvlone/\"))\n  ws := http.FileServer(http.Dir(\"./win/\"))\n\n  //creates custom server\n  server := http.Server {\n    Addr: \":8080\",\n    Handler: srvmx,\n  }\n\n  //handles paths by serving correct files\n  srvmx.Handle(\"/\", fs)\n  srvmx.Handle(\"/lvlione/\", http.StripPrefix(\"/lvlione/\", os))\n  srvmx.Handle(\"/win/\", http.StripPrefix(\"/win/\", ws))\n  srvmx.HandleFunc(\"/winrestart/\", func(w http.ResponseWriter, r *http.Request){\n    fmt.Println(\"server is being closed\")\n\n    //creates new servemux\n    wsm := http.NewServeMux()\n\n    //this handler just redirects people to the beggining\n    rh := http.RedirectHandler(\"http://127.0.0.1:8080/\", 308)\n\n    //create new redirect server\n    redirector := http.Server {\n      Addr: \":8080\",\n      Handler: wsm,\n    }\n\n    //Handle all paths by redirecting\n    wsm.Handle(\"/lvlione/\", rh)\n    wsm.Handle(\"/win/\", rh)\n    wsm.Handle(\"/winrestart/\", rh)\n\n    //logs redirect server is Listening\n    log.Println(\"redirecting...\")\n    server.Close()\n    redirector.ListenAndServe()\n  })\n\n  //logs that server is Listening\n  log.Println(\"Listening...\")\n  //starts normal level server\n  server.ListenAndServe()\n}\n</code></pre>\n\n<p>As of now, the server closes and the program exits, but no new server is started. Is there a way this can be done?</p>\n"}, {"tags": ["string", "go", "character-encoding", "iteration", "byte"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 1, "creation_date": 1532278480, "post_id": 51467090, "comment_id": 89903041, "body": "Please read <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">this classic piece</a> on strings in Go."}, {"owner": {"reputation": 1, "user_id": 10118198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fca5e3c8fae6685836256821d3e4224?s=128&d=identicon&r=PG&f=1", "display_name": "indeedion", "link": "https://stackoverflow.com/users/10118198/indeedion"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1532278903, "post_id": 51467090, "comment_id": 89903180, "body": "thanks, the post I apparently duplicated got it cleared out, should I remove this post, since it&#39;s a duplicate? Or mark it as solved?"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1532279750, "post_id": 51467090, "comment_id": 89903463, "body": "You can&#39;t mark posts as solved on SO. Just don&#39;t bother, let it rust there ;-)"}], "owner": {"reputation": 1, "user_id": 10118198, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6fca5e3c8fae6685836256821d3e4224?s=128&d=identicon&r=PG&f=1", "display_name": "indeedion", "link": "https://stackoverflow.com/users/10118198/indeedion"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1532277303, "answer_count": 0, "score": 0, "last_activity_date": 1532276966, "creation_date": 1532276966, "question_id": 51467090, "link": "https://stackoverflow.com/questions/51467090/charset-issue-when-iterating-through-string-in-go", "closed_reason": "Duplicate", "title": "Charset issue when iterating through string in Go", "body": "<p>So, I'm learning Golang and this has me stumped. \nThe subStr function should produce a substring, which it does, however, characters such as \u00f1 and \u00ed are not printed correctly. Since </p>\n\n<pre><code>str[i]\n</code></pre>\n\n<p>returns a byte I convert it to string, but then it is no longer utf-8? Or Unicode? (see, this is where I get confused)\nI did read suggestions in similar topics that said I should use </p>\n\n<pre><code>[]rune \n</code></pre>\n\n<p>instead of string, which I did not really comprehend.\nI'm new to GO and this is all very confusing, so if someone would like to explain what I should do to make the subStr function work properly, I would be most grateful.  </p>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n)\n\nfunc subStr(str string, beg int, end int)string {\n\n    var res string\n    for i := beg-1; i &lt; end+1; i++ {\n\n    res = string(res + string(str[i]))\n    }\n\n    return res\n}\n\nfunc main() {\n\n    fmt.Println(\"Testing function\\n\")\n\n    str := \"a\u00f1adir algo con letras extra\u00f1as aqu\u00ed\"\n\n    fmt.Println(str)\n\n    substr := subStr(str, 1, 4)\n\n    fmt.Println(substr)\n\n}\n</code></pre>\n\n<p>Output: </p>\n\n<pre><code>Testing function\n\na\u00f1adir algo con letras extra\u00f1as aqu\u00ed\na\u00c3\u00b1ad\n</code></pre>\n\n<p>As you can see from the output the original string prints fine, but the substring does not</p>\n"}, {"tags": ["go", "gocql"], "answers": [{"tags": [], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "is_accepted": false, "score": 0, "last_activity_date": 1532260833, "last_edit_date": 1532260833, "creation_date": 1532260246, "answer_id": 51464812, "question_id": 51464646, "link": "https://stackoverflow.com/questions/51464646/mapscan-can-not-unmarshal-to-non-pointer-int64/51464812#51464812", "title": "MapScan can not unmarshal to non-pointer int64", "body": "<p>I found the result :</p>\n\n<blockquote>\n  <p>rowValues = make(map[string]interface{})</p>\n</blockquote>\n\n<p>I must add this line in for loop , too.</p>\n\n<p>This is final code :</p>\n\n<pre><code>func FetchNotFinishedTBLRows(limit int) []NotFinishedTBLFields {\n\nrowValues := make(map[string]interface{})\nvar row NotFinishedTBLFields\nvar rows []NotFinishedTBLFields\niter := Instance().Query(fmt.Sprintf(`SELECT * FROM %q Limit %d`, NotFinishedTBLConfig.Name, limit)).Consistency(gocql.All).Iter()\n\nfor iter.MapScan(rowValues) {\n    fmt.Println(\"rowValues \", rowValues)\n    row = NotFinishedTBLFields{\n        Bulk_id:       rowValues[\"bulk_id\"].(int64),\n        Recipient:     rowValues[\"recipient\"].(string),\n        Operator:      rowValues[\"operator\"].(string),\n        Tracking_code: rowValues[\"tracking_code\"].(string),\n    }\n    rows = append(rows, row)\n    rowValues = make(map[string]interface{})\n}\nif err := iter.Close(); err != nil {\n    log.Fatal(err)\n}\nreturn rows\n}\n</code></pre>\n"}], "owner": {"reputation": 298, "user_id": 9456506, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "elham anari", "link": "https://stackoverflow.com/users/9456506/elham-anari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 336, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532269698, "creation_date": 1532259075, "last_edit_date": 1532269698, "question_id": 51464646, "link": "https://stackoverflow.com/questions/51464646/mapscan-can-not-unmarshal-to-non-pointer-int64", "title": "MapScan can not unmarshal to non-pointer int64", "body": "<p>I used MapScan and iterate on it with this error </p>\n\n<blockquote>\n  <p>can not unmarshal into non-pointer int64</p>\n</blockquote>\n\n<p>Errors out after the first iteration.</p>\n\n<p>This is the code I was working on:</p>\n\n<pre><code>type NotFinishedTBLFields struct {\n    Bulk_id       int64\n    Recipient     string\n    Operator      string\n    Tracking_code string\n} \n\nfunc FetchNotFinishedTBLRows() *NotFinishedTBLFields {\n\nrowValues := make(map[string]interface{})\nvar row NotFinishedTBLFields\n\niter := Instance().Query(fmt.Sprintf(`SELECT * FROM %q `, NotFinishedTBLConfig.Name)).Consistency(gocql.All).Iter()\n\nfor iter.MapScan(rowValues) {\n    fmt.Println(\"rowValues \",rowValues)\n    row = NotFinishedTBLFields{\n        Bulk_id:       rowValues[\"bulk_id\"].(int64),\n        Recipient:     rowValues[\"recipient\"].(string),\n        Operator:      rowValues[\"operator\"].(string),\n        Tracking_code: rowValues[\"tracking_code\"].(string),\n    }\n\n}\nif err := iter.Close(); err != nil {\n    log.Fatal(err)\n}\nreturn &amp;row\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose", "dockerfile", "phoenix"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1532271617, "post_id": 51464045, "comment_id": 89901106, "body": "My instinct on seeing that error message and that Dockerfile is that <code>main.go</code> isn&#39;t getting copied in, or perhaps the directory structure isn&#39;t what you expect.  If you <code>RUN ls</code> in the Dockerfile, does the right thing come out?  (Or <code>docker run</code> based one one of the container IDs that gets printed out in the <code>docker build</code> output?)"}], "answers": [{"tags": [], "owner": {"reputation": 1499, "user_id": 1430428, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/9cad3584982ca55f14f5d57114773c97?s=128&d=identicon&r=PG&f=1", "display_name": "piy26", "link": "https://stackoverflow.com/users/1430428/piy26"}, "is_accepted": true, "score": 1, "last_activity_date": 1532262998, "creation_date": 1532262998, "answer_id": 51465191, "question_id": 51464045, "link": "https://stackoverflow.com/questions/51464045/docker-compose-running-2-services-with-dockerfiles-the-task-phx-server-could/51465191#51465191", "title": "docker-compose running 2 services with dockerfiles, The task &quot;phx.server&quot; could not be found, main.go: no such file or directory", "body": "<p>For the error related to go microservice, Since the go binary is not found in PATH, you may need to set the GOPATH env variable via your docker file for go:</p>\n\n<pre><code>export GOPATH=\n</code></pre>\n"}], "owner": {"reputation": 527, "user_id": 5527293, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/c4090049213e9dfa34f08378052a2491?s=128&d=identicon&r=PG&f=1", "display_name": "Shaun Chua", "link": "https://stackoverflow.com/users/5527293/shaun-chua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 414, "favorite_count": 0, "accepted_answer_id": 51465191, "answer_count": 1, "score": 1, "last_activity_date": 1532262998, "creation_date": 1532254218, "question_id": 51464045, "link": "https://stackoverflow.com/questions/51464045/docker-compose-running-2-services-with-dockerfiles-the-task-phx-server-could", "title": "docker-compose running 2 services with dockerfiles, The task &quot;phx.server&quot; could not be found, main.go: no such file or directory", "body": "<p>I have an issue running my docker-compose.yml file with 4 services. They are my go microservice, phoenix web server, mongodb and redis images.</p>\n\n<p>I specified in both my phoenix and golang dockerfiles to change working directory before running both services. I currently get the following errors when I do docker-compose up.</p>\n\n<p>The task \"phx.server\" could not be found\nmain.go: no such file or directory</p>\n\n<p>Here is my Dockerfile.go.development:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code># base image elixer to start with\r\nFROM golang:latest\r\n\r\n# create app folder\r\nRUN mkdir /goApp\r\nCOPY ./genesys-api /goApp\r\nWORKDIR /goApp/cmd/genesys-server\r\n\r\n# install dependencies\r\nRUN go get gopkg.in/redis.v2\r\nRUN go get github.com/gorilla/handlers\r\nRUN go get github.com/dgrijalva/jwt-go\r\nRUN go get github.com/gorilla/context\r\nRUN go get github.com/gorilla/mux\r\nRUN go get gopkg.in/mgo.v2/bson\r\nRUN go get github.com/graphql-go/graphql\r\n\r\n# run phoenix in *dev* mode on port 8080\r\nCMD go run main.go</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Here is my Dockerfile.phoenix.development:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code># base image elixer to start with\r\nFROM elixir:1.6\r\n\r\n# install hex package manager\r\nRUN mix local.hex --force\r\nRUN mix local.rebar --force\r\n\r\n# install the latest phoenix \r\nRUN mix archive.install https://github.com/phoenixframework/archives/raw/master/phx_new.ez --force\r\n\r\n# create app folder\r\nRUN mkdir /app\r\nCOPY ./my_app /app\r\nWORKDIR /app\r\n\r\n# install dependencies\r\nRUN mix deps.get\r\n\r\n# run phoenix in *dev* mode on port 4000\r\nCMD mix phx.server</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>Here is my docker-compose.yml file:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>version: '3.6'\r\nservices:\r\n  go:\r\n    build:\r\n      context: .\r\n      dockerfile: Dockerfile.go.development\r\n    ports:\r\n      - 8080:8080\r\n    volumes:\r\n      - .:/goApp\r\n    depends_on:\r\n      - db\r\n      - redis\r\n  phoenix:\r\n    # tell docker-compose which Dockerfile it needs to build\r\n    build:\r\n      context: .\r\n      dockerfile: Dockerfile.phoenix.development\r\n    # map the port of phoenix to the local dev port\r\n    ports:\r\n      - 4000:4000\r\n    # mount the code folder inside the running container for easy development\r\n    volumes:\r\n      - .:/app\r\n    # make sure we start mongodb when we start this service\r\n    # links:\r\n    #   - db\r\n    depends_on:\r\n      - db\r\n      - redis\r\n    environment:\r\n      GOOGLE_CLIENT_ID: ${GOOGLE_CLIENT_ID}\r\n      GOOGLE_CLIENT_SECRET: ${GOOGLE_CLIENT_SECRET}\r\n      FACEBOOK_CLIENT_ID: ${FACEBOOK_CLIENT_ID}\r\n      FACEBOOK_CLIENT_SECRET: ${FACEBOOK_CLIENT_SECRET}\r\n  db:\r\n    container_name: db\r\n    image: mongo:latest\r\n    volumes:\r\n      - ./data/db:/data/db\r\n    ports:\r\n      - 27017:27017\r\n  redis:\r\n    container_name: redis\r\n    image: redis:latest\r\n    ports:\r\n      - \"6379:6379\"\r\n    volumes:\r\n      - ./data/redis:/data/redis\r\n    entrypoint: redis-server\r\n    restart: always</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}, {"tags": ["linux", "csv", "go", "permissions"], "answers": [{"tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": true, "score": 1, "last_activity_date": 1532342601, "last_edit_date": 1532342601, "creation_date": 1532249050, "answer_id": 51463421, "question_id": 51463210, "link": "https://stackoverflow.com/questions/51463210/golang-csv-write-empty-on-linux/51463421#51463421", "title": "Golang csv write empty on linux", "body": "<p>Golang spec described <a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\">OpenFile</a>:</p>\n\n<blockquote>\n  <p>OpenFile is the generalized open call; most users will use Open or\n  Create instead. It opens the named file with specified flag (O_RDONLY\n  etc.) and perm (before umask), if applicable. If successful, methods\n  on the returned File can be used for I/O. If there is an error, it\n  will be of type *PathError.</p>\n</blockquote>\n\n<p>You are missing the flag to write to the file created using <code>OpenFile</code> function that's the reason file is opened for writing or reading but nothing is written to the csv.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/csv\"\n    \"fmt\"\n    \"os\"\n)\n\nvar data = [][]string{\n    {\"1\", \"2\", \"3\", \"4\", \"5\"},\n    {\"a\", \"b\", \"c\", \"d\", \"f\"},\n}\n\nfunc main() {\n    filename := \"example.csv\"\n    fp, e := os.OpenFile(filename, os.O_CREATE|os.O_APPEND|os.O_WRONLY, os.ModePerm)\n    if nil != e {\n        fmt.Printf(\"Open file '%s' failed: %s\\n\", filename, e)\n        os.Exit(1)\n    }\n    defer fp.Close()\n    w := csv.NewWriter(fp)\n    defer w.Flush()\n    for _, l := range data {\n        if e := w.Write(l); nil != e {\n            fmt.Printf(\"Write csv failed: %s\\n\", e)\n            os.Exit(1)\n        }\n    }\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/RHQUvegjvxb\" rel=\"nofollow noreferrer\">Playground Example</a></p>\n\n<p>Flags are elaborated in source code for <a href=\"https://golang.org/src/os/file.go?s=8174:8240#L62\" rel=\"nofollow noreferrer\">os/file.go</a>:</p>\n\n<pre><code>// Flags to OpenFile wrapping those of the underlying system. Not all\n\n// flags may be implemented on a given system.\n\nconst (\n    // Exactly one of O_RDONLY, O_WRONLY, or O_RDWR must be specified.\n    O_RDONLY int = syscall.O_RDONLY // open the file read-only.\n    O_WRONLY int = syscall.O_WRONLY // open the file write-only.\n    O_RDWR   int = syscall.O_RDWR   // open the file read-write.\n    // The remaining values may be or'ed in to control behavior.\n    O_APPEND int = syscall.O_APPEND // append data to the file when writing.\n    O_CREATE int = syscall.O_CREAT  // create a new file if none exists.\n    O_EXCL   int = syscall.O_EXCL   // used with O_CREATE, file must not exist.\n    O_SYNC   int = syscall.O_SYNC   // open for synchronous I/O.\n    O_TRUNC  int = syscall.O_TRUNC  // if possible, truncate file when opened.\n\n)\n</code></pre>\n"}], "owner": {"reputation": 107, "user_id": 1530572, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/b34ac0a05543759b97b03478b0b73792?s=128&d=identicon&r=PG", "display_name": "Mingcai SHEN", "link": "https://stackoverflow.com/users/1530572/mingcai-shen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 413, "favorite_count": 0, "accepted_answer_id": 51463421, "answer_count": 1, "score": 1, "last_activity_date": 1532342601, "creation_date": 1532247220, "last_edit_date": 1532249684, "question_id": 51463210, "link": "https://stackoverflow.com/questions/51463210/golang-csv-write-empty-on-linux", "title": "Golang csv write empty on linux", "body": "<p>I have a problem of writing csv file on linux, with exactly the same code, it works on windows but nothing is written to the file on linux(Centos7):</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"fmt\"\n    \"encoding/csv\"\n)\n\nvar data = [][]string{\n    {\"1\",\"2\",\"3\",\"4\",\"5\"},\n    {\"a\",\"b\",\"c\",\"d\",\"f\"},\n}\n\n\nfunc main() {\n    filename := \"example.csv\"\n    fp,e := os.OpenFile(filename, os.O_CREATE|os.O_APPEND, os.ModePerm)\n    if nil != e {\n        fmt.Printf(\"Open file '%s' failed: %s\\n\", filename, e)\n        os.Exit(1)\n    }\n    defer fp.Close()\n    w := csv.NewWriter(fp)\n    defer w.Flush()\n    for _,l := range data {\n        if e := w.Write(l); nil != e {\n            fmt.Printf(\"Write csv failed: %s\\n\",e)\n            os.Exit(1)\n        }\n    }\n    fmt.Println(\"Done.\")\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532240810, "post_id": 51462307, "comment_id": 89894105, "body": "Why do you even have the <code>n</code> parameter? What does it stand for?"}, {"owner": {"reputation": 142, "user_id": 596087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c742ed19c020dc49622cdbec2b82dd?s=128&d=identicon&r=PG", "display_name": "Andrew Amis", "link": "https://stackoverflow.com/users/596087/andrew-amis"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532242029, "post_id": 51462307, "comment_id": 89894286, "body": "It&#39;s just for limiting the number of items returned. Because this is part of an RPC server, it&#39;s probably useful to limit the amount of network traffic and duplicated data in memory."}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 1, "creation_date": 1532242319, "post_id": 51462307, "comment_id": 89894336, "body": "In that case I would either 1) have the user provide a preallocated []string slice and return the number of items actually written to it or 2) keep the n, allocate []string myself but return the actual valid slice, not filled with nil. The reason not to return a slice with nil at the end is simplicity and convenience. Why should the caller have to take extra steps if you know how many items there are and can easily tell it?"}], "answers": [{"comments": [{"owner": {"reputation": 142, "user_id": 596087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c742ed19c020dc49622cdbec2b82dd?s=128&d=identicon&r=PG", "display_name": "Andrew Amis", "link": "https://stackoverflow.com/users/596087/andrew-amis"}, "edited": false, "score": 0, "creation_date": 1532244543, "post_id": 51462592, "comment_id": 89894743, "body": "It sounds like when using this on non-nil-able values, it&#39;s extra important not to include extraneous &quot;nil&quot; values because they aren&#39;t nil, they&#39;re an actual value that might have meaning in context. This is a nuance I missed: too much Java."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1532244167, "last_edit_date": 1532244167, "creation_date": 1532240918, "answer_id": 51462592, "question_id": 51462307, "link": "https://stackoverflow.com/questions/51462307/buffer-length-etiquette/51462592#51462592", "title": "Buffer length etiquette", "body": "<p>Every Go programmer encounters <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow noreferrer\"><code>io.Reader</code></a>. Here is an example,</p>\n\n<pre><code>for {\n    // io.Reader\n    n, err := r.Read(buf[:cap(buf)])\n    buf = buf[:n]\n    if err != nil {\n        // handle error\n    }\n    // process buf\n    for i := 0; i &lt; len(buf); i++ {\n        // process byte\n    }\n}\n</code></pre>\n\n<p>As you can see, the number of bytes actually read is returned, so we adjust the size of the buffer. We can then use <code>len(buf)</code> for the number of bytes to process.</p>\n\n<hr>\n\n<p>Go does not have C-like null terminated strings. A Go string <code>s</code> has a length <code>len(s)</code>.</p>\n\n<hr>\n\n<p>Not every type has a <code>nil</code> value. <code>nil</code> is only useful with pointer types. Your example doesn't appear to work.</p>\n\n<pre><code>var reply *[]string\nfor i := 0; i &lt; n; i++ {\n    // invalid operation: (*reply)[i] == nil (mismatched types string and nil)\n    if (*reply)[i] == nil {\n        break // or continue\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 142, "user_id": 596087, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/66c742ed19c020dc49622cdbec2b82dd?s=128&d=identicon&r=PG", "display_name": "Andrew Amis", "link": "https://stackoverflow.com/users/596087/andrew-amis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 1, "is_answered": true, "view_count": 69, "favorite_count": 1, "answer_count": 1, "score": -1, "last_activity_date": 1617803137, "creation_date": 1532237227, "last_edit_date": 1617803137, "question_id": 51462307, "link": "https://stackoverflow.com/questions/51462307/buffer-length-etiquette", "title": "Buffer length etiquette", "body": "<p>I have a question of etiquette. I'm implementing an RPC server, which is why this function takes a value and uses an out-variable in its parameter. This function reads from a <code>container/list</code> and fills a normal array buffer for return through the out-variable.</p>\n\n<pre><code>func (t *PersonalPlaylist) GetPlaylist(n int, reply *[]string) error {\n    t.listMutex.Lock()\n\n    bufLen := min(n, t.list.Len()) // mark\n\n    buf := make([]string, bufLen) // mark\n    e := t.list.Front()\n\n    for i := 0; i &lt; n; i++ {\n        s := e.Value.(string)\n        buf[i] = fmt.Sprintf(\"String #%d: %s\", i, s)\n\n        e = e.Next()\n        if e == nil {\n            break\n        }\n    }\n\n    *reply = buf\n\n    t.listMutex.Unlock()\n    return nil\n}\n</code></pre>\n\n<p>[Note that this function should limit the maximum buffer size.]</p>\n\n<p>Of particular note are the marked lines. I'm trying to decide whether the buffer should always be of the requested size (n) and be zero/nil-filled beyond the real data, or if the buffer should sometimes be shorter than the request value.</p>\n\n<p>If the buffer is always the requested size, the code calling this function can use the value it passed as a parameter as part of the loop through the array. However, some of the values in the array may be nil, so it would have to nil check in each loop:</p>\n\n<pre><code>for i := 0; i &lt; n; i++ {\n    if reply[i] == nil {\n        break; // or continue\n    }\n}\n</code></pre>\n\n<p>In the alternate scenario, the caller can't be sure of the buffer size, and will have to call <code>len(reply)</code> instead, but can be largely guaranteed that all the values will be non-nil.</p>\n\n<p>I'm leaning towards using the function as is, and making callers unsure of the length of the buffer (while still guaranteeing a maximum possible buffer size); this is primarily because this is a relatively high level interface that will only get higher as I continue development. Is there a convention I'm not aware of that this code breaks? Or some etiquette that pushes this one way or another?</p>\n"}, {"tags": ["go", "internationalization", "translation"], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": false, "score": 2, "last_activity_date": 1532228600, "creation_date": 1532228600, "answer_id": 51461687, "question_id": 51461667, "link": "https://stackoverflow.com/questions/51461667/what-does-golang-org-x-text-message-print-accomplish/51461687#51461687", "title": "What does golang.org/x/text/message.Print accomplish?", "body": "<blockquote>\n  <p>Package message implements formatted I/O for localized strings with functions analogous to the fmt's print functions. It is a drop-in replacement for fmt.</p>\n</blockquote>\n\n<p>Language-specific behavior does not distinguish <code>Printer.Print</code> from <code>Printer.Printf</code> -- rather it distinguishes each from their <a href=\"https://golang.org/pkg/fmt/#Print\" rel=\"nofollow noreferrer\">analogous functions in the <code>fmt</code> package</a>.  It's right there in the documentation you quoted.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 137, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1532228600, "creation_date": 1532228266, "question_id": 51461667, "link": "https://stackoverflow.com/questions/51461667/what-does-golang-org-x-text-message-print-accomplish", "title": "What does golang.org/x/text/message.Print accomplish?", "body": "<p>The doc for <a href=\"https://godoc.org/golang.org/x/text/message#Printer.Print\" rel=\"nofollow noreferrer\"><code>Printer.Print</code></a> says:</p>\n\n<blockquote>\n  <p>Print is like fmt.Print, but using language-specific formatting.</p>\n</blockquote>\n\n<p>but I'm having difficult seeing anything language specific compared to <a href=\"https://godoc.org/golang.org/x/text/message#Printer.Printf\" rel=\"nofollow noreferrer\"><code>Printer.Printf</code></a>.</p>\n\n<p>Consider:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"golang.org/x/text/language\"\n    \"golang.org/x/text/message\"\n)\n\nfunc main() {\n    message.SetString(language.English, \"foo\", \"bar\")\n\n    p := message.NewPrinter(language.English)\n    p.Print(\"foo\")\n    fmt.Println()\n    p.Printf(\"foo\")\n    fmt.Println()\n}\n</code></pre>\n\n<p>Result:</p>\n\n<pre><code>foo\nbar\n</code></pre>\n\n<p>What exactly does <code>Printer.Print</code> do (that is language specific)?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk"], "answers": [{"comments": [{"owner": {"reputation": 3516, "user_id": 1597944, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/c1d9df1b61a99e23af28bf753da54256?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Kayarohanam", "link": "https://stackoverflow.com/users/1597944/harish-kayarohanam"}, "edited": false, "score": 0, "creation_date": 1532247212, "post_id": 51463200, "comment_id": 89895253, "body": "hi, is it in the aws go sdk i can use ?"}, {"owner": {"reputation": 3516, "user_id": 1597944, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/c1d9df1b61a99e23af28bf753da54256?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Kayarohanam", "link": "https://stackoverflow.com/users/1597944/harish-kayarohanam"}, "edited": false, "score": 0, "creation_date": 1532247343, "post_id": 51463200, "comment_id": 89895285, "body": "this is nice tool, but if my json has different fields tmrw it will break right ? . thats why i was asking for if there is one struct in aws sdk itself"}], "tags": [], "owner": {"reputation": 2960, "user_id": 3521243, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/EJDD8.jpg?s=128&g=1", "display_name": "Emile Pels", "link": "https://stackoverflow.com/users/3521243/emile-pels"}, "is_accepted": false, "score": 2, "last_activity_date": 1532247375, "last_edit_date": 1532247375, "creation_date": 1532247157, "answer_id": 51463200, "question_id": 51460711, "link": "https://stackoverflow.com/questions/51460711/what-is-the-correct-struct-to-read-aws-config-notification/51463200#51463200", "title": "what is the correct struct to read AWS Config notification?", "body": "<p>I always use <a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">this</a> tool to generate struct definitions from JSON blobs. The only thing you have to do yourself is pick a type for the <code>null</code> values: it obviously can't determine those, and therefore sets them to <code>interface{}</code> (any type implements this).</p>\n\n<p>The struct tags (e.g. <code>json:\"changeType\"</code>) can be omitted if you only want to unmarshal, and not the other way around.</p>\n\n<pre><code>type ConfigNotification struct {\n    ConfigurationItemDiff struct {\n        ChangedProperties struct {\n        } `json:\"changedProperties\"`\n        ChangeType string `json:\"changeType\"`\n    } `json:\"configurationItemDiff\"`\n    ConfigurationItem struct {\n        RelatedEvents []interface{} `json:\"relatedEvents\"`\n        Relationships []interface{} `json:\"relationships\"`\n        Configuration struct {\n            Attachments      []interface{} `json:\"attachments\"`\n            AvailabilityZone string        `json:\"availabilityZone\"`\n            CreateTime       time.Time     `json:\"createTime\"`\n            Encrypted        bool          `json:\"encrypted\"`\n            KmsKeyID         interface{}   `json:\"kmsKeyId\"`\n            Size             int           `json:\"size\"`\n            SnapshotID       string        `json:\"snapshotId\"`\n            State            string        `json:\"state\"`\n            VolumeID         string        `json:\"volumeId\"`\n            Iops             int           `json:\"iops\"`\n            Tags             []struct {\n                Key   string `json:\"key\"`\n                Value string `json:\"value\"`\n            } `json:\"tags\"`\n            VolumeType string `json:\"volumeType\"`\n        } `json:\"configuration\"`\n        SupplementaryConfiguration struct {\n        } `json:\"supplementaryConfiguration\"`\n        Tags struct {\n            Creator string `json:\"creator\"`\n        } `json:\"tags\"`\n        ConfigurationItemVersion     string      `json:\"configurationItemVersion\"`\n        ConfigurationItemCaptureTime time.Time   `json:\"configurationItemCaptureTime\"`\n        ConfigurationStateID         int64       `json:\"configurationStateId\"`\n        AwsAccountID                 string      `json:\"awsAccountId\"`\n        ConfigurationItemStatus      string      `json:\"configurationItemStatus\"`\n        ResourceType                 string      `json:\"resourceType\"`\n        ResourceID                   string      `json:\"resourceId\"`\n        ResourceName                 interface{} `json:\"resourceName\"`\n        ARN                          string      `json:\"ARN\"`\n        AwsRegion                    string      `json:\"awsRegion\"`\n        AvailabilityZone             string      `json:\"availabilityZone\"`\n        ConfigurationStateMd5Hash    string      `json:\"configurationStateMd5Hash\"`\n        ResourceCreationTime         time.Time   `json:\"resourceCreationTime\"`\n    } `json:\"configurationItem\"`\n    NotificationCreationTime time.Time `json:\"notificationCreationTime\"`\n    MessageType              string    `json:\"messageType\"`\n    RecordVersion            string    `json:\"recordVersion\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 3516, "user_id": 1597944, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/c1d9df1b61a99e23af28bf753da54256?s=128&d=identicon&r=PG&f=1", "display_name": "Harish Kayarohanam", "link": "https://stackoverflow.com/users/1597944/harish-kayarohanam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 124, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1532247375, "creation_date": 1532213589, "question_id": 51460711, "link": "https://stackoverflow.com/questions/51460711/what-is-the-correct-struct-to-read-aws-config-notification", "title": "what is the correct struct to read AWS Config notification?", "body": "<p>I am pretty new to go and I have to use aws go sdk to read AWS Config notifications from SQS. (AWS config service -> sns -> sqs)\nI was able to get the message. But I want to get into the message get information like resourceType, resourceId, awsRegion.\nThis is the sample message string(stringified json) I have.\n<a href=\"https://gist.github.com/HarishAtGitHub/fcbb01515d11044d04bde14a3d9f6e7a\" rel=\"nofollow noreferrer\">https://gist.github.com/HarishAtGitHub/fcbb01515d11044d04bde14a3d9f6e7a</a></p>\n\n<p>I am from python background and in python it is easy to do, as the json is like a dictionary. We can easily get it by nested index.\nBut in go it seems like I should use the right struct to understand this message. </p>\n\n<p>can someone either point me to the right struct or any ideas on how to get the different properties in the message ?</p>\n"}, {"tags": ["forms", "rest", "go", "middleware", "gorilla"], "comments": [{"owner": {"reputation": 109956, "user_id": 159145, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/r8ryC.png?s=128&g=1", "display_name": "Dai", "link": "https://stackoverflow.com/users/159145/dai"}, "edited": false, "score": 0, "creation_date": 1532212270, "post_id": 51460418, "comment_id": 89890493, "body": "Have you used a Go debugger to inspect the contents of <code>r</code> when control enters your <code>commonMiddleware</code> function?"}], "answers": [{"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1532253196, "post_id": 51460841, "comment_id": 89896553, "body": "I do really appreciate if you can show it to me in form of code."}, {"owner": {"reputation": 13897, "user_id": 1713660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5aa62fae5a22b542d2a188b95384aee?s=128&d=identicon&r=PG", "display_name": "vladkras", "link": "https://stackoverflow.com/users/1713660/vladkras"}, "edited": false, "score": 0, "creation_date": 1617854811, "post_id": 51460841, "comment_id": 118425701, "body": "<code>r.PostForm.Get()</code> and <code>r.Form.Get()</code> will not work in your example if you don&#39;t call <code>r.ParseMultipartForm()</code> or  <code>r.ParseForm()</code> before&#39;em"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 5, "last_activity_date": 1532260166, "last_edit_date": 1532260166, "creation_date": 1532215353, "answer_id": 51460841, "question_id": 51460418, "link": "https://stackoverflow.com/questions/51460418/http-request-r-formvalue-returns-nothing-map/51460841#51460841", "title": "http.Request r.FormValue returns nothing/map[]", "body": "<p>You truing to read <code>r.Body</code> twice, first in <code>commonMiddleware</code> with  <code>ioutil.ReadAll(r.Body)</code> and then in <code>handleNumber</code> with <code>r.ParseForm()</code>. You can't. It's <code>io.Reader</code>, you can't read it two times. You can instead, for example, <code>r.ParseForm()</code> in middlewear and then use parsed form data. In middlewear <code>r.PosrForm.Encode()</code> to log, and in handler <code>r.FormValue()</code> or <code>r.Form.Get()</code> to extract. I think something like this should do</p>\n\n<pre><code>func commonMiddleware(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Add(\"Content-Type\", \"application/json\")\n    err:=r.ParseForm() //parse in middleware, data will be contained in r.PostForm\n    if err != nil {\n      log.Fatalf(\"Failed to decode postFormByteSlice: %v\", err)\n    }\n    rl := rLog{Method: r.Method, URI: r.RequestURI, FormParam: r.PostForm.Encode()} //url.Values.Encode() stringifys form data\n    log.Printf(\"%+v\", rl)\n    next.ServeHTTP(w, r)\n  })\n}\n\nfunc main() {\n  port := \":3000\"\n  var router = mux.NewRouter()\n  router.Use(commonMiddleware)\n  router.HandleFunc(\"/m/{msg}\", handleMessage).Methods(\"GET\")\n  router.HandleFunc(\"/n/\", handleNumber).Methods(\"POST\")\n}\n\nfunc handleNumber(w http.ResponseWriter, r *http.Request) {\n  log.Println(r.PostForm.Get(\"name\")) // or just r.Form.Get(\"name\") or r.FormValue(\"name\")\n  response := map[string]string{\"name\": \"1\"} // dummy response\n  json.NewEncoder(w).Encode(response)\n}\n</code></pre>\n"}], "owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2350, "favorite_count": 1, "accepted_answer_id": 51460841, "answer_count": 1, "score": 1, "last_activity_date": 1532260166, "creation_date": 1532209987, "last_edit_date": 1532210903, "question_id": 51460418, "link": "https://stackoverflow.com/questions/51460418/http-request-r-formvalue-returns-nothing-map", "title": "http.Request r.FormValue returns nothing/map[]", "body": "<p>I have the following Go code:</p>\n\n<pre><code>package main\n\nimport (\n  \"encoding/json\"\n  \"fmt\"\n  \"github.com/gorilla/mux\"\n  \"github.com/gorilla/handlers\"\n  \"log\"\n  \"net/http\"\n  \"io/ioutil\"\n)\n\ntype rLog struct {\n  Method string\n  URI string\n  FormParam string\n}\n\nfunc commonMiddleware(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Add(\"Content-Type\", \"application/json\")\n    formBs, err := ioutil.ReadAll(r.Body)\n    if err != nil {\n      log.Fatalf(\"Failed to decode postFormByteSlice: %v\", err)\n    }\n    rl := rLog{Method: r.Method, URI: r.RequestURI, FormParam: string(formBs)}\n    log.Printf(\"%+v\", rl)\n    next.ServeHTTP(w, r)\n  })\n}\n\nfunc main() {\n  port := \":3000\"\n  var router = mux.NewRouter()\n  router.Use(commonMiddleware)\n  router.HandleFunc(\"/m/{msg}\", handleMessage).Methods(\"GET\")\n  router.HandleFunc(\"/n/\", handleNumber).Methods(\"POST\")\n\n  headersOk := handlers.AllowedHeaders([]string{\"Authorization\"})\n  originsOk := handlers.AllowedOrigins([]string{\"*\"})\n  methodsOk := handlers.AllowedMethods([]string{\"GET\", \"POST\", \"OPTIONS\"})\n\n  fmt.Printf(\"Server is running at http://localhost%s\\n\", port)\n  log.Fatal(http.ListenAndServe(port, handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n}\n\nfunc handleMessage(w http.ResponseWriter, r *http.Request) {\n  vars := mux.Vars(r)\n  message := vars[\"msg\"]\n  response := map[string]string{\"message\": message}\n  json.NewEncoder(w).Encode(response)\n}\n\nfunc handleNumber(w http.ResponseWriter, r *http.Request) {\n  log.Println(r.FormValue(\"name\")) // this returns nothing\n  response := map[string]string{\"name\": \"1\"} // dummy response\n  json.NewEncoder(w).Encode(response)\n}\n</code></pre>\n\n<p>What I try to do here is very simple.</p>\n\n<ol>\n<li>I want to log all POST form data (it's done inside the <code>commonMiddleware</code>)</li>\n<li>Access the form data inside the <code>handleNumber</code> i.e. <code>name</code> (and many more later) and do some logic with it.</li>\n</ol>\n\n<p>The problem that I have right now is, the <code>log.Println(r.FormValue(\"name\"))</code> returns nothing and I really wonder why that happened.</p>\n\n<p><a href=\"https://i.stack.imgur.com/6B2oQ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6B2oQ.png\" alt=\"enter image description here\"></a></p>\n\n<p>I've tried adding <code>r.ParseForm()</code> before <code>log.Println(r.FormValue(\"name\"))</code>. But it didn't work.</p>\n\n<p>And, when I add <code>log.Println(r.Form)</code> line, it returns <code>map[]</code>.</p>\n\n<p>What did I missed here?</p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1532206164, "post_id": 51459957, "comment_id": 89889227, "body": "What version of go are you using? It seems to work for me: <a href=\"https://play.golang.org/p/p4fFqro9W60\" rel=\"nofollow noreferrer\">play.golang.org/p/p4fFqro9W60</a>"}, {"owner": {"reputation": 305, "user_id": 9273148, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04b81b581c2f76b5ef4c87adacb3c485?s=128&d=identicon&r=PG&f=1", "display_name": "Tanvi Jaywant", "link": "https://stackoverflow.com/users/9273148/tanvi-jaywant"}, "reply_to_user": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "edited": false, "score": 0, "creation_date": 1532206395, "post_id": 51459957, "comment_id": 89889273, "body": "go1.10.3 is the version"}], "answers": [{"tags": [], "owner": {"reputation": 4028, "user_id": 816892, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/203cadc8467e3add61b5cdcdfd224cf4?s=128&d=identicon&r=PG", "display_name": "Topo", "link": "https://stackoverflow.com/users/816892/topo"}, "is_accepted": false, "score": 2, "last_activity_date": 1532206348, "creation_date": 1532206348, "answer_id": 51460015, "question_id": 51459957, "link": "https://stackoverflow.com/questions/51459957/what-cases-cannot-convert-d-type-untyped-string-to-type-int-in-go/51460015#51460015", "title": "What cases &quot;cannot convert &quot;%d&quot; (type untyped string) to type int&quot; in Go?", "body": "<p>I see your error now. You are trying to concatenate or add the string and the int, instead of passing the two arguments to the function.</p>\n\n<pre><code>for _, v := range x {\n   fmt.Printf(\"%d\" + v); // The error is in this line\n}\n</code></pre>\n\n<p>It should be:</p>\n\n<pre><code>func printArray(x [3]int) {\n    for _, v := range x {\n       fmt.Printf(\"%d\", v);\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1111, "user_id": 1131607, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/xLKUc.jpg?s=128&g=1", "display_name": "Arun", "link": "https://stackoverflow.com/users/1131607/arun"}, "is_accepted": false, "score": 0, "last_activity_date": 1601618711, "creation_date": 1601618711, "answer_id": 64166836, "question_id": 51459957, "link": "https://stackoverflow.com/questions/51459957/what-cases-cannot-convert-d-type-untyped-string-to-type-int-in-go/64166836#64166836", "title": "What cases &quot;cannot convert &quot;%d&quot; (type untyped string) to type int&quot; in Go?", "body": "<p>My Answer is not particularly related to this Question, But I had similar error and the way I solved is updating here, may be some future users may found helpful!</p>\n<p><strong>Got the same error for below Code: Here <code>itemID</code> is <code>int</code></strong></p>\n<pre><code>strSQL := &quot;SELECT item_desc,item_sel_price FROM item_master WHERE item_id=&quot; +  itemID)\n</code></pre>\n<p><strong>Solved by using <code>fmt.Sprintf</code></strong></p>\n<pre><code>strSQL := fmt.Sprintf(&quot;%s%d&quot;,&quot;SELECT item_desc,item_sel_price FROM item_master WHERE item_id=&quot;, itemID)\n</code></pre>\n"}], "owner": {"reputation": 305, "user_id": 9273148, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/04b81b581c2f76b5ef4c87adacb3c485?s=128&d=identicon&r=PG&f=1", "display_name": "Tanvi Jaywant", "link": "https://stackoverflow.com/users/9273148/tanvi-jaywant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1855, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1601618711, "creation_date": 1532205743, "question_id": 51459957, "link": "https://stackoverflow.com/questions/51459957/what-cases-cannot-convert-d-type-untyped-string-to-type-int-in-go", "title": "What cases &quot;cannot convert &quot;%d&quot; (type untyped string) to type int&quot; in Go?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc printArray(x [3]int) {\n    fmt.Printf(\"%d\", x[1]);\n    // cannot convert \"%d\" (type untyped string) to type int\n    // invalid operation: \"%d\" + v (mismatched types string and int)\n    // for _, v := range x {\n    //  fmt.Printf(\"%d\" + v);\n    // }\n}\n\nfunc main() {\n    a := [3]int{1, 2, 3};\n\n    for _, v := range a {\n        fmt.Printf(\"%d\\n\", v);\n    }\n\n    printArray(a); \n}\n</code></pre>\n\n<p>I can successfully print the array in the go method, but when I pass array into the method, it throws an error when it tries to print. What cause's the method to treat it differently then main method?</p>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 28286, "user_id": 1995300, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/GR7Be.jpg?s=128&g=1", "display_name": "helmbert", "link": "https://stackoverflow.com/users/1995300/helmbert"}, "is_accepted": true, "score": 6, "last_activity_date": 1532257172, "creation_date": 1532257172, "answer_id": 51464389, "question_id": 51459418, "link": "https://stackoverflow.com/questions/51459418/how-can-i-set-redis-key-timeout-using-redigo/51464389#51464389", "title": "How can I set redis key timeout using redigo?", "body": "<p>The <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#Conn\" rel=\"noreferrer\"><code>Conn</code> struct's <code>Do</code> method</a> accepts the command name, and a list of arbitrary parameters (typed <code>...interface{}</code>).</p>\n\n<p>You can use these parameters to pass any kind of parameter that you would also pass using the Redis CLI:</p>\n\n<pre><code>conn.Do(\"SETEX\", \"mykey\", 600, value)\n</code></pre>\n\n<p>Also, have a look at the <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#hdr-Executing_Commands\" rel=\"noreferrer\">\"Executing commands\"</a> section from the documentation for more information.</p>\n"}], "owner": {"reputation": 8661, "user_id": 5774375, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/83e8847058c0655871c7022baf9ff89e?s=128&d=identicon&r=PG&f=1", "display_name": "Karlom", "link": "https://stackoverflow.com/users/5774375/karlom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2436, "favorite_count": 1, "accepted_answer_id": 51464389, "answer_count": 1, "score": 4, "last_activity_date": 1532257172, "creation_date": 1532201326, "last_edit_date": 1532202104, "question_id": 51459418, "link": "https://stackoverflow.com/questions/51459418/how-can-i-set-redis-key-timeout-using-redigo", "title": "How can I set redis key timeout using redigo?", "body": "<p>I'd like to add a timeout to redis key/value pair so that they expire after 10 minutes. </p>\n\n<p>Here is the function</p>\n\n<pre><code>func setData(value string) {\n    conn, err := redis.Dial(\"tcp\", \"localhost:6379\", redis.DialDatabase(1))\n    if err != nil {\n        log.Fatalf(\"Could not connect: %v\\n\", err)\n    }\n    defer conn.Close()\n\n    conn.Do(\"SET\", \"mykey\", value)\n}\n</code></pre>\n\n<p>I want redigo to do this:</p>\n\n<pre><code>redis 127.0.0.1:6379&gt; SETEX \"mykey\" 600 value\n</code></pre>\n\n<p>I'm wondering how can I acheive this in redigo?</p>\n\n<p>I looked at the docs <a href=\"https://godoc.org/github.com/gomodule/redigo/redis#pkg-examples\" rel=\"nofollow noreferrer\">examples</a> but could not figure out how to do so</p>\n"}, {"tags": ["postgresql", "go", "database-schema"], "comments": [{"owner": {"reputation": 22827, "user_id": 205426, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/fb24c70ec76f0a28e47fc1df1e70dcdf?s=128&d=identicon&r=PG", "display_name": "Woot4Moo", "link": "https://stackoverflow.com/users/205426/woot4moo"}, "edited": false, "score": 1, "creation_date": 1532199913, "post_id": 51459170, "comment_id": 89887872, "body": "jdbc is java, not go"}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "reply_to_user": {"reputation": 22827, "user_id": 205426, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/fb24c70ec76f0a28e47fc1df1e70dcdf?s=128&d=identicon&r=PG", "display_name": "Woot4Moo", "link": "https://stackoverflow.com/users/205426/woot4moo"}, "edited": false, "score": 0, "creation_date": 1532200531, "post_id": 51459170, "comment_id": 89887999, "body": "@Woot4Moo, that I know that&#39;s why I mentioned <i>as per doc</i>; sorry if it was not clear, but I have mentioned the code snippet below I tried adding those <code>currentSchema=myschema</code> to the statement but its not working"}], "answers": [{"comments": [{"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1532249632, "post_id": 51459828, "comment_id": 89895820, "body": "I am using  ` \tdb, err := sql.Open(&quot;postgres&quot;, <code>dbname=</code>+dbName+` user=<code>+username+</code> password=<code>+password+</code> host=<code>+host+</code> sslmode=disable<code>) \tif err != nil { \t\tpanic(&quot;Main db connection failed&quot;) \t}  \tdb.SetMaxIdleConns(40) \tdb.SetMaxOpenConns(160) </code> So there are many parallel connections, I am doubtful or can you explain me will executing this <code>db.Exec(</code>set search_path=&#39;mySchema&#39;<code>)</code> will set schema for every connection?"}, {"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1532261548, "post_id": 51459828, "comment_id": 89898501, "body": "@AbhishekSoni you are writing what I did in a different way. That exec is needed once per connection. Like you need to Open() per connection you need to Exec per db once."}, {"owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1532338713, "post_id": 51459828, "comment_id": 89919620, "body": "I am confused with the functionality of connections but indeed wanted to know that <code>db.Exec(</code>set search_path=&#39;mySchema&#39;<code>)</code> is required <b>once</b> per <i>OPEN</i> and not per connection (as in example i am setting maxConns to 40 so need to execute it 40 times)?"}, {"owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1532339266, "post_id": 51459828, "comment_id": 89919987, "body": "Why wouldn&#39;t you simply test and see?"}, {"owner": {"reputation": 16322, "user_id": 215969, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/4a50a54d4d142661b7b2ac1e6dce80da?s=128&d=identicon&r=PG", "display_name": "Ilia Choly", "link": "https://stackoverflow.com/users/215969/ilia-choly"}, "reply_to_user": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "edited": false, "score": 0, "creation_date": 1550689642, "post_id": 51459828, "comment_id": 96365196, "body": "@AbhishekSoni you should use a transaction"}], "tags": [], "owner": {"reputation": 15219, "user_id": 894977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f18198ad9bdf73fa1d90956f7028254?s=128&d=identicon&r=PG", "display_name": "Cetin Basoz", "link": "https://stackoverflow.com/users/894977/cetin-basoz"}, "is_accepted": false, "score": 3, "last_activity_date": 1532204580, "creation_date": 1532204580, "answer_id": 51459828, "question_id": 51459170, "link": "https://stackoverflow.com/questions/51459170/connect-with-postgresql-schema/51459828#51459828", "title": "Connect with postgreSQL schema", "body": "<p>Set Search_path is right and you do it once. ie:</p>\n\n<pre><code>db, err := sql.Open(\"postgres\",\n    \"host=localhost dbname=Test sslmode=disable user=postgres password=secret\")\nif err != nil {\n   log.Fatal(\"cannot connect ...\")\n}\ndefer db.Close()\ndb.Exec(`set search_path='mySchema'`)\n\nrows, err := db.Query(`select blah,blah2 from myTable`)\n...\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 106, "user_id": 264045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba8a80ee4a003cf76a18bd4f5cdbe562?s=128&d=identicon&r=PG", "display_name": "Mytholog", "link": "https://stackoverflow.com/users/264045/mytholog"}, "is_accepted": true, "score": 7, "last_activity_date": 1532360848, "creation_date": 1532360848, "answer_id": 51482726, "question_id": 51459170, "link": "https://stackoverflow.com/questions/51459170/connect-with-postgresql-schema/51482726#51482726", "title": "Connect with postgreSQL schema", "body": "<p>You should add <code>search_path=myschema</code> to <code>dataSourceName</code></p>\n\n<p>P.S. better use <code>fmt.Sprintf(\"host=%s port=%d dbname=%s user=%s password='%s' sslmode=disable search_path=%s\", ...)</code> instead <code>``+``</code></p>\n"}], "owner": {"reputation": 1217, "user_id": 5066719, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/902c0e0e880e8e5d5395c6872f05fb05?s=128&d=identicon&r=PG&f=1", "display_name": "Abhishek Soni", "link": "https://stackoverflow.com/users/5066719/abhishek-soni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9870, "favorite_count": 0, "accepted_answer_id": 51482726, "answer_count": 2, "score": 10, "last_activity_date": 1594142264, "creation_date": 1532199262, "last_edit_date": 1594142264, "question_id": 51459170, "link": "https://stackoverflow.com/questions/51459170/connect-with-postgresql-schema", "title": "Connect with postgreSQL schema", "body": "<p>I am looking to connect and query to a PostgreSQL. But I only want to connect to a particular <strong><a href=\"https://www.postgresql.org/docs/9.1/static/ddl-schemas.html\" rel=\"noreferrer\">Schema</a></strong>.</p>\n\n<p>As per the doc (<strong>JDBC</strong>) we can use </p>\n\n<pre><code>jdbc:postgresql://localhost:5432/mydatabase?searchpath=myschema\n</code></pre>\n\n<p>or <strong>update</strong> As of 9.4 you can specify the url with the new currentSchema parameter like so:</p>\n\n<pre><code>jdbc:postgresql://localhost:5432/mydatabase?currentSchema=myschema\n</code></pre>\n\n<p>But I am unable to do so with <strong>golang</strong> SQL driver;</p>\n\n<p>As per the documents, we can also use <code>SET search_path TO myschema,public;\n</code> But I only want to declare it for once during initializing but I think this needs to be executed every time for new connection. </p>\n\n<p>Also I am using following code please help me identify the correct parameters to be passed to this in order to only connect with schema </p>\n\n<pre><code>db, err := sql.Open(\"postgres\", `dbname=`+s.settings.Database+\n` user=`+s.settings.Username+` password=`+s.settings.Password+\n` host=`+s.settings.Url+` sslmode=disable`) \n</code></pre>\n\n<p>Adding <code>currentSchema=myschema</code> or <code>searchpath=myschema</code> is not working!</p>\n\n<p>Is there a way I can only connect to a particular database-schema in GO</p>\n"}, {"tags": ["json", "go", "maps", "deep-copy"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532199769, "post_id": 51459083, "comment_id": 89887835, "body": "There&#39;s no need to pass <code>dest</code> as a pointer since you&#39;re just setting entries in the map. I&#39;m confused by <code>((*dest)[key]).(map[string]interface{})</code>, though. You just set that to a <code>map[string]int</code>, so a type assertion to <code>map[string]interface{}</code> will fail. What are you trying to do there?"}, {"owner": {"reputation": 143, "user_id": 8176981, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-UgyZqiahokE/AAAAAAAAAAI/AAAAAAAAAAo/QZlkrLkfOnc/photo.jpg?sz=128", "display_name": "Varun Narayanan", "link": "https://stackoverflow.com/users/8176981/varun-narayanan"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532200630, "post_id": 51459083, "comment_id": 89888021, "body": "@AndySchweig when I don&#39;t type assert I get the following error <code>cannot use &amp;(*dest)[key] (type *interface {}) as type *map[string]interface {} in argument to deepCopyJSON</code>"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532201451, "post_id": 51459083, "comment_id": 89888202, "body": "Type asserting might avert that compiler error, but the assertion will fail at runtime because that value is a <code>map[string]int</code>."}, {"owner": {"reputation": 143, "user_id": 8176981, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-UgyZqiahokE/AAAAAAAAAAI/AAAAAAAAAAo/QZlkrLkfOnc/photo.jpg?sz=128", "display_name": "Varun Narayanan", "link": "https://stackoverflow.com/users/8176981/varun-narayanan"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532202413, "post_id": 51459083, "comment_id": 89888395, "body": "@AndySchweig even with the assertion removed it does not compile. The error is the same as the orginal error plus the type error. <code># cncli&#47;client ..&#47;client&#47;util.go:44:49: cannot take the address of (*dest)[key] ..&#47;client&#47;util.go:44:49: cannot use &amp;(*dest)[key] (type *interface {}) as type *map[string]interface {} in argument to deepCopyJSON </code>"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1532202816, "post_id": 51459083, "comment_id": 89888470, "body": "You have two problems. You can&#39;t take the address of a type assertion, and the type assertion won&#39;t work anyway. First of all, don&#39;t pass that map as a pointer. As I mentioned before, it isn&#39;t necessary. But there&#39;s a more fundamental problem, which is that you&#39;re creating a <code>map[string]int</code> and the function expects a <code>map[string]interface{}</code>. Those are different types. Why is the element type <code>int</code>? Shouldn&#39;t it be <code>interface{}</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 598, "user_id": 9552116, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Coconut", "link": "https://stackoverflow.com/users/9552116/coconut"}, "is_accepted": false, "score": 3, "last_activity_date": 1542017142, "last_edit_date": 1542017142, "creation_date": 1533379056, "answer_id": 51684750, "question_id": 51459083, "link": "https://stackoverflow.com/questions/51459083/deep-copying-maps-in-golang/51684750#51684750", "title": "Deep copying maps in Golang", "body": "<p>I think of 2 solutions.</p>\n\n<p>1) Simply mashal it back, then copy the bytes.</p>\n\n<p>2) Recursive calls as below.</p>\n\n<pre><code>func deepCopyJSON(src map[string]interface{}, dest map[string]interface{}) {\n    for key, value := range src {\n        switch src[key].(type) {\n        case map[string]interface{}:\n            dest[key] = map[string]interface{}{}\n            deepCopyJSON(src[key].(map[string]interface{}), dest[key].(map[string]interface{}))\n        default:\n            dest[key] = value\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/l6W1PD4lppG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/l6W1PD4lppG</a></p>\n"}, {"tags": [], "owner": {"reputation": 143, "user_id": 8176981, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-UgyZqiahokE/AAAAAAAAAAI/AAAAAAAAAAo/QZlkrLkfOnc/photo.jpg?sz=128", "display_name": "Varun Narayanan", "link": "https://stackoverflow.com/users/8176981/varun-narayanan"}, "is_accepted": true, "score": 1, "last_activity_date": 1533383737, "creation_date": 1533383737, "answer_id": 51685325, "question_id": 51459083, "link": "https://stackoverflow.com/questions/51459083/deep-copying-maps-in-golang/51685325#51685325", "title": "Deep copying maps in Golang", "body": "<pre><code>func deepCopyJSON(src map[string]interface{}, dest map[string]interface{}) error {\n    if src == nil {\n        return errors.New(\"src is nil. You cannot read from a nil map\")\n    }\n    if dest == nil {\n        return errors.New(\"dest is nil. You cannot insert to a nil map\")\n    }\n    jsonStr, err := json.Marshal(src)\n    if err != nil {\n        return err\n    }\n    err = json.Unmarshal(jsonStr, &amp;dest)\n    if err != nil {\n        return err\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 8176981, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh5.googleusercontent.com/-UgyZqiahokE/AAAAAAAAAAI/AAAAAAAAAAo/QZlkrLkfOnc/photo.jpg?sz=128", "display_name": "Varun Narayanan", "link": "https://stackoverflow.com/users/8176981/varun-narayanan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4239, "favorite_count": 1, "accepted_answer_id": 51685325, "answer_count": 2, "score": 0, "last_activity_date": 1542017142, "creation_date": 1532198546, "question_id": 51459083, "link": "https://stackoverflow.com/questions/51459083/deep-copying-maps-in-golang", "title": "Deep copying maps in Golang", "body": "<p>From what I understand, maps are reference types in Go. So assignment will do shallow copy. I plan to do a recursive deep copy of Maps in golang. Recursive because I am dealing with a map that holds the unmarshalled contents of a JSON.</p>\n\n<pre><code>func deepCopyJSON(src map[string]interface{}, dest *map[string]interface{}) error {\n    if src == nil || dest == nil {\n        return errors.New(\"src/dest is nil. You cannot insert to a nil map\")\n    }\n    for key, value := range src {\n        if reflect.TypeOf(value).String() != jsonType {\n            (*dest)[key] = value\n        } else {\n            (*dest)[key] = make(map[string]int)\n//Suspect code below causes the error.\n            deepCopyJSON(value.(map[string]interface{}), &amp;(((*dest)[key]).(map[string]interface{})))\n        }\n    }\n    return nil\n}\n</code></pre>\n\n<p>The Error: cannot take the address of (*dest)[key].(map[string]interface {})\nHow do I get around this? Are there other ways to deep maps?</p>\n\n<p>I primer on the internals of map in golang, will also be useful.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1532194790, "post_id": 51457902, "comment_id": 89886572, "body": "Yes: stop ignoring errors from all the functions dealing with that file after opening it. They all return errors, and <code>fmt.Fprintf</code> is no exception."}, {"owner": {"reputation": 8724, "user_id": 1068283, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XZLfw.jpg?s=128&g=1", "display_name": "Michael Hampton", "link": "https://stackoverflow.com/users/1068283/michael-hampton"}, "edited": false, "score": 0, "creation_date": 1532195092, "post_id": 51457902, "comment_id": 89886629, "body": "Not using the <a href=\"https://golang.org/pkg/log/\" rel=\"nofollow noreferrer\"><code>log</code> package</a>."}, {"owner": {"reputation": 73, "user_id": 2592525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf9fd9479f530292dcba81531aafadf0?s=128&d=identicon&r=PG", "display_name": "Tigger", "link": "https://stackoverflow.com/users/2592525/tigger"}, "edited": false, "score": 0, "creation_date": 1532260617, "post_id": 51457902, "comment_id": 89898286, "body": "Thanks, Kostix.  I&#39;m slow responding because I&#39;ve been tending my wounded ego, but you&#39;re correct, of course."}], "answers": [{"tags": [], "owner": {"reputation": 536, "user_id": 3956589, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/39365ac79e46dc67ace5d93a627a068d?s=128&d=identicon&r=PG&f=1", "display_name": "whitespace", "link": "https://stackoverflow.com/users/3956589/whitespace"}, "is_accepted": false, "score": 0, "last_activity_date": 1532420662, "creation_date": 1532420662, "answer_id": 51493877, "question_id": 51457902, "link": "https://stackoverflow.com/questions/51457902/logger-function-fails-in-golang/51493877#51493877", "title": "Logger function fails in Golang", "body": "<p>You are not getting anything in file because you are not opening it with <code>os.WRONLY</code>  or <code>os.RDWR</code>. By default. <code>os.OpenFile</code> returns a buffer with only read permission. You might want to close your file with a <code>defer</code>  in  case the code panics with <code>defer file.Close()</code>. </p>\n"}], "owner": {"reputation": 73, "user_id": 2592525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf9fd9479f530292dcba81531aafadf0?s=128&d=identicon&r=PG", "display_name": "Tigger", "link": "https://stackoverflow.com/users/2592525/tigger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 32, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1532420662, "creation_date": 1532189435, "last_edit_date": 1532202044, "question_id": 51457902, "link": "https://stackoverflow.com/questions/51457902/logger-function-fails-in-golang", "title": "Logger function fails in Golang", "body": "<p>I have what should be a very simple logger function but while the log file is created, nothing is written to it.  I tried several different things but it continues to fail.  The function is</p>\n\n<pre><code>func logger(logname string, message string) {\n    logName := \"../planner/log/\" + logname + \".log\"\n    var file *os.File\n\n    file, err := os.OpenFile(logName, os.O_APPEND|os.O_CREATE, 0755)\n    if err != nil {\n        fmt.Println(\"File\", logName, \"failed with error:\", err)\n    }\n\n    //file.WriteString(message)\n    fmt.Fprintf(file, message)\n    fmt.Println(\"Wrote\", message, \"to\", logName)\n    file.Sync()\n    file.Close()\n\n    test, err := os.Stat(logName)\n    size := test.Size()\n    fmt.Println(\"File size is\", size)\n}\n</code></pre>\n"}, {"tags": ["json", "rest", "go", "content-type", "mux"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1532178002, "post_id": 51456253, "comment_id": 89882090, "body": "<a href=\"https://github.com/gorilla/mux/blob/master/README.md#middleware\" rel=\"nofollow noreferrer\">github.com/gorilla/mux/blob/master/README.md#middleware</a>"}, {"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1532178351, "post_id": 51456253, "comment_id": 89882203, "body": "Thank you @Peter."}], "answers": [{"comments": [{"owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "edited": false, "score": 0, "creation_date": 1532178334, "post_id": 51456342, "comment_id": 89882196, "body": "Works perfectly. Thank you very much."}, {"owner": {"reputation": 111, "user_id": 76522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d01d0b413ba365ed11d82d72cfe1314?s=128&d=identicon&r=PG", "display_name": "tom d", "link": "https://stackoverflow.com/users/76522/tom-d"}, "edited": false, "score": 0, "creation_date": 1558054777, "post_id": 51456342, "comment_id": 98982825, "body": "I&#39;m confused about whether it&#39;s kosher to write to the <code>ResponseWriter</code> here. From the <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">current docs</a>: &quot;Middlewares should write to ResponseWriter if they are going to terminate the request, and they should not write to ResponseWriter if they are not going to terminate it.&quot;"}, {"owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "edited": false, "score": 2, "creation_date": 1558074978, "post_id": 51456342, "comment_id": 98987316, "body": "It doesnt <i>write</i> header. Only <code>WriteHeader</code> method does."}, {"owner": {"reputation": 111, "user_id": 76522, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d01d0b413ba365ed11d82d72cfe1314?s=128&d=identicon&r=PG", "display_name": "tom d", "link": "https://stackoverflow.com/users/76522/tom-d"}, "edited": false, "score": 0, "creation_date": 1558111234, "post_id": 51456342, "comment_id": 99005773, "body": "ah! That explains it. Thanks for the clarification and quick reply."}], "tags": [], "owner": {"reputation": 38307, "user_id": 2057388, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ceef8c04f66cd0e2bd360ef6abc14a81?s=128&d=identicon&r=PG", "display_name": "\u0417\u0435\u043b\u0451\u043d\u044b\u0439", "link": "https://stackoverflow.com/users/2057388/%d0%97%d0%b5%d0%bb%d1%91%d0%bd%d1%8b%d0%b9"}, "is_accepted": true, "score": 60, "last_activity_date": 1532177986, "creation_date": 1532177986, "answer_id": 51456342, "question_id": 51456253, "link": "https://stackoverflow.com/questions/51456253/how-to-set-http-responsewriter-content-type-header-globally-for-all-api-endpoint/51456342#51456342", "title": "How to set http.ResponseWriter Content-Type header globally for all API endpoints?", "body": "<p>You can define <code>middleware</code> for mux router, here is an example:</p>\n\n<pre><code>func main() {\n    port := \":3000\"\n    var router = mux.NewRouter()\n    router.Use(commonMiddleware)\n\n    router.HandleFunc(\"/m/{msg}\", handleMessage).Methods(\"GET\")\n    router.HandleFunc(\"/n/{num}\", handleNumber).Methods(\"GET\")\n    // rest of code goes here\n}\n\nfunc commonMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Add(\"Content-Type\", \"application/json\")\n        next.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>Read more in the <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"noreferrer\">documentation</a></p>\n"}], "owner": {"reputation": 7975, "user_id": 1577357, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9db0054df76cc4b80888ff713527a652?s=128&d=identicon&r=PG", "display_name": "Zulhilmi Zainudin", "link": "https://stackoverflow.com/users/1577357/zulhilmi-zainudin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 25403, "favorite_count": 6, "accepted_answer_id": 51456342, "answer_count": 1, "score": 26, "last_activity_date": 1532177986, "creation_date": 1532177410, "question_id": 51456253, "link": "https://stackoverflow.com/questions/51456253/how-to-set-http-responsewriter-content-type-header-globally-for-all-api-endpoint", "title": "How to set http.ResponseWriter Content-Type header globally for all API endpoints?", "body": "<p>I am new to Go and I'm building a simple API with it now:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"github.com/gorilla/handlers\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    port := \":3000\"\n    var router = mux.NewRouter()\n    router.HandleFunc(\"/m/{msg}\", handleMessage).Methods(\"GET\")\n    router.HandleFunc(\"/n/{num}\", handleNumber).Methods(\"GET\")\n\n    headersOk := handlers.AllowedHeaders([]string{\"Authorization\"})\n    originsOk := handlers.AllowedOrigins([]string{\"*\"})\n    methodsOk := handlers.AllowedMethods([]string{\"GET\", \"POST\", \"OPTIONS\"})\n\n    fmt.Printf(\"Server is running at http://localhost%s\\n\", port)\n    log.Fatal(http.ListenAndServe(port, handlers.CORS(originsOk, headersOk, methodsOk)(router)))\n}\n\nfunc handleMessage(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    message := vars[\"msg\"]\n    response := map[string]string{\"message\": message}\n    w.Header().Set(\"Content-Type\", \"application/json\") // this\n    json.NewEncoder(w).Encode(response)\n}\n\nfunc handleNumber(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    number := vars[\"num\"]\n    response := map[string]string{\"number\": number}\n    w.Header().Set(\"Content-Type\", \"application/json\") // and this\n    json.NewEncoder(w).Encode(response)\n}\n</code></pre>\n\n<p>I feel like it's not clean to keep repeating <code>w.Header().Set(\"Content-Type\", \"application/json\")</code> line in every API function that I have.</p>\n\n<p>So my question here is, does it possible to set that http.ResponseWriter Content-Type header globally for all API functions that I have?</p>\n"}, {"tags": ["opencv", "docker", "go", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1532177185, "creation_date": 1532177185, "answer_id": 51456219, "question_id": 51455801, "link": "https://stackoverflow.com/questions/51455801/issue-when-building-opencv-in-arm-docker-container/51456219#51456219", "title": "Issue when building OPENCV in ARM Docker container", "body": "<p>I guess it was too obvious to see it, I was downloaded the same ZIP two times..</p>\n\n<pre><code>https://github.com/opencv/opencv/archive/3.4.2.zip\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code>https://github.com/opencv/opencv_contrib/archive/3.4.2.zip\n</code></pre>\n"}], "owner": {"reputation": 438, "user_id": 1699865, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/7dfd127ca79430fed151aa1665ac7c84?s=128&d=identicon&r=PG", "display_name": "Elwyn", "link": "https://stackoverflow.com/users/1699865/elwyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 51456219, "answer_count": 1, "score": 0, "last_activity_date": 1532177185, "creation_date": 1532174091, "question_id": 51455801, "link": "https://stackoverflow.com/questions/51455801/issue-when-building-opencv-in-arm-docker-container", "title": "Issue when building OPENCV in ARM Docker container", "body": "<p>I am facing an issue when building OPENCV in ARM Docker container :</p>\n\n<pre><code>-- Configuring incomplete, errors occurred!\nSee also \"/tmp/opencv/opencv-3.4.2/build/CMakeFiles/CMakeOutput.log\".\nSee also \"/tmp/opencv/opencv-3.4.2/build/CMakeFiles/CMakeError.log\".\nThe command '/bin/sh -c cd /tmp/opencv/opencv-3.4.2 &amp;&amp;     mkdir build &amp;&amp;     cd build &amp;&amp;     cmake -D CMAKE_BUILD_TYPE=RELEASE           -D CMAKE_INSTALL_PREFIX=/usr/local           -D OPENCV_EXTRA_MODULES_PATH=/tmp/opencv/opencv_contrib-3.4.2/modules           -D BUILD_DOCS=OFF           -D BUILD_EXAMPLES=OFF           -D BUILD_TESTS=OFF           -D BUILD_PERF_TESTS=OFF           -D BUILD_opencv_java=OFF           -D BUILD_opencv_python=OFF           -D BUILD_opencv_python2=OFF           -D BUILD_opencv_python3=OFF .. &amp;&amp;     make -j1 &amp;&amp;     make install &amp;&amp;     rm -rf /tmp/opencv' returned a non-zero code: 1\n</code></pre>\n\n<p>Here is the Dockerfile that I use :</p>\n\n<pre><code>FROM armhf/ubuntu\nLABEL maintainer=\"Xxxxx XXXX &lt;xxxx.xxxx@xxxx.com&gt;\"\n\n# Dependencies\nRUN apt-get update &amp;&amp; \\ \n    apt-get upgrade -y &amp;&amp; \\ \n    apt-get install -y wget unzip build-essential cmake git libgtk2.0-dev pkg-config libavcodec-dev libavformat-dev libswscale-dev libtbb2 libtbb-dev libjpeg-dev libpng-dev libtiff-dev libdc1394-22-dev\n\n# Download OPENCV\nRUN mkdir -p /tmp/opencv &amp;&amp; \\ \n    cd /tmp/opencv &amp;&amp; \\ \n    wget --show-progress --quiet -O opencv.zip https://github.com/opencv/opencv/archive/3.4.2.zip &amp;&amp; \\ \n    unzip -o -q opencv.zip &amp;&amp; \\ \n    wget --show-progress --quiet -O opencv_contrib.zip https://github.com/opencv/opencv/archive/3.4.2.zip &amp;&amp; \\ \n    unzip -o -q opencv_contrib.zip &amp;&amp; \\ \n    rm opencv.zip opencv_contrib.zip \n\n# Build OPENCV\nRUN cd /tmp/opencv/opencv-3.4.2 &amp;&amp; \\ \n    mkdir build &amp;&amp; \\ \n    cd build &amp;&amp; \\ \n    cmake -D CMAKE_BUILD_TYPE=RELEASE \\\n          -D CMAKE_INSTALL_PREFIX=/usr/local \\ \n          -D OPENCV_EXTRA_MODULES_PATH=/tmp/opencv/opencv_contrib-3.4.2/modules \\ \n          -D BUILD_DOCS=OFF \\ \n          -D BUILD_EXAMPLES=OFF \\ \n          -D BUILD_TESTS=OFF \\ \n          -D BUILD_PERF_TESTS=OFF \\ \n          -D BUILD_opencv_java=OFF \\ \n          -D BUILD_opencv_python=OFF \\ \n          -D BUILD_opencv_python2=OFF \\ \n          -D BUILD_opencv_python3=OFF .. &amp;&amp; \\ \n    make -j1 &amp;&amp; \\ \n    make install &amp;&amp; \\ \n    rm -rf /tmp/opencv\n\nADD go-coop-camera /usr/bin\n\nWORKDIR /usr/bin\n\nEXPOSE 8000\nCMD [ \"/usr/bin/go-coop-camera\", \"--logging\", \"info\" ]\n</code></pre>\n\n<p>Do you see something that could be wrong ?\nI tried to apply this fix : <a href=\"https://github.com/opencv/opencv/issues/6027\" rel=\"nofollow noreferrer\">https://github.com/opencv/opencv/issues/6027</a></p>\n\n<p>But it is not working.</p>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170263, "post_id": 51455209, "comment_id": 89880044, "body": "Did you try adding the header: Content-Type: application/x-www-form-urlencoded?"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170348, "post_id": 51455209, "comment_id": 89880061, "body": "no, I didn&#39;t add that, is it necessary to add one? I will just add one and test it out."}, {"owner": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170440, "post_id": 51455209, "comment_id": 89880079, "body": "Usually form parameters require this header and parsing changes with that, if you use application/json, then it lets you auto-bind to structs, using the x-www-form-urlencoded sets the values as form, i.e: firstname=...&amp;lastname=... and then it is parsed with FormValue / PostForm"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170510, "post_id": 51455209, "comment_id": 89880101, "body": "my current <code>content-type</code> header value looks like this <code>content-type: application&#47;json; charset=UTF-8 application&#47;x-www-form-urlencoded</code>"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170743, "post_id": 51455209, "comment_id": 89880152, "body": "No change, still blank value."}, {"owner": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532170906, "post_id": 51455209, "comment_id": 89880198, "body": "check out the code sample here: <a href=\"https://github.com/kataras/iris/blob/master/_examples/http_request/read-json/main.go\" rel=\"nofollow noreferrer\">github.com/kataras/iris/blob/master/_examples/http_request/&hellip;</a> in MyHandler2 and just bind the request to your object, i.e.: var contact []Contact \terr := ctx.ReadJSON(&amp;contact)"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532171569, "post_id": 51455209, "comment_id": 89880337, "body": "Got this weird error - <code>json: cannot unmarshal string into Go value of type main.Contact</code> , is it because of <code>content-type</code> value as - <code>application&#47;json; charset=UTF-8</code>"}, {"owner": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532171675, "post_id": 51455209, "comment_id": 89880364, "body": "try not &quot;stringifying&quot; your json, instead of JSON.stringify(jQuery(&#39;#contact-form&#39;).serializeFormJSON()) just do this: jQuery(&#39;#contact-form&#39;).serializeFormJSON()"}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "reply_to_user": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "edited": false, "score": 0, "creation_date": 1532171820, "post_id": 51455209, "comment_id": 89880420, "body": "wow, @unkgd you are the man, please post this as an answer, I will mark it as solved. Thanks a lot"}], "answers": [{"tags": [], "owner": {"reputation": 641, "user_id": 5351763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f201d9a5791c609342b0a31b2a112066?s=128&d=identicon&r=PG&f=1", "display_name": "unkgd", "link": "https://stackoverflow.com/users/5351763/unkgd"}, "is_accepted": true, "score": 1, "last_activity_date": 1532171955, "creation_date": 1532171955, "answer_id": 51455528, "question_id": 51455209, "link": "https://stackoverflow.com/questions/51455209/reading-json-form-data-golang/51455528#51455528", "title": "Reading Json Form data golang", "body": "<p>One the one hand, you are sending a JSON to the server, but when fetching the parameters you are fetching them as \"application/x-www-form-urlencoded\", first, send the JSON parameters as JSON and not as string, remove the stringifying, i.e:</p>\n\n<p>instead of:</p>\n\n<pre><code>JSON.stringify(jQuery('#contact-form').serializeFormJSON())\n</code></pre>\n\n<p>do:</p>\n\n<pre><code>jQuery('#contact-form').serializeFormJSON()\n</code></pre>\n\n<p>and in your Go file, bind it to your object:</p>\n\n<pre><code>var contact []Contact \nerr := ctx.ReadJSON(&amp;contact) \n</code></pre>\n\n<p>good luck :)</p>\n"}], "owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1589, "favorite_count": 0, "accepted_answer_id": 51455528, "answer_count": 1, "score": -1, "last_activity_date": 1532171955, "creation_date": 1532169331, "question_id": 51455209, "link": "https://stackoverflow.com/questions/51455209/reading-json-form-data-golang", "title": "Reading Json Form data golang", "body": "<p>I am sending form data in JSON &amp; serialize format to golang server using ajax. I am not able to read those data.</p>\n\n<p>I am using <code>kataras/iris</code> golang framework.</p>\n\n<p>Below is my code -</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>(function ($) {\r\n    $.fn.serializeFormJSON = function () {\r\n        var o = {};\r\n        var a = this.serializeArray();\r\n        $.each(a, function () {\r\n            if (o[this.name]) {\r\n                if (!o[this.name].push) {\r\n                    o[this.name] = [o[this.name]];\r\n                }\r\n                o[this.name].push(this.value || '');\r\n            } else {\r\n                o[this.name] = this.value || '';\r\n            }\r\n        });\r\n        return o;\r\n    };\r\n})(jQuery);\r\n\r\nvar Contact = {\r\n    sendMessage: function() {\r\n      return m.request({\r\n          method: \"POST\",\r\n          url: \"/send/message\",\r\n          data: JSON.stringify(jQuery('#contact-form').serializeFormJSON()),\r\n          withCredentials: true,\r\n          headers: {\r\n              'X-CSRF-Token': 'token_here'\r\n          }\r\n      })\r\n    }\r\n}</code></pre>\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;!-- Data looks like below, what is sent --&gt;\r\n\"{\\\"first_name\\\":\\\"SDSDFSJ\\\",\\\"csrf.Token\\\":\\\"FjtWs7UFqC4mPlZU\\\",\\\"last_name\\\":\\\"KJDHKFSDJFH\\\",\\\"email\\\":\\\"DJFHKSDJFH@KJHFSF.COM\\\"}\"</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>And I am trying to fetch the data from server using below code - </p>\n\n<pre><code>// Contact form\ntype Contact struct {\n    FirstName string `json:\"first_name\"`\n    LastName  string `json:\"last_name\"`\n    Email     string `json:\"email\"`\n}\n\ncontact := Contact{}\ncontact.FirstName = ctx.FormValue(\"first_name\")\ncontact.LastName = ctx.FormValue(\"last_name\")\ncontact.Email = ctx.FormValue(\"email\")\nctx.Writef(\"%v\", ctx.ReadForm(contact))\n</code></pre>\n\n<p>My all data is blank, How to grab the data? I am using <a href=\"https://github.com/kataras/iris\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris</a> golang framework.</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1532180267, "post_id": 51455130, "comment_id": 89882699, "body": "If you think of MongoDB as a drop in replacement for  RDBMS, you are going to run into problems. Taking your existing models and use them in MongoDB has a good chance of failing. In SQL, you try to figure out how to answer your questions based on relatively rigid modelling. With NoSQL in general and MongoDB in particular, you model your data so that your questions can be answered in the most efficient way. Subtle, but important difference."}, {"owner": {"reputation": 75, "user_id": 1638680, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3daa6d9e1fd176087a06f2bac4475895?s=128&d=identicon&r=PG", "display_name": "dgm", "link": "https://stackoverflow.com/users/1638680/dgm"}, "edited": false, "score": 0, "creation_date": 1532265306, "post_id": 51455130, "comment_id": 89899479, "body": "Could we have a sample of your stored data, not just what returns from the call?"}], "answers": [{"comments": [{"owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "edited": false, "score": 1, "creation_date": 1532169452, "post_id": 51455168, "comment_id": 89879814, "body": "It will be return same output."}, {"owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "reply_to_user": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "edited": false, "score": 0, "creation_date": 1532171309, "post_id": 51455168, "comment_id": 89880285, "body": "try <code>map[string]interface{}</code> instead of author type. lets make sure unmarshalling is the problem here"}], "tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1532168950, "creation_date": 1532168950, "answer_id": 51455168, "question_id": 51455130, "link": "https://stackoverflow.com/questions/51455130/get-inside-struct-values/51455168#51455168", "title": "Get inside struct values", "body": "<p>change line:</p>\n\n<pre><code>Author Author `bson:\"inline\"\n</code></pre>\n\n<p>to </p>\n\n<pre><code>Author Author `bson:\"Author\"`\n</code></pre>\n"}], "owner": {"reputation": 105, "user_id": 7324602, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b3f3cfaaef5f110bbf4d2d9140e905b5?s=128&d=identicon&r=PG&f=1", "display_name": "Udayakumar", "link": "https://stackoverflow.com/users/7324602/udayakumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 93, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1532178278, "creation_date": 1532168675, "last_edit_date": 1532178278, "question_id": 51455130, "link": "https://stackoverflow.com/questions/51455130/get-inside-struct-values", "title": "Get inside struct values", "body": "<p>In this <a href=\"https://github.com/bxcodec/go-clean-arch\" rel=\"nofollow noreferrer\">example</a>, I changed the <code>Sql driver</code> to <code>mgo</code>, I got some confusion. Here, How can I access the inside struct value? like nested struct.</p>\n\n<p>I have two struct, </p>\n\n<p><strong>Author</strong></p>\n\n<pre><code>type Author struct {\n    ID        string `bson:\"id\"`\n    Name      string `bson:\"name\"`\n    Timestamp time.Time\n}\n</code></pre>\n\n<p><strong>Article</strong></p>\n\n<pre><code>type Article struct {\n    ID        bson.ObjectId `bson:\"_id,omitempty\"`\n    Title     string        `bson:\"title\"`\n    Content   string        `bson:\"content\"`\n    Author    Author        `bson:\"inline\"`\n    Timestamp time.Time\n}\n</code></pre>\n\n<p><strong>Function</strong></p>\n\n<pre><code>func (m *mgoArticleRepository) FindAll() ([]*models.Article, error) {\n    result := make([]*models.Article, 0)\n    sessionCopy := m.Conn.Copy()\n    defer sessionCopy.Close()\n    collection := sessionCopy.DB(DBNAME).C(COLLECTION)\n    err := collection.Find(nil).All(&amp;result)\n    return result, err\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<p>Author object return empty (I have data in mongoDB)</p>\n\n<pre><code>[\n    {\n        \"ID\":\"5b4f27c187a9e40828422cca\",\n        \"Title\":\"Makan Ayam\",\n        \"Content\":\"Sample values One\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    },\n    {\n        \"ID\":\"5b4f27c187a9e40828422ccb\",\n        \"Title\":\"Makan Ikan\",\n        \"Content\":\"Sample values Two\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    },\n    {\n        \"ID\":\"5b4f27c187a9e40828422ccc\",\n        \"Title\":\"Makan Sayur\",\n        \"Content\":\"Sample values Three\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    },\n    {\n        \"ID\":\"5b4f27c187a9e40828422ccd\",\n        \"Title\":\"Makan Daging\",\n        \"Content\":\"Sample values Four\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    },\n    {\n        \"ID\":\"5b4f27c187a9e40828422cce\",\n        \"Title\":\"Makan Indomie\",\n        \"Content\":\"Sample values Five\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    },\n    {\n        \"ID\":\"5b4f27c187a9e40828422ccf\",\n        \"Title\":\"Makan Soto\",\n        \"Content\":\"Sample values Six\",\n        \"Author\":{\n            \"ID\":\"\",\n            \"Name\":\"\",\n            \"Timestamp\":\"0001-01-01T00:00:00Z\"\n        },\n        \"Timestamp\":\"0001-01-01T00:00:00Z\"\n    }\n  ]\n</code></pre>\n\n<p>Here, How can I make the relationship for both structs? Thanks.</p>\n"}, {"tags": ["http", "go", "request", "authorization"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1532138907, "post_id": 51452148, "comment_id": 89874460, "body": "possible tip <a href=\"https://stackoverflow.com/questions/40338711/not-able-to-pass-bearer-token-in-headers-of-a-get-request-in-golang\" title=\"not able to pass bearer token in headers of a get request in golang\">stackoverflow.com/questions/40338711/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 164, "user_id": 1957835, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/65d3b38093aa7662cbe0cce12e0d62c4?s=128&d=identicon&r=PG", "display_name": "ahmetlutfu", "link": "https://stackoverflow.com/users/1957835/ahmetlutfu"}, "edited": false, "score": 1, "creation_date": 1597575342, "post_id": 51453196, "comment_id": 112172157, "body": "you should close resp.Body."}], "tags": [], "owner": {"reputation": 8884, "user_id": 5821354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qc8o0.jpg?s=128&g=1", "display_name": "Himanshu", "link": "https://stackoverflow.com/users/5821354/himanshu"}, "is_accepted": false, "score": 34, "last_activity_date": 1613350428, "last_edit_date": 1613350428, "creation_date": 1532151941, "answer_id": 51453196, "question_id": 51452148, "link": "https://stackoverflow.com/questions/51452148/how-can-i-make-a-request-with-a-bearer-token-in-go/51453196#51453196", "title": "How can I make a request with a bearer token in Go", "body": "<p>For control over HTTP client headers, redirect policy, and other settings, create a Client:</p>\n<pre><code>package main\n\nimport (\n    &quot;io/ioutil&quot;\n    &quot;log&quot;\n    &quot;net/http&quot;\n)\n\nfunc main() {\n    url := &quot;https://api.globalcode.com.br/v1/publico/eventos&quot;\n\n    // Create a Bearer string by appending string access token\n    var bearer = &quot;Bearer &quot; + &lt;ACCESS TOKEN HERE&gt;\n\n    // Create a new request using http\n    req, err := http.NewRequest(&quot;GET&quot;, url, nil)\n\n    // add authorization header to the req\n    req.Header.Add(&quot;Authorization&quot;, bearer)\n\n    // Send req using http Client\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Println(&quot;Error on response.\\n[ERROR] -&quot;, err)\n    }\n    defer resp.Body.Close()\n\n    body, err := ioutil.ReadAll(resp.Body)\n    if err != nil {\n        log.Println(&quot;Error while reading the response bytes:&quot;, err)\n    }\n    log.Println(string([]byte(body)))\n}\n</code></pre>\n<blockquote>\n<p>The Client's Transport typically has internal state (cached TCP\nconnections), so Clients should be reused instead of created as\nneeded. Clients are safe for concurrent use by multiple goroutines.</p>\n<p>A Client is higher-level than a RoundTripper (such as Transport) and\nadditionally handles HTTP details such as cookies and redirects.</p>\n</blockquote>\n<p>For more information on <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">Client and Transport</a> check golang spec for net/http package</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11321613, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-_kbF83DtRJ4/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdZHTVHGWHI8mAJvxElHldzUXsnsQ/mo/photo.jpg?sz=128", "display_name": "Philip Krause", "link": "https://stackoverflow.com/users/11321613/philip-krause"}, "is_accepted": false, "score": 1, "last_activity_date": 1571687082, "creation_date": 1571687082, "answer_id": 58493142, "question_id": 51452148, "link": "https://stackoverflow.com/questions/51452148/how-can-i-make-a-request-with-a-bearer-token-in-go/58493142#58493142", "title": "How can I make a request with a bearer token in Go", "body": "<p>I had to add a client.CheckRedirect Function(seen below) in order to pass the Bearer token to the API. </p>\n\n<pre class=\"lang-go prettyprint-override\"><code>bearer := \"Bearer \" + token\n\n    req, err := http.NewRequest(\"GET\", url, bytes.NewBuffer(nil))\n    req.Header.Set(\"Authorization\", bearer)\n    req.Header.Add(\"Accept\", \"application/json\")\n\n    client := &amp;http.Client{}\n\n\n    client.CheckRedirect = func(req *http.Request, via []*http.Request) error {\n        for key, val := range via[0].Header {\n            req.Header[key] = val\n        }\n        return err\n    }\n    resp, err := client.Do(req)\n    if err != nil {\n        log.Println(\"Error on response.\\n[ERRO] -\", err)\n    } else {\n        defer resp.Body.Close()\n        data, _ := ioutil.ReadAll(resp.Body)\n        fmt.Println(string(data))\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 1, "last_activity_date": 1571760327, "last_edit_date": 1571760327, "creation_date": 1571747605, "answer_id": 58504415, "question_id": 51452148, "link": "https://stackoverflow.com/questions/51452148/how-can-i-make-a-request-with-a-bearer-token-in-go/58504415#58504415", "title": "How can I make a request with a bearer token in Go", "body": "<p>I made a super-little-basic library for execute basic request like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\nimport (\n     request \"github.com/alessiosavi/Requests\"\n)\n\nfunc main(){\n    // Create a key-value list of headers\n    headers := request.CreateHeaderList(`Accept`, `application/json`, \"Authorization\", \"Bearer \"+auth.IAMToken)\n    resp :=request.SendRequest(`http://your_site.com`, `GET`, headers, nil))\n}\n</code></pre>\n\n<p>Here you can find the <code>request</code> implementation:<br>\n<a href=\"https://github.com/alessiosavi/Requests/blob/e7ca66bde738b6224fba2b6f146a8dbee67d3323/Requests.go\" rel=\"nofollow noreferrer\">https://github.com/alessiosavi/Requests/blob/e7ca66bde738b6224fba2b6f146a8dbee67d3323/Requests.go</a></p>\n\n<p>Here you can find how i use the library for Bearer Auth and other auth type:<br>\n<a href=\"https://github.com/alessiosavi/GoCloudant/blob/a8ad3a7990f04ea728bb327d6faea6af3e5455ca/cloudant.go\" rel=\"nofollow noreferrer\">https://github.com/alessiosavi/GoCloudant/blob/a8ad3a7990f04ea728bb327d6faea6af3e5455ca/cloudant.go</a></p>\n"}], "owner": {"reputation": 327, "user_id": 9579597, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/t3Vc0.jpg?s=128&g=1", "display_name": "Matheus Alc&#226;ntara", "link": "https://stackoverflow.com/users/9579597/matheus-alc%c3%a2ntara"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34047, "favorite_count": 4, "answer_count": 3, "score": 21, "last_activity_date": 1613350428, "creation_date": 1532137905, "last_edit_date": 1550117928, "question_id": 51452148, "link": "https://stackoverflow.com/questions/51452148/how-can-i-make-a-request-with-a-bearer-token-in-go", "title": "How can I make a request with a bearer token in Go", "body": "<p>I need to make a GET request to an API with a bearer token in the authorization request. How can I do this in Go? I have the following code, but I haven't had success.</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    url := \"https://api.globalcode.com.br/v1/publico/eventos\"\n\n    resp, err := http.Get(url)\n    resp.Header.Add(\"Bearer\", \"token\")\n    if err != nil {\n        log.Println(\"Erro ao realizar request.\\n[ERRO] -\", err)\n    }\n\n    body, _ := ioutil.ReadAll(resp.Body)\n    log.Println(string([]byte(body)))\n}\n</code></pre>\n"}, {"tags": ["rest", "web-services", "go", "iis", "tomcat7"], "comments": [{"owner": {"reputation": 52302, "user_id": 11182, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yfpsb.jpg?s=128&g=1", "display_name": "Lex Li", "link": "https://stackoverflow.com/users/11182/lex-li"}, "edited": false, "score": 0, "creation_date": 1532147723, "post_id": 51451625, "comment_id": 89875456, "body": "Learn HttpPlatformHandler."}], "answers": [{"comments": [{"owner": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "edited": false, "score": 0, "creation_date": 1532366524, "post_id": 51458245, "comment_id": 89937293, "body": "Thank you for the extended response.  For the HTML approach, (showing my ignorance here) do I need proxying?  The server is isolated from the internet and the domain it&#39;s on can only be accessed via VPN."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "edited": false, "score": 0, "creation_date": 1532450908, "post_id": 51458245, "comment_id": 89976330, "body": "Please understand that the proxying is not about security\u2014it&#39;s about making &quot;front-end&quot; server (that one which serves all incoming requests) &quot;delegate&quot; some of the incoming requests to some other server. That&#39;s how I understood the initial task. If, for some reason, you just got fixated on that you need a web server (be it IIS or nginx) to somehow make a program written in Go serve HTTP requests, then you&#39;re simply wrong: a HTTP-serving program written in Go can\u2014and usually is\u2014completely free-standing and self-sufficient."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "edited": false, "score": 0, "creation_date": 1532451013, "post_id": 51458245, "comment_id": 89976389, "body": "That os you just make it somehow configurable (from environment or the registry or a config file or command-line parameters or a combination of some of the above) and run telling it to which address and port to listen on, and then make your site(s) send HTTP requests to it; that&#39;s all. You do not need IIS or any other web server to somehow &quot;run your Go code&quot;."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1532191992, "creation_date": 1532191992, "answer_id": 51458245, "question_id": 51451625, "link": "https://stackoverflow.com/questions/51451625/is-it-possible-to-run-a-golang-rest-web-app-on-an-internal-private-iis-server/51458245#51458245", "title": "Is it possible to run a Golang REST web app on an internal (private) IIS server?", "body": "<p>That's not really about Go, but still there exist at least two solutions I can think of:</p>\n\n<ul>\n<li><p>Reverse proxying of HTTP requests.</p>\n\n<ol>\n<li><p>Write a plain Go server serving requests via HTTP.</p>\n\n<p>Maybe turn it into a proper Windows service using <a href=\"https://godoc.org/golang.org/x/sys/windows/svc\" rel=\"nofollow noreferrer\"><code>golang.org/x/sys/windows/svc</code></a>.</p></li>\n<li><p>Deploy it.</p>\n\n<p>If it's to be hosted on the same machine which runs IIS, then it's fine to make it listen on <code>localhost</code> only. Note that it will need a dedicated TCP port to listen on, and you'll need to make it possible for your server to be somehow configurable in this regard.</p></li>\n<li>Set up <a href=\"https://blogs.msdn.microsoft.com/friis/2016/08/25/setup-iis-with-url-rewrite-as-a-reverse-proxy-for-real-world-apps/\" rel=\"nofollow noreferrer\">reverse proxying in your IIS</a> so that it forwards requests coming to whatever (part of an) URL you want to the Go server.</li>\n</ol></li>\n<li><p>Use FastCGI.</p>\n\n<p>Go supports serving requests over the FastCGI\nprotocol <a href=\"https://golang.org/pkg/net/http/fcgi/\" rel=\"nofollow noreferrer\">by means of its standard library</a>,\nand <a href=\"https://www.iis.net/downloads/microsoft/fastcgi-for-iis\" rel=\"nofollow noreferrer\">IIS suports FastCGI workers</a>.</p>\n\n<p>So it's possible to (re-)write your Go server to use FastCGI\ninstead of HTTP and then hook it into IIS via this protocol.</p></li>\n</ul>\n\n<p>The pros and cons of these solutions\u2014as I view them\u2014are:</p>\n\n<ul>\n<li><p>Serving over plain HTTP is more familiar to a developer and\nmakes the server more \"portable\"\u2014in the sense it will be easier to change its deployment scheme if/when you'll need it.\nRight to making it available to the Internet directly.</p>\n\n<p>Conversely, with FastCGI, you'll always need a FastCGI host as a \"middleware\".</p></li>\n<li><p>There were rumors that HTTP code is more fine-tuned in terms\nof performance than that of FastCGI.</p>\n\n<p>Still, this only will be of concern for reasonably hard-core loads.</p></li>\n<li><p>One possible upside of FastCGI over HTTP is that it can\nbe served over pipes rather than TCP. For instance, you might\nget it served over named pipes as it's supported by IIS's FastCGI module and there exists <a href=\"https://stackoverflow.com/a/39407943/720999\">3rd-party packages for Go implementing support for them</a>\n(even including one from Microsoft\u00ae).</p>\n\n<p>The upside of this is that pipes are beleived to incur lesser overhead for data transfer (basically it's just shoveling bytes between in-kernel buffers belonging to two processes instead of pushing them through the whole TCP/IP stack), and using pipes frees you from the need of dedicating a TCP port to the Go server.</p>\n\n<p>Still, I have no personal experience with this kind of setup and its performance trade-offs.</p></li>\n</ul>\n"}], "owner": {"reputation": 608, "user_id": 1368561, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/fHj5Q.png?s=128&g=1", "display_name": "mnemotronic", "link": "https://stackoverflow.com/users/1368561/mnemotronic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1003, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1532191992, "creation_date": 1532130487, "question_id": 51451625, "link": "https://stackoverflow.com/questions/51451625/is-it-possible-to-run-a-golang-rest-web-app-on-an-internal-private-iis-server", "title": "Is it possible to run a Golang REST web app on an internal (private) IIS server?", "body": "<p>I would like to create a web service with GoLang that runs either on IIS (7, 8 or 10) or under Tomcat 7.0.  We have multiple environments, each with multiple servers, all being Windows 2008 R2, 2012 or 2016.  All servers are private (10.x).  My goal is to add some REST services to a <a href=\"https://www.microfocus.com/products/solutions-business-manager/#\" rel=\"nofollow noreferrer\">COTS product</a> that uses both IIS and Tomcat.  I'd prefer to avoid gluing nginx or something else onto either server at the risk of impairing the COTS product or having their tech support people not answer the phone.  Again .. the servers are only accessible via corporate VPN and are not public internet-facing.</p>\n\n<p>Which server would offer the easiest path to get something working -- Tomcat or IIS?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3226, "user_id": 1964690, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/120d7c6980b552a124f79016300ca954?s=128&d=identicon&r=PG", "display_name": "jrefior", "link": "https://stackoverflow.com/users/1964690/jrefior"}, "is_accepted": true, "score": 3, "last_activity_date": 1532142645, "last_edit_date": 1532142645, "creation_date": 1532142218, "answer_id": 51452436, "question_id": 51450987, "link": "https://stackoverflow.com/questions/51450987/xml-unmarshal-with-dynamic-type-empty-interface-in-go/51452436#51452436", "title": "XML Unmarshal with dynamic type (empty interface) in Go", "body": "<p>Per the <code>encoding/xml</code> package documentation:</p>\n\n<blockquote>\n  <p>If the XML element contains a sub-element that hasn't matched any\n  of the above rules and the struct has a field with tag <code>\",any\"</code>,\n  unmarshal maps the sub-element to that struct field.</p>\n</blockquote>\n\n<p>One small update to your code makes it work as you expected:</p>\n\n<p>Add the <code>xml:\",any\"</code> tag to your <code>Other</code> field definition.</p>\n\n<p>To clean up the code, I would also remove the <code>Any</code> type, you don't need it.  You can change the <code>Other</code> field definition to type <code>interface{}</code> with tag <code>xml:\",any\"</code> and accomplish the same thing.</p>\n\n<p>Like so:</p>\n\n<pre><code>Other interface{} `xml:\",any\"`\n</code></pre>\n\n<p>Execute and see the \"1000\" captured.</p>\n\n<p>I suggest updating your question to include your code directly to make it easier for people to find/search/read your question.  Having the Go playground link as well is also useful so readers can quickly run/tweak/test the example.</p>\n"}], "owner": {"reputation": 59, "user_id": 10113045, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/942799f8caa6bec9e17828593d5abdec?s=128&d=identicon&r=PG&f=1", "display_name": "J. Carl", "link": "https://stackoverflow.com/users/10113045/j-carl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1094, "favorite_count": 1, "accepted_answer_id": 51452436, "answer_count": 1, "score": 2, "last_activity_date": 1575284875, "creation_date": 1532124519, "last_edit_date": 1575284875, "question_id": 51450987, "link": "https://stackoverflow.com/questions/51450987/xml-unmarshal-with-dynamic-type-empty-interface-in-go", "title": "XML Unmarshal with dynamic type (empty interface) in Go", "body": "<p>I need to parse an XML message that has a dynamic element, so I have used an element of type <code>interface{}</code> to represent it in my Message struct. </p>\n\n<p>Once I know the type of this dynamic element (at runtime) I initialise a message struct and then try to unmarshal the XML message. However, the contents of the dynamic element are not unmarshalled.</p>\n\n<p>Here is a Go Playground with what I'm trying to achieve, with comments and the actual vs expected outputs: <a href=\"https://play.golang.org/p/eKVetUPmVI2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eKVetUPmVI2</a></p>\n\n<p>I tried several variations but can't get the unmarshalling to work as expected. Can anyone help me to understand why this behaviour and how to make it work? Thanks in advance.</p>\n\n<p>Code (in case the Go Playground link breaks one day):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"encoding/xml\"\n\n// XML root\ntype Message struct {\n    XMLName   xml.Name  `xml:\"message\"`\n    Operation Operation `xml:\"operation\"`\n}\n\n// An Operation can contain either a Create or an Update element\ntype Operation struct {\n    Create *Create `xml:\"create\"`\n    Update *Update `xml:\"update\"`\n}\n\n// Doesn't matter...\ntype Create struct{}\n\n// Update contains a Color element or Any other element (we only know its type during runtime)\ntype Update struct {\n    Color *Color `xml:\"color\"`\n    Other Any\n}\n\n// Doesn't matter...\ntype Color struct{}\n\ntype Any interface{}\n\nvar xmlStr = []byte(`&lt;message&gt;\n    &lt;operation&gt;\n        &lt;update&gt;\n            &lt;size&gt;\n                &lt;width&gt;1000&lt;/width&gt;\n            &lt;/size&gt;\n        &lt;/update&gt;\n    &lt;/operation&gt;\n&lt;/message&gt;`)\n\nfunc main() {\n    // At this point we already know what to expect to receive in Other, so we can declare a struct for its content (Size)\n    type Size struct {\n        XMLName xml.Name `xml:\"size\"`\n        Width   string   `xml:\"width\"`\n    }\n\n    // Unmarshal\n    msg := &amp;Message{\n        Operation: Operation{\n            Update: &amp;Update{\n                Other: &amp;Size{}, // Here I'm setting Other to Size, so I would expect Go to unmarshal the &lt;size&gt; contents into it\n            },\n        },\n    }\n    if err := xml.Unmarshal(xmlStr, msg); err != nil {\n        fmt.Println(err)\n    }\n\n    // Marshal again\n    b, err := xml.MarshalIndent(msg, \"\", \"    \")\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"expected:\\n\\n%s\\n\\n\", xmlStr)\n    fmt.Printf(\"actual:\\n\\n%s\", string(b))\n}\n</code></pre>\n"}, {"tags": ["go", "go-reflect"], "comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532242471, "post_id": 51450864, "comment_id": 89894369, "body": "I would suggest neither to use reflection, nor interface{}. Use concrete types for your concrete problem. That will make it much easier, not only for you to write it but for you to read it in three weeks as well."}, {"owner": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "reply_to_user": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532461092, "post_id": 51450864, "comment_id": 89981651, "body": "Thanks gonutz, could you give me an example or go playground"}, {"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532461749, "post_id": 51450864, "comment_id": 89981962, "body": "I do not even know what your concrete problem is, please elaborate on <b>why</b> you want to do this."}], "owner": {"reputation": 759, "user_id": 5112445, "user_type": "registered", "accept_rate": 83, "profile_image": "https://graph.facebook.com/1001121649919771/picture?type=large", "display_name": "Summer Ji", "link": "https://stackoverflow.com/users/5112445/summer-ji"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 50, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1532123734, "creation_date": 1532123734, "question_id": 51450864, "link": "https://stackoverflow.com/questions/51450864/using-a-map-which-store-struct-field-name-and-type-to-recover-go-struct", "title": "using a map which store struct field name and type to recover Go struct", "body": "<p>Playground for my problem: <a href=\"https://play.golang.org/p/rVwEaxpkJGL\" rel=\"nofollow noreferrer\">https://play.golang.org/p/rVwEaxpkJGL</a></p>\n\n<p>I have struct like</p>\n\n<pre><code>type SimpleBbInput struct {\n  MyInput  struct {\n     Num struct {\n        val int\n     } \n  } \n  HisInput string\n  HerInput uint8 \n}\n</code></pre>\n\n<p>I will store the field name and type in a map[string]interface{}, result like</p>\n\n<pre><code>map[HerInput:uint8 MyInput:map[Num:map[val:int]] HisInput:string]\n</code></pre>\n\n<p>My question is how to using this map to get back SimpleBbInput without knowing this struct.</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1532117044, "post_id": 51449606, "comment_id": 89869723, "body": "you use <code>defer</code>, if you are in loop it won t work. The code provided is insufficient to check for it."}, {"owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1532117762, "post_id": 51449606, "comment_id": 89869978, "body": "I&#39;ve added the beginning of the loop. Should I move defer outside the loop ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1532117894, "post_id": 51449606, "comment_id": 89870019, "body": "<code>defer</code> executes when the function returns, and you&#39;re going to run out of FDs before the function returns. You can&#39;t defer outside the loop (how would you?), you need to close the files in the loop. See <a href=\"https://stackoverflow.com/questions/24720097/golang-defer-behavior\" title=\"golang defer behavior\">stackoverflow.com/questions/24720097/golang-defer-behavior</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1532118497, "post_id": 51449606, "comment_id": 89870273, "body": "you could move the body loop into a function, within that function you can make use of defer as presented in the original code. if you use inline function take care to variable shadowing (<a href=\"http://oyvindsk.com/writing/common-golang-mistakes-1\" rel=\"nofollow noreferrer\">oyvindsk.com/writing/common-golang-mistakes-1</a>)"}], "answers": [{"comments": [{"owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "edited": false, "score": 0, "creation_date": 1532242807, "post_id": 51450113, "comment_id": 89894435, "body": "If there are any errors before you .Close() the file, Close will not be called. That is why you typocally use defer to close things. In your case I would simple add a call to an anonymous func inside the loop instead."}], "tags": [], "owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "is_accepted": true, "score": -3, "last_activity_date": 1532119436, "creation_date": 1532119436, "answer_id": 51450113, "question_id": 51449606, "link": "https://stackoverflow.com/questions/51449606/too-many-open-files-with-os-create/51450113#51450113", "title": "&quot;too many open files&quot; with os.Create", "body": "<p>ok, i got it, changed <code>defer w.Close()</code> to <code>w.Close()</code> and moved it after </p>\n\n<pre><code>png := vgimg.PngCanvas{Canvas: img}\nif _, err := png.WriteTo(w); err != nil {\n      panic(err)\n}\n</code></pre>\n\n<p>I'm now above 10'000 images and running...</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 1, "last_activity_date": 1532139988, "last_edit_date": 1532139988, "creation_date": 1532139205, "answer_id": 51452247, "question_id": 51449606, "link": "https://stackoverflow.com/questions/51449606/too-many-open-files-with-os-create/51452247#51452247", "title": "&quot;too many open files&quot; with os.Create", "body": "<blockquote>\n  <p><a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">The Go Programming Language Specification</a></p>\n  \n  <p><a href=\"https://golang.org/ref/spec#Defer_statements\" rel=\"nofollow noreferrer\">Defer statements</a></p>\n  \n  <p>A \"defer\" statement invokes a function whose execution is deferred to\n  the moment the surrounding function returns, either because the\n  surrounding function executed a return statement, reached the end of\n  its function body, or because the corresponding goroutine is\n  panicking.</p>\n\n<pre><code>DeferStmt = \"defer\" Expression .\n</code></pre>\n  \n  <p>The expression must be a function or method call; it cannot be\n  parenthesized. Calls of built-in functions are restricted as for\n  expression statements.</p>\n  \n  <p>Each time a \"defer\" statement executes, the function value and\n  parameters to the call are evaluated as usual and saved anew but the\n  actual function is not invoked. Instead, deferred functions are\n  invoked immediately before the surrounding function returns, in the\n  reverse order they were deferred. If a deferred function value\n  evaluates to nil, execution panics when the function is invoked, not\n  when the \"defer\" statement is executed.</p>\n</blockquote>\n\n<hr>\n\n<p>In other words, if you are processing files in a loop, put the processing for a single file in a separate function to pair the <code>Open</code> with the <code>defer Close()</code>. This avoids the \"too many open files\" error.</p>\n\n<p>For example, use a file processing structure like this to guarantee each file is closed immediately after use.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\n// process single file\nfunc processFile(name string) error {\n    f, err := os.Open(name)\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n    fi, err := f.Stat()\n    if err != nil {\n        return err\n    }\n    fmt.Println(fi.Name(), fi.Size())\n    return nil\n}\n\nfunc main() {\n    wd, err := os.Getwd()\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    fis, err := ioutil.ReadDir(wd)\n    if err != nil {\n        fmt.Fprintln(os.Stderr, err)\n        return\n    }\n    // process all files\n    for _, fi := range fis {\n        processFile(fi.Name())\n        if err != nil {\n            fmt.Fprintln(os.Stderr, err)\n        }\n    }\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/FrBWqlMOzaS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FrBWqlMOzaS</a></p>\n\n<p>Output:</p>\n\n<pre><code>dev 1644\netc 1644\ntmp 548\nusr 822\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3592, "user_id": 6276385, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/89c7b071a5c25c2f6ccc6f1f41bdb2e3?s=128&d=identicon&r=PG&f=1", "display_name": "gonutz", "link": "https://stackoverflow.com/users/6276385/gonutz"}, "is_accepted": false, "score": 1, "last_activity_date": 1532290476, "last_edit_date": 1532290476, "creation_date": 1532243260, "answer_id": 51462820, "question_id": 51449606, "link": "https://stackoverflow.com/questions/51449606/too-many-open-files-with-os-create/51462820#51462820", "title": "&quot;too many open files&quot; with os.Create", "body": "<p>Deferred statements are not executed until the surrounding function returns, that is why your files stay open until after the for-loop.</p>\n\n<p>To fix this you can simply insert an anonymous function call inside the loop:</p>\n\n<pre><code>for ... {\n    func() {\n        w, err := os.Create(testFile)\n        if err != nil {\n            panic(err)\n        }\n        defer w.Close()\n        ...\n    }()\n}\n</code></pre>\n\n<p>That way, after each iteration of the loop, the current file is closed.</p>\n"}], "owner": {"reputation": 137, "user_id": 7808537, "user_type": "registered", "accept_rate": 0, "profile_image": "https://lh5.googleusercontent.com/-MW9XsQwpqZg/AAAAAAAAAAI/AAAAAAAAwkk/dIeGpJGuLS4/photo.jpg?sz=128", "display_name": "Hugues", "link": "https://stackoverflow.com/users/7808537/hugues"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 645, "favorite_count": 1, "accepted_answer_id": 51450113, "answer_count": 3, "score": -1, "last_activity_date": 1532290476, "creation_date": 1532116969, "last_edit_date": 1532117707, "question_id": 51449606, "link": "https://stackoverflow.com/questions/51449606/too-many-open-files-with-os-create", "title": "&quot;too many open files&quot; with os.Create", "body": "<p>I have around 220'000 image files (.png) to create. I run into this error message when trying to create the 1'081th file:\npanic: open <code>/media/Snaps/pics/image1081_0.png: too many open files</code></p>\n\n<p>I've added the defer w.Close() line but it did not change the error.</p>\n\n<pre><code>    i := 1\n    for i &lt;= 223129 {\n\n    (some other code to prepare the data and create the chart)\n\n    img := vgimg.New(450, 600)\n    dc := draw.New(img)\n\n    canvases := table.Align(plots, dc)\n    plots[0][0].Draw(canvases[0][0])\n    plots[1][0].Draw(canvases[1][0])\n    plots[2][0].Draw(canvases[2][0])\n\n\n    testFile := \"/media/Snaps/pics/image\"+strconv.Itoa(i+60)+\"_\"+gain_loss+\".png\"\n\n        w, err := os.Create(testFile)\n        if err != nil {\n            panic(err)\n        }\n        defer w.Close()\n\n        png := vgimg.PngCanvas{Canvas: img}\n        if _, err := png.WriteTo(w); err != nil {\n            panic(err)\n        }   \n\n        //move to next image\n        i = i + 1\n     }\n</code></pre>\n\n<p>Surely this limit can be worked around ? Maybe I'm not closing the files properly ?</p>\n"}]