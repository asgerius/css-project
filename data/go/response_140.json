[{"tags": ["go"], "comments": [{"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1505372553, "post_id": 46208216, "comment_id": 79388025, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/32277884/golang-type-interface-is-interface-with-no-methods\">Golang type interface {} is interface with no methods</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": true, "score": 7, "last_activity_date": 1505345804, "creation_date": 1505345804, "answer_id": 46208325, "question_id": 46208216, "link": "https://stackoverflow.com/questions/46208216/type-interface-is-interface-with-no-methods/46208325#46208325", "title": "Type interface {} is interface with no methods", "body": "<p>A <a href=\"https://tour.golang.org/methods/15\" rel=\"noreferrer\">type assertion</a> does just that, asserts a value is a given <em>type</em>.</p>\n\n<pre><code>userID := user.(users).ID\n</code></pre>\n\n<p>Use they type name, and it should work.</p>\n"}], "owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3579, "favorite_count": 1, "accepted_answer_id": 46208325, "answer_count": 1, "score": 3, "last_activity_date": 1575111436, "creation_date": 1505344877, "last_edit_date": 1575111436, "question_id": 46208216, "link": "https://stackoverflow.com/questions/46208216/type-interface-is-interface-with-no-methods", "title": "Type interface {} is interface with no methods", "body": "<p>I am using <a href=\"https://github.com/kataras/iris\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris</a> golang web framework. This is follow up mail from the last question asked here - <a href=\"https://stackoverflow.com/questions/46130446/fetching-logged-in-user-info-for-display-golang-template\">Fetching Logged in User Info for display - Golang Template</a></p>\n\n<p>I am finally using code that was mentioned in the previous post like:-</p>\n\n<p><code>ctx.Values().Get(\"user\")</code></p>\n\n<p>and the value that user is set or has is \"Struct\" type:-</p>\n\n<pre><code>// users is struct below\n\nvar user users\n\n// details are fetched from DB and assigned to user \n// like mentioned here http://go-database-sql.org/retrieving.html \n// Now value is set\nctx.Values().Set(\"user\", user);\n</code></pre>\n\n<p>But after getting the value, When I use in different handler and print:-</p>\n\n<pre><code>user := ctx.Values().Get(\"user\")\nfmt.Println(user.ID)\n</code></pre>\n\n<p>I get the error:-</p>\n\n<p><code>user.ID undefined (type interface {} is interface with no methods)</code></p>\n\n<p>I need help in \"Type assertion\" for the interface. How can I \"type assert\" above value?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505336786, "post_id": 46206828, "comment_id": 79377042, "body": "No. Which is too short in itself as an answer. Remember: <code>interface{}</code> says nothing. That&#39;s why you have to do all the work,"}, {"owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505336845, "post_id": 46206828, "comment_id": 79377071, "body": "Ok. So downvote the question?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1505337343, "post_id": 46206828, "comment_id": 79377277, "body": "Couldn&#39;t you just make all the types implement a method to return <code>ObjectMeta</code>?"}, {"owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505379363, "post_id": 46206828, "comment_id": 79391974, "body": "@JimB, no. These types exist in external project. I have no control over them."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 0, "last_activity_date": 1505356610, "last_edit_date": 1505356610, "creation_date": 1505355639, "answer_id": 46209493, "question_id": 46206828, "link": "https://stackoverflow.com/questions/46206828/how-to-get-embedded-type-from-go-struct/46209493#46209493", "title": "How to get embedded type from GO struct?", "body": "<p>It can be done using reflection, iterating through the fields of the incoming value:</p>\n\n<pre><code>func myfunc(v interface{}) ObjectMeta {\n    // Elem() to de-reference pointer\n    ifv := reflect.ValueOf(v).Elem()\n    ift := reflect.TypeOf(v).Elem()\n\n    for i := 0; i &lt; ift.NumField(); i++ {\n        f := ift.Field(i)\n        if f.Name == \"ObjectMeta\" {\n            fv := ifv.Field(i)\n            return fv.Interface().(ObjectMeta)\n        }\n    }\n    panic(\"ObjectMeta not found\")\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/CzMHJWhxYr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CzMHJWhxYr</a></p>\n"}, {"comments": [{"owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "edited": false, "score": 0, "creation_date": 1505411040, "post_id": 46214819, "comment_id": 79414024, "body": "These types exist in external project. I have no control over them"}], "tags": [], "owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "is_accepted": false, "score": 0, "last_activity_date": 1505379787, "creation_date": 1505379787, "answer_id": 46214819, "question_id": 46206828, "link": "https://stackoverflow.com/questions/46206828/how-to-get-embedded-type-from-go-struct/46214819#46214819", "title": "How to get embedded type from GO struct?", "body": "<p>You can define interface which will get you that embedded type:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype HasMeta interface {\n    GetMeta() ObjectMeta\n}\n\ntype ObjectMeta struct {\n    Name      string\n    Namespace string\n}\n\nfunc (o ObjectMeta) GetMeta() ObjectMeta {\n    return o\n}\n\ntype A struct {\n    ObjectMeta\n    X string\n}\n\ntype B struct {\n    ObjectMeta\n    X string\n}\n\nfunc myfunc(o HasMeta) ObjectMeta {\n    return o.GetMeta()\n}\n\nfunc main() {\n    fmt.Println(myfunc(&amp;A{}))\n    fmt.Println(myfunc(A{}))\n    fmt.Println(myfunc(&amp;B{}))\n    fmt.Println(myfunc(B{}))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/CWa4k-kvvl\" rel=\"nofollow noreferrer\">https://play.golang.org/p/CWa4k-kvvl</a></p>\n"}], "owner": {"reputation": 7906, "user_id": 244009, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bd8e93613dba2b3b39c97afd6d065279?s=128&d=identicon&r=PG", "display_name": "codefx", "link": "https://stackoverflow.com/users/244009/codefx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 46209493, "answer_count": 2, "score": 0, "last_activity_date": 1505411089, "creation_date": 1505336659, "last_edit_date": 1505411089, "question_id": 46206828, "link": "https://stackoverflow.com/questions/46206828/how-to-get-embedded-type-from-go-struct", "title": "How to get embedded type from GO struct?", "body": "<p>I am trying to get embedded type from Go structs. Below is an example program that demonstrates this. Is there a way to write <code>myfunc()</code> without enumerating every type that can come in as input?\n<a href=\"https://play.golang.org/p/5wp14O660m\" rel=\"nofollow noreferrer\">https://play.golang.org/p/5wp14O660m</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype ObjectMeta struct {\n    Name string\n    Namespace string\n}\n\ntype A struct {\n    ObjectMeta\n    X string\n}\n\ntype B struct {\n    ObjectMeta\n\n    X string\n}\n\nfunc myfunc(v interface{}) ObjectMeta {\n    switch u := v.(type) {\n    case *A:\n        return u.ObjectMeta\n    case A:\n        return u.ObjectMeta\n    case *B:\n        return u.ObjectMeta\n    case B:\n        return u.ObjectMeta\n    }\n    panic(\"No matching type\")\n}\n\nfunc main() {\n    fmt.Println(myfunc(&amp;A{}))\n\n    var v interface{} = &amp;A{}\n    fmt.Println(v.(*ObjectMeta))\n}\n</code></pre>\n\n<p><code>ObjectMeta</code>, <code>A</code>, <code>B</code> structs exist in external project. I have no control over them.</p>\n"}, {"tags": ["testing", "go", "go-playground"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1505377458, "post_id": 46205923, "comment_id": 79390779, "body": "See also <a href=\"https://github.com/golang/go/issues/6511\" rel=\"nofollow noreferrer\">Go issue #6511</a> and especially <a href=\"http://play.golang.org/p/K0gFil6jFC\" rel=\"nofollow noreferrer\">this snippet</a> it refers to."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505333660, "post_id": 46206116, "comment_id": 79375521, "body": "Per the documentation, <code>testing.Main</code> is deprecated in favor of <code>testing.MainStart</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505333782, "post_id": 46206116, "comment_id": 79375599, "body": "<a href=\"https://golang.org/pkg/testing/#Main\" rel=\"nofollow noreferrer\">golang.org/pkg/testing/#Main</a> - &quot;Systems simulating &quot;go test&quot; should be updated to use MainStart.&quot;"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505335865, "post_id": 46206116, "comment_id": 79376575, "body": "They&#39;re both equally unstable (they&#39;re both intended for internal use only). So calling one &quot;non-deprecated but unstable&quot; is misleading."}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505336177, "post_id": 46206116, "comment_id": 79376751, "body": "Except <code>Main</code> is &quot;preserved, as much as possible&quot;, per the documentation, whereas <code>MainStart</code> is &quot;not subject to the Go 1 compatibility document&quot;.  So, yeah, it certainly seems like one is more stable than the other."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505336414, "post_id": 46206116, "comment_id": 79376871, "body": "They&#39;re both internal functions, so the only way it could be construed as &quot;more stable&quot; would be that it&#39;s no longer being updated <i>because it&#39;s deprecated</i>. It&#39;s still an internal API not subject to the Go 1 compatibility promise."}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 10, "last_activity_date": 1505334402, "last_edit_date": 1505334402, "creation_date": 1505333627, "answer_id": 46206116, "question_id": 46205923, "link": "https://stackoverflow.com/questions/46205923/how-do-i-use-the-testing-package-in-go-playground/46206116#46206116", "title": "How do I use the testing package in go playground?", "body": "<p>You need to use <code>testing.Main</code>:</p>\n\n<pre><code>func main() {\n    testSuite := []testing.InternalTest{\n        {\n            Name: \"TestCaseA\",\n            F:    TestCaseA,\n        },\n    }\n    testing.Main(matchString, testSuite, nil, nil)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DQsIGKNWwd\" rel=\"noreferrer\">https://play.golang.org/p/DQsIGKNWwd</a></p>\n\n<p>If you want to use the \"non deprecated\", but unstable way:</p>\n\n<p><a href=\"https://play.golang.org/p/4zH7DiDcAP\" rel=\"noreferrer\">https://play.golang.org/p/4zH7DiDcAP</a></p>\n"}, {"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505335720, "post_id": 46206134, "comment_id": 79376509, "body": "Not from me, but this doesn&#39;t have much more than commentary. Plus dave does have 2 working examples, with both <code>testing.Main</code> and <code>testing.MainStart</code> (not that I&#39;m recommending trying to simulate <code>go test</code> at all ;) )"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505335971, "post_id": 46206134, "comment_id": 79376637, "body": "The question doesn&#39;t have any code either and it&#39;s +2/-0, and Dave had the wrong (clearly indicated in the documentation) answer until I pointed it out. Oh well, the StackOverflow gods are fickle and inscrutable."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1505333691, "creation_date": 1505333691, "answer_id": 46206134, "question_id": 46205923, "link": "https://stackoverflow.com/questions/46205923/how-do-i-use-the-testing-package-in-go-playground/46206134#46206134", "title": "How do I use the testing package in go playground?", "body": "<p>There are execution time limits on playground and I believe they are less than the minimum execution time used by bench. From reviewing <a href=\"https://github.com/golang/go/blob/master/src/cmd/go/internal/test/test.go\" rel=\"nofollow noreferrer\">the source of the <code>go test</code> command</a>, it looks like the current proper entry point for tests is <a href=\"https://golang.org/pkg/testing/#MainStart\" rel=\"nofollow noreferrer\"><code>testing.MainStart</code></a> which you may or may not have luck using. It is technically an internal-use API and not subject to compatibility guidelines, so YMMV.</p>\n"}], "owner": {"reputation": 1495, "user_id": 203950, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/81d0f23e2c9e344f5b105f14686f8482?s=128&d=identicon&r=PG", "display_name": "Ben Walther", "link": "https://stackoverflow.com/users/203950/ben-walther"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1678, "favorite_count": 2, "accepted_answer_id": 46206116, "answer_count": 2, "score": 7, "last_activity_date": 1505334402, "creation_date": 1505332813, "question_id": 46205923, "link": "https://stackoverflow.com/questions/46205923/how-do-i-use-the-testing-package-in-go-playground", "title": "How do I use the testing package in go playground?", "body": "<p>The <code>testing</code> package is available in the go playground.</p>\n\n<p>How can I use the go playground to demonstrate testing concepts, without access to <code>go test</code>?</p>\n\n<p>My assumption is it's possible using the testing.RunTests function. My attempts to do so always generate only \"testing: warning: no tests to run\". </p>\n\n<p>Example: <a href=\"https://play.golang.org/p/PvRCMdeXhX\" rel=\"noreferrer\">https://play.golang.org/p/PvRCMdeXhX</a> </p>\n\n<p>For context, my use case is for sharing quick examples of tests, examples and benchmarks with colleagues. I rely on go playground for sharing code snippets like this often.</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 4, "creation_date": 1505327824, "post_id": 46204640, "comment_id": 79372439, "body": "You can&#39;t have an XML element or attribute name with a space in it. That&#39;s invalid XML."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 2, "creation_date": 1505328068, "post_id": 46204640, "comment_id": 79372580, "body": "@RayfenWindspear hence why I said &quot;element or attribute name&quot;. Neither can have a space in it."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1505328650, "post_id": 46204640, "comment_id": 79372924, "body": "Well, it&#39;s invalid XML altogether because there is no closing tag for <code>farmer</code> and it doesn&#39;t close itself."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505329090, "post_id": 46204640, "comment_id": 79373155, "body": "Can you do <code>farmer&gt;id,attr</code>? I don&#39;t think so but I&#39;m not 100% sure."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1505330022, "post_id": 46204640, "comment_id": 79373645, "body": "Are you sure you want <code>&lt;path farmer id=&quot;ME7&quot; &lt;&#47;path&gt;</code> as posted, or do you want <code>&lt;path farmer id=&quot;ME7&quot;&gt;&lt;&#47;path&gt;</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505330785, "post_id": 46204640, "comment_id": 79374042, "body": "Generating the desired (pseudo)XML is dead simple by use of fmt.Printf. No need for cleverness if something so simple (and invalid) has to be generated."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1505332014, "post_id": 46204640, "comment_id": 79374702, "body": "@Volker unless this is just a small piece of a larger piece of XML (which is likely). Attempting to do this as a value of another tag would result in the <code>&lt;&gt;</code> being XML encoded. Still hackable though. And this would probably be even more efficient than regexing a large XML string."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1505336370, "post_id": 46204640, "comment_id": 79376849, "body": "@RayfenWindspear encoding/xml offer solutions for this problem."}, {"owner": {"reputation": 33, "user_id": 7546676, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c6fc07402abd9e687cf453bd0254f1a4?s=128&d=identicon&r=PG&f=1", "display_name": "lymantok", "link": "https://stackoverflow.com/users/7546676/lymantok"}, "edited": false, "score": 0, "creation_date": 1505337182, "post_id": 46204640, "comment_id": 79377209, "body": "This is what I need. I missed the trailing slash in my post: &lt;farmer id=&quot;ME-7000-2&quot;/&gt;      And yes, this is just a tiny snippet of a much larger xml structure."}], "answers": [{"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1505329477, "post_id": 46205032, "comment_id": 79373367, "body": "If the XML must end up invalid exactly as in the example, remove the closing tag with <code>reg := regexp.MustCompile(&quot;(&lt;&#47;farmer&gt;)&quot;) \tdata = reg.ReplaceAllString(data, &quot;&quot;)</code>"}, {"owner": {"reputation": 33, "user_id": 7546676, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c6fc07402abd9e687cf453bd0254f1a4?s=128&d=identicon&r=PG&f=1", "display_name": "lymantok", "link": "https://stackoverflow.com/users/7546676/lymantok"}, "edited": false, "score": 0, "creation_date": 1505345131, "post_id": 46205032, "comment_id": 79379801, "body": "Many thanks. I checked with the api owner again. According to them:  If an XML element contains no value or child element then the element may be closed with \u201c/&gt;\u201d. So from their perspective self termination without a &lt;/farmer&gt; tag is legal. I take it golang does not support this type of termination."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 1, "last_activity_date": 1505329292, "creation_date": 1505329292, "answer_id": 46205032, "question_id": 46204640, "link": "https://stackoverflow.com/questions/46204640/in-golang-how-do-i-encode-an-xml-parameter-containing-a-space/46205032#46205032", "title": "In golang how do I encode an xml parameter containing a space?", "body": "<p>That's not valid XML.</p>\n\n<p>I would double check the API contract you mention since it's unlikely they require invalid XML.</p>\n\n<p>The closest you can get to that is this valid XML.</p>\n\n<pre><code>&lt;path&gt;&lt;farmer id=\"ME7\"&gt;&lt;/farmer&gt;&lt;/path&gt;\n</code></pre>\n\n<p>In order to generate the above (valid) XML, you should define your types as:</p>\n\n<pre><code>type Farmer struct {\n   XMLName   xml.Name    `xml:\"farmer\"`\n   Id        string      `xml:\"id,attr\"`\n}\n\ntype Path struct {\n    XMLName xml.Name `xml:\"path\"`\n    Farmer  Farmer   `xml:\"farmer\"`\n}\n</code></pre>\n\n<p>And then create the value as:</p>\n\n<pre><code>v := Path{Farmer: Farmer{Id: \"ME7\"}}\n</code></pre>\n\n<p>See here for a running example: <a href=\"https://play.golang.org/p/abEqMc6HdK\" rel=\"nofollow noreferrer\">https://play.golang.org/p/abEqMc6HdK</a></p>\n"}, {"comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1505332883, "post_id": 46205288, "comment_id": 79375138, "body": "Actually, now that I think of it, I have encountered something very similar to this myself with someones broken API implementation. In my case, I had to forcefully modify the XML to have a self closing tag (which go doesn&#39;t support), and had to use a magic string to insert multiple XML namespaces (which go also doesn&#39;t support, or didn&#39;t at the time)."}], "tags": [], "owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "is_accepted": true, "score": 1, "last_activity_date": 1505332366, "last_edit_date": 1505332366, "creation_date": 1505330244, "answer_id": 46205288, "question_id": 46204640, "link": "https://stackoverflow.com/questions/46204640/in-golang-how-do-i-encode-an-xml-parameter-containing-a-space/46205288#46205288", "title": "In golang how do I encode an xml parameter containing a space?", "body": "<p>The XML is invalid, but if you really need it to come out like that, use a regular expression to fix it afterward. Here is an example. </p>\n\n<p>I am assuming that you really want the open tag valid like so <code>&lt;path farmer id=\"ME7\"&gt;&lt;/path&gt;</code>, instead of not having the open tag valid as you posted <code>&lt;path farmer id=\"ME7\" &lt;/path&gt;</code>, but either way is doable with regex.</p>\n\n<p>BTW, your question is inconsistent about what you want. You start with wanting <code>&lt;path&gt;&lt;farmer id=\"ME7\"&gt;&lt;/path&gt;</code>, which @eugenioy 's answer will accommodate. Then end with \"What I want is this: <code>&lt;path farmer id=\"ME7\" &lt;/path&gt;</code>\". Which my answer is geared toward.</p>\n\n<p><a href=\"https://play.golang.org/p/A-sJhIgFZW\" rel=\"nofollow noreferrer\">https://play.golang.org/p/A-sJhIgFZW</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"regexp\"\n)\n\ntype Path struct {\n    XMLName  xml.Name `xml:\"path\"`\n    Farmer   string   `xml:\"farmer,attr\"`\n    FarmerId string   `xml:\"id,attr\"`\n}\n\nfunc main() {\n    path := &amp;Path{\n        FarmerId: \"ME7\",\n    }\n    data, err := xml.Marshal(path)\n    if err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    strData := string(data)\n\n    // fix with regex\n    reg := regexp.MustCompile(`(farmer)(=\"\")`)\n    strData = reg.ReplaceAllString(strData, \"$1\")\n    fmt.Println(strData) // &lt;path farmer id=\"ME7\"&gt;&lt;/path&gt;\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 7546676, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c6fc07402abd9e687cf453bd0254f1a4?s=128&d=identicon&r=PG&f=1", "display_name": "lymantok", "link": "https://stackoverflow.com/users/7546676/lymantok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 635, "favorite_count": 0, "accepted_answer_id": 46205288, "answer_count": 2, "score": -3, "last_activity_date": 1505345268, "creation_date": 1505327769, "last_edit_date": 1505345268, "question_id": 46204640, "link": "https://stackoverflow.com/questions/46204640/in-golang-how-do-i-encode-an-xml-parameter-containing-a-space", "title": "In golang how do I encode an xml parameter containing a space?", "body": "<p>I have this xml api construct I need to use (this construct is not defined by me and I cannot change it):</p>\n\n<pre><code>&lt;path&gt;&lt;farmer id=\"ME7\"/&gt;&lt;/path&gt;\n</code></pre>\n\n<p>In go I have:</p>\n\n<pre><code>type Path struct {\n  XMLName xml.Name `xml:\"path\"`\n  FarmerId string `xml:\"farmer id,attr\"`\n}\n\npMux := &amp;Path{FarmerId: \"ME7\"}\n</code></pre>\n\n<p>However go encodes pMux and prints it as this:</p>\n\n<pre><code>&lt;path xmlns:farmer=\"farmer\" farmer:id=\"ME7\" &lt;/path&gt;\n</code></pre>\n\n<p>What I want is this:</p>\n\n<pre><code>&lt;path&gt;&lt;farmer id=\"ME7\"/&gt; &lt;/path&gt;\n</code></pre>\n\n<p>How can I achieve this?</p>\n\n<p>Thx</p>\n"}, {"tags": ["elasticsearch", "go"], "answers": [{"comments": [{"owner": {"reputation": 532, "user_id": 3800246, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/JCVvv.jpg?s=128&g=1", "display_name": "Disciples", "link": "https://stackoverflow.com/users/3800246/disciples"}, "edited": false, "score": 0, "creation_date": 1505373474, "post_id": 46208085, "comment_id": 79388540, "body": "Thanks for example. As I understood, I need first example: I spawn as many goroutines as I need (dependings of length of <code>files</code> list length) and use same approach: <code>wg.Add(1)</code> and <code>wg.Wait()</code>.    However I still don&#39;t understand, why does inner <code>wg</code> of elastic search bulk insert function doesn&#39;t block outer goroutine. I need to pass <code>wg</code> by reference in order to wait for <code>BulkInsert</code> function to return?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "reply_to_user": {"reputation": 532, "user_id": 3800246, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/JCVvv.jpg?s=128&g=1", "display_name": "Disciples", "link": "https://stackoverflow.com/users/3800246/disciples"}, "edited": false, "score": 0, "creation_date": 1505381777, "post_id": 46208085, "comment_id": 79393726, "body": "<code>wg</code> must not be copied, use a pointer if you need to pass it around. wg is not a channel, it does not organize the concurrency, it only tells when its all done, it blocks only on Wait() call. Can t really say about your specific bulk code without reading it."}], "tags": [], "owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "is_accepted": true, "score": 1, "last_activity_date": 1505345570, "last_edit_date": 1505345570, "creation_date": 1505343805, "answer_id": 46208085, "question_id": 46204606, "link": "https://stackoverflow.com/questions/46204606/concurrent-file-parsing-and-inserting-into-elastic-search/46208085#46208085", "title": "Concurrent file parsing and inserting into Elastic Search", "body": "<blockquote>\n  <p>Can I achieve better performance? </p>\n</blockquote>\n\n<p>unclear, it depends of the receiver and the sender capabilities.</p>\n\n<blockquote>\n  <p>My question is, is my approach to this problem is correct? </p>\n</blockquote>\n\n<p>might this help you better understand go routines,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\nfunc main() {\n\n    addr := \"127.0.0.1:2074\"\n\n    srv := http.Server{\n        Addr: addr,\n        Handler: http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n            log.Println(\"hit \", r.URL.String())\n            &lt;-time.After(time.Second)\n            log.Println(\"done \", r.URL.String())\n        }),\n    }\n    fail(unblock(srv.ListenAndServe))\n\n    jobs := []int{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n\n    // case 1\n    // it creates 10 goroutines,\n    // that triggers 10 // concurrent get queries\n    {\n        wg := sync.WaitGroup{}\n        wg.Add(len(jobs))\n        log.Printf(\"starting %v jobs\\n\", len(jobs))\n        for _, job := range jobs {\n            go func(job int) {\n                defer wg.Done()\n                http.Get(fmt.Sprintf(\"http://%v/job/%v\", addr, job))\n            }(job)\n        }\n        wg.Wait()\n        log.Printf(\"done %v jobs\\n\", len(jobs))\n    }\n\n    log.Println()\n    log.Println(\"=================\")\n    log.Println()\n\n    // case 2\n    // it creates 3 goroutines,\n    // that triggers 3 // concurrent get queries\n    {\n        wg := sync.WaitGroup{}\n        wg.Add(len(jobs))\n        in := make(chan string)\n        limit := make(chan bool, 3)\n        log.Printf(\"starting %v jobs\\n\", len(jobs))\n        go func() {\n            for url := range in {\n                limit &lt;- true\n                go func(url string) {\n                    defer wg.Done()\n                    http.Get(url)\n                    &lt;-limit\n                }(url)\n            }\n        }()\n        for _, job := range jobs {\n            in &lt;- fmt.Sprintf(\"http://%v/job/%v\", addr, job)\n        }\n        wg.Wait()\n        log.Printf(\"done %v jobs\\n\", len(jobs))\n    }\n\n    log.Println()\n    log.Println(\"=================\")\n    log.Println()\n\n    // case 2: rewrite\n    // it creates 6 goroutines,\n    // that triggers 6 // concurrent get queries\n    {\n        wait, add := parallel(6)\n        log.Printf(\"starting %v jobs\\n\", len(jobs))\n        for _, job := range jobs {\n            url := fmt.Sprintf(\"http://%v/job/%v\", addr, job)\n            add(func() {\n                http.Get(url)\n            })\n        }\n        wait()\n        log.Printf(\"done %v jobs\\n\", len(jobs))\n    }\n}\n\nfunc parallel(c int) (func(), func(block func())) {\n    wg := sync.WaitGroup{}\n    in := make(chan func())\n    limit := make(chan bool, c)\n    go func() {\n        for block := range in {\n            limit &lt;- true\n            go func(block func()) {\n                defer wg.Done()\n                block()\n                &lt;-limit\n            }(block)\n        }\n    }()\n    return wg.Wait, func(block func()) {\n        wg.Add(1)\n        in &lt;- block\n    }\n}\n\nfunc unblock(block func() error) error {\n    w := make(chan error)\n    go func() { w &lt;- block() }()\n    select {\n    case err := &lt;-w:\n        return err\n    case &lt;-time.After(time.Millisecond):\n    }\n    return nil\n}\n\nfunc fail(err error) {\n    if err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>outputs</p>\n\n<pre><code>$ go run main.go \n2017/09/14 01:30:50 starting 10 jobs\n2017/09/14 01:30:50 hit  /job/0\n2017/09/14 01:30:50 hit  /job/4\n2017/09/14 01:30:50 hit  /job/5\n2017/09/14 01:30:50 hit  /job/2\n2017/09/14 01:30:50 hit  /job/9\n2017/09/14 01:30:50 hit  /job/1\n2017/09/14 01:30:50 hit  /job/3\n2017/09/14 01:30:50 hit  /job/7\n2017/09/14 01:30:50 hit  /job/8\n2017/09/14 01:30:50 hit  /job/6\n2017/09/14 01:30:51 done  /job/5\n2017/09/14 01:30:51 done  /job/4\n2017/09/14 01:30:51 done  /job/2\n2017/09/14 01:30:51 done  /job/0\n2017/09/14 01:30:51 done  /job/6\n2017/09/14 01:30:51 done  /job/9\n2017/09/14 01:30:51 done  /job/1\n2017/09/14 01:30:51 done  /job/3\n2017/09/14 01:30:51 done  /job/7\n2017/09/14 01:30:51 done  /job/8\n2017/09/14 01:30:51 done 10 jobs\n2017/09/14 01:30:51 \n2017/09/14 01:30:51 =================\n2017/09/14 01:30:51 \n2017/09/14 01:30:51 starting 10 jobs\n2017/09/14 01:30:51 hit  /job/0\n2017/09/14 01:30:51 hit  /job/2\n2017/09/14 01:30:51 hit  /job/1\n2017/09/14 01:30:52 done  /job/2\n2017/09/14 01:30:52 done  /job/0\n2017/09/14 01:30:52 done  /job/1\n2017/09/14 01:30:52 hit  /job/3\n2017/09/14 01:30:52 hit  /job/4\n2017/09/14 01:30:52 hit  /job/5\n2017/09/14 01:30:53 done  /job/3\n2017/09/14 01:30:53 done  /job/4\n2017/09/14 01:30:53 done  /job/5\n2017/09/14 01:30:53 hit  /job/6\n2017/09/14 01:30:53 hit  /job/7\n2017/09/14 01:30:53 hit  /job/8\n2017/09/14 01:30:54 done  /job/6\n2017/09/14 01:30:54 done  /job/7\n2017/09/14 01:30:54 done  /job/8\n2017/09/14 01:30:54 hit  /job/9\n2017/09/14 01:30:55 done  /job/9\n2017/09/14 01:30:55 done 10 jobs\n2017/09/14 01:30:55 \n2017/09/14 01:30:55 =================\n2017/09/14 01:30:55 \n2017/09/14 01:30:55 starting 10 jobs\n2017/09/14 01:30:55 hit  /job/0\n2017/09/14 01:30:55 hit  /job/1\n2017/09/14 01:30:55 hit  /job/4\n2017/09/14 01:30:55 hit  /job/2\n2017/09/14 01:30:55 hit  /job/3\n2017/09/14 01:30:55 hit  /job/5\n2017/09/14 01:30:56 done  /job/0\n2017/09/14 01:30:56 hit  /job/6\n2017/09/14 01:30:56 done  /job/1\n2017/09/14 01:30:56 done  /job/2\n2017/09/14 01:30:56 done  /job/4\n2017/09/14 01:30:56 hit  /job/7\n2017/09/14 01:30:56 done  /job/3\n2017/09/14 01:30:56 hit  /job/9\n2017/09/14 01:30:56 hit  /job/8\n2017/09/14 01:30:56 done  /job/5\n2017/09/14 01:30:57 done  /job/6\n2017/09/14 01:30:57 done  /job/7\n2017/09/14 01:30:57 done  /job/9\n2017/09/14 01:30:57 done  /job/8\n2017/09/14 01:30:57 done 10 jobs\n</code></pre>\n"}], "owner": {"reputation": 532, "user_id": 3800246, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/JCVvv.jpg?s=128&g=1", "display_name": "Disciples", "link": "https://stackoverflow.com/users/3800246/disciples"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 0, "accepted_answer_id": 46208085, "answer_count": 1, "score": 0, "last_activity_date": 1505345570, "creation_date": 1505327635, "last_edit_date": 1505332396, "question_id": 46204606, "link": "https://stackoverflow.com/questions/46204606/concurrent-file-parsing-and-inserting-into-elastic-search", "title": "Concurrent file parsing and inserting into Elastic Search", "body": "<p>I was playing with Go recently and come up with small script which parses log files and inserts them to elastic search. For each file I spawned a goroutine like this:</p>\n\n<pre><code>var wg := sync.WaitGroup{}\nwg.Add(len(files))\nfor _, file := range files {\n    go func(f os.FileInfo){\n        defer wg.Done()\n        ProcessFile(f.Name(), config.OriginFilePath, config.WorkingFilePath, config.ArchiveFilePath,fmt.Sprintf(\"http://%v:%v\", config.ElasticSearch.Host, config.ElasticSearch.Port),config.ProviderIndex, config.NetworkData)\n    }(file)\n}\nwg.Wait()\n</code></pre>\n\n<p>Inside of my processFile I have function which sends to elastic search:</p>\n\n<pre><code>func BulkInsert(lines []string, ES *elastic.Client) (*elastic.Response, error){\n    r, err := ES.PerformRequest(\"POST\", \"/_bulk\", url.Values{}, strings.Join(lines, \"\\n\")+\"\\n\")\n    if err != nil {\n        return nil, err\n    }\n    return r, nil\n}\n</code></pre>\n\n<p>The problem is that I don't fully understand how goroutines work. My understanding is that sending to elastic search is blocking one of my goroutines from executing. I tried spawning another goroutine for elastic search with bulk insert with same approach:</p>\n\n<p><code>WaitGroup</code>, <code>go func(){defer wg.Done(); BulkInsert(elems, ES);}()</code>\nand <code>wg.Wait()</code> before my function return. However, I've discovered that in the end that not all my events end up in elastic search. I think this is due to goroutines returning without ever sending/waiting for bulk request to finish.</p>\n\n<p>My question is, is my approach to this problem is correct? Can I achieve better performance? </p>\n"}, {"tags": ["go", "dependency-management", "godeps"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505325496, "post_id": 46203546, "comment_id": 79371108, "body": "<code>dep</code> can&#39;t currently do this. It needs to be able to fetch the repositories remotely."}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1505327345, "post_id": 46203546, "comment_id": 79372175, "body": "The is roughly equivalent to how I&#39;ve structured one of my projects. Originally I thought I&#39;d separate the packages into different repos, but it ended up being awful and unnecessary for my project. Now it is working quite nicely to have the main repo directory have no files, just the directories for the different packages. Notably, it IS actually two AppEngine modules (API and webserver) in one repo that share the DB package abstraction. Thus far, I haven&#39;t needed to separate anything into different repos, but it wouldn&#39;t be difficult to do so. Just a possible suggestion, YMMV."}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1505329979, "post_id": 46203546, "comment_id": 79373618, "body": "Yes, I see... but in my real project, each subproject is a microservice that should be extended/maintained/built separately."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505336401, "post_id": 46203546, "comment_id": 79376863, "body": "Just to clarify, you can put the packages wherever you want, and as long as they&#39;re locatable in GOPATH the program will compile. The fact that the packages can&#39;t be found on github.com yet is only a hinderance to sharing the code since <code>go get</code> won&#39;t work until they&#39;re there. The <code>dep</code> tool not using packages from GOPATH is a separate issue entirely, and is completely the fault of that tool, not with your packages."}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1505344266, "post_id": 46203546, "comment_id": 79379593, "body": "out of curiosity, what dep command do you run ?"}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1505418204, "post_id": 46203546, "comment_id": 79417840, "body": "I run <code>dep init</code> the first time and then <code>dep ensure</code> whenever there is a new dependency."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505480166, "post_id": 46203546, "comment_id": 79443708, "body": "This is basically <a href=\"https://github.com/golang/dep/issues/792\" rel=\"nofollow noreferrer\">issue 792</a> which is closed under &quot;known/won&#39;t fix&quot;. I personally think they should make the simple case work, but they want a complete solution which is much less tractable."}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 157, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505325736, "creation_date": 1505323600, "last_edit_date": 1505325736, "question_id": 46203546, "link": "https://stackoverflow.com/questions/46203546/how-to-add-referencdes-between-subprojects", "title": "How to add referencdes between subprojects", "body": "<p>This is the structure of my project:</p>\n\n<pre><code>src\n  + github.com\n      + myproject\n          + services\n              + utils\n                  + nonce.go\n              + myservice\n                  + main.go\n</code></pre>\n\n<p>As you can see, <code>myproject</code> consists of two subprojects (i.e. <code>utils</code> and <code>myservice</code>).</p>\n\n<p><code>main.go</code> references the <code>util</code> package like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/myproject/services/utils\"\n)\n\nfunc main() {\n    ...\n    utils.DoSomething()\n    ...\n}\n</code></pre>\n\n<p>The <code>utils</code> package is not in <code>github.com</code> yet... but <code>dep</code> looks for this package at <code>github.com</code>. Is it possible to compile all the subprojects (and manage dependencies with <code>dep</code>) while the project is still local on my PC?</p>\n"}, {"tags": ["xml", "go", "musicxml"], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 6201243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fOntPq_Suc4/AAAAAAAAAAI/AAAAAAAAAD8/_mis1pRQNFA/photo.jpg?sz=128", "display_name": "Shawn Rupp", "link": "https://stackoverflow.com/users/6201243/shawn-rupp"}, "edited": false, "score": 0, "creation_date": 1505409900, "post_id": 46203540, "comment_id": 79413410, "body": "You are absolutely correct. Of course it had to something so painfully obvious. Thanks for the help!"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1505323578, "creation_date": 1505323578, "answer_id": 46203540, "question_id": 46203443, "link": "https://stackoverflow.com/questions/46203443/golang-decode-musicxml/46203540#46203540", "title": "Golang Decode MusicXML", "body": "<p>I think you've misunderstood the behavior of the decoder: it decodes XML <em>into the object you pass to <code>Decode</code></em>:</p>\n\n<pre><code>song := xml.NewDecoder(io.Reader(f))\nscore := Score{}\nerr = song.Decode(&amp;score)\n// Decoded document is in score, *NOT* in song\nreturn score\n</code></pre>\n\n<p>You're treating the decoder as if it will contain your document, but it's just a decoder. It decodes. To make it clearer in code, it should not be named <code>song</code> - it should be named, say, <code>decoder</code> or <code>scoreDecoder</code> or what have you. You almost certainly don't want to return an <code>*xml.Decoder*</code> from your function, but rather the decoded <code>Score</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 6201243, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-fOntPq_Suc4/AAAAAAAAAAI/AAAAAAAAAD8/_mis1pRQNFA/photo.jpg?sz=128", "display_name": "Shawn Rupp", "link": "https://stackoverflow.com/users/6201243/shawn-rupp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 217, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505323578, "creation_date": 1505323224, "last_edit_date": 1505323348, "question_id": 46203443, "link": "https://stackoverflow.com/questions/46203443/golang-decode-musicxml", "title": "Golang Decode MusicXML", "body": "<p>I am writing a program that can read in a complete MusicXML file, edit it, and write a new file out. I am using xml.Decode to read the data into a struct for the MusicXML file, but when I run it nothing seems to happen. I tried printing the Decode object to the screen, but it printed a struct full of bytes.</p>\n\n<p>I've looked over the xml package page and I can't seem to find any threads covering the Decode function. I tried using UnMarshall according to some of the pointers I found, but that didn't work (most of those threads were older, so maybe UnMarshall works a bit differently since Decode was implemented?).</p>\n\n<p>Here's the input function:</p>\n\n<pre><code>func ImportXML(infile string) *xml.Decoder {\n    // Reads music xml file to memory\n    f, err := os.Open(infile)\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Error opening music xml file: %v\\n\", err)\n        os.Exit(1)\n    }\n    defer f.Close()\n    fmt.Println(\"\\n\\tReading musicXML file...\")\n    song := xml.NewDecoder(io.Reader(f))\n    // must pass an interface pointer to Decode\n    err = song.Decode(&amp;Score{})\n    if err != nil {\n        fmt.Fprintf(os.Stderr, \"Error assigning musicXML file to struct: %v\\n\", err)\n        os.Exit(1)\n    }\n    return song\n}\n</code></pre>\n\n<p>Here's the first few structs (the rest follow the same format):</p>\n\n<pre><code>type Score struct {\n    Work           Work           `xml:\"work\"`\n    Identification Identification `xml:\"identification\"`\n    Defaults       Defaults       `xml:\"defaults\"`\n    Credit         Credit         `xml:\"credit\"`\n    Partlist       []Scorepart    `xml:\"score-part\"`\n    Part           []Part         `xml:\"part\"`\n}\n\n// Name and other idenfication\ntype Work struct {\n    Number string `xml:\"work-number\"`\n    Title  string `xml:\"work-title\"`\n}\n\ntype Identification struct {\n    Type     string     `xml:\"type,attr\"`\n    Creator  string     `xml:\"creator\"`\n    Software string     `xml:\"software\"`\n    Date     string     `xml:\"encoding-date\"`\n    Supports []Supports `xml:\"supports\"`\n    Source   string     `xml:\"source\"`\n}\n</code></pre>\n\n<p>I greatly appreciate any insight.</p>\n"}, {"tags": ["go", "signals"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505323388, "post_id": 46203379, "comment_id": 79369882, "body": "Is <code>s.done</code> a buffered channel?"}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505323423, "post_id": 46203379, "comment_id": 79369899, "body": "<code>shutdown</code> doesn&#39;t call <code>*Server.Shutdown()</code>, it is <code>*Server.Shutdown()</code> - I&#39;m passing it directly into the signalHandler in the <code>*Server.Run()</code> method."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505323494, "post_id": 46203379, "comment_id": 79369936, "body": "I&#39;ve tried both buffered and unbuffered - same effect."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505323661, "post_id": 46203379, "comment_id": 79370029, "body": "There is no synchronization to wait for Run to complete, so that isn&#39;t guaranteed to ever print, but &quot;all done here&quot; should be written to the log. Is the log output the standard unbuffered stderr?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505323684, "post_id": 46203379, "comment_id": 79370040, "body": "What&#39;s the content of <code>main()</code>? Does it call <code>*Server.Run()</code> as its last operation?"}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "edited": false, "score": 1, "creation_date": 1505323861, "post_id": 46203379, "comment_id": 79370159, "body": "Yes <code>main()</code> calls <code>server.Run()</code> and checks if there is an error then logs it -- that&#39;s the last thing it does."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "edited": false, "score": 0, "creation_date": 1505323941, "post_id": 46203379, "comment_id": 79370205, "body": "I haven&#39;t messed with the <code>log</code> library in anyway, and I&#39;m seeing print lines, so I&#39;m assuming everything is set up with stdout -- no error is returned from shutdown at the moment, so I don&#39;t think I&#39;m missing anything from <code>log.Fatal</code>."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "edited": false, "score": 0, "creation_date": 1505323994, "post_id": 46203379, "comment_id": 79370237, "body": "And so we&#39;re on the same page, I&#39;m issuing the interrupt with CTRL+C - I appreciate you guys thinking about this!"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505324157, "post_id": 46203379, "comment_id": 79370320, "body": "As soon as <code>Run()</code> returns, <code>main()</code> returns, and when <code>main()</code> returns, the program exits."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505324255, "post_id": 46203379, "comment_id": 79370367, "body": "I generally put signal handling in <code>main()</code> itself, rather than in any goroutine, to ensure that <code>main()</code> does not return before I&#39;m done handling post-signal shutdown procedures."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505324269, "post_id": 46203379, "comment_id": 79370377, "body": "@Adrian - ah, I see what you mean - ok, that definitely makes sense."}, {"owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505324320, "post_id": 46203379, "comment_id": 79370406, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/154375/discussion-between-bbengfort-and-adrian\">continue this discussion in chat</a>."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 2, "last_activity_date": 1505324361, "creation_date": 1505324361, "answer_id": 46203742, "question_id": 46203379, "link": "https://stackoverflow.com/questions/46203379/go-process-prematurely-dies-when-capturing-sigint-and-sigterm/46203742#46203742", "title": "Go process prematurely dies when capturing SIGINT and SIGTERM", "body": "<p>The issue is that the call to <code>Run()</code> is the last real op in <code>main()</code>. As soon as <code>Run()</code> returns, <code>main()</code> returns, and when <code>main()</code> returns, the program exits. I generally put signal handling in <code>main()</code> itself, rather than in any goroutine, to ensure that <code>main()</code> does not return before I'm done handling post-signal shutdown procedures.</p>\n\n<p>(From the comments, reposting as an answer now that it's sorted.)</p>\n"}], "owner": {"reputation": 4552, "user_id": 488917, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/fb02e381d0337667d5e94d7ddd93e176?s=128&d=identicon&r=PG", "display_name": "bbengfort", "link": "https://stackoverflow.com/users/488917/bbengfort"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 46203742, "answer_count": 1, "score": 0, "last_activity_date": 1505324361, "creation_date": 1505322987, "last_edit_date": 1505324154, "question_id": 46203379, "link": "https://stackoverflow.com/questions/46203379/go-process-prematurely-dies-when-capturing-sigint-and-sigterm", "title": "Go process prematurely dies when capturing SIGINT and SIGTERM", "body": "<p>I have a fairly straight forward signal handling and cleanup process:</p>\n\n<pre><code>func signalHandler(shutdown func() error) {\n    // Make signal channel and register notifiers for Interupt and Terminate\n    sigchan := make(chan os.Signal, 1)\n    signal.Notify(sigchan, syscall.SIGINT, syscall.SIGTERM)\n\n    // Block until we receive a signal on the channel\n    &lt;-sigchan\n\n    // Shutdown now that we've received the signal\n    if err := shutdown(); err != nil {\n        msg := fmt.Sprintf(\"shutdown error: %s\", err.Error())\n        log.Fatal(msg)\n    }\n\n    log.Println(\"shutdown procedure complete\") \n\n    // Make a clean exit\n    os.Exit(0)\n}\n</code></pre>\n\n<p>This hander is running a go routine from the server:</p>\n\n<pre><code>func (s *Server) Run() error {\n    go signalHandler(s.Shutdown) \n    ...\n\n    &lt;-s.done // block until done \n    log.Println(\"done running!\") \n    return nil \n}\n\nfunc (s *Server) Shutdown() error {\n    s.done &lt;- true \n    log.Println(\"all done here!\") \n    return nil \n}\n</code></pre>\n\n<p>The problem is that the process exits before the \"all done here!\" can be printed to the log, and sometimes \"done running\" prints and other times it doesn't. It seems like there is an <code>os.Exit()</code> call somewhere else (possibly in one of the libraries I'm using?). I do need to clean up connections and delete temporary files etc, and they're not getting cleaned up properly. </p>\n\n<p>Does anyone know how I diagnose where the process is exiting?</p>\n\n<p><strong>Update</strong>: I'm also not seeing \"shutdown procedure complete\" with the addition of that log statement. It appears that the process is terminating before this function is over. </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505321062, "post_id": 46202487, "comment_id": 79368575, "body": "Nowhere in your dockerfile are you adding a testpack package."}, {"owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505321487, "post_id": 46202487, "comment_id": 79368855, "body": "The COPY ./   should take care of it as  it is just a folder above the main folder"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505321716, "post_id": 46202487, "comment_id": 79368975, "body": "If <code>testpack</code> is in the app directory, that can&#39;t be the import path.  The import path is relative to <code>$GOPATH&#47;src</code> -- please see <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}], "answers": [{"comments": [{"owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "edited": false, "score": 0, "creation_date": 1505321370, "post_id": 46202560, "comment_id": 79368783, "body": "Hello Zan,I just have it as a folder testpack in which i have a go file  my Gopath is /root/work/"}], "tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 2, "last_activity_date": 1505330841, "last_edit_date": 1505330841, "creation_date": 1505319998, "answer_id": 46202560, "question_id": 46202487, "link": "https://stackoverflow.com/questions/46202487/docker-golang-package-import-error-import-path-does-not-begin-with-hostname/46202560#46202560", "title": "Docker golang package import error : import path does not begin with hostname", "body": "<p>It is obviously trying to load it from the Internet because it isn't finding \"testpack\" in your GOPATH.</p>\n\n<p>You didn't show us your GOPATH setting or where you copied \"testpack\" to, so other than saying \"It's missing\" that's all I can tell you.</p>\n\n<p>Read <a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths\" rel=\"nofollow noreferrer\">https://golang.org/cmd/go/#hdr-Relative_import_paths</a></p>\n\n<p>Try either</p>\n\n<ul>\n<li><code>import \"./testpack\"</code></li>\n<li>Set GOPATH to \"/go\" in your Dockerfile<br>\n<code>import \"github.com/user/myProject/app/testpack\"</code></li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": false, "score": 0, "last_activity_date": 1506392515, "creation_date": 1506392515, "answer_id": 46416881, "question_id": 46202487, "link": "https://stackoverflow.com/questions/46202487/docker-golang-package-import-error-import-path-does-not-begin-with-hostname/46416881#46416881", "title": "Docker golang package import error : import path does not begin with hostname", "body": "<p>It sounds an awful lot like you're having a problem building your app inside the <code>docker build</code> process. This is likely a dependency issue (you have a dependency installed on your local $GOPATH that is not installed inside the image's go environment). You could install the dependency before the build command in the Dockerfile, but I would pretty seriously consider building the app outside of the Dockerfile, and copying the executable into the image on build.</p>\n\n<p>One of the biggest advantages of Golang is the statically compiled executables. Once it is compiled, you should be able to run it in any equivalent architecture. By default, go will try to compile a static executable but if you would like to enforce it (and you are not doing anything fancy with CGO) you can build with the CGO_ENABLED env var set to 0 like so: <code>CGO_ENABLED=0 go build -o &lt;output.name&gt; &lt;file.to.build&gt;</code></p>\n\n<p>At this point, your Dockerfile becomes much simpler (and SMALLER, check the image size of the resulting images), something like:</p>\n\n<pre><code>FROM scratch\n\n#copy executable into container\nADD &lt;output.name&gt; &lt;output.name&gt;\n\n#set entrypoint\nENTRYPOINT [./&lt;output.name&gt;]\n\n#set exposed port\nEXPOSE 8080\n</code></pre>\n\n<p>This should solve your dependency issue, and make your runtime container much smaller (probably &lt; 20MB), which will decrease build times and increase deployment speed.</p>\n"}], "owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1843, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1506392515, "creation_date": 1505319780, "question_id": 46202487, "link": "https://stackoverflow.com/questions/46202487/docker-golang-package-import-error-import-path-does-not-begin-with-hostname", "title": "Docker golang package import error : import path does not begin with hostname", "body": "<p>I am trying to test docker and go project. Here is my dockerfile</p>\n\n<pre><code>FROM golang\n\nARG app_env\nENV APP_ENV $app_env\n\nCOPY ./ /go/src/github.com/user/myProject/app\nWORKDIR /go/src/github.com/user/myProject/app\n\n\n\nRUN go get ./\nRUN go build\n\nCMD if [ ${APP_ENV} = production ]; \\\nthen \\\napp; \\\nelse \\\ngo get github.com/pilu/fresh &amp;&amp; \\\nfresh; \\\nfi  \nEXPOSE 8080\n</code></pre>\n\n<p>It runs fine. Then i added a package \"testpack\" to my go program.</p>\n\n<pre><code>package main\n\nimport(\n\"fmt\"\n\"time\"\n\"testpack\"\n)\n\nvar now = time.Now()\nvar election = time.Date(2016, time.November, 8, 0, 0, 0, 0, time.UTC)\nfunc main() {\n //get duration between election date and now\ntillElection := election.Sub(now)\n//get duration in nanoseconds\ntoNanoseconds := tillElection.Nanoseconds()\n//calculate hours from toNanoseconds\nhours := toNanoseconds/3600000000000\nremainder := toNanoseconds%3600000000000\n//derive minutes from remainder of hours\nminutes := remainder/60000000000\nremainder = remainder%60000000000\n//derive seconds from remainder of minutes\nseconds := remainder/1000000000 \n//calculate days and get hours left from remainder\ndays := hours/24\nhoursLeft := hours%24\n\nfmt.Printf(\"\\nHow long until the 2016 U.S. Presidential election?\\n\\n%v Days %v Hours %v Minutes %v Seconds\\n\\n\", days, hoursLeft, minutes, seconds)\n\n}\n</code></pre>\n\n<p>Now i ran=>  docker build ./</p>\n\n<p>I am getting an error </p>\n\n<p>package testpack: unrecognized import path \"testpack\" (import path does not begin with hostname)</p>\n\n<p>I tried this <a href=\"https://stackoverflow.com/questions/29774786/error-import-path-does-not-begin-with-hostname-when-building-docker-with-local\">Error &#39;import path does not begin with hostname&#39; when building docker with local package</a>  but couldn't resolve</p>\n\n<p>Any help is appreciated.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1505314127, "post_id": 46200550, "comment_id": 79363938, "body": "Those aren&#39;t valid tags."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1505318319, "post_id": 46200550, "comment_id": 79366963, "body": "The the question this one is a &quot;duplicate&quot; of is not really a duplicate, <i>but</i> both questions are similar enough that the same answer applies to both. Also, not only is your tag syntax wrong (it should be <code>json: &quot;,tagname&quot;</code>), but the tags you used are not valid."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1505326706, "post_id": 46200550, "comment_id": 79371775, "body": "@MiloChristiansen: &quot;tagname&quot; is ambiguous because there is no &quot;tag name&quot;; the tag <i>key</i> is <code>json</code>, and the tag <i>value</i> is the quoted string. The json package uses the first comma separated value as the field name, and the only valid options after that are <code>omitempty</code> and <code>string</code>, so you&#39;re example would also be invalid."}, {"owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "edited": false, "score": 0, "creation_date": 1505326814, "post_id": 46200550, "comment_id": 79371863, "body": "Obvious place holder is obvious. At least if you <i>took the time to RTFM</i>."}], "owner": {"reputation": 119, "user_id": 8226831, "user_type": "registered", "profile_image": "https://graph.facebook.com/1072421991/picture?type=large", "display_name": "Zhivko Angelov", "link": "https://stackoverflow.com/users/8226831/zhivko-angelov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 244, "favorite_count": 0, "closed_date": 1505314229, "answer_count": 0, "score": 0, "last_activity_date": 1505313904, "creation_date": 1505313904, "last_edit_date": 1592644375, "question_id": 46200550, "link": "https://stackoverflow.com/questions/46200550/golang-determine-if-empty-string-or-null-after-json-decode", "closed_reason": "Duplicate", "title": "Golang determine if empty string or null after json decode", "body": "<p>I have the following examples.</p>\n<h1>1</h1>\n<pre><code>package main\n\nimport (\n        &quot;encoding/json&quot;\n        &quot;fmt&quot;\n)\n\ntype JSType struct {\n        Value string `json:value`\n        Empty string `json:empty`\n}\n\nfunc main() {\n        str := `{&quot;value&quot;: &quot;base64&quot;, &quot;empty&quot;: &quot;&quot;, &quot;params&quot;: {}}`\n        var decoded JSType\n        metaBin := []byte(str)\n        json.Unmarshal(metaBin, &amp;decoded)\n\n        fmt.Println(decoded.Empty)\n}\n</code></pre>\n<p>It returns an empty string which is expected.</p>\n<h1>2</h1>\n<pre><code>package main\n\nimport (\n        &quot;encoding/json&quot;\n        &quot;fmt&quot;\n)\n\ntype JSType struct {\n        Value string `json:value`\n        Empty string `json:empty`\n}\n\nfunc main() {\n        str := `{&quot;value&quot;: &quot;base64&quot;, &quot;params&quot;: {}}`\n        var decoded JSType\n        metaBin := []byte(str)\n        json.Unmarshal(metaBin, &amp;decoded)\n\n        fmt.Println(decoded.Empty)\n}\n</code></pre>\n<p>in the 2nd example I removed the 'empty' key from the json and it still returns an empty string. So my question is how can I determine if the valie is &quot;&quot; or not defined (key is missing).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "edited": false, "score": 0, "creation_date": 1505313402, "post_id": 46200343, "comment_id": 79363373, "body": "Although the title is very similar to <a href=\"https://stackoverflow.com/questions/11117382/priority-in-go-select-statement-workaround\" title=\"priority in go select statement workaround\">stackoverflow.com/questions/11117382/&hellip;</a>, this is not a duplicate. The solution of the other question dealt with a consumer/producer problem, not a context."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505313631, "post_id": 46200343, "comment_id": 79363554, "body": "See point 2 in this article.  <a href=\"http://www.tapirgames.com/blog/golang-concurrent-select-implementation\" rel=\"nofollow noreferrer\">tapirgames.com/blog/golang-concurrent-select-implementation</a> , It seems that what you are experiencing is normal <code>select</code> behavior.  If you want more control you might have to reimplement without context and proceed with a <code>consumer&#47;producer</code> solution"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1505313728, "post_id": 46200343, "comment_id": 79363632, "body": "The question is not identical, but the answer is: Select on ctx.Done first and send heartbeat in the default case if not canceled (also selected). Loop. Simple. You cannot force priority in select. Don&#39;t look further, it is undoable. You have to nest selects."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505313776, "post_id": 46200343, "comment_id": 79363674, "body": "@Volker good point, sending to default should do the trick"}, {"owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505314285, "post_id": 46200343, "comment_id": 79364071, "body": "@Volker Can you post this as an answer with a code example? I don&#39;t really see how this should work. If the context is closed during the 1-second timeout, I want to abort as well  (the timeout is configurable and can be a minute or longer)"}], "answers": [{"comments": [{"owner": {"reputation": 7198, "user_id": 1254812, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/78ine.jpg?s=128&g=1", "display_name": "dcow", "link": "https://stackoverflow.com/users/1254812/dcow"}, "edited": false, "score": 0, "creation_date": 1591427241, "post_id": 46200933, "comment_id": 110056291, "body": "I understand the practical nature of your answer, but conceding &quot;race conditions sometimes happen just not very often so it&#39;s okay&quot; doesn&#39;t leave a great taste in the mouth."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7198, "user_id": 1254812, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/78ine.jpg?s=128&g=1", "display_name": "dcow", "link": "https://stackoverflow.com/users/1254812/dcow"}, "edited": false, "score": 0, "creation_date": 1591619268, "post_id": 46200933, "comment_id": 110115556, "body": "@dcow I never said that, so I&#39;m not sure what you&#39;re referring to? There&#39;s no data race here, all communications between goroutines are synchronized by channels."}, {"owner": {"reputation": 7198, "user_id": 1254812, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/78ine.jpg?s=128&g=1", "display_name": "dcow", "link": "https://stackoverflow.com/users/1254812/dcow"}, "edited": false, "score": 0, "creation_date": 1591658674, "post_id": 46200933, "comment_id": 110134389, "body": "I guess I was having trouble digesting your last paragraph. Having a timer fire after it&#39;s been canceled is, strictly, <i>not correct</i> and it&#39;s odd to me that you would design code that&#39;s probably okay even if the timer fires when it&#39;s not supposed to. I&#39;ve been in large codebases like that and it begins to drive you insane. I understand that defensive coding is practical, but your answer doesn&#39;t actually demonstrate a way to do what the OP is asking for, (your <i>probably</i> ordered channel doesn&#39;t really help anything because it just moves the problem around)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 7198, "user_id": 1254812, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/78ine.jpg?s=128&g=1", "display_name": "dcow", "link": "https://stackoverflow.com/users/1254812/dcow"}, "edited": false, "score": 0, "creation_date": 1591710067, "post_id": 46200933, "comment_id": 110154475, "body": "You can&#39;t guarantee order of concurrent operations. You can force them to be sequential using locking, but you still can&#39;t enforce their ordering. If you want strictly ordered operations, they should not be concurrent."}, {"owner": {"reputation": 7198, "user_id": 1254812, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/78ine.jpg?s=128&g=1", "display_name": "dcow", "link": "https://stackoverflow.com/users/1254812/dcow"}, "edited": false, "score": 0, "creation_date": 1591814697, "post_id": 46200933, "comment_id": 110203003, "body": "I don&#39;t think we disagree on that point. However, the question is not about strict ordering. The question is, &quot;if I have two channels that both have data ready to consume, how do I prioritize one channel over the other?&quot; The question stands irrespective of which event actually happened <i>first</i>, which, as you point out, isn&#39;t often meaningful since concurrent events effectively all happen at the same time."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 4, "last_activity_date": 1505315081, "creation_date": 1505315081, "answer_id": 46200933, "question_id": 46200343, "link": "https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement/46200933#46200933", "title": "Force priority of go select statement", "body": "<p>If it is <em>absolutely critical</em> to maintain that priority of operations, you can:</p>\n\n<ul>\n<li>Consume from each channel in a separate goroutine</li>\n<li>Have each of those goroutines write a message to a shared third channel indicating its type</li>\n<li>Have a third goroutine consume from that channel, reading the messages it receives to determine if it is a tick and should <code>sendHeartbeat</code> or if it is a cancel and it should exit</li>\n</ul>\n\n<p>This way, messages received on the other channels will (<em>probably</em> - you can't guarantee order of execution of concurrent routines) come in on the third channel in the order they're triggered, allowing you to handle them appropriately.</p>\n\n<p><em>However</em>, it's worth noting that this is probably not necessary. A <code>select</code> does not guarantee which <code>case</code> will execute <em>if multiple cases succeed simultaneously</em>. That is probably a rare event; the cancel and ticker would both have to fire before either was handled by the <code>select</code>. The vast majority of the time, only one or the other will fire at any given loop iteration, so it will behave exactly as expected. If you can tolerate rare occurrences of firing one additional heartbeat after a cancellation, you're better off keeping the code you have, as it is more efficient and more readable.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 8, "last_activity_date": 1505323223, "last_edit_date": 1505323223, "creation_date": 1505319924, "answer_id": 46202533, "question_id": 46200343, "link": "https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement/46202533#46202533", "title": "Force priority of go select statement", "body": "<p><strong>Note beforehand:</strong></p>\n\n<p>Your example will work as you intend it to, as if the context is already cancelled when <code>sendRegularHeartbeats()</code> is called, the <code>case &lt;-ctx.Done()</code> communication will be the only one ready to proceed and therefore chosen. The other <code>case &lt;-time.After(1 * time.Second)</code> will only be ready to proceed <strong>after 1 second</strong>, so it will not be chosen at first. But to explicitly handle priorities when multiple cases might be ready, read on.</p>\n\n<hr>\n\n<p>Unlike the <code>case</code> branches of a <a href=\"https://golang.org/ref/spec#Switch_statements\" rel=\"noreferrer\"><code>switch</code> statement</a> (where the evaluation order is the order they are listed), there is no priority or any order guaranteed in the <code>case</code> branches of a <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\"><code>select</code> statement</a>.</p>\n\n<p>Quoting from <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"noreferrer\">Spec: Select statements:</a></p>\n\n<blockquote>\n  <p>If one or more of the communications can proceed, <strong>a single one that can proceed is chosen via a uniform pseudo-random selection</strong>. Otherwise, if there is a default case, that case is chosen. If there is no default case, the \"select\" statement blocks until at least one of the communications can proceed.</p>\n</blockquote>\n\n<p>If more communications can proceed, one is chosen randomly. Period.</p>\n\n<p>If you want to maintain priority, you have to do that yourself (manually). You may do it using multiple <code>select</code> statements (subsequent, not nested), listing ones with higher priority in an <em>earlier</em> <code>select</code>, also be sure to add a <code>default</code> branch to avoid blocking if those are not ready to proceed. Your example requires 2 <code>select</code> statements, first one checking <code>&lt;-ctx.Done()</code> as that is the one you want higher priority for.</p>\n\n<p>I also recommend using a single <a href=\"https://golang.org/pkg/time/#Ticker\" rel=\"noreferrer\"><code>time.Ticker</code></a> instead of calling <a href=\"https://golang.org/pkg/time/#After\" rel=\"noreferrer\"><code>time.After()</code></a> in each iteration (<code>time.After()</code> also uses a <code>time.Ticker</code> under the hood, but it doesn't reuse it just \"throws it away\" and creates a new one on the next call).</p>\n\n<p>Here's an example implementation:</p>\n\n<pre><code>func sendRegularHeartbeats(ctx context.Context) {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n\n    for {\n        select {\n        case &lt;-ctx.Done():\n            return\n        default:\n        }\n\n        select {\n        case &lt;-ctx.Done():\n            return\n        case &lt;-ticker.C:\n            sendHeartbeat()\n        }\n    }\n}\n</code></pre>\n\n<p>This will send no heartbeat if the context is already cancelled when <code>sendRegularHeartbeats()</code> is called, as you can check / verify it on the <a href=\"https://play.golang.org/p/rDcAIN0-Mw\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<p>If you delay the <code>cancel()</code> call for 2.5 seconds, then exactly 2 heartbeats will be sent:</p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background())\ngo sendRegularHeartbeats(ctx)\ntime.Sleep(time.Millisecond * 2500)\ncancel()\ntime.Sleep(time.Second * 2)\n</code></pre>\n\n<p>Try this one on the <a href=\"https://play.golang.org/p/_flIJ-xERg\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "edited": false, "score": 0, "creation_date": 1532260674, "post_id": 51296312, "comment_id": 89898297, "body": "You are right - the accepted answer won&#39;t work if <code>sendRegularHeartbeats</code> is called and - later - both channels get closed at the exact same time. However, it will work if both channels are closed before <code>sendRegularHeartbeats</code> is called - which was exactly my specific problem."}, {"owner": {"reputation": 1419, "user_id": 2904103, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d4a83b767e6aa6f4ff7a55ff57b9e6a1?s=128&d=identicon&r=PG&f=1", "display_name": "Haswell", "link": "https://stackoverflow.com/users/2904103/haswell"}, "edited": false, "score": 0, "creation_date": 1603646980, "post_id": 51296312, "comment_id": 114096397, "body": "In that case (of the caveat), we can park the arrival of Done() using a flag, sendHeartbeat() since we have satisfied the ticker and then process the done immediately."}], "tags": [], "owner": {"reputation": 1418, "user_id": 19621, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Vj8zk.jpg?s=128&g=1", "display_name": "Balint Pato", "link": "https://stackoverflow.com/users/19621/balint-pato"}, "is_accepted": false, "score": 9, "last_activity_date": 1531363438, "last_edit_date": 1531363438, "creation_date": 1531360506, "answer_id": 51296312, "question_id": 46200343, "link": "https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement/51296312#51296312", "title": "Force priority of go select statement", "body": "<p>The accepted answer has a wrong suggestion: </p>\n\n<pre><code>func sendRegularHeartbeats(ctx context.Context) {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n\n    for {\n        //first select \n        select {\n        case &lt;-ctx.Done():\n            return\n        default:\n        }\n\n        //second select\n        select {\n        case &lt;-ctx.Done():\n            return\n        case &lt;-ticker.C:\n            sendHeartbeat()\n        }\n    }\n}\n</code></pre>\n\n<p>This doesn't help, because of the following scenario: </p>\n\n<ol>\n<li>both channels are empty</li>\n<li>first select runs </li>\n<li>both channels get a message concurrently</li>\n<li>you are in the same probability game as if you haven't done anything in the first select </li>\n</ol>\n\n<p>An alternative but still imperfect way is to guard against concurrent Done() events (the \"wrong select\") after consuming the ticker event i.e.</p>\n\n<pre><code>func sendRegularHeartbeats(ctx context.Context) {\n    ticker := time.NewTicker(time.Second)\n    defer ticker.Stop()\n\n    for {            \n        //select as usual\n        select {\n        case &lt;-ctx.Done():\n            return\n        case &lt;-ticker.C:\n            //give priority to a possible concurrent Done() event non-blocking way\n            select {\n              case &lt;-ctx.Done():\n              return\n            default:\n            }\n            sendHeartbeat()\n        }\n    }\n}\n</code></pre>\n\n<p>Caveat: the problem with this one is that it allows for \"close enough\" events to be confused - e.g. even though a ticker event arrived earlier, the Done event came soon enough to preempt the heartbeat. There is no perfect solution as of now.</p>\n"}], "owner": {"reputation": 14131, "user_id": 2224996, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/EDCvE.jpg?s=128&g=1", "display_name": "maja", "link": "https://stackoverflow.com/users/2224996/maja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2765, "favorite_count": 7, "accepted_answer_id": 46202533, "answer_count": 3, "score": 13, "last_activity_date": 1531363438, "creation_date": 1505313358, "last_edit_date": 1530012058, "question_id": 46200343, "link": "https://stackoverflow.com/questions/46200343/force-priority-of-go-select-statement", "title": "Force priority of go select statement", "body": "<p><strong>I have the following piece of code:</strong>    </p>\n\n<pre><code>func sendRegularHeartbeats(ctx context.Context) {\n    for {\n        select {\n        case &lt;-ctx.Done():\n            return\n        case &lt;-time.After(1 * time.Second):\n            sendHeartbeat()\n        }\n    }\n}\n</code></pre>\n\n<p>This function is executed in a dedicated go-routine and sends a heartbeat-message every second. The whole process should stop immediately when the context is canceled.</p>\n\n<p><strong>Now consider the following scenario:</strong></p>\n\n<pre><code>ctx, cancel := context.WithCancel(context.Background())\ncancel()\ngo sendRegularHeartbeats(ctx)\n</code></pre>\n\n<p>This starts the heartbeat-routine with a closed context. In such a case, I don't want any heartbeats to be transmitted. So the first <code>case</code> block in the select should be entered immediately.</p>\n\n<p>However, it seems that the order in which <code>case</code> blocks are evaluated is not guaranteed, and that the code sometimes sends a heartbeat message, even though the context is already canceled. </p>\n\n<p><strong>What is the correct way to implement such a behaviour?</strong> </p>\n\n<p>I could add a \"isContextclosed\"-check in the second <code>case</code>, but that looks more like an ugly workaround for the problem.</p>\n"}, {"tags": ["sorting", "go", "slice"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 6, "creation_date": 1505310900, "post_id": 46199397, "comment_id": 79361557, "body": "You compare the X then the Y values. Can you show an example of where you&#39;re having trouble doing this? (<code>sort.Slice</code> isn&#39;t required, you could always do this with the standard <code>sort.Sort</code> too.)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1505312702, "post_id": 46199397, "comment_id": 79362880, "body": "The package even contains an example of how to do it in the general case: <a href=\"https://golang.org/pkg/sort/#example__sortMultiKeys\" rel=\"nofollow noreferrer\">golang.org/pkg/sort/#example__sortMultiKeys</a>. Alternatively you can sort twice: First on Y and then stable (!) on X."}, {"owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "edited": false, "score": 0, "creation_date": 1505314401, "post_id": 46199397, "comment_id": 79364149, "body": "Can you give an example of the expected behavior?"}], "answers": [{"tags": [], "owner": {"reputation": 16065, "user_id": 1561148, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/zN5vT.jpg?s=128&g=1", "display_name": "tgogos", "link": "https://stackoverflow.com/users/1561148/tgogos"}, "is_accepted": false, "score": 1, "last_activity_date": 1505314672, "last_edit_date": 1505314672, "creation_date": 1505312602, "answer_id": 46200067, "question_id": 46199397, "link": "https://stackoverflow.com/questions/46199397/how-do-i-sort-a-go-slice-by-multiple-values/46200067#46200067", "title": "How do I sort a go slice by multiple values?", "body": "<p>Following the first example from here: <a href=\"https://golang.org/pkg/sort/\" rel=\"nofollow noreferrer\">Package sort</a>, I wrote the following...</p>\n\n<p>Inside the <code>Less()</code> function I check if <code>X</code> are equal and if so, I then check <code>Y</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/1EzOiaw_UJ\" rel=\"nofollow noreferrer\">playground demo</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sort\"\n)\n\ntype Item struct {\n    X    int\n    Y    int\n    otherProp    int\n}\n\nfunc (i Item) String() string {\n    return fmt.Sprintf(\"X: %d, Y: %d, otherProp: %d\\n\", i.X, i.Y, i.otherProp)\n}\n\n// ByX implements sort.Interface for []Item based on\n// the X field.\ntype ByX []Item\n\nfunc (o ByX) Len() int           { return len(o) }\nfunc (o ByX) Swap(i, j int)      { o[i], o[j] = o[j], o[i] }\nfunc (o ByX) Less(i, j int) bool { \n    if o[i].X == o[j].X {\n        return o[i].Y &lt; o[j].Y\n    } else {\n        return o[i].X &lt; o[j].X\n    }\n}\n\nfunc main() {\n    items := []Item{\n        {1,2,3},\n        {5,2,3},\n        {3,2,3},\n        {9,2,3},\n        {1,1,3},\n        {1,0,3},\n    }\n\n    fmt.Println(items)\n    sort.Sort(ByX(items))\n    fmt.Println(items)\n\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>[X: 1, Y: 2, otherProp: 3\n X: 5, Y: 2, otherProp: 3\n X: 3, Y: 2, otherProp: 3\n X: 9, Y: 2, otherProp: 3\n X: 1, Y: 1, otherProp: 3\n X: 1, Y: 0, otherProp: 3\n]\n[X: 1, Y: 0, otherProp: 3\n X: 1, Y: 1, otherProp: 3\n X: 1, Y: 2, otherProp: 3\n X: 3, Y: 2, otherProp: 3\n X: 5, Y: 2, otherProp: 3\n X: 9, Y: 2, otherProp: 3\n]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1505312973, "creation_date": 1505312973, "answer_id": 46200199, "question_id": 46199397, "link": "https://stackoverflow.com/questions/46199397/how-do-i-sort-a-go-slice-by-multiple-values/46200199#46200199", "title": "How do I sort a go slice by multiple values?", "body": "<blockquote>\n  <p>[...] is there a simple way to solve this without looping over the slice several times?</p>\n</blockquote>\n\n<p>No. Comparison-based sorting basically always involves looping over the slice at least once plus a bit more. But do not worry: sort.Slice does not do too much work.</p>\n\n<p>What's your question?</p>\n"}], "owner": {"reputation": 318, "user_id": 3310317, "user_type": "registered", "accept_rate": 45, "profile_image": "https://graph.facebook.com/1490518186/picture?type=large", "display_name": "SparklingWater", "link": "https://stackoverflow.com/users/3310317/sparklingwater"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1294, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1505314672, "creation_date": 1505310638, "question_id": 46199397, "link": "https://stackoverflow.com/questions/46199397/how-do-i-sort-a-go-slice-by-multiple-values", "title": "How do I sort a go slice by multiple values?", "body": "<pre><code>type Item struct {\n    Y    int\n    X    int\n    otherProp    int\n}\n</code></pre>\n\n<p>I have a slice of structs like the above one. How do I sort the slice <code>item []Item</code> by the X value first and then by the Y value like in SQLs <code>ORDER BY X,Y</code>?</p>\n\n<p>I see that you can use <code>sort.Slice()</code> since go 1.8 but is there a simple way to solve this without looping over the slice several times?</p>\n"}, {"tags": ["url", "go"], "comments": [{"owner": {"reputation": 3171, "user_id": 4844421, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CtVSq.jpg?s=128&g=1", "display_name": "Paul Boutes", "link": "https://stackoverflow.com/users/4844421/paul-boutes"}, "edited": false, "score": 0, "creation_date": 1505302891, "post_id": 46195423, "comment_id": 79355495, "body": "Everything is ok with this code, for me the output is <code>https:&#47;&#47;some-domain.com&#47;getsomething&#47;?id=1</code>. I have edited your code, because the <a href=\"https://golang.org/pkg/net/url/#Values.Set\" rel=\"nofollow noreferrer\">Set</a> function takes a string as a value."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1505302927, "post_id": 46195423, "comment_id": 79355524, "body": "I tried your program, and the output is as you require (<code>https:&#47;&#47;some-domain.com&#47;getsomething&#47;?id=1</code>). on Playground -  <a href=\"https://play.golang.org/p/M87JQqFb45\" rel=\"nofollow noreferrer\">play.golang.org/p/M87JQqFb45</a>"}, {"owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "edited": false, "score": 0, "creation_date": 1505303737, "post_id": 46195423, "comment_id": 79356087, "body": "I&#39;m sorry, I made my code in this question more simple. Updated."}], "answers": [{"comments": [{"owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "reply_to_user": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "edited": false, "score": 0, "creation_date": 1505305491, "post_id": 46197131, "comment_id": 79357310, "body": "Yop, my bad. Updated."}], "tags": [], "owner": {"reputation": 2028, "user_id": 711336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b48c9965a4ceb5193259840d3abdf38b?s=128&d=identicon&r=PG", "display_name": "s7anley", "link": "https://stackoverflow.com/users/711336/s7anley"}, "is_accepted": true, "score": 6, "last_activity_date": 1505305482, "last_edit_date": 1505305482, "creation_date": 1505304393, "answer_id": 46197131, "question_id": 46195423, "link": "https://stackoverflow.com/questions/46195423/add-query-string-url-in-go/46197131#46197131", "title": "Add query string url in Go", "body": "<p>You can use <a href=\"https://golang.org/pkg/net/url/#URL.ResolveReference\" rel=\"noreferrer\">ResolveReference</a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/url\"\n)\n\nfunc main() {\n    relativeUrl := \"/getsomething/\"\n    u, err := url.Parse(relativeUrl)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    queryString := u.Query()\n    queryString.Set(\"id\", \"1\")\n    u.RawQuery = queryString.Encode()\n\n    baseUrl := \"https://some-domain.com\"\n    base, err := url.Parse(baseUrl)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    fmt.Println(base.ResolveReference(u))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/BIU29R_XBM\" rel=\"noreferrer\">https://play.golang.org/p/BIU29R_XBM</a></p>\n"}], "owner": {"reputation": 7265, "user_id": 3457177, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/bae2e85ed6794ece744ee124d9ac7842?s=128&d=identicon&r=PG&f=1", "display_name": "Vitalii", "link": "https://stackoverflow.com/users/3457177/vitalii"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5281, "favorite_count": 1, "accepted_answer_id": 46197131, "answer_count": 1, "score": 2, "last_activity_date": 1505305482, "creation_date": 1505299414, "last_edit_date": 1505303606, "question_id": 46195423, "link": "https://stackoverflow.com/questions/46195423/add-query-string-url-in-go", "title": "Add query string url in Go", "body": "<p>I need to send http request to <code>https://some-domain.com/getsomething/?id=myID</code> \nI have url and need to add to it a query parameter. Here is my Go code</p>\n\n<pre><code>baseUrl := \"https://some-domain.com\"\nrelativeUrl := \"/getsomething/\"\nurl, _ := url.Parse(baseUrl)\nurl.Path = path.Join(url.Path, relativeUrl)\n\n// add parameter to query string\nqueryString := url.Query()\nqueryString.Set(\"id\", \"1\")\n// add query to url\nurl.RawQuery = queryString.Encode()\n// print it \nfmt.Println(url.String())\n</code></pre>\n\n<p>In output I see this url: <code>https://some-domain.com/getsomething?id=1</code></p>\n\n<p>And this one is required: <code>https://some-domain.com/getsomething/?id=1</code></p>\n\n<p>You can see that there is no <code>/</code> character before <code>?</code>. </p>\n\n<p>Do you know how to fix it without manual string manipulations? </p>\n\n<p><a href=\"https://play.golang.org/p/HsiTzHcvlQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/HsiTzHcvlQ</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 15285, "user_id": 113158, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48b539a26d13f6c9e40081805d8f47ac?s=128&d=identicon&r=PG", "display_name": "Jean Hominal", "link": "https://stackoverflow.com/users/113158/jean-hominal"}, "edited": false, "score": 0, "creation_date": 1505297699, "post_id": 46194718, "comment_id": 79351846, "body": "The implementation of intrinsics can be found in <a href=\"https://github.com/golang/go/blob/master/src/cmd/compile/internal/gc/ssa.go\" rel=\"nofollow noreferrer\">src/cmd/compile/internal/gc/ssa.go</a> and in the <a href=\"https://github.com/golang/go/tree/master/src/cmd/compile/internal/ssa\" rel=\"nofollow noreferrer\">src/cmd/compile/internal/ssa</a> package."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1505298029, "last_edit_date": 1505298029, "creation_date": 1505297381, "answer_id": 46194718, "question_id": 46194588, "link": "https://stackoverflow.com/questions/46194588/is-math-bits-in-go-using-machine-code-instructions/46194718#46194718", "title": "Is math.bits in Go using machine code instructions?", "body": "<p>Yes, as stated in <a href=\"https://golang.org/doc/go1.9#math-bits\" rel=\"nofollow noreferrer\">Go 1.9 Release Notes: New bit manipulation package:</a></p>\n\n<blockquote>\n  <p>Go 1.9 includes a new package, <a href=\"https://golang.org/pkg/math/bits/\" rel=\"nofollow noreferrer\"><code>math/bits</code></a>, with optimized implementations for manipulating bits. <strong>On most architectures, functions in this package are additionally recognized by the compiler and treated as intrinsics for additional performance.</strong></p>\n</blockquote>\n\n<p>Some related / historical github issues:</p>\n\n<p><a href=\"https://github.com/golang/go/issues/18616\" rel=\"nofollow noreferrer\">math/bits: an integer bit twiddling library #18616</a></p>\n\n<p><a href=\"https://github.com/golang/go/issues/17373\" rel=\"nofollow noreferrer\">proposal: cmd/compile: intrinsicify user defined assembly functions #17373</a></p>\n\n<p><a href=\"https://github.com/golang/go/issues/10757\" rel=\"nofollow noreferrer\">Provide a builtin for population counting / hamming distance #10757</a></p>\n"}, {"tags": [], "owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "is_accepted": false, "score": 3, "last_activity_date": 1505298158, "creation_date": 1505298158, "answer_id": 46194988, "question_id": 46194588, "link": "https://stackoverflow.com/questions/46194588/is-math-bits-in-go-using-machine-code-instructions/46194988#46194988", "title": "Is math.bits in Go using machine code instructions?", "body": "<p>Yes it does.  You can see an example of it working here</p>\n\n<p>first compile this</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/bits\"\n)\n\nfunc count(i uint) {\n    fmt.Printf(\"%d has %d length\\n\", i, bits.Len(i))\n}\n\nfunc main() {\n    for i := uint(0); i &lt; 100; i++ {\n        count(i)\n    }\n}\n</code></pre>\n\n<p>Then look at the disassembly.  Note the BSR instruction - Bit Scan Reverse which from the manual: Searches the value in a register or a memory location (second operand) for the most-significant set bit.</p>\n\n<pre><code>0000000000489620 &lt;main.count&gt;:\n  489620:       64 48 8b 0c 25 f8 ff    mov    %fs:0xfffffffffffffff8,%rcx\n  489627:       ff ff \n  489629:       48 3b 61 10             cmp    0x10(%rcx),%rsp\n  48962d:       0f 86 f2 00 00 00       jbe    489725 &lt;main.count+0x105&gt;\n  489633:       48 83 ec 78             sub    $0x78,%rsp\n  489637:       48 89 6c 24 70          mov    %rbp,0x70(%rsp)\n  48963c:       48 8d 6c 24 70          lea    0x70(%rsp),%rbp\n  489641:       48 8b 84 24 80 00 00    mov    0x80(%rsp),%rax\n  489648:       00 \n  489649:       48 0f bd c8             bsr    %rax,%rcx  ; **** Bit scan reverse instruction ***\n  48964d:       48 89 44 24 48          mov    %rax,0x48(%rsp)\n  489652:       48 c7 c0 ff ff ff ff    mov    $0xffffffffffffffff,%rax\n  489659:       48 0f 44 c8             cmove  %rax,%rcx\n  48965d:       48 8d 41 01             lea    0x1(%rcx),%rax\n</code></pre>\n"}], "owner": {"reputation": 17373, "user_id": 75517, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/404fabbcb3e36bac8da7d1904d260ec0?s=128&d=identicon&r=PG", "display_name": "chmike", "link": "https://stackoverflow.com/users/75517/chmike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 378, "favorite_count": 0, "accepted_answer_id": 46194718, "answer_count": 2, "score": 3, "last_activity_date": 1505304040, "creation_date": 1505297019, "last_edit_date": 1505304040, "question_id": 46194588, "link": "https://stackoverflow.com/questions/46194588/is-math-bits-in-go-using-machine-code-instructions", "title": "Is math.bits in Go using machine code instructions?", "body": "<p>The new golang package \"math/bits\" provides useful functions. The source code shows how the function result are computed. </p>\n\n<p>Are these functions replaced by the corresponding processor OP codes when available? </p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "edited": false, "score": 1, "creation_date": 1505310118, "post_id": 46194546, "comment_id": 79360927, "body": "what lib are you using for mongodb?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505312399, "post_id": 46194546, "comment_id": 79362630, "body": "What is the type of <code>j</code>?"}, {"owner": {"reputation": 11, "user_id": 8591328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e8f53852199db58802f0bee3c3bd31?s=128&d=identicon&r=PG&f=1", "display_name": "Ramprasad Reddy", "link": "https://stackoverflow.com/users/8591328/ramprasad-reddy"}, "edited": false, "score": 0, "creation_date": 1505365809, "post_id": 46194546, "comment_id": 79384898, "body": "i am using package gopkg.in/mgo.v2 and j is var j []M"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 8591328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e8f53852199db58802f0bee3c3bd31?s=128&d=identicon&r=PG&f=1", "display_name": "Ramprasad Reddy", "link": "https://stackoverflow.com/users/8591328/ramprasad-reddy"}, "edited": false, "score": 0, "creation_date": 1505367925, "post_id": 46200283, "comment_id": 79385684, "body": "thank you very much mkopriva. I just started coding in Go(1month)"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1505313177, "creation_date": 1505313177, "answer_id": 46200283, "question_id": 46194546, "link": "https://stackoverflow.com/questions/46194546/mongodb-find-query-with-combination-of-or-and-and-in-golang/46200283#46200283", "title": "MongoDB find query with combination of $or and $and in golang", "body": "<p>You're missing one <code>M{</code> before <code>\"$and\"</code> and after you add that don't forget to add another closing brace <code>}</code>.</p>\n\n<p><a href=\"https://play.golang.org/p/ByUQnJSJT5\" rel=\"nofollow noreferrer\">the good</a> and <a href=\"https://play.golang.org/p/MP2CN6L9lq\" rel=\"nofollow noreferrer\">the bad</a> for comparison.</p>\n"}, {"comments": [{"owner": {"reputation": 11, "user_id": 8591328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e8f53852199db58802f0bee3c3bd31?s=128&d=identicon&r=PG&f=1", "display_name": "Ramprasad Reddy", "link": "https://stackoverflow.com/users/8591328/ramprasad-reddy"}, "edited": false, "score": 0, "creation_date": 1505368735, "post_id": 46205925, "comment_id": 79386029, "body": "thank you reticentroot. This is much cleaner than mine and also replacing eq with :"}], "tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 0, "last_activity_date": 1505397911, "last_edit_date": 1505397911, "creation_date": 1505332821, "answer_id": 46205925, "question_id": 46194546, "link": "https://stackoverflow.com/questions/46194546/mongodb-find-query-with-combination-of-or-and-and-in-golang/46205925#46205925", "title": "MongoDB find query with combination of $or and $and in golang", "body": "<p>I don't know what driver your using, but I would probably do something like this..</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"time\"\n\n    mgo \"gopkg.in/mgo.v2\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\nconst (\n    databaseString = \"\"\n)\n\nvar db DataStore\n\ntype DataStore struct {\n    Session *mgo.Session\n}\n\n\n// database\nfunc (ds *DataStore) ConnectToDB() {\n\n    mongoDBDialInfo := &amp;mgo.DialInfo{\n        Addrs:   []string{\"localhost:27017\"},\n        Timeout: 1 * time.Hour,\n    }\n\n    sess, err := mgo.DialWithInfo(mongoDBDialInfo)\n    if err != nil {\n        sess.Refresh()\n        panic(err)\n    }\n    sess.SetMode(mgo.Monotonic, true)\n    db.Session = sess\n}\n\n// J is the expected mongo return object\ntype J struct {\n    ID bson.ObjectId `bson:\"_id,omitempty\" json:\"_id\"`\n    // example data below\n    Status string `bson:\"status\" json:\"status\"`\n}\n\nfunc init() {\n    db.ConnectToDB()\n}\n\nfunc main() {\n    colectionString := \"\"\n    // probably best if this was a mapped mgo struct see above\n    // var j bson.M\n\n    var j J\n\n    // your orignal code\n    // I don't know why you are using $eq couldn't you just do bson.M{\"repair\":\"ac\"}, and bson.M{\"repair\":\"tv\"}\n    conditions := bson.M{\"name\": bson.M{\"$regex\": \"me\"},\n        \"$or\": []bson.M{\n            bson.M{\"repair\": bson.M{\"$eq\": \"ac\"}},\n        },\n        \"$and\": []bson.M{\n            bson.M{\"repair\": bson.M{\"$eq\": \"tv\"}},\n            bson.M{\"phone\": bson.M{\"$gte\": 1091, \"$lte\": 1100}},\n        }}\n\n    err := db.Session.DB(databaseString).C(colectionString).Find(conditions).Sort(\"phone\").Limit(20).All(&amp;j)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p>I would probably also end up creating a separate package for the mongo connection stuff so that I can write wrapper functions around calls, </p>\n\n<pre><code>func FindItem(db *mgo.Session, id string) (data, error) {\n    defer sess.Close()\n    var res data //some data type struct\n    err := sess.DB(\"my db\").C(\"my collection\").Find(bson.M{\"user\": someID}).One(&amp;data)\n    return data, err\n}\n</code></pre>\n\n<p>then I'd be able to do things like this, which allow for concurrency</p>\n\n<pre><code>res, err := packagemain.FindItem(sess.Copy(), someID)\n</code></pre>\n\n<p>and your original code your you where missing <code>}</code> and <code>,</code>.  I suggest you use <code>go vet</code> or an ide which vets the code for you.  Also, <code>mgo</code> is the mongo driver you probably what you want to be using if you're not using it already.</p>\n"}], "owner": {"reputation": 11, "user_id": 8591328, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3e8f53852199db58802f0bee3c3bd31?s=128&d=identicon&r=PG&f=1", "display_name": "Ramprasad Reddy", "link": "https://stackoverflow.com/users/8591328/ramprasad-reddy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3030, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1505397911, "creation_date": 1505296915, "last_edit_date": 1505299527, "question_id": 46194546, "link": "https://stackoverflow.com/questions/46194546/mongodb-find-query-with-combination-of-or-and-and-in-golang", "title": "MongoDB find query with combination of $or and $and in golang", "body": "<p>I want to get rows where:</p>\n\n<pre><code>{repair field has \"ac\" OR {repair is \"tv\" and phone field in range 1091-1100}}\n</code></pre>\n\n<p>I am trying the following query:</p>\n\n<pre><code>type M map[string]interface{}\nconditions := M{\"name\": M{\"$regex\": \"me\"},\n    \"$or\": []M{M{\"repair\": M{\"$eq\": \"ac\"}},\n\"$and\": []M{M{\"repair\": M{\"$eq\": \"tv\"}}, M{\"phone\": M{\"$gte\": 1091, \"$lte\": 1100}}}}}\n    fmt.Println(conditions)\n    err = c.Find(conditions).Sort(\"phone\").Limit(20).All(&amp;j)\n</code></pre>\n\n<p>However, I am getting a compile error:</p>\n\n<pre><code>index must be non-negative integer constant\ncannot use []M literal (type []M) as type M in array or slice literal.\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 5, "creation_date": 1505292186, "post_id": 46192184, "comment_id": 79347792, "body": "There is no possible way to answer this, except to repeat the rules that exported variables must begin with a capital letter.  Beyond that, it&#39;s an opinion-based question."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505294455, "post_id": 46192184, "comment_id": 79349440, "body": "You could ask: How to <i>not</i> export nouns like &quot;Amazon&quot;,&quot;Google&quot; or &quot;Facebook&quot;. This is obviously a non-problem."}], "answers": [{"tags": [], "owner": {"reputation": 2610, "user_id": 563158, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/4b4b8b7fa59c8b18038b56613e342a82?s=128&d=identicon&r=PG", "display_name": "Nebril", "link": "https://stackoverflow.com/users/563158/nebril"}, "is_accepted": false, "score": 2, "last_activity_date": 1505385291, "last_edit_date": 1505385291, "creation_date": 1505291905, "answer_id": 46192761, "question_id": 46192184, "link": "https://stackoverflow.com/questions/46192184/naming-in-go-for-proper-nouns-that-begin-with-a-lower-case-letter/46192761#46192761", "title": "Naming in Go for proper nouns that begin with a lower case letter", "body": "<p>You need to start the name with uppercase letter if you want to have it exported anyway, so I would say that your proposed names would be fine for cases in which you need such names.</p>\n"}], "owner": {"reputation": 1361, "user_id": 7527624, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/2bbc57066ad37a5876653d8e933ad924?s=128&d=identicon&r=PG&f=1", "display_name": "Romper", "link": "https://stackoverflow.com/users/7527624/romper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "closed_date": 1505315586, "answer_count": 1, "score": -3, "last_activity_date": 1505385291, "creation_date": 1505290064, "last_edit_date": 1505292073, "question_id": 46192184, "link": "https://stackoverflow.com/questions/46192184/naming-in-go-for-proper-nouns-that-begin-with-a-lower-case-letter", "closed_reason": "Opinion-based", "title": "Naming in Go for proper nouns that begin with a lower case letter", "body": "<p>How do you name a type if it should be public/exported and the name should stand for: iPhoneX, iOS, eBay, etc.</p>\n\n<p>Do you name them IPhoneX and IOS? or how do you name a type if the name in real world starts with lowercase letter?</p>\n"}, {"tags": ["go", "design-patterns"], "comments": [{"owner": {"reputation": 5180, "user_id": 15527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b09f3f8d813d899d516943cd0220907?s=128&d=identicon&r=PG", "display_name": "Martin Spamer", "link": "https://stackoverflow.com/users/15527/martin-spamer"}, "edited": false, "score": 0, "creation_date": 1505286249, "post_id": 46189914, "comment_id": 79343991, "body": "Hopefully improved the question sufficient to remain open, @sensorario can you verify to ensure I&#39;ve not changed anything important."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505312529, "post_id": 46189914, "comment_id": 79362726, "body": "There is no such thing as &quot;an official list of creational patterns in go&quot;. There&#39;s nothing official about design patterns; they&#39;re just things that people have found they use often enough to give them names."}], "answers": [{"comments": [{"owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "edited": false, "score": 1, "creation_date": 1505287464, "post_id": 46190601, "comment_id": 79344787, "body": "Thank you for your response. I Ryad response but because more focused on my question. Also your response was useful for me. Thank you very much."}], "tags": [], "owner": {"reputation": 5180, "user_id": 15527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9b09f3f8d813d899d516943cd0220907?s=128&d=identicon&r=PG", "display_name": "Martin Spamer", "link": "https://stackoverflow.com/users/15527/martin-spamer"}, "is_accepted": false, "score": 5, "last_activity_date": 1529007278, "last_edit_date": 1529007278, "creation_date": 1505285089, "answer_id": 46190601, "question_id": 46189914, "link": "https://stackoverflow.com/questions/46189914/what-is-the-difference-between-pool-and-prototype-patterns/46190601#46190601", "title": "what is the difference between pool and prototype patterns?", "body": "<p><a href=\"https://en.wikipedia.org/wiki/Software_design_pattern\" rel=\"nofollow noreferrer\">Design Patterns</a> do not exist in isolation, they have relationships of their own.  So for example, an object pool might use a factory or prototype to initially fill the pool or deal with exhaustion.  The objects in that pool might conform to the command pattern, or be examples of the builder pattern.</p>\n\n<p>In practice you cannot possibly know all the details of all patterns, the most important thing to know is the intent.  What the pattern achieves.  When using the pattern the remaining details can and <em>should</em> be taken from a pattern catalogue, over time you will learn some patterns comprehensively and reference others.</p>\n\n<p>A Pattern Catalogue is the a collection of fully documented Design Patterns.  The <a href=\"https://en.wikipedia.org/wiki/Design_Patterns\" rel=\"nofollow noreferrer\">GoF Design Patterns</a> book is probably the most famous Pattern Catalogue, however the book you mention and even github repositories can fulfil the same purpose.</p>\n\n<p><a href=\"https://i.stack.imgur.com/gmqFs.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gmqFs.jpg\" alt=\"enter image description here\"></a></p>\n"}, {"tags": [], "owner": {"reputation": 243, "user_id": 4918500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd905f22682e1f5a2ea10757ed3737b?s=128&d=identicon&r=PG&f=1", "display_name": "RyanD", "link": "https://stackoverflow.com/users/4918500/ryand"}, "is_accepted": true, "score": 6, "last_activity_date": 1505285950, "creation_date": 1505285950, "answer_id": 46190872, "question_id": 46189914, "link": "https://stackoverflow.com/questions/46189914/what-is-the-difference-between-pool-and-prototype-patterns/46190872#46190872", "title": "what is the difference between pool and prototype patterns?", "body": "<p>A Pool helps <strong>limit</strong> the number of new objects allocated; a Prototype is a way of specifying <strong>how</strong> a new object is created.</p>\n\n<p>Object pools are concerned with caching created instances of objects that can be accessed later. Golang has an implementation (<a href=\"https://golang.org/pkg/sync/#Pool\" rel=\"noreferrer\">https://golang.org/pkg/sync/#Pool</a>) which is mainly used for <em>relieving pressure on the garbage collector.</em> The usual way of using a pool follows something like:</p>\n\n<ol>\n<li>ask the pool for an instance</li>\n<li>The pool will either give you back an unused object, or it will allocate a new object, and give the new instance back to you</li>\n<li>You use the object to do whatever you need</li>\n<li>You give the object back to the pool so that another \"client\" can use it.</li>\n</ol>\n\n<p>In the <code>Pool</code> implementation, you'll notice that you can pass a \"creation\" function to specify how the pool should create an instance in Step 2. </p>\n\n<p><code>New func() interface{}</code></p>\n\n<p>This function could simply allocate an empty struct, or it could use a Prototype pattern to clone new instances if the creation logic was complicated.</p>\n\n<p>The Prototype pattern is more focused on abstracting how you can create many \"copies\" of an object from a prototype object. You mainly use this pattern when you want to try and avoid the use of the <code>new</code> keyword.</p>\n"}], "owner": {"reputation": 15582, "user_id": 1420625, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/wJ6T0.png?s=128&g=1", "display_name": "sensorario", "link": "https://stackoverflow.com/users/1420625/sensorario"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 770, "favorite_count": 2, "accepted_answer_id": 46190872, "answer_count": 2, "score": 2, "last_activity_date": 1529007278, "creation_date": 1505282456, "last_edit_date": 1505288787, "question_id": 46189914, "link": "https://stackoverflow.com/questions/46189914/what-is-the-difference-between-pool-and-prototype-patterns", "title": "what is the difference between pool and prototype patterns?", "body": "<p>I've just read the chapter on Creational patterns in the book Design Patterns in golang.  These are:</p>\n\n<ul>\n<li>factory</li>\n<li>abstract factory</li>\n<li>prototype</li>\n<li>singleton</li>\n<li>builder</li>\n</ul>\n\n<p>I've created a repository on github to list all of them. I've looked for other repositories like mine:</p>\n\n<ul>\n<li><a href=\"https://github.com/tmrts/go-patterns/tree/master/creational\" rel=\"nofollow noreferrer\">tmrts/go-patterns</a></li>\n<li><a href=\"https://github.com/yksz/go-design-patterns/tree/master/creation\" rel=\"nofollow noreferrer\">yksz/go-design-patterns</a></li>\n<li><a href=\"https://github.com/jeanphorn/go-design-patterns/tree/master/creational_patterns\" rel=\"nofollow noreferrer\">jeanphorn/go-design-patterns</a></li>\n</ul>\n\n<p>Some list <code>object-pool</code> as a pattern, others <code>simple-factory</code> and <code>factory-method</code>.  Does there exist an official list of creational patterns in go?  Is it important to know the list, or is it more important to know what is possible and be able to use right code in right context? With or without know all the patterns in the world?</p>\n\n<p>And, ... what is the difference between prototype and object pool patterns? They look very similar to me.</p>\n"}, {"tags": ["regex", "shell", "go", "find"], "comments": [{"owner": {"reputation": 17784, "user_id": 1646322, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d9fd7a75e0d8ace7bb3276476786c2c0?s=128&d=identicon&r=PG", "display_name": "Ruslan Osmanov", "link": "https://stackoverflow.com/users/1646322/ruslan-osmanov"}, "edited": false, "score": 0, "creation_date": 1505268878, "post_id": 46187770, "comment_id": 79338272, "body": "You should escape <code>(</code>, <code>|</code>, and <code>)</code> in the Go script as well"}, {"owner": {"reputation": 2212, "user_id": 6935152, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f02ebbd76d4b518363a38bbbdf8e2c7f?s=128&d=identicon&r=PG&f=1", "display_name": "kaza", "link": "https://stackoverflow.com/users/6935152/kaza"}, "edited": false, "score": 0, "creation_date": 1505268884, "post_id": 46187770, "comment_id": 79338273, "body": "I believe the <code>|</code> is interpreted as a shell <code>pipe</code> for <code>find</code> command."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 2212, "user_id": 6935152, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f02ebbd76d4b518363a38bbbdf8e2c7f?s=128&d=identicon&r=PG&f=1", "display_name": "kaza", "link": "https://stackoverflow.com/users/6935152/kaza"}, "edited": false, "score": 0, "creation_date": 1505312637, "post_id": 46187770, "comment_id": 79362837, "body": "@bulbus it is not interpreted as shell pipe, shell does not process the parameters at all when using <code>exec.Command</code>."}], "answers": [{"comments": [{"owner": {"reputation": 91, "user_id": 4872346, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-qsJ2L1f_IQQ/AAAAAAAAAAI/AAAAAAAAAKM/SWTP6M4NInY/photo.jpg?sz=128", "display_name": "tedka", "link": "https://stackoverflow.com/users/4872346/tedka"}, "edited": false, "score": 0, "creation_date": 1611349705, "post_id": 46187963, "comment_id": 116432915, "body": "This is not working with pgrep Linux command when &#39;|&#39; is used inside the pattern expression. Looks like a bug in Golang."}], "tags": [], "owner": {"reputation": 17784, "user_id": 1646322, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/d9fd7a75e0d8ace7bb3276476786c2c0?s=128&d=identicon&r=PG", "display_name": "Ruslan Osmanov", "link": "https://stackoverflow.com/users/1646322/ruslan-osmanov"}, "is_accepted": true, "score": 2, "last_activity_date": 1505270217, "creation_date": 1505270217, "answer_id": 46187963, "question_id": 46187770, "link": "https://stackoverflow.com/questions/46187770/golang-exec-find-command-regex/46187963#46187963", "title": "golang exec find command regex", "body": "<p>By default, <code>find</code> interprets regular expressions as <a href=\"https://www.gnu.org/software/findutils/manual/html_node/find_html/emacs-regular-expression-syntax.html\" rel=\"nofollow noreferrer\"><em>Emacs Regular Expressions</em></a>, where, particularly, the alteration operator is <code>\\|</code>, and grouping is performed with backslashes followed by parentheses <code>\\(</code>, <code>\\)</code>. So you should either use the correct Emacs Regular Expressions syntax, or use alternative regular expressions syntax with the help of <code>-regextype</code> option, where these operators are not prefixed with backslashes, e.g.:</p>\n\n<pre><code>find -regextype 'posix-extended' -regex '.*(type-a|type-b)/os.*'\n</code></pre>\n\n<p>Since backslash in Go is used as an escape character in strings, you should escape the backslash character itself with an extra backslash, e.g.:</p>\n\n<pre><code>cmd := exec.Command(\"/usr/bin/find\", \"/opt/system/versions\",\n                    \"-mindepth\",  \"3\", \"-maxdepth\",  \"3\",\n                    \"-regex\",  \".*\\\\(type-a\\\\|type-b\\\\)\\\\/os.*\")\n</code></pre>\n"}], "owner": {"reputation": 231, "user_id": 760038, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cd07a1e2d0e9295a2918edf15635a91e?s=128&d=identicon&r=PG", "display_name": "Vinod", "link": "https://stackoverflow.com/users/760038/vinod"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1045, "favorite_count": 0, "closed_date": 1505477886, "accepted_answer_id": 46187963, "answer_count": 1, "score": 1, "last_activity_date": 1505270217, "creation_date": 1505268527, "last_edit_date": 1505269287, "question_id": 46187770, "link": "https://stackoverflow.com/questions/46187770/golang-exec-find-command-regex", "closed_reason": "Duplicate", "title": "golang exec find command regex", "body": "<p>I am trying to write a <code>find</code> command (shell command below) in go:</p>\n\n<pre><code>find . -mindepth 3 -maxdepth 3 -regex '.*\\(type-a\\|type-b\\)\\/os.*'\n</code></pre>\n\n<p>Here is the go snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n\n    cmd := exec.Command(\"/usr/bin/find\", \"/opt/system/versions\",\n                        \"-mindepth\",  \"3\", \"-maxdepth\",  \"3\",\n                        \"-regex\",  \".*(type-a|type-b)/os.*\")\n\n    var out bytes.Buffer\n    var stderr bytes.Buffer\n    cmd.Stdout = &amp;out\n    cmd.Stderr = &amp;stderr\n\n    err:= cmd.Run()\n    if err != nil {\n        fmt.Println(fmt.Sprint(err) + \": \" + stderr.String())\n        return\n    }\n    fmt.Println(\"Directory contents : \", out.String())\n}\n</code></pre>\n\n<p>It works fine if I search for just <code>type-a</code> (or just <code>type-b</code>). Does not work when I search for either <code>type-a</code> or <code>type-b</code> (the shell command works just fine). What did I get wrong in the regex pattern fed into <code>Command</code>?</p>\n\n<p>When I escape the <code>(</code>, <code>|</code> and <code>)</code> using <code>\\</code> , go complains about the escape sequence - <code>unknown escape sequence: (</code>:</p>\n\n<pre><code>    cmd := exec.Command(\"/usr/bin/find\", \"/opt/system/versions\",\n                        \"-mindepth\",  \"3\", \"-maxdepth\",  \"3\",\n                        \"-regex\",  \".*\\(type-a\\|type-b\\)/os.*\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505312766, "post_id": 46187181, "comment_id": 79362926, "body": "At what point would you expect that loop to exit? It has no conditions and no break, therefor it will run forever."}, {"owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "reply_to_user": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1505314174, "post_id": 46187181, "comment_id": 79363983, "body": "@scott-stensland, the edit is incorrect. Since I have in infinite while loop the code will never reach &quot;done &lt;- true return&quot;. I was hoping to break the loop from if more{} since I need to keep call the url until no more record returns."}, {"owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505314232, "post_id": 46187181, "comment_id": 79364032, "body": "@adrian,  I was hoping to break the loop from if more{} since I need to keep call the url until no more record returns."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505314701, "post_id": 46187181, "comment_id": 79364401, "body": "Not that loop; the <code>for {j++;jobs&lt;-j}</code> loop does not reference <code>more</code> at all, it just runs forever with no exit condition."}], "answers": [{"tags": [], "owner": {"reputation": 418, "user_id": 4893628, "user_type": "registered", "profile_image": "https://graph.facebook.com/1761892217370604/picture?type=large", "display_name": "Daniela Petruzalek", "link": "https://stackoverflow.com/users/4893628/daniela-petruzalek"}, "is_accepted": false, "score": 2, "last_activity_date": 1505271591, "last_edit_date": 1505271591, "creation_date": 1505264258, "answer_id": 46187286, "question_id": 46187181, "link": "https://stackoverflow.com/questions/46187181/go-program-stuck-in-a-loop/46187286#46187286", "title": "GO program stuck in a loop", "body": "<p>By definition a for loop without conditions is an infinite loop. Unless you put some logic to break this infinite loop, you'll never get out of it.</p>\n\n<p>In your playground your comment implies that you want to send 3 jobs. You should change your for loop accordingly:</p>\n\n<pre><code>for j := 0; j &lt; 3; j++ {\n  jobs &lt;- j\n  fmt.Println(\"sent job\", j)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": false, "score": 1, "last_activity_date": 1505315268, "creation_date": 1505315268, "answer_id": 46200995, "question_id": 46187181, "link": "https://stackoverflow.com/questions/46187181/go-program-stuck-in-a-loop/46200995#46200995", "title": "GO program stuck in a loop", "body": "<p>This is a simplified version of a worker.. Its not very useful for production level traffic, but should serve as a simple example, there are tons of them :-)</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"sync\"\n)\n\ntype worker struct {\n    jobs chan int\n    wg   *sync.WaitGroup\n}\n\nfunc main() {\n    w := worker{\n        jobs: make(chan int, 5), // I only want to work on 5 jobs at any given time\n        wg:   new(sync.WaitGroup),\n    }\n\n    for i := 0; i &lt; 3; i++ {\n        w.wg.Add(1)\n        go func(i int) {\n            defer w.wg.Done()\n            w.jobs &lt;- i\n        }(i)\n\n    }\n\n    // wait in the background so that i can move to line 34 and start consuming my job queue\n    go func() {\n        w.wg.Wait()\n        close(w.jobs)\n    }()\n\n    for job := range w.jobs {\n        log.Println(\"Got job, I should do something with it\", job)\n    }\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "is_accepted": true, "score": 0, "last_activity_date": 1505522646, "creation_date": 1505522646, "answer_id": 46249027, "question_id": 46187181, "link": "https://stackoverflow.com/questions/46187181/go-program-stuck-in-a-loop/46249027#46249027", "title": "GO program stuck in a loop", "body": "<p>This was I was looking for. I have a number generator in an infinite while loop. And the program exits on some condition, in this example, it is on the j value, but it can also be something else. </p>\n\n<p><a href=\"https://play.golang.org/p/Ud4etTjrmx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Ud4etTjrmx</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\n\nfunc jobs(job chan int) {\n    i := 1\n    for {\n        job &lt;- i\n        i++\n    }\n}\n\nfunc main() {\n    jobsChan := make(chan int, 5)\n\n\n    done := false\n    j := 0\n\n    go jobs(jobsChan)\n    for !done {\n        j = &lt;-jobsChan\n        if j &lt; 20 {\n            fmt.Printf(\"job %d\\n\", j)\n        } else {\n            done = true\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 466, "favorite_count": 0, "accepted_answer_id": 46249027, "answer_count": 3, "score": -1, "last_activity_date": 1505522646, "creation_date": 1505263369, "last_edit_date": 1505304165, "question_id": 46187181, "link": "https://stackoverflow.com/questions/46187181/go-program-stuck-in-a-loop", "title": "GO program stuck in a loop", "body": "<pre><code>// _Closing_ a channel indicates that no more values\n// will be sent on it. This can be useful to communicate\n// completion to the channel's receivers.\n\npackage main\n\nimport \"fmt\"\n\n// In this example we'll use a `jobs` channel to\n// communicate work to be done from the `main()` goroutine\n// to a worker goroutine. When we have no more jobs for\n// the worker we'll `close` the `jobs` channel.\nfunc main() {\n    jobs := make(chan int, 5)\n    done := make(chan bool)\n\n    // Here's the worker goroutine. It repeatedly receives\n    // from `jobs` with `j, more := &lt;-jobs`. In this\n    // special 2-value form of receive, the `more` value\n    // will be `false` if `jobs` has been `close`d and all\n    // values in the channel have already been received.\n    // We use this to notify on `done` when we've worked\n    // all our jobs.\n\n    for i := 1; i &lt;= 3; i++ {\n        go func() {\n            for {\n                j, more := &lt;-jobs\n                if more {\n                    fmt.Println(\"received job\", j)\n                } else {\n                    fmt.Println(\"received all jobs\")\n                    done &lt;- true\n                    return\n                }\n            }\n        }()\n    }\n\n    // This sends 3 jobs to the worker over the `jobs`\n    // channel, then closes it.\n    j := 0\n    for {\n        j++\n        jobs &lt;- j\n        fmt.Println(\"sent job\", j)\n    }\n    close(jobs)\n    fmt.Println(\"sent all jobs\")\n\n    // We await the worker using the\n    // [synchronization](channel-synchronization) approach\n    // we saw earlier.\n    &lt;-done\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/x28R_g8ftS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/x28R_g8ftS</a></p>\n\n<p>What I'm trying to do is get all the responses from a paginated url endpoint. jobs is a channel storing the page number. I have a function in if more{} checking for empty reponse  and I have </p>\n\n<pre><code>done &lt;- true\nreturn\n</code></pre>\n\n<p>I thought this would close the go routine. \nBut, the page generator <code>for{j++; jobs &lt;- j}</code> is causing it to get stuck in a loop. Any idea how this can be resolved?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505251800, "post_id": 46185540, "comment_id": 79334041, "body": "Your syntax for the method pointer call is wrong; if you use a pointer to a method <i>on an instance</i>, you needn&#39;t pass the instance to it again as a parameter."}, {"owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505252850, "post_id": 46185540, "comment_id": 79334458, "body": "Indeed. Thanks @Adrian. Every example I could find online only showed parameter less members so I was not seeing it was my mistake."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505251900, "post_id": 46185593, "comment_id": 79334077, "body": "Demonstration of all the permutations (instance method pointer, type method pointer, with and without args): <a href=\"https://play.golang.org/p/2eQEUrFBBI\" rel=\"nofollow noreferrer\">play.golang.org/p/2eQEUrFBBI</a>"}, {"owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505253027, "post_id": 46185593, "comment_id": 79334530, "body": "Yep. Works. I am still getting used to the capitalization. Uppercase for types, lowercase for instances is what I am accustomed to seeing. It is easy to mix up type Foo and instance variable Foo. Thanks for the demonstration."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 4, "last_activity_date": 1505252048, "last_edit_date": 1505252048, "creation_date": 1505251745, "answer_id": 46185593, "question_id": 46185540, "link": "https://stackoverflow.com/questions/46185540/in-go-is-it-possible-to-have-a-pointer-to-a-member-function-method-that-takes-pa/46185593#46185593", "title": "In Go is it possible to have a pointer to a member function/method that takes parameters?", "body": "<p><strong>Using method expressions</strong></p>\n\n<p>In this case, we get a reference from the type, then you need to pass an instance as the first argument.</p>\n\n<pre><code>fn2 := (*Foo).Op2\nf := &amp;Foo{}\nfn2(f, 2)\n</code></pre>\n\n<p><strong>Referencing an instance method</strong></p>\n\n<p>In this case, the instance is already bind to the method and you can just provide the arguments:</p>\n\n<pre><code>fn2 := f.Op2\nfn2(2)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/e0gUIHzj7Z\" rel=\"nofollow noreferrer\">https://play.golang.org/p/e0gUIHzj7Z</a></p>\n"}], "owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 0, "accepted_answer_id": 46185593, "answer_count": 1, "score": 1, "last_activity_date": 1505252048, "creation_date": 1505251482, "question_id": 46185540, "link": "https://stackoverflow.com/questions/46185540/in-go-is-it-possible-to-have-a-pointer-to-a-member-function-method-that-takes-pa", "title": "In Go is it possible to have a pointer to a member function/method that takes parameters?", "body": "<p>If I have</p>\n\n<pre><code>type Foo struct {\n    // some data\n}\n\nfunc (f *Foo) Op1() bool {\n    // perform operation and return a bool\n}\n\nfunc (f *Foo) Op2(other int) bool {\n    // perform a different operation using internal data\n    // and the passed in parameter(s)\n}\n</code></pre>\n\n<p>I know I can store a pointer to the first method.</p>\n\n<pre><code>fn := f.Op1\n</code></pre>\n\n<p>and call it</p>\n\n<pre><code>if fn(f) { // do something }\n</code></pre>\n\n<p>But what if I want to do the same with <code>Op2</code>?\nI am currently faking it by defined a wrapper function which takes a <code>Foo</code> and the values and calls the operation. But that is a lot of boiler plate code.</p>\n"}, {"tags": ["go", "channels"], "comments": [{"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 3, "creation_date": 1505246724, "post_id": 46184525, "comment_id": 79331807, "body": "You can increase the buffer size, which will only delay the problem, or add the default to skip the backed-up animal. The empty default case is fairly common for cases like this."}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "edited": false, "score": 3, "creation_date": 1505246777, "post_id": 46184525, "comment_id": 79331831, "body": "Yeah, it may feel weird, but that&#39;s the best way to do what you seem to be trying to do."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505249242, "post_id": 46184525, "comment_id": 79332919, "body": "@JimB is this a busy loop? Each loop iteration targets a different consumer."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505249817, "post_id": 46184525, "comment_id": 79333195, "body": "@Adrian: you&#39;re right, for some reason I read hat as an empty for loop."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1505283870, "post_id": 46184525, "comment_id": 79342547, "body": "It&#39;s the right way to check if the channel is blocked and then move on if it is."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1505290298, "post_id": 46184525, "comment_id": 79346547, "body": "&quot;having an empty default feels weird to me&quot;. Just get used to it."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 2, "last_activity_date": 1505294161, "creation_date": 1505294161, "answer_id": 46193502, "question_id": 46184525, "link": "https://stackoverflow.com/questions/46184525/what-is-the-preferred-approach-to-do-non-blocking-select-statement-with-channels/46193502#46193502", "title": "What is the preferred approach to do non-blocking select statement with channels in Go", "body": "<blockquote>\n  <p>However, having an empty default feels weird to me.</p>\n</blockquote>\n\n<p>It shouldn't.</p>\n\n<blockquote>\n  <p>Is there a better way to do this?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>You're already doing it properly.  The empty default isn't a \"do nothing\" statement, it's a \"don't block\" statement. This is just the semantics of how a non-blocking select works. </p>\n"}], "owner": {"reputation": 461, "user_id": 7359470, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3d7fb653bc3eb067f9dd9b2019e653bd?s=128&d=identicon&r=PG&f=1", "display_name": "mofury", "link": "https://stackoverflow.com/users/7359470/mofury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 46193502, "answer_count": 1, "score": 1, "last_activity_date": 1505294161, "creation_date": 1505246643, "last_edit_date": 1505247515, "question_id": 46184525, "link": "https://stackoverflow.com/questions/46184525/what-is-the-preferred-approach-to-do-non-blocking-select-statement-with-channels", "title": "What is the preferred approach to do non-blocking select statement with channels in Go", "body": "<p>Here's an example with what I want to do</p>\n\n<pre><code>func (zoo *Zoo) feedAnimals(food Food) {\n    for animal := range zoo.Animals {\n        select {\n        case animal.EatChan() &lt;- food:\n        default: // Do nothing\n        }\n    }\n}\n</code></pre>\n\n<p>Animal's <code>EatChan</code> has a small buffer, some times rate of which <code>feedAnimals</code> is called more often than the rate of which some animals can consume the food. When that happens, if I omit <code>default</code> statement in the <code>select</code> block, the select statement will block the <code>for loop</code> and other hungry animals can't get their food. So I'd rather skip the animal that is full (i.e. the channel has reached its capacity.)</p>\n\n<p>However, having an empty <code>default</code> feels weird to me. Is there a better way to do this?  </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-data-pipeline", "data-pipeline"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505245832, "post_id": 46184057, "comment_id": 79331405, "body": "It looks like list-runs is a feature of the CLI, not the API. There is no ListRuns action in the DataPipeline SDK. From a quick perusal of the source of the CLI, I <i>think</i> they&#39;re just doing some fancy filtering &amp; formatting of results of ListObjects, but I&#39;m not sure enough to post as an answer."}, {"owner": {"reputation": 51, "user_id": 8599594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d44f6cb27f6b9fe92e5fa62abc66aec6?s=128&d=identicon&r=PG&f=1", "display_name": "the1337beauty", "link": "https://stackoverflow.com/users/8599594/the1337beauty"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1506090083, "post_id": 46184057, "comment_id": 79693508, "body": "@Adrian - So far I&#39;ve been able to check status of actions by using DescribeObjects"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 8599594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d44f6cb27f6b9fe92e5fa62abc66aec6?s=128&d=identicon&r=PG&f=1", "display_name": "the1337beauty", "link": "https://stackoverflow.com/users/8599594/the1337beauty"}, "is_accepted": true, "score": 0, "last_activity_date": 1544550015, "creation_date": 1544550015, "answer_id": 53729525, "question_id": 46184057, "link": "https://stackoverflow.com/questions/46184057/checking-status-of-aws-data-pipeline-using-go-sdk/53729525#53729525", "title": "Checking status of AWS Data Pipeline using Go SDK", "body": "<p>FYI in case anyone else comes across this, this is how I resolved this:</p>\n\n<p>Golang AWS API call to describe objects/actions of a data pipeline, returns true if all objects are finished</p>\n\n<pre><code>    func awsDescribeObjects(pipelineID, region string, objects []string) bool {\n        var r Object\n        var s []string\n        var f bool\n        svc := datapipeline.New(session.New(&amp;aws.Config{Region: aws.String(region)}))\n        input := &amp;datapipeline.DescribeObjectsInput{\n            PipelineId: aws.String(pipelineID),\n            ObjectIds:  aws.StringSlice(objects),\n        }\n        result, err := svc.DescribeObjects(input)\n        if err != nil {\n            fmt.Println(\"error describing pipeline objects: \", err)\n            f = false\n            return f\n        }\n        //fmt.Println(\"original result: \", result)\n        result2 := re.ReplaceAllString(result.String(), `\"$1\"$2`) //add \"\" around keys\n        result3 := re1.ReplaceAllString(result2, `$3$2`)          //remove key and string/ref value from fields struct\n        result4 := strings.Replace(result3, \"@\", \"\", -1)          //remove @ from keys and values\n        result5 := re2.ReplaceAllString(result4, `$1$3$5$7$9`)    //remove \"\" from timestamps\n        result6 := re3.ReplaceAllString(result5, `$1,`)           // remove {} from fields struct\n        json.Unmarshal([]byte(result6), &amp;r)\n        // fmt.Printf(\"R: %+v\\n\", r)\n        p := r.PipelineObjects\n        // fmt.Printf(\"P: %+v\\n\", p)\n        for i := range p {\n            for m := range p[i].Fields {\n                fmt.Printf(\"%v STATUS: %v\\n\", p[i].Name, p[i].Fields[m].Status)\n                s = append(s, p[i].Fields[m].Status)\n                if p[i].Fields[m].Status != \"FINISHED\" {\n                    f = false\n                } else {\n                    f = true\n                }\n            }\n            // fmt.Println(\"bool: \", f)\n        }\n        return f\n    }\n</code></pre>\n\n<p>my main go function</p>\n\n<pre><code>    func main() {\n        if *action == \"describe\" {\n            obj := strings.Split(*object, \",\")\n\n            for i := 0; i &lt;= 20; i++ {\n                f := awsDescribeObjects(*pipeline, *region, obj)\n                fmt.Printf(\"%v - Status Check %v - Finished?: %v\\n\", time.Now(), i, f)\n                if f == true {\n                    fmt.Println(\"FINISHED describing pipeline complete\")\n                    break\n                }\n                time.Sleep(5 * time.Minute)\n                if i == 20 {\n                    fmt.Println(\"TIME OUT - describe pipeline timed out, max time reached\")\n                    os.Exit(1)\n                }\n            }\n        }\n    }\n</code></pre>\n\n<p>Shell script with go executable:</p>\n\n<pre><code>#PIPELINE 1\necho \"Starting Pipeline 1...\"\necho ./runpipeline.linux -region $REGION1 -pipeline-id $PIPELINEID1 -action activate\necho sleep 1m\necho ./runpipeline.linux -region $REGION1 -pipeline-id $PIPELINEID1 -action describe -object ShellCommandActivityObj\necho \"Pipeline 1 complete\"\n#PIPELINE 2\necho \"Starting Pipeline 2...\"\necho ./runpipeline.linux -region $REGION2 -pipeline-id $PIPELINEID2 -action activate\necho sleep 1m\necho ./runpipeline.linux -region $REGION2 -pipeline-id $PIPELINEID2 -action describe -object ShellCommandActivityObj,CliActivity\necho \"Pipeline 2 complete\"\necho \"FINISHED\"\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 8599594, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d44f6cb27f6b9fe92e5fa62abc66aec6?s=128&d=identicon&r=PG&f=1", "display_name": "the1337beauty", "link": "https://stackoverflow.com/users/8599594/the1337beauty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 0, "accepted_answer_id": 53729525, "answer_count": 1, "score": 1, "last_activity_date": 1544550015, "creation_date": 1505244728, "question_id": 46184057, "link": "https://stackoverflow.com/questions/46184057/checking-status-of-aws-data-pipeline-using-go-sdk", "title": "Checking status of AWS Data Pipeline using Go SDK", "body": "<p>Situation: I have 2 data pipelines that run on-demand. Pipeline B cannot run until Pipeline A has completed. I'm trying to automate running both pipelines in a single script/program but I'm unsure how to do all of this in Go.</p>\n\n<p>I have some Go code that activates a data pipeline:</p>\n\n<pre><code>func awsActivatePipeline(pipelineID, region string) (*datapipeline.ActivatePipelineOutput, error) {\n    svc := datapipeline.New(session.New(&amp;aws.Config{Region: aws.String(region)}))\n    input := &amp;datapipeline.ActivatePipelineInput{\n        PipelineId: aws.String(pipelineID),\n    }\n    result, err := svc.ActivatePipeline(input)\n    if err != nil {\n        fmt.Println(\"error activating pipeline: \", err)\n    }\n    fmt.Println(result)\n    return result, nil\n}\n</code></pre>\n\n<p>After activating, I want to be able to monitor that pipeline and determine when it's finished so that I can run a second pipeline. Similar to the <code>list-runs</code> CLI command but I'm not sure what the corresponding Go function would be.</p>\n\n<pre><code>$ aws datapipeline list-runs --region us-west-2 --pipeline-id df-EXAMPLE\n       Name                                                Scheduled Start      Status                 \n       ID                                                  Started              Ended              \n---------------------------------------------------------------------------------------------------\n   1.  EC2ResourceObj                                      2017-09-12T17:49:55  FINISHED               \n       @EC2ResourceObj_2017-09-12T17:49:55                 2017-09-12T17:49:58  2017-09-12T17:56:52\n\n   2.  Installation                                        2017-09-12T17:49:55  FINISHED               \n       @Installation_@ShellCommandActivityObj_2017-09-12T  2017-09-12T17:49:57  2017-09-12T17:54:09\n\n   3.  S3OutputLocation                                    2017-09-12T17:49:55  FINISHED               \n       @S3OutputLocation_2017-09-12T17:49:55               2017-09-12T17:49:58  2017-09-12T17:54:50\n\n   4.  ShellCommandActivityObj                             2017-09-12T17:49:55  FINISHED               \n       @ShellCommandActivityObj_2017-09-12T17:49:55        2017-09-12T17:49:57  2017-09-12T17:54:49\n</code></pre>\n\n<p>So once all actions are marked 'FINISHED', I want to activate my second pipeline. What's the best way to accomplish this?</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1505240834, "post_id": 46183083, "comment_id": 79329071, "body": "The JSON is just a plain array.. then I say your doing it to the way... there aren&#39;t any &quot;headers&quot; to unmarshal directly into.  The JSON array would have to be sent as a JSON object to unmarshal directly into a struct."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 3, "creation_date": 1505241646, "post_id": 46183083, "comment_id": 79329479, "body": "If style is the issue you can always create a custom type with a custom unmarshaller   <a href=\"http://choly.ca/post/go-json-marshalling/\" rel=\"nofollow noreferrer\">choly.ca/post/go-json-marshalling</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1505301787, "post_id": 46191912, "comment_id": 79354701, "body": "I already modified  <code>v</code> from <code>[]float64</code> to <code>[]interface{}</code>... but to parse an int I have to do something like <code>t.BidSize = int64(v[2].(float64))</code>... otherwise the compilation fails with error <code>interface conversion: interface {} is float64, not int64</code>... even if the REST response actually contains an int in third position (i.e. 30).  ."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 0, "creation_date": 1505302385, "post_id": 46191912, "comment_id": 79355128, "body": "@j3d: Mmm, to do proper int unmarshaling will be more complex then. How large are these integers? If they&#39;re smaller than 2^52, then using <code>float64</code> should not result in a loss of precision. If they can be larger than that, then you can parse each array element individually; it&#39;s more complex, but I can update the answer with an example if it would be helpful."}, {"owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "edited": false, "score": 1, "creation_date": 1505303169, "post_id": 46191912, "comment_id": 79355695, "body": "No, those integers are smaller than 2^52."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": true, "score": 1, "last_activity_date": 1505303812, "last_edit_date": 1505303812, "creation_date": 1505289261, "answer_id": 46191912, "question_id": 46183083, "link": "https://stackoverflow.com/questions/46183083/how-to-parse-a-json-array-into-a-struct/46191912#46191912", "title": "How to parse a JSON array into a Struct", "body": "<p>You're on the right track, but a more usable solution would be to create a custom unmarshaler:</p>\n\n<pre><code>func (t *Tick) UnmarshalJSON(data []byte) error {\n    var v []float64\n    if err := json.Unmarshal(data, &amp;v); err != nil {\n        return err\n    }\n    t.FlashReturnRate = v[0]\n    t.Bid = v[1]\n    t.BidSize = int64(v[2]) // Is this an int? Your sample data suggests it is, your code suggests it isn't.\n    // ... etc\n\n    return nil\n}\n</code></pre>\n\n<p>Now you can unmarshal directly to your <code>Tick</code> data type as:</p>\n\n<pre><code>var tick Tick\nif err := json.Unmarshal(res.Body, &amp;tick); err != nil {\n    // Handle error\n}\n</code></pre>\n"}], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 46191912, "answer_count": 1, "score": 0, "last_activity_date": 1505303812, "creation_date": 1505240362, "last_edit_date": 1505288859, "question_id": 46183083, "link": "https://stackoverflow.com/questions/46183083/how-to-parse-a-json-array-into-a-struct", "title": "How to parse a JSON array into a Struct", "body": "<p>Given the following REST call...</p>\n\n<pre><code>https://api.bitfinex.com/v2/ticker/fUSD\n</code></pre>\n\n<p>... I get back the following result as a JSON array:</p>\n\n<pre><code>[0.00073995,0.00067,30,10082128.5775703,0.000664,2,191337.1001453,-0.00003991,-0.057,0.00066009,94710166.80102274,0,0]\n</code></pre>\n\n<p>Here below is how I parse the result:</p>\n\n<pre><code>const (\n    URL = \"https://api.bitfinex.com/v2/ticker/f\"\n)\n\ntype Tick struct {\n    FlashReturnRate float64\n    Bid             float64\n    BidPeriod       int64\n    BidSize         float64\n    Ask             float64\n    AskPeriod       int64\n    AskSize         float64\n    DailyChange     float64\n    DailyChangePerc float64\n    LastPrice       float64\n    Volume          float64\n    High            float64\n    Low             float64\n}\n\n...\n\nfunc (s *TickerService) Get(curry string) (*Tick, error) {\n    req, err = http.NewRequest(\"GET\", URL + curry, nil)\n    if err != nil {\n        return nil, err\n    }\n\n    resp, err := http.DefaultClient.Do(req); if err != nil {\n        return nil, err\n    }\n\n    defer resp.Body.Close()\n\n    var v []float64\n    err = json.Unmarshal(resp.Body, &amp;v)\n    if err != nil {\n        return nil, err\n    }\n\n    t := Tick{\n        FlashReturnRate: v[0],\n        Bid:             v[1],\n        BidSize:         v[2],\n        BidPeriod:       int64(v[3]),\n        Ask:             v[4],\n        AskSize:         v[5],\n        AskPeriod:       int64(v[6]),\n        DailyChange:     v[7],\n        DailyChangePerc: v[8],\n        LastPrice:       v[9],\n        Volume:          v[10],\n        High:            v[11],\n        Low:             v[12],\n    }\n\n    return &amp;t, nil\n}\n</code></pre>\n\n<p>Is there a better way to build the <code>Tick</code> object?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 7, "creation_date": 1505237546, "post_id": 46182338, "comment_id": 79327539, "body": "It&#39;s not needed there, but the author may have put it there to indicate they are willfully ignoring the error value."}, {"owner": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505237964, "post_id": 46182338, "comment_id": 79327740, "body": "okay great, does a single blank identifier ignore all return assignments when applied like this?  I thought it would only ignore one of them as in the example of bad practice, <code>fi, _ := os.Stat(path)</code>"}, {"owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "edited": false, "score": 1, "creation_date": 1505238438, "post_id": 46182338, "comment_id": 79327978, "body": "I can not honestly vote for closure of this question. The OP is looking for insight into best practices."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1505238441, "post_id": 46182338, "comment_id": 79327979, "body": "You can only assign one thing per blank identifier, and <code>Decode</code> only returns one value. It may usually be bad practice to ignore errors, but in some cases the error simply doesn&#39;t matter; perhaps not decoding anything is the error regardless. I think the only really issue here is lack of comments in the code."}], "answers": [{"comments": [{"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 2, "creation_date": 1505238136, "post_id": 46182489, "comment_id": 79327820, "body": "This answer seems to contain less information than the comment it references."}, {"owner": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "edited": false, "score": 0, "creation_date": 1505238139, "post_id": 46182489, "comment_id": 79327821, "body": "thats exactly it, day 1 noob here, as per my comment above does a single blank identifier ignore all return assignments when applied like this? I thought it would only ignore one of them as in the example of bad practice in effective go <code>fi, _ := os.Stat(path)</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "edited": false, "score": 2, "creation_date": 1505238523, "post_id": 46182489, "comment_id": 79328020, "body": "@pushplaybang: both this and the original question could be answered faster by simply trying them."}], "tags": [], "owner": {"reputation": 15202, "user_id": 183110, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e56fee2230943ae9886f84233cc640b8?s=128&d=identicon&r=PG", "display_name": "John Giotta", "link": "https://stackoverflow.com/users/183110/john-giotta"}, "is_accepted": true, "score": 1, "last_activity_date": 1505237920, "creation_date": 1505237920, "answer_id": 46182489, "question_id": 46182338, "link": "https://stackoverflow.com/questions/46182338/why-would-we-use-blank-identifiers-in-go/46182489#46182489", "title": "Why would we use blank identifiers in Go?", "body": "<p>I'm assuming you're learning golang and asking because you can't identify why this example used this practice.</p>\n\n<p>As @JimB mentioned in comments, the example writer didn't need to do this they're simply ignoring the Error return.</p>\n"}, {"comments": [{"owner": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "edited": false, "score": 0, "creation_date": 1574122896, "post_id": 58914594, "comment_id": 104111166, "body": "thank you, while this is informative, it doesn&#39;t specifically speak to the question asked."}, {"owner": {"reputation": 462, "user_id": 5457306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vw1zh.jpg?s=128&g=1", "display_name": "Vallie", "link": "https://stackoverflow.com/users/5457306/vallie"}, "reply_to_user": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "edited": false, "score": 1, "creation_date": 1574158711, "post_id": 58914594, "comment_id": 104122628, "body": "I agree, I came here looking at the title of the question. Thought I could contribute something and it would help someone"}], "tags": [], "owner": {"reputation": 462, "user_id": 5457306, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vw1zh.jpg?s=128&g=1", "display_name": "Vallie", "link": "https://stackoverflow.com/users/5457306/vallie"}, "is_accepted": false, "score": 1, "last_activity_date": 1574080159, "creation_date": 1574080159, "answer_id": 58914594, "question_id": 46182338, "link": "https://stackoverflow.com/questions/46182338/why-would-we-use-blank-identifiers-in-go/58914594#58914594", "title": "Why would we use blank identifiers in Go?", "body": "<p>The blank identifier <code>_</code> can be used to strictly provide the keys in a struct too. See <a href=\"https://developer20.com/golang-tips-and-trics-v/\" rel=\"nofollow noreferrer\">this</a> for reference </p>\n\n<p>Without enforcing</p>\n\n<pre><code>type SomeStruct struct {\n  FirstField string\n  SecondField bool\n}\n\nmyStruct := SomeStruct{\"\", false}\n</code></pre>\n\n<p>Enforcing to mention the key for the value (Removes the dependency of ordering the values)</p>\n\n<pre><code>type SomeSturct struct {\n  FirstField string\n  SecondField bool\n  _ struct{}\n}\n\n// COMPILATION ERROR\nmyStruct := SomeSturct{\"\", false}\n</code></pre>\n\n<p>The above will give the error <code>too few values in SomeSturct literal</code></p>\n"}], "owner": {"reputation": 3159, "user_id": 1424399, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4382058a42be60198883a4c9fdbc0779?s=128&d=identicon&r=PG", "display_name": "bigmadwolf", "link": "https://stackoverflow.com/users/1424399/bigmadwolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 46182489, "answer_count": 2, "score": 1, "last_activity_date": 1574080159, "creation_date": 1505237310, "last_edit_date": 1505237422, "question_id": 46182338, "link": "https://stackoverflow.com/questions/46182338/why-would-we-use-blank-identifiers-in-go", "title": "Why would we use blank identifiers in Go?", "body": "<p>I'm finding the use of the blank identifier a little hard to understand. I've looked at <a href=\"https://golang.org/doc/effective_go.html#blank\" rel=\"nofollow noreferrer\">effective go</a> and understand most of the use cases they describe but then looking at a tutorial I came across this in a route handler function:</p>\n\n<pre><code>var person Person\n_ = json.NewDecoder(req.Body).Decode(&amp;person)\n</code></pre>\n\n<p>in the first line we create a new empty variable of type Person (a struct previously defined) and then I assume that</p>\n\n<ul>\n<li><code>&amp;person</code> is passing the person var in by reference,</li>\n<li>to be filled with data by the <code>Decode</code> function</li>\n</ul>\n\n<p>this function then goes on to perform a few more tasks before encoding and returning a json response.</p>\n\n<p>Why do we need have the decode assigned to a blank identifier? Couldn't we just run <code>json.NewDecoder(req.Body).Decode(&amp;person)</code> ? if we can't, why not?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 3, "creation_date": 1505236522, "post_id": 46182136, "comment_id": 79327051, "body": "See <a href=\"https://medium.com/@Martynas/formatting-date-and-time-in-golang-5816112bf098\" rel=\"nofollow noreferrer\">medium.com/@Martynas/&hellip;</a> ... RFC3339 expects you to pass in a time that looks like this <code>2006-01-02T15:04:05Z07:00</code>, your want your format to be this <code>2006-01-02</code>"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505236924, "post_id": 46182136, "comment_id": 79327227, "body": "Use this example as well <a href=\"https://goplay.space/#3S0VIw93On\" rel=\"nofollow noreferrer\">goplay.space/#3S0VIw93On</a>"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505286714, "post_id": 46182136, "comment_id": 79344250, "body": "@reticentroot: if you are answering the question why use a comment to do it? This way the question stays unanswered unless somebody copies your answer..."}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 7824574, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a639be4c9ecc139065fbc6b12b87e6a9?s=128&d=identicon&r=PG&f=1", "display_name": "typetetris", "link": "https://stackoverflow.com/users/7824574/typetetris"}, "is_accepted": true, "score": 3, "last_activity_date": 1505310116, "creation_date": 1505310116, "answer_id": 46199198, "question_id": 46182136, "link": "https://stackoverflow.com/questions/46182136/how-to-convert-yyyy-mm-dd-string-format-to-timestamp-in-golang/46199198#46199198", "title": "How to convert YYYY-MM-DD string format to timestamp in Golang?", "body": "<p>As already suggested, use this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"time\"\n)\n\nconst layout = \"2006-01-02\"\n\nfunc main() {\n    snapshot := \"2017-07-25\"\n    t, err := time.Parse(layout, snapshot)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(t)\n}\n</code></pre>\n"}], "owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1564, "favorite_count": 0, "accepted_answer_id": 46199198, "answer_count": 1, "score": -1, "last_activity_date": 1505310116, "creation_date": 1505236466, "last_edit_date": 1505239548, "question_id": 46182136, "link": "https://stackoverflow.com/questions/46182136/how-to-convert-yyyy-mm-dd-string-format-to-timestamp-in-golang", "title": "How to convert YYYY-MM-DD string format to timestamp in Golang?", "body": "<p>I'm sorry if this is a trivial question. This is currently what I have.</p>\n\n<pre><code>    snapshot = \"2017-07-25\"\n    snapshotFilter := \" AND cdate = %s\"\n    snapshot, err := time.Parse(time.RFC3339, snapshot)\n    if err != nil {\n        log.Fatal(err)\n    }\n    queryFilter = queryFilter + fmt.Sprintf(snapshotFilter, pq.FormatTimestamp(snapshot))\n</code></pre>\n\n<p>This is the output</p>\n\n<pre><code>2017/09/12 09:59:34 parsing time \"2017-07-25\" as \"2006-01-02T15:04:05Z07:\": cannot parse \"\" as \"T\".\n</code></pre>\n\n<p>I'm trying to get <code>snapshot</code> in the correct format to insert it into a postgres query. </p>\n\n<p>I'm using the </p>\n\n<pre><code>\"database/sql\"\n\"time\"\n\"github.com/gorilla/mux\"\n\"github.com/lib/pq\"\n</code></pre>\n\n<p>EDIT: is seemed that this was more of an issue with postgres and the <code>2017-07-25</code> just needed to be in quotes and put inside the postgres query string.</p>\n"}, {"tags": ["go", "x509"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505242703, "post_id": 46182134, "comment_id": 79330011, "body": "how you know 30:A1:48:01:DB:2B:C3:EE:D3:84:54:4B:66:AF:0C:4C:66:F7:69:47 is the correct one?"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505243370, "post_id": 46182134, "comment_id": 79330286, "body": "Running your code I get <code>4ADD06161BBCF668B576F581B6BB621ABA5A812F</code>, which match, looking at google the google cert with chrome tools I get <code>4A DD 06 16 1B BC F6 68 B5 76 F5 81 B6 BB 62 1A BA 5A 81 2F</code>  They match."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1505243651, "post_id": 46182134, "comment_id": 79330422, "body": "Also see <a href=\"https://security.stackexchange.com/questions/41578/why-does-google-ssl-cert-change-so-frequently\" title=\"why does google ssl cert change so frequently\">security.stackexchange.com/questions/41578/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 71, "user_id": 8599003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3157b884b4e8ffe3b6a13c023926ed7?s=128&d=identicon&r=PG&f=1", "display_name": "Georgi Ivanov", "link": "https://stackoverflow.com/users/8599003/georgi-ivanov"}, "is_accepted": false, "score": 2, "last_activity_date": 1505300009, "creation_date": 1505300009, "answer_id": 46195631, "question_id": 46182134, "link": "https://stackoverflow.com/questions/46182134/extract-subject-key-identifier-with-golang/46195631#46195631", "title": "Extract Subject Key Identifier with golang", "body": "<p>The problem was that I did not specify the SNI when checking with openssl.\nThe conclusion is: Always set SNI in ClientHello</p>\n\n<pre><code>$ echo q |openssl s_client -showcerts -connect mail.google.com:443 -servername mail.google.com -showcerts 2&gt;/dev/null | sed -n '/-----BEGIN/,/-----END/p' | openssl x509 -text -noout | grep -P -A1 'Subject Key'\n            X509v3 Subject Key Identifier: \n                4E:16:C1:4E:FC:D4:6B:0A:09:F8:09:0F:1C:00:27:8C:6F:99:2C:65\n$ echo q |openssl s_client -showcerts -connect mail.google.com:443 -showcerts 2&gt;/dev/null | sed -n '/-----BEGIN/,/-----END/p' | openssl x509 -text -noout | grep -P -A1 'Subject Key' \n           X509v3 Subject Key Identifier: \n                30:A1:48:01:DB:2B:C3:EE:D3:84:54:4B:66:AF:0C:4C:66:F7:69:47\n$\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 8599003, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b3157b884b4e8ffe3b6a13c023926ed7?s=128&d=identicon&r=PG&f=1", "display_name": "Georgi Ivanov", "link": "https://stackoverflow.com/users/8599003/georgi-ivanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 599, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1505300009, "creation_date": 1505236466, "question_id": 46182134, "link": "https://stackoverflow.com/questions/46182134/extract-subject-key-identifier-with-golang", "title": "Extract Subject Key Identifier with golang", "body": "<p>I am trying to use golang crypto/tls library to extract SubjectKeyIdentifiers for all the Certificates in a Chain that a server returns.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"fmt\"\n)\n\nfunc main() {\n    conn, err := tls.Dial(\"tcp\", \"mail.google.com:443\", &amp;tls.Config{\n        InsecureSkipVerify: true,\n    })\n    if err != nil {\n            panic(\"failed to connect: \" + err.Error())\n        }\n    state := conn.ConnectionState()\n        if err != nil {\n                    panic(\"failed to get ConnState: \" + err.Error())\n            }\n    for _, cert := range state.PeerCertificates {\n        fmt.Printf(\"%s\\n\", cert.Subject.CommonName)\n        fmt.Printf(\"%X\\n\", cert.SubjectKeyId)\n    }\n    conn.Close()\n}\n</code></pre>\n\n<p>As per the docs SubjectKeyId should have already been populated with ASN1 parsed data. \nThe problem is that I get\n4E16C14EFCD46B0A09F8090F1C00278C6F992C65 </p>\n\n<p>while the real one is </p>\n\n<p>30:A1:48:01:DB:2B:C3:EE:D3:84:54:4B:66:AF:0C:4C:66:F7:69:47</p>\n\n<p>What I am doing wrongly here ?</p>\n"}, {"tags": ["github", "go", "time"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505234345, "post_id": 46181419, "comment_id": 79325925, "body": "The question is a little confusing - <code>int</code> is not atomic, hence the need for <a href=\"https://golang.org/pkg/sync/atomic/\" rel=\"nofollow noreferrer\"><code>sync&#47;atomic</code></a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505234513, "post_id": 46181419, "comment_id": 79326014, "body": "Not only is <code>int</code> not atomic, there are no &quot;atomic&quot; types in Go. The only atomic operators are in <code>sync&#47;atomic</code>."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505234534, "post_id": 46181419, "comment_id": 79326025, "body": "Channels are the only atomic base type in Go."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505235598, "post_id": 46181419, "comment_id": 79326592, "body": "@Adrian: <code>sending</code> and <code>receiving</code> are &quot;atomic&quot; operations, but reading and writing channel values are not. That often triggers race conditions when users try to replace channel values concurrently to alter the cases in select blocks."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505235671, "post_id": 46181419, "comment_id": 79326627, "body": "Fair point, only channel ops are atomic, not the values themselves."}], "answers": [{"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1505238200, "post_id": 46181623, "comment_id": 79327848, "body": "This is call a &quot;type conversion&quot;. There are no casts in Go."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1505238614, "post_id": 46181623, "comment_id": 79328057, "body": "Yes, it&#39;s called type conversion in the spec, but type conversion to an underlying type has no practical difference from what is called type casting in every other language on Earth."}, {"owner": {"reputation": 280, "user_id": 2126299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8be3d0dec844c6ea692789359c55d7?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/2126299/adam"}, "edited": false, "score": 0, "creation_date": 1505252562, "post_id": 46181623, "comment_id": 79334355, "body": "@Adrian That&#39;s the ticket. Thanks."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1505234286, "creation_date": 1505234286, "answer_id": 46181623, "question_id": 46181419, "link": "https://stackoverflow.com/questions/46181419/type-wrapping-of-non-atomic-types-in-golang/46181623#46181623", "title": "Type wrapping of non-atomic types in golang", "body": "<p><a href=\"https://golang.org/ref/spec#Types\" rel=\"nofollow noreferrer\">Named types</a> do not inherit any methods from the underlying type (indeed there is no inheritance at all in Go); you must cast to the underlying type to call any methods from that type:</p>\n\n<pre><code>(time.Time(e.CreatedAt)).Format(\"2006-01-02 15:04:05.999999+00\")\n</code></pre>\n"}], "owner": {"reputation": 280, "user_id": 2126299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8be3d0dec844c6ea692789359c55d7?s=128&d=identicon&r=PG", "display_name": "Adam", "link": "https://stackoverflow.com/users/2126299/adam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 736, "favorite_count": 0, "accepted_answer_id": 46181623, "answer_count": 1, "score": 0, "last_activity_date": 1505251593, "creation_date": 1505233573, "last_edit_date": 1505251593, "question_id": 46181419, "link": "https://stackoverflow.com/questions/46181419/type-wrapping-of-non-atomic-types-in-golang", "title": "Type wrapping of non-atomic types in golang", "body": "<p>I'm new to golang and am trying to understand a code example of type wrapping for the \"non-atomic\" type time.Time.</p>\n\n<p>The type extension in question is from the Go client for GDAX on github, <a href=\"https://github.com/preichenberger/go-coinbase-exchange\" rel=\"nofollow noreferrer\">go-coinbase-exchange project</a>.</p>\n\n<p>The expected behavior would be for Time variables from the project (coinbase.Time), which are of <code>type Time time.Time</code> (as defined in the project's <a href=\"https://github.com/preichenberger/go-coinbase-exchange/blob/master/time.go\" rel=\"nofollow noreferrer\">time.go</a> file) to behave something like the following example for extending the \"atomic\" type <code>int</code> (from <a href=\"http://blog.riff.org/2014_07_19_golang_fun_adding_methods_to_primitive_types\" rel=\"nofollow noreferrer\">blog.riff.org</a> in that they might follow a kind of \"inheritance\" from the base type for functions like Time.format (from <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">golang's standard implementation of time</a>:</p>\n\n<pre><code>package main\nimport \"fmt\"\ntype Int int\n\nfunc (i Int) Add(j Int) Int {\n  return i + j\n}\n\nfunc main() {\n  i := Int(5)\n  j := Int(6)\n  fmt.Println(i.Add(j))\n  fmt.Println(i.Add(j) + 12)\n}\n</code></pre>\n\n<p>But if I modify the code example from the project's <code>List Account Ledger</code> example found in <a href=\"https://github.com/preichenberger/go-coinbase-exchange/blob/master/README.md\" rel=\"nofollow noreferrer\">Readme.md</a> to include a print function which might otherwise give me a human-readable view of the CreatedAt struct variables (as follows), I get a compiler error saying that \"type <code>coinbase.Time</code> has no field or method <code>Format</code>\":</p>\n\n<pre><code>for _, e := range ledger {\n    print(\"Entry Creation: \")\n    fmt.Printf(e.CreatedAt.Format(\"2006-01-02 15:04:05.999999+00\"))\n}\n</code></pre>\n\n<p>The expected behavior inside the <code>for</code> loop would be for it to print the ledger entries in a human-readable format. I can get the contents of the structs, but I'm not really sure how to then use the resulting <code>wall</code>, <code>ext</code> and <code>loc</code> members.</p>\n\n<p>For example, inserting <code>fmt.Printf(\"%#v\", e.CreatedAt)</code> into the <code>for</code> loop gives me a representation of the time that looks something like this:</p>\n\n<p><code>coinbase.Time{wall:0x3015a123, ext:63612345678, loc:(*time.Location)(nil)}\n{806986000 63638738354 &lt;nil&gt;}</code></p>\n\n<p>I can also see that <code>wall</code> is of type <code>uint64</code>, that <code>ext</code> is of type <code>int64</code> and that <code>loc</code> is just GMT/UTC=0 by formatting the variable as a string because <code>fmt.Printf(\"%s\", e.CreatedAt)</code> gives me output which is similar to the following:</p>\n\n<p><code>{%!s(uint64=712345678) %!s(int64=63612345678) %!s(*time.Location=&lt;nil&gt;)}</code></p>\n\n<p>It seems like I'm missing something. I've requested further information through <a href=\"https://github.com/preichenberger/go-coinbase-exchange/issues/24\" rel=\"nofollow noreferrer\">issues tab on github</a>, but maybe this is a nube question. So I'm not sure how quick the response time would be, and I'm interested in the more general case for extending non-atomic types in go.</p>\n"}, {"tags": ["go", "go-guru"], "answers": [{"comments": [{"owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505234176, "post_id": 46181460, "comment_id": 79325832, "body": "Thanks. I missed the &quot;const s&quot; in my search and forgot that <code>const</code> does not use &#39;:=&#39; so my grep did not find it."}, {"owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505234259, "post_id": 46181460, "comment_id": 79325878, "body": "I also discovered that GOPATH insists on having dir/{src,bin} and the code in question has to be under src/. So while i was setting GOPATH to look in the current directory I was being ignored. Once I fixed this guru was also able to find the location. Grumble."}, {"owner": {"reputation": 15285, "user_id": 113158, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48b539a26d13f6c9e40081805d8f47ac?s=128&d=identicon&r=PG", "display_name": "Jean Hominal", "link": "https://stackoverflow.com/users/113158/jean-hominal"}, "reply_to_user": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505234286, "post_id": 46181460, "comment_id": 79325895, "body": "By the way, <code>:=</code> does not work outside functions - cf. <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">the language specification</a>: &quot;Short variable declarations may appear only inside functions.&quot;"}], "tags": [], "owner": {"reputation": 15285, "user_id": 113158, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/48b539a26d13f6c9e40081805d8f47ac?s=128&d=identicon&r=PG", "display_name": "Jean Hominal", "link": "https://stackoverflow.com/users/113158/jean-hominal"}, "is_accepted": true, "score": 5, "last_activity_date": 1505233703, "creation_date": 1505233703, "answer_id": 46181460, "question_id": 46181296, "link": "https://stackoverflow.com/questions/46181296/where-is-s-defined-in-https-github-com-workiva-go-datastructures-tree-master/46181460#46181460", "title": "Where is &#39;s&#39; defined in https://github.com/Workiva/go-datastructures/tree/master/bitarray?", "body": "<p>It is defined in <code>go-datastructures/bitarray/block.go</code>:</p>\n\n<pre><code>// s denotes the size of any element in the block array.\n// For a block of uint64, s will be equal to 64\n// For a block of uint32, s will be equal to 32\n// and so on...\nconst s = uint64(unsafe.Sizeof(block(0)) * 8)\n</code></pre>\n\n<p>As the variable <code>s</code> was not defined in the function, and it was not prefixed by a package name or alias, it had to be a global (variable or constant) of the <code>bitarray</code> package.</p>\n\n<p>Once that was known, I went through every file in the folder <code>go-datastructures/bitarray</code> that was not suffixed with <code>_test</code> and I looked for a top-level declaration for <code>s</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505234950, "post_id": 46181562, "comment_id": 79326244, "body": "I mentioned guru in my question and that it was not working. If it worked for you then you could have pointed out that my GOPATH was probably wrong."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "edited": false, "score": 0, "creation_date": 1505236935, "post_id": 46181562, "comment_id": 79327233, "body": "@SeanPerry I didn&#39;t know why it didn&#39;t work for you, I just tried it with Atom and it worked, so all I implied was that with proper arguments it is capable of answering your question."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1505283703, "last_edit_date": 1505283703, "creation_date": 1505234052, "answer_id": 46181562, "question_id": 46181296, "link": "https://stackoverflow.com/questions/46181296/where-is-s-defined-in-https-github-com-workiva-go-datastructures-tree-master/46181562#46181562", "title": "Where is &#39;s&#39; defined in https://github.com/Workiva/go-datastructures/tree/master/bitarray?", "body": "<p>It's defined in <a href=\"https://github.com/Workiva/go-datastructures/blob/master/bitarray/block.go#L33\" rel=\"nofollow noreferrer\">go-datastructures/bitarray/block.go, line #33</a>:</p>\n\n<pre><code>const s = uint64(unsafe.Sizeof(block(0)) * 8)\n</code></pre>\n\n<p>\"Modern\" IDEs with Go support usually have the ability to go to the definition of a symbol / identifier your cursor is at or what you click on. For example in <a href=\"https://atom.io/\" rel=\"nofollow noreferrer\">Atom</a> with the <a href=\"https://atom.io/packages/go-plus\" rel=\"nofollow noreferrer\">Go-plus</a> plugin you can go to the definition by holding down the <kbd>CTRL</kbd> key while clicking.</p>\n\n<p>These IDEs use the <a href=\"https://github.com/rogpeppe/godef\" rel=\"nofollow noreferrer\">godef</a> open source tool to find the definition source file and line, you may also use it directly. You can find the godef documentation here: <a href=\"https://godoc.org/github.com/rogpeppe/godef\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/rogpeppe/godef</a></p>\n\n<p>Another tool, <a href=\"https://godoc.org/golang.org/x/tools/cmd/guru\" rel=\"nofollow noreferrer\">guru</a> is also capable of tracking the definition of it. Both guru and godef works in Atom, and were able to jump to block.go, to the definition of <code>s</code>. But it's much easier to use an \"armored\" IDE and just do a simple click.</p>\n\n<p>Also note that the success of using <code>grep</code> and patterns is limited, as variable and constant declarations can be grouped, and the following are also valid declarations:</p>\n\n<pre><code>var (\n    longer = 3\n    s      = uint64(3)\n)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>var (\n    s      = someExpression\n    longer = 3\n)\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>const (\n    p = uint64(iota)\n    s\n    x\n)\n</code></pre>\n"}], "owner": {"reputation": 3558, "user_id": 1732563, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/b51d68c0232ecc9de87719a203ccb428?s=128&d=identicon&r=PG", "display_name": "Sean Perry", "link": "https://stackoverflow.com/users/1732563/sean-perry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 66, "favorite_count": 0, "accepted_answer_id": 46181460, "answer_count": 2, "score": 1, "last_activity_date": 1505283703, "creation_date": 1505233171, "last_edit_date": 1505234857, "question_id": 46181296, "link": "https://stackoverflow.com/questions/46181296/where-is-s-defined-in-https-github-com-workiva-go-datastructures-tree-master", "title": "Where is &#39;s&#39; defined in https://github.com/Workiva/go-datastructures/tree/master/bitarray?", "body": "<p>I do not see where <code>s</code> is defined. Guru will not tell me. All I get is \"no object for identifier\" but it knows about the <code>k</code> right beside it. Here is a snippet that is typical of the linked code:</p>\n\n<pre><code>func getIndexAndRemainder(k uint64) (uint64, uint64) {\n    return k / s, k % s\n}\n</code></pre>\n\n<p>The one letter variable name definitely makes it harder to grep around for. I have looked for the usual suspects: <code>var s uint64</code>, <code>s := ...</code>, and nothing. Clearly it needs to be a global value defined somewhere.</p>\n\n<p>This leaves me with two questions:</p>\n\n<ol>\n<li>Where is <code>s</code> coming from?</li>\n<li>How would I find it without asking here?</li>\n</ol>\n\n<p>EDIT:\nFor others who stumble on this.</p>\n\n<p>Guru failed me because I did not checkout the source for the package under a proper Go workspace by placing the git clone under /some/path/src and setting the <code>GOPATH</code> to /some/path. So while I thought <code>GOPATH=. guru definition s</code> would work, the <code>GOPATH</code> was ignored. guru could find <code>k</code> because it is in the file but it did not know how to look in other files.</p>\n\n<p>My grep failed cause <code>const</code> uses a simple <code>=</code> not a <code>:=</code>. I will remember this when grepping in the future.</p>\n"}, {"tags": ["json", "string", "go", "unicode", "control-characters"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1505227911, "post_id": 46179431, "comment_id": 79321671, "body": "Efficient in what sense? Fast? Lowest power consumption? Least number of CPU instructions? Runs on Nacl? Least duration/Watt? Least number of cache misses? Easy to understand? Most efficient during debugging? Easiest to change of the JSON spec changes?"}, {"owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505227986, "post_id": 46179431, "comment_id": 79321733, "body": "@Volker Yes. Would be useful to know/see/document all the options and tradeoffs."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505228531, "post_id": 46179431, "comment_id": 79322165, "body": "&quot;All the options and tradeoffs&quot; is pretty broad. If you have a particular optimization target that might be narrow enough to answer on SO."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 2, "last_activity_date": 1505232072, "creation_date": 1505232072, "answer_id": 46180965, "question_id": 46179431, "link": "https://stackoverflow.com/questions/46179431/go-whats-the-best-way-to-detect-invalid-json-string-characters/46180965#46180965", "title": "Go: What&#39;s the best way to detect invalid JSON string characters?", "body": "<p>If you are looking to identify control characters (as in the answers to the Java question you pointed to), you might want to use <code>unicode.IsControl</code> for a simpler solution.</p>\n\n<p><a href=\"https://golang.org/pkg/unicode/#IsControl\" rel=\"nofollow noreferrer\">https://golang.org/pkg/unicode/#IsControl</a></p>\n\n<pre><code>func containsControlChar(s string) bool {\n    for _, c := range s {\n        if unicode.IsControl(c) {\n            return true\n        }\n    }\n    return false\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/Pr_9mmt-th\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Pr_9mmt-th</a></p>\n"}], "owner": {"reputation": 8200, "user_id": 79202, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/397f829eea921e02e35c37c22f9e6d3b?s=128&d=identicon&r=PG", "display_name": "theory", "link": "https://stackoverflow.com/users/79202/theory"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 1, "accepted_answer_id": 46180965, "answer_count": 1, "score": 1, "last_activity_date": 1505232072, "creation_date": 1505227551, "question_id": 46179431, "link": "https://stackoverflow.com/questions/46179431/go-whats-the-best-way-to-detect-invalid-json-string-characters", "title": "Go: What&#39;s the best way to detect invalid JSON string characters?", "body": "<p>What's the best, most efficient way to detect whether a Go string contains characters that are invalid in JSON strings? In other words, what's the Go equivalent to this answer to this <a href=\"https://stackoverflow.com/q/6051509/79202\">Java question</a>? Is it just to use\n<a href=\"https://golang.org/pkg/strings/#ContainsAny\" rel=\"nofollow noreferrer\">strings.ContainsAny</a> (assuming the <a href=\"https://en.wikipedia.org/wiki/ASCII#Control_characters\" rel=\"nofollow noreferrer\">ASCII control characters</a>)?</p>\n\n<pre><code>ctlChars := string([]byte{\n    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18,\n    19, 20, 21, 22, 23, 24, 25, 26, 27, 28, 29, 30, 31, 127,\n})\nif strings.ContainsAny(str, ctlChars) {\n    println(\"has control chars\")\n}\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 9300, "user_id": 409102, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/060588f22d2a4c5e049156f23fcf1405?s=128&d=identicon&r=PG", "display_name": "kravemir", "link": "https://stackoverflow.com/users/409102/kravemir"}, "edited": false, "score": 1, "creation_date": 1582921921, "post_id": 46175472, "comment_id": 106956305, "body": "Actually, it&#39;s possible with a tiny hack - just output <code>&quot;&quot;</code> there: <code>{{define &quot;Footer&quot;}}{{&quot;&quot;}}{{end}}</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1505223566, "last_edit_date": 1505223566, "creation_date": 1505216462, "answer_id": 46175472, "question_id": 46174445, "link": "https://stackoverflow.com/questions/46174445/how-can-i-override-a-template-block-with-an-empty-template/46175472#46175472", "title": "How can I override a template block with an empty template?", "body": "<p>This is the expected behavior. This is documented at <a href=\"https://golang.org/pkg/html/template/#Template.Parse\" rel=\"nofollow noreferrer\"><code>Template.Parse()</code></a>:</p>\n\n<blockquote>\n  <p>Templates can be redefined in successive calls to Parse, before the first use of Execute on t or any associated template. <strong>A template definition with a body containing only white space and comments is considered empty and will not replace an existing template's body.</strong> This allows using Parse to add new named template definitions without overwriting the main template body.</p>\n</blockquote>\n\n<p>So you can't \"erase\" an already defined template (you can't replace its content to be empty).</p>\n\n<p>If you \"conditionally\" need it, then use an <code>{{if}}</code> action to decide if the template is to be called. Alternatively you may put an <code>{{if}}</code> inside the template, and the template itself may choose not to render anything. In this case you have to make sure to pass the proper argument that controls what the template will render.</p>\n\n<p>P.S. If you're working with HTML templates, you should always use <a href=\"https://golang.org/pkg/html/template/\" rel=\"nofollow noreferrer\"><code>html/template</code></a> instead of <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\"><code>text/template</code></a>, as the former provides the same interface as package <code>text/template</code> but also provides contextual escaping to generate HTML output safe against code injection. </p>\n"}], "owner": {"reputation": 10244, "user_id": 797194, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3728c41e604024f375043551a59b41df?s=128&d=identicon&r=PG", "display_name": "m90", "link": "https://stackoverflow.com/users/797194/m90"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1079, "favorite_count": 0, "accepted_answer_id": 46175472, "answer_count": 1, "score": 3, "last_activity_date": 1505223566, "creation_date": 1505213309, "last_edit_date": 1505214298, "question_id": 46174445, "link": "https://stackoverflow.com/questions/46174445/how-can-i-override-a-template-block-with-an-empty-template", "title": "How can I override a template block with an empty template?", "body": "<p>Using <code>text/html</code> I define a <code>block</code> in my base template, containing default content. In some situations I would like this block to be empty, so I thought I could just re-define its name and make it contain nothing like:</p>\n\n<pre><code>{{ block \"something\" . }}\n    &lt;h1&gt;Default content&lt;/h1&gt;\n{{ end }}\n\n// later in a place that does not want \"something\" ...\n{{ define \"something\" }}{{ end }}\n</code></pre>\n\n<p>Somehow Go seems to think that this definition is \"Zero\" and will still render the default content unless I put any non-whitespace content into the definition.</p>\n\n<p>I found <a href=\"https://github.com/golang/go/issues/19204\" rel=\"nofollow noreferrer\">this issue on the Golang repo</a> which describes the very same thing nicely in <a href=\"https://play.golang.org/p/mpBOEdhkFR\" rel=\"nofollow noreferrer\">a Playground example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"runtime\"\n    \"text/template\"\n)\n\nfunc main() {\n\n    fmt.Printf(\"Version: %q\\n\", runtime.Version())\n\n    t, err := template.New(\"master\").Parse(`{{block \"area51\" .}}Original Content{{end}}`)\n    if err != nil {\n        panic(err)\n    }\n    t, err = t.New(\"other_template\").Parse(`{{define \"area51\"}}{{end}}`)\n    if err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"Output:\\n\")\n    if err := t.ExecuteTemplate(os.Stdout, \"master\", nil); err != nil {\n        panic(err)\n    }\n\n    fmt.Printf(\"\\n\")\n\n}\n</code></pre>\n\n<p>Weirdly, the issue mention it is fixed (and landed in 1.8.1 if I understand it correctly), but it does not work for me, neither with 1.8.1+ nor 1.9.</p>\n\n<p>Is this a bug in Golang or is the approach flawed? Do I need to do anything differently in order to re-define the block so that it renders empty?</p>\n"}, {"tags": ["go", "mgo"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505225025, "post_id": 46172984, "comment_id": 79319389, "body": "try something like  <code>&amp;bson.RegEx{Pattern: fmt.Sprintf(&quot;.*%s*.&quot;, keyword), Options: &quot;i&quot;}</code>  also test your regex using <a href=\"https://regex101.com/\" rel=\"nofollow noreferrer\">regex101.com</a>  Notice my regex is a pointer. <code>&amp;</code>. I use <code>fmt.Sprintf</code> because concatenations are harder to read and easier to mess up (my opinion)  You may also want to break up your logic and test.. for instance make a query just using your original logic <code>bson.M{&quot;first_name&quot;:bson.RegEx{&quot;.*&quot;+keyword+&quot;*.&quot;, &quot;i&quot;} }</code> don&#39;t complicate it with the or, status, or role.  Isolate and test your regex first"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505225325, "post_id": 46172984, "comment_id": 79319622, "body": "it also seems like your regex should work, assuming your keyword is what you expect it to be and doesn&#39;t have extra spaces, characters, etc <a href=\"https://regex101.com/r/B9F3Wp/1\" rel=\"nofollow noreferrer\">regex101.com/r/B9F3Wp/1</a>  So there is something else going on"}, {"owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505226699, "post_id": 46172984, "comment_id": 79320707, "body": "@reticentroot I have checked there is no extra space with my keyword. I think the regex is correct, the only difference is I compared the string full name against first_name and last_name from db"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1505232710, "post_id": 46172984, "comment_id": 79324913, "body": "the full name isn&#39;t going to match on anything see for the updated regex regex101.com/r/B9F3Wp/4"}], "answers": [{"tags": [], "owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "is_accepted": false, "score": 1, "last_activity_date": 1505273967, "creation_date": 1505273967, "answer_id": 46188470, "question_id": 46172984, "link": "https://stackoverflow.com/questions/46172984/search-based-on-regular-expression-in-mgo-does-not-give-required-result/46188470#46188470", "title": "Search based on regular expression in mgo does not give required result", "body": "<p>I made the following changes in my code and it works.</p>\n\n<pre>\n\n    name := strings.Replace(keyword, \" \", \"|\", -1)\n        conditions := bson.M{ \"role\" : config.ProviderRole, \n                                \"status\" : status, \n                                \"$or\": []bson.M{ \n                                    bson.M{\"first_name\":bson.RegEx{\"(?i).*\"+name+\".*\", \"i\"} },\n                                    bson.M{\"last_name\": bson.RegEx{ \"(?i).*\"+name+\".*\", \"i\"} }, \n                                    bson.M{\"email_id\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                                    bson.M{\"phone_number\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                                    bson.M{\"alt_phone_number\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                                }}\n    err = c.Find(query).All(&result)\n\n</pre>\n"}], "owner": {"reputation": 63, "user_id": 4971613, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c16e556a4e543395322dd15157db49b8?s=128&d=identicon&r=PG&f=1", "display_name": "Swati", "link": "https://stackoverflow.com/users/4971613/swati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 697, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505273967, "creation_date": 1505209140, "last_edit_date": 1505213225, "question_id": 46172984, "link": "https://stackoverflow.com/questions/46172984/search-based-on-regular-expression-in-mgo-does-not-give-required-result", "title": "Search based on regular expression in mgo does not give required result", "body": "<p>Hello I have the following code in my golang:</p>\n\n<p>Please take a look:</p>\n\n<pre>type User struct {\n    Id              int      `json:\"id\" bson:\"_id\"`\n    FirstName       string   `json:\"first_name\" bson:\"first_name\"`\n    LastName        string   `json:\"last_name\" bson:\"last_name\"`\n    EmailId         string   `json:\"email_id\" bson:\"email_id\"`\n    Password        string   `json:\"password\" bson:\"password\"`\n    PhoneNumber     string   `json:\"phone_number\" bson:\"phone_number\"`\n    AltPhoneNumber  string   `json:\"alt_phone_number\" bson:\"alt_phone_number\"`\n    Gender          string   `json:\"gender\" bson:\"gender\"`\n    Note            string   `json:\"note\" bson:\"note\"`\n    Address         string   `json:\"address\" bson:\"address\"`\n    AptNo           string   `json:\"apt_no\" bson:\"apt_no\"`\n    City            string   `json:\"city\" bson:\"city\"`\n    Zipcode         string   `json:\"zipcode\" bson:\"zipcode\"`\n}\n\nquery   := bson.M{  \"role\"   : \"customer\", \n                    \"status\" : 1, \n                    \"$or\": []bson.M{ \n                        bson.M{\"first_name\":bson.RegEx{\".*\"+keyword+\"*.\", \"i\"} },\n                        bson.M{\"last_name\": bson.RegEx{\".*\"+keyword+\"*.\", \"i\"} }, \n                        bson.M{\"email_id\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                        bson.M{\"phone_number\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                        bson.M{\"alt_phone_number\": bson.RegEx{\".*\"+keyword, \"i\"} }, \n                }}\n\nerr = c.Find(query).All(&result)\n</pre>\n\n<p>I have a record in database with first name \"swati\" and last name \"sharma\".\nWhen I search \"swati\" then it works properly, similarly when I search \"sharma\"\nit works properly.</p>\n\n<p>Issue is when I search \"swati sharma\" then it does not return any result. \nCan anybody tell how I can achieve this output?</p>\n"}, {"tags": ["go", "fastcgi"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505222373, "post_id": 46172287, "comment_id": 79317321, "body": "fcgi is just providing the HTTP server portion; the handlers and their registration are provided by the mux, which in this case is the standard <code>net&#47;http</code> <code>ServeMux</code>. It should not behave any differently, and I&#39;m not sure how it&#39;s even possible that both handlers are invoked - they both write headers, so one should be panicking due to headers already sent."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1505222463, "post_id": 46172287, "comment_id": 79317408, "body": "Are you completely sure the call to <code>handler2</code> is for <code>&#47;first</code> and not for, say, <code>favicon.ico</code>? <code>handler2</code>, because of its mapping, will handle requests for everything but <code>&#47;first</code>, so I would not be surprised to see it getting auxiliary requests generated by the browser on the same pageview."}], "answers": [{"comments": [{"owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "edited": false, "score": 0, "creation_date": 1575712629, "post_id": 59220564, "comment_id": 104664028, "body": "Thanks for your answer! I had already forgotten that I had actually asked this question hehe...  This made me re-read the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">documentation for ServeMux</a>, and I think that the issue is that I ought to have registered <code>http.HandleFunc(&quot;&#47;first&#47;&quot;, handler1)</code>, i. e. with a trailing slash, or else I get the behaviour you describe..."}], "tags": [], "owner": {"reputation": 11, "user_id": 12493585, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6940648885273a2bdd9111b401345aae?s=128&d=identicon&r=PG&f=1", "display_name": "Kodiak", "link": "https://stackoverflow.com/users/12493585/kodiak"}, "is_accepted": false, "score": 1, "last_activity_date": 1575667746, "creation_date": 1575667746, "answer_id": 59220564, "question_id": 46172287, "link": "https://stackoverflow.com/questions/46172287/in-go-fastcgi-does-it-make-any-sense-to-use-multiple-handlers/59220564#59220564", "title": "In Go + FastCGI, does it make any sense to use multiple handlers?", "body": "<p>I realize this is an old post, but I'm just starting to play with Go and fcgi myself and came across this same issue.</p>\n\n<p>The short answer is yes, it does make make sense to use multiple handlers.  The flaw in your example is that you aren't accounting for the <code>go-fcgi-test.fcgi</code> being part of your URL.</p>\n\n<p>When Go's ServeMux processes the URL, it is using the full URL of the request, not just the part being handled by your fcgi process.  In the case of <code>http://my.shared.web.server/go-fcgi-test.fcgi/first</code>, the program is looking for the closest match to <code>/go-fcgi-test.fcgi/first</code>, which is <code>/</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "is_accepted": true, "score": 0, "last_activity_date": 1575713307, "last_edit_date": 1592644375, "creation_date": 1575713307, "answer_id": 59224930, "question_id": 46172287, "link": "https://stackoverflow.com/questions/46172287/in-go-fastcgi-does-it-make-any-sense-to-use-multiple-handlers/59224930#59224930", "title": "In Go + FastCGI, does it make any sense to use multiple handlers?", "body": "<p>After reading the answer provided by @Kodiak, I re-read the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow noreferrer\">documentation for ServeMux</a> and came across this paragraph:</p>\n<blockquote>\n<p>Note that since a pattern ending in a slash names a rooted subtree, the pattern &quot;/&quot; matches all paths not matched by other registered patterns, not just the URL with Path == &quot;/&quot;.</p>\n<p>If a subtree has been registered and a request is received naming the subtree root <em>without its trailing slash</em>, ServeMux redirects that request to the subtree root (adding the trailing slash). This behavior can be overridden with a separate registration for the path without the trailing slash. For example, registering &quot;/images/&quot; causes ServeMux to redirect a request for &quot;/images&quot; to &quot;/images/&quot;, unless &quot;/images&quot; has been registered separately.</p>\n</blockquote>\n<p>(italics mine)</p>\n<p>My <em>assumption</em> was that <code>ServeMux</code> pretty much behaved as the rule-based pattern matching features of <code>nginx</code> and/or Apache's <code>rewrite</code> module, i. e. rules are processed according to the order they're registered, and therefore I was expecting that <code>/first</code> would be matched first (pun intended), and only if no match was found, <code>/</code> would be matched <em>next</em>.</p>\n<p>But this is not what the documentation says. Instead, the order of registration makes no real difference; <code>ServeMux</code>, in my given scenario, because I forgot adding a trailing slash, will <em>always</em> 'fall back' to the handler for <code>&quot;/&quot;</code>, not because of some bug or perversion of the matching algorithm, <em>but because that is the intended behaviour</em> as coded by the Go developers! In other words, if you have a handler for <code>&quot;/&quot;</code>, it acts as a catch-all for every non-slash-terminated subtree.</p>\n<p>I just failed to read the documentation properly! (or maybe back in 2017 that paragraph wasn't clear enough)</p>\n"}], "owner": {"reputation": 526, "user_id": 1035977, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/310abc9d873d41cede1258891d6bcaf3?s=128&d=identicon&r=PG", "display_name": "Gwyneth Llewelyn", "link": "https://stackoverflow.com/users/1035977/gwyneth-llewelyn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 744, "favorite_count": 0, "accepted_answer_id": 59224930, "answer_count": 2, "score": 1, "last_activity_date": 1575713307, "creation_date": 1505207254, "question_id": 46172287, "link": "https://stackoverflow.com/questions/46172287/in-go-fastcgi-does-it-make-any-sense-to-use-multiple-handlers", "title": "In Go + FastCGI, does it make any sense to use multiple handlers?", "body": "<p>Gopher newbie here. Please be kind :-)</p>\n\n<p>I have a setup where I do have an account on a shared server which runs Apache + FastCGI over which I have no control. It smoothly interfaces with Go, though. I'm more used to using Go with <code>net/http</code>, but figuring out how to use it with <code>net/http/fcgi</code> seemed simple enough. Here is my minimal test application:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/fcgi\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-type\", \"text/plain; charset=utf-8\")\n    fmt.Fprintln(w, \"This was generated by Go running as a FastCGI app\")\n}\n\nfunc main() {\n    /*\n     *  \n     *  Everything that is done here should be setup code etc. which is retained between calls\n     *  \n     */\n    http.HandleFunc(\"/\", handler)\n    // This is what actually concurrently handles requests\n    if err := fcgi.Serve(nil, nil); err != nil {\n            panic(err)\n    }\n}\n</code></pre>\n\n<p>Now this works beautifully and flawlessly: after compiling this to, say, <code>go-fcgi-test.fcgi</code> and placing it under the appropriate directory, the Go code is run from an URL like <code>http://my.shared.web.server/go-fcgi-test.fcgi</code>. For the sake of simplicity, I've left most of the actual processing out \u2014 but this works perfectly with extracting form parameters, ENV variables (under Go 1.9!) and so forth, so I know that the basic setup must be ok.</p>\n\n<p>Let's try a slightly more complicated example:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/fcgi\"\n)\n\nfunc handler1(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-type\", \"text/plain; charset=utf-8\")\n    fmt.Fprintln(w, \"This comes from handler1\")\n}\n\nfunc handler2(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(http.StatusOK)\n    w.Header().Set(\"Content-type\", \"text/plain; charset=utf-8\")\n    fmt.Fprintln(w, \"This comes from handler2\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/first\", handler1)\n    http.HandleFunc(\"/\", handler2)\n    if err := fcgi.Serve(nil, nil); err != nil {\n            panic(err)\n    }\n}\n</code></pre>\n\n<p>Now, in this scenario, I would expect <code>http://my.shared.web.server/go-fcgi-test.fcgi</code> to output <code>This comes from handler2</code>, and, indeed, that's exactly what happens.</p>\n\n<p>But why does <code>http://my.shared.web.server/go-fcgi-test.fcgi/first</code> actually invoke <code>handler2</code> as well, i.e. <code>handler1</code> is completely ignored? Note that <code>handler2</code> <em>does</em> get the <code>/first</code> bit of the URL \u2014 Apache is <em>not</em> stripping it out \u2014 because I can read <code>r.URL.Path[1:]</code> and confirm that this was the whole path sent to the Go application.</p>\n\n<p>All examples I've found on the Web using a similar skeleton for FastCGI show only <em>one</em> handler. Is this a limitation of the FastCGI package itself? A limitation of the FastCGI protocol (but then why is the whole path correctly sent?)? Something done at the Apache configuration which imposes this limitation (remember, I cannot touch the Apache configuration)? Or am I doing something terribly wrong?</p>\n\n<p>(For the sake of completeness, I should add that yes, I have tried out several variations of the above, renaming the Go app, using subfolders, using <em>several</em> handlers and not just one, etc. and so forth)</p>\n\n<p>My real world scenario is actually a small application that is supposed to run either as a stand-alone web server using <code>net/http</code> <em>or</em> as a FastCGI application in the case that the stand-alone model is either not supported or even forbidden (which is the case of some providers of shared environments). Since the actual handling is exactly the same for either case, the only difference is calling <code>fcgi.Serve()</code> as opposed to <code>http.ListenAndServe()</code>. But it would be nice to be able to use the routing ability of the <code>net/http</code> package with different handlers under FastCGI as well.</p>\n\n<p>Thanks in advance for any insight. And even if the answer is 'yes, that's <em>exactly</em> how the FastCGI implementation works under Go \u2014 one handler only!' that would still be useful \u2014 meaning that I just need to work around my own code and do things differently (basically, creating my own router/dispatcher based on parameters passed through the Form interface \u2014 no big deal, it's doable!)</p>\n"}, {"tags": ["html", "go", "iframe", "web-scraping", "chromedp"], "comments": [{"owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1505287553, "post_id": 46169407, "comment_id": 79344839, "body": "What have you tried so far? Does it select with XPath like <code>&#47;&#47;iframe</code>? Could you show you code to better understand the problem?"}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "edited": false, "score": 0, "creation_date": 1505290984, "post_id": 46169407, "comment_id": 79346977, "body": "@EugeneLisitsky: Please check the <a href=\"https://gist.github.com/yogesh-desai/cfb484cd0349fe18cb8e048f38616a6c\" rel=\"nofollow noreferrer\">file</a> for my code so far. I am able to get &quot;webyclip-widget-3&quot; iframe with its &quot;ID&quot;. But unable to get the complete HTML under it. &quot;Inspect&quot; element shows the videos and &quot;img&quot; tags. I want that &quot;img&quot; tags to extract the videos links."}], "answers": [{"comments": [{"owner": {"reputation": 179, "user_id": 4546396, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/4AxEt.jpg?s=128&g=1", "display_name": "Salis", "link": "https://stackoverflow.com/users/4546396/salis"}, "edited": false, "score": 0, "creation_date": 1569346429, "post_id": 46353977, "comment_id": 102564852, "body": "how to handle javascript alert and get the text inside it. I notice there is <code>Page.javascriptDialogOpening</code> in the method"}], "tags": [], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "is_accepted": true, "score": 0, "last_activity_date": 1506032268, "creation_date": 1506032268, "answer_id": 46353977, "question_id": 46169407, "link": "https://stackoverflow.com/questions/46169407/how-to-handle-iframes-on-a-webpage/46353977#46353977", "title": "How to handle iframes on a webpage", "body": "<p>After many attempts, Finally, I found the way and solved my query. You can check my <a href=\"https://github.com/yogesh-desai/WebCrawlerTokopedia\" rel=\"nofollow noreferrer\">GitHub</a> repository for this query. Thank you.\nTo get the iframe contents we can use Javascript. Way to do it with chromedp is as below,</p>\n\n<pre><code>cdp.EvaluateAsDevTools(\"document.getElementById('IFRAME-ID').contentWindow.document.body.outerHTML;\", RESULT-BUFFER),\n</code></pre>\n"}], "owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1215, "favorite_count": 0, "accepted_answer_id": 46353977, "answer_count": 1, "score": 0, "last_activity_date": 1571731532, "creation_date": 1505197832, "last_edit_date": 1571731532, "question_id": 46169407, "link": "https://stackoverflow.com/questions/46169407/how-to-handle-iframes-on-a-webpage", "title": "How to handle iframes on a webpage", "body": "<p>I want to get the HTML source of the iframe present on the <a href=\"https://www.tokopedia.com/chocoapple/ready-stock-bnib-iphone-128gb-7-plus-jet-black-garansi-apple-1-tahun-10?src=topads\" rel=\"nofollow noreferrer\">webpage</a>. I am using chromedp package with Go. How to handle the iframes with chromedp package? The documentation is very less so couldn't find a way.</p>\n\n<p>Links:</p>\n\n<p><a href=\"https://github.com/knq/chromedp\" rel=\"nofollow noreferrer\">chromedp</a></p>\n\n<p><a href=\"https://docs.google.com/document/d/1Gyu5f5QL_N5OkchOqMC8KJK_tvpd4UNMVZvsgkQhHzA/edit?usp=sharing\" rel=\"nofollow noreferrer\">Google-doc</a> to get more details of my task.</p>\n"}, {"tags": ["go", "range", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1505197785, "post_id": 46169351, "comment_id": 79300673, "body": "stu is a loop variable and exists only once: The variable (== the memory address) is reused on all iterations of the loop."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 4, "last_activity_date": 1505197779, "creation_date": 1505197779, "answer_id": 46169389, "question_id": 46169351, "link": "https://stackoverflow.com/questions/46169351/how-to-explain-golang-slice-ranges-phenomenon/46169389#46169389", "title": "How to explain golang slice range&#39;s phenomenon", "body": "<p>The application is taking the address of the local variable <code>stu</code>.  Change the code to take the address of the slice element:</p>\n\n<pre><code>for i := range s {\n    m[s[i].Name] = &amp;s[i]\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0izo4gGPV7\" rel=\"nofollow noreferrer\">https://play.golang.org/p/0izo4gGPV7</a></p>\n"}], "owner": {"reputation": 95, "user_id": 6507836, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/80a17bb7ecb37f2f1f0e2906b0e2c253?s=128&d=identicon&r=PG", "display_name": "Sotter.liu", "link": "https://stackoverflow.com/users/6507836/sotter-liu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "closed_date": 1505230191, "accepted_answer_id": 46169389, "answer_count": 1, "score": -3, "last_activity_date": 1505197779, "creation_date": 1505197620, "last_edit_date": 1592644375, "question_id": 46169351, "link": "https://stackoverflow.com/questions/46169351/how-to-explain-golang-slice-ranges-phenomenon", "closed_reason": "Duplicate", "title": "How to explain golang slice range&#39;s phenomenon", "body": "<pre><code>type student struct {\n    Name string\n    Age  int\n}\n\nfunc main() {\n    m := make(map[string]*student)\n    s := []student{\n        {Name: &quot;Allen&quot;, Age: 24},\n        {Name: &quot;Tom&quot;, Age: 23},\n    }\n\n    for _, stu := range s {\n        m[stu.Name] = &amp;stu\n    }\n    fmt.Println(m)\n    for key, value := range m {\n        fmt.Println(key, value)\n    }\n}\n</code></pre>\n<p>result:</p>\n<blockquote>\n<p>map[Allen:0xc42006a0c0 Tom:0xc42006a0c0]</p>\n<p>Allen &amp;{Tom 23}</p>\n<p>Tom &amp;{Tom 23}</p>\n</blockquote>\n<p>How to explain Slice's phenomenon, in my opinion, stu should be the address of every member of s, but from the results, s has the same address.</p>\n"}, {"tags": ["docker", "go", "docker-compose", "docker-machine", "docker-swarm"], "comments": [{"owner": {"reputation": 1821, "user_id": 2011943, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ahm8E.jpg?s=128&g=1", "display_name": "Pedro Nasser", "link": "https://stackoverflow.com/users/2011943/pedro-nasser"}, "edited": false, "score": 0, "creation_date": 1505225596, "post_id": 46167522, "comment_id": 79319820, "body": "When you ask something about how to use a package on Golang, it helps if you provide the full import path (github or whatever) of that package."}], "answers": [{"comments": [{"owner": {"reputation": 363, "user_id": 392753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a587f4914e137b7c8c9e655abba964?s=128&d=identicon&r=PG", "display_name": "Francesco Pasa", "link": "https://stackoverflow.com/users/392753/francesco-pasa"}, "edited": false, "score": 0, "creation_date": 1612806194, "post_id": 46211156, "comment_id": 116876201, "body": "This is actually wrong, because the docker log format has a header for each message, and you output garbled text if done this way: <a href=\"https://ahmet.im/blog/docker-logs-api-binary-format-explained/\" rel=\"nofollow noreferrer\">ahmet.im/blog/docker-logs-api-binary-format-explained</a>"}], "tags": [], "owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "is_accepted": false, "score": 0, "last_activity_date": 1505366798, "creation_date": 1505366798, "answer_id": 46211156, "question_id": 46167522, "link": "https://stackoverflow.com/questions/46167522/docker-golang-sdk-how-to-redirect-container-stdout-to-a-file/46211156#46211156", "title": "Docker Golang SDK - How to redirect container stdout to a file", "body": "<p>You can use something like below</p>\n\n<pre><code>  out, err := cli.ContainerLogs(ctx, resp.ID, types.ContainerLogsOptions{ShowStdout: true})\n  if err != nil {\n    panic(err)\n  }\n\n  f, err := os.Create(\"/tmp/clogs\")\n\n  io.Copy(f, out)\n</code></pre>\n\n<p>But make sure to to do that after you have started the container, Create will only create the container and not start it</p>\n"}, {"tags": [], "owner": {"reputation": 363, "user_id": 392753, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e2a587f4914e137b7c8c9e655abba964?s=128&d=identicon&r=PG", "display_name": "Francesco Pasa", "link": "https://stackoverflow.com/users/392753/francesco-pasa"}, "is_accepted": false, "score": 0, "last_activity_date": 1612806776, "creation_date": 1612806776, "answer_id": 66106775, "question_id": 46167522, "link": "https://stackoverflow.com/questions/46167522/docker-golang-sdk-how-to-redirect-container-stdout-to-a-file/66106775#66106775", "title": "Docker Golang SDK - How to redirect container stdout to a file", "body": "<p>The format of docker logs contains 8 bytes of header for each message, indicating for instance whether the output was on <code>stdout</code> or <code>stderr</code>. So one cannot simply copy the log output to a destination as Tarun Lalwani is mentioning in the other answer, because the header would then be interpreted as characters, garbling the output.</p>\n<p>Unfortunately the client docs don't even mention the issue. <a href=\"https://ahmet.im/blog/docker-logs-api-binary-format-explained/\" rel=\"nofollow noreferrer\">This article</a> explains it a bit and offers a library to solve the issue:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n  &quot;github.com/docker/docker/client&quot;\n  &quot;github.com/ahmetb/dlog&quot;\n)\n  \n// ---\n\nreader, err := cli.ContainerLogs(ctx, resp.ID, nil)\nif err != nil {\n  panic(err)\n}\n\nfile, err := os.Create(&quot;/path/to/your/file&quot;)\nio.Copy(file, dlog.NewReader(reader))\n</code></pre>\n"}], "owner": {"reputation": 399, "user_id": 8264607, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WQKpnhD7pmQ/AAAAAAAAAAI/AAAAAAAAABM/vjTCAvnmiD0/photo.jpg?sz=128", "display_name": "scriptonist", "link": "https://stackoverflow.com/users/8264607/scriptonist"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 756, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1612806776, "creation_date": 1505187533, "last_edit_date": 1505227266, "question_id": 46167522, "link": "https://stackoverflow.com/questions/46167522/docker-golang-sdk-how-to-redirect-container-stdout-to-a-file", "title": "Docker Golang SDK - How to redirect container stdout to a file", "body": "<p>Using the docker golang sdk the following method can be used to create a container and bind it's output to <code>stdout</code>.</p>\n\n<pre><code>resp, err := cli.ContainerCreate(ctx, &amp;container.Config{\n        Image:        \"alpine\",\n        Cmd:          []string{\"echo\", \"Hello World\"},\n        AttachStdout: true,\n    }, nil, nil, \"\")\n</code></pre>\n\n<p>How can I redirect this output to a file using the SDK ?\nI'm using the official SDK of docker - <code>github.com/docker/docker/client</code></p>\n"}, {"tags": ["go", "pipe", "tar", "gunzip"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 2, "creation_date": 1505187035, "post_id": 46167418, "comment_id": 79296960, "body": "What&#39;s the error? Also please <code>go fmt</code> the file"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505227421, "post_id": 46167418, "comment_id": 79321277, "body": "Unrelated: You shouldn&#39;t call log.Fatal in tests (or anywhere you expect to execute a <code>defer</code>statement), as it prevents any cleanup that you may intend to do, and can hide failing tests. There&#39;s a <code>t.Fatal</code> which does what you want. A tar file should not be executable. Close a channel rather than sending a sentinel value as a signal, or better yet, use a <code>WaitGroup</code> to wait for goroutines."}], "answers": [{"comments": [{"owner": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "edited": false, "score": 0, "creation_date": 1505250235, "post_id": 46178931, "comment_id": 79333409, "body": "One important thing that I forgot is to close opened writer in reverse order. Hope others could learn from my mistake. Thanks again @ JimB."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "edited": false, "score": 0, "creation_date": 1505250344, "post_id": 46178931, "comment_id": 79333453, "body": "@NSTNF: actually you had the <code>tarWriter.Close()</code> and <code>gzipWriter.Close()</code> correct, the defer calls are executed in LIFO order."}, {"owner": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "edited": false, "score": 0, "creation_date": 1505251159, "post_id": 46178931, "comment_id": 79333777, "body": "Thanks. Golang is different from other langs. It requires developer to change coding mind set. I am striving to code correctly and then efficiently.  Opened writers need to be closed in reverse order. This might be a common mistake. Would it be beneficial to other developers if creating a common mistakes wiki or add something like &quot;warning: close tar writer before closing gzip writer&quot; to the corresponding golang documentation?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1505227247, "last_edit_date": 1505227247, "creation_date": 1505226081, "answer_id": 46178931, "question_id": 46167418, "link": "https://stackoverflow.com/questions/46167418/bug-using-golang-io-pipe-to-tar-files/46178931#46178931", "title": "bug using golang io.pipe to tar files", "body": "<p>You are closing the pipe before the deferred Close calls on the <code>gzipWriter</code> and <code>tarWriter</code>. There's no error, because you're not checking the error on either of those close calls. You need to close the <code>tarWriter</code>, then the <code>gzipWriter</code>, then the <code>PipeWriter</code>, in that order.</p>\n\n<p>However, there's no reason for the pipe at all in this code, and you can remove the goroutine and the associated coordination altogether if you write directly to the file. </p>\n\n<pre><code>tarFile, err := os.OpenFile(\"/tmp/test.tar.gz\", os.O_RDWR|os.O_CREATE, 0644)\nif err != nil {\n    log.Fatal(err)\n}\ndefer tarFile.Close()\n\ngzipWriter := gzip.NewWriter(tarFile)\ndefer gzipWriter.Close()\ntarWriter := tar.NewWriter(gzipWriter)\ndefer tarWriter.Close()\n</code></pre>\n"}], "owner": {"reputation": 63, "user_id": 2237752, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/rMt2v.png?s=128&g=1", "display_name": "NSTNF", "link": "https://stackoverflow.com/users/2237752/nstnf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 726, "favorite_count": 0, "accepted_answer_id": 46178931, "answer_count": 1, "score": 0, "last_activity_date": 1505227247, "creation_date": 1505186775, "last_edit_date": 1505188046, "question_id": 46167418, "link": "https://stackoverflow.com/questions/46167418/bug-using-golang-io-pipe-to-tar-files", "title": "bug using golang io.pipe to tar files", "body": "<p>I have been testing code using io.Pipe to tar and gunzip files into a tar ball and then unzipping using the tar utility. The follow code passes, however the untaring process keeps getting </p>\n\n<p>error:\n<code>tar: Truncated input file (needed 1050624 bytes, only 0 available)\ntar: Error exit delayed from previous errors.</code></p>\n\n<p>This issue is really driving me crazy. It has been two weeks. I really need help debugging.</p>\n\n<p>Thanks.</p>\n\n<p>Development enviroment: go version go1.9 darwin/amd64</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/tar\"\n    \"compress/gzip\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n    \"testing\"\n)\n\nfunc testTarGzipPipe2(t *testing.T) {\n    src := \"/path/to/file/folder\"\n\n    pr, pw := io.Pipe()\n    gzipWriter := gzip.NewWriter(pw)\n    defer gzipWriter.Close()\n    tarWriter := tar.NewWriter(gzipWriter)\n    defer tarWriter.Close()\n\n    status := make(chan bool)\n\n    go func() {\n        defer pr.Close()\n        // tar to local disk\n        tarFile, err := os.OpenFile(\"/path/to/tar/ball/test.tar.gz\", os.O_RDWR|os.O_CREATE, 0755)\n        if err != nil {\n            log.Fatal(err)\n        }\n        defer tarFile.Close()\n        if _, err := io.Copy(tarFile, pr); err != nil {\n            log.Fatal(err)\n        }\n\n        status &lt;- true\n    }()\n\n    err := filepath.Walk(src, func(path string, info os.FileInfo, err error) error {\n        if err != nil {\n            return err\n        }\n\n        header, err := tar.FileInfoHeader(info, info.Name())\n        if err != nil {\n            return err\n        }\n\n        // header.Name = strings.TrimPrefix(strings.Replace(path, src, \"\", -1), string(filepath.Separator))\n\n        if err := tarWriter.WriteHeader(header); err != nil {\n            return err\n        }\n\n        if info.Mode().IsDir() {\n            return nil\n        }\n\n        fmt.Println(path)\n        f, err := os.Open(path)\n        if err != nil {\n            return err\n        }\n        defer f.Close()\n\n        if _, err := io.Copy(tarWriter, f); err != nil {\n            return err\n        }\n\n        return nil\n    })\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    pw.Close()\n    &lt;-status\n}\n</code></pre>\n"}, {"tags": ["go", "time", "format"], "comments": [{"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 3, "creation_date": 1505187165, "post_id": 46167391, "comment_id": 79296986, "body": "If I understand correctly, are you trying to say? you&#39;re unable to use <code>01&#47;23&#47;2004</code> as format layout. If yes; you&#39;re using an incorrect format layout. I recommend you to have a look at time package constant section <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#pkg-constants</a> to know more."}, {"owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "reply_to_user": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 0, "creation_date": 1505187744, "post_id": 46167391, "comment_id": 79297124, "body": "I&#39;m wondering where else this reference time is used and if it has a moniker. I 100% understand why <code>01&#47;23&#47;2006</code> yields the results it does."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1505192362, "post_id": 46167391, "comment_id": 79298378, "body": "This is pure speculation, but I suspect it was originally meant to be more human-readable than, say, <code>%a %b %e %H:%M:%S %z %Z %Y</code>, a subtle variant of the <a href=\"http://pubs.opengroup.org/onlinepubs/9699919799/utilities/date.html#tag_20_30_10\" rel=\"nofollow noreferrer\">default output format of the POSIX <code>date</code> utility</a>. Speculating further, Monday is the first day of the week in many countries, and January is the first month of the year, which is why they&#39;re used. 2006 (i.e. <code>&#39;06</code>) was the only year that fit the criteria, so it&#39;s the 6th item."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1505192469, "post_id": 46167391, "comment_id": 79298421, "body": "As for the 15, instead of 03, that&#39;s probably for the AM/PM bit since the docs specifically mention &quot;PM&quot;."}, {"owner": {"reputation": 3701, "user_id": 1343356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7f97690d8ae261766c333e8742473e6?s=128&d=identicon&r=PG", "display_name": "jeevatkm", "link": "https://stackoverflow.com/users/1343356/jeevatkm"}, "edited": false, "score": 1, "creation_date": 1505193063, "post_id": 46167391, "comment_id": 79298626, "body": "@ChronoKitsune that is the belief I have. Just I did a search around; come across this post <a href=\"https://groups.google.com/d/msg/golang-nuts/806le5R6gEc/iYbOz5z6ruwJ\" rel=\"nofollow noreferrer\">groups.google.com/d/msg/golang-nuts/806le5R6gEc/iYbOz5z6ruwJ</a>"}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1505200313, "last_edit_date": 1592644375, "creation_date": 1505199873, "answer_id": 46170003, "question_id": 46167391, "link": "https://stackoverflow.com/questions/46167391/understanding-golang-date-formatting-for-time-package/46170003#46170003", "title": "Understanding golang date formatting for time package", "body": "<p>The values in a date string are not arbitrary. You can't just change <code>02</code> to <code>03</code> and expect it to work.  The date formatter looks for those specific values, and knows that <code>1</code> means month, <code>2</code> means day of month, etc.</p>\n<p>Changing <code>01/02/2006</code> to <code>01/23/2004</code> is like changing a human-readable form that says <code>First Name: ______ Last Name: ______</code> to one that says <code>First Name: ______ Ice Cream: ______</code>.  You can't expect anyone to know that <code>Ice Cream</code> should mean <code>Last Name</code>.</p>\n<h2>The name</h2>\n<p>The only name provided for this is &quot;reference time&quot;, <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<p>Parse parses a formatted string and returns the time value it represents. The layout defines the format by showing how <strong>the reference time</strong>, defined to be</p>\n<pre><code>Mon Jan 2 15:04:05 -0700 MST 2006\n</code></pre>\n</blockquote>\n<p>and <a href=\"https://golang.org/pkg/time/#pkg-constants\" rel=\"nofollow noreferrer\">here</a>:</p>\n<blockquote>\n<p>These are predefined layouts for use in Time.Format and Time.Parse. <strong>The reference time</strong> used in the layouts is the specific time:</p>\n<pre><code>Mon Jan 2 15:04:05 MST 2006\n</code></pre>\n<p>which is Unix time 1136239445. Since MST is GMT-0700, <strong>the reference time</strong> can be thought of as</p>\n<pre><code>01/02 03:04:05PM '06 -0700\n</code></pre>\n<p>To define your own format, write down what <strong>the reference time</strong> would look like formatted your way; see the values of constants like ANSIC, StampMicro or Kitchen for examples. The model is to demonstrate what the reference time looks like so that the Format and Parse methods can apply the same transformation to a general time value.</p>\n</blockquote>\n<p>To specify that you're talking about Go's reference time, I'd say &quot;Go's reference time.&quot; Or to be blatantly obvious, &quot;Go's time.Parse reference time.&quot;</p>\n<hr />\n<p>As an aside, your function can be greatly shortened:</p>\n<pre><code>func Today() string {\n    return time.Now().Local().Format(&quot;01/02/2006&quot;)\n}\n</code></pre>\n"}], "owner": {"reputation": 7796, "user_id": 2334254, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh4.googleusercontent.com/-6e2XuTZAjgM/AAAAAAAAAAI/AAAAAAAAABU/JpF2-AkHsH4/photo.jpg?sz=128", "display_name": "kpie", "link": "https://stackoverflow.com/users/2334254/kpie"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1110, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1505200313, "creation_date": 1505186563, "question_id": 46167391, "link": "https://stackoverflow.com/questions/46167391/understanding-golang-date-formatting-for-time-package", "title": "Understanding golang date formatting for time package", "body": "<p>So I have the function performing well.</p>\n\n<pre><code>func Today()(result string){\n    current_time := time.Now().Local()\n    result =  current_time.Format(\"01/02/2006\")\n    return\n}\n</code></pre>\n\n<p>Prints <code>MM/DD/YYYY</code> And I thought that it would be more readable if I had a value greater than 12 in the days position to make it clear that it was MM/DD/YYYY so I changed the to following</p>\n\n<pre><code>func Today()(result string){\n    current_time := time.Now().Local()\n    result =  current_time.Format(\"01/23/2004\")\n    return\n}\n</code></pre>\n\n<p>Which to my chagrin caused bad results. Prints <code>MM/DDHH/DD0MM</code></p>\n\n<p>Realizing my mistake I see that the format is defined by the <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">reference time</a>...</p>\n\n<pre><code>Mon Jan 2 15:04:05 -0700 MST 2006\n</code></pre>\n\n<p>I'm wondering if there is any other instances this moment being used as a formatting reference for date times, and if this reference moment has a nickname (like <a href=\"https://en.wikipedia.org/wiki/Null_Island\" rel=\"nofollow noreferrer\">null island</a>)?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 4, "creation_date": 1505186074, "post_id": 46167279, "comment_id": 79296701, "body": "While this may seem off scope, but I suggest you read this guide. <a href=\"https://www.raspberrypi.org/documentation/remote-access/access-over-Internet/\" rel=\"nofollow noreferrer\">raspberrypi.org/documentation/remote-access/&hellip;</a> the procedure for exposing your go server is near identical as you&#39;ll need to open a port on your network and forward it. Dont use port 80 either."}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505186411, "post_id": 46167279, "comment_id": 79296782, "body": "Forgot to add, that I cannot actually configure the router, cuz I don&#39;t have access to it. Only got WiFi password :("}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "edited": false, "score": 4, "creation_date": 1505186434, "post_id": 46167279, "comment_id": 79296788, "body": "@Frynio then you&#39;re out of luck."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 1, "creation_date": 1505186549, "post_id": 46167279, "comment_id": 79296818, "body": "@Frynio you need access to the router to open the port otherwise it wont work.. Otherwise you might want to try the free tier on heroku <a href=\"https://devcenter.heroku.com/articles/getting-started-with-go\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/getting-started-with-go</a> or other like services"}, {"owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "edited": false, "score": 0, "creation_date": 1505186681, "post_id": 46167279, "comment_id": 79296849, "body": "Ah, poor me. Anyway thanks for all your advices guys! Maybe someday I will be given access to the router"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1505200602, "post_id": 46167279, "comment_id": 79302362, "body": "This really isn&#39;t a Go- or even programming-related question. This question would be better on ServerFault or SuperUser."}], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 4142736, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f83818c194f578aa637f6957113f3fbc?s=128&d=identicon&r=PG&f=1", "display_name": "bashxx", "link": "https://stackoverflow.com/users/4142736/bashxx"}, "is_accepted": true, "score": 1, "last_activity_date": 1505679670, "creation_date": 1505679670, "answer_id": 46268508, "question_id": 46167279, "link": "https://stackoverflow.com/questions/46167279/connecting-to-my-own-golang-sever-from-outside-world/46268508#46268508", "title": "Connecting to my own golang sever from outside world", "body": "<p>One way you can do it is deploy it on an AWS Free Tier instance with public IP(<a href=\"https://aws.amazon.com/free/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/free/</a>). \nOnce you are done spinning up the EC2 instance (<a href=\"https://aws.amazon.com/free/\" rel=\"nofollow noreferrer\">https://aws.amazon.com/free/</a>), copy the binary of your web server to that instance <code>scp -i mykey.pem somefile.txt root@my.ec2.id.amazonaws.com:/\n</code>\nYou need to ensure that the security group on that instance allows ingress from the internet(0.0.0.0/0) on that port </p>\n\n<p>To access it:\nUse either the public IP or public DNS of the EC2 instance along with the port number of your server(in your case 80)</p>\n"}], "owner": {"reputation": 1697, "user_id": 5172820, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/da4f4afa5dabda9b8e3de78e61e55713?s=128&d=identicon&r=PG&f=1", "display_name": "minecraftplayer1234", "link": "https://stackoverflow.com/users/5172820/minecraftplayer1234"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 456, "favorite_count": 0, "closed_date": 1505714241, "accepted_answer_id": 46268508, "answer_count": 1, "score": -3, "last_activity_date": 1505679670, "creation_date": 1505185681, "last_edit_date": 1505186347, "question_id": 46167279, "link": "https://stackoverflow.com/questions/46167279/connecting-to-my-own-golang-sever-from-outside-world", "closed_reason": "Not suitable for this site", "title": "Connecting to my own golang sever from outside world", "body": "<p>So I do have this code written in <code>go</code>:</p>\n\n<pre><code>// firstserver - my first server\npackage main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", Handler)\n    err := http.ListenAndServe(\":80\", nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\n// Handler - a handler function for a normal enter\nfunc Handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"You're connected\")\n}\n</code></pre>\n\n<p>Now, when I go to my browser and type <code>localhost:80</code> (or just <code>localhost</code>), the page loads, and I see the message <code>You're connected</code>. Now I wanted to try to connect from other devices too. So I took my other laptop. I checked my adapter address, its <code>192.168.0.15</code>. So when I typed <code>192.168.0.15:80</code> on the other laptop, it worked again, cool!</p>\n\n<p>Primarly I am trying to do some simple server to use it on my phone when I am at college, check the schedules, have some notes, etc. I took my smartphone, I disconnected from my WiFi, switched to my smartphones internet and dumbly typed <code>192.168.0.15:80</code> again. I knew it wouldn't work, cuz it's not my external IP. And it didn't.</p>\n\n<p>So I looked up the IP address that my ISP provider gives me, it looks like this: <code>88.156.xxx.xx</code>. Now on my phone I typed <code>88.156.xxx.xx:80</code> and it didn't work. I tried to search SO and other resources on the web on how to connect remotely to my server from outside of LAN. And I didn't find an answer. Is there a way to do that without, I don't know, paying for sorts of things, or something like this?</p>\n\n<p>P.S I'm living in a rented room, there's not only me in the house, so I don't have a way to configure a router (manually or over the web)</p>\n"}, {"tags": ["testing", "go", "goroutine"], "comments": [{"owner": {"reputation": 535, "user_id": 7300655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Watfr.jpg?s=128&g=1", "display_name": "harrycmfan", "link": "https://stackoverflow.com/users/7300655/harrycmfan"}, "edited": false, "score": 0, "creation_date": 1505185073, "post_id": 46167142, "comment_id": 79296443, "body": "I have heard about using context, but not able to find an exact example similar to my use case"}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505186875, "post_id": 46167142, "comment_id": 79296913, "body": "I don&#39;t quite understand what you are trying to do.  Why are you setting <code>b</code> in a goroutine? If you don&#39;t want to use sleep, use a waitgroup.  <a href=\"https://stackoverflow.com/questions/19208725/example-for-sync-waitgroup-correct\" title=\"example for sync waitgroup correct\">stackoverflow.com/questions/19208725/&hellip;</a>"}, {"owner": {"reputation": 535, "user_id": 7300655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Watfr.jpg?s=128&g=1", "display_name": "harrycmfan", "link": "https://stackoverflow.com/users/7300655/harrycmfan"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505190252, "post_id": 46167142, "comment_id": 79297766, "body": "sorry, I think my example is confusing, I changed my example"}], "answers": [{"tags": [], "owner": {"reputation": 815, "user_id": 4995451, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/492c54bdc53bf5c972e7a4f3f60012af?s=128&d=identicon&r=PG&f=1", "display_name": "faisal burhanudin", "link": "https://stackoverflow.com/users/4995451/faisal-burhanudin"}, "is_accepted": true, "score": 5, "last_activity_date": 1565127664, "last_edit_date": 1565127664, "creation_date": 1505192825, "answer_id": 46168303, "question_id": 46167142, "link": "https://stackoverflow.com/questions/46167142/how-to-test-the-result-in-goroutine-without-wait-in-test/46168303#46168303", "title": "how to test the result in goroutine without wait in test", "body": "<p>If you really want to check the result of a goroutine, you should use a channel like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    // in test\n    c := Hello()\n    if &lt;-c != \"done\" {\n        fmt.Println(\"assert error\")\n    }\n\n    // not want to check result\n    Hello()\n}\n\nfunc Hello() &lt;-chan string {\n    c := make(chan string)\n    go func() {\n        fmt.Println(\"do something\")\n        c &lt;- \"done\"\n    }()\n    return c\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/zUpNXg61Wn\" rel=\"nofollow noreferrer\">https://play.golang.org/p/zUpNXg61Wn</a></p>\n"}, {"comments": [{"owner": {"reputation": 391, "user_id": 5816516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf4bab28a115e763c471b44d7edc99d0?s=128&d=identicon&r=PG", "display_name": "Oleh Holovko", "link": "https://stackoverflow.com/users/5816516/oleh-holovko"}, "edited": false, "score": 9, "creation_date": 1560948953, "post_id": 46170265, "comment_id": 99904086, "body": "Sometimes you need to test that the goroutine with the func has been actually called with an expected set of arguments. How should such cases be tested then?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 391, "user_id": 5816516, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf4bab28a115e763c471b44d7edc99d0?s=128&d=identicon&r=PG", "display_name": "Oleh Holovko", "link": "https://stackoverflow.com/users/5816516/oleh-holovko"}, "edited": false, "score": 0, "creation_date": 1560949030, "post_id": 46170265, "comment_id": 99904128, "body": "@OlehHolovko: Pretty much the same way  you check whether any func, in a goroutine or not, is called properly. Probably with some dependency injection. Similar questions have been asked many times here. I suggest a search, and if you can&#39;t find an answer, a separate question is probably warranted."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 4, "last_activity_date": 1505200765, "creation_date": 1505200765, "answer_id": 46170265, "question_id": 46167142, "link": "https://stackoverflow.com/questions/46167142/how-to-test-the-result-in-goroutine-without-wait-in-test/46170265#46170265", "title": "how to test the result in goroutine without wait in test", "body": "<p>Most questions of \"How do I test X?\" tend to boil down to <strong>X</strong> being too big.</p>\n\n<p>In your case, the simplest solution is not to use goroutines in tests.  Test each function in isolation. Change your code to:</p>\n\n<pre><code>func Hello() {\n    go updateDatabase()\n    doSomething()\n}\n\nfunc updateDatabase() {\n    // do something and store the result for example in db\n}\n\nfunc doSomething() {\n    // do something\n}\n</code></pre>\n\n<p>Then write separate tests for <code>updateDatabase</code> and <code>doSomething</code>.</p>\n"}], "owner": {"reputation": 535, "user_id": 7300655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Watfr.jpg?s=128&g=1", "display_name": "harrycmfan", "link": "https://stackoverflow.com/users/7300655/harrycmfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6649, "favorite_count": 0, "accepted_answer_id": 46168303, "answer_count": 2, "score": 10, "last_activity_date": 1565127664, "creation_date": 1505184556, "last_edit_date": 1505190196, "question_id": 46167142, "link": "https://stackoverflow.com/questions/46167142/how-to-test-the-result-in-goroutine-without-wait-in-test", "title": "how to test the result in goroutine without wait in test", "body": "<p>When I do ut of golang, I sometimes need to test the result in goroutine, I was using time.Sleep to test, I am wondering is there any better way to test.</p>\n\n<p>let's say I have an example code like this</p>\n\n<pre><code>func Hello() {\n    go func() {\n        // do something and store the result for example in db\n    }()\n    // do something\n}\n</code></pre>\n\n<p>Then when I test the func, I want to test both result in goroutine,\nI am doing this:</p>\n\n<pre><code> func TestHello(t *testing.T) {\n        Hello()\n        time.Sleep(time.Second) // sleep for a while so that goroutine can finish\n        // test the result of goroutine\n }\n</code></pre>\n\n<p>is there any better way to test this?</p>\n\n<p>Basically, in real logic, I don't care the result in goroutine, I don't need to wait for it finished. but in test, I want to check after it finished.</p>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505201722, "post_id": 46165999, "comment_id": 79303086, "body": "Have you already confirmed what you have is not efficient?"}, {"owner": {"reputation": 499, "user_id": 2785937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HoRgS.jpg?s=128&g=1", "display_name": "Luis Louis", "link": "https://stackoverflow.com/users/2785937/luis-louis"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505220651, "post_id": 46165999, "comment_id": 79315890, "body": "Is a opinion that i need, if i can improve this code."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505253164, "post_id": 46165999, "comment_id": 79334582, "body": "Improve from what perspective? You&#39;re speaking of &quot;efficiency&quot;, while it&#39;s not the absolute property of the code."}, {"owner": {"reputation": 499, "user_id": 2785937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HoRgS.jpg?s=128&g=1", "display_name": "Luis Louis", "link": "https://stackoverflow.com/users/2785937/luis-louis"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1505309068, "post_id": 46165999, "comment_id": 79360102, "body": "@zerkms is about improve the time of response, i know that it depend the latency,the server speed and those thing, but i want to now if is a good way."}], "answers": [{"tags": [], "owner": {"reputation": 499, "user_id": 2785937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HoRgS.jpg?s=128&g=1", "display_name": "Luis Louis", "link": "https://stackoverflow.com/users/2785937/luis-louis"}, "is_accepted": true, "score": 1, "last_activity_date": 1506092806, "creation_date": 1506092806, "answer_id": 46367852, "question_id": 46165999, "link": "https://stackoverflow.com/questions/46165999/golang-services-response-file/46367852#46367852", "title": "Golang services response file", "body": "<p>after look information about the question i get that solution</p>\n\n<p>to specify a browser that is a file i put that header to the response:</p>\n\n<blockquote>\n  <p>w.Header().Set(\"Content-Disposition\", \"attachment;\n  filename=NameOfFile\")</p>\n</blockquote>\n\n<p>after that i read the file with ioutil:</p>\n\n<blockquote>\n  <p>files, err := ioutil.ReadFile(result)</p>\n</blockquote>\n\n<p>and at the end i use the http.ResponseWriter to write the []byte of the file to the response</p>\n\n<blockquote>\n  <p>w.Write(files)</p>\n</blockquote>\n"}], "owner": {"reputation": 499, "user_id": 2785937, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HoRgS.jpg?s=128&g=1", "display_name": "Luis Louis", "link": "https://stackoverflow.com/users/2785937/luis-louis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 46367852, "answer_count": 1, "score": 0, "last_activity_date": 1506092970, "creation_date": 1505174745, "last_edit_date": 1506092970, "question_id": 46165999, "link": "https://stackoverflow.com/questions/46165999/golang-services-response-file", "title": "Golang services response file", "body": "<p>How can I return a file from a service more efficiently in Go? For example, I receive a file like this</p>\n\n<p>Here is an example that i use to receive a file from the service:</p>\n\n<pre><code>func (b *BenefitListHandler) UploadAppend(w http.ResponseWriter, r *http.Request) {\n    r.ParseMultipartForm(32 &lt;&lt; 20)\n    file, handler, err := r.FormFile(\"benefitlistuploadfile\")\n    if err != nil {\n        libhttp.EncodeErrorResponse(w, err, http.StatusInternalServerError)\n        return\n    }\ndefer file.Close()\nf, err := os.OpenFile(\"./\"+handler.Filename, os.O_WRONLY|os.O_CREATE, 0666)\nif err != nil {\n    libhttp.EncodeErrorResponse(w, err, http.StatusInternalServerError)\n    return\n}\n\ndefer f.Close()\nio.Copy(f, file)\n\ngo b.readFileAppend(\"./\" + handler.Filename)\n\nlibhttp.EncodeOKResponse(w, true)}\n</code></pre>\n\n<p>After that, I am confused how I can send another file from that request like a binary, to improve the time and consumption.</p>\n"}, {"tags": ["go", "exec"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 6, "last_activity_date": 1505165386, "creation_date": 1505165386, "answer_id": 46164633, "question_id": 46164618, "link": "https://stackoverflow.com/questions/46164618/how-do-you-print-multiline-exec-output-in-golang/46164633#46164633", "title": "How do you print multiline exec output in golang", "body": "<p>The return type of the first value from <code>Output</code> is <code>[]byte</code>. <code>fmt.Println</code> is displaying the numeric values of each slice element.</p>\n\n<p>To show the desired result of the output of the command, you can either convert the byte slice to a string or use a format string with the <code>%s</code> verb:</p>\n\n<pre><code>fmt.Println(string(out))\n</code></pre>\n\n<p>Or: </p>\n\n<pre><code>fmt.Printf(\"%s\\n\", out)\n</code></pre>\n"}], "owner": {"reputation": 1220, "user_id": 1316465, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/f211ce1ca0a29ab1007bc2a5fc73e175?s=128&d=identicon&r=PG", "display_name": "thed0ctor", "link": "https://stackoverflow.com/users/1316465/thed0ctor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1066, "favorite_count": 0, "accepted_answer_id": 46164633, "answer_count": 1, "score": -1, "last_activity_date": 1505165386, "creation_date": 1505165267, "question_id": 46164618, "link": "https://stackoverflow.com/questions/46164618/how-do-you-print-multiline-exec-output-in-golang", "title": "How do you print multiline exec output in golang", "body": "<p>I'm trying to write a simple golang program that lists the files in a directory. Whenever my shell command yields multiple lines, it registers in Go as an array</p>\n\n<p>For example, when i try the following:</p>\n\n<pre><code>import (\n    \"log\"\n    \"os/exec\"\n    \"fmt\"\n)\nfunc main (){\n\n    out,err := exec.Command(\"ls\").Output()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(out)\n\n}\n</code></pre>\n\n<p>I end up with the output <code>[101 108 105 109 115 116 97 116 115 46 105 109 108 10 101 110 118 10 115 99 114 97 116 99 104 10 115 114 99 10]</code></p>\n\n<p>I feel like this is a common thing to do but wasn't able to find it on here anywhere.</p>\n"}, {"tags": ["windows", "go"], "comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506085809, "post_id": 46162245, "comment_id": 79690679, "body": "its helpful if you can leave a comment explaining reason for down vote - I will probably do the same again"}], "answers": [{"comments": [{"owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "edited": false, "score": 0, "creation_date": 1506086007, "post_id": 46162622, "comment_id": 79690802, "body": "Thank you Tim - I had something similar at one point without the unsafe pointer, I think I get it now but still struggling to get how to do this for all types, looking at how I would reference a class now - I don&#39;t suppose you know of any good tutorials around c/go bindings"}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 2, "last_activity_date": 1505156199, "creation_date": 1505156199, "answer_id": 46162622, "question_id": 46162245, "link": "https://stackoverflow.com/questions/46162245/how-to-consume-a-windows-dll-method/46162622#46162622", "title": "How to consume a Windows DLL method", "body": "<ol>\n<li>The <code>PULONGLONG</code> parameter type translates to <code>*uint64</code></li>\n<li>You must cast the the address of the <code>memory</code> variable to the <a href=\"https://godoc.org/unsafe#Pointer\" rel=\"nofollow noreferrer\"><code>unsafe.Pointer</code></a> type and then to <code>uintptr</code></li>\n</ol>\n\n\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nfunc main() {\n    kernel32 := syscall.NewLazyDLL(\"kernel32.dll\")\n    getPhysicallyInstalledSystemMemoryProc := kernel32.NewProc(\"GetPhysicallyInstalledSystemMemory\")\n\n    var memory uint64\n\n    ret, _, err := getPhysicallyInstalledSystemMemoryProc.Call(uintptr(unsafe.Pointer(&amp;memory)))\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, return: %+v\\n\", ret)\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, memory: %d\\n\", memory)\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, err: %s\\n\", err)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 4913, "user_id": 1146094, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/4b24c43824d179acb4c0dff101823534?s=128&d=identicon&r=PG", "display_name": "SwiftD", "link": "https://stackoverflow.com/users/1146094/swiftd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 175, "favorite_count": 0, "accepted_answer_id": 46162622, "answer_count": 1, "score": -4, "last_activity_date": 1505191827, "creation_date": 1505154780, "last_edit_date": 1505162309, "question_id": 46162245, "link": "https://stackoverflow.com/questions/46162245/how-to-consume-a-windows-dll-method", "title": "How to consume a Windows DLL method", "body": "<p>I am trying to use the <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/cc300158(v=vs.85).aspx\" rel=\"nofollow noreferrer\"><code>GetPhysicallyInstalledSystemMemory</code></a> method which is present in kernel32.dll.</p>\n\n<p>It requires a single argument of the type <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa383751(v=vs.85).aspx#PULONGLONG\" rel=\"nofollow noreferrer\">PULONGLONG</a>, but I have no idea how to map this into a golang variable. Here is my current attempt which results in \"err: The parameter is incorrect\".</p>\n\n<p>Can anyone explain how to do this?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"syscall\"\n)\n\nvar memory uintptr\n\nfunc main() {\n    kernel32 := syscall.NewLazyDLL(\"kernel32.dll\")\n    getPhysicallyInstalledSystemMemoryProc := kernel32.NewProc(\"GetPhysicallyInstalledSystemMemory\")\n\n    ret, _, err := getPhysicallyInstalledSystemMemoryProc.Call(uintptr(memory))\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, return: %+v\\n\", ret)\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, memory: %d\\n\", memory)\n    fmt.Printf(\"GetPhysicallyInstalledSystemMemory, err: %s\\n\", err)\n\n}\n</code></pre>\n"}, {"tags": ["elasticsearch", "go"], "answers": [{"tags": [], "owner": {"reputation": 243, "user_id": 4918500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd905f22682e1f5a2ea10757ed3737b?s=128&d=identicon&r=PG&f=1", "display_name": "RyanD", "link": "https://stackoverflow.com/users/4918500/ryand"}, "is_accepted": false, "score": 0, "last_activity_date": 1505327989, "creation_date": 1505327989, "answer_id": 46204703, "question_id": 46162146, "link": "https://stackoverflow.com/questions/46162146/simultaneous-append-insert-to-elasticsearch/46204703#46204703", "title": "Simultaneous Append/Insert to Elasticsearch", "body": "<p>There is no \"append\" like mechanism for adding entries into an array using the rest endpoints. The only way to add an item to an array in Elasticsearch, is to:</p>\n\n<ol>\n<li>Get the Doc</li>\n<li>Add the element you want in memory</li>\n<li>Put the whole array back</li>\n</ol>\n\n<p>The other option you have is the scripting api. This will allow you to do the \"append\" semantics above, on the ES cluster itself.</p>\n\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/guide/current/partial-updates.html#_using_scripts_to_make_partial_updates\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/guide/current/partial-updates.html#_using_scripts_to_make_partial_updates</a></p>\n\n<p>Elasticsearch also uses optimistic locking to make sure that if multiple processes try to \"patch\" the field at the same time, only 1 will win, and the others will have to retrieve the doc again, and append what they want.</p>\n\n<p><a href=\"https://www.elastic.co/guide/en/elasticsearch/guide/current/optimistic-concurrency-control.html\" rel=\"nofollow noreferrer\">https://www.elastic.co/guide/en/elasticsearch/guide/current/optimistic-concurrency-control.html</a></p>\n"}], "owner": {"reputation": 11, "user_id": 8529299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c29c62433cb59764269aeef9e11dab4?s=128&d=identicon&r=PG&f=1", "display_name": "Michael H.", "link": "https://stackoverflow.com/users/8529299/michael-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 67, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505327989, "creation_date": 1505154353, "question_id": 46162146, "link": "https://stackoverflow.com/questions/46162146/simultaneous-append-insert-to-elasticsearch", "title": "Simultaneous Append/Insert to Elasticsearch", "body": "<p>Using elasticsearch 5.x and Elastic package 5.x</p>\n\n<p>Is there any way to handle simultaneous inserts or appends to an array field within a document in elasticsearch? I have an array field that can potentially have multiple items appended to it; however, that isn't always necessarily the case. Suppose I'm designing a forum/comment space. I have a document for posts, with \"likes\" or favorites being represented by arrays of usernames. How would I handle a case in which more than 1 user is appended to an array, without running the risk of users overwriting one another? </p>\n"}, {"tags": ["go", "reflection"], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1505152677, "creation_date": 1505152677, "answer_id": 46161722, "question_id": 46161603, "link": "https://stackoverflow.com/questions/46161603/golang-create-a-variable-from-another-one/46161722#46161722", "title": "golang, create a variable from another one", "body": "<blockquote>\n  <p>Is there a more elegant solution (without the two switch blocks) to do the same job ?</p>\n</blockquote>\n\n<p>No there is not.</p>\n\n<p>You could use reflection but would still need a switch for int, uints and floats.</p>\n\n<p>(Btw: Don't do such things.)</p>\n"}, {"tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": false, "score": 0, "last_activity_date": 1505232268, "creation_date": 1505232268, "answer_id": 46181014, "question_id": 46161603, "link": "https://stackoverflow.com/questions/46161603/golang-create-a-variable-from-another-one/46181014#46181014", "title": "golang, create a variable from another one", "body": "<p>There is more elegant and more effective solution - do not use <code>interface{}</code> as casting to/from interface{} will result in spending resources (CPU/memory) on boxing/unboxing.</p>\n\n<pre><code>// Bad solution - 11 lines of slow code\nfunc sumBad(x, y interface{}) interface{} {\n    switch reflect.ValueOf(x).Kind() {\n        case reflect.Int:\n            return x.(int) + y.(int)\n        case reflect.Float32:\n            return x.(float32) + y.(float32)\n        case reflect.Float64:\n            return x.(float64) + y.(float64)\n    }\n    return nil\n}\n\n// Good solution - 9 lines of code that works faster\nfunc sumInt(a, b int) int {\n    return a + b\n}\nfunc sumFloat32(a, b float32) float32 {\n    return a + b\n}\nfunc sumFloat64(a, b float64) float64 {\n    return a + b\n}\n</code></pre>\n\n<p>If you have much more code inside the function you can use <a href=\"https://blog.golang.org/generate\" rel=\"nofollow noreferrer\">Go code generation</a> to generate the functions for as many types as you want.</p>\n\n<p>Another alternative would be to choose a type that cover all your needs. For example can you use just <code>float64</code> and cast parameters to it whenever needed?</p>\n"}], "owner": {"reputation": 19, "user_id": 8593538, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b548f622bbe7f8ebfd339819f7ddd29a?s=128&d=identicon&r=PG&f=1", "display_name": "jean-yves boisiaud", "link": "https://stackoverflow.com/users/8593538/jean-yves-boisiaud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 116, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1505232268, "creation_date": 1505152127, "question_id": 46161603, "link": "https://stackoverflow.com/questions/46161603/golang-create-a-variable-from-another-one", "title": "golang, create a variable from another one", "body": "<p>I want to :</p>\n\n<ol>\n<li>Create a variable with the type of another one. The source variable is numeric (int, int16, float32, ...)</li>\n<li>Make some simple operations (+, -, ...) on this variable.</li>\n</ol>\n\n<p>This code works fine :</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"reflect\"\n)\n\nfunc init1(v interface{}) interface{} {\n    switch reflect.ValueOf(v).Kind() {\n        case reflect.Int:\n            return int(0)\n        case reflect.Float32:\n            return float32(0)\n        case reflect.Float64:\n            return float64(0)\n    }\n    return nil\n}\n\nfunc sum(x, y interface{}) interface{} {\n    switch reflect.ValueOf(x).Kind() {\n        case reflect.Int:\n            return x.(int) + y.(int)\n        case reflect.Float32:\n            return x.(float32) + y.(float32)\n        case reflect.Float64:\n            return x.(float64) + y.(float64)\n    }\n    return nil\n}\n\nfunc main() {\n    v0 := 222.33\n    x0 := init1(v0)\n    x0 = sum(x0, v0)\n    x0 = sum(x0, v0)\n    fmt.Printf(\"v=%v, x=%v type x=%T\\n\", v0, x0, x0)\n\n    v1 := 33\n    x1 := init1(v1)\n    x1 = sum(x1, v1)\n    x1 = sum(x1, v1)\n    fmt.Printf(\"v=%v, x=%v type x=%T\\n\", v1, x1, x1)\n}\n</code></pre>\n\n<p>Result :</p>\n\n<pre><code>v=222.33, x=444.66 type x=float64\nv=33, x=66 type x=int\n</code></pre>\n\n<p>Is there a more elegant solution (without the two switch blocks) to do the same job ?</p>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["go", "interface"], "answers": [{"tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 1, "last_activity_date": 1505148195, "creation_date": 1505148195, "answer_id": 46160561, "question_id": 46159620, "link": "https://stackoverflow.com/questions/46159620/package-directory-structuring-for-interfaces-and-their-implementations/46160561#46160561", "title": "Package/directory structuring for Interfaces and their implementations", "body": "<p>Another possible approach could be to rearrange your packages.  Instead of <code>services</code> having more empowered collections of objects, reflected in directory structure:</p>\n\n<pre><code>- users/\n   - app.go\n   - map.go\n   - interface.go\n</code></pre>\n\n<p>Which could support a <code>users.New()</code> method which would be registered to delegate to the default.  This could allow you to keep stub/memory based interfaces in separate files from the production implementations.</p>\n\n<p>If you needed a service registry or something that could be a separate abstraction which has <code>users.New()</code> registered, or something?</p>\n"}, {"comments": [{"owner": {"reputation": 331, "user_id": 6002507, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/569ff207499b7c90a1d241e05377f8e5?s=128&d=identicon&r=PG&f=1", "display_name": "aetheus", "link": "https://stackoverflow.com/users/6002507/aetheus"}, "edited": false, "score": 0, "creation_date": 1505178295, "post_id": 46161815, "comment_id": 79295003, "body": "So if we wanted to access the <code>MapUser</code> implementation, would it be  <code>map.MapUser</code> ?  I&#39;m guessing not, since there&#39;s repetition, and &quot;MapUser&quot; doesn&#39;t tell us it&#39;s a service anymore.  Or should it just adopt the interface name, becoming <code>map.UserService</code>? If, for instance, all the other services also had &quot;map&quot; implementations, wouldn&#39;t they all also live in a &quot;map&quot; package, making &quot;map.New()&quot; ambiguous?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 331, "user_id": 6002507, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/569ff207499b7c90a1d241e05377f8e5?s=128&d=identicon&r=PG&f=1", "display_name": "aetheus", "link": "https://stackoverflow.com/users/6002507/aetheus"}, "edited": false, "score": 0, "creation_date": 1505199524, "post_id": 46161815, "comment_id": 79301685, "body": "@aetheus: Yes, your <code>map.MapUser</code> (or <code>map.User</code> if you prefer a less redundant name) is the implementation of your service interface.  What you name it doesn&#39;t matter in a technical sense."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 331, "user_id": 6002507, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/569ff207499b7c90a1d241e05377f8e5?s=128&d=identicon&r=PG&f=1", "display_name": "aetheus", "link": "https://stackoverflow.com/users/6002507/aetheus"}, "edited": false, "score": 0, "creation_date": 1505199567, "post_id": 46161815, "comment_id": 79301710, "body": "@aetheus: If you have different map service implementations, I suggest putting them in separate packages. Name them appropriately to avoid confusion. <code>mapuser.New()</code>, <code>mapfoo.New()</code>, etc."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 6, "last_activity_date": 1505152994, "creation_date": 1505152994, "answer_id": 46161815, "question_id": 46159620, "link": "https://stackoverflow.com/questions/46159620/package-directory-structuring-for-interfaces-and-their-implementations/46161815#46161815", "title": "Package/directory structuring for Interfaces and their implementations", "body": "<p>Your interface implementations should (generally) live in separate packages. This isn't a hard and fast rule, and you may often have a default instance live next to the interface definition.</p>\n\n<p>But think of a more abstract example: a Key/Value store interface.  It may be backed by the filesystem, a SQL database, Amazon S3, or an in-memory data structure.</p>\n\n<p>You'd typically define your interface in one place, say <code>myproject/kvstore/kvstore.go</code>.</p>\n\n<p>Then you'll define your implementations elsewhere.  Possibly even in entirely different repositories.</p>\n\n<pre><code>- myproject\n    - kvstore\n        kvstore.go\n        memory.go    -- A default implementation, non-persistent\n        - filesystem\n            filesystem.go -- A file-persistent implementation\n- yourproject\n    - sqlite    -- An implementation backed by sqlite\n</code></pre>\n\n<p>In your specific example, at minimum I would store my implementations one level beneath the interface definition:</p>\n\n<pre><code>- services/\n    - userService/\n        - interface.go  // the User interface\n        - app\n            app.go // the AppUser struct\n        - map\n            map.go // the MapUser struct\n    - [other services here]\n</code></pre>\n\n<p>Then there's no confusion between <code>map.New()</code> and <code>app.New()</code>, and your internal data structures won't step on each other, etc.</p>\n"}], "owner": {"reputation": 331, "user_id": 6002507, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/569ff207499b7c90a1d241e05377f8e5?s=128&d=identicon&r=PG&f=1", "display_name": "aetheus", "link": "https://stackoverflow.com/users/6002507/aetheus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2088, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1572203648, "creation_date": 1505144925, "last_edit_date": 1572203648, "question_id": 46159620, "link": "https://stackoverflow.com/questions/46159620/package-directory-structuring-for-interfaces-and-their-implementations", "title": "Package/directory structuring for Interfaces and their implementations", "body": "<p>Let's consider your typical web application. In an MVC application, you may eventually want to introduce a \"Service\" layer that abstracts complex business logic such as user registration. So in your controller, you'd pass an instance of a <code>services.User</code> struct and simply call the <code>Register()</code> method on it. </p>\n\n<p>Now, if <code>services.User</code> was simply a struct, we could have a relatively simple source code structure, like so:</p>\n\n<pre><code>- [other directories here]/\n- services/\n    - user.go\n    - [other service structs here]\n- main.go\n</code></pre>\n\n<p>And the <code>services/user.go</code> would look like so : </p>\n\n<pre><code>package services\n\ntype User struct { ... }\nfunc NewUserService(){ ... }\nfunc (u User) Register() { ... }\n</code></pre>\n\n<p>Which is all reasonably easy to read, so far. Let's say we take it one step further. In the spirit of making our web app easily testable, we'll turn all our Service structs into Service interfaces. That way, we can easily mock them for unit tests. For that purpose, we'll create a \"AppUser\" struct (for use in the actual application) and a \"MapUser\" struct (for mocking purposes). Placing the interfaces and the implementations in the same <code>services</code> directory makes sense - they're all still <code>service</code> code, after all.</p>\n\n<p>Our <code>services</code> folder now looks like this:</p>\n\n<pre><code>- services/\n    - app_user.go // the AppUser struct\n    - [other services here]\n    - map_user.go // the MapUser struct\n    - [other services here]\n    - user.go  // the User interface\n    - [other service structs here]\n</code></pre>\n\n<p>As you can tell, this makes the <code>services</code> package and directory a lot more difficult to handle - you can easily imagine how chaotic it would look with a dozen different interfaces, each of which at least have at least 1 implementation. If I change the <code>User</code> interface in <code>user.go</code>, I'd have to dart all across the directory listing to find all it's implementations to change, which is not at all ideal.</p>\n\n<p>Additionally, it becomes pretty crazy when you type <code>services.New(...)</code> and you're greeted with perhaps 50 or so autocomplete suggestions ; the <code>services</code> package has become nothing but a shambling monster.</p>\n\n<p>One of the simplest ideas I had to solve this is to go against convention and embrace repetition: </p>\n\n<pre><code>- services/\n    - userService/\n        - app.go // the AppUser struct\n        - map.go // the MapUser struct\n        - interface.go  // the User interface\n    - [other services here]\n</code></pre>\n\n<p>This keeps all the UserService related code in a logical, self contained package. But having to constantly refer to <code>userService.UserService</code> is pretty darn ugly.</p>\n\n<p>I've looked at all kinds of web application templates, and none of them (beyond the ones that are incredibly barebones) have an elegant solution to this structural. Most (if not all) of them simply omit interfaces completely to solve it, which is unacceptable. </p>\n"}, {"tags": ["go", "dependency-management"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1505145268, "post_id": 46159515, "comment_id": 79281415, "body": "<code>github.com&#47;my-repo&#47;myproject</code> and <code>github.com&#47;tendermint&#47;tendermint</code> are different paths. You need to keep the import path the same to share the code between multiple packages."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505145471, "post_id": 46159515, "comment_id": 79281558, "body": "@JimB In both projects, the import used is <code>&quot;github.com&#47;tendermint&#47;go-crypto&quot;</code>. I&#39;ll try and create a SSCE to demonstrate..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1505145686, "post_id": 46159515, "comment_id": 79281694, "body": "Oh, I see what you mean. The <code>tendermint</code> package has a vendor directory -- libraries can&#39;t really have vendor folders, which is why they are stripped out by vendoring tools. You can either remove the vendor directory for testing, or vendor your new version into your project."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505146299, "post_id": 46159515, "comment_id": 79282054, "body": "@JimB I&#39;ve tried with and without the vendor folder in the <code>tendermint</code> package. With the folder in place, I get the errors in this question. Without the folder in place, I get countless build errors for packages that are vendored in <i>my</i> project. A lovely mess :-)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505147590, "post_id": 46159515, "comment_id": 79282815, "body": "Yeah, this get kind of hairy with lots of complex deps ;) while it works in simple cases to get rid of <code>.&#47;vendor</code>, in general I test changes to a dependency in isolation (e.g. the &quot;unit&quot; tests), and test the integration by vendoring the changes back into the dependent project."}, {"owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505148225, "post_id": 46159515, "comment_id": 79283157, "body": "@JimB If it helps, I&#39;ve updated with a compilable example. There doesn&#39;t seem to be a neat answer to this, yet presumably it&#39;s a common enough requirement..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505149042, "post_id": 46159515, "comment_id": 79283595, "body": "Yes, if you remove the entire <code>vendor&#47;</code> directory, you&#39;re going to have to have all those packages somewhere else, which means in your GOPATH (and checked out at compatible commits), and you need to watch out for separate vendor directories in each package. Yes, you need to commit your changes for a vendor tool to pick them up, but that only needs to be local. For small changes I&#39;ll often first test by modifying the vendored code directly to skip the step of updating the vendor tree."}], "owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505148191, "creation_date": 1505144602, "last_edit_date": 1505148191, "question_id": 46159515, "link": "https://stackoverflow.com/questions/46159515/go-complains-of-wrong-type-when-using-modified-version-of-dependency", "title": "Go complains of wrong type when using modified version of dependency", "body": "<p>I'm using <code>dep</code> to manage dependencies in my Go project.</p>\n\n<p>I have a simple project in <code>~/go/src/github.com/my-repo/myproject</code>, with one file <code>example.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    tcrypto \"github.com/tendermint/go-crypto\"\n    \"github.com/tendermint/tendermint/types\"\n)\n\ntype ExampleSigner struct{}\n\n// Implements types.Signer\nfunc (signer ExampleSigner) Sign(msg []byte) tcrypto.Signature {\n    return tcrypto.Signature{}\n}\n\n// Implements types.Signer\nfunc (signer ExampleSigner) PubKey() tcrypto.PubKey {\n    return tcrypto.PubKey{}\n}\n\nfunc main() {\n    mySigner := ExampleSigner{}\n    validator := types.LoadPrivValidator(\"foo\")\n    validator.SetSigner(mySigner)\n}\n</code></pre>\n\n<p>Running <code>dep init</code>, then <code>dep ensure</code>, then <code>go install</code> works fine. (Running the code won't do anything meaningful - this is just enough code to reproduce the compilation error below).</p>\n\n<p>Now, I want to use a modified version of <a href=\"https://github.com/tendermint/tendermint\" rel=\"nofollow noreferrer\"><code>github.com/tendermint/tendermint</code></a>, so per <a href=\"https://github.com/golang/dep#testing-changes-to-a-dependency\" rel=\"nofollow noreferrer\">the documentation</a>, I've removed the directory from <code>./vendor</code> and have a modified copy in my <code>$GOPATH</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>~/go/src/github.com/tendermint/tendermint    &lt;---- (modified copy)\n~/go/src/github.com/my-repo/myproject/vendor/github.com/tendermint/tendermint\n                                                                   ^^^^^^^^^^\n                                                          (I deleted this directory)\n</code></pre>\n\n<p>I now get the following compilation errors, assuming I've installed the <code>tendermint/tendermint</code> dependencies using <code>glide install</code>:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code># github.com/my-repo/myproject\n./example.go:25:21: cannot use mySigner (type ExampleSigner) as type \"github.com/tendermint/tendermint/types\".Signer in argument to validator.SetSigner:\n    ExampleSigner does not implement \"github.com/tendermint/tendermint/types\".Signer (wrong type for PubKey method)\n        have PubKey() \"github.com/my-repo/myproject/vendor/github.com/tendermint/go-crypto\".PubKey\n        want PubKey() \"github.com/tendermint/tendermint/vendor/github.com/tendermint/go-crypto\".PubKey\n</code></pre>\n\n<p>If I delete the <code>~/go/src/github.com/tendermint/tendermint/vendor</code> directory, I then get these errors instead:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>../../tendermint/tendermint/types/events.go:5:2: cannot find package \"github.com/tendermint/abci/types\" in any of:\n    /usr/local/go/src/github.com/tendermint/abci/types (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/abci/types (from $GOPATH)\n../../tendermint/tendermint/types/genesis.go:10:2: cannot find package \"github.com/tendermint/go-crypto\" in any of:\n    /usr/local/go/src/github.com/tendermint/go-crypto (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/go-crypto (from $GOPATH)\n../../tendermint/tendermint/types/block.go:11:2: cannot find package \"github.com/tendermint/go-wire\" in any of:\n    /usr/local/go/src/github.com/tendermint/go-wire (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/go-wire (from $GOPATH)\n../../tendermint/tendermint/types/block.go:12:2: cannot find package \"github.com/tendermint/go-wire/data\" in any of:\n    /usr/local/go/src/github.com/tendermint/go-wire/data (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/go-wire/data (from $GOPATH)\n../../tendermint/tendermint/types/block.go:13:2: cannot find package \"github.com/tendermint/tmlibs/common\" in any of:\n    /usr/local/go/src/github.com/tendermint/tmlibs/common (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/tmlibs/common (from $GOPATH)\n../../tendermint/tendermint/types/events.go:8:2: cannot find package \"github.com/tendermint/tmlibs/events\" in any of:\n    /usr/local/go/src/github.com/tendermint/tmlibs/events (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/tmlibs/events (from $GOPATH)\n../../tendermint/tendermint/types/priv_validator.go:15:2: cannot find package \"github.com/tendermint/tmlibs/log\" in any of:\n    /usr/local/go/src/github.com/tendermint/tmlibs/log (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/tmlibs/log (from $GOPATH)\n../../tendermint/tendermint/types/block.go:14:2: cannot find package \"github.com/tendermint/tmlibs/merkle\" in any of:\n    /usr/local/go/src/github.com/tendermint/tmlibs/merkle (from $GOROOT)\n    /home/djones/go/src/github.com/tendermint/tmlibs/merkle (from $GOPATH)\n</code></pre>\n\n<p>Is there any way to avoid these errors, without having to commit my modified <code>tendermint/tendermint</code> to a repo somewhere and use <code>source</code> in my <code>Gopkg.toml</code>?</p>\n"}, {"tags": ["go", "amazon-ec2", "load", "amazon-kinesis", "amazon-kcl"], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 5610684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-kDm59KfTh_Q/AAAAAAAAAAI/AAAAAAAAABw/dJFMBCAF71I/photo.jpg?sz=128", "display_name": "Vincent acent", "link": "https://stackoverflow.com/users/5610684/vincent-acent"}, "edited": false, "score": 0, "creation_date": 1505374709, "post_id": 46204869, "comment_id": 79389189, "body": "Thank you for the resources, Ryan. But you didn&#39;t answer my question here."}], "tags": [], "owner": {"reputation": 243, "user_id": 4918500, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1cd905f22682e1f5a2ea10757ed3737b?s=128&d=identicon&r=PG&f=1", "display_name": "RyanD", "link": "https://stackoverflow.com/users/4918500/ryand"}, "is_accepted": false, "score": 0, "last_activity_date": 1505328618, "creation_date": 1505328618, "answer_id": 46204869, "question_id": 46159268, "link": "https://stackoverflow.com/questions/46159268/how-to-balance-kinesis-shards-across-several-record-processor/46204869#46204869", "title": "How to balance kinesis shards across several record processor?", "body": "<p>Before you start writing your own client...it looks like there are some people who have already done this:</p>\n\n<ul>\n<li><a href=\"https://github.com/nieksand/gokinesis\" rel=\"nofollow noreferrer\">https://github.com/nieksand/gokinesis</a></li>\n<li><a href=\"https://github.com/runtakun/kinesis-connector-go\" rel=\"nofollow noreferrer\">https://github.com/runtakun/kinesis-connector-go</a></li>\n</ul>\n\n<p>Another option you have is the KCL MultiLangDaemon. You can install a small runner program that does all the balancing for you, and then you just listen to the messages the daemon sends you and commit them back.</p>\n\n<p><a href=\"https://github.com/awslabs/amazon-kinesis-client#amazon-kcl-support-for-other-languages\" rel=\"nofollow noreferrer\">https://github.com/awslabs/amazon-kinesis-client#amazon-kcl-support-for-other-languages</a></p>\n"}, {"tags": [], "owner": {"reputation": 14421, "user_id": 836214, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/8f33763395d06f0b8a68cb0cfa31a72d?s=128&d=identicon&r=PG", "display_name": "Krease", "link": "https://stackoverflow.com/users/836214/krease"}, "is_accepted": false, "score": 6, "last_activity_date": 1509904400, "creation_date": 1509904400, "answer_id": 47124729, "question_id": 46159268, "link": "https://stackoverflow.com/questions/46159268/how-to-balance-kinesis-shards-across-several-record-processor/47124729#47124729", "title": "How to balance kinesis shards across several record processor?", "body": "<p>KCL already does load balancing for you.</p>\n\n<p>Here's a basic description of how it works today (keep in mind this is just the basics and is subject to change as Amazon improves the logic): </p>\n\n<ul>\n<li>When a worker (which may process multiple shards) starts up, it checks a central DynamoDB database for which shards are owned by workers (creating that database if necessary). This is the \"leasing\" table.\n\n<ul>\n<li>A \"lease\" is a relationship between a worker and a shard</li>\n<li>Workers will process records for shards it owns an unexpired lease for</li>\n<li>Leases expire if the worker hasn't emitted a \"heartbeat\" for the lease before it expires (typically every few seconds) - this heartbeat essentially updates the DDB record</li>\n</ul></li>\n<li>It checks Kinesis stream for which shards are available, and updates the table if needed</li>\n<li>If any leases are expired, the worker will try to take ownership of the lease - at database level, use shardId as key and write it's workerId there.</li>\n<li>If a worker starts and all shards are already taken, it checks to see what the \"balance\" is - if it detects an imbalance (ie: \"I own 0 shards and some other worker owns 10 shards\"), it initiates a \"steal shard\" protocol - the old worker stops processing for that shard, and the new worker starts</li>\n</ul>\n\n<p>You're of course free to examine the source code for KCL on github: <a href=\"https://github.com/awslabs/amazon-kinesis-client\" rel=\"noreferrer\">https://github.com/awslabs/amazon-kinesis-client</a> - hopefully this explanation gives you more context for how to understand KCL and adapt it to your needs.</p>\n"}, {"tags": [], "owner": {"reputation": 161, "user_id": 1297767, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6dbddfda34303f8d83620f7293612671?s=128&d=identicon&r=PG", "display_name": "Tommaso Visconti", "link": "https://stackoverflow.com/users/1297767/tommaso-visconti"}, "is_accepted": false, "score": 0, "last_activity_date": 1567686487, "creation_date": 1567686487, "answer_id": 57805503, "question_id": 46159268, "link": "https://stackoverflow.com/questions/46159268/how-to-balance-kinesis-shards-across-several-record-processor/57805503#57805503", "title": "How to balance kinesis shards across several record processor?", "body": "<p>For people interested in the topic, VMWare wrote the Go implementation of the Java lib: <a href=\"https://github.com/vmware/vmware-go-kcl/\" rel=\"nofollow noreferrer\">https://github.com/vmware/vmware-go-kcl/</a></p>\n\n<p>At the time of writing, though, it doesn't support lease stealing: <a href=\"https://github.com/vmware/vmware-go-kcl/issues/4\" rel=\"nofollow noreferrer\">https://github.com/vmware/vmware-go-kcl/issues/4</a></p>\n"}], "owner": {"reputation": 365, "user_id": 5610684, "user_type": "registered", "accept_rate": 67, "profile_image": "https://lh6.googleusercontent.com/-kDm59KfTh_Q/AAAAAAAAAAI/AAAAAAAAABw/dJFMBCAF71I/photo.jpg?sz=128", "display_name": "Vincent acent", "link": "https://stackoverflow.com/users/5610684/vincent-acent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1495, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1567686487, "creation_date": 1505143813, "question_id": 46159268, "link": "https://stackoverflow.com/questions/46159268/how-to-balance-kinesis-shards-across-several-record-processor", "title": "How to balance kinesis shards across several record processor?", "body": "<p>I am currently writing the simple Kinesis Client Library (KCL) in Golang version. One of the features that I want it for my simple KCL is load balancing shards across multiple record processors and EC2 instances. For example, I have two record processors (which will run in the separate EC2 instance) and four Kinesis shards. The load balancing feature will allow each record processors to process <strong>two Kinesis shards</strong>. </p>\n\n<p>I read that Java KCL implemented this but I can't find the implementation in the library. My question is how am I going to implement this feature in Golang? Thank you. </p>\n"}, {"tags": ["mysql", "go", "beego"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1505161436, "post_id": 46158034, "comment_id": 79290010, "body": "Execute sql query, process results, return&#39;em?"}], "answers": [{"tags": [], "owner": {"reputation": 1509, "user_id": 1093694, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/4hdHu.jpg?s=128&g=1", "display_name": "Lupus", "link": "https://stackoverflow.com/users/1093694/lupus"}, "is_accepted": false, "score": 0, "last_activity_date": 1505235084, "last_edit_date": 1505235084, "creation_date": 1505234769, "answer_id": 46181755, "question_id": 46158034, "link": "https://stackoverflow.com/questions/46158034/how-get-data-from-database-in-gobeego/46181755#46181755", "title": "How get data from database in Go&amp;Beego?", "body": "<p>You should use <code>QueryTable</code> as mentioned <a href=\"https://github.com/beego/beedoc/blob/master/en-US/mvc/model/query.md#all\" rel=\"nofollow noreferrer\">here</a></p>\n\n<pre><code>var users []*User\nnum, err := o.QueryTable(\"user\").Filter(\"name\", \"slene\").All(&amp;users)\n</code></pre>\n\n<p>In your case your <code>GetAllUsers</code> should look like this but I didn't tested it.</p>\n\n<pre><code>func GetAllUsers() map[int]*User {\n    usrs, err := orm.QueryTable(\"users\").Values(&amp;UserList)\n    if err != nil {\n        panic(err)\n    }\n    return UserList\n}\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 5226527, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oaSNg.jpg?s=128&g=1", "display_name": "Igor Bezlepkin", "link": "https://stackoverflow.com/users/5226527/igor-bezlepkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 622, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1534769394, "creation_date": 1505139840, "last_edit_date": 1534769394, "question_id": 46158034, "link": "https://stackoverflow.com/questions/46158034/how-get-data-from-database-in-gobeego", "title": "How get data from database in Go&amp;Beego?", "body": "<p>I try create a simple REST service on Go&amp;Beego.</p>\n\n<p>I can not understand the logic of Beego.</p>\n\n<p>All examples have information on how to retrieve just one item while I need to get all items.</p>\n\n<p>In case of API.</p>\n\n<p><strong>Controller:</strong></p>\n\n<pre><code>package controllers\nimport (\n    \"api/models\"\n    \"github.com/astaxie/beego\"\n)\n\ntype UserController struct {\n    beego.Controller\n}\n\nfunc (u *UserController) GetAll() {\n    users := models.GetAllUsers()\n    u.Data[\"json\"] = users\n    u.ServeJSON()\n}\n</code></pre>\n\n<p><strong>Model:</strong></p>\n\n<pre><code>package models\n\nimport (\n    \"github.com/astaxie/beego/orm\"\n)\n\nvar (\n    UserList map[int]*User\n)\n\nfunc init() {\n    orm.RegisterModel(new(User))\n\n    UserList = make(map[int]*User)\n\n    u := User{1, \"Chandler\", \"Bing\", \"chandlerbing@gmail.com\"}\n    UserList[1] = &amp;u\n}\n\ntype User struct {\n    Id int `form:\"id\"`\n    First_name string `form:\"first_name\"`\n    Last_name string `form:\"last_name\"`\n    Email string `form:\"email\"`\n}\n\nfunc GetAllUsers() map[int]*User {\n    return UserList\n}\n</code></pre>\n\n<p>That works! But, how can I get data from database?</p>\n\n<p>Database connections are ok (MySQL)</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505134957, "post_id": 46156376, "comment_id": 79274528, "body": "Packages need to be a directory. See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>. Start off with a single <code>GOPATH</code>, you can even use the default of <code>$HOME&#47;go</code> and not worry about it at all."}, {"owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 0, "creation_date": 1505134962, "post_id": 46156376, "comment_id": 79274531, "body": "You should place your project <code>firstapp</code> under <code>&#47;usr&#47;local&#47;go&#47;src</code> for it is where your <code>GOPATH</code> points to. Moreover you can&#39;t have 2 different packages in the same directory. So <code>data.go</code> should be in package <code>main</code>too."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 0, "creation_date": 1505135006, "post_id": 46156376, "comment_id": 79274561, "body": "@TheophileDano: no, that is <code>GOROOT</code>, and you should <i>never</i> put your code in <code>GOROOT</code>."}, {"owner": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505135145, "post_id": 46156376, "comment_id": 79274660, "body": "@JimB before he edited the post I thought I had seen gopath set to this location..."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 989, "user_id": 5016244, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/bdZPE.jpg?s=128&g=1", "display_name": "Theophile Dano", "link": "https://stackoverflow.com/users/5016244/theophile-dano"}, "edited": false, "score": 1, "creation_date": 1505135335, "post_id": 46156376, "comment_id": 79274786, "body": "@TheophileDano: <code>&#47;usr&#47;local&#47;go&#47;</code> is the default Go install path -- it should never be GOPATH. (P.S., can view the edit history of the post)"}, {"owner": {"reputation": 846, "user_id": 4850377, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b9a39021f91e3011063eb092916afb2b?s=128&d=identicon&r=PG&f=1", "display_name": "GAK", "link": "https://stackoverflow.com/users/4850377/gak"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505139755, "post_id": 46156376, "comment_id": 79277884, "body": "@volker I edited my question. It is unique as I believe i follow the documents but the code is still breaking."}, {"owner": {"reputation": 846, "user_id": 4850377, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b9a39021f91e3011063eb092916afb2b?s=128&d=identicon&r=PG&f=1", "display_name": "GAK", "link": "https://stackoverflow.com/users/4850377/gak"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505139826, "post_id": 46156376, "comment_id": 79277923, "body": "@jimB and @ TheophileDano i modified the structure and set the GOPATH to point to my project1 directory but still unable to find the package."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505139999, "post_id": 46156376, "comment_id": 79278045, "body": "As I said in the first comment, a package must be a directory. You don&#39;t have an import path of  <code>datatypes&#47;data</code> because there is no <code>data</code> directory."}, {"owner": {"reputation": 846, "user_id": 4850377, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b9a39021f91e3011063eb092916afb2b?s=128&d=identicon&r=PG&f=1", "display_name": "GAK", "link": "https://stackoverflow.com/users/4850377/gak"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505140268, "post_id": 46156376, "comment_id": 79278244, "body": "@JimB thanks I changed my package declaration as datatypes instead of datatypes/data in the hello.go and it fixed it. Thanks for the help."}], "owner": {"reputation": 846, "user_id": 4850377, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/b9a39021f91e3011063eb092916afb2b?s=128&d=identicon&r=PG&f=1", "display_name": "GAK", "link": "https://stackoverflow.com/users/4850377/gak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3686, "favorite_count": 0, "closed_date": 1505136417, "answer_count": 0, "score": 0, "last_activity_date": 1505139711, "creation_date": 1505134800, "last_edit_date": 1505139711, "question_id": 46156376, "link": "https://stackoverflow.com/questions/46156376/golang-package-not-found", "closed_reason": "Duplicate", "title": "Golang package not found", "body": "<p>I am new to go lang and I m trying out my first app. I hit a roadblock while importing a package from another go file. </p>\n\n<p>I have two go files. 1. hello.go with main package. 2. data.go with data package. </p>\n\n<p>The code inside hello.go is </p>\n\n<pre><code>   package main\n\n   import (\n    \"datatypes/data\"\n    \"fmt\"\n       )\n\n  func main() {\n      fmt.Print(\"Hello world!!\\n\")\n      /* calling the first function from another function */\n      myFirstFunction()\n   }\n\n  func myFirstFunction() {\n      fmt.Print(\"This is the first function\\n\")\n      data.WorkingWithDataTypes()\n  }\n</code></pre>\n\n<p>data.go code is </p>\n\n<pre><code>   package data\n\n  import \"fmt\"\n\n  /*WorkingWithDataTypes is a function to work with go lang data types */\n  func WorkingWithDataTypes() {\n    x := 10\n    fmt.Print(x)\n   }\n</code></pre>\n\n<p>When I run the main function by running go run hello.go I am getting the below error</p>\n\n<pre><code>**hello.go:10:2: cannot find package \"firstapp/data\" in any of:     \n/usr/local/go/src/firstapp/data (from $GOROOT)  \n/Users/home/workspaces/Go/Project1/src/firstapp/data (from $GOPATH)**\n</code></pre>\n\n<p>I set my go path as /Users/home/workspaces/Go/Project1. I am not sure where I make the mistake. any help?</p>\n\n<p>I set the GO PATH as </p>\n\n<p><a href=\"https://i.stack.imgur.com/CbJ1s.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/CbJ1s.png\" alt=\"enter image description here\"></a></p>\n\n<p>As per the go doc <a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">for go path</a></p>\n\n<p>I created the project structure as below and put my code below src folder. </p>\n\n<p>src/datatypes has the package data. \nsrc/main has the package main. </p>\n\n<p>But still go run hello.go is failing as it is not able to find the package datatypes/data</p>\n\n<p><a href=\"https://i.stack.imgur.com/hdrSr.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/hdrSr.png\" alt=\"enter image description here\"></a></p>\n"}, {"tags": ["xml", "go", "unmarshalling"], "answers": [{"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": false, "score": 0, "last_activity_date": 1505145579, "creation_date": 1505145579, "answer_id": 46159812, "question_id": 46155977, "link": "https://stackoverflow.com/questions/46155977/golang-unmarshal-change-structure-index-to-defined-value/46159812#46159812", "title": "Golang unmarshal change structure index to defined value", "body": "<p>As <code>v.Src</code> is a slice with <code>Src</code> its indices reveal only order of elements but not their inner fields. How to solve a task:</p>\n\n<ol>\n<li><p>Make special map with pointers to elements</p>\n\n<pre><code>srcs := make(map[int64]*Src)\n\nfor index, src := range v.Src {\n    id, _ := strconv.ParseInt(src.Id, 10, 64)\n    srcs[id] = &amp;(v.Src[index])\n}\n\nfmt.Printf(\"Srcs: %v\\n\", srcs)\nfmt.Printf(\"%#v\\n\", srcs[1].Name) //Prints: \"MySource\"\nfmt.Printf(\"%#v\\n\", srcs[2].Name) //Prints: \"MySource2\"\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6y3uW2jV13\" rel=\"nofollow noreferrer\">https://play.golang.org/p/6y3uW2jV13</a></p></li>\n<li><p>Use XPath to access elements with specific properties and then select like <code>//source[./id=1]/name</code></p></li>\n</ol>\n"}], "owner": {"reputation": 21, "user_id": 2525209, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd8adf6cec0309f39a2d15204448623f?s=128&d=identicon&r=PG", "display_name": "Snaky", "link": "https://stackoverflow.com/users/2525209/snaky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 146, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505145579, "creation_date": 1505133430, "question_id": 46155977, "link": "https://stackoverflow.com/questions/46155977/golang-unmarshal-change-structure-index-to-defined-value", "title": "Golang unmarshal change structure index to defined value", "body": "<p>See code below:</p>\n\n<p>Print out v.Src[0] and v.Src[1] brings up \"MySource\" and \"MySource2\".</p>\n\n<p>But comparing the XML, the entries [0] and [1] do not follow the id's set in <code>&lt;id&gt;x&lt;/id&gt;</code> </p>\n\n<p>How can I achieve that the decoder is using the <code>&lt;id&gt;x&lt;/id&gt;</code> as index? </p>\n\n<p>Target: v.Src[1] prints \"MySource\"</p>\n\n<p>Here is my working code</p>\n\n<p>package main</p>\n\n<pre><code>import (\n\n    \"encoding/xml\"\n    \"fmt\"\n)\n\n    type Flow struct {\n        Id   string `xml:\"id\"`\n        Name string `xml:\"name\"`\n    }\n    type Src struct {\n        Id    string `xml:\"id\"`\n        Name  string `xml:\"name\"`\n        Flows []Flow `xml:\"flows&gt;flow\"`\n    }\n    type Result struct {\n        Src   []Src  `xml:\"bar&gt;sources&gt;source\"`\n\n\n    }\n\nfunc main() {\n    data := `\n    &lt;foo&gt;\n        &lt;bar&gt;\n            &lt;sources&gt;\n                &lt;source&gt;\n                  &lt;id&gt;1&lt;/id&gt;\n                    &lt;name&gt;MySource&lt;/name&gt;\n\n                    &lt;flows&gt;\n                      &lt;flow&gt;\n                        &lt;id&gt;1&lt;/id&gt;\n                        &lt;name&gt;MySource 1L&lt;/name&gt;\n                      &lt;/flow&gt;\n                      &lt;flow&gt;\n                        &lt;id&gt;2&lt;/id&gt;\n                        &lt;name&gt;MySource 1R&lt;/name&gt;\n                      &lt;/flow&gt;\n                    &lt;/flows&gt;   \n                &lt;/source&gt;\n                &lt;source&gt;\n                  &lt;id&gt;2&lt;/id&gt;\n                    &lt;name&gt;MySource2&lt;/name&gt;\n\n                    &lt;flows&gt;\n                      &lt;flow&gt;\n                        &lt;id&gt;1&lt;/id&gt;\n                        &lt;name&gt;MySource2 2L&lt;/name&gt;\n                      &lt;/flow&gt;\n                      &lt;flow&gt;\n                        &lt;id&gt;2&lt;/id&gt;\n                        &lt;name&gt;MySource2 2R&lt;/name&gt;\n                      &lt;/flow&gt;\n                    &lt;/flows&gt;   \n                &lt;/source&gt;\n            &lt;/sources&gt;\n        &lt;/bar&gt;\n    &lt;/foo&gt;`\n\n    v := Result{}\n\n    err := xml.Unmarshal([]byte(data), &amp;v)\n    if err != nil {\n        fmt.Printf(\"error: %v\", err)\n        return\n    }\n    fmt.Printf(\"%#v\", v)\n    fmt.Printf(\"%#v\", v.Src[0].Name) //Prints: \"MySource\"\n    fmt.Printf(\"%#v\", v.Src[1].Name) //Prints: \"MySource2\"\n}\n</code></pre>\n\n<p>Many thanks for all help!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 311, "user_id": 5857663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbff9aa99ff79b9ff90c84b16bcc6a63?s=128&d=identicon&r=PG&f=1", "display_name": "roshan_nazareth", "link": "https://stackoverflow.com/users/5857663/roshan-nazareth"}, "edited": false, "score": 0, "creation_date": 1505130577, "post_id": 46155032, "comment_id": 79271550, "body": "post code here rather posting links to the code.  help us to help you"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505130688, "post_id": 46155032, "comment_id": 79271636, "body": "The method you are looking for is called <code>Elem()</code>."}, {"owner": {"reputation": 1, "user_id": 8591832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9695fa7cd309b22bee2d7ef30db63baa?s=128&d=identicon&r=PG&f=1", "display_name": "j.doe", "link": "https://stackoverflow.com/users/8591832/j-doe"}, "reply_to_user": {"reputation": 311, "user_id": 5857663, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbff9aa99ff79b9ff90c84b16bcc6a63?s=128&d=identicon&r=PG&f=1", "display_name": "roshan_nazareth", "link": "https://stackoverflow.com/users/5857663/roshan-nazareth"}, "edited": false, "score": 0, "creation_date": 1505131021, "post_id": 46155032, "comment_id": 79271868, "body": "@roshan_nazareth I can&#39;t place the full code here, could you please see it on play.golang.org, you can run it there."}, {"owner": {"reputation": 1, "user_id": 8591832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9695fa7cd309b22bee2d7ef30db63baa?s=128&d=identicon&r=PG&f=1", "display_name": "j.doe", "link": "https://stackoverflow.com/users/8591832/j-doe"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505131076, "post_id": 46155032, "comment_id": 79271909, "body": "@Volker Could you please help me to send the snippet. Though I have tried"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505132268, "post_id": 46155032, "comment_id": 79272715, "body": "Reflection is always tricky. You must develop a thorough understanding of how you traverse the different types. Elem lets you move from pointer to pointee."}], "answers": [{"tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 0, "last_activity_date": 1505133471, "creation_date": 1505133471, "answer_id": 46155995, "question_id": 46155032, "link": "https://stackoverflow.com/questions/46155032/how-to-traverse-embedded-struct-using-relfect-from-pointer-to-a-struct/46155995#46155995", "title": "How to traverse embedded struct using relfect from pointer to a struct", "body": "<p>To be able to send both pointer and value elements, you can add this to your <code>DeepFields</code> function:</p>\n\n<pre><code>if ift.Kind() == reflect.Ptr {\n    ifv = ifv.Elem()\n    ift = ift.Elem()\n}\n</code></pre>\n\n<p>Modified playground: <a href=\"https://play.golang.org/p/MgB-W81dYr\" rel=\"nofollow noreferrer\">https://play.golang.org/p/MgB-W81dYr</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8591832, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9695fa7cd309b22bee2d7ef30db63baa?s=128&d=identicon&r=PG&f=1", "display_name": "j.doe", "link": "https://stackoverflow.com/users/8591832/j-doe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 299, "favorite_count": 1, "answer_count": 1, "score": -3, "last_activity_date": 1505133471, "creation_date": 1505130470, "last_edit_date": 1505131238, "question_id": 46155032, "link": "https://stackoverflow.com/questions/46155032/how-to-traverse-embedded-struct-using-relfect-from-pointer-to-a-struct", "title": "How to traverse embedded struct using relfect from pointer to a struct", "body": "<p>I have this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\ntype B struct {\n    X string\n    Y string\n}\n\ntype D struct {\n    B\n    Z string\n}\n\nfunc DeepFields(iface interface{}) []reflect.Value {\n    fields := make([]reflect.Value, 0)\n    ifv := reflect.ValueOf(iface)\n    ift := reflect.TypeOf(iface)\n\n    for i := 0; i &lt; ift.NumField(); i++ {\n        v := ifv.Field(i)\n\n        switch v.Kind() {\n        case reflect.Struct:\n            fields = append(fields, DeepFields(v.Interface())...)\n        default:\n            fields = append(fields, v)\n        }\n    }\n\n    return fields\n}\n\nfunc main() {\n    b := B{\"this is X\", \"this is Y\"}\n    d := D{b, \"this is Z\"}\n    // fmt.Printf(\"%#v\\n\", d)\n    fmt.Println(DeepFields(d)) //works fine\n\n    // fmt.Println(DeepFields(&amp;d)) //but I need to pass pointer\n}\n</code></pre>\n\n<p>Go Playground: <a href=\"https://play.golang.org/p/1NS29r46Al\" rel=\"nofollow noreferrer\">https://play.golang.org/p/1NS29r46Al</a></p>\n\n<p>I need to do it using a pointer, see the line #44.</p>\n"}, {"tags": ["json", "go", "swagger", "swagger-2.0", "openapi"], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "is_accepted": false, "score": 0, "last_activity_date": 1505531407, "creation_date": 1505531407, "answer_id": 46249667, "question_id": 46153659, "link": "https://stackoverflow.com/questions/46153659/api-spec-converter-using-golang/46249667#46249667", "title": "API spec converter using golang", "body": "<p>I finally found a way for it by using API transformer (<a href=\"https://apimatic.io\" rel=\"nofollow noreferrer\">https://apimatic.io</a>) It is providing APU for conversion between all different API specs. Hope this helps.</p>\n"}], "owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 394, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1564976807, "creation_date": 1505126274, "last_edit_date": 1564976807, "question_id": 46153659, "link": "https://stackoverflow.com/questions/46153659/api-spec-converter-using-golang", "title": "API spec converter using golang", "body": "<p>My task is to convert xml to OpenAPI spec (Swagger 2.0). I found a node package (<a href=\"https://github.com/LucyBot-Inc/api-spec-converter\" rel=\"nofollow noreferrer\">https://github.com/LucyBot-Inc/api-spec-converter</a>) that does it but I want a similar package in golang. Thanks in advance!</p>\n"}, {"tags": ["macos", "ssl", "go", "rabbitmq"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505133377, "post_id": 46152088, "comment_id": 79273487, "body": "What version of Go are you using?"}, {"owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505177082, "post_id": 46152088, "comment_id": 79294782, "body": "go version go1.9 darwin/amd64"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505231846, "post_id": 46152088, "comment_id": 79324381, "body": "If the cert you&#39;re adding is correct, you&#39;re probably hitting <a href=\"https://golang.org/issue/16532\" rel=\"nofollow noreferrer\">golang.org/issue/16532</a>. I think that is 1/2 complete, and disabling cgo should load the <code>System.keychain</code> too.  Since you&#39;re setting up your own <code>tls.Config</code>, you could also just add the ca cert to the <code>RootCAs</code> there too."}], "owner": {"reputation": 9173, "user_id": 172265, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7d658f2c111ae5d8b48f0f0aa7624372?s=128&d=identicon&r=PG", "display_name": "lang2", "link": "https://stackoverflow.com/users/172265/lang2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 894, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505121325, "creation_date": 1505121325, "question_id": 46152088, "link": "https://stackoverflow.com/questions/46152088/certificate-signed-by-unknown-authority-with-self-signed-certificates", "title": "certificate signed by unknown authority with self-signed certificates", "body": "<p>I'm trying to setup a development environment where TLS is enabled for RabbitMQ. So here is what I did:</p>\n\n<ol>\n<li>Use <code>tls-gen</code> script to generate certificates with basic profile.</li>\n<li>Configure rabbitmq to use <code>ca-certificate.pem</code>, <code>server-certificate.pem</code>, and <code>server-key.pem</code>.</li>\n<li>As I'm using MacOS, I ran <code>sudo security add-trusted-cert -d -r trustRoot -k /Library/Keychains/System.keychain  testca/ca_certificate.pem</code> to add the CA certificate to the trusted roots</li>\n<li>Within a Go program, I load the <code>client_certificate.pem</code>, and <code>client-key.pem</code> into a <code>tls.Config</code></li>\n<li>Call <code>amqp.DialTLS()</code>.</li>\n</ol>\n\n<p>I got the following error message:</p>\n\n<pre><code> err: x509: certificate signed by unknown authority\n</code></pre>\n\n<p>which is unexpected. In step 4 above, if I add the <code>ca-certificate.pem</code> into the root CAs of the <code>tls.Config</code>, it works fine. So I'm suspecting that the addition of the root ca macOS is not right.</p>\n\n<p>Can somebody review the above and point out my mistake?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505117398, "post_id": 46150842, "comment_id": 79263440, "body": "Not like that. <a href=\"https://en.wikipedia.org/wiki/SQL_injection\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/SQL_injection</a> . Use bind parameters (&quot;prepared statements&quot;) please."}, {"owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "reply_to_user": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505118393, "post_id": 46150842, "comment_id": 79263970, "body": "Thank you @CraigRinger. Updated my question according to your inputs. Please comment now."}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505179586, "post_id": 46150842, "comment_id": 79295239, "body": "You&#39;ve completely misunderstood the issue. You need to use placeholders and bind parameters. Read one of the zillions of tutorials on sql injection prevention, bind parameters, prepared statements, etc."}, {"owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "reply_to_user": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505206785, "post_id": 46150842, "comment_id": 79306228, "body": "@CraigRinger   I am using placeholders (<code>$1,$2</code> etc.) to substitute the parameters in the query. Isn&#39;t this approach SQL Injection safe? I am using <code>fmt.Sprintf</code> to number the placeholder, because I don&#39;t know the number arguments ( this has nothing to do with SQL injection, isn&#39;t it? ). I don&#39;t understand what you are trying to convey."}, {"owner": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505219295, "post_id": 46150842, "comment_id": 79314946, "body": "Ah, yes, that&#39;s fine and I misread the code. I was caught out by your use of sprintf."}, {"owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "reply_to_user": {"reputation": 257364, "user_id": 398670, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/85f50c23bb5e9dfb061af5032bfe8e65?s=128&d=identicon&r=PG", "display_name": "Craig Ringer", "link": "https://stackoverflow.com/users/398670/craig-ringer"}, "edited": false, "score": 0, "creation_date": 1505284292, "post_id": 46150842, "comment_id": 79342767, "body": "@CraigRinger I&#39;ve updated my question."}], "owner": {"reputation": 215, "user_id": 5962248, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/NbGq8.jpg?s=128&g=1", "display_name": "Hardy", "link": "https://stackoverflow.com/users/5962248/hardy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1230, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1505221050, "creation_date": 1505116830, "last_edit_date": 1505221050, "question_id": 46150842, "link": "https://stackoverflow.com/questions/46150842/postgresql-dynamic-query-building-in-golang", "title": "Postgresql dynamic query building in golang", "body": "<p>How can I build a dynamic UPDATE query depending on the arguments that I have/get?</p>\n\n<p>Need to update the column only if the argument value is not empty.</p>\n\n<p>This is my code:</p>\n\n<pre><code>func main() {\n\n    err := DBConnect() //DB connection function\n    if err != nil {\n        fmt.Println(\"Error\", \"DB Connect fail\")\n        return\n    }\n\n    tx, err := Db.Begin()\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Unable to start DB\")\n        return\n    }\n\n    defer func() {\n        if err != nil {\n            tx.Rollback()\n        } else {\n            tx.Commit()\n        }\n    }()\n\n    var arg []interface{}\n\n    i := 1\n    col1 := \"value1\"\n    col2 := \"value2\"\n    col3 := \"\" \n    col4 := \"\"\n    col5 := \"value5\"\n\n    query := \"UPDATE schema1.products SET \"\n\n    if col1 != \"\" {\n        query = query + \"col1=$\" + fmt.Sprintf(\"%d\", i) + \", \"\n        arg = append(arg, col1)\n        i++\n    }\n    if col2 != \"\" {\n        query = query + \"col2=$\" + fmt.Sprintf(\"%d\", i) + \", \"\n        arg = append(arg, col2)\n        i++\n    }\n    if col3 != \"\" {\n        query = query + \"col3=$\" + fmt.Sprintf(\"%d\", i) + \", \"\n        arg = append(arg, col3)\n        i++\n    }\n    if col4 != \"\" {\n    query = query + \"col4=$\" + fmt.Sprintf(\"%d\", i) + \", \"\n    arg = append(arg, col4)\n    i++\n    }\n\n    query = query + \"WHERE col5=$\" + fmt.Sprintf(\"%d\", i)\n    arg = append(arg, col5)\n\n    stmt, err := tx.Prepare(query)\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Query prepare failed\")\n        return\n    }\n\n    res, err := stmt.Exec(arg...)\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Query Exec failed\")\n        return\n    }\n    n, err := res.RowsAffected()\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Unable to get rows affected\")\n        return\n    }\n    if n &gt; 1 {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"More than one row updated\")\n        return\n    }\n    return\n}\n</code></pre>\n\n<p>So the basic requirement is to update the columns only if the appropriate Input values are not null.</p>\n\n<p><strong>UPDATE:</strong></p>\n\n<pre><code>func GetRow(arg1, arg2 string) (data [][]string, err error) {\n    row, err := Db.Query(\"SELECT * FROM schema1.products WHERE ($1='' OR col1=$1) AND ($2='' OR col2=$2)\", arg1, arg2)\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Unable to Query DB\")\n        return\n    }\n    defer sql.Close(row)\n    _, data, err = sql.Scan(row)\n    if err != nil {\n        fmt.Println(\"Error\", err)\n        fmt.Println(\"Error\", \"Unable to scan rows\")\n        return\n    }\n    if len(data) &lt; 0 {\n        fmt.Println(\"Error\", \"No Data found\")\n        return\n    }\n    return\n}\n</code></pre>\n\n<p>The query in the GetRow function will include the conditions in WHERE clause only if arguments are not empty. So I need not worry whether the arg1 and arg2 are empty or not. I am Looking for a way to do the same in case of UPDATE query as well.</p>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505107758, "post_id": 46148682, "comment_id": 79258924, "body": "You must end your main for loop. As the error tells you: Nothing arrives on res."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1505107914, "post_id": 46148682, "comment_id": 79258975, "body": "@Volker but even i do <code>break</code> the main for loop, then do <code>quit &lt;- true</code>, still deadlock, can you help to create a works playground example?"}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1505112234, "post_id": 46148682, "comment_id": 79260705, "body": "In your program, <code>res &lt;- idx</code> and <code>quit &lt;- true</code> are both waiting for their values to be received which causes the deadlock. A better pattern to use channels can be found <a href=\"https://play.golang.org/p/uf94rfXkva\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1505112679, "post_id": 46148682, "comment_id": 79260934, "body": "@John S Perayil That&#39;s a good and simple example, but doesn&#39;t have consumer signalling to the producer to exit."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1505113234, "post_id": 46148682, "comment_id": 79261205, "body": "@Ravi I was just linking to a simple example on how to quit using a channel properly. I should have been more clear in the comment. <a href=\"http://www.golangbootcamp.com/book/concurrency\" rel=\"nofollow noreferrer\">Reference</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505120268, "post_id": 46149629, "comment_id": 79265119, "body": "haha, thank u, nice, like this then i need to explicitly quit the goroutine unconditionally"}], "tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": false, "score": 0, "last_activity_date": 1505112163, "creation_date": 1505112163, "answer_id": 46149629, "question_id": 46148682, "link": "https://stackoverflow.com/questions/46148682/how-can-i-stop-the-goroutine-based-on-the-returned-value-from-that-goroutine/46149629#46149629", "title": "How can I stop the goroutine based on the returned value from that goroutine", "body": "<p>The fundamental issue is that producer must <em>always</em> check in between sending values if the consumer (main in your case) has decided to quit reading (in your code this is optional). What's happening is even before the value of quit is sent (and received), the producer goes ahead and sends the next value on <code>res</code> which the consumer never is able to read - the consumer is in fact trying to send the value on the quit channel expecting the producer to read. Added a debug statement which can help you understand : <a href=\"https://play.golang.org/p/mP_4VYrkZZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/mP_4VYrkZZ</a>,  - producer is trying to send 7 on res and blocking, <em>and then</em> consumer trying to send value on quit and blocking. Deadlock!</p>\n\n<p>One possible solution is as follows (using a Waitgroup is optional, needed only if you need a clean exit from producer side before return):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\nfunc main() {\n    //WaitGroup is needed only if need a clean exit for producer\n    //that is the producer should have exited before consumer (main)\n    //exits - the code works even without the WaitGroup\n    var wg sync.WaitGroup\n    quit := make(chan bool)\n    res := make(chan int)\n\n    go func() {\n        idx := 0\n        for {\n\n            fmt.Println(\"goroutine is doing stuff..\", idx)\n            res &lt;- idx\n            idx++\n            if &lt;-quit {\n                fmt.Println(\"Producer quitting..\")\n                wg.Done()\n                return\n            }\n\n            //select {\n            //case &lt;-quit:\n            //fmt.Println(\"Detected quit signal!\")\n            //time.Sleep(1000 * time.Millisecond)\n            //  return\n            //default:\n            //fmt.Println(\"goroutine is doing stuff..\", idx)\n            //res &lt;- idx\n            //idx++\n            //}\n        }\n\n\n    }()\n    wg.Add(1)\n    for r := range res {\n        if r == 6 {\n            fmt.Println(\"Consumer exit condition met: \", r)\n            quit &lt;- true\n            break\n        }\n        quit &lt;- false\n        fmt.Println(\"I received: \", r)\n    }\n    wg.Wait()\n\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>goroutine is doing stuff.. 0\nI received:  0\ngoroutine is doing stuff.. 1\nI received:  1\ngoroutine is doing stuff.. 2\nI received:  2\ngoroutine is doing stuff.. 3\nI received:  3\ngoroutine is doing stuff.. 4\nI received:  4\ngoroutine is doing stuff.. 5\nI received:  5\ngoroutine is doing stuff.. 6\nConsumer exit condition met:  6\nProducer quitting..\n</code></pre>\n\n<p>On playground : <a href=\"https://play.golang.org/p/N8WSPvnqqM\" rel=\"nofollow noreferrer\">https://play.golang.org/p/N8WSPvnqqM</a></p>\n"}, {"comments": [{"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 1, "creation_date": 1505113393, "post_id": 46149732, "comment_id": 79261270, "body": "Lesser traffic on channel, better solution :)"}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505114864, "post_id": 46149732, "comment_id": 79262065, "body": "@icza, thank u very much for the very detailed explanation, put <code>res &lt;-  idx</code> on one case branch works fine for this case, but if i have some logic: in some iteration will send back one value, but in some iteration no value need to be sent back, then how to handle that properly?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505115012, "post_id": 46149732, "comment_id": 79262149, "body": "@lnshi What is &quot;iteration&quot;? The iteration should be when something needs to be sent back, which will result in no iterations where you don&#39;t need to send back anything. You should structure your loop that way. Please show something more concrete, maybe as a new question."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505115651, "post_id": 46149732, "comment_id": 79262526, "body": "@icza like <a href=\"https://play.golang.org/p/Paq01v3ScM\" rel=\"nofollow noreferrer\">Paq01v3ScM</a>, i only want to return the number in the <code>arbitraryNums</code> slice, or else do nothing, and quit upon first negative value is encountered."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505116124, "post_id": 46149732, "comment_id": 79262785, "body": "@lnshi Then here&#39;s your solution: <a href=\"https://play.golang.org/p/p89Ay46lIh\" rel=\"nofollow noreferrer\">Go Playground</a>. Basically the &quot;iteration&quot; here is the subsequent numbers in that slice, and not an increasing index. Just make sure the numbers you send trigger the <code>quit</code> branch in the main goroutine, else you need to send a negative number after the loop manually."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505117557, "post_id": 46149732, "comment_id": 79263520, "body": "@icza no, not generic enough,  i describe my more complex logic here: <a href=\"https://play.golang.org/p/e-TqgatUJb\" rel=\"nofollow noreferrer\">e-TqgatUJb</a>, basically u have no way to know when and what need to be passed back, only can go through the logic, to decide this iteration only need to traverse forward the data, that iteration need to pass back some value or error, and the main goroutine received the wanted data will indicate this goroutine to stop."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "edited": false, "score": 0, "creation_date": 1505117755, "post_id": 46149732, "comment_id": 79263618, "body": "@lnshi Then the logic that produces the next value to be sent should be separated. When the next value is ready, that may be used in a <code>case</code> statement. If producing the next value may take long time or may even block, that logic must also monitor the <code>quit</code> channel."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1505112707, "creation_date": 1505112707, "answer_id": 46149732, "question_id": 46148682, "link": "https://stackoverflow.com/questions/46148682/how-can-i-stop-the-goroutine-based-on-the-returned-value-from-that-goroutine/46149732#46149732", "title": "How can I stop the goroutine based on the returned value from that goroutine", "body": "<p>The problem is that in the goroutine you use a <code>select</code> to check if it should abort, but you use the <code>default</code> branch to do the work otherwise.</p>\n\n<p>The <code>default</code> branch is executed if no communications (listed in <code>case</code> branches) can proceed. So in each iteration <code>quit</code> channel is checked, but if it cannot be received from (no need to quit yet), <code>default</code> branch is executed, which <em>unconditionally</em> tries to send a value on <code>res</code>. Now if the main goroutine is not ready to receive from it, this will be a deadlock. And this is exactly what happens when the sent value is <code>6</code>, because then the main goroutine tries to send a value on <code>quit</code>, but if the worker goroutine is in the <code>default</code> branch trying to send on <code>res</code>, then <strong>both goroutines try to send a value, and none is trying to receive</strong>! Both channels are unbuffered, so this is a deadlock.</p>\n\n<p>In the worker goroutine you must send the value on <code>res</code> using a proper <code>case</code> branch, and not in the <code>default</code> branch:</p>\n\n<pre><code>select {\ncase &lt;-quit:\n    fmt.Println(\"Detected quit signal!\")\n    return\ncase res &lt;- idx:\n    fmt.Println(\"goroutine is doing stuff..\")\n    idx++\n}\n</code></pre>\n\n<p>And in the main goroutine you must break out from the <code>for</code> loop so the main goroutine can end and so the program can end as well:</p>\n\n<pre><code>if r == 6 {\n    quit &lt;- true\n    break\n}\n</code></pre>\n\n<p>Output this time (try it on the <a href=\"https://play.golang.org/p/C_lpJn_LLl\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>goroutine is doing stuff..\nI received:  0\nI received:  1\ngoroutine is doing stuff..\ngoroutine is doing stuff..\nI received:  2\nI received:  3\ngoroutine is doing stuff..\ngoroutine is doing stuff..\nI received:  4\nI received:  5\ngoroutine is doing stuff..\ngoroutine is doing stuff..\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1505199602, "post_id": 46168343, "comment_id": 79301727, "body": "If you have a data race, no, it&#39;s not fine. Read <a href=\"https://stackoverflow.com/questions/41406501/is-it-safe-to-read-a-function-pointer-concurrently-without-a-lock/41407827#41407827\">Is it safe to read a function pointer concurrently without a lock?</a> Moreover you&#39;re misusing panic-recover which was created for exceptional cases, so I don&#39;t recommend ever doing this."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1505224241, "post_id": 46168343, "comment_id": 79318809, "body": "@icza I made this playground <a href=\"https://play.golang.org/p/TYo_zMaEAU\" rel=\"nofollow noreferrer\">TYo_zMaEAU</a> to explain what exactly i was doing with this approach, want to hear your insight if in this case u think there still is potential risk, thank u very much"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1505229714, "post_id": 46168343, "comment_id": 79322938, "body": "Have you read the answer I linked? There is no point in talking about the correctness or usefulness of an app that contains data race. Period. It might be it runs correctly for you a hundred thousand times, then crash in the next run. It&#39;s unpredictable."}], "tags": [], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "is_accepted": false, "score": 0, "last_activity_date": 1505193003, "creation_date": 1505193003, "answer_id": 46168343, "question_id": 46148682, "link": "https://stackoverflow.com/questions/46148682/how-can-i-stop-the-goroutine-based-on-the-returned-value-from-that-goroutine/46168343#46168343", "title": "How can I stop the goroutine based on the returned value from that goroutine", "body": "<p>As @icza's answer is pretty clean, which @Ravi's goes to the synchronised way.</p>\n\n<p>But coz I don't want to spend that much effort to restructure the code, and also I don't want to go to the synchronised way, so eventually went to the <code>defer panic recover</code> flow control, as below:</p>\n\n<pre><code>func test(ch chan&lt;- int, data []byte) {\n    defer func() {\n        recover()\n    }()\n    defer close(ch)\n\n    // do your logic as normal ...\n    // send back your res as normal `ch &lt;- res`\n}\n\n// Then in the caller goroutine\n\nch := make(chan int)\ndata := []byte{1, 2, 3}\ngo test(ch, data)\n\nfor res := range ch {\n    // When you want to terminate the test goroutine:\n    //     deliberately close the channel\n    //\n    // `go -race` will report potential race condition, but it is fine\n    //\n    // then test goroutine will be panic due to try sending on the closed channel,\n    //     then recover, then quit, perfect :) \n    close(ch)\n    break\n}\n</code></pre>\n\n<p>any potential risk with this approach?</p>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2390, "favorite_count": 0, "accepted_answer_id": 46149732, "answer_count": 3, "score": 4, "last_activity_date": 1505193003, "creation_date": 1505107457, "last_edit_date": 1505113240, "question_id": 46148682, "link": "https://stackoverflow.com/questions/46148682/how-can-i-stop-the-goroutine-based-on-the-returned-value-from-that-goroutine", "title": "How can I stop the goroutine based on the returned value from that goroutine", "body": "<p>Like here I created a go playground sample: <a href=\"https://play.golang.org/p/sGgxEh40ev\" rel=\"nofollow noreferrer\">sGgxEh40ev</a>, but cannot get it work.</p>\n\n<pre><code>quit := make(chan bool)\nres := make(chan int)\n\ngo func() {\n    idx := 0\n    for {\n        select {\n        case &lt;-quit:\n            fmt.Println(\"Detected quit signal!\")\n            return\n        default:\n            fmt.Println(\"goroutine is doing stuff..\")\n            res &lt;- idx\n            idx++\n        }\n    }\n\n}()\n\nfor r := range res {\n    if r == 6 {\n        quit &lt;- true\n    }\n    fmt.Println(\"I received: \", r)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>goroutine is doing stuff..\ngoroutine is doing stuff..\nI received:  0\nI received:  1\ngoroutine is doing stuff..\ngoroutine is doing stuff..\nI received:  2\nI received:  3\ngoroutine is doing stuff..\ngoroutine is doing stuff..\nI received:  4\nI received:  5\ngoroutine is doing stuff..\ngoroutine is doing stuff..\nfatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>Is this possible? Where am I wrong</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1505106218, "post_id": 46147995, "comment_id": 79258432, "body": "Not true. Not only must the function name match, but the functions signature."}, {"owner": {"reputation": 9248, "user_id": 373653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd13ef154c3b67882d34c9b84e737f9?s=128&d=identicon&r=PG", "display_name": "sjr", "link": "https://stackoverflow.com/users/373653/sjr"}, "reply_to_user": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 1, "creation_date": 1505142069, "post_id": 46147995, "comment_id": 79279462, "body": "Might be a bit strong to say &quot;not true&quot;, it&#39;s necessary but not sufficient. Clarified."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1505160094, "post_id": 46147995, "comment_id": 79289304, "body": "<code>func (t *T)String()</code> != <code>func(t *T)String() string</code>. For you and me, that might be obvious - for others it might not be. Hence my rather strong objection ;)"}], "tags": [], "owner": {"reputation": 9248, "user_id": 373653, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bfd13ef154c3b67882d34c9b84e737f9?s=128&d=identicon&r=PG", "display_name": "sjr", "link": "https://stackoverflow.com/users/373653/sjr"}, "is_accepted": true, "score": 2, "last_activity_date": 1505142041, "last_edit_date": 1505142041, "creation_date": 1505102447, "answer_id": 46147995, "question_id": 46147978, "link": "https://stackoverflow.com/questions/46147978/why-does-the-following-go-program-need-the-functions-name-to-be-string-and-no/46147995#46147995", "title": "Why does the following Go program need the function&#39;s name to be String() and not anything else?", "body": "<p>When you define a method named <code>String</code> with no parameters returning a string, you implement the <code>Stringer</code> interface, which is documented here: <a href=\"https://golang.org/pkg/fmt/#Stringer\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt/#Stringer</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "is_accepted": false, "score": 4, "last_activity_date": 1505102811, "creation_date": 1505102811, "answer_id": 46148050, "question_id": 46147978, "link": "https://stackoverflow.com/questions/46147978/why-does-the-following-go-program-need-the-functions-name-to-be-string-and-no/46148050#46148050", "title": "Why does the following Go program need the function&#39;s name to be String() and not anything else?", "body": "<p>Your last sentence is exactly right. In Go, you can satisfy interfaces you didn't even know existed. And you can write new interfaces for other people's functions. Their code does not have to write \"implement\" or derive or anything. It is entirely based on the function name and having a matching argument and return value list.</p>\n"}, {"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 1, "last_activity_date": 1505116258, "creation_date": 1505116258, "answer_id": 46150691, "question_id": 46147978, "link": "https://stackoverflow.com/questions/46147978/why-does-the-following-go-program-need-the-functions-name-to-be-string-and-no/46150691#46150691", "title": "Why does the following Go program need the function&#39;s name to be String() and not anything else?", "body": "<p>The example is very similar to an example in \"Effective Go\" by the Go Authors, and the meaning of the <code>String()</code> method described there.</p>\n\n<blockquote>\n  <p>The ability to attach a method such as String to any user-defined type\n  makes it possible for arbitrary values to format themselves\n  automatically for printing. Although you'll see it most often applied\n  to structs, this technique is also useful for scalar types such as\n  floating-point types like ByteSize.</p>\n</blockquote>\n\n<p>See: <a href=\"https://golang.org/doc/effective_go.html#constants\" rel=\"nofollow noreferrer\">https://golang.org/doc/effective_go.html#constants</a></p>\n"}], "owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 46147995, "answer_count": 3, "score": 0, "last_activity_date": 1505142041, "creation_date": 1505102302, "last_edit_date": 1505136617, "question_id": 46147978, "link": "https://stackoverflow.com/questions/46147978/why-does-the-following-go-program-need-the-functions-name-to-be-string-and-no", "title": "Why does the following Go program need the function&#39;s name to be String() and not anything else?", "body": "<p>I'm following a book which shows the following example. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nconst (\n    KB = 1024\n    MB = 1048576          //KB * 1024\n    GB = 1073741824       //MB * 1024\n    TB = 1099511627776    //GB * 1024\n    PB = 1125899906842624 //TB * 1024\n)\n\ntype ByteSize float64\n\nfunc (b ByteSize) String() string {\n    switch {\n    case b &gt;= PB:\n        return \"Very Big\"\n    case b &gt;= TB:\n        return fmt.Sprintf(\"%.2fTB\", b/TB)\n    case b &gt;= GB:\n        return fmt.Sprintf(\"%.2fGB\", b/GB)\n    case b &gt;= MB:\n        return fmt.Sprintf(\"%.2fMB\", b/MB)\n    case b &gt;= KB:\n        return fmt.Sprintf(\"%.2fKB\", b/KB)\n    }\n    return fmt.Sprintf(\"%dB\", b)\n}\n\nfunc main() {\n    fmt.Println(ByteSize(2048))\n    fmt.Println(ByteSize(3292528.64))\n}\n</code></pre>\n\n<p>When I run this program it gives me the following output (in human readable data size units).</p>\n\n<pre><code>2.00KB\n3.14MB\n</code></pre>\n\n<p>But when I change the name of the function called String() to anything else, or if I lower-case the S in String, it gives me the following output.</p>\n\n<pre><code>2048\n3.29252864e+06\n</code></pre>\n\n<p>What is the reason behind that? Is there some String() function attached to some interface and our ByteSize type satisfies that interface? I mean what the hell? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "edited": false, "score": 0, "creation_date": 1505110414, "post_id": 46148032, "comment_id": 79259924, "body": "Thanks for the explanation! I found the WaitGroup in my own research, its similar to some concurrency concepts I am familiar with from Python. However, I thought I should try and understand how to solve the exercise using only things mentioned in the previous lessons.  Followup to your explanation, are you saying that each Crawler has it&#39;s own channel associated with it? That would make a lot more sense, and would explain why theres another loop that corresponds to each Crawler. I as under the impression all variables were in a shared space and thinking there was just one channel total."}, {"owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "reply_to_user": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "edited": false, "score": 0, "creation_date": 1505126080, "post_id": 46148032, "comment_id": 79268767, "body": "@leif Each crawler doesn&#39;t have it&#39;s own channel - there is only one channel. After each <code>Crawl</code> function is executed the <code>url</code> is sent via the same channel. You may want to read up a bit more and do a few exercises on channels. The Go Programming Language, by Donovan and Kernighan is a good book to read."}, {"owner": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "reply_to_user": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "edited": false, "score": 0, "creation_date": 1505136178, "post_id": 46148032, "comment_id": 79275387, "body": "Thanks @Ravi, I was replying to the unedited version of Blaskovicz&#39;s post which is now more clear that there is only one channel as I originally thought. I will check out the book you recommended, thanks!"}], "tags": [], "owner": {"reputation": 5692, "user_id": 626810, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/dde9640589b85543aa33fddb58bb169c?s=128&d=identicon&r=PG", "display_name": "Blaskovicz", "link": "https://stackoverflow.com/users/626810/blaskovicz"}, "is_accepted": true, "score": 3, "last_activity_date": 1505103155, "last_edit_date": 1505103155, "creation_date": 1505102710, "answer_id": 46148032, "question_id": 46147914, "link": "https://stackoverflow.com/questions/46147914/explanation-of-channels-from-tour-of-go-webcrawler-exercise/46148032#46148032", "title": "Explanation of Channels from &#39;Tour of Go&#39; Webcrawler Exercise", "body": "<p>The first <code>for</code> loop schedules multiple goroutines to run and is iterating over a slice of urls.</p>\n\n<p>The second loop blocks on each url, waiting until its corresponding <code>Crawl()</code> invocation has completed. All the <code>Crawl()</code>ers will run and do their work in parallel and block exiting until the main thread has a chance to receive a message on the <code>done</code> channel for each url.</p>\n\n<p>In my opinion, a better way to implement this is to use a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a>. This code could log the wrong thing depending on how long each <code>Crawl()</code> invocation takes unless <code>fetcher</code> locks.</p>\n\n<p>If you want to be sure of the url that finished <code>Crawl()</code>ing, you could change the type of the done channel to <code>string</code> and send the <code>url</code> instead of <code>true</code> upon a <code>Crawl()</code> completion. Then, we could receive the <code>url</code> in the second loop.</p>\n\n<p>Example:</p>\n\n<pre><code>done := make(chan string)\nfor _, u := range urls {\n    fmt.Printf(\"-&gt; Crawling %s\\n\", u)\n    go func(url string) {\n        Crawl(url, depth-1, fetcher)\n        done &lt;- url\n    }(u)\n}\nfor range urls {\n    fmt.Printf(\"&lt;- Waiting for next child\\n\")\n    u := &lt;-done\n    fmt.Printf(\"  Done... %s\\n\", u)\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 471, "favorite_count": 0, "accepted_answer_id": 46148032, "answer_count": 1, "score": 1, "last_activity_date": 1505103155, "creation_date": 1505101756, "question_id": 46147914, "link": "https://stackoverflow.com/questions/46147914/explanation-of-channels-from-tour-of-go-webcrawler-exercise", "title": "Explanation of Channels from &#39;Tour of Go&#39; Webcrawler Exercise", "body": "<p>I'm going through 'A Tour of Go' and have been editing most of the lessons to make sure I fully understand them. I have a question regarding an answer provided to the following exercise: <a href=\"https://tour.golang.org/concurrency/10\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/10</a> which can be found here: <a href=\"https://github.com/golang/tour/blob/master/solutions/webcrawler.go\" rel=\"nofollow noreferrer\">https://github.com/golang/tour/blob/master/solutions/webcrawler.go</a></p>\n\n<p>I have a question regarding the following section:</p>\n\n<pre><code>done := make(chan bool)\nfor i, u := range urls {\n    fmt.Printf(\"-&gt; Crawling child %v/%v of %v : %v.\\n\", i, len(urls), url, u)\n    go func(url string) {\n        Crawl(url, depth-1, fetcher)\n        done &lt;- true\n    }(u)\n}\nfor i, u := range urls {\n    fmt.Printf(\"&lt;- [%v] %v/%v Waiting for child %v.\\n\", url, i, len(urls), u)\n    &lt;-done\n}\nfmt.Printf(\"&lt;- Done with %v\\n\", url)\n</code></pre>\n\n<p>What purpose does adding and removing true from the the channel <code>done</code> and running the two separate for loops have? Is it just to block until the go routine finishes? I know this is an example exercise, but doesn't that kind of defeat the point of spinning out a new thread in the first place?</p>\n\n<p>Why can't you just call <code>go Crawl(url, depth-1, fetcher)</code> without the 2nd for loop and the <code>done</code> channel? Is it because of the shared memory space for all the variables?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["datetime", "go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 1338, "user_id": 2969090, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e44eb8fd2813c441b354f051042ea4e3?s=128&d=identicon&r=PG&f=1", "display_name": "Ravi", "link": "https://stackoverflow.com/users/2969090/ravi"}, "is_accepted": true, "score": 5, "last_activity_date": 1505103539, "creation_date": 1505103539, "answer_id": 46148119, "question_id": 46147641, "link": "https://stackoverflow.com/questions/46147641/why-is-time-in-go-printed-differently-in-a-struct/46148119#46148119", "title": "Why is time in Go printed differently in a struct?", "body": "<p>The reason why it's not printing the formatted time when in your struct is that String method is not invoked on the unexported fields (refer <a href=\"https://golang.org/pkg/fmt/\" rel=\"noreferrer\">https://golang.org/pkg/fmt/</a>):</p>\n\n<blockquote>\n  <p>When printing a struct, fmt cannot and therefore does not invoke\n  formatting methods such as Error or String on unexported fields.</p>\n</blockquote>\n\n<p>Changing your structure to export fields (capitalizing the first letter) makes it invoke the String method:</p>\n\n<pre><code>   package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype TheStruct struct {\n    The_time time.Time\n}\n\nfunc main() {\n    the_struct := TheStruct{time.Now()}\n    fmt.Println(the_struct)\n    fmt.Printf(\"%+v\\n\", the_struct)\n    fmt.Println(the_struct.The_time)\n    fmt.Println()\n    the_struct_2 := TheStruct{time.Unix(1505099248, 200)}\n    fmt.Println(the_struct_2)\n    fmt.Printf(\"%+v\\n\", the_struct_2)\n    fmt.Println(the_struct_2.The_time)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{2009-11-10 23:00:00 +0000 UTC m=+0.000000000}\n{The_time:2009-11-10 23:00:00 +0000 UTC m=+0.000000000}\n2009-11-10 23:00:00 +0000 UTC m=+0.000000000\n\n{2017-09-11 03:07:28.0000002 +0000 UTC}\n{The_time:2017-09-11 03:07:28.0000002 +0000 UTC}\n2017-09-11 03:07:28.0000002 +0000 UTC\n</code></pre>\n\n<p>On playground : <a href=\"https://play.golang.org/p/r0rQKBlpWc\" rel=\"noreferrer\">https://play.golang.org/p/r0rQKBlpWc</a></p>\n"}, {"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 2, "last_activity_date": 1505105877, "creation_date": 1505105877, "answer_id": 46148423, "question_id": 46147641, "link": "https://stackoverflow.com/questions/46147641/why-is-time-in-go-printed-differently-in-a-struct/46148423#46148423", "title": "Why is time in Go printed differently in a struct?", "body": "<p>The other answer covers the first part of your question quite well, so I will only cover the second part here.</p>\n\n<p>To put it simply, no, a nil location is not a problem, as acording to the source code for <code>time.Time</code>, a nil location means UTC.</p>\n\n<blockquote>\n<pre><code>// loc specifies the Location that should be used to\n// determine the minute, hour, month, day, and year\n// that correspond to this Time.\n// The nil location means UTC.\n// All UTC times are represented with loc==nil, never loc==&amp;utcLoc.\nloc *Location\n</code></pre>\n</blockquote>\n"}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2296, "favorite_count": 1, "accepted_answer_id": 46148119, "answer_count": 2, "score": 4, "last_activity_date": 1505105877, "creation_date": 1505099131, "last_edit_date": 1505099519, "question_id": 46147641, "link": "https://stackoverflow.com/questions/46147641/why-is-time-in-go-printed-differently-in-a-struct", "title": "Why is time in Go printed differently in a struct?", "body": "<p>I'm just starting out with Go, and in the first program I wrote I printed out a struct, which also showed</p>\n\n<pre><code>{wall:0 ext:63533980800 loc:&lt;nil&gt;}\n</code></pre>\n\n<p>Being puzzled over what that was it seemed to be a type <code>time.Time()</code>, and a google search brought me to <a href=\"https://golang.org/src/time/time.go\" rel=\"nofollow noreferrer\">this part of the Go source code</a> in which the difference between the \"wall clock\" and the \"monotonic clock\" is explained in the comments.</p>\n\n<p>So to test it in isolation I created a new minimalistic program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype TheStruct struct {\n    the_time time.Time\n}\n\nfunc main() {\n    the_struct := TheStruct{time.Now()}\n    fmt.Println(the_struct)\n    fmt.Printf(\"%+v\\n\", the_struct)\n    fmt.Println(the_struct.the_time)\n    fmt.Println()\n    the_struct_2 := TheStruct{time.Unix(1505099248, 200)}\n    fmt.Println(the_struct_2)\n    fmt.Printf(\"%+v\\n\", the_struct_2)\n    fmt.Println(the_struct_2.the_time)\n}\n</code></pre>\n\n<p>which prints out the following:</p>\n\n<pre><code>{{13719544904843884912 534246 0x1140680}}\n{the_time:{wall:13719544904843884912 ext:534246 loc:0x1140680}}\n2017-09-11 05:08:11.35635032 +0200 CEST m=+0.000534246\n\n{{200 63640696048 0x1140680}}\n{the_time:{wall:200 ext:63640696048 loc:0x1140680}}\n2017-09-11 05:07:28 +0200 CEST\n</code></pre>\n\n<p>So I wonder about two things here:</p>\n\n<ol>\n<li>Why is the time if part of a struct printed as wall clock as compared to the more usual datetime notation when printed out separately (using <code>the_struct.the_time</code>)?</li>\n<li>Is it a problem that the code in my other program prints out <code>&lt;nil&gt;</code> for the loc? How would I be able to solve that?</li>\n</ol>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "edited": false, "score": 0, "creation_date": 1505101765, "post_id": 46146800, "comment_id": 79257428, "body": "Thanks for the answer and accompanying literature! What is the preferred way to wait for go routines to finish? Or if you find yourself in that situation does it mean that you should be rearchitecting your code to avoid that?  I also posted another question from the exercises if you&#39;re feeling generous :) <a href=\"https://stackoverflow.com/questions/46147914/explanation-of-channels-from-tour-of-go-webcrawler-exercise\" title=\"explanation of channels from tour of go webcrawler exercise\">stackoverflow.com/questions/46147914/&hellip;</a>"}, {"owner": {"reputation": 12952, "user_id": 2398375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1a5530da29f23682b10bb5568076f83d?s=128&d=identicon&r=PG", "display_name": "Dioxin", "link": "https://stackoverflow.com/users/2398375/dioxin"}, "reply_to_user": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "edited": false, "score": 0, "creation_date": 1505102600, "post_id": 46146800, "comment_id": 79257608, "body": "@leif From my experiences, theres usually no need to redesign to avoid this, though that&#39;s just personal experience. Generally, your application would consist of routines that handle tasks and delegate results back to a thread which runs until the application actually requires termination. If you <i>really</i> need this behavior, you could use <a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow noreferrer\"><code>Gosched</code></a> to yield the main thread, allowing your routines to process. Check out <a href=\"https://stackoverflow.com/questions/13107958/what-exactly-does-runtime-gosched-do\">this post</a>."}], "tags": [], "owner": {"reputation": 12952, "user_id": 2398375, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/1a5530da29f23682b10bb5568076f83d?s=128&d=identicon&r=PG", "display_name": "Dioxin", "link": "https://stackoverflow.com/users/2398375/dioxin"}, "is_accepted": true, "score": 5, "last_activity_date": 1505090104, "creation_date": 1505090104, "answer_id": 46146800, "question_id": 46146761, "link": "https://stackoverflow.com/questions/46146761/concurrency-in-tour-of-go/46146800#46146800", "title": "Concurrency in &#39;Tour of Go&#39;", "body": "<p>The program terminates before you get a chance to see the results.</p>\n\n<p>You can fix this by adding a statement that ensures <code>main</code> doesn't exit before the other routines are finished.</p>\n\n<hr>\n\n<p>From <a href=\"http://www.golang-book.com/books/intro/10\" rel=\"noreferrer\">Golang - Concurrency</a>:</p>\n\n<blockquote>\n  <p>With a goroutine we <strong>return immediately to the next line and don't wait for the function to complete</strong>.</p>\n</blockquote>\n\n<p>They give a code example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc f(n int) {\n  for i := 0; i &lt; 10; i++ {\n    fmt.Println(n, \":\", i)\n  }\n}\n\nfunc main() {\n  go f(0)\n  var input string\n  fmt.Scanln(&amp;input)\n}\n</code></pre>\n\n<p>In regards to the code above:</p>\n\n<blockquote>\n  <p>This is why the call to the Scanln function has been included; <strong>without it the program would exit before being given the opportunity to print all the numbers</strong>.</p>\n</blockquote>\n"}], "owner": {"reputation": 35, "user_id": 8589395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f3bdddc04e1332197b52d827ba3b5cc?s=128&d=identicon&r=PG&f=1", "display_name": "leif", "link": "https://stackoverflow.com/users/8589395/leif"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 145, "favorite_count": 1, "accepted_answer_id": 46146800, "answer_count": 1, "score": 2, "last_activity_date": 1505090104, "creation_date": 1505089605, "question_id": 46146761, "link": "https://stackoverflow.com/questions/46146761/concurrency-in-tour-of-go", "title": "Concurrency in &#39;Tour of Go&#39;", "body": "<p>I'm going through 'A Tour of Go' and have been editing most of the lessons to make sure I fully understand them. I have a question regarding: <a href=\"https://tour.golang.org/concurrency/1\" rel=\"nofollow noreferrer\">https://tour.golang.org/concurrency/1</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc say(s string) {\n    for i := 0; i &lt; 5; i++ {\n        time.Sleep(100 * time.Millisecond)\n        fmt.Println(s)\n    }\n}\n\nfunc main() {\n    go say(\"world\")\n    say(\"hello\")\n}\n</code></pre>\n\n<p>Leaving <code>main</code> the way it is produces a random ordering of hellos and worlds because the threads are executing in different orders each time the program runs. I have two questions:</p>\n\n<ol>\n<li>If I remove <code>go</code> from the line with world and add it to the line with hello, world is printed 5 times and hello is not printed at all. Why is that? </li>\n<li>If I add <code>go</code> in front of both lines, nothing is printed at all. Why is that? </li>\n</ol>\n\n<p>I have some experience with concurrency with C++ (although it was a while ago) and some more recent experience with Python, but would describe my overall experience with concurrency fairly novice-level.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "mutex"], "answers": [{"comments": [{"owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "edited": false, "score": 0, "creation_date": 1505080338, "post_id": 46145798, "comment_id": 79253639, "body": "thanks, made me realize that even in the additional case of <code>range</code>ing over the map to find the <code>needle</code>, I can just wrap it inside a function and use the same kind of well, simple, logic as above"}], "tags": [], "owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "is_accepted": true, "score": 2, "last_activity_date": 1505079385, "creation_date": 1505079385, "answer_id": 46145798, "question_id": 46145728, "link": "https://stackoverflow.com/questions/46145728/minimize-lock-held-on-map-and-instead-lock-on-individual-item-asap/46145798#46145798", "title": "Minimize lock held on map \u2014&#160;and instead lock on individual item asap", "body": "<pre><code>Mymap.Lock()\nif val, ok := Mymap.m.[needle]; ok {\n    Mymap.m.[needle].Lock()\n    Mymap.Unlock()\n    // do something to this entry\n    Mymap.m.[needle].Unlock()\n} else {\n    Mymap.Unlock()\n}\n</code></pre>\n"}], "owner": {"reputation": 1818, "user_id": 2171758, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/0pO0W.jpg?s=128&g=1", "display_name": "salient", "link": "https://stackoverflow.com/users/2171758/salient"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 46145798, "answer_count": 1, "score": 2, "last_activity_date": 1505079385, "creation_date": 1505078851, "last_edit_date": 1505079172, "question_id": 46145728, "link": "https://stackoverflow.com/questions/46145728/minimize-lock-held-on-map-and-instead-lock-on-individual-item-asap", "title": "Minimize lock held on map \u2014&#160;and instead lock on individual item asap", "body": "<p>I want to minimize the lock held on a map of items that can be individually locked as soon as the relevant item has been retrieved.</p>\n\n<p>That lead me to believe that </p>\n\n<pre><code>var Mymap struct {\n    sync.Mutex\n    m map[string]*Somestruct\n}\n\ntype Somestruct struct {\n    sync.Mutex\n    Someval string\n}\n</code></pre>\n\n<p>could be used like this:</p>\n\n<pre><code>Mymap.Lock()\nif val, ok := Mymap.m.[needle]; ok {\n    Mymap.m.[needle].Lock()\n    Mymap.Unlock()\n    // do something to this entry\n    Mymap.m.[needle].Unlock()\n}\nMymap.Unlock()\n</code></pre>\n\n<p>\u2026but as I understand <code>Unlock()</code> on an already <code>Unlock</code>ed is not a no-op:</p>\n\n<pre><code>panic: sync: unlock of unlocked mutex\n</code></pre>\n\n<p>As per <a href=\"https://groups.google.com/forum/#!topic/Golang-Nuts/GeHbpo6AtTc\" rel=\"nofollow noreferrer\">https://groups.google.com/forum/#!topic/Golang-Nuts/GeHbpo6AtTc</a> I see that there is no way to check that it is actually <code>Unlock</code>ed.</p>\n\n<p>Should I just keep the \"Lock\" state somewhere or is there a better way of doing it than this:</p>\n\n<pre><code>var unlocked bool\n\nMymap.Lock()\nif val, ok := Mymap.m.[needle]; ok {\n    Mymap.m.[needle].Lock()\n    Mymap.Unlock()\n    unlocked := true\n\n    // do something to this entry\n    Mymap.m.[needle].Unlock()\n}\n\nif !unlocked {\n    Mymap.Unlock()\n}\n</code></pre>\n"}, {"tags": ["go", "gregorian-calendar", "hijri"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505086839, "post_id": 46145195, "comment_id": 79254779, "body": "Go wrapper for holiday API <a href=\"https://github.com/joshtronic/go-holidayapi\" rel=\"nofollow noreferrer\">github.com/joshtronic/go-holidayapi</a> Article about holiday API <a href=\"https://joshtronic.com/2013/12/02/holiday-api-free-ready-fork/\" rel=\"nofollow noreferrer\">joshtronic.com/2013/12/02/holiday-api-free-ready-fork</a>  I suggest you pay for the service if you don&#39;t want to build it yourself."}], "owner": {"reputation": 4609, "user_id": 4636715, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5ebd8c54bb287f99b94373429b588e21?s=128&d=identicon&r=PG&f=1", "display_name": "vahdet", "link": "https://stackoverflow.com/users/4636715/vahdet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 204, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1505074736, "creation_date": 1505074736, "question_id": 46145195, "link": "https://stackoverflow.com/questions/46145195/golang-convert-hijri-to-gregorian-date-to-get-holidays-via-an-api-or-not", "title": "Golang - Convert hijri to gregorian date to get holidays (via an API or not)", "body": "<p>So I want to get <a href=\"https://en.wikipedia.org/wiki/Eid_al-Fitr\" rel=\"nofollow noreferrer\">Eid Al-Fitr</a> (first three days of the month of the tenth month) and <a href=\"https://en.wikipedia.org/wiki/Eid_al-Adha\" rel=\"nofollow noreferrer\">Eid Al-Adha</a>(10-to-13th days of final month) in order to calculate the working days in countries e.g Turkey etc.\nAnd as Islamic calendar is a lunar one, it varies in every single Gregorian year. I'd prefer finding them with a piece of Go code rather than persisting their Gregorian equivalents for each year into a database.</p>\n\n<p>How to do that with Go? It is also ok fetching them through a <em>free</em> api too.<a href=\"https://holidayapi.com/\" rel=\"nofollow noreferrer\">HolidayAPI</a> seems to find it but only works for past years' data in free edition.</p>\n"}, {"tags": ["json", "mongodb", "go"], "comments": [{"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505076081, "post_id": 46145184, "comment_id": 79252575, "body": "ID bson.ObjectId <code>json:&quot;_id&quot; bson:&quot;_id,omitempty&quot;</code> ? (json:&quot;_id&quot; instead of json:&quot;id&quot;)"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "reply_to_user": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505076265, "post_id": 46145184, "comment_id": 79252616, "body": "@StephaneMartin  I mean if I change it like that in definition of Article struct it will work, but I need my output to contain string &quot;id&quot; instead of &quot;_id&quot;"}, {"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505078229, "post_id": 46145184, "comment_id": 79253098, "body": "you need two different struct types, one to Unmarshal, one to Marshal. See answer :)"}, {"owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "reply_to_user": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505079500, "post_id": 46145184, "comment_id": 79253425, "body": "I was pretty convenient that I can somehow avoid additional structure, like if I am not using unmarshal output will be whatever i put as value for json fields. Thanks for the answer anyhow, but I will wait a bit more to see is there a different solution."}, {"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 1, "creation_date": 1505079946, "post_id": 46145184, "comment_id": 79253524, "body": "Another possibility is to define the MarshalJson method for your Article struct to customize the marshaling. Probably needs more code, though."}], "answers": [{"tags": [], "owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "is_accepted": false, "score": 0, "last_activity_date": 1505077621, "creation_date": 1505077621, "answer_id": 46145585, "question_id": 46145184, "link": "https://stackoverflow.com/questions/46145184/unmarshal-id-to-id-wont-work/46145585#46145585", "title": "Unmarshal _id to id wont work", "body": "<ul>\n<li>Unmarshal into your Article struct, but with tag <code>json:\"_id\"</code></li>\n<li>two struct types that only differ by tags can be converted to each other. So one solution is to create another ArticleBis type, with tag <code>json:\"id\"</code> instead. Then you convert your article to an ArticleBis instance, which you Marshal.</li>\n</ul>\n\n<p>Another simple example:</p>\n\n<pre class=\"lang-go prettyprint-override\"><code>package main\n\nimport \"fmt\"\nimport \"encoding/json\"\n\ntype Base struct {\n    Firstname string `json:\"first\"`\n}\n\ntype A struct {\n    Base\n    Lastname string `json:\"last\"`\n}\n\ntype B struct {\n    Base\n    Lastname string `json:\"lastname\"`\n}\n\nfunc main() {\n    john := A{Base: Base{Firstname: \"John\"}, Lastname:\"Doe\"}\n    john1 := B(john)\n    john_json, _ := json.Marshal(john)\n    john1_json, _ := json.Marshal(john1)\n    fmt.Println(string(john_json))\n    fmt.Println(string(john1_json))\n}\n</code></pre>\n"}], "owner": {"reputation": 1217, "user_id": 109665, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c8ffc294bf8e3b38abbd3a0b1c2b8d20?s=128&d=identicon&r=PG", "display_name": "Splendid", "link": "https://stackoverflow.com/users/109665/splendid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 490, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505077621, "creation_date": 1505074683, "question_id": 46145184, "link": "https://stackoverflow.com/questions/46145184/unmarshal-id-to-id-wont-work", "title": "Unmarshal _id to id wont work", "body": "<p>So my structure looks like this:</p>\n\n<pre><code>type Article struct {\n    ID bson.ObjectId `json:\"id\" bson:\"_id,omitempty\"`\n    LangCode string `json:\"langCode\" bson:\"langCode\"`\n    AuthorId string `json:\"authorId\" bson:\"authorId\"`\n    AuthorName string `json:\"authorName\" bson:\"authorName\"`\n    ArticleType int64 `json:\"type\" bson:\"type\"`\n    Title string `json:\"title\" bson:\"title\"`\n    Intro string `json:\"intro\" bson:\"intro\"`\n    Body string `json:\"body\" bson:\"body\"`\n    MainPic string `json:\"mainPic\" bson:\"mainPic\"`\n    Tags string `json:\"tags\" bson:\"tags\"`\n    Slug string `json:\"slug\" bson:\"slug\"`\n    DateAdded time.Time `json:\"dateAdded\" bson:\"dateAdded\"`\n    Status int64 `json:\"status\" bson:\"status\"`\n}\n</code></pre>\n\n<p>And following snippet:</p>\n\n<pre><code>pageReturn.Pagination = resultsList.Pagination\nerr = json.Unmarshal(resultsList.Results, &amp;pageReturn.Articles)\n</code></pre>\n\n<p>Will return data without value _id from database (I mean in json string id will be equal to \"\")</p>\n\n<p>If I change     ID bson.ObjectId <code>json:\"id\" bson:\"_id,omitempty\"</code>\nto     ID bson.ObjectId <code>json:\"_id\" bson:\"_id,omitempty\"</code></p>\n\n<p>value will be returned normally (actual _id value from db will be returned)</p>\n\n<p>I'm wondering how can I avoid this (but I still need to use json.Unmarshal)</p>\n"}, {"tags": ["go", "vue.js", "vuejs2", "vue-router", "go-chi"], "comments": [{"owner": {"reputation": 4114, "user_id": 923679, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b6d6007311061f309462cfc88ca7a25c?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/923679/alex"}, "edited": false, "score": 0, "creation_date": 1505073326, "post_id": 46144883, "comment_id": 79251696, "body": "Please provide the URL that you try to open. I have a feeling that you are trying to access Go route (missing one of course), instead of using Vue route."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "reply_to_user": {"reputation": 4114, "user_id": 923679, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/b6d6007311061f309462cfc88ca7a25c?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/923679/alex"}, "edited": false, "score": 0, "creation_date": 1505073650, "post_id": 46144883, "comment_id": 79251813, "body": "@Alex Sadly can&#39;t provide URL right now (testing locally).. what you&#39;re saying makes sense, but if that&#39;s the case then why would I be able to open localhost:8080 and see the App.components.home page (which has no problems referencing other vue components)?"}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1505115088, "post_id": 46150194, "comment_id": 79262199, "body": "Oh wow, this works (I guess that&#39;s what Alex was refereeing to as well).. one problem with this is unfortunately that I really want to get rid of the <code>&#47;#&#47;</code> that appear if using <code>hash</code> mode. Do you know how this might be achieved? (I&#39;ll mark your answer as the solution tonight)"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1505115911, "post_id": 46150194, "comment_id": 79262663, "body": "I don&#39;t know how, but i think the only way is to use <code>mode: &#39;history&#39;</code>, the server then must be configured so that it can handle your routes properly. (like when your using webpack). any way, i&#39;ve created an app in vue.js interacting with an api written in Go and i think it&#39;s fine to have the hash sign as long as it doesn&#39;t get in my way :)"}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 1, "creation_date": 1505116205, "post_id": 46150194, "comment_id": 79262840, "body": "but I think it&#39;s very common for users to type the URL manually, e.g. <code>reddit.com&#47;r&#47;worldnews</code> - if don&#39;t use history mode then these users will be redirected to a 404 page rendered by Go? Do you have a solution to deal with this, or do you just ignore these users? (in my case it&#39;s impossible since I&#39;m building something that users would interact with the same way they interact with a url shortener)"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1505117860, "post_id": 46150194, "comment_id": 79263678, "body": "Try the approach suggested <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/0lj4qKurpMI\" rel=\"nofollow noreferrer\">here</a>."}, {"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 1, "creation_date": 1505126999, "post_id": 46150194, "comment_id": 79269264, "body": "Thanks, I decided to just let Go redirect all not-found URLs to <code>&#47;# + r.URL.Path</code>.. this seems to work quite well :)"}, {"owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "reply_to_user": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1505128503, "post_id": 46150194, "comment_id": 79270204, "body": "Great job mate :)"}], "tags": [], "owner": {"reputation": 1988, "user_id": 6716410, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RbA3G.png?s=128&g=1", "display_name": "sf9v", "link": "https://stackoverflow.com/users/6716410/sf9v"}, "is_accepted": true, "score": 6, "last_activity_date": 1505114858, "last_edit_date": 1505114858, "creation_date": 1505114400, "answer_id": 46150194, "question_id": 46144883, "link": "https://stackoverflow.com/questions/46144883/vue-router-in-production-serving-with-go/46150194#46150194", "title": "vue-router in production (serving with Go)", "body": "<p>I might be wrong, but maybe the routes that you are trying to visit gets resolved in the server (in your Go http server).</p>\n\n<p>You can try to remove the <code>mode: 'history'</code> in your vue-router initialization so that it defaults to <code>hash</code> mode (the routes will then resolve in browser). please see <a href=\"https://router.vuejs.org/en/api/options.html#mode\" rel=\"noreferrer\">this</a> link.</p>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2671, "favorite_count": 0, "accepted_answer_id": 46150194, "answer_count": 1, "score": 3, "last_activity_date": 1534002052, "creation_date": 1505072676, "last_edit_date": 1534002052, "question_id": 46144883, "link": "https://stackoverflow.com/questions/46144883/vue-router-in-production-serving-with-go", "title": "vue-router in production (serving with Go)", "body": "<p>I'd like to separate client and server completely, so I created a vuejs project with <code>vue init webpack my-project</code>. In this project I'm using vue-router for all my routing (this includes special paths, like <code>/user/SOMEID</code>..</p>\n\n<p>This is my routes.js file:</p>\n\n<pre><code>import App from './App.vue'\n\nexport const routes = [\n  {\n    path: '/',\n    component: App.components.home\n  },\n  {\n    path: '/user/:id',\n    component: App.components.userid\n  },\n  {\n    path: '*',\n    component: App.components.notFound\n  }\n]\n</code></pre>\n\n<p>When I run the application using <code>npm run dev</code> everything works perfectly.  I'm now ready to deploy to cloud, so I ran <code>npm run build</code>. Since I need to use a HTTP Server, I decided to use Go for that as well.. this is my Go file:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/go-chi/chi\"\n    \"github.com/me/myproject/server/handler\"\n    \"net/http\"\n    \"strings\"\n)\n\nfunc main() {\n    r := chi.NewRouter()\n\n    distDir := \"/home/me/code/go/src/github.com/me/myproject/client/dist/static\"\n    FileServer(r, \"/static\", http.Dir(distDir))\n\n    r.Get(\"/\", IndexGET)\n\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc IndexGET(w http.ResponseWriter, r *http.Request) {\n    handler.Render.HTML(w, http.StatusOK, \"index\", map[string]interface{}{})\n}\n\nfunc FileServer(r chi.Router, path string, root http.FileSystem) {\n    if strings.ContainsAny(path, \"{}*\") {\n        panic(\"FileServer does not permit URL parameters.\")\n    }\n\n    fs := http.StripPrefix(path, http.FileServer(root))\n\n    if path != \"/\" &amp;&amp; path[len(path)-1] != '/' {\n        r.Get(path, http.RedirectHandler(path+\"/\", 301).ServeHTTP)\n        path += \"/\"\n    }\n    path += \"*\"\n\n    r.Get(path, http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        fs.ServeHTTP(w, r)\n    }))\n}\n</code></pre>\n\n<p>I'm able to load the home page (<code>App.components.home</code>) where everything seem to work (the css, the images, translations, calls to and responses from the server).. but when I try to open other routes that should either result in 404 or load a user, then I just get the response <code>404 page not found</code> in plaintext (not the vue notFound component it's supposed to render)..</p>\n\n<p>Any ideas what I'm doing wrong and how to fix it?</p>\n\n<hr>\n\n<p>Edit: this is the other part of the router setup in the main.js file:</p>\n\n<pre><code>const router = new VueRouter({\n  mode: 'history',\n  base: __dirname,\n  routes\n})\n\nnew Vue({\n  el: '#app',\n  router,\n  i18n,\n  render: h =&gt; h(App)\n})\n</code></pre>\n"}, {"tags": ["go", "types", "casting"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 2, "creation_date": 1505072199, "post_id": 46144626, "comment_id": 79251327, "body": "&quot;This may not be idiomatic in Go, but it is the pattern that I want my code to follow.&quot; That&#39;s perfectly alright, as long as you accept that your code won&#39;t compile you can use whatever pattern you like."}, {"owner": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 1, "creation_date": 1505074707, "post_id": 46144626, "comment_id": 79252170, "body": "You need to wrap <code>fooB</code>: <a href=\"https://play.golang.org/p/T9m7iBHpwC\" rel=\"nofollow noreferrer\">play.golang.org/p/T9m7iBHpwC</a>"}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "reply_to_user": {"reputation": 1767, "user_id": 1412534, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459e618cf38006bdc543e535c854f163?s=128&d=identicon&r=PG", "display_name": "md2perpe", "link": "https://stackoverflow.com/users/1412534/md2perpe"}, "edited": false, "score": 0, "creation_date": 1505336101, "post_id": 46144626, "comment_id": 79376709, "body": "@md2perpe yep, something like that, but from inside a function generating function was what I used in the end... turned up much nicer/simpler than expected, no reflection and all that needed :)"}], "answers": [{"comments": [{"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1505335994, "post_id": 46145806, "comment_id": 79376648, "body": "Thanks! In the end, I realized that a simple &quot;general function generator&quot; (without reflection, but with type assertions inside) was what I needed to get the more &quot;general&quot; versions of the function I wanted. Reflection seems powerful, but my actual problem was much simpler :)"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1505080648, "last_edit_date": 1505080648, "creation_date": 1505079425, "answer_id": 46145806, "question_id": 46144626, "link": "https://stackoverflow.com/questions/46144626/function-types-in-go-particular-type-casting-to-more-general-type/46145806#46145806", "title": "Function types in Go - particular type casting to more general type", "body": "<p>To use type assertions, every possible type must be enumerated in <code>MakeExclamer</code>:</p>\n\n<pre><code>func MakeExclamer(fn interface{}, arg interface{}) func() {\n    switch fn := fn.(type) {\n    case func(int) int:\n        return func() {\n            fmt.Printf(\"%v!!!\\n\", fn(arg.(int)))\n        }\n    case func(interface{}) interface{}:\n        return func() {\n            fmt.Printf(\"%v!!!\\n\", fn(arg))\n        }\n    default:\n        panic(\"not supported\")\n    }\n}\n</code></pre>\n\n<p>To accept a function of any type, the <code>fn</code> argument is declared as type <code>interface{}</code>.  The code uses a <a href=\"https://golang.org/ref/spec#Type_switches\" rel=\"nofollow noreferrer\">type switch</a> to handle the different function types.</p>\n\n<p><a href=\"https://play.golang.org/p/zchaG36Vds\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p><a href=\"https://godoc.org/reflect#Value.Call\" rel=\"nofollow noreferrer\">Reflection</a> can be used to write a more general function.</p>\n\n<pre><code>func MakeExclamer(fn interface{}, arg interface{}) func() {\n    fnr := reflect.ValueOf(fn)\n    argr := reflect.ValueOf(arg)\n    return func() {\n        resultr := fnr.Call([]reflect.Value{argr})\n        fmt.Printf(\"%v!!!\\n\", resultr[0].Interface())\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/y0ZITDC9uA\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1505335893, "post_id": 46145921, "comment_id": 79376594, "body": "Thx a loooot! This was the bit I was not groking right: <i>&quot;The generic type under which a function can be passed around without caring about its type is interface{}. Something like &quot;func(interface{}) interface{}&quot; is not a generalization of a function, it is already a concrete type. Hence, &quot;func(interface{}) interface{}&quot; is not a generalization of &quot;func(int) int&quot;, those are two different function types entirely. This is why you can&#39;t use type assertions/cast to convert from one function type to another.&quot;</i>. Once I understood this, I actually managed to solve my more particular problem easily..."}, {"owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1505336223, "post_id": 46145921, "comment_id": 79376779, "body": "I appreciate your answer more, but I picked the one of @Cerise because it&#39;s probably more helpful to anyone landing here form google and wanting a simple/concise/ready-to-copy-paste solution :)"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "edited": false, "score": 0, "creation_date": 1505383332, "post_id": 46145921, "comment_id": 79394819, "body": "No problem, glad it helped you ;)"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 0, "last_activity_date": 1505080426, "creation_date": 1505080426, "answer_id": 46145921, "question_id": 46144626, "link": "https://stackoverflow.com/questions/46144626/function-types-in-go-particular-type-casting-to-more-general-type/46145921#46145921", "title": "Function types in Go - particular type casting to more general type", "body": "<p>First things first : When it comes to typing in Go, everything is <strong>theoretically</strong> possible. That's because even though the compiler does a lot of checks at compile-time, it is possible to change the runtime... at runtime. So-called runtime hacks, where you dynamically manipulate runtime structs that you're NOT supposed to handle.</p>\n\n<p>Now, you have an interesting question, whose answer doesn't include the need to  use the 'unsafe' package. However, the way I found of generalizing a function involves heavy reflection.</p>\n\n<h3>How to call a function (via reflection) ?</h3>\n\n<p>The documentation for the reflect package can be found <a href=\"https://godoc.org/reflect\" rel=\"nofollow noreferrer\" title=\"here\">here</a>.</p>\n\n<p>So, like all elements in Golang, functions have a Type. Without going through all fields, functions do take an array of arguments and produce an array of results. It is possible to investigate the Type of arguments and results through the In(int) and Out(int) method.</p>\n\n<pre><code>func investigate(fn interface{}) {\n    fnType := reflect.TypeOf(fn)\n\n    for idx := 0; idx &lt; fnType.NumIn(); idx ++ {\n        fmt.Printf(\"Input arg %d has type %v\\n\", idx, fnType.In(idx))\n    }\n\n    for idx := 0; idx &lt; fnType.NumOut(); idx ++ {\n        fmt.Printf(\"Output arg %d has type %v\\n\", idx, fnType.Out(idx))\n    }\n}\n</code></pre>\n\n<p>We won't use this code. However, two important things are to be noted at this point :</p>\n\n<ul>\n<li>The generic type under which a function can be passed around without caring about its type is interface{}. Something like \"func(interface{}) interface{}\" is not a generalization of a function, it is already a concrete type. Hence, \"func(interface{}) interface{}\" is not a generalization of \"func(int) int\", those are two different function types entirely. This is why you can't use type assertions/cast to convert from one function type to another.</li>\n<li>A function can be represented as <strong>something that takes an input array and produces and output array</strong>.</li>\n</ul>\n\n<p>Now, in order to call a function, you have to get not its Type, but its <strong>Value</strong>. Once you get its value, you can call it using an array of arguments, which must all be Values.</p>\n\n<p>The prototype is:</p>\n\n<pre><code>func (v Value) Call(in []Value) []Value\n</code></pre>\n\n<p>Using this method, it is possible to call any function.</p>\n\n<h3>The code</h3>\n\n<p>So, the only thing you need is to convert whichever arguments array you have to an array of Values, then you will be able to call your function.</p>\n\n<p>Here is your code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc MakeExclamer(foo interface{}, n int) func() {\n    exclamer := generalize(foo, n)\n    return func() {\n        fmt.Printf(\"%v!!!\\n\", exclamer())\n    }\n}\n\nfunc fooA(x interface{}) interface{} {\n    return x.(int) * 2\n}\n\nfunc fooB(x int) int {\n    return x * 10\n}\n\nfunc generalize(implem interface{}, args ...interface{}) func() interface{} {\n    valIn := make([]reflect.Value, len(args), len(args))\n\n    fnVal := reflect.ValueOf(implem)\n\n    for idx, elt := range args {\n        valIn[idx] = reflect.ValueOf(elt)\n    }\n\n    ret := func() interface{} {\n        res := fnVal.Call(valIn)\n\n        // We assume the function produces exactly one result\n        return res[0].Interface()\n    }\n\n    return ret\n}\n\nfunc main() {\n    exclamerA := MakeExclamer(fooA, 12)\n    exclamerA()\n\n    exclamerB := MakeExclamer(fooB, 66)\n    exclamerB()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/2cENYT3KjE\" rel=\"nofollow noreferrer\" title=\"Playground\">Playground</a></p>\n\n<p>The important bit is the <code>generalize</code> function which makes the translation between your arguments and an array of Values, then returns a new function whith all parameters already filled.</p>\n\n<p>Do not hesitate if you need any precision !</p>\n"}], "owner": {"reputation": 5541, "user_id": 507537, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/fdvRD.jpg?s=128&g=1", "display_name": "NeuronQ", "link": "https://stackoverflow.com/users/507537/neuronq"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 46145806, "answer_count": 2, "score": -1, "last_activity_date": 1505080648, "creation_date": 1505070984, "question_id": 46144626, "link": "https://stackoverflow.com/questions/46144626/function-types-in-go-particular-type-casting-to-more-general-type", "title": "Function types in Go - particular type casting to more general type", "body": "<p>What cast / assertion need I do in Go in order to pass to a function expecting a generic function like <code>func(interface{}) interface{}</code>, a more specific function like <code>func(int) int</code> instead?</p>\n\n<p>For example, in code like this, <code>fooA</code> can be passed to <code>MakeExclamer</code>, but not <code>fooB</code>:</p>\n\n<pre><code>func MakeExclamer(foo func (interface{}) interface{}, n int) func () {\n    return func() {\n        fmt.Printf(\"%v!!!\", foo(n))\n    }\n}\n\nfunc fooA(x interface{}) interface{} {\n    return x.(int)*2\n}\n\nfunc fooB(x int) int {\n    return x * 10\n}\n\nfunc main() {\n    exclamerA := MakeExclamer(fooA, 12)\n    exclamerA()\n    exclamerB := MakeExclamer(fooB, 66)\n// &gt;&gt; cannot use fooB (type func(int) int) as type func(interface {}) interface {} in argument to MakeExclamer \n    exclamerB()\n}\n</code></pre>\n\n<p>(Go Playground link: <a href=\"https://play.golang.org/p/xGzfco0IAG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xGzfco0IAG</a>)</p>\n\n<p>I'm not interested much in alternative code structure patterns, since this is how I want it to work: a specific function should be passed to a general function transformer (accepting function of type <code>Any -&gt; Any</code>) that will return another general function (<code>Any -&gt; Any</code>). This may not be idiomatic in Go, but it is the pattern that I want my code to follow.</p>\n"}, {"tags": ["go", "slice", "type-conversion"], "comments": [{"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505075895, "post_id": 46143974, "comment_id": 79252523, "body": "Looks good to me. Golang may be less verbose than plain C, but nearly nothing beats Python for concise code... By the way, it should be longer: you should check for scanner.Err() after the for loop."}, {"owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "reply_to_user": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505076455, "post_id": 46143974, "comment_id": 79252659, "body": "@StephaneMartin, thanks a lot for your comment. I just checked Golang&#39;s documentation on Scanner. Do you mean the line <code>if err := scanner.Err(); err != nil...</code> should be added to detect any error?"}, {"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505077150, "post_id": 46143974, "comment_id": 79252847, "body": "yep, after the for loop returns, to check that the scanner could actually parse content"}, {"owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "reply_to_user": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505077381, "post_id": 46143974, "comment_id": 79252903, "body": "@StephaneMartin Thank you :) Honestly this is my first time solving a problem independently using something other than Python. And it helps me to appreciate the simplicity of Python."}, {"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505077698, "post_id": 46143974, "comment_id": 79252979, "body": "Coming from Python (I do too), golang is only interesting for speed and goroutines/channels..."}, {"owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "reply_to_user": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505077817, "post_id": 46143974, "comment_id": 79253004, "body": "Personally I&#39;m writing some exercises in Java and Go now as I&#39;m too dependent on Python. In what applications are goroutines/channels common?"}, {"owner": {"reputation": 1576, "user_id": 5453515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c41cae4ee9e62e14df6757fc7a364cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Stephane Martin", "link": "https://stackoverflow.com/users/5453515/stephane-martin"}, "edited": false, "score": 0, "creation_date": 1505078168, "post_id": 46143974, "comment_id": 79253087, "body": "Concurrent code. Python is not truely multi-threaded (look for &quot;python global interpreter lock&quot;), so typical pure python code only uses one CPU. Goroutines (aka green threads) in go are multiplexed on OS threads, so the program actually uses all CPUs. Channels are queues to pass objects between goroutines."}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "edited": false, "score": 0, "creation_date": 1505133370, "post_id": 46155834, "comment_id": 79273485, "body": "Thank you Kaveh. I&#39;ve never used JSON with Go and will look into it!"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1505132969, "creation_date": 1505132969, "answer_id": 46155834, "question_id": 46143974, "link": "https://stackoverflow.com/questions/46143974/convert-slice-of-string-input-from-console-to-slice-of-numbers/46155834#46155834", "title": "Convert slice of string input from console to slice of numbers", "body": "<p>With given input, you can concatenate them to make a JSON string and then unmarshal (deserialize) that:</p>\n\n<pre><code>func main() {\n    var lines []string\n    for {\n        var line string\n        fmt.Scanln(&amp;line)\n        if line == \"\" {\n            break\n        }\n        lines = append(lines, \"[\"+line+\"]\")\n    }\n    all := \"[\" + strings.Join(lines, \",\") + \"]\"\n    inputs := [][]float64{}\n    if err := json.Unmarshal([]byte(all), &amp;inputs); err != nil {\n        fmt.Println(err)\n        return\n    }\n\n    fmt.Println(inputs)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "edited": false, "score": 0, "creation_date": 1505295107, "post_id": 46157013, "comment_id": 79349909, "body": "Hi Eugene, thanks for sharing your solution! Really like your idea to write all the input data in command line :)"}], "tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1505136832, "creation_date": 1505136832, "answer_id": 46157013, "question_id": 46143974, "link": "https://stackoverflow.com/questions/46143974/convert-slice-of-string-input-from-console-to-slice-of-numbers/46157013#46157013", "title": "Convert slice of string input from console to slice of numbers", "body": "<p>Using only string functions:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    scanner := bufio.NewScanner(os.Stdin)\n    var result [][]float64\n    var txt string\n    for scanner.Scan() {\n        txt = scanner.Text()\n        if len(txt) &gt; 0 {\n            values := strings.Split(txt, \",\")\n            var row []float64\n            for _, v := range values {\n                fl, err := strconv.ParseFloat(strings.Trim(v, \" \"), 64)\n                if err != nil {\n                    panic(fmt.Sprintf(\"Incorrect value for float64 '%v'\", v))\n                }\n                row = append(row, fl)\n            }\n            result = append(result, row)\n        }\n    }\n    fmt.Printf(\"Result: %v\\n\", result)\n}\n</code></pre>\n\n<p>Run:</p>\n\n<pre><code>$ printf \"1.1,2.2,3.3\n3.14,0,5.16\n2,45,76.0, 45 , 69\" | go run experiment2.go\n\nResult: [[1.1 2.2 3.3] [3.14 0 5.16] [2 45 76 45 69]]\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 6297414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e36e0275a7162d806e9da9df8c62ddd1?s=128&d=identicon&r=PG", "display_name": "Nahua", "link": "https://stackoverflow.com/users/6297414/nahua"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2033, "favorite_count": 0, "accepted_answer_id": 46157013, "answer_count": 2, "score": 3, "last_activity_date": 1547678307, "creation_date": 1505067009, "last_edit_date": 1547678307, "question_id": 46143974, "link": "https://stackoverflow.com/questions/46143974/convert-slice-of-string-input-from-console-to-slice-of-numbers", "title": "Convert slice of string input from console to slice of numbers", "body": "<p>I'm trying to write a Go script that takes in as many lines of comma-separated coordinates as the user wishes, split and convert the string of coordinates to float64, store each line as a slice, and then append each slice in a slice of slices for later usage.</p>\n\n<p>Example inputs are:</p>\n\n<pre><code>1.1,2.2,3.3\n3.14,0,5.16\n</code></pre>\n\n<p>Example outputs are:</p>\n\n<pre><code>[[1.1 2.2 3.3],[3.14 0 5.16]]\n</code></pre>\n\n<p>The equivalent in Python is</p>\n\n<pre><code>def get_input():\n    print(\"Please enter comma separated coordinates:\")\n    lines = []\n    while True:\n        line = input()\n        if line:\n            line = [float(x) for x in line.replace(\" \", \"\").split(\",\")]\n            lines.append(line)\n        else:\n            break\n    return lines\n</code></pre>\n\n<p>But what I wrote in Go seems way too long (pasted below), and I'm creating a lot of variables without the ability to change variable type as in Python. Since I literally just started writing Golang to learn it, I fear my script is long as I'm trying to convert Python thinking into Go. Therefore, I would like to ask for some advice as to how to write this script shorter and more concise in Go style? Thank you.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"bufio\"\n    \"strings\"\n    \"strconv\"\n)\n\nfunc main() {\n    inputs := get_input()\n    fmt.Println(inputs)\n}\n\nfunc get_input() [][]float64 {\n    fmt.Println(\"Please enter comma separated coordinates: \")\n\n    var inputs [][]float64\n\n    scanner := bufio.NewScanner(os.Stdin)\n    for scanner.Scan() {\n        if len(scanner.Text()) &gt; 0 {\n            raw_input := strings.Replace(scanner.Text(), \" \", \"\", -1)\n            input := strings.Split(raw_input, \",\")\n            converted_input := str2float(input)\n            inputs = append(inputs, converted_input)\n        } else {\n            break\n        }\n    }\n\n    return inputs\n}\n\nfunc str2float(records []string) []float64 {\n\n    var float_slice []float64\n\n    for _, v := range records {\n        if s, err := strconv.ParseFloat(v, 64); err == nil {\n            float_slice = append(float_slice, s)\n        }\n    }\n\n    return float_slice\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 560, "user_id": 3621898, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/afafb245f06a016d45d486db8f0cd277?s=128&d=identicon&r=PG&f=1", "display_name": "user3621898", "link": "https://stackoverflow.com/users/3621898/user3621898"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505063344, "post_id": 46142980, "comment_id": 79248446, "body": "I have a source struct, what does &quot;Make sure the source json tag is in line.&quot; mean ?"}], "answers": [{"tags": [], "owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "is_accepted": false, "score": 0, "last_activity_date": 1505063392, "creation_date": 1505063392, "answer_id": 46143360, "question_id": 46142980, "link": "https://stackoverflow.com/questions/46142980/json-marshal-one-property-of-struct-array/46143360#46143360", "title": "json marshal one property of struct array", "body": "<p>Add this to your source:</p>\n\n<pre><code>func (s Recipe) MarshalJSON() ([]byte, error) {\n    return json.Marshal(s.Source)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 9701, "user_id": 5165332, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/93c5b8f16dce739cd7e4336034e1f76c?s=128&d=identicon&r=PG&f=1", "display_name": "Eugene Lisitsky", "link": "https://stackoverflow.com/users/5165332/eugene-lisitsky"}, "is_accepted": true, "score": 2, "last_activity_date": 1505063538, "creation_date": 1505063538, "answer_id": 46143389, "question_id": 46142980, "link": "https://stackoverflow.com/questions/46142980/json-marshal-one-property-of-struct-array/46143389#46143389", "title": "json marshal one property of struct array", "body": "<p>You may define custom marshaller:</p>\n\n<pre><code>func (r Recipe) MarshalJSON() ([]byte, error) {\n  return json.Marshal(r.Source)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xLUAlMllGR\" rel=\"nofollow noreferrer\">https://play.golang.org/p/xLUAlMllGR</a></p>\n"}], "owner": {"reputation": 560, "user_id": 3621898, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/afafb245f06a016d45d486db8f0cd277?s=128&d=identicon&r=PG&f=1", "display_name": "user3621898", "link": "https://stackoverflow.com/users/3621898/user3621898"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 480, "favorite_count": 1, "accepted_answer_id": 46143389, "answer_count": 2, "score": 1, "last_activity_date": 1505063538, "creation_date": 1505061099, "question_id": 46142980, "link": "https://stackoverflow.com/questions/46142980/json-marshal-one-property-of-struct-array", "title": "json marshal one property of struct array", "body": "<p>So I have an array of struct Recipe it contains some properties and one of the properties is the struct Source, I want to convert the entire array to json but only the Source property of the Recipe struct</p>\n\n<p>Code: <a href=\"https://play.golang.org/p/E71d4xzNM4\" rel=\"nofollow noreferrer\">https://play.golang.org/p/E71d4xzNM4</a></p>\n\n<p>Result:</p>\n\n<pre><code>[\n{\n    \"Id\": 1,\n    \"Title\": \"Fine Peanutbutter\",\n    \"Description\": \"The best peanutbutter in the world\",\n    \"Source\": {\n        \"Name\": \"Peter\",\n        \"Address\": \"32121 Little Midge\"\n    },\n    \"Price\": 49\n},\n{\n    \"Id\": 2,\n    \"Title\": \"Fine Jelly\",\n    \"Description\": \"The best Jelly in the world\",\n    \"Source\": {\n        \"Name\": \"Peter\",\n        \"Address\": \"32121 Little Midge\"\n    },\n    \"Price\": 39\n}\n]\n</code></pre>\n\n<p>Wanted Result:</p>\n\n<pre><code>[\n{\n    \"Name\": \"Peter\",\n    \"Address\": \"32121 Little Midge\"     \n},\n{\n    \"Name\": \"Peter\",\n    \"Address\": \"32121 Little Midge\"\n}\n]\n</code></pre>\n\n<p>How do I get this without looping through the entire array and creating a new array struct and doing a json marshal on that one</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1505058267, "post_id": 46142440, "comment_id": 79246775, "body": "Did you uninstall go 1.8 first?  Possible that maybe you have mixed versions in C:\\Go?"}, {"owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1505058410, "post_id": 46142440, "comment_id": 79246813, "body": "I reset the windows and after that installed, let me remove the folder and re-install."}, {"owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1505058852, "post_id": 46142440, "comment_id": 79246959, "body": "Removing folder and re-installing worked. Thank You so much @DavidBudworth! I didn&#39;t think the solution will be that simple :), because the error message seemed very dirty."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 2, "creation_date": 1505058964, "post_id": 46142440, "comment_id": 79246983, "body": "yep, when you see crazy stuff happening in the runtime itself, it&#39;s highly likely that your files are &quot;corrupt&quot; in some way.   In this case, the go team probably removed some files, so you had some 1.8 remnants + 1.9, and go compiles all files in a package together."}, {"owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1505059717, "post_id": 46142440, "comment_id": 79247209, "body": "So it&#39;s the recommended way to remove the Go root folder and reinstall, right? I didn&#39;t think this problem will solve so easily."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1505059880, "post_id": 46142440, "comment_id": 79247263, "body": "yes, delete original folder and then install.  Or you could install go in a folder with the version in it, like <code>C:\\Go\\1.9</code>, but then you have to update your path and stuff.  That&#39;s only useful if you need to keep multiple versions around, which most people do not."}, {"owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 1, "creation_date": 1505059955, "post_id": 46142440, "comment_id": 79247290, "body": "I&#39;m assuming you do not keep your source code in that directory too, but have GOPATH somewhere else?   You should make sure you don&#39;t mix your code with the runtime&#39;s code, which will make delete / install easier as you won&#39;t accidentally delete your personal stuff."}, {"owner": {"reputation": 14826, "user_id": 3134069, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/5002efc769839cea1738a0e530f0e5d6?s=128&d=identicon&r=PG", "display_name": "majidarif", "link": "https://stackoverflow.com/users/3134069/majidarif"}, "edited": false, "score": 0, "creation_date": 1505070488, "post_id": 46142440, "comment_id": 79250789, "body": "Maybe it has something to do with this: <a href=\"https://golang.org/doc/go1.9#goroot\" rel=\"nofollow noreferrer\">golang.org/doc/go1.9#goroot</a>"}, {"owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "reply_to_user": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "edited": false, "score": 0, "creation_date": 1505071420, "post_id": 46142440, "comment_id": 79251084, "body": "@DavidBudworth Yes I keep my code at &#39;user/go&#39; and Go installs at c:/Go.  majidarif: No, actually I had old (1.8) installation&#39;s files remaining."}], "answers": [{"tags": [], "owner": {"reputation": 2776, "user_id": 1094529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/glcan.png?s=128&g=1", "display_name": "Milo Christiansen", "link": "https://stackoverflow.com/users/1094529/milo-christiansen"}, "is_accepted": false, "score": 3, "last_activity_date": 1505089015, "creation_date": 1505089015, "answer_id": 46146708, "question_id": 46142440, "link": "https://stackoverflow.com/questions/46142440/go-1-9-gives-runtime-error-on-windows-10/46146708#46146708", "title": "Go 1.9 gives runtime error on Windows 10", "body": "<p>Really weird issues in the runtime with no obvious cause are often caused by not uninstalling a pervious version before installing the new one.</p>\n\n<p>Sadly <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">the Go installation instructions</a> make no mention of the issue.</p>\n\n<p>In general you should move or delete your old Go install, and install the new version from scratch.</p>\n\n<p>If you are building from source (the way I do) it is best to move the old version to a diferent directory, and then configure a temporary environment so you can use the old version to build the new one. If installing from the official binaries just deleting the old version is simplest.</p>\n\n<p>Regardless of how you are installing you should never place your own code in the same tree as the runtime code, so just deleting the old runtime and reinstalling/rebuilding should always be possible.</p>\n"}], "owner": {"reputation": 417, "user_id": 7293425, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/DFFOL.jpg?s=128&g=1", "display_name": "Indu Pillai", "link": "https://stackoverflow.com/users/7293425/indu-pillai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 472, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1505089015, "creation_date": 1505057604, "question_id": 46142440, "link": "https://stackoverflow.com/questions/46142440/go-1-9-gives-runtime-error-on-windows-10", "title": "Go 1.9 gives runtime error on Windows 10", "body": "<p>I installed Go 1.9 on Windows 10 and when I ran a class 'Hello World' program it gave me the following error.</p>\n\n<pre><code># runtime\nC:\\Go\\src\\runtime\\mstkbar.go:151:10: debug.gcstackbarrieroff undefined (type struct { allocfreetrace int32; cgocheck int32; efence int32; gccheckmark int32; gcpacertrace int32; gcshrinkstackoff int32; gcrescanstacks int32; gcstoptheworld int32; gctrace int32; invalidptr int32; sbrk int32; scavenge int32; scheddetail int32; schedtrace int32 } has no field or method gcstackbarrieroff)\nC:\\Go\\src\\runtime\\mstkbar.go:162:24: division by zero\nC:\\Go\\src\\runtime\\mstkbar.go:162:43: invalid expression unsafe.Sizeof(composite literal)\nC:\\Go\\src\\runtime\\mstkbar.go:162:44: undefined: stkbar\nC:\\Go\\src\\runtime\\mstkbar.go:212:4: gp.stkbar undefined (type *g has no field or method stkbar)\nC:\\Go\\src\\runtime\\mstkbar.go:213:15: gp.stkbar undefined (type *g has no field or method stkbar)\nC:\\Go\\src\\runtime\\mstkbar.go:216:23: undefined: stackBarrierPC\nC:\\Go\\src\\runtime\\mstkbar.go:226:28: gp.stkbarPos undefined (type *g has no field or method stkbarPos)\nC:\\Go\\src\\runtime\\mstkbar.go:227:19: gp.stkbarPos undefined (type *g has no field or method stkbarPos)\nC:\\Go\\src\\runtime\\mstkbar.go:248:41: undefined: stkbar\nC:\\Go\\src\\runtime\\mstkbar.go:227:19: too many errors\n</code></pre>\n\n<p>When I ran <code>go env</code>, it gave me the following output,</p>\n\n<pre><code>set GOARCH=amd64\nset GOBIN=\nset GOEXE=.exe\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=windows\nset GOPATH=C:\\Users\\indu\\go\nset GORACE=\nset GOROOT=C:\\Go\nset GOTOOLDIR=C:\\Go\\pkg\\tool\\windows_amd64\nset GCCGO=gccgo\nset CC=gcc\nset GOGCCFLAGS=-m64 -mthreads -fmessage-length=0\nset CXX=g++\nset CGO_ENABLED=1\nset CGO_CFLAGS=-g -O2\nset CGO_CPPFLAGS=\nset CGO_CXXFLAGS=-g -O2\nset CGO_FFLAGS=-g -O2\nset CGO_LDFLAGS=-g -O2\nset PKG_CONFIG=pkg-config\n</code></pre>\n"}, {"tags": ["go", "dependency-injection"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1505133247, "post_id": 46141898, "comment_id": 79273395, "body": "There are many good packages out there. But a simple map of factory methods would do too (for many cases, though not all)."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1505141134, "post_id": 46141898, "comment_id": 79278807, "body": "A library, framework, or even map of factories is almost certainly unnecessarily overcomplicating things. Dependency injection just means that if Foo needs a Bar, Foo doesn&#39;t create a Bar, Foo receives Bar from whatever is creating/calling Foo."}, {"owner": {"reputation": 382, "user_id": 1165236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e823b21c2c71249c8364f533716fed6?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1165236/vincent"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1505163008, "post_id": 46141898, "comment_id": 79290734, "body": "@KavehShahbazian Yes I tried to implement a simple one with a map[string]interface{},, but I think I need to practice more to understand some requirements like injector / type.."}, {"owner": {"reputation": 382, "user_id": 1165236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e823b21c2c71249c8364f533716fed6?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1165236/vincent"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1505163304, "post_id": 46141898, "comment_id": 79290865, "body": "@Adrian I agree with you :) But finding a good way / process to inject them will be nice. For now I found a way like creating a Context, storing my instance inside and then giving this context to my struct that need it, but I don&#39;t really like this"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1505206155, "post_id": 46141898, "comment_id": 79305802, "body": "In my humble experience <code>context.Context.Value()</code> is (at best) a disease. One should avoid it. (IMHO) <code>context.Context</code> is the best way to implement a hierarchy of cancellation (combined with <code>sync.WaitGroup</code> for confirmation). <code>context.Context</code> is immutable in nature which is a good thing. The value part should really be used only inside a request scope (I&#39;ve never used it for that purpose either)."}], "answers": [{"comments": [{"owner": {"reputation": 382, "user_id": 1165236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e823b21c2c71249c8364f533716fed6?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1165236/vincent"}, "edited": false, "score": 0, "creation_date": 1505164767, "post_id": 46142013, "comment_id": 79291489, "body": "Thanks for your answer, I still never use a &quot;Context&quot; so I feel lost for now even with  documentation and example..  I read this too, it says do not abuse of the Context to store value inside, <a href=\"https://medium.com/@cep21/how-to-correctly-use-context-context-in-go-1-7-8f2c0fafdf39\" rel=\"nofollow noreferrer\">medium.com/@cep21/&hellip;</a>, but as I&#39;m not comfortable with, I think I will use a simple way for now and I will keep practicing with the language :)"}], "tags": [], "owner": {"reputation": 912, "user_id": 1912391, "user_type": "registered", "accept_rate": 22, "profile_image": "https://www.gravatar.com/avatar/890f477cf12dd59c58e326be303f04b6?s=128&d=identicon&r=PG", "display_name": "ZAky", "link": "https://stackoverflow.com/users/1912391/zaky"}, "is_accepted": false, "score": 3, "last_activity_date": 1505067303, "last_edit_date": 1505067303, "creation_date": 1505055174, "answer_id": 46142013, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang/46142013#46142013", "title": "What is the best way to have dependency injection in Golang", "body": "<p>Create a struct that represent the resource\u200b, let's call Cart. Add get and post methods to this struct. These methods should be http handlers. In main create an instance of the struct with db interface. And in the route call Cart.get. Now in get method you have access to the db interface.</p>\n\n<p>Not a working example, just to get the idea of injecting for testing.</p>\n\n<pre><code>type storage interface {\n    PrepareContext(context.Context, string) (*sql.Stmt, error)\n}\n\nfunc main() {\n    db, _ := sql.Open(\"mysql\", `queryString`)\n    http.HandleFunc(\"/\", Cart{db}.get)\n    http.ListenAndServe(\":8080\", nil)\n}\n\ntype Cart struct {\n    storage\n}\n\nfunc (crt Cart) get(w http.ResponseWriter, r *http.Request) {\n    q, _ := crt.PrepareContext(context.Background(), `select *`)\n    fmt.Println(q.Exec())\n}\n\n/////////Test\ntype testDB struct{}\n\nfunc (c testDB) PrepareContext(context.Context, string) (*sql.Stmt, error) {\n    return nil, nil\n}\nfunc TestGet(t *testing.T) {\n    db := testDB{}\n    _ = Cart{db}\n\n    //http test here\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 382, "user_id": 1165236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e823b21c2c71249c8364f533716fed6?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1165236/vincent"}, "edited": false, "score": 0, "creation_date": 1511888287, "post_id": 47220525, "comment_id": 82030745, "body": "Thank you, gonna take a look at this one :)"}], "tags": [], "owner": {"reputation": 1686, "user_id": 323044, "user_type": "registered", "accept_rate": 26, "profile_image": "https://www.gravatar.com/avatar/48110607223e772abb04d4f42650b7de?s=128&d=identicon&r=PG", "display_name": "Alessandro Dionisi", "link": "https://stackoverflow.com/users/323044/alessandro-dionisi"}, "is_accepted": false, "score": 0, "last_activity_date": 1510309309, "creation_date": 1510309309, "answer_id": 47220525, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang/47220525#47220525", "title": "What is the best way to have dependency injection in Golang", "body": "<p>I would suggest giving a try to <a href=\"https://github.com/facebookgo/inject\" rel=\"nofollow noreferrer\">https://github.com/facebookgo/inject</a>. It allows to define an object graph and specify dependencies with struct annotations. Injection is performed using reflection.</p>\n"}, {"tags": [], "owner": {"reputation": 2178, "user_id": 3067964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/CvonS.jpg?s=128&g=1", "display_name": "jwells131313", "link": "https://stackoverflow.com/users/3067964/jwells131313"}, "is_accepted": false, "score": 1, "last_activity_date": 1537134022, "creation_date": 1537134022, "answer_id": 52358627, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang/52358627#52358627", "title": "What is the best way to have dependency injection in Golang", "body": "<p>I would suggest <a href=\"https://github.com/jwells131313/dargo\" rel=\"nofollow noreferrer\">Dargo</a> which is an injection engine in the style of Java CDI and/or JSR-330.  It uses struct annotations and Injection is performed using reflection or using creator functions.  It supports different lifecycles for services including Singleton (created exactly once, lazily), PerLookup (created every time injected or looked up), Immediate (created exactly once, eagerly) and DargoContext (tied to the lifecycle of a context.Context)</p>\n"}, {"tags": [], "owner": {"reputation": 29, "user_id": 10472883, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-grRc3vJ9PiI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DV6-nExlrOn-PuZEkVwLLNiIJOXgw/mo/photo.jpg?sz=128", "display_name": "John Deng", "link": "https://stackoverflow.com/users/10472883/john-deng"}, "is_accepted": false, "score": 1, "last_activity_date": 1543549786, "last_edit_date": 1543549786, "creation_date": 1539538779, "answer_id": 52805345, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang/52805345#52805345", "title": "What is the best way to have dependency injection in Golang", "body": "<p>You can also try <a href=\"https://github.com/hidevopsio/hiboot\" rel=\"nofollow noreferrer\">Hiboot</a> which is a web/cli application framework that support dependency injection out of box.</p>\n\n<p><a href=\"https://hiboot.hidevops.io/\" rel=\"nofollow noreferrer\">Docs</a></p>\n\n<pre><code>// HelloService is a simple service interface, with interface, we can mock a fake service in unit test\ntype HelloService interface {\n    SayHello(name string) string\n}\n\ntype helloServiceImpl struct {\n}\n\nfunc init() {\n    // Register Rest Controller through constructor newHelloController\n    // Register Service through constructor newHelloService\n    app.Register(newHelloController, newHelloService)\n}\n\n// please note that the return type name of the constructor HelloService,\n// hiboot will instantiate a instance named helloService for dependency injection\nfunc newHelloService() HelloService {\n    return &amp;helloServiceImpl{}\n}\n\n// SayHello is a service method implementation\nfunc (s *helloServiceImpl) SayHello(name string) string {\n    return \"Hello\" + name\n}\n\n// PATH: /login\ntype helloController struct {\n    web.Controller\n    helloService HelloService\n}\n\n// newHelloController inject helloService through the argument helloService HelloService on constructor\nfunc newHelloController(helloService HelloService) *helloController {\n    return &amp;helloController{\n        helloService: helloService,\n    }\n}\n\n// Get /\n// The first word of method name is the http method GET\nfunc (c *helloController) Get(name string) string {\n    return c.helloService.SayHello(name)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2604, "user_id": 3719087, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/4a64a26b5a55dd3847f888ce68da53f3?s=128&d=identicon&r=PG", "display_name": "Milad Rahimi", "link": "https://stackoverflow.com/users/3719087/milad-rahimi"}, "is_accepted": false, "score": 0, "last_activity_date": 1570048909, "creation_date": 1570048909, "answer_id": 58209078, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang/58209078#58209078", "title": "What is the best way to have dependency injection in Golang", "body": "<p>For an IoC container, you can try this package:\n<a href=\"https://github.com/golobby/container\" rel=\"nofollow noreferrer\">https://github.com/golobby/container</a></p>\n\n<p>Example of singleton binding:</p>\n\n<pre><code>container.Singleton(func() Database {\n  return &amp;MySQL{}\n})\n</code></pre>\n\n<p>Example of resolving:</p>\n\n<pre><code>var db Database\ncontainer.Make(&amp;db)\n</code></pre>\n\n<p>As you can see it's so easy to work with.</p>\n"}], "owner": {"reputation": 382, "user_id": 1165236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e823b21c2c71249c8364f533716fed6?s=128&d=identicon&r=PG", "display_name": "Vincent", "link": "https://stackoverflow.com/users/1165236/vincent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5798, "favorite_count": 0, "answer_count": 5, "score": 7, "last_activity_date": 1570048909, "creation_date": 1505054423, "last_edit_date": 1505162125, "question_id": 46141898, "link": "https://stackoverflow.com/questions/46141898/what-is-the-best-way-to-have-dependency-injection-in-golang", "title": "What is the best way to have dependency injection in Golang", "body": "<p>I'm a beginner in Golang and I'm working on a small library which need to get a DB connection at some point in the code for diff\u00e9rent sub package / method call. I'm just wondering how I can manage this ? </p>\n\n<p>Example, If I manage to have a webserver, it works with handler, so how can I get this connection inside this function ?\nIt could be used with another process, simple method call or MVC model ?</p>\n\n<p>I don't want to use global because for me it's a bad practice except if it's very exceptional way (or tricky somehow).</p>\n\n<p>I read a lot of write in different website, but still, I'm asking and learning from different opinion and experiences.</p>\n\n<p>Thanks for your time !</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 885, "user_id": 815929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/shXrb.jpg?s=128&g=1", "display_name": "iajnr", "link": "https://stackoverflow.com/users/815929/iajnr"}, "edited": false, "score": 0, "creation_date": 1514084780, "post_id": 46141487, "comment_id": 82884799, "body": "@eugenjoy in case of buffered channel why will the two slower goroutines not try to send their responses to the channel? There can be a case in which before one of the goroutine has sent its request, a response is received to this &quot;&lt;-responses&quot;"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 885, "user_id": 815929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/shXrb.jpg?s=128&g=1", "display_name": "iajnr", "link": "https://stackoverflow.com/users/815929/iajnr"}, "edited": false, "score": 0, "creation_date": 1514294046, "post_id": 46141487, "comment_id": 82926836, "body": "@rnjai : the slower goroutines will indeed try to send the responses to the channel. No one will actually read those responses, but that is not a problem cause the channel has a buffer size of 3, so responses can be accomodated in the buffer so the goroutines will not block."}, {"owner": {"reputation": 885, "user_id": 815929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/shXrb.jpg?s=128&g=1", "display_name": "iajnr", "link": "https://stackoverflow.com/users/815929/iajnr"}, "edited": false, "score": 0, "creation_date": 1514302950, "post_id": 46141487, "comment_id": 82929936, "body": "yes, @eugenioy the goroutines will definitely not block, but there will certainly be a scope of goroutine leak since sending to a channel without receiver leads to a leak - <a href=\"https://play.golang.org/p/vMKwqoACGfT\" rel=\"nofollow noreferrer\">play.golang.org/p/vMKwqoACGfT</a>"}, {"owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "reply_to_user": {"reputation": 885, "user_id": 815929, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/shXrb.jpg?s=128&g=1", "display_name": "iajnr", "link": "https://stackoverflow.com/users/815929/iajnr"}, "edited": false, "score": 0, "creation_date": 1514551870, "post_id": 46141487, "comment_id": 83014902, "body": "hi @rnjai, I don&#39;t think your test is correct.. try changing your cycle to run it 100 times and take a look at the output.. number of goroutines stay stable and does not grow over time: <a href=\"https://play.golang.org/p/2DwtFkey53l\" rel=\"nofollow noreferrer\">play.golang.org/p/2DwtFkey53l</a>"}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": false, "score": 4, "last_activity_date": 1505051725, "creation_date": 1505051725, "answer_id": 46141487, "question_id": 46141353, "link": "https://stackoverflow.com/questions/46141353/goroutine-leak-with-buffered-channel-in-go/46141487#46141487", "title": "goroutine leak with buffered channel in Go", "body": "<p>The code shown does not cause a leak.</p>\n\n<p>As the paragraph states:</p>\n\n<blockquote>\n  <p><em>Had we used</em> an unbuffered channel</p>\n</blockquote>\n\n<p>Meaning: <strong>if</strong> we had used an unbuffered channel...</p>\n\n<p>So only if the channel was unbuffered the leak would occur.</p>\n"}], "owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 577, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1505051725, "creation_date": 1505051001, "question_id": 46141353, "link": "https://stackoverflow.com/questions/46141353/goroutine-leak-with-buffered-channel-in-go", "title": "goroutine leak with buffered channel in Go", "body": "<p>Th following codes is in <strong>The Go Programming Language</strong></p>\n\n<pre><code>func mirroredQuery() string {\n    responses := make(chan string, 3)\n    go func() { responses &lt;- request(\"asia.gopl.io\") }()\n    go func() { responses &lt;- request(\"europe.gopl.io\") }()\n    go func() { responses &lt;- request(\"americas.gopl.io\") }()\n    return &lt;-responses // return the quickest response\n}\n\nfunc request(hostname string) (response string) { /* ... */ }\n</code></pre>\n\n<p>And book says </p>\n\n<blockquote>\n  <p>Had we used an unbuffered channel, the two slower\n  goroutines would have gotten stuck trying to send their responses\n  on a channel from which no goroutine will ever receive . This situation, called a goroutine leak, would be a bug . Unlike garbage\n  variables, leaked goroutines are not automatically collec ted, so\n  it is important to make sure that goroutines terminate themselves\n  when no longer needed.</p>\n</blockquote>\n\n<p><br/>\nAnd the <strong>question</strong> is why this situation will cause a <code>goroutine</code> leak.In my idea, the buffered channel's <code>cap</code> is 3, and 3 <code>goroutines</code> will send their requests and exit immediately which will not cause the leak.    </p>\n"}, {"tags": ["go", "linear-algebra"], "comments": [{"owner": {"reputation": 15372, "user_id": 7980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b42c59ffe8d671459604f0f32f7a30?s=128&d=identicon&r=PG", "display_name": "Alec Thomas", "link": "https://stackoverflow.com/users/7980/alec-thomas"}, "edited": false, "score": 0, "creation_date": 1505105928, "post_id": 46140741, "comment_id": 79258358, "body": "FYI <code>runtime.GOMAXPROCS(0)</code> will have <a href=\"https://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow noreferrer\">no effect</a>. I would use <code>runtime.GOMAXPROCS(runtime.NumCPU())</code>.  However, on more recent versions of Go this should already be the case. What version of Go are you running?"}, {"owner": {"reputation": 131, "user_id": 3358087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/czPrP.jpg?s=128&g=1", "display_name": "Tva\u1e63\u1e6d\u0101", "link": "https://stackoverflow.com/users/3358087/tva%e1%b9%a3%e1%b9%ad%c4%81"}, "reply_to_user": {"reputation": 15372, "user_id": 7980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65b42c59ffe8d671459604f0f32f7a30?s=128&d=identicon&r=PG", "display_name": "Alec Thomas", "link": "https://stackoverflow.com/users/7980/alec-thomas"}, "edited": false, "score": 0, "creation_date": 1505112382, "post_id": 46140741, "comment_id": 79260795, "body": "I&#39;m using 1.8. I have tried both the versions, with NumCPU and 0. Both do the same thing, and produce a picture similar to the one on the task manager screenshot."}], "answers": [{"tags": [], "owner": {"reputation": 67, "user_id": 290839, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6f9fc1ad38fed8b3f3075ac7c656e5e9?s=128&d=identicon&r=PG", "display_name": "gthomas", "link": "https://stackoverflow.com/users/290839/gthomas"}, "is_accepted": false, "score": 1, "last_activity_date": 1505052361, "creation_date": 1505052361, "answer_id": 46141602, "question_id": 46140741, "link": "https://stackoverflow.com/questions/46140741/parallel-saxpy-implementation-in-go-isnt-scaling-well-across-cores/46141602#46141602", "title": "Parallel saxpy implementation in Go isn&#39;t scaling well across cores", "body": "<p>I'd try a parallel version without channels, where each worker computes every 8th block, without coordination.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 3358087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/czPrP.jpg?s=128&g=1", "display_name": "Tva\u1e63\u1e6d\u0101", "link": "https://stackoverflow.com/users/3358087/tva%e1%b9%a3%e1%b9%ad%c4%81"}, "edited": false, "score": 0, "creation_date": 1505118987, "post_id": 46150989, "comment_id": 79264313, "body": "That&#39;s interesting behavior at 2e8. What I still don&#39;t understand though, is why are the two implementations behaving identically? Up until 4e5, i.e. between sizes 1e5 and 4e5, it performs much faster than the serial variant. Any insights on that?"}, {"owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "reply_to_user": {"reputation": 131, "user_id": 3358087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/czPrP.jpg?s=128&g=1", "display_name": "Tva\u1e63\u1e6d\u0101", "link": "https://stackoverflow.com/users/3358087/tva%e1%b9%a3%e1%b9%ad%c4%81"}, "edited": false, "score": 0, "creation_date": 1505121754, "post_id": 46150989, "comment_id": 79266111, "body": "I&#39;m guessing it&#39;s because synchronization has a cost. Up to a certain point the cost is not amortized. If you do a profile you will find that <code>runtime.futex</code> is where the code spends a lot of time in. FMA operations benefit from parallelism while what we&#39;re trying to do is to use the idea of concurrency to power parallelism. That comes with a cost."}, {"owner": {"reputation": 131, "user_id": 3358087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/czPrP.jpg?s=128&g=1", "display_name": "Tva\u1e63\u1e6d\u0101", "link": "https://stackoverflow.com/users/3358087/tva%e1%b9%a3%e1%b9%ad%c4%81"}, "edited": false, "score": 0, "creation_date": 1505130638, "post_id": 46150989, "comment_id": 79271598, "body": "Is synchronization cost still the case for the implementations not using the &#39;sendchan&#39; channel like in Edits 1 and 2?"}], "tags": [], "owner": {"reputation": 168, "user_id": 3426066, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3e45c02f2ae5f812a55c4975124da6b2?s=128&d=identicon&r=PG", "display_name": "Chewxy", "link": "https://stackoverflow.com/users/3426066/chewxy"}, "is_accepted": false, "score": 1, "last_activity_date": 1505118452, "last_edit_date": 1505118452, "creation_date": 1505117439, "answer_id": 46150989, "question_id": 46140741, "link": "https://stackoverflow.com/questions/46140741/parallel-saxpy-implementation-in-go-isnt-scaling-well-across-cores/46150989#46150989", "title": "Parallel saxpy implementation in Go isn&#39;t scaling well across cores", "body": "<p>FWIW, it works on linux: you can see where the <code>BlockedSaxpy</code> and <code>ParrSaxpy</code> is called.</p>\n\n<p>First you see one core being maximized - that's when <code>blocked_serial_saxpy</code> is called. Then you see all cores being used, but they use less CPU than a single core. That's when <code>blocked_parrallel_saxpy</code> is being called. <code>SIZE</code> is a random 5126</p>\n\n<p><a href=\"https://i.stack.imgur.com/0KAYY.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0KAYY.png\" alt=\"parrworks\"></a></p>\n\n<p>Here's a version that runs on <code>SIZE=2e06</code>. Again you can see all cores working in the latter benchmark. Now I think your function could be improved slightly, but I'll leave that as an exercise for when I'm not starving for dinner.\n<a href=\"https://i.stack.imgur.com/3Ibwz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/3Ibwz.png\" alt=\"SIZE=2e06\"></a></p>\n\n<p>With <code>SIZE=2e8</code>, we finally see this result:</p>\n\n<pre><code>go test -bench=. -benchtime=10s -cpuprofile=test.prof\nBenchmarkBlockedSaxpy-8           20     662405409 ns/op\nBenchmarkParrSaxpy-8              30     474503967 ns/op\n</code></pre>\n\n<p>Finally, three notes:</p>\n\n<ol>\n<li><code>saxpy</code> is for <code>float32</code>. You mean <code>daxpy</code>, but I'm being pedantic. </li>\n<li>Additionally: gonum has great d/saxpy facilities.</li>\n<li>Just use <code>runtime.NumCPU()</code> instead of <code>runtime.GOMAXPROCS(runtime.NumCPU())</code>. </li>\n</ol>\n"}], "owner": {"reputation": 131, "user_id": 3358087, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/czPrP.jpg?s=128&g=1", "display_name": "Tva\u1e63\u1e6d\u0101", "link": "https://stackoverflow.com/users/3358087/tva%e1%b9%a3%e1%b9%ad%c4%81"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 651, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1505118452, "creation_date": 1505046878, "last_edit_date": 1505115745, "question_id": 46140741, "link": "https://stackoverflow.com/questions/46140741/parallel-saxpy-implementation-in-go-isnt-scaling-well-across-cores", "title": "Parallel saxpy implementation in Go isn&#39;t scaling well across cores", "body": "<p>So I'm trying to implement an implementation of saxpy that is both blocked and can be computed in parallel using the 8-cores available on my machine. I started with the assumption that small sizes of the vectors x and y which fit into the L1 cache of my machine (split 256kB - 128kB data, 128kB code), can be computed in serial. To test this assumption, I wrote two implementations of saxpy, one which is a blocked serial version of saxpy (BSS) and a blocked parallel version of saxpy (BPS). The blocking algorithm is used only when the sizes of the vectors are larger than 4096 elements long. The following are the implementations:</p>\n\n<pre><code>const cachecap = 32*1024/8 // 4096\nfunc blocked_serial_saxpy(a float64, x []float64, incx int, b float64, y []float64, incy int, z []float64, incz int) {\n    zn := len(z)\n    //fmt.Println(\"zn: \", zn)\n    if zn &lt;= cachecap {\n        serial_saxpy(a, x, incx, b, y, incy, z, incz)\n        return\n    }\n\n    nblocks := zn/cachecap + 1\n    //fmt.Println(\"nblocks: \", nblocks)\n    for i := 0; i &lt; nblocks; i++ {\n        beg := i * cachecap\n        end := (i + 1) * cachecap\n        if end &gt;= zn {\n            end = zn\n        }\n        //fmt.Println(\"beg, end: \", beg, end)\n        xb := x[beg:end]\n        yb := y[beg:end]\n        zb := z[beg:end]\n        serial_saxpy(a, xb, incx, b, yb, incy, zb, incz)\n    }\n}\nfunc blocked_parallel_saxpy(a float64, x []float64, incx int, b float64, y []float64, incy int, z []float64, incz int) {\n    zn := len(z)\n    if zn &lt;= cachecap {\n        //fmt.Println(\"zn &lt;= cachecap: using serial_saxpy\")\n        serial_saxpy(a, x, incx, b, y, incy, z, incz)\n        return\n    }\n\n    nblocks := zn/cachecap + 1\n    //fmt.Println(\"nblocks: \", nblocks)\n    nworkers := runtime.GOMAXPROCS(0)\n    if nblocks &lt; nworkers {\n        nworkers = nblocks\n    }\n    //fmt.Println(\"nworkers: \", nworkers)\n\n    //buf := blockSize*nworkers\n    //if buf &gt; nblocks {\n    //  buf = nblocks\n    //}\n    //sendchan := make(chan block, buf)\n    sendchan := make(chan block, nblocks)\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; nworkers; i++ {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            a, b := a, b\n            incx, incy, incz := incx, incy, incz\n            for blk := range sendchan {\n                beg, end := blk.beg, blk.end\n                serial_saxpy(a, x[beg:end], incx, b, y[beg:end], incy, z[beg:end], incz)\n            }\n        }()\n    }\n\n    for i := 0; i &lt; nblocks; i++ {\n        beg := i * cachecap\n        end := (i + 1) * cachecap\n        if end &gt;= zn {\n            end = zn\n        }\n        //fmt.Println(\"beg:end\", beg, end)\n        sendchan &lt;- block{beg, end}\n    }\n    close(sendchan)\n    wg.Wait()\n}\n\nfunc serial_saxpy(a float64, x []float64, incx int, b float64, y []float64, incy int, z []float64, incz int) {\n    if incx &lt;= 0 || incy &lt;= 0 || incz &lt;= 0 {\n        panic(\"AxpBy: zero or negative increments not supported\")\n    }\n\n    n := len(z) / incz\n    if incx == 1 &amp;&amp; incy == 1 &amp;&amp; incz == 1 {\n        if a == 1 &amp;&amp; b == 1 {\n            for i := 0; i &lt; n; i++ {\n                z[i] = x[i] + y[i]\n            }\n            return\n        }\n\n        if a == 0 &amp;&amp; b == 1 {\n            copy(z, y)\n            //for i := 0; i &lt; n; i++ {\n            //  z[i] = y[i]\n            //}\n            return\n        }\n\n        if a == 1 &amp;&amp; b == 0 {\n            copy(z, x)\n            //for i := 0; i &lt; n; i++ {\n            //  z[i] = x[i]\n            //}\n            return\n        }\n\n        if a == 0 &amp;&amp; b == 0 {\n            return\n        }\n\n        for i := 0; i &lt; n; i++ {\n            z[i] = a*x[i] + b*y[i]\n        }\n        return\n    }\n\n    // unequal increments or equal increments != 1\n    ix, iy, iz := 0, 0, 0\n    if a == 1 &amp;&amp; b == 1 {\n        for i := 0; i &lt; n; i, ix, iy, iz = i+1, ix+incx, iy+incy, iz+incz {\n            z[iz] = x[ix] + y[iy]\n        }\n        return\n    }\n\n    if a == 0 &amp;&amp; b == 1 {\n        for i := 0; i &lt; n; i, ix, iy, iz = i+1, ix+incx, iy+incy, iz+incz {\n            z[iz] = y[iy]\n        }\n        return\n    }\n\n    if a == 1 &amp;&amp; b == 0 {\n        for i := 0; i &lt; n; i, ix, iy, iz = i+1, ix+incx, iy+incy, iz+incz {\n            z[iz] = x[ix]\n        }\n        return\n    }\n\n    if a == 0 &amp;&amp; b == 0 {\n        return\n    }\n\n    for i := 0; i &lt; n; i, ix, iy, iz = i+1, ix+incx, iy+incy, iz+incz {\n        z[iz] = a*x[ix] + b*y[iy]\n    }\n}\n</code></pre>\n\n<p>I then wrote benchmarks for the three functions blocked_serial_saxpy, blocked_parallel_saxpy and serial_saxpy. The following image shows the results of the benchmarks with vector sizes 1e3, 1e4, 1e5, 2e5, 3e5, 4e5, 6e5, 8e5 and 1e6 respectively:\n<a href=\"https://i.stack.imgur.com/BjIfE.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/BjIfE.png\" alt=\"Saxpy Benchmarks Part 1\"></a><a href=\"https://i.stack.imgur.com/wivX3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wivX3.png\" alt=\"Saxpy Benchmarks Part 2\"></a></p>\n\n<p>To help me visualize the performance of the blocked_parallel_saxpy implementation, I plotted the results and this is what I obtained:\n<a href=\"https://i.stack.imgur.com/UiVMt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UiVMt.png\" alt=\"Saxpy Performance Plot\"></a>\nLooking at the plot, makes me wonder, why am I not seeing a parallel speedup, when all the CPUs are being used and at 100% during the blocked_parallel_saxpy benchmark. The image from task manager is below:\n<a href=\"https://i.stack.imgur.com/XDDi9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/XDDi9.png\" alt=\"Saxpy CPU Usage\"></a></p>\n\n<p>Could someone help me understand what's going on here? Is what I'm seeing, symptom of a problem or the way it should be? If it's the former, is there a way to fix it?</p>\n\n<p><strong>Edit</strong>: I have modified the blocked_parallel_saxpy code to the following. I dividing the total no.of blocks (<em>nblocks</em>) such that there are <em>nworker</em> goroutines computing <em>nworker</em> no. of blocks, in parallel. In addition, I have removed the channel. I have benchmarked the code and it performs identically to the parallel implementation with the channel, hence why I haven't attached the benchmarks.</p>\n\n<pre><code>func blocked_parallel_saxpy(a float64, x []float64, incx int, b float64, y []float64, incy int, z []float64, incz int) {\n    zn := len(z)\n    if zn &lt;= cachecap {\n        serial_saxpy(a, x, incx, b, y, incy, z, incz)\n        return\n    }\n\n    nblocks := zn/cachecap + 1\n    nworkers := runtime.GOMAXPROCS(0)\n    if nblocks &lt; nworkers {\n        nworkers = nblocks\n    }\n\n    var wg sync.WaitGroup\n    for i := 0; i &lt; nworkers; i++ {\n        for j := 0; j &lt; nworkers &amp;&amp; (i+j) &lt; nblocks; j++ {\n            wg.Add(1)\n            go func(i, j int) {\n                defer wg.Done()\n                a, b := a, b\n                incx, incy, incz := incx, incy, incz\n                k := i + j\n                beg := k * cachecap\n                end := (k + 1) * cachecap\n                if end &gt;= zn {\n                    end = zn\n                }\n                serial_saxpy(a, x[beg:end], incx, b, y[beg:end], incy, z[beg:end], incz)\n            }(i, j)\n        }\n    wg.Wait()\n}\n</code></pre>\n\n<p><strong>Edit.2</strong>: I have written another version of the blocked_parallel_saxpy, again, without channels. This time, I spawn <em>NumCPU</em> goroutines, each processing <em>nblocks/nworkers + 1</em> blocks where each block is <em>cachecap</em> no. of elements in length. Even, here, the code performs identically to the previous two implementations.</p>\n\n<pre><code>func blocked_parallel_saxpy(a float64, x []float64, incx int, b float64, y []float64, incy int, z []float64, incz int) {\n    zn := len(z)\n    if zn &lt;= cachecap {\n        serial_saxpy(a, x, incx, b, y, incy, z, incz)\n        return\n    }\n\n    nblocks := zn/cachecap + 1\n    nworkers := runtime.GOMAXPROCS(runtime.NumCPU())\n    if nblocks &lt; nworkers {\n        nworkers = nblocks\n    }\n\n    k := nblocks/nworkers + 1\n    var wg sync.WaitGroup\n    wg.Add(nworkers)\n    for i := 0; i &lt; nworkers; i++ {\n        go func(i int) {\n            defer wg.Done()\n            for j := 0; j &lt; k &amp;&amp; (j+i*k) &lt; nblocks; j++ {\n                beg := (j + i*k) * cachecap\n                end := beg + cachecap\n                if end &gt; zn {\n                    end = zn\n                }\n                //fmt.Printf(\"i:%d, j:%d, k:%d, [beg:end]=[%d:%d]\\n\", i, j, k, beg, end)\n                serial_saxpy(a, x[beg:end], incx, b, y[beg:end], incy, z[beg:end], incz)\n            }\n        }(i)\n    }\n\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505046035, "post_id": 46140491, "comment_id": 79242902, "body": "You cannot put your code in GOROOT. See <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">How to Write Go Code</a>"}, {"owner": {"reputation": 560, "user_id": 3621898, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/afafb245f06a016d45d486db8f0cd277?s=128&d=identicon&r=PG&f=1", "display_name": "user3621898", "link": "https://stackoverflow.com/users/3621898/user3621898"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1505047684, "post_id": 46140491, "comment_id": 79243327, "body": "realized that, the video tutorial i followed put it there though, so I did the same"}], "answers": [{"tags": [], "owner": {"reputation": 560, "user_id": 3621898, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/afafb245f06a016d45d486db8f0cd277?s=128&d=identicon&r=PG&f=1", "display_name": "user3621898", "link": "https://stackoverflow.com/users/3621898/user3621898"}, "is_accepted": true, "score": 5, "last_activity_date": 1505046017, "creation_date": 1505046017, "answer_id": 46140635, "question_id": 46140491, "link": "https://stackoverflow.com/questions/46140491/non-standard-import-in-standard-package-windows/46140635#46140635", "title": "non-standard import in standard package windows", "body": "<p>moved my goprojects out of my GoRoot path and into a separate folder in C:\\goprojects and replaced my GoPath with the new path and it worked.</p>\n"}], "owner": {"reputation": 560, "user_id": 3621898, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/afafb245f06a016d45d486db8f0cd277?s=128&d=identicon&r=PG&f=1", "display_name": "user3621898", "link": "https://stackoverflow.com/users/3621898/user3621898"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2635, "favorite_count": 0, "accepted_answer_id": 46140635, "answer_count": 1, "score": 0, "last_activity_date": 1505046017, "creation_date": 1505044876, "last_edit_date": 1505045583, "question_id": 46140491, "link": "https://stackoverflow.com/questions/46140491/non-standard-import-in-standard-package-windows", "title": "non-standard import in standard package windows", "body": "<p>I can't seem to run my go code because of this error </p>\n\n<blockquote>\n  <p>non-standard import \"gopkg.in/olivere/elastic.v5\" in standard package \"goprojects/search\"</p>\n</blockquote>\n\n<p>Main.go is located at: C:\\Go\\src\\goprojects\\search\\main.go</p>\n\n<p>GOROOT is C:\\Go</p>\n\n<p>GOPATH is C:\\Go\\src\\goprojects (tried adding my current working directory here \\search, but didnt help)</p>\n\n<p>when I run \"go get gopkg.in/olivere/elastic.v5\" I get the imported files in C:\\Go\\src\\goprojects\\src\\gopkg.in\\olivere\\elastic.v5</p>\n\n<p>visual studio code is giving me this message</p>\n\n<blockquote>\n  <p>cannot find package \"go.pkg.in/olivere/elastic.v5\" in any of:</p>\n  \n  <p>C:\\Go\\src\\vendor\\gopkg.in\\olivere\\elastic.v5 (vendor tree)</p>\n  \n  <p>C:\\Go\\src\\gopkg.in\\olivere\\elastic.v5 (from $GOROOT)</p>\n  \n  <p>C:\\Go\\src\\goprojects\\src\\gopkg.in\\olivere\\elastic.v5 (from $GOPATH)</p>\n</blockquote>\n\n<p>my code</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    elastic \"gopkg.in/olivere/elastic.v5\"\n)\n\nfunc main() {\n    http.HandleFunc(\"/search\", search)\n    http.ListenAndServe(\":3000\", nil)\n}\n\nfunc search(w http.ResponseWriter, r *http.Request) {\n    searchString := r.URL.Query().Get(\"q\")\n    fmt.Println(\"Searching for\" + searchString)\n\n    // Create a client\n    client, err := elastic.NewClient()\n\n    w.Write([]byte(searchString))\n}\n</code></pre>\n"}, {"tags": ["python", "go"], "comments": [{"owner": {"reputation": 268354, "user_id": 4909087, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/LmD3e.png?s=128&g=1", "display_name": "cs95", "link": "https://stackoverflow.com/users/4909087/cs95"}, "edited": false, "score": 2, "creation_date": 1505035591, "post_id": 46139165, "comment_id": 79240153, "body": "So do you want it in Go or python?"}, {"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 1, "creation_date": 1505035814, "post_id": 46139165, "comment_id": 79240222, "body": "Python -- check <code>ctypes</code> or <code>struct.pack</code>, Golang -- use <code>encoding&#47;binary</code>"}], "answers": [{"tags": [], "owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "is_accepted": true, "score": 2, "last_activity_date": 1505036637, "creation_date": 1505036637, "answer_id": 46139311, "question_id": 46139165, "link": "https://stackoverflow.com/questions/46139165/how-to-write-struct-to-file-in-go-or-python/46139311#46139311", "title": "How to write struct to file in go or python?", "body": "<p>In Python you can use <code>ctypes</code> module which allows you to generate structures with similar layout as C does, and convert them to byte arrays:</p>\n\n<pre><code>import ctypes\n\nclass MyStruct(ctypes.Structure):\n    _fields_ = [('i', ctypes.c_int),\n                ('cha', ctypes.c_char)]\n\ns = MyStruct()\ns.i = 0\ns.cha = 'A'\n\nf.write(bytearray(s))\n</code></pre>\n\n<p>There is a simplest approach in Python with using <code>struct.pack</code> and manually provide a layout as first argument (<code>'ic'</code> means <code>int</code> followed by a char):</p>\n\n<pre><code>import struct \nf.write(struct.pack('ic', 0, 'A'))\n</code></pre>\n\n<p>Go can encode structs via <code>encoding/binary</code></p>\n\n<pre><code>type myStruct struct {\n    i int \n    cha byte\n}\n\ns := myStruct{i: 0, cha:'A'}\nbinary.Write(f, binary.LittleEndian, &amp;s)\n</code></pre>\n\n<p><strong>NOTE</strong>: You will be subject of differing structure <em>alignment</em>, <em>padding</em> and <em>endianness</em>, so if you want to build truly interoperable program, use special formats such as <a href=\"https://github.com/google/protobuf\" rel=\"nofollow noreferrer\">Google Protobuf</a></p>\n"}], "owner": {"reputation": 153, "user_id": 2909466, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/aZvTX.jpg?s=128&g=1", "display_name": "olivetree123", "link": "https://stackoverflow.com/users/2909466/olivetree123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1490, "favorite_count": 1, "accepted_answer_id": 46139311, "answer_count": 1, "score": 0, "last_activity_date": 1505036637, "creation_date": 1505035526, "question_id": 46139165, "link": "https://stackoverflow.com/questions/46139165/how-to-write-struct-to-file-in-go-or-python", "title": "How to write struct to file in go or python?", "body": "<p>In C/C++, we can write a struct to file like this:</p>\n\n<pre><code>#include &lt;stdio.h&gt;\nstruct mystruct\n{\n    int i;\n    char cha;\n};\n\nint main(void)\n{\n    FILE *stream;\n    struct mystruct s;\n    stream = fopen(\"TEST.$$$\", \"wb\"))\n    s.i = 0;\n    s.cha = 'A';\n    fwrite(&amp;s, sizeof(s), 1, stream); \n    fclose(stream); \n    return 0;\n}\n</code></pre>\n\n<p>But how to wirte a struct to file in go or python ? I want the data in struct are continuous.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 0, "creation_date": 1505033865, "post_id": 46138902, "comment_id": 79239791, "body": "Since <code>Accept()</code> is not a channel, but a regular function, you need goroutines to call <code>Accept()</code> simultaneously."}], "answers": [{"comments": [{"owner": {"reputation": 10796, "user_id": 1105249, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/083d54b8327a76a1dcf57df507ab7b34?s=128&d=identicon&r=PG", "display_name": "Luis Masuelli", "link": "https://stackoverflow.com/users/1105249/luis-masuelli"}, "edited": false, "score": 0, "creation_date": 1543354759, "post_id": 46141588, "comment_id": 93887018, "body": "With a version downloaded in 2018, I cannot declare anonymous goroutines like that."}], "tags": [], "owner": {"reputation": 10159, "user_id": 4907630, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b96aeab7486cd88da186e9c52eb7d7c7?s=128&d=identicon&r=PG&f=1", "display_name": "eugenioy", "link": "https://stackoverflow.com/users/4907630/eugenioy"}, "is_accepted": true, "score": 1, "last_activity_date": 1505052272, "creation_date": 1505052272, "answer_id": 46141588, "question_id": 46138902, "link": "https://stackoverflow.com/questions/46138902/can-we-use-select-to-accept-from-different-listeners-in-go/46141588#46141588", "title": "Can we use select to Accept() from different listeners in Go?", "body": "<p><code>select</code> only works with channels (see more here: <a href=\"https://gobyexample.com/select\" rel=\"nofollow noreferrer\">https://gobyexample.com/select</a>)</p>\n\n<p>In your case, you could span two goroutines so that each of them waits for the <code>Accept</code> of one listener and processes the connection:</p>\n\n<pre><code>go {\n    for {\n        conn, err := listener1.Accept():\n        if err != nil {\n            log.Fatal(err)\n        }\n        handleConn1(conn)\n    }\n}\ngo {\n    for {\n        conn, err := listener2.Accept():\n        if err != nil {\n            log.Fatal(err)\n        }\n        handleConn2(conn)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 7370105, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/28a1d625330e0446be0e39e901f8b5b1?s=128&d=identicon&r=PG&f=1", "display_name": "handora", "link": "https://stackoverflow.com/users/7370105/handora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 443, "favorite_count": 0, "accepted_answer_id": 46141588, "answer_count": 1, "score": -1, "last_activity_date": 1505052316, "creation_date": 1505033427, "last_edit_date": 1505052316, "question_id": 46138902, "link": "https://stackoverflow.com/questions/46138902/can-we-use-select-to-accept-from-different-listeners-in-go", "title": "Can we use select to Accept() from different listeners in Go?", "body": "<p>Just as the following codes:</p>\n\n<pre><code>for {\n    select {\n    case conn, err := listener1.Accept():\n        if err != nil {\n            log.Fatal(err)\n        }\n        go handleConn1(conn)\n    case conn, err := listener2.Accept():\n        if err != nil {\n            log.Fatal(err)\n        }\n        go handleConn1(conn)\n    }\n}\n</code></pre>\n\n<p>While the editor tells me something wrong with <code>select</code></p>\n\n<p>Can we implement something like this in <strong>Go</strong>?</p>\n"}, {"tags": ["go", "struct", "slice"], "answers": [{"tags": [], "owner": {"reputation": 14311, "user_id": 5085211, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/eEZjd.png?s=128&g=1", "display_name": "fuglede", "link": "https://stackoverflow.com/users/5085211/fuglede"}, "is_accepted": true, "score": 4, "last_activity_date": 1505030544, "creation_date": 1505030544, "answer_id": 46138561, "question_id": 46138439, "link": "https://stackoverflow.com/questions/46138439/how-use-object-of-struct-in-golang/46138561#46138561", "title": "How use object of []struct in golang", "body": "<p>You can't use hyphens in type declarations, and you probably want to unmarshal to <code>resp</code> instead of <code>resp.Data</code>; that is, you may want to do something like</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype jsoninput []struct {\n    Data string `json:\"data\"`\n}\n\nfunc main() {\n    resp := `[{\"data\":\"some data\"}, {\"data\":\"some more data\"}]`\n    data := &amp;jsoninput{}\n    _ = json.Unmarshal([]byte(resp), data)\n    for _, value := range *data {\n        fmt.Println(value.Data)  // Prints \"some data\" and \"some more data\"\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/giDsPzgHT_\" rel=\"nofollow noreferrer\">https://play.golang.org/p/giDsPzgHT_</a></p>\n"}], "owner": {"reputation": 25, "user_id": 7195914, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6293d1c7d48915947090703f55166a0f?s=128&d=identicon&r=PG&f=1", "display_name": "Vladislav", "link": "https://stackoverflow.com/users/7195914/vladislav"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2313, "favorite_count": 0, "accepted_answer_id": 46138561, "answer_count": 1, "score": 2, "last_activity_date": 1505030544, "creation_date": 1505029514, "last_edit_date": 1505029875, "question_id": 46138439, "link": "https://stackoverflow.com/questions/46138439/how-use-object-of-struct-in-golang", "title": "How use object of []struct in golang", "body": "<p>I defined struct like:</p>\n\n<pre><code>type json-input []struct {\n    Data    string  `json:\"data\"`\n}\n</code></pre>\n\n<p>that Unmarshal json string like </p>\n\n<blockquote>\n  <p>[{\"data\":\"some data\"}, {\"data\":\"some data\"}]</p>\n</blockquote>\n\n<pre><code>data := &amp;json-input{}\n_ = json.Unmarshal([]byte(resp.Data), data)\n</code></pre>\n\n<p>How i can use object of this struct for turn of data</p>\n"}, {"tags": ["go", "thread-safety", "mutex"], "answers": [{"comments": [{"owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "edited": false, "score": 3, "creation_date": 1505031800, "post_id": 46138396, "comment_id": 79239285, "body": "Alternatively, <code>defer lock.Unlock()</code> just after <code>lock.Lock()</code> might be preferable, just in case anything inside the logic of <code>importantFunction</code> panics. That way the <code>Unlock</code> call is guaranteed to happen."}, {"owner": {"reputation": 1379, "user_id": 1040124, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96c11e2380a99bc5b13b1f6e778389ad?s=128&d=identicon&r=PG", "display_name": "Jens", "link": "https://stackoverflow.com/users/1040124/jens"}, "edited": false, "score": 0, "creation_date": 1559889522, "post_id": 46138396, "comment_id": 99567307, "body": "There is no guarantee that &quot;first&quot; will be printed before &quot;second&quot; as the first go routine may complete after the second. Although in this example it probably always will."}, {"owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 1, "creation_date": 1559994507, "post_id": 46138396, "comment_id": 99599626, "body": "Nobody promised order, just that they will be a second apart ;-)"}], "tags": [], "owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "is_accepted": false, "score": 13, "last_activity_date": 1505113908, "last_edit_date": 1505113908, "creation_date": 1505029181, "answer_id": 46138396, "question_id": 46138395, "link": "https://stackoverflow.com/questions/46138395/how-make-a-function-thread-safe-in-golang/46138396#46138396", "title": "How make a function thread safe in golang", "body": "<p>Easiest way is to use <code>sync.Mutex</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar lock sync.Mutex\n\nfunc main() {\n    go importantFunction(\"first\")\n    go importantFunction(\"second\")\n    time.Sleep(3 * time.Second)\n}\n\n\nfunc importantFunction(name string) {\n    lock.Lock()\n    defer lock.Unlock()\n    fmt.Println(name)\n    time.Sleep(1 * time.Second)\n}\n</code></pre>\n\n<p>Here you'll see that \"first\" and \"second\" is printed one second apart even though they are go routines.</p>\n\n<p>Go playground: <a href=\"https://play.golang.org/p/mXKl42zRW8\" rel=\"noreferrer\">https://play.golang.org/p/mXKl42zRW8</a></p>\n"}, {"comments": [{"owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 0, "creation_date": 1505201236, "post_id": 46138822, "comment_id": 79302755, "body": "I think you&#39;re right that this doesn&#39;t solve my problem since the result of the function is important to me (the reply from the serial line) and if I used a channel I couldn&#39;t be sure which request the two-way channel was responding to. But this <i>does</i> feel like the more idiomatic way of doing it in go so I appreciate you adding it :-)"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1505219236, "post_id": 46138822, "comment_id": 79314902, "body": "Just for completeness, your <code>main()</code> should have <code>close(opChan)</code> at the end. It would then be better to remove the sleep and make the second goroutine not a new goroutine (i.e. part of main&#39;s instead). Then termination would happen cleanly."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1505219667, "post_id": 46138822, "comment_id": 79315209, "body": "Pylinux, there is a good case for suggesting that this answer is the <i>more</i> idiomatic solution. It follows the Go recommendation  &#39;do not communicate by sharing memory, but share memory by communicating&#39;. In this case, the shared entity is within the serial device. Both approaches will of course work; the mutex is likely to be faster. But the channel approach fits better into any larger-scale network because CSP channels and goroutines can be composed into bigger aggregations quite easily."}, {"owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "reply_to_user": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1505219856, "post_id": 46138822, "comment_id": 79315341, "body": "Thanks @Rick-777. You&#39;re right that the example as a whole isn&#39;t complete in that it lacks a robust and idiomatic shut-down mechanism. Adding a <code>close(opChan)</code> at the end in its current state is racy and can theoretically lead to a panic, though. And putting the <code>serialLoop()</code> call in the main goroutine would prevent the program from exiting. I&#39;ll see if I can create a more complete example without hiding relevant parts in too much surrounding setup/teardown logic."}, {"owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "reply_to_user": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 0, "creation_date": 1505239554, "post_id": 46138822, "comment_id": 79328496, "body": "@Pylinux, yes, returning results is an advantage of the mutex approach. Nevertheless, I added an example of how results can be managed while still using channels. I also adjusted the main example as mentioned in the comment above."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1505299169, "post_id": 46138822, "comment_id": 79352915, "body": "Waiting for child goroutines is a bit tiresome in Go, so I wrote a small wrapper to make this easier (<a href=\"https://github.com/rickb777/process\" rel=\"nofollow noreferrer\">github.com/rickb777/process</a> -  shameless plug!), which contains the mutex code similar to the above."}, {"owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "edited": false, "score": 0, "creation_date": 1505311189, "post_id": 46138822, "comment_id": 79361760, "body": "Is there a reason for <code>close(opChan)</code> not being able to be called with <code>defer close(opChan)</code>. Doesn&#39;t <code>defer</code> work with <code>waitGroup</code>?"}, {"owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "edited": false, "score": 1, "creation_date": 1505313744, "post_id": 46138822, "comment_id": 79363654, "body": "You can do <code>defer close(opChan)</code> as long as you know with certainty that <code>wg.Wait()</code> has run before it is called. Otherwise you might have producer goroutines still trying to write to the channel, which will lead to a panic if it is closed. So you haven&#39;t really added any safety unless you also handle <code>Wait</code> the same way. But then you also need to make sure there is an equal amount of <code>Done</code> calls to the total of the <code>Add</code> calls, or <code>Wait</code> will deadlock in the deferred call. So all-in-all, I&#39;m not sure how much it will help you in terms of achieving code correctness."}], "tags": [], "owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "is_accepted": false, "score": 4, "last_activity_date": 1505239330, "last_edit_date": 1505239330, "creation_date": 1505032776, "answer_id": 46138822, "question_id": 46138395, "link": "https://stackoverflow.com/questions/46138395/how-make-a-function-thread-safe-in-golang/46138822#46138822", "title": "How make a function thread safe in golang", "body": "<p>Pylinux's solution using a Mutex is, like he says, probably the simplest in your case. I'll add another one here as an alternative, though. It may or may not apply in your case.</p>\n\n<p>Instead of using a Mutex, you could have a single goroutine perform all the operations on the serial interface, and use a channel to serialise the work it needs to perform. <a href=\"https://play.golang.org/p/osCL6m9Lzo\" rel=\"nofollow noreferrer\">Example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\n// handleCommands will handle commands in a serialized fashion\nfunc handleCommands(opChan &lt;-chan string) {\n    for op := range opChan {\n        fmt.Printf(\"command: %s\\n\", op)\n    }\n}\n\n// produceCommands will generate multiple commands concurrently\nfunc produceCommands(opChan chan&lt;- string) {\n    var wg sync.WaitGroup\n    wg.Add(2)\n    go func() { opChan &lt;- \"cmd1\"; wg.Done() }()\n    go func() { opChan &lt;- \"cmd2\"; wg.Done() }()\n    wg.Wait()\n    close(opChan)\n}\n\nfunc main() {\n    var opChan = make(chan string)\n    go produceCommands(opChan)\n    handleCommands(opChan)\n}\n</code></pre>\n\n<p>The advantage of this relative to a Mutex is that you have more control over the wait queue. With the Mutex, the queue exists implicitly at <code>Lock()</code>, and is unbounded. Using a channel, on the other hand, you can limit the maximum number of callers waiting and react appropriately if the synchronised call site is overloaded. You can also do things like checking how many goroutines are in the queue with <code>len(opChan)</code>.</p>\n\n<p><strong>Edit to add:</strong></p>\n\n<p>A limitation with the above example (as noted in the comments) is that it doesn't handle returning results from the computation back to the original sender. One way to do that, while keeping the approach of using channels, is to introduce a result channel for each command. So instead of sending strings over the command channel, one can send structs of the following format:</p>\n\n<pre><code>type operation struct {\n    command string\n    result  chan string\n}\n</code></pre>\n\n<p>Commands would be enqueued onto the command channel as follows:</p>\n\n<pre><code>func enqueueCommand(opChan chan&lt;- operation, cmd string) &lt;-chan string {\n    var result = make(chan string)\n    opChan &lt;- operation{command: cmd, result: result}\n    return result\n}\n</code></pre>\n\n<p>This allows the command handler to send a value back to the originator of the command. Full example on the playground <a href=\"https://play.golang.org/p/2fUgNqr5Ls\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 7623, "user_id": 1505860, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/168ccec72eee0530b818d44f3fedaacf?s=128&d=identicon&r=PG", "display_name": "Shlomi Noach", "link": "https://stackoverflow.com/users/1505860/shlomi-noach"}, "is_accepted": false, "score": 3, "last_activity_date": 1515220101, "creation_date": 1515220101, "answer_id": 48124886, "question_id": 46138395, "link": "https://stackoverflow.com/questions/46138395/how-make-a-function-thread-safe-in-golang/48124886#48124886", "title": "How make a function thread safe in golang", "body": "<p>There are two approaches to implementing non-reentrant functions:</p>\n\n<ul>\n<li>Blocking: first caller runs the function, subsequent caller(s) block and wait till function exits, then run the function</li>\n<li>Yielding: first caller runs the function, subsequent caller(s) abort while function is being executed</li>\n</ul>\n\n<p>The two approaches have different merits:</p>\n\n<ul>\n<li>Blocking non-reentrant functions are guaranteed to execute as many times as were attempted. However, they can be a backlog in case of long execution times, then bursts of executions following.</li>\n<li>Yielding non-reentrant functions guarantee non congestion and no bursts, and can guarantee a maximum of execution rate.</li>\n</ul>\n\n<p>Blocking non-reentrant functions are most easily implemented via <code>mutex</code>, as described in @Pylinux's answer.\nYielding non-reentrant functions can be implemented via atomic compare &amp; swap, as follows:</p>\n\n<pre><code>import (\n    \"sync/atomic\"\n    \"time\"\n)\n\nfunc main() {\n    tick := time.Tick(time.Second)\n    var reentranceFlag int64\n    go func() {\n        for range tick {\n            go CheckSomeStatus()\n            go func() {\n                if atomic.CompareAndSwapInt64(&amp;reentranceFlag, 0, 1) {\n                    defer atomic.StoreInt64(&amp;reentranceFlag, 0)\n                } else {\n                    return\n                }\n                CheckAnotherStatus()\n            }()\n        }\n    }()\n}\n</code></pre>\n\n<p>In the above, <code>CheckAnotherStatus()</code> is protected against re-entry such that the first caller sets <code>reentranceFlag</code> to <code>1</code>, and subsequent callers fail to do the same, and quit.</p>\n\n<p>Please consider my blog post, <a href=\"http://code.openark.org/blog/golang/implementing-non-re-entrant-functions-in-golang\" rel=\"nofollow noreferrer\">Implementing non re-entrant functions in Golang</a> for a more elaborate discussion.</p>\n"}], "owner": {"reputation": 9266, "user_id": 1465640, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/b64a91edcfaad3c6290039008deea285?s=128&d=identicon&r=PG", "display_name": "Pylinux", "link": "https://stackoverflow.com/users/1465640/pylinux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10870, "favorite_count": 0, "answer_count": 3, "score": 11, "last_activity_date": 1515220101, "creation_date": 1505029181, "question_id": 46138395, "link": "https://stackoverflow.com/questions/46138395/how-make-a-function-thread-safe-in-golang", "title": "How make a function thread safe in golang", "body": "<p>How to lock a function or the body of a function from being called by two threads in golang?</p>\n\n<p>My use case is that I have a webserver that is calling a serial interface which can only have one caller at a time, two calls will cancel each other out by creating noise for one another on the serial line.</p>\n"}, {"tags": ["go", "charts", "terminal"], "comments": [{"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1505030146, "post_id": 46138068, "comment_id": 79238863, "body": "Works for me. What terminal are you using?"}, {"owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "reply_to_user": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1505033829, "post_id": 46138068, "comment_id": 79239782, "body": "@akond - And you get an actual chart in the terminal? I&#39;m on OSX with Go 1.9. I tried it using <code>go run main.go</code> and <code>go build main.go &amp;&amp; .&#47;main</code>, but with both I get no output. What setup are you on? Do you have any idea how I can debug this?"}, {"owner": {"reputation": 14788, "user_id": 290339, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65572a7a674b480d45f048cdce08e841?s=128&d=identicon&r=PG", "display_name": "akond", "link": "https://stackoverflow.com/users/290339/akond"}, "edited": false, "score": 0, "creation_date": 1505034404, "post_id": 46138068, "comment_id": 79239910, "body": "I&#39;ve tried both windows and linux (centos). Both produce some result."}, {"owner": {"reputation": 2624, "user_id": 3310285, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FaFcy.png?s=128&g=1", "display_name": "Alex Efimov", "link": "https://stackoverflow.com/users/3310285/alex-efimov"}, "edited": false, "score": 0, "creation_date": 1505057822, "post_id": 46138068, "comment_id": 79246648, "body": "Tried on the same setup as you and it works."}], "owner": {"reputation": 38454, "user_id": 1650012, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/a21bc05bb7df4e5c3cb4933e4f3072eb?s=128&d=identicon&r=PG", "display_name": "kramer65", "link": "https://stackoverflow.com/users/1650012/kramer65"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 52, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1505026377, "creation_date": 1505026377, "question_id": 46138068, "link": "https://stackoverflow.com/questions/46138068/how-to-draw-chart-with-goterm", "title": "How to draw chart with goterm?", "body": "<p>I want to draw a simple chart in the terminal using Go for which I'm trying to use <a href=\"https://github.com/buger/goterm\" rel=\"nofollow noreferrer\">goterm</a>. When I run the example code below (<a href=\"https://github.com/buger/goterm/blob/master/examples/chart_example.go\" rel=\"nofollow noreferrer\">from here</a>) my program finishes without any output. Does anybody know what I might be doing wrong?</p>\n\n<pre><code>package main\n\nimport (\n    tm \"github.com/buger/goterm\"\n    \"math\"\n)\n\nfunc main() {\n    tm.Clear()\n    tm.MoveCursor(0, 0)\n\n    chart := tm.NewLineChart(100, 20)\n    data := new(tm.DataTable)\n    data.AddColumn(\"Time\")\n    data.AddColumn(\"Sin(x)\")\n    data.AddColumn(\"Cos(x+1)\")\n\n    for i := 0.1; i &lt; 10; i += 0.1 {\n        data.AddRow(i, math.Sin(i), math.Cos(i+1))\n    }\n\n    tm.Println(chart.Draw(data))\n    tm.Flush()\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": true, "score": 1, "last_activity_date": 1505023590, "creation_date": 1505023590, "answer_id": 46137763, "question_id": 46137490, "link": "https://stackoverflow.com/questions/46137490/install-go-package-with-dependencies/46137763#46137763", "title": "Install go package with dependencies", "body": "<p>Check out the <a href=\"https://github.com/adibendahan/mysqlbeat#how-to-build\" rel=\"nofollow noreferrer\">How to Build</a> section on <code>README.md</code> on <code>mysqlbeat</code>.</p>\n\n<p><code>mysqlbeat</code> uses Glide for dependency management. <a href=\"https://github.com/Masterminds/glide\" rel=\"nofollow noreferrer\">Check this for installing glide</a>. </p>\n\n<p>After installing Glide, clone the <code>mysqlbeat</code> repository and run:</p>\n\n<pre><code>$ glide update --no-recursive\n$ make\n</code></pre>\n\n<p>If you still want to import this repository by <code>go get</code>, clone the repo and then run <code>go get ./...</code> from its root directory.</p>\n"}], "owner": {"reputation": 27466, "user_id": 139150, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/7064369714bbb01ca2e42c699f95d60d?s=128&d=identicon&r=PG", "display_name": "shantanuo", "link": "https://stackoverflow.com/users/139150/shantanuo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 606, "favorite_count": 1, "accepted_answer_id": 46137763, "answer_count": 1, "score": 1, "last_activity_date": 1505028935, "creation_date": 1505020188, "last_edit_date": 1505028935, "question_id": 46137490, "link": "https://stackoverflow.com/questions/46137490/install-go-package-with-dependencies", "title": "Install go package with dependencies", "body": "<p>I had some issues with gopath configuration. I was able to resolve the go path issue. But getting this error...</p>\n\n<pre><code>[root@localhost mysqlbeat]# go get  github.com/adibendahan/mysqlbeat\n\n# github.com/adibendahan/mysqlbeat/beater\n/root/go/src/src/github.com/adibendahan/mysqlbeat/beater/mysqlbeat.go:289:7: b.Events undefined (type *beat.Beat has no field or method Events)\n/root/go/src/src/github.com/adibendahan/mysqlbeat/beater/mysqlbeat.go:303:7: b.Events undefined (type *beat.Beat has no field or method Events)\n/root/go/src/src/github.com/adibendahan/mysqlbeat/beater/mysqlbeat.go:326:5: b.Events undefined (type *beat.Beat has no field or method Events)\n</code></pre>\n\n<p>How do I correctly install go package along with all it's dependencies?</p>\n\n<hr>\n\n<p>Update:</p>\n\n<p>I downloaded the package and tried to run it.Different error this time...</p>\n\n<pre><code>[root@localhost mysqlbeat]# make\ngo build\ncan't load package: /root/go/src/src/github.com/adibendahan/mysqlbeat/main.go:8:2: non-standard import \"github.com/adibendahan/mysqlbeat/beater\" in standard package \"src/github.com/adibendahan/mysqlbeat\"\nmake: *** [build] Error 1\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 178, "user_id": 3423772, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/dsDgC.png?s=128&g=1", "display_name": "tim", "link": "https://stackoverflow.com/users/3423772/tim"}, "edited": false, "score": 0, "creation_date": 1505016829, "post_id": 46137152, "comment_id": 79236645, "body": "Well, that&#39;ll do it. Thank you!"}, {"owner": {"reputation": 178, "user_id": 3423772, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/dsDgC.png?s=128&g=1", "display_name": "tim", "link": "https://stackoverflow.com/users/3423772/tim"}, "edited": false, "score": 0, "creation_date": 1505020239, "post_id": 46137152, "comment_id": 79237101, "body": "I&#39;ve updated my code, but I&#39;m still having a little trouble. When the value of <code>k</code> is set to 2 through 6, it seems to work, but when it&#39;s set to 1, the <code>result</code> is set to 0, when it should be 1. When it&#39;s set to 7 the <code>result</code> is 3 and setting it higher than 7, the execution times out. Am I just totally over looking an error in my logic?"}, {"owner": {"reputation": 178, "user_id": 3423772, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/dsDgC.png?s=128&g=1", "display_name": "tim", "link": "https://stackoverflow.com/users/3423772/tim"}, "edited": false, "score": 0, "creation_date": 1505059165, "post_id": 46137152, "comment_id": 79247052, "body": "I figured it out. Thanks again."}], "tags": [], "owner": {"reputation": 609, "user_id": 550866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba271a060d9d82ac8783cd9165f83d2a?s=128&d=identicon&r=PG", "display_name": "Henry Finucane", "link": "https://stackoverflow.com/users/550866/henry-finucane"}, "is_accepted": true, "score": 3, "last_activity_date": 1505015775, "creation_date": 1505015775, "answer_id": 46137152, "question_id": 46137083, "link": "https://stackoverflow.com/questions/46137083/kth-highest-of-two-sorted-arrays/46137152#46137152", "title": "k&#39;th highest of two sorted arrays", "body": "<p><a href=\"http://www.fileformat.info/info/unicode/char/2013/index.htm\" rel=\"nofollow noreferrer\">U+2013</a> (or '\u2013') is a fancy version of '-' (or <a href=\"http://www.fileformat.info/info/unicode/char/002d/index.htm\" rel=\"nofollow noreferrer\">U+2d</a>) for people who are big into typography. If you type a dash on your keyboard, you'll get the right character, if you copied something in from a web site, a word processor, or an email, it might have been 'helpfully' replaced along with way with the wrong dash, which Go doesn't understand. This also happens a lot with the double-quote character.</p>\n\n<p>You should be able to search and replace the fancy dash in your text editor or IDE.</p>\n"}], "owner": {"reputation": 178, "user_id": 3423772, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/dsDgC.png?s=128&g=1", "display_name": "tim", "link": "https://stackoverflow.com/users/3423772/tim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 315, "favorite_count": 0, "accepted_answer_id": 46137152, "answer_count": 1, "score": 0, "last_activity_date": 1505077988, "creation_date": 1505014774, "last_edit_date": 1505077988, "question_id": 46137083, "link": "https://stackoverflow.com/questions/46137083/kth-highest-of-two-sorted-arrays", "title": "k&#39;th highest of two sorted arrays", "body": "<p>I'm new to Go and I'm running into what I'm sure are beginner errors. I'm getting an error <code>invalid identifier character U+2013</code> seemingly everywhere I'm subtracting. Am I some how not using the arithmetic operator properly? I'm also getting the errors <code>unexpected name, expecting semicolon or newline or }</code> and <code>non-declaration statement outside function body</code> but I'm not too sure what's causing it. It mainly seems like the issue is within my if statements above the for loop. I thought it was because I'm reassigning already declared variables, but that doesn't seem to be the case. Any help would be much appreciated and if anyone has some tips in general for debugging Go that would be great too.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n\nfunc main() {\n    a := []int{\n        13, 14, 15, 16, 17,\n    }\n\n    b := []int{\n        1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12,\n    }\n\n    k := 8\n\n    result := kthSmallest(a, b, k)\n    fmt.Printf(\"%v\", result)\n\n}\n\nfunc kthSmallest(a []int, b []int, k int) int {\n    if k &gt;= len(a) + len(b) {\n       fmt.Printf(\"The range is not large enough\")\n       return 0\n    }\n\n    var lowA, lowB, highA, highB int = 0, 0, k - 1, k - 1\n\n    if len(a) &lt; k - 1 {\n        highA = len(a) - 1;\n    }\n\n    if len(b) &lt; k - 1 {\n        highB = len(b) - 1;\n    }\n\n    if highA + highB &lt; k {\n        return 0;\n    }\n\n    var midA, midB int = 0, 0\n    var result int = 0\n\n    for k &gt; 0 {\n        midA = lowA + (highA - lowA)/2;\n        midB = lowB + (highB - lowB)/2;\n\n        if a[midA] &gt;= b[midB] {\n\n            k = k - (midB - lowB + 1);\n            result = b[midB];\n            highA = midA - 1;\n            lowB = midB + 1;\n\n        } else if a[midA] &lt; b[midB] {\n\n            k = k - (midA - lowA + 1);\n            result = a[midA];\n            highB = midB - 1;\n            lowA = midA + 1;\n\n        }\n\n    }\n\n\n    return result\n}\n</code></pre>\n"}, {"tags": ["go", "floating-point"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1505020107, "post_id": 46136886, "comment_id": 79237090, "body": "What is the &quot;last binary digit&quot; of a real number? Can you give some examples?"}, {"owner": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1505029266, "post_id": 46136886, "comment_id": 79238664, "body": "@PaulHankin I am trying to replicate the behavior of another system and that is the only description I have of how that system handles comparisons. But in my test case your <code>almostEqual</code> gives the same result, I will accept it in a while after others have had a chance to respond. Thanks."}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 2, "last_activity_date": 1505021792, "creation_date": 1505021792, "answer_id": 46137614, "question_id": 46136886, "link": "https://stackoverflow.com/questions/46136886/comparing-floats-by-ignoring-last-bit-in-golang/46137614#46137614", "title": "Comparing floats by ignoring last bit in golang", "body": "<p>If you want to know if two <code>float64</code> values are adjacent (that is, there's no <code>float64</code> value between them):</p>\n\n<pre><code>func almostEqual(a, b float64) bool {\n    ai, bi := int64(math.Float64bits(a)), int64(math.Float64bits(b))\n    return a == b || -1 &lt;= ai-bi &amp;&amp; ai-bi &lt;= 1\n}\n</code></pre>\n\n<p>Mostly that's the same as saying they differ in the lowest bit of their mantissa.</p>\n\n<p>This code doesn't work if <code>a</code> or <code>b</code> are NaNs, zeros or infinities, but you could add special cases if you wished.</p>\n\n<p>See <a href=\"https://randomascii.wordpress.com/2012/01/23/stupid-float-tricks-2/\" rel=\"nofollow noreferrer\">https://randomascii.wordpress.com/2012/01/23/stupid-float-tricks-2/</a></p>\n"}, {"tags": [], "owner": {"reputation": 7118, "user_id": 4283005, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/N0m1E.png?s=128&g=1", "display_name": "dev.bmax", "link": "https://stackoverflow.com/users/4283005/dev-bmax"}, "is_accepted": false, "score": 4, "last_activity_date": 1505035211, "last_edit_date": 1505035211, "creation_date": 1505033676, "answer_id": 46138942, "question_id": 46136886, "link": "https://stackoverflow.com/questions/46136886/comparing-floats-by-ignoring-last-bit-in-golang/46138942#46138942", "title": "Comparing floats by ignoring last bit in golang", "body": "<p>This looks like a perfect use case for the following function from the math package:</p>\n\n<pre><code>func equal(x, y float64) bool {\n    return math.Nextafter(x, y) == y\n}\n</code></pre>\n\n<blockquote>\n  <p>Nextafter returns the next representable float64 value after x towards y.\n  <br><br>Special cases are:\n  <br>Nextafter(x, x)   = x\n  <br>Nextafter(NaN, y) = NaN\n  <br>Nextafter(x, NaN) = NaN</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/unRkkoe6wb\" rel=\"nofollow noreferrer\">https://play.golang.org/p/unRkkoe6wb</a></p>\n"}], "owner": {"reputation": 9116, "user_id": 395258, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/613cdeb318951f568212eaaf9bec19e7?s=128&d=identicon&r=PG", "display_name": "C. E.", "link": "https://stackoverflow.com/users/395258/c-e"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1075, "favorite_count": 0, "accepted_answer_id": 46137614, "answer_count": 2, "score": 0, "last_activity_date": 1505035211, "creation_date": 1505012307, "question_id": 46136886, "link": "https://stackoverflow.com/questions/46136886/comparing-floats-by-ignoring-last-bit-in-golang", "title": "Comparing floats by ignoring last bit in golang", "body": "<p>A specification reads as follows:</p>\n\n<blockquote>\n  <p>It still considers real numbers equal if they differ in their last\n  binary digit.</p>\n</blockquote>\n\n<p>I would like to implement this way of comparing floats for the float64 data type in Go. Unfortunately, the bitwise operators aren't defined for floating point numbers. Is there a way to achieve this way of comparing floats in the Go language?</p>\n"}, {"tags": ["postgresql", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": true, "score": 0, "last_activity_date": 1505045657, "creation_date": 1505045657, "answer_id": 46140591, "question_id": 46136500, "link": "https://stackoverflow.com/questions/46136500/foreign-key-not-created-with-one-to-many-association/46140591#46140591", "title": "Foreign key not created with one to many association", "body": "<p>I had a similar issue, and it took me forever to figure it out. I believe the GORM documentation could definitely be better. Here's the relevant code snippet from the <a href=\"http://jinzhu.me/gorm/associations.html#has-many\" rel=\"nofollow noreferrer\">GORM site</a>:</p>\n\n<pre><code>//User has many emails, UserID is the foreign key\ntype User struct {\n    gorm.Model\n    Emails   []Email\n}\n\ntype Email struct {\n    gorm.Model\n    Email   string\n    UserID  uint\n}\n\ndb.Model(&amp;user).Related(&amp;emails)\n//// SELECT * FROM emails WHERE user_id = 111; // 111 is user's primary key\n</code></pre>\n\n<p>Why your code isn't working: </p>\n\n<ol>\n<li>First you need to add a TaskID field to your Runner struct.</li>\n<li><code>db.Model(&amp;Task{}).Related(&amp;Runner{})</code> doesn't do what you think it does. If you look at the code snippet from GORM, the SELECT comment kind of explains it (not very well though). The example is assuming that the <code>&amp;user</code> is already populated and has an ID of 111, then it fetches the emails storing them in <code>&amp;emails</code> that match the <code>UserID</code> of <code>&amp;user</code>. </li>\n</ol>\n"}], "owner": {"reputation": 964, "user_id": 3718337, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/3PP4r.jpg?s=128&g=1", "display_name": "Gurbakhshish Singh", "link": "https://stackoverflow.com/users/3718337/gurbakhshish-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1163, "favorite_count": 0, "accepted_answer_id": 46140591, "answer_count": 1, "score": 1, "last_activity_date": 1527757401, "creation_date": 1505006923, "last_edit_date": 1527757401, "question_id": 46136500, "link": "https://stackoverflow.com/questions/46136500/foreign-key-not-created-with-one-to-many-association", "title": "Foreign key not created with one to many association", "body": "<p>I have a <code>Task</code> type that has a list of <code>Runner</code> type objects in it. I am trying to map it to database using golang gorm but it doesn't have foreign key and i am getting <code>invalid association</code> during migration</p>\n\n<p>My Task struct:</p>\n\n<pre><code>type Task struct {\n    gorm.Model\n    Name        string `gorm:\"not null;unique_index\"`\n    Description string\n    Runners     []Runner\n}\n</code></pre>\n\n<p>My Runner struct:</p>\n\n<pre><code>type Runner struct {\n    gorm.Model\n    Name        string `gorm:\"not null;unique\"`\n    Description string\n}\n</code></pre>\n\n<p>My migration code:</p>\n\n<pre><code>func migrateSchema () (err error) {\n    db, err := context.DBProvider()\n\n    if err != nil {\n        return\n    }\n\n    db.Model(&amp;Task{}).Related(&amp;Runner{})\n    db.AutoMigrate(&amp;Task{})\n    db.AutoMigrate(&amp;Runner{})\n\n    return\n}\n</code></pre>\n\n<p>On <code>db.AutoMigrate(&amp;Task{})</code> I get <code>invalid association</code> message in console and when I check the database there is no foreign key created or no reference field created on <code>runners</code> table</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["json", "postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 5135, "user_id": 6207052, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SlsN4.jpg?s=128&g=1", "display_name": "putu", "link": "https://stackoverflow.com/users/6207052/putu"}, "is_accepted": true, "score": 2, "last_activity_date": 1505006246, "creation_date": 1505006246, "answer_id": 46136462, "question_id": 46135761, "link": "https://stackoverflow.com/questions/46135761/how-to-retrieve-the-keys-of-the-json-of-the-first-row-in-postgres-in-golang/46136462#46136462", "title": "How to retrieve the keys of the json of the first row in postgres in golang?", "body": "<p>Use <code>SELECT DISTINCT...</code>, i.e.</p>\n\n<pre><code>SELECT DISTINCT jsonb_object_keys(value) FROM mn_statistics_company;\n</code></pre>\n\n<p>See example at <a href=\"http://sqlfiddle.com/#!17/7a037/1/0\" rel=\"nofollow noreferrer\">SQLFiddle</a>.</p>\n"}], "owner": {"reputation": 543, "user_id": 7491660, "user_type": "registered", "accept_rate": 93, "profile_image": "https://lh5.googleusercontent.com/-cGWG7agUpXU/AAAAAAAAAAI/AAAAAAAAA3M/gXMwQQmKhIY/photo.jpg?sz=128", "display_name": "richard_d_sim", "link": "https://stackoverflow.com/users/7491660/richard-d-sim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 0, "accepted_answer_id": 46136462, "answer_count": 1, "score": 1, "last_activity_date": 1505006246, "creation_date": 1504997066, "question_id": 46135761, "link": "https://stackoverflow.com/questions/46135761/how-to-retrieve-the-keys-of-the-json-of-the-first-row-in-postgres-in-golang", "title": "How to retrieve the keys of the json of the first row in postgres in golang?", "body": "<p>I currently have a table like this</p>\n\n<pre><code>id | value\n----------\n1  | {\"key1\":\"value1\", \"test1\":\"value3\"}\n2  | {\"key1\":\"value2\", \"test1\":\"value4\"}\n</code></pre>\n\n<p>I would like this returned</p>\n\n<pre><code>key1, test1\n</code></pre>\n\n<p>The keys are the same in each row, but the number of keys may change.</p>\n\n<p>I tired using </p>\n\n<pre><code>SELECT jsonb_object_keys(value) FROM mn_statistics_company\n</code></pre>\n\n<p>however, that got me all the keys of all the json of that row\n    key1\n    test1\n    key1\n    test1</p>\n\n<p>and have tired </p>\n\n<pre><code>SELECT value FROM mn_statistics_company LIMIT 1\n</code></pre>\n\n<p>but that just returns the json with both the key and values.</p>\n\n<pre><code>{\"key1\":\"value1\", \"test1\":\"value3\"}\n</code></pre>\n"}, {"tags": ["c#", "xml", "go"], "comments": [{"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1505065796, "post_id": 46135167, "comment_id": 79249287, "body": "your implementation is probably the issue. You might want to unmarshal into defined data structures. See the example below.  <a href=\"https://play.golang.org/p/m99B12RaLe\" rel=\"nofollow noreferrer\">play.golang.org/p/m99B12RaLe</a>"}, {"owner": {"reputation": 7927, "user_id": 5214807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/aq31b.jpg?s=128&g=1", "display_name": "Saleem", "link": "https://stackoverflow.com/users/5214807/saleem"}, "edited": false, "score": 0, "creation_date": 1513171403, "post_id": 46135167, "comment_id": 82549100, "body": "Indeed it&#39;s issue with go sax parser.  I have tested it with 1GB xml file and came up with similar result as of OP."}], "answers": [{"tags": [], "owner": {"reputation": 135, "user_id": 7222662, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d4jMb.png?s=128&g=1", "display_name": "tsak", "link": "https://stackoverflow.com/users/7222662/tsak"}, "is_accepted": false, "score": 2, "last_activity_date": 1560337028, "creation_date": 1560337028, "answer_id": 56560528, "question_id": 46135167, "link": "https://stackoverflow.com/questions/46135167/standard-xml-parser-has-very-low-performance-in-golang/56560528#56560528", "title": "Standard xml parser has very low performance in Golang", "body": "<p>To answer your question <em>\"How can i improve xml parse performance using golang?\"</em></p>\n\n<p>Using the common <code>xml.NewDecoder</code> / <code>decoder.Token</code>, I was seeing 50 MB/s locally. By using <a href=\"https://github.com/tamerh/xml-stream-parser\" rel=\"nofollow noreferrer\">https://github.com/tamerh/xml-stream-parser</a> I was able to double the parse speed.</p>\n\n<p>To test I used <code>Posts.xml</code> (68 GB) from the <a href=\"https://archive.org/details/stackexchange\" rel=\"nofollow noreferrer\">https://archive.org/details/stackexchange</a> archive torrent.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"github.com/tamerh/xml-stream-parser\"\n    \"os\"\n    \"time\"\n)\n\nfunc main() {\n    // Using `Posts.xml` (68 GB) from https://archive.org/details/stackexchange (in the torrent)\n    f, err := os.Open(\"Posts.xml\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n\n    br := bufio.NewReaderSize(f, 1024*1024)\n    parser := xmlparser.NewXmlParser(br, \"row\")\n\n    started := time.Now()\n    var previous int64 = 0\n\n    for x := range *parser.Stream() {\n        elapsed := int64(time.Since(started).Seconds())\n        if elapsed &gt; previous {\n            kBytesPerSecond := int64(parser.TotalReadSize) / elapsed / 1024\n            fmt.Printf(\"\\r%ds elapsed, read %d kB/s (last post.Id %s)\", elapsed, kBytesPerSecond, x.Attrs[\"Id\"])\n            previous = elapsed\n        }\n    }\n}\n</code></pre>\n\n<p>This will output something along the line of:</p>\n\n<pre><code>...s elapsed, read ... kB/s (last post.Id ...)\n</code></pre>\n\n<p>Only caveat is that this does not give you the convenient unmarshal into struct.</p>\n\n<p>As discussed in <a href=\"https://github.com/golang/go/issues/21823\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/21823</a>, speed seems to be general problem with the XML implementation in Golang and would require a rewrite / rethink of that part of the standard library.</p>\n"}, {"tags": [], "owner": {"reputation": 1538, "user_id": 950582, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b86ceedfd1a20319af8af6413aaf703d?s=128&d=identicon&r=PG", "display_name": "Goodwine", "link": "https://stackoverflow.com/users/950582/goodwine"}, "is_accepted": false, "score": 1, "last_activity_date": 1589747933, "creation_date": 1589747933, "answer_id": 61858457, "question_id": 46135167, "link": "https://stackoverflow.com/questions/46135167/standard-xml-parser-has-very-low-performance-in-golang/61858457#61858457", "title": "Standard xml parser has very low performance in Golang", "body": "<p>These 5 things can help increase speed using the <code>encoding/xml</code> library:<br>\n<em>(Tested against XMB with 75k entries, 20MB, %s are applied to previous bullet)</em></p>\n\n<ol>\n<li>Use well defined structures</li>\n<li>Implement <code>xml.Unmarshaller</code> on all your structures\n\n<ul>\n<li>Lots of code</li>\n<li>Saves 20% time and 15% allocs</li>\n</ul></li>\n<li>Replace <code>d.DecodeElement(&amp;foo, &amp;token)</code> with <code>foo.UnmarshallXML(d, &amp;token)</code>\n\n<ul>\n<li>Almost 100% safe</li>\n<li>Saves 10% time &amp; allocs</li>\n</ul></li>\n<li>Use <code>d.RawToken()</code> instead of <code>d.Token()</code>\n\n<ul>\n<li>Needs manual handling of nested objects and namespaces</li>\n<li>Saves 10% time &amp; 20% allocs</li>\n</ul></li>\n<li>If use use <code>d.Skip()</code>, reimplement it using <code>d.RawToken()</code></li>\n</ol>\n\n<p>I <strong>reduced time and allocs by 40%</strong> on my specific usecase at the cost of more code, boileplate, and potentially worse handling of corner cases, but my inputs are fairly consistent, however it's not enough.</p>\n\n<pre><code>benchstat first.bench.txt parseraw.bench.txt \nname          old time/op    new time/op    delta\nUnmarshal-16     1.06s \u00b1 6%     0.66s \u00b1 4%  -37.55%  (p=0.008 n=5+5)\n\nname          old alloc/op   new alloc/op   delta\nUnmarshal-16     461MB \u00b1 0%     280MB \u00b1 0%  -39.20%  (p=0.029 n=4+4)\n\nname          old allocs/op  new allocs/op  delta\nUnmarshal-16     8.42M \u00b1 0%     5.03M \u00b1 0%  -40.26%  (p=0.016 n=4+5)\n</code></pre>\n\n<p>On my experiments, the <a href=\"https://github.com/golang/go/issues/38332\" rel=\"nofollow noreferrer\">lack of memoizing issue</a> is the reason for large time/allocs on the XML parser which slows down significantly, mostly because of Go copying by value.</p>\n"}], "owner": {"reputation": 347, "user_id": 4230468, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f74df84a21ab14b6a0eed38f38266cb2?s=128&d=identicon&r=PG&f=1", "display_name": "Grey", "link": "https://stackoverflow.com/users/4230468/grey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1656, "favorite_count": 0, "answer_count": 2, "score": 5, "last_activity_date": 1598392716, "creation_date": 1504991637, "last_edit_date": 1598392716, "question_id": 46135167, "link": "https://stackoverflow.com/questions/46135167/standard-xml-parser-has-very-low-performance-in-golang", "title": "Standard xml parser has very low performance in Golang", "body": "<p>I have a 100Gb sized xml file and parse it with SAX method in go with this code</p>\n\n<pre><code>file, err := os.Open(filename)\nhandle(err)\ndefer file.Close()\nbuffer := bufio.NewReaderSize(file, 1024*1024*256) // 33554432\ndecoder := xml.NewDecoder(buffer)\nfor {\n        t, _ := decoder.Token()\n        if t == nil {\n            break\n        }\n        switch se := t.(type) {\n        case xml.StartElement:\n            if se.Name.Local == \"House\" {\n                house := House{}\n                err := decoder.DecodeElement(&amp;house, &amp;se)\n                handle(err)\n            }\n        }\n    }\n</code></pre>\n\n<p>But golang working very slow, its seems by execution time and disk usage. My hdd capable to read data with speed around 100-120 mb/s, but golang uses only 10-13 mb/s.\nFor experiment i rewrite this code in c#:</p>\n\n<pre><code>using (XmlReader reader = XmlReader.Create(filename)\n            {\n                while (reader.Read())\n                {\n                    switch (reader.NodeType)\n                    {\n                        case XmlNodeType.Element:\n                            if (reader.Name == \"House\")\n                            {\n                                //Code\n                            }\n                            break;\n                    }\n                }\n            }\n</code></pre>\n\n<p>And i got full hdd loaded, c# read data with 100-110mb/s speed. And execution time around 10 times lower.</p>\n\n<p>How can i improve xml parse performance using golang?</p>\n"}, {"tags": ["go", "build", "scope", "global-variables", "undefined"], "comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1504995124, "post_id": 46135056, "comment_id": 79233451, "body": "The example code looks correct.  Try running <code>go vet</code> on your code."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1504995663, "post_id": 46135056, "comment_id": 79233562, "body": "I can&#39;t reproduce this problem. In <code>$GOPATH&#47;src&#47;myapp</code>, I run <code>go build</code> and it compiles fine. Where are you running <code>go build</code>? Is <code>$GOPATH</code> set correctly (though I don&#39;t need to set it to have things build correctly; testing w/ 1.9)?"}, {"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "reply_to_user": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1505006222, "post_id": 46135056, "comment_id": 79235231, "body": "@SnoProblem <code>go vet</code> doesn&#39;t output anything, and I gotta say that I&#39;m really perplexed."}, {"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1505006313, "post_id": 46135056, "comment_id": 79235244, "body": "@RobNapier Honestly from all the docs I&#39;ve read, I don&#39;t <i>think</i> I should be having any problems... I&#39;m running <code>go build</code> from <code>$GOPATH&#47;src&#47;myapp</code>, and <code>go env GOPATH</code> returns what I expect it to."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1505052632, "post_id": 46135056, "comment_id": 79244831, "body": "I&#39;d carefully check that <code>settings.go</code> is named correctly (in particular that it has a <code>.go</code> extension). The only way I can reproduce this so far is to move <code>settings.go</code> elsewhere or change its extension. I&#39;d probably move all your <code>settings.go</code> code into <code>server.go</code> to see if that fixes things, and then try moving just one thing to another file (maybe a new file)"}, {"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "edited": false, "score": 0, "creation_date": 1505073534, "post_id": 46135056, "comment_id": 79251773, "body": "By way of copy-pasting with X-selections, I had accidentally omitted the <code>&#47;&#47; +build go1.8</code> tags that I had at the top of each file. Removing these build tags allowed compilation to proceed as normal, like you suggested... I&#39;ve updated the question. Now I&#39;m wondering, why would these build tags introduce package scoping issues?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505137922, "post_id": 46135056, "comment_id": 79276633, "body": "@KeeferRourke: built tags won&#39;t change scoping, they simply cause files to be included or <i>ommitted</i> during compilation. Are you using the correct version of Go? Note that the build constraints as shown are not correct, as they need to be followed by a blank line too."}, {"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505341258, "post_id": 46135056, "comment_id": 79378708, "body": "@JimB, if you want to write up a proper answer, I&#39;ll mark it as the accepted solution. I am now fairly certain that the issue arose due to incorrect build tag usage."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505341455, "post_id": 46135056, "comment_id": 79378762, "body": "@KeeferRourke: I&#39;m not sure what to put, because I don&#39;t see how it wouldn&#39;t have worked. You are using the correct version of Go, and the build tags aren&#39;t formatted correctly, so they wouldn&#39;t take effect anyway."}], "answers": [{"comments": [{"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "edited": false, "score": 0, "creation_date": 1504994440, "post_id": 46135447, "comment_id": 79233290, "body": "This does not answer my question. Note that the two source files intentionally belong to the same package."}, {"owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "edited": false, "score": 0, "creation_date": 1504995015, "post_id": 46135447, "comment_id": 79233425, "body": "I have updated the code example to be more clear. My question concerns a custom package that I am writing which is split across multiple files. These files <i>should</i> share the same package scope, by my understanding, but do not see to."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505138190, "post_id": 46135447, "comment_id": 79276806, "body": "@Mue, While this is factually correct, it has nothing to do with the issue in question."}, {"owner": {"reputation": 6470, "user_id": 25814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nDa7n.jpg?s=128&g=1", "display_name": "themue", "link": "https://stackoverflow.com/users/25814/themue"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505153026, "post_id": 46135447, "comment_id": 79285636, "body": "@JimB I know, has been written immediately after the question has been entered. Here the packages in the code missed. See history of the question."}], "tags": [], "owner": {"reputation": 6470, "user_id": 25814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nDa7n.jpg?s=128&g=1", "display_name": "themue", "link": "https://stackoverflow.com/users/25814/themue"}, "is_accepted": false, "score": 0, "last_activity_date": 1504994005, "creation_date": 1504994005, "answer_id": 46135447, "question_id": 46135056, "link": "https://stackoverflow.com/questions/46135056/why-might-go-build-tags-introduce-scoping-issues/46135447#46135447", "title": "Why might Go +build tags introduce scoping issues?", "body": "<p>Exported code from other packages has to be prefixed with the package name.</p>\n\n<pre><code>package foo\n\nfunc Bar() { ... }\n</code></pre>\n\n<p>and</p>\n\n<pre><code>package main\n\nimport foo\n\nfunc main() {\n    foo.Bar() \n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 5637981, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6157f5ad46cbce9396740fd7904fc14b?s=128&d=identicon&r=PG&f=1", "display_name": "Keefer Rourke", "link": "https://stackoverflow.com/users/5637981/keefer-rourke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 207, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505073941, "creation_date": 1504990734, "last_edit_date": 1505073941, "question_id": 46135056, "link": "https://stackoverflow.com/questions/46135056/why-might-go-build-tags-introduce-scoping-issues", "title": "Why might Go +build tags introduce scoping issues?", "body": "<p>I am writing a web server in Go lang, which needs to read a configuration file into memory before the server starts. I am having trouble accessing my <code>Settings</code> type, several variables, and a function which are defined in <code>settings.go</code>. These need to be accessible to other files within the same package, but I keep getting 'undefined' errors, suggesting I have some sort of scope error.</p>\n\n<p>Below is a minimal code example which demonstrates my issue. Each file has <code>// +build go1.8</code> tags defined on the first line. With these tags present, compilation fails with the errors described below. Without these tags, compilation proceeds as expected.</p>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>// +build go1.8\npackage main\n\nimport (\n    \"myapp/srv\"\n)\n\nfunc main() {\n    srv.StartServer()\n}\n</code></pre>\n\n<p><strong>server.go</strong></p>\n\n<pre><code>// +build go1.8\npackage srv\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc init() {\n    // read the server configuration file into memory\n    err := ReadConfig(CFGFILE)\n    if err != nil {\n        log.Fatalf(\"config error: %s\", err)\n    }\n}\n\nfunc StartServer() {\n    fmt.Println(\"Starting server!\")\n    fmt.Println(\"Using config file at: \" + CFGFILE)\n    fmt.Println(\"Running on port: \" + PORT)\n\n    fmt.Print(Conf.String())\n\n    log.Fatal(http.ListenAndServe(\":\" + PORT, nil))\n}\n</code></pre>\n\n<p><strong>settings.go</strong></p>\n\n<pre><code>// +build go1.8\npackage srv\n\nimport (\n    /* Standard library packages */\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n)\n\n\n /* All settings */\n type Settings struct {\n    /* General settings */\n    Title           string  // site title\n    Subtitle        string  // site subtitle shown on landing page\n }\n\n // allow printing of runtime config\n func (s Settings) String() string {\n    res, err := json.MarshalIndent(s, \"\", \"  \")\n    var ret string\n    if err != nil {\n        ret = \"Error in config.\"\n    } else {\n        ret = string(res)\n    }\n    return fmt.Sprintf(\"%s\", ret)\n}\n\n// export global settings\nvar Conf Settings\nvar PORT string = \"3000\"\nvar CFGFILE string = \"config.json\"\n\nfunc ReadConfig(file string) error {\n    if file == \"\" {\n        fmt.Println(\"Path to config file cannot be nil!\")\n    }\n\n    buf, err := ioutil.ReadFile(file)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    err = json.Unmarshal(buf, &amp;Conf)\n\n    return err\n}\n</code></pre>\n\n<p>Compilation attempted with Go v1.8.3 on Fedora 26 Workstation by running <code>go build</code> from the project directory located at <code>$GOPATH/src/myapp</code>.</p>\n\n<p>Errors:</p>\n\n<pre><code>./server.go:12: undefined: ReadConfig\n./server.go:12: undefined: CFGFILE\n./server.go:20: undefined: CFGFILE\n./server.go:21: undefined: PORT\n./server.go:23: undefined: Conf in Conf.String\n./server.go:25: undefined: PORT\n</code></pre>\n\n<p>All of the above <em>are</em> defined in settings.go however, which to my knowledge should be included in the package when I execute <code>go build</code>. Any help would be appreciated.</p>\n\n<p><em>Project structure</em>:</p>\n\n<pre><code>myapp/\n+- srv/\n|  +- server.go\n|  +- settings.go\n+- main.go\n</code></pre>\n\n<p>UPDATE: Clarified questions to reflect new knowledge. I am fairly convinced that the build tags caused the issue outlined above.</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504978445, "post_id": 46133127, "comment_id": 79229001, "body": "I think you&#39;re confusing <code>select</code> and <code>switch</code> statements. The <code>select</code> cases are only concerned with channel operations"}], "answers": [{"comments": [{"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 0, "creation_date": 1504980639, "post_id": 46133416, "comment_id": 79229610, "body": "I&#39;m applying this pattern to a more complex pipeline. If you read the linked blog post you&#39;ll see they use the <code>done</code> channel to cancel the entire pipeline on error. I&#39;m not actually computing squares."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 0, "creation_date": 1504980755, "post_id": 46133416, "comment_id": 79229643, "body": "@jbrown If it&#39;s just looping over an input channel, regardless of what its doing inside there, you can just as easily close the goroutine on error by closing the input channel."}, {"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 0, "creation_date": 1504981037, "post_id": 46133416, "comment_id": 79229706, "body": "It&#39;s part of a fan-out/fan-in pipeline so not that straightforward according to the post. But it&#39;s the first time I&#39;ve implemented that in go so it might be simpler."}, {"owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "reply_to_user": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 2, "creation_date": 1504981140, "post_id": 46133416, "comment_id": 79229733, "body": "@jbrown I believe they use <code>done</code> there to shut down <i>multiple</i> goroutines at the same time regardless of their input channel. If you don&#39;t need that sort of coordination, closing the input channel works fine. If you do, then yes something like that is the way to go."}], "tags": [], "owner": {"reputation": 126343, "user_id": 14660, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/e55e0ec3c00f834d78fbdddeaa36e308?s=128&d=identicon&r=PG", "display_name": "Schwern", "link": "https://stackoverflow.com/users/14660/schwern"}, "is_accepted": false, "score": 0, "last_activity_date": 1504980038, "last_edit_date": 1504980038, "creation_date": 1504978863, "answer_id": 46133416, "question_id": 46133127, "link": "https://stackoverflow.com/questions/46133127/selecting-inside-range-over-go-channel/46133416#46133416", "title": "Selecting inside range over go channel", "body": "<blockquote>\n  <p><em>I don't fully understand the line <code>case out &lt;- n * n</code>:. I can see it's saying that if there's a value for n, then square it and send it down the channel, but I don't understand why.</em></p>\n</blockquote>\n\n<p>That's not correct. <code>case out &lt;- n * n</code> checks to see if <code>out</code> is ready to read, and sends <code>n * n</code> to <code>out</code> if it is. Unless <code>done</code> is also ready.</p>\n\n<p><code>select</code> is used when you have multiple channels to talk to. Whichever channel is ready, it will do that case. If multiple channels are ready, it will select one at random.</p>\n\n<pre><code>select {\n    case out &lt;- n * n:\n    case &lt;-done:\n        return\n    }\n}\n</code></pre>\n\n<p>This will select over <code>out</code> and <code>done</code>. If either is ready to proceed, ie. <code>out</code> is ready to read or there's something to read from <code>done</code>, it will pick one of those cases. The order is random, so it is possible to send more down <code>out</code> even if there's something to be read from <code>done</code>.</p>\n\n<p>This pattern is used to shut down infinite goroutines. If you stop reading from its output channel, it won't do any more work, but it will hang around in memory. So by passing a value to <code>done</code> you can tell the goroutine to shut down.</p>\n\n<hr>\n\n<p><strong><em>UPDATE</em></strong>: In your original case, where the goroutine is looping over an input channel and sending output, <code>done</code> is an unnecessary complication. Once the input channel is closed, the function will return.</p>\n\n<pre><code>func sq(in &lt;-chan int) &lt;-chan int {\n    out := make(chan int)\n    go func() {\n        defer close(out)\n        for n := range in {\n            out &lt;- n * n\n        }\n    }()\n    return out\n}\n\nfunc main() {\n    in := make(chan int)\n    out := sq(in)\n    for _,i := range []int{1,2,3,4} {\n        in &lt;- i\n        fmt.Println(&lt;-out)\n    }\n\n    // The `range` inside the goroutine from sq() will exit,\n    // and the goroutine will return.\n    close(in)\n}\n</code></pre>\n\n<p>If it just spat out an ever increasing set of squares, then <code>done</code> would be necessary inside an infinite loop.</p>\n\n<pre><code>func sq(done chan bool) &lt;-chan int {\n    out := make(chan int)\n    go func() {\n        defer close(out)\n        n := 0\n        for {\n            select {\n                case &lt;-done:\n                    return\n                case out&lt;-n*n:\n                    n++\n            }\n        }\n    }()\n    return out\n}\n\nfunc main() {\n    done := make(chan bool)\n    out := sq(done)\n    for range []int{1,2,3,4} {\n        fmt.Println(&lt;-out)\n    }\n\n    // The switch in the goroutine will be able to read\n    // from done (out's buffer being already full) and return.\n    done &lt;- true\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "edited": false, "score": 0, "creation_date": 1504980428, "post_id": 46133478, "comment_id": 79229569, "body": "You say to compute the value before the select, but my <code>GetData</code> function takes a few minutes to complete. If there&#39;s something on <code>done</code> I want to return immediately. Calling <code>GetData</code> after the <code>range</code> will run that expensive function even if <code>done</code> is ready to read. Is there an alternative that will only run <code>GetData</code> if <code>out</code> can accept the write?"}, {"owner": {"reputation": 2308, "user_id": 532383, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b16537f0f4ce1a484c06d3fc996ea37?s=128&d=identicon&r=PG", "display_name": "Ayub Malik", "link": "https://stackoverflow.com/users/532383/ayub-malik"}, "edited": false, "score": 0, "creation_date": 1584010888, "post_id": 46133478, "comment_id": 107307465, "body": "Great! I could not understand why the <b>case &lt;-done</b> clause would ever execute if there was a value in <b>n</b>. However I missed the fact that the first case statement is actually testing the <i>sending</i> to the <b>out</b> channel and not the reading from the in channel."}], "tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 1, "last_activity_date": 1504979266, "creation_date": 1504979266, "answer_id": 46133478, "question_id": 46133127, "link": "https://stackoverflow.com/questions/46133127/selecting-inside-range-over-go-channel/46133478#46133478", "title": "Selecting inside range over go channel", "body": "<ol>\n<li><p>Being in a <code>range</code> or not doesn't have any impact on what <code>select</code> is doing here.</p></li>\n<li><p>No, <code>select</code> doesn't take the first true expression... it doesn't take expressions at all. The only things that can appear as the cases of an expression are channel sends, channel receives, and assignments with channel receives on their right side.</p>\n\n<pre><code>select {\ncase out &lt;- n * n:\ncase &lt;-done:\n    return\n}\n</code></pre></li>\n</ol>\n\n<p>says \"if sending on <code>out</code> is possible (i.e. it has remaining capacity or an active reader), then send the value <code>n * n</code> to it and continue. If receiving from <code>done</code> is possible, return from the function. If both are possible, choose one at random and do it. If neither is possible, wait until one of them becomes possible.\" (See <a href=\"https://golang.org/ref/spec#Select_statements\" rel=\"nofollow noreferrer\">Select Statements</a> in the spec).</p>\n\n<p>If the value you want to send needs to be computed (and it's too complex to put on the right hand side of the channel send), simply do it before the <code>select</code>. The spec makes it clear that all of the expressions in send statements in a select are computed ahead of time anyway, so nothing is lost.</p>\n"}], "owner": {"reputation": 5825, "user_id": 2400966, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/937a1ba2c0aa7d9e24fd92b99e26e1e8?s=128&d=identicon&r=PG", "display_name": "jbrown", "link": "https://stackoverflow.com/users/2400966/jbrown"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2146, "favorite_count": 0, "accepted_answer_id": 46133478, "answer_count": 2, "score": 0, "last_activity_date": 1504980038, "creation_date": 1504977032, "last_edit_date": 1504978215, "question_id": 46133127, "link": "https://stackoverflow.com/questions/46133127/selecting-inside-range-over-go-channel", "title": "Selecting inside range over go channel", "body": "<p>I'm following <a href=\"https://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">this post</a> to parallelise my app. I need to tailor this code:</p>\n\n<pre><code>func sq(done &lt;-chan struct{}, in &lt;-chan int) &lt;-chan int {\n    out := make(chan int)\n    go func() {\n        defer close(out)\n        for n := range in {\n            select {\n            case out &lt;- n * n:\n            case &lt;-done:\n                return\n            }\n        }\n    }()\n    return out\n}\n</code></pre>\n\n<p>I don't fully understand the line <code>case out &lt;- n * n:</code>. I can see it's saying that if there's a value for <code>n</code>, then square it and send it down the channel, but I don't understand why. Does <code>select</code> just take the first <code>true</code> case? Could it be rewritten:</p>\n\n<pre><code>for n := range in {\n    select {\n    case n:\n       out &lt;- n * n\n    case &lt;-done:\n       return\n    }\n}\n</code></pre>\n\n<p>Anyway, I need to replace the line <code>case out &lt;- n * n:</code> with a function call. I've changed it to the following:</p>\n\n<pre><code>out := make(chan structs.Ticket)\n\ngo func() {\n    defer close(out)\n    for url := range inputChannel {\n        select {\n        case url:\n            data, err := GetData(url)\n            fmt.Println(\"Got error: \", err)\n            out &lt;- data\n        case &lt;-done:\n            return\n        }\n    }\n}()\n\nreturn out\n</code></pre>\n\n<p>It looks like this will compile (I can't compile it yet), but because it's not simple to debug parallel code I wanted to check that using <code>case url</code> was the right way to select on a channel in a <code>range</code>. Is this right?</p>\n\n<p><strong>Update</strong></p>\n\n<p>OK I've removed the remaining issues with my code, and now when I try to compile I get the error messages: </p>\n\n<pre><code>url evaluated but not used\nselect case must be receive, send or assign recv\n</code></pre>\n"}, {"tags": ["postgresql", "docker", "go", "alpine", "sqlx"], "comments": [{"owner": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1504976677, "post_id": 46132750, "comment_id": 79228458, "body": "Instead of building the alpine container from <code>golang:latest</code>, try building from <code>golang:alpine</code>."}, {"owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "reply_to_user": {"reputation": 1665, "user_id": 4638952, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/03791badf72f6918a8910148dfc4401e?s=128&d=identicon&r=PG&f=1", "display_name": "SnoProblem", "link": "https://stackoverflow.com/users/4638952/snoproblem"}, "edited": false, "score": 0, "creation_date": 1504999481, "post_id": 46132750, "comment_id": 79234253, "body": "@SnoProblem Thanks for the suggestion. Good idea. However, did not seem to help as I see it: <a href=\"https://github.com/mraxus/mystery-golang-alpine/pull/1\" rel=\"nofollow noreferrer\">github.com/mraxus/mystery-golang-alpine/pull/1</a>"}, {"owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1504999526, "post_id": 46132750, "comment_id": 79234262, "body": "Thx for the fix @Flimzy"}, {"owner": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1505017514, "post_id": 46132750, "comment_id": 79236749, "body": "This may be OS specific, because both the images worked for me. I ran them on Vagrant VM Ubuntu 16.04 LTS"}, {"owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "reply_to_user": {"reputation": 123770, "user_id": 2830850, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e48b39b77bf324de9aeefd6c5bfc10c6?s=128&d=identicon&r=PG&f=1", "display_name": "Tarun Lalwani", "link": "https://stackoverflow.com/users/2830850/tarun-lalwani"}, "edited": false, "score": 0, "creation_date": 1505117826, "post_id": 46132750, "comment_id": 79263656, "body": "Thanks for checking @TarunLalwani. Good to know it works on other platforms. I added my system details into the question. Docker just released an update for mac (17.06.2-ce, build cec0b72) but didn&#39;t make any difference. I will continue on in my quest."}, {"owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 0, "creation_date": 1505119974, "post_id": 46132750, "comment_id": 79264913, "body": "Try changing the postrgres hostname with an IP, may be you are experiencing a network configuration problem of your container."}, {"owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "reply_to_user": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 0, "creation_date": 1505128626, "post_id": 46132750, "comment_id": 79270290, "body": "@MaxZerbini You are correct. After some digging with help from a friend, we got to a working solution. I present &quot;solution&quot; here: <a href=\"https://github.com/mraxus/mystery-golang-alpine/pull/3\" rel=\"nofollow noreferrer\">github.com/mraxus/mystery-golang-alpine/pull/3</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "is_accepted": false, "score": 0, "last_activity_date": 1505284968, "last_edit_date": 1505284968, "creation_date": 1505129558, "answer_id": 46154709, "question_id": 46132750, "link": "https://stackoverflow.com/questions/46132750/sqlx-connect-get-stuck-in-docker-alpinelatest/46154709#46154709", "title": "sqlx.Connect() get stuck in docker alpine:latest", "body": "<h2>Proper solution (by realizing the actual problem)</h2>\n\n<p>So it turns out that the corporate network at work have a search domain set. This affects the alpine containers name resolution. However, the default golang is not.</p>\n\n<p>To solve the problem, you can overwrite docker-compose containers search domain, by modifying the config:</p>\n\n<pre><code>build:\n    dns_search: .\n    image: image:build\n    ...\n\nalpine:\n    dns_search: .\n    image: image:alpine\n    ...\n</code></pre>\n\n<p>See <a href=\"https://github.com/mraxus/mystery-golang-alpine/pull/4\" rel=\"nofollow noreferrer\">https://github.com/mraxus/mystery-golang-alpine/pull/4</a> </p>\n\n<h2>Alternative solution (not having realized the actual problem)</h2>\n\n<p>By forcing go to use the <code>cgo</code> name resolver, there is no longer any issues:</p>\n\n<p>In docker-compose.yml</p>\n\n<pre><code>alpine:\n    image: mamarcus.org/project:alpine\n    links:\n        - postgres\n    environment:\n        DB: \"postgres://postgres@postgres/postgres?sslmode=disable\"\n        GODEBUG: \"netdns=cgo\"\n</code></pre>\n\n<p>See <a href=\"https://github.com/mraxus/mystery-golang-alpine/pull/3\" rel=\"nofollow noreferrer\">https://github.com/mraxus/mystery-golang-alpine/pull/3</a></p>\n\n<p><em>It should be mentioned</em> that this solution is still iffy. In our real dev environment, containing ~20 services configured in docker-compose, some docker alpine images still did not resolve properly. But when updating the configuration with the \"proper solution\", everything worked like a charm.</p>\n"}], "owner": {"reputation": 1045, "user_id": 3101643, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4a94388b81e55a34a5057641454f23f4?s=128&d=identicon&r=PG", "display_name": "mraxus", "link": "https://stackoverflow.com/users/3101643/mraxus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 318, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1505284968, "creation_date": 1504974537, "last_edit_date": 1505116732, "question_id": 46132750, "link": "https://stackoverflow.com/questions/46132750/sqlx-connect-get-stuck-in-docker-alpinelatest", "title": "sqlx.Connect() get stuck in docker alpine:latest", "body": "<p>I have problem that I've managed to reduce to the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/jmoiron/sqlx\"\n    _ \"github.com/lib/pq\"\n    \"os\"\n)\n\nfunc main() {\n    addr := os.Getenv(\"DB\")\n    fmt.Println(\"Postgres addr: \" + addr)\n\n    _, err := sqlx.Connect(\"postgres\", addr)\n\n    if err != nil {\n        fmt.Println(\"Could not connect...\")\n    } else {\n        fmt.Println(\"Connecting successful\")\n    }\n}\n</code></pre>\n\n<p>I set up a repo with the code and more explanations at:</p>\n\n<p><a href=\"https://github.com/mraxus/mystery-golang-alpine\" rel=\"nofollow noreferrer\">https://github.com/mraxus/mystery-golang-alpine</a></p>\n\n<p>When I build and run this Go code with a valid DB url in a docker image (here <code>golang:latest</code>) throught <code>docker-compose</code>, where both the above program and the postgres db is in separate containers, the program runs as expected:</p>\n\n<pre><code>build_1     | Postgres addr: postgres://postgres@postgres/postgres?sslmode=disable\nbuild_1     | Connecting successful\n</code></pre>\n\n<p>However, when I run the same program in same setup (<code>docker-compose</code>) with the base image <code>alpine:latest</code>, the program just gets stuck at the sqlx.Connect():</p>\n\n<pre><code>alpine_1    | Postgres addr: postgres://postgres@postgres/postgres?sslmode=disable\n</code></pre>\n\n<p>I have no idea why this is. Do you know? I have setup a project to see if others can reproduce and get the same problem as I get:</p>\n\n<p><a href=\"https://github.com/mraxus/mystery-golang-alpine\" rel=\"nofollow noreferrer\">https://github.com/mraxus/mystery-golang-alpine</a></p>\n\n<p>Love to hear some insights that can help me solve this issue.</p>\n\n<p>My system details:</p>\n\n<ul>\n<li>macOS 10.12.6 (Sierra, MBP Mid 2015 15-inch)</li>\n<li>docker 17.06.1 1-ce-mac24</li>\n</ul>\n"}, {"tags": ["go", "aerospike"], "comments": [{"owner": {"reputation": 2245, "user_id": 78569, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/ff86b5a4d2ed04ef2e97af337b694bc9?s=128&d=identicon&r=PG&f=1", "display_name": "Imaskar", "link": "https://stackoverflow.com/users/78569/imaskar"}, "edited": false, "score": 0, "creation_date": 1526469353, "post_id": 46131591, "comment_id": 87754746, "body": "You use aerospike to store hits? Metrics? Aren&#39;t ClickHouse, InfluxDB and DalmatinerDB are for that?"}], "owner": {"reputation": 57, "user_id": 8479510, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/217776a6445ea0d5c2dde8bcb8e6336d?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/8479510/chrisdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 49, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1558993130, "creation_date": 1504966577, "question_id": 46131591, "link": "https://stackoverflow.com/questions/46131591/aerospike-grouped-cummulative-insert", "title": "Aerospike grouped cummulative insert", "body": "<p>I have an app which gets billions of hits per day. I use golang, aerospike to capture number of hits.When i try to insert this into aerospike ( mostly AddOP operation) aerospike hangs. It takes more than 10000ms for simple inserts during heavy load. </p>\n\n<p>So is there a way i could capture these in Golang script or through some connector/app -> buffer them -> add them up  and do insert every 1 minute or so into aerospike?</p>\n\n<p>I heard about kafka, is it a good option for aerospike?Are there better alternatives for my requirement?</p>\n\n<p>Any suggestions are helpful.</p>\n"}, {"tags": ["go", "concurrency", "channel", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504962803, "post_id": 46130936, "comment_id": 79224198, "body": "There&#39;s no such thing as a channel that can be dynamically resized, but there&#39;s nothing in the code indicating how you&#39;re trying to do that. You&#39;re copying your WaitGroup, <code>go vet</code> will point out this error for you"}, {"owner": {"reputation": 123, "user_id": 4854980, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/525327a5d72d5d08fcee960c94f9f681?s=128&d=identicon&r=PG&f=1", "display_name": "vitamike", "link": "https://stackoverflow.com/users/4854980/vitamike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504963019, "post_id": 46130936, "comment_id": 79224272, "body": "apologies, by dynamically resized i mean an unbuffered channel &quot;go vet&quot;?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504963364, "post_id": 46130936, "comment_id": 79224396, "body": "An unbuffered channel has no buffer, hence it never has a &quot;size&quot; other than 0. <code>vet</code> is one of the built in tools, run it on this code."}, {"owner": {"reputation": 123, "user_id": 4854980, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/525327a5d72d5d08fcee960c94f9f681?s=128&d=identicon&r=PG&f=1", "display_name": "vitamike", "link": "https://stackoverflow.com/users/4854980/vitamike"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504964144, "post_id": 46130936, "comment_id": 79224626, "body": "Thanks I&#39;ve updated it, the issue still hasn&#39;t been resolved the issue, the page script still fails to reach the print statements"}, {"owner": {"reputation": 583, "user_id": 1780541, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d8350ad7b44f8dcb1cdb9f54ba13f8c?s=128&d=identicon&r=PG", "display_name": "usil", "link": "https://stackoverflow.com/users/1780541/usil"}, "edited": false, "score": 0, "creation_date": 1504965800, "post_id": 46130936, "comment_id": 79225129, "body": "I am not sure if wg.Wait is blocking. I&#39;m getting panic: sync: negative WaitGroup counter error."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1504966556, "post_id": 46130936, "comment_id": 79225352, "body": "You should be only calling <code>wg.Done</code> for each goroutine, but you&#39;re calling it  for every value received from <code>testValContainer</code>. I&#39;m not sure what the logic is supposed to be, so it&#39;s hard to offer a correct answer. What are you trying to accomplish."}, {"owner": {"reputation": 583, "user_id": 1780541, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7d8350ad7b44f8dcb1cdb9f54ba13f8c?s=128&d=identicon&r=PG", "display_name": "usil", "link": "https://stackoverflow.com/users/1780541/usil"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1504966971, "post_id": 46130936, "comment_id": 79225458, "body": "Like @JimB told. Here is a minimal example what are you trying to do <a href=\"https://play.golang.org/p/fdck7CZ9VJ\" rel=\"nofollow noreferrer\">play.golang.org/p/fdck7CZ9VJ</a> and it is not ok."}], "answers": [{"tags": [], "owner": {"reputation": 1435, "user_id": 180656, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/24c91c0ae420dcaf04e5e9061be6a93c?s=128&d=identicon&r=PG", "display_name": "Josef Grahn", "link": "https://stackoverflow.com/users/180656/josef-grahn"}, "is_accepted": false, "score": 0, "last_activity_date": 1504970331, "last_edit_date": 1504970331, "creation_date": 1504969914, "answer_id": 46132061, "question_id": 46130936, "link": "https://stackoverflow.com/questions/46130936/closing-a-go-channel-and-syncing-a-go-routine/46132061#46132061", "title": "Closing a Go channel, and syncing a go routine", "body": "<p>In your example you have two errors:</p>\n\n<ol>\n<li>You are calling <code>wg.Done</code> in side the loop in each worker thread rather than at the end of the worker thread (right before it completes). The calls to <code>wg.Done</code> must be matched one-to-one with <code>wg.Add(1)</code>s.</li>\n<li>With that fixed, there is a deadlock where the main thread is waiting for the worker threads to complete, while the worker threads area waiting for the input channel to be closed by the main thread.</li>\n</ol>\n\n<p>The logic will be cleaner and easier to understand if you separate the <em>producer</em> side from the <em>consumer</em> side more clearly. Run a separate goroutine for each side. Example:</p>\n\n<pre><code>// Producer side (only write and close allowed).\ngo func() {\n    testValContainer &lt;- \"string val 1\"\n    testValContainer &lt;- \"string val 2\"\n    testValContainer &lt;- \"string val 3\"\n    testValContainer &lt;- \"string val 4\"\n    testValContainer &lt;- \"string val 5\"\n    testValContainer &lt;- \"string val 6\"\n    testValContainer &lt;- \"string val 7\"\n    close(testValContainer) // Signals that production is done.\n}()\n\n// Consumer side (only read allowed).\nfor i:=0; i &lt; 3; i++ {\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        v := i\n        fmt.Printf(\"launching %v\", i)\n        for str := range testValContainer {\n            doSomething(str)\n        }\n        fmt.Println(v, \"--EXIT --\")\n    }()\n}\nwg.Wait()\n</code></pre>\n\n<p>If the items are being produced from some other source, potentially a collection of goroutines, you should still have either: 1) a separate goroutine or logic somewhere that oversees that production and calls <code>close</code> once it's done, or 2) make your main thread wait for the production side to complete (e.g. with a <code>WaitGroup</code> waiting for the <em>producer</em> goroutines) and close the channel <em>before</em> waiting for the consumptions side.</p>\n\n<p>If you think about it, no matter how you arrange the logic you need to have <strong>some</strong> \"side-channel\" way of detecting, in one single synchronised place, that there are no more messages being produced. Otherwise you can never know when the channel should be closed.</p>\n\n<p>In other words, you can't wait for the range loops on the consumer side to complete to trigger the <code>close</code>, as this leads to a catch 22.</p>\n"}, {"tags": [], "owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "is_accepted": true, "score": 0, "last_activity_date": 1505066889, "creation_date": 1505066889, "answer_id": 46143957, "question_id": 46130936, "link": "https://stackoverflow.com/questions/46130936/closing-a-go-channel-and-syncing-a-go-routine/46143957#46143957", "title": "Closing a Go channel, and syncing a go routine", "body": "<p>I might do something like this, it keeps everything easy to follow.  I define a structure which implements a semaphore to control the number of active Go routines spinning up... and allows me to read from the channel as they come in.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype TestValContainer struct {\n    wg   sync.WaitGroup\n    sema chan struct{}\n    data chan int\n}\n\nfunc doSomething(number int) {\n    fmt.Println(number)\n}\n\nfunc main() {\n    //semaphore limit 10 routines at time\n    tvc := TestValContainer{\n        sema: make(chan struct{}, 10),\n        data: make(chan int),\n    }\n\n    for i := 0; i &lt;= 100; i++ {\n        tvc.wg.Add(1)\n        go func(i int) {\n            tvc.sema &lt;- struct{}{}\n            defer func() {\n                &lt;-tvc.sema\n                tvc.wg.Done()\n            }()\n\n            tvc.data &lt;- i\n        }(i)\n    }\n    // wait in the background so that waiting and closing the channel dont\n    // block the for loop below\n    go func() {\n        tvc.wg.Wait()\n        close(tvc.data)\n    }()\n    // get channel results\n    for res := range tvc.data {\n        doSomething(res)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 123, "user_id": 4854980, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/525327a5d72d5d08fcee960c94f9f681?s=128&d=identicon&r=PG&f=1", "display_name": "vitamike", "link": "https://stackoverflow.com/users/4854980/vitamike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1021, "favorite_count": 0, "accepted_answer_id": 46143957, "answer_count": 2, "score": 0, "last_activity_date": 1505066889, "creation_date": 1504961715, "last_edit_date": 1504965331, "question_id": 46130936, "link": "https://stackoverflow.com/questions/46130936/closing-a-go-channel-and-syncing-a-go-routine", "title": "Closing a Go channel, and syncing a go routine", "body": "<p>Im unable to terminate my WaitGroup in go and consequently can't exit the range loop. Can anybody tell me why. Or a better way of limiting the number of go routines while still being able to exit on chan close!</p>\n\n<p>Most examples i have seen relate to a statically typed chan length, but this channel is dynamically resized as a result of other processes.</p>\n\n<p>The print statement (\"DONE!\") in the example are printed showing that the testValProducer prints the right amount of times but the code never reaches (\"--EXIT--\") which means wg.Wait is still blocking somehow.</p>\n\n<pre><code>type TestValContainer chan string\n\nfunc StartFunc(){\ntestValContainer            := make(TestValContainer)\ngo func(){testValContainer &lt;- \"string val 1\"}()\ngo func(){testValContainer &lt;- \"string val 2\"}()\ngo func(){testValContainer &lt;- \"string val 3\"}()\ngo func(){testValContainer &lt;- \"string val 4\"}()\ngo func(){testValContainer &lt;- \"string val 5\"}()\ngo func(){testValContainer &lt;- \"string val 6\"}()\ngo func(){testValContainer &lt;- \"string val 7\"}()\nwg  := sync.WaitGroup{}\n\n// limit the number of worker goroutines\nfor i:=0; i &lt; 3; i++ {\n    wg.Add(1)\n    go func(){\n        v := i\n        fmt.Printf(\"launching %v\", i)\n        for str := range testValContainer{\n            testValProducer(str, &amp;wg)\n        }\n        fmt.Println(v, \"--EXIT --\")  // never called\n    }()\n}\n\nwg.Wait()\nclose(testValContainer)\n\n}\n\n\nfunc get(url string){\n    http.Get(url)\n    ch &lt;- getUnvisited()\n}\n\n\nfunc testValProducer(testStr string, wg *sync.WaitGroup){\n    doSomething(testStr)\n    fmt.Println(\"done !\") // called\n    wg.Done() // NO EFFECT??\n}\n</code></pre>\n"}, {"tags": ["go", "go-iris"], "answers": [{"comments": [{"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1505040335, "post_id": 46139541, "comment_id": 79241423, "body": "Wow! That was easy! Also is there any harm in using <code>Party</code> as my intention was to differentiate between <code>user route</code> with <code>allRoutes</code> and <code>admin routes</code> with <code>adminRoutes</code>. Is there any performance issue using it like that ?"}, {"owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 0, "creation_date": 1505040891, "post_id": 46139541, "comment_id": 79241558, "body": "I have used <code>app.Use</code> to share default title, host, layout file and settings table data.  Do you recommend avoiding <code>app.Party</code>? if so, please let me know, why!"}, {"owner": {"reputation": 769, "user_id": 2647655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qGHOi.png?s=128&g=1", "display_name": "kataras", "link": "https://stackoverflow.com/users/2647655/kataras"}, "reply_to_user": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "edited": false, "score": 1, "creation_date": 1506351651, "post_id": 46139541, "comment_id": 79774260, "body": "No John, it&#39;s not harmful neither any performance cost, if you&#39;d like <code>Party</code> for root routes then continue with that, what ever you like more!!"}], "tags": [], "owner": {"reputation": 769, "user_id": 2647655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qGHOi.png?s=128&g=1", "display_name": "kataras", "link": "https://stackoverflow.com/users/2647655/kataras"}, "is_accepted": true, "score": 3, "last_activity_date": 1505038241, "creation_date": 1505038241, "answer_id": 46139541, "question_id": 46130446, "link": "https://stackoverflow.com/questions/46130446/fetching-logged-in-user-info-for-display/46139541#46139541", "title": "Fetching Logged in User Info for display", "body": "<p>it's easy you can use the <code>ctx.Values().Set/Get</code> to make something shareable between your route's handlers or middleware(s).</p>\n\n<pre><code>// load session manager once\nsess := connectSess()\n\nfunc authCheck(ctx context.Context) {\n    session := sess.Start(ctx)\n    // Load your user here.\n    // [...]\n    // Save the returning user to the local storage of this handlers chain, once. \n    ctx.Values().Set(\"user\", user) // &lt;-- IMPORTANT\n}\n\napp.Get(\"/\", func(ctx context.Context) {\n    // Get the user from our handlers chain's local storage.\n    user := ctx.Values().Get(\"user\") // &lt;-- IMPORTANT\n\n    // Bind the \"{{.user}}\" to the user instance.\n    ctx.ViewData(\"user\", user)\n    // Render the template file.\n    ctx.View(\"index.html\")\n})\n\napp.Get(\"dashboard\", func(ctx context.Context) {\n    // The same, get the user from the local storage...\n    user := ctx.Values().Get(\"user\") // &lt;-- IMPORTANT\n\n    ctx.ViewData(\"user\", user)\n    ctx.View(\"index.html\")\n})\n</code></pre>\n\n<p><strong>That's all, pretty simple, right?</strong></p>\n\n<p>But I have some <strong>notes for you</strong>, read them if you have more time.</p>\n\n<p>When you're on root \"/\" you don't have to create a party for it(<code>.Party</code>) in order to add middlewares (begin(<code>Use</code>) or finish(<code>Done</code>)), use just the <code>iris.Application</code> instance, <code>app.Use/Done</code>.</p>\n\n<p>Don't write this:</p>\n\n<pre><code>allRoutes := app.Party(\"/\", logThisMiddleware, authCheck) {\n\n    allRoutes.Get(\"/\", myHandler)\n}\n</code></pre>\n\n<p>Do that instead:</p>\n\n<pre><code>app.Use(logThisMiddleware, authCheck)\napp.Get(\"/\", myHandler)\n</code></pre>\n\n<p>It's easier to <strong>read and understand</strong>.</p>\n\n<p>I've <strong>also</strong> noticed that you're using <code>;</code> at the end of your functions, your editor and <code>gocode</code> tool will remove those, when you write a program using the Go Programming Language you shouldn't do that, remove all <code>;</code>.</p>\n\n<p>Last, please read the documentation and the examples, we have many of them at <a href=\"https://github.com/kataras/iris/tree/master/_examples\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris/tree/master/_examples</a> , hopes you the best!</p>\n"}], "owner": {"reputation": 1598, "user_id": 2819754, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/326f7b0e36e8bbf46c6442668c6a0749?s=128&d=identicon&r=PG&f=1", "display_name": "John Cargo", "link": "https://stackoverflow.com/users/2819754/john-cargo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1320, "favorite_count": 0, "accepted_answer_id": 46139541, "answer_count": 1, "score": 0, "last_activity_date": 1575111490, "creation_date": 1504958490, "last_edit_date": 1575111490, "question_id": 46130446, "link": "https://stackoverflow.com/questions/46130446/fetching-logged-in-user-info-for-display", "title": "Fetching Logged in User Info for display", "body": "<p>I am using <a href=\"https://github.com/kataras/iris\" rel=\"nofollow noreferrer\">https://github.com/kataras/iris</a> Go web framework. I have:</p>\n\n<ol>\n<li>User Registered</li>\n<li>User Verified &amp; Logged in</li>\n<li>Session created and set with key <code>username</code> with user (table &amp; struct) <code>username</code></li>\n</ol>\n\n<p>Now, here is my code for logged in user:</p>\n\n<pre><code>// Loaded All DB and other required value above\n\nallRoutes := app.Party(\"/\", logThisMiddleware, authCheck) {\n    allRoutes.Get(\"/\", func(ctx context.Context) {\n        ctx.View(\"index.html\");\n    });\n}\n</code></pre>\n\n<p>In authcheck middleware</p>\n\n<pre><code>func authcheck(ctx context.Context) {\n    // Loaded session.\n    // Fetched Session key \"isLoggedIn\"\n    // If isLoggedIn == \"no\" or \"\" (empty)\n    // Redirected to login page\n    // else\n    ctx.Next()\n}\n</code></pre>\n\n<p>My Session function</p>\n\n<pre><code>func connectSess() *sessions.Sessions {\n    // Creating Gorilla SecureCookie Session\n    // returning session\n}\n</code></pre>\n\n<p>Now, my problem is, how do I share Logged User value to all routes in template. My Current option is:</p>\n\n<pre><code>// Loaded all DB and required value\nallRoutes := app.Party(\"/\", logThisMiddleware, authCheck) {\n\n    allRoutes.Get(\"/\", func(ctx context.Context) {\n        // Load Session again\n        // Fetch username stored in session\n        // Run Query against DB\n        // Share the user struct value.\n        // Example ctx.ViewData(\"user\", user)\n        ctx.View(\"index.html\");\n    });\n\n    allRoutes.Get(\"dashboard\", func(ctx context.Context) {\n        // Load Session again\n        // Fetch username stored in session\n        // Run Query against DB\n        // Share the user struct value.\n        // Example ctx.ViewData(\"user\", user)\n        ctx.View(\"index.html\");\n    });\n}\n</code></pre>\n\n<p>But problem with above code is, I will have to write session for each route and run query again for each route I run and than share. </p>\n\n<p>I feel, there must be better way of doing it , rather than loading session twice for each route one in <code>authCheck</code> middleware and second inside <code>allRoutes.Get</code> route.</p>\n\n<p>I need ideas on how this can be optimised and user data can be shared to template by just writing code one time and not repeating below for each route</p>\n\n<pre><code>        // Load Session again\n        // Fetch username stored in session\n        // Run Query against DB\n        // Share the user struct value.\n        // Example ctx.ViewData(\"user\", user)\n</code></pre>\n"}, {"tags": ["go", "pretty-print", "go-html-template"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1504964697, "post_id": 46130358, "comment_id": 79224796, "body": "gohtmltmpl essentially treats Go template items as if they&#39;re HTML tags, and you can do the same, but it&#39;s nigh impossible to make both the output and the template look good. Generally you want the output to look good, and that&#39;s what tools like <a href=\"http://www.html-tidy.org/\" rel=\"nofollow noreferrer\">Tidy</a> do. If you really want the template itself to look good, one solution is to simply convert the <code>{{</code> and <code>}}</code> strings to something like <code>&lt;go-template&gt;</code> and <code>&lt;&#47;go-template&gt;</code>. You might need special handling for <code>{{-</code> and <code>-}}</code> of course. Then prettify the result, and convert back. I&#39;m unaware of a ready-made solution."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 1, "creation_date": 1504964954, "post_id": 46130358, "comment_id": 79224883, "body": "Note that the approach above will not format things in the same way as gohtmltmpl and it was only meant as an example. As far as I am aware, you&#39;d need to create something yourself that does the same thing as gohtmltmpl."}], "owner": {"reputation": 1146, "user_id": 1248449, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9d8cdc612a969f3cc7bb32757dce1d4f?s=128&d=identicon&r=PG", "display_name": "Diti", "link": "https://stackoverflow.com/users/1248449/diti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 796, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1504957818, "creation_date": 1504957818, "question_id": 46130358, "link": "https://stackoverflow.com/questions/46130358/format-golang-html-templates-from-command-line", "title": "Format GoLang HTML templates from command line?", "body": "<p>To enforce a codestyle in a Go project, one can use the <a href=\"https://golang.org/cmd/gofmt/\" rel=\"nofollow noreferrer\"><code>gofmt</code></a> tool to format <code>.go</code> files, and make it part of the build chain.</p>\n\n<p>Is there any possibility to <strong>enforce proper formatting of Go <em>template</em> files</strong> (usually <code>.html.tmpl</code>  extension\u2014the <code>gohtmltmpl</code> filetype on Vim) with a CLI tool, to be used in a continuous integration system?</p>\n\n<p>All the \u201cHTML prettifier\u201d tools I found are not aware of Go templates, and mess up the indenting of such files.</p>\n"}, {"tags": ["go", "reflection", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 737, "user_id": 6275844, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f9f7071f7e0149f02e945420a120a3f?s=128&d=identicon&r=PG&f=1", "display_name": "Dan 0", "link": "https://stackoverflow.com/users/6275844/dan-0"}, "is_accepted": false, "score": 0, "last_activity_date": 1505047454, "creation_date": 1505047454, "answer_id": 46140821, "question_id": 46128572, "link": "https://stackoverflow.com/questions/46128572/how-to-remove-duplicated-code-in-go-with-gorm/46140821#46140821", "title": "How to remove duplicated code in Go with Gorm", "body": "<p>Have your Controllers implement an interface that has your <code>extractID</code> function. Then implement that <code>extractID</code> for each of your controllers. Kind of like this example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype IDInterface interface {\n    ExtractString()\n}\n\ntype OrderController struct {\n    IDInterface\n    OrderData string\n}\n\ntype HostController struct {\n    IDInterface\n    HostData string\n}\n\nfunc (c OrderController) ExtractString() {\n    fmt.Println(\"Data: \" + c.OrderData)\n}\n\nfunc (c HostController) ExtractString() {\n    fmt.Println(\"Data: \" + c.HostData)\n}\n\nfunc main() {\n    o := OrderController{OrderData: \"I'm an order!\"}\n    h := HostController{HostData: \"I'm a host!\"}\n    printData(o)\n    printData(h)\n}\n\nfunc printData(inter IDInterface) {\n    inter.ExtractString()\n}\n</code></pre>\n\n<p>Note <code>printData</code> takes in an <code>IDInterface</code>, but in <code>main</code> I'm just passing the controller.</p>\n"}], "owner": {"reputation": 23, "user_id": 4198895, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aaaa405f73d2093ed9aa532f42d7e1fa?s=128&d=identicon&r=PG&f=1", "display_name": "Jans Mans", "link": "https://stackoverflow.com/users/4198895/jans-mans"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 194, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505047454, "creation_date": 1504944726, "question_id": 46128572, "link": "https://stackoverflow.com/questions/46128572/how-to-remove-duplicated-code-in-go-with-gorm", "title": "How to remove duplicated code in Go with Gorm", "body": "<p>I am using gorm package as my database library in golang. I have many database tables like \"Hosts\" or \"Orders\". In my CRUD App every Controller has the function setHost / setOrder .... </p>\n\n<p>I can write this set function for each controller. But better way would be to have just a single function, where I would use first param to create object with same class as parameter, then pass it to gorm, which will fill it with data from database, then return it. I tried to use reflect for that, but failed, because I probably don't understand it much.</p>\n\n<p>Maybe I just didn't discover some function in gorm library, or I can't use reflect package properly. How should I implement the set function. Is it possible to have this implemented, or should I rather repeat my code?</p>\n\n<pre><code>type Host struct {\n  gorm.Model\n  name string\n}\n\ntype Order struct {\n  gorm.Model\n  RoomSize int\n}\n\nfunc setOrder(c *gin.Context) (order models.Order) {\n  db := dbpkg.DBInstance(c)\n  id := new(ApplicationController).extractID(c)\n\n  db.First(&amp;order, id)\n\n  if order.ID != id {\n    log.Panicf(\"No Object with the ID: %d\", id)\n  }\n  return\n}\n\nfunc setHost(c *gin.Context) (host models.Host) {\n    db := dbpkg.DBInstance(c)\n    id := new(ApplicationController).extractID(c)\n\n    db.First(&amp;host, id)\n\n    if host.ID != id {\n        log.Panicf(\"No Object with the ID: %d\", id)\n    }\n\n    return host\n}\n\nfunc (ctrl ApplicationController) extractID(c *gin.Context) uint64 {\n    id, err := strconv.ParseUint(c.Params.ByName(\"id\"), 10, 64)\n    if err != nil {\n        log.Panicf(\"ID: %s can not parse to an uint64\", c.Params.ByName(\"id\"))\n    }\n    return id\n}\n</code></pre>\n"}, {"tags": ["amazon-web-services", "go", "file-upload", "amazon-s3"], "comments": [{"owner": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1504971929, "post_id": 46128408, "comment_id": 79226957, "body": "It should be none of those things, but rather <code>ACL: &quot;public-read&quot;</code> inside the <code>UploadInput</code>. Give that a try?"}, {"owner": {"reputation": 466, "user_id": 4452100, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c337dc25db0e55866499acf3f9adc15?s=128&d=identicon&r=PG", "display_name": "Rocky", "link": "https://stackoverflow.com/users/4452100/rocky"}, "reply_to_user": {"reputation": 138098, "user_id": 1695906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638d2ec6b52f3db1583890be23d74cc6?s=128&d=identicon&r=PG", "display_name": "Michael - sqlbot", "link": "https://stackoverflow.com/users/1695906/michael-sqlbot"}, "edited": false, "score": 0, "creation_date": 1505043968, "post_id": 46128408, "comment_id": 79242359, "body": "Yes I was wrong. I fixed it the other way, on the server side. Thank you :)"}], "owner": {"reputation": 466, "user_id": 4452100, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c337dc25db0e55866499acf3f9adc15?s=128&d=identicon&r=PG", "display_name": "Rocky", "link": "https://stackoverflow.com/users/4452100/rocky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 507, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504943462, "creation_date": 1504943462, "question_id": 46128408, "link": "https://stackoverflow.com/questions/46128408/how-to-add-grantread-parameter-in-s3-uploadinput", "title": "How to add GrantRead parameter in s3 UploadInput?", "body": "<p>I've checked UploadInput type in the <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/s3manager/#UploadInput\" rel=\"nofollow noreferrer\">package</a></p>\n\n<p>It has this part</p>\n\n<pre><code>    // Gives the grantee READ, READ_ACP, and WRITE_ACP permissions on the object.\nGrantFullControl *string `location:\"header\" locationName:\"x-amz-grant-full-control\" type:\"string\"`\n\n// Allows grantee to read the object data and its metadata.\nGrantRead *string `location:\"header\" locationName:\"x-amz-grant-read\" type:\"string\"`\n\n// Allows grantee to read the object ACL.\nGrantReadACP *string `location:\"header\" locationName:\"x-amz-grant-read-acp\" type:\"string\"`\n\n// Allows grantee to write the ACL for the applicable object.\nGrantWriteACP *string `location:\"header\" locationName:\"x-amz-grant-write-acp\" type:\"string\"`\n</code></pre>\n\n<p>How do I use GrantRead in my following request?</p>\n\n<pre><code> result, err := uploader.Upload(&amp;s3manager.UploadInput{\n        Bucket: aws.String(Conf.AWS_S3_BUCKET),\n        Key:    &amp;filename,\n        Body:   f,\n    })\n</code></pre>\n\n<p>I'm trying to make my files public to READ</p>\n"}, {"tags": ["http", "go", "client", "http2"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505139480, "post_id": 46128394, "comment_id": 79277710, "body": "Are you certain it doesn&#39;t support it? Do you have an http proxy that works with HTTP2? If you&#39;re trying to use a socks5 proxy, that has nothing to do with the http protocol itself, so that should work regardless."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505137706, "post_id": 46131114, "comment_id": 79276490, "body": "The question is about using a proxy, not unix domain sockets."}, {"owner": {"reputation": 179, "user_id": 680906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d0acd7c48668139953457729851453?s=128&d=identicon&r=PG", "display_name": "whytheplatypus", "link": "https://stackoverflow.com/users/680906/whytheplatypus"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1505227972, "post_id": 46131114, "comment_id": 79321719, "body": "got it, my mistake, I misread the question. A proxy shouldn&#39;t be affected by the http2 implementation though.. I wouldn&#39;t think."}], "tags": [], "owner": {"reputation": 179, "user_id": 680906, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/92d0acd7c48668139953457729851453?s=128&d=identicon&r=PG", "display_name": "whytheplatypus", "link": "https://stackoverflow.com/users/680906/whytheplatypus"}, "is_accepted": false, "score": -1, "last_activity_date": 1504962966, "creation_date": 1504962966, "answer_id": 46131114, "question_id": 46128394, "link": "https://stackoverflow.com/questions/46128394/is-it-possible-to-use-proxy-socks-with-http2-client-in-go/46131114#46131114", "title": "Is it possible to use proxy/socks with http2 client in Go?", "body": "<p>If you're looking to communicate over sockets something like this should work:</p>\n\n<pre><code>socket := \"&lt;socket-path&gt;\"\n// server\nsock, err := net.Listen(\"unix\", socket)\ngo http.Serve(s, nil)\n\n//client\nhttpc := http.Client{\n    Transport: &amp;http.Transport{\n        DialContext: func(_ context.Context, _, _ string) (net.Conn, error) {\n            return net.Dial(\"unix\", socket)\n        },\n    },\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11432657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76914d43c6559766298b8c760fa769f9?s=128&d=identicon&r=PG&f=1", "display_name": "joel", "link": "https://stackoverflow.com/users/11432657/joel"}, "is_accepted": false, "score": 0, "last_activity_date": 1601016330, "last_edit_date": 1601016330, "creation_date": 1600999160, "answer_id": 64056718, "question_id": 46128394, "link": "https://stackoverflow.com/questions/46128394/is-it-possible-to-use-proxy-socks-with-http2-client-in-go/64056718#64056718", "title": "Is it possible to use proxy/socks with http2 client in Go?", "body": "<p>Yes I seem to recall something a while ago about the http2 client not working with HTTP/SOCKS5 proxies. Anyway time has moved on and the below works fine (if that's what you're after). Note that if using a custom DialTLS within the Transport, proxied connections still aren't supported.</p>\n<pre><code>package main\n\nimport (\n    &quot;log&quot;\n    &quot;net/http&quot;\n    &quot;net/url&quot;\n)\n\nfunc main() {\n    var addressString = &quot;https://www.facebook.com/&quot;\n    var proxyString = &quot;socks5://127.0.0.1:9150&quot;\n\n    req, _ := http.NewRequest(&quot;GET&quot;, addressString, nil)\n    tr := &amp;http.Transport{\n        Proxy: func(req *http.Request) (*url.URL, error) {\n            proxyURI, err := url.Parse(proxyString)\n            return proxyURI, err\n        },\n    }\n\n   // The http client is equipped to handle http/2 connections\n    hc := &amp;http.Client{Transport: tr}\n    resp, _ := hc.Do(req)\n    log.Print(resp)\n}\n</code></pre>\n"}], "owner": {"reputation": 21, "user_id": 8583318, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c70f45c1b4c1eea6d37763684ec0682?s=128&d=identicon&r=PG&f=1", "display_name": "Packman", "link": "https://stackoverflow.com/users/8583318/packman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 691, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1601016330, "creation_date": 1504943344, "last_edit_date": 1504944686, "question_id": 46128394, "link": "https://stackoverflow.com/questions/46128394/is-it-possible-to-use-proxy-socks-with-http2-client-in-go", "title": "Is it possible to use proxy/socks with http2 client in Go?", "body": "<p>I found, implementation of transport in http2 package doesn't support proxy/socks for http2 client. Is there an simple way to make it work?</p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1504942353, "post_id": 46128016, "comment_id": 79218944, "body": "&quot;t := appen(a1[:1], 6); a1=append(t, a1[1:])`. Please take the Tour of Go and read the Blog post about slices and append."}, {"owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1504943516, "post_id": 46128016, "comment_id": 79219200, "body": "ok. can you write answer?"}, {"owner": {"reputation": 12311, "user_id": 2095090, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/3vmqn.jpg?s=128&g=1", "display_name": "Vincent van der Weele", "link": "https://stackoverflow.com/users/2095090/vincent-van-der-weele"}, "edited": false, "score": 0, "creation_date": 1504944231, "post_id": 46128016, "comment_id": 79219349, "body": "Also see these useful <a href=\"https://github.com/golang/go/wiki/SliceTricks#insert\" rel=\"nofollow noreferrer\">slice tricks</a>"}], "answers": [{"tags": [], "owner": {"reputation": 56, "user_id": 8411216, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/076324715c8779834391def594ffb0a0?s=128&d=identicon&r=PG", "display_name": "ngurajeka", "link": "https://stackoverflow.com/users/8411216/ngurajeka"}, "is_accepted": false, "score": 3, "last_activity_date": 1504957517, "creation_date": 1504957517, "answer_id": 46130315, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/46130315#46130315", "title": "Insert a value in a slice at a given index", "body": "<p>extending the answer from @Volker, i put the answer here <a href=\"https://play.golang.org/p/3Hla2y2ava\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3Hla2y2ava</a> too if you want to test it.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    array1 := []int{1, 3, 4, 5}\n    array2 := []int{2, 4, 6, 8}\n    temp := append([]int{array2[2]}, array1[1:]...)\n    array1 = append(array1[:1], temp...)\n    fmt.Println(array1)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 157, "user_id": 8489404, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QebrR.jpg?s=128&g=1", "display_name": "lieblos", "link": "https://stackoverflow.com/users/8489404/lieblos"}, "edited": false, "score": 0, "creation_date": 1613232629, "post_id": 46130603, "comment_id": 117014983, "body": "Most may know this, make sure to remember slices are just special references to arrays and in some cases, like if <code>array1</code> is a slice of a slice and the original slice is hanging around somewhere, the append overwrites the next element in the array no matter who else may be using it it. It may cause you a headache <a href=\"https://play.golang.org/p/yelagAXPdKf\" rel=\"nofollow noreferrer\">Go Playground</a>."}, {"owner": {"reputation": 35322, "user_id": 296446, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/36cadb5227b6f43ea886165dd4b35d25?s=128&d=identicon&r=PG", "display_name": "Robert", "link": "https://stackoverflow.com/users/296446/robert"}, "edited": false, "score": 2, "creation_date": 1614711088, "post_id": 46130603, "comment_id": 117467036, "body": "Generous use of the word Simple"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 37, "last_activity_date": 1580007637, "last_edit_date": 1580007637, "creation_date": 1504959379, "answer_id": 46130603, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/46130603#46130603", "title": "Insert a value in a slice at a given index", "body": "<p>Simple, efficient and logical way:</p>\n\n<ol>\n<li>Make sure <code>array1</code> has enough capacity (length) to accomodate the new, insertable element. To do that, append a single element using the builting <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"noreferrer\"><code>append()</code></a> (doesn't matter what that is, it'll get overwritten).</li>\n<li>To insert an element, existing elements must be <em>shifted</em> (copied over to 1 index higher) to make room for that element, e.g. using the builtin <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"noreferrer\"><code>copy()</code></a> (elements you want to insert before).</li>\n<li>Set the element at the proper index, using a single <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">assignment</a>.</li>\n</ol>\n\n<p>In code:</p>\n\n<pre><code>array1 := []int{1, 3, 4, 5}\narray2 := []int{2, 4, 6, 8}\n\narray1 = append(array1, 0)   // Step 1\ncopy(array1[2:], array1[1:]) // Step 2\narray1[1] = array2[2]        // Step 3\n\nfmt.Println(array1)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/KaB62ANim9\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[1 6 3 4 5]\n</code></pre>\n\n<h3>Optimization in special cases</h3>\n\n<p>Note that in some special cases (when the slice element is big, like a big struct), it may be faster to append the last element, and then it's enough to copy 1 less elements (because the appended last element is right where it needs to be).</p>\n\n<p>This is how it looks like:</p>\n\n<pre><code>last := len(array1) - 1\narray1 = append(array1, array1[last]) // Step 1\ncopy(array1[2:], array1[1:last])      // Step 2\narray1[1] = array2[2]                 // Step 3\n</code></pre>\n\n<p>This will result in the same slice. Try this one on the <a href=\"https://play.golang.org/p/YYzmwVAbrNs\" rel=\"noreferrer\">Go Playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 790, "user_id": 1337666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec156d571db0cdc8823f50158d1e64e0?s=128&d=identicon&r=PG", "display_name": "NoAngel", "link": "https://stackoverflow.com/users/1337666/noangel"}, "edited": false, "score": 0, "creation_date": 1530176719, "post_id": 51078807, "comment_id": 89146308, "body": "code above can be easily changed to support another type or 2D array"}, {"owner": {"reputation": 9973, "user_id": 99046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f989b0bf8bfe9eb0bb03c7f6ad722a91?s=128&d=identicon&r=PG", "display_name": "John Gibb", "link": "https://stackoverflow.com/users/99046/john-gibb"}, "edited": false, "score": 2, "creation_date": 1530189343, "post_id": 51078807, "comment_id": 89154485, "body": "Looks good, but I&#39;d probably avoid that if statement at the top and let it panic if you pass in invalid indexes, to conform to how regular slices behave."}], "tags": [], "owner": {"reputation": 790, "user_id": 1337666, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec156d571db0cdc8823f50158d1e64e0?s=128&d=identicon&r=PG", "display_name": "NoAngel", "link": "https://stackoverflow.com/users/1337666/noangel"}, "is_accepted": false, "score": -1, "last_activity_date": 1530176620, "creation_date": 1530176620, "answer_id": 51078807, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/51078807#51078807", "title": "Insert a value in a slice at a given index", "body": "<p>I don't know is it optimal or not, but this piece of code works for me:</p>\n\n<pre><code>func sliceins(arr []int, pos int, elem int) []int { //insert element before pos in slice. if pos &gt;= len(arr) insert into tail\n    if pos &lt; 0 {\n        pos = 0\n    } else if pos &gt;= len(arr) {\n        pos = len(arr)\n    }\n    out := make([]int, len(arr)+1)\n    copy(out[:pos], arr[:pos])\n    out[pos] = elem\n    copy(out[pos+1:], arr[pos:])\n    return out\n}\n</code></pre>\n\n<p>In Your case just call</p>\n\n<pre><code>sliceins(array1, 1, array2[2])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574686913, "post_id": 51311878, "comment_id": 104308439, "body": "this is a duplicate of icza answer."}], "tags": [], "owner": {"reputation": 49229, "user_id": 1001938, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/ufPVV.jpg?s=128&g=1", "display_name": "Don P", "link": "https://stackoverflow.com/users/1001938/don-p"}, "is_accepted": false, "score": 7, "last_activity_date": 1531418405, "creation_date": 1531418405, "answer_id": 51311878, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/51311878#51311878", "title": "Insert a value in a slice at a given index", "body": "<p>I found the question setup pretty tricky to follow.</p>\n\n<p>Rephrased, they want to insert an element. Here we have an array where it's missing the element <code>3</code> and we want to insert it.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    a := []int{1, 2, 4, 5, 6}\n    b := 3\n\n    // Make space in the array for a new element. You can assign it any value.\n    a = append(a, 0)   \n    fmt.Println(a)\n\n    // Copy over elements sourced from index 2, into elements starting at index 3.\n    copy(a[3:], a[2:])  \n    fmt.Println(a)\n\n    a[2] = b         \n    fmt.Println(a)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4199, "user_id": 346335, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4481fa93eb8710047ed4e11a3ac533c8?s=128&d=identicon&r=PG", "display_name": "alastair", "link": "https://stackoverflow.com/users/346335/alastair"}, "edited": false, "score": 0, "creation_date": 1603284343, "post_id": 56593573, "comment_id": 113987626, "body": "It&#39;d be more idiomatic Go to return the array rather than using a pointer argument."}], "tags": [], "owner": {"reputation": 436, "user_id": 7271964, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PfVl2.png?s=128&g=1", "display_name": "fty4", "link": "https://stackoverflow.com/users/7271964/fty4"}, "is_accepted": false, "score": 0, "last_activity_date": 1560504540, "last_edit_date": 1560504540, "creation_date": 1560497918, "answer_id": 56593573, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/56593573#56593573", "title": "Insert a value in a slice at a given index", "body": "<p>Based on icza's post i wrote a function to shift the slice / array which I want to share with you:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    s := []string{\"a\", \"c\", \"d\"}\n    shiftArray(&amp;s, 1, \"b\")\n    fmt.Println(s)\n\n}\n\nfunc shiftArray(array *[]string, position int, value string) {\n    //  extend array by one\n    *array = append(*array, \"\")\n\n    // shift values\n    copy((*array)[position+1:], (*array)[position:])\n\n    // insert value\n    (*array)[position] = value\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1574700786, "post_id": 58747345, "comment_id": 104316115, "body": "plus&#39;d to support answerer, however, i do not endorse to recommend that solution. imho, the OP question is hardly factorized in a function that satisfies as many requirements as the std append builtin function."}], "tags": [], "owner": {"reputation": 886, "user_id": 5506278, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mwBMD.jpg?s=128&g=1", "display_name": "Yaroslav Bai", "link": "https://stackoverflow.com/users/5506278/yaroslav-bai"}, "is_accepted": false, "score": 2, "last_activity_date": 1574700196, "last_edit_date": 1574700196, "creation_date": 1573124521, "answer_id": 58747345, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/58747345#58747345", "title": "Insert a value in a slice at a given index", "body": "<p>The following solution worked for me</p>\n\n<pre><code>func insert(a []int, c int, i int) []int {\n    return append(a[:i], append([]int{c}, a[i:]...)...)\n}\n</code></pre>\n\n<p>You can make it more general via empty interfaces</p>\n\n<pre><code>func insert(a []interface{}, c interface{}, i int) []interface{} {\n    return append(a[:i], append([]interface{}{c}, a[i:]...)...)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1288, "user_id": 7225929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa26a9a36b086d9872cbe4c70355dfd3?s=128&d=identicon&r=PG&f=1", "display_name": "omotto", "link": "https://stackoverflow.com/users/7225929/omotto"}, "is_accepted": false, "score": 0, "last_activity_date": 1578656824, "creation_date": 1578656824, "answer_id": 59681063, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/59681063#59681063", "title": "Insert a value in a slice at a given index", "body": "<p>I answered a similar question in other thread. Anyway I used the following methods to play with slices and index:</p>\n\n<pre><code>func insertInt(array []int, value int, index int) []int {\n    return append(array[:index], append([]int{value}, array[index:]...)...)\n}\n\nfunc removeInt(array []int, index int) []int {\n    return append(array[:index], array[index+1:]...)\n}\n\nfunc moveInt(array []int, srcIndex int, dstIndex int) []int {\n    value := array[srcIndex]\n    return insertInt(removeInt(array, srcIndex), value, dstIndex)\n}\n</code></pre>\n\n<p>You can play with it here:</p>\n\n<p><a href=\"https://play.golang.org/p/Sfu1VsySieS\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Sfu1VsySieS</a></p>\n\n<p>I hope it'll help you</p>\n"}, {"comments": [{"owner": {"reputation": 923, "user_id": 2511892, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/378315f8cf1daaf1641ac2ff7dc1adc1?s=128&d=identicon&r=PG", "display_name": "Steven Eckhoff", "link": "https://stackoverflow.com/users/2511892/steven-eckhoff"}, "edited": false, "score": 3, "creation_date": 1597770949, "post_id": 61822301, "comment_id": 112240699, "body": "This should be the accepted solution. It is the most succinct solution and it comes with benchmarks."}, {"owner": {"reputation": 198, "user_id": 1109065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/49b8f0969fef9e859da59ac70c0732b3?s=128&d=identicon&r=PG", "display_name": "MichaelWang", "link": "https://stackoverflow.com/users/1109065/michaelwang"}, "edited": false, "score": 2, "creation_date": 1611670489, "post_id": 61822301, "comment_id": 116521280, "body": "This is terrific."}], "tags": [], "owner": {"reputation": 8841, "user_id": 8208215, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QXD4t.png?s=128&g=1", "display_name": "wasmup", "link": "https://stackoverflow.com/users/8208215/wasmup"}, "is_accepted": false, "score": 27, "last_activity_date": 1617778989, "last_edit_date": 1617778989, "creation_date": 1589554982, "answer_id": 61822301, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index/61822301#61822301", "title": "Insert a value in a slice at a given index", "body": "<p>A simple <code>append</code> is what you need:</p>\n<pre><code>a = append(a[:index+1], a[index:]...)\na[index] = value\n</code></pre>\n<p>Note: <code>len(a) &gt; 0 &amp;&amp; index &lt; len(a)</code></p>\n<p>Should <code>len(a) == index</code>, meaning <code>nil</code> or empty slice or append after the last element:</p>\n<pre><code>a = append(a, value)\n</code></pre>\n<p>Inserting at the index zero for slice of <code>int</code>s:</p>\n<pre><code>a = append([]int{value}, a...)\n</code></pre>\n<hr />\n<p>All in one function:</p>\n<pre><code>// 0 &lt;= index &lt;= len(a)\nfunc insert(a []int, index int, value int) []int {\n    if len(a) == index { // nil or empty slice or after last element\n        return append(a, value)\n    }\n    a = append(a[:index+1], a[index:]...) // index &lt; len(a)\n    a[index] = value\n    return a\n}\n</code></pre>\n<p>Usage:</p>\n<pre><code>    a := []int{10, 30, 40}\n    a = insert(a, 1, 20)\n    fmt.Println(a) // [10 20 30 40]\n</code></pre>\n<p>And for the OP:</p>\n<pre><code>    slice1 := []int{1, 3, 4, 5}\n    slice2 := []int{2, 4, 6, 8}\n    // slice1 = insert(slice1, 1, slice2[2])\n    slice1 = append(slice1[:2], slice1[1:]...)\n    slice1[1] = slice2[2]\n\n    fmt.Println(slice1) // [1 6 3 4 5]\n</code></pre>\n<hr />\n<p>Benchmark:</p>\n<pre><code>go version\n# go version go1.16.3 linux/amd64\nmake bench\ngo test -benchmem -bench . -args -n 32\n# BenchmarkInsert-8      4125085  275.0 ns/op  512 B/op  1 allocs/op\n# BenchmarkInsert2-8     3778551  316.0 ns/op  512 B/op  1 allocs/op\n\ngo test -benchmem -bench . -args -n 1000\n# BenchmarkInsert-8       198364  5876 ns/op  16384 B/op  1 allocs/op\n# BenchmarkInsert2-8      205197  7123 ns/op  16384 B/op  1 allocs/op\n\ngo test -benchmem -bench . -args -n 1000000\n# BenchmarkInsert-8          643  1898436 ns/op 10002437 B/op  1 allocs/op\n# BenchmarkInsert2-8         368  3248385 ns/op 10002436 B/op  1 allocs/op\n</code></pre>\n<p>Code:</p>\n<pre><code>func insert(a []int, index int, value int) []int {\n    a = append(a[:index+1], a[index:]...) // Step 1+2\n    a[index] = value                      // Step 3\n    return a\n}\nfunc insert2(a []int, index int, value int) []int {\n    last := len(a) - 1\n    a = append(a, a[last])           // Step 1\n    copy(a[index+1:], a[index:last]) // Step 2\n    a[index] = value                 // Step 3\n    return a\n}\nfunc BenchmarkInsert(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        r = insert(a, 2, 42)\n    }\n}\nfunc BenchmarkInsert2(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        r = insert2(a, 2, 42)\n    }\n}\n\nvar (\n    n    = flag.Int(&quot;n&quot;, 32, &quot;buffer length&quot;)\n    a, r []int\n)\n\n// We use TestMain to set up the buffer.\nfunc TestMain(m *testing.M) {\n    flag.Parse()\n    a = make([]int, *n)\n    os.Exit(m.Run())\n}\n</code></pre>\n<p>You may combine the <strong>two</strong> first steps to <strong>one</strong>; by using:</p>\n<pre><code>    a = append(a[:index+1], a[index:]...)\n</code></pre>\n<ol>\n<li>This makes sure the array has enough capacity to accommodate the new element.</li>\n<li>This copies all required elements to one index higher to make room for the new element.</li>\n<li>Set the element at the index, using a single assignment: <code>a[index] = value</code></li>\n</ol>\n<p>Which is more efficient, according to the benchmarks.</p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 31635, "favorite_count": 7, "accepted_answer_id": 46130603, "answer_count": 8, "score": 32, "last_activity_date": 1617778989, "creation_date": 1504940190, "last_edit_date": 1589555251, "question_id": 46128016, "link": "https://stackoverflow.com/questions/46128016/insert-a-value-in-a-slice-at-a-given-index", "title": "Insert a value in a slice at a given index", "body": "<p>Given</p>\n\n<pre><code>array1 := []int{1, 3, 4, 5}\narray2 := []int{2, 4, 6, 8}\n</code></pre>\n\n<p>I want to insert <code>array2[2]</code> i.e <code>6</code> at <code>array1[1]</code> i.e before <code>3</code> so that <code>array1</code> becomes a slice of <code>{1, 6, 3, 4, 5}</code>. How can I do it?</p>\n\n<p>Most the techniques I read online involve using the <code>:</code> operator but results in remaining elements being inserted as well. How can I append single values at an index in a slice?</p>\n"}, {"tags": ["elasticsearch", "go"], "comments": [{"owner": {"reputation": 1917, "user_id": 4039768, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EWQUf.jpg?s=128&g=1", "display_name": "Mohsin", "link": "https://stackoverflow.com/users/4039768/mohsin"}, "edited": false, "score": 1, "creation_date": 1504937172, "post_id": 46127434, "comment_id": 79217756, "body": "Welcome to SO. Try to include your code in question (if any). What you&#39;ve tried so far? Please refer <a href=\"https://stackoverflow.com/help/how-to-ask\">this</a>. Also read this: <a href=\"https://stackoverflow.com/help/mcve\">How to create a Minimal, Complete, and Verifiable example</a>"}, {"owner": {"reputation": 665, "user_id": 4415231, "user_type": "registered", "accept_rate": 50, "profile_image": "https://lh6.googleusercontent.com/-kXwrSXDWkqg/AAAAAAAAAAI/AAAAAAAAACI/7MVHVlhQr5Q/photo.jpg?sz=128", "display_name": "prasad kp", "link": "https://stackoverflow.com/users/4415231/prasad-kp"}, "edited": false, "score": 0, "creation_date": 1504964799, "post_id": 46127434, "comment_id": 79224834, "body": "please add the query"}], "owner": {"reputation": 11, "user_id": 8529299, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c29c62433cb59764269aeef9e11dab4?s=128&d=identicon&r=PG&f=1", "display_name": "Michael H.", "link": "https://stackoverflow.com/users/8529299/michael-h"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 230, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1504972204, "creation_date": 1504935042, "last_edit_date": 1504972204, "question_id": 46127434, "link": "https://stackoverflow.com/questions/46127434/elasticsearch-append-to-array-in-golang", "title": "Elasticsearch Append to Array in Golang", "body": "<p>Using elasticsearch 5.x and the olivere Elastic package.  </p>\n\n<p>I'm using the elastic package for Go to communicate with elasticsearch. Currently, I'm trying to append to an array within one of my JSON documents; however, I haven't been successful in doing so. How does one append to array fields in elasticsearch, using the olivere elastic package?</p>\n\n<pre><code>script := elastic.NewScript(\"ctx._source.Likes.add(Params.newCont)\").Params(map[string]interface{}{\"newCont\" : newContent})\n_, err = eclient.Update().\n    Index(ENTRY_INDEX).\n    Type(ENTRY_TYPE).\n    Id(\"1\").\n    Script(script).\n    Do(ctx)\n</code></pre>\n\n<p>Doing this does not successfully append anything to my array</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 1, "creation_date": 1504903447, "post_id": 46124232, "comment_id": 79211262, "body": "The JSON you posted is invalid somewhere..."}], "answers": [{"comments": [{"owner": {"reputation": 5672, "user_id": 485352, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/32550cd9f1492acdedd71fe82ee95267?s=128&d=identicon&r=PG", "display_name": "Christian Gossain", "link": "https://stackoverflow.com/users/485352/christian-gossain"}, "edited": false, "score": 0, "creation_date": 1585426787, "post_id": 46124266, "comment_id": 107756713, "body": "The tool you linked to is incredible, thanks for sharing. I just had to delete some duplicate definitions but otherwise it generated a perfect struct. Thanks again!"}, {"owner": {"reputation": 83, "user_id": 6951055, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0003c79a5adeff76cdf2537a8858fd7c?s=128&d=identicon&r=PG", "display_name": "Moo Master", "link": "https://stackoverflow.com/users/6951055/moo-master"}, "edited": false, "score": 0, "creation_date": 1592406003, "post_id": 46124266, "comment_id": 110415023, "body": "Agreed! This is actually an awesome tool - saved me sooo many hours"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 11, "last_activity_date": 1504903465, "creation_date": 1504903465, "answer_id": 46124266, "question_id": 46124232, "link": "https://stackoverflow.com/questions/46124232/go-parse-nested-json-array/46124266#46124266", "title": "GO parse nested json array", "body": "<p>It's an array of arrays of strings, not an array of structs containing arrays of structs containing strings, so you want something more like:</p>\n\n<pre><code>type response struct {\n    Meta struct {\n        Lv []struct {\n            Response struct {\n                Data [][]string `json:\"data\"`\n            } `json:\"response\"`\n        } `json:\"lv1\"`\n    } `json:\"meta\"`\n}\n</code></pre>\n\n<p>(I also changed the all-caps field names to match expected Go code style.)</p>\n\n<p>For what it's worth, there is a handy JSON-to-Go tool <a href=\"https://mholt.github.io/json-to-go/\" rel=\"noreferrer\">here</a> which gave me this for your input, after deleting the <code>some data</code> bit (which made the JSON invalid):</p>\n\n<pre><code>type AutoGenerated struct {\n    Meta struct {\n        Type        string `json:\"type\"`\n        Application string `json:\"application\"`\n        Data0       struct {\n        } `json:\"data0\"`\n        Lv1 []struct {\n            Status       string `json:\"status\"`\n            ResponseType string `json:\"response-type\"`\n            Message      struct {\n            } `json:\"message\"`\n            Response struct {\n                MoreData    string     `json:\"more_data\"`\n                NoResult    string     `json:\"no_result\"`\n                CurrentPage string     `json:\"current_page\"`\n                Data        [][]string `json:\"data\"`\n            } `json:\"response\"`\n        } `json:\"lv1\"`\n    } `json:\"meta\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 101, "user_id": 8580601, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/48d1f722aa37e73e3e91872b3936c56d?s=128&d=identicon&r=PG&f=1", "display_name": "lmln", "link": "https://stackoverflow.com/users/8580601/lmln"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2519, "favorite_count": 0, "accepted_answer_id": 46124266, "answer_count": 1, "score": 2, "last_activity_date": 1504927866, "creation_date": 1504903228, "last_edit_date": 1504927866, "question_id": 46124232, "link": "https://stackoverflow.com/questions/46124232/go-parse-nested-json-array", "title": "GO parse nested json array", "body": "<pre><code>{\n    \"meta\": {\n       \"type\": \"RESPONSE\",\n       \"application\": \"\",\n       \"data0\": {\n         some data\n       },\n      \"lv1\": [\n      {\n        \"status\": \"SUCCESS\",\n        \"response-type\": \"JSON\",\n        \"message\": {},\n        \"response\": {\n        \"more_data\": \"TRUE\",\n        \"no_result\": \"5\",\n        \"current_page\": \"1\",\n        \"data\": [[\n         \"1\",\n         \"2\", \n         \"3\"]]\n        }\n      }\n     ]\n   }\n}\n</code></pre>\n\n<hr>\n\n<pre><code>type response struct {\n    META struct {\n        LV []struct {\n            RESPONSE struct {\n                Data []struct {\n                    array []struct {\n                        val []string\n                    }\n                } `json:\"data\"`\n            } `json:\"response\"`\n        } `json:\"lv1\"`\n    } `json:\"meta\"`\n\n}\n</code></pre>\n\n<p>How can I get the values in the following?</p>\n\n<pre><code>\"data\": [[\n         \"1\",\n         \"2\", \n         \"3\"]]\n</code></pre>\n\n<p>I've tried both interface and struct. Using interface results in <code>[1 2 3]</code> of interface type and I'm not sure how I can get the values. When using struct, I ran into problem when trying to map an array of array with error message:</p>\n\n<blockquote>\n  <p>\"cannot unmarshal array into Go struct field .data of type struct {\n  vals []string }\"</p>\n</blockquote>\n"}, {"tags": ["database", "go", "reflection"], "comments": [{"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1504890467, "post_id": 46121289, "comment_id": 79205465, "body": "Calling <code>make</code> for the slice of values creates new variables, which will have different memory addresses each time this code is run. The loop is required because you can&#39;t get the memory addresses (pointers) of each item in the slice any other way."}, {"owner": {"reputation": 61, "user_id": 6101424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a3fc1262537fbc28243755c84a679c1?s=128&d=identicon&r=PG&f=1", "display_name": "wunt", "link": "https://stackoverflow.com/users/6101424/wunt"}, "reply_to_user": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1507560265, "post_id": 46121289, "comment_id": 80247355, "body": "Yes, but why it should be done several times? I think <code>make</code> could be executed once near define statement. Or it is way to clean values?"}, {"owner": {"reputation": 5044, "user_id": 1276480, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/v8UB8.jpg?s=128&g=1", "display_name": "RayfenWindspear", "link": "https://stackoverflow.com/users/1276480/rayfenwindspear"}, "edited": false, "score": 0, "creation_date": 1507581742, "post_id": 46121289, "comment_id": 80258601, "body": "There isn&#39;t a problem with leaving the <code>make</code> calls local to the function. If you made them global (which I assume is what you are suggesting), that memory never gets released. If they only exist in the function, all that memory is released when the function exits. It just makes the most sense to declare locally over globally."}], "answers": [{"tags": [], "owner": {"reputation": 24536, "user_id": 111124, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/8215e290861f1c44a457d26c4f24af70?s=128&d=identicon&r=PG", "display_name": "Andrew", "link": "https://stackoverflow.com/users/111124/andrew"}, "is_accepted": false, "score": 0, "last_activity_date": 1504903370, "creation_date": 1504903370, "answer_id": 46124253, "question_id": 46121289, "link": "https://stackoverflow.com/questions/46121289/how-to-call-the-scan-variadic-function-in-golang-using-reflection-without-looped/46124253#46124253", "title": "how to call the Scan variadic function in Golang using reflection without looped ptrs?", "body": "<p>As I understand it from : <a href=\"https://golang.org/pkg/database/sql/#Rows.Scan\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#Rows.Scan</a></p>\n\n<p>\"Scan copies the columns in the current row into the values pointed at by dest. \"</p>\n\n<p>When you are passing it in specific fields you would use:</p>\n\n<pre><code>rows.scan(&amp;myfield1, &amp;myfield2)\n</code></pre>\n\n<p>But in your instance you are passing in an array, and the address of the array is not really what you want to send in, Rayfen is right in his comment above -\n consider the alternative:</p>\n\n<pre><code>rows.scan(&amp;values)\n</code></pre>\n\n<p>That would be a pointer to a single object, not an array of pointers which is what you really are after, so you have to perform that loop so you can send in an array of pointers to the destination variables, not a pointer to the array.</p>\n"}], "owner": {"reputation": 61, "user_id": 6101424, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3a3fc1262537fbc28243755c84a679c1?s=128&d=identicon&r=PG&f=1", "display_name": "wunt", "link": "https://stackoverflow.com/users/6101424/wunt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 151, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1507560743, "creation_date": 1504889698, "last_edit_date": 1507560743, "question_id": 46121289, "link": "https://stackoverflow.com/questions/46121289/how-to-call-the-scan-variadic-function-in-golang-using-reflection-without-looped", "title": "how to call the Scan variadic function in Golang using reflection without looped ptrs?", "body": "<p>I found an answer about <a href=\"https://stackoverflow.com/questions/17845619/how-to-call-the-scan-variadic-function-in-golang-using-reflection/17885636#17885636\">how to call the Scan variadic function in Golang using reflection</a>. And don't have reputation to ask in there.</p>\n\n<p>Here the main part of code:</p>\n\n<pre><code>values := make([]interface{}, count)\nvaluePtrs := make([]interface{}, count)\n\nfor rows.Next() { \n    for i, _ := range columns {\n        valuePtrs[i] = &amp;values[i]\n    }    \n    rows.Scan(valuePtrs...)\n    ...\n}\n</code></pre>\n\n<p>And I don't get why is this statement have to be looped? Why <code>for</code> is in <code>for rows.Next</code>?</p>\n\n<pre><code>for rows.Next() { \n  for i, _ := range columns { valuePtrs[i] = &amp;values[i] }\n  ..\n}\n</code></pre>\n\n<p>Would valuePtrs be different on each iteration in golang? Or it's just mistake?</p>\n"}, {"tags": ["http", "go", "block", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1504887470, "post_id": 46120712, "comment_id": 79203997, "body": "You have a busy loop in your code. Don&#39;t do that."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1504893089, "post_id": 46120712, "comment_id": 79206624, "body": "What JimB said: Never ever do a <code>for {}</code>. Never. No arguing."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1504900344, "post_id": 46120712, "comment_id": 79209980, "body": "You also have a race condition on <code>bb</code>. And you can figure out where it&#39;s blocking by issuing a SIGQUIT to the process, which will <a href=\"https://golang.org/pkg/os/signal/#hdr-Default_behavior_of_signals_in_Go_programs\" rel=\"nofollow noreferrer\">trigger a stack dump</a>."}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8582816"}, "is_accepted": false, "score": 0, "last_activity_date": 1505293039, "creation_date": 1505293039, "answer_id": 46193120, "question_id": 46120712, "link": "https://stackoverflow.com/questions/46120712/goroutine-soon-blocked-the-http-server-when-it-was-requested/46193120#46193120", "title": "goroutine soon blocked the http server when it was requested", "body": "<p>I think there is no switching point.<br>\nthe Go scheduler is non preemptive. (cooperative)<br>\nall goroutines must be cooperative of scheduling</p>\n\n<pre><code>func main() {\n    go c()\n    for {\n        // it is not cooperative\n    }\n}\n</code></pre>\n\n<p><br><br>\nthe Go scheduler can switch only at specific points. <br>\nspecific points is I/O, chan, Sleep, Gosched</p>\n\n<p>try below code on block example</p>\n\n<pre><code>func main() {\n    go c()\n    for {\n        runtime.Gosched() // or time.Sleep(any)\n    }\n}\n</code></pre>\n\n<p><br>\nI hope this would help you</p>\n"}], "owner": {"reputation": 1, "user_id": 8580992, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff449c9a2a4a3287803cb8d18c9a3f3d?s=128&d=identicon&r=PG&f=1", "display_name": "tako", "link": "https://stackoverflow.com/users/8580992/tako"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1505293039, "creation_date": 1504887335, "question_id": 46120712, "link": "https://stackoverflow.com/questions/46120712/goroutine-soon-blocked-the-http-server-when-it-was-requested", "title": "goroutine soon blocked the http server when it was requested", "body": "<p><strong>goroutine sooblocked the http server when it was reqn uested</strong></p>\n\n<p>The following code will soon be blocked</p>\n\n<p>In a device management function, by visiting the http REST ful interface to determine whether the device is online, 30s access to 1000 devices, the current program is roughly as follows to see the number of goroutine is not very high, but soon the program will not Move, cpu, memory is not occupied too high</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc a() {\n    b()\n    //.....\n}\n\nvar bb = 0\n\nfunc b() {\n    fmt.Printf(\"b:%d\\n\", bb)\n    bb++\n    resp, err := http.Get(\"http://www.baidu.com\")\n    if err == nil {\n        resp.Body.Close()\n    }\n    //...\n}\nfunc c() {\n    t := time.NewTicker(time.Second * 30)\n    for {\n        fmt.Printf(\"start time:%s\\n\", time.Now().Format(\"15:04:05\"))\n        bb = 0\n        for i := 0; i &lt; 1000; i++ {\n            go a()\n            if i%11 == 0 {\n                time.Sleep(time.Millisecond * 300)\n                fmt.Printf(\"i:%d go:%d\\n\", i, runtime.NumGoroutine())\n            }\n        }\n        &lt;-t.C\n        fmt.Printf(\"over time:%s\\n\", time.Now().Format(\"15:04:05\"))\n    }\n}\nfunc main() {\n    go c()\n    for {\n\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/7Es2j.png\" rel=\"nofollow noreferrer\">block</a></p>\n\n<p>The following code will not block\uff0cThis is why, hope to give me some advice, thank you</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"runtime\"\n    \"time\"\n)\n\nfunc a() {\n    b()\n}\n\nvar bb = 0\n\nfunc b() {\n    fmt.Printf(\"b:%d\\n\", bb)\n    bb++\n    resp, err := http.Get(\"http://www.baidu.com\")\n    if err == nil {\n        resp.Body.Close()\n    }\n\n}\n\nfunc main() {\n    for {\n        for {\n        go b()\n        time.Sleep(time.Millisecond * 10)\n        fmt.Printf(\"go:%d\\n\", runtime.NumGoroutine())\n    }\n}\n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/wkm7j.png\" rel=\"nofollow noreferrer\">no-block</a></p>\n"}, {"tags": ["math", "go"], "comments": [{"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 2, "creation_date": 1504883975, "post_id": 46119678, "comment_id": 79201993, "body": "Need an explicit conversion first, i.e. <code>math.Pow(10, float32(value\u2212109) &#47; 32)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 195, "user_id": 1133061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef1ce6a1ef5e8b4a544a7391c741acbd?s=128&d=identicon&r=PG", "display_name": "Grrrben", "link": "https://stackoverflow.com/users/1133061/grrrben"}, "edited": false, "score": 0, "creation_date": 1504898387, "post_id": 46119854, "comment_id": 79209133, "body": "Thank you, after changing one bracket your example workt perffectly for me <code>math.Pow(10, (float64(value) - 109) &#47; 32)</code>"}], "tags": [], "owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "is_accepted": true, "score": 3, "last_activity_date": 1504884438, "creation_date": 1504884438, "answer_id": 46119854, "question_id": 46119678, "link": "https://stackoverflow.com/questions/46119678/go-uint8-to-float32/46119854#46119854", "title": "Go uint8 to float32", "body": "<ol>\n<li>There is no <code>\u00f7</code> operator in Go and <code>^</code> is a bitwise XOR, you need to use <code>Pow</code> functions from <code>math</code> package</li>\n<li>Go is very strict about type conversions, so it disallows implicit type conversions in many cases (so unsigned integer to floating point is not valid), so you need explicitly convert it with <code>type(expr)</code>, i.e. <code>float32(1)</code></li>\n</ol>\n\n<p>That said:</p>\n\n<pre><code>intensity = float32(math.Pow(10, float64((value - 109) / 32)))\n// - OR -\nintensity = float32(math.Pow10(int((value - 109) / 32)))\n</code></pre>\n"}], "owner": {"reputation": 195, "user_id": 1133061, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ef1ce6a1ef5e8b4a544a7391c741acbd?s=128&d=identicon&r=PG", "display_name": "Grrrben", "link": "https://stackoverflow.com/users/1133061/grrrben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "accepted_answer_id": 46119854, "answer_count": 1, "score": -3, "last_activity_date": 1504884438, "creation_date": 1504883818, "last_edit_date": 1504883991, "question_id": 46119678, "link": "https://stackoverflow.com/questions/46119678/go-uint8-to-float32", "title": "Go uint8 to float32", "body": "<p>I'm trying to learn Go and working on a rain intensity tool. \nFor this tool I have to make a calculation like this:</p>\n\n<pre><code>var intensity float32\nintensity = 10^((value\u2212109)\u00f732)\n</code></pre>\n\n<p>The value is an <code>uint8</code>, ranging from 0 to 255. The intensity variable is a float. </p>\n\n<p>However, Go tells me that </p>\n\n<blockquote>\n  <p>cannot use 10 ^ (value - 109) / 32 (type uint8) as type float32 in assignment</p>\n</blockquote>\n\n<p>How can I solve this?</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1504889743, "post_id": 46118462, "comment_id": 79205137, "body": "In case you want to avoid at least the double <code>xmlns</code> after <code>Marshal</code> you could change the <code>XMLName</code> tag from <code>xml:&quot;&quot;</code> to <code>xml:&quot;foo&quot;</code>. As far as the main issue goes, seems to me that <code>any</code> implies the behaviour you see and I don&#39;t think there&#39;s some other method that uses tags to change that behaviour. You might want to look at the <code>Unmarshaler</code> interface, i believe you should be able to utilize that."}], "owner": {"reputation": 118578, "user_id": 421223, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/9906fd74f88c426d7d370e877e1f3cbb?s=128&d=identicon&r=PG", "display_name": "KingCrunch", "link": "https://stackoverflow.com/users/421223/kingcrunch"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 74, "favorite_count": 0, "answer_count": 0, "score": 3, "last_activity_date": 1504879872, "creation_date": 1504879872, "question_id": 46118462, "link": "https://stackoverflow.com/questions/46118462/duplicated-attribute-when-using-both-xml-name-and-xml-attr", "title": "Duplicated attribute when using both xml.Name and []xml.Attr", "body": "<p>When I use a struct like</p>\n\n<pre><code>type MyStruct struct {\n    XMLName xml.Name\n    Attrs []xml.Attrs `xml:\",attr,any\"`\n}\n</code></pre>\n\n<p>The Namespace taken from the <code>xmlns</code>-attribute is both an attribute in <code>Attrs</code> and the value of <code>XMLName.Space</code>. That is unfortunate, because I'd expect, that <code>Attrs</code> only contains only attributes, that are not handled elsewhere</p>\n\n<p>Even worse, when I marshal and unmarshal an XML I'd expect to get the same XML. Instead I get something, that looks broken. <code>xmlns</code> is doubled</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\n\nfunc main() {\n    var Foo struct {\n        XMLName xml.Name `xml:\"\"`\n        Attr []xml.Attr `xml:\",attr,any\"`\n    } = struct {\n        XMLName xml.Name `xml:\"\"`\n        Attr []xml.Attr `xml:\",attr,any\"`\n    }{}\n\n    str := `\n&lt;foo xmlns=\"bar\"/&gt;\n    `\n\n    fmt.Println(str)\n    xml.Unmarshal([]byte(str), &amp;Foo)\n    b, _ := xml.Marshal(&amp;Foo)\n    fmt.Println(string(b))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ulWy-Paha2\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ulWy-Paha2</a></p>\n\n<p>Results in</p>\n\n<pre><code>&lt;foo xmlns=\"bar\"/&gt;\n\n&lt;foo xmlns=\"bar\" xmlns=\"bar\"&gt;&lt;/foo&gt;\n</code></pre>\n\n<p>How can I avoid this? Is there's a way to tell the decoder to simply ignore certain attributes completely?</p>\n"}, {"tags": ["json", "go", "swagger", "swagger-2.0", "openapi"], "comments": [{"owner": {"reputation": 128862, "user_id": 6819, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/20cd0e7eb3c9eeeafb8ef081d3b516e0?s=128&d=identicon&r=PG", "display_name": "Darrel Miller", "link": "https://stackoverflow.com/users/6819/darrel-miller"}, "edited": false, "score": 0, "creation_date": 1504923405, "post_id": 46118041, "comment_id": 79215662, "body": "What protocol are the WSDL bindings?  Are they SOAP or HTTP bindings?"}, {"owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "reply_to_user": {"reputation": 128862, "user_id": 6819, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/20cd0e7eb3c9eeeafb8ef081d3b516e0?s=128&d=identicon&r=PG", "display_name": "Darrel Miller", "link": "https://stackoverflow.com/users/6819/darrel-miller"}, "edited": false, "score": 0, "creation_date": 1504936577, "post_id": 46118041, "comment_id": 79217645, "body": "@DarrelMiller http bindings"}, {"owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "reply_to_user": {"reputation": 128862, "user_id": 6819, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/20cd0e7eb3c9eeeafb8ef081d3b516e0?s=128&d=identicon&r=PG", "display_name": "Darrel Miller", "link": "https://stackoverflow.com/users/6819/darrel-miller"}, "edited": false, "score": 0, "creation_date": 1504936721, "post_id": 46118041, "comment_id": 79217672, "body": "@DarrelMiller or else suggest me an example code of swagger 2.0 implementation using golang. all i want is the output has to be swagger 2.0 format"}, {"owner": {"reputation": 128862, "user_id": 6819, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/20cd0e7eb3c9eeeafb8ef081d3b516e0?s=128&d=identicon&r=PG", "display_name": "Darrel Miller", "link": "https://stackoverflow.com/users/6819/darrel-miller"}, "edited": false, "score": 0, "creation_date": 1504968396, "post_id": 46118041, "comment_id": 79225949, "body": "I&#39;m not aware of any Go based tooling that will output OpenAPI/.."}], "answers": [{"tags": [], "owner": {"reputation": 1183, "user_id": 4274484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/0dPT2.jpg?s=128&g=1", "display_name": "hypnoglow", "link": "https://stackoverflow.com/users/4274484/hypnoglow"}, "is_accepted": false, "score": 0, "last_activity_date": 1505224314, "creation_date": 1505224314, "answer_id": 46178250, "question_id": 46118041, "link": "https://stackoverflow.com/questions/46118041/xml-to-swagger-2-0-spec-conversion-using-golang/46178250#46178250", "title": "xml to swagger 2.0 spec conversion using golang", "body": "<p>I suggest you take a look at these libraries: <a href=\"https://github.com/go-openapi\" rel=\"nofollow noreferrer\">https://github.com/go-openapi</a>.\nI use them and they allow you to do pretty much everything you need.</p>\n\n<p>You can use them to build the swagger 2.0 spec dynamically. But of course, you will need to write your custom code to parse your XML, convert it to swagger structures and after all, you will be able to write your dynamically created spec to the file in <code>json</code> or <code>yaml</code> format.</p>\n"}, {"tags": [], "owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "is_accepted": false, "score": 0, "last_activity_date": 1505531157, "creation_date": 1505531157, "answer_id": 46249649, "question_id": 46118041, "link": "https://stackoverflow.com/questions/46118041/xml-to-swagger-2-0-spec-conversion-using-golang/46249649#46249649", "title": "xml to swagger 2.0 spec conversion using golang", "body": "<p>I solved it by using API transformer (<a href=\"https://apimatic.io\" rel=\"nofollow noreferrer\">https://apimatic.io</a>) It is providing APU for conversion between all different API specs. Hope this helps.</p>\n"}], "owner": {"reputation": 51, "user_id": 7144676, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/04a4329266dae70cc14af9e22175b555?s=128&d=identicon&r=PG&f=1", "display_name": "vijay varikol", "link": "https://stackoverflow.com/users/7144676/vijay-varikol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1837, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1505531157, "creation_date": 1504878554, "question_id": 46118041, "link": "https://stackoverflow.com/questions/46118041/xml-to-swagger-2-0-spec-conversion-using-golang", "title": "xml to swagger 2.0 spec conversion using golang", "body": "<p>I am having trouble converting xml (WSDL) to swagger 2.0 specs in golang. i found a library on github that converts xml to normal json but i need to convert to swagger 2.0 json. suggest me libraries if any. Thanks in advance!</p>\n"}]