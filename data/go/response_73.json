[{"tags": ["go", "youtube-api"], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 6411976, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206752879565512/picture?type=large", "display_name": "Vinh Nguyen", "link": "https://stackoverflow.com/users/6411976/vinh-nguyen"}, "is_accepted": true, "score": 2, "last_activity_date": 1464859956, "creation_date": 1464859956, "answer_id": 37587930, "question_id": 37580162, "link": "https://stackoverflow.com/questions/37580162/youtube-content-id-api-always-return-not-found/37587930#37587930", "title": "Youtube Content ID API always return Not Found", "body": "<p>I found the answer! </p>\n\n<p>Because I used <a href=\"https://support.google.com/cloud/answer/6158849?hl=en#serviceaccounts\" rel=\"nofollow\">Google Service Account</a> to interact with Google API. It seems to create a new user account. So that I have to grant permission on Youtube CMS by adding Service account client email to Youtube CMS. Finally, I can access Youtube CMS using the API.</p>\n"}], "owner": {"reputation": 21, "user_id": 6411976, "user_type": "registered", "profile_image": "https://graph.facebook.com/10206752879565512/picture?type=large", "display_name": "Vinh Nguyen", "link": "https://stackoverflow.com/users/6411976/vinh-nguyen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 37587930, "answer_count": 1, "score": 0, "last_activity_date": 1464859956, "creation_date": 1464822212, "question_id": 37580162, "link": "https://stackoverflow.com/questions/37580162/youtube-content-id-api-always-return-not-found", "title": "Youtube Content ID API always return Not Found", "body": "<p>My account is connected to a CMS but I can't see Youtube Content ID in API Library. However, I see it in my Enabled APIs!! (It appeared after I try \"Authorize requests using OAuth 2.0\" in Youtube Content ID API reference doc). I can test the API in reference doc and it shows data from my CMS. But when I call the API from my program, the response is always like this:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>{\n \"error\": {\n  \"errors\": [\n   {\n    \"domain\": \"global\",\n    \"reason\": \"notFound\",\n    \"message\": \"Not Found\"\n   }\n  ],\n  \"code\": 404,\n  \"message\": \"Not Found\"\n }\n}\n</code></pre>\n\n<p>This is my implementation using Go:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>func TestYoutubeAPI(w http.ResponseWriter, r *http.Request)  {\n    data, err := ioutil.ReadFile(\"./google-service-key.json\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    config, err := google.JWTConfigFromJSON(data, \"https://www.googleapis.com/auth/youtubepartner\", \"https://www.googleapis.com/auth/youtube.force-ssl\", \"https://www.googleapis.com/auth/youtube\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    client := config.Client(oauth2.NoContext)\n\n    request, _ := http.NewRequest(\"GET\", \"https://www.googleapis.com/youtube/partner/v1/assetSearch\", nil)\n    request.Header.Add(\"Accept\", \"application/json\")\n\n    query := request.URL.Query()\n    query.Add(\"createdAfter\",\"2015-01-29T23:00:00Z\")\n    query.Add(\"key\", \"XXX\")\n    request.URL.RawQuery = query.Encode()\n\n    response, err := client.Do(request)\n\n    if err != nil {\n        fmt.Fprintln(w, err)\n    } else {\n        responseBody, _ := ioutil.ReadAll(response.Body)\n        fmt.Println(response.Status)\n        fmt.Fprintln(w, string(responseBody))\n    }\n}\n</code></pre>\n\n<p>Other APIs (Youtube Data API) work fine with this code. However, I can't get my expected result with Youtube Content ID API. </p>\n\n<p>Anyone got experience in this please help me. Thank you. </p>\n"}, {"tags": ["regex", "go", "gorilla"], "answers": [{"comments": [{"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1464873822, "post_id": 37580758, "comment_id": 62671074, "body": "I think that way it matches more routes than it should, isn&#39;t it ? <a href=\"https://play.golang.org/p/uvxjxrfDrE\" rel=\"nofollow noreferrer\">play.golang.org/p/uvxjxrfDrE</a>"}, {"owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1464886202, "post_id": 37580758, "comment_id": 62680456, "body": "If that were the case, shouldn&#39;t <code>prefix.api.xsandbox.example.com</code> have returned <code>hello world</code>?"}, {"owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1464892262, "post_id": 37580758, "comment_id": 62683956, "body": "@Theuserwithnohat updated with the generated host regexes."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1465446205, "post_id": 37580758, "comment_id": 62906587, "body": "I don&#39;t quite understand... is the actual/final regex different than what you type in the route ? Does gorilla mux add its own flavour on top of the std regex? The question is not only what regex is required but also how it works  (i.e. why my regex doesn&#39;t work)"}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1465454617, "post_id": 37580758, "comment_id": 62909870, "body": "concerning the previous comment  <code>prefix.api.xsandbox.example.com</code> shouldn&#39;t match any route because I&#39;ve defined only <code>prefix.api.sandbox.example.com</code> and <code>prefix.api.example.com</code>.  To match <code>prefix.api.xsandbox.example.com</code> I think there should have been a wildcard before &quot;sandbox&quot; which is not the case."}, {"owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1465493565, "post_id": 37580758, "comment_id": 62936407, "body": "@Theuserwithnohat - Did you look at my example, or try running it? <code>xsandbox</code> <i>does not</i> match. If you look at my updated answer, you can see for yourself exactly how the regex is constructed by mux. This should be more than enough to sort out why yours is failing."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1465555007, "post_id": 37580758, "comment_id": 62961872, "body": "How do you know that&#39;s how mux constructs the regex? Could you point me to the documentation(if any ) or source code?"}, {"owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1465588259, "post_id": 37580758, "comment_id": 62981730, "body": "@Theuserwithnohat because I added debug to the <code>mux</code> code and checked... <a href=\"https://github.com/gorilla/mux/blob/master/regexp.go#L113\" rel=\"nofollow noreferrer\">github.com/gorilla/mux/blob/master/regexp.go#L113</a>"}], "tags": [], "owner": {"reputation": 3740, "user_id": 1246282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e2c2f18588f9771a7db500e90a6eb44?s=128&d=identicon&r=PG", "display_name": "chrsblck", "link": "https://stackoverflow.com/users/1246282/chrsblck"}, "is_accepted": true, "score": 2, "last_activity_date": 1464892199, "last_edit_date": 1464892199, "creation_date": 1464826565, "answer_id": 37580758, "question_id": 37579525, "link": "https://stackoverflow.com/questions/37579525/how-to-match-subdomain-with-gorilla-mux/37580758#37580758", "title": "How to match subdomain with gorilla mux", "body": "<p>The <code>^</code> and <code>$</code> metacharacters for matching beginning and end of lines should be removed, the parens can be as well.</p>\n\n<pre><code>route := router.Host(`prefix.api{_:|\\.sandbox}.example.com`)`\n</code></pre>\n\n<p>My hosts file:</p>\n\n<pre><code>\u25cb grep prefix /etc/hosts\n127.0.0.1   prefix.api.example.com\n127.0.0.1   prefix.api.sandbox.example.com\n127.0.0.1   prefix.api.xsandbox.example.com\n</code></pre>\n\n<p>Gives me the following:</p>\n\n<pre><code>\u25cb curl prefix.api.example.com:8000\nhello world%                                                                                                                                                                                                                                                                    \n\u25cb curl prefix.api.sandbox.example.com:8000\nhello world%                                                                                                                                                                                                                                                                    \n\u25cb curl prefix.api.xsandbox.example.com:8000\n404 page not found\n</code></pre>\n\n<p><strong>Updated:</strong></p>\n\n<p>Here are the regexes generated by the two different <code>.Host()</code>'s:</p>\n\n<pre><code>route :=  router.Host(`prefix.api{_:(^$|^\\.sandbox$)}.example.com`)\n</code></pre>\n\n<p>regexp: <code>^prefix\\.api(?P&lt;v0&gt;(^$|^\\.sandbox$))\\.example\\.com$</code></p>\n\n<pre><code>route := router.Host(`prefix.api{_:|\\.sandbox}.example.com`)\n</code></pre>\n\n<p>regexp: <code>^prefix\\.api(?P&lt;v0&gt;|\\.sandbox)\\.example\\.com$</code></p>\n\n<ul>\n<li>Example tests for both regexes can be played with\n<a href=\"https://play.golang.org/p/VPnxnHziTC\" rel=\"nofollow\">here</a> at play.golang</li>\n</ul>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1138, "favorite_count": 2, "accepted_answer_id": 37580758, "answer_count": 1, "score": 2, "last_activity_date": 1464892199, "creation_date": 1464818531, "last_edit_date": 1464819999, "question_id": 37579525, "link": "https://stackoverflow.com/questions/37579525/how-to-match-subdomain-with-gorilla-mux", "title": "How to match subdomain with gorilla mux", "body": "<p>I need to build a route which matches two subdomains(prefix.api.example.com and prefix.api.sandbox.example.com) using gorilla <a href=\"https://godoc.org/github.com/gorilla/mux#Router.Host\" rel=\"nofollow\">mux</a> router. So far I have the regex below but the router returns 404 on requests. Any idea why is that?</p>\n\n<pre><code>router := mux.NewRouter()\nroute :=  router.Host(`prefix.api{_:(^$|^\\.sandbox$)}.example.com`)\n</code></pre>\n\n<p>More code</p>\n\n<pre><code>package main\n\nimport(\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\ntype handler struct{}\n\nfunc (_ handler)ServeHTTP(w http.ResponseWriter, r *http.Request){\n    w.Write([]byte(\"hello world\"))\n    w.WriteHeader(200)\n\n}\nfunc main() {\n    router := mux.NewRouter().StrictSlash(true)\n    route :=  router.Host(`prefix.api{_:(^$|^\\.sandbox$)}.example.com`)\n    route.Handler(handler{})\n    http.Handle(\"/\", router)\n      panic(http.ListenAndServe(\":80\", nil))\n}\n</code></pre>\n\n<p>Request:</p>\n\n<pre><code>$ curl prefix.api.sandbox.example.com/any -v\n*   Trying 127.0.0.1...\n* Connected to prefix.api.sandbox.example.com (127.0.0.1) port 80 (#0)\n&gt; GET /some HTTP/1.1\n&gt; Host: prefix.api.sandbox.example.com\n&gt; User-Agent: curl/7.43.0\n&gt; Accept: */*\n&gt; \n&lt; HTTP/1.1 404 Not Found\n&lt; Content-Type: text/plain; charset=utf-8\n&lt; X-Content-Type-Options: nosniff\n&lt; Date: Wed, 01 Jun 2016 22:08:21 GMT\n&lt; Content-Length: 19\n&lt; \n404 page not found\n* Connection #0 to host prefix.api.sandbox.example.com left intact\n</code></pre>\n"}, {"tags": ["json", "go", "google-cloud-pubsub"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1464911408, "post_id": 37579399, "comment_id": 62692378, "body": "Can you show the json you are trying to unmarshal?"}, {"owner": {"reputation": 154, "user_id": 1901561, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3adf090dbd19c0071fb44e9ef1e4e5b5?s=128&d=identicon&r=PG", "display_name": "RIscRIpt", "link": "https://stackoverflow.com/users/1901561/riscript"}, "edited": false, "score": 0, "creation_date": 1464954845, "post_id": 37579399, "comment_id": 62710046, "body": "Did you try to embed the <code>Data struct</code> in the <code>Message struct</code>? Or if it&#39;s a sub-document, try to change type of <code>Data</code> field from <code>[]byte</code> to <code>Data struct</code>."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "edited": false, "score": 0, "creation_date": 1465120211, "post_id": 37579399, "comment_id": 62761039, "body": "I did try that without success. That&#39;s what confused me"}], "answers": [{"tags": [], "owner": {"reputation": 1955, "user_id": 3142348, "user_type": "registered", "accept_rate": 58, "profile_image": "https://i.stack.imgur.com/lFjeu.png?s=128&g=1", "display_name": "MTZ4", "link": "https://stackoverflow.com/users/3142348/mtz4"}, "is_accepted": false, "score": 1, "last_activity_date": 1552401320, "last_edit_date": 1552401320, "creation_date": 1552400952, "answer_id": 55123932, "question_id": 37579399, "link": "https://stackoverflow.com/questions/37579399/unmarshall-pubsub-request-data-bytes-with-golang/55123932#55123932", "title": "Unmarshall PubSub Request Data []bytes with Golang", "body": "<pre><code>decoder := json.NewDecoder(r.Body)\npsmsg := &amp;PushRequest{}\ndecoderErr := decoder.Decode(&amp;psmsg)\n\nif decoderErr != nil {\n    // Error... \n    return\n}\n\ndata := Data{}\nunmarshalErr := json.Unmarshal([]byte(string(psmsg.Message.Data)), &amp;data)\n\nif unmarshalErr != nil {\n    // Error...\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1042, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1552401320, "creation_date": 1464817911, "question_id": 37579399, "link": "https://stackoverflow.com/questions/37579399/unmarshall-pubsub-request-data-bytes-with-golang", "title": "Unmarshall PubSub Request Data []bytes with Golang", "body": "<p>I have an end-point that receives data from a Google PubSub request. As per <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/blob/master/docs/managed_vms/pubsub/pubsub.go\" rel=\"nofollow\">this repo</a>, the object is as so:</p>\n\n<pre><code>type pushRequest struct {\n    Message struct {\n        Attributes map[string]string\n        Data       []byte\n        ID         string `json:\"message_id\"`\n    }\n    Subscription string\n}\n</code></pre>\n\n<p>The Data field is consistently formatted as so:</p>\n\n<pre><code>type Data struct {\n    Key  string                 `json:\"key\"`\n    Body string                 `json:\"body\"`\n    Meta map[string]interface{} `json:\"meta\"`\n}\n</code></pre>\n\n<p>I can obvious unmarshal the JSON request with something like this:</p>\n\n<pre><code>f := &amp;pushRequest{}\njson.Unmarshal(msg, &amp;f)\n</code></pre>\n\n<p>That leaves with the the []bytes field. Which I can do something like this to convert to a string, as per the docs</p>\n\n<pre><code>messages = append(messages, string(f.Message.Data))\n</code></pre>\n\n<p>Which doesn't help, since I need it as a struct.</p>\n\n<p>I can Unmarshal the array again:</p>\n\n<pre><code>var m Data\njson.Unmarshal(f.Message.Data, &amp;m)\n</code></pre>\n\n<p>Have tried changing the field type in the pushRequest struct to Data without success. Blank...</p>\n\n<p>Is there a way I can unpack things in a single pass? Doing twice seems ridiculous.</p>\n\n<p>If it's obvious, I just cant see it!</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464815296, "post_id": 37578766, "comment_id": 62644498, "body": "I think you should be retrofitting your data rather than addressing this in application code. If you&#39;re updating the schema in a data store, you shouldn&#39;t add special features in your app to update things, you should fix the old data so what the app retrieves is consistent."}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464815957, "post_id": 37578766, "comment_id": 62644833, "body": "What is a good way to do that?"}, {"owner": {"reputation": 5147, "user_id": 334761, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/ZXRM5.jpg?s=128&g=1", "display_name": "Stefan Majewsky", "link": "https://stackoverflow.com/users/334761/stefan-majewsky"}, "edited": false, "score": 1, "creation_date": 1464816177, "post_id": 37578766, "comment_id": 62644928, "body": "It depends on your datastore. In an SQL-compatible RDBMS you can specify a default value when adding the new column, e.g. <code>ALTER TABLE persons ADD COLUMN employed BOOLEAN DEFAULT true;</code>. Or in retrospect, you can <code>UPDATE persons SET employed = true WHERE employed IS NULL</code>. Of course, that simple <code>true</code> can be any expression depending on the existing columns&#39; values."}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464816702, "post_id": 37578766, "comment_id": 62645190, "body": "The database is Google Datastore. Its a NoSQL database"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464818124, "post_id": 37578766, "comment_id": 62645752, "body": "@user1283776 how would run a query directly against the store? You can probably just use a normal update statement. I&#39;m not familiar with the syntax for Google Datastore so I&#39;d have to look into it a bit to give a more precise answer."}], "answers": [{"comments": [{"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464880129, "post_id": 37586544, "comment_id": 62676265, "body": "What should our process be like? Say that we release our updated web app and then straight afterwards load and save all entities. Until the job is complete, users might encounter problems. Do we need top have downtime  and run this update job during the downtime to remove the risk of problems?"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464883153, "post_id": 37586544, "comment_id": 62678555, "body": "In our Python app we prefer &quot;in-flight hot update&quot; approach whenever it is possible - new version loads entities and check for missing properties. If some props are obsolete we would keep them for a month or to and then add logic to remove them. This allows to migrate gradually and often rollback without issues (shit happens) or at least limit impact to small % of records. Also it&#39;s more cost effective as you do not pay for additional reads/writes. Once we sure we ok we can run a mapreduce. This does not involve downtime. You may need or don&#39;t need downtime - it&#39;s really depend on your change."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464883357, "post_id": 37586544, "comment_id": 62678707, "body": "See addition to my answer."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 2, "last_activity_date": 1464883342, "last_edit_date": 1464883342, "creation_date": 1464856236, "answer_id": 37586544, "question_id": 37578766, "link": "https://stackoverflow.com/questions/37578766/handle-schema-change-in-google-datastore-with-go/37586544#37586544", "title": "Handle schema change in Google datastore with Go?", "body": "<p>The proper way is to re-save old entities if you can afford it.</p>\n\n<p>You can use <a href=\"https://cloud.google.com/appengine/docs/python/dataprocessing/\" rel=\"nofollow\">Python map/reduce library</a> to update old entities.</p>\n\n<p>If you want to stick to Go you can go with simple batch processing using <a href=\"https://cloud.google.com/appengine/docs/go/taskqueue/\" rel=\"nofollow\">task queues</a> &amp; <a href=\"https://cloud.google.com/appengine/docs/go/datastore/query-cursors\" rel=\"nofollow\">query cursors</a>.</p>\n\n<p>In our Python app we prefer \"in-flight hot update\" approach whenever it is possible - new version loads entities and check for missing properties. If some props are obsolete we would keep them for a month or to and then add logic to remove them. This allows to migrate gradually and often rollback without issues (shit happens) or at least limit impact to small % of records. Also it's more cost effective as you do not pay for additional reads/writes. Once we sure we ok we can run a mapreduce. This does not involve downtime. You may need or don't need downtime - it's really depend on your change.</p>\n\n<p>With Go it may be a bit tricky as Go would panic if you try to load entity that has no corresponding fields on a struct. There should be some workarounds about it (<em>I remember something about special interface or a struct where you can load arbitrary entity</em>) but I have no much practical experience with Go on GAE yet.</p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 361, "favorite_count": 0, "accepted_answer_id": 37586544, "answer_count": 1, "score": 1, "last_activity_date": 1465338676, "creation_date": 1464815134, "last_edit_date": 1465338676, "question_id": 37578766, "link": "https://stackoverflow.com/questions/37578766/handle-schema-change-in-google-datastore-with-go", "title": "Handle schema change in Google datastore with Go?", "body": "<p>I added a new attribute to Go struct, persisted in a datastore entity kind.</p>\n\n<p>I tried to load entities using a filter on the new attribute:</p>\n\n<pre><code>q := datastore.NewQuery(\"Person\").Filter(\"Employed =\", false)\n</code></pre>\n\n<p>This only worked as intended for persons created after the new attribute was added.</p>\n\n<p>I had expected persons created before the attribute was added to be incleded in the filter, but they didnt have the attribute at all, so they were be excluded by the filter.</p>\n\n<p>I have thought of two ways to handle this:</p>\n\n<ul>\n<li>First load all entities and filter in a second step with a loop. This adds complexity to the code.</li>\n<li>Batch load and resave all entities, which adds the property and sets it to false. I have to remember to do this every time I add a new attribute.</li>\n</ul>\n\n<p>Is there a batter way to handle these types of entity schema changes?</p>\n"}, {"tags": ["networking", "go", "buffer"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1464814560, "last_edit_date": 1464814560, "creation_date": 1464814227, "answer_id": 37578527, "question_id": 37578350, "link": "https://stackoverflow.com/questions/37578350/golang-how-to-release-a-net-conn-from-a-bfio-reader/37578527#37578527", "title": "golang: how to release a net.Conn from a bfio.Reader", "body": "<p>You can get the buffered data from a <code>*bufio.Reader</code> using the following code:</p>\n\n<pre><code> p, _ := br.Peek(br.Buffered())\n</code></pre>\n\n<p>where <code>p</code> is a <code>[]byte</code> containing the buffered data and <code>br</code> is a <code>*bufio.Reader</code>.</p>\n\n<p>Many applications use the <code>*bufio.Reader</code> as an <code>io.Reader</code> after calling <code>ReadLine</code> and related methods. There's no need to get the buffered data in these applications.  The reader will continue reading from the buffered data as needed.</p>\n"}], "owner": {"reputation": 145, "user_id": 1074977, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/RicyJ.png?s=128&g=1", "display_name": "josgek", "link": "https://stackoverflow.com/users/1074977/josgek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 147, "favorite_count": 0, "accepted_answer_id": 37578527, "answer_count": 1, "score": 1, "last_activity_date": 1464814560, "creation_date": 1464813493, "question_id": 37578350, "link": "https://stackoverflow.com/questions/37578350/golang-how-to-release-a-net-conn-from-a-bfio-reader", "title": "golang: how to release a net.Conn from a bfio.Reader", "body": "<p>In go I have a net.Conn that I wrap with a bufio.Reader. I want to read and parse certain number of lines from the reader, and then obtain back the control over the net.Conn, obtaining back all the temporary data the reader might still have buffered. Is there an easy way to do it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1464810549, "post_id": 37577484, "comment_id": 62641978, "body": "Read <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> if you have not already done so.The sqlx package is designed to be installed using &#39;go get&#39;.  The directory structure from the root directory in the GOPATH to the <code>sqlx</code> directory is created by <code>go get</code>.  I suggest configuring your Go workspace (by setting GOPATH), running <code>go get github.com&#47;jmoiron&#47;sqlx</code> and look at the resulting directory structure."}], "answers": [{"comments": [{"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464842590, "post_id": 37578298, "comment_id": 62651959, "body": "Thanks for the detailed explanation. Was looking for a comparison of whether a directory structure like the one I have currently versus a flat directory structure is better depending on what type of application you&#39;re developing?"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464873161, "post_id": 37578298, "comment_id": 62670550, "body": "@user2490003 My personal preference is for folders, although a flat structure means you&#39;ll never get lost. remember different packages need different folders. i cant say either is &quot;better&quot;"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 4, "last_activity_date": 1464813314, "creation_date": 1464813314, "answer_id": 37578298, "question_id": 37577484, "link": "https://stackoverflow.com/questions/37577484/golang-project-structure-in-an-application-versus-a-package/37578298#37578298", "title": "Golang project structure in an application versus a package", "body": "<p>I did this too on my first project. I have since learned:</p>\n\n<ul>\n<li>the <code>$GOPATH/bin/ pkg/ src/</code> layout is constructed by <code>go get</code> and similar commands</li>\n<li>you can organize your .go files as a single flat project dir or with subfolders (caveat: all .go files in the same folder must have the same package name)</li>\n<li>put other people's code in a <code>/vendor</code> directory inside your project root, if it is code your app needs to work (google this, it's the worst part of go imo)</li>\n<li>put your own project under your gopath, symlink to it if you want it more accessible</li>\n</ul>\n\n<p>So I would imagine your code could look something like:</p>\n\n<pre><code>/Users/user2490003/MyGoPath/\n\u25be src/github.com/user2490003/myproject/\n  \u25be model/\n      user.go\n  \u25be myapp/\n      myapp.go\n  \u25be vendor/github.com/jmoiron/sqlx/\n      sqlx.go\n    main.go\n</code></pre>\n\n<p>Import the full package references, like this:</p>\n\n<pre><code>// main.go\npackage main\nimport (\n  github.com/jmoiron/sqlx\n  github.com/user2490003/myproject/myapp\n  github.com/user2490003/myproject/model\n)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1281, "user_id": 787553, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4be2932e858c8fc42b83a705031b73?s=128&d=identicon&r=PG", "display_name": "dmitris", "link": "https://stackoverflow.com/users/787553/dmitris"}, "is_accepted": false, "score": 3, "last_activity_date": 1469443756, "creation_date": 1469443756, "answer_id": 38565752, "question_id": 37577484, "link": "https://stackoverflow.com/questions/37577484/golang-project-structure-in-an-application-versus-a-package/38565752#38565752", "title": "Golang project structure in an application versus a package", "body": "<p>I would recommend to start with a layout that seems logical and works at the present moment and then refactor/restructure as needed when your applications grows and evolves.</p>\n\n<p>Using your company namespace is reasonable - I would consider creating a directory for your app underneath it (such as <code>company.co/my_app</code>) and inside of it, subdirectories for library packages (for example, <code>company.co/my_app/db</code> etc.) as well as the <code>cmd</code> one that would contain directories for the actual executables (<code>package main</code> programs) that you want to produce: cmd/exe1, cmd/exe2 etc.  This will allow you to have multiple executables as well as multiple library \"subpackages\" inside of the <code>my_app</code> which can be included independently with the corresponding import path.</p>\n\n<blockquote>\n  <p>Each library that I've included (e.g. sqlx, etc...) also has it's own folder.</p>\n</blockquote>\n\n<p>If you are ok with using the latest version of dependencies from Github, you don't have to include the dependencies' code into your repositories but instead install them with <code>go get</code> into the build area.  If you want to build from a local copy - and for corporate usage, it may be preferable for stability and audit track - you should put them in a <code>vendor</code> subdirectory, for example <code>company.co/my_app/vendor/github.com/jmoiron/sqlx</code>.  This way you have control on when you upgrade to a newer version of the dependencies and assurance that the upstream changes will not break your build or otherwise affect your programs without your knowledge and until you have a chance to do thorough testing.  </p>\n"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3291, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1502362872, "creation_date": 1464810299, "question_id": 37577484, "link": "https://stackoverflow.com/questions/37577484/golang-project-structure-in-an-application-versus-a-package", "title": "Golang project structure in an application versus a package", "body": "<p>My organization uses Rails to develop its app but I'm attempting to re-write one of our back-end processes in Golang because it's much quicker. </p>\n\n<p>I've structure my application with our company a namespace for my app (<code>example.co</code>), and a subfolder for each of the packages within my app. </p>\n\n<p>Each library that I've included (e.g. <code>sqlx</code>, etc...) also has it's own folder. </p>\n\n<pre><code>src/\n  github.com/\n    jmoiron/\n      (sqlx package files)\n  example.co\n    my_app/\n      (my app package files)\n    model/\n      (model package files...)\n</code></pre>\n\n<p><a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow\">However looking at other packages like sqlx</a>, it appears they scrap this directory structure entirely and put all their files in the root directory</p>\n\n<p>Is this because I'm writing an application and sqlx is a package that's meant to be included in other applications? Or is it just a difference in preference since there's no real accepted \"standard\"</p>\n"}, {"tags": ["linux", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464799774, "post_id": 37573985, "comment_id": 62636223, "body": "Is that really the entire stack trace? Are you using the current version of Go?"}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464799899, "post_id": 37573985, "comment_id": 62636296, "body": "go version go1.5.1 darwin/amd64"}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464799982, "post_id": 37573985, "comment_id": 62636336, "body": "I am outputting the response on to console;"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464800730, "post_id": 37573985, "comment_id": 62636749, "body": "There&#39;s got to be more output than that. That&#39;s just a single runtime goroutine stack, likely has nothing to do with your error, and you don&#39;t have an error message of any sort. From a quick glance at your code, you have a function with the comment &quot;will be in trouble if got called twice&quot;, but it contains no mutex and is called twice from 2 different goroutines. (it wouldn&#39;t hurt to update to the supported version of Go too, currently 1.6.2)"}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464801124, "post_id": 37573985, "comment_id": 62636995, "body": "the second connect block is the error recovery scenario as in; if the tcp connection goes down;  wait for configured time and then reconnect.           if err != nil {     fmt.Println(&quot;Failed to make a connection&quot;, err)     time.Sleep(tcpConnector.ReconnectTime)     tcpConnector.connect()     return  }"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464801698, "post_id": 37573985, "comment_id": 62637332, "body": "If your tcp connection goes down, you call connect from one goroutine (which blocks and may call connect recursively as long as there&#39;s connectivity problems, or hang indefinitely as there&#39;s no timeout), while the other goroutine sleeps then also calls connect, which may already be in progress, and which may also call connect recursively or block indefinitely. Either one of those connect calls may spawn 2 more goroutines, which each have the chance to call connect themselves. I can&#39;t tell what your error is with the limited info here, but your TcpConnector doesn&#39;t really work."}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464804935, "post_id": 37573985, "comment_id": 62639093, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/113560/discussion-between-harry-and-jimb\">continue this discussion in chat</a>."}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465174615, "post_id": 37573985, "comment_id": 62776659, "body": "That seems to be a possibility but even if there is no timeout explicitly mentioned won&#39;t every os itself have a time out like 3 min ??"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465175162, "post_id": 37573985, "comment_id": 62776777, "body": "a timeout on what? There aren&#39;t global timeouts for syscalls"}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465176914, "post_id": 37573985, "comment_id": 62777119, "body": "/ With or without a timeout, the operating system may impose         // its own earlier timeout. For instance, TCP timeouts are         // often around 3 minutes."}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465176932, "post_id": 37573985, "comment_id": 62777121, "body": "<a href=\"https://golang.org/src/net/dial.go?s=448:2248#L7\" rel=\"nofollow noreferrer\">golang.org/src/net/dial.go?s=448:2248#L7</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465177747, "post_id": 37573985, "comment_id": 62777234, "body": "the key points are  &quot;<i>may</i> impose&quot; and &quot;<i>often around</i> 3 minutes&quot;. But it&#39;s not guaranteed. A recv call will by default wait indefinitely, or if keepalive is enabled, a dead connection may close anywhere from 30min to many hours after the call. This is all beside the point. You need to figure out why you got a panic (you need to provide the full stack trace, and better yet run your program with the race detector), and you need to fix the retry logic in your <code>TcpConnector</code>."}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465356190, "post_id": 37573985, "comment_id": 62861451, "body": "@JimB: I&#39;ll try to get the stacktrace; I did recompile the program with --race option. I might have to wait for a week before I get the crash!!! Thanks in advance for taking out the time in helping me out !!!"}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465887790, "post_id": 37573985, "comment_id": 63074820, "body": "@JimB: the stack trace : <a href=\"http://pastebin.com/nJ8nMVrg\" rel=\"nofollow noreferrer\">pastebin.com/nJ8nMVrg</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465909664, "post_id": 37573985, "comment_id": 63089969, "body": "you&#39;ve run out of threads for some reason. I can&#39;t tell why, but it failed here when the GC tried to create one (Are you certain that you&#39;re not using the cgo net resolver? Are you using systemd with a low thread limit?Are you setting GOMAXPROCS to some unreasonable value?). Though none of this really matters when the code above is broken, never closes sockets, can recurse indefinitely while reconnecting, can get out of sync reading and writing from different sockets, and so on."}, {"owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1465921944, "post_id": 37573985, "comment_id": 63099293, "body": "Yes I am compiling with &#39;netgo&#39; flag and &#39;GOMaxprocs&#39; isn&#39;t defaulted to cores available as of 1.5 ?? I am not sure on systemd limits"}], "owner": {"reputation": 290, "user_id": 3731154, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/add6d86ee1fc413feba633e3cd30f70e?s=128&d=identicon&r=PG&f=1", "display_name": "harry", "link": "https://stackoverflow.com/users/3731154/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 686, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1465176897, "creation_date": 1464797995, "last_edit_date": 1464798368, "question_id": 37573985, "link": "https://stackoverflow.com/questions/37573985/golang-crashing-in-production", "title": "Golang crashing in production", "body": "<p>I have a go program which connects to a tcp server and publishes that message to web service. the application works fine in the first go and it panics after a week or so. I am not sure why. the stack trace isn't helpful either.\n(I cross compile from mac os to linux; env GOOS=linux GOARCH=386  go build)\ncould some one give pointers on what might be the issue?</p>\n\n<p>the tcp server connection might go off once in a while; I have build the reconnection logic by hand. \nthe error condition would be applicable to posting as well. the internet connection might break at any time; so \"dns\" resolver which go uses by default \"cgo\" was panicking. I had recompile with the \"netgo\" to use pure go network implementation.</p>\n\n<h2>Stack trace</h2>\n\n<pre><code>net.runtime_pollWait(0xf75c12d8, 0x72, 0x18690000)\n    /usr/local/go/src/runtime/netpoll.go:157 +0x55 net.(*pollDesc).Wait(0x18a6bb38, 0x72, 0x0, 0x0)/usr/local/go/src/net/fd_poll_runtime.go:73 +0x35\n    net.(*pollDesc).WaitRead(0x18a6bb38, 0x0, 0x0) _poll_runtime.go:78 +0x33\n    net.(*netFD).Read(0x18a6bb00, 0x18cd6000, 0x1000, 0x1000, 0x0, 0xf75bc018, 0x18690000)/usr/local/go/src/net/fd_unix.go:232 +0x19anet.(*conn).Read(0x18cd4d78, 0x18cd6000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\n    /usr/local/go/src/net/net.go:172 +0xb9\n    net/http.noteEOFReader.Read(0xf75fc018, 0x18cd4d78, 0x1889770c, 0x18cd6000, 0x1000, 0x1000, 0x2c3620, 0x0, 0x0)\n    /usr/local/go/src/net/http/transport.go:1370 +0x55\n    net/http.(*noteEOFReader).Read(0x18cd29e0, 0x18cd6000, 0x1000, 0x1000, 0x8056f0c, 0x0, 0x0)\n    &lt;autogenerated&gt;:126 +0xae\n    bufio.(*Reader).fill(0x1881b7d0)\n    /usr/local/go/src/bufio/bufio.go:97 +0x172\n    bufio.(*Reader).Peek(0x1881b7d0, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/bufio/bufio.go:132 +0xad\n    net/http.(*persistConn).readLoop(0x188976e0)\n    /usr/local/go/src/net/http/transport.go:876 +0xe3\n    created by net/http.(*Transport).dialConn\n    /usr/local/go/src/net/http/transport.go:685 +0xabc\n</code></pre>\n\n<p>GO program <a href=\"https://play.golang.org/p/Xu7clWnXTb\" rel=\"nofollow\">go program</a></p>\n\n<pre><code>  package main\n\n import (\n  \"bufio\"\n  \"bytes\"\n  \"encoding/json\"\n  \"flag\"\n  \"fmt\"\n  \"net\"\n  \"net/http\"\n  \"time\"\n  )\n\n  var (\n    server             = flag.String(\"deamon\", \"127.0.0.1:7070\", \"AMQP URI\")\n    msgRoutingKey      = flag.String(\"routingKey\", \"routingKey\", \" routing key\")\n    msgexchange        = flag.String(\"exchange\", \"exchange\", \" excahnge \")\n    mywebserviceServer = flag.String(\"mywebservice-server\", \"127.0.0.1:8080\",      \"mywebserviceServer:port \")\n  )\n\n   func init() {\n\n     flag.Parse()\n   }\n\n   type TcpConnector struct {\n    Outbound      chan string\n    Inbound       chan string\n    Addr          string\n    ReconnectTime time.Duration\n   }\n\ntype Message struct {\n  RoutingKey string `json:\"routingKey\"`\n  Exchange   string `json:\"exchange\"`\n  Data       string `json:\"data\"`\n}\n\nfunc main() {\n  start := time.Now()\n  tcpClient := NewTcpConnector(*server)\n  elapsed := time.Since(start)\n  fmt.Println(\"the connecting params are  %s\", *server, *msgexchange, *msgRoutingKey, *mywebserviceServer)\n  fmt.Println(\"connecting to daemon took %s\", elapsed)\n   go func() {\n    for msg := range tcpClient.Inbound {\n        fmt.Println(msg)\n        rabbitMessage := Message{\n            RoutingKey: *msgRoutingKey,\n            Exchange:   *msgexchange,\n            Data:       msg,\n        }\n        mywebserviceMessageEndpoint :=    fmt.Sprintf(\"http://%s/v1/messages/publish\", *mywebserviceServer)\n        doPut(mywebserviceMessageEndpoint, &amp;rabbitMessage)\n\n      }\n    }()\n\n   select {}\n }\n\nfunc doPut(url string, rabbitMessage *Message) {\n start := time.Now()\n b, err := json.Marshal(rabbitMessage)\n client := &amp;http.Client{}\n request, err := http.NewRequest(\"PUT\", url, bytes.NewBuffer(b))\n request.Header.Add(\"Content-Type\", \"application/json\")\n request.Header.Add(\"accept\", \"application/json\")\n response, err := client.Do(request)\n if err != nil {\n    fmt.Println(err)\n } else {\n    defer response.Body.Close()\n    fmt.Println(\"   \", response.StatusCode)\n    hdr := response.Header\n    for key, value := range hdr {\n        fmt.Println(\"   \", key, \":\", value)\n    }\n\n }\n\n elapsed := time.Since(start)\n fmt.Println(\"posting to mywebservice took %s\", elapsed)\n\n}\n\nfunc NewTcpConnector(addr string) *TcpConnector {\n tcpConnector := &amp;TcpConnector{\n    Addr:          addr,\n    Outbound:      make(chan string, 100),\n    Inbound:       make(chan string, 100),\n    ReconnectTime: 30 * time.Second,\n }\n tcpConnector.connect()\n return tcpConnector\n}\n\n//keep connect private, will be in trouble if got called twice\nfunc (tcpConnector *TcpConnector) connect() {\n conn, err := net.Dial(\"tcp\", tcpConnector.Addr)\n if err != nil {\n    fmt.Println(\"Failed to make a connection\", err)\n    time.Sleep(tcpConnector.ReconnectTime)\n    tcpConnector.connect()\n    return\n }\n\ngo func() {\n    for msg := range tcpConnector.Outbound {\n\n        _, err = fmt.Fprintf(conn, msg+\"\\n\")\n        if err != nil {\n            fmt.Println(\"Failed sending event\", err)\n            time.Sleep(tcpConnector.ReconnectTime)\n            tcpConnector.connect()\n            break\n        }\n\n    }\n}()\ngo func() {\n    reader := bufio.NewReaderSize(conn, 1024*1024)\n    for {\n        message, err := reader.ReadBytes('\\n')\n        if err != nil {\n            break\n        }\n        fmt.Println(\"Message Received: %s\", message)\n        tcpConnector.Inbound &lt;- string(message)\n        fmt.Println(\"Message sent to chan\")\n    }\n\n    fmt.Println(\"reconnecting...\")\n    tcpConnector.connect()\n}()\nfmt.Println(\"Connected tcp\")\n}\n</code></pre>\n"}, {"tags": ["go", "docker", "proxy"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 6632588, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/68b0f4cb2eee7b067e1e67a48dabd0ad?s=128&d=identicon&r=PG", "display_name": "Tieyan", "link": "https://stackoverflow.com/users/6632588/tieyan"}, "is_accepted": false, "score": 4, "last_activity_date": 1469394243, "creation_date": 1469394243, "answer_id": 38556766, "question_id": 37573476, "link": "https://stackoverflow.com/questions/37573476/docker-complaining-about-all-proxy-environment-variable-with-proxy-unknown-sch/38556766#38556766", "title": "Docker complaining about ALL_PROXY environment variable with &quot;proxy: unknown scheme: http&quot;", "body": "<p>I am facing the same issue with docker 1.11.2.  I believe the error is coming from method <a href=\"https://github.com/docker/docker/blob/3d13fddd2bc4d679f0eaa68b0be877e5a816ad53/vendor/src/golang.org/x/net/proxy/proxy.go#L93\" rel=\"nofollow\">FromURL</a>. </p>\n\n<p>After checking the relevant commit <a href=\"https://github.com/docker/docker/commit/16effc66c028a7800096ed92174ca4bceba229ad\" rel=\"nofollow\">https://github.com/docker/docker/commit/16effc66c028a7800096ed92174ca4bceba229ad</a>, it turns out from v1.11.0-rc1 up to v1.12.0-rc4 are including this commit. </p>\n\n<p>So the solution for me is to install a lower version (I used v1.10.3) of docker toolbox, after which \"docker run hello-world\" works.</p>\n"}], "owner": {"reputation": 45618, "user_id": 1228454, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6796659eead1cfd7d8cd6b6f80ba6a94?s=128&d=identicon&r=PG", "display_name": "nwinkler", "link": "https://stackoverflow.com/users/1228454/nwinkler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2128, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1469394243, "creation_date": 1464796397, "question_id": 37573476, "link": "https://stackoverflow.com/questions/37573476/docker-complaining-about-all-proxy-environment-variable-with-proxy-unknown-sch", "title": "Docker complaining about ALL_PROXY environment variable with &quot;proxy: unknown scheme: http&quot;", "body": "<p>I'm facing the following issue with my Docker containers: When I try to <em>enter</em> the container using </p>\n\n<pre><code>docker exec -it container-id /bin/bash\n</code></pre>\n\n<p>Docker (I assume it's Docker) complains with the following message:</p>\n\n<pre><code>proxy: unknown scheme: http\n</code></pre>\n\n<p>I have traced this back to the following environment variable that's set on my host machine, since I'm using a proxy server to access the web:</p>\n\n<pre><code>ALL_PROXY=http://myproxy:8080\n</code></pre>\n\n<p>The error message seems to come from the <code>net/proxy.go</code> file, which can be found <a href=\"https://github.com/golang/net/blob/master/proxy/proxy.go\" rel=\"nofollow\">here</a> - the error message is issued on the last line of the file. Why would <code>http</code> not be a registered URL scheme in the Docker case?</p>\n\n<p>As soon as I <code>unset ALL_PROXY</code> on the host, I can enter the container without any issues.</p>\n\n<p>Environment:</p>\n\n<ul>\n<li>Mac OS X v10.11.5</li>\n<li>Docker v1.11.1</li>\n<li>Docker-Machine v0.7.0</li>\n</ul>\n\n<p>Any idea how to fix this (other than unsetting the variable each time)?</p>\n"}, {"tags": ["json", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1464799282, "post_id": 37573982, "comment_id": 62635947, "body": "@KarrotKake, the RawMessage was the first thing that I tried, but it encodes to base64. Do you have a working example? I would be happy to check where I did wrong."}], "tags": [], "owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "is_accepted": true, "score": 3, "last_activity_date": 1464797990, "creation_date": 1464797990, "answer_id": 37573982, "question_id": 37573395, "link": "https://stackoverflow.com/questions/37573395/aggregating-json-objects-in-go/37573982#37573982", "title": "Aggregating JSON objects in Go", "body": "<p>Yes, you can use a custom type that implements <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow\"><code>Marshaler</code></a> interface.</p>\n\n<p><a href=\"https://play.golang.org/p/YB_eKlfOND\" rel=\"nofollow\">https://play.golang.org/p/YB_eKlfOND</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n)\n\ntype Event struct {\n    Place     RawString  `json:\"place\"`\n    Attendees RawString  `json:\"attendees,omitempty\"`\n}\n\ntype RawString string\n\nfunc (s RawString) MarshalJSON() ([]byte, error) {\n    return []byte(s), nil\n}\n\nfunc main() {\n    event := Event{\n        Place: RawString(`{\"name\":\"Paris\"}`),\n        Attendees: RawString(`[{\"name\":\"John\"}, {\"name\":\"Juli\"}]`),\n    }\n    s, err := json.Marshal(event)\n    fmt.Println(fmt.Sprintf(\"event: %v; err: %v\", string(s), err))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1464799189, "post_id": 37574219, "comment_id": 62635889, "body": "I&#39;ve tried to use RawMessage but it encodes the string to base64. Can you provide a working example? Just curious, as it was first what I tried."}, {"owner": {"reputation": 3788, "user_id": 352876, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/HW4nf.jpg?s=128&g=1", "display_name": "Jukurrpa", "link": "https://stackoverflow.com/users/352876/jukurrpa"}, "edited": false, "score": 0, "creation_date": 1464799560, "post_id": 37574219, "comment_id": 62636107, "body": "I actually tried <code>RawMessage</code> as the contents I have really are <code>[]byte</code> and not <code>string</code> and it gets encoded in base64 too. If there&#39;s a workaround for this..."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "reply_to_user": {"reputation": 3788, "user_id": 352876, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/HW4nf.jpg?s=128&g=1", "display_name": "Jukurrpa", "link": "https://stackoverflow.com/users/352876/jukurrpa"}, "edited": false, "score": 0, "creation_date": 1464799868, "post_id": 37574219, "comment_id": 62636280, "body": "@Jukurrpa, you can inherit your custom class as <code>type RawBytes []byte</code>. Also curios about <code>RawMessage</code>."}, {"owner": {"reputation": 2336, "user_id": 1826232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DldsJ.png?s=128&g=1", "display_name": "Asdine", "link": "https://stackoverflow.com/users/1826232/asdine"}, "edited": false, "score": 3, "creation_date": 1464800088, "post_id": 37574219, "comment_id": 62636399, "body": "You must have passed the json.RawMessage by value and not a pointer. see <a href=\"http://stackoverflow.com/a/24229303/1826232\">stackoverflow.com/a/24229303/1826232</a>"}], "tags": [], "owner": {"reputation": 2336, "user_id": 1826232, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DldsJ.png?s=128&g=1", "display_name": "Asdine", "link": "https://stackoverflow.com/users/1826232/asdine"}, "is_accepted": false, "score": 4, "last_activity_date": 1464800034, "last_edit_date": 1464800034, "creation_date": 1464798783, "answer_id": 37574219, "question_id": 37573395, "link": "https://stackoverflow.com/questions/37573395/aggregating-json-objects-in-go/37574219#37574219", "title": "Aggregating JSON objects in Go", "body": "<p>You can use <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow\"><code>json.RawMessage</code></a></p>\n\n<blockquote>\n  <p>RawMessage is a raw encoded JSON object. It implements Marshaler and Unmarshaler and can be used to delay JSON decoding or precompute a JSON encoding.</p>\n</blockquote>\n\n<p>Also, <code>json.RawMessage</code> is an alias to <code>[]byte</code> so you can values to it this way:</p>\n\n<pre><code>v := json.RawMessage(`{\"foo\":\"bar\"}`)\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\ntype Event struct {\n    Place     json.RawMessage `json:\"place\"`\n    Attendees json.RawMessage `json:\"attendees\"`\n}\n\nfunc main() {\n    e := Event{\n         Place: json.RawMessage(`{\"address\":\"somewhere\"}`),\n         Attendees: json.RawMessage(`{\"key\":\"value\"}`),\n    }\n    c, err := json.Marshal(&amp;e)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(c))\n    // {\"place\":{\"address\":\"somewhere\"},\"attendees\":{\"key\":\"value\"}}\n}\n</code></pre>\n"}], "owner": {"reputation": 3788, "user_id": 352876, "user_type": "registered", "accept_rate": 78, "profile_image": "https://i.stack.imgur.com/HW4nf.jpg?s=128&g=1", "display_name": "Jukurrpa", "link": "https://stackoverflow.com/users/352876/jukurrpa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 322, "favorite_count": 0, "accepted_answer_id": 37573982, "answer_count": 2, "score": 3, "last_activity_date": 1464800034, "creation_date": 1464796179, "question_id": 37573395, "link": "https://stackoverflow.com/questions/37573395/aggregating-json-objects-in-go", "title": "Aggregating JSON objects in Go", "body": "<p>I'm making a Go service that gathers JSON objects from different sources and aggregates them in a single JSON object.</p>\n\n<p>I was wondering if there was any way to aggregate the child objects without having to unmarshal and re-marshal them again or having to manually build a JSON string.</p>\n\n<p>I was thinking of using a <code>struct</code> containing the already marshalled parts, such as this:</p>\n\n<pre><code>type Event struct {\n    Place     string `json:\"place\"`\n    Attendees string `json:\"attendees\"`\n}\n</code></pre>\n\n<p>Where <code>Place</code> and <code>Attendees</code> are JSON strings themselves. I'd like to somehow mark them as \"already marshalled\" so they don't end up as escaped JSON strings but get used as is instead.</p>\n\n<p>Is there any way to achieve this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464789644, "post_id": 37570665, "comment_id": 62629103, "body": "The three dots is called an &quot;ellipsis&quot;. The question you linked directly answers you question. The other answer is kind of needlessly wordy, what what about it don&#39;t you understand?"}, {"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464789751, "post_id": 37570665, "comment_id": 62629188, "body": "TL;DR: assume <code>a := []int{1,2,3}</code> -- then <code>do(a...)</code> is equivalent to <code>do(1, 2, 3)</code>"}, {"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 1, "creation_date": 1464794268, "post_id": 37570665, "comment_id": 62632666, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/23669720/dot-dot-dot-in-golang-interface-with-empty-braces\">dot dot dot in golang. interface with empty braces</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464790258, "post_id": 37571013, "comment_id": 62629601, "body": "You could think about it that way, but it reality it assigns the slice directly to the variadic slice in the arguments, which is much more efficient."}], "tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1464789856, "creation_date": 1464789856, "answer_id": 37571013, "question_id": 37570665, "link": "https://stackoverflow.com/questions/37570665/what-does-mean-when-coming-directly-after-a-slice/37571013#37571013", "title": "What does ... mean when coming directly after a slice?", "body": "<p>It unpacks slice.</p>\n\n<p><code>ids[:index]</code> is a short form of <code>ids[0:index]</code></p>\n\n<p><code>ids[index+1:]</code> is a short form of <code>ids[index+1:len(ids)-1]</code></p>\n\n<p>So, your example <code>ids = append(ids[:index], ids[index+1:]...)</code> translates to</p>\n\n<pre><code>//pseudocode\nids = append(ids[0:index], ids[index+1], ids[index+2], ids[index+3], ..., ids[len(ids)-2], ids[len(ids)-1])\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464814128, "post_id": 37571541, "comment_id": 62643879, "body": "Thank you! Very well explained"}], "tags": [], "owner": {"reputation": 7543, "user_id": 1794051, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4fc6d765eadabca02bdd7b44d6504720?s=128&d=identicon&r=PG", "display_name": "val", "link": "https://stackoverflow.com/users/1794051/val"}, "is_accepted": true, "score": 8, "last_activity_date": 1464791268, "creation_date": 1464791268, "answer_id": 37571541, "question_id": 37570665, "link": "https://stackoverflow.com/questions/37570665/what-does-mean-when-coming-directly-after-a-slice/37571541#37571541", "title": "What does ... mean when coming directly after a slice?", "body": "<p>Some languages (C, Python, ...) accept <em>variadic arguments</em>. Basically, you allow the client of a function to pass <em>a number</em> of arguments, without specifying how many. Since the function will still need to process these arguments one way or another, they are usually converted to a collection of some sort. For instance, in Python:</p>\n\n<pre><code>def foo(x, *args): # * is used for variadic arguments\n    return len(args)\n\n&gt;&gt;&gt; foo(1)  # Passed the required argument, but no varargs\n0 \n&gt;&gt;&gt; foo(1, 2, 3)  # Passed the required, plus two variadic arguments\n2\n&gt;&gt;&gt; foo(1, 2, 3, 4, 5, 6) # required + 5 args, etc...\n5\n</code></pre>\n\n<p>Now one obvious problem of that approach is that <em>a number of arguments</em> is quite a fuzzy concept as far as types are concerned. C uses pointers, Python doesn't really care about types that much in the first place, and Go takes the decision of restricting it to a specified case: you pass <a href=\"https://golang.org/ref/spec#Passing_arguments_to_..._parameters\" rel=\"noreferrer\">a slice of a given type</a>. </p>\n\n<p>This is nice because it lets the type-system do its thing, while still being quite flexible (in particular, the type in question can be an interface, so you can pass different 'actual types' as long as the function knows how to process these.</p>\n\n<p>The typical example would be the <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"noreferrer\">Command function</a>, which executes a program, passing it <em>some arguments</em>:</p>\n\n<pre><code>func Command(name string, arg ...string) *Cmd\n</code></pre>\n\n<p>It makes a lot of sense here, but recall that variadic arguments are just a <em>convenient way to pass slices</em>. You could have the exact same API with:</p>\n\n<pre><code>func Command(name string, args []string) *Cmd\n</code></pre>\n\n<p>The only advantage of the first is that it lets you pass no argument, one argument, several... without having to build the slice yourself.</p>\n\n<h2>What about your question then ?</h2>\n\n<p>Sometimes, you <em>do</em> have a slice, but need to call a variadic function. But if you do it naively:</p>\n\n<pre><code>my_args_slice := []string{\"foo\", \"bar\"}\ncmd := Command(\"myprogram\", my_args_slice)\n</code></pre>\n\n<p>The compiler will complain that it expects string(s), but got a slice instead ! What you want to tell it is that it doesn't have to 'build the slice in the back', because you have a slice already. You do that by using this ellipsis:</p>\n\n<pre><code>my_args_slice := []string{\"foo\", \"bar\"}\ncmd := Command(\"myprogram\", my_args_slice...) // &lt;- Interpret that as strings\n</code></pre>\n\n<p>The <code>append</code> function, despite being built-in and special, <a href=\"https://golang.org/ref/spec#Appending_and_copying_slices\" rel=\"noreferrer\">follows the same rules</a>. You can append zero, one, or more elements to the slice. If you want to concatenate slices (i.e. you have a 'slice of arguments' already), you similarly use the ellipsis to make it use it directly.</p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1178, "favorite_count": 1, "accepted_answer_id": 37571541, "answer_count": 2, "score": 3, "last_activity_date": 1464791268, "creation_date": 1464788952, "last_edit_date": 1495541277, "question_id": 37570665, "link": "https://stackoverflow.com/questions/37570665/what-does-mean-when-coming-directly-after-a-slice", "title": "What does ... mean when coming directly after a slice?", "body": "<p>What does <code>...</code> mean in this context in Go?</p>\n\n<pre><code>ids = append(ids[:index], ids[index+1:]...)\n</code></pre>\n\n<p>I have read this great Q&amp;A: \n<a href=\"https://stackoverflow.com/questions/24340379/do-three-dots-which-is-called-wildcard-contain-multiple-meanings\">Do three dots (which is called wildcard?) contain multiple meanings?</a></p>\n\n<p>about what ... means in some situations, but I don't understand what it means in the situation above.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1464784249, "post_id": 37568346, "comment_id": 62624461, "body": "Related: <a href=\"http://stackoverflow.com/questions/9320862/go-why-would-i-make-or-new\">Go: why would I make() or new()?</a>"}], "answers": [{"tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": false, "score": 2, "last_activity_date": 1464784150, "creation_date": 1464784150, "answer_id": 37568691, "question_id": 37568346, "link": "https://stackoverflow.com/questions/37568346/map-types-are-reference-types-var-m-mapstringint-doesnt-point-to-an-initiali/37568691#37568691", "title": "Map types are reference types. var m map[string]int doesn&#39;t point to an initialized map. What doe this mean?", "body": "<blockquote>\n  <p>What does var m map[string]int do?</p>\n</blockquote>\n\n<p>You can think about it like pointer with nil value, it does not point to anything yet but able to point to concrete value.</p>\n\n<blockquote>\n  <p>Why do I need to write m = make(map[string]int) but not i = make(int)</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#allocation_make\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#allocation_make</a></p>\n\n<p>Back to allocation. The built-in function make(T, args) serves a purpose different from new(T). It creates slices, maps, and channels only, and it returns an initialized (not zeroed) value of type T (not *T). The reason for the distinction is that these three types represent, under the covers, references to data structures that must be initialized before use. A slice, for example, is a three-item descriptor containing a pointer to the data (inside an array), the length, and the capacity, and until those items are initialized, the slice is nil. For slices, maps, and channels, make initializes the internal data structure and prepares the value for use. For instance,</p>\n\n<pre><code>make([]int, 10, 100)\n</code></pre>\n\n<p>allocates an array of 100 ints and then creates a slice structure with length 10 and a capacity of 100 pointing at the first 10 elements of the array. (When making a slice, the capacity can be omitted; see the section on slices for more information.) In contrast, new([]int) returns a pointer to a newly allocated, zeroed slice structure, that is, a pointer to a nil slice value.</p>\n\n<p>These examples illustrate the difference between new and make.</p>\n\n<pre><code>var p *[]int = new([]int)       // allocates slice structure; *p == nil; rarely useful\nvar v  []int = make([]int, 100) // the slice v now refers to a new array of 100 ints\n\n// Unnecessarily complex:\nvar p *[]int = new([]int)\n*p = make([]int, 100, 100)\n\n// Idiomatic:\nv := make([]int, 100)\n</code></pre>\n\n<p>Remember that make applies only to maps, slices and channels and does not return a pointer. To obtain an explicit pointer allocate with new or take the address of a variable explicitly.</p>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 2, "last_activity_date": 1464785580, "creation_date": 1464785580, "answer_id": 37569261, "question_id": 37568346, "link": "https://stackoverflow.com/questions/37568346/map-types-are-reference-types-var-m-mapstringint-doesnt-point-to-an-initiali/37569261#37569261", "title": "Map types are reference types. var m map[string]int doesn&#39;t point to an initialized map. What doe this mean?", "body": "<p>All words have the same length of <strong>32 bits (4 bytes)</strong> or <strong>64 bits (8 bytes)</strong>,\ndepending on the processor and the operating system. They are identified by their memory address (represented as a hexadecimal number). </p>\n\n<p>All variables of <strong><em>primitive types</em></strong> like <strong>int</strong>, <strong>float</strong>, <strong>bool</strong>, <strong>string</strong> ... are <code>value types</code>, they point directly to the values contained in the memory. Also composite types like arrays and structs are value types. When assigning with <code>=</code> the value of a value type to another variable: <code>j = i</code>, a copy of the original value <code>i</code> is made in memory.</p>\n\n<p>More complex data which usually needs several words are treated as <strong><em>reference types</em></strong>. A reference type variable <code>r1</code> contains the address (a number) of the memory location where the value of <code>r1</code> is stored (or at least the 1st word of it):</p>\n\n<p><a href=\"https://i.stack.imgur.com/L1Hzp.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/L1Hzp.png\" alt=\"enter image description here\"></a></p>\n\n<p>For reference types when assigning <code>r2 = r1</code>, only the reference (the address) is copied and not the value!!. If the value of r1 is modified, all references of that value (like r1 and r2) will be reflected.</p>\n\n<p>In Go pointers are reference types, as well as slices, maps and channels. The variables that are referenced are stored in the heap, which is garbage collected.</p>\n\n<p>In the light of the above statements it's clear why the article states: </p>\n\n<blockquote>\n  <p>To initialize a map, use the built in make function.</p>\n</blockquote>\n\n<p>The make function allocates and initializes a hash map data structure and returns a map value that points to it. This means you can write into it, compare to </p>\n\n<pre><code>var m map[string]int\n</code></pre>\n\n<p>which is readable, resulting a <code>nil</code> map, but an attempt to write to a nil map will cause a runtime panic. This is the reason why it's important to initialize the map with <code>make</code>.</p>\n\n<pre><code>m = make(map[string]int)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 3, "last_activity_date": 1464786369, "creation_date": 1464786369, "answer_id": 37569587, "question_id": 37568346, "link": "https://stackoverflow.com/questions/37568346/map-types-are-reference-types-var-m-mapstringint-doesnt-point-to-an-initiali/37569587#37569587", "title": "Map types are reference types. var m map[string]int doesn&#39;t point to an initialized map. What doe this mean?", "body": "<blockquote>\n  <p>What does var m map[string]int do?</p>\n</blockquote>\n\n<p>It tells the compiler that <code>m</code> is a variable of type <code>map[string]int</code>, and assigns \"The Zero Value\" of the type map[string] int to <code>m</code> (that's why m is nil as nil is The Zero Value of any map).</p>\n\n<blockquote>\n  <p>Why do I need to write m = make(map[string]int) but not i = make(int)</p>\n</blockquote>\n\n<p>You don't need to. You can create a initialized map also like this:</p>\n\n<pre><code>m = map[string]int{}\n</code></pre>\n\n<p>which does exactly the same.</p>\n\n<p>The difference between maps and ints is: A nil map is perfectly fine. E.g. <code>len()</code> of a nil map works and is 0. The only thing you cannot do with a nil map is store key-value-pairs. If you want to do this you'll have to prepare/initialize the map. This preparation/initialization in Go is done through the builtin <code>make</code> (or by a literal map as shown above). This initialization process is not needed for ints. As there are no nil ints this initialization would be total noise.</p>\n\n<p>Note that you do not initialize the <em>variable</em> <code>m</code>: The variable <code>m</code> is a map of strings to ints, initialized or not. Like <code>i</code> is a variable for ints. Now ints are directly usable while maps require one more step because the language works that way.</p>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 478, "favorite_count": 1, "accepted_answer_id": 37569587, "answer_count": 3, "score": 2, "last_activity_date": 1464787241, "creation_date": 1464783233, "last_edit_date": 1464787241, "question_id": 37568346, "link": "https://stackoverflow.com/questions/37568346/map-types-are-reference-types-var-m-mapstringint-doesnt-point-to-an-initiali", "title": "Map types are reference types. var m map[string]int doesn&#39;t point to an initialized map. What doe this mean?", "body": "<p>I have read on the golang blog: <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">https://blog.golang.org/go-maps-in-action</a> that:</p>\n\n<blockquote>\n<pre><code>var m map[string]int\n</code></pre>\n  \n  <p>Map types are reference types, like pointers or slices, and so the\n  value of m above is nil; it doesn't point to an initialized map. A nil\n  map behaves like an empty map when reading, but attempts to write to a\n  nil map will cause a runtime panic; don't do that. To initialize a\n  map, use the built in make function:</p>\n\n<pre><code>m = make(map[string]int)\n</code></pre>\n  \n  <p>The make function allocates and initializes a hash map data structure\n  and returns a map value that points to it.</p>\n</blockquote>\n\n<p>I have a hard time understanding some parts of this:</p>\n\n<ul>\n<li>What does <code>var m map[string]int</code> do?</li>\n<li>Why do I need to write <code>m = make(map[string]int)</code> but not <code>i = make(int)</code></li>\n</ul>\n"}, {"tags": ["go", "exception-handling"], "comments": [{"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1464773738, "post_id": 37563478, "comment_id": 62616931, "body": "Why not to do: <code>if err != nil { db.Close(); log.Fatalln(err) }</code>?"}, {"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "reply_to_user": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1464800744, "post_id": 37563478, "comment_id": 62636761, "body": "That would involve passing around the <code>db</code> object to every downstream function, whether it uses it or not, just so it could be used in the error call. I&#39;m sure it would work! But I imagine there has to be a more efficient way"}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 1, "creation_date": 1464823558, "post_id": 37563478, "comment_id": 62647580, "body": "I probably would create some Context object that keeps DB and other staff and would be passing a pointer to it everywhere. Should not be costly.  And why not just use <code>panic()</code>? You can recover and close connection. <a href=\"https://blog.golang.org/defer-panic-and-recover\" rel=\"nofollow noreferrer\">blog.golang.org/defer-panic-and-recover</a>"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 37, "favorite_count": 0, "closed_date": 1464770504, "answer_count": 0, "score": 0, "last_activity_date": 1464770175, "creation_date": 1464770175, "question_id": 37563478, "link": "https://stackoverflow.com/questions/37563478/how-to-ensure-golang-closes-the-db-connection", "closed_reason": "Duplicate", "title": "How to ensure golang closes the DB connection?", "body": "<p>My golang <code>main()</code> routing initializes a db connection and then passes it to another function to start the main processing.</p>\n\n<pre><code>func main() {\n    dbinfo := fmt.Sprintf(\"user=%s dbname=%s sslmode=disable\", \"my_user\", \"my_db\")\n\n    db, err := sql.Connect(\"postgres\", dbinfo)\n    if err != nil { log.Fatalln(err) }\n    defer db.Close()\n\n\n    model.Run(db)\n}\n</code></pre>\n\n<p>The <code>model.Run()</code> method goes off to call several other packages and functions, and just passes the <code>db</code> object around between them. </p>\n\n<p>What if one of those various downstream functions run into an error? Will the program just shut down without closing my connection defined above? Or will it bubble up the exception and execute my <code>defer</code> statement in <code>main()</code>?</p>\n\n<p>For what it's worth, I'm handling all errors as follows -</p>\n\n<pre><code>_, err := someFunction()\nif err != nil { log.Fatalln(err) }\n</code></pre>\n\n<p>Note: <code>Fatalln</code> is equivalent to calling <code>Println</code> and then <code>os.Exit(1)</code> (<a href=\"https://golang.org/pkg/log/#Fatalln\" rel=\"nofollow\">See here</a>)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 3381, "user_id": 3964654, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/ITt1C.jpg?s=128&g=1", "display_name": "wingerse", "link": "https://stackoverflow.com/users/3964654/wingerse"}, "edited": false, "score": 0, "creation_date": 1498839076, "post_id": 37564048, "comment_id": 76682332, "body": "It actually does implement io.ByteReader because io.ByteScanner is a io.ByteReader too."}], "tags": [], "owner": {"reputation": 963, "user_id": 385280, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/82d083ee140420fe7acde11d5109a311?s=128&d=identicon&r=PG", "display_name": "Venkat", "link": "https://stackoverflow.com/users/385280/venkat"}, "is_accepted": false, "score": 0, "last_activity_date": 1464771727, "creation_date": 1464771727, "answer_id": 37564048, "question_id": 37563214, "link": "https://stackoverflow.com/questions/37563214/golang-un-gzip-from-bytes-reader/37564048#37564048", "title": "Golang un-gzip from bytes.Reader", "body": "<p>As per the <a href=\"https://godoc.org/compress/gzip#NewReader\" rel=\"nofollow\">documentation</a> for <code>gzip.NewReader</code>, <code>If r does not also implement io.ByteReader, the decompressor may read more data than necessary from r.</code></p>\n\n<p>For  <a href=\"https://godoc.org/bytes#Reader\" rel=\"nofollow\">bytes.Reader</a>, <code>A Reader implements the io.Reader, io.ReaderAt, io.WriterTo, io.Seeker, io.ByteScanner, and io.RuneScanner interfaces by reading from a byte slice.</code></p>\n\n<p>The problem maybe lies in the fact that <code>bytes.Reader</code> does not implement <code>io.ByteReader</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": true, "score": 2, "last_activity_date": 1464773635, "creation_date": 1464773635, "answer_id": 37564773, "question_id": 37563214, "link": "https://stackoverflow.com/questions/37563214/golang-un-gzip-from-bytes-reader/37564773#37564773", "title": "Golang un-gzip from bytes.Reader", "body": "<p>I believe you should close gzip writer before geting bytes from the underlying buffer.</p>\n\n<pre><code>func (f *File) Zip() error {\n    buff := bytes.NewBuffer(nil)\n\n    writer := gzip.NewWriter(buff)\n    defer writer.Close()\n\n    _, err := f.Body.WriteTo(writer)\n    if err != nil {\n        return err\n    }\n\n    writer.Close() // I have added this line\n\n    f.Body = bytes.NewReader(buff.Bytes())\n    f.Name = fmt.Sprintf(\"%s.gz\", f.Name)\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 5954, "user_id": 230392, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uwtL7.jpg?s=128&g=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/230392/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1562, "favorite_count": 0, "accepted_answer_id": 37564773, "answer_count": 2, "score": 0, "last_activity_date": 1464773635, "creation_date": 1464769437, "question_id": 37563214, "link": "https://stackoverflow.com/questions/37563214/golang-un-gzip-from-bytes-reader", "title": "Golang un-gzip from bytes.Reader", "body": "<p>I have a file struct that holds a body which is just a <code>*bytes.Reader</code> I have two methods on the struct <code>Zip() error</code> and <code>UnZip() error</code>.  When I call <code>Zip</code> it should zip the file storing the zipped data in body and I should be able to call <code>UnZip</code> on the same file and store the unzipped data in the body. </p>\n\n<p>The minimal example I have is below in the playground. <a href=\"https://play.golang.org/p/WmZtqtvnyN\" rel=\"nofollow\">https://play.golang.org/p/WmZtqtvnyN</a></p>\n\n<p>I'm able to zip the file just fine and looks like it's doing what it's supposed to do; however, when I try and unzip the file I get <code>unexpected EOF</code></p>\n\n<p>I've been going at this for hours now. Any help is greatly appreciated.</p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 74, "last_activity_date": 1557909679, "last_edit_date": 1557909679, "creation_date": 1464769111, "answer_id": 37563128, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/37563128#37563128", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>There is no one-liner as you have it in Ruby, but with a helper function you can make it almost as short.</p>\n\n<p>Here's our helper function that loops over a slice, and selects and returns only the elements that meet a criteria captured by a function value:</p>\n\n<pre><code>func filter(ss []string, test func(string) bool) (ret []string) {\n    for _, s := range ss {\n        if test(s) {\n            ret = append(ret, s)\n        }\n    }\n    return\n}\n</code></pre>\n\n<p>Using this helper function your task:</p>\n\n<pre><code>ss := []string{\"foo_1\", \"asdf\", \"loooooooong\", \"nfoo_1\", \"foo_2\"}\n\nmytest := func(s string) bool { return !strings.HasPrefix(s, \"foo_\") &amp;&amp; len(s) &lt;= 7 }\ns2 := filter(ss, mytest)\n\nfmt.Println(s2)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ahlSqR53wt9\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[asdf nfoo_1]\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>If it is expected that many elements will be selected, it might be profitable to allocate a \"big\" <code>ret</code> slice beforehand, and use simple assignment instead of the <code>append()</code>. And before returning, slice the <code>ret</code> to have a length equal to the number of selected elements.</p>\n\n<p><strong>Note #2:</strong></p>\n\n<p>In my example I chose a <code>test()</code> function which tells if an element is to be returned. So I had to invert your \"exclusion\" condition. Obviously you may write the helper function to expect a tester function which tells what to exclude (and not what to include).</p>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 5, "last_activity_date": 1464773100, "last_edit_date": 1464773100, "creation_date": 1464769480, "answer_id": 37563232, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/37563232#37563232", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>There isn't an idiomatic way you can achieve the same expected result in Go in one single line as in Ruby, but with a helper function you can obtain the same expressiveness as in Ruby. </p>\n\n<p>You can call this helper function as:</p>\n\n<pre><code>Filter(strs, func(v string) bool {\n    return strings.HasPrefix(v, \"foo_\") // return foo_testfor\n}))\n</code></pre>\n\n<p>Here is the whole code:</p>\n\n<pre><code>package main\n\nimport \"strings\"\nimport \"fmt\"\n\n// Returns a new slice containing all strings in the\n// slice that satisfy the predicate `f`.\nfunc Filter(vs []string, f func(string) bool) []string {\n    vsf := make([]string, 0)\n    for _, v := range vs {\n        if f(v) &amp;&amp; len(v) &gt; 7 {\n            vsf = append(vsf, v)\n        }\n    }\n    return vsf\n}\n\nfunc main() {\n\n    var strs = []string{\"foo1\", \"foo2\", \"foo3\", \"foo3\", \"foo_testfor\", \"_foo\"}\n\n    fmt.Println(Filter(strs, func(v string) bool {\n        return strings.HasPrefix(v, \"foo_\") // return foo_testfor\n    }))\n}\n</code></pre>\n\n<p>And the running example: <a href=\"https://play.golang.org/p/GzF1wleeSo\" rel=\"noreferrer\">Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 11680, "user_id": 3022127, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/l0OvV.jpg?s=128&g=1", "display_name": "bersling", "link": "https://stackoverflow.com/users/3022127/bersling"}, "edited": false, "score": 1, "creation_date": 1521479471, "post_id": 37563270, "comment_id": 85738208, "body": "I think the for loop would be more idiomatic like this:      <code>for _, elt := range a {         if(!strings.HasPrefix(elt, &quot;foo_&quot;) &amp;&amp; len(elt) &lt;= 7) {             nofoos = append(nofoos, elt)         }     }</code>"}], "tags": [], "owner": {"reputation": 1434, "user_id": 377655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yMoLD.jpg?s=128&g=1", "display_name": "Elwin Arens", "link": "https://stackoverflow.com/users/377655/elwin-arens"}, "is_accepted": false, "score": 20, "last_activity_date": 1493802922, "last_edit_date": 1493802922, "creation_date": 1464769566, "answer_id": 37563270, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/37563270#37563270", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>Have a look at <a href=\"https://github.com/robpike/filter\" rel=\"noreferrer\">robpike's filter library</a>. This would allow you to do:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n    \"filter\"\n)\n\nfunc isNoFoo7(a string) bool {\n    return ! strings.HasPrefix(a, \"foo_\") &amp;&amp; len(a) &lt;= 7\n}\n\nfunc main() {\n    a := []string{\"test\", \"some_other_test\", \"foo_etc\"}\n    result := Choose(a, isNoFoo7)\n    fmt.Println(result) // [test]\n}\n</code></pre>\n\n<p>Interestingly enough the README.md by Rob:</p>\n\n<blockquote>\n  <p>I wanted to see how hard it was to implement this sort of thing in Go, with as nice an API as I could manage. It wasn't hard.\n  Having written it a couple of years ago, I haven't had occasion to use it once. Instead, I just use \"for\" loops.\n  You shouldn't use it either.</p>\n</blockquote>\n\n<p>So the most idiomatic way according to Rob would be something like:</p>\n\n<pre><code>func main() {\n    a := []string{\"test\", \"some_other_test\", \"foo_etc\"}\n    nofoos := []string{}\n    for i := range a {\n        if(!strings.HasPrefix(a[i], \"foo_\") &amp;&amp; len(a[i]) &lt;= 7) {\n            nofoos = append(nofoos, a[i])\n        }\n    }\n    fmt.Println(nofoos) // [test]\n}\n</code></pre>\n\n<p>This style is very similar, if not identical, to the approach any C-family language takes.</p>\n"}, {"tags": [], "owner": {"reputation": 11680, "user_id": 3022127, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/l0OvV.jpg?s=128&g=1", "display_name": "bersling", "link": "https://stackoverflow.com/users/3022127/bersling"}, "is_accepted": false, "score": 1, "last_activity_date": 1521489171, "creation_date": 1521489171, "answer_id": 49371313, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/49371313#49371313", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>\"Select Elements from Array\" is also commonly called a <strong>filter function</strong>. There's no such thing in go. There are also no other \"Collection Functions\" such as map or reduce. For the most idiomatic way to get the desired result, I find <a href=\"https://gobyexample.com/collection-functions\" rel=\"nofollow noreferrer\">https://gobyexample.com/collection-functions</a> a good reference:</p>\n\n<blockquote>\n  <p>[...] in Go it\u2019s common to provide collection functions if and when they are specifically needed for your program and data types.</p>\n</blockquote>\n\n<p>They provide an implementation example of the filter function for strings:</p>\n\n<pre><code>func Filter(vs []string, f func(string) bool) []string {\n    vsf := make([]string, 0)\n    for _, v := range vs {\n        if f(v) {\n            vsf = append(vsf, v)\n        }\n    }\n    return vsf\n}\n</code></pre>\n\n<p>However, they also say, that it's often ok to just inline the function:</p>\n\n<blockquote>\n  <p>Note that in some cases it may be clearest to just inline the\n  collection-manipulating code directly, instead of creating and calling\n  a helper function.</p>\n</blockquote>\n\n<p>In general, golang tries to only introduce orthogonal concepts, meaning that when you can solve a problem one way, there shouldn't be too many more ways to solve it. This adds simplicity to the language by only having a few core concepts, such that not every developer uses a different subset of the language.</p>\n"}, {"comments": [{"owner": {"reputation": 1537, "user_id": 320229, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/5ba244e7ecbefc56ef8130b78f8a0aaf?s=128&d=identicon&r=PG", "display_name": "Theodore Zographos", "link": "https://stackoverflow.com/users/320229/theodore-zographos"}, "edited": false, "score": 0, "creation_date": 1546707520, "post_id": 50183212, "comment_id": 94942544, "body": "It&#39;s a classic &#39;trick&#39;.  s = s[:0] retains the underlying array and slice capacity, zeroing only the slice length."}], "tags": [], "owner": {"reputation": 594, "user_id": 2654541, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acfa49aaf3b8bbf839a09a9a2e8414bb?s=128&d=identicon&r=PG", "display_name": "MicahStetson", "link": "https://stackoverflow.com/users/2654541/micahstetson"}, "is_accepted": false, "score": 9, "last_activity_date": 1525468976, "creation_date": 1525468976, "answer_id": 50183212, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/50183212#50183212", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>Today, I stumbled on a pretty idiom that surprised me. If you want to filter a slice in place without allocating, use two slices with the same backing array:</p>\n\n<pre><code>s := []T{\n    // the input\n} \ns2 := s\ns = s[:0]\nfor _, v := range s2 {\n    if shouldKeep(v) {\n        s = append(s, v)\n    }\n}\n</code></pre>\n\n<p>Here's a specific example of removing duplicate strings:</p>\n\n<pre><code>s := []string{\"a\", \"a\", \"b\", \"c\", \"c\"}\ns2 := s\ns = s[:0]\nvar last string\nfor _, v := range s2 {\n    if len(s) == 0 || v != last {\n        last = v\n        s = append(s, v)\n    }\n}\n</code></pre>\n\n<p>If you need to keep both slices, simply replace <code>s = s[:0]</code> with <code>s = nil</code> or <code>s = make([]T, 0, len(s))</code>, depending on whether you want <code>append()</code> to allocate for you.</p>\n"}, {"tags": [], "owner": {"reputation": 98, "user_id": 4265419, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b79aeb6fc6e8677cfbbcc760b45b286c?s=128&d=identicon&r=PG&f=1", "display_name": "wan_keen", "link": "https://stackoverflow.com/users/4265419/wan-keen"}, "is_accepted": false, "score": 1, "last_activity_date": 1573308054, "creation_date": 1573308054, "answer_id": 58780014, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/58780014#58780014", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>Take a look at this library: <a href=\"https://github.com/thoas/go-funk\" rel=\"nofollow noreferrer\">github.com/thoas/go-funk</a>\nIt provides an implementation of a lot of life-saving idioms in Go (including filtering of elements in array for instance).</p>\n\n<pre><code>r := funk.Filter([]int{1, 2, 3, 4}, func(x int) bool {\n    return x%2 == 0\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 745, "user_id": 2540509, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a053895b4bd95faef139fb2f9a87ec9e?s=128&d=identicon&r=PG", "display_name": "Antony Mativos", "link": "https://stackoverflow.com/users/2540509/antony-mativos"}, "is_accepted": false, "score": 4, "last_activity_date": 1612360763, "last_edit_date": 1612360763, "creation_date": 1574771657, "answer_id": 59051095, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/59051095#59051095", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>There are a couple of nice ways to filter a slice without allocations or new dependencies. Found in <a href=\"https://github.com/golang/go/wiki/SliceTricks#filtering-without-allocating\" rel=\"nofollow noreferrer\">the Go wiki on Github</a>:</p>\n<blockquote>\n<p><strong>Filter (in place)</strong></p>\n<pre><code>n := 0\n\nfor _, x := range a {\n  if keep(x) {\n      a[n] = x\n      n++\n  }\n\n}\na = a[:n]\n</code></pre>\n</blockquote>\n<p>And another, more readable, way:</p>\n<blockquote>\n<p><strong>Filtering without allocating</strong></p>\n<p>This trick uses the fact that a slice shares the same backing array\nand capacity as the original, so the storage is reused for the\nfiltered slice. Of course, the original contents are modified.</p>\n<pre><code>b := a[:0]\n\nfor _, x := range a {\n  if f(x) {\n      b = append(b, x)\n  }\n}\n</code></pre>\n<p>For elements which must be garbage collected, the following code can\nbe included afterwards:</p>\n<pre><code>for i := len(b); i &lt; len(a); i++ {\n  a[i] = nil // or the zero value of T\n}\n</code></pre>\n</blockquote>\n<p>One thing I'm not sure about is whether the first method needs clearing (setting to <code>nil</code>) the items in slice <code>a</code> after index <code>n</code>, like they do in the second method.</p>\n<p>EDIT: the second way is basically what MicahStetson described in <a href=\"https://stackoverflow.com/a/50183212/2540509\">his answer</a>. In my code I use a function similar to the following, which is probably as good as it gets in terms on performance and readability:</p>\n<pre><code>func filterSlice(slice []*T, keep func(*T) bool) []*T {\n    newSlice := slice[:0]\n\n    for _, item := range slice {\n        if keep(item) {\n            newSlice = append(newSlice, item)\n        }\n    }\n    // make sure discarded items can be garbage collected\n    for i := len(newSlice); i &lt; len(slice); i++ {\n        slice[i] = nil\n    }\n    return newSlice\n}\n</code></pre>\n<p>Note that if items in your slice are not pointers and don't contain pointers you can skip the second for loop.</p>\n"}, {"tags": [], "owner": {"reputation": 13, "user_id": 1676272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/322644ceb4ed4436747da3bdc1d41641?s=128&d=identicon&r=PG", "display_name": "Jose78", "link": "https://stackoverflow.com/users/1676272/jose78"}, "is_accepted": false, "score": 0, "last_activity_date": 1598186597, "last_edit_date": 1598186597, "creation_date": 1597962419, "answer_id": 63513941, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/63513941#63513941", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>I`m developing this library: <a href=\"https://github.com/jose78/go-collection\" rel=\"nofollow noreferrer\">https://github.com/jose78/go-collection</a>. PLease try this example to filter elements:</p>\n<pre><code>package main\n    \nimport (\n    &quot;fmt&quot;\n\n    col &quot;github.com/jose78/go-collection/collections&quot;\n)\n\ntype user struct {\n    name string\n    age  int\n    id   int\n}\n\nfunc main() {\n    newMap := generateMapTest()\n    if resultMap, err := newMap.FilterAll(filterEmptyName); err != nil {\n        fmt.Printf(&quot;error&quot;)\n    } else {\n        fmt.Printf(&quot;Result: %v\\n&quot;, resultMap)\n\n        result := resultMap.ListValues()\n        fmt.Printf(&quot;Result: %v\\n&quot;, result)\n        fmt.Printf(&quot;Result: %v\\n&quot;, result.Reverse())\n        fmt.Printf(&quot;Result: %v\\n&quot;, result.JoinAsString(&quot; &lt;---&gt; &quot;))\n        fmt.Printf(&quot;Result: %v\\n&quot;, result.Reverse().JoinAsString(&quot; &lt;---&gt; &quot;))\n\n        result.Foreach(simpleLoop)\n        err := result.Foreach(simpleLoopWithError)\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n\nfunc filterEmptyName(key interface{}, value interface{}) bool {\n    user := value.(user)\n    return user.name != &quot;empty&quot;\n}\n\nfunc generateMapTest() (container col.MapType) {\n    container = col.MapType{}\n    container[1] = user{&quot;Alvaro&quot;, 6, 1}\n    container[2] = user{&quot;Sofia&quot;, 3, 2}\n    container[3] = user{&quot;empty&quot;, 0, -1}\n    return container\n}\n\nvar simpleLoop col.FnForeachList = func(mapper interface{}, index int) {\n    fmt.Printf(&quot;%d.- item:%v\\n&quot;, index, mapper)\n}\n\nvar simpleLoopWithError col.FnForeachList = func(mapper interface{}, index int) {\n    if index &gt; 0 {\n        panic(fmt.Sprintf(&quot;Error produced with index == %d\\n&quot;, index))\n    }\n    fmt.Printf(&quot;%d.- item:%v\\n&quot;, index, mapper)\n}\n</code></pre>\n<p>Result of execution:</p>\n<pre><code>Result: map[1:{Alvaro 6 1} 2:{Sofia 3 2}]\nResult: [{Sofia 3 2} {Alvaro 6 1}]\nResult: [{Alvaro 6 1} {Sofia 3 2}]\nResult: {Sofia 3 2} &lt;---&gt; {Alvaro 6 1}\nResult: {Alvaro 6 1} &lt;---&gt; {Sofia 3 2}\n0.- item:{Sofia 3 2}\n1.- item:{Alvaro 6 1}\n0.- item:{Sofia 3 2}\nRecovered in f Error produced with index == 1\n\nERROR: Error produced with index == 1\nError produced with index == 1\n</code></pre>\n<p>The DOC currently are located in <a href=\"https://github.com/jose78/go-collection/wiki\" rel=\"nofollow noreferrer\">wiki section of the project</a>. You can try it in this <a href=\"https://play.golang.org/p/cslGN46nC72\" rel=\"nofollow noreferrer\">link</a>. I hope you like it...</p>\n<p>REgaRDS...</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 6692214, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fa33dbca06afb68326a0ad8a02945645?s=128&d=identicon&r=PG&f=1", "display_name": "M Long", "link": "https://stackoverflow.com/users/6692214/m-long"}, "is_accepted": false, "score": 1, "last_activity_date": 1612557217, "last_edit_date": 1612557217, "creation_date": 1612546877, "answer_id": 66068041, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang/66068041#66068041", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>Here is an elegant example of both Fold and Filter that uses recursion to accomplish filtering. FoldRight is also generally useful.  It is not stack safe but could be made so with trampolining.  Once Golang has generics it can be entirely generalized for any 2 types:</p>\n<pre><code>func FoldRightStrings(as, z []string, f func(string, []string) []string) []string {\n    if len(as) &gt; 1 {//Slice has a head and a tail.\n        h, t := as[0], as[1:len(as)]\n        return f(h, FoldRightStrings(t, z, f))\n    } else if len(as) == 1 {//Slice has a head and an empty tail.\n        h := as[0]\n        return f(h, FoldRightStrings([]string{}, z, f))\n    }\n    return z\n}\n\nfunc FilterStrings(as []string, p func(string) bool) []string {\n    var g = func(h string, accum []string) []string {\n        if p(h) {\n            return append(accum, h)\n        } else {\n            return accum\n        }\n    }\n    return FoldRightStrings(as, []string{}, g)\n}\n</code></pre>\n<p>Here is an example of its usage to filter out all the strings with length &lt; 8</p>\n<pre><code>    var p = func(s string) bool {\n                if len(s) &lt; 8 {\n                    return true\n                } else {\n                    return false\n                }\n            }\n\n FilterStrings([]string{&quot;asd&quot;,&quot;asdfas&quot;,&quot;asdfasfsa&quot;,&quot;asdfasdfsadfsadfad&quot;}, p)\n</code></pre>\n"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57874, "favorite_count": 8, "accepted_answer_id": 37563128, "answer_count": 9, "score": 52, "last_activity_date": 1612557217, "creation_date": 1464768313, "last_edit_date": 1475863452, "question_id": 37562873, "link": "https://stackoverflow.com/questions/37562873/most-idiomatic-way-to-select-elements-from-an-array-in-golang", "title": "Most idiomatic way to select elements from an array in Golang?", "body": "<p>I have an array of strings, and I'd like to exclude values that start in <code>foo_</code> OR are longer than 7 characters.</p>\n\n<p>I can loop through each element, run the <code>if</code> statement, and add it to a slice along the way. But I was curious if there was an idiomatic or more golang-like way of accomplishing that.</p>\n\n<p>Just for example, the same thing might be done in Ruby as</p>\n\n<pre><code>my_array.select! { |val| val !~ /^foo_/ &amp;&amp; val.length &lt;= 7 }\n</code></pre>\n"}, {"tags": ["database", "postgresql", "go"], "comments": [{"owner": {"reputation": 5778, "user_id": 5921693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/104a78260ca097069cf8f8179e41acdd?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/5921693/nick"}, "edited": false, "score": 1, "creation_date": 1464761130, "post_id": 37560534, "comment_id": 62609444, "body": "Any reason you don&#39;t want to check if the database exists before attempting to drop it?"}, {"owner": {"reputation": 1303, "user_id": 779404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1312959fa177c836dc5ecee589dc487f?s=128&d=identicon&r=PG", "display_name": "b0xxed1n", "link": "https://stackoverflow.com/users/779404/b0xxed1n"}, "reply_to_user": {"reputation": 5778, "user_id": 5921693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/104a78260ca097069cf8f8179e41acdd?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/5921693/nick"}, "edited": false, "score": 0, "creation_date": 1464761260, "post_id": 37560534, "comment_id": 62609501, "body": "That would be an acceptable solution too, I wasn&#39;t aware I could do that :-) Is there a query for that?"}, {"owner": {"reputation": 5778, "user_id": 5921693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/104a78260ca097069cf8f8179e41acdd?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/5921693/nick"}, "edited": false, "score": 0, "creation_date": 1464761479, "post_id": 37560534, "comment_id": 62609599, "body": "Certainly. Check out the pg_database object. <code>SELECT TRUE AS result FROM pg_database WHERE datname=&#39;abc&#39;;</code>"}, {"owner": {"reputation": 5778, "user_id": 5921693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/104a78260ca097069cf8f8179e41acdd?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/5921693/nick"}, "edited": false, "score": 0, "creation_date": 1464761556, "post_id": 37560534, "comment_id": 62609642, "body": "Also, if you want to avoid the whole issue, simply: <code>DROP DATABASE IF EXISTS dbName;</code>"}, {"owner": {"reputation": 1303, "user_id": 779404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1312959fa177c836dc5ecee589dc487f?s=128&d=identicon&r=PG", "display_name": "b0xxed1n", "link": "https://stackoverflow.com/users/779404/b0xxed1n"}, "reply_to_user": {"reputation": 5778, "user_id": 5921693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/104a78260ca097069cf8f8179e41acdd?s=128&d=identicon&r=PG", "display_name": "Nick", "link": "https://stackoverflow.com/users/5921693/nick"}, "edited": false, "score": 0, "creation_date": 1464762324, "post_id": 37560534, "comment_id": 62610003, "body": "Oh awesome, thanks, that&#39;s perfect."}], "answers": [{"comments": [{"owner": {"reputation": 1303, "user_id": 779404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1312959fa177c836dc5ecee589dc487f?s=128&d=identicon&r=PG", "display_name": "b0xxed1n", "link": "https://stackoverflow.com/users/779404/b0xxed1n"}, "edited": false, "score": 1, "creation_date": 1464762407, "post_id": 37560627, "comment_id": 62610038, "body": "Thank you, this was helpful, however I&#39;m just going to use what Nicarus mentioned above (DROP DATABASE IF EXISTS dbName;).  If anyone is curious what the error message returned is though, it was this:  pq.Error{Severity:&quot;ERROR&quot;, Code:&quot;3D000&quot;, Message:&quot;database \\&quot;dbname\\&quot; does not exist&quot;, Detail:&quot;&quot;, Hint:&quot;&quot;, Position:&quot;&quot;, InternalPosition:&quot;&quot;, InternalQuery:&quot;&quot;, Where:&quot;&quot;, Schema:&quot;&quot;, Table:&quot;&quot;, Column:&quot;&quot;, DataTypeName:&quot;&quot;, Constraint:&quot;&quot;, File:&quot;dbcommands.c&quot;, Line:&quot;799&quot;, Routine:&quot;dropdb&quot;} Unable to execute setup: pq: database &quot;dbname&quot; does not exist"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 18, "last_activity_date": 1464761102, "creation_date": 1464761102, "answer_id": 37560627, "question_id": 37560534, "link": "https://stackoverflow.com/questions/37560534/golang-postgres-error-constants/37560627#37560627", "title": "Golang postgres error constants?", "body": "<p>The <a href=\"https://godoc.org/github.com/lib/pq\" rel=\"noreferrer\"><code>lib/pq</code></a> package may return errors of type <a href=\"https://godoc.org/github.com/lib/pq#Error\" rel=\"noreferrer\"><code>*pq.Error</code></a>, which is a struct. If it does, you may use all its fields to inspect for details of the error.</p>\n\n<p>This is how it can be done:</p>\n\n<pre><code>if err, ok := err.(*pq.Error); ok {\n    // Here err is of type *pq.Error, you may inspect all its fields, e.g.:\n    fmt.Println(\"pq error:\", err.Code.Name())\n}\n</code></pre>\n\n<p><code>pq.Error</code> has the following fields:</p>\n\n<pre><code>type Error struct {\n    Severity         string\n    Code             ErrorCode\n    Message          string\n    Detail           string\n    Hint             string\n    Position         string\n    InternalPosition string\n    InternalQuery    string\n    Where            string\n    Schema           string\n    Table            string\n    Column           string\n    DataTypeName     string\n    Constraint       string\n    File             string\n    Line             string\n    Routine          string\n}\n</code></pre>\n\n<p>The meaning and possible values of these fields are Postres specific and the full list can be found here: <a href=\"https://www.postgresql.org/docs/current/static/protocol-error-fields.html\" rel=\"noreferrer\">Error and Notice Message Fields</a></p>\n"}], "owner": {"reputation": 1303, "user_id": 779404, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/1312959fa177c836dc5ecee589dc487f?s=128&d=identicon&r=PG", "display_name": "b0xxed1n", "link": "https://stackoverflow.com/users/779404/b0xxed1n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6006, "favorite_count": 1, "accepted_answer_id": 37560627, "answer_count": 1, "score": 8, "last_activity_date": 1464761102, "creation_date": 1464760720, "question_id": 37560534, "link": "https://stackoverflow.com/questions/37560534/golang-postgres-error-constants", "title": "Golang postgres error constants?", "body": "<p>I'm trying to delete a database using the postgres driver (lib/pq) by doing a:</p>\n\n<p><code>db.Exec(\"DROP DATABASE dbName;\")</code></p>\n\n<p>But I'd like to do a different conditional based on whether the error received is something strange, or is a \"database does not exist\" error.</p>\n\n<p>My question is, is there a constant variable or something I can use to check if the error returned is a \"database does not exist\" error message, or would I have to manually parse the error string myself?</p>\n\n<p>I tried to look in the documentation, but could not find anything for \"database does not exist\". I did however find this list: <a href=\"https://www.postgresql.org/docs/9.3/static/errcodes-appendix.html\" rel=\"noreferrer\">https://www.postgresql.org/docs/9.3/static/errcodes-appendix.html</a></p>\n\n<p>Perhaps it fits under some other error code? Also I'm not quite sure the semantically correct way of fetching and comparing the error codes through the Postgres driver. I presume I should do something like this?:</p>\n\n<p><code>if err.ErrorCode != \"xxx\"</code></p>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1464758701, "post_id": 37559744, "comment_id": 62608445, "body": "<code>temp := PublicVar</code> <b>does</b> copy the value and does nothing else. It is impossible to &quot;change the name&quot; of a variable in Go (exported or unexported). What are you trying to do?"}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464761933, "post_id": 37559744, "comment_id": 62609821, "body": "@Volker actually temp := PublicVar does not copy the value always. For example if PublicVar is referring a slice or a channel or a map, then temp also will be referring to the same copy of the data."}, {"owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "reply_to_user": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 1, "creation_date": 1464762312, "post_id": 37559744, "comment_id": 62609996, "body": "@Nipun Thats because slices channels and maps are reference types. Not because <code>:=</code> behaves differently. It does always copy the <i>value</i>. In case of slices, channels and maps the value is a reference."}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "reply_to_user": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "edited": false, "score": 0, "creation_date": 1464762452, "post_id": 37559744, "comment_id": 62610059, "body": "@AH Thanks for clarifying."}], "answers": [{"comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1464762234, "post_id": 37560189, "comment_id": 62609959, "body": "Among the stuffs I miss in Go are constructors, copy constructors, assignment operators that are almost always used in C++. The confusions and dangers that we see in the example is much lesser in C++."}, {"owner": {"reputation": 534, "user_id": 6112213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/N48wo.jpg?s=128&g=1", "display_name": "HeadwindFly", "link": "https://stackoverflow.com/users/6112213/headwindfly"}, "edited": false, "score": 0, "creation_date": 1464765184, "post_id": 37560189, "comment_id": 62611471, "body": "I want to copy value of slice not reference, what is correct way?"}], "tags": [], "owner": {"reputation": 4928, "user_id": 1150725, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/dfe8aa21199e444d60f32a9ec4f94c6e?s=128&d=identicon&r=PG&f=1", "display_name": "Aruna Herath", "link": "https://stackoverflow.com/users/1150725/aruna-herath"}, "is_accepted": true, "score": 3, "last_activity_date": 1464770498, "last_edit_date": 1495541277, "creation_date": 1464759215, "answer_id": 37560189, "question_id": 37559744, "link": "https://stackoverflow.com/questions/37559744/how-to-copy-a-public-variable-use-go/37560189#37560189", "title": "How to copy a public variable use go?", "body": "<p>This happen because probably <code>PublicVar</code> is a pointer to an instance. So <code>temp</code> is also pointing to the same instance. You can get a value type by following.</p>\n\n<pre><code>temp := *PublicVar\ntemp.name = \"bob\"\n</code></pre>\n\n<p>See an example at <a href=\"https://play.golang.org/p/lmEsuhTOsz\" rel=\"nofollow noreferrer\">Playground</a></p>\n\n<p><strong>Edit</strong>: Since the question is edited to show the variable of concern is a slice, khrm's <a href=\"https://stackoverflow.com/a/37562171/1150725\">answer</a> is more relevant.</p>\n"}, {"tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": false, "score": 1, "last_activity_date": 1464766219, "creation_date": 1464766219, "answer_id": 37562171, "question_id": 37559744, "link": "https://stackoverflow.com/questions/37559744/how-to-copy-a-public-variable-use-go/37562171#37562171", "title": "How to copy a public variable use go?", "body": "<p>Go copy by value. But in case of maps and slices, there is an exceptions in that only their reference is copied as they are implemented as reference type.</p>\n\n<p>In case of slice, you can do this using builtin copy:</p>\n\n<pre><code>b := make([]string, len(a))\ncopy(b,a)\n</code></pre>\n\n<p>In case of maps:</p>\n\n<pre><code>for k, v := range a {\n    b[k] = v\n}\n</code></pre>\n"}], "owner": {"reputation": 534, "user_id": 6112213, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/N48wo.jpg?s=128&g=1", "display_name": "HeadwindFly", "link": "https://stackoverflow.com/users/6112213/headwindfly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 73, "favorite_count": 0, "accepted_answer_id": 37560189, "answer_count": 2, "score": 0, "last_activity_date": 1464770498, "creation_date": 1464757047, "last_edit_date": 1464764999, "question_id": 37559744, "link": "https://stackoverflow.com/questions/37559744/how-to-copy-a-public-variable-use-go", "title": "How to copy a public variable use go?", "body": "<p>How to copy a public variable use go?</p>\n\n<p>For example, a public variadble named PublicVar</p>\n\n<pre><code>a := []string{\"A\", \"B\"}\nb := a\nfmt.Printf(\"%v\\n\", a)\nfmt.Printf(\"%v\\n\", b)\n\nb[0] = \"C\"\nfmt.Printf(\"%v\\n\", a)\nfmt.Printf(\"%v\\n\", b)\n// a has been changed.\n</code></pre>\n\n<p>The PublicVar's name will be changed, but this is not what I want. </p>\n\n<p>I just want to copy the value of PublicVar.</p>\n"}, {"tags": ["go", "broadcast", "shutdown", "channel"], "answers": [{"comments": [{"owner": {"reputation": 723, "user_id": 1065474, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ccbe7da9a44a8737ca2eda4462c42fe1?s=128&d=identicon&r=PG", "display_name": "Martin Sustrik", "link": "https://stackoverflow.com/users/1065474/martin-sustrik"}, "edited": false, "score": 0, "creation_date": 1464768466, "post_id": 37561489, "comment_id": 62613428, "body": "So every &lt;- in the worker would have to be replaced by 3-way select, correct?"}, {"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "reply_to_user": {"reputation": 723, "user_id": 1065474, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ccbe7da9a44a8737ca2eda4462c42fe1?s=128&d=identicon&r=PG", "display_name": "Martin Sustrik", "link": "https://stackoverflow.com/users/1065474/martin-sustrik"}, "edited": false, "score": 0, "creation_date": 1464772279, "post_id": 37561489, "comment_id": 62615879, "body": "Yes, if you have one or more additional channels providing values to do work with."}], "tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": true, "score": 2, "last_activity_date": 1464764191, "creation_date": 1464764191, "answer_id": 37561489, "question_id": 37559715, "link": "https://stackoverflow.com/questions/37559715/close-golang-channel-with-multiple-values/37561489#37561489", "title": "Close golang channel with multiple values", "body": "<p>Personally I'd use two channels to signal shutdown: <a href=\"https://play.golang.org/p/5erPW1tFXp\" rel=\"nofollow\">https://play.golang.org/p/5erPW1tFXp</a></p>\n"}], "owner": {"reputation": 723, "user_id": 1065474, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ccbe7da9a44a8737ca2eda4462c42fe1?s=128&d=identicon&r=PG", "display_name": "Martin Sustrik", "link": "https://stackoverflow.com/users/1065474/martin-sustrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 37561489, "answer_count": 1, "score": 0, "last_activity_date": 1464765131, "creation_date": 1464756880, "last_edit_date": 1464765131, "question_id": 37559715, "link": "https://stackoverflow.com/questions/37559715/close-golang-channel-with-multiple-values", "title": "Close golang channel with multiple values", "body": "<p>Imagine I have one sender and arbitrary number of receivers connected via a channel. When the sender finishes it closes the channel and all receivers get notified. So far so good.</p>\n\n<p>Now imagine sender wants receivers to finish in two different ways, say, \"close immediately\" and \"first finish what you are doing, then close\". To achieve that it has to broadcast two different values (NOW vs. LATER) to all receivers when shutting down.</p>\n\n<p>What is the Go-idiomatic way to do this?</p>\n"}, {"tags": ["string", "go", "unicode"], "comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464765511, "post_id": 37559689, "comment_id": 62611631, "body": "Now I have given complete code demonstrating this."}], "answers": [{"comments": [{"owner": {"reputation": 1109, "user_id": 4160987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0fe8027fb4a18d37c60f9ecd3268491e?s=128&d=identicon&r=PG&f=1", "display_name": "Varun Patro", "link": "https://stackoverflow.com/users/4160987/varun-patro"}, "edited": false, "score": 0, "creation_date": 1464759360, "post_id": 37560131, "comment_id": 62608715, "body": "How do I then access the first rune of a unicode string?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 1109, "user_id": 4160987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0fe8027fb4a18d37c60f9ecd3268491e?s=128&d=identicon&r=PG&f=1", "display_name": "Varun Patro", "link": "https://stackoverflow.com/users/4160987/varun-patro"}, "edited": false, "score": 0, "creation_date": 1464764647, "post_id": 37560131, "comment_id": 62611199, "body": "unicode/utf8.DecodeRune[InString]: <a href=\"https://golang.org/pkg/unicode/utf8/#DecodeRune\" rel=\"nofollow noreferrer\">golang.org/pkg/unicode/utf8/#DecodeRune</a> and DecodeRuneInString"}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1464758940, "creation_date": 1464758940, "answer_id": 37560131, "question_id": 37559689, "link": "https://stackoverflow.com/questions/37559689/store-unicode-characters-in-golang/37560131#37560131", "title": "Store unicode characters in golang", "body": "<p>Like this: <code>type Char rune</code>.</p>\n\n<p>Pay attention to \"compare\", that is a complicated thing with Unicode. While code points (<code>rune</code>s) are easy to compare numerically (U+0020 == U+0020; U+1234 &lt; U+2345) this might or might not be what you want given case, combining characters and what else Unicode offers.</p>\n"}, {"tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": false, "score": 1, "last_activity_date": 1464765494, "last_edit_date": 1464765494, "creation_date": 1464765060, "answer_id": 37561759, "question_id": 37559689, "link": "https://stackoverflow.com/questions/37559689/store-unicode-characters-in-golang/37561759#37561759", "title": "Store unicode characters in golang", "body": "<ol start=\"2\">\n<li><p>To compare utf8 strings, you need to check their runevalue. Runevalue is int32 value of utf8 character. Use standard package \"unicode/utf8\". Pass \"string[0:]\" to get the first character</p>\n\n<pre><code>    test := \"\u6625\u8282\"\n    runeValue, width := utf8.DecodeRuneInString(test[0:])\n    fmt.Println(runeValue,width)\n    fmt.Printf(\"%#U %d\", runeValue, runeValue)\n</code></pre></li>\n</ol>\n\n<p>Now you can compare runeValue of two strings's first character using == operator</p>\n\n<ol>\n<li><p>Also you need to store string in string if you want to store whole character. </p>\n\n<pre><code>type ds struct {\n    char string // What should Char be so that I can safely compare two ds?\n}\n</code></pre></li>\n</ol>\n\n<p>Complete code demonstrating this: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"unicode/utf8\"\n)\n\ntype ds struct {\n    char string // What should Char be so that I can safely compare two ds?\n}\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n\n    ds1 := ds{\"\u6625\u8282\"}\n    ds2 := ds{\"\u6625\u8282\"}\n\n    runeValue1, _ := utf8.DecodeRuneInString(ds1.char[0:])\n    runeValue2, _ := utf8.DecodeRuneInString(ds2.char[0:])\n\n    fmt.Printf(\"%#U %#U\", runeValue1, runeValue2)\n\n    if runeValue1 == runeValue2 {\n        fmt.Println(\"\\nFirst Char Same\")\n    } else {\n        fmt.Println(\"\\nDifferent\")\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/FrNocJPHV8\" rel=\"nofollow\">Golang Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464843575, "post_id": 37582574, "comment_id": 62652322, "body": "You don&#39;t need to do type Char rune. Unless you are doing []Char(str)[0]"}], "tags": [], "owner": {"reputation": 1109, "user_id": 4160987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0fe8027fb4a18d37c60f9ecd3268491e?s=128&d=identicon&r=PG&f=1", "display_name": "Varun Patro", "link": "https://stackoverflow.com/users/4160987/varun-patro"}, "is_accepted": false, "score": 0, "last_activity_date": 1464840984, "creation_date": 1464840984, "answer_id": 37582574, "question_id": 37559689, "link": "https://stackoverflow.com/questions/37559689/store-unicode-characters-in-golang/37582574#37582574", "title": "Store unicode characters in golang", "body": "<p>From Volkers, answer, we can just use rune to compare. </p>\n\n<ol>\n<li><code>type Char rune</code></li>\n<li>to get the first unicode character we can simply do <code>[]rune(str)[0]</code></li>\n</ol>\n"}], "owner": {"reputation": 1109, "user_id": 4160987, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0fe8027fb4a18d37c60f9ecd3268491e?s=128&d=identicon&r=PG&f=1", "display_name": "Varun Patro", "link": "https://stackoverflow.com/users/4160987/varun-patro"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1093, "favorite_count": 0, "answer_count": 3, "score": -1, "last_activity_date": 1464840984, "creation_date": 1464756715, "last_edit_date": 1464764792, "question_id": 37559689, "link": "https://stackoverflow.com/questions/37559689/store-unicode-characters-in-golang", "title": "Store unicode characters in golang", "body": "<p>I'm creating a data structure for storing single unicode characters which I can then compare.</p>\n\n<p>Two Questions: </p>\n\n<ol>\n<li><p>What data types do I use?</p>\n\n<p><code>type ds struct {\n    char Char // What should Char be so that I can safely compare two ds?\n}</code></p></li>\n<li><p>I need a way to compare the first character of any two unicode strings. Is there a simple way to do that? Basically, how do I retrieve the first unicode character of a string? </p></li>\n</ol>\n"}, {"tags": ["postgresql", "testing", "go"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1464959582, "post_id": 37558570, "comment_id": 62713254, "body": "following up on pie&#39;s answer, you can make a <code>testfixtures</code> package if you need to use the helper across multiple packages&#39; tests"}], "answers": [{"comments": [{"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464756715, "post_id": 37559223, "comment_id": 62607659, "body": "Thanks, I appreciate the detailed explanation! You&#39;re right, it looks like all those testing libraries have their own pros/cons. I ran into the same issue when searching for an ORM for Postgres - there&#39;s a few, but nothing&#39;s really emerged as a robust standard unfortunately. With regards to your example - <code>myOpt</code> and <code>conn</code> in the testing file are not defined in any function, so I guess they get executed once (in the defined order) and are available to all tests?"}, {"owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "reply_to_user": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464757614, "post_id": 37559223, "comment_id": 62607992, "body": "Yes, the <code>conn</code> get created once then is available until <code>destroyConn</code> is called. You can create many <code>conn</code>&#39;s as you want, including mocks and swap them in when testing."}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 1, "last_activity_date": 1464757522, "last_edit_date": 1464757522, "creation_date": 1464753858, "answer_id": 37559223, "question_id": 37558570, "link": "https://stackoverflow.com/questions/37558570/re-usable-components-and-fixtures-in-golang-tests/37559223#37559223", "title": "Re-usable components and fixtures in Golang tests", "body": "<ol>\n<li><p>Go is based on strong package management, meaning a namespace is treated as one single file. If <code>establish_db_connection</code> is used within a single test package, it can begin with a lowercase letter to signify a private instance and use it in the test file with the same package as the code being tested (Note that naming convention in Go is <code>establishDBConnection</code>). \nHowever, most of the time, as in <a href=\"https://golang.org/pkg/database/sql/\" rel=\"nofollow\">data/sql</a>, you will want to obtain a DB connection once and keep that around until the test is finished (more like a factory and injection pattern).</p></li>\n<li><p>There is none in the standard <code>testing</code> package. If you like BDD, <a href=\"https://github.com/smartystreets/goconvey\" rel=\"nofollow\">Goconvey</a> use scopes to define fixtures and a <code>reset</code> function for teardown. </p></li>\n<li><p>You can use factory and dependency injections in your testing. I think that's pretty idiomatic.</p></li>\n<li><p>A few includes <a href=\"https://github.com/smartystreets/goconvey\" rel=\"nofollow\">Goconvey</a>, <a href=\"https://github.com/onsi/ginkgo\" rel=\"nofollow\">Ginkgo</a> and <a href=\"https://github.com/stretchr/testify\" rel=\"nofollow\">Testify</a> They all have pros and cons of their own. The first two often end up with too many nested scopes, but Goconvey has a great browser-based real-time testing server which can be used with Go standard testing. </p></li>\n</ol>\n\n<p>Since there's no global variables/functions in Go, you might design your project in <a href=\"https://medium.com/code-zen/go-interfaces-and-delegation-pattern-f962c138dc1e#.j3jzmb3r1\" rel=\"nofollow\">interface-delegate pattern</a> to help with importing functions cross packages and avoiding cyclic imports when dealing with cross-package testing.</p>\n\n<pre><code>mypackage\n\ntype DBOptions struct {\n        Name, Credentials string\n}\n\nfunc aFunc(db *sql.DB) error {\n        // do something\n        return nil\n}\n\nfunc bFunc(db *sql.DB) int, error {\n        // do something\n        return 0, nil\n}\n\nfunc establishConn(opts *DBOptions) (*sql.DB, error) {\n        db, err := sql.Open(opts.Name, opts.Credentials)\n        if err != nil {\n                return nil, err\n        }\n        return db, nil\n}\n\nfunc destroyConn(conn *sql.DB) {\n        conn.Close()\n}\n\n// test file\nmypackage \n\nimport \"testing\"\n\nvar myOpt = &amp;DBOptions{\n        Name: \"mysql\", \n        Credentials: \"user:password@tcp(127.0.0.1:3306)/hello\",\n}\n\nvar conn, _ = establishConn(myOpt)\n\nfunc TestAFunc(t *testing.T) {\n        err := aFunc(conn)\n\n        if err != nil  {\n                t.Error(err)\n        }\n}\n\nfunc TestBFunc(t *testing.T) {\n        err := aFunc(conn)\n\n        if err != nil  {\n                t.Error(err)\n        }\n}\n\n// use `conn` in other tests ...\n\ndestroyConn(conn)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1464961355, "post_id": 37615733, "comment_id": 62714562, "body": "any thoughts @pieohpah?"}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 1, "last_activity_date": 1464960592, "creation_date": 1464960592, "answer_id": 37615733, "question_id": 37558570, "link": "https://stackoverflow.com/questions/37558570/re-usable-components-and-fixtures-in-golang-tests/37615733#37615733", "title": "Re-usable components and fixtures in Golang tests", "body": "<p>on fixtures: consider passing functions in your testcases:</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\ntype testcase struct {\n    scenario  string\n    before    func(string)\n    after     func()\n    input     string\n    expOutput string\n}\n\nvar state = \"\"\n\nfunc setup(s string) {\n    state = s\n}\n\nfunc nilSetup(s string) {}\n\nfunc reset() {\n    state = \"\"\n}\n\nfunc execute(s string) string {\n    return state\n}\n\nfunc TestSetupTeardown(t *testing.T) {\n    tcs := []testcase{\n        {\n            scenario:  \"blank output when initial state is wrong\",\n            before:    nilSetup,\n            after:     reset,\n            input:     \"foo\",\n            expOutput: \"\",\n        },\n        {\n            scenario:  \"correct output when initial state is right\",\n            before:    setup,\n            after:     reset,\n            input:     \"foo\",\n            expOutput: \"foo\",\n        },\n    }\n\n    for _, tc := range tcs {\n        tc.before(tc.input)\n        if out := execute(tc.input); out != tc.expOutput {\n            t.Fatal(tc.scenario)\n        }\n        tc.after()\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 623, "user_id": 929095, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de4bdd0982fc27bafaae60eef98d8bc1?s=128&d=identicon&r=PG", "display_name": "houqp", "link": "https://stackoverflow.com/users/929095/houqp"}, "is_accepted": false, "score": 0, "last_activity_date": 1576192090, "creation_date": 1576192090, "answer_id": 59313979, "question_id": 37558570, "link": "https://stackoverflow.com/questions/37558570/re-usable-components-and-fixtures-in-golang-tests/59313979#59313979", "title": "Re-usable components and fixtures in Golang tests", "body": "<p>I built a tiny utility library to make it easy to create reusable fixtures to tests in go. Check out <a href=\"https://github.com/houqp/gtest\" rel=\"nofollow noreferrer\">https://github.com/houqp/gtest</a> to see if it solves your problem.</p>\n\n<p>Here is a quick example on how to create a database transaction fixture for each test in a test group:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type TransactionFixture struct{}\n\n// Construct can take other fixtures as input parameter as well\nfunc (s TransactionFixture) Construct(t *testing.T, fixtures struct{}) (*sqlx.Tx, *sqlx.Tx) {\n    tx := // create db transaction here\n    return tx, tx\n}\n\nfunc (s TransactionFixture) Destruct(t *testing.T, tx *sqlx.Tx) {\n    tx.Rollback()\n}\n\nfunc init() {\n    // register and make fixture available to all tests\n    gtest.MustRegisterFixture(\n        \"Transaction\", &amp;TransactionFixture{}, gtest.ScopeSubTest)\n}\n\n// begin of test definition\ntype SampleTests struct{}\n\nfunc (s *SampleTests) Setup(t *testing.T)      {\n    // you can create/initialize DB in this method\n    // DB instance can also be implemented as a fixture and get injected into Transanction fixture.\n}\nfunc (s *SampleTests) Teardown(t *testing.T)   {\n    // you can clean up all DB resources in this method\n}\nfunc (s *SampleTests) BeforeEach(t *testing.T) {}\nfunc (s *SampleTests) AfterEach(t *testing.T)  {}\n\nfunc (s *SampleTests) SubTestFoo(t *testing.T, fixtures struct {\n    Tx sqlx.Tx `fixture:\"Transaction\"`\n}) {\n    // transaction is available as fixtures.Tx in this test\n}\n\nfunc TestSampleTests(t *testing.T) {\n    gtest.RunSubTests(t, &amp;SampleTests{})\n}\n</code></pre>\n\n<p>See <a href=\"https://godoc.org/github.com/houqp/gtest\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/houqp/gtest</a> and <a href=\"https://github.com/houqp/gtest/blob/master/example_test.go\" rel=\"nofollow noreferrer\">https://github.com/houqp/gtest/blob/master/example_test.go</a> for more advanced and uptodate examples.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 7898539, "user_type": "registered", "profile_image": "https://graph.facebook.com/759112110920820/picture?type=large", "display_name": "Kanji Yomoda", "link": "https://stackoverflow.com/users/7898539/kanji-yomoda"}, "is_accepted": false, "score": 2, "last_activity_date": 1597140411, "creation_date": 1597140411, "answer_id": 63355944, "question_id": 37558570, "link": "https://stackoverflow.com/questions/37558570/re-usable-components-and-fixtures-in-golang-tests/63355944#63355944", "title": "Re-usable components and fixtures in Golang tests", "body": "<p>About test fixture library similar to FactoryGirl in Rails, There are some choices in go.</p>\n<p>those two libraries got stars most.</p>\n<ul>\n<li><a href=\"https://github.com/bluele/factory-go\" rel=\"nofollow noreferrer\">https://github.com/bluele/factory-go</a></li>\n<li><a href=\"https://github.com/go-testfixtures/testfixtures\" rel=\"nofollow noreferrer\">https://github.com/go-testfixtures/testfixtures</a></li>\n</ul>\n<p>And I also implemented test-fixture library which is type-safe, DRY, and flexible compared to the above libraries!</p>\n<ul>\n<li><a href=\"https://github.com/k-yomo/fixtory\" rel=\"nofollow noreferrer\">https://github.com/k-yomo/fixtory</a></li>\n</ul>\n"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1552, "favorite_count": 0, "accepted_answer_id": 37559223, "answer_count": 4, "score": 1, "last_activity_date": 1597140411, "creation_date": 1464749108, "last_edit_date": 1464749859, "question_id": 37558570, "link": "https://stackoverflow.com/questions/37558570/re-usable-components-and-fixtures-in-golang-tests", "title": "Re-usable components and fixtures in Golang tests", "body": "<p>I'm just getting started with Golang and writing my first test suite.</p>\n\n<p>I have a background in Rails, which has fantastic support for testing tools (Rspec, Cucumber, etc..), so I'm approaching my golang tests with a similar mindset (not sure if that's the right or wrong thing to do)</p>\n\n<p>I have a <code>User</code> data model (basically a struct) that reads records from a <code>users</code> table in postgres and stores an array of them. (Essentially a really simple version of what ActiveRecord does in the Rails world)</p>\n\n<p>I'd like to write a test that checks if the routine correctly reads from the DB and builds the models. </p>\n\n<ol>\n<li><p>In almost every test suite I'll be connecting to the DB so I have a helper named <code>establish_db_connection</code>. Where can I place this so that it's centrally available to all my tests?</p></li>\n<li><p>Building off #1 - is there an equivalent of a <code>before</code> block or some setup/teardown method where I can establish a connection before every test?</p></li>\n<li><p>Lastly, how do I handle fixtures? Right now before each test I call a <code>clear_db</code> function that resets all tables and inserts some static data rows. I'd love to move away from fixtures and use factories to build data as needed (very similar to <code>FactoryGirl</code> in Rails), but not sure how common that is in Golang.</p></li>\n<li><p>Is the built-in <code>go test</code> framework the best approach, or are there better alternatives?</p></li>\n</ol>\n"}, {"tags": ["go", "config", "microservices"], "comments": [{"owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "edited": false, "score": 0, "creation_date": 1464765857, "post_id": 37558498, "comment_id": 62611886, "body": "The main server is the server that hosts the Docker containers?"}, {"owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "reply_to_user": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "edited": false, "score": 0, "creation_date": 1464778554, "post_id": 37558498, "comment_id": 62620397, "body": "main server could be another go http server running in a different docker image instance"}], "owner": {"reputation": 508, "user_id": 936052, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/35791690683d0f5626b2ce342c1d2bbb?s=128&d=identicon&r=PG", "display_name": "Nexus2020", "link": "https://stackoverflow.com/users/936052/nexus2020"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 112, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464748499, "creation_date": 1464748499, "question_id": 37558498, "link": "https://stackoverflow.com/questions/37558498/golang-rpc-server-docker-automatic-deployment", "title": "Golang RPC server Docker Automatic Deployment", "body": "<p>I want to deploy golang rpc servers to different docker images. How or what is the best practice for auto configuring these images.</p>\n\n<p>For instance, if I have 3 different RPC servers, for 3 different purposes. I want to deploy them as three independent docker instances with different IPs. And some how let the main server contact them automatically. Is there a way or tool to do this? </p>\n\n<p>I am using gorilla rpc, rpc/json and mux packages by the way.</p>\n"}, {"tags": ["web-applications", "go", "server", "constants"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1464746613, "creation_date": 1464746613, "answer_id": 37558299, "question_id": 37558259, "link": "https://stackoverflow.com/questions/37558259/loading-constants-file-into-application-golang/37558299#37558299", "title": "Loading constants file into application -Golang", "body": "<p>You can make it a separate package called \"constants\" if you really want them to be constants.</p>\n\n<p>Or, since your constants aren't really constants (you're using <code>var</code>, not <code>const</code>), you could make a <code>constants</code> struct with the values you want. </p>\n\n<pre><code>type Constants struct {\n    FirstName string\n    LastName string\n}\n</code></pre>\n"}], "owner": {"reputation": 147, "user_id": 4956447, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/AXPa8.jpg?s=128&g=1", "display_name": "keala", "link": "https://stackoverflow.com/users/4956447/keala"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3538, "favorite_count": 0, "accepted_answer_id": 37558299, "answer_count": 1, "score": 3, "last_activity_date": 1464747003, "creation_date": 1464746296, "last_edit_date": 1464747003, "question_id": 37558259, "link": "https://stackoverflow.com/questions/37558259/loading-constants-file-into-application-golang", "title": "Loading constants file into application -Golang", "body": "<p>i have a constants file in my main pkg:</p>\n\n<pre><code>package main\n\nconst (\n  FIRST_NAME                    = \"FIRST_NAME\"\n  LAST_NAME                     = \"LAST_NAME\"\n)\n</code></pre>\n\n<p>and i'd like to be able to say something like <code>first_name := constants.FIRSTNAME</code></p>\n\n<p>any idea on how to tell my application \"hey, load my constants file and let me access it with constants.\"?</p>\n"}, {"tags": ["go", "struct", "types", "interface", "dereference"], "answers": [{"comments": [{"owner": {"reputation": 110, "user_id": 2030824, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uOcGk.jpg?s=128&g=1", "display_name": "chaseisabelle", "link": "https://stackoverflow.com/users/2030824/chaseisabelle"}, "edited": false, "score": 0, "creation_date": 1464743568, "post_id": 37557884, "comment_id": 62604351, "body": "Ah, I forgot to specify pointer to <code>http2.Transport</code> in my assertion! Many thanks!"}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 4, "last_activity_date": 1464744406, "last_edit_date": 1464744406, "creation_date": 1464742972, "answer_id": 37557884, "question_id": 37557763, "link": "https://stackoverflow.com/questions/37557763/golang-get-interface-implementation-instance-from-struct-after-dereferencing/37557884#37557884", "title": "golang - get interface implementation instance from struct after dereferencing", "body": "<p>You have a type mismatch here. If you look at the documentation, you'll see that the field <code>Transport</code> of the <code>Client</code> struct returns an interface <code>RoundTripper</code>:</p>\n\n<pre><code>type Client struct {\n    // Transport specifies the mechanism by which individual\n    // HTTP requests are made.\n    // If nil, DefaultTransport is used.\n    Transport RoundTripper\n\n    // ...\n}\n</code></pre>\n\n<p>So, the type of <code>tmp1</code> is <code>http.RoundTripper</code>, though the underlying type is <code>*http2.Transport</code> which implements the <code>RoundTripper</code> interface.</p>\n\n<p>As for <code>tmp2</code> and <code>tmp3</code>, they are seen as pointers to a <code>RoundTripper</code> and not as <code>**http2.Transport</code>.</p>\n\n<p>In order to retrieve the <code>DialTLS</code> field, you have to use type assertions to convert a <code>RoundTripper</code> back into a <code>Transport</code>:</p>\n\n<pre><code>dialTLS := client.Transport.(*http2.Transport).DialTLS\n</code></pre>\n"}], "owner": {"reputation": 110, "user_id": 2030824, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uOcGk.jpg?s=128&g=1", "display_name": "chaseisabelle", "link": "https://stackoverflow.com/users/2030824/chaseisabelle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 663, "favorite_count": 0, "accepted_answer_id": 37557884, "answer_count": 1, "score": 1, "last_activity_date": 1464744406, "creation_date": 1464741878, "question_id": 37557763, "link": "https://stackoverflow.com/questions/37557763/golang-get-interface-implementation-instance-from-struct-after-dereferencing", "title": "golang - get interface implementation instance from struct after dereferencing", "body": "<p>Create a struct that implements an interface.\nEncapsulate it into another struct.\nFetch the struct / dereference it.</p>\n\n<ol>\n<li>Fetching gets pointer to the implementation of the interface.</li>\n<li>Dereferencing the pointer results in another point to the interface.</li>\n</ol>\n\n<p>Why wouldn't dereferencing the pointer to the implementation gives the implementation instance?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n\n    \"golang.org/x/net/http2\"\n)\n\nfunc main() {\n    transport := &amp;http2.Transport{}\n    client := &amp;http.Client{Transport: transport}\n\n    tmp1 := client.Transport\n    tmp2 := &amp;client.Transport\n    tmp3 := &amp;tmp1\n\n    fmt.Printf(\"%T\\n%T\\n%T\\n\", tmp1, tmp2, tmp3)\n\n    //dialTLS := tmp1.DialTLS\n}\n</code></pre>\n\n<p>This code outputs...</p>\n\n<pre><code>*http2.Transport\n*http.RoundTripper\n*http.RoundTripper\n</code></pre>\n\n<p>As well, trying to access a property of the <code>tmp1</code> (uncommenting <code>dialTLS := tmp1.DialTLS</code>) results in compile error...</p>\n\n<pre><code>tmp1.DialTLS undefined (type http.RoundTripper has no field or method DialTLS)\n</code></pre>\n\n<p>...even though <code>fmt.Printf(\"%+v\", tmp1)</code> outputs...</p>\n\n<pre><code>&amp;{DialTLS:&lt;nil&gt; TLSClientConfig:0xc8203ec8c0 ConnPool:&lt;nil&gt; DisableCompression:false MaxHeaderListSize:0 t1:&lt;nil&gt; connPoolOnce:{m:{state:0 sema:0} done:0} connPoolOrDef:&lt;nil&gt;}\n</code></pre>\n\n<p>What I am attempting to do is access <code>DialTLS</code> in the Transport instance.</p>\n"}, {"tags": ["go", "swagger", "swagger-2.0"], "comments": [{"owner": {"reputation": 1197, "user_id": 2572703, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/ea9bb5d1f7a8a598ebc867c3b88e7aaa?s=128&d=identicon&r=PG", "display_name": "Sakib", "link": "https://stackoverflow.com/users/2572703/sakib"}, "edited": false, "score": 1, "creation_date": 1476682715, "post_id": 37557583, "comment_id": 67431069, "body": "were you able to get this working? I am trying to do this for my own project but with no luck"}], "answers": [{"tags": [], "owner": {"reputation": 1159, "user_id": 23418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39a948a58f4569c53d971c2e120920?s=128&d=identicon&r=PG", "display_name": "Casual Jim", "link": "https://stackoverflow.com/users/23418/casual-jim"}, "is_accepted": true, "score": 5, "last_activity_date": 1464750745, "creation_date": 1464750745, "answer_id": 37558788, "question_id": 37557583, "link": "https://stackoverflow.com/questions/37557583/generating-swagger-spec-with-golang-comments/37558788#37558788", "title": "Generating Swagger spec with golang comments", "body": "<p>The generated spec would be json not yaml at this stage, not saying it can't be made to do yaml but currently it only generates json.</p>\n\n<p>you can annotate your main package with: <code>//go:generate swagger generate spec -o swagger.json</code></p>\n\n<p>then you can generate the spec with: <code>go generate</code> when you are in folder of the main package. If your main package is not your project root but something like <code>$project_root/cmd/my-server</code> then you can run <code>go generate ./cmd/my-server</code> from the project root.</p>\n"}, {"tags": [], "owner": {"reputation": 609, "user_id": 4893739, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-WJZKacx7wGg/AAAAAAAAAAI/AAAAAAAAD68/SLiV-uZgybg/photo.jpg?sz=128", "display_name": "Camila Macedo", "link": "https://stackoverflow.com/users/4893739/camila-macedo"}, "is_accepted": false, "score": 3, "last_activity_date": 1549992362, "creation_date": 1549992362, "answer_id": 54655567, "question_id": 37557583, "link": "https://stackoverflow.com/questions/37557583/generating-swagger-spec-with-golang-comments/54655567#54655567", "title": "Generating Swagger spec with golang comments", "body": "<p>Yes, you can create a YAML file. Following an example. </p>\n\n<pre><code>swagger generate spec -m -o ../../api/swagger.yaml\n</code></pre>\n\n<p>Also, feel free to check the <a href=\"https://dev4devs.com/2019/02/08/golang-how-to-generate-swagger-api-doc-from-the-source-code/\" rel=\"nofollow noreferrer\">Blog Post</a>.</p>\n"}], "owner": {"reputation": 121, "user_id": 6407048, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c1731554ee39dc7e00b9bc2ad891bea?s=128&d=identicon&r=PG&f=1", "display_name": "user6407048", "link": "https://stackoverflow.com/users/6407048/user6407048"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10049, "favorite_count": 1, "accepted_answer_id": 37558788, "answer_count": 2, "score": 8, "last_activity_date": 1549992362, "creation_date": 1464740279, "last_edit_date": 1497351066, "question_id": 37557583, "link": "https://stackoverflow.com/questions/37557583/generating-swagger-spec-with-golang-comments", "title": "Generating Swagger spec with golang comments", "body": "<p>I am trying to create documentation for my REST API written in golang using Swagger. I have been following this guide: <a href=\"https://goswagger.io/generate/spec.html\" rel=\"nofollow noreferrer\">https://goswagger.io/generate/spec.html</a> to do so and have been able to create the json file from my comments in my main file, however I do not know how to create the .yaml file that would translate to the actual swagger spec. I have followed the instructions on the page and included the <code>//go:generate swagger generate spec</code> in my main file. Anyone know how to create the .yaml file?</p>\n"}, {"tags": ["python", "go"], "answers": [{"comments": [{"owner": {"reputation": 59346, "user_id": 444036, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/My2AZ.jpg?s=128&g=1", "display_name": "Paulo Scardine", "link": "https://stackoverflow.com/users/444036/paulo-scardine"}, "edited": false, "score": 0, "creation_date": 1464739913, "post_id": 37557493, "comment_id": 62603600, "body": "I suppose your recommendation to avoid simple translations between languages means that this code is not idiomatic in go, is it? Honest curiosity, I know nothing about go."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 59346, "user_id": 444036, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/My2AZ.jpg?s=128&g=1", "display_name": "Paulo Scardine", "link": "https://stackoverflow.com/users/444036/paulo-scardine"}, "edited": false, "score": 0, "creation_date": 1464740085, "post_id": 37557493, "comment_id": 62603644, "body": "@Paulo Scardine It is. But when writing in a language, you have to think about how to solve the problem for this language, not in another and translate after."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1464757705, "last_edit_date": 1464757705, "creation_date": 1464739505, "answer_id": 37557493, "question_id": 37557427, "link": "https://stackoverflow.com/questions/37557427/python-list-comprehension-in-go/37557493#37557493", "title": "Python list comprehension in Go", "body": "<p>Simply use explicit for loops. However, you should not try to simply translate what you do in a language into another.</p>\n\n<pre><code>func list1s() []string {\n    res := make([]string, 0, 256*64)\n    for x := 192; x &lt; 256; x++ {\n        for y := 0; y &lt; 256; y++ {\n            res = append(res, fmt.Sprintf(\"10.%d.%d.1\", x, y))\n        }\n    }\n    return res\n}\n</code></pre>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 37557493, "answer_count": 1, "score": 1, "last_activity_date": 1464757705, "creation_date": 1464739103, "question_id": 37557427, "link": "https://stackoverflow.com/questions/37557427/python-list-comprehension-in-go", "title": "Python list comprehension in Go", "body": "<p>I'm translating below Python function to Go. It's using list comprehension which I don't think is available in Go. What's the best way to translate it to Go ?</p>\n\n<pre><code>def list1s():\n        return [\"10.\" + str(x) + \".\" + str(y) + \".1\" for x in range(192, 256) for y in range(0, 256)]\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9866, "user_id": 368552, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3672308feaff9d9167de4fcc7dc6d077?s=128&d=identicon&r=PG", "display_name": "Luke Hutton", "link": "https://stackoverflow.com/users/368552/luke-hutton"}, "edited": false, "score": 4, "creation_date": 1464736895, "post_id": 37557094, "comment_id": 62602866, "body": "correct, you don&#39;t use it"}, {"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 2, "creation_date": 1464737103, "post_id": 37557094, "comment_id": 62602923, "body": "What do you do with <code>var alive bool</code>? you never use it anywhere in the example. You could print it, or return it and you&#39;d be fine but you have to do something with it."}], "answers": [{"tags": [], "owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "is_accepted": false, "score": 1, "last_activity_date": 1464736931, "creation_date": 1464736931, "answer_id": 37557153, "question_id": 37557094, "link": "https://stackoverflow.com/questions/37557094/declared-and-not-used/37557153#37557153", "title": "declared and not used", "body": "<p>Since it is a local variable, it will exit scope at the end of the function. <code>alive</code> is neither evaluated nor returned inside the function.  Hence the compiler complains.</p>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": true, "score": 1, "last_activity_date": 1464737748, "creation_date": 1464737748, "answer_id": 37557252, "question_id": 37557094, "link": "https://stackoverflow.com/questions/37557094/declared-and-not-used/37557252#37557252", "title": "declared and not used", "body": "<p>The compile error you're seeing is <em>exactly</em> what is happening. That <code>var alive bool</code> is unused. You declare it and assign a value to it but you never do anything with it. </p>\n\n<p>Here is a <a href=\"https://play.golang.org/p/7A5TInvWx8\" rel=\"nofollow\">playground</a>-friendly modification of your code that will run:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strconv\"\n)\n\nfunc main() {\n    fmt.Println(isInt(\"Hello, playground\")) // prints false\n    fmt.Println(isInt(\"1234567890\")) // prints true\n}\n\nfunc isInt(s string) bool {\n    var alive bool\n    _, err := strconv.Atoi(s) // simply to demonstrate an error case\n    if err != nil {\n        alive = false\n    } else {\n        alive = true\n    }\n    return alive    \n}\n</code></pre>\n\n<p>Notice that I return alive. The function is useless and not something I would suggest in and of itself but  it should help illustrate what is missing in your example.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11110924, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/900f5022cc06f8fe368b9a2eb549dbd1?s=128&d=identicon&r=PG&f=1", "display_name": "Some Body", "link": "https://stackoverflow.com/users/11110924/some-body"}, "is_accepted": false, "score": 0, "last_activity_date": 1551178049, "last_edit_date": 1551178049, "creation_date": 1551051595, "answer_id": 54857670, "question_id": 37557094, "link": "https://stackoverflow.com/questions/37557094/declared-and-not-used/54857670#54857670", "title": "declared and not used", "body": "<p>Those strange limitations in Golang Devs team heads are terribly annoying.</p>\n\n<p>Why not to allow people to disable their limitations with options?</p>\n\n<p>Answer is simple: they write the lang for themselves (for guugle), not for the community.</p>\n\n<p>Fortunately, Go is OpenSource and even written in Go.</p>\n\n<p>So, here is a simple patch removing the \"declared and not used\" or \"declared but not used\" errors raising:</p>\n\n<pre><code>diff --git a/src/cmd/compile/internal/gc/walk.go b/src/cmd/compile/internal/gc/walk.go\nindex 770210f..78c0cbc 100644\n--- a/src/cmd/compile/internal/gc/walk.go\n+++ b/src/cmd/compile/internal/gc/walk.go\n@@ -49,10 +49,7 @@ func walk(fn *Node) {\n                        if defn.Left.Name.Used() {\n                                continue\n                        }\n-                       yyerrorl(defn.Left.Pos, \"%v declared and not used\", ln.Sym)\n                        defn.Left.Name.SetUsed(true) // suppress repeats\n-               } else {\n-                       yyerrorl(ln.Pos, \"%v declared and not used\", ln.Sym)\n                }\n        }\n\ndiff --git a/src/go/types/stmt.go b/src/go/types/stmt.go\nindex abd9d05..8b15786 100644\n--- a/src/go/types/stmt.go\n+++ b/src/go/types/stmt.go\n@@ -55,6 +55,7 @@ func (check *Checker) funcBody(decl *declInfo, name string, sig *Signature, body\n }\n\n func (check *Checker) usage(scope *Scope) {\n+       return\n        var unused []*Var\n        for _, elem := range scope.elems {\n                if v, _ := elem.(*Var); v != nil &amp;&amp; !v.used {\n</code></pre>\n\n<p>(Actual for go1.12)</p>\n\n<p>Unpack a fresh Golang into /usr/local/go and apply the patch.</p>\n\n<p>Then compile:</p>\n\n<pre><code>export GOROOT_BOOTSTRAP=/usr/local/go2\ncp -a /usr/local/go /usr/local/go2\ncd /usr/local/go/src\nsed -e 's#^bash run.bash.*##' -i all.bash\n./all.bash\nrm -rf /usr/local/go2\nunset GOROOT_BOOTSTRAP\n</code></pre>\n\n<p>It's much faster to apply the patch once [per new version] than every time deal with every missed variable.</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1920, "favorite_count": 0, "accepted_answer_id": 37557252, "answer_count": 3, "score": -2, "last_activity_date": 1551178049, "creation_date": 1464736455, "last_edit_date": 1526312790, "question_id": 37557094, "link": "https://stackoverflow.com/questions/37557094/declared-and-not-used", "title": "declared and not used", "body": "<p>I can't find why below code gives compile error \"alive declared and not used\". </p>\n\n<pre><code>func ping(ip string)  {     \n    var alive bool\n    _, err := exec.Command(\"ping\", \"-n 1\", \"-w 1000\", ip).Output()\n    if err != nil {\n        alive = false\n    } else {\n        alive = true\n    }\n}\n</code></pre>\n"}, {"tags": ["mysql", "json", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1464726274, "post_id": 37554472, "comment_id": 62598763, "body": "Can you just [un]marshal the values as []byte and not worry about encoding at all?"}, {"owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "edited": false, "score": 1, "creation_date": 1464728442, "post_id": 37554472, "comment_id": 62599881, "body": "Can you include an example of what is getting mangled?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464728551, "post_id": 37554472, "comment_id": 62599935, "body": "@JimB&#39;s suggestion is probably as good as it&#39;s gonna get for you. I spent a few minutes reviewing the json package after reading your question and I just don&#39;t see anyway you can specify the encoding as <code>utf8mb4</code>."}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464733065, "post_id": 37554472, "comment_id": 62601761, "body": "What mysql driver do you use? Does your driver support charset=utf8mb4? Did you set it? There is nothing special about 4 bytes UTF-8 encoding (utf8mb4), go supports it out of the box. Use build in json.Encoder/Decoder"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464735865, "post_id": 37554472, "comment_id": 62602624, "body": "it handles single-, double-, triple-, and quad-bytes unicode codepoints <a href=\"https://play.golang.org/p/IhD66l32-1\" rel=\"nofollow noreferrer\">play.golang.org/p/IhD66l32-1</a>"}], "answers": [{"comments": [{"owner": {"reputation": 614, "user_id": 1007409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/djzLN.jpg?s=128&g=1", "display_name": "Kurt Funai", "link": "https://stackoverflow.com/users/1007409/kurt-funai"}, "edited": false, "score": 2, "creation_date": 1495587239, "post_id": 37562983, "comment_id": 75311945, "body": "Simply adding <code>charset=utf-8&quot;</code> was enough to resolve the issue for me. No need to cast to string :)  <code>w.Header().Set(&quot;Content-Type&quot;, &quot;application&#47;json; charset=utf-8&quot;)</code>"}, {"owner": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "reply_to_user": {"reputation": 614, "user_id": 1007409, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/djzLN.jpg?s=128&g=1", "display_name": "Kurt Funai", "link": "https://stackoverflow.com/users/1007409/kurt-funai"}, "edited": false, "score": 1, "creation_date": 1614292116, "post_id": 37562983, "comment_id": 117348962, "body": "@KurtFunai is right, just setting the charset worked for me too. This is really surprising that it required that."}], "tags": [], "owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "is_accepted": true, "score": 4, "last_activity_date": 1464768616, "creation_date": 1464768616, "answer_id": 37562983, "question_id": 37554472, "link": "https://stackoverflow.com/questions/37554472/golang-json-marshaling-converts-emoji-to-question-mark/37562983#37562983", "title": "Golang JSON marshaling converts emoji to question mark", "body": "<p>I was eventually able to find a workaround. Previously I was marshaling the JSON into a []byte and then calling w.Write(jsonBytes) on my http.ResponseWriter. By casting the bytes to a string, writing the appropriate content type header and using io.WriteString instead I was able to prevent the mangling. Here is my code:</p>\n\n<pre><code>returnJSON, error := json.Marshal(value)\nif error != nil { Error(w, error); return }\nw.Header().Set(\"Content-Type\", \"application/json; charset=utf-8\")\nio.WriteString(w, string(returnJSON))\n</code></pre>\n"}], "owner": {"reputation": 4515, "user_id": 1710704, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/a3b646c4f3b358bc74cfe636ca9655f7?s=128&d=identicon&r=PG&f=1", "display_name": "Logan Shire", "link": "https://stackoverflow.com/users/1710704/logan-shire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1243, "favorite_count": 0, "accepted_answer_id": 37562983, "answer_count": 1, "score": 3, "last_activity_date": 1464768616, "creation_date": 1464724249, "question_id": 37554472, "link": "https://stackoverflow.com/questions/37554472/golang-json-marshaling-converts-emoji-to-question-mark", "title": "Golang JSON marshaling converts emoji to question mark", "body": "<p>I have a golang web server which communicates with a MySQL database. Users can post comments, and these comments can contain emoji, among other utf8mb4 characters. My database is capable of storing and retrieving these emoji characters, however, when JSON marshaling / unmarshmaling, emoji are mangled. Is is possible to use Go's native encoding/json package to decode / encode utf8mb4 characters? If so, how would I go about doing so. Thanks in advance!</p>\n"}, {"tags": ["xml", "go", "xml-parsing"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1464718100, "post_id": 37552728, "comment_id": 62594051, "body": "You actually want to do something like this <a href=\"http://stackoverflow.com/questions/21164455/multiple-types-decoder-in-golang\" title=\"multiple types decoder in golang\">stackoverflow.com/questions/21164455/&hellip;</a> where you provide an implementation of <code>UnmarshalXML</code> although I don&#39;t personally think it&#39;s any better than just calling some function like <code>type.Sanatize()</code> after the fact. I personally would take the latter because it&#39;s less obfuscated. I see custom <code>Unmarshal</code> implementations a lot like operator overloading, more confusion and work than they&#39;re worth."}, {"owner": {"reputation": 761, "user_id": 2345647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c511ef77481eb163a14285a3b1e1016?s=128&d=identicon&r=PG", "display_name": "Jim Wood", "link": "https://stackoverflow.com/users/2345647/jim-wood"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464724471, "post_id": 37552728, "comment_id": 62597752, "body": "@evanmcdonnal Both options are quite dissatisfying. I mean the existing decoder is already changing &quot;&amp;amp;&quot; to &quot;&amp;&quot; along with other standard xml escapes, is it really so hard-coded that I cannot just tag along there? I&#39;m not trying to actually break the XML rules like in the other question."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464724834, "post_id": 37552728, "comment_id": 62597974, "body": "I mean that&#39;s what implementing <code>UnmarshalXML</code> does... You can just decode everything, run string replace and then call the regular <code>Unmarshal</code>, it&#39;s not like you have to do any of the hard work. I&#39;m not terribly privy to xml&#39;s spec but afaik <code>|</code> has no special designation so why would you expect to be able to have it treated like an escape character? Yes I would expect that list of special character to be hard coded and unexported, why would it not be?"}, {"owner": {"reputation": 761, "user_id": 2345647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c511ef77481eb163a14285a3b1e1016?s=128&d=identicon&r=PG", "display_name": "Jim Wood", "link": "https://stackoverflow.com/users/2345647/jim-wood"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464725054, "post_id": 37552728, "comment_id": 62598098, "body": "@evanmcdonnal You make a fair point. Looks like either way I&#39;m not going to get anything for free, unfortunately. Thanks."}, {"owner": {"reputation": 761, "user_id": 2345647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c511ef77481eb163a14285a3b1e1016?s=128&d=identicon&r=PG", "display_name": "Jim Wood", "link": "https://stackoverflow.com/users/2345647/jim-wood"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464726690, "post_id": 37552728, "comment_id": 62598992, "body": "@evanmcdonnal Please see my edit. Seems that I&#39;m only 50% of the way there using the example from the other question."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464727996, "post_id": 37552728, "comment_id": 62599647, "body": "Yeah that only decodes the first element. I&#39;m looking into the docs to try and figure out how to iterate over all elements or decode everything at one."}], "answers": [{"tags": [], "owner": {"reputation": 6650, "user_id": 113325, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IYQC9.jpg?s=128&g=1", "display_name": "Schnouki", "link": "https://stackoverflow.com/users/113325/schnouki"}, "is_accepted": true, "score": 1, "last_activity_date": 1465283656, "last_edit_date": 1465283656, "creation_date": 1465226620, "answer_id": 37661158, "question_id": 37552728, "link": "https://stackoverflow.com/questions/37552728/custom-string-translation-while-decoding-xml-in-golang/37661158#37661158", "title": "Custom string translation while decoding XML in Golang", "body": "<p>To deal with attributes, you can use the <a href=\"https://golang.org/pkg/encoding/xml/#UnmarshalerAttr\" rel=\"nofollow\"><code>UnmarshalerAttr</code></a> interface with the <code>UnmarshalXMLAttr</code> method. Your example then becomes:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"strings\"\n)\n\ntype string2 string\n\ntype XMLTests struct {\n    Content string2    `xml:\"test_content\"`\n    Tests   []*XMLTest `xml:\"test_attr&gt;test\"`\n}\n\ntype XMLTest struct {\n    Name  string2 `xml:\"name,attr\"`\n    Value string2 `xml:\"value,attr\"`\n}\n\nfunc decode(s string) string2 {\n    s = strings.Replace(s, \"|\", \"%7C\", -1)\n    s = strings.Replace(s, \"&amp;amp;\", \"&amp;\", -1)\n    return string2(s)\n}\n\nfunc (s *string2) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    var content string\n    if err := d.DecodeElement(&amp;content, &amp;start); err != nil {\n        return err\n    }\n    *s = decode(content)\n    return nil\n}\n\nfunc (s *string2) UnmarshalXMLAttr(attr xml.Attr) error {\n    *s = decode(attr.Value)\n    return nil\n}\n\nfunc main() {\n    xmlData := `&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;tests&gt;\n    &lt;test_content&gt;X&amp;amp;amp;Y is a dumb way to write XnY | also here's a pipe.&lt;/test_content&gt;\n    &lt;test_attr&gt;\n      &lt;test name=\"Normal\" value=\"still normal\" /&gt;\n      &lt;test name=\"X&amp;amp;amp;Y\" value=\"should be the same as X&amp;amp;Y | XnY would have been easier.\" /&gt;\n    &lt;/test_attr&gt;\n&lt;/tests&gt;`\n    xmlFile := strings.NewReader(xmlData)\n\n    var q XMLTests\n\n    decoder := xml.NewDecoder(xmlFile)\n    decoder.Decode(&amp;q)\n\n    fmt.Println(q.Content)\n    for _, t := range q.Tests {\n        fmt.Printf(\"\\t%s\\t\\t%s\\n\", t.Name, t.Value)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>X&amp;Y is a dumb way to write XnY %7C also here's a pipe.\n    Normal      still normal\n    X&amp;Y     should be the same as X&amp;Y %7C XnY would have been easier.\n</code></pre>\n\n<p>(You can test this in the <a href=\"https://play.golang.org/p/XdfuZTEeg-\" rel=\"nofollow\">Go playground</a>.)</p>\n\n<p>So if using <code>string2</code> everywhere is suitable for you, this should do the trick.</p>\n\n<p>(<em>edit</em>: simpler code, without using <code>DecodeElement</code> and a type switch...)</p>\n"}], "owner": {"reputation": 761, "user_id": 2345647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c511ef77481eb163a14285a3b1e1016?s=128&d=identicon&r=PG", "display_name": "Jim Wood", "link": "https://stackoverflow.com/users/2345647/jim-wood"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1429, "favorite_count": 0, "accepted_answer_id": 37661158, "answer_count": 1, "score": 2, "last_activity_date": 1465283656, "creation_date": 1464717957, "last_edit_date": 1495541281, "question_id": 37552728, "link": "https://stackoverflow.com/questions/37552728/custom-string-translation-while-decoding-xml-in-golang", "title": "Custom string translation while decoding XML in Golang", "body": "<p>I am decoding some XML which contains only string values and attributes. It also contains a few instances of <code>\"&amp;amp;amp;\"</code>, which is unfortunate, and I'd like to decode that to just <code>\"&amp;\"</code> rather than <code>\"&amp;amp;\"</code>. I'm also going to do some more work with these string values in which I need the character <code>\"|\"</code> to never appear, and so I'd like to replace any <code>\"|\"</code> instance with <code>\"%7C\"</code>.</p>\n\n<p>I could do these changes using <code>strings.Replace</code> after the decoding, but since the decoding is already doing similar work (after all it does translate <code>\"&amp;amp;\"</code> to <code>\"&amp;\"</code>) I'd like to do it at the same time.</p>\n\n<p>The files I will be parsing are huge, so I'll be doing something similar to <a href=\"http://blog.davidsingleton.org/parsing-huge-xml-files-with-go/\" rel=\"nofollow noreferrer\">http://blog.davidsingleton.org/parsing-huge-xml-files-with-go/</a></p>\n\n<p>Here is a short example xml file:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;\n&lt;tests&gt;\n    &lt;test_content&gt;X&amp;amp;amp;Y is a dumb way to write XnY | also here's a pipe.&lt;/test_content&gt;\n    &lt;test_attr&gt;\n      &lt;test name=\"Normal\" value=\"still normal\" /&gt;\n      &lt;test name=\"X&amp;amp;amp;Y\" value=\"should be the same as X&amp;amp;Y | XnY would have been easier.\" /&gt;\n    &lt;/test_attr&gt;\n&lt;/tests&gt;\n</code></pre>\n\n<p>And some Go code that does standard decoding and prints out the results:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"os\"\n)\n\ntype XMLTests struct {\n    Content string     `xml:\"test_content\"`\n    Tests   []*XMLTest `xml:\"test_attr&gt;test\"`\n}\n\ntype XMLTest struct {\n    Name  string `xml:\"name,attr\"`\n    Value string `xml:\"value,attr\"`\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"test.xml\")\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n        return\n    }\n    defer xmlFile.Close()\n\n    var q XMLTests\n\n    decoder := xml.NewDecoder(xmlFile)\n\n    // I tried this to no avail:\n    // decoder.Entity = make(map[string]string)\n    // decoder.Entity[\"|\"] = \"%7C\"\n    // decoder.Entity[\"&amp;amp;amp;\"] = \"&amp;\"\n\n    var inElement string\n    for {\n        t, _ := decoder.Token()\n        if t == nil {\n            break\n        }\n        switch se := t.(type) {\n        case xml.StartElement:\n            inElement = se.Name.Local\n            if inElement == \"tests\" {\n                decoder.DecodeElement(&amp;q, &amp;se)\n            }\n        default:\n        }\n    }\n\n    fmt.Println(q.Content)\n    for _, t := range q.Tests {\n        fmt.Printf(\"\\t%s\\t\\t%s\\n\", t.Name, t.Value)\n    }\n}\n</code></pre>\n\n<p>How do I modify this code to get what I want? ie: <strong>How does one customize the decoder?</strong></p>\n\n<p>I looked at the docs, specifically <a href=\"https://golang.org/pkg/encoding/xml/#Decoder\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/xml/#Decoder</a> and tried playing with the Entity map, but I was unable to make any progress.</p>\n\n<p><strong>Edit:</strong></p>\n\n<p>Based on the comments, I've followed the example from <a href=\"https://stackoverflow.com/questions/21164455/multiple-types-decoder-in-golang\">Multiple-types decoder in golang</a> and added/changed the following to the above code:</p>\n\n<pre><code>type string2 string\n\ntype XMLTests struct {\n    Content string2    `xml:\"test_content\"`\n    Tests   []*XMLTest `xml:\"test_attr&gt;test\"`\n}\n\ntype XMLTest struct {\n    Name  string2 `xml:\"name,attr\"`\n    Value string2 `xml:\"value,attr\"`\n}\n\nfunc (s *string2) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    var content string\n    if err := d.DecodeElement(&amp;content, &amp;start); err != nil {\n        return err\n    }\n    content = strings.Replace(content, \"|\", \"%7C\", -1)\n    content = strings.Replace(content, \"&amp;amp;\", \"&amp;\", -1)\n    *s = string2(content)\n    return nil\n}\n</code></pre>\n\n<p>That works for the <code>test_content</code> but not for the attributes?</p>\n\n<pre><code>X&amp;Y is a dumb way to write XnY %7C also here's a pipe.\n    Normal      still normal\n    X&amp;amp;Y     should be the same as X&amp;Y | XnY would have been easier.\n</code></pre>\n"}, {"tags": ["linux", "memory-management", "go", "out-of-memory"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1464715444, "post_id": 37551288, "comment_id": 62592512, "body": "What do you have at line 66 in your program?"}, {"owner": {"reputation": 233489, "user_id": 14122, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/5e2861b08f37fa306fbf5384994af688?s=128&d=identicon&r=PG", "display_name": "Charles Duffy", "link": "https://stackoverflow.com/users/14122/charles-duffy"}, "edited": false, "score": 2, "creation_date": 1464716976, "post_id": 37551288, "comment_id": 62593315, "body": "BTW, in general, questions need to include enough information to be answerable <i>in the question itself</i>; a question that folks can only answer after following a github link is technically against the rules here, though since you&#39;ve already got some good answers this isn&#39;t likely to be closed."}], "answers": [{"comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 2, "creation_date": 1464715687, "post_id": 37552064, "comment_id": 62592644, "body": "You do not fix a broken data structure by reducing the size of its entries, you take a more efficient one."}, {"owner": {"reputation": 166, "user_id": 4655777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8a0f4579bd4de4ad1e1e1abf555759?s=128&d=identicon&r=PG", "display_name": "stonith", "link": "https://stackoverflow.com/users/4655777/stonith"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 3, "creation_date": 1464715829, "post_id": 37552064, "comment_id": 62592725, "body": "Yes you are right, I just diddnt want to write somthing like &#39;this code is crap, dont use it&#39;.."}], "tags": [], "owner": {"reputation": 166, "user_id": 4655777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3f8a0f4579bd4de4ad1e1e1abf555759?s=128&d=identicon&r=PG", "display_name": "stonith", "link": "https://stackoverflow.com/users/4655777/stonith"}, "is_accepted": false, "score": 5, "last_activity_date": 1464715568, "creation_date": 1464715568, "answer_id": 37552064, "question_id": 37551288, "link": "https://stackoverflow.com/questions/37551288/golang-fatal-error-runtime-out-of-memory/37552064#37552064", "title": "Golang : fatal error: runtime: out of memory", "body": "<p>The <code>node</code> type has a memory size of <code>2084</code> bytes.\nI wrote a litte program to demonstrate the memory usage: <a href=\"https://play.golang.org/p/szm7AirsDB\" rel=\"noreferrer\">https://play.golang.org/p/szm7AirsDB</a></p>\n\n<p>As you can see, the three strings (11(+1) bytes in size) <code>dictionary := []string{\"fizz\", \"buzz\", \"123\"}</code> require 24 MB of memory.</p>\n\n<p>If your dictionary has a length of 4 MB you would need about <code>4000 * 2084 = 8.1 GB</code> of memory.</p>\n\n<p>So you should try to decrease the size of your dictionary.</p>\n"}, {"comments": [{"owner": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "edited": false, "score": 0, "creation_date": 1464728837, "post_id": 37552074, "comment_id": 62600075, "body": "Thank you I see now the problem."}, {"owner": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "edited": false, "score": 0, "creation_date": 1464772248, "post_id": 37552074, "comment_id": 62615856, "body": "<a href=\"https://github.com/anknown/ahocorasick\" rel=\"nofollow noreferrer\">This implementation  of Aho-Corasick algorithm</a> seems more efficient."}, {"owner": {"reputation": 898, "user_id": 8214868, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oXRBf.png?s=128&g=1", "display_name": "Drubio", "link": "https://stackoverflow.com/users/8214868/drubio"}, "edited": false, "score": 0, "creation_date": 1559812093, "post_id": 37552074, "comment_id": 99539043, "body": "The material link is broken. Can you update it if possible? Thanks."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 11, "last_activity_date": 1583426669, "last_edit_date": 1583426669, "creation_date": 1464715600, "answer_id": 37552074, "question_id": 37551288, "link": "https://stackoverflow.com/questions/37551288/golang-fatal-error-runtime-out-of-memory/37552074#37552074", "title": "Golang : fatal error: runtime: out of memory", "body": "<p>Your structure is awfully inefficient in terms of memory, let's look at the internals. But before that, a quick reminder of the space required for some go types:</p>\n\n<ul>\n<li>bool: 1 byte</li>\n<li>int: 4 bytes</li>\n<li>uintptr: 4 bytes</li>\n<li>[N]type: N*sizeof(type)</li>\n<li>[]type: 12 + len(slice)*sizeof(type)</li>\n</ul>\n\n<p>Now, let's have a look at your structure:</p>\n\n<pre><code>type node struct {\n    root bool        // 1 byte\n    b []byte         // 12 + len(slice)*1\n    output bool      // 1 byte\n    index int        // 4 bytes\n    counter int      // 4 bytes\n    child [256]*node // 256*4 = 1024 bytes\n    fails [256]*node // 256*4 = 1024 bytes\n    suffix *node     // 4 bytes\n    fail *node       // 4 bytes\n}\n</code></pre>\n\n<p>Ok, you should have a guess of what happens here: each node weighs more than 2KB, this is huge ! Finally, we'll look at the code that you use to initialize your trie:</p>\n\n<pre><code>func (m *Matcher) buildTrie(dictionary [][]byte) {\n    max := 1\n    for _, blice := range dictionary {\n        max += len(blice)\n    }\n    m.trie = make([]node, max)\n\n    // ...\n}\n</code></pre>\n\n<p>You said your dictionary is 4 MB. If it is 4MB in total, then it means that at the end of the for loop, <code>max = 4MB</code>. It it holds 4 MB different words, then <code>max = 4MB*avg(word_length)</code>.</p>\n\n<p>We'll take the first scenario, the nicest one. You are initializing a slice of 4M of nodes, each of which uses 2KB. Yup, that makes a nice 8GB necessary.</p>\n\n<p>You should review how you build your trie. From the wikipedia page related to the Aho-Corasick algorithm, each node contains one character, so there is at most 256 characters that go from the root, not 4MB.</p>\n\n<p>Some material to make it right: <a href=\"https://web.archive.org/web/20160315124629/http://www.cs.uku.fi/~kilpelai/BSA05/lectures/slides04.pdf\" rel=\"nofollow noreferrer\">https://web.archive.org/web/20160315124629/http://www.cs.uku.fi/~kilpelai/BSA05/lectures/slides04.pdf</a></p>\n"}, {"tags": [], "owner": {"reputation": 189, "user_id": 9485417, "user_type": "registered", "profile_image": "https://graph.facebook.com/701924146864087/picture?type=large", "display_name": "franciscorode", "link": "https://stackoverflow.com/users/9485417/franciscorode"}, "is_accepted": false, "score": 0, "last_activity_date": 1593795779, "creation_date": 1593795779, "answer_id": 62719807, "question_id": 37551288, "link": "https://stackoverflow.com/questions/37551288/golang-fatal-error-runtime-out-of-memory/62719807#62719807", "title": "Golang : fatal error: runtime: out of memory", "body": "<p>Set resource limit to unlimited worked for me</p>\n<p>if <code>ulimit -a</code> return 0 run <code>ulimit -c unlimited</code></p>\n<p>Maybe set a real size limit to be more secure</p>\n"}], "owner": {"reputation": 181, "user_id": 4453606, "user_type": "registered", "accept_rate": 8, "profile_image": "https://www.gravatar.com/avatar/f22060487336c0de33d2f973806562cc?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/4453606/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 22840, "favorite_count": 1, "answer_count": 3, "score": 1, "last_activity_date": 1593795779, "creation_date": 1464712845, "last_edit_date": 1464728437, "question_id": 37551288, "link": "https://stackoverflow.com/questions/37551288/golang-fatal-error-runtime-out-of-memory", "title": "Golang : fatal error: runtime: out of memory", "body": "<p>I trying to use this package in <a href=\"https://github.com/cloudflare/ahocorasick/blob/master/ahocorasick.go\" rel=\"nofollow\">Github</a> for string matching. My dictionary is 4 MB. When creating the Trie, I got <code>fatal error: runtime: out of memory</code>. I am using Ubuntu 14.04 with 8 GB of RAM and Golang version 1.4.2.</p>\n\n<p>It seems the error come from the line 99 (now) <a href=\"https://github.com/cloudflare/ahocorasick/blob/master/ahocorasick.go\" rel=\"nofollow\">here</a> : <code>m.trie = make([]node, max)</code></p>\n\n<p>The program stops at this line.</p>\n\n<p>This is the error:</p>\n\n<pre><code>fatal error: runtime: out of memory\n\nruntime stack:\nruntime.SysMap(0xc209cd0000, 0x3b1bc0000, 0x570a00, 0x5783f8)\n    /usr/local/go/src/runtime/mem_linux.c:149 +0x98\nruntime.MHeap_SysAlloc(0x57dae0, 0x3b1bc0000, 0x4296f2)\n    /usr/local/go/src/runtime/malloc.c:284 +0x124\nruntime.MHeap_Alloc(0x57dae0, 0x1d8dda, 0x10100000000, 0x8)\n    /usr/local/go/src/runtime/mheap.c:240 +0x66\n\ngoroutine 1 [running]:\nruntime.switchtoM()\n    /usr/local/go/src/runtime/asm_amd64.s:198 fp=0xc208518a60 sp=0xc208518a58\nruntime.mallocgc(0x3b1bb25f0, 0x4d7fc0, 0x0, 0xc20803c0d0)\n    /usr/local/go/src/runtime/malloc.go:199 +0x9f3 fp=0xc208518b10 sp=0xc208518a60\nruntime.newarray(0x4d7fc0, 0x3a164e, 0x1)\n    /usr/local/go/src/runtime/malloc.go:365 +0xc1 fp=0xc208518b48 sp=0xc208518b10\nruntime.makeslice(0x4a52a0, 0x3a164e, 0x3a164e, 0x0, 0x0, 0x0)\n    /usr/local/go/src/runtime/slice.go:32 +0x15c fp=0xc208518b90 sp=0xc208518b48\ngithub.com/mf/ahocorasick.(*Matcher).buildTrie(0xc2083c7e60, 0xc209860000, 0x26afb, 0x2f555)\n    /home/go/ahocorasick/ahocorasick.go:104 +0x28b fp=0xc208518d90 sp=0xc208518b90\ngithub.com/mf/ahocorasick.NewStringMatcher(0xc208bd0000, 0x26afb, 0x2d600, 0x8)\n    /home/go/ahocorasick/ahocorasick.go:222 +0x34b fp=0xc208518ec0 sp=0xc208518d90\nmain.main()\n    /home/go/seme/substrings.go:66 +0x257 fp=0xc208518f98 sp=0xc208518ec0\nruntime.main()\n    /usr/local/go/src/runtime/proc.go:63 +0xf3 fp=0xc208518fe0 sp=0xc208518f98\nruntime.goexit()\n    /usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc208518fe8 sp=0xc208518fe0\nexit status 2\n</code></pre>\n\n<p>This is the content of the main function (taken from the same repo: test file)</p>\n\n<pre><code>var dictionary = InitDictionary()   \nvar bytes = []byte(\"\"Partial invoice (\u20ac100,000, so roughly 40%) for the consignment C27655 we shipped on 15th August to London from the Make Believe Town depot. INV2345 is for the balance.. Customer contact (Sigourney) says they will pay this on the usual credit terms (30 days).\")   \n\nvar precomputed = ahocorasick.NewStringMatcher(dictionary)// line 66 here\nfmt.Println(precomputed.Match(bytes))\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464708305, "post_id": 37549570, "comment_id": 62588020, "body": "Please, what are you trying to achieve exactly ? The question is unclear actually."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464708771, "post_id": 37549570, "comment_id": 62588343, "body": "Also paste a code snippet."}, {"owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "edited": false, "score": 0, "creation_date": 1464709096, "post_id": 37549570, "comment_id": 62588569, "body": "I didnt know it would be so unclear. Ill post it tomorrow, when Im at my computer again"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1464709787, "post_id": 37549570, "comment_id": 62589047, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/33142594/how-to-print-struct-with-string-of-fields\">How to print struct with String() of fields?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 2, "creation_date": 1464709317, "post_id": 37550032, "comment_id": 62588735, "body": "@RickyA: it helps to read through the <a href=\"https://golang.org/pkg/fmt/\" rel=\"nofollow noreferrer\"><code>fmt</code> documentation:</a> <code>%#v\ta Go-syntax representation of the value</code>. (note that <code>%#v</code> is also modifiable via the GoStringer interface)"}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 6, "last_activity_date": 1464709058, "creation_date": 1464709058, "answer_id": 37550032, "question_id": 37549570, "link": "https://stackoverflow.com/questions/37549570/print-all-properties-of-struct-even-through-that-struct-has-a-default-string-rep/37550032#37550032", "title": "Print all properties of struct even through that struct has a default string representation?", "body": "<p>An easy workaround is to use the <code>%#v</code> verb:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype someStruct struct {\n    a int\n    b int\n}\n\nfunc (someStruct) String() string {\n    return \"this is the end\"\n}\n\nfunc main() {\n    fmt.Printf(\"%+v\\n\", someStruct{1, 2})\n    fmt.Printf(\"%#v\\n\", someStruct{1, 2})\n}\n</code></pre>\n\n<p>This prints:</p>\n\n<pre><code>this is the end\nmain.someStruct{a:1, b:2}\n</code></pre>\n"}], "owner": {"reputation": 12496, "user_id": 1283776, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/abb815001c365007d50d2bdb3226e70a?s=128&d=identicon&r=PG", "display_name": "user1283776", "link": "https://stackoverflow.com/users/1283776/user1283776"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 37550032, "answer_count": 1, "score": 0, "last_activity_date": 1464709453, "creation_date": 1464707796, "last_edit_date": 1464709453, "question_id": 37549570, "link": "https://stackoverflow.com/questions/37549570/print-all-properties-of-struct-even-through-that-struct-has-a-default-string-rep", "title": "Print all properties of struct even through that struct has a default string representation?", "body": "<p>Normally, I can print all properties of an object with:</p>\n\n<pre><code>c.Infof(\"car: %+v\", car)\n</code></pre>\n\n<p>But one struct has a <code>String()</code> method. I think that this causes the line above to only print what the <code>String()</code> method returns.</p>\n\n<p>How can I override this and force print all properties of that struct?</p>\n"}, {"tags": ["http", "go", "https"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1464708850, "post_id": 37548915, "comment_id": 62588401, "body": "did you try posting to http instead of https"}, {"owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1464715854, "post_id": 37548915, "comment_id": 62592736, "body": "@Plato yes I did, but with the same result"}], "answers": [{"comments": [{"owner": {"reputation": 3197, "user_id": 3750381, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/f3203f61c9d9e29b6ab0491c5727eec6?s=128&d=identicon&r=PG&f=1", "display_name": "Vasantha Ganesh", "link": "https://stackoverflow.com/users/3750381/vasantha-ganesh"}, "edited": false, "score": 3, "creation_date": 1558513767, "post_id": 37552125, "comment_id": 99122235, "body": "I faced a similar issue where the request was malformed. One of the JSON fields was populated from config and the JSON field was empty since there was no value in the config.  +1 on the nicer error message."}], "tags": [], "owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "is_accepted": true, "score": 11, "last_activity_date": 1517603077, "last_edit_date": 1517603077, "creation_date": 1464715758, "answer_id": 37552125, "question_id": 37548915, "link": "https://stackoverflow.com/questions/37548915/http-client-rejects-request-with-unsupported-protocol-scheme-even-if-its-s/37552125#37552125", "title": "http.Client rejects request with &gt;unsupported protocol scheme &quot;&quot;&lt; even if it&#39;s set", "body": "<p>Ok, I figured it out.  The problem was not the call to YouTube itself.</p>\n\n<p>The library tried to refresh the token in the background but there was something wrong with the <code>TokenURL</code>.</p>\n\n<p>Ensuring there is a valid URL fixed the problem.</p>\n\n<p>A nicer error message would have helped a lot, but well...</p>\n"}], "owner": {"reputation": 3063, "user_id": 450598, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/780c14039de44c48349f578fdcfa66e0?s=128&d=identicon&r=PG", "display_name": "soupdiver", "link": "https://stackoverflow.com/users/450598/soupdiver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14555, "favorite_count": 0, "accepted_answer_id": 37552125, "answer_count": 1, "score": 6, "last_activity_date": 1517603077, "creation_date": 1464706068, "question_id": 37548915, "link": "https://stackoverflow.com/questions/37548915/http-client-rejects-request-with-unsupported-protocol-scheme-even-if-its-s", "title": "http.Client rejects request with &gt;unsupported protocol scheme &quot;&quot;&lt; even if it&#39;s set", "body": "<p>I try to upload some videos to youtube. Somewhere in the stack it comes down to a <code>http.Client</code>. This part somehow behaves weird.</p>\n\n<p>The request and everything is created inside the youtube package.</p>\n\n<p>After doing my request in the end it fails with: </p>\n\n<pre><code>Error uploading video: Post https://www.googleapis.com/upload/youtube/v3/videos?alt=json&amp;part=snippet%2Cstatus&amp;uploadType=multipart: Post : unsupported protocol scheme \"\"\n</code></pre>\n\n<p>I debugged the library a bit and printed the <code>URL.Scheme</code> content. As a string the result is <code>https</code> and in <code>[]byte</code> <code>[104 116 116 112 115]</code></p>\n\n<p><a href=\"https://golang.org/src/net/http/transport.go\" rel=\"noreferrer\">https://golang.org/src/net/http/transport.go</a> on line 288 is the location where the error is thrown.</p>\n\n<p><a href=\"https://godoc.org/google.golang.org/api/youtube/v3\" rel=\"noreferrer\">https://godoc.org/google.golang.org/api/youtube/v3</a> the library I use</p>\n\n<p>My code where I prepare/upload the video:</p>\n\n<pre><code>//create video struct which holds info about the video\nvideo := &amp;yt3.Video{\n//TODO: set all required video info\n}\n\n//create the insert call\ninsertCall := service.Videos.Insert(\"snippet,status\", video)\n\n//attach media data to the call\ninsertCall = insertCall.Media(tmp, googleapi.ChunkSize(1*1024*1024)) //1MB chunk\n\nvideo, err = insertCall.Do()\nif err != nil {\n    log.Printf(\"Error uploading video: %v\", err)\n    return\n    //return errgo.Notef(err, \"Failed to upload to youtube\")\n}\n</code></pre>\n\n<p>So I have not idea why the schema check fails.</p>\n"}, {"tags": ["loops", "go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464703532, "post_id": 37547677, "comment_id": 62584525, "body": "Also see the FAQ: <a href=\"https://golang.org/doc/faq#closures_and_goroutines\" rel=\"nofollow noreferrer\">golang.org/doc/faq#closures_and_goroutines</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464703653, "post_id": 37547677, "comment_id": 62584636, "body": "Maybe a more exact duplicate: <a href=\"http://stackoverflow.com/questions/36776315/go-concurrency-with-for-loop-and-anonymous-function-behaves-unexpectedly\" title=\"go concurrency with for loop and anonymous function behaves unexpectedly\">stackoverflow.com/questions/36776315/&hellip;</a>"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464708730, "post_id": 37547677, "comment_id": 62588308, "body": "It&#39;s not necessary that you will get 6,6,6,6 only. Increase the value of i. You will get different value. You are getting the value of i at the time of execution of goroutine."}], "answers": [{"tags": [], "owner": {"reputation": 14050, "user_id": 3772221, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/xfx4l.png?s=128&g=1", "display_name": "m0meni", "link": "https://stackoverflow.com/users/3772221/m0meni"}, "is_accepted": true, "score": 5, "last_activity_date": 1465826168, "last_edit_date": 1465826168, "creation_date": 1464702956, "answer_id": 37547764, "question_id": 37547677, "link": "https://stackoverflow.com/questions/37547677/iterating-using-a-goroutine-is-giving-unexpected-result/37547764#37547764", "title": "Iterating using a goroutine is giving unexpected result", "body": "<p><a href=\"https://play.golang.org/p/bGU0UpMi-Z\" rel=\"nofollow\">Playground example</a></p>\n\n<p>All your goroutines are running asynchronously <strong>after</strong> your for loop has finished.</p>\n\n<p>At the end of your for loop <code>i</code> is equal to 6, and thus, your goroutines each log the number 6.</p>\n\n<p>To fix the problem you can create a closure, and save the current value of <code>i</code> inside it so that when the goroutine runs, it runs with the proper value of <code>i</code>.</p>\n\n<p>To do this just change your code so it looks like</p>\n\n<pre class=\"lang-c prettyprint-override\"><code>go func(x int) {\n  fmt.Println(x)\n  wg.Done()\n}(i) // &lt;--- \"save\" value of i at this point in time.\n</code></pre>\n\n<p>This way you \"save\" the value of <code>i</code> inside the function you're telling the goroutine to execute such that later, when the for loop has run to completion, it doesn't use the <strong>current</strong> value of <code>i</code> which is 6; instead, it uses the <strong>old</strong> value of <code>i</code> at the time the goroutine was created.</p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 229, "favorite_count": 0, "closed_date": 1464703519, "accepted_answer_id": 37547764, "answer_count": 1, "score": 0, "last_activity_date": 1465826168, "creation_date": 1464702731, "question_id": 37547677, "link": "https://stackoverflow.com/questions/37547677/iterating-using-a-goroutine-is-giving-unexpected-result", "closed_reason": "Duplicate", "title": "Iterating using a goroutine is giving unexpected result", "body": "<p>I was doing some condition checking inside the goroutine based on the iteratating variable <code>i</code> and found that it is giving me results that I wasn't expecting, and I decided to confirm it with some simple code.</p>\n\n<pre><code>    for i := 1; i &lt;= 5; i++ {\n    wg.Add(1)\n    fmt.Println(i)\n\n    go func() {\n        fmt.Println(i)\n        wg.Done()\n    }()\n\n\n}\nwg.Wait()\n\n1\n2\n3\n4\n5\n6\n6\n6\n6\n6\n</code></pre>\n\n<p>Is this expected behaviour? Could someone kindly explain why is 6 being printed for 5 times, though I was iterating only till 5??</p>\n"}, {"tags": ["http", "go", "io", "httpresponse"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464695791, "post_id": 37544727, "comment_id": 62578708, "body": "If you can get <code>someval</code> before reading the response body: Just read <code>someval</code> many bytes from the body and ignore them and then read the rest, or copy it directly to the file."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464696631, "post_id": 37544727, "comment_id": 62579277, "body": "Thank you @Volker, I was trying to read <code>someval</code> many bytes in the second case using bytes.Buffer, which apparently is not happening because of my ignorance on how to do it properly. If you mean using http <code>range</code> headers to read few bytes and then do it again and again, then the http endpoint that I am hitting has a connection restriction, which restrict me from spawning too many connections in goroutines at my end, and doing sequentially would be time consuming."}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 5, "last_activity_date": 1464696413, "creation_date": 1464696413, "answer_id": 37545336, "question_id": 37544727, "link": "https://stackoverflow.com/questions/37544727/in-go-how-do-i-write-a-streaming-http-response-body-to-a-seek-position-in-a-fil/37545336#37545336", "title": "In Go, how do I write a streaming http response body to a seek position in a file effectively?", "body": "<p>Use <a href=\"https://godoc.org/io#Copy\" rel=\"noreferrer\">io.Copy</a> to copy the response body to the file: </p>\n\n<pre><code>resp, _ := client.Do(req)\ndefer resp.Close()\n//Some func that gets the seek value someval\nfs.Seek(int64(someval), 0)\nn, err := io.Copy(fs, resp.Body)\n// n is number of bytes copied\n</code></pre>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1287, "favorite_count": 0, "accepted_answer_id": 37545336, "answer_count": 1, "score": 3, "last_activity_date": 1464696413, "creation_date": 1464694753, "question_id": 37544727, "link": "https://stackoverflow.com/questions/37544727/in-go-how-do-i-write-a-streaming-http-response-body-to-a-seek-position-in-a-fil", "title": "In Go, how do I write a streaming http response body to a seek position in a file effectively?", "body": "<p>I have a program that combines multiple http responses and writes to the respective seek positions on a file. I am currently doing this by </p>\n\n<pre><code>client := new(http.Client)\nreq, _ := http.NewRequest(\"GET\", os.Args[1], nil)\nresp, _ := client.Do(req)\ndefer resp.Close()\nreader, _ := ioutil.ReadAll(resp.Body) //Reads the entire response to memory\n//Some func that gets the seek value someval\nfs.Seek(int64(someval), 0)\nfs.Write(reader)\n</code></pre>\n\n<p>This sometimes results in a large memory usage because of the <code>ioutil.ReadAll</code>. </p>\n\n<p>I tried <code>bytes.Buffer</code> as</p>\n\n<pre><code>buf := new(bytes.Buffer)\noffset, _ := buf.ReadFrom(resp.Body) //Still reads the entire response to memory.\nfs.Write(buf.Bytes())\n</code></pre>\n\n<p>but it was still the same. </p>\n\n<p>My intention was to use a buffered write to the file, then seek to the offset again, and to continue write again till the end of stream is received (and hence capturing the offset value from buf.ReadFrom). But it was also keeping everything in the memory and writing at once. </p>\n\n<p>What is the best way to write a similar stream directly to the disk, without keeping the entire content in buffer?</p>\n\n<p>An example to understand would be much appreciated.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464697247, "post_id": 37543207, "comment_id": 62579731, "body": "<a href=\"https://github.com/mattermost/platform\" rel=\"nofollow noreferrer\">github.com/mattermost/platform</a> Separate as store and model as they are doing here."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464713140, "post_id": 37543207, "comment_id": 62591209, "body": "How about using stored procedures? Inline SQL is considered very bad practice in general, not just for code clarity reasons but also because you don&#39;t protect yourself from SQL injection when you&#39;re using things like <code>fm.Sprintf</code> to form your query string. Also check out <code>Prepare</code> in the sql package, it returns a <code>*Stmt</code> which you can reuse as much as you&#39;d like."}, {"owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 1, "creation_date": 1464714726, "post_id": 37543207, "comment_id": 62592112, "body": "You can try <a href=\"https://github.com/nleof/goyesql\" rel=\"nofollow noreferrer\">github.com/nleof/goyesql</a>: Parse a file and associate SQL queries to a map. Useful for separating SQL from code logic."}, {"owner": {"reputation": 1894, "user_id": 2269979, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff22a1e835980e29baccf08a62e7ff71?s=128&d=identicon&r=PG", "display_name": "molivier", "link": "https://stackoverflow.com/users/2269979/molivier"}, "edited": false, "score": 1, "creation_date": 1464714930, "post_id": 37543207, "comment_id": 62592238, "body": "You can also have a look to drone repository implementation: <a href=\"https://github.com/drone/drone/blob/master/store/datastore/agents.go\" rel=\"nofollow noreferrer\">github.com/drone/drone/blob/master/store/datastore/agents.go</a>"}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1464716535, "post_id": 37543207, "comment_id": 62593083, "body": "This isn&#39;t specifically a golang problem.  But there are extensions that exist that might help such as Sqlx:  <a href=\"https://github.com/jmoiron/sqlx\" rel=\"nofollow noreferrer\">github.com/jmoiron/sqlx</a>"}, {"owner": {"reputation": 1364, "user_id": 313754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01b3e7f117dfdbd060d35d8527ea342b?s=128&d=identicon&r=PG", "display_name": "Bactisme", "link": "https://stackoverflow.com/users/313754/bactisme"}, "edited": false, "score": 0, "creation_date": 1464724235, "post_id": 37543207, "comment_id": 62597625, "body": "I confirm, what you really need is a &quot;repository pattern&quot;. Leave your model simple, and introduce a classes that deal with interfacing business needs with DB. <a href=\"https://i-msdn.sec.s-msft.com/dynimg/IC340233.png\" rel=\"nofollow noreferrer\">i-msdn.sec.s-msft.com/dynimg/IC340233.png</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "is_accepted": false, "score": 1, "last_activity_date": 1464767049, "creation_date": 1464767049, "answer_id": 37562425, "question_id": 37543207, "link": "https://stackoverflow.com/questions/37543207/golang-how-can-i-keep-my-sql-queries-out-of-my-code/37562425#37562425", "title": "Golang How can I keep my SQL queries out of my code?", "body": "<p>You can implement something that looks like a <a href=\"http://martinfowler.com/eaaCatalog/dataMapper.html\" rel=\"nofollow noreferrer\">data mapper pattern</a>.</p>\n\n<p><strong>Example from the EAA catalog:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/QPdxX.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QPdxX.gif\" alt=\"enter image description here\"></a></p>\n\n<p><strong>In Go:</strong></p>\n\n<p>model/person.go</p>\n\n<pre><code>type Person struct {\n  Lastname   string\n  Firstname  string\n  Dependents int\n}\n</code></pre>\n\n<p>mapper/person.go</p>\n\n<pre><code>package mapper\n\nimport m \"whatever/model\"\n\ntype PersonMap struct { }\n\nfunc (m *PersonMap) Insert(p *m.Person) error {\n  // SQL query\n  return nil\n}\n\nfunc (m *PersonMap) Update(p *m.Person) error {\n  // SQL query\n  return nil\n}\n\nfunc (m *PersonMap) Delete(p *m.Person) error {\n  // SQL query\n  return nil\n}\n</code></pre>\n\n<p>However, that solution would only be a part of the solution. Regarding the DB transactions, I think you should manage them from another \"layer\".</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1481, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1464767049, "creation_date": 1464690619, "question_id": 37543207, "link": "https://stackoverflow.com/questions/37543207/golang-how-can-i-keep-my-sql-queries-out-of-my-code", "title": "Golang How can I keep my SQL queries out of my code?", "body": "<p>I'm stuck on trying to decide the best way to organize sql queries, and code. </p>\n\n<p>Right now I have a <code>models/</code> folder in my package which contains all my tables, each in their own <code>.go</code> file, which contains a struct that matches the database table. </p>\n\n<p>I've been making a mess of my code though by throwing a ton of sqlQueries into it, especially with  transactions and what not. </p>\n\n<p>How exactly can I structure my code, without littering it with SQL queries. </p>\n\n<p>(I don't want to use an ORM to accomplish this)</p>\n"}, {"tags": ["go", "concurrency", "ftp"], "comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464688469, "post_id": 37541255, "comment_id": 62573883, "body": "Can you share the complete main? Are you blocking the main? Otherwise, it won&#39;t wait for go routine."}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "reply_to_user": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464688875, "post_id": 37541255, "comment_id": 62574148, "body": "@khrm I&#39;ve edited my question please check it!"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464694576, "post_id": 37541255, "comment_id": 62577873, "body": "You can keep take two different instance of ftp. Then it works properly."}], "answers": [{"comments": [{"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1464709403, "post_id": 37544800, "comment_id": 62588796, "body": "Yeu mean It&#39;s happend because of FTP technology? If yes what&#39;s the best way to have access to the file info here (upload time) SSH?"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1464710042, "post_id": 37544800, "comment_id": 62589213, "body": "@MasoodAfrashteh I made myself more clear. It&#39;s not due to ftp technology but  *goftp.FTP. You are using same connection in both go routine."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 1, "creation_date": 1464710335, "post_id": 37544800, "comment_id": 62589427, "body": "@MasoodAfrashteh  I added the code explaining that. I am running ftp server in local machine, so I made appropriate changes."}, {"owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1464710764, "post_id": 37544800, "comment_id": 62589764, "body": "Thanks but isn&#39;t better for me to use SSH in this situation I think we can implement something like rsync with that. I just trying to find an efficient way..."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1464712150, "post_id": 37544800, "comment_id": 62590620, "body": "Yes. Rsync is better."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "edited": false, "score": 0, "creation_date": 1464712479, "post_id": 37544800, "comment_id": 62590812, "body": "But I am not sure how to proceed with that in golang."}], "tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 2, "last_activity_date": 1464709997, "last_edit_date": 1464709997, "creation_date": 1464694955, "answer_id": 37544800, "question_id": 37541255, "link": "https://stackoverflow.com/questions/37541255/golang-upload-via-ftp-and-get-ftp-progress-in-a-same-time/37544800#37544800", "title": "golang upload via FTP and get FTP progress in a same time", "body": "<p>Currently, both the goroutine have same ftp instance (var ftp *goftp.FTP\n) which are blocking each other as they have race condition. And your result is unpredictable. Sometime, it gives correct result when first execute properly. Or when it waits for second and then runs completely. Or when first doesn't execute. Otherwise, both the go routine are blocking each other. \nSolutons:</p>\n\n<ul>\n<li><p>You take two different instances of ftp to give different connections to goroutine</p>\n\n<pre><code>var ftp,ftp1 *goftp.FTP\n</code></pre></li>\n</ul>\n\n<p>Like here <a href=\"https://play.golang.org/p/wpZf3PLVR5\" rel=\"nofollow\">Play Golang</a>\nOr</p>\n\n<ul>\n<li>Have *goftp stor first in main go routine. Then start other go routine. But it will defeat the purpose of second go routine. </li>\n</ul>\n"}], "owner": {"reputation": 1497, "user_id": 1672905, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/AfScD.png?s=128&g=1", "display_name": "coditori", "link": "https://stackoverflow.com/users/1672905/coditori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5836, "favorite_count": 1, "accepted_answer_id": 37544800, "answer_count": 1, "score": 4, "last_activity_date": 1464709997, "creation_date": 1464685281, "last_edit_date": 1464688817, "question_id": 37541255, "link": "https://stackoverflow.com/questions/37541255/golang-upload-via-ftp-and-get-ftp-progress-in-a-same-time", "title": "golang upload via FTP and get FTP progress in a same time", "body": "<p>I've used <a href=\"http://github.com/dutchcoders/goftp\" rel=\"nofollow\">http://github.com/dutchcoders/goftp</a> to send a file via FTP. It works normally but when I want to upload a file and get that file info (at the same time) It doesn't work!</p>\n\n<pre><code>fileName := \"sth\"\nvar err error\nvar ftp *goftp.FTP\n\nif ftp, err = goftp.Connect(\"serverip:port\"); err != nil {\n    fmt.Println(err)\n}\n\ndefer ftp.Close()\n\nconfig := tls.Config{\n    InsecureSkipVerify: true,\n    ClientAuth:         tls.RequestClientCert,\n}\n\nif err = ftp.AuthTLS(config); err != nil {\n    //      log.Println(\"1\", err)\n}\n\nif err = ftp.Login(\"userName\", \"pass\"); err != nil {\n    log.Println(\"2\", err)\n}\n//\nif err = ftp.Cwd(\"/home/myDir/\"); err != nil {\n    log.Println(\"3\", err)\n}\n\nvar file *os.File\nif file, err = os.Open(fileName); err != nil {\n    log.Println(\"6\", err)\n}\ndefer file.Close()\n\nfmt.Println(\"start\")\n\ngo func() {\n    fmt.Println(\"first\")\n    nmp := ftp.Stor(fileName, file)\n    if nmp != nil {\n        log.Println(\"7\", err)\n    } else {\n        fmt.Println(\"first is runung\")\n\n    }\n}()\n\ngo func() {\n    fmt.Println(\"second\")\n    for {\n        files, nms := ftp.List(fileName)\n        if nms == nil {\n            fmt.Println(files)\n        }\n        time.Sleep(1 * time.Second)\n    }\n}()\n\nfmt.Println(\"end\")\n\nvar mnmn string\nfmt.Scan(&amp;mnmn)\n</code></pre>\n\n<p>ftp.Stor func won't run and my code returns below outputs:</p>\n\n<blockquote>\n<pre><code>start\nend\nfirst\nsecond\n2016/05/31 13:21:38 7 &lt;nil&gt;\n[]\n[]\n</code></pre>\n</blockquote>\n"}, {"tags": ["go", "pipe"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464678619, "post_id": 37538389, "comment_id": 62567618, "body": "Check your calls for errors."}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464680596, "post_id": 37538389, "comment_id": 62568855, "body": "fmt.Scanln returns EOF, is this the output of the command before pipe?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464681347, "post_id": 37538389, "comment_id": 62569312, "body": "yes, it returns EOF because there&#39;s no more input. And you keep trying to read over and over even though there will never be any more input."}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464683867, "post_id": 37538389, "comment_id": 62570812, "body": "What would be the right way to read the input when the binary executed in pipe?"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464702731, "post_id": 37538389, "comment_id": 62583847, "body": "First call to <code>fmt.Scanln(&amp;response)</code> reads &quot;just-showing-how-pipe-affects-the-behavior&quot;, since it is not equal to neither &quot;y&quot; nor &quot;n&quot; it calls <code>scanln_test()</code> again in your else statement. But now Stdin is empty and closed so <code>fmt.Scanln(&amp;response)</code> returns EOF error and response is null value string, so it didnt match again and calls <code>scanln_test()</code> again in else statement. And it loops forever in recursion. What did you expect? Does <code>$ echo &quot;y&quot; | .&#47;scanln</code> runs as expected?"}, {"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464704632, "post_id": 37538389, "comment_id": 62585424, "body": "Whether it&#39;s from a pipe or not <i>makes no difference</i>. The right thing to do is check your errors and handle EOF by exiting or doing something else."}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464758118, "post_id": 37538389, "comment_id": 62608210, "body": "<code>$ echo &quot;y&quot; | .&#47;scanln</code> runs well. Ok, now I understand that this caused by EOF in stdin, but what would be the right way to read user input when I use pipe to run?"}], "answers": [{"comments": [{"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464681012, "post_id": 37539014, "comment_id": 62569113, "body": "The condition always returns false, but anyway I tried to replace fmt.Scanln with <code>ioutil.ReadAll(os.Stdin)</code> and it returns <code>[119 104 97 116 101 118 101 114 10]</code> which is probably the same &quot;EOF&quot; returned by Scanln error"}, {"owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "reply_to_user": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464684221, "post_id": 37539014, "comment_id": 62571029, "body": "You must be doing something wrong. Save <a href=\"https://play.golang.org/p/YvJwt6bw0N\" rel=\"nofollow noreferrer\">this</a> file as <code>input.go</code> and try with <code>go run input.go</code> and <code>echo foo | go run input.go</code>. You&#39;ll see <code>not piped</code> and <code>piped</code> respectively."}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464684352, "post_id": 37539014, "comment_id": 62571107, "body": "I execute the compiled binary (Linux x64)"}, {"owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "reply_to_user": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464684654, "post_id": 37539014, "comment_id": 62571281, "body": "Doesn&#39;t matter, it works the same. See <a href=\"http://dpaste.com/18QYWES.txt\" rel=\"nofollow noreferrer\">here</a>. Did you try the <b>exact</b> file I&#39;ve linked? Also, what is your go version?"}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464685379, "post_id": 37539014, "comment_id": 62571736, "body": "Sorry, I must have mixed up something. The condition works now. I tried to use <code>ioutil.ReadAll(os.Stdin)</code> as you suggested, but it just returns the content of what I have before the pipe. My golang version is 1.6"}], "tags": [], "owner": {"reputation": 1351, "user_id": 879047, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ee933b5bf986de605ee48c1ae3e3f7ee?s=128&d=identicon&r=PG", "display_name": "Duru Can Celasun", "link": "https://stackoverflow.com/users/879047/duru-can-celasun"}, "is_accepted": false, "score": 0, "last_activity_date": 1464678366, "creation_date": 1464678366, "answer_id": 37539014, "question_id": 37538389, "link": "https://stackoverflow.com/questions/37538389/using-scanln-while-executing-go-binary-with-pipe/37539014#37539014", "title": "Using scanln while executing go binary with pipe", "body": "<p>You can use <a href=\"https://golang.org/pkg/os/#FileMode\" rel=\"nofollow\"><code>os.ModeCharDevice</code></a>:</p>\n\n\n\n<pre><code>stat, _ := os.Stdin.Stat()\n\nif (stat.Mode() &amp; os.ModeCharDevice) == 0 {\n    // piped\n    input, _ := ioutil.ReadAll(os.Stdin)\n} else {\n    // not piped, do whatever, like fmt.Scanln()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464758271, "post_id": 37555533, "comment_id": 62608277, "body": "Thanks! All 3 recommendations are useful, however, the original question remains unanswered \u2013 how to read user input when I use pipe to run the binary?"}, {"owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "edited": false, "score": 0, "creation_date": 1464759942, "post_id": 37555533, "comment_id": 62608973, "body": "This was discussed here below <a href=\"http://stackoverflow.com/a/37539014/1826109\">stackoverflow.com/a/37539014/1826109</a>. It helps to get the data I have before the pipe, which is not the case I&#39;m looking for. My example <code>echo &quot;just-showing-how-pipe-affects-the-behavior&quot; | .&#47;scanln</code> is just to make a point, but what I really have is something like that <code>wget -qO- http:&#47;&#47;example.com&#47;get | sh -s &quot;param&quot;</code>. I have a binary exec inside of this shell script and I want it to show user dialogue with y/n"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1466508503, "last_edit_date": 1495542809, "creation_date": 1464728491, "answer_id": 37555533, "question_id": 37538389, "link": "https://stackoverflow.com/questions/37538389/using-scanln-while-executing-go-binary-with-pipe/37555533#37555533", "title": "Using scanln while executing go binary with pipe", "body": "<p>So you need concurrent input from Stdin (pipe) and user Stdin (Keyboard):<br>\n i think you answer is cat command see: <a href=\"https://stackoverflow.com/questions/5843741/how-can-i-pipe-initial-input-into-process-which-will-then-be-interactive\">How can I pipe initial input into process which will then be interactive?</a><br>\nand: <a href=\"https://en.wikipedia.org/wiki/Cat_(Unix)\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/Cat_(Unix)</a>  </p>\n\n<p>see: <a href=\"https://stackoverflow.com/questions/10781516/how-to-pipe-several-commands-in-go\">How to pipe several commands in Go?</a><br>\nand <a href=\"https://stackoverflow.com/questions/9366550/go-inter-process-communication\">Go Inter-Process Communication</a></p>\n\n<p>there are 3 things to note:<br>\nfirst: it is good practice to check for all errors:<br>\n  in your case :</p>\n\n<pre><code>n, err := fmt.Scanln(&amp;response)  \n</code></pre>\n\n<p>second:<br>\nyou are using recursive call (Tail Call) and it is not necessary here.<br>\nreplace it with simple for loop and see:  <a href=\"https://stackoverflow.com/questions/12102675/tail-call-optimization-in-go\">Tail Call Optimization in Go</a><br>\n3rd:<br>\nlast but not least: in case of bad input your code loops for ever(consuming stack if compiler could not optimizes tail call)!<br>\nit is good to limit to 3.<br>\nexample:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\ntype Input int\n\nconst (\n    Timeout Input = iota\n    Yes\n    No\n    Abort\n    BadInput\n)\n\nfunc userInput(msg string) Input {\n    var input string\n    for i := 0; i &lt; 3; i++ {\n        fmt.Println(msg)\n        n, err := fmt.Scanln(&amp;input)\n        if n &gt; 0 {\n            switch strings.ToLower(input) {\n            case \"y\":\n                return Yes\n            case \"n\":\n                return No\n            case \"a\":\n                return Abort\n            }\n        }\n        if err != nil {\n            return BadInput // or panic(err)\n        }\n    }\n    return Timeout\n}\nfunc main() {\n    ans := userInput(\"Please type Yes,No or Abort and then press enter [y/n/a]: \")\n    fmt.Println(ans)\n    switch ans {\n    case Yes:\n        fmt.Println(\"Yes\") // do some job\n        //...\n    }\n}\n</code></pre>\n\n<p>Edit:\nwith this simple \"y/n\" you do not need to check is it pipe or not.<br>\neven simple std Read with one byte slice is good:  </p>\n\n<pre><code>os.Stdin.Read(b1)\n</code></pre>\n\n<p>see my piping sample: <a href=\"https://stackoverflow.com/a/37334984/6169399\">https://stackoverflow.com/a/37334984/6169399</a></p>\n\n<p>but in case your Stdin is pipe you may use:</p>\n\n<pre><code>bytes, err := ioutil.ReadAll(os.Stdin) \n</code></pre>\n\n<p>to read all piped data all at once. but be careful to handle errors. \nyou can check if stdin is associated with a terminal or a pipe then use appropriate code.<br>\nsimple way to detect it is pipe or not :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    info, err := os.Stdin.Stat()\n    if err != nil {\n        fmt.Println(\"not a pipe\")\n    } else {\n        fmt.Println(\"pipe name=\", info.Name(), \"pipe size=\", info.Size())\n    }\n}\n</code></pre>\n\n<p>all in one sample code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n    \"strings\"\n)\n\ntype Input int\n\nconst (\n    Timeout Input = iota\n    Yes\n    No\n    Abort\n    BadInput\n)\n\nfunc userInput(msg string) Input {\n    var input string\n    for i := 0; i &lt; 3; i++ {\n        fmt.Println(msg)\n        n, err := fmt.Scanln(&amp;input)\n        if n &gt; 0 {\n            switch strings.ToLower(input) {\n            case \"y\":\n                return Yes\n            case \"n\":\n                return No\n            case \"a\":\n                return Abort\n            }\n        }\n        if err != nil {\n            return BadInput // or panic(err)\n        }\n    }\n    return Timeout\n}\nfunc main() {\n    info, err := os.Stdin.Stat()\n    if err != nil {\n        //fmt.Println(\"not a pipe\")\n        ans := userInput(\"Please type Yes,No or Abort and then press enter [y/n/a]: \")\n        fmt.Println(ans)\n        switch ans {\n        case Yes:\n            fmt.Println(\"Yes\") // do some job\n            //...\n        }\n\n    } else {\n        fmt.Println(\"pipe name=\", info.Name(), \"pipe size=\", info.Size())\n        bytes, err := ioutil.ReadAll(os.Stdin)\n        fmt.Println(string(bytes), err) //do some jobe with bytes\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 753, "user_id": 1826109, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/LsWmX.png?s=128&g=1", "display_name": "chingis", "link": "https://stackoverflow.com/users/1826109/chingis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1466508503, "creation_date": 1464676338, "last_edit_date": 1464760486, "question_id": 37538389, "link": "https://stackoverflow.com/questions/37538389/using-scanln-while-executing-go-binary-with-pipe", "title": "Using scanln while executing go binary with pipe", "body": "<p>I have the following go code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    if scanln_test() {\n        fmt.Println(\"Success!\")\n    }\n}\n\nfunc scanln_test() bool {\n    fmt.Print(\"Please type yes or no and then press enter [y/n]: \")\n\n    var response string\n    fmt.Scanln(&amp;response)\n\n    if response == \"y\" {\n        return true\n    } else if response == \"n\" {\n        return false\n    } else {\n        return scanln_test()\n    }\n}\n</code></pre>\n\n<p>When execute the compiled binary via pipe, e.g.:</p>\n\n<p><code>$ echo \"just-showing-how-pipe-affects-the-behavior\" | ./scanln</code> </p>\n\n<p>I get a infinite output of <code>fmt.Print</code> inside of <code>scanln_test</code> function. However when I don't execute it via pipe, everything works fine.</p>\n\n<p>Is there a way to fix this?</p>\n\n<p>UPD. fmt.Scanln returns \"EOF\" as an error when the binary executed with in pipe</p>\n\n<p>UPD2. The example with echo above is just to make a point about the pipe, but I'm not looking to read the content of this echo in my go program. The real case looks like this: <code>wget -qO- http://example.com/get | sh -s \"param\"</code>. I have exec of go program inside of this downloaded shell script and I want my program to show dialogue to user with Y/N. I'm not sure whether it's possible at all, so for now I've decided to get rid of the pipe and run it separately like <code>wget -qO- http://example.com/get | sh &amp;&amp; go-program \"param\"</code>. </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464674066, "post_id": 37537756, "comment_id": 62565409, "body": "Can you provide the name of the files you saw it into?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1464674164, "post_id": 37537756, "comment_id": 62565455, "body": "Do you have a specific piece of code in mind?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464704237, "post_id": 37537756, "comment_id": 62585131, "body": "If you were already reading the source, why not look at the actual method definition in the same file? Also, what do you mean by &quot;saw a lot&quot;? That call only appeared once in the source (outside of a test), and has been replaced by <code>d.deadline(ctx, time.Now())</code>"}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 5, "last_activity_date": 1464674563, "creation_date": 1464674563, "answer_id": 37537907, "question_id": 37537756, "link": "https://stackoverflow.com/questions/37537756/what-is-the-purpose-deadlinetime-now-in-golang/37537907#37537907", "title": "What is the purpose deadline(time.Now()) in golang?", "body": "<p>This is the function you are referring to (<code>net</code> package, file <a href=\"https://golang.org/src/net/dial.go#L191\" rel=\"noreferrer\">dial.go</a>). So, it returns the first deadline to come between the deadline set and the timeout set for the connection.</p>\n\n<pre><code>67  // Return either now+Timeout or Deadline, whichever comes first.\n68  // Or zero, if neither is set.\n69  func (d *Dialer) deadline(now time.Time) time.Time {\n70      if d.Timeout == 0 {\n71          return d.Deadline\n72      }\n73      timeoutDeadline := now.Add(d.Timeout)\n74      if d.Deadline.IsZero() || timeoutDeadline.Before(d.Deadline) {\n75          return timeoutDeadline\n76      } else {\n77          return d.Deadline\n78      }\n79  }\n</code></pre>\n"}], "owner": {"reputation": 92, "user_id": 3792393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/271d6f497b797da0c57b27fdec22916c?s=128&d=identicon&r=PG&f=1", "display_name": "Hu lv", "link": "https://stackoverflow.com/users/3792393/hu-lv"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1097, "favorite_count": 0, "accepted_answer_id": 37537907, "answer_count": 1, "score": 0, "last_activity_date": 1464727336, "creation_date": 1464673942, "question_id": 37537756, "link": "https://stackoverflow.com/questions/37537756/what-is-the-purpose-deadlinetime-now-in-golang", "title": "What is the purpose deadline(time.Now()) in golang?", "body": "<p>I saw a lot d.deadline(time.Now()) in net package. From the name, I just guess it just set deadline on now, which has no meaning in network communication. So what is the purpose deadline(time.Now()) in golang? </p>\n"}, {"tags": ["database", "go"], "answers": [{"comments": [{"owner": {"reputation": 1657, "user_id": 1311835, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/816e24723c114551ae2be00ae10fcd3c?s=128&d=identicon&r=PG", "display_name": "rahmat", "link": "https://stackoverflow.com/users/1311835/rahmat"}, "edited": false, "score": 0, "creation_date": 1464674044, "post_id": 37537220, "comment_id": 62565405, "body": "Ahh.. thanks! Changed it to <code>db, err = sql.Open(&quot;mysql&quot;, DefaultDSN)</code> also make it works.. :)"}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1657, "user_id": 1311835, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/816e24723c114551ae2be00ae10fcd3c?s=128&d=identicon&r=PG", "display_name": "rahmat", "link": "https://stackoverflow.com/users/1311835/rahmat"}, "edited": false, "score": 0, "creation_date": 1464676838, "post_id": 37537220, "comment_id": 62566652, "body": "Yes. I didn&#39;t notice that you have declare error also."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "reply_to_user": {"reputation": 1657, "user_id": 1311835, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/816e24723c114551ae2be00ae10fcd3c?s=128&d=identicon&r=PG", "display_name": "rahmat", "link": "https://stackoverflow.com/users/1311835/rahmat"}, "edited": false, "score": 0, "creation_date": 1464677293, "post_id": 37537220, "comment_id": 62566872, "body": "I added your comment as answer as people reads answer  mostly. Upvote if it helps."}], "tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 1, "last_activity_date": 1464676920, "last_edit_date": 1464676920, "creation_date": 1464671169, "answer_id": 37537220, "question_id": 37537156, "link": "https://stackoverflow.com/questions/37537156/why-my-db-connection-couldnt-be-accessed-from-handler/37537220#37537220", "title": "Why my db connection couldn&#39;t be accessed from handler?", "body": "<p>Your db variable in function is shadowing global variable.\nWhen you do this:</p>\n\n<pre><code>db,err:=\n</code></pre>\n\n<p>It assigns it to a new local variable db.\nThis is because it's not from same block. According to the standard:</p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may redeclare variables provided they were originally declared earlier\n  in the same block (or the parameter lists if the block is the function\n  body) with the same type, and at least one of the non-blank variables\n  is new. As a consequence, redeclaration can only appear in a\n  multi-variable short declaration. Redeclaration does not introduce a\n  new variable; it just assigns a new value to the original.</p>\n</blockquote>\n\n<p>So global variable remains nil pointer. And when it is access, you get nil pointer dereference</p>\n\n<p>Change it to d and then assign it later to db. Or which is more correct(as given in comment by rahmat):=</p>\n\n<pre><code>d , err = \n</code></pre>\n\n<p>I would recommend you to have separate files for handler, models etc. And look into <a href=\"https://github.com/mattermost/platform\" rel=\"nofollow\">https://github.com/mattermost/platform</a> to how to organise the code. </p>\n"}], "owner": {"reputation": 1657, "user_id": 1311835, "user_type": "registered", "accept_rate": 32, "profile_image": "https://www.gravatar.com/avatar/816e24723c114551ae2be00ae10fcd3c?s=128&d=identicon&r=PG", "display_name": "rahmat", "link": "https://stackoverflow.com/users/1311835/rahmat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 180, "favorite_count": 0, "accepted_answer_id": 37537220, "answer_count": 1, "score": 0, "last_activity_date": 1464676920, "creation_date": 1464670751, "question_id": 37537156, "link": "https://stackoverflow.com/questions/37537156/why-my-db-connection-couldnt-be-accessed-from-handler", "title": "Why my db connection couldn&#39;t be accessed from handler?", "body": "<p>I have code like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\n// Default constant for configuration\nconst DefaultHTTPAddr = \":8080\"\nconst DefaultDSN = \"root:root@tcp(127.0.0.1:3306)/librarian\"\n\n// Parameters\nvar (\n    httpAddr string\n    dsn      string\n    db       *sql.DB\n)\n\n// init initializes this package.\nfunc init() {\n    flag.StringVar(&amp;httpAddr, \"addr\", DefaultHTTPAddr, \"Set the HTTP bind address\")\n    flag.StringVar(&amp;dsn, \"dsn\", DefaultDSN, \"Set the Data Source Name\")\n    flag.Usage = func() {\n        fmt.Fprintf(os.Stderr, \"Usage: %s [options]\\n\", os.Args[0])\n        flag.PrintDefaults()\n    }\n\n}\n\ntype Book struct {\n    id     int\n    title  string\n    author string\n}\n\nfunc main() {\n    flag.Parse()\n\n    var err error\n    db, err := sql.Open(\"mysql\", DefaultDSN)\n    if err != nil {\n        log.Fatal(err)\n    }\n    if err = db.Ping(); err != nil {\n        log.Fatal(err)\n    }\n\n    // handler\n    http.HandleFunc(\"/\", homepage)\n    http.HandleFunc(\"/books\", booksIndex)\n\n    log.Println(\"httpd started successfully\")\n    http.ListenAndServe(httpAddr, nil)\n}\n\nfunc booksIndex(w http.ResponseWriter, r *http.Request) {\n    if r.Method != \"GET\" {\n        http.Error(w, http.StatusText(405), 405)\n        return\n    }\n\n    rows, err := db.Query(\"SELECT * FROM books\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    books := make([]*Book, 0)\n    for rows.Next() {\n        bk := new(Book)\n        err = rows.Scan(&amp;bk.id, &amp;bk.title, &amp;bk.author)\n        if err != nil {\n            log.Fatal(err)\n        }\n        books = append(books, bk)\n    }\n    if err = rows.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    for _, bk := range books {\n        fmt.Fprintf(w, \"%v, %v, %v\\n\", bk.id, bk.title, bk.author)\n    }\n}\n\nfunc homepage(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Welcome!\")\n}\n</code></pre>\n\n<p>Everytime I try to access <code>/books</code> it always panic. </p>\n\n<pre><code>$ curl localhost:8080/books\ncurl: (52) Empty reply from server\n</code></pre>\n\n<p>Like this one:</p>\n\n<pre><code>2016/05/31 11:56:38 http: panic serving 127.0.0.1:51711: runtime error: invalid memory address or nil pointer dereference\ngoroutine 6 [running]:\nnet/http.(*conn).serve.func1(0xc820074100)\n        /usr/local/opt/go/libexec/src/net/http/server.go:1389 +0xc1\npanic(0x357b40, 0xc82000a150)\n        /usr/local/opt/go/libexec/src/runtime/panic.go:443 +0x4e9\ndatabase/sql.(*DB).conn(0x0, 0xc820010b01, 0xc8200de000, 0x0, 0x0)\n        /usr/local/opt/go/libexec/src/database/sql/sql.go:778 +0xac9\ndatabase/sql.(*DB).query(0x0, 0x4022c0, 0x13, 0x0, 0x0, 0x0, 0x3c4601, 0x6, 0x0, 0x0)\n        /usr/local/opt/go/libexec/src/database/sql/sql.go:1073 +0x46\ndatabase/sql.(*DB).Query(0x0, 0x4022c0, 0x13, 0x0, 0x0, 0x0, 0xc820016280, 0x0, 0x0)\n        /usr/local/opt/go/libexec/src/database/sql/sql.go:1061 +0xa3\nmain.booksIndex(0x6979c0, 0xc82006da00, 0xc8200e2000)\n        /Users/rahmatawaludin/gocode/src/github.com/rahmatawaludin/librarian/main.go:68 +0xd9\nnet/http.HandlerFunc.ServeHTTP(0x4666f8, 0x6979c0, 0xc82006da00, 0xc8200e2000)\n        /usr/local/opt/go/libexec/src/net/http/server.go:1618 +0x3a\nnet/http.(*ServeMux).ServeHTTP(0xc820010ba0, 0x6979c0, 0xc82006da00, 0xc8200e2000)\n        /usr/local/opt/go/libexec/src/net/http/server.go:1910 +0x17d\nnet/http.serverHandler.ServeHTTP(0xc820074080, 0x6979c0, 0xc82006da00, 0xc8200e2000)\n        /usr/local/opt/go/libexec/src/net/http/server.go:2081 +0x19e\nnet/http.(*conn).serve(0xc820074100)\n        /usr/local/opt/go/libexec/src/net/http/server.go:1472 +0xf2e\ncreated by net/http.(*Server).Serve\n        /usr/local/opt/go/libexec/src/net/http/server.go:2137 +0x44e\n</code></pre>\n\n<p>I thought I could access <code>db</code> from <code>booksIndex</code> as I set in to be global variable. When I move the db initialization to <code>booksIndex</code> the errors doesn't show up. </p>\n\n<p>What parts is wrong in my code?</p>\n\n<p>Also, I'm new in Golang. If you have any suggestion on how to organize my code, please tell me. Thanks.. :)</p>\n"}, {"tags": ["arrays", "json", "go", "unmarshalling", "flickr"], "comments": [{"owner": {"reputation": 3695, "user_id": 1360261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/710b744442d5e038351521a8d8f3e661?s=128&d=identicon&r=PG", "display_name": "Bubbles", "link": "https://stackoverflow.com/users/1360261/bubbles"}, "edited": false, "score": 2, "creation_date": 1464667795, "post_id": 37536460, "comment_id": 62563352, "body": "Are you reading the error from <code>json.Unmarshal</code>? When I try the above I get a problem with the type mismatch between <code>ispublic</code>, <code>isfriend</code>, and <code>isfamily</code> versus the strings the struct is expecting. If I change the types it seems to work alright. Here&#39;s an example with the change, including usage for one field of <code>json.Number</code>, which can be handy in cases like this - <a href=\"https://play.golang.org/p/4fE_MkxgxS\" rel=\"nofollow noreferrer\">play.golang.org/p/4fE_MkxgxS</a>. I see two entries in <code>Photo</code> in the results."}, {"owner": {"reputation": 4297, "user_id": 3798545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TlzYW.jpg?s=128&g=1", "display_name": "That Dave Guy", "link": "https://stackoverflow.com/users/3798545/that-dave-guy"}, "reply_to_user": {"reputation": 3695, "user_id": 1360261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/710b744442d5e038351521a8d8f3e661?s=128&d=identicon&r=PG", "display_name": "Bubbles", "link": "https://stackoverflow.com/users/1360261/bubbles"}, "edited": false, "score": 0, "creation_date": 1464668263, "post_id": 37536460, "comment_id": 62563481, "body": "That did it, thank you. I don&#39;t want to talk about how many times I went over this."}], "answers": [{"tags": [], "owner": {"reputation": 3695, "user_id": 1360261, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/710b744442d5e038351521a8d8f3e661?s=128&d=identicon&r=PG", "display_name": "Bubbles", "link": "https://stackoverflow.com/users/1360261/bubbles"}, "is_accepted": true, "score": 4, "last_activity_date": 1464669103, "last_edit_date": 1495540938, "creation_date": 1464669103, "answer_id": 37536871, "question_id": 37536460, "link": "https://stackoverflow.com/questions/37536460/unmarshal-only-gives-me-first-element-of-array-that-is-nested-in-json-response/37536871#37536871", "title": "Unmarshal only gives me first element of array that is nested in JSON response", "body": "<p>Answered originally in comments, but for a bit more clarification:</p>\n\n<p>There was an uncaught error from <code>json.Unmarshal</code>: </p>\n\n<p><code>json: cannot unmarshal number into Go value of type string</code></p>\n\n<p>Caused by a type mismatch between the flicker API giving <code>ispublic</code>, <code>isfriend</code>, and <code>isfamily</code> as integers, but the struct was expecting strings. An easy fix is just to convert them to ints.</p>\n\n<p>Another option for these sorts of situations is to use <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow noreferrer\"><code>json.Number</code></a>, which wraps a basic string from the source json and provides a few convenience methods to convert it to a number later (or just keep it as a string). By doing say </p>\n\n<pre><code>Ispublic json.Number `json:\"ispublic\"`   //is image publicly viewable?\nIsfriend json.Number `json:\"isfriend\"`   //is image owner my friend?\nIsfamily json.Number `json:\"isfamily\"`\n</code></pre>\n\n<p>It will work fine, and the result can easily be gotten as a string via <code>fr.Ispublic.String()</code>.</p>\n\n<p>A more elaborate change that might be useful in this situation is to use a custom boolean type. The values in question seem to mirror booleans, but integers do not map cleanly to booleans either. A custom deserialized type can be used. Borrowing from <a href=\"https://stackoverflow.com/questions/30856454/golang-how-to-unmarshall-both-0-and-false-as-bool-from-json\">this example</a> elsewhere on stackoverflow:</p>\n\n<pre><code>type ConvertibleBoolean bool\n\nfunc (bit ConvertibleBoolean) UnmarshalJSON(data []byte) error {\n    asString := string(data)\n    if asString == \"1\" || asString == \"true\" {\n        bit = true\n    } else if asString == \"0\" || asString == \"false\" {\n        bit = false\n    } else {\n        return errors.New(fmt.Sprintf(\"Boolean unmarshal error: invalid input %s\", asString))\n    }\n    return nil\n}\n</code></pre>\n\n<p>The above would let you declare the <code>Is*</code> values as <code>ConvertibleBoolean</code>, and will automatically map the 0 &amp; 1 values you'd presumably get in those fields from Flickr to booleans.</p>\n"}], "owner": {"reputation": 4297, "user_id": 3798545, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TlzYW.jpg?s=128&g=1", "display_name": "That Dave Guy", "link": "https://stackoverflow.com/users/3798545/that-dave-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1354, "favorite_count": 0, "accepted_answer_id": 37536871, "answer_count": 1, "score": 1, "last_activity_date": 1464669254, "creation_date": 1464666099, "last_edit_date": 1464667389, "question_id": 37536460, "link": "https://stackoverflow.com/questions/37536460/unmarshal-only-gives-me-first-element-of-array-that-is-nested-in-json-response", "title": "Unmarshal only gives me first element of array that is nested in JSON response", "body": "<p>I am trying to work with the Flickr API and I have an endpoint which gives me a response like this</p>\n\n<pre><code>{\n  \"photos\": {\n    \"page\": 1,\n    \"pages\": 500,\n    \"perpage\": 1,\n    \"total\": 500,\n    \"photo\": [\n      {\n        \"id\": \"12345\",\n        \"owner\": \"12345@N01\",\n        \"secret\": \"12ab345xyz\",\n        \"server\": \"1234\",\n        \"farm\": 1,\n        \"title\": \"Some Title\",\n        \"ispublic\": 1,\n        \"isfriend\": 0,\n        \"isfamily\": 0\n      },\n     ...\n    ]\n  },\n  \"stat\": \"ok\"\n}\n</code></pre>\n\n<p>I have a struct that looks like this</p>\n\n<pre><code>type FlickrResp struct {\n    Photos struct {\n        Page int            `json:\"page\"`       //what page the results were retreived from\n        Pages int           `json:\"pages\"`      //total number of pages of results\n        Perpage int         `json:\"perpage\"`    //number of results per page\n        Total int           `json:\"total\"`      //total number of results\n        Photo []struct {\n            ID string       `json:\"id\"`         //image ID\n            Owner string    `json:\"owner\"`      //owner ID\n            Secret string   `json:\"secret\"`     //owner secret\n            Server string   `json:\"server\"`     //server ID\n            Farm int        `json:\"farm\"`       //farm ID\n            Title string    `json:\"title\"`      //image title\n            Ispublic string `json:\"ispublic\"`   //is image publicly viewable?\n            Isfriend string `json:\"isfriend\"`   //is image owner my friend?\n            Isfamily string `json:\"isfamily\"`   //is image owner my family?\n        }                   `json:\"photo\"`      //array of objects with details of photos\n    }                       `json:\"photos\"`     //object that holds information about photoset\n    Stat string             `json:\"stat\"`       //status\n}\n</code></pre>\n\n<p>and I'm trying to Unmarshal thusly</p>\n\n<pre><code>var fr FlickrResp                                               //create blank struct of type FlickrResp to hold JSON\nresp, err := ioutil.ReadAll(flickrCB.Body)                      //read HTTP GET response\nif err != nil {\n\n}\njson.Unmarshal([]byte(resp), &amp;fr)                               //serialize JSON into template\n</code></pre>\n\n<p>flickCB.Body comes from an http.Get</p>\n\n<p>The problem is that I'm only getting the first element of the photo array. I can see that I have more than one element when I print the response object cast as a string. What am I doing wrong? I've been banging my head against Unmarshal and more complicated JSON responses for a few days now.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1464731570, "post_id": 37537134, "comment_id": 62601262, "body": "Thank you so much!"}, {"owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "edited": false, "score": 7, "creation_date": 1505033546, "post_id": 37537134, "comment_id": 79239714, "body": "for the address to redirect to, you&#39;d be better off using <code>&quot;https:&#47;&#47;&quot; + r.Host + r.RequestURI</code>, which will avoid having your hostname or IP address hardcoded."}, {"owner": {"reputation": 3567, "user_id": 4019871, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7db9ac6bdc0a996dd01da64b3660f8b6?s=128&d=identicon&r=PG&f=1", "display_name": "Mas Bagol", "link": "https://stackoverflow.com/users/4019871/mas-bagol"}, "edited": false, "score": 0, "creation_date": 1577876442, "post_id": 37537134, "comment_id": 105272452, "body": "<code>r.Host</code> is obtained from <code>Host</code> header in the http request. I think it should not be trusted (see <a href=\"https://security.stackexchange.com/a/111903\">this</a> post) and <code>r.RequestURI</code> could contains full origin like <code>http:&#47;&#47;localhost:5000</code> (see <a href=\"https://stackoverflow.com/a/6911635/4019871\">this</a> post) so it&#39;s too should not be trusted."}, {"owner": {"reputation": 2324, "user_id": 86375, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/830d4a5362713c3080d20f4222922f10?s=128&d=identicon&r=PG", "display_name": "Cameron", "link": "https://stackoverflow.com/users/86375/cameron"}, "reply_to_user": {"reputation": 3567, "user_id": 4019871, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/7db9ac6bdc0a996dd01da64b3660f8b6?s=128&d=identicon&r=PG&f=1", "display_name": "Mas Bagol", "link": "https://stackoverflow.com/users/4019871/mas-bagol"}, "edited": false, "score": 0, "creation_date": 1617492753, "post_id": 37537134, "comment_id": 118320345, "body": "TL;DR, using r.Host is the correct way to do this, despite user fiddling potential. --- Interesting discussion. @MasBagol is quite correct, the user can &#39;fool&#39; or override r.Host .  But, the alternatives are NOT pretty, it could mean asking your admin/user to configure &#39;IPAddr&#39;, which is a BAD idea.  Without lots of brittle assumptions about NAT/requestor-environment is it difficult to figure out what to pass to http.Redirect() without using r.Host.  And! given the example, the &#39;hacker&#39; is only managing to get your Go-app to pass a HTTP 301 Moved Permanently back to their own browser."}], "tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 22, "last_activity_date": 1464800022, "last_edit_date": 1464800022, "creation_date": 1464670606, "answer_id": 37537134, "question_id": 37536006, "link": "https://stackoverflow.com/questions/37536006/how-do-i-rewrite-redirect-from-http-to-https-in-go/37537134#37537134", "title": "How do I rewrite / redirect from http to https in Go?", "body": "<p>Create a handler which handles redirection to https like:</p>\n\n<pre><code>func redirectTLS(w http.ResponseWriter, r *http.Request) {\n    http.Redirect(w, r, \"https://IPAddr:443\"+r.RequestURI, http.StatusMovedPermanently)\n}\n</code></pre>\n\n<p>Then redirect http traffic:</p>\n\n<pre><code>go func() {\n    if err := http.ListenAndServe(\":80\", http.HandlerFunc(redirectTLS)); err != nil {\n        log.Fatalf(\"ListenAndServe error: %v\", err)\n    }\n}()\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "edited": false, "score": 0, "creation_date": 1464731644, "post_id": 37553452, "comment_id": 62601294, "body": "Thank you for the help! I gave the answer to the other post that was some hours earlier. Have a good day!"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1465567249, "post_id": 37553452, "comment_id": 62969945, "body": "Is there a problem here with the explicit 127.0.0.1 address? It might need the domain name contatenated, e.g &quot;https://&quot; + domain + r.RequestURI."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1465567273, "post_id": 37553452, "comment_id": 62969954, "body": "Also, 443 is the default port for https and can be omitted."}], "tags": [], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "is_accepted": false, "score": 3, "last_activity_date": 1611594401, "last_edit_date": 1611594401, "creation_date": 1464720592, "answer_id": 37553452, "question_id": 37536006, "link": "https://stackoverflow.com/questions/37536006/how-do-i-rewrite-redirect-from-http-to-https-in-go/37553452#37553452", "title": "How do I rewrite / redirect from http to https in Go?", "body": "<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;net/http&quot;\n)\n\nfunc redirectToHttps(w http.ResponseWriter, r *http.Request) {\n    // Redirect the incoming HTTP request. Note that &quot;127.0.0.1:443&quot; will only work if you are accessing the server from your local machine.\n    http.Redirect(w, r, &quot;https://127.0.0.1:443&quot;+r.RequestURI, http.StatusMovedPermanently)\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, &quot;Hi there!&quot;)\n    fmt.Println(r.RequestURI)\n}\n\nfunc main() {\n    http.HandleFunc(&quot;/&quot;, handler)\n    // Start the HTTPS server in a goroutine\n    go http.ListenAndServeTLS(&quot;:443&quot;, &quot;cert.pem&quot;, &quot;key.pem&quot;, nil)\n    // Start the HTTP server and redirect all incoming connections to HTTPS\n    http.ListenAndServe(&quot;:8080&quot;, http.HandlerFunc(redirectToHttps))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4580, "user_id": 262748, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/O0oj4.png?s=128&g=1", "display_name": "Benny Jobigan", "link": "https://stackoverflow.com/users/262748/benny-jobigan"}, "edited": false, "score": 0, "creation_date": 1567588175, "post_id": 53496743, "comment_id": 102003714, "body": "+10. <code>net.JoinHostPort()</code> was exactly what I needed."}], "tags": [], "owner": {"reputation": 508, "user_id": 878792, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c8c31138045abd812fcf28cee493692e?s=128&d=identicon&r=PG", "display_name": "jabbrwcky", "link": "https://stackoverflow.com/users/878792/jabbrwcky"}, "is_accepted": false, "score": 6, "last_activity_date": 1543311798, "creation_date": 1543311798, "answer_id": 53496743, "question_id": 37536006, "link": "https://stackoverflow.com/questions/37536006/how-do-i-rewrite-redirect-from-http-to-https-in-go/53496743#53496743", "title": "How do I rewrite / redirect from http to https in Go?", "body": "<p>The solutions posted above are a little inflexible, especially if the external hostname is different from the local host.</p>\n\n<p>Here is the code I use for HTTP->HTTPS redirects:</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n    \"log\"\n    \"net/http\"\n)\n\nvar httpAddr \":8080\"\nvar httpsAddr \":8443\"\n\nfunc main() {\n    srv := http.Server{\n        Addr: httpsAddr,\n    }\n\n    _, tlsPort, err := net.SplitHostPort(httpsAddr)\n    if err != nil {\n        return err\n    }\n    go redirectToHTTPS(tlsPort)\n\n    srv.ListenAndServeTLS(\"cert.pem\", \"key.pem\")\n}\n\nfunc redirectToHTTPS(tlsPort string) {\n    httpSrv := http.Server{\n        Addr: httpAddr,\n        Handler: http.HandlerFunc(func(w http.ResponseWriter, r *http.Request){\n            host, _, _ := net.SplitHostPort(r.Host)\n            u := r.URL\n            u.Host = net.JoinHostPort(host, tlsPort)\n            u.Scheme=\"https\"\n            log.Println(u.String())\n            http.Redirect(w,r,u.String(), http.StatusMovedPermanently)\n        }),\n    }\n    log.Println(httpSrv.ListenAndServe())\n}\n</code></pre>\n\n<p>If you are using standard ports (80,443) the splitting of joining of the adresses is not rquired and just setting the scheme on the URL is sufficient.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user8094098"}, "is_accepted": false, "score": 1, "last_activity_date": 1583670689, "creation_date": 1583670689, "answer_id": 60587482, "question_id": 37536006, "link": "https://stackoverflow.com/questions/37536006/how-do-i-rewrite-redirect-from-http-to-https-in-go/60587482#60587482", "title": "How do I rewrite / redirect from http to https in Go?", "body": "<p>There is another great example and discussion here if you are using your own mux:\n<a href=\"https://gist.github.com/d-schmidt/587ceec34ce1334a5e60\" rel=\"nofollow noreferrer\">https://gist.github.com/d-schmidt/587ceec34ce1334a5e60</a></p>\n"}], "owner": {"reputation": 4421, "user_id": 3759007, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/7e4b340203ea76ae1e9e1110fce0b343?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/3759007/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10908, "favorite_count": 5, "accepted_answer_id": 37537134, "answer_count": 4, "score": 18, "last_activity_date": 1611594401, "creation_date": 1464662332, "question_id": 37536006, "link": "https://stackoverflow.com/questions/37536006/how-do-i-rewrite-redirect-from-http-to-https-in-go", "title": "How do I rewrite / redirect from http to https in Go?", "body": "<p>I have put up TLS and it works. I know how to rewrite from http to https in nginx, but I do not use nginx anymore. I don't know how to do this in Go properly.</p>\n\n<pre><code>func main() {\n\n    certificate := \"/srv/ssl/ssl-bundle.crt\"\n    privateKey := \"/srv/ssl/mykey.key\"\n\n    http.HandleFunc(\"/\", rootHander)\n    // log.Fatal(http.ListenAndServe(\":80\", nil))\n    log.Fatal(http.ListenAndServeTLS(\":443\", certificate, privateKey, nil))\n}\n\nfunc rootHander(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"To the moon!\"))\n}\n</code></pre>\n\n<p>How would I do this in a good way?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464658266, "post_id": 37535524, "comment_id": 62561243, "body": "It <i>is</i> a reference to the underlying array. <a href=\"https://play.golang.org/p/EQDfsMq9SB\" rel=\"nofollow noreferrer\">play.golang.org/p/EQDfsMq9SB</a>"}, {"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "reply_to_user": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464658505, "post_id": 37535524, "comment_id": 62561275, "body": "@noisypixy This is my confusion. I thought a slice referenced the underlying array that is created with the initial make call. I can certainly print  the sub slices as suggested above, but the underlying array remains unchanged."}, {"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1464658536, "post_id": 37535524, "comment_id": 62561285, "body": "Interesting, I guess <code>Sscanf</code> is doing some re-allocations internally. Updated answer."}, {"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "reply_to_user": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464658773, "post_id": 37535524, "comment_id": 62561319, "body": "Extending @noisypixy&#39;s example reveals that <code>Sscanf</code> must allocate a new byte array and update the pointer referenced by <code>a</code> to the new allocation. <a href=\"https://play.golang.org/p/Ai2E6ZsMZc\" rel=\"nofollow noreferrer\">play.golang.org/p/Ai2E6ZsMZc</a>"}], "tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": true, "score": 3, "last_activity_date": 1464658528, "last_edit_date": 1464658528, "creation_date": 1464658097, "answer_id": 37535524, "question_id": 37535286, "link": "https://stackoverflow.com/questions/37535286/how-do-you-use-a-sub-slice-with-scanning-hexadecimal-strings-with-sscanf/37535524#37535524", "title": "How do you use a sub slice with scanning hexadecimal strings with Sscanf?", "body": "<p>When you run <code>Sscanf</code> it will re-allocate the pointers for <code>a</code>, <code>b</code>, and <code>c</code> so that they no longer point to their respective locations within <code>bs</code>. You'll see this if you output the values of these variables:</p>\n\n<pre><code>fmt.Printf(\"%v %v %v\", a, b, c)\n# Outputs [0 255] [255 0] [0 255]\n</code></pre>\n\n<p>You can return the result like this:</p>\n\n<pre><code>result := append(a, b...)\nresult = append(result, c...)\nreturn result, nil\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2722, "user_id": 4740606, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sWt5W.jpg?s=128&g=1", "display_name": "Snowman", "link": "https://stackoverflow.com/users/4740606/snowman"}, "is_accepted": false, "score": 1, "last_activity_date": 1464701232, "creation_date": 1464701232, "answer_id": 37547112, "question_id": 37535286, "link": "https://stackoverflow.com/questions/37535286/how-do-you-use-a-sub-slice-with-scanning-hexadecimal-strings-with-sscanf/37547112#37547112", "title": "How do you use a sub slice with scanning hexadecimal strings with Sscanf?", "body": "<p>You can get the result that you expected, and by nearly identical means as you originally attempted. This modified version of your example yields <code>Value: [0 255 255 0 0 255] Error: &lt;nil&gt;</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n)\n\nfunc parse(data string) ([]byte, error) {\n    bs := make([]byte, 6)\n\n    // Create sub slices over larger slice\n    a := bs[0:2]\n    b := bs[2:4]\n    c := bs[4:6]\n\n    // Attempt to scan each string value into their respective slices\n    _, err := fmt.Sscanf(data, \"%4x-%4x-%4x\", &amp;a, &amp;b, &amp;c)\n\n    fmt.Println(a, b, c)\n    return bytes.Join([][]byte{a, b, c}, []byte(\"\")), err\n}\n\nfunc main() {\n    d, err := parse(\"00ff-ff00-00ff\")\n    fmt.Printf(\"Value: %+v Error: %v\\n\", d, err)\n}\n</code></pre>\n"}], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 119, "favorite_count": 0, "accepted_answer_id": 37535524, "answer_count": 2, "score": 1, "last_activity_date": 1464701232, "creation_date": 1464655943, "question_id": 37535286, "link": "https://stackoverflow.com/questions/37535286/how-do-you-use-a-sub-slice-with-scanning-hexadecimal-strings-with-sscanf", "title": "How do you use a sub slice with scanning hexadecimal strings with Sscanf?", "body": "<p>I have a parsing function that will fill a byte array with data given in a string format.</p>\n\n<pre><code>func Parse(data string) ([]byte, error) {\n    bs := make([]byte, 6)\n\n    // Create sub slices over larger slice\n    a := bs[0:2]\n    b := bs[2:4]\n    c := bs[4:6]\n\n    // Attempt to scan each string value into their respective slices\n    _, err := fmt.Sscanf(data, \"%4x-%4x-%4x\", &amp;a, &amp;b, &amp;c)\n\n    return bs, err\n}\n</code></pre>\n\n<p>Evaluating this function on the <a href=\"https://play.golang.org/p/c0o9mjIqlg\" rel=\"nofollow\">Go Playground</a> the null value of the byte array is returned.</p>\n\n<pre><code>func main() {\n    d, err := Parse(\"00ff-ff00-00ff\")\n    fmt.Printf(\"Value: %+v Error: %s\\n\", d, err)\n}\n</code></pre>\n\n<p>Which yields:</p>\n\n<pre><code>Value: [0 0 0 0 0 0] Error: %!s(&lt;nil&gt;)\n</code></pre>\n\n<p>I expected the above approach to return <code>[0 255 255 0 0 255]</code>. Is there a correct approach to populating a byte array with data using Sscanf? </p>\n"}, {"tags": ["json", "go", "unicode", "emoji", "utf8mb4"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1464658056, "post_id": 37535245, "comment_id": 62561208, "body": "It would be extremely helpful to include the JSON that is causing the error."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1464659949, "post_id": 37535245, "comment_id": 62561545, "body": "Posted. It&#39;s one of the emoji characters. Without it, it works fine."}, {"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 2, "creation_date": 1464662178, "post_id": 37535245, "comment_id": 62562002, "body": "The value of <code>test</code> in your JSON is <code>\\u262e\\ufe0f</code>. The first character is <code>PEACE SYMBOL</code>; the second is <code>VARIATION SELECTOR-16</code>. I suspect the presence or absence of the latter is what causes the emoji to be displayed or not, and the error as well. Please, confirm."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464670229, "post_id": 37535245, "comment_id": 62564063, "body": "I&#39;ve only tried it with and without the emoji entirely, but I&#39;m guessing you&#39;re probably right on the second character. Still, the problem I&#39;ve got is that I cannot control the user input but for some reason Golang&#39;s translation of this is considered invalid by the client, yet the same script in PHP returns fine without any processing issue. (fetches from the same DB)"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1465190810, "post_id": 37535245, "comment_id": 62779967, "body": "It works fine for me.  Maybe the &quot;database explorer&quot; is broken?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1465191557, "post_id": 37535245, "comment_id": 62780201, "body": "I think it is, but the problem is solved below in the comments."}], "answers": [{"comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1464662660, "post_id": 37536005, "comment_id": 62562126, "body": "&quot;character&quot; is a somewhat vague term in this context; those six bytes are two codepoints (two runes in Go speak) that make up one visible symbol."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 2, "creation_date": 1464669992, "post_id": 37536005, "comment_id": 62563986, "body": "OK, but blaming this whole thing on iOS isn&#39;t fair because if I code the same script in PHP with the same database and same iOS client, it doesn&#39;t have this issue. It&#39;s something with Golang because that&#39;s the different component."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464670081, "post_id": 37536005, "comment_id": 62564009, "body": "Also, just to clarify, the storage format in the database is <code>utf8mb4</code>. It returns the emoji fine via the script in PHP, as mentioned, but not Golang. (I prefer the Golang version so I hope I can resolve this, as I cannot control user input which could be any of these variations.)"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464697781, "post_id": 37536005, "comment_id": 62580125, "body": "I gave you info how go deals with this characrers, you gave me &quot;it works fine with PHP&quot; reason. is it fair? give us what PHP read from database (PHP can clean strings internally), try to encode it with PHP and show output. try to DEcode \u262e ([226 152 174]) 1 character with NSJSONSerialization, try to ENcode the same character in iOS, try to ENcode unprintable character ([239, 184, 143]) in iOS. I think you got the point."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464801424, "post_id": 37536005, "comment_id": 62637175, "body": "Right, but my point isn&#39;t to start a language battle more to address the fact that something that Go is doing is causing a problem from a shared data source. Regardless of what Go is doing right or wrong, in my opinion Go is generating what is considered unsafe JSON considering that user input might have these characters in it. Would you not agree? Is there any way to protect against them on the server-side?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464801977, "post_id": 37536005, "comment_id": 62637494, "body": "I created a related question about perhaps band-aiding this before returning the JSON... <a href=\"https://stackoverflow.com/questions/37575168/how-to-remove-unescaped-characters-from-json-generated-by-go\" title=\"how to remove unescaped characters from json generated by go\">stackoverflow.com/questions/37575168/&hellip;</a> ... Could you post thoughts if you have any?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 2, "creation_date": 1464826144, "post_id": 37536005, "comment_id": 62648301, "body": "Did some serious digging on this and found a really odd encoding error somewhere on the client-side. So you&#39;re right, it wasn&#39;t a Go issue! It was just brought to light by the fact that Go was, in fact, doing everything right. :)"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464830730, "post_id": 37536005, "comment_id": 62649270, "body": "I&#39;m glad it helped. Make sure to use <code>encoding:NSUTF8StringEncoding</code>  or <code>dataUsingEncoding:NSUTF8StringEncoding</code> on your NSString/NSData."}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "edited": false, "score": 0, "creation_date": 1464831406, "post_id": 37536005, "comment_id": 62649389, "body": "If you are using NSString: default NSString&#39;s encoding is UTF-16, may be its the root of problem. However NSData has no encoding at all, its simple bytes buffer. Cant say more with out client code."}], "tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": true, "score": 2, "last_activity_date": 1464665682, "last_edit_date": 1495542289, "creation_date": 1464662317, "answer_id": 37536005, "question_id": 37535245, "link": "https://stackoverflow.com/questions/37535245/go-is-generating-unescaped-control-characters-in-json-output-due-to-emoji/37536005#37536005", "title": "Go is generating unescaped control characters in JSON output due to emoji", "body": "<p>Go is doing fine.</p>\n\n<pre><code>fmt.Println([]byte(\"\u262e\ufe0f\"))\n//[226 152 174 239 184 143]\n//Yup, 1 character - 6 bytes.\n</code></pre>\n\n<p>NSJSONSerialization cant handle this. May be this link will be helpful\n<a href=\"https://stackoverflow.com/questions/23814394/nsjsonserialization-and-emoji\">NSJSONSerialization and Emoji</a>. It's something about <code>NSData * utf32Data = [uniText dataUsingEncoding:NSUTF32LittleEndianStringEncoding];</code>. blah</p>\n\n<p>Can you give us byte representation of \"\u262e\ufe0f\" simbol in \"iOS style\", like i did with go?</p>\n\n<p><strong>UPD</strong></p>\n\n<p>I made some research, looks like something wrong with your database encoding. Is it UTF16?</p>\n\n<p>Check this out</p>\n\n<pre><code>// it look the same, but completely different \"characters\"\n//first one is yours, and second one is U+262E\nconst nihongo = \"\u262e\ufe0f\u262e\"\nfor index, runeValue := range nihongo {\n        fmt.Printf(\"%#U starts at byte position %d\\n\", runeValue, index)\n}\nbad := []byte(\"\u262e\ufe0f\")\ngood := []byte(\"\u262e\")\nfmt.Printf(\"%v %s \\n\", bad, bad)\nfmt.Printf(\"%v %s \\n\", good, good)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>U+262E '\u262e' starts at byte position 0\nU+FE0F '\ufe0f' starts at byte position 3\nU+262E '\u262e' starts at byte position 6\n[226 152 174 239 184 143] \u262e\ufe0f \n[226 152 174] \u262e \n</code></pre>\n\n<p><strong>UDP2</strong></p>\n\n<p>It just hit me! I was doing ctrl+c/ctrl+v all the way with your symbol. But it is not a single symbol! Its 2 symbols and second one is unprintable.</p>\n\n<pre><code>unprintable := []byte{239, 184, 143}\nfmt.Printf(\"valid? %v\", utf8.Valid(unprintable))\nfmt.Println(\"full rune?\", utf8.FullRune(unprintable))\nr, size := utf8.DecodeRune(unprintable)\nfmt.Println(r, size, string(r))\nfmt.Printf(\"valid rune? #v\", utf8.ValidRune(r))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>valid? true\nfull rune? true\n65039 3 \ufe0f\nvalid rune? true\n</code></pre>\n\n<p>So, your db is fine, unprintable \"character\" is fine, but NSJSONSerialization can not handle it. Better to ask iOS community =)</p>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 382, "favorite_count": 0, "accepted_answer_id": 37536005, "answer_count": 1, "score": 4, "last_activity_date": 1464665682, "creation_date": 1464655425, "last_edit_date": 1464662040, "question_id": 37535245, "link": "https://stackoverflow.com/questions/37535245/go-is-generating-unescaped-control-characters-in-json-output-due-to-emoji", "title": "Go is generating unescaped control characters in JSON output due to emoji", "body": "<p>I'm having trouble with something in Go and I'm not sure where to look. I'm fetching a UTF-8 string from a MySQL database, and attempting to return it in a JSON response to a client.</p>\n\n<p>Different clients react differently, but iOS <code>NSJSONSerialization</code> returns an \"<strong>Unescaped control character</strong>\" error. This breaks the whole application. I can decode the JSON without issue in Chrome using <code>JSON.parse()</code>, though.</p>\n\n<p>On the server-side, this same generator function written in another language besides Go works fine. Help?</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> Here is the JSON that is causing the issue:</p>\n\n<pre><code>{ \"test\":\"\u262e\ufe0f\" }\n</code></pre>\n\n<p>... If I omit this emoji, it works. If it's there, it doesn't work. The issue seems to be something related to there being two different encodings for certain emoji. One seems to trip up Go, but they are both valid.</p>\n\n<p>To demonstrate the difference in encoding, some of the emoji show up in the database explorer and some do not:</p>\n\n<p><a href=\"https://i.stack.imgur.com/AmaG9.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/AmaG9.png\" alt=\"screenshot\"></a></p>\n\n<p>... These ones that appear in the database explorer are causing this issue with 100% reproducibility. <strong>However, all of them usually appear in the actual client software (not the database explorer) without issue.</strong> I don't know if there's a way to reconfigure the database connection to avoid this (or something), but it seems to work with different instances depending on what is doing the decoding and how forgiving it is. Considering that users could type or copy/paste either encoding... this needs to work consistently.</p>\n\n<p>Any help would be appreciated. Thanks in advance.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1464645165, "post_id": 37533919, "comment_id": 62558347, "body": "<a href=\"https://golang.org/s/go14customimport\" rel=\"nofollow noreferrer\">golang.org/s/go14customimport</a> discusses how <code>go get</code> works with custom domains. All that I can tell here is that the URL corresponding to this package path 404s."}, {"owner": {"reputation": 7800, "user_id": 1144203, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e9563e87ef7289e475f9ffdf6e61081c?s=128&d=identicon&r=PG", "display_name": "ivan.sim", "link": "https://stackoverflow.com/users/1144203/ivan-sim"}, "edited": false, "score": 0, "creation_date": 1464645279, "post_id": 37533919, "comment_id": 62558369, "body": "See if this <a href=\"http://stackoverflow.com/q/27500861/1144203\">post</a> helps."}], "owner": {"reputation": 131, "user_id": 1544890, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/7eb1d11f36c9a950c20bf7840a01b8dc?s=128&d=identicon&r=PG", "display_name": "Fadhel Ghorbel", "link": "https://stackoverflow.com/users/1544890/fadhel-ghorbel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 556, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464644545, "creation_date": 1464644291, "last_edit_date": 1464644545, "question_id": 37533919, "link": "https://stackoverflow.com/questions/37533919/go-get-insecure-my-domain-com", "title": "Go get -insecure my.domain.com", "body": "<p>I have a a Golang Git project.</p>\n\n<p>I tried to use <code>go get -insecure my.domia.com/alerts</code></p>\n\n<p>but i got the fellowing error.</p>\n\n<pre>\nOK: 214 MiB in 23 packages\nFetching https://my.domia.com/alerts?go-get=1\nhttps fetch failed: Get https://my.domia.com/alerts?go-get=1: http: server gave HTTP response to HTTPS client\nFetching http://my.domia.com/alerts?go-get=1\nParsing meta tags from http://my.domia.com/alerts?go-get=1 (status code 404)\npackage my.domia.com/alerts: unrecognized import path \"my.domia.com/alerts\" (parse http://my.domia.com/alerts?go-get=1: no go-import meta tags)\n</pre>\n\n<p>Could any one help please? I really appreciate it.</p>\n\n<p>Or, if anyone could help to install manually. </p>\n\n<p>Thanks,</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1464678902, "post_id": 37532255, "comment_id": 62567819, "body": "&quot;I want to do this {without a loop, in one line, not using a slice, with this filesystem layout, whatever}.&quot; is somehow &quot;un-Go-ish&quot; as Go is heavily opinionated and the complete opposite of &quot;clever&quot;. You have to process several things: Write a loop. You want to accomplish something difficult: Write several lines of code. You want to use the go tool: Stick to the workspace conventions."}, {"owner": {"reputation": 717, "user_id": 4021308, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2nOgU.png?s=128&g=1", "display_name": "Asad-ullah Khan", "link": "https://stackoverflow.com/users/4021308/asad-ullah-khan"}, "edited": false, "score": 1, "creation_date": 1583914497, "post_id": 37532255, "comment_id": 107268251, "body": "If you&#39;ve come here wanting to use a slice as a key to a map, just use <code>fmt.Sprint(arr)</code>, it is fast and works well."}], "answers": [{"comments": [{"owner": {"reputation": 5229, "user_id": 158179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DETF6.jpg?s=128&g=1", "display_name": "N0thing", "link": "https://stackoverflow.com/users/158179/n0thing"}, "edited": false, "score": 0, "creation_date": 1464635536, "post_id": 37532282, "comment_id": 62555014, "body": "fmt.Println(fmt.Sprint(A)) yields <code>[1 2 3]</code>  This does not allow for a custom delimiter..."}, {"owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "reply_to_user": {"reputation": 5229, "user_id": 158179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DETF6.jpg?s=128&g=1", "display_name": "N0thing", "link": "https://stackoverflow.com/users/158179/n0thing"}, "edited": false, "score": 0, "creation_date": 1464635627, "post_id": 37532282, "comment_id": 62555049, "body": "Precisely. Do you need <i>exactly</i> the &quot;1, 2, 3&quot; string?"}, {"owner": {"reputation": 5229, "user_id": 158179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DETF6.jpg?s=128&g=1", "display_name": "N0thing", "link": "https://stackoverflow.com/users/158179/n0thing"}, "edited": false, "score": 0, "creation_date": 1464635655, "post_id": 37532282, "comment_id": 62555062, "body": "Yes, making the question statement a bit more obvious that I need to control what is in between the numbers."}], "tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": false, "score": 4, "last_activity_date": 1464636429, "last_edit_date": 1464636429, "creation_date": 1464635350, "answer_id": 37532282, "question_id": 37532255, "link": "https://stackoverflow.com/questions/37532255/one-liner-to-transform-int-into-string/37532282#37532282", "title": "One-liner to transform []int into string", "body": "<p>I believe that you can go with the <code>fmt.Sprint</code> family of functions. I am not expert in go formatting flags, and maybe you can make it with just a <code>Sprintf</code>, but here's a one-liner that works:</p>\n\n<pre><code>data := []int{1,2,3}\n\nfunc(x string) string { return x[6:len(x)-1]; }(fmt.Sprintf(\"%#v\", data)) // 1, 2, 3\n</code></pre>\n\n<p>In general, you could use <code>strings.Replace</code> to come up with different separators (as long as you can safely replace the <code>,</code> or <code></code> default separator):</p>\n\n<pre><code>// Produces 1--2--3\nmagic := func(s, d string) string { return strings.Replace(s[1:len(s)-1], \" \", d, -1)  }\nfmt.Println(magic(fmt.Sprint([]int{1, 2, 3}), \"--\"))\n\n// As one liner\nfmt.Println(func(s, d string) string { return strings.Replace(s[1:len(s)-1], \" \", d, -1)  }(fmt.Sprint([]int{1, 2, 3}), \"--\"))\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 561, "user_id": 1971322, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4a4f0bd5043481d49174a06a9026dc53?s=128&d=identicon&r=PG", "display_name": "Lideln Kyoku", "link": "https://stackoverflow.com/users/1971322/lideln-kyoku"}, "edited": false, "score": 2, "creation_date": 1513539026, "post_id": 37533144, "comment_id": 82681857, "body": "Nice regression indeed from a clean and simple <code>a.implode(&#39;,&#39;)</code> :-/"}, {"owner": {"reputation": 1781, "user_id": 4515566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bOOZ7.jpg?s=128&g=1", "display_name": "arainone", "link": "https://stackoverflow.com/users/4515566/arainone"}, "reply_to_user": {"reputation": 561, "user_id": 1971322, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4a4f0bd5043481d49174a06a9026dc53?s=128&d=identicon&r=PG", "display_name": "Lideln Kyoku", "link": "https://stackoverflow.com/users/1971322/lideln-kyoku"}, "edited": false, "score": 1, "creation_date": 1526482688, "post_id": 37533144, "comment_id": 87764548, "body": "@LidelnKyoku php&#39;s <code>implode</code>, like python&#39;s <code>join</code>, allow one to do this in an easier way because they are <b>not</b> statically typed. I&#39;m not sure it&#39;s easier than that in other statically typed languages"}, {"owner": {"reputation": 561, "user_id": 1971322, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/4a4f0bd5043481d49174a06a9026dc53?s=128&d=identicon&r=PG", "display_name": "Lideln Kyoku", "link": "https://stackoverflow.com/users/1971322/lideln-kyoku"}, "reply_to_user": {"reputation": 1781, "user_id": 4515566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bOOZ7.jpg?s=128&g=1", "display_name": "arainone", "link": "https://stackoverflow.com/users/4515566/arainone"}, "edited": false, "score": 1, "creation_date": 1526501452, "post_id": 37533144, "comment_id": 87774530, "body": "@arainone I wouldn&#39;t know, but IMHO it should still be (made) possible with some reduce feature or something, like so: <code>a.reduce((ret, item) =&gt; ret + itoa(item) + &#39;,&#39;)</code> (to keep it simple, but not perfect)"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 2, "creation_date": 1546016476, "post_id": 37533144, "comment_id": 94761294, "body": "All the proposed solutions are unnecessarily inefficient."}, {"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1547115547, "post_id": 37533144, "comment_id": 95084178, "body": "@InancGumus Could you please explain why?"}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 3, "creation_date": 1547125384, "post_id": 37533144, "comment_id": 95089686, "body": "@yogesh_desai If you use this function in a hot-path, you&#39;ll witness a lot of unnecessary allocations. Go is explicit and mostly one-liners are not Go style. When you bend idiomatic Go rules, it&#39;s inevitable to witness a lot of headaches later on."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 115, "last_activity_date": 1464641599, "last_edit_date": 1464641599, "creation_date": 1464639584, "answer_id": 37533144, "question_id": 37532255, "link": "https://stackoverflow.com/questions/37532255/one-liner-to-transform-int-into-string/37533144#37533144", "title": "One-liner to transform []int into string", "body": "<p>To convert<br>\n<code>A := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}</code></p>\n\n<p>to a one line delimited string like<br>\n\"1,2,3,4,5,6,7,8,9\"<br>\nuse:</p>\n\n<pre><code>strings.Trim(strings.Join(strings.Fields(fmt.Sprint(A)), delim), \"[]\")\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>strings.Trim(strings.Join(strings.Split(fmt.Sprint(A), \" \"), delim), \"[]\")\n</code></pre>\n\n<p>or:</p>\n\n<pre><code>strings.Trim(strings.Replace(fmt.Sprint(A), \" \", delim, -1), \"[]\")\n</code></pre>\n\n<p>and return it from a function such as in this example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\n\nfunc arrayToString(a []int, delim string) string {\n    return strings.Trim(strings.Replace(fmt.Sprint(a), \" \", delim, -1), \"[]\")\n    //return strings.Trim(strings.Join(strings.Split(fmt.Sprint(a), \" \"), delim), \"[]\")\n    //return strings.Trim(strings.Join(strings.Fields(fmt.Sprint(a)), delim), \"[]\")\n}\n\nfunc main() {\n    A := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}\n\n    fmt.Println(arrayToString(A, \",\")) //1,2,3,4,5,6,7,8,9\n}\n</code></pre>\n\n<p>To include a space after the comma you could call <code>arrayToString(A, \", \")</code> or conversely define the return as <code>return strings.Trim(strings.Replace(fmt.Sprint(a), \" \", delim + \" \", -1), \"[]\")</code> to force its insertion after the delimiter.</p>\n"}, {"comments": [{"owner": {"reputation": 21339, "user_id": 348056, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/577bbd898a44a99ec8cca0b76df6407a?s=128&d=identicon&r=PG", "display_name": "JnBrymn", "link": "https://stackoverflow.com/users/348056/jnbrymn"}, "edited": false, "score": 0, "creation_date": 1578676216, "post_id": 42159097, "comment_id": 105529068, "body": "Did you mean &quot;SliceToString&quot; instead of &quot;SplitToString&quot;?"}], "tags": [], "owner": {"reputation": 699, "user_id": 5215366, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-AHxA6zWr1Ms/AAAAAAAAAAI/AAAAAAAACpA/LR6pkPJOeY4/photo.jpg?sz=128", "display_name": "Andrea Sessa", "link": "https://stackoverflow.com/users/5215366/andrea-sessa"}, "is_accepted": false, "score": 26, "last_activity_date": 1486728715, "creation_date": 1486728715, "answer_id": 42159097, "question_id": 37532255, "link": "https://stackoverflow.com/questions/37532255/one-liner-to-transform-int-into-string/42159097#42159097", "title": "One-liner to transform []int into string", "body": "<p>I've just run into the same problem today, since I've not found anything on standard library, I've recompiled 3 ways to do this conversion</p>\n\n<p>Create a string and appending the values from the array by converting it using strconv.Itoa:</p>\n\n<pre><code>func IntToString1() string {\n    a := []int{1, 2, 3, 4, 5}\n    b := \"\"\n    for _, v := range a {\n        if len(b) &gt; 0 {\n            b += \",\"\n        }\n        b += strconv.Itoa(v)\n    }\n\n    return b\n}\n</code></pre>\n\n<p>Create a []string, convert each array value and then return a joined string from []string:</p>\n\n<pre><code>func IntToString2() string {\n    a := []int{1, 2, 3, 4, 5}\n    b := make([]string, len(a))\n    for i, v := range a {\n        b[i] = strconv.Itoa(v)\n    }\n\n    return strings.Join(b, \",\")\n}\n</code></pre>\n\n<p>Convert the []int to a string and replace / trim the value:</p>\n\n<pre><code>func IntToString3() string {\n    a := []int{1, 2, 3, 4, 5}\n    return strings.Trim(strings.Replace(fmt.Sprint(a), \" \", \",\", -1), \"[]\")\n}\n</code></pre>\n\n<p>Performance is quite different depending on implementation:</p>\n\n<pre><code>BenchmarkIntToString1-12         3000000           539 ns/op\nBenchmarkIntToString2-12         5000000           359 ns/op\nBenchmarkIntToString3-12         1000000          1162 ns/op\n</code></pre>\n\n<p>Personally, I'll go with IntToString2, so the final function could be an util package in my project like this:</p>\n\n<pre><code>func SplitToString(a []int, sep string) string {\n    if len(a) == 0 {\n        return \"\"\n    }\n\n    b := make([]string, len(a))\n    for i, v := range a {\n        b[i] = strconv.Itoa(v)\n    }\n    return strings.Join(b, sep)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 379, "user_id": 6097285, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/caed10d0c712a106142e2bb79a8cd665?s=128&d=identicon&r=PG&f=1", "display_name": "yogesh_desai", "link": "https://stackoverflow.com/users/6097285/yogesh-desai"}, "edited": false, "score": 0, "creation_date": 1547116198, "post_id": 50538159, "comment_id": 95084585, "body": "Is it possible to make it a one-liner?"}], "tags": [], "owner": {"reputation": 4600, "user_id": 1431641, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/P52VH.png?s=128&g=1", "display_name": "Shijing Lv", "link": "https://stackoverflow.com/users/1431641/shijing-lv"}, "is_accepted": false, "score": 8, "last_activity_date": 1589001940, "last_edit_date": 1589001940, "creation_date": 1527292920, "answer_id": 50538159, "question_id": 37532255, "link": "https://stackoverflow.com/questions/37532255/one-liner-to-transform-int-into-string/50538159#50538159", "title": "One-liner to transform []int into string", "body": "<p>You can always <code>json.Marshal</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>data := []int{1,2,3}\ns, _ := json.Marshal(data)\nfmt.Println(string(s))\n// output: [1, 2, 3]\n\nfmt.Println(strings.Trim(string(s), \"[]\"))\n//output 1,2,3\n</code></pre>\n"}], "owner": {"reputation": 5229, "user_id": 158179, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/DETF6.jpg?s=128&g=1", "display_name": "N0thing", "link": "https://stackoverflow.com/users/158179/n0thing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50414, "favorite_count": 14, "accepted_answer_id": 37533144, "answer_count": 4, "score": 51, "last_activity_date": 1589001940, "creation_date": 1464635237, "last_edit_date": 1498039304, "question_id": 37532255, "link": "https://stackoverflow.com/questions/37532255/one-liner-to-transform-int-into-string", "title": "One-liner to transform []int into string", "body": "<p>Basically I have <code>[]int{1, 2, 3}</code>, I want a one-liner that transforms this into the string \"1, 2, 3\" (I need the delimiter to be custom, sometimes <code>.</code>, sometimes <code>,</code>, etc). Below is the best I could come up with. Searched online and did not seem to find a better answer.</p>\n\n<p>In most languages there is in-built support for this, e.g.:</p>\n\n<p>python:</p>\n\n<pre><code>&gt; A = [1, 2, 3]\n&gt; \", \".join([str(a) for a in A])\n'1, 2, 3'\n</code></pre>\n\n<p>go:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"fmt\"\n    \"strconv\"\n)\n\n// Could not find a one-liner that does this :(.\nfunc arrayToString(A []int, delim string) string {\n\n    var buffer bytes.Buffer\n    for i := 0; i &lt; len(A); i++ {\n        buffer.WriteString(strconv.Itoa(A[i]))\n        if i != len(A)-1 {\n            buffer.WriteString(delim)\n        }\n    }\n\n    return buffer.String()\n}\n\nfunc main() {\n    A := []int{1, 2, 3}\n    fmt.Println(arrayToString(A, \", \"))\n}\n</code></pre>\n\n<p>Surely there must be an utility buried into go that allows me to do this with a one-liner?</p>\n\n<p>I know that there is <code>strings.Join(A, \", \")</code>, but that only works if A is already []string.</p>\n"}, {"tags": ["go", "io", "buffer", "beanstalkd"], "answers": [{"comments": [{"owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1464635075, "post_id": 37531472, "comment_id": 62554837, "body": "Thanks for this - <code>reader.Read(&#39;\\n&#39;)</code> was a typo - I corrected question. I have also attached example code of where I have got so far. As you can see, I can get the number of expected bytes of the body. Could you elaborate on why you don&#39;t like the idea of reading a specific number of bytes? This seems most logical?"}, {"owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "reply_to_user": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "edited": false, "score": 0, "creation_date": 1464637487, "post_id": 37531472, "comment_id": 62555719, "body": "Answer added in post."}], "tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": true, "score": 13, "last_activity_date": 1464674852, "last_edit_date": 1464674852, "creation_date": 1464631553, "answer_id": 37531472, "question_id": 37530451, "link": "https://stackoverflow.com/questions/37530451/golang-bufio-read-multiline-until-crlf-r-n-delimiter/37531472#37531472", "title": "golang - bufio read multiline until (CRLF) \\r\\n delimiter", "body": "<blockquote>\n  <p>res, err := this.reader.Read('\\n')</p>\n</blockquote>\n\n<p>Does not make any sense to me. Did you mean ReadBytes/ReadSlice/ReadString?</p>\n\n<p>You need bufio.Scanner.</p>\n\n<p>Define your bufio.SplitFunc (example is a copy of bufio.ScanLines with modifications to look for '\\r\\n'). Modify it to match your case.</p>\n\n<pre><code>// dropCR drops a terminal \\r from the data.\nfunc dropCR(data []byte) []byte {\n    if len(data) &gt; 0 &amp;&amp; data[len(data)-1] == '\\r' {\n        return data[0 : len(data)-1]\n    }\n    return data\n}\n\n\nfunc ScanCRLF(data []byte, atEOF bool) (advance int, token []byte, err error) {\n        if atEOF &amp;&amp; len(data) == 0 {\n            return 0, nil, nil\n        }\n        if i := bytes.Index(data, []byte{'\\r','\\n'}); i &gt;= 0 {\n            // We have a full newline-terminated line.\n            return i + 2, dropCR(data[0:i]), nil\n        }\n        // If we're at EOF, we have a final, non-terminated line. Return it.\n        if atEOF {\n            return len(data), dropCR(data), nil\n        }\n        // Request more data.\n        return 0, nil, nil\n    }\n</code></pre>\n\n<p>Now, wrap your io.Reader with your custom scanner.</p>\n\n<pre><code>scanner := bufio.NewScanner(this.reader)\nscanner.Split(ScanCRLF)\n// Set the split function for the scanning operation.\nscanner.Split(split)\n// Validate the input\nfor scanner.Scan() {\n        fmt.Printf(\"%s\\n\", scanner.Text())\n}\n\nif err := scanner.Err(); err != nil {\n        fmt.Printf(\"Invalid input: %s\", err)\n}\n</code></pre>\n\n<p>Read <a href=\"https://golang.org/pkg/bufio\" rel=\"noreferrer\">bufio package's</a> source code about Scanner.</p>\n\n<blockquote>\n  <p>Alternatively - is there a way of reading a specific number of bytes as specified in  in example response above?</p>\n</blockquote>\n\n<p>First you need to read \"RESERVED  \\r\\n\" line some how.</p>\n\n<p>And then you can use </p>\n\n<pre><code>nr_of_bytes : = read_number_of_butes_somehow(this.reader)\nbuf : = make([]byte, nr_of_bytes)\nthis.reader.Read(buf)\n</code></pre>\n\n<p>or <a href=\"https://golang.org/pkg/io/#LimitedReader\" rel=\"noreferrer\">LimitedReader</a>.</p>\n\n<p>But i dont like this approach.</p>\n\n<blockquote>\n  <p>Thanks for this - reader.Read('\\n') was a typo - I corrected question. I have also attached example code of where I have got so far. As you can see, I can get the number of expected bytes of the body. Could you elaborate on why you don't like the idea of reading a specific number of bytes? This seems most logical?</p>\n</blockquote>\n\n<p>I'd like to see Bean's definition, especially reader's part.\nImagine, this counter is wrong somehow.</p>\n\n<ol>\n<li><p>Its short: you need to find following \"\\r\\n\" and discard everything up to that point? or not? why do you need counter in the first place then?</p></li>\n<li><p>Its bigger then it should be (or even worse its huge!).</p>\n\n<p>2.1 No next message in the reader: fine, read is shorter then expected but its fine.</p>\n\n<p>2.2 There is next message waiting: bah, you read part of it and there is no easy way to recover.</p>\n\n<p>2.3 Its huge: you cant allocate memory even if message is only 1 byte.</p></li>\n</ol>\n\n<p>This byte counters in general are designed to verify the message.\nAnd looks like it is the case with beanstalkd protocol.</p>\n\n<p>Use Scanner, parse message, check length with expected number ... profit</p>\n\n<p><strong>UPD</strong></p>\n\n<p>Be warned, default bufio.Scanner cant read more then 64k, set max length with scanner.Buffer first. And thats bad, because you cant change this option on the fly and some data may have had been \"pre\"-read by scanner.</p>\n\n<p><strong>UPD2</strong></p>\n\n<p>Thinking about my last update. Take a look at <a href=\"https://golang.org/src/net/textproto/reader.go\" rel=\"noreferrer\">net.textproto</a> how it implements dotReader like simple state machine.  You could do something similar with reading command first and \"expected bytes\" checking on payload.</p>\n"}], "owner": {"reputation": 11294, "user_id": 1239122, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/8cf239e31df87733c835e53851283548?s=128&d=identicon&r=PG", "display_name": "Gravy", "link": "https://stackoverflow.com/users/1239122/gravy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9473, "favorite_count": 3, "accepted_answer_id": 37531472, "answer_count": 1, "score": 4, "last_activity_date": 1464674852, "creation_date": 1464626853, "last_edit_date": 1464634880, "question_id": 37530451, "link": "https://stackoverflow.com/questions/37530451/golang-bufio-read-multiline-until-crlf-r-n-delimiter", "title": "golang - bufio read multiline until (CRLF) \\r\\n delimiter", "body": "<p>I am trying to implement my own beanstalkd client as a way of learning go. <a href=\"https://github.com/kr/beanstalkd/blob/master/doc/protocol.txt\" rel=\"nofollow\">https://github.com/kr/beanstalkd/blob/master/doc/protocol.txt</a></p>\n\n<p>At the moment, I am using <code>bufio</code> to read in a line of data delimited by <code>\\n</code>.</p>\n\n<p><code>res, err := this.reader.ReadLine('\\n')</code></p>\n\n<p>This is fine for when I send a single command, and read a a single line response like: <code>INSERTED %d\\r\\n</code> but I find difficulties when I try to reserve a job because the job body could be multiple lines and as such, I cannot use the <code>\\n</code> delimiter.</p>\n\n<p>Is there a way to read into the buffer until <code>CRLF</code>?</p>\n\n<p>e.g. when I send the <code>reserve</code> command. My expected response is as follows:</p>\n\n<pre><code>RESERVED &lt;id&gt; &lt;bytes&gt;\\r\\n\n&lt;data&gt;\\r\\n\n</code></pre>\n\n<p>But data could contain <code>\\n</code>, so I need to read until the <code>\\r\\n</code>.</p>\n\n<p>Alternatively - is there a way of reading a specific number of bytes as specified in <code>&lt;bytes&gt;</code> in example response above?</p>\n\n<p>At the moment, I have (err handling removed):</p>\n\n<pre><code>func (this *Bean) receiveLine() (string, error) {\n    res, err := this.reader.ReadString('\\n')\n    return res, err\n}\n\nfunc (this *Bean) receiveBody(numBytesToRead int) ([]byte, error) {\n    res, err := this.reader.ReadString('\\r\\n') // What to do here to read to CRLF / up to number of expected bytes?\n\n    return res, err\n}\n\nfunc (this *Bean) Reserve() (*Job, error) {\n\n    this.send(\"reserve\\r\\n\")\n    res, err := this.receiveLine()\n\n    var jobId uint64\n    var bodylen int\n    _, err = fmt.Sscanf(res, \"RESERVED %d %d\\r\\n\", &amp;jobId, &amp;bodylen)\n\n    body, err := this.receiveBody(bodylen)\n\n    job := new(Job)\n    job.Id = jobId\n    job.Body = body\n\n    return job, nil\n}\n</code></pre>\n"}, {"tags": ["http", "go", "scale", "net-http"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1464624509, "post_id": 37529511, "comment_id": 62550471, "body": "You may tweak / customize the HTTP server by creating / configuring your own <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow noreferrer\"><code>http.Server</code></a> (read its doc for details). The package doc of <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\"><code>net&#47;http</code></a> contains an example of this. Also, incoming HTTP requests are handled concurrently, by creating a new service goroutine for each, as documented at <a href=\"https://golang.org/pkg/net/http/#Server.Serve\" rel=\"nofollow noreferrer\"><code>Server.Serve()</code></a>."}, {"owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464626616, "post_id": 37529511, "comment_id": 62551342, "body": "@icza Thank you! +1 for useful information.  However, I&#39;m not 100% sure I follow on the http.Server comments.  The docs (seem to?) say I can configure a/an Addr, Handler, ReadTimeout, WriteTimeout, MaxHeaderBytes, TLSConfig, TLSNextProto, ConnState, and ErrorLog.  I don&#39;t see anything about process management there. Am I missing something, or were you just recommending a good place to start in general?"}], "answers": [{"comments": [{"owner": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "edited": false, "score": 0, "creation_date": 1556705665, "post_id": 37531953, "comment_id": 98521957, "body": "Can you please show an example of selective limiting an handler. I am looking for the same as one of the handler is resource expensive and want to limit it say 5 concurrent request."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 825, "user_id": 570200, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/c1f1eb2f77f0fc96d61e5d2252b179dc?s=128&d=identicon&r=PG", "display_name": "Abhinav", "link": "https://stackoverflow.com/users/570200/abhinav"}, "edited": false, "score": 0, "creation_date": 1556707052, "post_id": 37531953, "comment_id": 98522465, "body": "@Abhinav Simply in the rate-limiting middleware where you know the nature of the request, if rate limiting is required, send on the channel, then call the handler, then receive from the channel. If no rate limiting is required, just call the handler without sending on / receiving from the channel."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 14, "last_activity_date": 1521027543, "last_edit_date": 1521027543, "creation_date": 1464633746, "answer_id": 37531953, "question_id": 37529511, "link": "https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver/37531953#37531953", "title": "Process Management for the Go Webserver", "body": "<h3>Tweaking / configuring the HTTP server</h3>\n\n<p>The type that implements the HTTP server is <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"noreferrer\"><code>http.Server</code></a>. If you don't create an <code>http.Server</code> yourself e.g. because you call the <a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"noreferrer\"><code>http.ListenAndServe()</code></a> function, that creates an <code>http.Server</code> under the hood for you:</p>\n\n<pre><code>func ListenAndServe(addr string, handler Handler) error {\n    server := &amp;Server{Addr: addr, Handler: handler}\n    return server.ListenAndServe()\n}\n</code></pre>\n\n<p>So if you want to tweek / customize the HTTP server, then create one yourself and call its <a href=\"https://golang.org/pkg/net/http/#Server.ListenAndServe\" rel=\"noreferrer\"><code>Server.ListenAndServe()</code></a> method yourself. <code>http.Server</code> is a struct, its zero value is a valid configuration. See its doc what fields it has and so what you can tweak / configure.</p>\n\n<p>The \"Process Management\" of the HTTP server is documented at <a href=\"https://golang.org/pkg/net/http/#Server.Serve\" rel=\"noreferrer\"><code>Server.Serve()</code></a>:</p>\n\n<blockquote>\n  <p>Serve accepts incoming connections on the Listener l, <strong>creating a new service goroutine for each</strong>. The service goroutines read requests and then call srv.Handler to reply to them. Serve always returns a non-nil error.</p>\n</blockquote>\n\n<p>So each incoming HTTP request is handled in its new goroutine, meaning they are served concurrently. Unfortunately the API does not document any way to jump in and change how this works.</p>\n\n<p>And looking at the current implementation (Go 1.6.2), there is also no undocumented way to do that. <a href=\"https://golang.org/src/net/http/server.go?s=63385:63431#L2097\" rel=\"noreferrer\"><code>server.go</code>, currently line #2107-2139</a>:</p>\n\n<pre><code>2107    func (srv *Server) Serve(l net.Listener) error {\n2108        defer l.Close()\n2109        if fn := testHookServerServe; fn != nil {\n2110            fn(srv, l)\n2111        }\n2112        var tempDelay time.Duration // how long to sleep on accept failure\n2113        if err := srv.setupHTTP2(); err != nil {\n2114            return err\n2115        }\n2116        for {\n2117            rw, e := l.Accept()\n2118            if e != nil {\n2119                if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {\n2120                    if tempDelay == 0 {\n2121                        tempDelay = 5 * time.Millisecond\n2122                    } else {\n2123                        tempDelay *= 2\n2124                    }\n2125                    if max := 1 * time.Second; tempDelay &gt; max {\n2126                        tempDelay = max\n2127                    }\n2128                    srv.logf(\"http: Accept error: %v; retrying in %v\", e, tempDelay)\n2129                    time.Sleep(tempDelay)\n2130                    continue\n2131                }\n2132                return e\n2133            }\n2134            tempDelay = 0\n2135            c := srv.newConn(rw)\n2136            c.setState(c.rwc, StateNew) // before Serve can return\n2137            go c.serve()\n2138        }\n2139    }\n</code></pre>\n\n<p>As you can see in line #2137, the connection is served <em>unconditionally</em> on a new goroutine, so there's nothing you can do about that.</p>\n\n<h3>Limiting the \"worker\" goroutines</h3>\n\n<p>If you want to limit the number of goroutines serving requests, you can still do it.</p>\n\n<p>You may limit them on multiple levels. For limiting on the listener level, see Darigaaz's answer. To limit on the Handler level, read on.</p>\n\n<p>For example you could insert a code to each of your <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"noreferrer\"><code>http.Handler</code></a> or handler functions (<a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"noreferrer\"><code>http.HandlerFunc</code></a>) which only proceeds if the number of concurrent request serving goroutines are less than a specified limit.</p>\n\n<p>There are numerous constructs to such limiting-synchronization code. One example could be: create a buffered channel with capacity being your desired limit. Each handler should first send a value on this channel, and then do the work. When the handler returns, it must receive a value from the channel: so it's best done in a deferred function (not to forget to \"clean\" itself).</p>\n\n<p>If the buffer is full, a new request attempting to send on the channel will block: wait until a request finishes its work.</p>\n\n<p>Note that you don't have to inject this limiting code to all your handlers, you may use a \"middleware\" pattern, a new handler type which wraps your handlers, does this limiting-synchronization job, and calls the wrapped handler in the middle of it.</p>\n\n<p>The advantage of limiting in the handler (as opposed to limiting in Listeners) is that in the handler we know what the handler does, so we can do <em>selective</em> limiting (e.g. we may choose to limit certain requests such as database operations, and not to limit others like serving static resources) or we can create <em>multiple, distinct limit groups</em> arbitrarily to our needs (e.g. limit concurrent db requests to 10 max, limit static requests to 100 max, limit heavy computational requests to 3 max) etc. We can also easily realize limitations like unlimited (or high limit) for logged-in / paying users, and low limit for anonymous / non-paying users.</p>\n\n<p>Also note that you can even do the rate-limiting in a single place, without using middlewares. Create a \"main handler\", and pass that to <code>http.ListenAndServe()</code> (or <code>Server.ListenAndServe()</code>). In this main handler do the rate limiting (e.g. using a buffered channel as mentioned above), and simply forward the call to the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"noreferrer\"><code>http.ServeMux</code></a> you're using.</p>\n\n<p>Here's a simple example which uses <code>http.ListenAndServe()</code> and the default  multiplexer of the <code>http</code> package (<code>http.DefaultServeMux</code>) for demonstration. It limits concurrent requests to 2:</p>\n\n<pre><code>func fooHandler(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"Foo called...\")\n    time.Sleep(3 * time.Second)\n    w.Write([]byte(\"I'm Foo\"))\n    log.Println(\"Foo ended.\")\n}\n\nfunc barHandler(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"Bar called...\")\n    time.Sleep(3 * time.Second)\n    w.Write([]byte(\"I'm Bar\"))\n    log.Println(\"Bar ended.\")\n}\n\nvar ch = make(chan struct{}, 2) // 2 concurrent requests\n\nfunc mainHandler(w http.ResponseWriter, r *http.Request) {\n    ch &lt;- struct{}{}\n    defer func() {\n        &lt;-ch\n    }()\n\n    http.DefaultServeMux.ServeHTTP(w, r)\n}\n\nfunc main() {\n    http.HandleFunc(\"/foo\", fooHandler)\n    http.HandleFunc(\"/bar\", barHandler)\n\n    panic(http.ListenAndServe(\":8080\", http.HandlerFunc(mainHandler)))\n}\n</code></pre>\n\n<h3>Deployment</h3>\n\n<p>Web applications written in Go do not require external servers to control processes, as the Go webserver itself handles requests concurrently.</p>\n\n<p>So you may start your webserver written in Go as-is: the Go webserver is production ready.</p>\n\n<p>You may of course use other servers for additional tasks if you wish so (e.g. HTTPS handling, authentication / authorization, routing, load balancing between multiple servers).</p>\n"}, {"tags": [], "owner": {"reputation": 1216, "user_id": 6248842, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84403e264482ffd6f4ac8c8eee99f122?s=128&d=identicon&r=PG", "display_name": "Darigaaz", "link": "https://stackoverflow.com/users/6248842/darigaaz"}, "is_accepted": false, "score": 5, "last_activity_date": 1470220116, "last_edit_date": 1470220116, "creation_date": 1464634360, "answer_id": 37532087, "question_id": 37529511, "link": "https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver/37532087#37532087", "title": "Process Management for the Go Webserver", "body": "<p><code>ListenAndServe</code> starts an HTTP server with a given address and handler. The handler is usually nil, which means to use <code>DefaultServeMux</code>. Handle and <code>HandleFunc</code> add handlers to <code>DefaultServeMux</code>.</p>\n\n<p>Look at <a href=\"https://golang.org/pkg/net/http/#Server\" rel=\"nofollow\">http.Server</a>, alot of fields are optional and works fine with default values.</p>\n\n<p>Now lets look at <a href=\"https://golang.org/src/net/http/server.go?s=65528:65583#L2183\" rel=\"nofollow\">http.ListenAndServe</a>, is not hard at all</p>\n\n<pre><code>func ListenAndServe(addr string, handler Handler) error {\n    server := &amp;Server{Addr: addr, Handler: handler}\n    return server.ListenAndServe()\n}\n</code></pre>\n\n<p>so the default server is super simple to create.</p>\n\n<pre><code>func (srv *Server) ListenAndServe() error {\n    addr := srv.Addr\n    if addr == \"\" {\n        addr = \":http\"\n    }\n    ln, err := net.Listen(\"tcp\", addr)\n    if err != nil {\n        return err\n    }\n    return srv.Serve(tcpKeepAliveListener{ln.(*net.TCPListener)})\n }\n\nfunc (srv *Server) Serve(l net.Listener) error {\n    defer l.Close()\n    if fn := testHookServerServe; fn != nil {\n        fn(srv, l)\n    }\n    var tempDelay time.Duration // how long to sleep on accept failure\n    if err := srv.setupHTTP2(); err != nil {\n        return err\n    }\n    for {\n        rw, e := l.Accept()\n        if e != nil {\n            if ne, ok := e.(net.Error); ok &amp;&amp; ne.Temporary() {\n                if tempDelay == 0 {\n                    tempDelay = 5 * time.Millisecond\n                } else {\n                    tempDelay *= 2\n                }\n                if max := 1 * time.Second; tempDelay &gt; max {\n                    tempDelay = max\n                }\n                srv.logf(\"http: Accept error: %v; retrying in %v\", e, tempDelay)\n                time.Sleep(tempDelay)\n                continue\n            }\n            return e\n        }\n        tempDelay = 0\n        c := srv.newConn(rw)\n        c.setState(c.rwc, StateNew) // before Serve can return\n        go c.serve()\n    }\n}\n</code></pre>\n\n<p>It Listen on \"addr\" and Accept every connection, then it spawns a goroutine to handle each connection independently. (HTTP/2.0 is a little bit different, but is the same in general).</p>\n\n<p>If you want to control connections you have 2 options:</p>\n\n<ol>\n<li><p>Create custom server (its 3 lines of code) with server.<a href=\"https://golang.org/pkg/net/http/#ConnState\" rel=\"nofollow\">ConnState</a> callback and control client connections from there. (but they will be Accepted by kernel anyway)</p></li>\n<li><p>Create custom server with your own implementation of <code>net.Listener</code> (like <code>LimitedListener</code>) and control connections from there, this way you will have ultimate power over connections.</p></li>\n</ol>\n\n<p>Since default <code>http.Server</code> has no way to be stopped the second way is the only way to gracefully terminate listener. You can combine two methods to implement different strategies, well its been done <a href=\"https://www.google.ru/search?q=golang%20http%20graceful\" rel=\"nofollow\">already</a>.</p>\n"}], "owner": {"reputation": 156951, "user_id": 4668, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/e5abe1d27b286199c319b0cbe75596c3?s=128&d=identicon&r=PG", "display_name": "Alan Storm", "link": "https://stackoverflow.com/users/4668/alan-storm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2705, "favorite_count": 3, "accepted_answer_id": 37531953, "answer_count": 2, "score": 14, "last_activity_date": 1521027543, "creation_date": 1464623061, "last_edit_date": 1470219921, "question_id": 37529511, "link": "https://stackoverflow.com/questions/37529511/process-management-for-the-go-webserver", "title": "Process Management for the Go Webserver", "body": "<p>I'm a new Go programmer, coming from the world of web application and service development.  Apologies is this is a herp de-derp question, but my googling around for an answer hasn't found anything. Also, this is borderline Server Fault territory, but since I'm more interested in the APIs/programmatic interfaces I'm asking here. </p>\n\n<p>I've written a small go program using the <code>net/http</code> package's built-in web server.  I'm getting ready to deploy to production, but I'm a little unclear on the process of model go Go's web-server and how I should deploy. </p>\n\n<p>Specifically -- in the environments I'm used to (PHP, Ruby, Python) we have a web server (Apache, Nginx, etc.) sitting in front of our application, and we configure these web servers to use a certain number of worker processes/threads, and configure how many individual HTTP(S) connections each thread should process.  </p>\n\n<p>I haven't been able to find information on how Go's web-server handles this, or practical information on how to scale/plan-for-scale for a Go web server.  </p>\n\n<p>i.e. -- if I have a simple program running, ready to handle an HTTP request</p>\n\n<pre><code>func main() {\n   http.HandleFunc(\"/\", processRequest)\n   http.ListenAndServe(\":8000\", nil)    \n}\n</code></pre>\n\n<p>how many connections will <code>HandleFunc</code> try to handle at once?  Or will it start blocking when a connection opens, and only serve the next connection once the connection closes?  </p>\n\n<p>Or should I just not worry about this and jam everything into a go routine? But if I do that how do I prevent the system from becoming bogged down by too many threads of execution?</p>\n\n<p>I'm basically trying to </p>\n\n<ol>\n<li>Understand the process mode of the go web server</li>\n<li>Find the built-in features of go for tweaking this, and/or whatever standard package folks are using </li>\n</ol>\n\n<p>Like I said, I'm very new to go, so if I'm completely missing the plot on this please let me know!</p>\n"}, {"tags": ["image", "go", "gif", "animated-gif"], "comments": [{"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 3, "creation_date": 1464630856, "post_id": 37529227, "comment_id": 62553045, "body": "Try saving the file as-is, instead of re-encoding it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1464634909, "post_id": 37529227, "comment_id": 62554776, "body": "You&#39;re only decoding the first frame. From the documentation: &quot;Decode reads a GIF image from r and returns the first embedded image as an image.Image&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": true, "score": 2, "last_activity_date": 1464722222, "last_edit_date": 1464722222, "creation_date": 1464721224, "answer_id": 37553627, "question_id": 37529227, "link": "https://stackoverflow.com/questions/37529227/go-image-upload/37553627#37553627", "title": "Go image upload", "body": "<p>As hinted in the comments, you are just working with one frame:</p>\n\n<blockquote>\n  <p><code>func Decode(r io.Reader) (image.Image, error)</code> Decode reads a GIF image\n  from r and returns the <strong>first embedded image</strong> as an image.Image.</p>\n</blockquote>\n\n<p>But you need </p>\n\n<blockquote>\n  <p>func DecodeAll(r io.Reader) (*GIF, error) DecodeAll reads a GIF image\n  from r and returns the sequential frames and timing information.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p><code>func EncodeAll(w io.Writer, g *GIF) error</code> EncodeAll writes the images\n  in g to w in GIF format with the given loop count and delay between\n  frames.</p>\n</blockquote>\n\n<p>Look at <a href=\"http://tech.nitoyon.com/en/blog/2016/01/07/go-animated-gif-gen/\" rel=\"nofollow noreferrer\">this post</a> for details.</p>\n\n<p>Here's an example that slows down the image to 0.5s each frame:</p>\n\n<pre><code>package main\n\nimport (\n    \"image/gif\"\n    \"os\"\n)\n\nfunc main() {\n    logo, err := os.Open(\"yay.gif\")\n    if err != nil {\n        panic(err)\n    }\n    defer logo.Close()\n\n    inGif, err := gif.DecodeAll(logo)\n    if err != nil {\n        panic(err)\n    }\n\n    outGif, err := os.Create(\"done.gif\")\n    if err != nil {\n        panic(err)\n    }\n    defer outGif.Close()\n\n    for i := range inGif.Delay {\n        inGif.Delay[i] = 50\n    }\n    if err := gif.EncodeAll(outGif, inGif); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Results:</p>\n\n<p><a href=\"https://i.stack.imgur.com/LfImG.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/LfImG.gif\" alt=\"Original Image\"></a>\n<a href=\"https://i.stack.imgur.com/UgAdv.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/UgAdv.gif\" alt=\"Slowed-down version\"></a></p>\n\n<h1>Side note</h1>\n\n<p>Even if in my browser (Firefox) I see the output image animated, and I can see the the frames in The GIMP, I cannot see it animated on my desktop viewers (gifview, comix). I do not know (yet) what is the cause of this.</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 717, "favorite_count": 0, "accepted_answer_id": 37553627, "answer_count": 1, "score": 2, "last_activity_date": 1464773525, "creation_date": 1464622025, "last_edit_date": 1464773525, "question_id": 37529227, "link": "https://stackoverflow.com/questions/37529227/go-image-upload", "title": "Go image upload", "body": "<p>I am currently uploading an image to my server doing the following:</p>\n\n<pre><code>func (base *GuildController) GuildLogo(w http.ResponseWriter, req *http.Request, ps httprouter.Params) {\n    ...\n    logo, _, err := req.FormFile(\"logo\")\n    defer logo.Close()\n    logoGif, format, err := image.Decode(logo)\n    if err != nil {\n        base.Error = \"Error while decoding your guild logo\"\n        return\n    }\n    logoImage, err := os.Create(pigo.Config.String(\"template\")+\"/public/guilds/\"+ps.ByName(\"name\")+\".gif\")\n    if err != nil {\n        base.Error = \"Error while trying to open guild logo image\"\n        return\n    }\n    defer logoImage.Close()\n    //resizedLogo := resize.Resize(64, 64, logoGif, resize.Lanczos3)\n    err = gif.Encode(logoImage, logoGif, &amp;gif.Options{\n        256,\n        nil,\n        nil,\n    })\n    if err != nil {\n        base.Error = \"Error while encoding your guild logo\"\n        return\n    }\n    ...\n}\n</code></pre>\n\n<p>So everything is working good. But gifs lose the animation.</p>\n\n<p>For example here is a gif I want to upload</p>\n\n<p><a href=\"https://i.stack.imgur.com/K3A0s.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/K3A0s.gif\" alt=\"enter image description here\"></a></p>\n\n<p>And here is the saved one</p>\n\n<p><a href=\"https://i.stack.imgur.com/0J7Gl.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/0J7Gl.gif\" alt=\"enter image description here\"></a></p>\n\n<p>Not sure what I am doing wrong</p>\n"}, {"tags": ["python", "amazon-web-services", "elasticsearch", "go"], "answers": [{"comments": [{"owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464688670, "post_id": 37529249, "comment_id": 62574015, "body": "Hello, Thanks for response. I got an error, please check the question, i updated it!"}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "reply_to_user": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464693409, "post_id": 37529249, "comment_id": 62577111, "body": "Oh, <code>missing</code> is not yet available in 1.5.2 it only appeared in 1.6. Sorry my bad."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "reply_to_user": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464694047, "post_id": 37529249, "comment_id": 62577515, "body": "Is upgrading to 1.6 an option?"}, {"owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464694680, "post_id": 37529249, "comment_id": 62577939, "body": "Does AWS let you upgrade ? Only solution i can see is to create EC2 instance and install es there."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "reply_to_user": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464697592, "post_id": 37529249, "comment_id": 62579970, "body": "Yes, it&#39;s an easy way out."}], "tags": [], "owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "is_accepted": false, "score": 2, "last_activity_date": 1464622118, "creation_date": 1464622118, "answer_id": 37529249, "question_id": 37529203, "link": "https://stackoverflow.com/questions/37529203/elasticsearch-field-value-factor-missing-parameter/37529249#37529249", "title": "Elasticsearch - field_value_factor, missing parameter", "body": "<p>In at least one document, the field <code>lang_en</code> is null, empty or simply non-existent.</p>\n\n<p>You need to modify your <code>field_value_factor</code> function in order to tell it what to do in such as case, by using the <code>missing</code> setting with whatever default value makes sense (0, 1, etc):</p>\n\n<pre><code>{\n    \"field_value_factor\": {\n         \"field\": \"lang_en\",\n         \"missing\": 1                &lt;---- add this line\n    }\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1464694745, "post_id": 37544683, "comment_id": 62577988, "body": "You&#39;ll still need to add the <code>missing</code> parameter to your query, upgrading alone is not sufficient, hence my answer still stands."}, {"owner": {"reputation": 163519, "user_id": 4604579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/reC2t.jpg?s=128&g=1", "display_name": "Val", "link": "https://stackoverflow.com/users/4604579/val"}, "edited": false, "score": 0, "creation_date": 1464697997, "post_id": 37544683, "comment_id": 62580262, "body": "Glad we figured it out."}], "tags": [], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "is_accepted": true, "score": 1, "last_activity_date": 1464694647, "creation_date": 1464694647, "answer_id": 37544683, "question_id": 37529203, "link": "https://stackoverflow.com/questions/37529203/elasticsearch-field-value-factor-missing-parameter/37544683#37544683", "title": "Elasticsearch - field_value_factor, missing parameter", "body": "<p>The problem was with the dumb AWS ES version 1.5.2.</p>\n\n<p>My solution: Create EC2 instance and deploy Elasticsearch manualy.</p>\n"}], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 954, "favorite_count": 2, "accepted_answer_id": 37544683, "answer_count": 2, "score": 0, "last_activity_date": 1464694647, "creation_date": 1464621917, "last_edit_date": 1464688635, "question_id": 37529203, "link": "https://stackoverflow.com/questions/37529203/elasticsearch-field-value-factor-missing-parameter", "title": "Elasticsearch - field_value_factor, missing parameter", "body": "<p>So i finally have setup the elasticsearch database and imported data into it.</p>\n\n<p>Sometimes when i try to request data from frontend, i get 500 error( not all the time, just sometimes ).</p>\n\n<p>I tried to request data from POSTMAN( to see the ES error message ).</p>\n\n<p>I got:</p>\n\n<pre><code>{\n  \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[9m4uVcf3TLmQ9Kr7z_fSpQ][text][0]: QueryPhaseExecutionException[[text][0]: query[filtered(function score (blended(terms: [url_words:test, domain_words:test, title:test, body:test]), functions: [{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@56319fc9]}{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@60b46f02]}]))-&gt;cache(_type:page)],from[0],size[25]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[Missing value for field [lang_en]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][1]: QueryPhaseExecutionException[[text][1]: query[filtered(function score (blended(terms: [url_words:test, domain_words:test, title:test, body:test]), functions: [{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@3ca7d41e]}{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@63daf999]}]))-&gt;cache(_type:page)],from[0],size[25]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[Missing value for field [lang_en]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][2]: QueryPhaseExecutionException[[text][2]: query[filtered(function score (blended(terms: [url_words:test, domain_words:test, title:test, body:test]), functions: [{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@27521539]}{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@66dbac2b]}]))-&gt;cache(_type:page)],from[0],size[25]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[Missing value for field [lang_en]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][3]: QueryPhaseExecutionException[[text][3]: query[filtered(function score (blended(terms: [url_words:test, domain_words:test, title:test, body:test]), functions: [{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@73bb4f5e]}{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@112dcf1c]}]))-&gt;cache(_type:page)],from[0],size[25]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[Missing value for field [lang_en]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][4]: QueryPhaseExecutionException[[text][4]: query[filtered(function score (blended(terms: [url_words:test, domain_words:test, title:test, body:test]), functions: [{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@b650549]}{filter(*:*), function [org.elasticsearch.common.lucene.search.function.FieldValueFactorFunction@7fbe90f4]}]))-&gt;cache(_type:page)],from[0],size[25]: Query Failed [Failed to execute main query]]; nested: ElasticsearchException[Missing value for field [lang_en]]; }]\",\n  \"status\": 500\n}\n</code></pre>\n\n<p>Here is the request body:</p>\n\n<pre><code>{\n      \"query\": {\n        \"function_score\": {\n          \"query\": {\n            \"multi_match\": {\n              \"query\": \"test\",\n              \"minimum_should_match\": \"-25%\",\n              \"type\": \"cross_fields\",\n                  \"tie_breaker\": 0.5,\n                  \"fields\": [\"title^3\", \"body\", \"url_words^2\", \"domain_words^8\"]\n            }\n\n          },\n          \"functions\": [{\n                \"field_value_factor\": {\n              \"field\": \"rank\",\n              \"factor\": 1\n            }\n        },{\n                        \"field_value_factor\": {\n                \"field\": \"lang_en\"\n            }\n                }]\n        }\n      },\n      \"from\": 0,\n      \"size\": 25\n    }\n</code></pre>\n\n<p>I understand that Missing value for field [lang_en] is the problem. I toyed around es with google results, but without success.</p>\n\n<p>ES version: 1.5.2</p>\n\n<p>Any ideas ?</p>\n\n<p>EDIT:</p>\n\n<p>I added \"missing\": 0, to second <code>field_value_factor</code>, but i got this error instead:</p>\n\n<pre><code>{\n  \"error\": \"SearchPhaseExecutionException[Failed to execute phase [query], all shards failed; shardFailures {[9m4uVcf3TLmQ9Kr7z_fSpQ][text][0]: SearchParseException[[text][0]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n      \\\"query\\\": {\\n        \\\"function_score\\\": {\\n          \\\"query\\\": {\\n            \\\"multi_match\\\": {\\n              \\\"query\\\": \\\"test\\\",\\n              \\\"minimum_should_match\\\": \\\"-25%\\\",\\n              \\\"type\\\": \\\"cross_fields\\\",\\n                  \\\"tie_breaker\\\": 0.5,\\n                  \\\"fields\\\": [\\\"title^3\\\", \\\"body\\\", \\\"url_words^2\\\", \\\"domain_words^8\\\"]\\n            }\\n\\n          },\\n          \\\"functions\\\": [{\\n                \\\"field_value_factor\\\": {\\n              \\\"field\\\": \\\"rank\\\",\\n              \\\"factor\\\": 1\\n            }\\n        },{\\n                        \\\"field_value_factor\\\": {\\n                \\\"field\\\": \\\"lang_en\\\",\\n                \\\"missing\\\": 0\\n            }\\n                }]\\n        }\\n      },\\n      \\\"from\\\": 0,\\n      \\\"size\\\": 25\\n    }\\n]]]; nested: QueryParsingException[[text] field_value_factor query does not support [missing]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][1]: SearchParseException[[text][1]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n      \\\"query\\\": {\\n        \\\"function_score\\\": {\\n          \\\"query\\\": {\\n            \\\"multi_match\\\": {\\n              \\\"query\\\": \\\"test\\\",\\n              \\\"minimum_should_match\\\": \\\"-25%\\\",\\n              \\\"type\\\": \\\"cross_fields\\\",\\n                  \\\"tie_breaker\\\": 0.5,\\n                  \\\"fields\\\": [\\\"title^3\\\", \\\"body\\\", \\\"url_words^2\\\", \\\"domain_words^8\\\"]\\n            }\\n\\n          },\\n          \\\"functions\\\": [{\\n                \\\"field_value_factor\\\": {\\n              \\\"field\\\": \\\"rank\\\",\\n              \\\"factor\\\": 1\\n            }\\n        },{\\n                        \\\"field_value_factor\\\": {\\n                \\\"field\\\": \\\"lang_en\\\",\\n                \\\"missing\\\": 0\\n            }\\n                }]\\n        }\\n      },\\n      \\\"from\\\": 0,\\n      \\\"size\\\": 25\\n    }\\n]]]; nested: QueryParsingException[[text] field_value_factor query does not support [missing]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][2]: SearchParseException[[text][2]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n      \\\"query\\\": {\\n        \\\"function_score\\\": {\\n          \\\"query\\\": {\\n            \\\"multi_match\\\": {\\n              \\\"query\\\": \\\"test\\\",\\n              \\\"minimum_should_match\\\": \\\"-25%\\\",\\n              \\\"type\\\": \\\"cross_fields\\\",\\n                  \\\"tie_breaker\\\": 0.5,\\n                  \\\"fields\\\": [\\\"title^3\\\", \\\"body\\\", \\\"url_words^2\\\", \\\"domain_words^8\\\"]\\n            }\\n\\n          },\\n          \\\"functions\\\": [{\\n                \\\"field_value_factor\\\": {\\n              \\\"field\\\": \\\"rank\\\",\\n              \\\"factor\\\": 1\\n            }\\n        },{\\n                        \\\"field_value_factor\\\": {\\n                \\\"field\\\": \\\"lang_en\\\",\\n                \\\"missing\\\": 0\\n            }\\n                }]\\n        }\\n      },\\n      \\\"from\\\": 0,\\n      \\\"size\\\": 25\\n    }\\n]]]; nested: QueryParsingException[[text] field_value_factor query does not support [missing]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][3]: SearchParseException[[text][3]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n      \\\"query\\\": {\\n        \\\"function_score\\\": {\\n          \\\"query\\\": {\\n            \\\"multi_match\\\": {\\n              \\\"query\\\": \\\"test\\\",\\n              \\\"minimum_should_match\\\": \\\"-25%\\\",\\n              \\\"type\\\": \\\"cross_fields\\\",\\n                  \\\"tie_breaker\\\": 0.5,\\n                  \\\"fields\\\": [\\\"title^3\\\", \\\"body\\\", \\\"url_words^2\\\", \\\"domain_words^8\\\"]\\n            }\\n\\n          },\\n          \\\"functions\\\": [{\\n                \\\"field_value_factor\\\": {\\n              \\\"field\\\": \\\"rank\\\",\\n              \\\"factor\\\": 1\\n            }\\n        },{\\n                        \\\"field_value_factor\\\": {\\n                \\\"field\\\": \\\"lang_en\\\",\\n                \\\"missing\\\": 0\\n            }\\n                }]\\n        }\\n      },\\n      \\\"from\\\": 0,\\n      \\\"size\\\": 25\\n    }\\n]]]; nested: QueryParsingException[[text] field_value_factor query does not support [missing]]; }{[9m4uVcf3TLmQ9Kr7z_fSpQ][text][4]: SearchParseException[[text][4]: from[-1],size[-1]: Parse Failure [Failed to parse source [{\\n      \\\"query\\\": {\\n        \\\"function_score\\\": {\\n          \\\"query\\\": {\\n            \\\"multi_match\\\": {\\n              \\\"query\\\": \\\"test\\\",\\n              \\\"minimum_should_match\\\": \\\"-25%\\\",\\n              \\\"type\\\": \\\"cross_fields\\\",\\n                  \\\"tie_breaker\\\": 0.5,\\n                  \\\"fields\\\": [\\\"title^3\\\", \\\"body\\\", \\\"url_words^2\\\", \\\"domain_words^8\\\"]\\n            }\\n\\n          },\\n          \\\"functions\\\": [{\\n                \\\"field_value_factor\\\": {\\n              \\\"field\\\": \\\"rank\\\",\\n              \\\"factor\\\": 1\\n            }\\n        },{\\n                        \\\"field_value_factor\\\": {\\n                \\\"field\\\": \\\"lang_en\\\",\\n                \\\"missing\\\": 0\\n            }\\n                }]\\n        }\\n      },\\n      \\\"from\\\": 0,\\n      \\\"size\\\": 25\\n    }\\n]]]; nested: QueryParsingException[[text] field_value_factor query does not support [missing]]; }]\",\n  \"status\": 400\n}\n</code></pre>\n"}, {"tags": ["go", "message-queue"], "answers": [{"tags": [], "owner": {"reputation": 101, "user_id": 276354, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea379ae84d8493303e3fb77d2017d724?s=128&d=identicon&r=PG", "display_name": "derek", "link": "https://stackoverflow.com/users/276354/derek"}, "is_accepted": true, "score": 1, "last_activity_date": 1464696283, "creation_date": 1464696283, "answer_id": 37545283, "question_id": 37526679, "link": "https://stackoverflow.com/questions/37526679/using-nats-queuing-in-a-request-reply-manner/37545283#37545283", "title": "Using NATS Queuing in a Request/Reply Manner", "body": "<p>Yes, this is by design and allows you to easily scale the group of receivers.</p>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 37545283, "answer_count": 1, "score": 1, "last_activity_date": 1464696283, "creation_date": 1464614231, "question_id": 37526679, "link": "https://stackoverflow.com/questions/37526679/using-nats-queuing-in-a-request-reply-manner", "title": "Using NATS Queuing in a Request/Reply Manner", "body": "<p>Using <a href=\"http://nats.io/\" rel=\"nofollow\">NATS.IO</a> message queue; Is it OK to send messages in a request/reply manner (using <code>nc.Request(...)</code>) but subscribe in a queue manner (using <code>nc.QueueSubscribe(...)</code> and reply from there?</p>\n"}, {"tags": ["php", "go", "rpc"], "comments": [{"owner": {"reputation": 4007, "user_id": 616398, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/83e5ba145326da0edcc404bfff584df5?s=128&d=identicon&r=PG", "display_name": "Gerben Jacobs", "link": "https://stackoverflow.com/users/616398/gerben-jacobs"}, "edited": false, "score": 1, "creation_date": 1464612235, "post_id": 37525928, "comment_id": 62543517, "body": "There is no way to directly talk with PHP. Options you have are creating a Golang API that runs somewhere and then use either PHP Curl or Javascript AJAX to get the information."}], "answers": [{"comments": [{"owner": {"reputation": 1364, "user_id": 313754, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01b3e7f117dfdbd060d35d8527ea342b?s=128&d=identicon&r=PG", "display_name": "Bactisme", "link": "https://stackoverflow.com/users/313754/bactisme"}, "edited": false, "score": 0, "creation_date": 1464613343, "post_id": 37526304, "comment_id": 62544178, "body": "Very close to the queue pattern, there are &quot;in-memory databases / in-memory caches&quot; like Memcache or Redis. The last one, redis, is very efficient at managing queue messaging job response via queue commands (lpush, rpop etc.)."}], "tags": [], "owner": {"reputation": 1447, "user_id": 6316030, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Du1DJ.jpg?s=128&g=1", "display_name": "Maxim Tkach", "link": "https://stackoverflow.com/users/6316030/maxim-tkach"}, "is_accepted": true, "score": 7, "last_activity_date": 1464613139, "creation_date": 1464613139, "answer_id": 37526304, "question_id": 37525928, "link": "https://stackoverflow.com/questions/37525928/communication-between-php-golang/37526304#37526304", "title": "Communication between PHP &amp; Golang", "body": "<p>The best solution is to use the socket. Any other \"patterns\" would use a socket.\nFor example you can use to interact ZMQ processes. ZMQ will give you access to the low level sockets at a high (socket on steroids).</p>\n\n<p>Using the database - will not be considered as an asynchronous solution, but it can also be used.... \n<em>It should be based on the available resources and tasks.</em></p>\n\n<p><a href=\"http://zeromq.org/bindings:php\" rel=\"noreferrer\">ZMQ PHP binding</a></p>\n\n<p><a href=\"http://zeromq.org/bindings:go\" rel=\"noreferrer\">ZMQ Go Binding</a></p>\n\n<p>P.S. I had an experience combining php + Erlang. So my solution - universally.</p>\n"}, {"tags": [], "owner": {"reputation": 1039, "user_id": 1212212, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/56a83aaf801b8ec28e4f1ba3b3806091?s=128&d=identicon&r=PG", "display_name": "user1212212", "link": "https://stackoverflow.com/users/1212212/user1212212"}, "is_accepted": false, "score": 0, "last_activity_date": 1467956332, "last_edit_date": 1467956332, "creation_date": 1467955787, "answer_id": 38259469, "question_id": 37525928, "link": "https://stackoverflow.com/questions/37525928/communication-between-php-golang/38259469#38259469", "title": "Communication between PHP &amp; Golang", "body": "<p>A few lines of GoLang can trivially create an HTTP server. Using the Echo framework on-top of this will make for a fast way to interact with a long-standing process. </p>\n\n<p>From there, PHP can send it requests.</p>\n\n<p>As you port your application, the web clients can hit the server directly, using CORS. Ex:\n  <strong>www.site.com</strong> getting content from <strong>golang.site.com</strong></p>\n\n<p><strong>Optional:</strong> \n  The GoLang webserver has a CGI package (FastCGI offered by others) that you could use to run PHP code from GoLang code, but the chore of converting your Apache configuration may make this impractical.  </p>\n\n<p>Either way you'll have an idiomatic server producing lightning-fast responses. </p>\n"}, {"tags": [], "owner": {"reputation": 115, "user_id": 6620063, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/1360546147295482/picture?type=large", "display_name": "Suthat", "link": "https://stackoverflow.com/users/6620063/suthat"}, "is_accepted": false, "score": 2, "last_activity_date": 1469108495, "creation_date": 1469108495, "answer_id": 38505939, "question_id": 37525928, "link": "https://stackoverflow.com/questions/37525928/communication-between-php-golang/38505939#38505939", "title": "Communication between PHP &amp; Golang", "body": "<p>You can start building a simple REST server in Golang, which return JSON as a general format as follows: \n<a href=\"http://www.alexedwards.net/blog/golang-response-snippets\" rel=\"nofollow\">http://www.alexedwards.net/blog/golang-response-snippets</a></p>\n\n<p>In the PHP side, say APIs request, you can use cURL to send a simple request to call REST server as follows:\n<a href=\"http://codular.com/curl-with-php\" rel=\"nofollow\">http://codular.com/curl-with-php</a></p>\n\n<p>As you can a simple REST APIs in Golang that return some JSON data, it allows you to use almost of the modern programming languages to communicate and make interoperability with your REST APIs such as Javascript, Java, Python, Ruby and so on.    </p>\n"}], "owner": {"reputation": 167, "user_id": 4113727, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/275d48c4fa0e83ce25ac652f78d3be17?s=128&d=identicon&r=PG&f=1", "display_name": "Anthony Pradal", "link": "https://stackoverflow.com/users/4113727/anthony-pradal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7148, "favorite_count": 1, "closed_date": 1471513463, "accepted_answer_id": 37526304, "answer_count": 3, "score": 3, "last_activity_date": 1469108495, "creation_date": 1464612019, "question_id": 37525928, "link": "https://stackoverflow.com/questions/37525928/communication-between-php-golang", "closed_reason": "Needs more focus", "title": "Communication between PHP &amp; Golang", "body": "<p>I would like to start to use golang. To do that, I gave me a little project. I already have a website (classical php, mysql, css, html). </p>\n\n<p>I would like to export some traitment to a golang script. (like calculate Pi.).</p>\n\n<p>Actually, when I click on a button, a PHP algo do the job. Is there a best practice to use php and golang.</p>\n\n<p>I was thinking about socket. (server golang, client php) or a database. But it will be result with a lot a SQL requests.</p>\n\n<p>I hope you will help me,</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "floating-point", "reinforcement-learning", "q-learning"], "answers": [{"comments": [{"owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "edited": false, "score": 0, "creation_date": 1464716443, "post_id": 37536185, "comment_id": 62593037, "body": "That was an interesting point which I totally missed. I did try using different values when the game continues: Anything higher than <code>-0.45</code> results to the same problem, and lower values produce negative rewards for all state-actions (maximum value = 0) and the agent still fails to win. Any thoughts?"}, {"owner": {"reputation": 4910, "user_id": 3782161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bIAr4.jpg?s=128&g=1", "display_name": "Pablo EM", "link": "https://stackoverflow.com/users/3782161/pablo-em"}, "edited": false, "score": 1, "creation_date": 1464767151, "post_id": 37536185, "comment_id": 62612606, "body": "This issue can be related with an undesired optimal policy or behaviour, but not justifies the divergence of the Q-values..."}, {"owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "edited": false, "score": 0, "creation_date": 1464810893, "post_id": 37536185, "comment_id": 62642164, "body": "Thanks Nick, that edit really helped me see what Pablo was trying to say! I used a python implementation from github as a source to be able to make sense of this, but apparently I chose the wrong one and took too much of it!"}], "tags": [], "owner": {"reputation": 769, "user_id": 1497463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/661108b9ec73342b9313d2a2bfaebfe4?s=128&d=identicon&r=PG", "display_name": "Nick Walker", "link": "https://stackoverflow.com/users/1497463/nick-walker"}, "is_accepted": false, "score": 3, "last_activity_date": 1464663778, "creation_date": 1464663778, "answer_id": 37536185, "question_id": 37524472, "link": "https://stackoverflow.com/questions/37524472/q-learning-values-get-too-high/37536185#37536185", "title": "Q-Learning values get too high", "body": "<p>The reward function is likely the problem. Reinforcement learning methods try to maximize the <strong>expected total reward</strong>; it gets a positive reward for every time step in the game, so the optimal policy is to play as long as possible! The q-values, which define the <em>value function</em> (expected total reward of taking an action in a state then behaving optimally) are growing because the correct expectation is unbounded. To incentivize winning, you should have a negative reward every time step (kind of like telling the agent to hurry up and win).</p>\n\n<p>See 3.2 Goals and Rewards in <em>Reinforcement Learning: An Introduction</em> for more insight into the purpose and definition of reward signals. The problem you are facing is actually exercise 3.5 in the book.</p>\n"}, {"comments": [{"owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "edited": false, "score": 0, "creation_date": 1464805523, "post_id": 37561698, "comment_id": 62639386, "body": "It may very well be that I chose the wrong source to learn from. In the current system <code>prevScore = value of (s, a)</code>, <code>reward = value of (s&#39;, a&#39;)</code>"}, {"owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "edited": false, "score": 2, "creation_date": 1464806001, "post_id": 37561698, "comment_id": 62639673, "body": "and <code>reward</code> is often a big number (value), not <code>{-1, 0, 1}</code>. I think I see the problem now!"}, {"owner": {"reputation": 1158, "user_id": 5374400, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/a2kAn.jpg?s=128&g=1", "display_name": "Ehsan Jeihani", "link": "https://stackoverflow.com/users/5374400/ehsan-jeihani"}, "edited": false, "score": 0, "creation_date": 1480630020, "post_id": 37561698, "comment_id": 69054674, "body": "ye chand sal dir soaleta didam."}, {"owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "reply_to_user": {"reputation": 1158, "user_id": 5374400, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/a2kAn.jpg?s=128&g=1", "display_name": "Ehsan Jeihani", "link": "https://stackoverflow.com/users/5374400/ehsan-jeihani"}, "edited": false, "score": 0, "creation_date": 1480633123, "post_id": 37561698, "comment_id": 69056062, "body": "@EhsanJeihani It had me for a couple of days! Really fun when I got it to work though"}], "tags": [], "owner": {"reputation": 4910, "user_id": 3782161, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/bIAr4.jpg?s=128&g=1", "display_name": "Pablo EM", "link": "https://stackoverflow.com/users/3782161/pablo-em"}, "is_accepted": true, "score": 1, "last_activity_date": 1464764863, "creation_date": 1464764863, "answer_id": 37561698, "question_id": 37524472, "link": "https://stackoverflow.com/questions/37524472/q-learning-values-get-too-high/37561698#37561698", "title": "Q-Learning values get too high", "body": "<p>If I've understood well, in your Q-learning update rule, you are using the current reward and the previous reward. However, the Q-learning rule only uses one reward (<code>x</code> are states and <code>u</code> are actions):\n<a href=\"https://i.stack.imgur.com/1Rtd2.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/1Rtd2.png\" alt=\"enter image description here\"></a></p>\n\n<p>On the other hand, you are assuming that the current reward is the same that <code>Qmax</code> value, which is not true. So probably you are misunderstanding the Q-learning algorithm.</p>\n"}], "owner": {"reputation": 435, "user_id": 717221, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/bc60d2404a2cfd43c27a7c9d4da6bde3?s=128&d=identicon&r=PG", "display_name": "Fardin K.", "link": "https://stackoverflow.com/users/717221/fardin-k"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2228, "favorite_count": 2, "accepted_answer_id": 37561698, "answer_count": 2, "score": 4, "last_activity_date": 1464810633, "creation_date": 1464607475, "last_edit_date": 1464810633, "question_id": 37524472, "link": "https://stackoverflow.com/questions/37524472/q-learning-values-get-too-high", "title": "Q-Learning values get too high", "body": "<p>I've recently made an attempt to implement a basic Q-Learning algorithm in Golang. Note that I'm new to Reinforcement Learning and AI in general, so the error may very well be mine.</p>\n\n<p>Here's how I implemented the solution to an m,n,k-game environment:\nAt each given time <code>t</code>, the agent holds the last state-action <code>(s, a)</code> and the acquired reward for it; the agent selects a move <code>a'</code> based on an Epsilon-greedy policy and calculates the reward <code>r</code>, then proceeds to update the value of <code>Q(s, a)</code> for time <code>t-1</code></p>\n\n<pre><code>func (agent *RLAgent) learn(reward float64) {\n    var mState = marshallState(agent.prevState, agent.id)\n    var oldVal = agent.values[mState]\n\n    agent.values[mState] = oldVal + (agent.LearningRate *\n        (agent.prevScore + (agent.DiscountFactor * reward) - oldVal))\n}\n</code></pre>\n\n<p>Note:</p>\n\n<ul>\n<li><code>agent.prevState</code> holds previous state right after taking the action and before the environment responds (i.e. after the agent makes it's move and before the other player makes a move) I use that in place of the state-action tuple, but I'm not quite sure if that's the right approach</li>\n<li><code>agent.prevScore</code> holds the reward to previous state-action</li>\n<li>The <code>reward</code> argument represents the reward for current step's state-action (<code>Qmax</code>)</li>\n</ul>\n\n<p>With <code>agent.LearningRate = 0.2</code> and <code>agent.DiscountFactor = 0.8</code> the agent fails to reach 100K episodes because of state-action value overflow.\nI'm using golang's <code>float64</code> (Standard IEEE 754-1985 double precision floating point variable) which overflows at around <code>\u00b11.80\u00d710^308</code> and yields <code>\u00b1Infiniti</code>. That's too big a value I'd say!</p>\n\n<p>Here's the state of a model trained with a learning rate of <code>0.02</code> and a discount factor of <code>0.08</code> which got through 2M episodes (1M games with itself):</p>\n\n<pre><code>Reinforcement learning model report\nIterations: 2000000\nLearned states: 4973\nMaximum value: 88781786878142287058992045692178302709335321375413536179603017129368394119653322992958428880260210391115335655910912645569618040471973513955473468092393367618971462560382976.000000\nMinimum value: 0.000000\n</code></pre>\n\n<p>The reward function returns:</p>\n\n<ul>\n<li>Agent won: 1</li>\n<li>Agent lost: -1</li>\n<li>Draw: 0</li>\n<li>Game continues: 0.5</li>\n</ul>\n\n<p>But you can see that the minimum value is zero, and the maximum value is too high.</p>\n\n<p>It may be worth mentioning that with a simpler learning method I found in a python script works perfectly fine and feels actually more intelligent! When I play with it, most of the time the result is a draw (it even wins if I play carelessly), whereas with the standard Q-Learning method, I can't even let it win!</p>\n\n<pre><code>agent.values[mState] = oldVal + (agent.LearningRate * (reward - agent.prevScore))\n</code></pre>\n\n<p>Any ideas on how to fix this?\nIs that kind of state-action value normal in Q-Learning?!</p>\n\n<hr>\n\n<p><strong>Update:</strong>\nAfter reading Pablo's answer and the slight but important edit that Nick provided to this question, I realized the problem was <code>prevScore</code> containing the Q-value of previous step (equal to <code>oldVal</code>) instead of the reward of the previous step (in this example, -1, 0, 0.5 or 1).</p>\n\n<p>After that change, the agent now behaves normally and after 2M episodes, the state of the model is as follows:</p>\n\n<pre><code>Reinforcement learning model report\nIterations: 2000000\nLearned states: 5477\nMaximum value: 1.090465\nMinimum value: -0.554718\n</code></pre>\n\n<p>and out of 5 games with the agent, there were 2 wins for me (the agent did not recognize that I had two stones in a row) and 3 draws.</p>\n"}, {"tags": ["go", "gmail-api"], "comments": [{"owner": {"reputation": 20315, "user_id": 963881, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e82a2a2b9ddf6fb580a9c34b2eca65f4?s=128&d=identicon&r=PG&f=1", "display_name": "syntagma", "link": "https://stackoverflow.com/users/963881/syntagma"}, "edited": false, "score": 0, "creation_date": 1464621579, "post_id": 37523884, "comment_id": 62548874, "body": "You should try sending the whole message (including attachement, with proper headers) inside <code>message.Raw</code> without using the <code>Media()</code> method. I have had some success with it but did not use the proper headers, so I won&#39;t post any working code."}], "answers": [{"comments": [{"owner": {"reputation": 25, "user_id": 3562428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0e5b84ae85f163e68f65bc00090ac2?s=128&d=identicon&r=PG&f=1", "display_name": "mlmireles", "link": "https://stackoverflow.com/users/3562428/mlmireles"}, "edited": false, "score": 0, "creation_date": 1513371862, "post_id": 47837967, "comment_id": 82643663, "body": "I know I need to mark as duplicate but don&#39;t have the reputation yet"}, {"owner": {"reputation": 74, "user_id": 3357984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c7263d56135694c5f1f362759782f3b1?s=128&d=identicon&r=PG&f=1", "display_name": "not_fubar_yet", "link": "https://stackoverflow.com/users/3357984/not-fubar-yet"}, "edited": false, "score": 0, "creation_date": 1598197473, "post_id": 47837967, "comment_id": 112372875, "body": "Is there a way by using access token? the <a href=\"https://github.com/jordan-wright/email\" rel=\"nofollow noreferrer\">github.com/jordan-wright/email</a> method requires the user&#39;s password"}], "tags": [], "owner": {"reputation": 25, "user_id": 3562428, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ea0e5b84ae85f163e68f65bc00090ac2?s=128&d=identicon&r=PG&f=1", "display_name": "mlmireles", "link": "https://stackoverflow.com/users/3562428/mlmireles"}, "is_accepted": false, "score": 0, "last_activity_date": 1513362476, "creation_date": 1513362476, "answer_id": 47837967, "question_id": 37523884, "link": "https://stackoverflow.com/questions/37523884/send-email-with-attachment-using-gmail-api-in-golang/47837967#47837967", "title": "send email with attachment using gmail API in golang", "body": "<p>I were having the same issue, after long time reading find a library that support attachments <a href=\"https://github.com/jordan-wright/email\" rel=\"nofollow noreferrer\">https://github.com/jordan-wright/email</a> </p>\n"}], "owner": {"reputation": 73, "user_id": 2216582, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/64vkC.jpg?s=128&g=1", "display_name": "Uttam", "link": "https://stackoverflow.com/users/2216582/uttam"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3178, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1513362476, "creation_date": 1464605590, "question_id": 37523884, "link": "https://stackoverflow.com/questions/37523884/send-email-with-attachment-using-gmail-api-in-golang", "title": "send email with attachment using gmail API in golang", "body": "<p>I have followed <a href=\"https://developers.google.com/gmail/api/quickstart/go\" rel=\"nofollow\">https://developers.google.com/gmail/api/quickstart/go</a>. I modified the scope to gmail.MailGoogleComScope and tried sending email. The email gets sent. However, the attachment is not getting sent. It does not give any error as well. Please note the call to Media function is what I tried looking at the code in gmail API, not sure if that is the right way.</p>\n\n<p>When I set the contentType to application/png, the API throws an exception with the message 'png not supported, use message/rfc822'. Following is the code for SendEmail.</p>\n\n<pre><code>func SendEmail(msg EmailMessage) {\n  ctx := context.Background()\n\n  b, err := ioutil.ReadFile(\"/tmp/client_secret.json\")\n  if err != nil {\n    log.Fatalf(\"Unable to read client secret file: %v\", err)\n  }\n\n  config, err := google.ConfigFromJSON(b, gmail.MailGoogleComScope)\n  if err != nil {\n    log.Fatalf(\"Unable to parse client secret file to config: %v\", err)\n  }\n  client := getClient(ctx, config)\n\n  srv, err := gmail.New(client)\n  if err != nil {\n    log.Fatalf(\"Unable to retrieve gmail Client %v\", err)\n  }\n\n  var message gmail.Message\n  temp := []byte(\"From: 'me'\\r\\n\" +\n    \"reply-to: sender@gmail.com\\r\\n\" +\n    \"To:  \" + msg.To + \"\\r\\n\" +\n    \"Subject: \" + msg.Subject + \"\\r\\n\" +\n    \"\\r\\n\" + msg.Body)\n\n  message.Raw = base64.StdEncoding.EncodeToString(temp)\n  message.Raw = strings.Replace(message.Raw, \"/\", \"_\", -1)\n  message.Raw = strings.Replace(message.Raw, \"+\", \"-\", -1)\n  message.Raw = strings.Replace(message.Raw, \"=\", \"\", -1)\n\n  imgFile, err := os.Open(\"image.png\") // a QR code image\n\n  if err != nil {\n    log.Fatalf(\"Error in opening file\")\n  }\n  defer imgFile.Close()\n\n  mediaOptions := googleapi.ContentType(\"message/rfc822\")\n  _, err = srv.Users.Messages.Send(\"me\", &amp;message).Media(imgFile,  mediaOptions).Do()\n  if err != nil {\n    log.Fatalf(\"Unable to send. %v\", err)\n  }\n}\n</code></pre>\n\n<p>Please suggest what is missing</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "edited": false, "score": 0, "creation_date": 1464601203, "post_id": 37522286, "comment_id": 62536738, "body": "How do you count a goroutine that starts and finishes before doWork returns?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1464603287, "post_id": 37522286, "comment_id": 62538024, "body": "You may use <a href=\"https://golang.org/pkg/runtime/#NumGoroutine\" rel=\"nofollow noreferrer\"><code>runtime.NumGoroutine()</code></a> to query the number of goroutines that currently exist. It may help if you can restrict not to launch new goroutines in other parts of your code (and not to finish any meanwhile), else it won&#39;t be &quot;accurate&quot; (it won&#39;t be what you want). You won&#39;t get better help than that unless the caller gives you more &quot;insight&quot;. And actually you shouldn&#39;t care. Correctness of your code should not depend on how many goroutines are calling it: it&#39;s either <i>safe</i> for concurrent use (and then it doesn&#39;t matter), or not."}, {"owner": {"reputation": 1572, "user_id": 638488, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/mmEHj.png?s=128&g=1", "display_name": "J&#248;rgen", "link": "https://stackoverflow.com/users/638488/j%c3%b8rgen"}, "edited": false, "score": 0, "creation_date": 1464681896, "post_id": 37522286, "comment_id": 62569646, "body": "What are you trying to achieve? Do you really want to know the count or are you just want to control them? Because that you can better do with channels or a syncgroup"}, {"owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "edited": false, "score": 0, "creation_date": 1464682075, "post_id": 37522286, "comment_id": 62569759, "body": "I want to count the goroutine number, it&#39;s part of my metrics"}], "answers": [{"tags": [], "owner": {"reputation": 9811, "user_id": 168717, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/851da71d0192b0e34ac44dd6c98c31d2?s=128&d=identicon&r=PG", "display_name": "AkiRoss", "link": "https://stackoverflow.com/users/168717/akiross"}, "is_accepted": false, "score": 1, "last_activity_date": 1464892253, "creation_date": 1464892253, "answer_id": 37599598, "question_id": 37522286, "link": "https://stackoverflow.com/questions/37522286/golang-calculate-how-many-goroutines-are-started-by-worker-itself/37599598#37599598", "title": "Golang: calculate how many goroutines are started by worker itself?", "body": "<p><code>runtime.NumGoroutines()</code> should give you a global number, so let's assume you cannot rely on that and you need to count how many goroutines were started by this specific procedure, and not the possibly more complex application.</p>\n\n<p>One solution could be, as you stated, using a global counter. Remember that there are races in this case, therefore you are better using synchronization methods, for example by using <a href=\"https://gobyexample.com/atomic-counters\" rel=\"nofollow\">atomic operations</a>.</p>\n\n<p>Personally, I do not love globals, therefore a solution that I'd like more could be to use a closure to produce a pair (function, countingvariable) by using a maker function (untested code):</p>\n\n<pre><code>func makeCounted(n int) ([]uint64, func(int)) {\n    var counters []uint64 = make([]uint64, n)\n    return counters, func(i int) {\n        atomic.AddUint64(&amp;counters[i], 1)\n        fmt.Println(\"Doing stuff\")\n    }\n}\n\nhowMany, doWork := makeCounted()\nParallelize(workers, doWork)\n</code></pre>\n\n<p>In the case in which <code>n</code> is unknown (<code>len(dataSet)</code> is unknown), you will have to grow dynamically the size of counters, but you will probably need something like <code>sync.Mutex</code>.</p>\n"}], "owner": {"reputation": 3680, "user_id": 1813875, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6078165a3f6a8693a0b1a1101e9260c7?s=128&d=identicon&r=PG", "display_name": "harryz", "link": "https://stackoverflow.com/users/1813875/harryz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1334, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1464892253, "creation_date": 1464600837, "last_edit_date": 1464616083, "question_id": 37522286, "link": "https://stackoverflow.com/questions/37522286/golang-calculate-how-many-goroutines-are-started-by-worker-itself", "title": "Golang: calculate how many goroutines are started by worker itself?", "body": "<p>Here is my problem: a caller will create several goroutines to run my code <code>doWork</code>,</p>\n\n<pre><code>go func() {\n    for data := range dataSet {\n        doWork(data)\n    }\n}()\n</code></pre>\n\n<p>And now, I want to count how many goroutines are started to do this work, though I can not modify or read data from the caller. How can I achieve this?</p>\n\n<p>[update] <code>doWork</code> is passed to caller, for example:</p>\n\n<pre><code>   doWork := func(i int) {\n        testArray[i]++\n        ...\n    }\n\n   Parallelize(workerNumber, doWork)\n</code></pre>\n\n<p>So I am planning to use a global variable as counter.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1464602141, "post_id": 37521389, "comment_id": 62537289, "body": "Do not call it &quot;subpackage&quot;, not even mentally. There is no real notion of &quot;sub&quot;-package. Package have to live somewhere and these directories are nested in the filesystem. But this filesystem nesting has no meaning on how you use, import and access the packages. (Nitpick: The go tool treats some filesystem folders like vendor, internal or testdata special and has a notion of subpackage)."}], "answers": [{"tags": [], "owner": {"reputation": 779, "user_id": 2112388, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/dc29826ccf22e30922806b2a655c84fa?s=128&d=identicon&r=PG", "display_name": "Christiaan", "link": "https://stackoverflow.com/users/2112388/christiaan"}, "is_accepted": false, "score": 2, "last_activity_date": 1464598294, "creation_date": 1464598294, "answer_id": 37521455, "question_id": 37521389, "link": "https://stackoverflow.com/questions/37521389/go-subpackage-functions-not-imported-properly/37521455#37521455", "title": "Go subpackage functions not imported properly", "body": "<p>When you import a package it will be made available under its name.</p>\n\n<p>To address Somefunc in your main.go you have to do</p>\n\n<p><code>subpackage.Somefunc()</code></p>\n"}, {"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 8, "last_activity_date": 1464598776, "creation_date": 1464598776, "answer_id": 37521609, "question_id": 37521389, "link": "https://stackoverflow.com/questions/37521389/go-subpackage-functions-not-imported-properly/37521609#37521609", "title": "Go subpackage functions not imported properly", "body": "<p>You have to prefix the function by the name of the package is belongs to: <code>subpackage.Somefunc()</code>.</p>\n\n<p>In the case you have several subpackages with the same name, you have to alias them while importing them, or there will be a conflict:</p>\n\n<pre><code>import (\n    xapi \"x/xx/xxx/api\"\n    yapi \"y/yy/yyy/api\"\n)\n</code></pre>\n"}], "owner": {"reputation": 1765, "user_id": 602488, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c8875a43793df9aa50a3cacf0e00a5df?s=128&d=identicon&r=PG", "display_name": "Esben", "link": "https://stackoverflow.com/users/602488/esben"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 647, "favorite_count": 0, "accepted_answer_id": 37521609, "answer_count": 2, "score": -1, "last_activity_date": 1464598776, "creation_date": 1464598140, "question_id": 37521389, "link": "https://stackoverflow.com/questions/37521389/go-subpackage-functions-not-imported-properly", "title": "Go subpackage functions not imported properly", "body": "<p>Trying to wrap my head around packages in Golang.</p>\n\n<p>This is my workspace</p>\n\n<pre><code>/bin\n/pkg\n/src\n  /github.com\n    /esbenp\n      /testrepo\n        /subpackage\n          somefuncs.go\n        main.go\n</code></pre>\n\n<p><strong>main.go</strong></p>\n\n<pre><code>package main\n\nimport \"github.com/esbenp/testrepo/subpackage\"\n\nfunc main() {\n  Somefunc()\n}\n</code></pre>\n\n<p><strong>somefuncs.go</strong></p>\n\n<pre><code>package subpackage\n\nimport \"fmt\"\n\nfunc Somefunc() {\n  fmt.Printf(\"yo\")\n}\n</code></pre>\n\n<p>I was under the impression that since <code>Somefunc</code> starts with an uppercase letter it would be exported for use in other files that imported it. The ouput I get in the console is.</p>\n\n<pre><code>main.go:4: imported and not used: \"github.com/esbenp/testrepo/subpackage\"\nmain.go:8: undefined: Somefunc\n</code></pre>\n\n<p>Can someone point me in the right direction?</p>\n"}, {"tags": ["string", "go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 2384, "user_id": 1105556, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d797c593d0bc643c7bbcacfb6c4fa7da?s=128&d=identicon&r=PG", "display_name": "Sudhakar", "link": "https://stackoverflow.com/users/1105556/sudhakar"}, "edited": false, "score": 0, "creation_date": 1464594637, "post_id": 37520048, "comment_id": 62533205, "body": "Thank you for the detailed info."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1464593979, "last_edit_date": 1464593979, "creation_date": 1464593658, "answer_id": 37520048, "question_id": 37519927, "link": "https://stackoverflow.com/questions/37519927/go-channel-takes-each-letter-as-string-instead-of-the-whole-string/37520048#37520048", "title": "Go channel takes each letter as string instead of the whole string", "body": "<p>Your code sends <code>string</code>s on the channel properly:</p>\n\n<pre><code>func doStuff(s string, ch chan string){\n    ch &lt;- s\n}\n</code></pre>\n\n<p>The problem is at the receiver side:</p>\n\n<pre><code>results := &lt;- c\n\nfmt.Println(\"channel size = \", len(results))\n\n// print the items in channel\nfor _,r := range results {\n  fmt.Println(string(r))\n}\n</code></pre>\n\n<p><code>results</code> will be a <em>single</em> value received from the channel (the first value sent on it). And you print the length of this <code>string</code>.</p>\n\n<p>Then you loop over this string (<code>results</code>) using a <code>for range</code> which loops over its <code>rune</code>s, and you print those.</p>\n\n<p>What you want is loop over the values of the channel:</p>\n\n<pre><code>// print the items in channel\nfor s := range c {\n    fmt.Println(s)\n}\n</code></pre>\n\n<p>This when run will result in a runtime panic:</p>\n\n<pre><code>fatal error: all goroutines are asleep - deadlock!\n</code></pre>\n\n<p>Because you never close the channel, and a <code>for range</code> on a channel runs until the channel is closed. So you have to close the channel sometime.</p>\n\n<p>For example let's wait 1 second, then close it:</p>\n\n<pre><code>go func() {\n    time.Sleep(time.Second)\n    close(c)\n}()\n</code></pre>\n\n<p>This way your app will run and quit after 1 second. Try it on the <kbd><a href=\"https://play.golang.org/p/RbWSMwRCu2\" rel=\"nofollow\">Go Playground</a></kbd>.</p>\n\n<p>Another, nicer solution is to use <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow\"><code>sync.WaitGroup</code></a>: this waits until all goroutines are done doing their work (sending a value on the channel), then it closes the channel (so there is no unnecessary wait / delay).</p>\n\n<pre><code>var wg = sync.WaitGroup{}\n\nfunc doStuff(s string, ch chan string) {\n    ch &lt;- s\n    wg.Done()\n}\n\n// And in main():\nfor i := 0; i &lt; len(loops); i++ {\n    wg.Add(1)\n    go doStuff(\"helloooo\", c)\n}\ngo func() {\n    wg.Wait()\n    close(c)\n}()\n</code></pre>\n\n<p>Try this one on the <kbd><a href=\"https://play.golang.org/p/Tu4bFqBoHM\" rel=\"nofollow\">Go Playground</a></kbd>.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>To repeat something 5 times, you don't need that ugly <code>loops</code> array. Simply do:</p>\n\n<pre><code>for i := 0; i &lt; 5; i++ {\n    // Do something\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 0, "last_activity_date": 1464594129, "creation_date": 1464594129, "answer_id": 37520171, "question_id": 37519927, "link": "https://stackoverflow.com/questions/37519927/go-channel-takes-each-letter-as-string-instead-of-the-whole-string/37520171#37520171", "title": "Go channel takes each letter as string instead of the whole string", "body": "<p>The reason you are getting back the letters instead of string is that you are assigning the channel result to a variable and iterating over the result of the channel assigned to this variable which in your case is a string, and in Go you can iterate over a string with a <code>for range</code> loop to get the runes.</p>\n\n<p>You can simply print the channel without to iterate over the channel result.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc doStuff(s string, ch chan string){\n    ch &lt;- s\n}\n\nfunc main() {\n    c := make(chan string)\n    loops := [5]int{1,2,3,4,5}\n\n    for i := 0; i &lt; len(loops) ; i++ {\n       go doStuff(\"helloooo\", c)    \n    }\n\n    results := &lt;- c \n    fmt.Println(\"channel size = \", len(results))\n    fmt.Println(results) // will print helloooo\n}\n</code></pre>\n"}], "owner": {"reputation": 2384, "user_id": 1105556, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/d797c593d0bc643c7bbcacfb6c4fa7da?s=128&d=identicon&r=PG", "display_name": "Sudhakar", "link": "https://stackoverflow.com/users/1105556/sudhakar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "accepted_answer_id": 37520048, "answer_count": 2, "score": 2, "last_activity_date": 1464594972, "creation_date": 1464593260, "last_edit_date": 1464594972, "question_id": 37519927, "link": "https://stackoverflow.com/questions/37519927/go-channel-takes-each-letter-as-string-instead-of-the-whole-string", "title": "Go channel takes each letter as string instead of the whole string", "body": "<p>I'm creating a simple channel that takes string values. But apparently I'm pushing each letter in the string instead of the whole string in each loop.</p>\n\n<p>I'm probably missing something very fundamental. What am I doing wrong ?</p>\n\n<p><a href=\"https://play.golang.org/p/-6E-f7ALbD\" rel=\"nofollow\">https://play.golang.org/p/-6E-f7ALbD</a></p>\n\n<p>Code:</p>\n\n<pre><code>func doStuff(s string, ch chan string) {\n    ch &lt;- s\n}\n\nfunc main() {\n    c := make(chan string)\n    loops := [5]int{1, 2, 3, 4, 5}\n\n    for i := 0; i &lt; len(loops); i++ {\n        go doStuff(\"helloooo\", c)\n    }\n\n    results := &lt;-c\n\n    fmt.Println(\"channel size = \", len(results))\n\n    // print the items in channel\n    for _, r := range results {\n        fmt.Println(string(r))\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 1, "creation_date": 1464584490, "post_id": 37517620, "comment_id": 62528928, "body": "You need to use <a href=\"https://golang.org/pkg/archive/zip/#FileHeader.ModTime\" rel=\"nofollow noreferrer\">golang.org/pkg/archive/zip/#FileHeader.ModTime</a> Or file header. What&#39;s the code that you are using?"}, {"owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "reply_to_user": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464615138, "post_id": 37517620, "comment_id": 62545244, "body": "@khrm: So you basically create a FileHeader and populate it with the values you want and then pass it to CreateHeader? I wondering if there is a way to copy over the values(besides copying one element at a time) from the file being zipped to the FileHeader variable..."}, {"owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464617929, "post_id": 37517620, "comment_id": 62546848, "body": "Can you share your code snippet?"}, {"owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "reply_to_user": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "edited": false, "score": 0, "creation_date": 1464623480, "post_id": 37517620, "comment_id": 62549926, "body": "I think I found what I&#39;m looking for, I the zip package they include a function func FileInfoHeader(fi os.FileInfo) (*FileHeader, error) which does exactly what I want."}], "answers": [{"tags": [], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "is_accepted": false, "score": 0, "last_activity_date": 1464623624, "creation_date": 1464623624, "answer_id": 37529666, "question_id": 37517620, "link": "https://stackoverflow.com/questions/37517620/golang-zip-package-modified-time-defaults-to-30-november-1979-0000/37529666#37529666", "title": "Golang: Zip Package Modified Time Defaults to 30 November 1979, 00:00", "body": "<p>I found this function which does what I was looking for: func FileInfoHeader(fi os.FileInfo) (*FileHeader, error). This will take an input data file and create a partially filled FileHeader.</p>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 848738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d33c92cca5778ba29da1f65cc07cba5a?s=128&d=identicon&r=PG", "display_name": "xgrtl", "link": "https://stackoverflow.com/users/848738/xgrtl"}, "edited": false, "score": 1, "creation_date": 1541580864, "post_id": 37536160, "comment_id": 93261648, "body": "Been a while, but just in case someone else ends up here with this problem. The zip.FileHeader structure returned by zip.FileInfoHeader has the Method field initialized to Store, the default, which doesn&#39;t compress. If you want compression you need to do: fih.Method = zip.Deflate after getting the header from FileInfoHeader"}], "tags": [], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "is_accepted": false, "score": 0, "last_activity_date": 1464663550, "creation_date": 1464663550, "answer_id": 37536160, "question_id": 37517620, "link": "https://stackoverflow.com/questions/37517620/golang-zip-package-modified-time-defaults-to-30-november-1979-0000/37536160#37536160", "title": "Golang: Zip Package Modified Time Defaults to 30 November 1979, 00:00", "body": "<p>I can now use the input file's os.FileInfo for the FileHeader but the compression ratio is almost 1:1...Meaning its hardly compressing the file now. If I don't use CreateHeader then I get a good compression ratio. Does anyone know why? Here's the code I tried..</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"bytes\"\n    \"fmt\"\n    \"os\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(\"Zip Program!\\n\\n\")\n\n    zbuf := new(bytes.Buffer)\n\n    fmt.Print(\"Enter input filename: \")\n    var ifilename string\n    fmt.Scanf(\"%s\", &amp;ifilename)\n\n    if ifd, err := os.Open(ifilename); err == nil {\n        ibuf := make([]byte, 128)\n        zwtr := zip.NewWriter(zbuf)\n        fi, _ := ifd.Stat()              //call stat() to get os.FileInfo\n        fih, _ := zip.FileInfoHeader(fi) //get FileHeader from input file\n\n        if zw, err := zwtr.CreateHeader(fih); err == nil { //use input file header\n            for true {\n                if ird, err := ifd.Read(ibuf); err == nil {\n                    //fmt.Printf(\"%s\", ibuf[:ird])\n                    zw.Write(ibuf[:ird])\n                } else {\n                    ifd.Close()\n                    zwtr.Close()\n                    break\n                }\n            }\n        } else {\n            fmt.Println(err.Error())\n        }\n    } else {\n        fmt.Println(err.Error())\n    }\n\n    fmt.Printf(\"Buf size: %d\\n\", len(zbuf.Bytes()))\n\n    fmt.Print(\"Enter zip filename: \")\n    var zfilename string\n    fmt.Scanf(\"%s\", &amp;zfilename)\n\n    if !strings.HasSuffix(zfilename, \".zip\") {\n        zfilename += \".zip\"\n    }\n\n    if zfd, err := os.Create(zfilename); err == nil {\n        if _, err := zfd.Write(zbuf.Bytes()); err == nil {\n\n        } else {\n            fmt.Print(err.Error())\n        }\n    } else {\n        fmt.Println(err.Error())\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 469, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1464663550, "creation_date": 1464582455, "question_id": 37517620, "link": "https://stackoverflow.com/questions/37517620/golang-zip-package-modified-time-defaults-to-30-november-1979-0000", "title": "Golang: Zip Package Modified Time Defaults to 30 November 1979, 00:00", "body": "<p>How do you change the modified time for a zip file to time.Now()? When I create a zip file I get a modified time of 30 November 1979, 00:00.</p>\n\n<p>So is there an easy way to set the modified time to now?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1464582678, "post_id": 37517621, "comment_id": 62528474, "body": "Thanks. It &#39;clicked&#39; when you explained the difference between pointer allocation and struct allocation. And because go doesn&#39;t differentiate between pointer and non-pointer for field access, I guess the statement will still work. Thanks again."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 1, "last_activity_date": 1464582460, "creation_date": 1464582460, "answer_id": 37517621, "question_id": 37517426, "link": "https://stackoverflow.com/questions/37517426/understanding-memory-allocation-for-named-returned-type/37517621#37517621", "title": "Understanding memory allocation for named returned type", "body": "<blockquote>\n  <p>Will the compiler always allocate any function's named returned value?</p>\n</blockquote>\n\n<p>Yes, absolutely.</p>\n\n<blockquote>\n  <p>Also, why do I need to add the return statement at the end of the function? Is this a bug with the compiler?</p>\n</blockquote>\n\n<p>Because function which return a value must end in a return statement. That's what the language spec requires and the compiler enforces.</p>\n\n<blockquote>\n  <p>Why is the compiler letting me believe an allocation with a statement such as pt = new(Point) is not needed?</p>\n</blockquote>\n\n<p>The compiler allocates space for the pointer (that's what you return) but he cannot know where the memory for the actual Point shall be. That's your job.</p>\n\n<blockquote>\n  <p>Is this another bug with the compiler?</p>\n</blockquote>\n\n<p>No. Such stuff is fundamental. The chances you discover such a bug in such obvious code is basically zero.</p>\n"}, {"tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": false, "score": 1, "last_activity_date": 1464582935, "creation_date": 1464582935, "answer_id": 37517687, "question_id": 37517426, "link": "https://stackoverflow.com/questions/37517426/understanding-memory-allocation-for-named-returned-type/37517687#37517687", "title": "Understanding memory allocation for named returned type", "body": "<blockquote>\n  <p>In the following code sample, can I assume that I don't need to allocate the returned value? Will the compiler always allocate any function's named returned value?</p>\n</blockquote>\n\n<p>I assume by allocate you don't mean assigning like this:</p>\n\n<pre><code>a := func(1,2)\n</code></pre>\n\n<p>In this case, compiler will assign whatever comes out of func to a.</p>\n\n<p>But I think you mean allocating function result variables.</p>\n\n<pre><code>1. Yes, in this case you don't need to allocate as this is just a value.\n\n2. Nope. It depends whether value is a pointer or a concrete type. In concrete type, you don't need to allocate in any case.\n</code></pre>\n\n<blockquote>\n  <p>Also, why do I need to add the return statement at the end of the function? Is this a bug with the compiler?</p>\n</blockquote>\n\n<p>Now to return part, according to standard:</p>\n\n<blockquote>\n  <p>If the function's signature declares result parameters, the function body's statement list must end in a terminating statement.</p>\n</blockquote>\n\n<p>And this result can be named or not.</p>\n\n<blockquote>\n  <p>The code will compile but I am getting a runtime error! Why is the\n  compiler letting me believe an allocation with a statement such as pt\n  = new(Point) is not needed? Is this another bug with the compiler?</p>\n</blockquote>\n\n<p>It isn't a bug. It's happening because compiler doesn't care about which concrete type a pointer's point. Its create a pointer with zero value of nil. You need to take care of it. Otherwise, you get nil pointer dereference as you still haven't pointed it to any concrete type.</p>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 37517621, "answer_count": 2, "score": 0, "last_activity_date": 1464582935, "creation_date": 1464580972, "last_edit_date": 1464581461, "question_id": 37517426, "link": "https://stackoverflow.com/questions/37517426/understanding-memory-allocation-for-named-returned-type", "title": "Understanding memory allocation for named returned type", "body": "<p>In the following code sample, can I assume that I don't need to allocate the returned value? Will the compiler always allocate any function's named returned value?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Point struct {\n    X, Y int\n}\n\nfunc MakePoint(x, y int) (pt Point) {\n    pt.X = x\n    pt.Y = y\n    return\n}\n\nfunc main() {\n    fmt.Printf(\"%v\\n\", MakePoint(1, 2))\n}\n</code></pre>\n\n<p>Also, why do I need to add the <code>return</code> statement at the end of the function? Is this a bug with the compiler?</p>\n\n<p>If I decide to return a pointer:</p>\n\n<pre><code>func MakePoint(x, y int) (pt *Point) {\n</code></pre>\n\n<p>The code will compile but I am getting a runtime error! Why is the compiler letting me believe an allocation with a statement such as <code>pt = new(Point)</code> is not needed? Is this another bug with the compiler? Clearly, I am missing something crucial about memory allocation in Go.</p>\n"}, {"tags": ["arrays", "pointers", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1464571773, "post_id": 37516510, "comment_id": 62526460, "body": "<code>unsafe.Pointer(&amp;var[0])</code> (cast as required)"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 1, "last_activity_date": 1464610733, "creation_date": 1464610733, "answer_id": 37525488, "question_id": 37516510, "link": "https://stackoverflow.com/questions/37516510/in-go-how-do-you-convert-a-16float32-to-float32/37525488#37525488", "title": "In Go, how do you convert a [16]float32 to *float32", "body": "<p>working sample:</p>\n\n<pre><code>package main\n\n/*\nfloat Add(float *fs)\n{\n  fs[15]=15.5;\n  return fs[0]+fs[1];\n}\n*/\nimport \"C\"\n\nimport \"fmt\"\nimport \"unsafe\"\n\nfunc main() {\n    ary := [16]float32{1.5, 2.0}\n    fs := (*C.float)(unsafe.Pointer(&amp;ary[0]))\n    r := float32(C.Add(fs))\n    fmt.Println(r, ary[15]) //3.5 15.5\n}\n</code></pre>\n"}], "owner": {"reputation": 315, "user_id": 3195297, "user_type": "registered", "accept_rate": 27, "profile_image": "https://www.gravatar.com/avatar/bf114b97761515874d9c47b571abadb1?s=128&d=identicon&r=PG&f=1", "display_name": "amortaza", "link": "https://stackoverflow.com/users/3195297/amortaza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464610733, "creation_date": 1464571389, "question_id": 37516510, "link": "https://stackoverflow.com/questions/37516510/in-go-how-do-you-convert-a-16float32-to-float32", "title": "In Go, how do you convert a [16]float32 to *float32", "body": "<p>I am using a math library to handle projection matrix arithmetic.</p>\n\n<p>The OpenGL library that I am using requires \"*float32\" that represents the matrix.\nHowever, what I have available is \"[16]float32\"</p>\n\n<p>How can I create a *float32 variable and have it point to the beginning of the [16]float32 array?</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464621735, "post_id": 37516328, "comment_id": 62548962, "body": "You are changing the value of <code>two</code>, which is held by <code>f</code>. Change it to <code>f := big.NewInt(2)</code>"}, {"owner": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464622092, "post_id": 37516328, "comment_id": 62549172, "body": "Got it. Working now. Many thanks."}], "answers": [{"comments": [{"owner": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "edited": false, "score": 0, "creation_date": 1464575952, "post_id": 37516577, "comment_id": 62527170, "body": "Thank you. I made several changes, as shown in the EDIT to my original question, but there is still something wrong, a runtime error on the <code>Mul</code> function. I appreciate your help."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "edited": false, "score": 0, "creation_date": 1464598567, "post_id": 37516577, "comment_id": 62535150, "body": "You have a nil z, so it panics on the first occurrrence. Init it with a dummy value."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1464572083, "creation_date": 1464572083, "answer_id": 37516577, "question_id": 37516328, "link": "https://stackoverflow.com/questions/37516328/new-to-go-how-to-use-math-big/37516577#37516577", "title": "New to go; how to use math/big", "body": "<p>So, if you look at the documentation, you'll see that <code>Add</code>, <code>Div</code> and <code>Mul</code> are defined for the type <code>*big.Int</code>, so you have to call them using a <code>*big.Int</code> with the dot notation. Also, they expect arguments of type <code>*big.Int</code>, but you're giving them <code>big.Int</code>.</p>\n\n<p>If you look at the documentation, you'll also see that those functions are of the type: <code>z.Op(x, y)</code>. They apply <code>x Op y</code> and store the result into another <code>*big.Int</code> called <code>z</code>. So, you need a dummy <code>*big.Int</code>, that I'll call <code>z</code> (the methods return it at the same time).</p>\n\n<p>Finally, it's better to work with pointers in this case, as all methods work with pointers.</p>\n\n<pre><code>func factors(n big.Int) (fs []big.Int) --&gt; func factors(n *big.Int) (fs []big.Int)\nwheel := [11]big.Int{*one,*two,*two,*four,*two,*four,*two,*four,*six,*two,*six} --&gt;\nwheel := [11]*big.Int{one,two,two,four,two,four,two,four,six,two,six}\n\nbig.Mul(*f, *f) --&gt; z.Mul(f, f)\nbig.Mod(n, *f) --&gt; z.Mod(n, f)\nn = big.Div(n, *f) --&gt; n.Div(n, f)\nf = big.Add(f, wheel[w]) -\u2212&gt; f.Add(f, wheel[w])\n</code></pre>\n\n<p>A last thing: your condition is broken in the second for, because you are giving it an <code>int</code> instead of a <code>boolean</code>.</p>\n\n<p>So, I do not guarantee the code works after those modifications, but you will be able to make it compile and debug it.</p>\n"}], "owner": {"reputation": 16306, "user_id": 448810, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a4b14d4a7503a55cb803c049700ed83b?s=128&d=identicon&r=PG", "display_name": "user448810", "link": "https://stackoverflow.com/users/448810/user448810"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 349, "favorite_count": 0, "accepted_answer_id": 37516577, "answer_count": 1, "score": 0, "last_activity_date": 1464621269, "creation_date": 1464569438, "last_edit_date": 1464621269, "question_id": 37516328, "link": "https://stackoverflow.com/questions/37516328/new-to-go-how-to-use-math-big", "title": "New to go; how to use math/big", "body": "<p>I am new to Go but not to programming. I am trying to implement a few functions on prime numbers as a way to learn. Here's my code, which you can run at <a href=\"http://ideone.com/qxLQ0D\" rel=\"nofollow\"><a href=\"http://ideone.com/qxLQ0D\" rel=\"nofollow\">http://ideone.com/qxLQ0D</a></a>:</p>\n\n<pre><code>// prime numbers\n\npackage main\n\nimport (\n    \"fmt\"\n)\n\n// list of primes less than n:\n// sieve of eratosthenes\nfunc primes(n int) (ps []int) {\n    sieve := make([]bool, n)\n    for i := 2; i &lt; n; i++ {\n        if !(sieve[i]) {\n            ps = append(ps, i)\n            for  j := i * i; j &lt; n; j += i {\n                sieve[j] = true\n            }\n        }\n    }\n    return ps\n}\n\n// true if n is prime, else false:\n// trial division via 2,3,5-wheel\nfunc isPrime(n int) (bool) {\n    wheel := [11]int{1,2,2,4,2,4,2,4,6,2,6}\n    w := 0\n    f := 2\n    for f*f &lt;= n {\n        if n % f == 0 { return false }\n        f += wheel[w]\n        w += 1\n        if w == 11 { w = 3 }\n    }\n    return true\n}\n\n// greatest common divisor of x and y:\n// via euclid's algorithm\nfunc gcd(x int, y int) (int) {\n    for y != 0 {\n        x, y = y, x % y\n    }\n    return x\n}\n\n// absolute value of x\nfunc abs(x int) (int) {\n    if x &lt; 0 {\n        return -1 * x\n    }\n    return x\n}\n\n// list of prime factors of n:\n// trial division via 2,3,5-wheel\n// to 1000 followed by pollard rho\nfunc factors(n int) (fs []int) {\n    wheel := [11]int{1,2,2,4,2,4,2,4,6,2,6}\n    w := 0 // wheel pointer\n    f := 2 // current trial factor\n    for f*f &lt;= n &amp;&amp; f &lt; 1000 {\n        for n % f == 0 {\n            fs = append(fs, f)\n            n /= f\n        }\n        f += wheel[w]; w += 1\n        if w == 11 { w = 3 }\n    }\n    if n == 1 { return fs }\n    h := 1 // hare\n    t := 1 // turtle\n    g := 1 // greatest common divisor\n    c := 1 // random number parameter\n    for !(isPrime(n)) {\n        for g == 1 {\n            h = (h*h+c) % n // the hare runs\n            h = (h*h+c) % n // twice as fast\n            t = (t*t+c) % n // as the tortoise\n            g = gcd(abs(t-h), n)\n        }\n        if isPrime(g) {\n            for n % g == 0 {\n                fs = append(fs, g)\n                n /= g\n            }\n        }\n        h, t, g, c = 1, 1, 1, c+1\n    }\n    fs = append(fs, n)\n    return fs\n}\n\nfunc main() {\n    fmt.Println(primes(100))\n    fmt.Println(isPrime(997))\n    fmt.Println(isPrime(13290059))\n    fmt.Println(factors(13290059))\n}\n</code></pre>\n\n<p>That works fine. I would like to know how to initialize <code>wheel</code> as a constant at compile time so that it can be shared by <code>isPrime</code> and <code>factors</code>, and I would appreciate any comments on style or other aspects of my program.</p>\n\n<p>I eventually want to implement some factoring algorithms on big integers, using the <code>math/big</code> package. But I'm having much trouble. Simplifying to just the trial division via a 2,3,5-wheel part of the algorithm, here's my code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc factors(n big.Int) (fs []big.Int) {\n    zero := big.NewInt(0);\n    one  := big.NewInt(1);\n    two  := big.NewInt(2);\n    four := big.NewInt(4);\n    six  := big.NewInt(6);\n    wheel := [11]big.Int{*one,*two,*two,*four,*two,*four,*two,*four,*six,*two,*six}\n    w := 0;\n    f := two;\n    for big.Mul(*f, *f).Cmp(n) &lt;= 0 {\n        for big.Mod(n, *f).Cmp(*zero) {\n            fs = append(fs, *f)\n            n = big.Div(n, *f)\n        }\n        f = big.Add(f, wheel[w])\n        w += 1\n        if w &gt; 11 { w = 3 }\n    }\n    fs = append(fs, n)\n    return fs\n}\n\nfunc main() {\n    fmt.Println(factors(*big.NewInt(13290059)))\n}\n</code></pre>\n\n<p>That doesn't work; ideone complains that the <code>Add</code>, <code>Div</code>, <code>Mod</code> and <code>Mul</code> functions are not found. And it looks rather ugly to me, stylistically.</p>\n\n<p>Please tell me how to fix my <code>factors</code> function.</p>\n\n<p><strong>EDIT 1:</strong> Thanks to @TClaverie, I now have a function that compiles. Now I am getting a runtime error, and ideone points to the <code>Mul</code> function. Once again, can anyone help? My revised code is shown below and at <a href=\"http://ideone.com/aVBgJg\" rel=\"nofollow\"><a href=\"http://ideone.com/aVBgJg\" rel=\"nofollow\">http://ideone.com/aVBgJg</a></a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc factors(n *big.Int) (fs []big.Int) {\n    var z *big.Int\n    zero := big.NewInt(0)\n    one  := big.NewInt(1)\n    two  := big.NewInt(2)\n    four := big.NewInt(4)\n    six  := big.NewInt(6)\n    wheel := [11]*big.Int{one,two,two,four,two,four,two,four,six,two,six}\n    w := 0\n    f := two\n    z.Mul(f, f)\n    for z.Cmp(n) &lt;= 0 {\n        z.Mod(n, f)\n        for z.Cmp(zero) == 0 {\n            fs = append(fs, *f)\n            n.Div(n, f)\n            z.Mod(n, f)\n        }\n        f.Add(f, wheel[w])\n        w += 1\n        if w &gt; 11 { w = 3 }\n        z.Mul(f, f)\n    }\n    fs = append(fs, *n)\n    return fs\n}\n\nfunc main() {\n    fmt.Println(factors(big.NewInt(13290059)))\n}\n</code></pre>\n\n<p><strong>EDIT 2:</strong> Thanks to @TClaverie, I've learned a lot about Go, and I'm close to a solution. But I still have one problem; the program</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/big\"\n)\n\nfunc main() {\n    one   := big.NewInt(1);\n    two   := big.NewInt(2);\n    four  := big.NewInt(4);\n    six   := big.NewInt(6);\n    wheel := [11]*big.Int{one,two,two,four,two,four,two,four,six,two,six}\n    f := two; w := 0\n    for f.Cmp(big.NewInt(40)) &lt; 0 {\n        fmt.Println(f, w, wheel)\n        f.Add(f, wheel[w])\n        w += 1; if w == 11 { w = 3 }\n    }\n}\n</code></pre>\n\n<p>prints the following output, which shows that <code>wheel</code> is being modified in the call to <code>Add</code>:</p>\n\n<pre><code>2 0 [1 2 2 4 2 4 2 4 6 2 6]\n3 1 [1 3 3 4 3 4 3 4 6 3 6]\n6 2 [1 6 6 4 6 4 6 4 6 6 6]\n12 3 [1 12 12 4 12 4 12 4 6 12 6]\n16 4 [1 16 16 4 16 4 16 4 6 16 6]\n32 5 [1 32 32 4 32 4 32 4 6 32 6]\n36 6 [1 36 36 4 36 4 36 4 6 36 6]\n</code></pre>\n\n<p>What's the right way to prevent that from happening?</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-sql"], "comments": [{"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 1, "creation_date": 1464583564, "post_id": 37515417, "comment_id": 62528690, "body": "I think it&#39;s a bug in the sample, try changing line 68 from &quot;return fmt.Sprintf(&quot;%stcp([%s]:%d)/&quot;, cred, c.Host, c.Port)&quot; to &quot;return fmt.Sprintf(&quot;%stcp([%s]:%d)/library&quot;, cred, c.Host, c.Port)&quot;."}, {"owner": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 1, "creation_date": 1464584131, "post_id": 37515417, "comment_id": 62528836, "body": "I opened an issue on the github page, that&#39;s probably a better place to bring up this issue: <a href=\"https://github.com/GoogleCloudPlatform/golang-samples/issues/55\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/golang-samples/issues/55</a>"}, {"owner": {"reputation": 83, "user_id": 3429092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QBpeQ.jpg?s=128&g=1", "display_name": "Lee Trent", "link": "https://stackoverflow.com/users/3429092/lee-trent"}, "reply_to_user": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1464658694, "post_id": 37515417, "comment_id": 62561305, "body": "Worked! Thank you!!"}, {"owner": {"reputation": 83, "user_id": 3429092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QBpeQ.jpg?s=128&g=1", "display_name": "Lee Trent", "link": "https://stackoverflow.com/users/3429092/lee-trent"}, "reply_to_user": {"reputation": 4643, "user_id": 350488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b2f718cd7ee6515956717892c47cb93e?s=128&d=identicon&r=PG", "display_name": "Vadim", "link": "https://stackoverflow.com/users/350488/vadim"}, "edited": false, "score": 0, "creation_date": 1464659125, "post_id": 37515417, "comment_id": 62561388, "body": "Vadim, really appreciate it!"}], "owner": {"reputation": 83, "user_id": 3429092, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/QBpeQ.jpg?s=128&g=1", "display_name": "Lee Trent", "link": "https://stackoverflow.com/users/3429092/lee-trent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 248, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464559530, "creation_date": 1464559530, "question_id": 37515417, "link": "https://stackoverflow.com/questions/37515417/could-not-list-books-error-1046-no-database-selected", "title": "could not list books: Error 1046: No database selected", "body": "<p>1) I'm working through the bookshelf tutorial using Golang and Cloud SQL (MySQL).</p>\n\n<p>Link to Tutorial: </p>\n\n<p><a href=\"https://cloud.google.com/go/getting-started/using-cloud-sql\" rel=\"nofollow\">https://cloud.google.com/go/getting-started/using-cloud-sql</a></p>\n\n<p>2) I'm been able to deploy to app engine successfully.</p>\n\n<p>3) I'm able to add, edit, delete books successfully in the cloud.</p>\n\n<p>THE PROBLEM:</p>\n\n<p>After a certain amount of time has elapsed, I get the following error message in the browser: </p>\n\n<p>\"could not list books: Error 1046: No database selected\"</p>\n\n<p>The problem goes away when I redeploy using the following command:</p>\n\n<p>$ aedeploy gcloud preview app deploy app.yaml</p>\n\n<p>QUESTION:</p>\n\n<p>Any idea why this could be happening: Initial success followed by Error 1046 after a certain amount of time has elapsed?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464554145, "post_id": 37514674, "comment_id": 62522871, "body": "Use the <code>...</code> operator to expand the args slice."}, {"owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464556132, "post_id": 37514674, "comment_id": 62523434, "body": "thats not working, i still get the same error: sql: converting Exec argument #0&#39;s type: unsupported type []interface {}, a slice"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464556195, "post_id": 37514674, "comment_id": 62523451, "body": "Please, post a Minimal, Verifiable Example so we can help you."}, {"owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464558299, "post_id": 37514674, "comment_id": 62523993, "body": "<a href=\"https://play.golang.org/p/79yNm_1Sa1\" rel=\"nofollow noreferrer\">play.golang.org/p/79yNm_1Sa1</a>  since the example works fine and only db.Exec is causing the issue i have decided to use a different approach, thanks for your time and effort :)"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 1, "creation_date": 1464558618, "post_id": 37514674, "comment_id": 62524057, "body": "@Andy Schweig solved the problem. The example you provided doesn&#39;t do what you think, the args you pass to the insert function is seen as only one element because it isn&#39;t expanded."}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 13, "last_activity_date": 1464556783, "creation_date": 1464556783, "answer_id": 37515100, "question_id": 37514674, "link": "https://stackoverflow.com/questions/37514674/golang-pass-in-args-a-slice-of-strings-as-args-interface/37515100#37515100", "title": "golang pass in args (a slice of strings) as &quot;args ... interface{}&quot;", "body": "<p>In the <code>db.Exec</code> call, use <code>args...</code> instead of <code>args</code>.</p>\n"}], "owner": {"reputation": 31, "user_id": 4647979, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-bzRsVL8RBVA/AAAAAAAAAAI/AAAAAAAAAA4/0lWz8nj_QdQ/photo.jpg?sz=128", "display_name": "Alandroid", "link": "https://stackoverflow.com/users/4647979/alandroid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4733, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1560797331, "creation_date": 1464553836, "last_edit_date": 1560797331, "question_id": 37514674, "link": "https://stackoverflow.com/questions/37514674/golang-pass-in-args-a-slice-of-strings-as-args-interface", "title": "golang pass in args (a slice of strings) as &quot;args ... interface{}&quot;", "body": "<p><strong>Here is my code:</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n)\n\nfunc main() {\n    table := \"some table\"\n\n    args := []interface{}{\"string1\", \"string2\", \"string3\", \"string4\"}\n\n    _, err := db.Exec( \"INSERT INTO\" + table + \"VALUES('', ?, ?, ?, ?)\", args)\n        if err != nil {\n            return err\n        }\n}\n</code></pre>\n\n<p>I want to pass in the args but cannot format them as <code>\"args ...interface{}\"</code></p>\n\n<p><strong>Current output is:</strong></p>\n\n<p><code>sql: converting Exec argument #0's type: unsupported type []interface {}, a slice</code></p>\n\n<p>Thanks in advance!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 1, "creation_date": 1464549753, "post_id": 37513924, "comment_id": 62521369, "body": "You can map your purchase by date: map[time.Time][]Purchase, so you do not have to do that on UI side. If your collection is not sorted by time, then you have to traverse it all. If it is sorted by time, then you have to take the first elements until you cross the 2-weeks deadline. Else, you may want to sort it by time. For that, you have to implement the <a href=\"https://godoc.org/sort#Interface\" rel=\"nofollow noreferrer\">sort Interface</a>."}, {"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464554403, "post_id": 37513924, "comment_id": 62522937, "body": "@T.Claverie what about getting the previuos 2 weeks of days, do I need a calender type class or?"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464554630, "post_id": 37513924, "comment_id": 62523013, "body": "The <code>time</code> library should be plenty enough to do what you want."}], "answers": [{"tags": [], "owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1464587696, "creation_date": 1464587696, "answer_id": 37518491, "question_id": 37513924, "link": "https://stackoverflow.com/questions/37513924/how-to-filter-a-collection-based-on-date-and-assign-it-to-a-map/37518491#37518491", "title": "How to filter a collection based on date and assign it to a map", "body": "<p>An approach may be to arrange the entries in time-series structures and use that to filter required entries within some interval. We may use a map like map[timestamp_bucket][]Purchase. time-stamp bucket may be calculated as (time_stamp_corresponding_to_purchase_date_in_second - (time_stamp_corresponding_to_purchase_date_in_second % 3600)).  Basically, we arrange the purchases in hourly buckets.  When we want to get last two weeks purchases, we just compute the time_bucket keys that fall in last two weeks and retrieve the purchases from the corresponding buckets in the map. We may keep the slice []Purchase sorted if required if we want to use arbitrary time intervals to filter the records.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464587696, "creation_date": 1464549496, "question_id": 37513924, "link": "https://stackoverflow.com/questions/37513924/how-to-filter-a-collection-based-on-date-and-assign-it-to-a-map", "title": "How to filter a collection based on date and assign it to a map", "body": "<p>I have a struct that represents a Purchase:</p>\n\n<pre><code>type Purchase struct {\n  id int64\n  UserId int64\n  CreatedAt  time.Time\n}\n</code></pre>\n\n<p>Now I have a collection of these purchases.</p>\n\n<p>On the UI side I am doing this:</p>\n\n<ol>\n<li>Get the current date, and display the last 2 weeks dates.</li>\n<li>If a purchase falls within a date, display it.</li>\n</ol>\n\n<p>So it would look like:</p>\n\n<pre><code>Sunday May 29th\n- date/timestamp purchase id, amount, etc.\n- date/timestamp purchase id, amount, etc.\nSaturday May 28th\n- date/timestamp purchase id, amount, etc.\nFriday May 27th\n..\n..\n(past 2 weeks).\n</code></pre>\n\n<p>So my algorithm would be:</p>\n\n<ol>\n<li>get the current date</li>\n<li>using the current date, loop through the previous 2 weeks and search my Products collection and if the CreatedAt is the given date insert it into a collection</li>\n<li>On the UI side, loop through this collection, where the key is the day</li>\n</ol>\n\n<p>So the current date is:</p>\n\n<pre><code>t := time.Now()\n</code></pre>\n\n<p>How can I traverse the past 2 weeks and then insert it into a map.</p>\n\n<p>Is there a better algorithm that you would suggest?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 2, "creation_date": 1464539986, "post_id": 37512309, "comment_id": 62518267, "body": "What do you mean by &quot;the server is already on a port&quot;?"}, {"owner": {"reputation": 251, "user_id": 3969104, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/773a98c145dc02e5db1a207d55304a7f?s=128&d=identicon&r=PG&f=1", "display_name": "She Fu", "link": "https://stackoverflow.com/users/3969104/she-fu"}, "reply_to_user": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "edited": false, "score": 0, "creation_date": 1464540139, "post_id": 37512309, "comment_id": 62518314, "body": "for example if you have a vagrantbox ,the box is served on localhost port 8000"}, {"owner": {"reputation": 815, "user_id": 5595052, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-VCv1pzX179I/AAAAAAAAAAI/AAAAAAAAANM/1-bBYl0T9ZE/photo.jpg?sz=128", "display_name": "jnmoal", "link": "https://stackoverflow.com/users/5595052/jnmoal"}, "reply_to_user": {"reputation": 13306, "user_id": 162698, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HnjBG.png?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/162698/rob"}, "edited": false, "score": 0, "creation_date": 1464540676, "post_id": 37512309, "comment_id": 62518474, "body": "Ok, so @Rob answer is correct, on a server two processes can&#39;t listen on the same port, you have to use another one."}], "answers": [{"tags": [], "owner": {"reputation": 13306, "user_id": 162698, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HnjBG.png?s=128&g=1", "display_name": "Rob", "link": "https://stackoverflow.com/users/162698/rob"}, "is_accepted": false, "score": 2, "last_activity_date": 1464540258, "creation_date": 1464540258, "answer_id": 37512443, "question_id": 37512309, "link": "https://stackoverflow.com/questions/37512309/does-golang-need-to-listen-and-serve-on-the-same-port-as-the-server/37512443#37512443", "title": "Does Golang need to listen and serve on the same port as the server?", "body": "<p>When you use Go's built in server, it's no different than listening with Apache or nginx. You can listen on any IP and port you wish but you have to avoid conflicts where both attempt to respond to the same requests. If your server is listening on 127.0.0.1:80, you can't have Go listening in on the same port or there will be a conflict (for example).</p>\n"}], "owner": {"reputation": 251, "user_id": 3969104, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/773a98c145dc02e5db1a207d55304a7f?s=128&d=identicon&r=PG&f=1", "display_name": "She Fu", "link": "https://stackoverflow.com/users/3969104/she-fu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 680, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464540258, "creation_date": 1464539498, "last_edit_date": 1464539765, "question_id": 37512309, "link": "https://stackoverflow.com/questions/37512309/does-golang-need-to-listen-and-serve-on-the-same-port-as-the-server", "title": "Does Golang need to listen and serve on the same port as the server?", "body": "<p>I've built a little web app in go but on a server you can`t launch and listen to a serve function because the server is already on a port.</p>\n\n<p>Do I need to listen and serve but set it on the same port that the server runs? In python, for example, you have a virtualenv. Does go require a similar environment?</p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 1, "last_activity_date": 1464544820, "creation_date": 1464544820, "answer_id": 37513164, "question_id": 37511958, "link": "https://stackoverflow.com/questions/37511958/how-to-render-the-correct-css-class-based-on-a-property/37513164#37513164", "title": "How to render the correct css class based on a property?", "body": "<p>There are several ways to do that, I will cover two. First way is to work with if statements and equality tests in the template:</p>\n\n<pre><code>{{range $count, $user := .Users}}\n&lt;div ...&gt;\n   &lt;div class=\"row {{if eq $user.UserLevel \"beg\"}}beginner{{else if eq $user.UserLevel \"int\" }}intermediate{{else}}default{{end}}\"&gt;\n&lt;/div&gt;\n{{end}}\n</code></pre>\n\n<p>The second way is to define a function for the User, which outputs the correct class based on the <code>UserLevel</code> property:</p>\n\n<pre><code>func (u User) CssClass() string {\n    switch u.UserLevel {\n    case \"beg\":\n        return \"beginner\"\n    case \"int\":\n        return \"intermediate\"\n    default:\n        return \"\"\n    }\n}\n\n{{range $count, $user := .Users}}\n&lt;div ...&gt;\n   &lt;div class=\"row {{$user.CssClass}}\"&gt;\n&lt;/div&gt;\n{{end}}\n</code></pre>\n\n<p>I put this little test code in the <a href=\"https://play.golang.org/p/FRGilrDL5L\" rel=\"nofollow\">Go playground</a>, both produce the same output with the correct class.</p>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 40, "favorite_count": 0, "accepted_answer_id": 37513164, "answer_count": 1, "score": 0, "last_activity_date": 1464544820, "creation_date": 1464537332, "question_id": 37511958, "link": "https://stackoverflow.com/questions/37511958/how-to-render-the-correct-css-class-based-on-a-property", "title": "How to render the correct css class based on a property?", "body": "<p>My template looks like this currently:</p>\n\n<pre><code>{{range .Users}}\n&lt;div ...&gt;\n   &lt;div class=\"row XXXX\"&gt;\n&lt;/div&gt;\n{{end}}\n</code></pre>\n\n<p>The XXX has to be replaced with a css-class that is based on a property of the User struct, UserLevel which is a string.</p>\n\n<p>So depending on the value of UserLevel, I will display the correct css class:</p>\n\n<p>UserLevel is \"beg\" then I need to output \"beginner\".\nUserLevel is \"int\" then I need to output \"intermediate\"\netc.</p>\n\n<p>I know I can just rename the css class to match the value of the property, but I don't want to keep a tight coupling between the 2.</p>\n\n<p>Is this possible to do somehow since expressions are not allowed in if statements?</p>\n"}, {"tags": ["go", "proxy"], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2890, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1464533604, "creation_date": 1464533604, "question_id": 37511337, "link": "https://stackoverflow.com/questions/37511337/golang-https-socks5-proxy", "title": "Golang: Http(s) / Socks5 proxy", "body": "<p>I want to create a proxy who can use socks5(using tor) and classic proxies then my scraper(casperjs) can make request through it.</p>\n\n<p>I made a proxy using http.NewRequest here is the code in short:</p>\n\n<pre><code>     main(){\n        ...        \n        // struct to initialise the proxy params\n        P = NewProxy(..)\n        http.ListenAndServe(\":9999\", P)\n        ... \n    }\n</code></pre>\n\n<p>;</p>\n\n<pre><code>   func (p Proxy) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n        ...\n            req, err := http.NewRequest(\"GET\", r.URL.String(), nil)\n        ...\n    }\n</code></pre>\n\n<p>I need to get the full URL to make the call, for the http it works but for the https i got  <strong>www.example.com:443</strong></p>\n\n<p>Firstly i stared with tcp proxy using:</p>\n\n<pre><code>listener, err := net.Listen(\"tcp\", p.from)\n\nconnection, err := listener.Accept()\n\nremote, err := net.Dial(\"tcp\", p.to)\n</code></pre>\n\n<p>and <code>io.Copy(to, from)</code> to copy the data from the client to the remote server and vice-versa my code was heavily inspired by <a href=\"https://gist.github.com/vmihailenco/1380352\" rel=\"nofollow\">this gist by vmihailenco</a></p>\n\n<p>it works fine for both http and https because the listening was in the TCP couche BUT the problem with this method i can't use <strong>socks5</strong> and <strong>http(s)</strong> i have to set the type of the proxy in the call</p>\n\n<pre><code>$casperjs --proxy=127.0.0.1:9999 --proxy-type=socks5 bbuy.js\n</code></pre>\n\n<p>but what i need is that my proxy can concurrently send several requests, each using a different proxy.\nand to do that i have to modifay the transport for each request</p>\n\n<pre><code>proxyUrl, err := url.Parse(\"http://proxyIp:proxyPort\")\nhttp.DefaultTransport = &amp;http.Transport{Proxy: http.ProxyURL(proxyUrl)}\n</code></pre>\n\n<p>thats why i choose to use the http.NewRequest and to do it i have to get the full url then i can make the call \nthe problem now as i said before when my scraper try to scrape for example <strong><a href=\"https://example.com?a=1&amp;b=2\" rel=\"nofollow\">https://example.com?a=1&amp;b=2</a></strong> the resulte that i got using  <code>r.URL.String()</code>\nis <strong>example.com:443</strong> but if it's a <code>http</code> web site i got the full url</p>\n\n<p>any suggestion or idea to solve this problem</p>\n"}, {"tags": ["oop", "go"], "comments": [{"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 3, "creation_date": 1464530506, "post_id": 37510763, "comment_id": 62515255, "body": "Go doesn&#39;t have classes in the way C++, C# and Java do. It has simple aggregate-like user-defined types and separately defined free functions operating on those types. Constants like yours would probably be some kind of package-local constant in Go."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 0, "creation_date": 1464530660, "post_id": 37510763, "comment_id": 62515301, "body": "Thank for your answer :) So it means I can achieve it by declaring a struct and then, have a method linked to this one to initialize everything. Too used to use OOP ! ^^"}, {"owner": {"reputation": 11381, "user_id": 4774918, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kQQAl.jpg?s=128&g=1", "display_name": "too honest for this site", "link": "https://stackoverflow.com/users/4774918/too-honest-for-this-site"}, "edited": false, "score": 0, "creation_date": 1464531774, "post_id": 37510763, "comment_id": 62515673, "body": "A function is not the same as a <i>method</i> (but a <i>method</i> is a function)."}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464532025, "post_id": 37510763, "comment_id": 62515753, "body": "A method has to be linked to a class, isn&#39;t?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 2, "creation_date": 1464548297, "post_id": 37510763, "comment_id": 62520879, "body": "@MaximeGuittet in Go, a method is a function applied to a receiver (could be translated into a function with the receiver as its first argument): <a href=\"https://golang.org/ref/spec#Method_declarations\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_declarations</a>"}, {"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1464548584, "post_id": 37510763, "comment_id": 62520969, "body": "Interesting answer ! thank"}], "answers": [{"comments": [{"owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "edited": false, "score": 0, "creation_date": 1465206175, "post_id": 37642959, "comment_id": 62787604, "body": "This answer is exactly what I wanted ! Thank !"}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1537970948, "post_id": 37642959, "comment_id": 91978971, "body": "this is, in fact, a very very useful way of looking go comming from an OO world like java... thanks! What about channels? I guess there is no direct isomorphism for that... but i don&#39;t know why, it recall me how we used to code the stdout in c++, for example <code>std::cout &lt;&lt; &quot;hello&quot;</code> (instead of a &lt;&lt;, now they use an &lt;-)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5047085"}, "edited": false, "score": 0, "creation_date": 1543701689, "post_id": 37642959, "comment_id": 94015129, "body": "How is &quot;there is no inheritance in Go&quot; an answer to the question of &quot;how to add a static member to a struct&quot;?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 23, "last_activity_date": 1469603689, "last_edit_date": 1469603689, "creation_date": 1465136549, "answer_id": 37642959, "question_id": 37510763, "link": "https://stackoverflow.com/questions/37510763/static-member-variable-such-as-oop-langage/37642959#37642959", "title": "Static member variable such as OOP langage", "body": "<p>There is no inheritance in Go,<br>\nbut you can do all OOP stuff in Golang way.</p>\n\n<p>also see:<br>\n<a href=\"https://github.com/luciotato/golang-notes/blob/master/OOP.md\" rel=\"noreferrer\">https://github.com/luciotato/golang-notes/blob/master/OOP.md</a> \n<a href=\"https://www.goinggo.net/2013/07/object-oriented-programming-in-go.html\" rel=\"noreferrer\">https://www.goinggo.net/2013/07/object-oriented-programming-in-go.html</a></p>\n\n<p>1: static var in C# class => global var in Golang package<br>\n2: enum in C# => new package with enum name and const type of enum elements<br>\n3: class in OOP => struct type<br>\n4: class methods => struct with receiver methods<br>\n5: C#/Java abstract methods(pure virtual functions in C++) => interface methods like io.Reader<br>\n6: public => first letter Upper case Name<br>\n7: private => first letter lower case name<br>\n8: namespace => package name<br>\n9: inheritance => embedded struct and embedded interface<br>\n10: Thread => Go  routines<br>\n11: lock => sync.Mutex<br>\n...  </p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user5047085"}, "is_accepted": false, "score": 0, "last_activity_date": 1543702977, "creation_date": 1543702977, "answer_id": 53575561, "question_id": 37510763, "link": "https://stackoverflow.com/questions/37510763/static-member-variable-such-as-oop-langage/53575561#53575561", "title": "Static member variable such as OOP langage", "body": "<p>There's no real way to get a static member of a struct like you would with a static member of a Java class, but you add metadata or a tag to a struct using StructTags:</p>\n\n<p><a href=\"https://medium.com/golangspec/tags-in-golang-3e5db0b8ef3e\" rel=\"nofollow noreferrer\">https://medium.com/golangspec/tags-in-golang-3e5db0b8ef3e</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go\">What are the use(s) for tags in Go?</a></p>\n\n<p><a href=\"https://golang.org/pkg/reflect/#StructTag\" rel=\"nofollow noreferrer\">https://golang.org/pkg/reflect/#StructTag</a></p>\n\n<p>typically we see them when creating a struct for use with unmarshaing JSON:</p>\n\n<pre><code>type Foo struct {\n  Bar string `json:\"bar,omitempty\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 3206, "user_id": 6093604, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/7f17S.jpg?s=128&g=1", "display_name": "Emixam23", "link": "https://stackoverflow.com/users/6093604/emixam23"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9770, "favorite_count": 4, "accepted_answer_id": 37642959, "answer_count": 2, "score": 5, "last_activity_date": 1575545049, "creation_date": 1464530254, "last_edit_date": 1575545049, "question_id": 37510763, "link": "https://stackoverflow.com/questions/37510763/static-member-variable-such-as-oop-langage", "title": "Static member variable such as OOP langage", "body": "<p>I'm pretty new with Go and then I searched a lot how to have a static class with static function/variables such as C# by example. But, I couldn't find anything which answered well about it. Maybe this question seems stupid, but I don't like either when I'm not sure or when I don't understand completely something. </p>\n\n<p>Let say we have this code:</p>\n\n<pre><code>public class Program\n{\n    public static string name = \"Program tester.\";\n\n    public enum Importance\n    {\n        None,\n        Trivial,\n        Regular,\n        Important,\n        Critical\n    };\n\n    public static void tester(Importance value)\n    {\n        // ... Test against known Importance values.\n        if (value == Importance.Trivial)\n        {\n            Console.WriteLine(\"Not true\");\n        }\n        else if (value == Importance.Critical)\n        {\n            Console.WriteLine(\"True\");\n        }\n    }\n}\n</code></pre>\n\n<p>Golang is a C-like if I understand, so does it have some behavior like this one above, such as C++/C# languages? My code above can be achieved as C++/C# or the way to do it is to passing by a language as C (using the C modular programming way)?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1464533865, "post_id": 37509981, "comment_id": 62516281, "body": "try moving the <code>var x int</code> declaration to line 6 and you&#39;ll see it change"}], "answers": [{"tags": [], "owner": {"reputation": 32098, "user_id": 124319, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/lVhrR.jpg?s=128&g=1", "display_name": "coredump", "link": "https://stackoverflow.com/users/124319/coredump"}, "is_accepted": true, "score": 7, "last_activity_date": 1464536283, "last_edit_date": 1592644375, "creation_date": 1464526226, "answer_id": 37510123, "question_id": 37509981, "link": "https://stackoverflow.com/questions/37509981/go-anonymous-function/37510123#37510123", "title": "Go: Anonymous Function", "body": "<h3>Short version</h3>\n<p>You are building a new closure each time you call <code>squares</code>.</p>\n<p>This is exactly as if you built a new Counter object in an object-oriented language:</p>\n<pre><code>new Counter().increment(); // 4\nnew Counter().increment(); // 4\n</code></pre>\n<p>...as opposed to:</p>\n<pre><code>c = new Counter();\nc.increment(); // 4\nc.increment(); // 16\n</code></pre>\n<h3>Longer version</h3>\n<p>In your function, <code>var x int</code> declares a local variable <code>x</code>:</p>\n<pre><code>func squares() func() int {\n    var x int\n    return func() int {\n        x = x + 2\n        return x * x\n    }\n}\n</code></pre>\n<p>As for any function, local variables are visible only inside the function. If you call a function in different contexts, each call has a separate set of memory storage addressable by your local symbols (here <code>x</code>). What happens when you return a function is that any binding currently visible in the scope of your code is kept alongside your function, which is then called a  closure.</p>\n<p>Closures can hold a state, like objects do. Thus your closure can refer to the local variables that were visible when it was created, even when you escape the block where local variables were introduced (thankfully, the GC is here to keep track of the memory associated with those variables).</p>\n<p>When you define <code>f</code>, you create a fresh closure. Each time you call it you modify the same place referenced by the internal <code>x</code> variable. But if you create fresh closures and call them once each, then you won't see the same side-effects, because each <code>x</code> names a different place in memory.</p>\n"}, {"tags": [], "owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "is_accepted": false, "score": 2, "last_activity_date": 1464537427, "last_edit_date": 1464537427, "creation_date": 1464530501, "answer_id": 37510800, "question_id": 37509981, "link": "https://stackoverflow.com/questions/37509981/go-anonymous-function/37510800#37510800", "title": "Go: Anonymous Function", "body": "<p>The reason you are getting the same result when you are calling the second variant with closure function is a consequence of scope rules. All function values created by the new self invoking, or anonymous function, capture and share the same variable - an addressable storage location, not it's value at that particular moment. </p>\n\n<p>The anonymous function introduce a new lexical block which shares the same logical address to which the function values points to, so each time you invoke the function without to enclose the function to a new scope it will share the same logical address. This is the reason why you'll see in many places an anonymous function called in this way:</p>\n\n<pre><code>for i := range mymap {\n        func(n int) { \n             fmt. Println(n) \n        }(i) // note the scope\n}\n</code></pre>\n\n<p>To address your issue one way would be to use pointer variables, this way you will be absolute sure that you will share the variable allocated to the same memory address. Here is the updated and working code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc squares() func(x *int) int {\n    return func(x *int) int {\n        *x = *x + 2\n        return *x * *x\n    }\n}\n\nfunc main() {\n    f := squares()\n    x := 0\n    fmt.Println(f(&amp;x))\n    fmt.Println(f(&amp;x))\n    fmt.Println(f(&amp;x))\n    fmt.Println(squares()(&amp;x))\n    fmt.Println(squares()(&amp;x))\n    fmt.Println(squares()(&amp;x))\n}\n</code></pre>\n\n<p><kbd><a href=\"https://play.golang.org/p/XFCkbDfdn2\" rel=\"nofollow\">Go Playground</a></kbd></p>\n\n<p>Another way is to expose the variable <code>x</code> as a global variable. This will guarantee that you won't create a new variable <code>x</code> each time you run the anonymous function. </p>\n"}, {"tags": [], "owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "is_accepted": false, "score": 2, "last_activity_date": 1464537579, "last_edit_date": 1464537579, "creation_date": 1464537175, "answer_id": 37511926, "question_id": 37509981, "link": "https://stackoverflow.com/questions/37509981/go-anonymous-function/37511926#37511926", "title": "Go: Anonymous Function", "body": "<p>Here's a different perspective to answer your question.</p>\n\n<p>First break down the <code>squares()</code> function first to understand what is going on:</p>\n\n<pre><code>func squares() func() int {\n</code></pre>\n\n<p>The above defines a func named <code>squares</code> that <em>returns</em> another function of type <code>func() int</code> (and that returns an <code>int</code>, but that's not the focus here).</p>\n\n<p>Drill that into your head first: it returns a function.</p>\n\n<p>Now, let's see what happens when we call <code>squares()</code>:</p>\n\n<pre><code>    var x int\n</code></pre>\n\n<p>That's it.  It defines a varibale <code>x</code>, which defaults to value 0 per Go specs.</p>\n\n<p>OK, now we have a variable in scope called <code>x</code> and it has a value of 0.  Now, we return a function:</p>\n\n<pre><code>    return func() int {\n         x = x + 2\n         return x * x\n    }\n</code></pre>\n\n<p>If we had not defined <code>x</code> earlier, this would be a build error because x must be defined.  But, it was defined in the previous scope.</p>\n\n<p>Go's use of <em>closures</em> allows another scope to be defined, which uses variables in the previous scope.  <code>var x int</code> in this case.</p>\n\n<p>Also, you are able to modify closures (variables in previous scope).  And in this case, we are modifying the previous <code>var x int</code> that was defined in the previous scope.</p>\n\n<p>Hold onto those thoughts for a moment, let's run some code...</p>\n\n<pre><code>f := squares()\n</code></pre>\n\n<p>Here we run <code>squares()</code>, which defines <code>var x int</code> as zero and returns a <code>func()</code> named <code>f()</code> that can do more work on <code>x</code>.</p>\n\n<pre><code>fmt.Println(f())\nfmt.Println(f())\nfmt.Println(f())\n</code></pre>\n\n<p>Since we continue to reuse <code>f()</code>, this keeps the scope of <code>var x int</code> on a stack, and that stack remains around as long as you have this <code>f()</code> variable.  Therefore, <code>x</code> continues to retain its modified value and be modified.</p>\n\n<p>With all of this knowledge, the answer to your question is simple: <em>if you don't retain the scope, the <code>f()</code> definition like above, then you define a new <code>var x int = 0</code> at every invitation of <code>squares()</code></em>:</p>\n\n<pre><code>fmt.Println(squares()())\n</code></pre>\n\n<p>This invokes a new <code>squares()</code> at every call.  And therefore, a new <code>var x int = 0</code>.</p>\n\n<p>So the output of the returning func of squares, which is invoked with <code>squares()()</code>, always operates on <code>var x int = 0</code>, at every invokation since a new squares is called each time.</p>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1464584632, "last_edit_date": 1464584632, "creation_date": 1464551550, "answer_id": 37514279, "question_id": 37509981, "link": "https://stackoverflow.com/questions/37509981/go-anonymous-function/37514279#37514279", "title": "Go: Anonymous Function", "body": "<p>Simply because (1) <code>x</code> is a captured closure for the anonymous function and (2) the default value for type <code>int</code> is <code>0</code>. So every time you call it, you will see the same output.</p>\n\n<p>Let's rewrite the function <code>squares</code> like this:</p>\n\n<pre><code>func squares(initialValue int) func() int {\n    var x int\n    x = initialValue\n    return func() int {\n        x = x + 2\n        return x * x\n    }\n}\n</code></pre>\n\n<p>Now for this:</p>\n\n<pre><code>func main() {\n    f := squares(0)\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(squares(0)())\n    fmt.Println(squares(0)())\n    fmt.Println(squares(0)())\n}\n</code></pre>\n\n<p>We will see the exact output! Because we are initializing <code>x</code> with <code>0</code>. If we use <code>1</code> as the initial value of <code>x</code>:</p>\n\n<pre><code>func main() {\n    f := squares(1)\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(squares(1)())\n    fmt.Println(squares(1)())\n    fmt.Println(squares(1)())\n}\n</code></pre>\n\n<p>We will see this result:</p>\n\n<pre><code>9\n25\n49\n9\n9\n9\n</code></pre>\n\n<p>As you can see, it's just about the initial value of <code>x</code>, which when not initialized explicitly, will have it's default value, zero.</p>\n"}], "owner": {"reputation": 977, "user_id": 1419809, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0Plto.jpg?s=128&g=1", "display_name": "Pauli", "link": "https://stackoverflow.com/users/1419809/pauli"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3887, "favorite_count": 2, "accepted_answer_id": 37510123, "answer_count": 4, "score": 2, "last_activity_date": 1464584632, "creation_date": 1464525442, "question_id": 37509981, "link": "https://stackoverflow.com/questions/37509981/go-anonymous-function", "title": "Go: Anonymous Function", "body": "<p>Here is the code I've been trying to understand:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc squares() func() int {\n    var x int\n    return func() int {\n        x = x + 2\n        return x * x\n    }\n}\n\nfunc main() {\n    f := squares()\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(f())\n    fmt.Println(squares()())\n    fmt.Println(squares()())\n    fmt.Println(squares()())\n}\n</code></pre>\n\n<p>The result we got:</p>\n\n<pre><code>4\n16\n36\n4\n4\n4\n</code></pre>\n\n<p>My question is: Why does the value of <code>x</code> in <code>fmt.Println(squares()())</code> stay unchanged?</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464533041, "post_id": 37509845, "comment_id": 62516044, "body": "IMHO stop coding Go like Java."}], "answers": [{"comments": [{"owner": {"reputation": 761, "user_id": 4408431, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a2b44a8fe8eced45cbed11539b706c48?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas", "link": "https://stackoverflow.com/users/4408431/lukas"}, "edited": false, "score": 0, "creation_date": 1464587342, "post_id": 37511229, "comment_id": 62529813, "body": "Thanks a lot. However, I do not really understand what you mean by using a simple interface instead of reflection. I would be most graceful if you could explain this a little."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 761, "user_id": 4408431, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a2b44a8fe8eced45cbed11539b706c48?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas", "link": "https://stackoverflow.com/users/4408431/lukas"}, "edited": false, "score": 1, "creation_date": 1464602616, "post_id": 37511229, "comment_id": 62537576, "body": "@Lukas I added an interface example, it&#39;s just to give you a general idea, generally reflection should be avoided except for things like JSON/XML marshaling/unmarshaling."}, {"owner": {"reputation": 761, "user_id": 4408431, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a2b44a8fe8eced45cbed11539b706c48?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas", "link": "https://stackoverflow.com/users/4408431/lukas"}, "edited": false, "score": 1, "creation_date": 1464683690, "post_id": 37511229, "comment_id": 62570710, "body": "Thank you for the interface example."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1464602531, "last_edit_date": 1464602531, "creation_date": 1464533000, "answer_id": 37511229, "question_id": 37509845, "link": "https://stackoverflow.com/questions/37509845/reflection-restore-time-time-instance/37511229#37511229", "title": "Reflection - restore time.Time instance", "body": "<p>You need to get the interface to the field:</p>\n\n<pre><code>actuallyAddedTimespan.StartDate = actuallyReflectedTimespan.FieldByName(\"StartDate\").Interface().(time.Time)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TB74mLATUt\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n\n<p>Personal opinion time, using reflection for this rather than using a simple interface is:</p>\n\n<ol>\n<li>Slow.</li>\n<li>Inefficient</li>\n<li>Can break easily if you change how your struct looks and forget to update the reflection code.</li>\n</ol>\n\n<p>Example of using an interface:</p>\n\n<pre><code>func main() {\n    ts := &amp;Timespan{ID: 102, StartDate: time.Now().AddDate(6, 0, 0), EndDate: time.Now().AddDate(8, 0, 0)}\n    m := map[string]interface{}{\n        \"key\": ts,\n    }\n    switch v := m[\"key\"].(type) {\n    case Timespaner:\n        fmt.Println(v.Value())\n    default:\n        fmt.Println(\"wtfmate?\")\n    }\n}\n\nfunc (ts *Timespan) Value() (id uint8, start, end time.Time) {\n    return ts.ID, ts.StartDate, ts.EndDate\n}\n\ntype Timespaner interface {\n    Value() (id uint8, start, end time.Time)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iCo_xXq4JC\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 1, "last_activity_date": 1464533073, "creation_date": 1464533073, "answer_id": 37511238, "question_id": 37509845, "link": "https://stackoverflow.com/questions/37509845/reflection-restore-time-time-instance/37511238#37511238", "title": "Reflection - restore time.Time instance", "body": "<p>You can use the <code>Interface()</code> function to get the <code>interface{}</code> value from a struct. Then, you can use a type assertion to get the correct type back:</p>\n\n<pre><code>func main() {\n    t := &amp;Timespan{42, time.Now(), time.Now()}\n    reflectedPointer := reflect.ValueOf(t)\n    reflectedTimespan := reflectedPointer.Elem()\n    var timespan Timespan = reflectedTimespan.Interface().(Timespan)\n    fmt.Println(*t)\n    fmt.Println(timespan)\n}\n</code></pre>\n"}], "owner": {"reputation": 761, "user_id": 4408431, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/a2b44a8fe8eced45cbed11539b706c48?s=128&d=identicon&r=PG&f=1", "display_name": "Lukas", "link": "https://stackoverflow.com/users/4408431/lukas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "accepted_answer_id": 37511229, "answer_count": 2, "score": 1, "last_activity_date": 1464602531, "creation_date": 1464524468, "question_id": 37509845, "link": "https://stackoverflow.com/questions/37509845/reflection-restore-time-time-instance", "title": "Reflection - restore time.Time instance", "body": "<p>I am developing a program in go that needs to store and retrieve an array of custom structure instances using the <code>sessions</code> package of the Gorilla toolkit. For restoring the custom structure I need to make use of reflection features. The issue is that my structure named <code>Timestamp</code> includes two <code>time.Time</code> instances and I have not been able to restore the instances. Thus, my question is how to restore a <code>time.Time</code> instance.</p>\n\n<p>Below you can see my code for the <code>Timespan</code> structure as well as the code for storing and reading the <code>Timespan</code> array in the session store.</p>\n\n<pre><code>type Timespan struct {\n    ID uint8;\n    StartDate time.Time;\n    EndDate time.Time;\n}\n\nfunc (server *WebServer) setTimespans(writer http.ResponseWriter, request *http.Request, timespans [model.TimespanCount]*model.Timespan) error {\n    var session *sessions.Session;\n    var sessionDecodingException error;\n    session, sessionDecodingException = server.SessionStore.Get(request, authenticationSessionName);\n    if sessionDecodingException != nil {\n        return sessionDecodingException;\n    }\n\n\n    session.Values[sessionTimestamps] = timespans;\n    return nil;\n}\n\nfunc (server *WebServer) getTimespans(request *http.Request) ([model.TimespanCount]*model.Timespan, error) {\n    var session *sessions.Session;\n    var sessionDecodingException error;\n    session, sessionDecodingException = server.SessionStore.Get(request, authenticationSessionName);\n    var readTimespans [model.TimespanCount]*model.Timespan;\n    if sessionDecodingException != nil {\n        return readTimespans, sessionDecodingException;\n    }\n\n    interfaceValue := reflect.ValueOf(session.Values[sessionTimestamps]);\n    var actuallyAddedTimespan *model.Timespan;\n    for counter := 0; counter &lt; model.TimespanCount; counter++ {\n        actuallyAddedTimespan = &amp;model.Timespan{};\n        actuallyReflectedTimespan := interfaceValue.Index(counter).Elem();\n        actuallyAddedTimespan.ID = uint8(actuallyReflectedTimespan.FieldByName(\"ID\").Uint());\n        //actuallyAddedTimespan.StartDate = actuallyReflectedTimespan.FieldByName(\"StartDate\");\n        //actuallyAddedTimespan.EndDate = actuallyReflectedTimespan.FieldByName(\"EndDate\");\n        fmt.Println(actuallyAddedTimespan);\n    }\n    return readTimespans, nil;\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 6, "last_activity_date": 1464509543, "last_edit_date": 1464509543, "creation_date": 1464509165, "answer_id": 37507607, "question_id": 37507524, "link": "https://stackoverflow.com/questions/37507524/golang-type-aliasing-structures-that-meet-a-interface-requirement/37507607#37507607", "title": "Golang: Type aliasing Structures That Meet a Interface Requirement", "body": "<p>In your code <code>MI</code> is a new type which doesn't carry over the methods from the original type. The <code>DoubleIt</code> method really isn't available:</p>\n\n<pre><code>e2 := MI{12}\nfmt.Printf(\"%d\\n\", e2.DoubleIt())\n</code></pre>\n\n<blockquote>\n<pre><code>e2.DoubleIt undefined (type MI has no field or method DoubleIt)\n</code></pre>\n</blockquote>\n\n<p>An alternative if you want to carry over the methods would be to embed <code>MyInt</code>:</p>\n\n<pre><code>type MI struct {\n    MyInt\n}\n</code></pre>\n\n<p>Then you can say:</p>\n\n<pre><code>e2 := MI{MyInt{12}}\nfmt.Printf(\"%d\\n\", e2.DoubleIt())\n</code></pre>\n\n<hr>\n\n<p>From the <a href=\"https://golang.org/ref/spec#Types\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>A type may have a method set associated with it. The method set of any\n  <strong>other type T</strong> consists of all methods <strong>declared with receiver type T</strong>. Further rules apply to structs containing anonymous fields, as\n  described in the section on struct types. <strong>Any other type has an empty\n  method set</strong>.</p>\n</blockquote>\n"}], "owner": {"reputation": 1892, "user_id": 3158810, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1ebf9e065f654642fecfee399b439030?s=128&d=identicon&r=PG&f=1", "display_name": "G4143", "link": "https://stackoverflow.com/users/3158810/g4143"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1063, "favorite_count": 1, "accepted_answer_id": 37507607, "answer_count": 1, "score": 0, "last_activity_date": 1464509543, "creation_date": 1464508552, "question_id": 37507524, "link": "https://stackoverflow.com/questions/37507524/golang-type-aliasing-structures-that-meet-a-interface-requirement", "title": "Golang: Type aliasing Structures That Meet a Interface Requirement", "body": "<p>See code below:</p>\n\n<p>I have an odd behavior that I can't understand in Golang. If I want to create a type alias of a structure and that structure meets the requirements of a interface type, then the type alias won't meet the requirements of that interface type. I have no idea why this is happening. Any thoughts?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MyInt struct {\n    value int\n}\n\nfunc (m MyInt) DoubleIt() int {\n    return m.value * 2\n}\n\ntype MyInter interface {\n    DoubleIt() int\n}\n\ntype MyIntContainer struct {\n    d MyInter\n}\n\ntype MC MyIntContainer\ntype MI MyInt\n\nfunc main() {\n    e1 := MyIntContainer{MyInt{12}} //This is OK\n    fmt.Printf(\"%d\\n\", e1.d.DoubleIt())\n    e2 := MC{MI{12}} //this fails with error - line 29\n    fmt.Printf(\"%d\\n\", e2.d.DoubleIt())\n}\n</code></pre>\n\n<p>The error message:\nLine 29: cannot use MI literal (type MI) as type MyInter in field value:\nMI does not implement MyInter (missing DoubleIt method)</p>\n"}, {"tags": ["go", "hex", "ascii"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1464503144, "post_id": 37506631, "comment_id": 62508134, "body": "Keep in mind that ASCII has a contsept of &quot;printable characters&quot;, ie some values might not have graphic representataion."}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 14, "last_activity_date": 1464502838, "creation_date": 1464502838, "answer_id": 37506864, "question_id": 37506631, "link": "https://stackoverflow.com/questions/37506631/how-to-convert-hex-to-ascii/37506864#37506864", "title": "How to convert Hex to ASCII", "body": "<p>There's a <code>hex</code> package in the standard library that can decode hex into bytes. If it's valid utf-8 (which all ASCII is), you can display it as a string.</p>\n\n<p>Here it is in action:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n)\n\nfunc main() {\n    a := \"73616d706c65\"\n    bs, err := hex.DecodeString(a)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(bs))\n}\n</code></pre>\n\n<p>The output is \"sample\", which you can see <a href=\"https://play.golang.org/p/8CuZ5oYHUR\" rel=\"noreferrer\">on the playground</a>.</p>\n"}], "owner": {"reputation": 177, "user_id": 5747682, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/450d55729e7b4b15bfe67282d413abd7?s=128&d=identicon&r=PG", "display_name": "16b7195abb140a3929bbc322d1c6f1", "link": "https://stackoverflow.com/users/5747682/16b7195abb140a3929bbc322d1c6f1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11433, "favorite_count": 1, "accepted_answer_id": 37506864, "answer_count": 1, "score": 5, "last_activity_date": 1558010687, "creation_date": 1464500731, "last_edit_date": 1558010687, "question_id": 37506631, "link": "https://stackoverflow.com/questions/37506631/how-to-convert-hex-to-ascii", "title": "How to convert Hex to ASCII", "body": "<p>I'm writing a go program to convert hex to int, binary and ascii. The int and binary worked fine but ascii is causing issues. If the input text is shorter than 2 characters it works fine, but anything longer causes malformed text to appear. My code is as follows:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strconv\"\n\nfunc main() {\n\n    // get input as string\n    fmt.Print(\"Enter hex to convert: \")\n    var input_hex string = \"\"\n    fmt.Scanln(&amp;input_hex)\n\n    // convert hex to int and print outputs\n    if i, err := strconv.ParseInt(input_hex, 16, 0); err != nil {\n        fmt.Println(err)\n    } else {\n        // int\n        fmt.Print(\"Integer = \")\n        fmt.Println(i)\n        // ascii\n        fmt.Print(\"Ascii = \")\n        fmt.Printf(\"%c\", i)\n        fmt.Println(\"\")\n        // bin\n        fmt.Print(\"Binary = \")\n        fmt.Printf(\"%b\", i)\n        fmt.Println(\"\\n\")\n    }\n\n}\n</code></pre>\n\n<p>An example of some output when entering hex '<strong>73616d706c65</strong>':</p>\n\n<pre><code>Enter hex to convert: 73616d706c65\nInteger = 126862285106277\nAscii = \ufffd\nBinary = 11100110110000101101101011100000110110001100101\n</code></pre>\n\n<p>I've done lots of searching and have seen some documentation in regards to 'runes' but i'm unsure as to how this works. Is there a built-in hex encode/decode library that can be used to accomplish this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "edited": false, "score": 0, "creation_date": 1464535788, "post_id": 37504976, "comment_id": 62516895, "body": "Thank you, @seh.  This is what I was looking for."}, {"owner": {"reputation": 14380, "user_id": 31818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3487ce6ed9ec277bac79a838537b46a8?s=128&d=identicon&r=PG", "display_name": "seh", "link": "https://stackoverflow.com/users/31818/seh"}, "reply_to_user": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "edited": false, "score": 0, "creation_date": 1464542325, "post_id": 37504976, "comment_id": 62519005, "body": "Note too that Kaveh shows an alternate approach below: eliminate the <code>rowScanner</code> interface as a named type, and inline the interface definition in the function parameter. <a href=\"http://stackoverflow.com/a/37511481/31818\">stackoverflow.com/a/37511481/31818</a>"}], "tags": [], "owner": {"reputation": 14380, "user_id": 31818, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3487ce6ed9ec277bac79a838537b46a8?s=128&d=identicon&r=PG", "display_name": "seh", "link": "https://stackoverflow.com/users/31818/seh"}, "is_accepted": true, "score": 3, "last_activity_date": 1464503570, "last_edit_date": 1464503570, "creation_date": 1464481308, "answer_id": 37504976, "question_id": 37504735, "link": "https://stackoverflow.com/questions/37504735/create-a-function-that-accepts-two-different-objects-that-have-the-same-method/37504976#37504976", "title": "Create a function that accepts two different objects that have the same method", "body": "<p>Both <a href=\"https://golang.org/pkg/database/sql/#Rows\" rel=\"nofollow\"><code>sql.Rows</code></a> and <a href=\"https://golang.org/pkg/database/sql/#Row\" rel=\"nofollow\"><code>sql.Row</code></a> have <a href=\"https://golang.org/pkg/database/sql/#Row.Scan\" rel=\"nofollow\">a <code>Scan</code> method</a>. There's no interface containing that method in the standard library, but it's possible to define it yourself:</p>\n\n<pre><code>type rowScanner interface {\n    Scan(dest ...interface{}) error\n}\n</code></pre>\n\n<p>You can then write a function that operates on a <code>rowScanner</code> rather than a <code>*sql.Row</code> or a <code>*sql.Rows</code>:</p>\n\n<pre><code> import \"database/sql\"\n\n type rowScanner interface {\n    Scan(dest ...interface{}) error\n }\n\n func handleRow(scanner rowScanner) error {\n    var i int\n    return scanner.Scan(&amp;i)\n }\n\n func main() {\n    var row *sql.Row\n    handleRow(row) // Crashes due to calling on a nil pointer.\n    var rows *sql.Rows\n    handleRow(rows)  // Crashes due to calling on a nil pointer.\n }\n</code></pre>\n\n<p>I didn't mock up using a real <code>*sql.Row</code> or <code>*sql.Rows</code>, but that should give you the idea. Your desired <code>ScanUserFromRow</code> function would demand a <code>rowScanner</code> instead of <code>*sql.Row</code>. </p>\n"}, {"comments": [{"owner": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "edited": false, "score": 0, "creation_date": 1464536187, "post_id": 37506470, "comment_id": 62517038, "body": "Thank you for posting this.  I definitely think this is a reasonable refactor, removing the other piece of duplication in my code, the SQL query.  However, this also removes the need for the code that was at the heart of my question (i.e. how to generalize a function argument, so that it can accept more than one specific type)."}], "tags": [], "owner": {"reputation": 40406, "user_id": 459, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0db193fbf6f0929c49dd9704698204ff?s=128&d=identicon&r=PG", "display_name": "dlamblin", "link": "https://stackoverflow.com/users/459/dlamblin"}, "is_accepted": false, "score": 2, "last_activity_date": 1464499767, "last_edit_date": 1464499767, "creation_date": 1464499057, "answer_id": 37506470, "question_id": 37504735, "link": "https://stackoverflow.com/questions/37504735/create-a-function-that-accepts-two-different-objects-that-have-the-same-method/37506470#37506470", "title": "Create a function that accepts two different objects that have the same method", "body": "<p>In this case I'd refactor both to <code>Query()</code> with <code>sql.rows</code> and have both return <code>users[]</code>. Then add a convenience function to return the first item in that array if we know ids are unique.</p>\n\n<p>Something like:</p>\n\n<pre><code>type User struct {\n  ID        int\n  FirstName string\n  LastName  string\n}\n</code></pre>\n\n<pre><code>func GetUser(id int) (user User) {\n  users := getUsers(id)\n  if (len(users) &gt; 0) {\n      user = users[0]\n  }\n  return\n}\n</code></pre>\n\n<pre><code>func GetUsers() []User {\n  return getUsers(0)\n}\n</code></pre>\n\n<pre><code>func getUsers(id int) (users []User) {\n  rows := getUserRows(id)\n  for rows.Next() {\n    user := User{}\n    err := rows.Scan(&amp;user.ID, &amp;user.FirstName, &amp;user.LastName)\n    if err != nil {\n      panic(err)\n    }\n    users = append(users, user)\n  }\n  if err := rows.Err(); err != nil {\n      log.Fatal(err)\n  }\n  rows.Close()\n  return\n}\n\nfunc getUserRows(id int) (rows sql.Rows) {\n  sqlSelect := `\n    SELECT id, first_name, last_name\n    FROM users`\n  sqlWhere := `\n    WHERE id = $1`\n  sqlOrder := `\n    ORDER BY last_name`\n  var err error\n  if (0 == id) {\n    rows, err = db.Query(sqlSelect + sqlOrder)\n  } else {\n    rows, err = db.Query(sqlSelect + sqlWhere + sqlOrder, id)\n  }\n  if err != nil {\n    panic(err)\n  }\n  return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "edited": false, "score": 1, "creation_date": 1464543797, "post_id": 37511481, "comment_id": 62519419, "body": "I like this approach too.  It&#39;s a bit less readable than the approach of defining the custom interface, but it alleviates the need to come up with a name for the interface, which I think has a hidden benefit.  If you name the interface, you assign meaning to it, which you have to reason about.  That may lead to some wasted mental effort since the meaning/name of this interface isn&#39;t all that important."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "edited": false, "score": 0, "creation_date": 1464548619, "post_id": 37511481, "comment_id": 62520976, "body": "Exactly! As always; it depends!"}], "tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 1, "last_activity_date": 1464534511, "creation_date": 1464534511, "answer_id": 37511481, "question_id": 37504735, "link": "https://stackoverflow.com/questions/37504735/create-a-function-that-accepts-two-different-objects-that-have-the-same-method/37511481#37511481", "title": "Create a function that accepts two different objects that have the same method", "body": "<p>You can enforce the argument of your function to obey a specific interface - in this case, having a <code>Scan(dest ...interface{}) error</code> method:</p>\n\n<pre><code>func sampleHandler(ru interface {\n    Scan(dest ...interface{}) error\n}) error {\n    var data []interface{}\n    // result of some action in your logic\n    return ru.Scan(data)\n}\n</code></pre>\n"}], "owner": {"reputation": 8949, "user_id": 2325596, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2297878f20b8b95376bf21bfe876924d?s=128&d=identicon&r=PG", "display_name": "Elliot Larson", "link": "https://stackoverflow.com/users/2325596/elliot-larson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 37504976, "answer_count": 3, "score": 6, "last_activity_date": 1464618408, "creation_date": 1464478540, "last_edit_date": 1495539849, "question_id": 37504735, "link": "https://stackoverflow.com/questions/37504735/create-a-function-that-accepts-two-different-objects-that-have-the-same-method", "title": "Create a function that accepts two different objects that have the same method", "body": "<p>I'm learning Golang and want to understand the \"Go way\" of solving this problem.  </p>\n\n<p>Specifically, I'm using the <code>sql</code> package and I'm seeing some redundant functionality in my code that I'd like to pull out into a function.</p>\n\n<h2>My Original Code</h2>\n\n<p>I have, <strong><em>1)</em></strong> a user struct:</p>\n\n<pre><code>type User struct {\n  ID        int\n  FirstName string\n  LastName  string\n}\n</code></pre>\n\n<p><strong><em>2)</em></strong> a function for getting one user by ID from the database (Postgresql):</p>\n\n<pre><code>func GetUserById(id int) (user User) {\n  sql := `\n    SELECT id, first_name, last_name\n    FROM users\n    WHERE id = $1\n  `\n  row := db.QueryRow(sql, id)\n  err := row.Scan(&amp;user.ID, &amp;user.FirstName, &amp;user.LastName)\n  if err != nil {\n    panic(err)\n  }\n  return\n}\n</code></pre>\n\n<p>and, <strong><em>3)</em></strong> a function for getting all users from the database:</p>\n\n<pre><code>func GetUsers() (users []User) {\n  sql := `\n    SELECT id, first_name, last_name\n    FROM users\n    ORDER BY last_name\n  `\n  rows, err := db.Query(sql)\n  if err != nil {\n    panic(err)\n  }\n  for rows.Next() {\n    user := User{}\n    err := rows.Scan(&amp;user.ID, &amp;user.FirstName, &amp;user.LastName)\n    if err != nil {\n      panic(err)\n    }\n    users = append(users, user)\n  }\n  rows.Close()\n  return\n}\n</code></pre>\n\n<h2>Desired Refactor</h2>\n\n<p>With only 3 fields in the user record, this is a trivial example.  But, with a few more fields, the <code>rows.Scan(...)</code> piece of both data access functions would be nice to move to a function that both could call:</p>\n\n<pre><code>func ScanUserFromRow(row *sql.Row) (user User) {\n  err := row.Scan(&amp;user.ID, &amp;user.FirstName, &amp;user.LastName)\n  if err != nil {\n    panic(err)\n  }\n  return\n}\n</code></pre>\n\n<p>Then the updated database access functions would look something like:</p>\n\n<pre><code>func GetUserById(id int) (user User) {\n  sql := `\n    SELECT id, first_name, last_name\n    FROM users\n    WHERE id = $1\n  `\n  row := db.QueryRow(sql, id)\n  user = ScanUserFromRow(row)\n  return\n}\n\nfunc GetUsers() (users []User) {\n  sql := `\n    SELECT id, first_name, last_name\n    FROM users\n    ORDER BY last_name\n  `\n  rows, err := db.Query(sql)\n  if err != nil {\n    panic(err)\n  }\n  for rows.Next() {\n    user := ScanUserFromRow(rows)\n    users = append(users, user)\n  }\n  rows.Close()\n  return\n}\n</code></pre>\n\n<p>However, in the case of the <code>GetUserById</code> function, I'm dealing with an <code>*sql.Row</code> struct pointer.  In the case of the <code>GetUsers</code> function, I'm dealing with an <code>*sql.Rows</code> struct pointer.  The two are different... obviously, but <em>similar</em> in that they both have a <code>Scan</code> method.</p>\n\n<p>It seems the type system won't let me create a method that will accept one or the other.  Is there a way to do this utilizing <code>interface{}</code>, or is there some other more idiomatic Go solution for this?</p>\n\n<h2>Update/Solution</h2>\n\n<p>With this question, I'm saying both <code>sql.Row</code> and <code>sql.Rows</code> are ducks that \"quack\" with <code>Scan</code>.  How can I use a function argument that allows both?</p>\n\n<p><a href=\"https://stackoverflow.com/a/37504976/2325596\">@seh provided an answer below</a> that allows the sort of duck-typing I was hoping for by making the argument a custom interface.  Here is the resulting code:</p>\n\n<pre><code>type rowScanner interface {\n  Scan(dest ...interface{}) error\n}\n\nfunc ScanPlayerFromRow(rs rowScanner) (u User) {\n  err := rs.Scan(&amp;u.ID, &amp;u.FirstName, &amp;u.LastName)\n  if err != nil {\n    panic(err)\n  }\n  return\n}\n</code></pre>\n\n<p><a href=\"https://stackoverflow.com/a/37511481/2325596\"><strong>...or,</strong> as @Kaveh pointed out below</a>, the definition of the interface can be inlined in the function argument:</p>\n\n<pre><code>func ScanPlayerFromRow(rs interface {\n  Scan(des ...interface{}) error\n}) (u User) {\n  err := rs.Scan(&amp;u.ID, &amp;u.FirstName, &amp;u.LastName)\n  if err != nil {\n    panic(err)\n  }\n  return\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 1, "creation_date": 1464489820, "post_id": 37504682, "comment_id": 62506087, "body": "What would happen if the last line of the program were replaced by <code>i.foo(&quot;hello&quot;)</code>? It wouldn&#39;t be a type error, because <code>i.foo</code> accepts an argument of any type."}, {"owner": {"reputation": 3577, "user_id": 1814909, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/04ca8b6a14373e9cfe5aaea6096f4c01?s=128&d=identicon&r=PG", "display_name": "kaspersky", "link": "https://stackoverflow.com/users/1814909/kaspersky"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1464527728, "post_id": 37504682, "comment_id": 62514425, "body": "@PaulHankin, that&#39;s true, but what do you want to say by that?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1464528115, "post_id": 37504682, "comment_id": 62514550, "body": "By it I meant that if <code>s</code> satisfied the interface <code>I</code> then you&#39;d have a well-typed program that calls <code>S.foo</code> with a string argument, even though it requires an int argument. So go&#39;s type system wouldn&#39;t be sound."}], "answers": [{"comments": [{"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1552439512, "post_id": 37505170, "comment_id": 97007202, "body": "The improvement at the end is a nice touch. I see many people trying to jam fields into the methods of interfaces - rather than focusing on distilling down the methods themselves."}], "tags": [], "owner": {"reputation": 4393, "user_id": 4946286, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a23f5b1b48421368971c04e06e1ccbce?s=128&d=identicon&r=PG&f=1", "display_name": "khrm", "link": "https://stackoverflow.com/users/4946286/khrm"}, "is_accepted": true, "score": 11, "last_activity_date": 1464489335, "last_edit_date": 1464489335, "creation_date": 1464483634, "answer_id": 37505170, "question_id": 37504682, "link": "https://stackoverflow.com/questions/37504682/why-does-method-signature-have-to-perfectly-match-interface-method/37505170#37505170", "title": "Why does method signature have to perfectly match interface method", "body": "<p>I think your understanding of interface isn't sound. Interface{} itself is a type. It consists of two things : underlying type and underlying value.</p>\n\n<p>Golang doesn't have overloading. Golang type system matches by name and requires consistency in the types</p>\n\n<p>So, when you are defining a function taking a interface type as a parameter:</p>\n\n<pre><code>foo(interface {})\n</code></pre>\n\n<p>This is a different function from a function taking int type:</p>\n\n<pre><code>foo(int)\n</code></pre>\n\n<p>So you should change the following line to </p>\n\n<pre><code>func (s S) foo(i interface{}) {\n    fmt.Println(i)\n}\n</code></pre>\n\n<p>Or better yet to this:</p>\n\n<pre><code>type I interface {\n    foo()\n}\n\ntype S struct {\n    I int\n}\n\nfunc (s S) foo() {\n    fmt.Println(s.I)\n}\n\nfunc main() {\n    var i I = S{2}\n    i.foo()\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1590116404, "post_id": 55131415, "comment_id": 109564750, "body": "It&#39;s helpful that you fixed the original code as it was listed."}], "tags": [], "owner": {"reputation": 1629, "user_id": 5839563, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k7Dvf.jpg?s=128&g=1", "display_name": "Zhenhua", "link": "https://stackoverflow.com/users/5839563/zhenhua"}, "is_accepted": false, "score": 1, "last_activity_date": 1552432040, "last_edit_date": 1552432040, "creation_date": 1552428756, "answer_id": 55131415, "question_id": 37504682, "link": "https://stackoverflow.com/questions/37504682/why-does-method-signature-have-to-perfectly-match-interface-method/55131415#55131415", "title": "Why does method signature have to perfectly match interface method", "body": "<p>The error message itself is self-explaining:</p>\n\n<pre><code>\"S does not implement I (wrong type for foo method)\" \n</code></pre>\n\n<p>so S{} which is of S type cannot be used on the RHS of type I variable assignment.</p>\n\n<p>To implement I interface, type S needs to define foo function with the exact same signature. </p>\n\n<p>To achieve what you wanted, you can use empty interface as input parameter for your foo function in S and do type assertion </p>\n\n<pre><code>    package main\n\n    import \"fmt\"\n\n    type I interface {\n        foo(interface {})\n    }\n\n    type S struct {}\n\n    func (s S) foo(i interface{}) {\n        if i, ok := i.(int); ok{\n        fmt.Println(i)\n        }\n    }\n\n    func main() {\n        var i I = S{}\n        i.foo(2)\n        i.foo(\"2\")\n    }\n</code></pre>\n\n<p>Try <a href=\"https://play.golang.org/p/oVtBFG4W-a-\" rel=\"nofollow noreferrer\">it</a> in go playground</p>\n"}], "owner": {"reputation": 3577, "user_id": 1814909, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/04ca8b6a14373e9cfe5aaea6096f4c01?s=128&d=identicon&r=PG", "display_name": "kaspersky", "link": "https://stackoverflow.com/users/1814909/kaspersky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2630, "favorite_count": 4, "accepted_answer_id": 37505170, "answer_count": 2, "score": 8, "last_activity_date": 1552432040, "creation_date": 1464478044, "question_id": 37504682, "link": "https://stackoverflow.com/questions/37504682/why-does-method-signature-have-to-perfectly-match-interface-method", "title": "Why does method signature have to perfectly match interface method", "body": "<p>I began to learn Go and have trouble understanding the following:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype I interface {\n    foo(interface {})\n}\n\ntype S struct {}\n\nfunc (s S) foo(i int) {\n    fmt.Println(i)\n}\n\nfunc main() {\n    var i I = S{}\n    i.foo(2)\n}\n</code></pre>\n\n<p>This fails with:</p>\n\n<pre><code>cannot use S literal (type S) as type I in assignment:\n        S does not implement I (wrong type for foo method)\n                have foo(int)\n                want foo(interface {})\n</code></pre>\n\n<p>I don't understand why Go doesn't accept the <code>foo(int)</code> signature given the fact that <code>int</code> implements <code>interface {}</code>. Can anyone help with an explanation?</p>\n"}, {"tags": ["xml", "go"], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 1, "last_activity_date": 1464511525, "creation_date": 1464511525, "answer_id": 37507911, "question_id": 37504533, "link": "https://stackoverflow.com/questions/37504533/marshalling-xml-in-golang-field-is-empty-append-doesnt-work/37507911#37507911", "title": "Marshalling XML in GOlang: field is empty (APPEND doesn&#39;t work?)", "body": "<p>The members that you want to marshal have to be exported (capitalized). Try:</p>\n\n<pre><code>type point struct {\n    Geo    string `xml:\"point\"`\n    Radius int    `xml:\"radius,attr\"`\n}\n</code></pre>\n\n<p>From the <a href=\"https://golang.org/pkg/encoding/xml/\" rel=\"nofollow\"><code>encoding/xml</code> doc</a>:</p>\n\n<blockquote>\n  <p>The XML element for a struct contains marshalled elements <strong>for each of\n  the exported fields of the struct</strong>.</p>\n  \n  <p>[..]</p>\n  \n  <p>Because Unmarshal uses the reflect package, <strong>it can only assign to\n  exported (upper case) fields</strong>.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 103, "user_id": 4916032, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dwcxF.jpg?s=128&g=1", "display_name": "shantibiotic", "link": "https://stackoverflow.com/users/4916032/shantibiotic"}, "edited": false, "score": 0, "creation_date": 1464557396, "post_id": 37508165, "comment_id": 62523754, "body": "Thank you so much! And thanks for pointing to other mistakes."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 2, "last_activity_date": 1464514273, "last_edit_date": 1464514273, "creation_date": 1464513500, "answer_id": 37508165, "question_id": 37504533, "link": "https://stackoverflow.com/questions/37504533/marshalling-xml-in-golang-field-is-empty-append-doesnt-work/37508165#37508165", "title": "Marshalling XML in GOlang: field is empty (APPEND doesn&#39;t work?)", "body": "<p>Several things are wrong in your code. When working with encoding packages in Go, all the fields you want to marshal/unmarshal have to be exported. Note that the structs themselves do not have to be exported.</p>\n\n<p>So, first step is to change the <code>point</code> struct to export the fields:</p>\n\n<pre><code>type point struct {\n    Geo    string `xml:\"point\"`\n    Radius int    `xml:\"radius,attr\"`\n}\n</code></pre>\n\n<p>Now, if you want to display the <code>Geo</code> field inside a point, you have to add <code>,cdata</code> to the xml tag. Finally, there is no need to add an <code>omitempty</code> keyword to a slice.</p>\n\n<pre><code>type Request struct {\n    XMLName xml.Name `xml:\"request\"`\n    Action  string   `xml:\"action,attr\"`\n    Point   []point  `xml:\"point\"`\n}\n\ntype point struct {\n    Geo    string `xml:\",chardata\"`\n    Radius int    `xml:\"radius,attr\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9pGMl570Q0\" rel=\"nofollow\">Go playground</a></p>\n"}], "owner": {"reputation": 103, "user_id": 4916032, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/dwcxF.jpg?s=128&g=1", "display_name": "shantibiotic", "link": "https://stackoverflow.com/users/4916032/shantibiotic"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 676, "favorite_count": 0, "accepted_answer_id": 37508165, "answer_count": 2, "score": 3, "last_activity_date": 1464514273, "creation_date": 1464476711, "last_edit_date": 1464478771, "question_id": 37504533, "link": "https://stackoverflow.com/questions/37504533/marshalling-xml-in-golang-field-is-empty-append-doesnt-work", "title": "Marshalling XML in GOlang: field is empty (APPEND doesn&#39;t work?)", "body": "<p>i'm learning to create XML in Go. Here's my code:</p>\n\n<pre><code>type Request struct {\n    XMLName       xml.Name        `xml:\"request\"`\n    Action        string          `xml:\"action,attr\"`\n    ...\n    Point         []point         `xml:\"point,omitempty\"`\n}\n\ntype point struct {\n    geo    string `xml:\"point\"`\n    radius int    `xml:\"radius,attr\"`\n}\n\nfunc main() {\n    v := &amp;Request{Action: \"get-objects\"}\n    v.Point = append(v.Point, point{geo: \"55.703038, 37.554457\", radius: 10})\n    output, err := xml.MarshalIndent(v, \"  \", \"    \")\n    if err != nil {\n        fmt.Println(\"error: %v\\n\", err)\n    }\n    os.Stdout.Write([]byte(xml.Header))\n    os.Stdout.Write(output)\n\n}\n</code></pre>\n\n<p>I expect the output to be like:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n  &lt;request action=\"get-objects\"&gt;\n      &lt;point radius=10&gt;55.703038, 37.554457&lt;/point&gt;\n  &lt;/request&gt;\n</code></pre>\n\n<p>But what I'm getting is:</p>\n\n<pre><code> &lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n      &lt;request action=\"get-objects\"&gt;\n          &lt;point&gt;&lt;/point&gt;\n      &lt;/request&gt;\n</code></pre>\n\n<p>What am I missing or doing wrong?\nBecause the \"name,attr\" thing works perfect for everything else (for example, for the \"request\" field, as you can see). \nThanks. </p>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 1, "creation_date": 1464495852, "post_id": 37504519, "comment_id": 62506936, "body": "How could I just check if the .Users count is greater than 0?  I don&#39;t want it to loop."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "edited": false, "score": 1, "creation_date": 1537823286, "post_id": 37504519, "comment_id": 91916020, "body": "I agree with @Blankman . What does one do when rendering a table?  One needs to know if there are a non-zero number of items <i>before</i> deciding whether to output the table&#39;s <code>&lt;th&gt;</code> tags etc. Ranging on the <code>&lt;td&gt;</code> -  it&#39;s already too late."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 7, "last_activity_date": 1464476417, "creation_date": 1464476417, "answer_id": 37504519, "question_id": 37504510, "link": "https://stackoverflow.com/questions/37504510/how-to-know-if-a-range-is-empty/37504519#37504519", "title": "How to know if a range is empty?", "body": "<p>Use <a href=\"https://godoc.org/text/template#hdr-Actions\" rel=\"noreferrer\"><code>{{range pipeline}} T1 {{else}} T0 {{end}}</code></a>:</p>\n\n<blockquote>\n<pre><code>{{range pipeline}} T1 {{else}} T0 {{end}}\n        The value of the pipeline must be an array, slice, map, or channel.\n        If the value of the pipeline has length zero, dot is unaffected and\n        T0 is executed; otherwise, dot is set to the successive elements\n        of the array, slice, or map and T1 is executed.\n</code></pre>\n</blockquote>\n\n<p>Example:</p>\n\n<pre><code>{{range .Users}}\n...\n{{else}}\n&lt;p&gt;No users&lt;/p&gt;\n{{end}}\n</code></pre>\n"}], "owner": {"reputation": 235600, "user_id": 39677, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/77aa7bc1ace6e4b0b49a2102e4fa4059?s=128&d=identicon&r=PG", "display_name": "Blankman", "link": "https://stackoverflow.com/users/39677/blankman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1206, "favorite_count": 0, "accepted_answer_id": 37504519, "answer_count": 1, "score": 4, "last_activity_date": 1549062427, "creation_date": 1464476352, "question_id": 37504510, "link": "https://stackoverflow.com/questions/37504510/how-to-know-if-a-range-is-empty", "title": "How to know if a range is empty?", "body": "<p>How can I conditionally display something else if my range is empty?</p>\n\n<pre><code>{{range .Users}}\n...\n{{end}}\n</code></pre>\n\n<p>If the range is empty, I want to display a different block of HTML.</p>\n"}, {"tags": ["google-app-engine", "pointers", "reflection", "go", "interface"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464478317, "post_id": 37504458, "comment_id": 62504402, "body": "Try this: <code>memcache.Gob.Get(*context, cacheKey, fetchFromCache)</code> (note no address <code>&amp;</code> operator before <code>fetchFromCache</code>)."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464478776, "post_id": 37504458, "comment_id": 62504489, "body": "Wow, <i>facepalm</i>. After spending all day on this, with your help, I&#39;m finally able to nearly get it right on my own. Ha, thank you."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464482902, "post_id": 37504458, "comment_id": 62505209, "body": "Quick follow-up question: For some reason, this isn&#39;t returning <code>true</code> in the above code ... <code>(err==memcache.ErrCacheMiss)</code> ... yet this is <code>true</code>: <code>(err!=nil &amp;&amp; err.Error()==memcache.ErrCacheMiss.Error())</code> .... I&#39;d prefer to avoid string comparison, is there a fix for this?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464505927, "post_id": 37504458, "comment_id": 62508668, "body": "You should never do string comparison on errors. I find it unlikely what you wrote,  please double check. But do this: first check if <code>err != nil &amp;&amp; err != memcache.ErrCacheMiss</code> and if so, return early. Also if it&#39;s <code>memcache.ErrCacheMiss</code> and you manually fetch data successfully, you should return a <code>nil</code> error by setting <code>err</code> to <code>nil</code>. Maybe your confusion comes from you still returning the <code>memcache.ErrCacheMiss</code> in this case."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464529468, "post_id": 37504458, "comment_id": 62514949, "body": "Yeah, it seemed a bit odd that the errors weren&#39;t matching but the strings were. I&#39;m going to flush my <code>pkg</code> directory and see if that helps."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1464479314, "creation_date": 1464479314, "answer_id": 37504800, "question_id": 37504458, "link": "https://stackoverflow.com/questions/37504458/issue-translating-data-back-from-serialization-into-go-struct-dynamically-using/37504800#37504800", "title": "Issue translating data back from serialization into Go struct dynamically using reflection", "body": "<p><code>memcache.Gob.Get()</code> which is <a href=\"https://godoc.org/google.golang.org/appengine/memcache#Codec.Get\" rel=\"nofollow\"><code>Codec.Get()</code></a> expects the \"target\" as a pointer, wrapped into an <code>interface{}</code>.</p>\n\n<p>Your <code>fetchFromCache</code> is already just that: a pointer to a value of the specified type (<code>returnType</code>) wrapped in an <code>interface{}</code>. So you don't need to take its address when passing it to <code>Gob.Get()</code>: pass it as-is:</p>\n\n<pre><code>_, err=memcache.Gob.Get(*context, cacheKey, fetchFromCache)\n</code></pre>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 37504800, "answer_count": 1, "score": 1, "last_activity_date": 1464479314, "creation_date": 1464475845, "last_edit_date": 1464477385, "question_id": 37504458, "link": "https://stackoverflow.com/questions/37504458/issue-translating-data-back-from-serialization-into-go-struct-dynamically-using", "title": "Issue translating data back from serialization into Go struct dynamically using reflection", "body": "<p>I'm having trouble using reflection in Go to fetch data from a cache dynamically into various statically declared struct types:</p>\n\n<pre><code>func FetchFromCacheOrSomewhereElse(cacheKey string, returnType reflect.Type) (out interface {}, err error) {\n    fetchFromCache := reflect.New(returnType).Interface();\n    _, err=memcache.Gob.Get(*context, cacheKey, &amp;fetchFromCache);\n\n    if (err==nil) {\n        out=reflect.ValueOf(fetchFromCache).Elem().Interface();\n\n    } else if (err==memcache.ErrCacheMiss) {\n        /* Fetch data manually... */\n\n    }\n\n    return out, err;\n\n}\n</code></pre>\n\n<p>It seems that <code>reflect</code> won't translate this statically typed cache data back into a reflect value, and returns this error instead: <code>gob: local interface type *interface {} can only be decoded from remote interface type; received concrete type</code> ... :\\</p>\n\n<p>This data is saved elsewhere in the code to the cache without the need for <code>reflect</code>.</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1464468340, "post_id": 37503585, "comment_id": 62502132, "body": "<code>return false, nil</code> why aren&#39;t you returning the error? There could be some useful information provided."}], "answers": [{"comments": [{"owner": {"reputation": 397, "user_id": 3689247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7a648a4c50aff110dba2c7116e22aa21?s=128&d=identicon&r=PG", "display_name": "Fireynis", "link": "https://stackoverflow.com/users/3689247/fireynis"}, "edited": false, "score": 0, "creation_date": 1464478928, "post_id": 37503919, "comment_id": 62504521, "body": "Tossing the error is an oversight, thank you, I will look into the prepare function."}, {"owner": {"reputation": 397, "user_id": 3689247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7a648a4c50aff110dba2c7116e22aa21?s=128&d=identicon&r=PG", "display_name": "Fireynis", "link": "https://stackoverflow.com/users/3689247/fireynis"}, "edited": false, "score": 0, "creation_date": 1464496162, "post_id": 37503919, "comment_id": 62506977, "body": "It was too many connections, and exec has fixed it. Thank you."}], "tags": [], "owner": {"reputation": 1942, "user_id": 1209272, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97e49723c518649025bd10ea6bf113b5?s=128&d=identicon&r=PG", "display_name": "Chief", "link": "https://stackoverflow.com/users/1209272/chief"}, "is_accepted": true, "score": 1, "last_activity_date": 1464471156, "creation_date": 1464471156, "answer_id": 37503919, "question_id": 37503585, "link": "https://stackoverflow.com/questions/37503585/cant-insert-more-than-150-rows/37503919#37503919", "title": "Can&#39;t insert more than 150 rows", "body": "<p>Your code seems to discard the error value returned, which you shouldn't do; handle it gracefully. See what the error is, if you're opening too many connections to the DB, you should use a database connection pool and set the <code>(*DB) SetMaxOpenConns</code> value.</p>\n\n<p><code>(*DB)Query</code> is typically used for <code>SELECT</code> statements that return rows, use <code>(*DB)Exec</code> or <code>(*Stmt)Exec</code> for your <code>INSERT</code>. </p>\n\n<p>I'd advise using a db connection pool, and <code>(*sql.DB)Prepare</code> to prepare a statement and run your inserts (even concurrently) using the prepared statement.  </p>\n\n<p>See <a href=\"https://golang.org/pkg/database/sql/#DB.Prepare\" rel=\"nofollow\">https://golang.org/pkg/database/sql/#DB.Prepare</a> </p>\n"}], "owner": {"reputation": 397, "user_id": 3689247, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7a648a4c50aff110dba2c7116e22aa21?s=128&d=identicon&r=PG", "display_name": "Fireynis", "link": "https://stackoverflow.com/users/3689247/fireynis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 37503919, "answer_count": 1, "score": -3, "last_activity_date": 1464471156, "creation_date": 1464468219, "question_id": 37503585, "link": "https://stackoverflow.com/questions/37503585/cant-insert-more-than-150-rows", "title": "Can&#39;t insert more than 150 rows", "body": "<p>I am using go-sql-driver/mysql to insert a ton of movies from the OMDB data dump. I am parsing the data and inserting it with the following code:</p>\n\n<pre><code>_, err = database.Query(\"INSERT INTO `movies` (`name`, `year`, `release_date`, `full_plot`, `genre`, `imdb_id`) VALUES (?, ?, ?, ?, ?, ?)\", movie.Name, movie.Year, movie.ReleaseDate, movie.FullPlot, movie.Genre, movie.IMDBID)\n\nif err != nil {\n    return false, nil\n}\nreturn true, nil\n</code></pre>\n\n<p>It works, but for only 150 rows. Am I doing something wrong?</p>\n"}, {"tags": ["go", "arm"], "comments": [{"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464466622, "post_id": 37503085, "comment_id": 62501650, "body": "Have you tried with the <code>build</code> command, instead of <code>install</code>? e.g. <code>GOARCH=arm go build</code>?"}], "answers": [{"comments": [{"owner": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1464474216, "post_id": 37503543, "comment_id": 62503618, "body": "You don&#39;t actually need so many variables. If you don&#39;t need CGO then no gcc needed. For go only builds you only need to set GOOS, GOARCH and GOARM"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 8880, "user_id": 2363866, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ToSkw.png?s=128&g=1", "display_name": "creker", "link": "https://stackoverflow.com/users/2363866/creker"}, "edited": false, "score": 0, "creation_date": 1464475004, "post_id": 37503543, "comment_id": 62503782, "body": "@creker: yes, My IDE set all automatically (for general case)"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 2, "last_activity_date": 1464468700, "last_edit_date": 1464468700, "creation_date": 1464467845, "answer_id": 37503543, "question_id": 37503085, "link": "https://stackoverflow.com/questions/37503085/building-for-arm-cannot-do-cross-compilation-with-go-install-when-gobin-is-se/37503543#37503543", "title": "Building for ARM? Cannot do cross-compilation with `go install` when GOBIN is set", "body": "<p>this works for me(cross compilation from win64 to linux arm6):<br>\nI first set these in terminal:</p>\n\n<pre><code>set GOARCH=arm\nset GOBIN=D:\\work\\go\\bin\nset GOEXE=\nset GOHOSTARCH=amd64\nset GOHOSTOS=windows\nset GOOS=linux\nset GOPATH=D:\\work\\go\nset GORACE=\nset GOROOT=c:\\go\nset GOTOOLDIR=c:\\go\\pkg\\tool\\windows_amd64\nset GO15VENDOREXPERIMENT=1\nset CC=gcc\nset GOGCCFLAGS=-fPIC -marm -fmessage-length=0\nset CXX=g++\nset CGO_ENABLED=0\n</code></pre>\n\n<p>and then simply:<br>\ngo build<br>\nand it generates binary output for target (ok).<br>\nthen copy binary output to the target system and run.<br>\nI think you should use \"go build\"  not \"go install\" for cross compilation.</p>\n"}, {"comments": [{"owner": {"reputation": 2680, "user_id": 5556676, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/873efb3aa94e7f6805c489dcc0ebb57f?s=128&d=identicon&r=PG&f=1", "display_name": "init_js", "link": "https://stackoverflow.com/users/5556676/init-js"}, "edited": false, "score": 2, "creation_date": 1554454262, "post_id": 37511474, "comment_id": 97766458, "body": "<code>go install</code> supports passing multiple packages at once on the command line when they&#39;re all part of the same project (e.g.  <code>GOBIN=&#47;path&#47;to&#47;bin go install mypkg&#47;foo mypkg&#47;bar</code>). But unlike <code>install</code>, <code>go build</code> cannot combine <code>-o</code> and multiple packages. So that bit of functionality seems lost."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 7, "last_activity_date": 1464534470, "creation_date": 1464534470, "answer_id": 37511474, "question_id": 37503085, "link": "https://stackoverflow.com/questions/37503085/building-for-arm-cannot-do-cross-compilation-with-go-install-when-gobin-is-se/37511474#37511474", "title": "Building for ARM? Cannot do cross-compilation with `go install` when GOBIN is set", "body": "<p>You can use the go build command instead:</p>\n\n<pre><code>env GOOS=android GOARCH=arm64 go build -o /arm64bins/app\n</code></pre>\n\n<p>Available <code>GOOS/GOARCH</code>'s in Go 1.7:</p>\n\n<pre><code>\u279c go tool dist list | grep arm                                                                                   05/29/16\nandroid/arm\nandroid/arm64\ndarwin/arm\ndarwin/arm64\nfreebsd/arm\nlinux/arm\nlinux/arm64\nnacl/arm\nnetbsd/arm\nopenbsd/arm\nplan9/arm\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1737, "user_id": 8261341, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eyDTc.jpg?s=128&g=1", "display_name": "Ivan Kaloyanov", "link": "https://stackoverflow.com/users/8261341/ivan-kaloyanov"}, "edited": false, "score": 0, "creation_date": 1533399856, "post_id": 51687168, "comment_id": 90336945, "body": "This does not provide any value to the established answer"}], "tags": [], "owner": {"reputation": 39, "user_id": 10175582, "user_type": "registered", "profile_image": "https://graph.facebook.com/2228422987386019/picture?type=large", "display_name": "Annymosse", "link": "https://stackoverflow.com/users/10175582/annymosse"}, "is_accepted": false, "score": -1, "last_activity_date": 1533397403, "creation_date": 1533397403, "answer_id": 51687168, "question_id": 37503085, "link": "https://stackoverflow.com/questions/37503085/building-for-arm-cannot-do-cross-compilation-with-go-install-when-gobin-is-se/51687168#51687168", "title": "Building for ARM? Cannot do cross-compilation with `go install` when GOBIN is set", "body": "<p><code>env GOOS=android GOARCH=arm64 go build test.go</code> return error</p>\n\n<pre><code># command-line-arguments \n/usr/lib/go-1.10/pkg/tool/linux_amd64/link: running gcc failed: exit status 1\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/usr/bin/x86_64-linux-gnu-ld: /tmp/go-link-711744324/go.o: Relocations in generic ELF (EM: 183)\n/tmp/go-link-711744324/go.o: error adding symbols: File in wrong format\ncollect2: error: ld returned 1 exit status\n</code></pre>\n"}], "owner": {"reputation": 1185, "user_id": 4495663, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/c964625d8b1b0af294b1fcb2dc197f2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jacob Mason", "link": "https://stackoverflow.com/users/4495663/jacob-mason"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9330, "favorite_count": 1, "accepted_answer_id": 37511474, "answer_count": 3, "score": 9, "last_activity_date": 1554469947, "creation_date": 1464464042, "last_edit_date": 1554469947, "question_id": 37503085, "link": "https://stackoverflow.com/questions/37503085/building-for-arm-cannot-do-cross-compilation-with-go-install-when-gobin-is-se", "title": "Building for ARM? Cannot do cross-compilation with `go install` when GOBIN is set", "body": "<p>Whenever I try and use 'go install' after settings goarch, goos and gobin I get 'cannot install cross-compiled binaries when GOBIN is set', but don't understand why?</p>\n\n<p>What's the simplest way to build for arm linux?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464534752, "post_id": 37507041, "comment_id": 62516583, "body": "I don&#39;t have an OSX to confirm, however there&#39;s a big chance that Go dropped support for certain instructions on that old hardware, so you <i>may</i> end up with broken binaries even if it compiles."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1464504268, "creation_date": 1464504268, "answer_id": 37507041, "question_id": 37503054, "link": "https://stackoverflow.com/questions/37503054/what-version-of-go-is-supported-on-osx-10-7-5-lion/37507041#37507041", "title": "What version of Go is supported on OSX 10.7.5 (Lion)", "body": "<p>Go 1.4.2 was the last official release that officially mentioned support for versions of OSX before 10.8. For that release there were two binary packages: one with an <code>osx10.8</code> suffix, and one with an <code>osx10.6</code> suffix.</p>\n\n<p>Already in Go 1.5, only OSX 10.8 was mentioned as being supported. See: <a href=\"https://web.archive.org/web/20150820055435/https://golang.org/dl/\" rel=\"nofollow\">https://web.archive.org/web/20150820055435/https://golang.org/dl/</a></p>\n\n<p>Of course, you can download any version and build it from source, and that's what I'd do if I were stuck with an old version of OSX.</p>\n"}], "owner": {"reputation": 7672, "user_id": 315595, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/4181550f04cd172c045405b1d88d52e2?s=128&d=identicon&r=PG", "display_name": "Jan Hettich", "link": "https://stackoverflow.com/users/315595/jan-hettich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 225, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464504268, "creation_date": 1464463778, "question_id": 37503054, "link": "https://stackoverflow.com/questions/37503054/what-version-of-go-is-supported-on-osx-10-7-5-lion", "title": "What version of Go is supported on OSX 10.7.5 (Lion)", "body": "<p>I have an older MacBook that can't be upgraded past OSX 10.7.5.  What is the latest binary release of the Go tools can I install on it?  According to the <a href=\"https://golang.org/dl/\" rel=\"nofollow\">golang downloads page</a>, the current \"featured\" download (1.6.2) requires OSX 10.8, but for most prior releases, the page doesn't state the OS version compatibility requirements.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1464463894, "post_id": 37503002, "comment_id": 62500905, "body": "This is standard behaviour. The types are not the same, as they are imported in two different Go packages."}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1464464165, "post_id": 37503002, "comment_id": 62500981, "body": "This sounds like a pretty big limitation. What if I need to use some C types in more than one go file? What is your recommendation to make this work?"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1464464711, "post_id": 37503002, "comment_id": 62501142, "body": "You would export <code>C.Point</code> from <code>lib</code> as a new type: <code>type Point C.Point</code>, and <code>lib</code>&#39;s functions to accept that type. However, this requires that your C structs have exported field names (i.e. start with an uppercase letter). If they don&#39;t, you will have to create wrapper Go structs that copy information to and from the C struct."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1464464765, "post_id": 37503002, "comment_id": 62501160, "body": "<a href=\"https://play.golang.org/p/q-oHTRaIlb\" rel=\"nofollow noreferrer\">play.golang.org/p/q-oHTRaIlb</a>"}, {"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1464466155, "post_id": 37503002, "comment_id": 62501520, "body": "Thanks for the sample. Legacy code has got mostly everything with lowercase fields because that&#39;s the way C coders write code. So the trick with type-aliasing won&#39;t work. I am going to see if I can &quot;unsafe cast&quot; in the signature of the functions instead and when I have more time write the proper go bindings. That&#39;s a real bummer."}], "answers": [{"comments": [{"owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1464471185, "post_id": 37503869, "comment_id": 62502872, "body": "Thanks for your answer. Unfortunately, I am using a C library which doesn&#39;t have the capitalized fields in the headers. Therefore your assignments in main() don&#39;t work. I am still investigating if I can unsafe wrap the structs."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "edited": false, "score": 0, "creation_date": 1464476156, "post_id": 37503869, "comment_id": 62503993, "body": "@john-difool : updated with lower case C headers, you need to define new Setter Methods, like sample code."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1464473034, "last_edit_date": 1464473034, "creation_date": 1464470701, "answer_id": 37503869, "question_id": 37503002, "link": "https://stackoverflow.com/questions/37503002/cannot-use-variable-of-type-c-struct-foo-as-type-package-c-struct-foo-when-impor/37503869#37503869", "title": "Cannot use variable of type C.struct_Foo as type package.C.struct_Foo when importing &quot;C&quot; type in two files", "body": "<p>Edit: <strong>with lower case C headers</strong>:<br>\nyou need to define new Setter Methods and\nexport Point from lib like this, it will work:<br>\nworking sample:<br>\nlib.go file:</p>\n\n<pre><code>package lib\n\n/*\ntypedef struct{\n    float x;\n    float y;\n}  point_t;\n*/\nimport \"C\"\n\ntype Point C.point_t\n\nfunc (p *Point) SetX(x float32) {\n    p.x = C.float(x)\n}\n\nfunc (p *Point) SetY(y float32) {\n    p.y = C.float(y)\n}\n\nfunc CheckPoint(pt Point) bool {\n    return pt.x == 1 &amp;&amp; pt.y == 2\n}\n</code></pre>\n\n<p>main.go file:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/john-difool/test/lib\"\n)\n\nfunc main() {\n    var p lib.Point\n\n    p.SetX(1)\n    p.SetY(2)\n    fmt.Println(lib.CheckPoint(p)) //true\n}\n</code></pre>\n\n<p>Old:\nexport Point from lib like this, it will work:<br>\nworking sample:<br>\nlib.go file:</p>\n\n<pre><code>package lib\n\n/*\ntypedef struct{\n    float X;\n    float Y;\n}  Point_t;\n*/\nimport \"C\"\n\ntype Point C.Point_t\n\nfunc CheckPoint(pt Point) bool {\n    return pt.X == 1 &amp;&amp; pt.Y == 2\n}\n</code></pre>\n\n<p>main.go file:  </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n\n    \"github.com/john-difool/test/lib\"\n)\n\nfunc main() {\n    var p lib.Point\n\n    p.X = 1\n    p.Y = 2\n    fmt.Println(lib.CheckPoint(p)) //true\n}\n</code></pre>\n"}], "owner": {"reputation": 4844, "user_id": 666818, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/uixCu.jpg?s=128&g=1", "display_name": "Laurent", "link": "https://stackoverflow.com/users/666818/laurent"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 92, "favorite_count": 0, "accepted_answer_id": 37503869, "answer_count": 1, "score": 0, "last_activity_date": 1464583346, "creation_date": 1464463406, "last_edit_date": 1464583346, "question_id": 37503002, "link": "https://stackoverflow.com/questions/37503002/cannot-use-variable-of-type-c-struct-foo-as-type-package-c-struct-foo-when-impor", "title": "Cannot use variable of type C.struct_Foo as type package.C.struct_Foo when importing &quot;C&quot; type in two files", "body": "<p>Even if I am including the <strong>same</strong> C header file into 2 different go files, I am getting an error as the compiler thinks the types are different. I originally had the header included system-wide (using <code>&lt;&gt;</code> without path location) but that didn't work either.\n<br></p>\n\n<pre><code>// main.go\n\npackage main\n\nimport (\n    \"fmt\"\n    \"github.com/john-difool/test/lib\"\n)\n\n//#include \"lib/types.h\"\nimport \"C\"\n\nfunc main() {\n    var p C.Point\n\n    p.x = 0\n    p.y = 0\n    fmt.Println(lib.CheckPoint(p))\n}\n</code></pre>\n\n<p><br></p>\n\n<pre><code>// lib/lib.go\n\npackage lib\n\n//#include \"types.h\"\nimport \"C\"\n\nfunc CheckPoint(pt C.Point) bool {\n    return true // TOnotDO\n}\n</code></pre>\n\n<p><br></p>\n\n<pre><code>// lib/types.h\n\ntypedef struct Point {\n    float x;\n    float y;\n} Point;\n</code></pre>\n\n<p>This is the error I am getting doing <code>go build</code> at the top level:</p>\n\n<blockquote>\n  <p>cannot use p (type C.struct_Point) as type lib.C.struct_Point in\n  argument to lib.CheckPoint</p>\n</blockquote>\n"}, {"tags": ["pointers", "reflection", "go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464459375, "post_id": 37502355, "comment_id": 62499550, "body": "@BenGuild Yes, but you can call <code>Value.Interface()</code> on the <code>Value</code> returned by <code>Value.Elem()</code>. It&#39;s in the answer, read it."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464460189, "post_id": 37502355, "comment_id": 62499802, "body": "@icza If I do that, then it&#39;s a pointer and if I try to &quot;type assert&quot; it... it says it&#39;s a pointer of that type not the type itself, and we&#39;re back to my original question."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464460252, "post_id": 37502355, "comment_id": 62499822, "body": "@BenGuild Did you try the examples I included in the answer? Click on the <a href=\"https://play.golang.org/p/ApIG-VgS6q\" rel=\"nofollow noreferrer\">Go Playground</a> link to try them. Output is posted as verification."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464460480, "post_id": 37502355, "comment_id": 62499889, "body": "@icza Those work in that example, but I&#39;m getting things like &quot;panic: reflect.Value.Addr of unaddressable value&quot; when I try to cast these back to pointers for later use."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 2, "creation_date": 1464460768, "post_id": 37502355, "comment_id": 62499976, "body": "@BenGuild Then you should post more of your code so that we can tell what&#39;s wrong with it."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464461065, "post_id": 37502355, "comment_id": 62500065, "body": "The problem is that if I call <code>CreateNewItemOfType(returnType)</code> as shown above, then try to take the result of that and pass it as like an <code>&amp;out</code> parameter to another function... it panics with that."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464461172, "post_id": 37502355, "comment_id": 62500106, "body": "However, if I do <code>reflect.New(returnType).Interface()</code> without <code>Elem()</code> in between, it works fine ... yet returns a pointer and I can&#39;t type assert that to its actual type (returnType)... only to a pointer of the returnType. As mentioned in my original question, the compiler panics if I try to turn it from a pointer to a non-pointer, because it thinks it&#39;s an interface not a pointer. It will only let me type assert it to a pointer version of that type at runtime, which I can&#39;t use consistently."}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 1, "creation_date": 1464461261, "post_id": 37502355, "comment_id": 62500126, "body": "@BenGuild Please, show your exact code so that we can help you."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464461309, "post_id": 37502355, "comment_id": 62500139, "body": "OK, please give me a minute."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464465145, "post_id": 37502355, "comment_id": 62501267, "body": "I&#39;ve been struggling to come up with a generic example but I&#39;ve been unsuccessful so far. I&#39;ll post one but it involves a third-party library that is balking at types:"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464465275, "post_id": 37502355, "comment_id": 62501297, "body": "(returnType is passed a custom struct&#39;s type:) <code>structOfReturnType := reflect.New(returnType).Elem().Interface(); err=db.Where(&quot;user=?&quot;, 1).First(structOfReturnType).Error;</code> ... This throws &quot;panic: reflect.Value.Addr of unaddressable value&quot; and involves the <code>GORM</code> library <a href=\"https://github.com/jinzhu/gorm/issues/394\" rel=\"nofollow noreferrer\">github.com/jinzhu/gorm/issues/394</a> ........ If I omit the <code>Elem()</code> call as mentioned above, it works fine but then it&#39;s a pointer and the compiler fails when trying to cast it with an asterisk ( invalid indirect )."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464465993, "post_id": 37502355, "comment_id": 62501481, "body": "Oh, I forgot the &quot;&amp;&quot; in front of <code>structOfReturnType</code> in that, sorry. I think the issue here now is that I have to type assert this as well."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464467217, "post_id": 37502355, "comment_id": 62501842, "body": "OK, I&#39;ve been able to rejigger this a bit with the help of your code. Where I was hitting a snag was trying to pass a pointer myself through an <code>interface {}</code> typed variable to <i>another</i> function... then there&#39;s no way to asterisk that back there without the compiler throwing a panic. Is there a way around that?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464468640, "post_id": 37502355, "comment_id": 62502211, "body": "@BenGuild Yes, there is. <code>Value.Elem()</code> as described. If <code>i</code> is of type <code>interface{}</code> which holds a pointer, then <code>reflect.ValueOf(i).Elem().Interface()</code>."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464475861, "post_id": 37502355, "comment_id": 62503923, "body": "I&#39;m going to fork this question: <a href=\"https://stackoverflow.com/questions/37504458/issue-translating-data-back-from-serialization-into-go-struct-dynamically-using\" title=\"issue translating data back from serialization into go struct dynamically using\">stackoverflow.com/questions/37504458/&hellip;</a> ..."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1584259634, "last_edit_date": 1584259634, "creation_date": 1464459205, "answer_id": 37502355, "question_id": 37502226, "link": "https://stackoverflow.com/questions/37502226/cant-get-reflect-to-not-return-pointers-compiler-panics-on-conversion/37502355#37502355", "title": "Can&#39;t get reflect to not return pointers, compiler panics on conversion?", "body": "<p><a href=\"https://golang.org/pkg/reflect/#New\" rel=\"nofollow noreferrer\"><code>reflect.New()</code></a> creates a new value of the specified type, and returns the <a href=\"https://golang.org/pkg/reflect/#Value\" rel=\"nofollow noreferrer\"><code>reflect.Value</code></a> descriptor of a <em>pointer</em> to that value. You may use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>Value.Elem()</code></a> to \"navigate\" from pointer to pointed value wrapped in a <code>reflect.Value</code>. Then you can call <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> to get the value (struct) as an <code>interface{}</code> value.</p>\n\n<p>If you need a value of concrete type, you may use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow noreferrer\">type assertion</a> to \"extract\" the value wrapped in the <code>interface{}</code> value.</p>\n\n<pre><code>func CreateNewItemOfType(returnType reflect.Type) interface{} {\n    return reflect.New(returnType).Elem().Interface()\n}\n</code></pre>\n\n<p>Testing it:</p>\n\n<pre><code>type Point struct {\n    X, Y int\n}\n\nt := reflect.TypeOf(Point{})\n\ni := CreateNewItemOfType(t) // i is of type interface{}\nfmt.Printf(\"%T %+v\\n\", i, i)\n\npt := i.(Point) // pt is of type Point\nfmt.Printf(\"%T %+v\\n\", pt, pt)\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/ApIG-VgS6q\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>main.Point {X:0 Y:0}\nmain.Point {X:0 Y:0}\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>It is also possible to obtain the non-pointer struct value if <code>Value.Elem()</code> is not used. For that, you need to type-assert the pointer value (of type <code>*Point</code>), then you can dereference the pointer to get the non-pointer. </p>\n\n<p>See this example:</p>\n\n<pre><code>t := reflect.TypeOf(Point{})\npi := reflect.New(t).Interface() // pi is of type interface{}\nfmt.Printf(\"%T %+v\\n\", pi, pi)\n\nppt := pi.(*Point) // pt is of type *Point\nfmt.Printf(\"%T %+v\\n\", ppt, ppt)\n\ni2 := *ppt // i2 is of type Point\nfmt.Printf(\"%T %+v\\n\", i2, i2)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>*main.Point &amp;{X:0 Y:0}\n*main.Point &amp;{X:0 Y:0}\nmain.Point {X:0 Y:0}\n</code></pre>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 37502355, "answer_count": 1, "score": 1, "last_activity_date": 1584259634, "creation_date": 1464458450, "last_edit_date": 1464462339, "question_id": 37502226, "link": "https://stackoverflow.com/questions/37502226/cant-get-reflect-to-not-return-pointers-compiler-panics-on-conversion", "title": "Can&#39;t get reflect to not return pointers, compiler panics on conversion?", "body": "<p>Code written around something like this is causing an issue:</p>\n\n<pre><code>func CreateNewItemOfType(returnType reflect.Type) (interface {}) {\n    return reflect.New(returnType).Interface();\n\n}\n</code></pre>\n\n<p>... How can one actually return a struct of <code>returnType</code> and not a pointer to a struct, as <code>reflect</code> creates here? The compiler builds this fine but panics at run-time, yet will not accept an asterisk in front of the return call here in order to actually return the struct and not a pointer.</p>\n"}, {"tags": ["go", "struct", "rsa", "bigint"], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": true, "score": 2, "last_activity_date": 1464459845, "creation_date": 1464459845, "answer_id": 37502451, "question_id": 37502134, "link": "https://stackoverflow.com/questions/37502134/declaring-type-big-int-overflowing-constant-golang/37502451#37502451", "title": "Declaring type *big.Int overflowing constant golang", "body": "<p>The problem is that Go interprets your literal value as an int. But, it does not really fit into 32 bits, so it fails. However, you can set the value of a <code>big.Int</code> after its creation:</p>\n\n<pre><code>PublicKey.N = big.NewInt(0)\nPublicKey.N.SetBytes([]byte(\"8162962977631249175163884403387595004235353952981629629776312491751638844033875950042353539529\"))\nfmt.Println(N)\n// 8162962977631249175163884403387595004235353952981629629776312491751638844033875950042353539529\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 81, "user_id": 2876575, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/70d5285ca85e41fa711d57e8463fa3d9?s=128&d=identicon&r=PG&f=1", "display_name": "Axx", "link": "https://stackoverflow.com/users/2876575/axx"}, "is_accepted": false, "score": 5, "last_activity_date": 1532845395, "creation_date": 1532845395, "answer_id": 51577804, "question_id": 37502134, "link": "https://stackoverflow.com/questions/37502134/declaring-type-big-int-overflowing-constant-golang/51577804#51577804", "title": "Declaring type *big.Int overflowing constant golang", "body": "<p>The answer from T. Claverie will create a public key but will not set the modulus (PublicKey.N) to the number you see. Instead it will use the character codes of those numbers.</p>\n\n<pre><code>fmt.Print([]byte(\"1\"))\n[49]\n</code></pre>\n\n<p>You can use big.Int.UnmarshalText() to get the key you see in the input string.</p>\n\n<pre><code>PublicKey := new(rsa.PublicKey)\nPublicKey.N = big.NewInt(0)\nPublicKey.N.UnmarshalText([]byte(\"8162962977631249175163884403387595004235353952981629629776312491751638844033875950042353539529\"))\n</code></pre>\n\n<p>You can see the difference here: <a href=\"https://play.golang.org/p/HL6YNdcSubv\" rel=\"noreferrer\">https://play.golang.org/p/HL6YNdcSubv</a></p>\n"}], "owner": {"reputation": 708, "user_id": 3302584, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/19cai.jpg?s=128&g=1", "display_name": "Awn", "link": "https://stackoverflow.com/users/3302584/awn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1874, "favorite_count": 0, "accepted_answer_id": 37502451, "answer_count": 2, "score": 0, "last_activity_date": 1532845395, "creation_date": 1464457836, "last_edit_date": 1464459274, "question_id": 37502134, "link": "https://stackoverflow.com/questions/37502134/declaring-type-big-int-overflowing-constant-golang", "title": "Declaring type *big.Int overflowing constant golang", "body": "<p>Generating a keypair using the crypto/rsa package is trivial, but declaring it yourself is a pain.</p>\n\n<p>I'm trying to declare a variable of type rsa.PublicKey, which is defined as:</p>\n\n<pre><code>type PublicKey struct {\n        N *big.Int // modulus\n        E int      // public exponent\n}\n</code></pre>\n\n<p>I've tried a hundred and three methods, but my code currently looks like:</p>\n\n<pre><code>PublicKey := new(rsa.PublicKey)\n\nPublicKey.N = 816296297763124917516388440338759500423535395290623239231731567955308683122890408110917894172120047293936355563865250296188045077627313515614945465389856882915690164742049821466713295090362914686221827012330520911241180940331170800129566133563943306086709509374426793735798983196271063876215936717347200817820685489907456621846519078704338901417077754153251584919148131668369473222078960469749879767829241702858598298315759777245767370065542249841401685747514693845945420663931515035586797756896017462499826100826469085345198490755785708882569397123671313993933597159332140624225622926365258472081852103795720495728779491860405409429756519754432759030127289255409541378096471189783136441306888685144178712329637014132885623358066824356187044819578205172698506597932578231190886063535262514544569054747443504586895362356519252402500104155389876467086444850150261677007183689594568339805440756958346151465691221654766132846717117978938197863452998630570321897641091974200100764524637808876854013287571133384735164135339783262769321526997252096927500094807456840263828514476848496064212933462545940124330314474126636272733109787671957872657823289210871868354885730638093964892263227561606744192311648252923260065974092128743259979645799\n\nPublicKey.E = 65537\n</code></pre>\n\n<p>I get this error:</p>\n\n<pre><code>./main.go:21: constant too large: 816296297763124917516388440338759500423535395290623239231731567955308683122890408110917894172120047293936355563865250296188045077627313515614945465389856882915690164742049821466713295090362914686221827012330520911241180940331170800129566133563943306086709509374426793735798983196271063876215936717347200817820685489907456621846519078704338901417077754153251584919148131668369473222078960469749879767829241702858598298315759777245767370065542249841401685747514693845945420663931515035586797756896017462499826100826469085345198490755785708882569397123671313993933597159332140624225622926365258472081852103795720495728779491860405409429756519754432759030127289255409541378096471189783136441306888685144178712329637014132885623358066824356187044819578205172698506597932578231190886063535262514544569054747443504586895362356519252402500104155389876467086444850150261677007183689594568339805440756958346151465691221654766132846717117978938197863452998630570321897641091974200100764524637808876854013287571133384735164135339783262769321526997252096927500094807456840263828514476848496064212933462545940124330314474126636272733109787671957872657823289210871868354885730638093964892263227561606744192311648252923260065974092128743259979645799\n./main.go:21: overflow in constant\n./main.go:21: cannot use 0 (type int) as type *big.Int in assignment\n</code></pre>\n\n<p>Any help?</p>\n"}, {"tags": ["postgresql", "go"], "answers": [{"comments": [{"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464458496, "post_id": 37502088, "comment_id": 62499278, "body": "Thanks! For my own education - That makes sense, but isn&#39;t it an inefficient operation? If my database has several thousand records it will expand/append to the slice several thousand times. I know modifying the slice itself is a quick operation since it&#39;s just a fixed reference to an underlying array, but it will still have to expand the underlying array several thousand times."}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 4, "creation_date": 1464459479, "post_id": 37502088, "comment_id": 62499578, "body": "The standard algorithm to do this efficiently (which I assume <code>append</code> uses some variation of) is double the length of the underlying array every time you reallocate. This way, for <i>n</i> append operations, you perform only <i>log(n)</i> allocations, and you allocate approximately <i>2n</i> memory. Thus, the amount of space you allocate is linear in the number of append operations."}, {"owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "edited": false, "score": 0, "creation_date": 1464466564, "post_id": 37502088, "comment_id": 62501634, "body": "Ah yes, that does seem a lot more efficient. I marked your answer as accepted, much appreciated :)"}, {"owner": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "edited": false, "score": 0, "creation_date": 1561730294, "post_id": 37502088, "comment_id": 100170674, "body": "@joshlf can you please elaborate further on that comment?"}, {"owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "reply_to_user": {"reputation": 379, "user_id": 2918731, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/6mtoN.png?s=128&g=1", "display_name": "TheLebDev", "link": "https://stackoverflow.com/users/2918731/thelebdev"}, "edited": false, "score": 0, "creation_date": 1561834435, "post_id": 37502088, "comment_id": 100193102, "body": "@Chris There&#39;s a pretty good explanation of the doubling algorithm - and why it&#39;s more efficient if you&#39;re appending many items - in this article: <a href=\"https://www.interviewcake.com/concept/java/dynamic-array-amortized-analysis\" rel=\"nofollow noreferrer\">interviewcake.com/concept/java/dynamic-array-amortized-analy&zwnj;&#8203;sis</a>"}], "tags": [], "owner": {"reputation": 16549, "user_id": 836390, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/tNl4E.jpg?s=128&g=1", "display_name": "joshlf", "link": "https://stackoverflow.com/users/836390/joshlf"}, "is_accepted": true, "score": 18, "last_activity_date": 1464457585, "creation_date": 1464457585, "answer_id": 37502088, "question_id": 37501601, "link": "https://stackoverflow.com/questions/37501601/creating-an-array-slice-to-store-db-query-results-in-golang/37502088#37502088", "title": "Creating an array/slice to store DB Query results in Golang", "body": "<p>Go has a built-in <code>append</code> function for exactly this purpose. It takes a slice and one or more elements and appends those elements to the slice, returning the new slice. Additionally, the zero value of a slice (<code>nil</code>) is a slice of length zero, so if you append to a nil slice, it will work. Thus, you can do:</p>\n\n<pre><code>type User struct {\n    Id    int\n    Title string\n}\n\nfunc Find_users(db *sql.DB) {\n    // Query the DB\n    rows, err := db.Query(`SELECT u.id, u.title FROM users u;`)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    var users []User\n    for rows.Next() {\n        err := rows.Scan(&amp;id, &amp;title)\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        log.Println(id, title)\n        users = append(users, User{Id: id, Title: title})\n    }\n    if err := rows.Err(); err != nil {\n        log.Fatal(err)\n    }\n\n    // ...\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 422, "user_id": 7327955, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Te8cv.jpg?s=128&g=1", "display_name": "Eds_k", "link": "https://stackoverflow.com/users/7327955/eds-k"}, "is_accepted": false, "score": 3, "last_activity_date": 1558701388, "last_edit_date": 1558701388, "creation_date": 1534868578, "answer_id": 51952960, "question_id": 37501601, "link": "https://stackoverflow.com/questions/37501601/creating-an-array-slice-to-store-db-query-results-in-golang/51952960#51952960", "title": "Creating an array/slice to store DB Query results in Golang", "body": "<p>User appending to a slice:</p>\n\n<pre><code>type DeviceInfo struct {\n     DeviceName     string\n     DeviceID       string\n     DeviceUsername string\n     Token          string\n}\n\nfunc QueryMultiple(db *sql.DB){\n    var device DeviceInfo\n    sqlStatement := `SELECT \"deviceName\", \"deviceID\", \"deviceUsername\", \n                 token FROM devices LIMIT 10`\n    rows, err := db.Query(sqlStatement)\n    if err != nil {\n       panic(err)\n    }\n    defer rows.Close()\n    var deviceSlice []DeviceInfo\n    for rows.Next(){\n        rows.Scan(&amp;device.DeviceID, &amp;device.DeviceUsername, &amp;device.Token, \n                  &amp;device.DeviceName)\n         deviceSlice = append(deviceSlice, device)\n    }\n    fmt.Println(deviceSlice)\n}\n</code></pre>\n"}], "owner": {"reputation": 7734, "user_id": 2490003, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/3dRD0.png?s=128&g=1", "display_name": "user2490003", "link": "https://stackoverflow.com/users/2490003/user2490003"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12864, "favorite_count": 2, "accepted_answer_id": 37502088, "answer_count": 2, "score": 10, "last_activity_date": 1558701388, "creation_date": 1464454444, "question_id": 37501601, "link": "https://stackoverflow.com/questions/37501601/creating-an-array-slice-to-store-db-query-results-in-golang", "title": "Creating an array/slice to store DB Query results in Golang", "body": "<p>I'm just getting started with golang and I'm attempting to read several rows from a Postgres <code>users</code> table and store the result as an array of <code>User</code> structs that model the row. </p>\n\n<pre><code>type User struct {\n    Id  int\n    Title string\n}\n\nfunc Find_users(db *sql.DB) {\n    // Query the DB\n    rows, err := db.Query(`SELECT u.id, u.title FROM users u;`)\n    if err != nil { log.Fatal(err) }\n\n    // Initialize array slice of all users. What size do I use here? \n    // I don't know the number of results beforehand\n    var users = make([]User, ????)\n\n    // Loop through each result record, creating a User struct for each row\n    defer rows.Close()\n    for i := 0; rows.Next(); i++ {\n        err := rows.Scan(&amp;id, &amp;title)\n        if err != nil { log.Fatal(err) }\n\n        log.Println(id, title)\n        users[i] = User{Id: id, Title: title}\n    }\n\n    // .... do stuff\n}\n</code></pre>\n\n<p>As you can see, my problem is that I want to initialize an array or slice beforehand to store all the DB records, but I don't know ahead of time how many records there are going to be. </p>\n\n<p>I was weighing a few different approaches, and wanted to find out which of the following was most used in the golang community - </p>\n\n<ol>\n<li><p>Create a really large array beforehand (e.g. 10,000 elements). Seems wasteful</p></li>\n<li><p>Count the rows explicitly beforehand. This could work, but I need to run 2 queries - one to count and one to get the results. If my query is complex (not shown here), that's duplicating that logic in 2 places. Alternatively I can run the same query twice, but first loop through it and count the rows. All this would work, but it just seems unclean. </p></li>\n<li><p>I've seen examples of expanding slices. I don't quite understand slices well enough to see how it could be adapted here. Also if I'm constantly expanding a slice 10k times, it definitely seems wasteful. </p></li>\n</ol>\n\n<p>Thanks!</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ec2", "docker"], "comments": [{"owner": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1464453806, "post_id": 37501466, "comment_id": 62497796, "body": "You&#39;re saying that you can&#39;t hit 127.0.0.1:9700?"}, {"owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1464454052, "post_id": 37501466, "comment_id": 62497871, "body": "Hello, Yes i cant access 127.0.0.1:9700, i tried with curl( addedd http:// ), tried ping, tried telnet. Connection reset by peer."}, {"owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "reply_to_user": {"reputation": 251753, "user_id": 129570, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/aa98a2c5baceef5ffcaf95fdde12b8fb?s=128&d=identicon&r=PG", "display_name": "Oliver Charlesworth", "link": "https://stackoverflow.com/users/129570/oliver-charlesworth"}, "edited": false, "score": 0, "creation_date": 1464455215, "post_id": 37501466, "comment_id": 62498188, "body": "@OliverCharlesworth Any ideas ?"}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 0, "creation_date": 1464493396, "post_id": 37501466, "comment_id": 62506507, "body": "Try checking on what interface it listens by running this command: netstat -a -n |grep 9700"}, {"owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "edited": false, "score": 0, "creation_date": 1464493581, "post_id": 37501466, "comment_id": 62506535, "body": "And before you can connect to it from outside, you should make sure it listens on ec2&#39;s external interface, not just on localhost."}], "answers": [{"comments": [{"owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "edited": false, "score": 0, "creation_date": 1464460650, "post_id": 37502086, "comment_id": 62499937, "body": "Sorry, for some reason the address got cut out of that last paragraph - you should be able to access the server at: your_public_ip:9700"}, {"owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464590214, "post_id": 37502086, "comment_id": 62530997, "body": "This does not work.  I already had set the permisions of security group.  But thanks for reply."}, {"owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "reply_to_user": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "edited": false, "score": 0, "creation_date": 1464627229, "post_id": 37502086, "comment_id": 62551603, "body": "I disagree. I literally set up an EC2 instance pulled the code and ran it. I had to edit the security group in order to access it from outside the AWS instance - and then it worked just fine. Check that your inbound rules are set appropriately."}], "tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": false, "score": 2, "last_activity_date": 1464457577, "creation_date": 1464457577, "answer_id": 37502086, "question_id": 37501466, "link": "https://stackoverflow.com/questions/37501466/docker-cant-access-docker-port-from-outside/37502086#37502086", "title": "Docker - Cant access docker port from outside", "body": "<p>127.0.0.1 is the loopback address for the local (EC2) instance. I just recreated your problem following the same instructions and setting up the server in a docker container on an EC2 instance.</p>\n\n<p>If you open another ssh session to your EC2 instance you CAN curl the loopback address, which just spits out the HTML shown below. \n<div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;title&gt;\r\n      Common Search\r\n    &lt;/title&gt;&lt;meta content=\"/apple-touch-icon-precomposed.png\" itemprop=\"image\"&gt;&lt;link href=\"/favicon.ico\" rel=\"shortcut icon\"&gt;&lt;!-- CSS: This will be replaced in templates.go:preprocessTemplate() by the inline, compiled CSS\r\n              if the file build/static/css/index.css exists --&gt;&lt;link rel=\"stylesheet\" href=\"/css/global.css\"/&gt;&lt;link rel=\"stylesheet\" href=\"/css/header.css\"/&gt;&lt;link rel=\"stylesheet\" href=\"/css/footer.css\"/&gt;&lt;link rel=\"stylesheet\" href=\"/css/hits.css\"/&gt;&lt;link rel=\"stylesheet\" href=\"/css/responsive.css\"/&gt;&lt;!-- ENDCSS --&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1\"&gt;&lt;/head&gt;&lt;body  class=\"full\"&gt;&lt;header id=\"h\"&gt;&lt;div class=\"about\"&gt;&lt;a href=\"https://about.commonsearch.org/\" tabindex=\"1\"&gt;About&lt;/a&gt;&lt;/div&gt;&lt;form id=\"f\" action=\"/\" method=\"GET\" data-init=\"{&amp;#34;q&amp;#34;:&amp;#34;&amp;#34;,&amp;#34;p&amp;#34;:1,&amp;#34;g&amp;#34;:&amp;#34;&amp;#34;}\"&gt;&lt;a href=\"/\" id=\"logo\" tabindex=\"2\"&gt;Common Search&lt;/a&gt;&lt;div id=\"w\"&gt;&lt;div id=\"qw\"&gt;&lt;input id=\"q\" name=\"q\" type=\"text\" size=\"60\" value=\"\" autofocus tabindex=\"3\"/&gt;&lt;/div&gt;&lt;span id=\"g\"&gt;&lt;select name=\"g\" tabindex=\"4\"&gt;&lt;option  value=\"ar\"&gt;AR&lt;/option&gt;&lt;option  value=\"de\"&gt;DE&lt;/option&gt;&lt;option selected value=\"en\"&gt;EN&lt;/option&gt;&lt;option  value=\"es\"&gt;ES&lt;/option&gt;&lt;option  value=\"fr\"&gt;FR&lt;/option&gt;&lt;option  value=\"it\"&gt;IT&lt;/option&gt;&lt;option  value=\"ja\"&gt;JA&lt;/option&gt;&lt;option  value=\"ko\"&gt;KO&lt;/option&gt;&lt;option  value=\"nl\"&gt;NL&lt;/option&gt;&lt;option  value=\"pl\"&gt;PL&lt;/option&gt;&lt;option  value=\"pt\"&gt;PT&lt;/option&gt;&lt;option  value=\"ru\"&gt;RU&lt;/option&gt;&lt;option  value=\"vi\"&gt;VI&lt;/option&gt;&lt;option  value=\"zh\"&gt;ZH&lt;/option&gt;&lt;option  value=\"all\"&gt;ALL&lt;/option&gt;&lt;/select&gt;&lt;/span&gt;&lt;input id=\"s\" type=\"submit\" value=\"&amp;#x1f50d;\" tabindex=\"5\"/&gt;&lt;/div&gt;&lt;/form&gt;&lt;/header&gt;&lt;div id=\"hits\"&gt;&lt;/div&gt;&lt;div id=\"dbg\"&gt;&lt;/div&gt;&lt;div id=\"pager\" data-page=\"1\"&gt;&lt;/div&gt;&lt;script src=\"/js/index.js\" type=\"text/javascript\"&gt;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>However I doubt this is what you actually want..</p>\n\n<p>If you want to be able to access the hosted server from your (or any other) computer you need to edit the security group for your EC2 instance.</p>\n\n<p>From the nav bar on the left side of the AWS console, select Network &amp; Security -> Security Groups. Select the security group that applies to your current EC2 instance (assuming you made it with the launch wizard, it will have a name like: 'launch-wizard-1 created 2016-05-28T12:57:23.487-04:00'). In the lower half of the console, select the Inbound tab. Edit a new rule to allow TCP on port 9700 from any (or a specific range of) IP(s). The resulting entry should look something like this:<a href=\"https://i.stack.imgur.com/6WmO7.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6WmO7.png\" alt=\"AWS Security Group Rule Example\"></a> </p>\n\n<p>My TCP rule is set up to allow inbound traffic from ANY IP address on that port, you may want to configure it differently for security purposes.</p>\n\n<p>Once the rule is set up, you should be able to access the web server at the public IP of your EC2 instance (which can be found on the Instances page of the AWS console). The address you should access should be :9700</p>\n\n<p>Hope this helps!</p>\n"}, {"tags": [], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "is_accepted": true, "score": 6, "last_activity_date": 1464615831, "last_edit_date": 1464615831, "creation_date": 1464590539, "answer_id": 37519174, "question_id": 37501466, "link": "https://stackoverflow.com/questions/37501466/docker-cant-access-docker-port-from-outside/37519174#37519174", "title": "Docker - Cant access docker port from outside", "body": "<p>I made a issue at github as swell and one guy saved the day.</p>\n\n<p>Here's he's response:</p>\n\n<p>Server listening on 127.0.0.1:9700\nYour application is listening on localhost. localhost is scoped to the container itself. Thus to be able to connect to it, you would have to be inside the container.\nTo fix, you need to get your application to listen on 0.0.0.0 instead.</p>\n"}], "owner": {"reputation": 1506, "user_id": 2831700, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/5e40a909ecdd6e94a32e120c0044ac9d?s=128&d=identicon&r=PG", "display_name": "IvRRimUm", "link": "https://stackoverflow.com/users/2831700/ivrrimum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2502, "favorite_count": 1, "accepted_answer_id": 37519174, "answer_count": 2, "score": 3, "last_activity_date": 1571603445, "creation_date": 1464453558, "last_edit_date": 1464454824, "question_id": 37501466, "link": "https://stackoverflow.com/questions/37501466/docker-cant-access-docker-port-from-outside", "title": "Docker - Cant access docker port from outside", "body": "<p>So i created a new EC2 Instance and installed docker on it.</p>\n\n<p>I deployed code from ( <a href=\"https://github.com/commonsearch/cosr-front/blob/master/INSTALL.md\" rel=\"nofollow\">https://github.com/commonsearch/cosr-front/blob/master/INSTALL.md</a> ) and followed install instructions.</p>\n\n<p>Install was successfull and i started the server:</p>\n\n<pre><code>[ec2-user@ip-172-30-0-127 cosr-front]$ make docker_devserver\ndocker run -e DOCKER_HOST --rm -v \"/home/ec2-user/cosr-front:/go/src/github.com/commonsearch/cosr-front:rw\" -w /go/src/github.com/commonsearch/cosr-front -p 9700:9700 -i -t commonsearch/local-front make devserver\nmkdir -p build\ngo build -o build/cosr-front.bin ./server\nGODEBUG=gctrace=1 COSR_DEBUG=1 ./build/cosr-front.bin\n2016/05/28 16:32:38 Using Docker host IP: 172.17.0.1\n2016/05/28 16:32:38 Server listening on 127.0.0.1:9700 - You should open http://127.0.0.1:9700 in your browser!\n</code></pre>\n\n<p>Well, now when i want to access it from outside, i cant! Not even curl the local server.</p>\n\n<p>When i run <code>docker ps</code> it gives me correct port forwarding: </p>\n\n<pre><code>[ec2-user@ip-172-30-0-127 ~]$ docker ps\nCONTAINER ID        IMAGE                                       COMMAND                  CREATED             STATUS              PORTS                                              NAMES\n1a9f77e1eeb1        commonsearch/local-front                    \"make devserver\"         4 minutes ago       Up 4 minutes        0.0.0.0:9700-&gt;9700/tcp                             stoic_hopper\n9ff00fe3e70d        commonsearch/local-elasticsearch-devindex   \"/docker-entrypoint.s\"   4 minutes ago       Up 4 minutes        0.0.0.0:39200-&gt;9200/tcp, 0.0.0.0:39300-&gt;9300/tcp   kickass_wilson\n</code></pre>\n\n<p>These are my docker images:</p>\n\n<pre><code>REPOSITORY                                  TAG                 IMAGE ID            CREATED             VIRTUAL SIZE\n&lt;none&gt;                                      &lt;none&gt;              3e205118cd3f        17 minutes ago      853.3 MB\n&lt;none&gt;                                      &lt;none&gt;              1d233da1fa59        2 hours ago         955.7 MB\ndebian                                      jessie              ce58426c830c        4 days ago          125.1 MB\ncommonsearch/local-front                    latest              30de7ab48d43        7 weeks ago         1.024 GB\ncommonsearch/local-elasticsearch-devindex   latest              b1156ada5a24        11 weeks ago        383.2 MB\ncommonsearch/local-elasticsearch            latest              808e72f49b4a        3 months ago        355.2 MB\n</code></pre>\n\n<p>I have tryed disabling ipv6 and all kind of nonsense google offered me, but without success.</p>\n\n<p>Any ideas ?</p>\n\n<p>EDIT:</p>\n\n<p>Also, if i enter the docker container for frontend( using docker exec ), then I CAN PING AND CULR the frontend.</p>\n\n<p>But i cant from the outside( nor ssh, not from my home pc using browser ).</p>\n\n<p>Also my docker version:</p>\n\n<pre><code>Client:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.2\n Git commit:   a34a1d5/1.9.1\n Built:        \n OS/Arch:      linux/amd64\n\nServer:\n Version:      1.9.1\n API version:  1.21\n Go version:   go1.4.2\n Git commit:   a34a1d5/1.9.1\n Built:        \n OS/Arch:      linux/amd64\n</code></pre>\n"}, {"tags": ["c++", "mysql", "performance", "go"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464486048, "post_id": 37500878, "comment_id": 62505641, "body": "Does it help if you change <code>relations := []Relation{}</code> to <code>relations := make([]Relation, 0, 131123541)</code> (Just testing a theory) also  which version of Go are you using?"}, {"owner": {"reputation": 459, "user_id": 1004737, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VpPpI.jpg?s=128&g=1", "display_name": "pyanfield", "link": "https://stackoverflow.com/users/1004737/pyanfield"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464493204, "post_id": 37500878, "comment_id": 62506479, "body": "The Go version is 1.6. And I have tried that just as you mentioned, but the result is not improved obviously."}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "edited": false, "score": 0, "creation_date": 1465102814, "post_id": 37500878, "comment_id": 62757728, "body": "Be sure to time it twice -- the first time would be slow due to I/O; the second time might be faster due to caching."}, {"owner": {"reputation": 524, "user_id": 3767643, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/3cc0a74b12a5aee091191468790d9c8a?s=128&d=identicon&r=PG&f=1", "display_name": "user3767643", "link": "https://stackoverflow.com/users/3767643/user3767643"}, "edited": false, "score": 0, "creation_date": 1562987790, "post_id": 37500878, "comment_id": 100563325, "body": "Offtopic: @pyanfield what is your server RAM &amp; CPU specification."}], "answers": [{"comments": [{"owner": {"reputation": 459, "user_id": 1004737, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VpPpI.jpg?s=128&g=1", "display_name": "pyanfield", "link": "https://stackoverflow.com/users/1004737/pyanfield"}, "edited": false, "score": 0, "creation_date": 1464493354, "post_id": 37501033, "comment_id": 62506501, "body": "Thanks for your comments. I tested it again with <code>runtime.GOMAXPROCS(1)</code>. It costs almost 2min 25s."}], "tags": [], "owner": {"reputation": 141, "user_id": 6340066, "user_type": "registered", "profile_image": "https://graph.facebook.com/10207551318599538/picture?type=large", "display_name": "Joey Yandle", "link": "https://stackoverflow.com/users/6340066/joey-yandle"}, "is_accepted": false, "score": 0, "last_activity_date": 1464450646, "creation_date": 1464450646, "answer_id": 37501033, "question_id": 37500878, "link": "https://stackoverflow.com/questions/37500878/huge-performance-difference-query-mysql-database-with-same-golang-snippet/37501033#37501033", "title": "Huge performance difference query mysql database with same golang snippet", "body": "<p>Golang is likely running the DB query processing more in parallel for the snippet alone.  Your complete application is almost certainly using some of those cores for other things.  </p>\n\n<p>The loop where you process all 130M rows seems the likely culprit.</p>\n\n<p>Try setting the max procs to 1 in the snippet if you want to test this theory.</p>\n"}, {"tags": [], "owner": {"reputation": 459, "user_id": 1004737, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VpPpI.jpg?s=128&g=1", "display_name": "pyanfield", "link": "https://stackoverflow.com/users/1004737/pyanfield"}, "is_accepted": true, "score": 2, "last_activity_date": 1464747174, "creation_date": 1464747174, "answer_id": 37558363, "question_id": 37500878, "link": "https://stackoverflow.com/questions/37500878/huge-performance-difference-query-mysql-database-with-same-golang-snippet/37558363#37558363", "title": "Huge performance difference query mysql database with same golang snippet", "body": "<p>I got my answer and want to share it. This is caused by my mistake. Sometimes ago, I tried to add memory profile and set <code>runtime. MemProfileRate=1</code> in my <code>init</code> method. But I forgot to reset it to a reasonable value. I ignored this method when I checked my code every time. After removing this setting from my project, it returns to normal, and spend almost 5~6mins to query these 130M datas. The speed is pretty close to the C++ version. My advise is that please carefully when you set <code>runtime.MemProfileRate=1</code> unless you make sure you want to do that, and remember to reset it back.</p>\n"}], "owner": {"reputation": 459, "user_id": 1004737, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/VpPpI.jpg?s=128&g=1", "display_name": "pyanfield", "link": "https://stackoverflow.com/users/1004737/pyanfield"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2852, "favorite_count": 0, "accepted_answer_id": 37558363, "answer_count": 2, "score": -1, "last_activity_date": 1464747174, "creation_date": 1464449704, "last_edit_date": 1464494058, "question_id": 37500878, "link": "https://stackoverflow.com/questions/37500878/huge-performance-difference-query-mysql-database-with-same-golang-snippet", "title": "Huge performance difference query mysql database with same golang snippet", "body": "<p>I reimplement my project with golang recently. The project was implemented with C++. When I finished the code and have a performance test. I'm shocked by the result. When I query the database with C++, I can get the 130 million rows result in 5 mins. But with golang, it's almost 45 mins. But when I separate the code from the project and build the code snippet, it's finished in 2mins. Why does they have so much huge difference performance result?</p>\n\n<p>My code snippet :\n<a href=\"https://gist.github.com/pyanfield/2651d23311901b33c5723b7de2364148\" rel=\"nofollow\">https://gist.github.com/pyanfield/2651d23311901b33c5723b7de2364148</a></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"runtime\"\n    \"strconv\"\n    \"time\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc main() {\n    runtime.GOMAXPROCS(runtime.NumCPU())\n    // defer profile.Start(profile.CPUProfile, profile.ProfilePath(\".\")).Stop()\n    dbRead, err := connectDB(\"test:test@tcp(127.0.0.1:3306)/test_oltp?charset=utf8&amp;readTimeout=600s&amp;writeTimeout=600s\")\n    if err != nil {\n        fmt.Printf(\"Error happend when connecting to DB. %s\\n\", err.Error())\n        return\n    }\n    defer dbRead.Close()\n    dbRead.SetMaxIdleConns(0)\n    dbRead.SetMaxOpenConns(100)\n\n    query := fmt.Sprintf(\"WHERE company_id in (11,22,33,44,55,66,77,88,99,00,111,222,333,4444,555,666,777,888,999)\")\n\n    relations := getRelations(dbRead, query)\n}\nfunc connectDB(addr string) (*sql.DB, error) {\n    db, err := sql.Open(\"mysql\", addr)\n    if err != nil {\n        return nil, err\n    }\n    if err = db.Ping(); err != nil {\n        return nil, err\n    }\n    return db, nil\n}\n\ntype Relation struct {\n    childId  int64 \n    parentId int64 \n}\n\nfunc getRelations(db *sql.DB, where string)[]Relation {\n    begin := time.Now()\n\n    var err error\n    var rows *sql.Rows\n    query := fmt.Sprintf(\"SELECT `child_id`, `parent_id` FROM `test_relations` %s\", where)\n    rows, err = db.Query(query)\n    if err != nil {\n        fmt.Println(\"query error:\", err.Error())\n        return nil\n    }\n    defer rows.Close()\n\n    columns, err := rows.Columns()\n    buffer := make([]sql.RawBytes, len(columns))\n    scanArgs := make([]interface{}, len(buffer))\n    for i := range scanArgs {\n        scanArgs[i] = &amp;buffer[i]\n    }\n\n    relations := []Relation{}\n    relation := Relation{}\n    for rows.Next() {\n        if err = rows.Scan(scanArgs...); err != nil {\n            fmt.Println(\"scan:\", err.Error())\n            return nil\n        }\n        relation.parentId, _ = strconv.ParseInt(string(buffer[1]), 10, 64)\n        relation.childId, _ = strconv.ParseInt(string(buffer[0]), 10, 64)\n\n        relations = append(relations, relation)\n    }\n\n    if err = rows.Err(); err != nil {\n        fmt.Println(\"next error:\", err.Error())\n        return nil\n    }\n    fmt.Printf(\"&gt;&gt;&gt; getRelations cost: %s\\n\", time.Since(begin).String())\n    // output :&gt;&gt;&gt; getRelations cost:1m45.791047s\n    return relations\n    // len(relations): 131123541\n}\n</code></pre>\n\n<p><strong>Update:</strong>\nMy go version is 1.6. The cpu profile I got are as below:\nThe Code Snippet profile top20:</p>\n\n<pre><code>    75.67s of 96.82s total (78.16%)\nDropped 109 nodes (cum &lt;= 0.48s)\nShowing top 20 nodes out of 82 (cum &gt;= 12.04s)\n      flat  flat%   sum%        cum   cum%\n    11.85s 12.24% 12.24%     11.85s 12.24%  runtime.memmove\n    10.28s 10.62% 22.86%     20.01s 20.67%  runtime.mallocgc\n     5.82s  6.01% 28.87%      5.82s  6.01%  strconv.ParseUint\n     5.79s  5.98% 34.85%      5.79s  5.98%  runtime.futex\n     3.42s  3.53% 38.38%     10.28s 10.62%  github.com/go-sql-driver/mysql.(*buffer).readNext\n     3.42s  3.53% 41.91%      6.38s  6.59%  runtime.scang\n     3.37s  3.48% 45.39%     36.97s 38.18%  github.com/go-sql-driver/mysql.(*textRows).readRow\n     3.37s  3.48% 48.87%      3.37s  3.48%  runtime.memclr\n     3.20s  3.31% 52.18%      3.20s  3.31%  runtime.heapBitsSetType\n     3.02s  3.12% 55.30%      7.36s  7.60%  database/sql.convertAssign\n     2.96s  3.06% 58.36%      3.02s  3.12%  runtime.(*mspan).sweep.func1\n     2.53s  2.61% 60.97%      2.53s  2.61%  runtime._ExternalCode\n     2.39s  2.47% 63.44%      2.96s  3.06%  runtime.readgstatus\n     2.24s  2.31% 65.75%      8.06s  8.32%  strconv.ParseInt\n     2.21s  2.28% 68.03%      5.24s  5.41%  runtime.heapBitsSweepSpan\n     2.15s  2.22% 70.25%      7.68s  7.93%  runtime.rawstring\n     2.06s  2.13% 72.38%      3.18s  3.28%  github.com/go-sql-driver/mysql.readLengthEncodedString\n     1.95s  2.01% 74.40%     12.23s 12.63%  github.com/go-sql-driver/mysql.(*mysqlConn).readPacket\n     1.83s  1.89% 76.29%     79.42s 82.03%  main.Relations\n     1.81s  1.87% 78.16%     12.04s 12.44%  runtime.slicebytetostring\n</code></pre>\n\n<p>The project cpu profile top20:</p>\n\n<pre><code>     (pprof) top20\n38.71mins of 42.82mins total (90.40%)\nDropped 334 nodes (cum &lt;= 0.21mins)\nShowing top 20 nodes out of 76 (cum &gt;= 1.35mins)\n      flat  flat%   sum%        cum   cum%\n 12.02mins 28.07% 28.07%  12.48mins 29.15%  runtime.addspecial\n  5.95mins 13.89% 41.96%  15.08mins 35.21%  runtime.pcvalue\n  5.26mins 12.29% 54.25%   5.26mins 12.29%  runtime.readvarint\n  2.60mins  6.08% 60.32%   7.87mins 18.37%  runtime.step\n  1.98mins  4.62% 64.94%  19.45mins 45.43%  runtime.gentraceback\n  1.65mins  3.86% 68.80%   1.65mins  3.86%  runtime/internal/atomic.Xchg\n  1.57mins  3.66% 72.46%   2.93mins  6.84%  runtime.(*mspan).sweep\n  1.52mins  3.54% 76.01%   1.78mins  4.15%  runtime.findfunc\n  1.41mins  3.30% 79.31%   1.42mins  3.31%  runtime.markrootSpans\n  1.13mins  2.64% 81.95%   1.13mins  2.64%  runtime.(*fixalloc).alloc\n  0.64mins  1.50% 83.45%   0.64mins  1.50%  runtime.duffcopy\n  0.46mins  1.08% 84.53%   0.46mins  1.08%  runtime.findmoduledatap\n  0.44mins  1.02% 85.55%   0.44mins  1.02%  runtime.fastrand1\n  0.42mins  0.97% 86.52%  15.49mins 36.18%  runtime.funcspdelta\n  0.38mins  0.89% 87.41%  36.02mins 84.13%  runtime.mallocgc\n  0.30mins   0.7% 88.12%   0.78mins  1.83%  runtime.scanobject\n  0.26mins   0.6% 88.72%   0.32mins  0.74%  runtime.stkbucket\n  0.26mins   0.6% 89.32%   0.26mins   0.6%  runtime.memmove\n  0.23mins  0.55% 89.86%   0.23mins  0.55%  runtime.heapBitsForObject\n  0.23mins  0.53% 90.40%   1.35mins  3.15%  runtime.lock\n</code></pre>\n"}, {"tags": ["python", "file-io", "go", "attributes", "metadata"], "comments": [{"owner": {"reputation": 595, "user_id": 1107942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f0f0f1c9e4088e7a36872dd95f13d8?s=128&d=identicon&r=PG", "display_name": "MrSaints", "link": "https://stackoverflow.com/users/1107942/mrsaints"}, "edited": false, "score": 0, "creation_date": 1464449655, "post_id": 37500810, "comment_id": 62496496, "body": "If you&#39;re looking to detect a wide range of content types, what you really need is something like: <a href=\"https://tika.apache.org/\" rel=\"nofollow noreferrer\">tika.apache.org</a>. Otherwise, Go HTTP pkg has a basic <code>DetectContentType</code> that can pick up on some MIME types. Most of the time you&#39;ll have to rely on the file headers or the extension for type detection (there are packages for this)."}, {"owner": {"reputation": 320, "user_id": 3529271, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NmPnP.jpg?s=128&g=1", "display_name": "Mr. Foots", "link": "https://stackoverflow.com/users/3529271/mr-foots"}, "reply_to_user": {"reputation": 595, "user_id": 1107942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18f0f0f1c9e4088e7a36872dd95f13d8?s=128&d=identicon&r=PG", "display_name": "MrSaints", "link": "https://stackoverflow.com/users/1107942/mrsaints"}, "edited": false, "score": 0, "creation_date": 1464449941, "post_id": 37500810, "comment_id": 62496607, "body": "@MrSaints I am looking for a non-Web based solution. Its a program designed for moving around files on windows based on whether or not they have a &#39;file attribute&#39;. I was just likening what I need to HTTP Headers. Additionally, I do not need to determine the content type, I was hoping for a method that allowed me to edit the &#39;headers&#39; of all files, regardless of their content type. Thanks."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1464453116, "post_id": 37500810, "comment_id": 62497598, "body": "File metadata, such as the title of a PDF, the number of lines in an Office XML Document (.docx), the artist in an MP3 file, etc., are all file-specific. NTFS provides an API for this sort of information using its <a href=\"https://social.msdn.microsoft.com/Forums/vstudio/en-US/416cf926-a091-4028-8d09-f9d93c3b1ba7/read-any-file-details-and-metadata-using-c?forum=vclanguage#bf763052-f2c4-4578-ba33-2a2105ac5447\" rel=\"nofollow noreferrer\">&quot;Alternate Data Streams&quot;</a> capability, assuming Windows has created the ADS for the file in the first place. I&#39;m not aware of any Go packages to support getting this information though."}], "answers": [{"comments": [{"owner": {"reputation": 3660, "user_id": 2247264, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/a645fe19c42263286b982aaa633b96a9?s=128&d=identicon&r=PG", "display_name": "Dalen", "link": "https://stackoverflow.com/users/2247264/dalen"}, "edited": false, "score": 0, "creation_date": 1464457994, "post_id": 37501333, "comment_id": 62499100, "body": "Might get lucky with some formats - docx is a zip file, perhaps adding data inside the archive wouldn&#39;t confuse MS Word. At least it shouldn&#39;t. But as for other formats, well, +1 for mentioning sqlite"}], "tags": [], "owner": {"reputation": 708, "user_id": 3401706, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/ece1e92fd692086ce8f6fe7c63caa979?s=128&d=identicon&r=PG&f=1", "display_name": "saq7", "link": "https://stackoverflow.com/users/3401706/saq7"}, "is_accepted": false, "score": 1, "last_activity_date": 1464452660, "creation_date": 1464452660, "answer_id": 37501333, "question_id": 37500810, "link": "https://stackoverflow.com/questions/37500810/attribute-system-similar-to-http-headers-for-local-files/37501333#37501333", "title": "Attribute system similar to HTTP Headers for local files", "body": "<p>If you are dealing with binary files like docx and pdf, you're best off storing the metadata in seperate files or in a sqlite file.</p>\n\n<p>Metadata is usually stored seperate from files, in data structures called inodes (at least in Unix systems, Windows probably has something similar). But you probably don't want to get that deep into the rabbit hole.</p>\n\n<p>If your goal is to query the system based on metadata, then it would be easier and more efficient to use something SQLite. Having the meta data in the file would mean that you would need to open the file, read it into memory from disk, and then check the meta data - i.e slower queries.</p>\n\n<p>If you don't need to query based on metadata, then storing metadata in the file might make sense. It would reduce the dependencies in your application, but in order to access the contents of the file through Word or Adobe Reader, you'd need to strip the metadata before handing it off to the application. Not worth the hassle, usually</p>\n"}, {"comments": [{"owner": {"reputation": 320, "user_id": 3529271, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NmPnP.jpg?s=128&g=1", "display_name": "Mr. Foots", "link": "https://stackoverflow.com/users/3529271/mr-foots"}, "edited": false, "score": 0, "creation_date": 1464547473, "post_id": 37502101, "comment_id": 62520632, "body": "I appreciated your full range of possibilities! Thereby: answer. Although thank you @saq7 as well. It looks like both you and Dalen came to the same conclusion of using a database. So I guess I will look into that. Thanks all!"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1464608663, "post_id": 37502101, "comment_id": 62541221, "body": "I&#39;d add that <code>extN</code> file systems (and also <code>XFS</code>, <code>ZFS</code>, <code>JFS</code> etc) support the so-called &quot;POSIX extended attributes&quot; and &quot;user&#39;s extended attributes&quot;. Some filesystems require specific mount-time flags to enable them others default to enabling them. The keywords to google: <code>xattr</code>, <code>setxattr</code>, <code>getxattr</code>."}], "tags": [], "owner": {"reputation": 3660, "user_id": 2247264, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/a645fe19c42263286b982aaa633b96a9?s=128&d=identicon&r=PG", "display_name": "Dalen", "link": "https://stackoverflow.com/users/2247264/dalen"}, "is_accepted": true, "score": 2, "last_activity_date": 1464457645, "creation_date": 1464457645, "answer_id": 37502101, "question_id": 37500810, "link": "https://stackoverflow.com/questions/37500810/attribute-system-similar-to-http-headers-for-local-files/37502101#37502101", "title": "Attribute system similar to HTTP Headers for local files", "body": "<p>Metadata you wish to add is best kept in a separate file or database for all files.</p>\n\n<p>Or in another file with same name and different extension or prefix, that you can make hidden.</p>\n\n<p>Relying on a file system is very tricky and your data will be bound by the restrictions and capabilities of the file system your file is stored on.\nAnd, you cannot count on your data remaining intact as any application may wish to change these flags.</p>\n\n<p>And some of those have very specific, clearly defined use, such as creation time, modification time, access time...</p>\n\n<p>See, if you need only flagging the document, you may wish to use creation time, which will stay unchanged through out the live of this document (until is copied) to store your flags. :D</p>\n\n<p>Very dirty business, unprofessional, unreliable and all that.</p>\n\n<p>But it's a solution. Poor one, but exists.</p>\n\n<p>I do not know that FAT32 or NTFS file systems support any extra bits for flagging except those already used by the OS.\nUnixes EXT family FS's do support some extra bits. And even than you should be careful in case some other important application makes use of them for something.</p>\n\n<p>Mac OS may support some metadata by itself, but I am not 100% sure.</p>\n\n<p>On Windows, you have one more option to associate more data with a file, but I wouldn't use that as well.</p>\n\n<p>Well, NTFS file system (FAT doesn't support that) has a feature called streams.</p>\n\n<pre><code>In essential, same file can have multiple data streams under itself. I.e. You have more than one file contents under same file node.\n</code></pre>\n\n<p>To be more clear. Same file contains two different files.</p>\n\n<p>When you open the file normally only main stream is visible to the application. Applications must check whether the other streams are present and choose the one they want to follow.</p>\n\n<p>So, you may choose to store metadata under the second stream of the file.</p>\n\n<p>But, what if all streams are taken?</p>\n\n<p>Even more, anti-virus programs may prevent you access to the metadata out of paranoya, or at least ask for a permission.\nI don't know why MS included that option, probably for file duplication or something, but bad hackers made use of the fact that you can store some data, under existing regular file, that nobody is aware of.</p>\n\n<p>Imagine a virus writing it's copy into another stream of one of programs already there.</p>\n\n<p>All that is needed for it to start, instead of your old program next time you run it is a batch script added to task scheduler that flips two streams making the virus data the main one.</p>\n\n<p>Nasty trick! So when this feature started to be abused, anti-virus software started restricting files with multiple streams, so it's like this feature doesn't exist.</p>\n\n<p>If you want to add some metadata using OS's technology, use Windows registry,\nbut even that is unwise.</p>\n\n<p>What to tell you?\nDon't add metadata to files, organize a separate file, or index your data in special files with same name as the file you are refering to and in same folder.</p>\n"}], "owner": {"reputation": 320, "user_id": 3529271, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/NmPnP.jpg?s=128&g=1", "display_name": "Mr. Foots", "link": "https://stackoverflow.com/users/3529271/mr-foots"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 37502101, "answer_count": 2, "score": 0, "last_activity_date": 1464457645, "creation_date": 1464449233, "question_id": 37500810, "link": "https://stackoverflow.com/questions/37500810/attribute-system-similar-to-http-headers-for-local-files", "title": "Attribute system similar to HTTP Headers for local files", "body": "<p>I am in the process of writing a program and need some guidance. Essentially, I am trying to determine if a file has some marker or flag attached to it. Sort of like the attributes for a HTTP Header. </p>\n\n<p>If such a marker exists, that file will be manipulated in some way (moved to another directory).</p>\n\n<p>My question is: Where exactly should I be storing this flag/marker? Do files have a system similar to HTTP Headers? I don't want to access or manipulate the contents of the file, just some kind of property of the file that can be edited without corrupting the actual file--and it must be rather universal among file types as my potential domain of file types is unbound. I have some experience with Web APIs so I am familiar with HTTP Headers and json. Does any similar system exist for local files in windows? I am especially interested in anyone who has professional/industry knowledge of common techniques that programmers use when trying to store 'meta data' in files in order to access them later. Or if anyone knows of where to point me, as I am unsure to what I should be researching. </p>\n\n<p>For the record, I am going to write a program for Windows probably using Golang or Python. And the files I am going to manipulate will be potentially all common ones (.docx, .txt, .pdf, etc.)</p>\n\n<p>Thanks in advanced!</p>\n"}, {"tags": ["json", "multidimensional-array", "go", "struct", "unmarshalling"], "answers": [{"comments": [{"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "edited": false, "score": 0, "creation_date": 1464441746, "post_id": 37499361, "comment_id": 62493991, "body": "Thank you @cnicutar. I missed that. However, when I changed it to bool, it still stops at the multidimensional array. <a href=\"https://play.golang.org/p/2HMUi6JadG\" rel=\"nofollow noreferrer\">play.golang.org/p/2HMUi6JadG</a> I have uncommented the 2d slice part in the struct and you can see the difference."}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "edited": false, "score": 0, "creation_date": 1464442150, "post_id": 37499361, "comment_id": 62494100, "body": "Ah never mind, your error catching helped me. It is a slice of string and a number, so I put an empty interface"}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 1, "creation_date": 1464443376, "post_id": 37499361, "comment_id": 62494544, "body": "@nohuo stop go development, <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">read this</a>, then continue your go development."}, {"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "reply_to_user": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 0, "creation_date": 1464455922, "post_id": 37499361, "comment_id": 62498401, "body": "Thank you @eduncan911, started it."}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 2, "last_activity_date": 1464440762, "creation_date": 1464440762, "answer_id": 37499361, "question_id": 37499114, "link": "https://stackoverflow.com/questions/37499114/nested-json-unmarshaling-with-2d-slices-into-struct-not-working-in-golang/37499361#37499361", "title": "Nested json unmarshaling with 2d slices into struct not working in golang", "body": "<p>The main problem is that you're not handling the error returned by <code>json.Unmarshal</code>. Once you handle that, problems with your json (and the decoding struct) become obvious.</p>\n\n<pre><code>if err := json.Unmarshal(jsonfile, &amp;jsonobject); err != nil {\n    fmt.Printf(\"Unmarshal: %v\\n\", err)\n}\n</code></pre>\n\n<p>First:</p>\n\n<blockquote>\n  <p>Unmarshal json: cannot unmarshal bool into Go value of type string</p>\n</blockquote>\n\n<p>So <code>Add_info</code> should be <code>bool</code>. After fixing that and uncommenting <code>Applications</code>:</p>\n\n<blockquote>\n  <p>Unmarshal json: cannot unmarshal number into Go value of type string</p>\n</blockquote>\n\n<p>After changing 12 to \"12\" and 106 to \"106\" the result is:</p>\n\n<pre><code>{[{{{false [[Systems 12] [SomeProject 106]] [SomeUser1 SomeUser2]}}}]}\n</code></pre>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2230, "favorite_count": 0, "accepted_answer_id": 37499361, "answer_count": 1, "score": 1, "last_activity_date": 1464442062, "creation_date": 1464439291, "last_edit_date": 1495541803, "question_id": 37499114, "link": "https://stackoverflow.com/questions/37499114/nested-json-unmarshaling-with-2d-slices-into-struct-not-working-in-golang", "title": "Nested json unmarshaling with 2d slices into struct not working in golang", "body": "<p>I have a json structure that looks like</p>\n\n<pre><code>{\n\"devices\": [\n    {\n        \"server\": {\n            \"bu\": {\n                \"add_info\": false,\n                \"applications\": [\n                    [\n                        \"Systems\",\n                        12\n                    ],\n                    [\n                        \"SomeProject\",\n                        106\n                    ]\n                ],\n                \"name\": [\n                    [\n                        \"SomeName\",\n                        4\n                    ],\n                    [\n                        \"CommonName\",\n                        57\n                    ]\n                ],\n                \"owners\": [\n                    \"SomeOwner1\",\n                    \"SomeOwner2\"\n                ],\n                \"users\": [\n                    \"SomeUser1\",\n                    \"SomeUser2\"\n                ]\n            }\n        }\n    }\n  ]\n}\n</code></pre>\n\n<p>I am trying to add it to a struct, and the struct looks like</p>\n\n<pre><code>type TwoD [][]string\ntype MainContainer struct {\n    Devices []struct{\n        Server struct{\n            Bu struct{\n                Add_info string `json:\"add_info\"`\n                Applications TwoD `json:\"applications\"`\n                Name TwoD `json:\"name\"`\n                Owners []string `json:\"owners\"`\n                Users []string `json:\"users\"`\n               } `json:\"bu\"`\n               } `json:\"server\"`\n    } `json:\"devices\"`\n}\n</code></pre>\n\n<p>However, when I am printing the struct, I get only one value from the 2D slice and nothing beyond it.</p>\n\n<pre><code>func main() {\njsonfile, err  := ioutil.ReadFile(\"./search.json\")\nif err != nil {\n    fmt.Println(err)\n    os.Exit(1)\n}\nvar jsonobject MainContainer\njson.Unmarshal(jsonfile, &amp;jsonobject)\nfmt.Printf(\"%v\", jsonobject)\n}\n</code></pre>\n\n<p><code>{[{{{ [[Systems ]] [] [] []}}}]}</code></p>\n\n<p>But if I am omitting the 2d slices in the struct like</p>\n\n<pre><code>type MainContainer struct {\nDevices []struct{\n        Server struct{\n            Bu struct{\n                Add_info string `json:\"add_info\"`\n                //Applications TwoD `json:\"applications\"`\n                //Name TwoD `json:\"name\"`\n                Owners []string `json:\"owners\"`\n                Users []string `json:\"users\"`\n               } `json:\"bu\"`\n               } `json:\"server\"`\n    } `json:\"devices\"`\n}\n</code></pre>\n\n<p>everything is printed as</p>\n\n<p><code>{[{{{ [SomeOwner1 SomeOwner2] [SomeUser1 SomeUser2]}}}]}</code></p>\n\n<p>Could someone help me identify what is wrong here? </p>\n\n<p><a href=\"https://play.golang.org/p/RgGmYyo-AY\" rel=\"nofollow noreferrer\">Here</a> is the link to the golang playground with the struct and sample json. The two TwoD slices are commented in the struct there.</p>\n\n<p>Note:: Edited the playground link with one 2d slice uncommented so that the difference can be noted, and changed the type string to bool, as pointed out by <a href=\"https://stackoverflow.com/users/714501/cnicutar\">@cnicutar</a>, Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1464439002, "post_id": 37499008, "comment_id": 62493146, "body": "Can you try: <code>exec.Command(&quot;cmd&quot;, &quot;runas&quot;)</code> (Make sure your program has the administrative privileges to use <code>runas</code>"}, {"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "reply_to_user": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1464439591, "post_id": 37499008, "comment_id": 62493307, "body": "The command works,without <code>&quot;cmd&quot;</code>, but asks for a password. And I wish I could enter the password via go, not in the command prompt - @Tico"}, {"owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1464439878, "post_id": 37499008, "comment_id": 62493399, "body": "Check this answer: <a href=\"http://stackoverflow.com/questions/31558066/how-to-ask-for-administer-privileges-on-windows-with-golang\" title=\"how to ask for administer privileges on windows with golang\">stackoverflow.com/questions/31558066/&hellip;</a>  The poster seems to have found a way!"}, {"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "reply_to_user": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1464440496, "post_id": 37499008, "comment_id": 62493605, "body": "Sorry I better explain myself. I want via this application launch other applications (eg Ccleaner, antivirus eset online, etc ...) on computers of my clients. So I create a adminsys account and I want to launch these various applications automatically with this account. @Tico"}, {"owner": {"reputation": 1644, "user_id": 1574221, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3354f9ca5a8b1d4cc30f5bcc1de26ed5?s=128&d=identicon&r=PG", "display_name": "marsh-wiggle", "link": "https://stackoverflow.com/users/1574221/marsh-wiggle"}, "edited": false, "score": 0, "creation_date": 1464440836, "post_id": 37499008, "comment_id": 62493705, "body": "@samuelmichaux May be its better to edit your question and add your comment there"}, {"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "reply_to_user": {"reputation": 1644, "user_id": 1574221, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/3354f9ca5a8b1d4cc30f5bcc1de26ed5?s=128&d=identicon&r=PG", "display_name": "marsh-wiggle", "link": "https://stackoverflow.com/users/1574221/marsh-wiggle"}, "edited": false, "score": 0, "creation_date": 1464441243, "post_id": 37499008, "comment_id": 62493819, "body": "@boboes. Yes, I am sorry. I modified."}, {"owner": {"reputation": 2666, "user_id": 1421957, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b8e742c4a05e312502c828847c455ad?s=128&d=identicon&r=PG", "display_name": "Tico", "link": "https://stackoverflow.com/users/1421957/tico"}, "edited": false, "score": 0, "creation_date": 1464441957, "post_id": 37499008, "comment_id": 62494051, "body": "Oh, I see now @samuelmichaux. Do you get any error when trying to write your password to the stdin?"}, {"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "edited": false, "score": 0, "creation_date": 1464442684, "post_id": 37499008, "comment_id": 62494288, "body": "No errors with stdin. The errors with runas. <code>Erreur de RUNAS : Impossible d\u2019ex&#233;cuter - C:\\program.exe 1326 : Le nom d\u2019utilisateur ou le mot de passe est incorrect.</code>  It looks like he does not recognize the password. This works when I do it directly in the command prompt"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464466210, "post_id": 37499008, "comment_id": 62501531, "body": "Does it work if you change <code>io.WriteString(stdin, password)</code> to <code>io.WriteString(stdin, password + &quot;\\n&quot;)</code>?"}, {"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464508422, "post_id": 37499008, "comment_id": 62509223, "body": "@OneOfOne - It&#39;s same.  I added a gif to show the result"}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "edited": false, "score": 0, "creation_date": 1464589671, "post_id": 37513740, "comment_id": 62530769, "body": "No change. It&#39;s the same thing. :-("}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 0, "last_activity_date": 1464550061, "last_edit_date": 1464550061, "creation_date": 1464548447, "answer_id": 37513740, "question_id": 37499008, "link": "https://stackoverflow.com/questions/37499008/how-to-create-interactive-command-execution/37513740#37513740", "title": "How to create interactive command execution", "body": "<p>I'm not running windows, and the code you have in your question works for me. So, the following may not solve your problem, but this is an alternative for passing string to a command.</p>\n\n<p>I created this basic command named <code>pass</code> in order to assert the correctness of the password:</p>\n\n<pre><code>func main() {\n\n    fmt.Print(\"Enter your password please: \")\n    reader := bufio.NewReader(os.Stdin)\n    password, err := reader.ReadString('\\n')\n    if err != nil {\n        fmt.Println(\"An error occurred while reading line\")\n    }\n\n    // Remove the line break\n    password = password[:len(password)-1]\n\n    if password == \"Secret pass\" {\n        fmt.Println(\"Success !\")\n    } else {\n        fmt.Println(\"Failure !\")\n    }\n\n}\n</code></pre>\n\n<p>Now, instead of working with pipe, set the <code>Stdin</code> of the command to a new reader:</p>\n\n<pre><code>func main() {\n    cmd := exec.Command(\"pass\")\n    cmd.Stdin = strings.NewReader(\"Secret pass!\\n\")\n    cmd.Stdout = os.Stdout\n    _ = cmd.Run()\n    // Failure\n\n    cmd = exec.Command(\"pass\")\n    cmd.Stdin = strings.NewReader(\"Secret pass\\n\")\n    cmd.Stdout = os.Stdout\n    _ = cmd.Run()\n    // Success\n}\n</code></pre>\n\n<p>Hope this helps.</p>\n"}], "owner": {"reputation": 31, "user_id": 6394309, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/76836db740173587b2ff0cb60894d7be?s=128&d=identicon&r=PG&f=1", "display_name": "samuel michaux", "link": "https://stackoverflow.com/users/6394309/samuel-michaux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1977, "favorite_count": 2, "answer_count": 1, "score": 2, "last_activity_date": 1554210548, "creation_date": 1464438602, "last_edit_date": 1554210548, "question_id": 37499008, "link": "https://stackoverflow.com/questions/37499008/how-to-create-interactive-command-execution", "title": "How to create interactive command execution", "body": "<p>My problem is the interaction with exec.command. I would like to automate RunAs on windows.</p>\n\n<p>I want via this application launch other applications (eg Ccleaner, antivirus eset online, etc ...) on computers of my clients. So I create a adminsys account and I want to launch these various applications automatically with this account.</p>\n\n<pre><code>cmd := exec.Command(\"runas\", user, nameProgram)\n\ncmd.Stdout = os.Stdout\ncmd.Stderr = os.Stderr\n\nstdin, err := cmd.StdinPipe()\nif err != nil {\n    fmt.Println(err)\n}\ndefer stdin.Close()\nerr = cmd.Start()\nif err != nil {\n    fmt.Println(err)\n    return\n}\n\ntime.Sleep(3 * time.Second)\nio.WriteString(stdin, password)\n\nerr = cmd.Wait()\nif err != nil {\n    fmt.Println(err)\n    return\n}\n</code></pre>\n\n<p>This does not work!</p>\n\n<p>The errors with runas.</p>\n\n<pre><code>Erreur de RUNAS : Impossible d\u2019ex\u00e9cuter - C:\\program.exe \n1326 : Le nom d\u2019utilisateur ou le mot de passe est incorrect.\n</code></pre>\n\n<p>It looks like he does not recognize the password. This works when I do it directly in the command prompt</p>\n\n<p><a href=\"https://i.stack.imgur.com/2a9wo.gif\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/2a9wo.gif\" alt=\"gif\"></a></p>\n"}, {"tags": ["go", "udp", "go-gin"], "answers": [{"tags": [], "owner": {"reputation": 494, "user_id": 6392978, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/C7NNr.jpg?s=128&g=1", "display_name": "Opnauticus", "link": "https://stackoverflow.com/users/6392978/opnauticus"}, "is_accepted": true, "score": 1, "last_activity_date": 1464468373, "last_edit_date": 1464468373, "creation_date": 1464468005, "answer_id": 37503561, "question_id": 37498964, "link": "https://stackoverflow.com/questions/37498964/golang-mixing-gin-with-an-udp-server/37503561#37503561", "title": "Golang: Mixing Gin with an UDP server", "body": "<p>There is an infinite loop in your code.</p>\n\n<pre><code>for {\n    handleUDPConnection(conn)\n}\n</code></pre>\n\n<p>This will repetedly call the handleUDPConnection function until the program exits without ever moving on to</p>\n\n<pre><code>fmt.Sprintf(\"UDP server up and listening on port %s\\n\", port)\nserver.Run()\n</code></pre>\n\n<p>Perhaps you want to deal with the connections in a go thread. This would be something more like this:</p>\n\n<pre><code>//define an exit variable\nkeepListening := true\n//spawn a go routine (starts the function on another thread*)\ngo func() {\n    for keepListening {\n        handleUDPConnection(conn)\n    }\n}()\n//notify the user that the server is listening\nfmt.Sprintf(\"UDP server up and listening on port %s\\n\", port)\n//run the server (I assume this function call is blocking\nserver.Run()\n//stop the go routine when the server is done running\nkeepListening = false\n</code></pre>\n\n<p>Hope this helps!</p>\n\n<p>*a goroutine is not a thread. It can be useful/simple to think of it like that, but they are distinctly different. <a href=\"http://tleyden.github.io/blog/2014/10/30/goroutines-vs-threads/\" rel=\"nofollow\">Here's an article</a> explaining some of the differences and advantages.</p>\n"}], "owner": {"reputation": 441, "user_id": 6077397, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d456f19ea4fc9981404a2e3dc7245b89?s=128&d=identicon&r=PG&f=1", "display_name": "Alex. b", "link": "https://stackoverflow.com/users/6077397/alex-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 610, "favorite_count": 0, "accepted_answer_id": 37503561, "answer_count": 1, "score": 1, "last_activity_date": 1464468373, "creation_date": 1464438338, "last_edit_date": 1464439656, "question_id": 37498964, "link": "https://stackoverflow.com/questions/37498964/golang-mixing-gin-with-an-udp-server", "title": "Golang: Mixing Gin with an UDP server", "body": "<p>I'm trying to use both a UDP server to listen continuously to datagrams and a http server, but the string \"UDP server up and listening on port...\" and command \"server.Run()\" are never reached.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gin-gonic/gin\"\n    \"log\"\n    \"net\"\n)\n\nfunc handleUDPConnection(conn *net.UDPConn) {\n    buffer := make([]byte, 8096)\n    n, addr, err := conn.ReadFromUDP(buffer)\n\n    if err != nil {\n        log.Fatal(err)\n    } else {\n        fmt.Println(\"UDP client: \", addr)\n        fmt.Println(\"Received from UDP client: \", string(buffer[:n]))\n    }\n}\n\nfunc main() {\n    server := gin.Default()\n    host, port := \"localhost\", \"41234\"\n    udpAddr, err := net.ResolveUDPAddr(\"udp4\", fmt.Sprintf(\"%s:%s\", host, port))\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    conn, err := net.ListenUDP(\"udp\", udpAddr)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    defer conn.Close()\n    server.GET(\"/ping\", func(c *gin.Context) {\n        c.JSON(200, gin.H{\"message\": \"pong\"})\n    })\n\n    for {\n        handleUDPConnection(conn)\n    }\n\n    fmt.Sprintf(\"UDP server up and listening on port %s\\n\", port)\n    server.Run()\n}\n</code></pre>\n\n<p>How can I make it work?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1464437754, "post_id": 37498781, "comment_id": 62492728, "body": "You can&#39;t convert to the original type without knowing what it is. Reflect can let you dynamically handle various types, but you can&#39;t get a &quot;real&quot; type without an assertion."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464437803, "post_id": 37498781, "comment_id": 62492738, "body": "I just posted some clarification as an edit."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464437930, "post_id": 37498781, "comment_id": 62492780, "body": "The current workaround I have is to pass a closure to the function instead of an <code>interface {}</code> type property, and the function calls that function if necessary without losing the original variable&#39;s type as it&#39;s within the prior scope and never changes type. However, this requires me to copy and paste code into various instances of me calling this method, which I find unnecessary.... Seems like the only way to keep the type that I&#39;ve found."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464437974, "post_id": 37498781, "comment_id": 62492797, "body": "Then yo need to assert it back to the correct type. If you know the signature of the function that needs to be called at compile time, then you know the type you need to assert. If not, you have to do the whole thing using reflection."}, {"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464437986, "post_id": 37498781, "comment_id": 62492799, "body": "Posting the relevant part of the code might help."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464438024, "post_id": 37498781, "comment_id": 62492813, "body": "Give me a few minutes, I&#39;ll post some code."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464438420, "post_id": 37498781, "comment_id": 62492937, "body": "Posted code. Please let me know if that makes more sense."}, {"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464440497, "post_id": 37498781, "comment_id": 62493606, "body": "Read the link in <a href=\"http://stackoverflow.com/a/37498813/4475267\">@TClaverie&#39;s answer</a>. With that method, create a <i>new</i> variable with the type you want and the value of <code>out</code>."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464440890, "post_id": 37498781, "comment_id": 62493718, "body": "... Wouldn&#39;t it be better for me to just pass a type (not an empty struct) to this function then? How can I do that?"}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "edited": false, "score": 0, "creation_date": 1464444861, "post_id": 37498781, "comment_id": 62494988, "body": "@noisypixy This isn&#39;t working. If I pass a <code>reflect.Type</code> typed property to a function there&#39;s no way to create an object of that type and populate it to return to the caller. Help? What are you saying?"}, {"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464447866, "post_id": 37498781, "comment_id": 62495893, "body": "<code>reflect.Type</code> can&#39;t be used as type assertion, it is a representation of the type, not the type itself. But you cannot store a Go type into a variable, that&#39;s not possible."}], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "edited": false, "score": 0, "creation_date": 1464437499, "post_id": 37498813, "comment_id": 62492642, "body": "Can you explain how to directly fetch the original type of an <code>interface {}</code> element and reassert it to that type before passing it to another function? If so, I can accept this solution."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 5, "last_activity_date": 1464447338, "last_edit_date": 1464447338, "creation_date": 1464437393, "answer_id": 37498813, "question_id": 37498781, "link": "https://stackoverflow.com/questions/37498781/restore-type-information-after-passing-through-function-as-interface/37498813#37498813", "title": "Restore type information after passing through function as &quot;interface {}&quot;?", "body": "<p>To change the type of an interface into its rightful type, you can use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertions</a>:</p>\n\n<pre><code>package main\n\nimport r \"reflect\"\n\ntype A struct {\n    Name string\n}\n\nfunc main() {\n    // No pointer\n    aa := A{\"name\"}\n    var ii interface{} = aa\n\n    bb := ii.(A)\n    // main.A\n\n    // Pointer\n    a := &amp;A{\"name\"}\n    var i interface{} = a\n\n    b := *i.(*A)\n    // main.A\n\n    c := i.(*A)\n    // *main.A\n\n    d := r.Indirect(r.ValueOf(i)).Interface().(A)\n    // main.A\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wH_dwjb8yO\" rel=\"nofollow\">Playground 1</a></p>\n\n<p>When using type assertions, you have to know the underlying type of your interface. In Go, there is no way to use type assertion with a dynamic type. <code>reflect.Type</code> is not a type, it's an interface representing a type. So no, you can't use it this way.</p>\n\n<p>If you have several type possibilities, the solution is the <a href=\"https://golang.org/doc/effective_go.html#type_switch\" rel=\"nofollow\">type switch</a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype TypeA struct {\n    A string\n}\n\ntype TypeB struct {\n    B string\n}\n\nfunc doSomethingA(t TypeA) {\n    fmt.Println(t.A)\n}\n\nfunc doSomethingB(t TypeB) {\n    fmt.Println(t.B)\n}\n\nfunc doSomething(t interface{}) {\n    switch t := t.(type) {\n    case TypeA:\n        doSomethingA(t)\n    case TypeB:\n        doSomethingB(t)\n    default:\n        panic(\"Unrecognized type\")\n    }\n}\n\nfunc main() {\n    a := TypeA{\"I am A\"}\n    b := TypeB{\"I am B\"}\n\n    doSomething(a)\n    // I am A\n    doSomething(b)\n    // I am B\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/P1IMmC13vj\" rel=\"nofollow\">Playground 2</a></p>\n"}, {"comments": [{"owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 1, "creation_date": 1464453864, "post_id": 37500585, "comment_id": 62497812, "body": "Please, post how you solved the issue then. However, serializing and deserializing structs in order to get the right type is not a good way to solve it. And, you still have the problem of getting back the right struct at the end."}, {"owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "reply_to_user": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "edited": false, "score": 0, "creation_date": 1464455044, "post_id": 37500585, "comment_id": 62498139, "body": "That&#39;s not the issue really. It&#39;s more that the cache load/save methods in my example were panicking if an <code>interface {}</code> was passed versus a native type. Since the function might not have access to the original type in order to declare a wide range of possible types, I had to switch to <code>JSON</code> as the cache method which was less picky than <code>Gob</code>."}], "tags": [], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "is_accepted": true, "score": 0, "last_activity_date": 1464447969, "creation_date": 1464447969, "answer_id": 37500585, "question_id": 37498781, "link": "https://stackoverflow.com/questions/37498781/restore-type-information-after-passing-through-function-as-interface/37500585#37500585", "title": "Restore type information after passing through function as &quot;interface {}&quot;?", "body": "<p>It turns out that using <code>JSON</code> instead of <code>Gob</code> for serialization avoids the error that I was encountering entirely. Other functions can handle passing into interfaces, etc.</p>\n"}], "owner": {"reputation": 4173, "user_id": 963901, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/ef089712a38be13b7190e8d52b1a9fa3?s=128&d=identicon&r=PG", "display_name": "Ben Guild", "link": "https://stackoverflow.com/users/963901/ben-guild"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 0, "accepted_answer_id": 37500585, "answer_count": 2, "score": 1, "last_activity_date": 1464447969, "creation_date": 1464437166, "last_edit_date": 1464438708, "question_id": 37498781, "link": "https://stackoverflow.com/questions/37498781/restore-type-information-after-passing-through-function-as-interface", "title": "Restore type information after passing through function as &quot;interface {}&quot;?", "body": "<p>I'm running into a slight architectural problem with Golang right now that's causing me to copy/paste a bit more code than I'd prefer. I feel like there must be a solution, so please let me know if this is perhaps possible:</p>\n\n<p>When I pass things through an <code>interface {}</code>-typed function parameter, I start getting errors such as \"expected struct or slice\", etc. ... even though what I passed was previously a struct or a slice. I realize that I could manually convert these to another type after receiving them in that function, but then that become tedious in instances such as this:</p>\n\n<blockquote>\n  <p>local interface type *interface {} can only be decoded from remote\n  interface type; received concrete type</p>\n</blockquote>\n\n<p>... In this case, the receiving function seems like it'd need to be hard-coded to convert all <code>interface {}</code> items back to their respective original types in order to work properly, because the receiving function needs to know the exact type in order to process the item correctly.</p>\n\n<p><strong>Is there a way to dynamically re-type Golang <code>interface {}</code> typed variables back to their original type?</strong> Something like this, <a href=\"https://stackoverflow.com/questions/34098936/how-to-i-convert-reflect-news-return-value-back-to-the-original-type\">How to I convert reflect.New&#39;s return value back to the original type</a> ... maybe?</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> To clarify, basically,  I'm passing <code>&amp;out</code> to a function and it needs to be its original type by the time it reaches another inner function call.</p>\n\n<p>Example code:</p>\n\n<pre><code>// NOTE: This is sort of pseudo-Golang code, not meant to be compiled or taken too seriously.\n\nfunc PrepareTwoDifferentThings(keyA string, keyB string) {\n    var somethingA TypeA;\n    var somethingB TypeB;\n\n    loadFromCache(keyA, &amp;somethingA, nil);\n    loadFromCache(keyB, &amp;somethingB, nil);\n\n    fmt.Printf(\"Somethings: %v, %v\", somethingA, somethingB);\n\n}\n\nfunc loadFromCache(key string, isNew, out interface {}, saveNewData interface {}) {\n    if err := cache.load(key, &amp;out); err!=nil { // NOTE: Current issue is that this expects \"&amp;out\" to be `TypeA`/`TypeB` not \"interface {}\", but I don't want to copy and paste this whole function's worth of code or whatever.\n        panic(\"oh no!\");\n\n    }\n\n    if (saveNewData!=nil) {\n        cache.save(key, saveNewData); // This doesn't seem to care if \"saveNewData\" is \"interface {}\" when saving, but later cache fetches above using the \"load()\" method to an \"interface {}\"-typed `&amp;out` parameter throw an exception that the \"interface {}\" type on `&amp;out` does not match the original when it was saved here (`TypeA`/`TypeB`).\n\n    }\n\n}\n</code></pre>\n"}, {"tags": ["html", "go", "canonicalization"], "comments": [{"owner": {"reputation": 191, "user_id": 4726336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0934219118f9e7c4464c14d102458f39?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Alexander", "link": "https://stackoverflow.com/users/4726336/nicholas-alexander"}, "edited": false, "score": 0, "creation_date": 1464437508, "post_id": 37498608, "comment_id": 62492644, "body": "check what html.Parse is actually returning."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 191, "user_id": 4726336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0934219118f9e7c4464c14d102458f39?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Alexander", "link": "https://stackoverflow.com/users/4726336/nicholas-alexander"}, "edited": false, "score": 0, "creation_date": 1464438704, "post_id": 37498608, "comment_id": 62493044, "body": "Yeah, I am trying to walk it... <a href=\"http://s.natalian.org/2016-05-28/compare2.go\" rel=\"nofollow noreferrer\">s.natalian.org/2016-05-28/compare2.go</a> or what do you mean?"}, {"owner": {"reputation": 191, "user_id": 4726336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0934219118f9e7c4464c14d102458f39?s=128&d=identicon&r=PG&f=1", "display_name": "Nicholas Alexander", "link": "https://stackoverflow.com/users/4726336/nicholas-alexander"}, "edited": false, "score": 0, "creation_date": 1464441077, "post_id": 37498608, "comment_id": 62493764, "body": "in compare2.go: in the final iteration, c is nil, so it gets to Downhere, but it does not seem the same issue as the question where doc and doc2 hold addresses which are not the same."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1464447675, "post_id": 37498608, "comment_id": 62495847, "body": "<code>reflect.DeepEqual</code> might work"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1464577956, "post_id": 37498608, "comment_id": 62527537, "body": "Hoping something might come through here: <a href=\"https://github.com/xi2/htmlnode/issues/1#issuecomment-222336736\" rel=\"nofollow noreferrer\">github.com/xi2/htmlnode/issues/1#issuecomment-222336736</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1464479987, "post_id": 37501342, "comment_id": 62504720, "body": "Is there is a space, it says it&#39;s not the same. :/ <a href=\"http://s.natalian.org/2016-05-29/so.go\" rel=\"nofollow noreferrer\">s.natalian.org/2016-05-29/so.go</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1484886015, "post_id": 37501342, "comment_id": 70704189, "body": "I ended up doing a simpler strings.Contains based test <a href=\"https://github.com/kaihendry/toc/blob/master/toc_test.go\" rel=\"nofollow noreferrer\">github.com/kaihendry/toc/blob/master/toc_test.go</a>"}], "tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 0, "last_activity_date": 1464452693, "creation_date": 1464452693, "answer_id": 37501342, "question_id": 37498608, "link": "https://stackoverflow.com/questions/37498608/how-to-compare-html-markup-in-golang/37501342#37501342", "title": "How to compare HTML markup in Golang?", "body": "<p>The simplest way is to use reflection, since <code>html.Parse</code> returns <code>*Node</code> object. Comparing two of objects in Go need a <code>reflect.DeepEqual</code>.</p>\n\n<pre><code>if reflect.DeepEqual(doc, doc2) {                                     \n        fmt.Println(\"HTML is the same\") \n} else {\n        fmt.Println(\"HTML is not the same\")                         \n}\n</code></pre>\n\n<p>This prints out \"HTML is the same\".</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 641, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1464452693, "creation_date": 1464436118, "question_id": 37498608, "link": "https://stackoverflow.com/questions/37498608/how-to-compare-html-markup-in-golang", "title": "How to compare HTML markup in Golang?", "body": "<p>I'm trying to come up with a test suite which checks HTML fragments/files are canonically equivalent to one another. I was surprised to see that if I parse the same string or file, the <a href=\"https://godoc.org/golang.org/x/net/html#Node\" rel=\"nofollow\">https://godoc.org/golang.org/x/net/html#Node</a> was comparing as different. What am I missing?</p>\n\n<p>Hopefully this demonstrates the issue:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"golang.org/x/net/html\"\n)\n\nfunc main() {\n    s := `&lt;h1&gt;\n    test\n    &lt;/h1&gt;&lt;p&gt;foo&lt;/p&gt;`\n    // s2 := `&lt;h1&gt;test&lt;/h1&gt;&lt;p&gt;foo&lt;/p&gt;`\n\n    doc, _ := html.Parse(strings.NewReader(s))\n    doc2, _ := html.Parse(strings.NewReader(s))\n\n    if doc == doc2 {\n        fmt.Println(\"HTML is the same\") // Expected this\n    } else {\n        fmt.Println(\"HTML is not the same\") // Got this\n    }\n}\n</code></pre>\n\n<p><strong>HTML is not the same</strong></p>\n"}, {"tags": ["arrays", "parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 1, "creation_date": 1464436618, "post_id": 37498530, "comment_id": 62492310, "body": "Nice <i>abuse</i> of json :) However, strings are space-separated (not comma-separated) and reading the full line is pretty inefficient in space."}], "tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": 1, "last_activity_date": 1484381223, "last_edit_date": 1484381223, "creation_date": 1464435630, "answer_id": 37498530, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/37498530#37498530", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<p>1) read string</p>\n\n<p>2) prepend <code>[</code> and append <code>]</code> </p>\n\n<p>3) parse as json into []int?</p>\n\n<pre><code>var input = \"1,2,3\"\nvar answer []int\nj := []byte(fmt.Sprintf(\"[%s]\",input))\nerr:= json.Unmarshal(j, &amp;input)\nif err != nil {\n  panic(err)\n}\nfor k,v := range input {\n   fmt.Printf(\"Element \u2116%v is %v\\n\", k,v)\n}\n</code></pre>\n\n<p>also using split strings (<a href=\"https://godoc.org/strings#Split\" rel=\"nofollow noreferrer\">https://godoc.org/strings#Split</a>)\nand <a href=\"https://godoc.org/strconv#ParseInt\" rel=\"nofollow noreferrer\">https://godoc.org/strconv#ParseInt</a></p>\n\n<pre><code>input:= \"1,2,3\"\ntemp := strings.Split(input, \",\")\nvar answer []int\n\nfor _,v := range temp {\n  i,err := strconv.ParseInt(v)\n  if err != nill {\n     panic(err)\n  }\n  answer = append(answer, i)\n}\n</code></pre>\n\n<p>UPD: just found that the numbers are SPACE separated.\nSo, this code have to do the thing:</p>\n\n<pre><code>input:= \"1 2 3\"\ntemp := strings.Split(input, \" \")\nvar answer []int\n\nfor _,v := range temp {\n  i,err := strconv.ParseInt(v)\n  if err != nill {\n     panic(err)\n  }\n  answer = append(answer, i)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464437240, "post_id": 37498770, "comment_id": 62492545, "body": "I wouldn&#39;t call this concise, in fact it looks similar to what I wrote."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 1, "creation_date": 1464437271, "post_id": 37498770, "comment_id": 62492559, "body": "./shrug if you want tiny functions try ruby :)"}, {"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464437357, "post_id": 37498770, "comment_id": 62492584, "body": "Or Python, or Haskell :) I would like to use go, but it sucks to spend more time on the parsing part than on the meat of problem."}], "tags": [], "owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "is_accepted": false, "score": 2, "last_activity_date": 1464437079, "creation_date": 1464437079, "answer_id": 37498770, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/37498770#37498770", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<pre><code>// inputs space separated list of integers, outputs []int64\npackage main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"strconv\"\n    \"strings\"\n)\n\nfunc main() {\n    fmt.Println(parse(\"100 200 300\"))\n}\n\nfunc parse(i string) (o []int64) {\n    // from https://golang.org/pkg/bufio/#example_Scanner_custom\n    s := bufio.NewScanner(strings.NewReader(i))\n    splitter := func(data []byte, atEOF bool) (advance int, token []byte, err error) {\n        advance, token, err = bufio.ScanWords(data, atEOF)\n        if err == nil &amp;&amp; token != nil {\n            x, err := strconv.ParseInt(string(token), 10, 32)\n            if err != nil {\n                panic(err)\n            }\n            o = append(o, x)\n        }\n        return\n    }\n    s.Split(splitter)\n    for s.Scan() {\n    }\n    return o\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464463958, "post_id": 37499149, "comment_id": 62500916, "body": "This is the best option so far. You don&#39;t need to check for n since you will always get an error if n != 1"}, {"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464464565, "post_id": 37499149, "comment_id": 62501090, "body": "Actually, I stay corrected, this doesn&#39;t work because it doesn&#39;t tell apart EOLs and EOFs, it should only consume a line."}, {"owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "reply_to_user": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464465631, "post_id": 37499149, "comment_id": 62501372, "body": "You wanted to <i>parse a space-separated <b>line</b> of integers into a slice</i>."}, {"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464468457, "post_id": 37499149, "comment_id": 62502163, "body": "Exactly, <code>echo -e &#39;1 2 3 4\\n5 6 7 8&#39; | go run a.go</code> puts everything in the same array instead of a single line, which is what I was asking for."}, {"owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "edited": false, "score": 0, "creation_date": 1464472440, "post_id": 37499149, "comment_id": 62503183, "body": "No worries. Thanks for giving it a try!! :)"}, {"owner": {"reputation": 3889, "user_id": 100405, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/924e4500ab6bdce291ab6346099ede26?s=128&d=identicon&r=PG", "display_name": "weima", "link": "https://stackoverflow.com/users/100405/weima"}, "edited": false, "score": 0, "creation_date": 1537271054, "post_id": 37499149, "comment_id": 91715772, "body": "<code>fmt.Scan(&quot;%s&quot;, &amp;input)</code> or <code>fmt.Scanln(&quot;%s&quot;, &amp;input)</code> doesn&#39;t work"}], "tags": [], "owner": {"reputation": 694, "user_id": 4475267, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--RSHYsfQegM/AAAAAAAAAAI/AAAAAAAAAI0/NQY8UBQZ-ag/photo.jpg?sz=128", "display_name": "noisypixy", "link": "https://stackoverflow.com/users/4475267/noisypixy"}, "is_accepted": false, "score": 2, "last_activity_date": 1464439502, "creation_date": 1464439502, "answer_id": 37499149, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/37499149#37499149", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<p>You can use <a href=\"https://godoc.org/fmt#Scanf\" rel=\"nofollow\"><code>fmt.Scanf</code></a>, but you need to keep track of the values you're getting.</p>\n\n<pre><code>// a.go\npackage main\n\nimport (\n    \"fmt\"\n    \"io\"\n)\n\nfunc main() {\n    var (\n        next int\n        nums []int\n    )\n\n    for {\n        n, err := fmt.Scanf(\"%d\", &amp;next)\n        if err == io.EOF {\n            break\n        }\n        if err != nil {\n            panic(err)\n        }\n        if n == 0 {\n            break\n        }\n\n        nums = append(nums, next)\n    }\n\n    fmt.Printf(\"%#v\\n\", nums)\n}\n</code></pre>\n\n<hr>\n\n<pre><code>$ echo \"4 8 15 16 23 42\" | go run a.go\n[]int{4, 8, 15, 16, 23, 42}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 0, "last_activity_date": 1466150019, "last_edit_date": 1466150019, "creation_date": 1464552546, "answer_id": 37514456, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/37514456#37514456", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<p>I've used this for those times playing in <em>hackerrank</em> (so concise, but not tested for <em>humans</em>):</p>\n\n<pre><code>func scanInt(n int) []int {\n    input := make([]int, n)\n    buffer := make([]interface{}, n)\n\n    for i := 0; i &lt; n; i++ {\n        buffer[i] = &amp;input[i]\n    }\n\n    fmt.Scanln(buffer...)\n\n    return input\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 4, "last_activity_date": 1464608941, "creation_date": 1464608941, "answer_id": 37524957, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/37524957#37524957", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<p>Well, I have done some hackerrank problems too, and here is what I came up with. Typically, problems start with the number of items in the array:</p>\n\n<pre><code>func main() {\n    var N int\n    fmt.Scanf(\"%d\", &amp;N)\n    line := make([]int, N)\n    for i, _ := range line {\n        fmt.Scanf(\"%d\", &amp;line[i])\n    }\n\n    // Do something with the values\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6486, "user_id": 1116230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55a894894150db28d6641f0c57e48bac?s=128&d=identicon&r=PG", "display_name": "Nico Haase", "link": "https://stackoverflow.com/users/1116230/nico-haase"}, "edited": false, "score": 0, "creation_date": 1568316907, "post_id": 57913181, "comment_id": 102245943, "body": "Please add some explanation to your code such that others can learn from it"}], "tags": [], "owner": {"reputation": 11, "user_id": 6752519, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0d771926b5b4015739e494236c12ac6e?s=128&d=identicon&r=PG&f=1", "display_name": "Alishan Ahmed", "link": "https://stackoverflow.com/users/6752519/alishan-ahmed"}, "is_accepted": false, "score": 1, "last_activity_date": 1588307611, "last_edit_date": 1588307611, "creation_date": 1568315635, "answer_id": 57913181, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go/57913181#57913181", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<pre><code>func main() {\n    arr := make([]int, 0)\n\n    reader := bufio.NewReaderSize(os.Stdin, 1024*1024)\n\n    for {\n        line, _, err := reader.ReadLine()\n        if err != nil {\n          if err == io.EOF {\n            break\n          }\n          panic(err)\n        }\n\n\n        str := strings.Split(string(line), \" \")\n\n        for i:=0; i&lt;len(str); i++ {\n            v, _ := strconv.Atoi(str[i])\n            arr = append(arr, v)\n        }\n    }\n    fmt.Println(arr)\n}\n</code></pre>\n"}], "owner": {"reputation": 4057, "user_id": 1914440, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/96950854138967a35884c26aeb048f3d?s=128&d=identicon&r=PG", "display_name": "fons", "link": "https://stackoverflow.com/users/1914440/fons"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2345, "favorite_count": 0, "answer_count": 6, "score": 7, "last_activity_date": 1588307611, "creation_date": 1464434995, "last_edit_date": 1464468682, "question_id": 37498430, "link": "https://stackoverflow.com/questions/37498430/concise-and-robust-way-to-read-a-line-of-space-separated-integers-in-go", "title": "Concise and robust way to read a line of space-separated integers in Go", "body": "<p>I have been giving HackerRank a try where the problems often require reading lines of integers into arrays (slices).</p>\n\n<p>For many of the problems, my parsing code ends up being larger than the algorithmic meat of the solution. For instance, that was the case in <a href=\"https://www.hackerrank.com/challenges/sherlock-and-array\" rel=\"noreferrer\">Sherlock and Array</a></p>\n\n<p>Any ideas on how to concisely parse a space-separated line of integers into a slice? <code>fmt.Scanf</code> doesn't support slices and when using <code>bufio</code> I get long solutions.</p>\n\n<p>Some requirements:</p>\n\n<ul>\n<li>You can only use the standard library.</li>\n<li>The solution should be concise, the shorter the better.</li>\n<li>Error checks shouldn't be skipped. I know that the input is well defined in HackerRank and you should be able to cut corners, but please don't, it's bad practice.</li>\n<li>It should be reasonably efficient.</li>\n</ul>\n\n<p><strong>NOTE:</strong>\nThe parser should only consume a single line and not the full input.</p>\n"}, {"tags": ["gcc", "go", "sqlite", "cygwin", "cgo"], "comments": [{"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1464428847, "post_id": 37497354, "comment_id": 62490255, "body": "gcc is for building on Cygwin for Cygwin. mingw32 is for building for Windows. May be you want to use the cross compiler <code>&#47;usr&#47;bin&#47;x86_64-w64-mingw32-gcc.exe</code> from Cygwin to Windows ?"}, {"owner": {"reputation": 22340, "user_id": 664108, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cbc8378de58e66705678686057cffac9?s=128&d=identicon&r=PG", "display_name": "Fabian Schmengler", "link": "https://stackoverflow.com/users/664108/fabian-schmengler"}, "reply_to_user": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1464429728, "post_id": 37497354, "comment_id": 62490496, "body": "@matzeri thanks for the suggestion, but I can&#39;t figure out how to tell go, which <code>gcc</code> binary to use. Actually, building for cygwin would be fine for me too, if I can get it to work. Any ideas?"}, {"owner": {"reputation": 6281, "user_id": 5105383, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2YCB5.jpg?s=128&g=1", "display_name": "matzeri", "link": "https://stackoverflow.com/users/5105383/matzeri"}, "edited": false, "score": 0, "creation_date": 1464440117, "post_id": 37497354, "comment_id": 62493480, "body": "I do not see go as cygwin package, so building for cygwin seems complicated. Look if setting CC or GCC variable is effective"}, {"owner": {"reputation": 1448, "user_id": 1913856, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tpY6A.png?s=128&g=1", "display_name": "isalgueiro", "link": "https://stackoverflow.com/users/1913856/isalgueiro"}, "edited": false, "score": 0, "creation_date": 1495550173, "post_id": 37497354, "comment_id": 75294071, "body": "On mingw64 I needed to install <code>mingw-w64-x86_64-gcc</code>"}], "answers": [{"comments": [{"owner": {"reputation": 611, "user_id": 2142899, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Spq4e.png?s=128&g=1", "display_name": "N0dGrand87", "link": "https://stackoverflow.com/users/2142899/n0dgrand87"}, "edited": false, "score": 0, "creation_date": 1555546349, "post_id": 37501576, "comment_id": 98152806, "body": "For reference, the issue is clarified <a href=\"https://android.googlesource.com/platform/external/cherry/+/master/README\" rel=\"nofollow noreferrer\">here</a> <code>- MinGW: http:&#47;&#47;www.mingw.org&#47;   * add &quot;c:\\MinGW\\bin&quot; to PATH   * run &quot;mingw-get install gcc&quot;   * required for building sqlite Go package   * note: using Cygwin GCC doesn&#39;t work</code>"}], "tags": [], "owner": {"reputation": 22340, "user_id": 664108, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cbc8378de58e66705678686057cffac9?s=128&d=identicon&r=PG", "display_name": "Fabian Schmengler", "link": "https://stackoverflow.com/users/664108/fabian-schmengler"}, "is_accepted": true, "score": 11, "last_activity_date": 1464454318, "creation_date": 1464454318, "answer_id": 37501576, "question_id": 37497354, "link": "https://stackoverflow.com/questions/37497354/compile-cgo-lib-on-cygwin64-ld-cannot-find-lmingw32/37501576#37501576", "title": "Compile cgo lib on Cygwin64: &quot;ld: cannot find -lmingw32&quot;", "body": "<p>What finally worked for me (instead of Cygwin) is to download TDM MinGW-w64 from <a href=\"http://tdm-gcc.tdragon.net/download\" rel=\"noreferrer\">http://tdm-gcc.tdragon.net/download</a> and set the PATH such that gcc from <code>C:\\TDM-GCC-64\\bin</code> is used.</p>\n"}, {"tags": [], "owner": {"reputation": 1295, "user_id": 2279765, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/432916361960d8ddbb2d4bdb8369b78f?s=128&d=identicon&r=PG", "display_name": "Tomer", "link": "https://stackoverflow.com/users/2279765/tomer"}, "is_accepted": false, "score": 1, "last_activity_date": 1481752826, "creation_date": 1481752826, "answer_id": 41152979, "question_id": 37497354, "link": "https://stackoverflow.com/questions/37497354/compile-cgo-lib-on-cygwin64-ld-cannot-find-lmingw32/41152979#41152979", "title": "Compile cgo lib on Cygwin64: &quot;ld: cannot find -lmingw32&quot;", "body": "<p>I have encountered the same issue as well. It seems to me that cygwin is not fully compatible with cgo. Instead, I have used <a href=\"https://mingw-w64.org\" rel=\"nofollow noreferrer\">https://mingw-w64.org</a>.</p>\n\n<p>From the cgo documentation <a href=\"https://github.com/golang/go/wiki/cgo\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/cgo</a>:</p>\n\n<blockquote>\n  <p>In order to use cgo on Windows, you'll also need to first install a gcc compiler (for instance, mingw-w64) and have gcc.exe (etc.) in your PATH environment variable before compiling with cgo will work.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 513, "user_id": 3325516, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WayaF.png?s=128&g=1", "display_name": "iqqmuT", "link": "https://stackoverflow.com/users/3325516/iqqmut"}, "is_accepted": false, "score": 3, "last_activity_date": 1493135853, "creation_date": 1493135853, "answer_id": 43615612, "question_id": 37497354, "link": "https://stackoverflow.com/questions/37497354/compile-cgo-lib-on-cygwin64-ld-cannot-find-lmingw32/43615612#43615612", "title": "Compile cgo lib on Cygwin64: &quot;ld: cannot find -lmingw32&quot;", "body": "<p>You can also install package <code>mingw64-i686-gcc-core</code> from Cygwin.</p>\n\n<p>The binary will be <code>/usr/bin/i686-w64-mingw32-gcc.exe</code> so you probably need to copy it as <code>/usr/bin/gcc.exe</code>.</p>\n"}], "owner": {"reputation": 22340, "user_id": 664108, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/cbc8378de58e66705678686057cffac9?s=128&d=identicon&r=PG", "display_name": "Fabian Schmengler", "link": "https://stackoverflow.com/users/664108/fabian-schmengler"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7688, "favorite_count": 6, "accepted_answer_id": 37501576, "answer_count": 3, "score": 14, "last_activity_date": 1493135853, "creation_date": 1464427698, "question_id": 37497354, "link": "https://stackoverflow.com/questions/37497354/compile-cgo-lib-on-cygwin64-ld-cannot-find-lmingw32", "title": "Compile cgo lib on Cygwin64: &quot;ld: cannot find -lmingw32&quot;", "body": "<p>I'm trying to use a cgo library on Windows, namely <code>github.com/mattn/go-sqlite3</code></p>\n\n<p>I use Cygwin64 and installed with all \"Development\" packages, so gcc is availabe.</p>\n\n<p>But running <code>go get github.com/mattn/go-sqlite3</code> results in:</p>\n\n<pre><code>/usr/lib/gcc/x86_64-pc-cygwin/5.3.0/../../../../x86_64-pc-cygwin/bin/ld: cannot find -lmingwex\n/usr/lib/gcc/x86_64-pc-cygwin/5.3.0/../../../../x86_64-pc-cygwin/bin/ld: cannot find -lmingw32\n</code></pre>\n\n<p>If I search for \"mingwex\" and \"mingw32\" in the Cygwin installer, I get no results. Am I looking for the wrong names or are they not available on 64 bit systems?</p>\n\n<p>Or is there a better way to use the library on Windows?</p>\n\n<hr>\n\n<p>Note that the README states that</p>\n\n<blockquote>\n  <p>However, if you install go-sqlite3 with go install\n  github.com/mattn/go-sqlite3, you don't need gcc to build your app\n  anymore</p>\n</blockquote>\n\n<p>but I get the same error message if I use <code>go install</code>.</p>\n\n<pre><code>$ go version\ngo version go1.6.2 windows/amd64\n</code></pre>\n"}, {"tags": ["go", "enums"], "comments": [{"owner": {"reputation": 4025, "user_id": 763799, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/r4nZd.jpg?s=128&g=1", "display_name": "basgys", "link": "https://stackoverflow.com/users/763799/basgys"}, "edited": false, "score": 2, "creation_date": 1464428397, "post_id": 37496098, "comment_id": 62490139, "body": "Detail not related to your question, but constants should not be uppercased (C style). It is Pending/Approved/Rejected"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464453125, "post_id": 37496098, "comment_id": 62497603, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/37385007/golang-creating-a-constant-type-and-restricting-the-types-values\">Golang: Creating a Constant Type and Restricting the Type&#39;s Values</a>"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1464453604, "post_id": 37496270, "comment_id": 62497739, "body": "Making <code>StatusType</code> unexported and using an interface won&#39;t cut it. See a dirty trick which I presented in <a href=\"http://stackoverflow.com/questions/37385007/golang-creating-a-constant-type-and-restricting-the-types-values\">Golang: Creating a Constant Type and Restricting the Type&#39;s Values</a> which allows to implement interfaces even with unexported methods. In fact, no constant type can be restricted this way."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464456169, "post_id": 37496270, "comment_id": 62498475, "body": "@icza Agree (and upvoted). I thought about unexported wrapper struct, but I want to stay as close as possible to the original code of the OP. As I say in the answer, &quot;caveat applies&quot;."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 9, "last_activity_date": 1464419442, "last_edit_date": 1495541810, "creation_date": 1464419442, "answer_id": 37496270, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/37496270#37496270", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>Simply don't export <code>StatusType</code> (assuming you define it in package '<code>status</code>').<br>\nThis follow \"<a href=\"https://stackoverflow.com/a/17989915/6309\">What is an idiomatic way of representing enums in Go?</a>\":</p>\n\n<pre><code>type statusType int\n\nconst (\n    PENDING statusType = iota\n    APPROVED\n    REJECTED\n)\ntype StatusTyper interface {\n    StatusType() statusType \n}\n\nfunc(st statusType) StatusType() statusType {\n    return st\n}\n</code></pre>\n\n<p>Any external package would then refer to <code>StatusType</code>-like variable as <code>status.PENDING</code>, <code>status.APPROVED</code> or <code>status.REJECTED</code>.<br>\n(the only three <code>statusType</code> which implement the <code>StatusTyper</code> interface. <a href=\"https://stackoverflow.com/questions/14426366/what-is-an-idiomatic-way-of-representing-enums-in-go#comment28204112_17989915\">Caveat applies</a>.)</p>\n"}, {"tags": [], "owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "is_accepted": false, "score": 3, "last_activity_date": 1464419660, "creation_date": 1464419660, "answer_id": 37496295, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/37496295#37496295", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>Assuming you wish for invalid JSON payloads to fail, implement the <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow\">Unmarshaler</a> interface: <a href=\"https://play.golang.org/p/zuchzQ0vmo\" rel=\"nofollow\">https://play.golang.org/p/zuchzQ0vmo</a> </p>\n"}, {"comments": [{"owner": {"reputation": 1330, "user_id": 78931, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/819f593d43579eff5fa5a38f69969d08?s=128&d=identicon&r=PG", "display_name": "makapuf", "link": "https://stackoverflow.com/users/78931/makapuf"}, "edited": false, "score": 0, "creation_date": 1612863685, "post_id": 37502382, "comment_id": 116892851, "body": "I think -1 would be considered valid"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 11, "last_activity_date": 1464467340, "last_edit_date": 1464467340, "creation_date": 1464459367, "answer_id": 37502382, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/37502382#37502382", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>I do this way:<br>\nfirst create a package named \"StatusType\" (inside a folder named StatusType):<br>\nfilename: $GOPATH/enum/StatusType/StatusType.go  </p>\n\n<pre><code>package StatusType\n\ntype Int int\n\nconst (\n    Pending Int = iota\n    Approved\n    Rejected\n    end\n)\n\nfunc IsValid(value int) bool {\n    return value &lt; int(end)\n}\n</code></pre>\n\n<p>and  use like this ($GOPATH/enum/main.go):</p>\n\n<pre><code>package main\n\nimport (\n    \"enum/StatusType\"\n    \"fmt\"\n)\n\nfunc Test(enum StatusType.Int) {\n    fmt.Println(enum) //1\n}\nfunc main() {\n    Test(StatusType.Approved)\n\n    fmt.Println(StatusType.IsValid(1))  //true\n    fmt.Println(StatusType.IsValid(10)) //false\n}\n</code></pre>\n\n<p>The StatusType package just exports what you need so there is no need to check against iota const range.<br>\nJust in case you want to check, use: StatusType.IsValid()<br>\nAnd nice thing about StatusType package is:<br>\nWhen you want function parameter of StatusType type use StatusType.Int and it reveals that it is enumeration of type int.<br>\nLike:</p>\n\n<pre><code>Test(StatusType.Approved)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 9965269, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/491d5b4a0275ec20fc534cfb7e23447d?s=128&d=identicon&r=PG", "display_name": "user9965269", "link": "https://stackoverflow.com/users/9965269/user9965269"}, "is_accepted": false, "score": 0, "last_activity_date": 1547718045, "creation_date": 1547718045, "answer_id": 54232963, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/54232963#54232963", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>use go generate with <a href=\"https://github.com/alvaroloes/enumer\" rel=\"nofollow noreferrer\">github.com/alvaroloes/enumer</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//go:generate enumer -type=StatusType\ntype StatusType int\n\nconst (\n    PENDING StatusType = iota\n    APPROVED\n    REJECTED\n)\n\nfunc main() {\n    fmt.Println(StatusType(0).IsAStatusType()) // true\n    fmt.Println(StatusType(1).IsAStatusType()) // true\n    fmt.Println(StatusType(2).IsAStatusType()) // true\n    fmt.Println(StatusType(3).IsAStatusType()) // false\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 4156120, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/99d81979a0b62db9913702d119ed3a68?s=128&d=identicon&r=PG&f=1", "display_name": "Keiser He", "link": "https://stackoverflow.com/users/4156120/keiser-he"}, "is_accepted": false, "score": 0, "last_activity_date": 1548260624, "last_edit_date": 1548260624, "creation_date": 1547720467, "answer_id": 54233726, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/54233726#54233726", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>the iota is merely a compiler thing. The code is equivalent to:</p>\n\n<pre><code>const PENDING int = 0\nconst APPROVED int = 1\n...\n</code></pre>\n\n<p>So to design a function CheckValid() to decide if the value is among the given values.\nYou could either use user6169399's method if your const is in a continuous range.\nOr you could simply define a var map[YOUR_TYPE_HERE]bool to validate.</p>\n\n<pre><code>func (t YOUR_TYPE) CheckValid(){\n    if _, ok:=map[t];ok return true\n    else return false\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 69, "user_id": 6426898, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-fNrIO7HTN44/AAAAAAAAAAI/AAAAAAAAABQ/ruSipc9BQMQ/photo.jpg?sz=128", "display_name": "Iveronanomi", "link": "https://stackoverflow.com/users/6426898/iveronanomi"}, "is_accepted": false, "score": 0, "last_activity_date": 1552905880, "creation_date": 1552905880, "answer_id": 55219505, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang/55219505#55219505", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>Here are another two ways to do it right without map\n<a href=\"https://play.golang.org/p/eKW_KPshx7b\" rel=\"nofollow noreferrer\">https://play.golang.org/p/eKW_KPshx7b</a></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"errors\"\n    \"log\"\n)\n\ntype StatusType int\n\nconst (\n    PENDING StatusType = iota\n    APPROVED\n    REJECTED\n)\n\nfunc Validate(val int) (bool, error) {\n    if v := StatusType(val); v &gt; REJECTED || v &lt; PENDING {\n        return false, errors.New(\"invalid StatusType\")\n    }\n    return true, nil\n}\n\nfunc (t StatusType) Validate() (bool, error) {\n    if t &gt; REJECTED || t &lt; PENDING {\n        return false, errors.New(\"invalid StatusType\")\n    }\n    return true, nil\n}\n\n\nfunc main() {\n    log.Print(Validate(-1))\n    log.Print(Validate(0))\n    log.Print(Validate(1))\n    log.Print(Validate(3))\n\n    log.Print(StatusType(-1).Validate())\n    log.Print(StatusType(1).Validate())\n    log.Print(StatusType(10).Validate())\n}\n</code></pre>\n"}], "owner": {"reputation": 1571, "user_id": 1041618, "user_type": "registered", "accept_rate": 27, "profile_image": "https://i.stack.imgur.com/ZY0v7.jpg?s=128&g=1", "display_name": "Shamsher", "link": "https://stackoverflow.com/users/1041618/shamsher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10482, "favorite_count": 3, "answer_count": 6, "score": 12, "last_activity_date": 1569606344, "creation_date": 1464418108, "last_edit_date": 1569606344, "question_id": 37496098, "link": "https://stackoverflow.com/questions/37496098/how-to-check-whether-the-value-is-of-type-iota-constant-in-golang", "title": "How to check whether the value is of type iota constant in Golang?", "body": "<p>I have the following type defined using iota in Golang.</p>\n\n<pre><code>type StatusType int\n\nconst (\n    PENDING StatusType = iota\n    APPROVED\n    REJECTED\n)\n</code></pre>\n\n<p>I want to restrict the value passed in REST-API to the StatusType. Such that the value should not exceed 0,1,2.</p>\n"}, {"tags": ["go", "google-drive-api"], "comments": [{"owner": {"reputation": 18863, "user_id": 1000753, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/23634e7a38e353cca12bb72a4205615b?s=128&d=identicon&r=PG", "display_name": "pinoyyid", "link": "https://stackoverflow.com/users/1000753/pinoyyid"}, "edited": false, "score": 0, "creation_date": 1464444196, "post_id": 37495815, "comment_id": 62494784, "body": "what type of file is it?"}, {"owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "reply_to_user": {"reputation": 18863, "user_id": 1000753, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/23634e7a38e353cca12bb72a4205615b?s=128&d=identicon&r=PG", "display_name": "pinoyyid", "link": "https://stackoverflow.com/users/1000753/pinoyyid"}, "edited": false, "score": 0, "creation_date": 1464549317, "post_id": 37495815, "comment_id": 62521217, "body": "Image png but hopefully an answer exists for any type"}], "answers": [{"comments": [{"owner": {"reputation": 2121, "user_id": 2759097, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1010688230/picture?type=large", "display_name": "DaFois", "link": "https://stackoverflow.com/users/2759097/dafois"}, "edited": false, "score": 0, "creation_date": 1513089859, "post_id": 47774939, "comment_id": 82511548, "body": "while the link may give an answer the question, it is better to include the most important parts in your answer and to use the link only as reference"}, {"owner": {"reputation": 19, "user_id": 8148648, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mY294O3RrKo/AAAAAAAAAAI/AAAAAAAAACk/Rev4tWFUFi8/photo.jpg?sz=128", "display_name": "Prajeesh Prakash", "link": "https://stackoverflow.com/users/8148648/prajeesh-prakash"}, "reply_to_user": {"reputation": 2121, "user_id": 2759097, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1010688230/picture?type=large", "display_name": "DaFois", "link": "https://stackoverflow.com/users/2759097/dafois"}, "edited": false, "score": 0, "creation_date": 1513159758, "post_id": 47774939, "comment_id": 82541672, "body": "Thank you for the suggestion Mr. DaFois"}], "tags": [], "owner": {"reputation": 19, "user_id": 8148648, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-mY294O3RrKo/AAAAAAAAAAI/AAAAAAAAACk/Rev4tWFUFi8/photo.jpg?sz=128", "display_name": "Prajeesh Prakash", "link": "https://stackoverflow.com/users/8148648/prajeesh-prakash"}, "is_accepted": false, "score": 0, "last_activity_date": 1513088708, "creation_date": 1513088708, "answer_id": 47774939, "question_id": 37495815, "link": "https://stackoverflow.com/questions/37495815/unsupportedoutputformat-go-drive-api-sdk-v3-fails-to-download-content-of-file-on/47774939#47774939", "title": "unsupportedOutputFormat go drive api sdk v3 fails to download content of file on gdrive", "body": "<p><a href=\"https://stackoverflow.com/questions/47279650/upload-file-to-google-drive-using-rest-api-in-node-js\">this</a> solution worked for me. the change found is that to give the file URL directly. which lead to another error on inSufficientPermission. Solved that too via <a href=\"https://stackoverflow.com/questions/32309136/google-drive-api-client-python-insufficient-permission-for-files-insert\">this</a></p>\n"}], "owner": {"reputation": 764, "user_id": 1405725, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/85157a97c87155b8ec2671e86aef1087?s=128&d=identicon&r=PG", "display_name": "Darian311", "link": "https://stackoverflow.com/users/1405725/darian311"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 778, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1513088708, "creation_date": 1464415676, "last_edit_date": 1464444183, "question_id": 37495815, "link": "https://stackoverflow.com/questions/37495815/unsupportedoutputformat-go-drive-api-sdk-v3-fails-to-download-content-of-file-on", "title": "unsupportedOutputFormat go drive api sdk v3 fails to download content of file on gdrive", "body": "<p>The docs aren't clear about how to properly set output format. \nI hardcoded a route for a single file on google drive: \n<a href=\"http://localhost:8080/0B-zdryEj60U_OXZBVklsdG13Wlk\" rel=\"nofollow\">http://localhost:8080/0B-zdryEj60U_OXZBVklsdG13Wlk</a>\nand it responds below: \nthe runtime process gave a bad HTTP response:              </p>\n\n<pre><code>2016/05/28 06:00:26 handleOneDoc\n2016/05/28 06:00:26 \n2016/05/28 06:00:26 &amp;{0xc82007a500 0xc8201121c0 0x84de40 false false 0xc82016a180 {0xc82016c820 map[] false false} map[] false 0 -1 0 false false [] 0 [0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0] [0 0 0 0 0 0 0 0 0 0] &lt;nil&gt;}\n2016/05/28 06:00:29 Unable to get download link %vgoogleapi: got HTTP response code 400 with body: {\"error\":{\"errors\":[{\"domain\":\"global\",\"reason\":\"unsupportedOutputFormat\",\"message\":\"Unsupported Output Format\",\"locationType\":\"parameter\",\"location\":\"alt\"}],\"code\":400,\"message\":\"Unsupported Output Format\"}}\n</code></pre>\n\n<p>Below is the source:</p>\n\n<pre><code>package gwebdrive\n\nimport (\n    \"fmt\"\n    \"golang.org/x/net/context\"\n    _ \"golang.org/x/oauth2\"\n    \"golang.org/x/oauth2/google\"\n    \"golang.org/x/oauth2/jwt\"\n    \"google.golang.org/api/drive/v3\"\n    \"google.golang.org/appengine\"\n    _ \"html/template\"\n    _ \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n    \"net/url\"\n\n    \"strings\"\n)\n\nconst (\n    assetFolder = \"0B-zdryEj60U_N0NtSFJuQUdaWTA\"\n)\n\nvar (\n    //tpl  *template\n    dir  *drive.FileList\n    conf *jwt.Config\n)\n\nfunc init() {\n    ... key config content here. \n    http.Handle(\"/list\", appengineHandler(handleList))\n    http.Handle(\"/0B-zdryEj60U_OXZBVklsdG13Wlk\", appengineHandler(handleOneDoc))\n\n    //http.Handle(\"/.+\", appengineHandler(handleContent))\n}\n\n// appengineHandler wraps http.Handler to pass it a new `appengine.Context` and handle errors.\ntype appengineHandler func(c context.Context, w http.ResponseWriter, r *http.Request) error\n\nfunc (h appengineHandler) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\n    c := appengine.NewContext(r)\n    if err := h(c, w, r); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"Hello Darian Go Serve some Assets\")\n\n}\n\nfunc handleOneDoc(c context.Context, w http.ResponseWriter, r *http.Request) error {\n    log.Print(\"handleOneDoc\")\n    u, err := url.Parse(r.RequestURI)\n    if err != nil {\n        log.Fatalf(\"Unable to parse Request URL %v\", err)\n    }\n    log.Printf(u.RawPath)\n    s := strings.Split(u.RawPath, \"/\")\n    // looking for regex for Google File ID's.\n\n    // I don't actually know the point of this call but it's needed.\n    client := conf.Client(appengine.NewContext(r))\n    // use url to decide what asset to return as data.\n    // for now assume url contains id.\n    srv, err := drive.New(client)\n    fileid := s[len(s)-1]\n    log.Print(w, fileid)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve drive Client %v\", err)\n    }\n\n    dwn, err := srv.Files.Get(fileid).Download()\n    fmt.Fprint(w, \"mimeType:image/png\")\n\n    if err != nil {\n        log.Fatal(\"Unable to get download link %v\", err)\n    }\n\n    fmt.Fprint(w, dwn.Body)\n\n    return nil\n\n}\n\nfunc handleContent(c context.Context, w http.ResponseWriter, r *http.Request) error {\n    log.Print(\"handleContent\")\n    u, err := url.Parse(r.RequestURI)\n    if err != nil {\n        log.Fatalf(\"Unable to parse Request URL %v\", err)\n    }\n    fmt.Fprintf(w, u.RawPath)\n    s := strings.Split(u.RawPath, \"/\")\n    // looking for regex for Google File ID's.\n\n    // I don't actually know the point of this call but it's needed.\n    client := conf.Client(appengine.NewContext(r))\n    // use url to decide what asset to return as data.\n    // for now assume url contains id.\n    srv, err := drive.New(client)\n    fileid := s[len(s)-1]\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve drive Client %v\", err)\n    }\n\n    dwn, err := srv.Files.Get(fileid).Download()\n    //service.files().get(fileId).executeMediaAndDownloadTo(w)\n    fmt.Fprint(w, dwn)\n    if err != nil {\n        log.Fatal(\"Unable to get download link %v\", err)\n    }\n\n    //fmt.Fprint(w, dwn)\n\n    return nil\n\n}\n\nfunc handleList(c context.Context, w http.ResponseWriter, r *http.Request) error {\n    log.Print(\"just handle\")\n\n    // Initiate an http.Client, the following GET request will be\n    // authorized and authenticated on the behalf of user@example.com.\n    client := conf.Client(appengine.NewContext(r))\n\n    srv, err := drive.New(client)\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve drive Client %v\", err)\n    }\n\n    dir, err = srv.Files.List().PageSize(10).Q(\"'0B-zdryEj60U_MXVkajFweXBQWHM' in parents\").\n        Fields(\"files(id, kind, name, size, webViewLink)\").Do()\n    //resp, err := srv.Files.Export(dir.Files[1].Id, dir.Files[1].MimeType).Download()\n    //fmt.Fprint(w, resp.Body)\n\n    if err != nil {\n        log.Fatalf(\"Unable to retrieve files.\", err)\n    }\n\n    fmt.Fprint(w, \"Files:\")\n    if len(dir.Files) &gt; 0 {\n        for _, i := range dir.Files {\n            fmt.Fprint(w, \"%s (%s)\\n\", i.Name, i.WebViewLink)\n        }\n    } else {\n        fmt.Fprint(w, \"No files found.\")\n    }\n    return err\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1464409369, "post_id": 37495107, "comment_id": 62486161, "body": "There is no difference actually. But it is good practice to pass the required variables from enclosing scope as parameters to goroutines."}], "answers": [{"comments": [{"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1464444521, "post_id": 37495793, "comment_id": 62494887, "body": "You say &quot;the third version is also good&quot;. So that means the Ticker will work properly, even if it&#39;s defined in the same Goroutine that is doing the work?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1464503259, "post_id": 37495793, "comment_id": 62508157, "body": "@AndreKR yes, using variables in the same goroutine that they&#39;re defined is normal. It may help to understand that all programs have at least one goroutine -- the one that runs your code in main!"}, {"owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "edited": false, "score": 0, "creation_date": 1464530708, "post_id": 37495793, "comment_id": 62515317, "body": "I thought maybe when the goroutine was busy the Ticker somehow doesn&#39;t get a chance to send the next tick to the channel, but on second thought that doesn&#39;t really make sense, the ticker will need another internal goroutine in any case."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 2, "last_activity_date": 1464415497, "creation_date": 1464415497, "answer_id": 37495793, "question_id": 37495107, "link": "https://stackoverflow.com/questions/37495107/does-it-matter-where-i-create-the-ticker/37495793#37495793", "title": "Does it matter where I create the Ticker?", "body": "<p>The second version of the code is wrong: it has a race condition.</p>\n\n<pre><code>var ticker *time.Ticker\n\ngo func() {\n    ticker = time.NewTicker(1 * time.Second)\n    for _ = range ticker.C {\n        fmt.Print(\"Tick\")\n    }\n}()\n\ntime.Sleep(3)\nticker.Stop()\n</code></pre>\n\n<p>There's no synchronization between the assignment to <code>ticker</code> inside the goroutine and the use of <code>ticker</code> in the <code>ticker.Stop()</code> call.</p>\n\n<p>In practice this will almost always be harmless because of the long <code>time.Sleep(3)</code>, but such races should be avoided if possible because even if they're harmless today they may cause trouble later. For example, if instead of <code>Sleep</code> you have some code that takes a variable amount of time, you may see nil pointer panics if that code happens to take a very short amount of time.</p>\n\n<p>So for that reason, I'd always use the first version of your code (the one that creates the <code>ticker</code> outside the goroutine).</p>\n\n<p>The third version of the code (where the <code>ticker</code> is used entirely inside the goroutine) is also good. I'd definitely use this shorter version of the code where the ticker is defined inside the goroutine if that's possible. The shortness of the code is nice, but I also like that the code outside doesn't see the ticker at all, so it's easy for the reader of the code to understand the scope of the ticker.</p>\n"}], "owner": {"reputation": 27770, "user_id": 476074, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ad32697402bb21379768728e8640a22?s=128&d=identicon&r=PG", "display_name": "AndreKR", "link": "https://stackoverflow.com/users/476074/andrekr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 75, "favorite_count": 0, "accepted_answer_id": 37495793, "answer_count": 1, "score": 0, "last_activity_date": 1464415497, "creation_date": 1464408794, "question_id": 37495107, "link": "https://stackoverflow.com/questions/37495107/does-it-matter-where-i-create-the-ticker", "title": "Does it matter where I create the Ticker?", "body": "<p>Is there any difference between</p>\n\n<pre><code>ticker := time.NewTicker(1 * time.Second)\n\ngo func() {\n    for _ = range ticker.C {\n        fmt.Print(\"Tick\")\n    }\n}()\n\ntime.Sleep(3)\nticker.Stop()\n</code></pre>\n\n<p>and</p>\n\n<pre><code>var ticker *time.Ticker\n\ngo func() {\n    ticker = time.NewTicker(1 * time.Second)\n    for _ = range ticker.C {\n        fmt.Print(\"Tick\")\n    }\n}()\n\ntime.Sleep(3)\nticker.Stop()\n</code></pre>\n\n<p>in terms of thread-safeness, especially when the work in the function takes longer than a tick's period?</p>\n\n<p>I am asking because (when stopping the Ticker is not required) the latter can be shortened to</p>\n\n<pre><code>go func() {\n    for ticker := time.NewTicker(1 * time.Second) ;; &lt;-ticker.C {\n        fmt.Print(\"Tick\")\n    }\n}()\n</code></pre>\n\n<p>while the former cannot. This form has the additional advantage that the first tick is triggered right away.</p>\n"}, {"tags": ["go", "markdown"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 1, "creation_date": 1464407135, "post_id": 37494831, "comment_id": 62485825, "body": "Where exactly does the dividing line between &quot;fancy&quot; and &quot;non-fancy&quot; packages lay?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1464407607, "post_id": 37494831, "comment_id": 62485897, "body": "For extraction, you&#39;d need to parse the slice of bytes, extracting the YAML information, and pass the remaining bytes to <code>MarkdownCommon</code>. <a href=\"https://godoc.org/gopkg.in/yaml.v2\" rel=\"nofollow noreferrer\">A YAML parser</a> could help here, if you didn&#39;t want to parse it yourself, though it might be overkill in your case."}, {"owner": {"reputation": 15991, "user_id": 56693, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/f8c3348c144b3d7c7d16264bb2adf7ee?s=128&d=identicon&r=PG", "display_name": "eduncan911", "link": "https://stackoverflow.com/users/56693/eduncan911"}, "edited": false, "score": 3, "creation_date": 1464408827, "post_id": 37494831, "comment_id": 62486088, "body": "You are already using a <i>fancy package</i> named blackfriday.  Also, <code>html&#47;template</code>, <code>io&#47;ioutil</code> and <code>net&#47;http</code> are all <i>fancy packages</i> as well - just they are included with Go&#39;s installation.  Just use <code>github.com&#47;go-yaml&#47;yaml</code> and move on."}, {"owner": {"reputation": 107, "user_id": 5800226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5a483dc8d5e2c2e9e0afe2006085bb6?s=128&d=identicon&r=PG&f=1", "display_name": "user5800226", "link": "https://stackoverflow.com/users/5800226/user5800226"}, "edited": false, "score": 0, "creation_date": 1464449679, "post_id": 37494831, "comment_id": 62496508, "body": "Ok thanks I&#39;ll look into the yaml package. I just didn&#39;t want to use something huge like Hugo or Revel."}], "answers": [{"tags": [], "owner": {"reputation": 3025, "user_id": 1063, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/229e3746f6f5100c1d7d5d7a8a5b82d5?s=128&d=identicon&r=PG", "display_name": "icco", "link": "https://stackoverflow.com/users/1063/icco"}, "is_accepted": false, "score": 0, "last_activity_date": 1609381555, "creation_date": 1609381555, "answer_id": 65515917, "question_id": 37494831, "link": "https://stackoverflow.com/questions/37494831/how-do-i-insert-extract-front-matter-from-blackfriday-in-go/65515917#65515917", "title": "How do I insert/extract front matter from Blackfriday in Go?", "body": "<p>I use <a href=\"https://github.com/gernest/front\" rel=\"nofollow noreferrer\">https://github.com/gernest/front</a> to parse jekyll files. Works pretty well. First parse the file with <code>front</code>, then pass body to blackfriday.</p>\n"}], "owner": {"reputation": 107, "user_id": 5800226, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f5a483dc8d5e2c2e9e0afe2006085bb6?s=128&d=identicon&r=PG&f=1", "display_name": "user5800226", "link": "https://stackoverflow.com/users/5800226/user5800226"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 610, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1609381555, "creation_date": 1464405404, "last_edit_date": 1464406391, "question_id": 37494831, "link": "https://stackoverflow.com/questions/37494831/how-do-i-insert-extract-front-matter-from-blackfriday-in-go", "title": "How do I insert/extract front matter from Blackfriday in Go?", "body": "<p>In jekyll you insert this at the top of your markdown and are able to insert them into your layouts:</p>\n\n<pre><code>---\n\nlayout: post\n\ntitle: Blogging Like a Hacker\n\n---\n</code></pre>\n\n<p>I need to do the same in Go using no frameworks or fancy packages. Just Golang.</p>\n\n<pre><code>import (\n       \"github.com/russross/blackfriday\"\n       \"html/template\"\n       \"io/ioutil\"\n       \"net/http\"\n)\n\ntype webPost struct {\n     Title       string\n     Author      string\n     Description string\n     Body        template.HTML\n}\n\n\n\nfunc handlePost(res http.ResponseWriter, req *http.Request) {\n\n          //Read in some markdown from a file\n          input, _ := ioutil.ReadFile(\"test.md\")\n          //Render it into HTML\n          output := blackfriday.MarkdownCommon(input)\n\n          //I need the first three parameters to grab the front matter from test.md\n          post := webPost{\"title\", \"author\", \"a descritpion\", template.HTML(output)}\n          //Serve to client a template \n          templates.ExecuteTemplate(res, \"Post\", post)\n}\n</code></pre>\n"}, {"tags": ["go", "interface", "slice", "mergesort"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 4, "creation_date": 1464397909, "post_id": 37494264, "comment_id": 62484604, "body": "<code>sort.Interface</code> is designed for <code>sort.Sort</code>. It&#39;s not a good fit for a non-in-place sort like merge sort."}, {"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 0, "creation_date": 1464399057, "post_id": 37494264, "comment_id": 62484819, "body": "You might want to address the question of why you&#39;re implementing merge sort in the first place when the <code>sort</code> package provides perfectly capable sorting and binary search facilities."}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1464406404, "post_id": 37494264, "comment_id": 62485726, "body": "He could be implementing a typed version of it."}, {"owner": {"reputation": 1479, "user_id": 1164937, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/70d5a73393d4d374e50da45db2df7646?s=128&d=identicon&r=PG", "display_name": "user1164937", "link": "https://stackoverflow.com/users/1164937/user1164937"}, "edited": false, "score": 0, "creation_date": 1464415893, "post_id": 37494264, "comment_id": 62487207, "body": "Yeah, I was rewriting some algorithms I learned in Java to Go. I tried to follow Go&#39;s footsteps by copying <code>sort.Interface</code> worked, but this is where things got weird. I&#39;m going to stick with working with primitive types for my algorithms. And of course, use Go&#39;s packages for actual projects (I rarely have a need for generics with just those anyway)"}], "answers": [{"tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 0, "last_activity_date": 1464399871, "creation_date": 1464399871, "answer_id": 37494419, "question_id": 37494264, "link": "https://stackoverflow.com/questions/37494264/go-how-to-copy-slice-of-an-interface/37494419#37494419", "title": "Go - How to copy slice of an interface?", "body": "<p>Use the built-in <code>copy</code> function, you just have to declare the new slice as an interface type:</p>\n\n<pre><code>type Interface []string\n\nfunc merge(data Interface, lo, mid, hi int) {\n    i, j := lo, mid+1\n    var aux Interface = make([]string, len(data), len(data))\n    copy(aux, data)\n}\n</code></pre>\n"}], "owner": {"reputation": 1479, "user_id": 1164937, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/70d5a73393d4d374e50da45db2df7646?s=128&d=identicon&r=PG", "display_name": "user1164937", "link": "https://stackoverflow.com/users/1164937/user1164937"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 733, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464399871, "creation_date": 1464397605, "question_id": 37494264, "link": "https://stackoverflow.com/questions/37494264/go-how-to-copy-slice-of-an-interface", "title": "Go - How to copy slice of an interface?", "body": "<p>I'm trying to implement a simple merge sort using an auxiliary array. I have <code>type byString []string</code> that implements the <code>Less, Swap, and Len</code> methods. It's basically following Go's <code>sort</code> package's interface.</p>\n\n<p>However, I'm having some difficulty choosing the best route to copy the <code>byString</code> slice to a temporary array. </p>\n\n<p>Please help me break out of Java's polymorphism world to make it work with Go.</p>\n\n<pre><code>func merge(data Interface, lo, mid, hi int) {\n  i, j := lo, mid+1\n\n  // How do I copy data's elements to a new slice called aux?\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-datastore"], "answers": [{"comments": [{"owner": {"reputation": 293, "user_id": 1497954, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b15aa28fde8d1ff2299b9c277ccffd6?s=128&d=identicon&r=PG", "display_name": "Max ZooZoo", "link": "https://stackoverflow.com/users/1497954/max-zoozoo"}, "edited": false, "score": 0, "creation_date": 1464471123, "post_id": 37499371, "comment_id": 62502859, "body": "thanks for well explained answer to my confusion about the concrete type. I am trying to understand how implementing the <code>PropertyLoadSaver</code> (<a href=\"https://cloud.google.com/appengine/docs/go/datastore/reference#hdr-The_PropertyLoadSaver_Interface\" rel=\"nofollow noreferrer\">cloud.google.com/appengine/docs/go/datastore/&hellip;</a>) can help me in this situation. What I would like to achieve here is to make a generic function which can store any Kind and it can get the kind&#39;s name using the metadata attached to the kind itself. I tried to achieve that by introducing <code>Name()</code>. Do you have any solution to this? So the caller doesn&#39;t need to specify the kind name all the time."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 293, "user_id": 1497954, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b15aa28fde8d1ff2299b9c277ccffd6?s=128&d=identicon&r=PG", "display_name": "Max ZooZoo", "link": "https://stackoverflow.com/users/1497954/max-zoozoo"}, "edited": false, "score": 0, "creation_date": 1464678696, "post_id": 37499371, "comment_id": 62567672, "body": "@MaxZooZoo <code>Name()</code> is a too generic method name, I would choose something more specific (e.g. <code>EntityName()</code>). But I would not go this down this path, entity name is rather a meta-info and not something a concrete implementation should decide. Better would be to add a new field to structs, using <a href=\"http://stackoverflow.com/questions/10858787/what-are-the-uses-for-tags-in-go/30889373#30889373\">struct tags</a> to exclude it, but the tag value could hold the info for entity name. Or even better option would be to build a registry of names, a <code>map[Type]string</code> mapping from Go type to entity name."}, {"owner": {"reputation": 293, "user_id": 1497954, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b15aa28fde8d1ff2299b9c277ccffd6?s=128&d=identicon&r=PG", "display_name": "Max ZooZoo", "link": "https://stackoverflow.com/users/1497954/max-zoozoo"}, "edited": false, "score": 0, "creation_date": 1464711400, "post_id": 37499371, "comment_id": 62590159, "body": "That&#39;s exactly my point. I liked the tag approach, but I was wondering if there is a way to tag a struct itself since the metadata is to be linked to the whole struct instead of a specific field in the struct. If you are familiar with annotations in Java, it would be a class annotation. Do we have such a thing in Go?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 293, "user_id": 1497954, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b15aa28fde8d1ff2299b9c277ccffd6?s=128&d=identicon&r=PG", "display_name": "Max ZooZoo", "link": "https://stackoverflow.com/users/1497954/max-zoozoo"}, "edited": false, "score": 0, "creation_date": 1464715806, "post_id": 37499371, "comment_id": 62592710, "body": "@MaxZooZoo No, only fields can be &quot;tagged&quot;. To &quot;tag&quot; types, use a registry mentioned above: <code>map[Type]string</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 16, "last_activity_date": 1506760155, "last_edit_date": 1506760155, "creation_date": 1464440826, "answer_id": 37499371, "question_id": 37494137, "link": "https://stackoverflow.com/questions/37494137/datastore-invalid-entity-type-on-put/37499371#37499371", "title": "datastore: invalid entity type on Put", "body": "<p><a href=\"https://godoc.org/google.golang.org/appengine/datastore#Put\" rel=\"noreferrer\"><code>datastore.Put()</code></a> expects the entity data as a struct pointer or any value that implements <a href=\"https://godoc.org/google.golang.org/appengine/datastore#PropertyLoadSaver\" rel=\"noreferrer\"><code>PropertyLoadSaver</code></a>. This is clearly stated in its doc:</p>\n\n<blockquote>\n  <p><code>src</code> must be a struct pointer or implement <code>PropertyLoadSaver</code></p>\n</blockquote>\n\n<p>What you pass to <code>datastore.Put()</code> is a pointer value, a pointer to an interface. It's true that the value stored in the interface is of concrete type <code>model.Message</code>, but they are not the same.</p>\n\n<p>You can't use <code>reflect.TypeOf().String()</code> because in case of interface it tells you the concrete type stored in the interface (so it might be misleading).</p>\n\n<p>See this code to demonstrate the difference:</p>\n\n<pre><code>var data Kind = Message{}\nfmt.Println(reflect.TypeOf(&amp;data).Kind())\nfmt.Println(reflect.TypeOf(&amp;data).Elem().Kind())\n\nvar msg Message = Message{}\nfmt.Println(reflect.TypeOf(&amp;msg).Kind())\nfmt.Println(reflect.TypeOf(&amp;msg).Elem().Kind())\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/dYi3ACTvBT\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>ptr\ninterface\nptr\nstruct\n</code></pre>\n\n<p>All in all, <code>&amp;data</code> is a pointer to an interface, and that is not allowed to be passed to <code>datastore.Put()</code>. You can only pass <code>*Message</code>, or if you want to pass an interface value (NOT a pointer to an interface), then make sure to implement <code>PropertyLoadSaver</code>.</p>\n"}], "owner": {"reputation": 293, "user_id": 1497954, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4b15aa28fde8d1ff2299b9c277ccffd6?s=128&d=identicon&r=PG", "display_name": "Max ZooZoo", "link": "https://stackoverflow.com/users/1497954/max-zoozoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5347, "favorite_count": 1, "accepted_answer_id": 37499371, "answer_count": 1, "score": 10, "last_activity_date": 1506760155, "creation_date": 1464396067, "last_edit_date": 1474380990, "question_id": 37494137, "link": "https://stackoverflow.com/questions/37494137/datastore-invalid-entity-type-on-put", "title": "datastore: invalid entity type on Put", "body": "<p>I am trying to create a wrapper around my Kinds and here is how I am doing it:</p>\n\n<pre><code>package model\n\nimport (\n    \"time\"\n)\n\ntype Kind interface {\n    Name() string\n}\n\ntype Message struct {\n    Text      string\n    CreatedOn time.Time\n    UserId    string\n}\n\nfunc (q Message) Name() string {\n    return \"MESSAGE\"\n}\n</code></pre>\n\n<p>And the reason I introduced <code>type Kind interface</code> is:</p>\n\n<pre><code>// Stores the given model for the the kind in data store\nfunc Store(req *http.Request, data Kind) error {\n    ctx := appengine.NewContext(req)\n    key := datastore.NewKey(ctx, data.Name(), \"\", 0, nil)\n    _, err := datastore.Put(ctx, key, &amp;data)\n    return err\n}\n</code></pre>\n\n<p>As you can see, I am using <code>data.Name()</code> to get the kinds name. </p>\n\n<p>When I try to save the data, it complains about: </p>\n\n<pre><code>datastore: invalid entity type\n</code></pre>\n\n<p>I read that this could be due to not passing the reference to <code>datastore.Put</code>, but I am doing that. Any idea?</p>\n\n<p>I must add that when I checked the type of data (using <code>reflect.TypeOf()</code>), it is <code>model.Message</code> which is correct too. So it is a concrete type.</p>\n"}, {"tags": ["reflection", "go"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 4, "creation_date": 1464393711, "post_id": 37493805, "comment_id": 62483881, "body": "You might want to at least provide some code or something or you&#39;re gonna end up having your question down voted"}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user539810"}, "edited": false, "score": 2, "creation_date": 1464402534, "post_id": 37494338, "comment_id": 62485294, "body": "Regarding why it&#39;s a bad idea: the internal structure of the logger might change in the next release or 10 releases from now, making your code break entirely. Worse, if you update your code to accommodate this change, suddenly a person with the new version of your code and the old version of the logger finds their code doesn&#39;t work. The reverse situation where this version of your code and a new version of the logger code that is incompatible are used is equally as bad. Of course, it might not change at all, but that doesn&#39;t mean it&#39;s a good idea."}], "tags": [], "owner": {"reputation": 8007, "user_id": 6336139, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yZ1gA.png?s=128&g=1", "display_name": "T. Claverie", "link": "https://stackoverflow.com/users/6336139/t-claverie"}, "is_accepted": false, "score": 1, "last_activity_date": 1464399047, "last_edit_date": 1464399047, "creation_date": 1464398609, "answer_id": 37494338, "question_id": 37493805, "link": "https://stackoverflow.com/questions/37493805/golang-how-to-access-internals-of-struct-reflection/37494338#37494338", "title": "golang - how to access internals of struct (reflection?)", "body": "<p>I will first go through what you asked for exactly, that is access the attributes stored in the logger's context.</p>\n\n<p>Reflection in Go is based on <code>Type</code> and <code>Value</code>. You do not have access to any data using <code>Type</code>, you just have information about the type (surprise !). So, here you have to use the <code>Value</code> side of reflection.</p>\n\n<p>However, the problem is that the <code>ctx</code> field of the logger is not exported, so it's not possible to access it directly. However, using a bit of unsafe operations make it doable.</p>\n\n<p>Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\ntype logger struct {\n    ctx []interface{}\n}\n\ntype Logger interface {\n    Populate(ctx ...interface{})\n}\n\nfunc NewLogger() Logger {\n     return &amp;logger{}\n}\n\nfunc (l *logger) Populate(ctx ...interface{}) {\n    l.ctx = ctx\n}\n\nfunc main() {\n    log := NewLogger()\n    log.Populate(42, \"42\", 84, \"84\")\n    fmt.Println(log)\n    // &amp;{[42 42 84 84]}\n    v := reflect.ValueOf(log).Elem()\n    field := v.FieldByName(\"ctx\")\n    ar := *(*[]interface{})(unsafe.Pointer(field.UnsafeAddr()))\n\n    for _, i := range ar {\n        fmt.Println(i)\n    }\n    // 42 42 84 84\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/mv2-MoR75Q\" rel=\"nofollow\">Go playground</a></p>\n\n<p><strong>Do NEVER do that</strong></p>\n\n<p>The code works, and produces what you expect. However, what you are doing is using reflection and unsafe operations to get values from an <strong>unexported</strong> struct of a <strong>third-party</strong> library. My english is not good enough to express properly how <strong>bad</strong> this is.</p>\n\n<p>If you don't want to have twice the same attribute in the logger, do not put it twice in the first place, it's far better and easier than maintaining the code that's above.</p>\n\n<p>If you still do not trust yourself enough for this, then wrap the logger in a struct where you store the attributes contained in the logger. At least it will be something you have your hands on, and do the same job.</p>\n\n<p>So, you're free to use this code. But if you want to do yourself a favor, you won't use it in that case.</p>\n"}], "owner": {"reputation": 1, "user_id": 6393070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2zgZI.png?s=128&g=1", "display_name": "cooljames", "link": "https://stackoverflow.com/users/6393070/cooljames"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 245, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464399047, "creation_date": 1464392991, "question_id": 37493805, "link": "https://stackoverflow.com/questions/37493805/golang-how-to-access-internals-of-struct-reflection", "title": "golang - how to access internals of struct (reflection?)", "body": "<p>I need to add attributes to a log15 logger, but if I inadvertently add one twice it will appear twice. So, I want to add logic to see if the attribute is already populated and skip the action if it is.</p>\n\n<p>Here's what I get when I output the log object:</p>\n\n<pre><code>log=\"&amp;{ctx:[field1 val1 field2 val2 field3 val3 field2 val2] h:0xc82052c1e0}\"\n</code></pre>\n\n<p>How can I access that 'ctx' field and validate when my value is already there? I've tried some reflection tricks and can get the data type, but I can't figure out how to get the value.</p>\n"}, {"tags": ["http", "redirect", "go"], "comments": [{"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1464386841, "post_id": 37492544, "comment_id": 62482129, "body": "Are you using any sort of templating package or front end framework e.g. Angular / React / EmberJS?"}, {"owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "reply_to_user": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1464387511, "post_id": 37492544, "comment_id": 62482327, "body": "No. This is on Windows, if that makes any difference. It&#39;s straight HTML and Javascript. This is in development, and I&#39;m using <a href=\"https://localhost:3001/login.html\" rel=\"nofollow noreferrer\">localhost:3001/login.html</a> as the URL. Everything is running on the same machine."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "edited": false, "score": 0, "creation_date": 1464387646, "post_id": 37492544, "comment_id": 62482372, "body": "Can you include the small snippet of JavaScript and html that processes the login"}], "answers": [{"comments": [{"owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464389031, "post_id": 37493204, "comment_id": 62482797, "body": "You&#39;re brilliant. Thanks. Still developing that page, and haven&#39;t taken care of the error condition yet. That behavior kind of freaked me out."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464389851, "post_id": 37493204, "comment_id": 62483036, "body": "@user1426181 Right on, gl!"}, {"owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464729985, "post_id": 37493204, "comment_id": 62600598, "body": "Actually, I&#39;m still stuck on this. Yes, it is filling the div with the contents of the page, but I&#39;m still trying to figure out why it&#39;s doing this. For some reason, it&#39;s not changing the http status code to a redirect, which I have as a 302. The line: http.Redirect(w, r, &quot;/dashboard.html&quot;, 302) is not causing a 302. I&#39;d like to figure that out, but I&#39;ll take your suggestion and do the location.href solution."}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464730476, "post_id": 37493204, "comment_id": 62600812, "body": "@user1426181 I&#39;m not sure on my terminology 100% but it&#39;s because you&#39;re passing the data through your xmlhttprequest. If you were to physically visit the page that would work just fine and it would redirect you, but because of the method you&#39;re using its passing all the relevant information through the object"}, {"owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "reply_to_user": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464730561, "post_id": 37493204, "comment_id": 62600845, "body": "@user1426181 instead of sending a redirect, send a json object if it was successful, something like <code>success: true</code> then do a location.href based on the result"}, {"owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "edited": false, "score": 0, "creation_date": 1464732023, "post_id": 37493204, "comment_id": 62601423, "body": "Yep, I&#39;m going to do that in the interim. the http request should handle other response codes. This is what&#39;s there to handle a 200:                     if (xmlhttp.readyState == 4 &amp;&amp; xmlhttp.status == 200), and I&#39;d think that this would fail for a 302 redirect. The problem may be from the golang end, where it&#39;s not generating the 302 in the header. I don&#39;t know, I&#39;m a little confused, but I will take your advice and go with the location.href method. Thanks for your help on this."}], "tags": [], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "is_accepted": true, "score": 0, "last_activity_date": 1464388533, "creation_date": 1464388533, "answer_id": 37493204, "question_id": 37492544, "link": "https://stackoverflow.com/questions/37492544/golang-http-redirect-strange-behavior/37493204#37493204", "title": "Golang http redirect Strange behavior", "body": "<p>I believe this is coming from your </p>\n\n<pre><code>if (xhttp.readyState == 4 &amp;&amp; xhttp.status == 200)\n{\n    document.getElementById(\"loginerrormessageid\").innerHTML = xhttp.responseText;\n}\n</code></pre>\n\n<p>When the redirect comes back you're getting the entire page and it's just loading it in to the error message because there is no conditionals. You might want to do something instead like</p>\n\n<pre><code>if (isAuthenticated) {\n    location.href = \"/\"; // whatever page to redirect to\n}\n</code></pre>\n"}], "owner": {"reputation": 115, "user_id": 1426181, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f82fb43edbaa3575bb0d84e4bfc881f8?s=128&d=identicon&r=PG", "display_name": "user1426181", "link": "https://stackoverflow.com/users/1426181/user1426181"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 232, "favorite_count": 0, "accepted_answer_id": 37493204, "answer_count": 1, "score": 0, "last_activity_date": 1464388533, "creation_date": 1464384796, "last_edit_date": 1464388134, "question_id": 37492544, "link": "https://stackoverflow.com/questions/37492544/golang-http-redirect-strange-behavior", "title": "Golang http redirect Strange behavior", "body": "<p>I have a login page (login.html) that uses Javascript to call a golang service on the back end. Upon successful login, the user should be taken to a dashboard page (dashboard.html). Instead, the dashboard page opens up in the middle of the login page as shown here:</p>\n\n<p><a href=\"https://i.stack.imgur.com/huViB.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/huViB.jpg\" alt=\"Page within a Page instead of Redirect\"></a></p>\n\n<p>The relevant code is:</p>\n\n<pre><code>func userhandler(w http.ResponseWriter, r *http.Request, subcommand string) {\n...\n\n// If the credentials are valid, go to the Dashboard page\nif validateLoginCredentials([]byte(loginUsername), []byte(loginPassword)) != -1 {\n\nhttp.Redirect(w, r, \"/dashboard.html\", 302) //&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;The Redirect is here\n\n}\n...\n}\n\nfunc webhandler(w http.ResponseWriter, r *http.Request) { ...\n// Service the API\nif strings.HasPrefix(r.URL.Path, \"/xyzzy/\") {\n    urlparts := strings.SplitN(r.URL.Path, \"/\", 5) ...\n        switch urlparts[3] {\n            case \"user\":\n                userhandler(w, r, urlparts[4]) ...\n        }\n    }\n} else { // Serve the static pages\n    http.FileServer(http.Dir(\".\")).ServeHTTP(w, r)\n}\n\n... \n}\n\nfunc main {\n...\nhttp.HandleFunc(\"/\", webhandler) ...\nerr_https := http.ListenAndServeTLS(\":3001\", \"./xyzzy.crt\", \"./xyzzy.key\", nil)\n... \n}\n</code></pre>\n\n<p>If, as a test, I put the redirect into the spot where it serves the static pages (all static pages will redirect to the dashboard page), it looks like it works. But, in the code that handles the user api functions, like login, I get this behavior.</p>\n\n<p>HTML Snippet:</p>\n\n<pre><code>&lt;body&gt;\n    &lt;div class=\"logintopspacer\" id=\"logintopspacerid\"&gt;&lt;/div&gt;\n    &lt;div class=\"loginlogo\" id=\"loginlogoid\"&gt;&lt;img src=\"img/pixmover1.png\" alt=\"PixMover\" width=\"270\"&gt;&lt;/div&gt;\n    &lt;div class=\"logintitlecontainer\" id=\"logintitlecontainerid\"&gt;\n        &lt;div class=\"logintitle\" id=\"logintitleid\"&gt;User Login&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"loginmidspacer\" id=\"loginmidspacerid\"&gt;&lt;/div&gt;\n    &lt;div class=\"logincredentialscontainer\" id=\"logincredentialscontainerid\"&gt;\n        &lt;div class=\"logincredentialsspacer\"&gt;&lt;/div&gt;\n        &lt;div class=\"logincredentialtitle\"&gt;Username/Email:&lt;/div&gt;\n        &lt;div class=\"logincredentialentry\"&gt;&lt;input type=\"text\" name=\"pixun\" id=\"pixunid\" size=\"25\"&gt;&lt;/div&gt;\n        &lt;div class=\"logincredentialsspacer\"&gt;&lt;/div&gt;\n\n        &lt;div class=\"logincredentialsspacer\"&gt;&lt;/div&gt;\n        &lt;div class=\"logincredentialtitle\"&gt;Password:&lt;/div&gt;\n        &lt;div class=\"logincredentialentry\"&gt;&lt;input type=\"password\" name=\"pixpw\" id=\"pixpwid\" size=\"25\"&gt;&lt;/div&gt;\n        &lt;div class=\"logincredentialsspacer\"&gt;&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"loginbuttoncontainer\" id=\"loginbuttoncontainerid\"&gt;\n        &lt;div class=\"loginbutton\" id=\"loginbuttonid\" onmousedown=\"buttonPressed();\" onmouseup=\"submitForm();\" onmouseout=\"buttonReleased();\" &gt;Login&lt;/div&gt;\n    &lt;/div&gt;\n    &lt;div class=\"loginerrormessage\" id=\"loginerrormessageid\"&gt;&lt;/div&gt;\n    &lt;div class=\"loginbottomspacer\" id=\"loginbottomspacerid\"&gt;&lt;/div&gt;\n\n    &lt;div class=\"pagefooter\" id=\"pagefooterid\"&gt;\n        Copyright &amp;copy; XYZZY, Inc. 2016\n    &lt;/div&gt;\n\n&lt;/body&gt;\n</code></pre>\n\n<p>Javascript:</p>\n\n<pre><code>function submitForm()\n{\n    document.getElementById(\"loginbuttonid\").className = \"loginbutton\";\n    pixlogin();\n}\n\nfunction pixlogin()\n{\n    var xhttp = new XMLHttpRequest();\n\n    xhttp.onreadystatechange = function()\n    {\n        if (xhttp.readyState == 4 &amp;&amp; xhttp.status == 200)\n        {\n            document.getElementById(\"loginerrormessageid\").innerHTML = xhttp.responseText;\n        }\n    };\n\n    xhttp.open(\"POST\", \"pixmover/1_0_0/user/login\", true);\n    xhttp.setRequestHeader(\"Content-type\", \"application/x-www-form-urlencoded\");\n    xhttp.send(\"username=\" + document.getElementById(\"pixunid\").value + \"&amp;password=\" + document.getElementById(\"pixpwid\").value);\n}\n</code></pre>\n"}, {"tags": ["memory", "memory-management", "go", "garbage-collection"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1464383525, "post_id": 37492296, "comment_id": 62480938, "body": "Also check out this: <a href=\"http://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer\">Golang - Cannot free memory once occupied by bytes.Buffer</a>, there is <a href=\"https://golang.org/pkg/runtime/debug/#FreeOSMemory\" rel=\"nofollow noreferrer\"><code>debug.FreeOSMemory()</code></a>. You could also limit concurrent requests / file uploads/downloads."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1464383592, "post_id": 37492296, "comment_id": 62480966, "body": "To be clear, are you sure the goroutine has returned and the handler is the issue? I think you can leak a goroutine much like if you fail to free an object in non-GC&#39;d languages."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1464384367, "post_id": 37492296, "comment_id": 62481262, "body": "Get a stack trace as you&#39;re running our of memory and see what goroutines are still running. It also can&#39;t hurt to try the current dev version of Go if you&#39;re having trouble on ARM."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 4, "creation_date": 1464391532, "post_id": 37492296, "comment_id": 62483457, "body": "Can you show the code?"}, {"owner": {"reputation": 4166, "user_id": 1898070, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c29fa44faffe872325c40c6d5aea0393?s=128&d=identicon&r=PG", "display_name": "Nipun Talukdar", "link": "https://stackoverflow.com/users/1898070/nipun-talukdar"}, "edited": false, "score": 0, "creation_date": 1464410430, "post_id": 37492296, "comment_id": 62486325, "body": "If for every request a goroutine is opened, then that may very well result in disaster. For example, if there are 40,000 concurrent requests, then there will be 40000 goroutines and if each goroutine consumes a lot of memory, then out-of-memory error may happen. Ideally, you should have a pool of goroutines executing the requests. The size of the pool may be decided by analyzing resources constraints. You may submit the requests to a buffered channel and the requests are pulled from the channel by the go routines from the pool executing the requests."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1464425456, "post_id": 37492296, "comment_id": 62489378, "body": "First thank you for the helpful comments. First I updated the golang version. The problem was that just Golang 1.3 was installed. My fault not to check that. After updating to 1.6.2 the memory usage is ok. If a file with 200 MB is used the server takes that amount of memory. After finishing that request the 200MB are still blocked, but if another file with 150 MB is used the server uses the blocked part of the memory. I am still testing. I will write an answer when I know more."}], "answers": [{"tags": [], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "is_accepted": false, "score": 0, "last_activity_date": 1464513091, "creation_date": 1464513091, "answer_id": 37508105, "question_id": 37492296, "link": "https://stackoverflow.com/questions/37492296/how-can-i-make-my-server-written-in-golang-not-run-out-of-memory/37508105#37508105", "title": "How can I make my server (written in Golang) not run out of memory?", "body": "<p>The short answer: \nI updated to version 1.6.2. Now there is no additional memory allocation for each routine. </p>\n\n<hr>\n\n<p>Thank you all for your comments. They brought me back to the right track.</p>\n\n<p>The memory consumption came from a function which creates a md5 hash for each uploaded file. So 100MB file needs also 100MB memory. Go in version 1.3 allocated for every request (go routine) new memory. So after max. 1 GB of uploaded files the Raspbery ran out of memory. </p>\n\n<p><strong>Where do all the goroutines come from?</strong></p>\n\n<p>One comment was about the logic to open a go routine for every request. This logic was not implemented by myself it is inside the way go handles the requests.</p>\n\n<p>More about that you can find in that great open source book about building web applications with Go: <a href=\"https://github.com/astaxie/build-web-application-with-golang/blob/master/en/03.4.md\" rel=\"nofollow\">Get into http package</a></p>\n\n<p><strong>What happens now in version 1.6.2?</strong></p>\n\n<p>For every upload the server allocates memory. The difference is now that Go reserves the amount of memory, but it uses it also for other routines.</p>\n\n<p>Example for version 1.6.2:</p>\n\n<pre><code>1st file 10 MB -&gt; 10 MB RAM is used by the server\n2nd file 5 MB -&gt; 10 MB RAM is used by the server\n3rd file 100 MB -&gt; 100 MB RAM is used by the server\n4th file 50 MB -&gt; 100 MB is used by the server\n</code></pre>\n\n<p>So until no file is bigger than the memory the server should work.</p>\n"}], "owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 861, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1464513091, "creation_date": 1464383363, "last_edit_date": 1495539847, "question_id": 37492296, "link": "https://stackoverflow.com/questions/37492296/how-can-i-make-my-server-written-in-golang-not-run-out-of-memory", "title": "How can I make my server (written in Golang) not run out of memory?", "body": "<p>I have a small server which has to handle a lot of files. The files are send via a PUT request to the server. I am using the net/http package for the server. I know that for every request a go routine is opened. But the problem is that after a request is finished the used memory of the handler is not released.</p>\n\n<p>The server (should) run on a Raspery Pi 3 with 1GB memory. The problem is that it runs out of memory, when I am sending a lot of files. At this point I can not wait until the garbage collector releases the memory.</p>\n\n<p>This two topics are about the problem:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/32800952/why-is-the-memory-block-not-cleaned-by-the-garbage-collector\">Why is the memory block not cleaned by the garbage collector?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/24376817/go-1-3-garbage-collector-not-releasing-server-memory-back-to-system\">Go 1.3 Garbage collector not releasing server memory back to system</a></p>\n\n<p>But there is no solution for my problem. </p>\n\n<p>Now the question is: is there a way to make a http handler marked as totaly ready, that the garbage collector releases the memory for the calling routine? I tried to add a <code>return</code> at the end of the handler, but that doesn't work. I am runing still out of memory.</p>\n"}]