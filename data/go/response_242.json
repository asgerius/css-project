[{"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1567050900, "post_id": 57700985, "comment_id": 101848892, "body": "This is a strange question as the whole point of <code>go get -u</code> is to update a dependency to the given (or latest) version. You prevent go get -u from doing what it should do by not doing go get -u."}, {"owner": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1567139175, "post_id": 57700985, "comment_id": 101882028, "body": "<code>go get -u</code> updates all dependencies. That should explain the question."}], "answers": [{"tags": [], "owner": {"reputation": 1997, "user_id": 420405, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qIikv.jpg?s=128&g=1", "display_name": "Ibrahim AshShohail", "link": "https://stackoverflow.com/users/420405/ibrahim-ashshohail"}, "is_accepted": false, "score": 2, "last_activity_date": 1567042467, "creation_date": 1567042467, "answer_id": 57701889, "question_id": 57700985, "link": "https://stackoverflow.com/questions/57700985/go-modules-how-do-you-lock-in-a-specific-version-that-wont-get-overridden-with/57701889#57701889", "title": "Go modules: How do you lock in a specific version that won&#39;t get overridden with `go get -u`?", "body": "<p>There is <a href=\"https://github.com/golang/go/wiki/Modules#how-to-upgrade-and-downgrade-dependencies\" rel=\"nofollow noreferrer\">no way to do this</a> currently.</p>\n\n<p>You can only specify if want to use the defined versions of the transitive dependencies of the packages you directly import or allow using a newer minor or patch version.</p>\n"}], "owner": {"reputation": 30856, "user_id": 105562, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/e66ceae48943526967c5118011e58b63?s=128&d=identicon&r=PG", "display_name": "Travis Reeder", "link": "https://stackoverflow.com/users/105562/travis-reeder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 291, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1567042467, "creation_date": 1567033149, "question_id": 57700985, "link": "https://stackoverflow.com/questions/57700985/go-modules-how-do-you-lock-in-a-specific-version-that-wont-get-overridden-with", "title": "Go modules: How do you lock in a specific version that won&#39;t get overridden with `go get -u`?", "body": "<p>If I specify a specific branch/version using <code>go get github.com/org/package@sha_or_branch</code> it will update accordingly. But if I run <code>go get -u</code> afterwards it gets overridden with any newer version. </p>\n\n<p>Is there any way to lock it in so it doesn't change when doing a <code>go get -u</code>?</p>\n"}, {"tags": ["go", "protocol-buffers", "grpc", "proto", "protoc"], "comments": [{"owner": {"reputation": 1767, "user_id": 1073170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e7782e36e3cf978a02ee761c7e70e?s=128&d=identicon&r=PG", "display_name": "Jory Geerts", "link": "https://stackoverflow.com/users/1073170/jory-geerts"}, "edited": false, "score": 0, "creation_date": 1567089420, "post_id": 57700860, "comment_id": 101867307, "body": "Can you add the exact command you are executing?"}, {"owner": {"reputation": 651, "user_id": 4460294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dj2KDkekyM4/AAAAAAAAAAI/AAAAAAAAAIQ/C-OhGO-gz2E/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/4460294/mayank-gupta"}, "reply_to_user": {"reputation": 1767, "user_id": 1073170, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c13e7782e36e3cf978a02ee761c7e70e?s=128&d=identicon&r=PG", "display_name": "Jory Geerts", "link": "https://stackoverflow.com/users/1073170/jory-geerts"}, "edited": false, "score": 0, "creation_date": 1567098121, "post_id": 57700860, "comment_id": 101871578, "body": "&quot;protoc greet/greetpb/greet.proto --go_out=plugins=grpc:.&quot; Folder structure: greet-&gt;greetpb-&gt; greet.proto file"}], "answers": [{"comments": [{"owner": {"reputation": 458, "user_id": 11751463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5091d0a03b8da93bbc04e92c5a3fd29b?s=128&d=identicon&r=PG&f=1", "display_name": "Tannisha Hill", "link": "https://stackoverflow.com/users/11751463/tannisha-hill"}, "edited": false, "score": 1, "creation_date": 1567187271, "post_id": 57730314, "comment_id": 101902649, "body": "This wouldn&#39;t work as the <code>protoc</code> compiler can&#39;t resolve <code>~</code>"}, {"owner": {"reputation": 458, "user_id": 11751463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5091d0a03b8da93bbc04e92c5a3fd29b?s=128&d=identicon&r=PG&f=1", "display_name": "Tannisha Hill", "link": "https://stackoverflow.com/users/11751463/tannisha-hill"}, "edited": false, "score": 0, "creation_date": 1567187339, "post_id": 57730314, "comment_id": 101902675, "body": "As an aside, you really should be using <code>.bashrc</code> instead of <code>.bash_profile</code>"}, {"owner": {"reputation": 1002, "user_id": 8826629, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MU7EG.jpg?s=128&g=1", "display_name": "Joel Guerra", "link": "https://stackoverflow.com/users/8826629/joel-guerra"}, "reply_to_user": {"reputation": 458, "user_id": 11751463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5091d0a03b8da93bbc04e92c5a3fd29b?s=128&d=identicon&r=PG&f=1", "display_name": "Tannisha Hill", "link": "https://stackoverflow.com/users/11751463/tannisha-hill"}, "edited": false, "score": 0, "creation_date": 1584740653, "post_id": 57730314, "comment_id": 107539474, "body": "@SoumasishGoswami can you explain why use .bashrc instead of .bash_profile?"}], "tags": [], "owner": {"reputation": 651, "user_id": 4460294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dj2KDkekyM4/AAAAAAAAAAI/AAAAAAAAAIQ/C-OhGO-gz2E/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/4460294/mayank-gupta"}, "is_accepted": true, "score": 13, "last_activity_date": 1592060557, "last_edit_date": 1592060557, "creation_date": 1567182544, "answer_id": 57730314, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/57730314#57730314", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>Resolved by following the steps:</p>\n\n<p>Install go library using: \ngo get -u github.com/golang/protobuf/{proto,protoc-gen-go}</p>\n\n<ol>\n<li>Run <code>vim ~/.bash_profile</code></li>\n<li>Add: </li>\n</ol>\n\n<pre class=\"lang-sh prettyprint-override\"><code>export GO_PATH=~/go\nexport PATH=$PATH:/$GO_PATH/bin\n</code></pre>\n\n<ol start=\"3\">\n<li>Run <code>source ~/.bash_profile</code></li>\n</ol>\n\n<p>Reference: <a href=\"https://stackoverflow.com/questions/28099004/unable-to-build-protobuf-to-go-endpoint\">Unable to build protobuf to go endpoint</a></p>\n"}, {"tags": [], "owner": {"reputation": 458, "user_id": 11751463, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5091d0a03b8da93bbc04e92c5a3fd29b?s=128&d=identicon&r=PG&f=1", "display_name": "Tannisha Hill", "link": "https://stackoverflow.com/users/11751463/tannisha-hill"}, "is_accepted": false, "score": 17, "last_activity_date": 1567187192, "creation_date": 1567187192, "answer_id": 57731186, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/57731186#57731186", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>There are two ways to install the protobuf compiler, if you're on Ubuntu you can use this,</p>\n\n<pre><code>sudo apt install protobuf-compiler\n</code></pre>\n\n<p>Then of course there's the standard way,</p>\n\n<pre><code>go get -u github.com/golang/protobuf/{proto,protoc-gen-go}\n</code></pre>\n\n<p>Here forward it's just adding the path. Assuming when you installed Go you did this,</p>\n\n<pre><code>echo 'export GOPATH=$HOME/Go' &gt;&gt; $HOME/.bashrc\nsource $HOME/.bashrc\n</code></pre>\n\n<p>Now you can just extend this,</p>\n\n<pre><code>echo 'export PATH=$PATH:$GOPATH/bin' &gt;&gt; $HOME/.bashrc\nsource $HOME/.bashrc\n</code></pre>\n\n<p>Strangely <code>protoc</code> can't expand <code>~</code>. </p>\n"}, {"tags": [], "owner": {"reputation": 3868, "user_id": 2295484, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/BAohf.png?s=128&g=1", "display_name": "Krishnadas PC", "link": "https://stackoverflow.com/users/2295484/krishnadas-pc"}, "is_accepted": false, "score": 7, "last_activity_date": 1586269240, "creation_date": 1586269240, "answer_id": 61082200, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/61082200#61082200", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>From the github repo this solution has worked for me.</p>\n\n<p>Go version is <code>go version go1.14.1 linux/amd64</code></p>\n\n<p>Add this to <code>.bashrc</code> and source it.</p>\n\n<pre><code>export GOROOT=/usr/local/go\nexport GOPATH=$HOME/go\nexport GOBIN=$GOPATH/bin\nexport PATH=$PATH:$GOROOT:$GOPATH:$GOBIN\n</code></pre>\n\n<p><a href=\"https://github.com/golang/protobuf/issues/795\" rel=\"noreferrer\">https://github.com/golang/protobuf/issues/795</a></p>\n"}, {"tags": [], "owner": {"reputation": 2667, "user_id": 1508147, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/nueRO.jpg?s=128&g=1", "display_name": "Sathishkumar Rakkiasamy", "link": "https://stackoverflow.com/users/1508147/sathishkumar-rakkiasamy"}, "is_accepted": false, "score": 3, "last_activity_date": 1618069571, "last_edit_date": 1618069571, "creation_date": 1592912263, "answer_id": 62533800, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/62533800#62533800", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>Make sure your GOBIN is set in the <code>PATH</code> variable. Otherwise, you may encounter this problem. Check <code>GOBIN</code> path by running <code>go env</code> and confirm <code>GOBIN</code> is not empty.</p>\n<p>If it is empty then try like below</p>\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:$GOPATH/bin\nprotoc --go_out=plugins=grpc:. *.proto\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 12233260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ce0d19d598efaa1685e9ba90499ce13?s=128&d=identicon&r=PG&f=1", "display_name": "Panchove", "link": "https://stackoverflow.com/users/12233260/panchove"}, "is_accepted": false, "score": 4, "last_activity_date": 1599275606, "last_edit_date": 1599275606, "creation_date": 1593276839, "answer_id": 62612925, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/62612925#62612925", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>They commented above that the following package had to be added</p>\n<pre><code>sudo apt install protobuf-compiler\n</code></pre>\n<p>In my case I also had to add this one ..</p>\n<pre><code>sudo apt install golang-goprotobuf-dev\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 3613868, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/77ee8e80719f97f08047c98a15dda22a?s=128&d=identicon&r=PG&f=1", "display_name": "Andy", "link": "https://stackoverflow.com/users/3613868/andy"}, "is_accepted": false, "score": -1, "last_activity_date": 1607633988, "creation_date": 1607633988, "answer_id": 65242245, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/65242245#65242245", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>Many of the other responses address path issues but if it's not installed, you can install it using the following command:</p>\n<pre><code>go install google.golang.org/grpc/cmd/protoc-gen-go-grpc\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 504, "user_id": 2725353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8743e994aaa7936b7d63f97ed5ed3f91?s=128&d=identicon&r=PG", "display_name": "Yrineu Rodrigues", "link": "https://stackoverflow.com/users/2725353/yrineu-rodrigues"}, "is_accepted": false, "score": 4, "last_activity_date": 1610767548, "creation_date": 1610767548, "answer_id": 65746184, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/65746184#65746184", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>Just in case if anyone else is still facing this issue, try the official solution from <a href=\"https://grpc.io/docs/languages/go/quickstart/#prerequisites\" rel=\"nofollow noreferrer\">grpc.io documentation</a></p>\n<p>Go plugins for the protocol compiler:</p>\n<p>Install the protocol compiler plugins for Go using the following commands:</p>\n<pre><code>$ export GO111MODULE=on  # Enable module mode\n\n$ go get google.golang.org/protobuf/cmd/protoc-gen-go \\\n         google.golang.org/grpc/cmd/protoc-gen-go-grpc\n</code></pre>\n<p>Update your PATH so that the protoc compiler can find the plugins:</p>\n<pre><code>$ export PATH=&quot;$PATH:$(go env GOPATH)/bin&quot;\n</code></pre>\n<p>This worked for me.</p>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 11328931, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tNAJ3.jpg?s=128&g=1", "display_name": "ThogTq", "link": "https://stackoverflow.com/users/11328931/thogtq"}, "is_accepted": false, "score": 0, "last_activity_date": 1614922502, "creation_date": 1614922502, "answer_id": 66487353, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable/66487353#66487353", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>When you run <code>go get -u github.com/golang/protobuf/protoc-gen-go</code> in vscode terminal. If vscode doesn't found $GOPATH &amp; $GOBIN it will install the package at default user's home directory /home/$username/go{/bin}</p>\n<p>The solution is to move all file in bin and pkg folder to your current go path (/usr/local/go{/bin}), go path is which contains <code>go</code> file in bin folder\nAnd add this line to end of .bashrc file</p>\n<pre><code>export GOPATH=/usr/local/go:$PATH\nexport GOBIN=/usr/local/go/bin:$PATH\n</code></pre>\n<p>Then reboot computer</p>\n"}], "owner": {"reputation": 651, "user_id": 4460294, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-dj2KDkekyM4/AAAAAAAAAAI/AAAAAAAAAIQ/C-OhGO-gz2E/photo.jpg?sz=128", "display_name": "Mayank Gupta", "link": "https://stackoverflow.com/users/4460294/mayank-gupta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 27531, "favorite_count": 3, "accepted_answer_id": 57730314, "answer_count": 8, "score": 20, "last_activity_date": 1618069571, "creation_date": 1567031979, "last_edit_date": 1567086096, "question_id": 57700860, "link": "https://stackoverflow.com/questions/57700860/protoc-gen-go-program-not-found-or-is-not-executable", "title": "protoc-gen-go: program not found or is not executable", "body": "<p>I am trying to build a sample app with go grpc but I am unable to generate the code using \"protoc\"</p>\n\n<p>Have installed the required libraries/go packages using:</p>\n\n<ol>\n<li>go get -u google.golang.org/grpc</li>\n<li>go get -u github.com/golang/protobuf/protoc-gen-go</li>\n</ol>\n\n<p>Have tried setting the path as well but no luck.</p>\n\n<p>Sample \"proto\" file:</p>\n\n<pre><code>syntax = \"proto3\";\n\npackage greet;\noption go_package=\"greetpb\";\n\nservice GreetService{}\n</code></pre>\n\n<p>Error Message: \n\"protoc-gen-go: program not found or is not executable\n--go_out: protoc-gen-go: Plugin failed with status code 1.\"</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 6, "creation_date": 1567025575, "post_id": 57699829, "comment_id": 101843726, "body": "Try <code>go test .&#47;...</code>"}, {"owner": {"reputation": 1584, "user_id": 411006, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/64447bbe846dd442d46e38d7462ee6f6?s=128&d=identicon&r=PG", "display_name": "Ricko M", "link": "https://stackoverflow.com/users/411006/ricko-m"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1567025631, "post_id": 57699829, "comment_id": 101843745, "body": "that worked!! any where i can read why ? :/"}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 7, "creation_date": 1567026996, "post_id": 57699829, "comment_id": 101844258, "body": "<a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Relative_import_paths</a> : <code>Relative patterns are also allowed, like &quot;go test .&#47;...&quot; to test all subdirectories. See &#39;go help packages&#39; for details on the pattern syntax.</code>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567084297, "post_id": 57699829, "comment_id": 101864079, "body": "<code>go help test</code> explains this, among other things."}], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567084237, "post_id": 57703185, "comment_id": 101864041, "body": "This is unnecessary additional complexity &amp; dependency when you can just run <code>go test .&#47;...</code> regardless of how many test files/packages you have."}], "tags": [], "owner": {"reputation": 148, "user_id": 3423611, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ff7e20d8cb851aaf324218f0c2c50b06?s=128&d=identicon&r=PG&f=1", "display_name": "jkasper", "link": "https://stackoverflow.com/users/3423611/jkasper"}, "is_accepted": false, "score": 0, "last_activity_date": 1567054430, "creation_date": 1567054430, "answer_id": 57703185, "question_id": 57699829, "link": "https://stackoverflow.com/questions/57699829/testing-golang-folder-structure/57703185#57703185", "title": "Testing golang folder structure", "body": "<p>How about having a make file? In the future if you expand your project and have more test files then you can test all of them at once by just running <code>make test</code>.\nThis <a href=\"https://sohlich.github.io/post/go_makefile/\" rel=\"nofollow noreferrer\">link</a> would be helpful.</p>\n"}], "owner": {"reputation": 1584, "user_id": 411006, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/64447bbe846dd442d46e38d7462ee6f6?s=128&d=identicon&r=PG", "display_name": "Ricko M", "link": "https://stackoverflow.com/users/411006/ricko-m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 543, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1567054430, "creation_date": 1567025218, "last_edit_date": 1567025535, "question_id": 57699829, "link": "https://stackoverflow.com/questions/57699829/testing-golang-folder-structure", "title": "Testing golang folder structure", "body": "<p>My folders are structured as follows</p>\n\n<pre><code>src/\n   github.com/\n              hello/\n                   hello.go\n                   hello_test.go \n                   integers/\n                            integers.go\n                            integers_test.go\n</code></pre>\n\n<p>hello.go/hello_test.go belong to package main\nintegers.go/integers_test.go belong to package integers</p>\n\n<p>When run go test from the root of folder hello, it only runs hello_test.go. How can i get it to run all tests recursively.  Is this the right way to structure tests inside their respective packages?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 604, "user_id": 2265106, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/IKHQK.png?s=128&g=1", "display_name": "xrfang", "link": "https://stackoverflow.com/users/2265106/xrfang"}, "edited": false, "score": 0, "creation_date": 1610612608, "post_id": 57700944, "comment_id": 116189163, "body": "&quot;IPV4Mask&quot; should be &quot;IPv4Mask&quot;, small letter v."}, {"owner": {"reputation": 622, "user_id": 256399, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b29d5b70930afacb8e88c7a4a8ff6164?s=128&d=identicon&r=PG", "display_name": "Nadeem Douba", "link": "https://stackoverflow.com/users/256399/nadeem-douba"}, "edited": false, "score": 0, "creation_date": 1610917869, "post_id": 57700944, "comment_id": 116277976, "body": "Couldn&#39;t you just use conversion like so (<a href=\"https://play.golang.org/p/blf5sv0Ncwz\" rel=\"nofollow noreferrer\">play.golang.org/p/blf5sv0Ncwz</a>): <code>sz, _ := net.IPMask(ip.To4()).Size()</code>?"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1567119964, "last_edit_date": 1567119964, "creation_date": 1567032807, "answer_id": 57700944, "question_id": 57699732, "link": "https://stackoverflow.com/questions/57699732/convert-net-mask-into-cidr-in-go/57700944#57700944", "title": "Convert net mask into CIDR in Go", "body": "<p>This isn't very obvious at first, but:</p>\n\n<pre><code>addr := ip.To4()\nsz, _ := net.IPV4Mask(addr[0], addr[1], addr[2], addr[3]).Size()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1567033951, "creation_date": 1567033951, "answer_id": 57701071, "question_id": 57699732, "link": "https://stackoverflow.com/questions/57699732/convert-net-mask-into-cidr-in-go/57701071#57701071", "title": "Convert net mask into CIDR in Go", "body": "<p>I'm not aware about existense of such function but it's easy to create one.</p>\n\n<p>CIDR notation is just a count of set bits in netmask.</p>\n\n<p>So, crude solution could be:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func cidr(netmask string) int {       \n        var mask uint32\n    for idx, dotpart := range strings.Split(netmask, \".\") {\n        part, _ := strconv.Atoi(dotpart)    \n        mask = mask | uint32(part) &lt;&lt; uint32(24-idx*8)\n    }   \n    return len(fmt.Sprintf(\"%b\", mask))\n}\n</code></pre>\n"}], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1205, "favorite_count": 0, "accepted_answer_id": 57700944, "answer_count": 2, "score": 1, "last_activity_date": 1567119964, "creation_date": 1567024640, "question_id": 57699732, "link": "https://stackoverflow.com/questions/57699732/convert-net-mask-into-cidr-in-go", "title": "Convert net mask into CIDR in Go", "body": "<p>I'm looking for a way to convert a netmask string into CIDR notation in Go.  </p>\n\n<p>For instance, \"255.255.255.0\" -> \"/24\"</p>\n\n<p>I'm currently obtaining an IP address and the net mask string with the below logic, which may just be complicating things.  </p>\n\n<p>I've been perusing the <code>net</code> library trying to see if there is a different function to use to accomplish what I'd like, which is really just a IP address in CIDR notation:</p>\n\n<pre><code>192.168.1.2/24\n</code></pre>\n\n<pre><code>var mgmtInterface *net.Interface\nvar err error\n\nmgmtInterface, err = net.InterfaceByName(\"eth0\")\nif err != nil {\n  log.Println(\"Unable to find interface eth0, trying en0\")\n  mgmtInterface, err = net.InterfaceByName(\"en0\")\n}\n\naddrs, err := mgmtInterface.Addrs()\nif err != nil {\n  log.Println(\"interface has no address\")\n}\n\nfor _, addr := range addrs {\n  var ip net.IP\n  var mask net.IPMask\n  switch v := addr.(type) {\n  case *net.IPNet:\n    ip = v.IP\n    mask = v.Mask\n  case *net.IPAddr:\n    ip = v.IP\n    mask = ip.DefaultMask()\n  }\n\n  if ip == nil {\n    continue\n  }\n\n  ip = ip.To4()\n  if ip == nil {\n    continue\n  }\n\n  // create the netmask\n  cleanMask := fmt.Sprintf(\"%d.%d.%d.%d\", mask[0], mask[1], mask[2], mask[3])\n\n} \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1255, "user_id": 4982148, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/X52Wq.jpg?s=128&g=1", "display_name": "atakanyenel", "link": "https://stackoverflow.com/users/4982148/atakanyenel"}, "edited": false, "score": 0, "creation_date": 1567025345, "post_id": 57699575, "comment_id": 101843624, "body": "It looks like <code>pagesize</code> is an uninitialized variable. My IDE also said that it doesn&#39;t exists. Maybe that&#39;s an error in the Google repo, is this an option ?"}, {"owner": {"reputation": 1614, "user_id": 5728357, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ET3iW.jpg?s=128&g=1", "display_name": "xarantolus", "link": "https://stackoverflow.com/users/5728357/xarantolus"}, "edited": false, "score": 0, "creation_date": 1567072176, "post_id": 57699575, "comment_id": 101857134, "body": "It seems like the variable is defined <a href=\"https://github.com/google/gopacket/blob/6eef11e26c8c0772cc627edf0fb231ad8eda357b/afpacket/afpacket.go#L44\" rel=\"nofollow noreferrer\">in this line</a>, which calls <a href=\"https://github.com/golang/sys/blob/c7b8b68b14567162c6602a7c5659ee0f26417c18/unix/pagesize_unix.go#L13\" rel=\"nofollow noreferrer\">this function</a>. The build tag in line 5 indicates that it does not work on mips. However, support was added <a href=\"https://github.com/golang/go/commit/1b9499b06989d2831e5b156161d6c07642926ee1\" rel=\"nofollow noreferrer\">here</a>"}], "answers": [{"tags": [], "owner": {"reputation": 129, "user_id": 8140152, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kylGe.png?s=128&g=1", "display_name": "AnonymousX", "link": "https://stackoverflow.com/users/8140152/anonymousx"}, "is_accepted": false, "score": 0, "last_activity_date": 1608115499, "creation_date": 1608115499, "answer_id": 65321716, "question_id": 57699575, "link": "https://stackoverflow.com/questions/57699575/undefined-when-building-for-mips/65321716#65321716", "title": "Undefined when building for mips", "body": "<p>The problem is that gopacket is not a pure go project, it relies on CGO for running.\nEnable CGO by passing env may be help:</p>\n<pre><code>CGO_ENABLED=1 GOOS=linux GOARCH=mipsle go build ./\n</code></pre>\n<p>At the same time, you need to prepare a mipsle version libpcap.</p>\n<ol>\n<li>download cross complie toolchain: <a href=\"https://www.mips.com/develop/tools/compilers/linux-toolchain/\" rel=\"nofollow noreferrer\">mipsle-linux-gcc</a></li>\n<li>compile libpcap:</li>\n</ol>\n<pre class=\"lang-sh prettyprint-override\"><code>wget http://www.tcpdump.org/release/libpcap-1.8.1.tar.gz\ntar -zxvf libpcap-1.8.1.tar.gz\ncd libpcap-1.8.1\n./configure --host=mipsle-linux --with-pcap=linux\nmake  #if error occured, install dependency following the error message.\n</code></pre>\n<p>After compile, you'll find <code>libpcap.a</code> and <code>libpcap.so.1.8.1</code> build up.</p>\n<ol start=\"3\">\n<li>compile your project with libpcap linked</li>\n</ol>\n<pre><code>CGO_ENABLED=1 CC=mipsle-linux-gcc GOARCH=mipsle GOOS=linux CGO_LDFLAGS=&quot;-L./libpcap-1.8.1&quot; go build ./\n</code></pre>\n"}], "owner": {"reputation": 2968, "user_id": 2796183, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/e0dfd6aa3bb051d2ed876540bb9f1076?s=128&d=identicon&r=PG", "display_name": "ardevd", "link": "https://stackoverflow.com/users/2796183/ardevd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1608115499, "creation_date": 1567023818, "question_id": 57699575, "link": "https://stackoverflow.com/questions/57699575/undefined-when-building-for-mips", "title": "Undefined when building for mips", "body": "<p>Trying to cross compile my go app for mips.</p>\n\n<pre><code>GOOS=linux GOARCH=mipsle go build ./\n</code></pre>\n\n<p>However, I get the following issues:</p>\n\n<pre><code># github.com/google/gopacket/afpacket\n/root/go/src/github.com/google/gopacket/afpacket/options.go:176:19: undefined: pageSize\n/root/go/src/github.com/google/gopacket/afpacket/options.go:177:85: undefined: pageSize\n# github.com/google/gopacket/pcap\n/root/go/src/github.com/google/gopacket/pcap/pcap.go:30:22: undefined: pcapErrorNotActivated\n/root/go/src/github.com/google/gopacket/pcap/pcap.go:52:17: undefined: pcapTPtr\n/root/go/src/github.com/google/gopacket/pcap/pcap.go:64:10: undefined: pcapPkthdr\n</code></pre>\n\n<p>What's the actual issue here? Is there some architecture limitations in <code>gopacket</code> that prevents me from building it for mips?</p>\n"}, {"tags": ["json", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "edited": false, "score": 0, "creation_date": 1567016055, "post_id": 57697966, "comment_id": 101840033, "body": "Perfect!  I love the succinct-ness of it!"}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1567015805, "creation_date": 1567015805, "answer_id": 57697966, "question_id": 57697902, "link": "https://stackoverflow.com/questions/57697902/wrap-and-marshal-go-struct-in-required-json-parameter/57697966#57697966", "title": "Wrap and Marshal Go struct in required JSON parameter", "body": "<p>You can create another struct to enclose the Device struct you have, or do something like this:</p>\n\n<pre><code>json.Marshal(map[string]interface{}{\"device\":d})\n</code></pre>\n"}], "owner": {"reputation": 2074, "user_id": 688071, "user_type": "registered", "accept_rate": 67, "profile_image": "https://graph.facebook.com/1229375604/picture?type=large", "display_name": "Godzilla74", "link": "https://stackoverflow.com/users/688071/godzilla74"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30, "favorite_count": 0, "accepted_answer_id": 57697966, "answer_count": 1, "score": -1, "last_activity_date": 1567033857, "creation_date": 1567015535, "last_edit_date": 1567033857, "question_id": 57697902, "link": "https://stackoverflow.com/questions/57697902/wrap-and-marshal-go-struct-in-required-json-parameter", "title": "Wrap and Marshal Go struct in required JSON parameter", "body": "<p>I'm trying to create JSON to send to a Rails API that accepts the following format:</p>\n\n<pre><code>{\"device\":{\"ipaddress\":\"192.168.1.2\", \"netmask\": \"255.255.255.0\", \"gateway\": \"192.168.1.1\"}}\n</code></pre>\n\n<p>But I'm unsure of how to wrap what I've already marshaled into the <code>\"device\":{}</code> portion that the API accepts.</p>\n\n<p>Here's what I have so far:</p>\n\n<pre><code>type Device struct {\n    IPAddress string `json:\"ipaddress\"`\n    Network   string `json:\"network\"`\n    Gateway   string `json:\"gateway\"`\n}\n\n// gathers the IP info\nfunc GatherIPInfo() {\n\n    d := Device{\n        IPAddress: \"192.168.1.2\",\n        Network:   \"255.255.255.0\",\n        Gateway:   \"192.168.1.1\",\n    }\n\n    // now send to API\n    data, _ := json.Marshal(d) // looks like: {\"ipaddress\":\"192.168.1.2\",\"network\":\"255.255.255.0\",\"gateway\":\"192.168.1.1\"}\n\n    ...\n    ...\n}\n</code></pre>\n\n<p>Do I have to create another struct to be able to achieve wrapping the existing into 'device' or is there an easier way?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "amazon-s3"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567013462, "post_id": 57697389, "comment_id": 101839044, "body": "<a href=\"https://golang.org/pkg/encoding/json/#Decoder\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Decoder</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1567013581, "creation_date": 1567013581, "answer_id": 57697450, "question_id": 57697389, "link": "https://stackoverflow.com/questions/57697389/parse-large-single-line-json-without-loading-whole-file-into-memory/57697450#57697450", "title": "Parse large single line JSON without loading whole file into memory", "body": "<p>You can use json.Decoder() and process the file token by token as a stream. You can use Decoder.Decode() when you come to a place where you want to unmarshal into a struct.</p>\n\n<p>json.Unmarshal() is essentially Decoder.Decode() called at the beginning of the stream.</p>\n"}], "owner": {"reputation": 83, "user_id": 10255083, "user_type": "registered", "profile_image": "https://graph.facebook.com/42811684/picture?type=large", "display_name": "Taylor Clark", "link": "https://stackoverflow.com/users/10255083/taylor-clark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 0, "closed_date": 1567013655, "answer_count": 1, "score": 0, "last_activity_date": 1567013813, "creation_date": 1567013297, "question_id": 57697389, "link": "https://stackoverflow.com/questions/57697389/parse-large-single-line-json-without-loading-whole-file-into-memory", "closed_reason": "Duplicate", "title": "Parse large single line JSON without loading whole file into memory", "body": "<p>I am trying to parse JSON from S3 CloudTrail logs and some of the files are a single line of 40MB of JSON when they are unzipped. I'm trying to avoid loading all of this into memory - is there a way to more properly read the entries 1 by 1 instead of loading the whole blob in memory?</p>\n\n<p>I'm new to this so the only code I have right now is to Unmarshal the full line into memory</p>\n"}, {"tags": ["file", "go", "amazon-s3", "aws-lambda"], "comments": [{"owner": {"reputation": 1814, "user_id": 4193581, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/K7o5b.jpg?s=128&g=1", "display_name": "K Mo", "link": "https://stackoverflow.com/users/4193581/k-mo"}, "edited": false, "score": 0, "creation_date": 1567077653, "post_id": 57697095, "comment_id": 101860134, "body": "You should be able to do something with HeadObject using the AWS GO SDK. <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.HeadObject\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.HeadObject</a>"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576151373, "post_id": 57697095, "comment_id": 104810387, "body": "what means &quot;safely&quot; in your question ?"}], "answers": [{"comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576151356, "post_id": 59303898, "comment_id": 104810378, "body": "surely this is unsafe to concurrent writes."}, {"owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "reply_to_user": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576153897, "post_id": 59303898, "comment_id": 104811703, "body": "@mh-cbon I agree, but nobody knows what did R.Slaby mean under &quot;safety&quot;. By the way, even if the S3 object is being written concurrently, why do you need to get its metadata concurrently?"}, {"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 0, "creation_date": 1576154611, "post_id": 59303898, "comment_id": 104812057, "body": "usually you use s3 in some kind of distributed processing, depending the implementation requirement, they may compete for the same resource, hence my remark. Like you, i am unclear about what safely means in OP q."}], "tags": [], "owner": {"reputation": 1818, "user_id": 9506712, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zueWr.jpg?s=128&g=1", "display_name": "Tarasovych", "link": "https://stackoverflow.com/users/9506712/tarasovych"}, "is_accepted": false, "score": 0, "last_activity_date": 1576151252, "creation_date": 1576151252, "answer_id": 59303898, "question_id": 57697095, "link": "https://stackoverflow.com/questions/57697095/how-i-can-safely-check-if-file-exists-in-s3-bucket-using-go-in-lambda/59303898#59303898", "title": "How I can safely check if file exists in S3 bucket using go in lambda?", "body": "<p>You can try this code to <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/#S3.HeadObject\" rel=\"nofollow noreferrer\">get object metadata</a>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>sess, err := session.NewSession(&amp;aws.Config{\n    Region: aws.String(\"your-region\"),\n})\n\nif err != nil {\n    //handle error here\n}\n\nsvc := s3.New(session.Must(sess, err))\noutput, err := svc.HeadObject(&amp;s3.HeadObjectInput{\n    Bucket: aws.String(\"bucket_name\"),\n    Key:    aws.String(\"object_key\"),\n})\n\nif err != nil {\n    //handle error here\n}\n\nfmt.Println(output.LastModified) //do something with metadata\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 501, "user_id": 1827796, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a05192cbaa31bbfe337308f86f16de2?s=128&d=identicon&r=PG", "display_name": "Ioannis Tsiokos", "link": "https://stackoverflow.com/users/1827796/ioannis-tsiokos"}, "is_accepted": false, "score": 2, "last_activity_date": 1608310863, "creation_date": 1608310863, "answer_id": 65360986, "question_id": 57697095, "link": "https://stackoverflow.com/questions/57697095/how-i-can-safely-check-if-file-exists-in-s3-bucket-using-go-in-lambda/65360986#65360986", "title": "How I can safely check if file exists in S3 bucket using go in lambda?", "body": "<p>Make sure you have the following permissions:\n&quot;s3:GetObject&quot;,\n&quot;s3:ListBucket&quot;,</p>\n<p>Regarding Safety, AWS just introduced strong consistency for S3</p>\n<pre><code>s3svc = s3.New(sess)\n     \nfunc keyExists(bucket string, key string) (bool, error) {\n        _, err := S3Svc().HeadObject(&amp;s3.HeadObjectInput{\n            Bucket: aws.String(bucket),\n            Key:    aws.String(key),\n        })\n        if err != nil {\n            if aerr, ok := err.(awserr.Error); ok {\n                switch aerr.Code() {            \n                case &quot;NotFound&quot;: // s3.ErrCodeNoSuchKey does not work, aws is missing this error code so we hardwire a string\n                    return false, nil\n                default:\n                    return false, err\n                }\n            }\n            return false, err\n        }\n        return true, nil\n    }\n</code></pre>\n"}], "owner": {"reputation": 91, "user_id": 8398928, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d5bcecc6c029a3ac81350153317adcec?s=128&d=identicon&r=PG&f=1", "display_name": "R.Slaby", "link": "https://stackoverflow.com/users/8398928/r-slaby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2643, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1608310863, "creation_date": 1567011880, "question_id": 57697095, "link": "https://stackoverflow.com/questions/57697095/how-i-can-safely-check-if-file-exists-in-s3-bucket-using-go-in-lambda", "title": "How I can safely check if file exists in S3 bucket using go in lambda?", "body": "<p>I am working on a service for my project that is used to synchronize Lambdas works in AWS. The idea is to write a TrackerFile module that will store structures on S3. Each time I use the tracker, I will check if there is a file with the name assigned to the called tracker.</p>\n\n<p>I have no idea but how to safely check if a file with a given name exists on S3. can you show a sample piece of code that would be able to return (bool, err) where bool is True if the file exists?</p>\n"}, {"tags": ["go", "cgo", "unsafe-pointers"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567014463, "post_id": 57696977, "comment_id": 101839447, "body": "You cannot take the address of an interface dynamic value. That\u2019s simply how interfaces work. If you need a pointer, put a pointer in the interface."}, {"owner": {"reputation": 1418, "user_id": 5946921, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa6d24b5cd68697ac3f92d8b7e608ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Will Da Silva", "link": "https://stackoverflow.com/users/5946921/will-da-silva"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567014647, "post_id": 57696977, "comment_id": 101839531, "body": "I can&#39;t control what gets put into the interface. I&#39;m interfacing with code from a project I have no control over."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567015007, "post_id": 57696977, "comment_id": 101839683, "body": "The you need to copy the value somewhere it can be addressed. Trying to get the address out of the interface is only going to get you undefined behavior, since it\u2019s not allowed in the language spec."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567019059, "post_id": 57698257, "comment_id": 101841183, "body": "The fact that val is always a pointer is not guaranteed by the language. That has changed in the past, and doing this is unsafe in general."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1567021169, "post_id": 57698257, "comment_id": 101842008, "body": "1) this follows the pointer rules: <a href=\"https://godoc.org/unsafe#Pointer\" rel=\"nofollow noreferrer\">godoc.org/unsafe#Pointer</a> that promise compatibility with future versions; despite how topic starter tried to get pointer from uintptr using reflect.Value.Pointer (which tagged in future deprecation list). 2) i don&#39;t think that interface struct may ever been changed, at least up to go2 (because it is really smells like breaking changes). Now this struct is how interfaces works. 3) it won&#39;t be changed without mention. go 1.13(see notes) is already breaks unruled things. 4) so topic starter works with cgo which already meant to be unsafe in general."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567021267, "post_id": 57698257, "comment_id": 101842035, "body": "There&#39;s no tabs, there&#39;s no newlines for comments. What&#39;s wrong?"}, {"owner": {"reputation": 1418, "user_id": 5946921, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa6d24b5cd68697ac3f92d8b7e608ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Will Da Silva", "link": "https://stackoverflow.com/users/5946921/will-da-silva"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567021409, "post_id": 57698257, "comment_id": 101842076, "body": "@JimB I&#39;m asking to do something inherently unsafe (working with cgo/unsafe.Pointer), so I don&#39;t really care if this solution isn&#39;t perfectly safe. If it breaks, I&#39;ll just update my code. For now, this is the most performant and clean way to solve my problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1418, "user_id": 5946921, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa6d24b5cd68697ac3f92d8b7e608ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Will Da Silva", "link": "https://stackoverflow.com/users/5946921/will-da-silva"}, "edited": false, "score": 0, "creation_date": 1567023364, "post_id": 57698257, "comment_id": 101842874, "body": "@WillDaSilva, that\u2019s fine as long as you\u2019re aware that it\u2019s unsafe and undefined. This isn\u2019t relevant to the unsafe pointer rules, it\u2019s the fact the the interface internals are not a public interface and there is no compatibility guarantee (as I said, it has changed in the past)"}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567024604, "post_id": 57698257, "comment_id": 101843334, "body": "@JimB can you provide link? I can&#39;t find recent commit related to interface structure changes. Last one been at 2009 when golang just got released."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1567025305, "post_id": 57698257, "comment_id": 101843606, "body": "Also that is already not &quot;undefined&quot; if you aware how it works and it works the way that golang developers defined for using unsafe everywhere in own code. It even sounds weird because meant that whole language runtime is unsafe by your words. Just it&#39;s less documented than another code."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567025403, "post_id": 57698257, "comment_id": 101843647, "body": "I\u2019m fairly certain it was after 1.0, and it wasn\u2019t a structural change but the compiler would pack small values into the interface. I\u2019m not sure why it matters when it was changed though, breaking the language spec is unsafe and undefined, period. If you have some rare case where those values can\u2019t be preallocated and the copy somehow effects you (copying a pointer sized values is usually faster than a dereferrence), then go ahead and accept the lack of memory safety at your own risk."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567025728, "post_id": 57698257, "comment_id": 101843783, "body": "And that isn\u2019t what \u201cundefined\u201d means. Yes, the language runtime <i>is</i> by definition \u201cunsafe\u201d of course, because it\u2019s the implementation of the language spec. \u201cUndefined\u201d means &quot;not defined in the language specification\u201d. Many languages have undefined behavior that you can observe in the implementation, but use of that behavior very often learns to bugs."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1567026449, "post_id": 57698257, "comment_id": 101844036, "body": "That&#39;s why it is called &quot;unsafe&quot;, people should care about safety by their own, but that&#39;s still defined and usable unless people abuse spoonfeeding without understanding.  That commit been exactly a decade ago and at the moment nothing presages changes. There&#39;s no even related issues what can make some point about."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1567026812, "post_id": 57698257, "comment_id": 101844184, "body": "Ok, i got your point. Just i trying to say that code provided in answer has nothing &quot;undefined&quot;, because there&#39;s only 2 fields with type and value pointers and struct itself doesn&#39;t presage to changes. It&#39;s still unsafe but defined code because works same way as regular interface except unsafe representation."}, {"owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "edited": false, "score": 0, "creation_date": 1567027156, "post_id": 57698257, "comment_id": 101844319, "body": "Sorry for mistypes over the place, i have to change but SO doesn&#39;t seems that allows that"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567086201, "post_id": 57698257, "comment_id": 101865291, "body": "Sorry, but this is literally the common definition of \u201cundefined\u201d. This is not defined in the language spec, is not guaranteed by any means, and a Go implementation (there are multiple) may implement interfaces in any way it chooses, provided it behaves according to the spec."}], "tags": [], "owner": {"reputation": 412, "user_id": 10779150, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-PdwkjFzp4rE/AAAAAAAAAAI/AAAAAAAAABU/9BZconXx6W0/photo.jpg?sz=128", "display_name": "Laevus Dexter", "link": "https://stackoverflow.com/users/10779150/laevus-dexter"}, "is_accepted": true, "score": 0, "last_activity_date": 1567030903, "last_edit_date": 1567030903, "creation_date": 1567017108, "answer_id": 57698257, "question_id": 57696977, "link": "https://stackoverflow.com/questions/57696977/how-to-get-a-pointer-to-the-underlying-value-of-an-interface-in-go/57698257#57698257", "title": "How to get a pointer to the underlying value of an Interface{} in Go", "body": "<p><code>interface{}</code> has own struct:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type eface struct {\n    typ *rtype\n    val unsafe.Pointer\n}\n</code></pre>\n\n<p>You have no access to <code>rtype</code> directly or by linking, on the other hand, even though you'll copy whole rtype, it may be changed (deprecated) at future.</p>\n\n<p>But thing is that you can replace pointer types with <code>unsafe.Pointer</code> (it may be anything else with same size, but pointer is much idiomatic, because each type has own <strong>pointer</strong>):</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type eface struct {\n    typ, val unsafe.Pointer\n} \n</code></pre>\n\n<p>So, now we can get value contained in eface:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func some_func(arg interface{}) {\n   passed_value := (*eface)(unsafe.Pointer(&amp;arg)).val\n   *(*byte)(passed_value) = 'b'\n}\n\nsome_var := byte('a')\n\nfmt.Println(string(some_var)) // 'a'\n\nsome_func(some_var)\nfmt.Println(string(some_var)) // 'a', it didn't changed, just because it was copied\n\nsome_func(&amp;some_var)\nfmt.Println(string(some_var)) // 'b'\n</code></pre>\n\n<p>You also might see some more usages at my repo:\n<a href=\"https://github.com/LaevusDexter/fast-cast\" rel=\"nofollow noreferrer\">https://github.com/LaevusDexter/fast-cast</a></p>\n\n<p>Sorry for my poor English.</p>\n"}], "owner": {"reputation": 1418, "user_id": 5946921, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fa6d24b5cd68697ac3f92d8b7e608ea7?s=128&d=identicon&r=PG&f=1", "display_name": "Will Da Silva", "link": "https://stackoverflow.com/users/5946921/will-da-silva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 450, "favorite_count": 0, "accepted_answer_id": 57698257, "answer_count": 1, "score": 0, "last_activity_date": 1567030903, "creation_date": 1567011284, "question_id": 57696977, "link": "https://stackoverflow.com/questions/57696977/how-to-get-a-pointer-to-the-underlying-value-of-an-interface-in-go", "title": "How to get a pointer to the underlying value of an Interface{} in Go", "body": "<p>I'm interfacing with C code in Go using cgo, and I need to call a C function with a pointer to the underlying value in an <code>Interface{}</code> object. The value will be any of the atomic primitive types (not including <code>complex64</code>/<code>complex128</code>}, or <code>string</code>.</p>\n\n<p>I was hoping I'd be able to do something like this to get the address of <code>ptr</code> as an <code>unsafe.Pointer</code>:</p>\n\n<pre><code>unsafe.Pointer(reflect.ValueOf(ptr).UnsafeAddr())\n</code></pre>\n\n<p>But this results in a panic due to the value being unaddressable.</p>\n\n<p>A similar question to this is <a href=\"https://stackoverflow.com/questions/15518919/take-address-of-value-inside-an-interface\">Take address of value inside an interface</a>, but this question is different, as in this case it is known that the value will always be one of the types specified above (which will be at most 64 bits), and I only need to give this value to a C function. Note that there are multiple C functions, and the one that will be called varies based off of a different unrelated parameter.</p>\n\n<p>I also tried to solve this using a type switch statement, however I found myself unable to get the address of the values even after the type assertion was done. I was able to assign the values to temporary copies, then get the address of those copies, but I'd rather avoid making these copies if possible.</p>\n"}, {"tags": ["postgresql", "docker", "go", "kubernetes", "docker-compose"], "comments": [{"owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1569380831, "post_id": 57696882, "comment_id": 102574089, "body": "FWIW, you don&#39;t have to close your question, and we aren&#39;t trying to say you are doing it wrong, but I am saying that what you have described isn&#39;t an effective debugging technique. Pop into <a href=\"https://chat.stackoverflow.com/rooms/62927/rust\">the chat</a> if you want. Please flag this comment as &quot;no longer needed&quot; once you see it to keep this Q&amp;A tidy."}, {"owner": {"reputation": 2430, "user_id": 1762493, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pEEmF.jpg?s=128&g=1", "display_name": "Mikeumus", "link": "https://stackoverflow.com/users/1762493/mikeumus"}, "reply_to_user": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1569381269, "post_id": 57696882, "comment_id": 102574148, "body": "@Shepmaster, I&#39;m here now: <a href=\"https://meta.stackoverflow.com/questions/334761/stack-overflow-chat-asks-me-to-log-in-but-i-am-already-logged-in#comment729892_334761\" title=\"stack overflow chat asks me to log in but i am already logged in%23comment729892_334761\">meta.stackoverflow.com/questions/334761/&hellip;</a> my luck right now is \ud83d\udcaf"}, {"owner": {"reputation": 269529, "user_id": 155423, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/419218774d04a581476ea1887a0921e0?s=128&d=identicon&r=PG", "display_name": "Shepmaster", "link": "https://stackoverflow.com/users/155423/shepmaster"}, "edited": false, "score": 0, "creation_date": 1569381478, "post_id": 57696882, "comment_id": 102574185, "body": "weird. It looks like you have some weird vestigial account  <a href=\"https://chat.stackoverflow.com/users/244193/mikeumus\">chat.stackoverflow.com/users/244193/mikeumus</a>"}], "answers": [{"comments": [{"owner": {"reputation": 895, "user_id": 4252996, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/c708ad123f5b181bfa47381fa7ea801a?s=128&d=identicon&r=PG&f=1", "display_name": "mondayguy", "link": "https://stackoverflow.com/users/4252996/mondayguy"}, "edited": false, "score": 1, "creation_date": 1605612855, "post_id": 57696883, "comment_id": 114698069, "body": "Worked for me, plussed from 2 accounts=)"}], "tags": [], "owner": {"reputation": 2430, "user_id": 1762493, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pEEmF.jpg?s=128&g=1", "display_name": "Mikeumus", "link": "https://stackoverflow.com/users/1762493/mikeumus"}, "is_accepted": true, "score": 4, "last_activity_date": 1567010903, "creation_date": 1567010903, "answer_id": 57696883, "question_id": 57696882, "link": "https://stackoverflow.com/questions/57696882/docker-golang-lib-pq-dial-tcp-127-0-0-15432-connect-connection-refused/57696883#57696883", "title": "docker + golang lib/pq &quot;dial tcp 127.0.0.1:5432: connect: connection refused&quot;", "body": "<p>Using the connection string as a URL worked:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>    url := fmt.Sprintf(\"postgres://%v:%v@%v:%v/%v?sslmode=disable\",\n        pql.conf.Postgres.User,\n        pql.conf.Postgres.Password,\n        pql.conf.Postgres.Host,\n        pql.conf.Postgres.Port,\n        pql.conf.Postgres.DB)\n</code></pre>\n\n<p>See lib/pq docs here:\n<a href=\"https://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/lib/pq</a></p>\n\n<p>I was stuck on this for more than a day and I owe the fix to Nikolay Sandalov's comment here in GitHub:\n<a href=\"https://github.com/coreos/clair/issues/134#issuecomment-491300639\" rel=\"nofollow noreferrer\">https://github.com/coreos/clair/issues/134#issuecomment-491300639</a></p>\n\n<p>Thank you, Nikolay \ud83d\ude47\ud83c\udffb\u200d\u2642\ufe0f</p>\n"}], "owner": {"reputation": 2430, "user_id": 1762493, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/pEEmF.jpg?s=128&g=1", "display_name": "Mikeumus", "link": "https://stackoverflow.com/users/1762493/mikeumus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4188, "favorite_count": 1, "accepted_answer_id": 57696883, "answer_count": 1, "score": 1, "last_activity_date": 1567010903, "creation_date": 1567010903, "question_id": 57696882, "link": "https://stackoverflow.com/questions/57696882/docker-golang-lib-pq-dial-tcp-127-0-0-15432-connect-connection-refused", "title": "docker + golang lib/pq &quot;dial tcp 127.0.0.1:5432: connect: connection refused&quot;", "body": "<p><code>sql.Open()</code> wouldn't error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if db, err = sql.Open(\"postgres\", url); err != nil {\n    return nil, fmt.Errorf(\"Postgres connect error : (%v)\", err)\n}\n</code></pre>\n\n<p>but <code>db.Ping()</code> would error:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err = db.Ping(); err != nil {\n    return nil, fmt.Errorf(\"Postgres ping error : (%v)\", err)\n}\n</code></pre>\n\n<p>and it was simply because the lib/pq connection string wouldn't connect from within a docker container with the seperated connection parameters.</p>\n\n<p>For example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>url := fmt.Sprintf(\"user=%v password=%v host=%v port=%v dbname=%v\",\n    rs.conf.Redshift.User,\n    rs.conf.Redshift.Password,\n    rs.conf.Redshift.Host,\n    rs.conf.Redshift.Port,\n    rs.conf.Redshift.DB)\n</code></pre>\n"}, {"tags": ["go", "time", "channel"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1567011681, "creation_date": 1567011681, "answer_id": 57697057, "question_id": 57696867, "link": "https://stackoverflow.com/questions/57696867/go-program-sleeps-forever-even-after-passing-short-time-duration/57697057#57697057", "title": "Go program sleeps forever even after passing short time.Duration", "body": "<p>This code has a number of problems, mainly a tight loop using <code>for</code>/<code>select</code> that may not allow the other goroutine to ever get to send on the channel. Since the <code>default</code> case is empty and the <code>select</code> has only one <code>case</code>, the whole <code>select</code> is unnecessary. The following code works correctly:</p>\n\n<pre><code>backOffChan := make(chan struct{})\ngo func() {\n    time.Sleep(1 * time.Millisecond)\n    backOffChan &lt;- struct{}{}\n}()\nfor range backOffChan {\n    d := time.Duration(10 * time.Millisecond)\n    log.Printf(\"reconnecting in %s\", d)\n    select {\n    case &lt;-time.After(d):\n        log.Printf(\"reconnected after %s\", d)\n        return\n    }\n}\n</code></pre>\n\n<p>This will wait until the <code>backOffChan</code> gets a message without burning a tight loop.</p>\n\n<p>(Note that this code also addresses issues using <code>log.Println</code> with formatting directives - these were corrected to <code>log.Printf</code>).</p>\n\n<p>See it in action here: <a href=\"https://play.golang.org/p/ksAzOq5ekrm\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ksAzOq5ekrm</a></p>\n"}], "owner": {"reputation": 154, "user_id": 10316247, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/--EoxDyFKf8Y/AAAAAAAAAAI/AAAAAAAAAuM/gd0UM-OmTx8/photo.jpg?sz=128", "display_name": "nicolasassi", "link": "https://stackoverflow.com/users/10316247/nicolasassi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 41, "favorite_count": 0, "accepted_answer_id": 57697057, "answer_count": 1, "score": -1, "last_activity_date": 1567011681, "creation_date": 1567010842, "question_id": 57696867, "link": "https://stackoverflow.com/questions/57696867/go-program-sleeps-forever-even-after-passing-short-time-duration", "title": "Go program sleeps forever even after passing short time.Duration", "body": "<p>I'm trying to build some short of semaphore in Go. Although when when the channel receives the signal it just sleeps forever.</p>\n\n<p>I've tried changing the way to sleep and the duration to sleep, but it stills just stopping forever.</p>\n\n<p>Here a representation of what I've tried: </p>\n\n<pre><code>func main() {\n    backOffChan := make(chan struct{})\n    go func() {\n        time.Sleep(2)\n        backOffChan &lt;- struct{}{}\n    }()\n    for {\n        select {\n        case &lt;-backOffChan:\n            d := time.Duration(5 * time.Second)\n            log.Println(\"reconnecting in %s\", d)\n            select {\n            case &lt;-time.After(d):\n                log.Println(\"reconnected after %s\", d)\n                return\n            }\n        default:\n        }\n    }\n}\n</code></pre>\n\n<p>I expect that it just returns after printing the log message and returning.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 1, "creation_date": 1567009150, "post_id": 57696399, "comment_id": 101837274, "body": "<code>msg = fmt.Sprint(msgAndArgs...)</code> - should this not be wrapped in an <code>else</code> block?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1567009343, "post_id": 57696399, "comment_id": 101837370, "body": "<i>&quot;is there a workaround?&quot;</i> try using the -vet=off flag. Why? This is a <code>go vet</code> error from the <code>printf</code> check and <code>go test</code> runs <code>go vet</code> before executing the test binary. <a href=\"https://golang.org/cmd/go/#hdr-Test_packages\" rel=\"nofollow noreferrer\">golang.org/cmd/go/#hdr-Test_packages</a> and <a href=\"https://golang.org/cmd/vet/\" rel=\"nofollow noreferrer\">golang.org/cmd/vet</a>."}, {"owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 2, "creation_date": 1567009471, "post_id": 57696399, "comment_id": 101837415, "body": "Or slightly less sledge-hammery: <a href=\"https://github.com/golang/go/issues/12294\" rel=\"nofollow noreferrer\"><code>-printfuncs=makeError</code></a> (<a href=\"https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/\" rel=\"nofollow noreferrer\">additional explanation</a>)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 1, "creation_date": 1567009825, "post_id": 57696399, "comment_id": 101837561, "body": "@MTCoster will that flag be passed by <code>go test</code> to <code>go vet</code>?"}, {"owner": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1567010347, "post_id": 57696399, "comment_id": 101837771, "body": "@mkopriva Good point, I wasn&#39;t thinking about that. Worth a quick test I think"}, {"owner": {"reputation": 12085, "user_id": 842685, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b00aa217caf47e646f5d5aea851dc4a7?s=128&d=identicon&r=PG", "display_name": "Joshua Honig", "link": "https://stackoverflow.com/users/842685/joshua-honig"}, "reply_to_user": {"reputation": 5287, "user_id": 1813169, "user_type": "registered", "accept_rate": 70, "profile_image": "https://i.stack.imgur.com/wTAkF.jpg?s=128&g=1", "display_name": "MTCoster", "link": "https://stackoverflow.com/users/1813169/mtcoster"}, "edited": false, "score": 0, "creation_date": 1567088830, "post_id": 57696399, "comment_id": 101866948, "body": "@MTCoster alas the printfuncs flag doesn&#39;t even seem to work with <code>go vet</code>. Full info is outside the scope of this question"}, {"owner": {"reputation": 437, "user_id": 6291719, "user_type": "registered", "accept_rate": 74, "profile_image": "https://graph.facebook.com/610655952418150/picture?type=large", "display_name": "Ulises Vargas De Sousa", "link": "https://stackoverflow.com/users/6291719/ulises-vargas-de-sousa"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1600906589, "post_id": 57696399, "comment_id": 113240120, "body": "@mkopriva solution helps me, +1"}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 2, "last_activity_date": 1567009547, "creation_date": 1567009547, "answer_id": 57696603, "question_id": 57696399, "link": "https://stackoverflow.com/questions/57696399/go-test-wont-build-call-has-possible-formatting-directive/57696603#57696603", "title": "go test won&#39;t build: Call has possible formatting directive", "body": "<p>From the help text of go test:</p>\n\n<blockquote>\n  <p>As part of building a test binary, go test runs go vet on the package\n  and its test source files to identify significant problems. If go vet\n  finds any problems, go test reports those and does not run the test\n  binary. Only a high-confidence subset of the default go vet checks are\n  used. That subset is: 'atomic', 'bool', 'buildtags', 'nilfunc', and\n  'printf'. You can see the documentation for these and other vet tests\n  via \"go doc cmd/vet\". To disable the running of go vet, use the\n  -vet=off flag.\"</p>\n</blockquote>\n"}], "owner": {"reputation": 12085, "user_id": 842685, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/b00aa217caf47e646f5d5aea851dc4a7?s=128&d=identicon&r=PG", "display_name": "Joshua Honig", "link": "https://stackoverflow.com/users/842685/joshua-honig"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1729, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1567009547, "creation_date": 1567008627, "question_id": 57696399, "link": "https://stackoverflow.com/questions/57696399/go-test-wont-build-call-has-possible-formatting-directive", "title": "go test won&#39;t build: Call has possible formatting directive", "body": "<p><code>go test</code> refuses to build when a call to a function in the library to be tested <em>by design</em> contains a formatting directive. Is this intentional or is this a bug? Either way, is there a workaround?</p>\n\n<p>Please note, unlike <a href=\"https://stackoverflow.com/questions/53961617/call-has-possible-formatting-directive\">Call has possible formatting directive</a>, this is <em>not</em> a call to a built-in function that doesn't accept formatting directives. It is a call to a function that I wrote and which is specifically designed to accept formatting directives. </p>\n\n<p>Here is a contrived but complete reproduction. Note <code>makeError</code> is designed to handle a format string. <code>go build</code> works fine, but <code>go test</code> produces the following error and does not run any tests:</p>\n\n<pre><code>.\\example.go:16:13: makeError call has possible formatting directive %v\nFAIL    sandbox/example [build failed]\n</code></pre>\n\n<p>go version: <code>go version go1.12.7 windows/amd64</code></p>\n\n<p><code>example.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package example\n\nimport \"fmt\"\n\ntype ErrExample struct {\n    data interface{}\n    msg  string\n}\n\nfunc (e *ErrExample) Error() string {\n    return e.msg\n}\n\nfunc Divide(f1 float64, f2 float64) (float64, error) {\n    if f2 == 0.0 {\n        return 0, makeError(nil, \"Cannot divide %v by 0\", f1)\n    }\n    return f1 / f2, nil\n}\n\nfunc makeError(data interface{}, msgAndArgs ...interface{}) error {\n    msg := \"\"\n    switch len(msgAndArgs) {\n    case 0:\n        // Ignore\n    case 1:\n        msg = fmt.Sprint(msgAndArgs[0])\n    default:\n        if str, ok := msgAndArgs[0].(string); ok {\n            msg = fmt.Sprintf(str, msgAndArgs[1:]...)\n        }\n        msg = fmt.Sprint(msgAndArgs...)\n    }\n    return &amp;ErrExample{data: data, msg: msg}\n}\n</code></pre>\n\n<p><code>example_test.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package example\n\nimport (\n    \"testing\"\n)\n\nfunc TestDivide(t *testing.T) {\n    _, err := Divide(1230, 0)\n    if err == nil {\n        t.Errorf(\"Expected error when dividing by 0\")\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "mips"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1567005232, "post_id": 57693825, "comment_id": 101835127, "body": "Side note: unless you have very specific requirements, <code>go build</code> should normally not be used with file names but with package names (or empty or <code>.</code> for the package in the current directory)."}], "answers": [{"tags": [], "owner": {"reputation": 541, "user_id": 162393, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0aece0b73256254b3cc0dd340d99ec46?s=128&d=identicon&r=PG", "display_name": "Almost Famous", "link": "https://stackoverflow.com/users/162393/almost-famous"}, "is_accepted": false, "score": 1, "last_activity_date": 1567016565, "creation_date": 1567016565, "answer_id": 57698121, "question_id": 57693825, "link": "https://stackoverflow.com/questions/57693825/net-listen-returns-errno-89-on-linux-mipsle/57698121#57698121", "title": "net.Listen returns errno -89 on linux/mipsle", "body": "<p><a href=\"https://github.com/golang/go/issues/23446\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/23446</a></p>\n\n<p>Issue with socket flags on older kernel versions. Resolved in GO 1.11+</p>\n"}], "owner": {"reputation": 541, "user_id": 162393, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/0aece0b73256254b3cc0dd340d99ec46?s=128&d=identicon&r=PG", "display_name": "Almost Famous", "link": "https://stackoverflow.com/users/162393/almost-famous"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 76, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1567016565, "creation_date": 1566999584, "last_edit_date": 1567005133, "question_id": 57693825, "link": "https://stackoverflow.com/questions/57693825/net-listen-returns-errno-89-on-linux-mipsle", "title": "net.Listen returns errno -89 on linux/mipsle", "body": "<p>I'm running into an error with Go not being able to listen on a MIPSLE router. A simple listener using <code>net.Listen(\"tcp\", \"127.0.0.1:8080\")</code></p>\n\n<p>Is returning <code>Error listening: listen tcp 127.0.0.1:8080: errno -89</code></p>\n\n<p>C compiled programs work fine, it seems to be just Go. I'm compiling with version 1.10.8 (1.11+ does not run on the router)</p>\n\n<p><code>env GOOS=linux GOARCH=mipsle GOMIPS=softfloat go build -a main.go</code></p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 363, "user_id": 3795990, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6d37d81a7ddc13e52d035d4b86281985?s=128&d=identicon&r=PG&f=1", "display_name": "zxdvd", "link": "https://stackoverflow.com/users/3795990/zxdvd"}, "edited": false, "score": 0, "creation_date": 1566992690, "post_id": 57691595, "comment_id": 101827517, "body": "I think it&#39;s impossible."}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566992929, "post_id": 57691595, "comment_id": 101827652, "body": "Why do you want to do such a thing ? If you know at the first place that you want the fied <code>id</code> in your json, why not set it to <code>id</code> ?"}, {"owner": {"reputation": 15, "user_id": 1645430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8596759b26bb7efcaf2f6e752e063866?s=128&d=identicon&r=PG", "display_name": "impervious", "link": "https://stackoverflow.com/users/1645430/impervious"}, "reply_to_user": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566993119, "post_id": 57691595, "comment_id": 101827766, "body": "@edkeveked I am exploring a different approach. The server_response will have metadata fields and one payload field which I would like to just pass on to the API response handler to unmarshal it. But to load the object in data, I need to apply the tag."}, {"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566993890, "post_id": 57691595, "comment_id": 101828216, "body": "Why do you need to apply the tag to load the data ? That does not seem clear to me"}, {"owner": {"reputation": 15, "user_id": 1645430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8596759b26bb7efcaf2f6e752e063866?s=128&d=identicon&r=PG", "display_name": "impervious", "link": "https://stackoverflow.com/users/1645430/impervious"}, "reply_to_user": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566995139, "post_id": 57691595, "comment_id": 101828928, "body": "@edkeveked Updated the description. Basically, either the field name should match the key or the json tag should. So, if I have a Payload with tag as <code>json:&quot;stats&quot;</code> and the response json has a field &quot;stats&quot;, the whole stats field will be loaded into Payload as a raw json."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1566998965, "post_id": 57691595, "comment_id": 101831257, "body": "Struct tags are a feature of the type, and types are immutable at runtime. You could create a new type using reflection but it&#39;s going to be even harder to work with than a <code>map</code>."}], "answers": [{"comments": [{"owner": {"reputation": 15, "user_id": 1645430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8596759b26bb7efcaf2f6e752e063866?s=128&d=identicon&r=PG", "display_name": "impervious", "link": "https://stackoverflow.com/users/1645430/impervious"}, "edited": false, "score": 0, "creation_date": 1566997944, "post_id": 57692601, "comment_id": 101830613, "body": "Updated description to state why I don&#39;t want to use generic map."}, {"owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "reply_to_user": {"reputation": 15, "user_id": 1645430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8596759b26bb7efcaf2f6e752e063866?s=128&d=identicon&r=PG", "display_name": "impervious", "link": "https://stackoverflow.com/users/1645430/impervious"}, "edited": false, "score": 0, "creation_date": 1567000809, "post_id": 57692601, "comment_id": 101832442, "body": "I understand your point about generic maps, and that&#39;s precisely where the <code>mapstructure</code> package comes into play: it allows you to &quot;unmarshal&quot; a <code>map[string]interface{}</code> into a struct, removing the need to write code like <code>decodedData.Version = genericMap[&quot;version&quot;]</code>."}], "tags": [], "owner": {"reputation": 36, "user_id": 10653205, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/biZZx.jpg?s=128&g=1", "display_name": "Adrien", "link": "https://stackoverflow.com/users/10653205/adrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1566995850, "creation_date": 1566995850, "answer_id": 57692601, "question_id": 57691595, "link": "https://stackoverflow.com/questions/57691595/can-we-update-tags-on-struct-fields-via-reflection/57692601#57692601", "title": "Can we update tags on struct fields via reflection?", "body": "<p>If I understand your question properly, why don't you simply pass the entire response to the handler? The handler will then know if it needs to read from the <code>stats</code> or the <code>id</code> or whatever field... <a href=\"https://play.golang.org/p/pQXa3Gm_WS0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pQXa3Gm_WS0</a> shows roughly the idea.</p>\n\n<p>An alternative would be to decode your response into a <code>map[string]interface{}</code> and to use <a href=\"https://github.com/mitchellh/mapstructure\" rel=\"nofollow noreferrer\">https://github.com/mitchellh/mapstructure</a> afterwards to decode parts of the response into structs. </p>\n"}], "owner": {"reputation": 15, "user_id": 1645430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8596759b26bb7efcaf2f6e752e063866?s=128&d=identicon&r=PG", "display_name": "impervious", "link": "https://stackoverflow.com/users/1645430/impervious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 138, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566997894, "creation_date": 1566992490, "last_edit_date": 1566997894, "question_id": 57691595, "link": "https://stackoverflow.com/questions/57691595/can-we-update-tags-on-struct-fields-via-reflection", "title": "Can we update tags on struct fields via reflection?", "body": "<p>I would like to know if we can update tag on a struct instance before unmarshaling data into it.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Response struct {\n    Name    string          `json:\"name\"`\n    Payload json.RawMessage `json:\"default\"`\n}\n\nvar data Response\n&lt;update tag on data.Payload to say `json:\"id\"`&gt;\njson.Unmarshal(server_response, &amp;data)\n</code></pre>\n\n<p>The motivation is to load common keys in Response struct and delegate API specific response to API handler by passing the raw Payload.</p>\n\n<p>The Payload fields, are complex structs, hence being parsed in their own handlers makes it cleaner. </p>\n\n<p>Need to apply the tag, to let json.Unmarshal know which key from server_response to map to Payload.</p>\n\n<p>The metadata fields (like Name) need some validations. So, if I pass the entire response to handler, each handler has to extract each field and return this metadata, which is well, not a very clean approach. </p>\n\n<p>Decoding response to map[string]interface{} also leads to same issue. I want all the fields of metadata in one struct, populated automatically and handler to parse payload. Decoding to generic map, means copying keys. </p>\n\n<p>Example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Response struct {\n  Version int\n  Name string\n  Hash string\n  Payload json.RawMessage\n}\n</code></pre>\n\n<p>Would like the main function to load the server response in this object, to be able to do all kinds of validations and pass on Payload to handler to let it deal with it. </p>\n\n<p>Using generic map means writing code like:\ndecodedData.Version = genericMap[\"version\"] \nwhich does not scale to lots of keys.</p>\n"}, {"tags": ["go", "optimization", "benchmarking", "goroutine", "flamegraph"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567006148, "post_id": 57691331, "comment_id": 101835682, "body": "Do you have appropriate timeouts set in all your read and write operations? A blocked write can be multiple things, but the only way to handle it in the write is to timeout."}, {"owner": {"reputation": 165, "user_id": 7785023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3df1beffad732cc45094736c12e71e96?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/7785023/jay"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567146277, "post_id": 57691331, "comment_id": 101883747, "body": "I have no idea about any blocking write operation in my code. The http fetching is issued by DefaultClient from net/http which is said to support asynchornous request from multiple go routines. The neo4j query is issued by the official driver with a underlying lib called seabolt, using the bolt protocol which seems to have no thing to do with http"}, {"owner": {"reputation": 165, "user_id": 7785023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3df1beffad732cc45094736c12e71e96?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/7785023/jay"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1567151386, "post_id": 57691331, "comment_id": 101885935, "body": "@JimB Is it a fake bottleneck? http.DefaultClient uses a pool of persist connections to handle request, and they stay idle when there is no new request, so they are blocked at the &quot;select&quot; in http.(*persistConn).writeLoop() when they are waiting for new request from pc.writech or closing command from pc.closech. http.(*persistConn).writeLoop() seems to be blocked for a long time because there is no new request?"}], "owner": {"reputation": 165, "user_id": 7785023, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3df1beffad732cc45094736c12e71e96?s=128&d=identicon&r=PG&f=1", "display_name": "Jay", "link": "https://stackoverflow.com/users/7785023/jay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 658, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566991616, "creation_date": 1566991616, "question_id": 57691331, "link": "https://stackoverflow.com/questions/57691331/process-spend-too-much-time-blocking-at-select-go-with-no-explicit-corresponding", "title": "process spend too much time blocking at select.go with no explicit corresponding operation", "body": "<p>I'm trying to figure out the bottleneck of my program. Accroding to the benchmark result, the process is blocked at line 485 of runtime/select.go for a considerably long time which is caused by http.(*persistConn).writeLoop, but I have no idea of the root cause.</p>\n\n<p>I've tried to analyse the http operation in my program. but accroding to the flamegraph, my url fetch operations executed by several goroutines parallelly didn't become a significant burden.  I have not use \"select\" in my program, either </p>\n\n<p>Here is the pprof output in the \"source\" view:</p>\n\n<pre><code>runtime.selectgo\n/usr/lib/golang/src/runtime/select.go\nTotal:    2.75mins   2.75mins (flat, cum) 79.42%\n\n480            .          .             } \n481            .          .             goto retc \n482            .          .            \n483            .          .           retc: \n484            .          .             if cas.releasetime &gt; 0 { \n485     2.75mins   2.75mins                 blockevent(cas.releasetime-t0, 1) \n486            .          .             } \n487            .          .             return casi, recvOK \n488            .          .            \n489            .          .           sclose: \n490            .          .             // send on closed channel \n</code></pre>\n\n<p><a href=\"https://i.stack.imgur.com/uuGbq.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uuGbq.png\" alt=\"flamegraph of blocking\"></a></p>\n\n<p>I'd like to know the possible cause of this cost or the way to analyze the reason of this cost.</p>\n"}, {"tags": ["go", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 291, "user_id": 10856988, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DDlHR.png?s=128&g=1", "display_name": "starzar", "link": "https://stackoverflow.com/users/10856988/starzar"}, "is_accepted": true, "score": 0, "last_activity_date": 1567011263, "last_edit_date": 1567011263, "creation_date": 1567008879, "answer_id": 57696453, "question_id": 57691111, "link": "https://stackoverflow.com/questions/57691111/gomobile-build-cannot-find-package/57696453#57696453", "title": "GoMobile Build : Cannot find package", "body": "<p>Go takes path references with respect to the GOPATH or GOROOT path's provided in  environment/system variables.It looks into the <strong>\"src\"</strong> directory in the GOPATH/GOROOT for the package .<strong>This means providing absolute package path will not work.</strong></p>\n\n<p><strong>- Example(the above case )</strong>  </p>\n\n<blockquote>\n  <p>GOPATH = D:\\Script\\Golang<br>\n    GOROOT = C:\\go<br>\n  Absolute Package path = D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic</p>\n</blockquote>\n\n<p>In this case, providing <strong>absolute package path</strong> will be read as </p>\n\n<blockquote>\n  <p>GOPATH\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic<br>\n    <strong>or</strong>\n  GOROOT\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic</p>\n</blockquote>\n\n<p>As golang uses GOPATH or GOROOT as reference , the package path should be </p>\n\n<blockquote>\n  <p>GOPATH\\golang.org\\x\\mobile\\example\\basic</p>\n</blockquote>\n\n<p>Golang automatically will use the reference GOPATH in the environment variables and append to it the path which comes after it.<br>\nSo in the above case,the  package path provided would be -  </p>\n\n<blockquote>\n  <p>PS D:\\Script\\Golang\\bin> .\\gomobile.exe build golang.org\\x\\mobile\\example\\basic</p>\n</blockquote>\n"}], "owner": {"reputation": 291, "user_id": 10856988, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DDlHR.png?s=128&g=1", "display_name": "starzar", "link": "https://stackoverflow.com/users/10856988/starzar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 509, "favorite_count": 0, "accepted_answer_id": 57696453, "answer_count": 1, "score": 0, "last_activity_date": 1567011263, "creation_date": 1566990891, "question_id": 57691111, "link": "https://stackoverflow.com/questions/57691111/gomobile-build-cannot-find-package", "title": "GoMobile Build : Cannot find package", "body": "<p>I was testing GoMobile tools in Go[1.12.9 windows/amd64] ,and tried to build the example projects that come with it into an Android Apk.<br>\nOn pointing the build to the <strong>package</strong> directory and running the build command, the console gave a <strong>cannot find package error</strong>.   How can the Go package be recognised?<br>\n[<strong>NOTE</strong>- I tried installing and using <a href=\"https://godoc.org/golang.org/x/mobile/cmd/gomobile\" rel=\"nofollow noreferrer\">GoMobile tools</a>,but they were also not recognised,I could only download them as a Git package via VSCode ]</p>\n\n<pre><code>PS D:\\Script\\Golang\\bin&gt; go version\ngo version go1.12.9 windows/amd64  \nPS D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic&gt; gci\n\n\n    Directory: D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic\n\n\nMode                LastWriteTime         Length Name\n----                -------------         ------ ----\n-a----       18-08-2019     11:27           4618 main.go\n-a----       18-08-2019     11:27            225 main_x.go\n\n\nPS D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic&gt; cd D:\\Script\\Golang\\bin\nPS D:\\Script\\Golang\\bin&gt; .\\gomobile.exe build D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic\nD:\\Script\\Golang\\bin\\gomobile.exe: cannot find package \"D:\\\\Script\\\\Golang\\\\src\\\\golang.org\\\\x\\\\mobile\\\\example\\\\basic\" in any of:\n        c:\\go\\src\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic (from $GOROOT)\n        D:\\Script\\Golang\\src\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic (from $GOPATH)\nS D:\\Script\\Golang\\bin&gt; .\\gomobile.exe build \"D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic\"\nD:\\Script\\Golang\\bin\\gomobile.exe: cannot find package \"D:\\\\Script\\\\Golang\\\\src\\\\golang.org\\\\x\\\\mobile\\\\example\\\\basic\" in any of:\n        c:\\go\\src\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic (from $GOROOT)\n        D:\\Script\\Golang\\src\\D:\\Script\\Golang\\src\\golang.org\\x\\mobile\\example\\basic (from $GOPATH) \n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566987460, "post_id": 57689710, "comment_id": 101824710, "body": "why do you mean by &quot;how can I tell when the end of the buffer is reached&quot; ?"}, {"owner": {"reputation": 599, "user_id": 1115751, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c0b12c4d421141dd9a881cdab13cd350?s=128&d=identicon&r=PG", "display_name": "Waqas", "link": "https://stackoverflow.com/users/1115751/waqas"}, "reply_to_user": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566989156, "post_id": 57689710, "comment_id": 101825650, "body": "I mean there is no more data to search for. I am stuck in the loop if the prompt is not found."}, {"owner": {"reputation": 8470, "user_id": 538866, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eb67b45ca1dc2584f8e4d703d009177b?s=128&d=identicon&r=PG", "display_name": "Jonas G. Drange", "link": "https://stackoverflow.com/users/538866/jonas-g-drange"}, "edited": false, "score": 0, "creation_date": 1566993813, "post_id": 57689710, "comment_id": 101828180, "body": "Is the prompt found by using the <code>validID</code> regexp?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566995248, "post_id": 57689710, "comment_id": 101828995, "body": "Side note: don&#39;t use <code>regexp.MustCompile</code> like this; use <code>regexp.Compile</code> and return the error if not nil. Or, preferably arrange things so that you don&#39;t have to re-compile regular expressions (e.g. take a <code>*regexp.Regexp</code> which the caller can build once at init time with <code>regexp.MustCompile</code> if they&#39;re using a hard-coded regular expression)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566995895, "post_id": 57689710, "comment_id": 101829379, "body": "Does <code>device.reader</code> support <code>SetReadDeadline</code> (such as in <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\"><code>net.Conn</code></a>)?"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566995578, "post_id": 57691328, "comment_id": 101829195, "body": "This won&#39;t do what you think it does. Your first <code>select</code> case creates a new timer channel which will not be readable so the <code>default</code> block will get executed.  An <code>io.Reader</code> (which is probably what <code>device.Reader</code> is) will block until input is available. Even if it didn&#39;t, you recreate a new 1 second timer each time through the loop which will never be ready to read."}], "tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": false, "score": -1, "last_activity_date": 1566996612, "last_edit_date": 1566996612, "creation_date": 1566991608, "answer_id": 57691328, "question_id": 57689710, "link": "https://stackoverflow.com/questions/57689710/end-of-buffer-and-timeout/57691328#57691328", "title": "End of Buffer and Timeout", "body": "<p>You can use a ticker in a select loop to break from your loop</p>\n\n<pre><code>func (device *Device) readUntil(pattern string) (*string, error) {\n    stdoutBuf := make([]byte, 65*1024)\n    output := \"\"\n    var validID = regexp.MustCompile(pattern)\n\n    timeout := time.After(1 * time.Second)\n\n    for {\n\n        select {\n\n        case &lt;-timeout:\n            return nil, errors.New(\"error timeout\")\n\n        default:\n            byteCount, err := device.reader.Read(stdoutBuf)\n            if err != nil {\n                log.Println(\"Reader read err:%s\", err.Error())\n                break\n            }\n            output += string(stdoutBuf[:byteCount])\n            //fmt.Println(byteCount, err, io.EOF)\n\n            if validID.MatchString(string(stdoutBuf[:byteCount])) {\n                return &amp;output, nil\n            }\n        }\n\n    }\n\n    return &amp;output, nil\n}\n</code></pre>\n"}], "owner": {"reputation": 599, "user_id": 1115751, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/c0b12c4d421141dd9a881cdab13cd350?s=128&d=identicon&r=PG", "display_name": "Waqas", "link": "https://stackoverflow.com/users/1115751/waqas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566996612, "creation_date": 1566986210, "question_id": 57689710, "link": "https://stackoverflow.com/questions/57689710/end-of-buffer-and-timeout", "title": "End of Buffer and Timeout", "body": "<p>I have this method that I want to read the buffer until it reaches the prompt. It works fine when the prompt available in the output but I don't know how can I tell when the end of the buffer is reached.</p>\n\n<p>Also, I want to add a timeout in case the device didn't respond.</p>\n\n<pre><code>func (device *Device) readUntil(pattern string) (*string, error) {\nstdoutBuf := make([]byte, 65*1024)\noutput := \"\"\nvar validID = regexp.MustCompile(pattern)\n\nfor {\n    byteCount, err := device.reader.Read(stdoutBuf)\n    if err != nil {\n        log.Println(\"Reader read err:%s\", err.Error())\n        break\n    }\n    output += string(stdoutBuf[:byteCount])\n    //fmt.Println(byteCount, err, io.EOF)\n\n    if validID.MatchString(string(stdoutBuf[:byteCount])) {\n        return &amp;output, nil\n    }\n\n}\n\nreturn &amp;output, nil\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 1, "creation_date": 1566986360, "post_id": 57689622, "comment_id": 101824080, "body": "Maybe you can try, <code>db.Raw(&quot;SELECT * FROM table LIMIT 1&quot;).Scan(&amp;variable)</code>"}, {"owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "reply_to_user": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "edited": false, "score": 0, "creation_date": 1566987697, "post_id": 57689622, "comment_id": 101824826, "body": "yes &#39;__&#39;) i guess that&#39;s the only way"}], "answers": [{"tags": [], "owner": {"reputation": 14633, "user_id": 5069957, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/597577c2765adaa190e4524d3a3860fe?s=128&d=identicon&r=PG&f=1", "display_name": "edkeveked", "link": "https://stackoverflow.com/users/5069957/edkeveked"}, "is_accepted": true, "score": 2, "last_activity_date": 1566987821, "creation_date": 1566987821, "answer_id": 57690232, "question_id": 57689622, "link": "https://stackoverflow.com/questions/57689622/gorm-database-firsttablestruct-id-without-deleted-at-is-null/57690232#57690232", "title": "GORM Database.First(&amp;tableStruct, id) without deleted_at IS NULL", "body": "<p>You can use a raw query</p>\n\n<pre><code>db.Raw(\"SELECT * FROM table LIMIT 1\").Scan(&amp;variable)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "is_accepted": false, "score": 4, "last_activity_date": 1566988263, "creation_date": 1566988263, "answer_id": 57690374, "question_id": 57689622, "link": "https://stackoverflow.com/questions/57689622/gorm-database-firsttablestruct-id-without-deleted-at-is-null/57690374#57690374", "title": "GORM Database.First(&amp;tableStruct, id) without deleted_at IS NULL", "body": "<p>After reading the source code, there are <code>Unscoped</code> method to prevent adding <code>deleted_at IS NULL</code> </p>\n\n<pre><code>Database.Unscoped().First(&amp;tableStruct, id)\n</code></pre>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1001, "favorite_count": 0, "accepted_answer_id": 57690232, "answer_count": 2, "score": 2, "last_activity_date": 1570054709, "creation_date": 1566985994, "last_edit_date": 1570054709, "question_id": 57689622, "link": "https://stackoverflow.com/questions/57689622/gorm-database-firsttablestruct-id-without-deleted-at-is-null", "title": "GORM Database.First(&amp;tableStruct, id) without deleted_at IS NULL", "body": "<p>When <code>tableStruct</code> have <code>gorm.Model</code> inside, how to get first record by <code>id</code> without gorm automatically adding <code>deleted_at IS NULL</code>? Is there such function?</p>\n"}, {"tags": ["go", "grpc", "grpc-gateway"], "answers": [{"tags": [], "owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "is_accepted": true, "score": 8, "last_activity_date": 1567131493, "creation_date": 1567131493, "answer_id": 57719718, "question_id": 57686963, "link": "https://stackoverflow.com/questions/57686963/how-to-access-request-headers-in-grpc-service-proxied-by-grpc-gateway-in-golang/57719718#57719718", "title": "How to access request headers in grpc service proxied by. grpc-gateway in golang", "body": "<p>HTTP headers are stored in metadata. </p>\n\n<p><code>md, ok := metadata.FromIncomingContext(ctx)</code> should work for getting the incoming metadata.</p>\n"}], "owner": {"reputation": 575, "user_id": 1393136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70cefa201e790be5d2d4204b06d60b62?s=128&d=identicon&r=PG", "display_name": "Amudhan", "link": "https://stackoverflow.com/users/1393136/amudhan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1834, "favorite_count": 0, "accepted_answer_id": 57719718, "answer_count": 1, "score": 1, "last_activity_date": 1567131493, "creation_date": 1566976959, "question_id": 57686963, "link": "https://stackoverflow.com/questions/57686963/how-to-access-request-headers-in-grpc-service-proxied-by-grpc-gateway-in-golang", "title": "How to access request headers in grpc service proxied by. grpc-gateway in golang", "body": "<p>I have a grpc server proxied by grpc-gateway. When I make a HTTP call to the gateway endpoint, my corresponding grpc service method is called. Now, the grpc service implementation receives a Context which has the headers. I couldn't figure out how to access the headers.</p>\n\n<p><a href=\"https://i.stack.imgur.com/mB6MZ.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mB6MZ.png\" alt=\"enter image description here\"></a></p>\n\n<p>When I debug my grpc service and put a breakpoint, this is the structure of the Context object which my service receives. Now, how can I get the value of any of the HTTP request headers?</p>\n"}, {"tags": ["go", "go-chi"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566984675, "post_id": 57686809, "comment_id": 101823158, "body": "How do you know <code>req.Body</code> is empty? What does the error returned from <code>Decode</code> say? What do you mean it&#39;s about Render / Bind? What have those two anything to do with this?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566984728, "post_id": 57686809, "comment_id": 101823186, "body": "... also show how you&#39;ve defined the <code>Book</code> model."}, {"owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566986109, "post_id": 57686809, "comment_id": 101823914, "body": "I have updated questions, no error is thrown by Decode method."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566986524, "post_id": 57686809, "comment_id": 101824186, "body": "ok so the first problem is that your fields are unexported. <code>encoding&#47;json</code> doesn&#39;t work on unexported fields. First export the fields, try again, and if that doesn&#39;t fix it update the question with the progress."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566986562, "post_id": 57686809, "comment_id": 101824209, "body": "<a href=\"https://golang.org/ref/spec#Exported_identifiers\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Exported_identifiers</a>"}, {"owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566989175, "post_id": 57686809, "comment_id": 101825660, "body": "Ohh, I missed that part, and after exporting fields, it resolved the problem, many thanks."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566995051, "post_id": 57686809, "comment_id": 101828865, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/26327391/json-marshalstruct-returns\">json.Marshal(struct) returns &quot;{}&quot;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "is_accepted": true, "score": 0, "last_activity_date": 1566989251, "creation_date": 1566989251, "answer_id": 57690674, "question_id": 57686809, "link": "https://stackoverflow.com/questions/57686809/unable-to-read-request-body-in-go-chi-router/57690674#57690674", "title": "Unable to read &quot;request.Body&quot; in Go Chi router", "body": "<p>Exporting all fields of structs resolved the issue. thanks @mkopriva</p>\n\n<pre><code>type Book struct {\nID     primitive.ObjectID `json:\"id,omitempty\" bson:\"id,omitempty\"`\nName   string             `json:\"name,omitempty\" bson:\"name,omitempty\"`\nAuthor string             `json:\"author,omitempty\" bson:\"author,omitempty\"`\nISBN   string             `json:\"isbn,omitempty\" bson:\"isbn,omitempty\"`\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 919, "user_id": 3239630, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/lO5aN.png?s=128&g=1", "display_name": "Alok G.", "link": "https://stackoverflow.com/users/3239630/alok-g"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1442, "favorite_count": 0, "accepted_answer_id": 57690674, "answer_count": 1, "score": 1, "last_activity_date": 1567044237, "creation_date": 1566976398, "last_edit_date": 1567044237, "question_id": 57686809, "link": "https://stackoverflow.com/questions/57686809/unable-to-read-request-body-in-go-chi-router", "title": "Unable to read &quot;request.Body&quot; in Go Chi router", "body": "<p>Consider the following code in main/entry function</p>\n\n<pre><code>    r := chi.NewRouter()\n    r.Use(middleware.RequestID)\n    r.Use(middleware.RealIP)\n    r.Use(middleware.Logger)\n    r.Use(middleware.Recoverer)\n\n    r.Post(\"/book\", controllers.CreateBook)\n    http.ListenAndServe(\":3333\", r)\n</code></pre>\n\n<p>and CreateBook Function defined as </p>\n\n<pre><code>    func CreateBook(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"content-type\", \"application/json\")\n    var bookObj models.Book\n    err := json.NewDecoder(r.Body).Decode(&amp;bookObj)\n    spew.Dump(bookObj)\n    collection := db.Client.Database(\"bookdb\").Collection(\"book\")\n    ctx, _ := context.WithTimeout(context.Background(), 5*time.Second)\n    insertResult, err := collection.InsertOne(ctx, bookObj)\n    if err != nil {\n        log.Fatal(err)\n    }\n    json.NewEncoder(w).Encode(insertResult)\n  }\n</code></pre>\n\n<p>Book Model</p>\n\n<p>//exporting attributes here solved the issue\n    type Book struct {\n        ID     primitive.ObjectID <code>json:\"id,omitempty\" bson:\"id,omitempty\"</code>\n        name   string             <code>json:\"name,omitempty\" bson:\"name,omitempty\"</code>\n        author string             <code>json:\"author,omitempty\" bson:\"author,omitempty\"</code>\n        isbn   string             <code>json:\"isbn,omitempty\" bson:\"isbn,omitempty\"</code>\n    }</p>\n\n<p>However <code>json.NewDecoder(r.Body).Decode(&amp;bookObj)</code> dont parse any things as req.Body is empty, no error thrown, its about chi's Render function, Can anyone help me to disable Render and Bind functions of Chi, I would like to parse body through JSON decoders only.</p>\n\n<p>Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "edited": false, "score": 0, "creation_date": 1566993091, "post_id": 57686808, "comment_id": 101827744, "body": "Did you run <code>source</code> command after changing <code>.zshrc</code> file? Also, try to write to <code>.bash_profile</code> file similar lines as <code>.zshrc</code> is storing. And then <code>$ source ~&#47;.bash_profile</code>. Lemme know if it won&#39;t help"}, {"owner": {"reputation": 51, "user_id": 7379755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/947101be7fea0ab4f63b7ac449a673e3?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/7379755/martin"}, "reply_to_user": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "edited": false, "score": 0, "creation_date": 1567040246, "post_id": 57686808, "comment_id": 101846999, "body": "@Mykhailo Tkachenko Thx for your remind, but I have used the <code>source</code> command before, and I have tried both <code>.zshrc</code> and <code>.bash_profile</code>"}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "edited": false, "score": 1, "creation_date": 1567069648, "post_id": 57686808, "comment_id": 101855861, "body": "Well, there is my <code>bash_profile</code> file and after source command every env var is not empty: <code>export PATH=$PATH:$GOPATH&#47;bin export GOPATH=&quot;$HOME&#47;go&quot; export GOROOT=$HOME&#47;go </code>"}, {"owner": {"reputation": 12637, "user_id": 6347629, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vxdJr.jpg?s=128&g=1", "display_name": "Venkatachalam", "link": "https://stackoverflow.com/users/6347629/venkatachalam"}, "edited": false, "score": 0, "creation_date": 1610730879, "post_id": 57686808, "comment_id": 116233453, "body": "remove the double codes in the your export command. This worked for me.. !!"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 12180051, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/250d6d9a106226a1fe4d5fd9200b4ae6?s=128&d=identicon&r=PG", "display_name": "Andy Zhong", "link": "https://stackoverflow.com/users/12180051/andy-zhong"}, "is_accepted": false, "score": 1, "last_activity_date": 1570516482, "last_edit_date": 1570516482, "creation_date": 1570506973, "answer_id": 58280005, "question_id": 57686808, "link": "https://stackoverflow.com/questions/57686808/error-about-running-go-tour-localy-couldnt-find-tour-files-could-not-find-go/58280005#58280005", "title": "Error about running Go Tour localy: Couldn&#39;t find tour files: could not find go-tour content; check $GOROOT and $GOPATH", "body": "<p>May be you explicitly enable go module through GO111MODULE = on, then tour's code downloaded in <code>$GOPATH/pkg/mod/golang.org/x/tour@v0.0.0-20191002171047-6bb846ce41cd</code> directory, but the tour program lookup tour src code dir through ctx.Import,at this time will only from <code>$GOROOT/src/golang.org/x/tour</code> or <code>$GOPATH/src/golang.org/x/tour</code>, but not from <code>$GOPATH/PKG/mod</code>, so lead to can not find the tour src code dir.</p>\n\n<p>Solution:</p>\n\n<p>Solution 1: copy <code>$GOPATH/pkg/mod/golang.org/x/tour@v0.0.0-20191002171047-6bb846ce41cd</code> to <code>$GOPATH/src/golang.org/x/tour</code></p>\n\n<p>Solution 2: modify the tour source local.go file</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func findRoot() (string, error) {\n    ...\n\n    if os.Getenv(\"GO111MODULE\") == \"on\" {\n        pkgDir := filepath.Join(os.Getenv(\"GOPATH\"), \"pkg\", \"mod\")\n        cfg := &amp;packages.Config{Mode: packages.LoadFiles, Dir: pkgDir}\n        pkgs, _ := packages.Load(cfg, basePkg)\n        for _, pkg := range pkgs {\n            for _, goFile := range pkg.GoFiles {\n                root := filepath.Dir(goFile)\n                if isRoot(root) {\n                    return root, nil\n                }\n            }\n        }\n    }\n    return \"\", fmt.Errorf(\"could not find go-tour content; check $GOROOT and $GOPATH\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 7890430, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8aaf0980f33f57801a008c4c08b2d204?s=128&d=identicon&r=PG&f=1", "display_name": "go4math", "link": "https://stackoverflow.com/users/7890430/go4math"}, "is_accepted": false, "score": 0, "last_activity_date": 1595648107, "creation_date": 1595648107, "answer_id": 63084046, "question_id": 57686808, "link": "https://stackoverflow.com/questions/57686808/error-about-running-go-tour-localy-couldnt-find-tour-files-could-not-find-go/63084046#63084046", "title": "Error about running Go Tour localy: Couldn&#39;t find tour files: could not find go-tour content; check $GOROOT and $GOPATH", "body": "<p>I saw the same problem. And the problem is still not solved following Andy's answer. I checked the code of findRoot function in local.go file, it relies on build.Default, which is the return value of build.defaultContext(). It returns the default context which reads GOPATH from environment variables. And from the source code <a href=\"https://golang.org/src/go/build/build.go\" rel=\"nofollow noreferrer\">build/build.go</a> I see:</p>\n<pre><code>func defaultContext() Context {\n\n    var c Context\n\n    c.GOARCH = envOr(&quot;GOARCH&quot;, runtime.GOARCH)\n    c.GOOS = envOr(&quot;GOOS&quot;, runtime.GOOS)\n    c.GOROOT = pathpkg.Clean(runtime.GOROOT())\n    c.GOPATH = envOr(&quot;GOPATH&quot;, defaultGOPATH())\n\n    // code omitted\n\n    return c\n\n}\n</code></pre>\n<p>However, when we set GOPATH using <code>go env -w GOPATH=&quot;/Users/elk/ccode/go&quot;</code> command, this value is saved only in go env, not in your system environment. So when you run the tour, since GOPATH is empty, it uses default path value, usually <code>/Users/elk/go</code>, which results in failure to find tour content.</p>\n<p>This could be because &quot;the tour of go&quot; is written in 2011, when we still need to set GOPATH environment variable at that time. But later Go improved settings, but the legacy code in tour of go did not change accordingly.</p>\n<p>So a quick solution is setting GOPATH variable in your .bashrc file. Or just <code>export GOPATH=&quot;Users/elk/ccode/go&quot;</code> in the command line for temporary use, before you run the tour program.</p>\n"}, {"tags": [], "owner": {"reputation": 846, "user_id": 4124310, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-bphVkOoEZR0/AAAAAAAAAAI/AAAAAAAAQ30/_PJ71OmLDoI/photo.jpg?sz=128", "display_name": "Evan", "link": "https://stackoverflow.com/users/4124310/evan"}, "is_accepted": false, "score": 0, "last_activity_date": 1599330671, "creation_date": 1599330671, "answer_id": 63757265, "question_id": 57686808, "link": "https://stackoverflow.com/questions/57686808/error-about-running-go-tour-localy-couldnt-find-tour-files-could-not-find-go/63757265#63757265", "title": "Error about running Go Tour localy: Couldn&#39;t find tour files: could not find go-tour content; check $GOROOT and $GOPATH", "body": "<p>Try these steps:</p>\n<ol>\n<li>set <code>GO111MODULE</code> off</li>\n</ol>\n<pre><code>   export GO111MODULE=off\n</code></pre>\n<ol start=\"2\">\n<li>make sure you are not inside the <code>$GOPATH</code> directory (if you are, just run <code>cd ~</code>)</li>\n<li>run the <code>go get</code> command</li>\n</ol>\n<pre><code>   go get golang.org/x/tour\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 15326345, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b13a1f5bd1b59539693a0cfc6406020f?s=128&d=identicon&r=PG&f=1", "display_name": "Brian Y.", "link": "https://stackoverflow.com/users/15326345/brian-y"}, "is_accepted": false, "score": 0, "last_activity_date": 1614826207, "creation_date": 1614826207, "answer_id": 66467890, "question_id": 57686808, "link": "https://stackoverflow.com/questions/57686808/error-about-running-go-tour-localy-couldnt-find-tour-files-could-not-find-go/66467890#66467890", "title": "Error about running Go Tour localy: Couldn&#39;t find tour files: could not find go-tour content; check $GOROOT and $GOPATH", "body": "<p>For anyone that encounters this issue and just wants to run the tour, you can always navigate to <code>$HOME\\go\\pkg\\mod\\golang.org\\x\\tour@version</code> and then do <code>go run .</code></p>\n"}], "owner": {"reputation": 51, "user_id": 7379755, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/947101be7fea0ab4f63b7ac449a673e3?s=128&d=identicon&r=PG", "display_name": "Martin", "link": "https://stackoverflow.com/users/7379755/martin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 829, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1614826207, "creation_date": 1566976397, "question_id": 57686808, "link": "https://stackoverflow.com/questions/57686808/error-about-running-go-tour-localy-couldnt-find-tour-files-could-not-find-go", "title": "Error about running Go Tour localy: Couldn&#39;t find tour files: could not find go-tour content; check $GOROOT and $GOPATH", "body": "<p><code>go version go1.12.9 darwin/amd64</code></p>\n\n<p>When I installed the golang.org/x/tour project, I ran the comman <code>tour</code> and got an error:</p>\n\n<pre><code>Couldn't find tour files: could not find go-tour content; check $GOROOT and $GOPATH\n</code></pre>\n\n<p>Here is my go env:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCACHE=\"/Users/elk/Library/Caches/go-build\"\nGOEXE=\"\"\nGOFLAGS=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/elk/ccode/go\"\nGOPROXY=\"https://goproxy.io\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTMPDIR=\"\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nGOMOD=\"/dev/null\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\nPKG_CONFIG=\"pkg-config\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/5d/q9dj2fxx4t71w0g5g00cvlkh0000gn/T/go-build144784202=/tmp/go-build -gno-record-gcc-switches -fno-common\"\n</code></pre>\n\n<p>I add two lines in <code>.zshrc</code> \uff1a</p>\n\n<pre><code>export GOPATH=\"$HOME/ccode/go\"\nexport PATH=\"$PATH:$GOPATH/bin\"\n</code></pre>\n\n<p>The command <code>go get golang.org/x/tour</code> was running with no error.</p>\n\n<p>The strange thing is:\n<code>echo $GOROOT</code> will display a blank line\nAnd <code>echo $GOPATH</code> is consistent with go env.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 648, "user_id": 6324924, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/qil2Y.png?s=128&g=1", "display_name": "Robert van der Spek", "link": "https://stackoverflow.com/users/6324924/robert-van-der-spek"}, "edited": false, "score": 1, "creation_date": 1566974069, "post_id": 57686176, "comment_id": 101817840, "body": "I guess for simplicity? Why would you ever want to use var in the init statement as you will allways give it an initial value. (And therefore the type can always be implicit.)"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1566979345, "post_id": 57686176, "comment_id": 101820196, "body": "Because the language spec says so."}], "answers": [{"comments": [{"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1566982887, "post_id": 57686295, "comment_id": 101822164, "body": "Close Reason: primarily opinion-based. Your answer is an opinion."}], "tags": [], "owner": {"reputation": 332774, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 3, "last_activity_date": 1566974342, "last_edit_date": 1566974342, "creation_date": 1566974037, "answer_id": 57686295, "question_id": 57686176, "link": "https://stackoverflow.com/questions/57686176/why-cant-var-be-used-in-for-loop-in-go/57686295#57686295", "title": "Why can&#39;t &#39;var&#39; be used in for loop in Go?", "body": "<p>The initialisation statement in <a href=\"https://golang.org/ref/spec#ForClause\" rel=\"nofollow noreferrer\">this form of the <code>for</code> clause</a> can't be any kind of statement but must be a <a href=\"https://golang.org/ref/spec#SimpleStmt\" rel=\"nofollow noreferrer\">\"simple statement\"</a> (one case of such statements is the <a href=\"https://golang.org/ref/spec#ShortVarDecl\" rel=\"nofollow noreferrer\">\"short variable declaration\"</a> you saw working).</p>\n\n<p>As for the reason, it's just like many other choices in the Go language: to keep your code readable and looking like the Go code of other developpers: if you could put any kind of statement here, the <code>for</code> loop wouldn't always be easily identifiable (and would mix concerns other than loop initialization). </p>\n"}], "owner": {"reputation": 307, "user_id": 8064177, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/tMFpQ.jpg?s=128&g=1", "display_name": "Saber", "link": "https://stackoverflow.com/users/8064177/saber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 1, "closed_date": 1566986463, "accepted_answer_id": 57686295, "answer_count": 1, "score": -3, "last_activity_date": 1566974342, "creation_date": 1566973394, "question_id": 57686176, "link": "https://stackoverflow.com/questions/57686176/why-cant-var-be-used-in-for-loop-in-go", "closed_reason": "Opinion-based", "title": "Why can&#39;t &#39;var&#39; be used in for loop in Go?", "body": "<p>I'm new to Go, and there is a question.</p>\n\n<p>As I know, the following two snippets are basically the same.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>i := 0\n\nvar i = 0\n</code></pre>\n\n<p>but why can't <code>var</code> statement be used in for loop? </p>\n\n<pre><code>for var i = 0; i &lt; 10; i++ {\n    //do something\n}\n</code></pre>\n\n<p>There will be a <code>syntax error: var declaration not allowed in for initializergo</code></p>\n\n<p>Why is it designed this way? Are there any thoughts in it?</p>\n\n<p>I would appreciate it if someone could tell me.</p>\n"}, {"tags": ["go", "reflection"], "answers": [{"comments": [{"owner": {"reputation": 16157, "user_id": 709537, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/093e5ff9805c50b7fbe8d4a12da66e19?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeniy Berezovsky", "link": "https://stackoverflow.com/users/709537/evgeniy-berezovsky"}, "edited": false, "score": 0, "creation_date": 1566971956, "post_id": 57685724, "comment_id": 101817119, "body": "How embarrassing - I had actually tried this function - my mistake was to pass not a pointer to struct, but a pointer to interface{} of that struct... Thanks!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1566971253, "last_edit_date": 1566971253, "creation_date": 1566970939, "answer_id": 57685724, "question_id": 57685693, "link": "https://stackoverflow.com/questions/57685693/reflectively-set-field-of-struct-that-was-passed-in-as-interface/57685724#57685724", "title": "Reflectively set field of struct that was passed in as interface{}", "body": "<p>Declare the argument as type <code>interface{}</code> as you noted.  Pass a pointer to the struct as in the last code snippet.</p>\n\n<pre><code>func SetReflectConcrete(obj interface{}, fieldName string, newValue interface{}) {\n    objElem := reflect.ValueOf(obj).Elem()\n    field := objElem.FieldByName(fieldName)\n    field.Set(reflect.ValueOf(newValue))\n}\n\nmyStruct := MyStruct{123}\nSetReflectConcrete(&amp;myStruct, \"MyField\", int32(1234))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/aIm702JtvKM\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n\n<p>The reflect value must be addressable to set a field. The value will not be addressable if created directly from a struct.</p>\n"}], "owner": {"reputation": 16157, "user_id": 709537, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/093e5ff9805c50b7fbe8d4a12da66e19?s=128&d=identicon&r=PG&f=1", "display_name": "Evgeniy Berezovsky", "link": "https://stackoverflow.com/users/709537/evgeniy-berezovsky"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 57685724, "answer_count": 1, "score": 1, "last_activity_date": 1566971253, "creation_date": 1566970779, "question_id": 57685693, "link": "https://stackoverflow.com/questions/57685693/reflectively-set-field-of-struct-that-was-passed-in-as-interface", "title": "Reflectively set field of struct that was passed in as interface{}", "body": "<p>The following works fine:</p>\n\n<pre><code>type MyStruct struct {\n    MyField int32\n}\n\nfunc SetReflectConcrete(obj *MyStruct, fieldName string, newValue interface{}) {\n    objElem := reflect.ValueOf(obj).Elem()\n    field := objElem.FieldByName(fieldName)\n    field.Set(reflect.ValueOf(newValue))\n}\n\nfunc main() {\n    myStruct := MyStruct{123}\n    SetReflectConcrete(myStruct, \"MyField\", int32{1234})\n}\n</code></pre>\n\n<p>How can I make a variant of the <code>SetReflect</code> function that works on any struct? All my attempts so far have failed. The signature would be something like this:</p>\n\n<pre><code>func SetReflectInterface(obj interface{}, fieldName string, newValue interface{})\n</code></pre>\n\n<p>And is this even possible, when calling it like</p>\n\n<pre><code>SetReflectInterface(myStruct, \"MyField\", int32{1234})\n</code></pre>\n\n<p>or would it have to be called like</p>\n\n<pre><code>SetReflectInterface(&amp;myStruct, \"MyField\", int32{1234})\n</code></pre>\n\n<p>(After all, <code>interface{}</code> has a pointer to the struct.)</p>\n"}, {"tags": ["regex", "mongodb", "go", "find", "bson"], "answers": [{"comments": [{"owner": {"reputation": 3, "user_id": 2491067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e841b7ff16d4c0be70a82031b889f814?s=128&d=identicon&r=PG", "display_name": "user2491067", "link": "https://stackoverflow.com/users/2491067/user2491067"}, "edited": false, "score": 0, "creation_date": 1567153976, "post_id": 57685401, "comment_id": 101887068, "body": "Thank you for asking my question. I want to send $and query, so could you ask me $and query??"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 3, "user_id": 2491067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e841b7ff16d4c0be70a82031b889f814?s=128&d=identicon&r=PG", "display_name": "user2491067", "link": "https://stackoverflow.com/users/2491067/user2491067"}, "edited": false, "score": 0, "creation_date": 1567172019, "post_id": 57685401, "comment_id": 101895637, "body": "Replace $or with $and."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 0, "last_activity_date": 1566968878, "creation_date": 1566968878, "answer_id": 57685401, "question_id": 57685299, "link": "https://stackoverflow.com/questions/57685299/how-to-solve-the-problem-about-filter-field-must-be-of-bson-type-object/57685401#57685401", "title": "How to solve the problem about &#39;filter&#39; field must be of BSON type object", "body": "<p>Mongodb requires a query object but you're sending an array. I suppose you wanted to do a logical-OR of the two conditions, so try this:</p>\n\n<pre><code>docs := bson.M{\"$or\": []bson.M{\n    {\"message\": bson.M{\"$regex\": bson.RegEx{`name:agent`, \"\"}}},\n    {\"message\": bson.M{\"$regex\": bson.RegEx{ip, \"\"}}}}}\n</code></pre>\n"}], "owner": {"reputation": 3, "user_id": 2491067, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e841b7ff16d4c0be70a82031b889f814?s=128&d=identicon&r=PG", "display_name": "user2491067", "link": "https://stackoverflow.com/users/2491067/user2491067"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566981247, "creation_date": 1566968284, "last_edit_date": 1566981247, "question_id": 57685299, "link": "https://stackoverflow.com/questions/57685299/how-to-solve-the-problem-about-filter-field-must-be-of-bson-type-object", "title": "How to solve the problem about &#39;filter&#39; field must be of BSON type object", "body": "<p>I want to solve this problem when called find query.</p>\n\n<p>This is running Golang, and use package \"\"gopkg.in/mgo.v2/bson\".</p>\n\n<pre><code>import \"gopkg.in/mgo.v2\"\nimport \"fmt\"\n\n    /* mongodb */\n    info := &amp;mgo.DialInfo{\n        Addrs:    []string{1.1.1.1+ \":\" + 27017},\n        Database: MgName,\n        Username: MgId,\n        Password: MgPasswd,\n    }\n\n    mgconn, err := mgo.DialWithInfo(info)\n    if err != nil {\n        fmt.Printf(\"[ERR ] mongodb : %s\\n\", err)\n        return (-1)\n    }\n\n    /* error check on every access */\n    mgconn.SetSafe(&amp;mgo.Safe{})\n\n    MgConn := mgconn.DB(MgName)\n\n    col := MgConn.C(\"test\")\n    ip := \"1.1.1.1\"\n    docs := []interface{}{\n        bson.M{\"message\": bson.M{\"$regex\": bson.RegEx{`name:agent`, \"\"}}},\n        bson.M{\"message\": bson.M{\"$regex\": bson.RegEx{ip, \"\"}}},\n    }\n\n    err := col.Find(docs).Sort(\"-time\").One(&amp;statistic)\n    if err != nil {\n        fmt.Printf(\"[INFO] mongodb select : %s\\n\", err)\n    }\n</code></pre>\n\n<p>This is the error message:</p>\n\n<pre><code>Failed to parse: filter: [ { message: { $regex: /name:agent/ } }, { \nmessage: { $regex: /192.168.18.61/ } } ]. 'filter' field must be of \nBSON type object.\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 4, "last_activity_date": 1566967125, "creation_date": 1566967125, "answer_id": 57685153, "question_id": 57685078, "link": "https://stackoverflow.com/questions/57685078/returning-struct-from-function-in-go/57685153#57685153", "title": "Returning struct from function in Go", "body": "<pre><code>func GetProject(w http.ResponseWriter, r *http.Request) {\n    params := mux.Vars(r)[\"uuid\"]\n\n    type ProjectLocation struct {\n        UUID     string `json:\"uuid\"`\n        Location string `json:\"location\"`\n        Primary  bool   `json:\"is_primary\"`\n    }\n\n    // ...\n}\n\nfunc getProjectLocations(uuid string) []ProjectLocation {\n    // ...\n}\n</code></pre>\n\n<p><code>type ProjectLocation</code> is local to <code>func GetProject</code>.</p>\n"}], "owner": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 1, "accepted_answer_id": 57685153, "answer_count": 1, "score": 0, "last_activity_date": 1566992776, "creation_date": 1566966485, "last_edit_date": 1566992776, "question_id": 57685078, "link": "https://stackoverflow.com/questions/57685078/returning-struct-from-function-in-go", "title": "Returning struct from function in Go", "body": "<p>I'm trying to return a struct from one function to another for use with an API. The function is to reduce repeating my code in other places in my API that I am developing.</p>\n\n<p>I'm getting the below error:</p>\n\n<blockquote>\n  <p>cannot use getProjectLocations(params) (type []ProjectLocation) as type []ProjectLocation in assignment</p>\n</blockquote>\n\n<p>Code below:</p>\n\n<pre><code>func GetProject(w http.ResponseWriter, r *http.Request) {\n    params := mux.Vars(r)[\"uuid\"]\n\n    type ProjectLocation struct {\n        UUID     string `json:\"uuid\"`\n        Location string `json:\"location\"`\n        Primary  bool   `json:\"is_primary\"`\n    }\n\n    type Project struct {\n        UUID           string            `json:\"uuid\"`\n        Owner          null.String       `json:\"project_owner\"`\n        Name           string            `json:\"project_name\"`\n        Locations      []ProjectLocation `json:\"locations\"`\n    }\n\n    q := `SELECT\n            p.uuid,\n            p.project_owner,\n            p.project_name,\n            p.project_type,\n            p.project_status,\n            p.created_date,\n            p.created_by,\n            p.last_modified,\n            p.last_modified_by\n        FROM\n            projects p\n        WHERE p.uuid=$1 LIMIT 1;`\n\n    rows, err := global.DB.Query(q, params)\n    global.CheckDbErr(err)\n\n    var project Project\n    for rows.Next() {\n        err = rows.Scan(\n            &amp;project.UUID,\n            &amp;project.Owner,\n            &amp;project.Name,\n        )\n        global.CheckDbErr(err)\n    }\n    project.Locations = getProjectLocations(params)\n\n    rows.Close()\n    json.NewEncoder(w).Encode(project)\n}\n\n\nfunc getProjectLocations(uuid string) []ProjectLocation {\n\n    var Locations []ProjectLocation\n    q := `SELECT uuid,location,is_primary FROM project_locations WHERE project_uuid=$1`\n    rows, err := global.DB.Query(q, uuid)\n    global.CheckDbErr(err)\n    for rows.Next() {\n        var location ProjectLocation\n        err = rows.Scan(\n            &amp;location.UUID,\n            &amp;location.Location,\n            &amp;location.Primary,\n        )\n        Locations = append(Locations, location)\n    }\n    return Locations\n}\n</code></pre>\n\n<p>I believe I'm returning a <code>[]ProjectLocation</code> struct to the get project function, so I'm just a little confused as a beginner.</p>\n"}, {"tags": ["go", "kubernetes"], "answers": [{"comments": [{"owner": {"reputation": 64, "user_id": 3277028, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f9e0983521dc87a43fb74cc7c1e83ce?s=128&d=identicon&r=PG&f=1", "display_name": "Mazout", "link": "https://stackoverflow.com/users/3277028/mazout"}, "edited": false, "score": 0, "creation_date": 1567021916, "post_id": 57684964, "comment_id": 101842276, "body": "Do you have an exemple of code? I&#39;m not able to understand"}, {"owner": {"reputation": 2086, "user_id": 7695859, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o2i_xhVzt2A/AAAAAAAAAAI/AAAAAAAAAB4/DfExOz6hJ2k/photo.jpg?sz=128", "display_name": "Emruz Hossain", "link": "https://stackoverflow.com/users/7695859/emruz-hossain"}, "reply_to_user": {"reputation": 64, "user_id": 3277028, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f9e0983521dc87a43fb74cc7c1e83ce?s=128&d=identicon&r=PG&f=1", "display_name": "Mazout", "link": "https://stackoverflow.com/users/3277028/mazout"}, "edited": false, "score": 0, "creation_date": 1567051214, "post_id": 57684964, "comment_id": 101848948, "body": "No. You can check the tests to see how clients are used: <a href=\"https://github.com/GoogleCloudPlatform/gke-managed-certs/tree/master/e2e\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/gke-managed-certs/tree/master&zwnj;&#8203;/&hellip;</a>"}], "tags": [], "owner": {"reputation": 2086, "user_id": 7695859, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o2i_xhVzt2A/AAAAAAAAAAI/AAAAAAAAAB4/DfExOz6hJ2k/photo.jpg?sz=128", "display_name": "Emruz Hossain", "link": "https://stackoverflow.com/users/7695859/emruz-hossain"}, "is_accepted": false, "score": 1, "last_activity_date": 1566965546, "creation_date": 1566965546, "answer_id": 57684964, "question_id": 57684644, "link": "https://stackoverflow.com/questions/57684644/how-to-query-kubernetes-custom-api-networking-gke-io-v1beta1-using-go-client/57684964#57684964", "title": "How to query kubernetes custom api (networking.gke.io/v1beta1) using go client?", "body": "<p>GKE networking apis and clients are in this repo : <a href=\"https://github.com/GoogleCloudPlatform/gke-managed-certs\" rel=\"nofollow noreferrer\">gke-managed-certs</a></p>\n\n<p>Clients are in this package: <a href=\"https://github.com/GoogleCloudPlatform/gke-managed-certs/tree/master/pkg/clients\" rel=\"nofollow noreferrer\">/pkg/clients</a></p>\n"}], "owner": {"reputation": 64, "user_id": 3277028, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1f9e0983521dc87a43fb74cc7c1e83ce?s=128&d=identicon&r=PG&f=1", "display_name": "Mazout", "link": "https://stackoverflow.com/users/3277028/mazout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566965546, "creation_date": 1566962838, "question_id": 57684644, "link": "https://stackoverflow.com/questions/57684644/how-to-query-kubernetes-custom-api-networking-gke-io-v1beta1-using-go-client", "title": "How to query kubernetes custom api (networking.gke.io/v1beta1) using go client?", "body": "<p>I want to play with kubernetes api with gke. But gke use a special api (networking.gke.io/v1beta1). I want to be able to query it, but the go-client of kubernetes dont have this api. How can I query it?</p>\n\n<p>I try REST API, but dont know at all how to use it, and the documentation is not clear.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": false, "score": 1, "last_activity_date": 1566956518, "creation_date": 1566956518, "answer_id": 57684054, "question_id": 57684022, "link": "https://stackoverflow.com/questions/57684022/vs-code-error-when-running-go-application/57684054#57684054", "title": "VS Code error when running go application", "body": "<p>Use <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow noreferrer\">http.HandlerFunc</a>:</p>\n\n<pre><code>router := muxinator.NewRouter()\nrouter.Get(\"/read/{serviceName}\", http.HandlerFunc(c.ReadConfig))\n</code></pre>\n\n<p>It's expecting a ServeHTTP method, but you gave it a direct function. <code>http.HandlerFunc</code> acts as a wrapper so you can use a plain function as your handler. </p>\n"}], "owner": {"reputation": 145, "user_id": 10297524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a498bff2b1b88cf0c12b446e760fa5d?s=128&d=identicon&r=PG&f=1", "display_name": "Diego Delgado", "link": "https://stackoverflow.com/users/10297524/diego-delgado"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 108, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566956518, "creation_date": 1566956251, "question_id": 57684022, "link": "https://stackoverflow.com/questions/57684022/vs-code-error-when-running-go-application", "title": "VS Code error when running go application", "body": "<p>I am new to go and I am following a tutorial online. I get this error from VS Code </p>\n\n<p>\"cannot use c.ReadConfig (type func(http.ResponseWriter, *http.Request)) as type http.Handler in argument to router.Get:\n func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)\". </p>\n\n<p>I checked the Get and Redconfig functions and they look alright. The teacher on his end does not get the error and he is able to run the Go code fine. this is the snippet in the main</p>\n\n<p>This the main function</p>\n\n<pre><code>func main() {\n    config := domain.Config{}\n\n    configService := service.ConfigService{\n        Config:   &amp;config,\n        Location: \"config.yaml\",\n    }\n\n    go configService.Watch(time.Second * 30)\n\n    c := controller.Controller{\n        Config: &amp;config,\n    }\n\n    router := muxinator.NewRouter()\n    router.Get(\"/read/{serviceName}\", c.ReadConfig)\n    log.Fatal(router.ListenAndServe(\":8080\"))\n}\n</code></pre>\n\n<p>This is the Get function </p>\n\n<pre><code>// Get returns the config for a particular service\n\nfunc (c *Config) Get(serviceName string) (map[string]interface{}, error) {\n    c.lock.RLock()\n    defer c.lock.RUnlock()\n\n    a, ok := c.config[\"base\"].(map[string]interface{})\n    if !ok {\n        return nil, fmt.Errorf(\"base config is not a map\")\n    }\n\n    // If no config is defined for the service\n    if _, ok = c.config[serviceName]; !ok {\n        // Return the base config\n        return a, nil\n    }\n\n    b, ok := c.config[serviceName].(map[string]interface{})\n    if !ok {\n        return nil, fmt.Errorf(\"service %q config is not a map\", serviceName)\n    }\n\n    // Merge the maps with the service config taking precedence\n    config := make(map[string]interface{})\n    for k, v := range a {\n        config[k] = v\n    }\n    for k, v := range b {\n        config[k] = v\n    }\n\n    return config, nil\n}\n</code></pre>\n\n<p>This is ReadConfig</p>\n\n<pre><code>// ReadConfig writes the config for the given service to the ResponseWriter\n\nfunc (c *Controller) ReadConfig(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Content-Type\", \"application/json; charset=UTF-8\")\n\n    vars := mux.Vars(r)\n    serviceName, ok := vars[\"serviceName\"]\n    if !ok {\n        w.WriteHeader(http.StatusBadRequest)\n        fmt.Fprintf(w, \"error\")\n    }\n\n    config, err := c.Config.Get(serviceName)\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        fmt.Fprintf(w, \"error\")\n    }\n\n    rsp, err := json.Marshal(&amp;config)\n    if err != nil {\n        w.WriteHeader(http.StatusInternalServerError)\n        fmt.Fprintf(w, \"error\")\n    }\n\n    w.WriteHeader(http.StatusOK)\n    fmt.Fprintf(w, string(rsp))\n}\n</code></pre>\n\n<p>What should happen is that I should be able to run and I can go to <a href=\"http://localhost:8080/read/base\" rel=\"nofollow noreferrer\">http://localhost:8080/read/base</a></p>\n"}, {"tags": ["dictionary", "go"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 4, "creation_date": 1566952552, "post_id": 57683619, "comment_id": 101813474, "body": "There&#39;s a data race on <code>db</code>.  Run the application with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a>."}, {"owner": {"reputation": 69, "user_id": 3504236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6e8829834f9aa50ebad86e702fa5a4?s=128&d=identicon&r=PG&f=1", "display_name": "atye", "link": "https://stackoverflow.com/users/3504236/atye"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566957066, "post_id": 57683619, "comment_id": 101814131, "body": "Running with &quot;go build -race&quot; isn&#39;t showing any warnings. I added mutex.Lock and defer mutex.Unlock right before the map access in both handlers which had no effect. I tried adding a sleep right before the redirection in uploadHandler but got the same problem."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1566993190, "post_id": 57684521, "comment_id": 101827804, "body": "By the way, to the OP: using the <code>q</code> formatting verb (&quot;%q&quot; in place of &quot;%v&quot; or &quot;%s&quot;) will format a double-quoted escaped string to make such difference more obvious (in this case it would show \u2026<code>EFCE\\n&quot;</code>) It also helps distinguish spaces from tabs (which would show as &#39;\\t&#39;)."}], "tags": [], "owner": {"reputation": 7910, "user_id": 1467988, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/6b79aae3b24baa468857e9414873d9b1?s=128&d=identicon&r=PG", "display_name": "novalagung", "link": "https://stackoverflow.com/users/1467988/novalagung"}, "is_accepted": true, "score": 1, "last_activity_date": 1566961601, "creation_date": 1566961601, "answer_id": 57684521, "question_id": 57683619, "link": "https://stackoverflow.com/questions/57683619/why-is-a-map-value-becoming-non-existent/57684521#57684521", "title": "Why is a map value becoming non-existent?", "body": "<p>It's because in the <code>uploadHandler</code>, the <code>id</code> variable contains newline. If we take a look closely on the log we can see it. somehow <code>Type: string</code> text is printed in the 2nd line.</p>\n\n<pre><code>2019/08/27 19:49:49 ID: BA06C157-451E-48B5-85F9-8069D9A4EFCE // &lt;-- newline\n Type: string\n2019/08/27 19:49:49 ID: BA06C157-451E-48B5-85F9-8069D9A4EFCE Type: string\n</code></pre>\n\n<p>Putting trim operation on the <code>idStr</code> should solve the problem.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>idStr := strings.TrimSpace(string(id[:]))\n</code></pre>\n"}], "owner": {"reputation": 69, "user_id": 3504236, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c6e8829834f9aa50ebad86e702fa5a4?s=128&d=identicon&r=PG&f=1", "display_name": "atye", "link": "https://stackoverflow.com/users/3504236/atye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "accepted_answer_id": 57684521, "answer_count": 1, "score": 0, "last_activity_date": 1566961601, "creation_date": 1566951896, "question_id": 57683619, "link": "https://stackoverflow.com/questions/57683619/why-is-a-map-value-becoming-non-existent", "title": "Why is a map value becoming non-existent?", "body": "<p>I am using a map to store random string keys to *os.File objects. Users will be uploading a file and I want to hold a reference to the file in a global map so I can delete it later.</p>\n\n<p>I have an http handler to process the upload and at the end, I map a random key from the OS uuidgen to \"logBundleFile\" which is type *os.File.</p>\n\n<pre><code>var db = map[string]*os.File{}\n\nfunc uploadHandler(w http.ResponseWriter, r *http.Request) {\n    r.ParseMultipartForm(5 &lt;&lt; 30)\n    file, handler, err := r.FormFile(\"file\")\n    if err != nil {\n        log.Fatalf(\"Error retrieving the file: %v\", err)\n        return\n    }\n    defer file.Close()\n\n    logBundleFile, err := ioutil.TempFile(\"\", handler.Filename)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer logBundleFile.Close()\n\n    fileBytes, err := ioutil.ReadAll(file)\n    if err != nil {\n        log.Fatalf(\"Error reading file: %v\", err)\n    }\n    logBundleFile.Write(fileBytes)\n\n    id, err := exec.Command(\"uuidgen\").Output()\n    idStr := string(id[:])\n    //id := \"1\"\n    if err != nil {\n        log.Fatal(err)\n    }\n    db[idStr] = logBundleFile\n    log.Printf(\"ID: %v Type: %T\\n\", idStr, idStr)\n    log.Printf(\"val: %v Type: %T\\n\\n\", db[idStr], db[idStr])\n    http.Redirect(w, r, fmt.Sprintf(\"/%s\", idStr), http.StatusMovedPermanently)\n}\n</code></pre>\n\n<p>Once that is done, you get redirected to this sessionHandler. It will check if the ID in the body is valid, i.e, mapped to a *os.File. The \"ok\" bool is always returning false.</p>\n\n<pre><code>func sessionHandler(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    id := vars[\"id\"]\n    log.Printf(\"ID: %v Type: %T\\n\", id, id)\n    log.Printf(\"val: %v Type: %T\\n\", db[id], db[id])\n    if val, ok := db[id]; ok {\n        w.Write([]byte(fmt.Sprintf(\"Session %s %v\", id, val)))\n    } else {\n        http.Redirect(w, r, \"/\", http.StatusMovedPermanently)\n    }\n}\n</code></pre>\n\n<p>Here is an output from the prints. In the uploadHandler, we can see that we have a string key mapped to a non-nil *os.File.</p>\n\n<p>But in the session handler, the same string key maps to a nil *os.File. I don't know what is going on.</p>\n\n<pre><code>2019/08/27 19:49:49 ID: BA06C157-451E-48B5-85F9-8069D9A4EFCE\n Type: string\n2019/08/27 19:49:49 val: &amp;{0xc000160120} Type: *os.File\n\n2019/08/27 19:49:49 ID: BA06C157-451E-48B5-85F9-8069D9A4EFCE Type: string\n2019/08/27 19:49:49 val: &lt;nil&gt; Type: *os.File\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1566956727, "post_id": 57683132, "comment_id": 101814077, "body": "Do you need to have only one client? The most straightforward way to do this is simply have a function which returns a new client object that you can use."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1566957410, "post_id": 57683132, "comment_id": 101814195, "body": "@Jesse, if you do only that, then you will leak open tcp connections"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1566957770, "post_id": 57683132, "comment_id": 101814255, "body": "Why not just close the connection, and not worry about the pool? Have you tried using <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow noreferrer\"><code>Request.Close</code></a> (or set the <code>Connection: close</code> header)?"}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1566958876, "post_id": 57683132, "comment_id": 101814446, "body": "@JimB If it&#39;s for testing purposes that may not be a concern."}, {"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1566962155, "post_id": 57683132, "comment_id": 101814919, "body": "Any of these could work. Mind adding as an answer?"}], "answers": [{"comments": [{"owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "edited": false, "score": 0, "creation_date": 1566950215, "post_id": 57683423, "comment_id": 101813142, "body": "This doesn&#39;t help because once I make a request causing a connection to <code>example.com</code>, I need that connection to go away, so that next request uses dials from scratch. However, setting <code>MaxConnsPerHost:1</code> will still reuse that one TCP connection."}], "tags": [], "owner": {"reputation": 366, "user_id": 3153830, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/WWne5.png?s=128&g=1", "display_name": "Joshua Lawson", "link": "https://stackoverflow.com/users/3153830/joshua-lawson"}, "is_accepted": false, "score": 0, "last_activity_date": 1566949916, "creation_date": 1566949916, "answer_id": 57683423, "question_id": 57683132, "link": "https://stackoverflow.com/questions/57683132/turning-off-connection-pool-for-go-http-client/57683423#57683423", "title": "Turning off connection pool for Go http.Client", "body": "<p>The http.Transport has a property called <code>MaxConnsPerHost</code></p>\n\n<blockquote>\n  <p>MaxConnsPerHost optionally limits the total number of connections per host, including connections in the dialing, active, and idle states.</p>\n</blockquote>\n\n<p>It includes the dialing, active and idle states</p>\n"}, {"tags": [], "owner": {"reputation": 1723, "user_id": 9361998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a4903f0d1b79d5499e942a376d853475?s=128&d=identicon&r=PG&f=1", "display_name": "alessiosavi", "link": "https://stackoverflow.com/users/9361998/alessiosavi"}, "is_accepted": false, "score": 3, "last_activity_date": 1580205676, "last_edit_date": 1580205676, "creation_date": 1579855322, "answer_id": 59892941, "question_id": 57683132, "link": "https://stackoverflow.com/questions/57683132/turning-off-connection-pool-for-go-http-client/59892941#59892941", "title": "Turning off connection pool for Go http.Client", "body": "<p>You need to set the <code>DisableKeepAlives</code> to <code>true</code>, and <code>MaxIdleConnsPerHost</code> to -1.</p>\n\n<p>From the documentation:</p>\n\n<pre><code>// DisableKeepAlives, if true, disables HTTP keep-alives and\n// will only use the connection to the server for a single\n// HTTP request.\n</code></pre>\n\n<p><a href=\"https://golang.org/src/net/http/transport.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/transport.go</a>, line 166 and 187</p>\n\n<p>So, your client have to be initialized as following</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>c = &amp;http.Client{\n    Transport: &amp;http.Transport{\n        DialContext: (&amp;net.Dialer{\n            Timeout:   5 * time.Second,\n        }).DialContext,\n        TLSHandshakeTimeout:   5 * time.Second,\n        ResponseHeaderTimeout: 5 * time.Second,\n        ExpectContinueTimeout: 1 * time.Second,\n        DisableKeepAlives: true,\n        MaxIdleConnsPerHost: -1\n    },\n}\n</code></pre>\n\n<p>If you are using a Go version prior than 1.7, than you need to consume all the buffer of the body and only after call the <code>request.Body.Close()</code>. Instead, if you are using a version greater or equal the 1.7, you can defer the close without additional precautions.</p>\n\n<p>Example library that has connection pooling disabled, but is still able to perform parallel requests:\n<a href=\"https://github.com/alessiosavi/Requests\" rel=\"nofollow noreferrer\">https://github.com/alessiosavi/Requests</a></p>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 2, "last_activity_date": 1586564967, "last_edit_date": 1586564967, "creation_date": 1580081273, "answer_id": 59923694, "question_id": 57683132, "link": "https://stackoverflow.com/questions/57683132/turning-off-connection-pool-for-go-http-client/59923694#59923694", "title": "Turning off connection pool for Go http.Client", "body": "<p>Connections are added to the pool in the function <a href=\"https://github.com/golang/go/blob/c333d07ebe9268efc3cf4bd68319d65818c75966/src/net/http/transport.go#L819\" rel=\"nofollow noreferrer\">Transport.tryPutIdleConn</a>.  The connection is not pooled if <a href=\"https://godoc.org/net/http#Transport.DisableKeepAlives\" rel=\"nofollow noreferrer\">Transport.DisableKeepAlives</a> is true or  <a href=\"https://godoc.org/net/http#Transport.MaxIdleConnsPerHost\" rel=\"nofollow noreferrer\">Transport.MaxIdleConnsPerHost</a> is less than zero.</p>\n\n<p>Setting either value disables pooling. The transport adds the <code>Connection: close</code> request header when DisableKeepAlives is true. This may or may not be desirable depending on what you are testing.</p>\n\n<p>Here's how to set DisableKeepAlives:</p>\n\n<pre><code>t := http.DefaultTransport.(*http.Transport).Clone()\nt.DisableKeepAlives = true\nc := &amp;http.Client{Transport: t}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/yIJLbSZ-kHg\" rel=\"nofollow noreferrer\">Run a demonstration of DisableKeepAlives = true on the playground</a>.</p>\n\n<p>Here's how to set MaxIdleConnsPerHost:</p>\n\n<pre><code>t := http.DefaultTransport.(*http.Transport).Clone()\nt.MaxIdleConnsPerHost = -1\nc := &amp;http.Client{Transport: t}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0aBzZ0fK_lZ\" rel=\"nofollow noreferrer\">Run a demonstration of MaxIdleConnsPerHost = -1 on the playground</a>.</p>\n\n<p>The code above <a href=\"https://godoc.org/net/http#Transport.Clone\" rel=\"nofollow noreferrer\">clones</a> the default transport to ensure that the default transport options are used. If you explicitly want the options in the question, then use </p>\n\n<pre><code>    c = &amp;http.Client{\n        Transport: &amp;http.Transport{\n            DialContext: (&amp;net.Dialer{\n                Timeout:   5 * time.Second,\n                KeepAlive: 5 * time.Second,\n            }).DialContext,\n            TLSHandshakeTimeout:   5 * time.Second,\n            ResponseHeaderTimeout: 5 * time.Second,\n            ExpectContinueTimeout: 1 * time.Second,\n            DisableKeepAlives: true,\n        },\n    }\n</code></pre>\n\n<p>or</p>\n\n<pre><code>    c = &amp;http.Client{\n        Transport: &amp;http.Transport{\n            DialContext: (&amp;net.Dialer{\n                Timeout:   5 * time.Second,\n                KeepAlive: 5 * time.Second,\n            }).DialContext,\n            TLSHandshakeTimeout:   5 * time.Second,\n            ResponseHeaderTimeout: 5 * time.Second,\n            ExpectContinueTimeout: 1 * time.Second,\n            MaxIdleConnsPerHost: -1,\n        },\n    }\n</code></pre>\n\n<p>MaxIdleConnsPerHost does not limit the number of active connections per host.  <a href=\"https://play.golang.org/p/6eJg0mY8ZXr\" rel=\"nofollow noreferrer\">See this playground example for a demonstration</a>.</p>\n\n<p>Pooling is not disabled by setting  <a href=\"https://godoc.org/net#Dialer.KeepAlive\" rel=\"nofollow noreferrer\">Dialer.KeepAlive</a> to -1. See <a href=\"https://stackoverflow.com/questions/59656164/what-is-the-difference-between-net-dialerkeepalive-and-http-transportidletimeo/59656223#59656223\">this answer</a> for an explanation.</p>\n"}], "owner": {"reputation": 34574, "user_id": 54929, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/2jr8M.jpg?s=128&g=1", "display_name": "AhmetB - Google", "link": "https://stackoverflow.com/users/54929/ahmetb-google"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2058, "favorite_count": 4, "accepted_answer_id": 59923694, "answer_count": 3, "score": 14, "last_activity_date": 1586564967, "creation_date": 1566946527, "last_edit_date": 1566949377, "question_id": 57683132, "link": "https://stackoverflow.com/questions/57683132/turning-off-connection-pool-for-go-http-client", "title": "Turning off connection pool for Go http.Client", "body": "<p>For testing purposes I'm trying to create a <code>net/http.Client</code> in Go that has connection pooling disabled. What I'm trying to achieve is a new TCP connection is established to the address on every HTTP/1.x request.</p>\n\n<p>Currently I have:</p>\n\n<pre><code>        c = &amp;http.Client{\n            Transport: &amp;http.Transport{\n                DialContext: (&amp;net.Dialer{\n                    Timeout:   5 * time.Second,\n                    KeepAlive: 5 * time.Second,\n                }).DialContext,\n                TLSHandshakeTimeout:   5 * time.Second,\n                ResponseHeaderTimeout: 5 * time.Second,\n                ExpectContinueTimeout: 1 * time.Second,\n            },\n        }\n</code></pre>\n\n<p>Any ideas how should I tweak this?</p>\n\n<p>I'm seeing that if I set <code>c.Transport.MaxIdleConns = 1</code> this could work, but I'm not exactly sure if this still allows 1 in-use + 1 idle (2 total) TCP connections:</p>\n\n<pre><code>    // MaxIdleConns controls the maximum number of idle (keep-alive)\n    // connections across all hosts. Zero means no limit.\n    MaxIdleConns int\n</code></pre>\n\n<p>Similarly, it seems like <code>c.Dialer.KeepAlive = -1</code> could do this, too: </p>\n\n<pre><code>    // KeepAlive specifies the keep-alive period for an active\n    // network connection.\n    // If zero, keep-alives are enabled if supported by the protocol\n    // and operating system. Network protocols or operating systems\n    // that do not support keep-alives ignore this field.\n    // If negative, keep-alives are disabled.\n</code></pre>\n\n<p>but I'm not sure about the behavior for TCP connections + Keep-Alive + HTTP.</p>\n\n<p>Another approach is to try to kill idle TCP connections as soon as possible, so I set <code>c.Transport.IdleConnTimeout = 1*time.Nanosecond</code>.</p>\n\n<p>When I did this, my <code>Client.Do()</code> now occassionally returns error:</p>\n\n<pre><code>tls: use of closed connection\n</code></pre>\n\n<p>I'm suspecting this is a Go stdlib issue (perhaps a race) that it uses a connection that should've been taken out of a pool.</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1567000897, "post_id": 57684264, "comment_id": 101832493, "body": "The first case could be simplified further to just <code>for range time.Tick(5 * time.Second) { task() }</code>."}], "tags": [], "owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "is_accepted": true, "score": 5, "last_activity_date": 1566958747, "creation_date": 1566958747, "answer_id": 57684264, "question_id": 57682902, "link": "https://stackoverflow.com/questions/57682902/run-scheduled-tasks-within-a-web-application/57684264#57684264", "title": "Run scheduled tasks within a web application", "body": "<p>Your implementation is pretty much what scheduled jobs/tasks in Go look like. There are cron-esque libraries that give you more control for tasks, but in most cases a simple goroutine with a loop is sufficient.</p>\n\n<p>Here are a few more examples in increasing complexity based on what your needs are:</p>\n\n<hr>\n\n<p>Run a task forever, waiting 5 seconds in between each run. Cannot be stopped and doesn't take into account the run time of the task. This is the simplest form and also the most common one.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>go func() {\n    for {\n        task()\n        &lt;-time.After(5 * time.Second)\n    }\n}()\n</code></pre>\n\n<hr>\n\n<p>Same as before except now there is a channel to stop the task if we ever want to. While your implementation lets you stop the task via the <code>Stop()</code> method, the goroutine will remain open since the channel is never closed (and therefore will leak memory).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Includes a channel to stop the task if needed.\nquit := make(chan bool, 1)\n\ngo func() {\n    task()\n\n    for {\n        select {\n        case &lt;-quit:\n            return\n        case &lt;-time.After(5 * time.Second):\n            task()\n        }\n    }\n}()\n\n// To stop the task\nquit &lt;- true\n</code></pre>\n\n<hr>\n\n<p>This is the most robust solution of the three. The task can be stopped at any point, and it also takes into account how long the task took to run when it waits to run it again. In the previous examples, if the task took 1 second to run, and you wait an additional 5 seconds, your interval is actually 6 seconds, relative to when the task starts.</p>\n\n<p>This solution really is only applicable to very long running tasks or if it's critical that your tasks are ran at constant intervals. If the tasks must be ran at constant intervals then you need to take into account the fact that <code>time.After()</code> will wait at LEAST the duration you provide it -- it could end up waiting slightly longer if the CPU is busy with other processes/goroutines.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Calls `fn` and then waits so the total elapsed time is `interval`\nfunc runAndWait(interval time.Duration, fn func()) {\n    earlier := time.Now()\n    fn()\n    diff := time.Now().Sub(earlier)\n    &lt;-time.After(interval - diff)\n}\n\nquit := make(chan bool, 1)\n\ngo func() {\n    // The total time to run one iteration of the task\n    interval := 5 * time.Second\n\n    for {\n        select {\n        case &lt;-quit:\n            return\n        default:\n            runAndWait(interval, task)\n        }\n    }\n}()\n</code></pre>\n"}], "owner": {"reputation": 453, "user_id": 6060482, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/6898272ab810e419c2c9ca9af1e53da8?s=128&d=identicon&r=PG", "display_name": "lennard", "link": "https://stackoverflow.com/users/6060482/lennard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 567, "favorite_count": 0, "accepted_answer_id": 57684264, "answer_count": 1, "score": 0, "last_activity_date": 1566992946, "creation_date": 1566944362, "last_edit_date": 1566992946, "question_id": 57682902, "link": "https://stackoverflow.com/questions/57682902/run-scheduled-tasks-within-a-web-application", "title": "Run scheduled tasks within a web application", "body": "<p>I want to run tasks every 5\u00a0minutes to update stats on my website without blocking the HTTP server.</p>\n\n<p>I've just added basic HTTP server logic with an example of a worker. If I added multiple tasks like this, is this considered bad practice or is there a better way?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n)\n\nfunc Home(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintf(w, \"Home page\")\n}\n\nfunc schedule(f func(), interval time.Duration) *time.Ticker {\n    ticker := time.NewTicker(interval)\n    go func() {\n        for range ticker.C {\n            f()\n        }\n    }()\n    return ticker\n}\n\nfunc longRunningTask() {\n    fmt.Println(\"Long running task\")\n}\n\nfunc main() {\n    schedule(longRunningTask, time.Second*5)\n\n    http.HandleFunc(\"/\", Home)\n    http.ListenAndServe(\"127.0.0.1:8080\", nil)\n}\n</code></pre>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1566959489, "post_id": 57682216, "comment_id": 101814531, "body": "Is there code after the goroutine call that keeps the program open? Do you have a <code>defer db.Close()</code> call that would interfere with the data fetching?"}, {"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1566973204, "post_id": 57682216, "comment_id": 101817535, "body": "@Jesse sure, all exists. Code in question was edited according to your question"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1566973472, "post_id": 57682216, "comment_id": 101817627, "body": "can you try using <code>sync.WaitGroup</code> to lock the <code>goroutines</code> before the program ends?"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1566973580, "post_id": 57682216, "comment_id": 101817659, "body": "... and why do you have <code>for {}</code>?"}, {"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "reply_to_user": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1566976042, "post_id": 57682216, "comment_id": 101818676, "body": "@kkesley  <code>for {}</code> keeps application working"}, {"owner": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1567001184, "post_id": 57682216, "comment_id": 101832685, "body": "@OlegSobchuk The <code>for {}</code> needs to be in your main function. I bet if you commented out <code>defer db.Close()</code> your issue goes away."}, {"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "reply_to_user": {"reputation": 1747, "user_id": 2896976, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3baa97daedb276fbd0cdca06d6de4d2d?s=128&d=identicon&r=PG&f=1", "display_name": "Jesse", "link": "https://stackoverflow.com/users/2896976/jesse"}, "edited": false, "score": 0, "creation_date": 1567009636, "post_id": 57682216, "comment_id": 101837485, "body": "@Jesse <code>for {}</code> is in <code>main</code> function. If I commented out <code>defer db.Close()</code> then no changes..."}, {"owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "reply_to_user": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1567010307, "post_id": 57682216, "comment_id": 101837758, "body": "@kkesley thanks <code>sync.WaitGroup</code> helped. You can add answer and I&#39;ll check it as correct. Maybe you can explain why it works with <code>sync.WaitGroup</code> and not with <code>loop</code>. Thanks"}, {"owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "edited": false, "score": 0, "creation_date": 1567031984, "post_id": 57682216, "comment_id": 101845514, "body": "Hi @OlegSobchuk, I&#39;m not sure what do you mean by <code>loop</code>. I can&#39;t see any loop in the main function. I&#39;ve answered your question. But let me know if anything is missing."}], "answers": [{"tags": [], "owner": {"reputation": 2586, "user_id": 3548468, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/U5OZO.png?s=128&g=1", "display_name": "kkesley", "link": "https://stackoverflow.com/users/3548468/kkesley"}, "is_accepted": true, "score": 2, "last_activity_date": 1567031289, "creation_date": 1567031289, "answer_id": 57700784, "question_id": 57682216, "link": "https://stackoverflow.com/questions/57682216/gorm-in-goroutines-freezes-if-large-query-limit/57700784#57700784", "title": "GORM in goroutines freezes if large query limit", "body": "<p>You need to wait for all goroutines to complete before exiting the program.</p>\n\n<pre><code>func main() {\n  ... // init DB connection etc\n  wg := sync.WaitGroup{}\n  defer db.Close()\n  wg.Add(1) // number of goroutines\n  go fetch(db, &amp;wg)\n  wg.Wait() // wait for goroutines before exiting\n}\n\nfunc fetch(db *gotm.DB, wg *sync.WaitGroup) {\n  .... // some code counts pages, creates file etc\n  sqlLimit := 20000 // set limit\n  for i := 0; i &lt; pages; i++ {\n    db.Table(\"reports_bookings\"),Debug().Where(sql).Offset(i * sqlLimit).Limit(sqlLimit).Find(&amp;myModels)\n    .... // code: push it to file\n    for {} // keeps open process\n  }\n}\n</code></pre>\n\n<p>Otherwise, your program would exit before your goroutines are finished</p>\n"}], "owner": {"reputation": 3134, "user_id": 3884750, "user_type": "registered", "accept_rate": 62, "profile_image": "https://graph.facebook.com/100003183948251/picture?type=large", "display_name": "Oleg  Sobchuk", "link": "https://stackoverflow.com/users/3884750/oleg-sobchuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "accepted_answer_id": 57700784, "answer_count": 1, "score": 1, "last_activity_date": 1570045847, "creation_date": 1566939676, "last_edit_date": 1570045847, "question_id": 57682216, "link": "https://stackoverflow.com/questions/57682216/gorm-in-goroutines-freezes-if-large-query-limit", "title": "GORM in goroutines freezes if large query limit", "body": "<p>I've decided to build service what creates CSV report.</p>\n\n<p>In use: Go 1.12, GORM (as PostgreSQL ORM)</p>\n\n<pre><code>func main() {\n  ... // init DB connection etc\n  defer db.Close()\n  go fetch(db)\n  for {} // keeps open process\n}\n\nfunc fetch(db *gotm.DB) {\n  .... // some code counts pages, creates file etc\n  sqlLimit := 20000 // set limit\n  for i := 0; i &lt; pages; i++ {\n    db.Table(\"reports_bookings\"),Debug().Where(sql).Offset(i * sqlLimit).Limit(sqlLimit).Find(&amp;myModels)\n    .... // code: push it to file\n  }\n}\n</code></pre>\n\n<p>So when code tries to fetch data it just freezes. If decrease limit and set 100 for example, it runs SQL 2 times and freezes.</p>\n\n<p><code>Debug()</code> does show nothing as well. As I told seems like it froze. One core from processor loaded.</p>\n\n<p><strong>It works Okay without goroutines. Can you help me to figure out, why it doesn't work in goroutines?</strong> </p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT</strong></p>\n\n<p>maybe my approach is bad and you can suggest, how to fix it. In the end, file should be uploaded to S3 (for example)</p>\n"}, {"tags": ["go", "kubernetes", "proto", "client-go"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1566954159, "post_id": 57681781, "comment_id": 101813706, "body": "Your overall workflow sounds pretty similar to what <a href=\"https://helm.sh\" rel=\"nofollow noreferrer\">Helm</a> does; could you use that in place of a custom tool?"}], "answers": [{"comments": [{"owner": {"reputation": 11, "user_id": 7086988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1b391b03da4e9bd952fe01aefaded4d?s=128&d=identicon&r=PG&f=1", "display_name": "Nitin Mathur", "link": "https://stackoverflow.com/users/7086988/nitin-mathur"}, "edited": false, "score": 0, "creation_date": 1567103758, "post_id": 57685430, "comment_id": 101873849, "body": "Any specific reason not to XXX_Merge? Currently I am only supporting Env variables, so this will work just fine. But the moment I start almost complete PodSpec this will become tricky. Curious why XXX_Merge function not to be used or any scenario where it should be used."}], "tags": [], "owner": {"reputation": 437, "user_id": 965002, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0595d2bfd5707fe87e0115023974eff6?s=128&d=identicon&r=PG", "display_name": "hoozecn", "link": "https://stackoverflow.com/users/965002/hoozecn"}, "is_accepted": false, "score": 0, "last_activity_date": 1566969068, "creation_date": 1566969068, "answer_id": 57685430, "question_id": 57681781, "link": "https://stackoverflow.com/questions/57681781/how-to-manipulate-kubernetes-podspec-object/57685430#57685430", "title": "How to manipulate kubernetes PodSpec object", "body": "<p>You should not use XXX_Merge. Just fill the <code>dep</code> object with user inputs. For instance:</p>\n\n<pre><code>dep.Spec.Template.Env = append(dep.Spec.Template.Env, EnvVar{Name: \"abc\", Value: \"xyz\"})\ndep.Spec.Template.Env = append(dep.Spec.Template.Env, EnvVar{Name: \"ab\", Value: \"12\"})\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 7086988, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c1b391b03da4e9bd952fe01aefaded4d?s=128&d=identicon&r=PG&f=1", "display_name": "Nitin Mathur", "link": "https://stackoverflow.com/users/7086988/nitin-mathur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 83, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1566969068, "creation_date": 1566937475, "question_id": 57681781, "link": "https://stackoverflow.com/questions/57681781/how-to-manipulate-kubernetes-podspec-object", "title": "How to manipulate kubernetes PodSpec object", "body": "<p>I am looking for some help with the golang code to modify the podspec based on user input.</p>\n\n<p>This is my flow.</p>\n\n<p>User provides an incomplete yaml file to create deployment. Assume they are missing/update environment variables information.\nUser also gives a variable foo [{name: \"abc\", value: \"xyz\"}, {name: \"ab\", value: \"12\"}] which has the environment variable information. I need to read the yaml file and merge the variable before i create the deployment.</p>\n\n<p>This is what I have figured out so far,\nRead yaml file.</p>\n\n<pre><code>decode := scheme.Codecs.UniversalDeserializer().Decode\ndata, _ := readyamlfile(file)\nobj, _, _ := decode(data, nil, nil)\ndep := obj.(*appsv1.Deployment)\n</code></pre>\n\n<p>From dep I can find the podspec. Now I need to update the object based on user input foo. Not sure if i can use XXX_Merge function or not. Please recommend and if possible provide a working example pointer of XXX_Merge function. <a href=\"https://godoc.org/k8s.io/apiserver/pkg/apis/example/v1#PodSpec.XXX_Merge\" rel=\"nofollow noreferrer\">https://godoc.org/k8s.io/apiserver/pkg/apis/example/v1#PodSpec.XXX_Merge</a></p>\n\n<p>Please let me know if there is any other way.</p>\n"}, {"tags": ["go", "testing", "grpc"], "comments": [{"owner": {"reputation": 36902, "user_id": 223424, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/e97c628a88337b15e76a4690e916a2cd?s=128&d=identicon&r=PG", "display_name": "9000", "link": "https://stackoverflow.com/users/223424/9000"}, "edited": false, "score": 0, "creation_date": 1566935383, "post_id": 57681271, "comment_id": 101809319, "body": "Isn&#39;t it because it expects <code>interface{}</code> and you are passing and returning a reference? Maybe it would match <code>*interface{}</code>? That is, implementation-wise, it <i>should</i> match a pointer, because an interface assumes a pointer, but I&#39;m not sure about syntax."}], "answers": [{"comments": [{"owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1567434890, "post_id": 57744945, "comment_id": 101953638, "body": "I understand this and I appreciate your excellent explanation as to what&#39;s going on in the underlying implementation but there is still one point of confusion for me, shouldn&#39;t any value satisfy <code>interface{}</code>? Isn&#39;t <code>req *AuthData</code> identical to <code>req interface{}</code>? Since <code>interface{}</code> is used to satisfy unknown type constraints in go I assume that those functions are in fact the same type, so I&#39;m wondering where the type error comes from"}, {"owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "reply_to_user": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 0, "creation_date": 1567477738, "post_id": 57744945, "comment_id": 101964410, "body": "@RobbieMilejczak Go is statically typed. And interfaces in Go are still types. The static type of <code>req *AuthData</code> and <code>req interface{}</code> are not the same (one is *AuthData and the other is interface{}, obviously). Say you declare a variable <code>var req interface{}</code>, you can assign value of other types to this variable, as long as they satisfy this interface (in this special case, any type would satisfy). For example, you can write <code>x := 1; req = x</code>. But this fact doesn&#39;t make <code>req</code> and <code>x</code> the same static type."}, {"owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "reply_to_user": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "edited": false, "score": 1, "creation_date": 1567477843, "post_id": 57744945, "comment_id": 101964430, "body": "Similarly, for the function <code>type UnaryHandler func(ctx context.Context, req interface{}) (interface{}, error)</code>, the fact that you can pass value of any type as the <code>req</code> argument to <code>UnaryHandler</code> doesn&#39;t make the static type interface{} identical to *AuthData. Thus we can know that the two function we have discussed are not the same static type, neither."}], "tags": [], "owner": {"reputation": 547, "user_id": 10201437, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9066621f4fa9987ca2148edc002bf057?s=128&d=identicon&r=PG&f=1", "display_name": "ConnectionLost", "link": "https://stackoverflow.com/users/10201437/connectionlost"}, "is_accepted": true, "score": 3, "last_activity_date": 1567331572, "creation_date": 1567331572, "answer_id": 57744945, "question_id": 57681271, "link": "https://stackoverflow.com/questions/57681271/spoofing-grpc-unaryhandler-for-unit-testing-grpc-in-go/57744945#57744945", "title": "Spoofing grpc UnaryHandler for unit testing gRPC in Go", "body": "<p>No, the function</p>\n\n<pre><code>GetToken(ctx context.Context, req *AuthData) (*Token, error)\n</code></pre>\n\n<p>is not of the same type as </p>\n\n<pre><code>type UnaryHandler func(ctx context.Context, req interface{}) (interface{}, error)\n</code></pre>\n\n<p>In <code>GetToken</code> the second parameter <code>req</code> is of type <code>*AuthData</code>, while in <code>UnaryHandler</code> <code>req</code> is of type <code>interface{}</code>. The returned <code>*Token</code> is not the same type as <code>interface{}</code>, neither.  This is the reason why you can't pass <code>GetToken</code> directly to the interceptor.</p>\n\n<p>In your grpc services, you would write methods like </p>\n\n<pre><code>GetToken(ctx context.Context, req *AuthData) (*Token, error)\n</code></pre>\n\n<p>as handlers to do your server works. However, it's not an <code>UnaryHandler</code> as one may think.</p>\n\n<p>Most of the transformation is done by the grpc/protobuf code generator. Base on your proto definition, it generates an interface, like this:</p>\n\n<pre><code>type XXXServer interface {\n    GetToken(ctx context.Context, req *AuthData) (*Token, error)\n}\n</code></pre>\n\n<p>You can see that it is this interface (not the UnaryHander) that your handler satisfies.</p>\n\n<p>Under the hood, if you take a look on the <code>xxx.pb.go</code> file generated, you'll find some <code>_XXX_GetToken_Handler</code> that's actually doing the handler work. In this function, an (actual) <code>UnaryHandler</code> is defined, as:</p>\n\n<pre><code>func _XXX_GetToken_Handler(srv interface{}, ctx context.Context, dec func(interface{}) error, interceptor grpc.UnaryServerInterceptor) (interface{}, error) {\n    // skip other preparations...\n    // \n    handler := func(ctx context.Context, req interface{}) (interface{}, error) {\n        return srv.(XXXServer).GetToken(ctx, req.(*AuthData))\n    }\n    return interceptor(ctx, in, info, handler)\n}\n</code></pre>\n\n<p>Inside this <code>UnaryHandler</code>, it will cast your server to the <code>XXXServer</code> interface, and then invoke your handler (your code). And that shows how the <code>interceptor</code> is called.</p>\n"}], "owner": {"reputation": 4828, "user_id": 8378419, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2772206b4d6afcbdfe7485286554190d?s=128&d=identicon&r=PG&f=1", "display_name": "Robbie Milejczak", "link": "https://stackoverflow.com/users/8378419/robbie-milejczak"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 57744945, "answer_count": 1, "score": 0, "last_activity_date": 1567331572, "creation_date": 1566934925, "question_id": 57681271, "link": "https://stackoverflow.com/questions/57681271/spoofing-grpc-unaryhandler-for-unit-testing-grpc-in-go", "title": "Spoofing grpc UnaryHandler for unit testing gRPC in Go", "body": "<p>I'm working on improving coverage for my Go gRPC server but I have run into trouble writing a test for the server's interceptor function because I'm unable to meaningfully satisfy the <code>UnaryHandler</code> type.</p>\n\n<p>I have a function <code>Interceptor</code> with the following signature:</p>\n\n<pre><code>Interceptor func(\n  ctx context.Context,\n  req interface{},\n  info *grpc.UnaryServerInfo,\n  handler grpc.UnaryHandler, // &lt;- my issue comes from here\n) (interface{}, error)\n</code></pre>\n\n<p>I assumed that any gRPC method would satisfy the signature of <code>UnaryHandler</code>:</p>\n\n<pre><code>type UnaryHandler func(ctx context.Context, req interface{}) (interface{}, error)\n</code></pre>\n\n<p>So I tried passing in a method with this signature:</p>\n\n<pre><code>GetToken(ctx context.Context, req *AuthData) (*Token, error)\n</code></pre>\n\n<p>I imagined this would work, since this is what the Interceptor is actually doing (forwarding that RPC), but for some reason Go complains:</p>\n\n<blockquote>\n  <p>cannot use authService.GetToken (type func(context.Context, *AuthData) (*Token, error)) as type grpc.UnaryHandler in argument to Interceptor</p>\n</blockquote>\n\n<p>I went ahead and wrote a dummy function that correctly satisfies:  </p>\n\n<pre><code>func genericHandler(ctx context.Context, req interface{}) (interface{}, error) {\n    return req, nil\n}\n</code></pre>\n\n<p>which is fine since I don't particularly <em>need</em> to run any specific method when testing the interceptor. However I am curious as to why the actual method doesn't satisfy the constraints because (according to my understanding) it is being passed to the Interceptor function under hood whenever I call that RPC in the wild.</p>\n\n<p>The most likely explanation is that the grpc UnaryHandler doesn't do what I'm thinking it does, but then what does it do? </p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 1757, "user_id": 4544967, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DOtWk.jpg?s=128&g=1", "display_name": "Hamza Anis", "link": "https://stackoverflow.com/users/4544967/hamza-anis"}, "edited": false, "score": 0, "creation_date": 1566932187, "post_id": 57680627, "comment_id": 101808060, "body": "Try updating the version of <code>github.com&#47;docker&#47;docker</code>."}], "answers": [{"comments": [{"owner": {"reputation": 544, "user_id": 3970258, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7df68893bf9045d5a3490307e448f807?s=128&d=identicon&r=PG&f=1", "display_name": "Sharthak Ghosh", "link": "https://stackoverflow.com/users/3970258/sharthak-ghosh"}, "edited": false, "score": 1, "creation_date": 1566968771, "post_id": 57684977, "comment_id": 101816227, "body": "For the sake of posting here I put app but it&#39;s exactly like GitHub.com/my/repo. Plus why should that even matter ? Doesn&#39;t make sense to me"}, {"owner": {"reputation": 355, "user_id": 297540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e523ed1951ef6d20f1928709bd5a3c4?s=128&d=identicon&r=PG", "display_name": "Remis B", "link": "https://stackoverflow.com/users/297540/remis-b"}, "reply_to_user": {"reputation": 544, "user_id": 3970258, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7df68893bf9045d5a3490307e448f807?s=128&d=identicon&r=PG&f=1", "display_name": "Sharthak Ghosh", "link": "https://stackoverflow.com/users/3970258/sharthak-ghosh"}, "edited": false, "score": 0, "creation_date": 1566970581, "post_id": 57684977, "comment_id": 101816700, "body": "Sorry for answer I have provided above. I see that the cause of the problem is not existing source code repository. github.com/docker/docker  url automatticaly redirects to <a href=\"https://github.com/moby/moby\" rel=\"nofollow noreferrer\">github.com/moby/moby</a> repository. Where did you get the source from?"}, {"owner": {"reputation": 544, "user_id": 3970258, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7df68893bf9045d5a3490307e448f807?s=128&d=identicon&r=PG&f=1", "display_name": "Sharthak Ghosh", "link": "https://stackoverflow.com/users/3970258/sharthak-ghosh"}, "edited": false, "score": 0, "creation_date": 1567002617, "post_id": 57684977, "comment_id": 101833612, "body": "This is the official client for docker, it&#39;s on goDoc"}, {"owner": {"reputation": 355, "user_id": 297540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e523ed1951ef6d20f1928709bd5a3c4?s=128&d=identicon&r=PG", "display_name": "Remis B", "link": "https://stackoverflow.com/users/297540/remis-b"}, "reply_to_user": {"reputation": 544, "user_id": 3970258, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7df68893bf9045d5a3490307e448f807?s=128&d=identicon&r=PG&f=1", "display_name": "Sharthak Ghosh", "link": "https://stackoverflow.com/users/3970258/sharthak-ghosh"}, "edited": false, "score": 0, "creation_date": 1567017323, "post_id": 57684977, "comment_id": 101840532, "body": "Ok. Based on information you have provided I see that documentation [<a href=\"https://docs.docker.com/develop/sdk/]\" rel=\"nofollow noreferrer\">docs.docker.com/develop/sdk/]</a> says that you have to execute <code>_go get github.com&#47;docker&#47;docker&#47;client</code> command to download it. Once library is retrieved it should compile. I have updated original answer."}], "tags": [], "owner": {"reputation": 355, "user_id": 297540, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e523ed1951ef6d20f1928709bd5a3c4?s=128&d=identicon&r=PG", "display_name": "Remis B", "link": "https://stackoverflow.com/users/297540/remis-b"}, "is_accepted": false, "score": -1, "last_activity_date": 1567017536, "last_edit_date": 1567017536, "creation_date": 1566965647, "answer_id": 57684977, "question_id": 57680627, "link": "https://stackoverflow.com/questions/57680627/cannot-find-module-providing-for-package-in-go/57684977#57684977", "title": "&quot;cannot find module providing for package&quot; in go", "body": "<p>Based on <a href=\"https://docs.docker.com/develop/sdk/\" rel=\"nofollow noreferrer\">docker documentation</a>, it says that you have to execute <code>go get github.com/docker/docker/client</code> command to download it. Once library is retrieved it should compile.</p>\n"}, {"tags": [], "owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "is_accepted": false, "score": 0, "last_activity_date": 1567044145, "creation_date": 1567044145, "answer_id": 57702028, "question_id": 57680627, "link": "https://stackoverflow.com/questions/57680627/cannot-find-module-providing-for-package-in-go/57702028#57702028", "title": "&quot;cannot find module providing for package&quot; in go", "body": "<p>I remember that I had similar problems as you 1.5-2 monthes ago.</p>\n\n<p><strong>My observations</strong>:</p>\n\n<ul>\n<li>there are a lot of versions of docker API</li>\n<li>it's hard to tell which version described in \"official\" documentation</li>\n<li>API itself flawed </li>\n<li>source code  - quite easy to understand</li>\n</ul>\n\n<p>I did not found answers for \"what actually describes official documentation?\" or  \"where actually docker API repo?\"</p>\n\n<p>I gave up on attempts to solve in \"official way\" and found that more practical to use \"unofficial\"</p>\n\n<p><strong>\"Unofficial way\"</strong>:</p>\n\n<ul>\n<li>use <a href=\"https://github.com/docker/docker-ce/tree/master/components/engine\" rel=\"nofollow noreferrer\">docker/docker-ce</a>  (note that examples from official documentation will not work without modification)</li>\n<li>instead of official documentation - just search code in <code>docker-ce</code> repo. </li>\n<li>best example of <code>docker/client</code> usage I found here: <a href=\"https://github.com/docker/docker-ce/blob/e3af8e077494c6a2b8b4f8a4a979b559825e8f7a/components/engine/integration/internal/container/exec.go#L13\" rel=\"nofollow noreferrer\">components/engine/integration/internal/container/exec.go</a> (note that it resides in <code>internal</code> and is impossible to be used as package) </li>\n<li>I grabbed code that I needed into my package and solved the problem I had</li>\n</ul>\n\n<p>Maybe it's \"incorrect\" solution but it worked for me.</p>\n\n<p>I suppose it could be more practical for you to not rely on docker documentation too.</p>\n\n<p>Good luck!</p>\n"}], "owner": {"reputation": 544, "user_id": 3970258, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/7df68893bf9045d5a3490307e448f807?s=128&d=identicon&r=PG&f=1", "display_name": "Sharthak Ghosh", "link": "https://stackoverflow.com/users/3970258/sharthak-ghosh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 450, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1567044145, "creation_date": 1566931740, "question_id": 57680627, "link": "https://stackoverflow.com/questions/57680627/cannot-find-module-providing-for-package-in-go", "title": "&quot;cannot find module providing for package&quot; in go", "body": "<p>Im trying to install the official go docker client by importing </p>\n\n<p>\"github.com/docker/docker/client\"</p>\n\n<p>But i get the following error</p>\n\n<p>cannot load github.com/docker/distribution/reference: cannot find module providing package github.com/docker/distribution/reference</p>\n\n<p>My go version is 1.12 and\nmy project is outside $GOPATH/src. My go.mod file looks like this.</p>\n\n<pre><code>module app\n\ngo 1.12\n\nrequire (\n  github.com/Microsoft/go-winio v0.4.14 // indirect\n  github.com/docker/docker v1.13.1\n  github.com/docker/go-connections v0.4.0 // indirect\n  github.com/docker/go-units v0.4.0 // indirect\n  golang.org/x/net v0.0.0-20190827160401-ba9fcec4b297 // indirect\n)\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1566930749, "post_id": 57680408, "comment_id": 101807515, "body": "As the error says, <code>Atoi</code> takes a string, <code>stn[i3]</code> is a byte. <code>strconv.Atoi(string(stn[i3]))</code> should work."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566992294, "post_id": 57680408, "comment_id": 101827276, "body": "@Adrian given that <code>str</code> is a string, I think it would be more appropriate to do <code>str[i3:i3]</code>. Of course a better implementation wouldn&#39;t bother with converting to/from strings at all."}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 0, "last_activity_date": 1567474967, "creation_date": 1567474967, "answer_id": 57764100, "question_id": 57680408, "link": "https://stackoverflow.com/questions/57680408/convert-string-to-int-in-go/57764100#57764100", "title": "Convert string to int in GO", "body": "<p>Answering the question behind the question, here's how you might convert an int into a slice of digits in go instead of using string conversions.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func digitSlice(input int) []int {\n    output := []int{}\n    for input &gt; 0 {\n        output = append([]int{input % 10}, output...)\n        input = input / 10\n    }\n    return output\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/tCLISl7Djah\" rel=\"nofollow noreferrer\">https://play.golang.org/p/tCLISl7Djah</a></p>\n"}], "owner": {"reputation": 51, "user_id": 10082594, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-G_AXQLeaZQ0/AAAAAAAAAAI/AAAAAAAAAAA/AAnnY7rBj_sTFJ_U18CezNanab9CFT3Azw/mo/photo.jpg?sz=128", "display_name": "Tommy Do", "link": "https://stackoverflow.com/users/10082594/tommy-do"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 88, "favorite_count": 0, "answer_count": 1, "score": -5, "last_activity_date": 1567474967, "creation_date": 1566930573, "question_id": 57680408, "link": "https://stackoverflow.com/questions/57680408/convert-string-to-int-in-go", "title": "Convert string to int in GO", "body": "<p>I am trying to convert a number into a slice of its digit in Go. My code is like this</p>\n\n<pre><code>    stn := strconv.Itoa(2342)\n    starr := make([]int,0)\n    for i3,_ := range stn {\n        temp,_ := strconv.Atoi(stn[i3])\n        starr = append(starr,temp )\n    }\n    fmt.Println(starr)\n</code></pre>\n\n<p>The error is: \"cannot use stn[i3] (type byte) as type string in argument to strconv.Atoi\". I am used to Python so I try to follow the idea from Python but it does not seem to work. Reall appreciate any help</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1566919777, "post_id": 57678008, "comment_id": 101802847, "body": "There is no inheritance in Go."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566919807, "post_id": 57678008, "comment_id": 101802856, "body": "@Adrian I understand Go does not have inheritance; this question is about how people achieve it otherwise."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1566919876, "post_id": 57678008, "comment_id": 101802904, "body": "Then can you clarify your question maybe? You reference inheritance repeatedly, but you say you know there&#39;s no such thing."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566919921, "post_id": 57678008, "comment_id": 101802933, "body": "@Adrian edited."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566920447, "post_id": 57678008, "comment_id": 101803206, "body": "@Tommy have you considered <i>embedding</i>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1566920791, "post_id": 57678008, "comment_id": 101803387, "body": "&quot;I want to swap out a single implementation detail of&quot; you simply cannot do that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566920909, "post_id": 57678008, "comment_id": 101803435, "body": "@Tommy ... note that (to add to my previous comment), only struct types can <i>embed</i> another type. So to be able to do what you want <code>MaxPriorityQueue</code> would have to be a struct type that embeds <code>PriorityQueue</code>, this also means that anytime you want to reference the embedded queue as a slice, e.g. in a range loop, index expression, etc. you&#39;ll have to do so by referencing the embedded slice field as opposed to the embedding struct value."}, {"owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "edited": false, "score": 0, "creation_date": 1567083156, "post_id": 57678008, "comment_id": 101863337, "body": "i see a lot of good discussion here, and question the close vote. &quot;You can&#39;t do that&quot; is an answer, and a valid one, NOT a reason to close a question."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566928473, "creation_date": 1566928473, "answer_id": 57679951, "question_id": 57678008, "link": "https://stackoverflow.com/questions/57678008/golang-question-about-interface-implementation-inheritance-stack-overflow/57679951#57679951", "title": "golang: question about interface implementation inheritance - Stack Overflow", "body": "<p>There are multiple ways you can do this. </p>\n\n<p>You can define a new type based on the original type, and delegate all methods:</p>\n\n<pre><code>type OriginalType struct {...}\n\nfunc (o OriginalType) F() {...}\n\ntype NewType OriginalType\n\nfunc (n NewType) F() { OriginalType(n).F() }\n</code></pre>\n\n<p>With this, you need to redefine all methods of the original type, as the NewType does not \"inherit\" the methods of the OriginalType.</p>\n\n<p>You can embed:</p>\n\n<pre><code>type NewType struct {\n   OldType\n}\n</code></pre>\n\n<p>Now you have a NewType.F() function, but it will operate on the OldType portion of the NewType. If you want to redeclare that, you can:</p>\n\n<pre><code>func (n NewType) F() { \n   n.OldType.F(); \n   // Do more stuff\n}\n</code></pre>\n\n<p>This will work like inheritance if you pass either instance through an interface. That is:</p>\n\n<pre><code>type IntF interface {\n   F()\n}\n\nfunc f(v IntF) {\n  v.F()\n}\n</code></pre>\n\n<p>If you pass a NewType, then NewType.F will be called. </p>\n\n<p>However, you have to pass an interface, you cannot pass the embedded struct to get the behavior of the enclosing object:</p>\n\n<pre><code>func f(v OriginalType) {\n   v.F()\n}\n\nfunc main() {\n   n:=NewType()\n   // f(n) Won't work\n   f(n.OriginalType)\n</code></pre>\n\n<p>Above, only the OriginalType part of n is sent to the function f, and OriginalType.F will be called.</p>\n"}, {"tags": [], "owner": {"reputation": 622, "user_id": 5604249, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/7bed34ebe08c34a10addbea1bf85ff17?s=128&d=identicon&r=PG&f=1", "display_name": "Pharaoh", "link": "https://stackoverflow.com/users/5604249/pharaoh"}, "is_accepted": false, "score": 0, "last_activity_date": 1566929905, "last_edit_date": 1566929905, "creation_date": 1566929577, "answer_id": 57680192, "question_id": 57678008, "link": "https://stackoverflow.com/questions/57678008/golang-question-about-interface-implementation-inheritance-stack-overflow/57680192#57680192", "title": "golang: question about interface implementation inheritance - Stack Overflow", "body": "<p>You can try something like this using composition.</p>\n\n<pre><code>type iTemp interface {\n    func1()\n    func2()\n}\n\ntype base struct {\n}\n\nfunc (base) func1() {\n    fmt.Println(\"base func1\")\n}\nfunc (base) func2() {\n    fmt.Println(\"base func2\")\n}\n\n\ntype child struct {\n    base\n}\n\nfunc (child) func1() {\n    fmt.Println(\"child func1\")\n}\n\nfunc main(){\n    printMessage(base{})\n    printMessage(child{})\n}\n\nfunc printMessage(t iTemp) {\n    t.func1()\n    t.func2()\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>base func1  \nbase func2  \nchild func1  \nbase func2  \n</code></pre>\n\n<p>Here in child struct you are providing a new implementation of func1 function of base class, but you still have access to base class implementation, you can still call it using <code>child{}.base.func1()</code></p>\n"}], "owner": {"reputation": 9564, "user_id": 743188, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/gPyaY.jpg?s=128&g=1", "display_name": "Tommy", "link": "https://stackoverflow.com/users/743188/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1567089795, "creation_date": 1566919717, "last_edit_date": 1567089795, "question_id": 57678008, "link": "https://stackoverflow.com/questions/57678008/golang-question-about-interface-implementation-inheritance-stack-overflow", "title": "golang: question about interface implementation inheritance - Stack Overflow", "body": "<p>This question is about the cleanest way to \"inherit\" interface implementations in golang. I understand Go does not have inheritance; this question is about how people achieve it otherwise, hence the quotes around inheritance.</p>\n\n<p>Let's say theres a standard library interface defined, for example <code>container/heap</code>: <a href=\"https://golang.org/pkg/container/heap/#Interface\" rel=\"nofollow noreferrer\">https://golang.org/pkg/container/heap/#Interface</a></p>\n\n<p>Lets say there's a <code>.go</code> file called <code>pq.go</code> that implements that interface:</p>\n\n<pre><code>//pq.go\nimport (\"container/heap\")\ntype PriorityQueue []*Vertex\n\nfunc (pq PriorityQueue) Len() int { return len(pq) }\n\nfunc (pq PriorityQueue) Less(i, j int) bool {\n...\n}\n\nfunc (pq PriorityQueue) Swap(i, j int) {\n...\n}\n\nfunc (pq *PriorityQueue) Push(x interface{}) {\n...\n}\n\nfunc (pq *PriorityQueue) Pop() interface{} {\n...\n}\n</code></pre>\n\n<p>Now let's say I just want a Tiny variant on this, called <code>MaxPQ</code>, in <code>maxpq.go</code>, for where I want to override a single implementation detail of <code>pq.go</code>, e.g., override <code>Less(..)</code>. How do I achieve this without literally copying the last file over, changing the type name, and changing the implementation of the single function, e.g., <code>less</code>?</p>\n\n<p>Meaning, is there a way to make a new implementation of an interface that is very similar to another?</p>\n\n<p>Doing this, literally copying it over, seems drastic and changes would need to be made in multiple places:</p>\n\n<pre><code>//maxpq.go\nimport (\"container/heap\")\ntype MaxPriorityQueue []*Vertex\n\nfunc (pq MaxPriorityQueue) Len() int { return len(pq) }\n\nfunc (pq MaxPriorityQueue) Less(i, j int) bool {\n...\n}\n\nfunc (pq MaxPriorityQueue) Swap(i, j int) {\n...\n}\n\nfunc (pq *MaxPriorityQueue) Push(x interface{}) {\n...\n}\n\nfunc (pq *MaxPriorityQueue) Pop() interface{} {\n...\n}\n</code></pre>\n"}, {"tags": ["azure", "go", "azure-sql-database"], "answers": [{"comments": [{"owner": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 0, "creation_date": 1566929817, "post_id": 57679889, "comment_id": 101807171, "body": "And do not pick Resource Owner Password Credentials flow (option 1). Your app should never be handling the user&#39;s password."}, {"owner": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 0, "creation_date": 1566929908, "post_id": 57679889, "comment_id": 101807199, "body": "You can also use a multi-tenant app, though a user will then need to give your app the necessary RBAC roles manually, or you can do it automatically by using the logged-in user&#39;s access to create the RBAC assignments."}, {"owner": {"reputation": 1873, "user_id": 11833061, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q8nQv7NqxDE/AAAAAAAAAAI/AAAAAAAAAA4/iOIUdDJ8jvk/photo.jpg?sz=128", "display_name": "Adam Marczak", "link": "https://stackoverflow.com/users/11833061/adam-marczak"}, "reply_to_user": {"reputation": 40761, "user_id": 1658906, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4e4748ed2fb97e8a8d4dd6d439625135?s=128&d=identicon&r=PG", "display_name": "juunas", "link": "https://stackoverflow.com/users/1658906/juunas"}, "edited": false, "score": 1, "creation_date": 1566933436, "post_id": 57679889, "comment_id": 101808569, "body": "Agreed. But in some rare cases ROPC is the only way, but should be avoided if possible. Otherwise ROPC wouldn&#39;t exist. Hard to say what OP is doing."}], "tags": [], "owner": {"reputation": 1873, "user_id": 11833061, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-Q8nQv7NqxDE/AAAAAAAAAAI/AAAAAAAAAA4/iOIUdDJ8jvk/photo.jpg?sz=128", "display_name": "Adam Marczak", "link": "https://stackoverflow.com/users/11833061/adam-marczak"}, "is_accepted": true, "score": 1, "last_activity_date": 1566928220, "creation_date": 1566928220, "answer_id": 57679889, "question_id": 57677966, "link": "https://stackoverflow.com/questions/57677966/authorization-for-azure-app-resource-management-without-client-id-and-client-sec/57679889#57679889", "title": "Authorization for azure app resource management without client ID and client secret", "body": "<p>In <strong>all cases</strong> of authorization flow you will need at least <strong>client id</strong>. In some you will need more like <strong>client secret</strong>.</p>\n\n<p>You can read about OAuth authorization here <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-app-types\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-app-types</a></p>\n\n<p>but in general what you are aiming for is either of two cases</p>\n\n<ol>\n<li>Authorize as user without internaction using username and password (this would be client <strong>resource owner flow</strong> \n\n<ul>\n<li><a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth-ropc\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth-ropc</a></li>\n</ul></li>\n<li>Authorize as user with his interaction \n\n<ul>\n<li>if  this is code that can't get postback URL then use <strong>device code flow</strong> <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-device-code</a></li>\n<li>or for anything in the browser use standard <strong>implicit grant flow</strong> <a href=\"https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-implicit-grant-flow\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/azure/active-directory/develop/v2-oauth2-implicit-grant-flow</a></li>\n</ul></li>\n</ol>\n\n<p>You will quickly notice that in all cases you NEED to have client ID. This is because how Azure Authentication works.</p>\n"}], "owner": {"reputation": 33, "user_id": 11984683, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-xbsiQ5bg6EE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcPgekASgAGtf6owTb4iRI29zr9jA/photo.jpg?sz=128", "display_name": "Mike N", "link": "https://stackoverflow.com/users/11984683/mike-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "accepted_answer_id": 57679889, "answer_count": 1, "score": 3, "last_activity_date": 1566928220, "creation_date": 1566919583, "question_id": 57677966, "link": "https://stackoverflow.com/questions/57677966/authorization-for-azure-app-resource-management-without-client-id-and-client-sec", "title": "Authorization for azure app resource management without client ID and client secret", "body": "<p>I'm trying to create an application where the user can manage their Azure resources (sql databases, storage). How can I authorize the  user without needing their client ID and client secret.</p>\n\n<p>I've looked at their documentation: <a href=\"https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/Azure/go-autorest/autorest/azure/auth</a>, however all of them requires environment variables and/or clientID/clientSecret. Is there a way where a user can provide username/password and I can get back an authorizer</p>\n\n<pre><code>type Client struct {\n    ServersClient postgresql.ServersClient\n}\n\nfunc NewCloudClient() *Client {\n    return &amp;Client{}\n}\n\nfunc (c *Client) Init(config map[string]string) error {\n    var (\n        subscriptionID = config[\"subscriptionID\"]\n        // tenantID       = config[\"tenantID\"]\n        // clientID       = config[\"clientID\"]\n        // clientSecret   = config[\"clientSecret\"]\n        // resourceGroup  = config[\"resourceGroup\"]\n    )\n    // oauthConfig, err := adal.NewOAuthConfig(azure.PublicCloud.ActiveDirectoryEndpoint, tenantID)\n    // if err != nil {\n    //  return errors.Wrap(err, \"error getting OAuthConfig\")\n    // }\n    // spt, err := adal.NewServicePrincipalToken(*oauthConfig, clientID, clientSecret, resourceGroup)\n    serversClient := postgresql.NewServersClient(subscriptionID)\n\n    //serversClient.BaseClient.Authorizer = autorest.NewBearerAuthorizer(spt)\n    c.ServersClient = serversClient\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566919345, "post_id": 57677885, "comment_id": 101802604, "body": "Why would your prod docker image contain any source code at all?"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566919461, "post_id": 57677885, "comment_id": 101802664, "body": "it&#39;s not, but I guess binary is going to be bigger if there is more dependencies isn&#39;t it ?"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1566919678, "post_id": 57677885, "comment_id": 101802793, "body": "No. The binary only includes packages imported (directly or transitively) from <code>main</code>."}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566919808, "post_id": 57677885, "comment_id": 101802857, "body": "Ok, wonderful, so I can include all my test dependencies, etc. at no cost. Problem solved. I will even save a docker layer"}, {"owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566922681, "post_id": 57677885, "comment_id": 101804234, "body": "@Adrian it is ok, but I can&#39;t find my binary... Do you know where it is ? I tried  $GOPATH/bin/golint but it is not here :("}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1566927648, "post_id": 57677885, "comment_id": 101806283, "body": "You did not tell after which exactly actions you failed to find the binary. All in all, adding the <code>-x</code> command-line flag to any <code>go</code> call which is supposed to compile comething usually makes that tool be explicit about what it&#39;s doing; try that."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1584042414, "creation_date": 1584042414, "answer_id": 60660970, "question_id": 57677885, "link": "https://stackoverflow.com/questions/57677885/go-get-disabled-by-mod-vendor/60660970#60660970", "title": "go get: disabled by -mod=vendor", "body": "<p><code>go get</code> maintains consistency among your dependencies' requirements, and uses the graph of <code>import</code> statements in source files to determine which packages to update.</p>\n\n<p>So <code>go get -u</code> necessarily must download at least the <code>go.mod</code> files for your dependencies, plus the source code for the requested package and <em>its</em> upgraded dependencies.</p>\n"}], "owner": {"reputation": 14185, "user_id": 1956558, "user_type": "registered", "accept_rate": 63, "profile_image": "https://i.stack.imgur.com/8D66D.jpg?s=128&g=1", "display_name": "Juliatzin", "link": "https://stackoverflow.com/users/1956558/juliatzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1896, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1584042414, "creation_date": 1566919278, "question_id": 57677885, "link": "https://stackoverflow.com/questions/57677885/go-get-disabled-by-mod-vendor", "title": "go get: disabled by -mod=vendor", "body": "<p>I'm using Go modules, and I use vendoring mode, as it speed up 2x my CI.</p>\n\n<p>I do:</p>\n\n<pre><code>go mod vendor\ngo build -mod=vendor ...\n</code></pre>\n\n<p>and I can build my app without any issue.</p>\n\n<p>But when I want to use <code>go get</code>, for instance to install <code>golint</code>:</p>\n\n<pre><code>go get -u golang.org/x/lint/golint\n</code></pre>\n\n<p>It will download all my project dependencies again, not just golint.</p>\n\n<p>If I try: </p>\n\n<pre><code>go get -mod=vendor -u golang.org/x/lint/golint\n</code></pre>\n\n<p>I get: </p>\n\n<pre><code>go get: disabled by -mod=vendor\n</code></pre>\n\n<p>Lint will be used in my dev docker image, but not in the prod one, so I don't want to add it to <code>go.mod</code></p>\n\n<p>What can I do about it ?</p>\n"}, {"tags": ["go", "time"], "comments": [{"owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "edited": false, "score": 0, "creation_date": 1566918767, "post_id": 57677523, "comment_id": 101802274, "body": "[widget_1 20:27:38.482204] my answer is supposed to look like this,  and im not sure what im doing wrong"}, {"owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "edited": false, "score": 0, "creation_date": 1566989033, "post_id": 57677523, "comment_id": 101825591, "body": "&quot;Tried many other things from fmt package,&quot; For time, the obvious place to look is the documentation for <a href=\"https://golang.org/pkg/time\" rel=\"nofollow noreferrer\">package time</a>.."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 0, "last_activity_date": 1566918228, "creation_date": 1566918228, "answer_id": 57677574, "question_id": 57677523, "link": "https://stackoverflow.com/questions/57677523/unexpected-output-when-printing-time-time/57677574#57677574", "title": "Unexpected output when printing time.Time", "body": "<p>The <code>m</code> field is the <a href=\"https://golang.org/pkg/time/#hdr-Monotonic_Clocks\" rel=\"nofollow noreferrer\">monotonic time</a>. Per the docs:</p>\n\n<blockquote>\n  <p>The canonical way to strip a monotonic clock reading is to use <code>t = t.Round(0)</code>.</p>\n</blockquote>\n\n<p>Doing so yields a time without a <code>m</code> value. The <code>+0300</code> is the time zone offset, which is part of the time value (without it, the time value would be useless, because it would have a margin of error of +/- 23 hours).</p>\n"}], "owner": {"reputation": 27, "user_id": 11193096, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_3VQ9fq8_YY/AAAAAAAAAAI/AAAAAAAACMc/riulW5dPSek/photo.jpg?sz=128", "display_name": "Justin Obanor", "link": "https://stackoverflow.com/users/11193096/justin-obanor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 33, "favorite_count": 0, "closed_date": 1566988847, "answer_count": 1, "score": -4, "last_activity_date": 1566918360, "creation_date": 1566918060, "last_edit_date": 1566918360, "question_id": 57677523, "link": "https://stackoverflow.com/questions/57677523/unexpected-output-when-printing-time-time", "closed_reason": "Duplicate", "title": "Unexpected output when printing time.Time", "body": "<p>\"I'm trying to output the values of a channel , which received values from a struct, which should be a string and time. It outputs those two, but then it includes this strange line \" +0300 +03 m=+0.001997101\" after the time.\"</p>\n\n<p>Tried many other things from fmt package, but still no help. Tried things from the time package too</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"sync\"\n    \"syscall\"\n    \"time\"\n)\n\nvar wg sync.WaitGroup\n\ntype widget struct {\n    Label string\n    Time  time.Time\n}\n\nfunc main() {\n    c := make(chan widget)\n    sc := make(chan os.Signal, 1)\n    done := make(chan bool, 1)\n\n    signal.Notify(sc, syscall.SIGINT,\n            syscall.SIGTERM,\n        syscall.SIGHUP,\n        syscall.SIGKILL,\n        syscall.SIGSEGV,\n    )\n\n    go func() {\n            sig := &lt;-sc\n        fmt.Println()\n        fmt.Println(sig)\n        done &lt;- true\n    }()\n\n    go send(c)\n    go receive(c)\n    &lt;-done\n    fmt.Println(\"Program exited\")\n\n}\n\nfunc send(p chan&lt;- widget) {\n    producer := widget{\n            \"widget_id_34\",\n        time.Now(),\n    }\n    p &lt;- producer\n}\n//where im grtting the problem from i beilieve\nfunc receive(c &lt;-chan widget) {\n    out := &lt;-c\n    fmt.Printf(\"%v\", out)\n    //fmt.Fprintln(os.Stdout, &lt;-c)\n}\n</code></pre>\n"}, {"tags": ["docker", "go", "go-modules"], "comments": [{"owner": {"reputation": 1481, "user_id": 10104472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vRksd.jpg?s=128&g=1", "display_name": "prometherion", "link": "https://stackoverflow.com/users/10104472/prometherion"}, "edited": false, "score": 1, "creation_date": 1566919046, "post_id": 57677074, "comment_id": 101802439, "body": "Tried to replicate but it worked on my Docker build:   &gt; Step 6/12 : RUN go mod download &gt; go: finding github.com/gorilla/mux v1.7.3 &gt; Step 7/12 : COPY . .  Are you sure your Docker Engine has internet access denied due to proxy settings?"}, {"owner": {"reputation": 109, "user_id": 11901987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366b46cd818a7cf27faa030449e84328?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Lucci", "link": "https://stackoverflow.com/users/11901987/rob-lucci"}, "reply_to_user": {"reputation": 1481, "user_id": 10104472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vRksd.jpg?s=128&g=1", "display_name": "prometherion", "link": "https://stackoverflow.com/users/10104472/prometherion"}, "edited": false, "score": 0, "creation_date": 1566921960, "post_id": 57677074, "comment_id": 101803914, "body": "@prometherion I don&#39;t know how to check this for sure, but I&#39;ve added <code>tcpdump -i docker0</code> output"}, {"owner": {"reputation": 596, "user_id": 1983554, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/8f5a8f555ba614299c1e0de8688d15cc?s=128&d=identicon&r=PG", "display_name": "Karl Pokus", "link": "https://stackoverflow.com/users/1983554/karl-pokus"}, "edited": false, "score": 0, "creation_date": 1589052220, "post_id": 57677074, "comment_id": 109141561, "body": "Thanks for the <code>go mod download</code> after only copying .mod and .sum I was re-fetching deps like crazy. Now the cache works."}], "answers": [{"comments": [{"owner": {"reputation": 1481, "user_id": 10104472, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vRksd.jpg?s=128&g=1", "display_name": "prometherion", "link": "https://stackoverflow.com/users/10104472/prometherion"}, "edited": false, "score": 0, "creation_date": 1566938912, "post_id": 57678855, "comment_id": 101810609, "body": "great, glad you solved :) please put a +1 on my comment since you found useful!"}], "tags": [], "owner": {"reputation": 109, "user_id": 11901987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366b46cd818a7cf27faa030449e84328?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Lucci", "link": "https://stackoverflow.com/users/11901987/rob-lucci"}, "is_accepted": false, "score": 3, "last_activity_date": 1566976135, "last_edit_date": 1566976135, "creation_date": 1566923209, "answer_id": 57678855, "question_id": 57677074, "link": "https://stackoverflow.com/questions/57677074/how-to-build-go-modules-in-docker/57678855#57678855", "title": "How to build go modules in docker?", "body": "<p>Well, thanks to @prometherion The problem was in the absence of internet access from within of docker container. <a href=\"https://stackoverflow.com/a/20431030/11901987\">This SO answer</a> worked for me. Guess that I should  create an issue in golang repo and ask to rework this error message.</p>\n"}], "owner": {"reputation": 109, "user_id": 11901987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/366b46cd818a7cf27faa030449e84328?s=128&d=identicon&r=PG&f=1", "display_name": "Rob Lucci", "link": "https://stackoverflow.com/users/11901987/rob-lucci"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 938, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1566976135, "creation_date": 1566916671, "last_edit_date": 1566921858, "question_id": 57677074, "link": "https://stackoverflow.com/questions/57677074/how-to-build-go-modules-in-docker", "title": "How to build go modules in docker?", "body": "<p>I'm trying to build my go project in the docker container.</p>\n\n<p>Here is the dockerfile:</p>\n\n<pre><code>FROM golang:1.12.9 as builder\n\nENV GO111MODULE=on\nWORKDIR /app\n\nCOPY go.mod .\nCOPY go.sum .\n\nRUN go mod download\n\nCOPY . .\n\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -o encashment\n\n\nFROM scratch\nCOPY --from=builder /app/encashment /encashment/\nEXPOSE 8080\nENTRYPOINT [\"/app/encashment\"]\n</code></pre>\n\n<p>I have only one dependency in go.mod:</p>\n\n<pre><code>require github.com/gorilla/mux v1.7.3\n</code></pre>\n\n<p>If I delete <code>gorilla/mux</code> locally and call <code>go mod download</code>, everyhing works fine. But when I call <code>docker build .</code> it returns </p>\n\n<pre><code>go: finding github.com/gorilla/mux v1.7.3\ngo: github.com/gorilla/mux@v1.7.3: unknown revision v1.7.3\ngo: error loading module requirements\n</code></pre>\n\n<p>How to make this work?<br>\n<strong>UPD:</strong> Here is the piece of tcpdump output:</p>\n\n<pre><code>19:00:00.220102 IP 172.17.0.2.43627 &gt; dns.google.domain: 15472+ A? github.com. (28)\n19:00:00.220115 IP 172.17.0.2.43627 &gt; dns.google.domain: 64629+ AAAA? github.com. (28)\n19:00:02.969391 IP 172.17.0.1.38261 &gt; 239.255.255.250.1900: UDP, length 172\n19:00:03.971322 IP 172.17.0.1.38261 &gt; 239.255.255.250.1900: UDP, length 172\n19:00:04.971794 IP 172.17.0.1.38261 &gt; 239.255.255.250.1900: UDP, length 172\n19:00:05.221952 IP 172.17.0.2.40395 &gt; dns.google.domain: 15472+ A? github.com. (28)\n19:00:05.221992 IP 172.17.0.2.40395 &gt; dns.google.domain: 64629+ AAAA? github.com. (28)\n19:00:05.970002 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:05.970263 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:05.972573 IP 172.17.0.1.38261 &gt; 239.255.255.250.1900: UDP, length 172\n19:00:06.971288 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:06.971446 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:08.972581 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:08.972736 IP 172.17.0.1.mdns &gt; 224.0.0.251.mdns: 0 PTR (QM)? _googlecast._tcp.local. (40)\n19:00:10.224125 IP 172.17.0.2.43627 &gt; dns.google.domain: 15472+ A? github.com. (28)\n19:00:10.224171 IP 172.17.0.2.43627 &gt; dns.google.domain: 64629+ AAAA? github.com. (28)\n\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 7, "creation_date": 1566915653, "post_id": 57676736, "comment_id": 101800501, "body": "Use the <code>len</code> built-in to find the length of the string and don&#39;t try to index past that index."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1566915779, "post_id": 57676736, "comment_id": 101800569, "body": "As Tim said, best is to use <code>len()</code> before indexing or slicing, to avoid out-of-range indices. If the code is out of your hands, you may use <code>recover()</code> to recover from such panics, but first try to add checks before toucing <code>recover()</code>."}, {"owner": {"reputation": 365, "user_id": 3401218, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/698ca7c1748c890a02eb6923395c1991?s=128&d=identicon&r=PG&f=1", "display_name": "hrugani", "link": "https://stackoverflow.com/users/3401218/hrugani"}, "edited": false, "score": 0, "creation_date": 1566917597, "post_id": 57676736, "comment_id": 101801617, "body": "Thank you (Tim Cooper and Icza) for your comments. The approach you put on the table is really good and simple. The treatment before to substring call because I can forecast whether the problem will occur or not."}], "answers": [{"comments": [{"owner": {"reputation": 365, "user_id": 3401218, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/698ca7c1748c890a02eb6923395c1991?s=128&d=identicon&r=PG&f=1", "display_name": "hrugani", "link": "https://stackoverflow.com/users/3401218/hrugani"}, "edited": false, "score": 0, "creation_date": 1566917915, "post_id": 57676821, "comment_id": 101801809, "body": "Thank you for your answer.  It has the same approach from the comments from Tim Cooper and Icza above. This solution is good and simple. Exactly what I wanted."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 2, "last_activity_date": 1567120031, "last_edit_date": 1567120031, "creation_date": 1566915832, "answer_id": 57676821, "question_id": 57676736, "link": "https://stackoverflow.com/questions/57676736/how-to-catch-the-slice-bounds-out-of-range-error-and-write-a-handle-for-it/57676821#57676821", "title": "How to catch the &quot;slice bounds out of range&quot; error and write a handle for it", "body": "<p>You need to do bounds checking on your indexes:</p>\n\n<pre><code>if j &gt;= 0 &amp;&amp; j &lt;= len(str) {\n   y = str[:j]\n}\n\n</code></pre>\n"}], "owner": {"reputation": 365, "user_id": 3401218, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/698ca7c1748c890a02eb6923395c1991?s=128&d=identicon&r=PG&f=1", "display_name": "hrugani", "link": "https://stackoverflow.com/users/3401218/hrugani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1125, "favorite_count": 0, "accepted_answer_id": 57676821, "answer_count": 1, "score": -3, "last_activity_date": 1567120031, "creation_date": 1566915593, "question_id": 57676736, "link": "https://stackoverflow.com/questions/57676736/how-to-catch-the-slice-bounds-out-of-range-error-and-write-a-handle-for-it", "title": "How to catch the &quot;slice bounds out of range&quot; error and write a handle for it", "body": "<p>I read other questions about the \"slice bounds of range\" here in the stackoverflow, but none of them using the same context from this.\nThen, none of the answers helped me.</p>\n\n<p>In my use case, the \"golang's syntax\" of substring using [] doesn't return an error variable. It launches a runtime error using the \"panic\" instruction.\nMy goal is to avoid to reach on the \"panic\" instruction.\nI need to treat this error and provide messages that describe with more details the context around the moment where this error had occurred.</p>\n\n<p>Obs:\nThe content of the string variable which one I need to get the substring value is totally dynamic and the indexes that I have been using to get the substring value is equally calculated dynamically.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 5, "creation_date": 1566914259, "post_id": 57676259, "comment_id": 101799678, "body": "Does <code>*routeGuideServer</code> implement <code>RouteGuideServer</code>? If so, then the code is correct and working as intended."}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1566914366, "post_id": 57676259, "comment_id": 101799746, "body": "yes, but why.. Its a <code>struct</code> not an <code>interface</code> I would expect a type error to be thrown.. It bothers me that it doesn&#39;t seem to be logically sound."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1566914533, "post_id": 57676259, "comment_id": 101799840, "body": "See <a href=\"https://tour.golang.org/methods/1\" rel=\"nofollow noreferrer\">tour.golang.org/methods/1</a> ff. And of course the language spec. Can you explain where your feeling about a missing type error are based on?"}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 0, "creation_date": 1566914930, "post_id": 57676259, "comment_id": 101800086, "body": "I think I feel this way because logically speaking type <code>struct</code> is not type <code>interface</code> and I have never transformed it into one.. so it shouldn&#39;t be able to be used as <code>interface</code>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 5, "creation_date": 1566915020, "post_id": 57676259, "comment_id": 101800132, "body": "type <code>struct</code> is not type <code>interface</code>, that&#39;s true. But that specific struct type in question <b>implements</b> (or satisfies) the specific interface type and therefore can be used whereever that interface type is expected. In Go interfaces are implemented <b>implicitly</b>, that means you don&#39;t have to ever say that struct <code>S</code> implements interface <code>I</code>. If struct <code>S</code> implements all of the methods that the interface <code>I</code> defines in its method set then <code>S</code> automatically implements <code>I</code>."}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566916339, "post_id": 57676259, "comment_id": 101800877, "body": "@mkopriva I understand! I am not going to say its not confusing why it is implemented in that way, but I do understand.  Thank you!"}], "answers": [{"comments": [{"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 0, "creation_date": 1566915045, "post_id": 57676473, "comment_id": 101800146, "body": "so it implicitly transforms my struct into an interface without my intervention? do you know where I can read about this?"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 2, "creation_date": 1566915325, "post_id": 57676473, "comment_id": 101800314, "body": "It doesn&#39;t &quot;transform&quot; the value. It passes the value to the function as an interface. As I said above, you can still get the underlying value from the interface. This  is similar to assigning an interface value to a struct. For instance, you can to this: var i RouteGuideServerInterface = &amp;routeGuideServer{}. Here, i is an interface whose value is a struct. You can find a lot of resources by searching for &quot;go interfaces&quot;, one is: <a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">gobyexample.com/interfaces</a>"}, {"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 0, "creation_date": 1566916095, "post_id": 57676473, "comment_id": 101800754, "body": "@bserdar Thank you for the explaination, and <code>var i RouteGuideServerInterface = &amp;routeGuideServer{}</code> is exactly what I would expect would be required to pass to the function.  Not having to do this seems odd.. but I suppose if the <code>struct</code> is implementing an <code>interface</code>, then in the background its recognized as a type <code>interface</code> though being a <code>struct</code>.. quite confusing"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 1, "creation_date": 1566916604, "post_id": 57676473, "comment_id": 101801037, "body": "Search for &quot;duck typing&quot;. There are lots of resources out there explaining this."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1567120039, "last_edit_date": 1567120039, "creation_date": 1566914772, "answer_id": 57676473, "question_id": 57676259, "link": "https://stackoverflow.com/questions/57676259/why-can-a-struct-be-passed-as-an-interface-to-a-function/57676473#57676473", "title": "Why can a struct be passed as an interface to a function?", "body": "<p>An <code>interface</code> defines a set of methods. Any type that has those methods \"implements\" that interface.</p>\n\n<p>In your case, you have a struct type implementing all the methods of an interface. That means values of that struct type can be used wherever such an interface is needed. When you pass a struct value to a function like you did, the complier will check if the value implements all the functions of the interface, and if it does, send the value as an interface to the function. Outside the function you have your struct value, but inside the function, you can only see the functions of that interface. You can, however, make a type assertion and recover the value of that interface:</p>\n\n<pre><code>func (f interfaceType) {\n   if k, ok := f.(myType); ok {\n      // Here, k is the value of the interface, which is of type \"myType\"\n   }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "edited": false, "score": 0, "creation_date": 1566916208, "post_id": 57676563, "comment_id": 101800817, "body": "so the <code>struct</code> would automatically be interpreted as the <code>interface</code> provided that it has the same methods.. confusing but I suppose if it works."}], "tags": [], "owner": {"reputation": 13, "user_id": 4692714, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wQ2MG.jpg?s=128&g=1", "display_name": "jiahuat", "link": "https://stackoverflow.com/users/4692714/jiahuat"}, "is_accepted": false, "score": 0, "last_activity_date": 1566915415, "last_edit_date": 1566915415, "creation_date": 1566915047, "answer_id": 57676563, "question_id": 57676259, "link": "https://stackoverflow.com/questions/57676259/why-can-a-struct-be-passed-as-an-interface-to-a-function/57676563#57676563", "title": "Why can a struct be passed as an interface to a function?", "body": "<p>This works because <code>*routeGuideServer</code> implements <code>RouteGuideServer</code>.\nIf wrongType doesn't implement <code>RouteGuideServer</code>, you'll get an error:</p>\n\n<blockquote>\n  <p>wrongType does not implement RouteGuideServer(missing \"some\" method)</p>\n</blockquote>\n\n<p><a href=\"https://gobyexample.com/interfaces\" rel=\"nofollow noreferrer\">example</a></p>\n"}], "owner": {"reputation": 753, "user_id": 3699468, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/n0DZO.jpg?s=128&g=1", "display_name": "rustysys-dev", "link": "https://stackoverflow.com/users/3699468/rustysys-dev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 78, "favorite_count": 0, "accepted_answer_id": 57676473, "answer_count": 2, "score": -3, "last_activity_date": 1567120039, "creation_date": 1566914104, "last_edit_date": 1566916503, "question_id": 57676259, "link": "https://stackoverflow.com/questions/57676259/why-can-a-struct-be-passed-as-an-interface-to-a-function", "title": "Why can a struct be passed as an interface to a function?", "body": "<p>I have some <a href=\"https://www.grpc.io/docs/tutorials/basic/go/\" rel=\"nofollow noreferrer\">example code</a> that takes an interface as an input as below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type RouteGuideServer interface {\n        ...\n}\n\nfunc RegisterRouteGuideServer(s *grpc.Server, srv RouteGuideServer) {\n    s.RegisterService(&amp;_RouteGuide_serviceDesc, srv)\n}\n</code></pre>\n\n<p>That is all fine and good, but then when implementing this server we have the following code which gives a struct (that implements the interface) to the function as below.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type routeGuideServer struct {\n        ...\n}\n\n...\n\npb.RegisterRouteGuideServer(grpcServer, &amp;routeGuideServer{})\n</code></pre>\n\n<p>I would expect that an error is thrown when given the wrong type.. why does this work? I feel that this shouldn't work?</p>\n\n<p>I would appriciate any feedback, Thanks!</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566912367, "post_id": 57675419, "comment_id": 101798501, "body": "Try <code>bson.D{{&quot;name&quot;, primitive.Regex{Pattern: &quot;^&quot;+prefix +&quot;*&quot;, Options: &quot;i&quot;}}}</code>, or <code>bson.D{{&quot;name&quot;, bson.D{{&quot;$regex&quot;, &quot;^&quot;+prefix+&quot;*&quot;}, {&quot;$options&quot;, &quot;i&quot;}}}</code>."}], "answers": [{"comments": [{"owner": {"reputation": 2062, "user_id": 2898919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df96d2d1b61c5e52c46a4ad55f5794?s=128&d=identicon&r=PG&f=1", "display_name": "FL3SH", "link": "https://stackoverflow.com/users/2898919/fl3sh"}, "edited": false, "score": 0, "creation_date": 1566913658, "post_id": 57675720, "comment_id": 101799324, "body": "Thank you, I am pretty sure that I tried sth similar. Anyway, how can I list all property to use it for search?"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1566915109, "last_edit_date": 1592644375, "creation_date": 1566912387, "answer_id": 57675720, "question_id": 57675419, "link": "https://stackoverflow.com/questions/57675419/mongodb-list-databases-with-given-prefix-in-go/57675720#57675720", "title": "MongoDB list databases with given prefix in Go", "body": "<p>Simply filter by the <code>name</code> property, which denotes the database name. And to list databases starting with a given prefix, you may use a regexp being <code>^prefix_</code>:</p>\n<pre><code>filter := bson.M{&quot;name&quot;: primitive.Regex{Pattern: &quot;^prefix_&quot;}}\n</code></pre>\n<p>Other filter options are listed on the <a href=\"https://docs.mongodb.com/manual/reference/command/listDatabases/\" rel=\"nofollow noreferrer\"><code>listDatabases</code> command</a> page:</p>\n<blockquote>\n<p>You can specify a condition on any of the fields in the output of <code>listDatabases</code>:</p>\n<ul>\n<li><code>name</code></li>\n<li><code>sizeOnDisk</code></li>\n<li><code>empty</code></li>\n<li><code>shards</code></li>\n</ul>\n</blockquote>\n<p>And you may use an empty <code>bson.M{}</code> to insert an empty document (<code>_id</code> will be added of course).</p>\n"}], "owner": {"reputation": 2062, "user_id": 2898919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10df96d2d1b61c5e52c46a4ad55f5794?s=128&d=identicon&r=PG&f=1", "display_name": "FL3SH", "link": "https://stackoverflow.com/users/2898919/fl3sh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1166, "favorite_count": 0, "accepted_answer_id": 57675720, "answer_count": 1, "score": 2, "last_activity_date": 1566915109, "creation_date": 1566911316, "last_edit_date": 1592644375, "question_id": 57675419, "link": "https://stackoverflow.com/questions/57675419/mongodb-list-databases-with-given-prefix-in-go", "title": "MongoDB list databases with given prefix in Go", "body": "<h1>Question</h1>\n<p>How can I list databases only with the given prefix (<code>prefix_</code>)?</p>\n<h1>Example:</h1>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n  &quot;context&quot;\n  &quot;fmt&quot;\n  &quot;go.mongodb.org/mongo-driver/bson&quot;\n  &quot;go.mongodb.org/mongo-driver/mongo&quot;\n  &quot;go.mongodb.org/mongo-driver/mongo/options&quot;\n  &quot;log&quot;\n)\n\ntype foo struct {\n  Value string\n}\n\nfunc main() {\n  clientOptions := options.Client().ApplyURI(&quot;mongodb://10.0.12.76:27018&quot;)\n  client, err := mongo.Connect(context.TODO(), clientOptions)\n  if err != nil {\n    log.Fatal(err)\n  }\n  db := [3]string{&quot;prefix_foo&quot;, &quot;prefix_bar&quot;, &quot;bar&quot;}\n\n  for _, element := range db {\n    _, err := client.Database(element).Collection(&quot;placeholder&quot;).InsertOne(context.TODO(), foo{&quot;sth&quot;})\n    if err != nil {\n      log.Fatal(err)\n    }\n  }\n\n  filter := bson.D{{}}\n\n  dbs, err := client.ListDatabaseNames(context.TODO(), filter)\n  if err != nil {\n    log.Fatal(err)\n  }\n  fmt.Printf(&quot;%+v\\n&quot;, dbs)\n}\n</code></pre>\n<h1>Output:</h1>\n<p><code>[admin bar config local prefix_bar prefix_foo]</code></p>\n<h1>Expected output:</h1>\n<p><code>[prefix_bar prefix_foo]</code></p>\n<h1>Bonus:</h1>\n<ol>\n<li>It is possible to create a database without defining new <code>struct</code> in my case <code>foo</code>?</li>\n<li>My goal is to run a query on databases only with a prefix, so maybe better solution exists than listing dbs and then run a query on each database?</li>\n</ol>\n"}, {"tags": ["docker", "go", "tcp", "centos"], "comments": [{"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "edited": false, "score": 0, "creation_date": 1566915238, "post_id": 57673267, "comment_id": 101800264, "body": "need more details about your docker container creation. like Port mapping etc."}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "reply_to_user": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "edited": false, "score": 0, "creation_date": 1566915541, "post_id": 57673267, "comment_id": 101800443, "body": "@BillyYuan updated"}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "edited": false, "score": 0, "creation_date": 1566915983, "post_id": 57673267, "comment_id": 101800688, "body": "so\uff0cwhere is 8082\uff1f"}, {"owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "reply_to_user": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "edited": false, "score": 0, "creation_date": 1566916320, "post_id": 57673267, "comment_id": 101800872, "body": "@BillyYuan it doesn&#39;t matter, just a mistype. The issue is on mac everything is work with <code>curl 172.17.0.1:8082&#47;status</code>, but at the server, not 172.17.0.1, not public ip doesn&#39;t work."}, {"owner": {"reputation": 784, "user_id": 10737552, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee6d7fb0cd2e5fb9e1daa3282b25f876?s=128&d=identicon&r=PG&f=1", "display_name": "Billy Yuan", "link": "https://stackoverflow.com/users/10737552/billy-yuan"}, "edited": false, "score": 0, "creation_date": 1566922888, "post_id": 57673267, "comment_id": 101804319, "body": "it seems like the port map issue\uff0ccheck firewall setting of your vps"}], "answers": [{"tags": [], "owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "is_accepted": true, "score": 4, "last_activity_date": 1566993794, "creation_date": 1566993794, "answer_id": 57691985, "question_id": 57673267, "link": "https://stackoverflow.com/questions/57673267/how-to-fix-dial-tcp-i-o-timeout-while-calling-public-address-in-docker-container/57691985#57691985", "title": "How to fix dial tcp i/o timeout while calling public address in docker container?", "body": "<p>The problem was triggered by 2 issues.\nFirst, containers must be in the same network. And the second one, when containers are in the same network, calls to each other must be with the property container name host. For example: </p>\n\n<pre><code>$ docker ps -a\nCONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS                              NAMES\n9c6c31b8ec21        user-ms             \"./user-ms run\"          3 minutes ago       Up 3 minutes             8080/tcp, 0.0.0.0:9980-&gt;9980/tcp   user-ms\n13863218f942        finance-ms          \"./finance-ms run\"       3 minutes ago       Up 3 minutes             0.0.0.0:9982-&gt;9982/tcp             finance-ms\n</code></pre>\n\n<p>That's mean, what curl and all other calls from container <code>user-ms</code> to <code>finance-ms</code> must be with <code>finance-ms:9982</code> address.</p>\n"}], "owner": {"reputation": 197, "user_id": 9076478, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/FrXue.jpg?s=128&g=1", "display_name": "Mykhailo Tkachenko", "link": "https://stackoverflow.com/users/9076478/mykhailo-tkachenko"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3934, "favorite_count": 0, "accepted_answer_id": 57691985, "answer_count": 1, "score": 6, "last_activity_date": 1578928821, "creation_date": 1566903672, "last_edit_date": 1578928821, "question_id": 57673267, "link": "https://stackoverflow.com/questions/57673267/how-to-fix-dial-tcp-i-o-timeout-while-calling-public-address-in-docker-container", "title": "How to fix dial tcp i/o timeout while calling public address in docker container?", "body": "<p>I'm setting up a new container 'A' which is calling some endpoints from container 'B'. Why are these calls always return <code>dial tcp 116.2.153.48:8082: i/o timeout</code>?</p>\n\n<p>The call from container 'A' is using public IP. All containers are deployed on the CentOS 7. Every container has own network with own database in this network. Also, the call which returns error works fine from any REST-API client, such Postman.\nNameservers in resolv.conf file has been changed to google's 8.8.8.8 and 8.8.4.4</p>\n\n<p>Error: <code>error=\"Post http://116.2.153.48:8082/new_user?email=eto@email.com: dial tcp 116.203.153.48:8082: i/o timeout\"</code></p>\n\n<p>Call from the program: </p>\n\n<pre><code>req, err := http.NewRequest(http.MethodPost, fmt.Sprintf(\"http://116.2.153.48:8082/new_user?email=%s\", user.Email), nil)\n    if err != nil {\n        return err\n    }\n    httpClient := &amp;http.Client{}\n    resp, err := httpClient.Do(req)\n    if err != nil {\n        return err\n    }\n</code></pre>\n\n<p><strong>UPD:</strong></p>\n\n<p>Docker-compose of the first container:</p>\n\n<pre><code>\n  payment-ms:\n    container_name: payment-ms\n    build:\n      context: .\n      dockerfile: Dockerfile\n    environment:\n      - DB_HOST=payment-ms-db\n    ports:\n      - 8082:8082\n\n</code></pre>\n\n<p>Docker-compose file of the second container:</p>\n\n<pre><code>user-ms:\n    container_name: user-ms\n    build:\n      context: .\n      dockerfile: Dockerfile\n    environment: \n      - DB_HOST=user-ms-db\n    ports: \n      - 8080:8080\n    depends_on:\n      user-ms-db:\n        condition: service_healthy\n</code></pre>\n\n<p>Also, on my local machine with MacOS everything works fine, problem reproducing only on VPS with CentOS7.</p>\n"}, {"tags": ["go", "homebrew"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1566909313, "post_id": 57672733, "comment_id": 101796637, "body": "If you install 1.12.7 while 1.12.9 is current you are doing it wrong anyway."}], "answers": [{"tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": true, "score": 3, "last_activity_date": 1566907847, "creation_date": 1566907847, "answer_id": 57674404, "question_id": 57672733, "link": "https://stackoverflow.com/questions/57672733/unable-to-install-specific-version-of-go-on-mac-with-homebrew/57674404#57674404", "title": "Unable to install specific version of go on mac with homebrew", "body": "<p>There is no \"simple way\". </p>\n\n<p>By default <code>brew</code> allows you set only last <em>patch</em> version for go1.12, because of <a href=\"https://github.com/Homebrew/homebrew-core/blob/df2816f89ba3afca571c737f674dba0476748593/Formula/go.rb\" rel=\"nofollow noreferrer\">formula file</a> (right now it is 1.12.9).</p>\n\n<p>But you can do it manually.</p>\n\n<pre><code>:~$ cd \"$(brew --repo homebrew/core)\"\n:~$ git log --oneline Formula/go.rb # To see all old versions\n:~$ git reset --hard go1.12.7\nHEAD is now at fa46027fe go: update 1.12.7 bottle.\n\n:~$ HOMEBREW_NO_AUTO_UPDATE=1 brew install go@1.12\n==&gt; Downloading https://homebrew.bintray.com/bottles/go-1.12.7.mojave.bottle.tar.gz\n</code></pre>\n"}], "owner": {"reputation": 560, "user_id": 1974137, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/50a1a180963d83ad9c5af5b2dbeb9d55?s=128&d=identicon&r=PG", "display_name": "ashwinbhy", "link": "https://stackoverflow.com/users/1974137/ashwinbhy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1386, "favorite_count": 1, "accepted_answer_id": 57674404, "answer_count": 1, "score": 0, "last_activity_date": 1566927962, "creation_date": 1566901818, "last_edit_date": 1566927962, "question_id": 57672733, "link": "https://stackoverflow.com/questions/57672733/unable-to-install-specific-version-of-go-on-mac-with-homebrew", "title": "Unable to install specific version of go on mac with homebrew", "body": "<p>i am trying to install go lang version 1.12.7 with</p>\n\n<pre><code>brew install go@1.12.7\n</code></pre>\n\n<p>but its saying formula is wrong.\nAny help would be appreciated.</p>\n"}, {"tags": ["go", "apache-kafka", "kafka-consumer-api"], "answers": [{"tags": [], "owner": {"reputation": 880, "user_id": 11033447, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-5Rnw0TpRiTA/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQMI20zIr_quZYjqIjKzfUUcxqHcWA/mo/photo.jpg?sz=128", "display_name": "Yannick", "link": "https://stackoverflow.com/users/11033447/yannick"}, "is_accepted": false, "score": 0, "last_activity_date": 1566905401, "creation_date": 1566905401, "answer_id": 57673734, "question_id": 57672407, "link": "https://stackoverflow.com/questions/57672407/schedule-creation-of-consumer-in-kafka-using-kafka-go/57673734#57673734", "title": "Schedule creation of consumer in Kafka using kafka-go", "body": "<p>You should not have a coupled producer/consumer, Kafka let you have totally decoupled producer / consumer.</p>\n\n<p>You can run your consumer even if the topic does not exists ( Kafka will create it, you'll just get an leader unavailable warning ), and run your producer whenever you want.</p>\n\n<p>Regarding scaling, the idea is that you create as many partition as you might want your topic to be scaled ( in number of consumers).</p>\n\n<p>Here is some reading about topic partition strategy:\n<a href=\"https://blog.newrelic.com/engineering/effective-strategies-kafka-topic-partitioning/\" rel=\"nofollow noreferrer\">https://blog.newrelic.com/engineering/effective-strategies-kafka-topic-partitioning/</a></p>\n\n<p>You have lot of readings about this on the web. </p>\n\n<p>Yannick </p>\n"}], "owner": {"reputation": 3, "user_id": 11983127, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AAuE7mDrZAbQnmVJgalHSIbghe3v8MUPaGaw-jYGkxzi=k-s128", "display_name": "Suraj Singh", "link": "https://stackoverflow.com/users/11983127/suraj-singh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 46, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566905401, "creation_date": 1566900698, "question_id": 57672407, "link": "https://stackoverflow.com/questions/57672407/schedule-creation-of-consumer-in-kafka-using-kafka-go", "title": "Schedule creation of consumer in Kafka using kafka-go", "body": "<p>I am new to kafka and currently working on it. I am using kafka-go in golang to create producer and consumer. Currently i am able to create a producer but i want consumer to be created once a producer of a topic is created and not every time. means for each topic, a consumer is created only once. Also, when there is a need of creating more consumer for a topic to balance load, it gets created. Is there any way to schedule that, either through goroutines or Faktory?</p>\n"}, {"tags": ["sql", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566889596, "post_id": 57669174, "comment_id": 101786287, "body": "What does <i>&quot;it fails&quot;</i> or <i>&quot;not working&quot;</i> mean? Are you getting an error? If so, please include that error in your question. Are you getting a result different from what you expect? If so, please include the expected and the actual result in the question."}, {"owner": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566889714, "post_id": 57669174, "comment_id": 101786339, "body": "@mkopriva i&#39;m expecting when i do the queryrow it to save RequestedBy as a null in the database and not to save it as  &quot;&quot; ( which fails with my schema)"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566889895, "post_id": 57669174, "comment_id": 101786428, "body": "Then do not use <code>null.String</code> but implement your own custom type. Since in json an empty string <code>&quot;&quot;</code> is not the same as <code>null</code>, the behaviour of <code>null.String</code> is correct. So if your requirements are different from what <code>null.String</code> supports then simply do not use it."}], "answers": [{"comments": [{"owner": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "edited": false, "score": 0, "creation_date": 1566891632, "post_id": 57669685, "comment_id": 101787219, "body": "Thankyou for first solution was perfect. I&#39;ve tried to implement it for null.time but im a bit lost on that too could you possible tell me how to do that one too?  func (ns *MyNullTime) UnmarshalJSON(data []byte) error { \tif err := ns.Time.UnmarshalJSON(data); err != nil { \t\treturn err \t} \tns.Valid = len(ns.Time.Time) &gt; 0 // if empty, set as valid=false \treturn nil } dosent seem to work"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "reply_to_user": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "edited": false, "score": 0, "creation_date": 1566892407, "post_id": 57669685, "comment_id": 101787552, "body": "@Trentfrompunchbowl1 I&#39;ve added an update to the answer, try it and let me know if it works because I haven&#39;t tested it or anything."}, {"owner": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "edited": false, "score": 1, "creation_date": 1566892736, "post_id": 57669685, "comment_id": 101787716, "body": "@mkoprive works like a charm and thanks again for your help.... my brain has melted all day from trying to figure out what i was doing wrong"}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 2, "last_activity_date": 1566892738, "last_edit_date": 1566892738, "creation_date": 1566890947, "answer_id": 57669685, "question_id": 57669174, "link": "https://stackoverflow.com/questions/57669174/golang-null-string-decoding-not-working-correctly/57669685#57669685", "title": "golang null.String decoding not working correctly", "body": "<p>If you want to treat empty strings as nulls you have at least two options.</p>\n\n<p>\"Extend\" <code>null.String</code>:</p>\n\n<pre><code>type MyNullString struct {\n    null.String\n}\n\nfunc (ns *MyNullString) UnmarshalJSON(data []byte) error {\n    if string(data) == `\"\"` {\n        ns.Valid = false\n        return nil\n    }\n    ns.String.UnmarshalJSON(data)\n}\n</code></pre>\n\n<p>Or use <code>NULLIF</code> in the query:</p>\n\n<pre><code>INSERT INTO workorders (\n    uuid\n    , work_date\n    , requested_by\n) VALUES (\n    $1\n    , $2\n    , NULLIF($3, '')\n)\nRETURNING uuid\n</code></pre>\n\n<hr>\n\n<p><strong>Update</strong>:</p>\n\n<p>To extend the <code>null.Time</code> you have to understand that the type of <a href=\"https://github.com/guregu/null/blob/v3.4.0/time.go#L14\" rel=\"nofollow noreferrer\"><code>null.Time.Time</code></a> is a <em>struct</em>. The builtin <a href=\"https://golang.org/pkg/builtin/#len\" rel=\"nofollow noreferrer\"><code>len</code></a> function works on slices, arrays, pointers to arrays, maps, channels, and strings. Not structs. So in this case you can check the <code>data</code> argument, which is a byte slice, by converting it to a string and comparing it to a string that <em>contains</em> an empty string, i.e. it has two double quotes and nothing else.</p>\n\n<pre><code>type MyNullTime struct {\n    null.Time\n}\n\nfunc (ns *MyNullTime) UnmarshalJSON(data []byte) error {\n    if string(data) == `\"\"` {\n        ns.Valid = false\n        return nil\n    }\n    return ns.Time.UnmarshalJSON(data)\n}\n</code></pre>\n"}], "owner": {"reputation": 77, "user_id": 11263304, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/afdc4543cfba8068b12318925c1c8b44?s=128&d=identicon&r=PG&f=1", "display_name": "Trentfrompunchbowl1", "link": "https://stackoverflow.com/users/11263304/trentfrompunchbowl1"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 657, "favorite_count": 0, "accepted_answer_id": 57669685, "answer_count": 1, "score": 1, "last_activity_date": 1587796872, "creation_date": 1566889013, "last_edit_date": 1566889658, "question_id": 57669174, "link": "https://stackoverflow.com/questions/57669174/golang-null-string-decoding-not-working-correctly", "title": "golang null.String decoding not working correctly", "body": "<p>Trying to fix this problem i'm having with my api im building.</p>\n\n<p>db:</p>\n\n<pre><code>DROP TABLE IF EXISTS contacts CASCADE;\nCREATE TABLE IF NOT EXISTS contacts (\n        uuid UUID UNIQUE PRIMARY KEY,\n        first_name varchar(150),\n);\n\n\n\nDROP TABLE IF EXISTS workorders CASCADE;\nCREATE TABLE IF NOT EXISTS workorders (\n        uuid UUID UNIQUE PRIMARY KEY,\n        work_date timestamp WITH time zone,\n        requested_by UUID REFERENCES contacts (uuid) ON UPDATE CASCADE ON DELETE CASCADE,\n\n);\n</code></pre>\n\n<p>struct:</p>\n\n<p><a href=\"https://gopkg.in/guregu/null.v3\" rel=\"nofollow noreferrer\">https://gopkg.in/guregu/null.v3</a></p>\n\n<pre><code>type WorkorderNew struct {\n    UUID               string      `json:\"uuid\"`\n    WorkDate           null.Time   `json:\"work_date\"`\n    RequestedBy        null.String `json:\"requested_by\"`\n}\n</code></pre>\n\n<p>api code:</p>\n\n<pre><code>workorder := &amp;models.WorkorderNew{}\nif err := json.NewDecoder(r.Body).Decode(workorder); err != nil {\n    log.Println(\"decoding fail\", err)\n}\n// fmt.Println(NewUUID())\nu2, err := uuid.NewV4()\nif err != nil {\n    log.Fatalf(\"failed to generate UUID: %v\", err)\n}\n\nq := `\n            INSERT\n            INTO workorders\n                (uuid,\n                work_date,\n                requested_by\n                )\n            VALUES\n                ($1,$2,$3)\n            RETURNING uuid;`\n\nstatement, err := global.DB.Prepare(q)\nglobal.CheckDbErr(err)\n\nfmt.Println(\"requested by\", workorder.RequestedBy)\n\nlastInsertID := \"\"\nerr = statement.QueryRow(\n    u2,\n    workorder.WorkDate,\n    workorder.RequestedBy,\n).Scan(&amp;lastInsertID)\nglobal.CheckDbErr(err)\n\njson.NewEncoder(w).Encode(lastInsertID)\n</code></pre>\n\n<p>When I send an API request with null as the value it works as expected\nbut when i try to send a \"\" as the value for the null.String or the null.Time it fails </p>\n\n<p>works:</p>\n\n<pre><code>{  \n   \"work_date\":\"2016-12-16T19:00:00Z\",\n   \"requested_by\":null\n}\n</code></pre>\n\n<p>not working:</p>\n\n<pre><code>{  \n   \"work_date\":\"2016-12-16T19:00:00Z\",\n   \"requested_by\":\"\"\n}\n</code></pre>\n\n<p>Basically when i call the QueryRow and save to database the workorder.RequestedBy value should be a null and not the \"\" value im getting\nthanks</p>\n"}, {"tags": ["mongodb", "go", "mongo-go"], "owner": {"reputation": 21, "user_id": 2780768, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7b6c6a5739daa2db57a7ec34f7889081?s=128&d=identicon&r=PG&f=1", "display_name": "X-MT", "link": "https://stackoverflow.com/users/2780768/x-mt"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 907, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1566894637, "creation_date": 1566879889, "last_edit_date": 1566894637, "question_id": 57667653, "link": "https://stackoverflow.com/questions/57667653/how-to-use-interface-type-as-a-model-in-mongo-go-driver", "title": "How to use interface type as a model in mongo-go-driver?", "body": "<pre class=\"lang-golang prettyprint-override\"><code>package code_test\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"testing\"\n)\n\ntype Data struct {\n    Type   int32   `bson:\"Type\"`\n    IValue IGetter `bson:\"IValue\"`\n}\n\nfunc (m *Data) UnmarshalBSON(b []byte) error {\n    tempData := &amp;struct {\n        Type int32 `bson:\"Type\"`\n    }{}\n    err := bson.Unmarshal(b, tempData)\n    if err != nil {\n        fmt.Println(\"A\", err)\n    }\n    switch tempData.Type {\n    case 100:\n        reallyData := &amp;struct {\n            Type   int32    `bson:\"Type\"`\n            IValue *AGetter `bson:\"IValue\"`\n        }{}\n        err = bson.Unmarshal(b, reallyData)\n        m.Type = reallyData.Type\n        m.IValue = reallyData.IValue\n    }\n\n    return nil\n}\n\ntype IGetter interface {\n    Get() string\n    MarshalBSON() ([]byte, error)\n}\n\ntype AGetter struct {\n    DataA string\n}\n\nfunc (m *AGetter) Get() string {\n    return \"AGetter\" + m.DataA\n}\nfunc (m *AGetter) MarshalBSON() ([]byte, error) {\n    t := &amp;struct {\n        DataA string\n    }{\n        DataA: m.DataA,\n    }\n    return bson.Marshal(t)\n    //return bson.Marshal(m)\n}\n\nfunc TestD(t *testing.T) {\n    {\n        data := &amp;Data{\n            Type: 100,\n            IValue: &amp;AGetter{\n                DataA: \"aaa\",\n            },\n        }\n        byteData, err := bson.Marshal(data)\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        var after = &amp;Data{}\n        err = bson.Unmarshal(byteData, after)\n        fmt.Printf(\"%s\\n\", Stringify(after))\n    }\n}\n\n\nfunc Stringify(o interface{}) string {\n    //data, err := json.MarshalIndent(o, \"\", \"  \")\n    data, err := json.Marshal(o)\n    if err != nil {\n        //xlog.Error(err)\n        return err.Error()\n    }\n    return string(data)\n}\n</code></pre>\n\n<p>this code work success. </p>\n\n<p><strong>but i don't want to write MarshalBSON function.</strong></p>\n\n<p>just like in mgo driver: <a href=\"https://stackoverflow.com/questions/26039580/how-to-use-interface-type-as-a-model-in-mgo-go\">How to use interface type as a model in mgo (Go)?</a></p>\n\n<p><strong>It seems only UnmarshalBSON function is necessary.</strong> </p>\n\n<p>But when I remove MarshalBSON in mongo-go-driver, I got an error <strong>\"no encoder found for code_test.IGetter\"</strong></p>\n\n<hr>\n\n<p>before find a good solution, I use this code to solve the problem...</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package mongo_test_test\n\nimport (\n    \"fmt\"\n    mgoBson \"github.com/globalsign/mgo/bson\"\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"testing\"\n    \"xkit\"\n)\n\ntype Data struct {\n    Type   int32   `bson:\"Type\"`\n    IValue IGetter `bson:\"IValue\"`\n}\n\nfunc (m *Data) UnmarshalBSON(b []byte) error {\n    tempData := &amp;struct {\n        Type int32 `bson:\"Type\"`\n    }{}\n    err := bson.Unmarshal(b, tempData)\n    if err != nil {\n        fmt.Println(\"A\", err)\n    }\n    switch tempData.Type {\n    case 100:\n        reallyData := &amp;struct {\n            Type   int32    `bson:\"Type\"`\n            IValue *AGetter `bson:\"IValue\"`\n        }{}\n        err = bson.Unmarshal(b, reallyData)\n        m.Type = reallyData.Type\n        m.IValue = reallyData.IValue\n    }\n\n    return nil\n}\nfunc (m *Data) MarshalBSON() ([]byte, error) {\n    return mgoBson.Marshal(m)\n}\n\ntype IGetter interface {\n    Get() string\n}\n\ntype AGetter struct {\n    DataA string\n}\n\nfunc (m *AGetter) Get() string {\n    return \"AGetter\" + m.DataA\n}\n\nfunc TestD(t *testing.T) {\n    {\n        data := &amp;Data{\n            Type: 100,\n            IValue: &amp;AGetter{\n                DataA: \"aaa\",\n            },\n        }\n        byteData, err := bson.Marshal(data)\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        var after = &amp;Data{}\n        err = bson.Unmarshal(byteData, after)\n        fmt.Printf(\"%s\\n\", xkit.Stringify(after))\n    }\n}\n\n</code></pre>\n"}, {"tags": ["go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 1240, "user_id": 1788496, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7efebd4721a49a49058e243f01d1dd9a?s=128&d=identicon&r=PG", "display_name": "mgrenier", "link": "https://stackoverflow.com/users/1788496/mgrenier"}, "edited": false, "score": 0, "creation_date": 1566948365, "post_id": 57667125, "comment_id": 101812862, "body": "I tried using the index action as mentioned in my original post but it didn&#39;t work, tried it again tonight and it did. Not sure what I did wrong last night but all is good now thanks."}], "tags": [], "owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "is_accepted": true, "score": 3, "last_activity_date": 1566911014, "last_edit_date": 1566911014, "creation_date": 1566874332, "answer_id": 57667125, "question_id": 57666867, "link": "https://stackoverflow.com/questions/57666867/passing-index-of-array-to-template/57667125#57667125", "title": "Passing Index of Array to Template", "body": "<p>You need the <code>index</code> action, you can read more about it in <a href=\"https://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow noreferrer\">the documentation</a>. Here is a working example:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n    \"os\"\n    \"text/template\"\n)\n\ntype Inventory struct {\n    Material []string\n    Count    uint\n}\n\nfunc main() {\n    sweaters := Inventory{[]string{\"wool\"}, 17}\n    tmpl, err := template.New(\"test\").Parse(\"{{.Count}} items are made of {{index .Material 0}}\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = tmpl.Execute(os.Stdout, sweaters)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/6k0R5HYWcmb\" rel=\"nofollow noreferrer\">Go Playground</a></p>\n"}, {"comments": [{"owner": {"reputation": 1240, "user_id": 1788496, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7efebd4721a49a49058e243f01d1dd9a?s=128&d=identicon&r=PG", "display_name": "mgrenier", "link": "https://stackoverflow.com/users/1788496/mgrenier"}, "edited": false, "score": 0, "creation_date": 1566948371, "post_id": 57667443, "comment_id": 101812864, "body": "I tried using the index action as mentioned in my original post but it didn&#39;t work, tried it again tonight and it did. Not sure what I did wrong last night but all is good now thanks."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566877778, "creation_date": 1566877778, "answer_id": 57667443, "question_id": 57666867, "link": "https://stackoverflow.com/questions/57666867/passing-index-of-array-to-template/57667443#57667443", "title": "Passing Index of Array to Template", "body": "<p>Here's another example:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"text/template\"\n)\n\n\nfunc main() {\n    data:=map[string]interface{}{ \"item\": []interface{}{\"str1\",\"str2\"}}\n    tmpl, _ := template.New(\"test\").Parse(`Some text\n{{define \"mytp\"}}\n{{.}}\n{{end}}\n\n{{template \"mytp\" index .item 0}}`)\n\n    tmpl.Execute(os.Stdout, data)\n}\n</code></pre>\n"}], "owner": {"reputation": 1240, "user_id": 1788496, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/7efebd4721a49a49058e243f01d1dd9a?s=128&d=identicon&r=PG", "display_name": "mgrenier", "link": "https://stackoverflow.com/users/1788496/mgrenier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 100, "favorite_count": 0, "accepted_answer_id": 57667125, "answer_count": 2, "score": 0, "last_activity_date": 1566948099, "creation_date": 1566871661, "last_edit_date": 1566948099, "question_id": 57666867, "link": "https://stackoverflow.com/questions/57666867/passing-index-of-array-to-template", "title": "Passing Index of Array to Template", "body": "<p>How can I pass the index of an array to a template?\nI know I can do something like this to access the first element:</p>\n\n<pre><code>{{ with index . 0 }}\n</code></pre>\n\n<p>but I need to do something like this:</p>\n\n<pre><code>{{ template \"mytemp\" index . 0 }}\n</code></pre>\n\n<p>which doesn't seem to work. I also tried this which didn't work:</p>\n\n<pre><code>{{ with index . 0 }}\n  {{ template \"mytemp\" . }}\n{{ end }}\n</code></pre>\n\n<p>I can't seem to figure out how to achieve this.</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 165, "user_id": 5404881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZBPKs.jpg?s=128&g=1", "display_name": "jrcichra", "link": "https://stackoverflow.com/users/5404881/jrcichra"}, "edited": false, "score": 0, "creation_date": 1566865608, "post_id": 57666288, "comment_id": 101781267, "body": "Thanks. That makes sense now. VSCode did not suggest the ()&#39;s, I was thinking it was a static member of that type/class, so for the life of me I wouldn&#39;t have seen this."}], "tags": [], "owner": {"reputation": 311, "user_id": 11972391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f1e6c78a40c69940c82bf775558db2?s=128&d=identicon&r=PG&f=1", "display_name": "cafster", "link": "https://stackoverflow.com/users/11972391/cafster"}, "is_accepted": true, "score": 3, "last_activity_date": 1566865352, "creation_date": 1566865352, "answer_id": 57666288, "question_id": 57666204, "link": "https://stackoverflow.com/questions/57666204/go-sql-driver-mysql-inserting-a-float64-into-mariadb-double-column-gives-uns/57666288#57666288", "title": "go-sql-driver/mysql - inserting a float64 into mariadb (double column) gives unsupported type func() float64, a func", "body": "<p>It appears that you are passing a first class function <code>func() float64</code> instead of an actual float64 primitive. The source of this function looks to be <code>r.rtt.Seconds</code>, which should be invoked as <code>r.rtt.Seconds()</code>. See <a href=\"https://golang.org/pkg/time/#Duration.Seconds\" rel=\"nofollow noreferrer\">Duration.Seconds</a>.</p>\n"}], "owner": {"reputation": 165, "user_id": 5404881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ZBPKs.jpg?s=128&g=1", "display_name": "jrcichra", "link": "https://stackoverflow.com/users/5404881/jrcichra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 57666288, "answer_count": 1, "score": 0, "last_activity_date": 1566865352, "creation_date": 1566864370, "question_id": 57666204, "link": "https://stackoverflow.com/questions/57666204/go-sql-driver-mysql-inserting-a-float64-into-mariadb-double-column-gives-uns", "title": "go-sql-driver/mysql - inserting a float64 into mariadb (double column) gives unsupported type func() float64, a func", "body": "<p>I am new to Go I just started learning it a few days ago for the concurrency :-). I have a different library that returns a time.Duration type, which has Seconds, a float64 precision value I'd like to use and store in a database.</p>\n\n<p>Here are relevant bits and pieces to what I'm trying to accomplish:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type pResp struct {\n    address string\n    rtt     time.Duration\n    sent    int\n    recv    int\n}\n\nstmt, err := db.Prepare(\"insert pings set domain = ?, packet_rtt = ?, packets_sent = ?, packets_recv = ?\")\nres, err := stmt.Exec(r.address, r.rtt.Seconds, r.sent, r.recv)\n</code></pre>\n\n<p>This is the error I get:</p>\n\n<pre><code>2019/08/26 19:57:35 sql: converting argument $2 type: unsupported type func() float64, a func\nProcess exiting with code: 0\n</code></pre>\n\n<p>The column in MySQL is set to double, which should be 64 bits... I am not sure where I am going wrong here. Is this a limitation of the library I am using? Thanks.</p>\n"}, {"tags": ["variables", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1566859402, "post_id": 57665616, "comment_id": 101780167, "body": "FYI, <code>x := make([]T, 0)</code> can usually be replaced with <code>var x []T</code>."}], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": -1, "last_activity_date": 1567120054, "last_edit_date": 1567120054, "creation_date": 1566858762, "answer_id": 57665673, "question_id": 57665616, "link": "https://stackoverflow.com/questions/57665616/refer-to-variables-in-go-using-the-data-in-other-variables/57665673#57665673", "title": "Refer to variables in go using the data in other variables?", "body": "<p>You can do something like this:</p>\n\n<pre><code>var selected *[]int\nswitch strings.ToLower(set) {\n  case \"a\": selected = &amp;a\n  ...\n}\n*selected = append(*selected, num)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 3, "last_activity_date": 1566862635, "creation_date": 1566862635, "answer_id": 57666054, "question_id": 57665616, "link": "https://stackoverflow.com/questions/57665616/refer-to-variables-in-go-using-the-data-in-other-variables/57666054#57666054", "title": "Refer to variables in go using the data in other variables?", "body": "<p>This sounds like the general description of a <em>string-keyed map</em>: you have three values, and you want to choose which one to use based on some string value.</p>\n\n<pre><code>maps := map[string][]int{}\n\nset := input.Ask(\"Which set would you like to input to:\")\nset = strings.toLower(set)\nfor true {\n    num := input.Ask(\"Number:\")\n    maps[set] = append(maps[set], num)\n}\n</code></pre>\n\n<p>If it's important to you to only be able to use one of these three values, you can prepopulate the map</p>\n\n<pre><code>maps := map[string][]int{\n    \"a\": nil,\n    \"b\": nil,\n    \"c\": nil,\n}\nset := input.Ask(\"Which set would you like to input to (a, b, or c):\")\nset = strings.toLower(set)\nif _, ok := maps[set]; !ok {\n    fmt.Println(\"I don't know about that set\")\n    return\n}\n</code></pre>\n\n<p>There's <a href=\"https://golang.org/ref/spec#Map_types\" rel=\"nofollow noreferrer\">more information on maps in the language spec</a>.</p>\n"}], "owner": {"reputation": 13, "user_id": 5950871, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/370af0b629a16ead8863d12cf64db856?s=128&d=identicon&r=PG&f=1", "display_name": "Mark Muchane", "link": "https://stackoverflow.com/users/5950871/mark-muchane"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 47, "favorite_count": 0, "accepted_answer_id": 57666054, "answer_count": 2, "score": -3, "last_activity_date": 1567120054, "creation_date": 1566858272, "question_id": 57665616, "link": "https://stackoverflow.com/questions/57665616/refer-to-variables-in-go-using-the-data-in-other-variables", "title": "Refer to variables in go using the data in other variables?", "body": "<p>I am relatively new to go/ coding.I want to be able to reference a variable by using a variable.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var a = make([]int,0)\nvar b = make([]int,0)\nvar c = make([]int,0)\n</code></pre>\n\n<p>I have some slices defined</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>set := input.Ask(\"Which set would you like to input to (a, b, c):\")\nfor true {\n  num := input.Ask(\"Number:\")\n  strings.toLower(set) = append(strings.toLower(set), num)\n}\n</code></pre>\n\n<p>I want the \"strings.tolower\" part output a string, which it does, that will allow me to select one of the variables I have defined.</p>\n"}, {"tags": ["postgresql", "go", "data-structures", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "edited": false, "score": 0, "creation_date": 1566921732, "post_id": 57667175, "comment_id": 101803816, "body": "Thank you, that&#39;s definitely something I needed to know about the gorm model! I edited the code and updated stores, that was a mistake. However, I&#39;m still confused as to why the stores model has a user_id and store_id that gets added? And, if gorm.Model adds an ID, how do I access the ID from my user?"}, {"owner": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "edited": false, "score": 0, "creation_date": 1566922436, "post_id": 57667175, "comment_id": 101804120, "body": "I removed &#39;gorm.Model&#39; and I still have user_id and store_id added after recreating my database."}, {"owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "reply_to_user": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "edited": false, "score": 0, "creation_date": 1566928868, "post_id": 57667175, "comment_id": 101806794, "body": "@RobertPelican because you defined a many 2 many relations in users. gorm takes care of that automatically it will add custom keys by him self. You can read more about it in <a href=\"https://gorm.io/docs/many_to_many.html#Self-Referencing\" rel=\"nofollow noreferrer\">here</a>"}, {"owner": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "edited": false, "score": 0, "creation_date": 1566937474, "post_id": 57667175, "comment_id": 101810125, "body": "Thanks! I&#39;ll add that to my answer!"}], "tags": [], "owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "is_accepted": false, "score": 4, "last_activity_date": 1566874767, "creation_date": 1566874767, "answer_id": 57667175, "question_id": 57665370, "link": "https://stackoverflow.com/questions/57665370/automigrate-in-gorm-database-adds-unwanted-fields-to-sql-table/57667175#57667175", "title": "Automigrate in GORM database adds unwanted fields to SQL table", "body": "<p>This is what <code>gorm.Model</code> looks like</p>\n\n<pre><code>type Model struct {\n  ID        uint `gorm:\"primary_key\"`\n  CreatedAt time.Time\n  UpdatedAt time.Time\n  DeletedAt *time.Time\n}\n</code></pre>\n\n<p>When we call <code>gorm.Model</code> inside a struct, it means we are add default fields of  <code>gorm.Model</code> in  our current struct.</p>\n\n<pre><code>type Stores struct {\n    gorm.Model\n....\n</code></pre>\n\n<p>so your user model will look something like </p>\n\n<pre><code>ype User struct {\n    ID        uint `gorm:\"primary_key\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt *time.Time\n    ID int `json:\"u_id\"`\n    Name string `json:\"u_name\"`\n    Stores []Store `gorm:\"many2many:stores;\" json:\"stores\"`\n}\n</code></pre>\n\n<p>that error mayne due to duplicate primary_key key. try to rename  <code>ID int</code>json:\"u_id\"`` to <code>UserID</code>. you need to update <code>Stores</code> too.</p>\n"}, {"tags": [], "owner": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "is_accepted": true, "score": 0, "last_activity_date": 1566937533, "last_edit_date": 1566937533, "creation_date": 1566923187, "answer_id": 57678852, "question_id": 57665370, "link": "https://stackoverflow.com/questions/57665370/automigrate-in-gorm-database-adds-unwanted-fields-to-sql-table/57678852#57678852", "title": "Automigrate in GORM database adds unwanted fields to SQL table", "body": "<p>Fixed the duplicate ID errors by removing gorm.Model, as @(Akshaydeep Girl) pointed out what having gorm.Model entails. As for the random 'user_id' and 'store_id' that kept automatically being added, they were being added because of the many2many gorm relationship. I was able to remove those by switching the order of migration.</p>\n\n<pre><code>func DBMigrate(db *gorm.DB) *gorm.DB {\n    db.AutoMigrate(&amp;Store{})\n    db.AutoMigrate(&amp;User{})\n    return db\n}\n</code></pre>\n\n<p>When I dropped both tables and re-compiled/ran my project with the new order of migration, the stores table was created without the random 'user_id' and 'store_id', and the users table didn't have those either.</p>\n"}], "owner": {"reputation": 61, "user_id": 9895395, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/853e9e44b7dd046542e85b99f8345862?s=128&d=identicon&r=PG&f=1", "display_name": "Robert Pelican", "link": "https://stackoverflow.com/users/9895395/robert-pelican"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1145, "favorite_count": 0, "accepted_answer_id": 57678852, "answer_count": 2, "score": 0, "last_activity_date": 1566937533, "creation_date": 1566856134, "last_edit_date": 1566921628, "question_id": 57665370, "link": "https://stackoverflow.com/questions/57665370/automigrate-in-gorm-database-adds-unwanted-fields-to-sql-table", "title": "Automigrate in GORM database adds unwanted fields to SQL table", "body": "<p>When I create my tables in the gorm database, it adds columns to the table that I don't want. I'm not sure how it's adding these extra fields. This causes me to run into an error that says, \"pq: null value in column \"user_id\" violates not-null constraint\". \"user_id\" is the unwanted column that gets added. I'm using gorm and postgreSQL.</p>\n\n<p>I have a many to many relationship for my two tables. My first table is created properly and my second table, stores, is created with the provided fields plus two unwanted fields: \"user_id\" and \"stores_id\". I've tried removing the many to many relationship to see if that was the issue, I've tried dropping the tables and recreating them with different fields. Regardless, I have not been able to get rid of the two extra columns.</p>\n\n<p>The first (working) table:</p>\n\n<pre><code>type User struct {\n    gorm.Model\n    ID int `json:\"u_id\"`\n    Name string `json:\"u_name\"`\n    Stores []Store `gorm:\"many2many:stores;\" json:\"stores\"`\n}\n</code></pre>\n\n<p>When I execute '\\d users', I get the following columns: id, created_at, updated_at, deleted_at, name.</p>\n\n<p>The second (problematic) table:</p>\n\n<pre><code>type Stores struct {\n    gorm.Model\n    ID int `json:\"s_id\"`\n    NUM int `gorm:\"unique\" json:\"s_num\"`\n    Users []User `gorm:\"many2many:user\" json:\"users\"`\n}\n</code></pre>\n\n<p>When I execute '\\d' stores, I get the following columns: user_id, vehicle_id, id, created_at, updated_at, deleted_at, num.</p>\n\n<p>I'm executing the creation of these tables through the following code:</p>\n\n<pre><code>db.AutoMigrate(&amp;User{})\ndb.AutoMigrate(&amp;Store{})\n</code></pre>\n\n<p>On another note, if I add <code>gorm:\"primary_key\";auto_increment\"</code> to my ID values in my structs, I get the error \"pq: column \"user_id\" appears twice in primary key constraint\". I was able to get around this by removing the primary_key and auto_increment attributes, running AutoMigrate() and then adding it back in and running AutoMigrate() again - this was totally fine and working.</p>\n\n<p>I've also tried manually inserting a user_id and store_id. This works fine, except that I'd have to generate new ones every time because they require uniqueness. I understand that the error \"pq: null value in column \"user_id\" violates not-null constraint\" is caused by the fact that I'm not providing a user_id or store_id when I'm creating my store. I'm simply confused why a user_id and store_id column is being generated at all, and I'm hoping I can fix that.</p>\n"}, {"tags": ["go", "gorp"], "answers": [{"tags": [], "owner": {"reputation": 1152, "user_id": 4786944, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/eb18930f3400e1851acfe1239c113816?s=128&d=identicon&r=PG", "display_name": "CallMeLoki", "link": "https://stackoverflow.com/users/4786944/callmeloki"}, "is_accepted": false, "score": 0, "last_activity_date": 1566895169, "creation_date": 1566895169, "answer_id": 57670746, "question_id": 57665357, "link": "https://stackoverflow.com/questions/57665357/go-scanner-still-returns-nil/57670746#57670746", "title": "Go Scanner still returns &lt;nil&gt;", "body": "<p>the scan function would be called on passed value type to <code>dbmap.Select()</code> so in your case, you need to implement <code>Dashboard</code> as <code>scanner</code>.</p>\n"}], "owner": {"reputation": 233, "user_id": 2096859, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/6e091f1a6f32dd41d6ebd4be01f28530?s=128&d=identicon&r=PG&f=1", "display_name": "Vardens Archangel", "link": "https://stackoverflow.com/users/2096859/vardens-archangel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 66, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566895169, "creation_date": 1566856071, "question_id": 57665357, "link": "https://stackoverflow.com/questions/57665357/go-scanner-still-returns-nil", "title": "Go Scanner still returns &lt;nil&gt;", "body": "<p>first of all: I am totally newbie in golang, so I may not understand well.\nI am tasked to write a Go data extractor from one database using \"gorp\". The problem is with one table, that has custom field \"TimeRange\".\nIt is defined as:</p>\n\n<pre><code>type TimeRange struct {\n    From string\n    To  string\n}\n</code></pre>\n\n<p>Sadly when I try to fetch row I am getting scanner error, so I realised I need a custom scanner.</p>\n\n<pre><code>// Scan - Implement the database/sql scanner interface\nfunc (tr *TimeRange) Scan(value interface{}) error {\n    tr.From = \"mis\"\n    tr.To = \"lala\"\n    fmt.Printf(\"%v\\n\", *tr)\n\n    return nil\n}\n</code></pre>\n\n<p>So I expect to see fixed '{mis lala}' in returned string.\nWhy I am getting:</p>\n\n<pre><code>var q2 []models.Dashboard\nresult, err := dbmap.Select(&amp;q2, \"select * from dashboard where id=3\")\nfmt.Printf(\"q2=%v\\n\", q2)\n</code></pre>\n\n<p>prints:</p>\n\n<pre><code>p2=[{{&lt;nil&gt; Tomek b1f6f0ba-f618-00d6-6d24-8410a9219c95}}]\n</code></pre>\n\n<p>which is:\nTimeRange, UserName and UUID</p>\n\n<p>Might be important: using \"gorp\" for DB managment</p>\n"}, {"tags": ["go", "anonymous-struct"], "comments": [{"owner": {"reputation": 308, "user_id": 1729496, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9b1818f25bed9eb4148d2d3c732e1c1f?s=128&d=identicon&r=PG", "display_name": "Omnomnious", "link": "https://stackoverflow.com/users/1729496/omnomnious"}, "edited": false, "score": 0, "creation_date": 1566914010, "post_id": 57665092, "comment_id": 101799529, "body": "Why was I downvoted?"}], "answers": [{"tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": false, "score": 3, "last_activity_date": 1566854998, "creation_date": 1566854998, "answer_id": 57665175, "question_id": 57665092, "link": "https://stackoverflow.com/questions/57665092/does-whether-or-not-a-field-is-exported-inside-an-anonymous-struct-make-any-diff/57665175#57665175", "title": "Does whether or not a field is exported inside an anonymous struct make any difference?", "body": "<blockquote>\n  <p>Does exporting (or not exporting) a field in an anonymous struct in golang make any difference?</p>\n</blockquote>\n\n<p>Of course, all the usual rules apply (you'll see the difference if you try to feed your struct to <code>json.Marshal</code>, for example).</p>\n"}, {"tags": [], "owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "is_accepted": true, "score": 4, "last_activity_date": 1566855223, "last_edit_date": 1566855223, "creation_date": 1566855098, "answer_id": 57665190, "question_id": 57665092, "link": "https://stackoverflow.com/questions/57665092/does-whether-or-not-a-field-is-exported-inside-an-anonymous-struct-make-any-diff/57665190#57665190", "title": "Does whether or not a field is exported inside an anonymous struct make any difference?", "body": "<p>Sure does, due to reflection. Try calling <code>json.Marshal(test)</code> after each of your declarations. In the first case, you will get <code>{\"FieldOne\":\"some string\",\"FieldTwo\":\"some other string\"}</code>, but in the second case you will get <code>{}</code>. That's because the JSON marshaler only \"sees\" exported struct fields. More generally, even though the type of <code>test</code> doesn't have a name, doesn't mean that the type itself is inaccessible; it <em>is</em> accessible to anything with reflection.</p>\n"}], "owner": {"reputation": 308, "user_id": 1729496, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/9b1818f25bed9eb4148d2d3c732e1c1f?s=128&d=identicon&r=PG", "display_name": "Omnomnious", "link": "https://stackoverflow.com/users/1729496/omnomnious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 57665190, "answer_count": 2, "score": -3, "last_activity_date": 1566855223, "creation_date": 1566854519, "question_id": 57665092, "link": "https://stackoverflow.com/questions/57665092/does-whether-or-not-a-field-is-exported-inside-an-anonymous-struct-make-any-diff", "title": "Does whether or not a field is exported inside an anonymous struct make any difference?", "body": "<p>Does exporting (or not exporting) a field in an anonymous struct in golang make any difference? In other words are the following two blocks of code different from each other in any way? Considering it's an anonymous struct, you can't use the struct outside the variable itself so I would assume the capital F doesn't make a difference when compiling (no compilation speed or run time memory differences).</p>\n\n<p>Block 1:</p>\n\n<pre><code>var test = struct {\n   FieldOne string\n   FieldTwo string\n} {\n   FieldOne: \"some string\",\n   FieldTwo: \"some other string\",\n}\n</code></pre>\n\n<p>Block 2:</p>\n\n<pre><code>var test = struct {\n   fieldOne string\n   fieldTwo string\n} {\n   fieldOne: \"some string\",\n   fieldTwo: \"some other string\",\n}\n</code></pre>\n"}, {"tags": ["go", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "is_accepted": true, "score": 1, "last_activity_date": 1566878905, "creation_date": 1566878905, "answer_id": 57667567, "question_id": 57665048, "link": "https://stackoverflow.com/questions/57665048/cannot-unmarshal-yaml-file-into-struct/57667567#57667567", "title": "cannot unmarshal yaml file into struct", "body": "<p>insted of <code>models.DataFromYAML</code> use array of <code>[]models.DataFromYAML</code>\n    package main</p>\n\n<pre><code>import (\n    \"fmt\"\n\n    \"github.com/ghodss/yaml\"\n)\n\n\nconst data = `--- \n- \n  labels: cats, cute, funny\n  name: \"funny cats\"\n  url: \"http://glorf.com/videos/asfds.com\"\n- \n  labels: cats, ugly,funny\n  name: \"more cats\"\n  url: \"http://glorf.com/videos/asdfds.com\"\n- \n  labels: dogs, cute, funny\n  name: \"lots of dogs\"\n  url: \"http://glorf.com/videos/asasddfds.com\"\n- \n  name: \"bird dance\"\n  url: \"http://glorf.com/videos/q34343.com\"\n`\n\ntype DataFromYAML struct {\n    Labels string `yaml:\"labels\"`\n    Name   string `yaml:\"name\"`\n    URL    string `yaml:\"url\"`\n}\n\n\nfunc main() {\n    var test []DataFromYAML\n    err := yaml.Unmarshal([]byte(data), &amp;test)\n    if err != nil {\n        fmt.Printf(\"err: %v\\n\", err)\n        return\n    }\n\n    fmt.Println(test)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>[{cats, cute, funny funny cats http://glorf.com/videos/asfds.com} {cats, ugly,funny more cats http://glorf.com/videos/asdfds.com} {dogs, cute, funny lots of dogs http://glorf.com/videos/asasddfds.com} { bird dance http://glorf.com/videos/q34343.com}]\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 6178349, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/985dfa92816948825f48d2d60b52583d?s=128&d=identicon&r=PG&f=1", "display_name": "J. Vi&#233;gas", "link": "https://stackoverflow.com/users/6178349/j-vi%c3%a9gas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 244, "favorite_count": 0, "accepted_answer_id": 57667567, "answer_count": 1, "score": 0, "last_activity_date": 1566878905, "creation_date": 1566854255, "question_id": 57665048, "link": "https://stackoverflow.com/questions/57665048/cannot-unmarshal-yaml-file-into-struct", "title": "cannot unmarshal yaml file into struct", "body": "<p>I am trying to UnmarshalS into DataCollectionFromYAML</p>\n\n<pre><code>--- \n- \n  labels: cats, cute, funny\n  name: \"funny cats\"\n  url: \"http://glorf.com/videos/asfds.com\"\n- \n  labels: cats, ugly,funny\n  name: \"more cats\"\n  url: \"http://glorf.com/videos/asdfds.com\"\n- \n  labels: dogs, cute, funny\n  name: \"lots of dogs\"\n  url: \"http://glorf.com/videos/asasddfds.com\"\n- \n  name: \"bird dance\"\n  url: \"http://glorf.com/videos/q34343.com\"\n\n</code></pre>\n\n<pre><code>type DataFromYAML struct {\n    Labels string `yaml:\"labels\"`\n    Name   string `yaml:\"name\"`\n    URL    string `yaml:\"url\"`\n}\n\ntype DataCollectionFromYAML struct {\n    data []VidedFromYAML\n}\n</code></pre>\n\n<p>Here is part of my code and I am using gopkg.in/yaml.v2 package</p>\n\n<pre><code>yamlFile, err := ioutil.ReadAll(r)\n    if err != nil {\n        return err\n    }\n    var data models.DataFromYAML\n\n    err2 := yaml.Unmarshal(yamlFile, data)\n\n\n</code></pre>\n\n<p>I am getting the error message: cannot unmarshal !!seq into models.DataCollectionFromYAML</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1566852195, "post_id": 57664430, "comment_id": 101778158, "body": "The connection isn&#39;t being reused because the <code>http.Client</code> isn&#39;t being reused. You&#39;re creating a whole new <code>Client</code> for every request. You&#39;re correct that the <code>map</code> is not being deep copied when you pass it; a map is a pointer internally. However it&#39;s hard to say how to do it correctly because the quoted example code is invalid; you cannot pass a <code>interface{}</code> or a <code>map</code> to <code>bytes.NewBuffer</code>. Perhaps if you edit your question with a <a href=\"https://stackoverflow.com/help/minimal-reproducible-example\">Minimal, Reproducible Example</a> it might be answerable."}, {"owner": {"reputation": 85, "user_id": 3677365, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/646dc01711bbd0d0fb7c2658d136b426?s=128&d=identicon&r=PG&f=1", "display_name": "user3677365", "link": "https://stackoverflow.com/users/3677365/user3677365"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1566852485, "post_id": 57664430, "comment_id": 101778251, "body": "Did edited. Missed those line from pasting here."}], "answers": [{"comments": [{"owner": {"reputation": 85, "user_id": 3677365, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/646dc01711bbd0d0fb7c2658d136b426?s=128&d=identicon&r=PG&f=1", "display_name": "user3677365", "link": "https://stackoverflow.com/users/3677365/user3677365"}, "edited": false, "score": 0, "creation_date": 1566852578, "post_id": 57664724, "comment_id": 101778282, "body": "Mutex lock doesn&#39;t seems to work for me. Can&#39;t I use the reqBody to generate the post data in each goroutine like i tried?"}], "tags": [], "owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "is_accepted": false, "score": 0, "last_activity_date": 1566852656, "last_edit_date": 1566852656, "creation_date": 1566852272, "answer_id": 57664724, "question_id": 57664430, "link": "https://stackoverflow.com/questions/57664430/avoid-data-race-in-goroutine-inside-range-with-interface/57664724#57664724", "title": "Avoid data race in goroutine inside range with interface", "body": "<p>A couple of options:</p>\n\n<p><strong>Use the Mutex</strong></p>\n\n<p>This is the safest and most straightforward.  It looks like the scope of your <a href=\"https://en.wikipedia.org/wiki/Critical_section\" rel=\"nofollow noreferrer\">mutex</a> could be reduced to:</p>\n\n<pre><code>serviceMutex.Lock()\nsomePostData.(map[string]interface{})[\"someKey\"] = \"someval\" \npostJsonBody, _ := json.Marshal(somePostData)\nserviceMutex.Unlock()\n</code></pre>\n\n<p>Which should significantly help with your throughput.</p>\n\n<p><strong>Have each goroutine build its own <code>somePostData</code></strong></p>\n\n<p>Depending on your data structure this should allow each goroutine to not share data with any other and give you the safety and speed boost.  Imagine instead of passing an <code>interface{}</code> with potentially lots of references itself you pass in a thread-safe method that is able to build a request body:</p>\n\n<pre><code>func callUrls(urls []string, buildReqBody func(...params...) interface{})\n...\n\n\nsomePostData = buildReqBody(...params...)\n\n</code></pre>\n"}], "owner": {"reputation": 85, "user_id": 3677365, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/646dc01711bbd0d0fb7c2658d136b426?s=128&d=identicon&r=PG&f=1", "display_name": "user3677365", "link": "https://stackoverflow.com/users/3677365/user3677365"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1566852656, "creation_date": 1566850637, "last_edit_date": 1566852278, "question_id": 57664430, "link": "https://stackoverflow.com/questions/57664430/avoid-data-race-in-goroutine-inside-range-with-interface", "title": "Avoid data race in goroutine inside range with interface", "body": "<p>I have following <code>for...range</code> block which call the urls using <code>goroutine</code>.</p>\n\n<pre><code>func callUrls(urls []string, reqBody interface{}) []*Response {\n    ch := make(chan *Response, len(urls))\n    for _, url := range urls {\n        somePostData := reqBody //this just seems to copy reference, not a deep copy\n        go func(url string, somePostData interface{}) {\n            //serviceMutex.Lock()\n            //defer serviceMutex.Unlock()\n            somePostData.(map[string]interface{})[\"someKey\"] = \"someval\" //can be more deeper nested\n            //Data race - while executing above line it seems the original data is only getting modified, not the new local variable\n\n            //http post on url,\n            postJsonBody, _ := json.Marshal(somePostData)\n            req, err := http.NewRequest(\"POST\", url, bytes.NewBuffer(postJsonBody))\n            req.Header.Set(\"Content-Type\", \"application/json\")\n            req.Header.Set(\"Connection\", \"Keep-Alive\")\n\n            client := &amp;http.Client{\n                Timeout: time.Duration(time.Duration(300) * time.MilliSecond),\n            }\n\n            response, err := client.Do(req)\n            response.Body.Close()\n\n\n            // return to channel accordingly\n            ch &lt;- &amp;Response{200, \"url\", \"response body\"}\n\n        }(url, somePostData)\n    }\n    //for block to return result.\n}\n</code></pre>\n\n<p>Each <code>goroutine func</code> needs to post modified post data to url.</p>\n\n<p>However running with <code>-race</code> shows data race at the line where post data interface is modified.</p>\n\n<p>I also tried the <code>sync.Mutex</code> <code>Lock()</code> and <code>Unlock()</code> but it seems it blocking the whole app. I don't want to use []bytes so as modifying the slices seems to more cpu consuming(As it seems to me).</p>\n\n<p>What would be best way to avoid data race here. Also the connection doesn't seems to be reused causing http error as well. Any suggestions?</p>\n"}, {"tags": ["reactjs", "go", "axios", "mux"], "comments": [{"owner": {"reputation": 92569, "user_id": 400654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/afc1068910df4dd83c2fc3af0255af11?s=128&d=identicon&r=PG", "display_name": "Kevin B", "link": "https://stackoverflow.com/users/400654/kevin-b"}, "edited": false, "score": 0, "creation_date": 1566844715, "post_id": 57663157, "comment_id": 101775313, "body": "Your cors implementation only handles simple CORS requests. for more advanced ones, you&#39;ll need to properly handle the preflight."}, {"owner": {"reputation": 21, "user_id": 8635495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de20e54b494871a089323bd63fdd4099?s=128&d=identicon&r=PG&f=1", "display_name": "Aliou Amar", "link": "https://stackoverflow.com/users/8635495/aliou-amar"}, "reply_to_user": {"reputation": 92569, "user_id": 400654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/afc1068910df4dd83c2fc3af0255af11?s=128&d=identicon&r=PG", "display_name": "Kevin B", "link": "https://stackoverflow.com/users/400654/kevin-b"}, "edited": false, "score": 0, "creation_date": 1566845044, "post_id": 57663157, "comment_id": 101775432, "body": "@KevinB I tried that solution early on, it didn&#39;t work for me for some reason (adding the 3 headers and returning 200 if the method is &quot;OPTIONS&quot;)"}, {"owner": {"reputation": 92569, "user_id": 400654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/afc1068910df4dd83c2fc3af0255af11?s=128&d=identicon&r=PG", "display_name": "Kevin B", "link": "https://stackoverflow.com/users/400654/kevin-b"}, "edited": false, "score": 1, "creation_date": 1566845098, "post_id": 57663157, "comment_id": 101775445, "body": "The latter part is what you are missing currently. That it didn&#39;t work for you doesn&#39;t change that you need to properly respond to the OPTIONS request. All it needs is a 200 status code and the 3 headers. It&#39;s not complicated."}, {"owner": {"reputation": 21, "user_id": 8635495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de20e54b494871a089323bd63fdd4099?s=128&d=identicon&r=PG&f=1", "display_name": "Aliou Amar", "link": "https://stackoverflow.com/users/8635495/aliou-amar"}, "reply_to_user": {"reputation": 92569, "user_id": 400654, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/afc1068910df4dd83c2fc3af0255af11?s=128&d=identicon&r=PG", "display_name": "Kevin B", "link": "https://stackoverflow.com/users/400654/kevin-b"}, "edited": false, "score": 0, "creation_date": 1566845359, "post_id": 57663157, "comment_id": 101775525, "body": "I&#39;ll retry that then thanks :)"}], "owner": {"reputation": 21, "user_id": 8635495, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/de20e54b494871a089323bd63fdd4099?s=128&d=identicon&r=PG&f=1", "display_name": "Aliou Amar", "link": "https://stackoverflow.com/users/8635495/aliou-amar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 4471, "favorite_count": 0, "closed_date": 1566848089, "answer_count": 0, "score": 1, "last_activity_date": 1566844522, "creation_date": 1566844522, "question_id": 57663157, "link": "https://stackoverflow.com/questions/57663157/how-to-fix-access-to-xmlhttprequest-at-http-localhost8000-api-companies-fr", "closed_reason": "Duplicate", "title": "How to fix &#39;Access to XMLHttpRequest at &#39;http://localhost:8000/api/companies&#39; from origin &#39;http://localhost:3000&#39; has been blocked by CORS policy&#39;", "body": "<p>I am currently working on a web app with Go/Postgres backend and React frontend. I am running into some trouble with CORS despite trying many solutions found here and around the internet.</p>\n\n<p>Currently, I am using the package <code>github.com/rs/cors</code> to handle CORS on the server side and, checking with a curl request like</p>\n\n<pre><code>curl -D - -H 'Origin: http://localhost:3000' \\\n-H 'Authorization: Bearer mytoken' \\\nhttp://localhost:8000/api/companies\n</code></pre>\n\n<p>I get the correct response:</p>\n\n<pre><code>HTTP/1.1 200 OK\nAccess-Control-Allow-Credentials: true\nAccess-Control-Allow-Origin: http://localhost:3000\nContent-Type: application/json\nVary: Origin\nDate: Mon, 26 Aug 2019 18:19:32 GMT\nContent-Length: 273\n\n{\"data\":[{\"ID\":1,\"CreatedAt\":\"2019-08-23T17:54:23.43867+01:00\",\"UpdatedAt\":\"2019-08-23T17:59:26.898246+01:00\",\"DeletedAt\":null,\"name\":\"Goldman Sachs\",\"url\":\"https://goldmansachs.com\",\"industry\":\"Investment Banking\",\"hq\":\"New York, US\"}],\"message\":\"success\",\"success\":true}\n</code></pre>\n\n<p>But the request fails when it is done by the React frontend with an <code>Access to XMLHttpRequest at 'http://localhost:8000/api/companies' from origin 'http://localhost:3000' has been blocked by CORS policy: Response to preflight request doesn't pass access control check: No 'Access-Control-Allow-Origin' header is present on the requested resource.</code> message.</p>\n\n<p>main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func main() {\n    router := mux.NewRouter()\n\n    db := models.GetDB()\n    defer db.Close()\n\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n        port = \"8000\" //localhost\n    }\n\n\n    router.HandleFunc(\"/api/companies\", handlers.GetAllCompanies).Methods(\"GET\")\n    ...\n\n\n    c := cors.New(cors.Options{\n        AllowedOrigins: []string{\"http://localhost:3000\"},\n        AllowedMethods: []string{\"POST\", \"GET\", \"OPTIONS\", \"PUT\", \"DELETE\"},\n        AllowCredentials: true,\n    })\n\n    router.Use(app.JwtAuthentication)\n\n    handler := c.Handler(router)\n\n    err := http.ListenAndServe(\":\"+port, handler)\n    if err != nil {\n        panic(err.Error())\n    }\n}\n</code></pre>\n\n<p>endpoints.js</p>\n\n<pre><code>...\nexport const token = () =&gt; {\n  const localToken = getLocalAccessToken()\n  //getLocalAccessToken returns the token correctly\n  return localToken\n}\n...\nconst headers = {\n  Authorization: `Bearer ${token()}`,\n  'Content-Type': 'application/json',\n};\n\nexport const getCompanies = () =&gt; axios.get(`http://localhost:8000/api/companies`, { headers }, { crossDomain: true });\n...\n</code></pre>\n\n<p>I don't really know what to do to fix this because it works with curl but not in the browser and at the moment I am clueless to why.</p>\n"}, {"tags": ["go", "coroutine", "goroutine"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566843190, "post_id": 57662739, "comment_id": 101774719, "body": "Where are you fetching these fields from?"}, {"owner": {"reputation": 1137, "user_id": 834604, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/370dff88f83f96e95114d06df9ee5f42?s=128&d=identicon&r=PG", "display_name": "Lem0n", "link": "https://stackoverflow.com/users/834604/lem0n"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566843987, "post_id": 57662739, "comment_id": 101775042, "body": "I have a module that resolves dependencies and query external services (for now this is a prototype, so it&#39;s just stubs). For instance: <a href=\"https://play.golang.org/p/Php5Nod5U0i\" rel=\"nofollow noreferrer\">play.golang.org/p/Php5Nod5U0i</a>   If you check canConsumeAlcohol(), it resolves the dependencies it needs to be able to call canconsumealcohol.Get() and saves in a cache in case it&#39;s called again."}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1566843189, "creation_date": 1566843189, "answer_id": 57662888, "question_id": 57662739, "link": "https://stackoverflow.com/questions/57662739/pattern-for-fetching-multiple-fields-in-parallel/57662888#57662888", "title": "Pattern for fetching multiple fields in parallel", "body": "<p>Without knowing more of the specifics of your scenario, my only suggestion would be to separate out the Go routine error handling into another package.</p>\n\n<p>Fortunately, a package already exists that does the same thing, named <a href=\"https://godoc.org/golang.org/x/sync/errgroup\" rel=\"noreferrer\"><code>errgroup</code></a>. Below is an implementation of your original code using the <code>errgroup</code> package:</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n\n    \"golang.org/x/sync/errgroup\"\n)\n\ntype User struct {\n    Name     string\n    Age      int\n    CanDrive *bool\n}\n\nfunc Name() (string, error) {\n    return \"foobar\", nil\n}\n\nfunc Age() (int, error) {\n    return 25, nil\n}\n\nfunc CanDrive() (bool, error) {\n    return true, nil\n}\n\nfunc fetchUser(ctx context.Context) (*User, error) {\n    group, ctx := errgroup.WithContext(ctx)\n\n    user := &amp;User{}\n    group.Go(func() (err error) {\n        user.Name, err = Name()\n        return\n    })\n    group.Go(func() (err error) {\n        user.Age, err = Age()\n        return\n    })\n    group.Go(func() error {\n        canDrive, err := CanDrive()\n        if err == nil {\n            user.CanDrive = &amp;canDrive\n        }\n        return err\n    })\n\n    if err := group.Wait(); err != nil {\n        return nil, err\n    }\n\n    return user, nil\n}\n\nfunc main() {\n    user, err := fetchUser(context.Background())\n    fmt.Println(user, err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1137, "user_id": 834604, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/370dff88f83f96e95114d06df9ee5f42?s=128&d=identicon&r=PG", "display_name": "Lem0n", "link": "https://stackoverflow.com/users/834604/lem0n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 57662888, "answer_count": 1, "score": 0, "last_activity_date": 1566843189, "creation_date": 1566842402, "question_id": 57662739, "link": "https://stackoverflow.com/questions/57662739/pattern-for-fetching-multiple-fields-in-parallel", "title": "Pattern for fetching multiple fields in parallel", "body": "<p>I need to fetch multiple fields in parallel for my system from external services (in this example, simulated by Name(), Age() and CanDrive() methods).</p>\n\n<p>The fetchUser() method does what I want, but it seems too verbose specially if you consider I could have 10+ fields. Are there better ways I can implement this?</p>\n\n<p>playground: <a href=\"https://play.golang.org/p/90sNq1GmrD8\" rel=\"nofollow noreferrer\">https://play.golang.org/p/90sNq1GmrD8</a></p>\n\n<p>Code (same as in playground):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n)\n\ntype User struct {\n    Name string\n    Age int\n    CanDrive *bool\n}\n\nfunc Name() (string, error) {\n    return \"foobar\", nil\n}\n\nfunc Age() (int, error) {\n    return 25, nil\n}\n\nfunc CanDrive() (bool, error) {\n    return true, nil\n}\n\nfunc fetchUser() (*User, error) {\n    var wg sync.WaitGroup\n    errs := make(chan error)\n\n    user := &amp;User{}\n\n    wg.Add(1)\n    go func() {\n        var err error\n        defer wg.Done()\n        user.Name, err = Name()\n        errs &lt;- err\n    }()\n\n    wg.Add(1)\n\n    go func() {\n        var err error\n        defer wg.Done()\n        user.Age, err = Age()\n        errs &lt;- err\n    }()\n\n    wg.Add(1)\n    go func() {\n        defer wg.Done()\n        canDrive, err := CanDrive()\n        if err == nil {\n            user.CanDrive = &amp;canDrive\n        }\n        errs &lt;- err\n    }()\n\n    // wait until all go-routines are completed successfully\n    // if that's the case, close the errs channel\n    go func() {\n        wg.Wait()\n        close(errs)\n    }()\n\n    // keep waiting for errors (or for the error channel to be closed\n    // if all calls succeed)\n    for err := range errs {\n        if err != nil {\n            return nil, err\n        }\n    }\n\n    return user, nil\n}\n\nfunc main() {\n    user, _ := fetchUser()\n    fmt.Println(user)\n}\n</code></pre>\n"}, {"tags": ["go", "dependency-injection"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566838366, "post_id": 57661909, "comment_id": 101772824, "body": "The body of <code>initialize</code> doesn&#39;t look like valid Go, unless I&#39;m missing something?"}, {"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566839298, "post_id": 57661909, "comment_id": 101773207, "body": "You were correct but it was just a typo on the post, it is correct on my side. I edited to fix the typo"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566839599, "post_id": 57661909, "comment_id": 101773320, "body": "I&#39;ve never used <code>wire</code> so I don&#39;t really know how the code&#39;s supposed to look, but aren&#39;t you missing a <a href=\"https://github.com/google/wire/blob/master/docs/guide.md#defining-providers\" rel=\"nofollow noreferrer\">provider</a> for <code>*Config</code>? It seems like that&#39;s what the error is complaining about."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566839838, "post_id": 57661909, "comment_id": 101773404, "body": "In <a href=\"https://github.com/google/wire/blob/master/docs/guide.md#use-fields-of-a-struct-as-providers\" rel=\"nofollow noreferrer\">this example</a> the <code>S</code> field is not a pointer."}, {"owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566841733, "post_id": 57661909, "comment_id": 101774162, "body": "I shortened the example but I have several other providers which themselves take in a <code>*Config</code> and I don&#39;t have to do anything so I think wire makes the Config a provider as well though I don&#39;t understand those details. No, in the example <code>S</code> is not a pointer but I sort of expected, just as the struct provider documentation, it to make a provider of both pointer and non-pointer type. Might just be that it does not"}], "owner": {"reputation": 2008, "user_id": 710618, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/779233af08fd9f187990a44146f1778c?s=128&d=identicon&r=PG", "display_name": "Alexandre Thenorio", "link": "https://stackoverflow.com/users/710618/alexandre-thenorio"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1566839197, "creation_date": 1566838093, "last_edit_date": 1566839197, "question_id": 57661909, "link": "https://stackoverflow.com/questions/57661909/how-to-get-back-a-pointer-provider-from-wire-fieldsof", "title": "How to get back a pointer provider from `wire.FieldsOf`?", "body": "<p>I am trying to use <a href=\"https://github.com/google/wire\" rel=\"nofollow noreferrer\">google wire</a> to wire a config field and failing hard at it.</p>\n\n<p>I have the following wire entrypoint</p>\n\n<pre><code>type Config struct {\n    UserConfig UserConfig\n}\n\nfunc initialize(ctx context.Context, cfg *Config) (*st, func(), error) {\n    panic( // panic to be replaced by generated code\n        wire.Build(\n            InitializeUser,\n            wire.FieldsOf(new(Config), \"UserConfig\"),\n        ),\n    )\n}\n\nfunc InitializeUser(config *UserConfig) *User {\n    // initialize user from user config\n}\n</code></pre>\n\n<p>I am trying to make the <code>UserConfig</code> field in the <code>Config</code>struct a provider without having to write a simple wrapper initializer just for that.</p>\n\n<p>It is my understanding that <code>wire.FieldsOf</code> is supposed to do exactly this however it does not seem to work (keep geting <code>no provider found for *Config</code>). My guess is it only provides a <code>UserConfig</code> and not a <code>*UserConfig</code>.</p>\n\n<p>Without changing the <code>UserConfig</code> field to a pointer or writing a initializer wrapper that takes a config and returns a <code>*UserConfig</code>, is there any way to do this in wire?</p>\n"}, {"tags": ["shell", "docker", "go", "networking", "netstat"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566837572, "post_id": 57661626, "comment_id": 101772551, "body": "As a first step, after writing the strings send a newline: io.WriteString(stdin, &quot;CID=&quot;+CID+&quot;\\n&quot;)"}, {"owner": {"reputation": 41, "user_id": 10925215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a2e9edf1e361ce1354c0b906cc4d922?s=128&d=identicon&r=PG&f=1", "display_name": "SahilW", "link": "https://stackoverflow.com/users/10925215/sahilw"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566839648, "post_id": 57661626, "comment_id": 101773338, "body": "Tried it, getting exit status 2 and 1."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566843383, "post_id": 57661626, "comment_id": 101774802, "body": "You could try sending the whole thing as a single command, like cmd1 ; cmd2 ; cmd3 ; ...\\n"}, {"owner": {"reputation": 41, "user_id": 10925215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a2e9edf1e361ce1354c0b906cc4d922?s=128&d=identicon&r=PG&f=1", "display_name": "SahilW", "link": "https://stackoverflow.com/users/10925215/sahilw"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566861328, "post_id": 57661626, "comment_id": 101780562, "body": "That worked! Thank you so much :)"}], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 10925215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a2e9edf1e361ce1354c0b906cc4d922?s=128&d=identicon&r=PG&f=1", "display_name": "SahilW", "link": "https://stackoverflow.com/users/10925215/sahilw"}, "is_accepted": false, "score": 0, "last_activity_date": 1566862388, "last_edit_date": 1566862388, "creation_date": 1566861732, "answer_id": 57665973, "question_id": 57661626, "link": "https://stackoverflow.com/questions/57661626/unable-to-run-netstat-for-docker-in-go-using-exec/57665973#57665973", "title": "Unable to run netstat for docker in Go using exec", "body": "<p>If someone looks for the same in the future, here's a working solution</p>\n\n<pre><code>cmd := exec.Command(\"/bin/sh\", \"-c\", \"CID=\"+CID+\" ; TASKS=/sys/fs/cgroup/devices/docker/$CID*/tasks ; PID=$(head -n 1 $TASKS); mkdir -p /var/run/netns ; ln -sf /proc/$PID/ns/net /var/run/netns/$CID ; ip netns exec $CID netstat -i\")\nout, err := cmd.CombinedOutput()\nif err != nil {\n    fmt.Println(err)\n}\n\nfmt.Printf(\"%s\\n\", out)\n</code></pre>\n"}], "owner": {"reputation": 41, "user_id": 10925215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a2e9edf1e361ce1354c0b906cc4d922?s=128&d=identicon&r=PG&f=1", "display_name": "SahilW", "link": "https://stackoverflow.com/users/10925215/sahilw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 81, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1566862388, "creation_date": 1566836742, "question_id": 57661626, "link": "https://stackoverflow.com/questions/57661626/unable-to-run-netstat-for-docker-in-go-using-exec", "title": "Unable to run netstat for docker in Go using exec", "body": "<p>Trying to run terminal commands in Go using exec to get docker network usage but unable to. The following link shows how to get docker container's network usage using terminal and it works fine in terminal but not using Go. <a href=\"https://docs.docker.com/config/containers/runmetrics/\" rel=\"nofollow noreferrer\">https://docs.docker.com/config/containers/runmetrics/</a></p>\n\n<p>I get exit code 1, 2, 125, etc. with different combinations.</p>\n\n<pre><code>stdin, err := cmd.StdinPipe()\nif err != nil {\n    log.Fatal(err)\n}\n\ndefer stdin.Close()\nio.WriteString(stdin, \"CID=\"+CID) // container ID\nio.WriteString(stdin,\"TASKS=/sys/fs/cgroup/devices/docker/$CID*/tasks\")\nio.WriteString(stdin, \"PID=$(head -n 1 $TASKS)\")\nio.WriteString(stdin, \"mkdir -p /var/run/netns\")\nio.WriteString(stdin, \"ln -sf /proc/$PID/ns/net /var/run/netns/$CID\")\nio.WriteString(stdin, \"ip netns exec $CID netstat -i\")\n\nout, err := cmd.CombinedOutput()\nif err != nil {\n    log.Fatal(err)\n}\n\nfmt.Printf(\"%s\\n\", out)\n</code></pre>\n\n<p>Expected output:</p>\n\n<pre><code>Kernel Interface table\nIface             MTU    RX-OK RX-ERR RX-DRP RX-OVR    TX-OK TX-ERR TX-DRP TX-OVR Flg\neth0             1450  1228323      0      0 0       1761314      0      0      0 BMRU\n</code></pre>\n"}, {"tags": ["postgresql", "go", "model", "go-gorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566833220, "post_id": 57660347, "comment_id": 101770764, "body": "<i>&quot;The problem is that I have an additional field in the <code>school_accreditation</code> table but <b>it is included</b> in the response.&quot;</i> Is that a typo? Or are you saying that you want to <i>exclude</i> a field from json? If so, you can use the <code>json:&quot;-&quot;</code> field tag to achieve that."}, {"owner": {"reputation": 6177, "user_id": 633864, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/N2ha7.jpg?s=128&g=1", "display_name": "COil", "link": "https://stackoverflow.com/users/633864/coil"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566833808, "post_id": 57660347, "comment_id": 101771049, "body": "Sorry, I have modified &quot;it isn&#39;t included&quot;. I want the additional field to appear in the json response. Thanks for pointing out the typo. :)"}], "answers": [{"tags": [], "owner": {"reputation": 6177, "user_id": 633864, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/N2ha7.jpg?s=128&g=1", "display_name": "COil", "link": "https://stackoverflow.com/users/633864/coil"}, "is_accepted": true, "score": 1, "last_activity_date": 1567415526, "last_edit_date": 1567415526, "creation_date": 1566917448, "answer_id": 57677321, "question_id": 57660347, "link": "https://stackoverflow.com/questions/57660347/gorm-many2many-and-additional-fields-in-association-table/57677321#57677321", "title": "gorm many2many and additional fields in association table", "body": "<p>Answering to myself, I added the field in the linked model as \"ignore\" and it works, the column is automatically retrieved from the association table.</p>\n\n<pre><code>type Accreditation struct {\n    // \"accreditation\" table\n    ID          int `gorm:\"primary_key\"`\n    Name        string\n    Description string\n    // \"school_accreditation table\", so the field is set as ignore with \"-\"\n    EndAt       time.Time `gorm:\"-\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 6177, "user_id": 633864, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/N2ha7.jpg?s=128&g=1", "display_name": "COil", "link": "https://stackoverflow.com/users/633864/coil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 704, "favorite_count": 0, "accepted_answer_id": 57677321, "answer_count": 1, "score": 2, "last_activity_date": 1570045841, "creation_date": 1566831310, "last_edit_date": 1570045841, "question_id": 57660347, "link": "https://stackoverflow.com/questions/57660347/gorm-many2many-and-additional-fields-in-association-table", "title": "gorm many2many and additional fields in association table", "body": "<p>I have a many2many association (it is used to return JSON). It's declared in a model:</p>\n\n<pre><code>// models/school.go\ntype School struct {\n    ID                int      `gorm:\"primary_key\"`\n    Name              string `gorm:\"not null\"`\n    Accreditations    []Accreditation `gorm:\"many2many:school_accreditation;\"` \n}\n</code></pre>\n\n<p>It works well. I have the association returned in the json. The problem is that I have an additional field in the <code>school_accreditation</code> table but it <strong>isn't</strong> included in the response.</p>\n\n<p>I have tried to declare a model for the association like proposed in <a href=\"https://stackoverflow.com/a/55339916/633864\">this  answer</a>:</p>\n\n<pre><code>// models/schoolAccreditation.go\npackage models\n\nimport \"time\"\n\n// many to many\ntype SchoolAccreditation struct {\n    StartedAt time.Time `gorm:\"not null\"`\n}\n</code></pre>\n\n<p>But it doesn't work so far. Is there some additional configuration to declare? Or to modify?</p>\n"}, {"tags": ["qt", "user-interface", "go"], "comments": [{"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566829494, "post_id": 57659704, "comment_id": 101768947, "body": "Hi, from the github wiki of therecipe/qt, it seems to expect Qt5 and not Qt4: <a href=\"https://github.com/therecipe/qt/wiki/Installation-on-Linux\" rel=\"nofollow noreferrer\">github.com/therecipe/qt/wiki/Installation-on-Linux</a>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566836394, "post_id": 57659704, "comment_id": 101772085, "body": "@Dinesh : I installed <code>sudo apt-get --no-install-recommends install libqt*5-dev qt*5-dev qml-module-qtquick-* </code> but error is persisting. This command (part of installation) is not working: <code>$(go env GOPATH)&#47;bin&#47;qtsetup</code>"}, {"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566841037, "post_id": 57659704, "comment_id": 101773898, "body": "What&#39;s the error you&#39;re getting? did qtsetup get installed correctly?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566867678, "post_id": 57659704, "comment_id": 101781531, "body": "I have added output and error of qtsetup command in my question above."}, {"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566870513, "post_id": 57659704, "comment_id": 101781986, "body": "The error says it all no? It can&#39;t find go executable in your PATH. Something is off with your go installation."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566871625, "post_id": 57659704, "comment_id": 101782158, "body": "Go is otherwise working all right. I had downloaded and installed with command <code>tar -C &#47;usr&#47;local -xzf go$VERSION.$OS-$ARCH.tar.gz</code> as given on <a href=\"https://golang.org/doc/install\" rel=\"nofollow noreferrer\">golang.org/doc/install</a> . Can I correct above error?"}, {"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566873832, "post_id": 57659704, "comment_id": 101782548, "body": "Out of curiosity, why are you using sudo to run qtsetup? If you followed the go lang installations as per their website and added <code>export PATH=$PATH:&#47;usr&#47;local&#47;go&#47;bin</code>  to your <code>&#47;home&#47;abcde&#47;.profile</code>, it won&#39;t be accessible to qtsetup because sudo makes it look for .profile in <code>&#47;root&#47;.profile</code>. If you want to use sudo, add the path to <code>&#47;etc&#47;profile</code> . Or don&#39;t use sudo"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566874181, "post_id": 57659704, "comment_id": 101782605, "body": "Without sudo, it did not work since it was trying to make symlinks in sbin folder."}, {"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566874377, "post_id": 57659704, "comment_id": 101782633, "body": "Ah well add the <code>&#47;usr&#47;local&#47;go&#47;bin</code> to  <code>&#47;etc&#47;profile</code> . The qtsetup probably assumed you&#39;ve installed go to /home/abcde/bin/go or some such paths."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566875334, "post_id": 57659704, "comment_id": 101782780, "body": "It does not work. I am abandoning it currently. As such therecipe/qt takes 1.1Gb disk space which is in addition to what Qt packages take on Debian installation."}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2207, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566867588, "creation_date": 1566829031, "last_edit_date": 1566867588, "question_id": 57659704, "link": "https://stackoverflow.com/questions/57659704/running-simple-qt-gui-application-in-go", "title": "Running simple Qt GUI application in Go", "body": "<p>I am trying to modify following simple code from <a href=\"https://doc.qt.io/archives/3.3/tutorial1-01.html\" rel=\"nofollow noreferrer\">here</a> to use Qt in Go.</p>\n\n<pre><code>#include &lt;qapplication.h&gt;\n#include &lt;qpushbutton.h&gt;\nint main( int argc, char **argv )\n{\n    QApplication a( argc, argv );\n\n    QPushButton hello( \"Hello world!\", 0 );\n    hello.resize( 100, 30 );\n\n    a.setMainWidget( &amp;hello );\n    hello.show();\n    return a.exec();\n}\n</code></pre>\n\n<p>My <a href=\"https://golang.org/\" rel=\"nofollow noreferrer\">Go (Golang)</a> code is: </p>\n\n<pre><code>package main\nimport (\n    \"github.com/therecipe/qt\"\n    \"github.com/therecipe/qt/widgets\"\n)\nfunc main() {\n    a := qt.NewQApplication(len(os.Args), os.Args) //ch: widgets.NewQ..\n    hello := widgets.QPushButton( \"Hello world!\", 0 )\n    a.setMainWidget( &amp;hello )\n    hello.Show()\n    a.Exec()\n}\n</code></pre>\n\n<p>However, I get following error: </p>\n\n<pre><code># github.com/therecipe/qt/core\ncore.cpp:9:30: fatal error: QAbstractAnimation: No such file or directory\n #include &lt;QAbstractAnimation&gt;\n                              ^\ncompilation terminated.\n</code></pre>\n\n<p>I have installed Qt bindings in Go using command: </p>\n\n<pre><code>go get \"github.com/therecipe/qt\"\n</code></pre>\n\n<p>I am working on Debian9 Linux and have following Qt4 packages installed: </p>\n\n<pre><code>libntrack-qt4-1         016-1.3         016-1.3         016-1.3         install\nlibqt4-dev              4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\nlibqt4-dev-bin          4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\nlibqt4-opengl-dev       4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\npython-qt4              4.11.4+dfsg-2+b1        4.11.4+dfsg-2+b1        4.11.4+dfsg-2+b1        install\nqt4-default             4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\nqt4-linguist-tools      4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\nqt4-qmake               4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 4:4.8.7+dfsg-11 install\nruby-qt4                4:4.14.3-1+b3   4:4.14.3-1+b3   4:4.14.3-1+b3   install\n</code></pre>\n\n<p>Where is the problem and how can it be solved? Thanks for your help.</p>\n\n<p>Edit: For installing, I followed commands at <a href=\"https://github.com/therecipe/qt/wiki/Installation-on-Linux\" rel=\"nofollow noreferrer\">https://github.com/therecipe/qt/wiki/Installation-on-Linux</a> [Your system package managers version (without Android support)]. However, the command qtsetup gives following output with error: </p>\n\n<pre><code>$ sudo /home/abcde/go/bin/qtsetup\nERRO[0000] failed to run command                         _func=RunCmd cmd=\"go env GOMOD\" dir= env= error=\"exec: \\\"go\\\": executable file not found in $PATH\" name=GOMOD\n</code></pre>\n"}, {"tags": ["javascript", "go", "websocket", "header"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566824922, "post_id": 57658017, "comment_id": 101766544, "body": "The code <code>w.Write([]byte(&quot;Yo&quot;))</code> sends an HTTP response with status 200 and body starting with &quot;Yo&quot;.  Delete this line of code.  It looks like the client is attempting to send the JWT as a sub-protocol.  Although you can probably make this work with changes to the server code, a better approach is to send the JWT as the first message."}, {"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566825649, "post_id": 57658017, "comment_id": 101766897, "body": "@CeriseLim&#243;n actually i added that line because with out it chrome would say it needs a response. about sending it as the first message is it really as secure as the header?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566826769, "post_id": 57658017, "comment_id": 101767548, "body": "Show the exact error reported by Chrome when when the erroneous <code>w.Write([]byte(&quot;Yo&quot;))</code> is removed. The error is probably about missing subprotocol in the response.  If so, the server should add a Sec-WebSocket-Protocol header to the handshake response. That said, you should not abuse the protocol header.  What is your security concern regarding message vs. headers?  Do you have infrastructure that logs one and not the other?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566826879, "post_id": 57658017, "comment_id": 101767607, "body": "There&#39;s a data race on <code>Hubs</code>.  Run the application with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a> once you get to the point where the Hubs code is used."}, {"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566884422, "post_id": 57658017, "comment_id": 101784474, "body": "@CeriseLim&#243;n the problem is i can not send a message till the server is connected to client and i serve the history of messages as it connects and my chat hubs are private."}, {"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566884495, "post_id": 57658017, "comment_id": 101784501, "body": "@CeriseLim&#243;n this is the error i get when i do this with out the <code>w.Write()</code>  WebSocket connection to &#39;ws://127.0.0.1:8080/trip/chat/ws?id=7&#39; failed: Error during WebSocket handshake: Sent non-empty &#39;Sec-WebSocket-Protocol&#39; header but no response was received"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566886323, "post_id": 57658017, "comment_id": 101785034, "body": "The error message is telling you that the client requested a subprotocol, but the server did not reply to that request.  Fix by setting the Sec-WebSocket-Protocol handshake response header to  <code>tknstr</code>.  This may not work reliably because JWTs are not HTTP header tokens."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566886441, "post_id": 57658017, "comment_id": 101785073, "body": "A better approach is to use the first message for authentication. Do not process the first message as a normal message or save the first message to history."}, {"owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566887342, "post_id": 57658017, "comment_id": 101785378, "body": "@CeriseLim&#243;n thank you for your help i will do that."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1566918619, "post_id": 57658017, "comment_id": 101802213, "body": "If you do use protocol negotiation to transmit the JWT, then you should hex encode the JWT so that it satisfies the HTTP token syntax as described in <a href=\"https://tools.ietf.org/html/rfc2616\" rel=\"nofollow noreferrer\">tools.ietf.org/html/rfc2616</a>."}], "owner": {"reputation": 45, "user_id": 11925738, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-yzgOjEUh5dY/AAAAAAAAAAI/AAAAAAAAAsE/jID9yJ_grj0/photo.jpg?sz=128", "display_name": "Sepehr Noori", "link": "https://stackoverflow.com/users/11925738/sepehr-noori"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 70, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1566822860, "creation_date": 1566822860, "question_id": 57658017, "link": "https://stackoverflow.com/questions/57658017/how-can-i-send-a-header-via-websocket-js-and-not-need-a-response", "title": "how can i send a header via websocket js and not need a response", "body": "<p>I have js that is making a websocket connection to my go and i need to send a jwt so i have send it in the header but since my websocket is not making a respond chrome is not allowing me to make the request. So i need to either send a respond or set the header in a way that does not need one.</p>\n\n<p>I have tried to wright on my http response in go but it did not work and i can not send it in URL because of security.</p>\n\n<p>client:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>if (window[\"WebSocket\"]) {\n                conn = new WebSocket(\"ws://127.0.0.1:8080/trip/chat/ws?id={{ trip.id }}\", \"{{ jwt }}\");\n                conn.protocol()\n                conn.onclose = function (evt) {\n                    var item = document.createElement(\"div\");\n                    item.innerHTML = \"&lt;b&gt;Connection closed.&lt;/b&gt;\";\n                    appendLog(item);\n                };\n                conn.onmessage = function (evt) {\n                    var messages = evt.data.split('\\n');\n                    for (var i = 0; i &lt; messages.length; i++) {\n                        var item = document.createElement(\"div\");\n                        item.innerText = messages[i];\n                        appendLog(item);\n                    }\n                };\n</code></pre>\n\n<p>server:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func serveWs(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Yo\"))\n    conn, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    tknstr := r.Header.Get(\"Sec-WebSocket-Protocol\")\n    claims := getTokenConntents(tknstr)\n    trip, ok := r.URL.Query()[\"id\"]\n    if !ok {\n        log.Println(\"Url Param id is missing\")\n        return\n    }\n    id, err := strconv.ParseInt(trip[0], 10, 64)\n    if err != nil {\n        log.Println(err)\n        return\n    }\n    log.Print(\"client made\")\n    if _, ok := Hubs[trip[0]]; !ok {\n        hub := newHub()\n        go hub.run()\n        Hubs[trip[0]] = hub\n    }\n    if claims.Username != \"\" &amp;&amp; claims.Trip == int(id) {\n        client := &amp;Client{hub: Hubs[trip[0]], conn: conn, send: make(chan Message, 256), trip: int(id), claims: claims}\n        client.hub.register &lt;- client\n        go client.serveLastMessages(int(id))\n        go client.writePump()\n        go client.readPump()\n    } else {\n        conn.Close()\n    }\n\n}\n</code></pre>\n\n<p>and this is the error that my chrome sends:\nWebSocket connection to 'ws://127.0.0.1:8080/trip/chat/ws?id=7' failed: Error during WebSocket handshake: Unexpected response code: 200</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 1, "creation_date": 1566819407, "post_id": 57656841, "comment_id": 101763866, "body": "This might help you understand what it means <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">go mod</a>"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1566820282, "post_id": 57656841, "comment_id": 101764281, "body": "It&#39;s just the name of the module, and by extension the import path (prefix) for your package(s). There does not have to be a repository on GitHub."}], "answers": [{"tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": true, "score": 1, "last_activity_date": 1566821269, "creation_date": 1566821269, "answer_id": 57657655, "question_id": 57656841, "link": "https://stackoverflow.com/questions/57656841/golang-and-gqlgen-with-github/57657655#57657655", "title": "Golang and gqlgen with GitHub", "body": "<p>Go has no links with github.</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">Modules</a> allow you use any name you want as a package name, for example</p>\n\n<p><code>go mod init bestPackageEver</code></p>\n\n<p>Using VCS URLs are often used because of the convenience of working with a remote server:</p>\n\n<pre><code>git remote add origin https://github.com/my/repo\ngo mod init github.com/my/repo\n</code></pre>\n\n<p>gqlgen uses github in docks just because their source code is hosed on github.</p>\n\n<p>You can find more details in Russ Cox's <a href=\"https://go.googlesource.com/proposal/+/master/design/24301-versioned-go.md\" rel=\"nofollow noreferrer\">article</a>.</p>\n"}], "owner": {"reputation": 675, "user_id": 1009350, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/a4f312d852fdb5d14bc0095aad012f5a?s=128&d=identicon&r=PG&f=1", "display_name": "The questioner", "link": "https://stackoverflow.com/users/1009350/the-questioner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 101, "favorite_count": 0, "accepted_answer_id": 57657655, "answer_count": 1, "score": -1, "last_activity_date": 1566821269, "creation_date": 1566818086, "question_id": 57656841, "link": "https://stackoverflow.com/questions/57656841/golang-and-gqlgen-with-github", "title": "Golang and gqlgen with GitHub", "body": "<p>I see this line of command in the gqlgen getting started page.</p>\n\n<p><code>go mod init github.com/[username]/gqlgen-todos</code></p>\n\n<p>why Golang is linked to GitHub?</p>\n\n<p>In this case, is it necessary to really initiate the repo in my Github account? Will gqlgen or Golang automatically push the code to GitHub?</p>\n"}, {"tags": ["go", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 99, "user_id": 10068222, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/833f49fb61844eb5b7e216a9fd07041e?s=128&d=identicon&r=PG&f=1", "display_name": "BigFatTom", "link": "https://stackoverflow.com/users/10068222/bigfattom"}, "is_accepted": false, "score": 0, "last_activity_date": 1566894346, "creation_date": 1566894346, "answer_id": 57670550, "question_id": 57655179, "link": "https://stackoverflow.com/questions/57655179/x-mobile-launch-a-android-application-with-given-package-name-string-in-go/57670550#57670550", "title": "x/mobile: Launch a android application with given package name [String] in go", "body": "<p>In android, you should specify the path \"/system/bin/\"(/system/bin/am). Please make sure there are \"am\" in this path.</p>\n"}], "owner": {"reputation": 57, "user_id": 3255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f460776d815e64f35dce5c789bedf19?s=128&d=identicon&r=PG&f=1", "display_name": "user3255980", "link": "https://stackoverflow.com/users/3255980/user3255980"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 36, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566894346, "creation_date": 1566811626, "question_id": 57655179, "link": "https://stackoverflow.com/questions/57655179/x-mobile-launch-a-android-application-with-given-package-name-string-in-go", "title": "x/mobile: Launch a android application with given package name [String] in go", "body": "<p>Following is the function written in go:</p>\n\n<pre><code>func LaunchApplication(packageName string) {\n Query :\n how can I execute application with given packageName\n\n}\n</code></pre>\n\n<p>Generated the java binding [.aar] using gomobile.\nI want to include .aar generated in my android application and call LaunchApplication(\"com.package.name\") from java layer to native go layer and go layer should run the application.</p>\n\n<p>In java application, following is the way to run apk using package name:</p>\n\n<pre><code>Process process = Runtime.getRuntime().exec(\"am start -n com.package.name/com.package.name.ActivityName\");\n</code></pre>\n\n<p>I tried the same in go using:\n<strong>os.exec() function but it is giving error that \"am not found in the $PATH\"</strong></p>\n\n<p>Is there is any other way to do that ?</p>\n"}, {"tags": ["go", "go-sqlite3"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1566806312, "post_id": 57653892, "comment_id": 101757634, "body": "What do you see if you print its type? <code>fmt.Printf(&quot;%T&quot;, err)</code>?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1566807258, "post_id": 57653892, "comment_id": 101758021, "body": "There are no type casts in Go. What your code tries to do is a type assertion. If this tape assertion fails it means you botched up the types. You should read the documentation of the function which returns your error and take a close look at its signature."}], "answers": [{"comments": [{"owner": {"reputation": 513, "user_id": 1353146, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/4b6dc262cc9ad249f9ac3186f1f412e6?s=128&d=identicon&r=PG", "display_name": "Ashish Mittal", "link": "https://stackoverflow.com/users/1353146/ashish-mittal"}, "edited": false, "score": 0, "creation_date": 1566811783, "post_id": 57654117, "comment_id": 101760232, "body": "Many thanks for posting this answer. It works!!!!"}, {"owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "reply_to_user": {"reputation": 513, "user_id": 1353146, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/4b6dc262cc9ad249f9ac3186f1f412e6?s=128&d=identicon&r=PG", "display_name": "Ashish Mittal", "link": "https://stackoverflow.com/users/1353146/ashish-mittal"}, "edited": false, "score": 0, "creation_date": 1566874381, "post_id": 57654117, "comment_id": 101782634, "body": "@AshishMittal :)"}], "tags": [], "owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "is_accepted": true, "score": 1, "last_activity_date": 1566807196, "creation_date": 1566807196, "answer_id": 57654117, "question_id": 57653892, "link": "https://stackoverflow.com/questions/57653892/not-able-to-convert-err-into-go-sqlite3-error/57654117#57654117", "title": "Not able to convert err into go-sqlite3.Error", "body": "<p>try the following example. <code>err.(*sqlite3.Error)</code> is changed to <code>err.(sqlite3.Error)</code></p>\n\n<pre><code>if sqlite3Err, ok := err.(sqlite3.Error); ok {\n    if sqlite3Err.Code == sqlite3.ErrConstraint &amp;&amp;\n        sqlite3Err.ExtendedCode == 1555 {\n        // logic \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 513, "user_id": 1353146, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/4b6dc262cc9ad249f9ac3186f1f412e6?s=128&d=identicon&r=PG", "display_name": "Ashish Mittal", "link": "https://stackoverflow.com/users/1353146/ashish-mittal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "closed_date": 1566893052, "accepted_answer_id": 57654117, "answer_count": 1, "score": -2, "last_activity_date": 1566807663, "creation_date": 1566806259, "last_edit_date": 1566807663, "question_id": 57653892, "link": "https://stackoverflow.com/questions/57653892/not-able-to-convert-err-into-go-sqlite3-error", "closed_reason": "Not suitable for this site", "title": "Not able to convert err into go-sqlite3.Error", "body": "<p><a href=\"https://i.stack.imgur.com/ekA0H.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ekA0H.png\" alt=\"t \"></a></p>\n\n<p>I am trying to convert an err in Go to go-sqlite3.Error, but it fails always.\nAbove image represents the snapshot of my debug windows, which shows that the err is of type go-sqlite3.Error</p>\n\n<p>I am using below code to type cast.</p>\n\n<pre><code>import (\n    \"github.com/mattn/go-sqlite3\"\n)\n\nif err != nil {\n    if sqlite3Err, ok := err.(*sqlite3.Error); ok {\n        if sqlite3Err.Code == sqlite3.ErrConstraint &amp;&amp; sqlite3Err.ExtendedCode == 1555 {\n            // SQLITE3 ERROR 1555 : PRIMARY KEY CONSTRAINT ERROR\n            return errors.New(\"Log Error\")\n        }\n    }\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 1, "creation_date": 1566804072, "post_id": 57653322, "comment_id": 101756758, "body": "What if you change the <code>Login</code> signature to return <code>interface{}</code>?"}, {"owner": {"reputation": 335, "user_id": 1693363, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd4b5f916626e9a535ceb2a0008d6fcd?s=128&d=identicon&r=PG", "display_name": "Vishal", "link": "https://stackoverflow.com/users/1693363/vishal"}, "reply_to_user": {"reputation": 24772, "user_id": 770830, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a3943e02574f64dabaa71603264c9c28?s=128&d=identicon&r=PG", "display_name": "bereal", "link": "https://stackoverflow.com/users/770830/bereal"}, "edited": false, "score": 0, "creation_date": 1566804485, "post_id": 57653322, "comment_id": 101756906, "body": "@bereal That I can do, infact, that&#39;s what I&#39;m doing for now. But, in this case, I&#39;ll lose type checks for handler return data. That I think will create problems in longer term for the code."}], "answers": [{"tags": [], "owner": {"reputation": 171, "user_id": 1503465, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/560dfce511baa205d006d43a57bea1f0?s=128&d=identicon&r=PG", "display_name": "Michael Ernst", "link": "https://stackoverflow.com/users/1503465/michael-ernst"}, "is_accepted": true, "score": 2, "last_activity_date": 1566804428, "creation_date": 1566804428, "answer_id": 57653479, "question_id": 57653322, "link": "https://stackoverflow.com/questions/57653322/golang-http-route-handler-generic-wrapper-implementation/57653479#57653479", "title": "Golang HTTP Route Handler Generic Wrapper Implementation", "body": "<p>To make it compile \n<code>Login(w http.ResponseWriter, r *http.Request) (*AuthenticationResponse, *types.HandlerErrorResponse)</code> needs to be <code>Login(w http.ResponseWriter, r *http.Request) (interface{}, *types.HandlerErrorResponse)</code></p>\n\n<p>However I'd suggest you to define an inteface ( or use an existing one : <code>io.Reader</code> might be what you want ) </p>\n\n<p>Define the methods you need to access from the response and then return that. </p>\n\n<pre><code>type GenericBody interface{\n    Bytes() []byte\n}\n</code></pre>\n\n<p>Now as long as your return object implements this method, you can return it. However, the function signature will have to include this new type. </p>\n"}], "owner": {"reputation": 335, "user_id": 1693363, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fd4b5f916626e9a535ceb2a0008d6fcd?s=128&d=identicon&r=PG", "display_name": "Vishal", "link": "https://stackoverflow.com/users/1693363/vishal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 57653479, "answer_count": 1, "score": -1, "last_activity_date": 1566804428, "creation_date": 1566803707, "question_id": 57653322, "link": "https://stackoverflow.com/questions/57653322/golang-http-route-handler-generic-wrapper-implementation", "title": "Golang HTTP Route Handler Generic Wrapper Implementation", "body": "<p>I'm trying to convert a route handler which returns response body and error instead of directly writing it to response writer. \nThen I want to send success/error response from the wrapper function instead.</p>\n\n<p>It'll help me add tracing and metrics in a common place for all routes.</p>\n\n<p>To achieve that, I tried this:</p>\n\n<pre><code>router.HandleFunc(app, \"/login\", WrapHandler(Login)).Methods(\"POST\")\n</code></pre>\n\n<pre><code>func WrapHandler(handler func(http.ResponseWriter, *http.Request) (interface{}, *types.HandlerErrorResponse)) func(http.ResponseWriter, *http.Request) {\n    return func(w http.ResponseWriter, r *http.Request) {\n        response, errResponse := handler(w, r)\n\n        sendResponse(r.Context(), w, response, errResponse)\n    }\n}\n</code></pre>\n\n<p>Login is an interface with signature:</p>\n\n<pre><code>Login(w http.ResponseWriter, r *http.Request) (*AuthenticationResponse, *types.HandlerErrorResponse)\n</code></pre>\n\n<p>Now, with this code the error comes in compilation:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>cannot use Login (type func(http.ResponseWriter, *http.Request) (*AuthenticationResponse, *types.HandlerErrorResponse)) as type func(http.ResponseWriter, *http.Request) (interface {}, *types.HandlerErrorResponse) in argument to WrapHandlerNew\n</code></pre>\n\n<p>But, to make generic Wrapper, I have to make my response body as interface.</p>\n\n<p>Please let me know, how can I achieve it.</p>\n"}, {"tags": ["regex", "go", "regex-greedy"], "comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566803706, "post_id": 57653290, "comment_id": 101756610, "body": "Jutst a negated <code>[</code>, <code>(?:\\[\\d{2}])+[^[]</code>, should do thew job. Also, regex is not language-agnostic."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566803869, "post_id": 57653290, "comment_id": 101756680, "body": "<a href=\"https://play.golang.com/p/TYzR6k_PPN5\" rel=\"nofollow noreferrer\">play.golang.com/p/TYzR6k_PPN5</a>"}, {"owner": {"reputation": 113, "user_id": 7830844, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/thEYV.png?s=128&g=1", "display_name": "Garlic Xu", "link": "https://stackoverflow.com/users/7830844/garlic-xu"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566804041, "post_id": 57653290, "comment_id": 101756746, "body": "@mkopriva This one won&#39;t match if the &#39;any character&#39; part is not a <code>\\w</code> character, e.g. <code>[11][22][33]---dd</code> won&#39;t match"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1566804083, "post_id": 57653290, "comment_id": 101756764, "body": "The question is, do you want to match <code>[11][22][33][some text here</code>?"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1566804584, "post_id": 57653290, "comment_id": 101756941, "body": "The problem here is caused by backtracking, once the pattern does not match, the quantified pattern lets the engine backtrack to find another way to match the string, and once the path succeeds, the match is returned. Possessive quantifiers and capturing groups inside lookaheads with backreference later won&#39;t work in Go regex. So, the only way to solve this is to write a more precise pattern, but you need to precise the rules."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566804751, "post_id": 57653290, "comment_id": 101757000, "body": "Well, try <code>(?:\\[\\d{2}])+(?:\\[(?:\\D|\\d\\D|\\d{2}[^]])|[^\\[]|\\[(?:\\d?|\\d{3,&zwnj;&#8203;})])</code>, see <a href=\"https://regex101.com/r/mlPKMx/2\" rel=\"nofollow noreferrer\">regex101.com/r/mlPKMx/2</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566805529, "post_id": 57653290, "comment_id": 101757308, "body": "<a href=\"https://play.golang.com/p/nvMY2kSB4J2\" rel=\"nofollow noreferrer\">play.golang.com/p/nvMY2kSB4J2</a>"}, {"owner": {"reputation": 113, "user_id": 7830844, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/thEYV.png?s=128&g=1", "display_name": "Garlic Xu", "link": "https://stackoverflow.com/users/7830844/garlic-xu"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566807180, "post_id": 57653290, "comment_id": 101757991, "body": "@WiktorStribi\u017cew Thanks for your suggestion, and <a href=\"https://github.com/golang/go/issues/7713\" rel=\"nofollow noreferrer\">this issue</a> seems to suggest that support of possessive quantifiers is currently unplanned. For now I&#39;d simply switch the final quantifier to <code>*</code> and do an extra check on whether the final part is empty."}, {"owner": {"reputation": 113, "user_id": 7830844, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/thEYV.png?s=128&g=1", "display_name": "Garlic Xu", "link": "https://stackoverflow.com/users/7830844/garlic-xu"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566808260, "post_id": 57653290, "comment_id": 101758524, "body": "@WiktorStribi\u017cew Similar to @mkopriva&#39;s, I&#39;m using <code>(\\[\\d{2}])+(.*)</code> and checking whether the 2nd match group is empty"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566809053, "post_id": 57653290, "comment_id": 101758850, "body": "@GarlicXu Thtat might be the best approach here unless all the strings you have match <code>\\[\\d{2}]</code> pattern."}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1566810893, "post_id": 57653290, "comment_id": 101759788, "body": "I think you should precise the question: you want to return <code>true</code> if there is a <code>\\[\\d{2}]</code> pattern match NOT at the end of the string. Right?"}], "answers": [{"tags": [], "owner": {"reputation": 310, "user_id": 11901036, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cKY2y.jpg?s=128&g=1", "display_name": "Klienblat Moshe", "link": "https://stackoverflow.com/users/11901036/klienblat-moshe"}, "is_accepted": false, "score": 0, "last_activity_date": 1566808439, "creation_date": 1566808439, "answer_id": 57654398, "question_id": 57653290, "link": "https://stackoverflow.com/questions/57653290/fail-the-regex-match-at-the-end-of-the-string-in-go/57654398#57654398", "title": "Fail the regex match at the end of the string in Go", "body": "<p>the regular expression you need to use is i presume goes like that:</p>\n\n<pre><code>(\\[[0-9]{2}\\]){1,}[a-z]{1,}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 2, "last_activity_date": 1566811431, "creation_date": 1566811431, "answer_id": 57655136, "question_id": 57653290, "link": "https://stackoverflow.com/questions/57653290/fail-the-regex-match-at-the-end-of-the-string-in-go/57655136#57655136", "title": "Fail the regex match at the end of the string in Go", "body": "<p>You may use</p>\n\n<pre><code>re := regexp.MustCompile(`(?:\\[\\d{2}])+(.*)`)\nmatch := re.FindStringSubmatch(s)\nif len(match) &gt; 1 {\n    return match[1] != \"\"\n}\nreturn false\n</code></pre>\n\n<p>The <code>(?:\\[\\d{2}])+(.*)</code> pattern matches 1+ occurrences of <code>[</code>, 2 digits, <code>]</code> and then captures any 0 or more chars other than line break chars into Group 1. Then, if the match was found (<code>if len(match) &gt; 1</code>), <code>true</code> should be returned if the Group 1 value is not empty (<code>match[1] != \"\"</code>), otherwise, <code>false</code> is returned.</p>\n\n<p>See <a href=\"https://play.golang.com/p/Z-_rpEKE8qr\" rel=\"nofollow noreferrer\">Go demo</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    strs := []string{\n        \"[11][22][33]\",\n        \"___[11][22][33]\",\n        \"[11][22][33]____\",\n        \"[11][22]____[33]\",\n    }\n    for _, str := range strs {\n        fmt.Printf(\"%q - %t\\n\", str, match(str))\n    }\n}\n\nvar re = regexp.MustCompile(`(?:\\[\\d{2}])+(.*)`)\n\nfunc match(s string) bool {\n    match := re.FindStringSubmatch(s)\n    if len(match) &gt; 1 {\n        return match[1] != \"\"\n    }\n    return false\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>\"[11][22][33]\" - false\n\"___[11][22][33]\" - false\n\"[11][22][33]____\" - true\n\"[11][22]____[33]\" - true\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 7830844, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/thEYV.png?s=128&g=1", "display_name": "Garlic Xu", "link": "https://stackoverflow.com/users/7830844/garlic-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 415, "favorite_count": 0, "accepted_answer_id": 57655136, "answer_count": 2, "score": 0, "last_activity_date": 1566811472, "creation_date": 1566803563, "last_edit_date": 1566811472, "question_id": 57653290, "link": "https://stackoverflow.com/questions/57653290/fail-the-regex-match-at-the-end-of-the-string-in-go", "title": "Fail the regex match at the end of the string in Go", "body": "<p>I'm trying to test a string against this pattern: \"At least one square bracket pair, wrapping 2 digits, followed by at lease one  character\". For example, <code>[11][22][33]dd</code> should match while <code>[11][22][33]</code> shouldn't.</p>\n\n<p>I've tried this regex: <code>(\\[\\d{2}])+.+</code>. However, when it is tested against with <code>[11][22][33]</code>, which should have failed, it still passes that test. The first <code>+</code> quantifier only matches two groups <code>[11]</code> and <code>[22]</code>, while the rest part <code>[33]</code> is matched by <code>.+</code>.</p>\n\n<p>I thought the \"greedy\" behaviour of the <code>+</code> quantifier would exhaust all the matching segments of the group it modifies; however it seems that the regex engine would place the \"exhaust all matching possibilities\" principle above the \"greedy quantifier\" rule, not the way I'd expected.</p>\n\n<p>How should I achieve my goal?</p>\n\n<p>(This question is actually language-agnostic, though tagged with \"golang\" which is the language I'm currently using.)</p>\n"}, {"tags": ["go", "select", "channel"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1566803430, "post_id": 57653111, "comment_id": 101756493, "body": "Any <code>case</code> in a select happens only if it <i>can</i> happen. If there is nobody to read from your oc (or in your case even worse you do not have a made oc) the default happens. The Tour of Go explains this in detail."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 6, "last_activity_date": 1566806058, "last_edit_date": 1566806058, "creation_date": 1566802795, "answer_id": 57653132, "question_id": 57653111, "link": "https://stackoverflow.com/questions/57653111/why-a-select-in-go-always-goes-to-default-case-when-non-default-is-a-input-chann/57653132#57653132", "title": "Why a select in go always goes to default case when non default is a input channel?", "body": "<p>You never initialized the <code>oc</code> channel, so it is <code>nil</code>, and sending on a <code>nil</code> channel blocks forever. And the <code>select</code> statement chooses <code>default</code> if there are no ready cases.</p>\n\n<p>You have to initialize the channel. And if there are no receivers, it must have \"some\" buffer to accommodate the element you want to send on it, else the send would also block.</p>\n\n<p>This works the way you want it to (try it on the <a href=\"https://play.golang.org/p/RszxxnMU60I\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>var oc chan object\noc = make(chan object, 1)\n</code></pre>\n\n<p>See related: <a href=\"https://stackoverflow.com/questions/39015602/how-does-a-non-initialized-channel-behave/39016004#39016004\">How does a non initialized channel behave?</a></p>\n"}], "owner": {"reputation": 11, "user_id": 11976945, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-c020q1KCVjE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rfmYGR_4n2N50hcrz1LKWMf3dv9KQ/photo.jpg?sz=128", "display_name": "pavan", "link": "https://stackoverflow.com/users/11976945/pavan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1566806058, "creation_date": 1566802634, "last_edit_date": 1566803466, "question_id": 57653111, "link": "https://stackoverflow.com/questions/57653111/why-a-select-in-go-always-goes-to-default-case-when-non-default-is-a-input-chann", "title": "Why a select in go always goes to default case when non default is a input channel?", "body": "<p>I am new to go programming. Here is my piece of code. I am trying to assign value to a struct and assigning that struct to  go channel. But it is not setting it and going to default case.</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n)\ntype object struct {\n    a int\n    b string\n}\nfunc main() {\n\n    o1 := object{\n        a: 25,\n        b: \"quack\",\n    }\n\n    var oc chan object\n    select {\n    case oc &lt;- o1:\n        fmt.Println(\"Chan is set\")\n    default:\n        fmt.Println(\"Chan is not set\")\n    }\n}\n</code></pre>\n"}, {"tags": ["user-interface", "go", "fyne"], "comments": [{"owner": {"reputation": 141, "user_id": 1782149, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/df21e0a05d621d59a147b9091a56ebdc?s=128&d=identicon&r=PG", "display_name": "gernotstarke", "link": "https://stackoverflow.com/users/1782149/gernotstarke"}, "edited": false, "score": 0, "creation_date": 1609751109, "post_id": 57651536, "comment_id": 115910355, "body": "you could try with a canvas element, as outlined here: <a href=\"https://stackoverflow.com/a/64416951/1782149\">stackoverflow.com/a/64416951/1782149</a>"}], "answers": [{"comments": [{"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566798847, "post_id": 57651866, "comment_id": 101754945, "body": "This is quite correct. The only way to have a widget that is is styled differently to the standard colours is to implement a custom widget and add that functionality yourself."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566798915, "post_id": 57651866, "comment_id": 101754973, "body": "There are, however, some semantic styles, a button can be \u201cprimary, for example, in which case it will use the theme highlight color."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566799541, "post_id": 57651866, "comment_id": 101755165, "body": "@ajwillia.ms You wouldn&#39;t be <a href=\"https://github.com/andydotxyz\" rel=\"nofollow noreferrer\">github.com/andydotxyz</a>, one of the authors/main contributors (<a href=\"https://github.com/fyne-io/fyne/blob/master/AUTHORS\" rel=\"nofollow noreferrer\">github.com/fyne-io/fyne/blob/master/AUTHORS</a>) of <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">github.com/fyne-io/fyne</a>, by any chance?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566799653, "post_id": 57651866, "comment_id": 101755212, "body": "@ajwillia.ms I have included your comments in the answer for more visibility."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566802946, "post_id": 57651866, "comment_id": 101756313, "body": "It will be great if you can post some code here outlining major steps to create <code>a custom label</code>."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566893842, "post_id": 57651866, "comment_id": 101788218, "body": "Hi @VonC, yup that\u2019s me :)"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566893924, "post_id": 57651866, "comment_id": 101788260, "body": "Sorry @rnso we\u2019re not encouraging custom components until next release when the process will be simpler. In general it\u2019s strongly advised to use the standard, themable, well tested components"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566894394, "post_id": 57651866, "comment_id": 101788484, "body": "I hadn&#39;t noticed my nick here was out of date, fixed :)"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 4, "last_activity_date": 1566799633, "last_edit_date": 1566799633, "creation_date": 1566794634, "answer_id": 57651866, "question_id": 57651536, "link": "https://stackoverflow.com/questions/57651536/how-to-change-color-of-gui-components/57651866#57651866", "title": "How to change color of GUI components", "body": "<p>That was proposed in <a href=\"https://github.com/fyne-io/fyne/issues/255\" rel=\"nofollow noreferrer\"><code>fyne-io/fyne</code> issue 255</a></p>\n\n<blockquote>\n  <p>I propose individual styles assignable to widgets:</p>\n</blockquote>\n\n<p>But:</p>\n\n<blockquote>\n  <p>Part of our design is to promote application consistency - a user experience that cannot be trivially compromised by \"this label is larger\" or \"this dropdown is transparent\".</p>\n  \n  <p>Fyne's approach to this is that widgets have a set style (that can be themed) but the canvas remains fully available to do whatever specific designs a developer chooses to code.</p>\n</blockquote>\n\n<p>So there is no native support to change the color of an individual button.</p>\n\n<p><a href=\"https://github.com/andydotxyz\" rel=\"nofollow noreferrer\">Andy Williams</a>, author/main contributor of <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">fyne-io/fyne</a>, adds <a href=\"https://stackoverflow.com/questions/57651536/how-to-change-color-of-gui-components/57651866?noredirect=1#comment101754973_57651866\">in the comments</a>:</p>\n\n<blockquote>\n  <p>This is quite correct.<br>\n  The only way to have a widget that is is styled differently to the standard colours is to implement a custom widget and add that functionality yourself. </p>\n  \n  <p>There are, however, some semantic styles, a button can be \u201cprimary, for example, in which case it will use the theme highlight color</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "is_accepted": true, "score": 1, "last_activity_date": 1566894714, "creation_date": 1566894714, "answer_id": 57670641, "question_id": 57651536, "link": "https://stackoverflow.com/questions/57651536/how-to-change-color-of-gui-components/57670641#57670641", "title": "How to change color of GUI components", "body": "<p>As the standard widgets in Fyne do not support customisation there is no short answer to this (other than we don't advise it).</p>\n\n<p>If you have to do this, for some valid reason that your users require, then you should look at our developer documentation which has a brief introduction to writing <a href=\"https://fyne.io/develop/custom-widget.html\" rel=\"nofollow noreferrer\">custom widgets</a>. However we aim to make this process easier in release 1.2 later this year.</p>\n\n<p>Just to re-iterate comments above the Fyne toolkit is aiming to create a consistent user experience that is simple and fast to program. Every time you create a custom widget so that you can have custom colours or styles you may be confusing your user and you will be making it much harder to maintain the code.</p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1091, "favorite_count": 1, "accepted_answer_id": 57670641, "answer_count": 2, "score": 3, "last_activity_date": 1566894714, "creation_date": 1566791353, "question_id": 57651536, "link": "https://stackoverflow.com/questions/57651536/how-to-change-color-of-gui-components", "title": "How to change color of GUI components", "body": "<p>I am trying following demo code of <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\"><code>fyne</code></a>: </p>\n\n<pre><code>package main\nimport (\n    \"fyne.io/fyne/app\"\n    \"fyne.io/fyne/widget\"\n)\nfunc main() {\n    a := app.New()\n    w := a.NewWindow(\"Hello\")\n    w.SetContent(\n        widget.NewVBox(\n            widget.NewLabel(\"Hello Fyne!\"),\n            widget.NewButton(\"Quit\", func(){a.Quit()} ),\n        ),\n    )\n    w.ShowAndRun()\n}\n</code></pre>\n\n<p>It runs all right but I want to change color of label to blue and that of button to green. I see there is <a href=\"https://github.com/fyne-io/fyne/tree/master/theme\" rel=\"nofollow noreferrer\"><code>theme</code></a> but that seems to be for entire application and not for individual elements. </p>\n\n<p>How can different colors be applied to different GUI components? Thanks for your help.</p>\n"}, {"tags": ["go", "logging"], "answers": [{"comments": [{"owner": {"reputation": 2585, "user_id": 3061689, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/kUP4K.jpg?s=128&g=1", "display_name": "Eddwin Paz", "link": "https://stackoverflow.com/users/3061689/eddwin-paz"}, "edited": false, "score": 0, "creation_date": 1566791732, "post_id": 57651572, "comment_id": 101753389, "body": "You are right, I was actually reading about this. Thanks. There is now a strange behavior and it&#39;s that it outputs JSON and not the nice formatted colored console log. any Ideas? @bserdar"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 2585, "user_id": 3061689, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/kUP4K.jpg?s=128&g=1", "display_name": "Eddwin Paz", "link": "https://stackoverflow.com/users/3061689/eddwin-paz"}, "edited": false, "score": 0, "creation_date": 1566791902, "post_id": 57651572, "comment_id": 101753414, "body": "You commented out the text formatter and set up the JSON formatter instead, that&#39;s why it is printing out JSON logs. It is the SetFormatter function."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 3, "last_activity_date": 1567120059, "last_edit_date": 1567120059, "creation_date": 1566791663, "answer_id": 57651572, "question_id": 57651476, "link": "https://stackoverflow.com/questions/57651476/logrus-how-to-print-con-console-log/57651572#57651572", "title": "Logrus: How to print con console log", "body": "<p>You can try writing to multiple targets:</p>\n\n<pre><code>mylog.SetOutput(io.MultiWriter(file, os.Stdout))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 75, "user_id": 495836, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cf94462872707bd5550e6900e4e217c8?s=128&d=identicon&r=PG", "display_name": "safepost", "link": "https://stackoverflow.com/users/495836/safepost"}, "is_accepted": false, "score": 0, "last_activity_date": 1611045797, "creation_date": 1611045797, "answer_id": 65787987, "question_id": 57651476, "link": "https://stackoverflow.com/questions/57651476/logrus-how-to-print-con-console-log/65787987#65787987", "title": "Logrus: How to print con console log", "body": "<p>If you use logrus you should better use hooks which is recommanded by documentation.</p>\n<p>See : <a href=\"https://github.com/rifflock/lfshook\" rel=\"nofollow noreferrer\">https://github.com/rifflock/lfshook</a> for examples.</p>\n<p>Using multiwriter is not optimal, because you can't have a different formatting for stdout and file, what you generally want to (colors for stdout and different timestamp for file for example).</p>\n"}], "owner": {"reputation": 2585, "user_id": 3061689, "user_type": "registered", "accept_rate": 44, "profile_image": "https://i.stack.imgur.com/kUP4K.jpg?s=128&g=1", "display_name": "Eddwin Paz", "link": "https://stackoverflow.com/users/3061689/eddwin-paz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1256, "favorite_count": 0, "accepted_answer_id": 57651572, "answer_count": 2, "score": -2, "last_activity_date": 1617717717, "creation_date": 1566790458, "last_edit_date": 1617717717, "question_id": 57651476, "link": "https://stackoverflow.com/questions/57651476/logrus-how-to-print-con-console-log", "title": "Logrus: How to print con console log", "body": "<p>Implementing Logrus Go package. File is saved but stopped printing out on the console the logs only visible in created .log file called vendor.log. </p>\n\n<p>Here is the code currently using.</p>\n\n<pre><code>\npackage logging\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    mylog \"github.com/sirupsen/logrus\"\n)\n\n// InitializeLogging asdas\nfunc InitializeLogging(logFile string) {\n\n    var file, err = os.OpenFile(logFile, os.O_RDWR|os.O_CREATE|os.O_APPEND, 0666)\n    if err != nil {\n        fmt.Println(\"Could Not Open Log File : \" + err.Error())\n    }\n    mylog.SetOutput(file)\n\n    //log.SetFormatter(&amp;log.TextFormatter{})\n    mylog.SetFormatter(&amp;mylog.JSONFormatter{})\n}\n</code></pre>\n"}, {"tags": ["go", "visual-studio-code", "vscode-debugger", "delve"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 1, "last_activity_date": 1566795729, "creation_date": 1566795729, "answer_id": 57652008, "question_id": 57651058, "link": "https://stackoverflow.com/questions/57651058/how-can-i-simulate-interactive-console-in-vscode-debugger/57652008#57652008", "title": "How can I simulate interactive console in VSCode debugger?", "body": "<p>This is followed by <a href=\"https://github.com/Microsoft/vscode-go/issues/219\" rel=\"nofollow noreferrer\">Microsoft/vscode-go issue 219</a>, and still open.</p>\n\n<blockquote>\n  <p>Yes - the VS Code debugger console doesn't currently support piping any input through to stdin.</p>\n  \n  <p>FYI, you can tell the Code debugger to use an external console in the launch config:</p>\n\n<pre><code>\"externalConsole\": true\n</code></pre>\n</blockquote>\n\n<p>It has a <a href=\"https://github.com/Microsoft/vscode-go/issues/219#issuecomment-449621513\" rel=\"nofollow noreferrer\">possible workaround</a>, using remote debug + vscode task, but that is not trivial.</p>\n\n<blockquote>\n  <p><code>task.json</code></p>\n</blockquote>\n\n<pre><code>{\n    // See https://go.microsoft.com/fwlink/?LinkId=733558\n    // for the documentation about the tasks.json format\n    \"version\": \"2.0.0\",\n    \"tasks\": [\n        {\n            \"label\": \"echo\",\n            \"type\": \"shell\",\n            \"command\": \"cd ${fileDirname} &amp;&amp; dlv debug --headless --listen=:2345 --log --api-version=2\",\n            \"problemMatcher\": [],\n            \"group\": {\n                \"kind\": \"build\",\n                \"isDefault\": true\n            }\n        }\n    ]\n}\n</code></pre>\n\n<blockquote>\n  <p><code>launch.json</code>:</p>\n</blockquote>\n\n<pre><code>{\n    // Use IntelliSense to learn about possible attributes.\n    // Hover to view descriptions of existing attributes.\n    // For more information, visit: https://go.microsoft.com/fwlink/?linkid=830387\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Connect to server\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"remote\",\n            \"remotePath\": \"${fileDirname}\",\n            \"port\": 2345,\n            \"host\": \"127.0.0.1\",\n            \"program\": \"${fileDirname}\",\n            \"env\": {},\n            \"args\": []\n        }\n    ]\n}\n</code></pre>\n\n<blockquote>\n  <p>Run the task using shortcut key(shift + cmd + B in Mac OS), vscode will start a new shell and run the delve server.</p>\n  \n  <p>Pressing F5 to debug the .go file. It works fine for me.</p>\n</blockquote>\n"}], "owner": {"reputation": 881, "user_id": 9534591, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wxvb4.png?s=128&g=1", "display_name": "ik1ne", "link": "https://stackoverflow.com/users/9534591/ik1ne"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1114, "favorite_count": 1, "accepted_answer_id": 57652008, "answer_count": 1, "score": 1, "last_activity_date": 1566795729, "creation_date": 1566784936, "last_edit_date": 1566792553, "question_id": 57651058, "link": "https://stackoverflow.com/questions/57651058/how-can-i-simulate-interactive-console-in-vscode-debugger", "title": "How can I simulate interactive console in VSCode debugger?", "body": "<p>I am trying to debug this Go program which reads text and outputs it to console via VSCode debugger.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    reader := bufio.NewReader(os.Stdin)\n    fmt.Print(\"Enter text: \")\n    text, _ := reader.ReadString('\\n')\n    fmt.Println(text)\n}\n</code></pre>\n\n<p>It runs fine on terminal, but when I debug it with VSCode I can't type anything even if I focus the debug output.</p>\n\n<p>There's a console in the debug section but it's REPL evaluator so it also isn't related to terminal console.</p>\n\n<p>How can I enable console in VSCode so I can type a text to the program?</p>\n"}, {"tags": ["http", "go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566808257, "post_id": 57650645, "comment_id": 101758523, "body": "&quot;Also the code I have now will take 4 seconds&quot; -- Fix this by getting rid of the explicit delay. What purpose is that meant to serve?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566808631, "post_id": 57650645, "comment_id": 101758672, "body": "Also the code you&#39;ve included won&#39;t even compile. It would be nice to use <i>actual code</i> in your question."}], "answers": [{"tags": [], "owner": {"reputation": 4248, "user_id": 1832966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bbc5a2b0d0f59c23c20aafce9309773?s=128&d=identicon&r=PG", "display_name": "Kyle Lemons", "link": "https://stackoverflow.com/users/1832966/kyle-lemons"}, "is_accepted": false, "score": 3, "last_activity_date": 1566780054, "creation_date": 1566780054, "answer_id": 57650717, "question_id": 57650645, "link": "https://stackoverflow.com/questions/57650645/cancel-http-handler-request/57650717#57650717", "title": "Cancel Http handler request", "body": "<p>To begin, I highly recommend taking a look at the <a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">Context blog post</a> to familiarize yourself with contexts, in addition to reading over the <a href=\"http://golang.org/pkg/context\" rel=\"nofollow noreferrer\"><code>context</code> documentation</a> itself.</p>\n\n<p>To address your specific questions:</p>\n\n<p><strong>How can you cancel the database query if the user cancels their quest?</strong></p>\n\n<p>To make this work, there are a few things you want to check:</p>\n\n<ol>\n<li>Ensure that your database driver (if you are using <code>database/sql</code>) supports context cancellation.</li>\n<li>Ensure you are using the Context variants of all available methods (e.g. <a href=\"https://golang.org/pkg/database/sql/#DB.QueryContext\" rel=\"nofollow noreferrer\"><code>db.QueryContext</code></a> instead of <a href=\"https://golang.org/pkg/database/sql/#DB.Query\" rel=\"nofollow noreferrer\"><code>db.Query</code></a>).</li>\n<li>Ensure that you are passing the context (or a derivative of the context) through the stack from your HTTP request through to the database calls.</li>\n</ol>\n\n<p><strong>Do I need to pass the ctx to F1()?</strong></p>\n\n<p>Per #3 above, yes: you will need to pass the context through all intermediate calls to \"connect\" the database call with the request context.</p>\n\n<p><strong>How can I return as soon as F1() returns?</strong></p>\n\n<p>The code that you have in your question calls <code>F1</code> in series, rather than concurrently, with your cancellation/timeout <code>select</code>.</p>\n\n<p>If you want to apply a specific deadline to your database call, use <a href=\"http://golang.org/pkg/context#WithTimeout\" rel=\"nofollow noreferrer\"><code>context.WithTimeout</code></a> to limit how long it can take.  Otherwise, you do not need to do anything special: just call <code>F1</code> with your context, and the rest will happen for you, no <code>select</code> is needed.</p>\n"}], "owner": {"reputation": 79, "user_id": 9240773, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8a7fd90d8f55f1ef5bc2111c92868acd?s=128&d=identicon&r=PG&f=1", "display_name": "Julia12", "link": "https://stackoverflow.com/users/9240773/julia12"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 237, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566808177, "creation_date": 1566779062, "last_edit_date": 1566808177, "question_id": 57650645, "link": "https://stackoverflow.com/questions/57650645/cancel-http-handler-request", "title": "Cancel Http handler request", "body": "<p>I have handlers that respond to https requests. In the handlers I call a function F1() which does some application logic and connects to a mysql db and does a query. I want to know how I can use the golang context package to cancel the Db  query if the client cancels the request. Do I need to pass the ctx to F1()? Also the code I have now will take 4 seconds even if F1() returns in  less then 4. How can I return as soon as F1() returns?</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n\n  ctx:= r.context()\n\n  F1()\n\n\n select {\n\n     case &lt;-ctx.Done():\n\n     case &lt;- time.After( 4*time.Second):\n\n   }\n\n\n   w.WriteHeader(http.statusOk)\n  return \n\n }\n</code></pre>\n"}, {"tags": ["file", "go", "download", "go-gin"], "comments": [{"owner": {"reputation": 503, "user_id": 3128757, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/34e590f6ccedcccb0c95084f87371db4?s=128&d=identicon&r=PG&f=1", "display_name": "Cherry", "link": "https://stackoverflow.com/users/3128757/cherry"}, "edited": false, "score": 0, "creation_date": 1566835138, "post_id": 57649633, "comment_id": 101771614, "body": "It will be helpful... If you provide some explanation before you downvote."}], "answers": [{"tags": [], "owner": {"reputation": 2559, "user_id": 740182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/znKux.jpg?s=128&g=1", "display_name": "Akshaydeep Giri", "link": "https://stackoverflow.com/users/740182/akshaydeep-giri"}, "is_accepted": true, "score": 2, "last_activity_date": 1566798153, "creation_date": 1566798153, "answer_id": 57652331, "question_id": 57649633, "link": "https://stackoverflow.com/questions/57649633/how-to-return-a-files-or-images-path-urls-to-forntend-using-golang-rest-apis/57652331#57652331", "title": "How to return a files or images path urls to forntend using golang rest apis?", "body": "<p>First, you should store the image name in the database.</p>\n\n<p>To serve the static assets (image file) in gin you have to define a static route.</p>\n\n<pre><code>router := gin.Default()\nrouter.Static(\"/image\", \"./path-to-image-dir\")\n</code></pre>\n\n<p>file path will look something like that</p>\n\n<pre><code>http://myapp.com/image/filename.jpg\n</code></pre>\n\n<p>but i will recommend you to use a custom header for serving images content using <code>bind-header</code> method that way you will have more control. you can read more about it in the gin documentation.</p>\n\n<p><a href=\"https://github.com/gin-gonic/gin#bind-header\" rel=\"nofollow noreferrer\">https://github.com/gin-gonic/gin#bind-header</a></p>\n"}], "owner": {"reputation": 503, "user_id": 3128757, "user_type": "registered", "accept_rate": 31, "profile_image": "https://www.gravatar.com/avatar/34e590f6ccedcccb0c95084f87371db4?s=128&d=identicon&r=PG&f=1", "display_name": "Cherry", "link": "https://stackoverflow.com/users/3128757/cherry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2448, "favorite_count": 0, "accepted_answer_id": 57652331, "answer_count": 1, "score": 1, "last_activity_date": 1597430845, "creation_date": 1566766230, "last_edit_date": 1597430845, "question_id": 57649633, "link": "https://stackoverflow.com/questions/57649633/how-to-return-a-files-or-images-path-urls-to-forntend-using-golang-rest-apis", "title": "How to return a files or images path urls to forntend using golang rest apis?", "body": "<p>I am using Golang(gin-gonic framework) for my backend. I have developed below rest API to receive images or files from the frontend applications. I am saving files in this path \"/home/user/Desktop/files/\"+dt.String()+\"_\"+filepath.Base(file.Filename). Till now everything fine, I can see the saved files.</p>\n\n<p>Now I am planning to return these file paths to frontend via another rest API (Eg: API: /getImageUrl, Response: <a href=\"https://via.placeholder.com/600/771796\" rel=\"nofollow noreferrer\">https://via.placeholder.com/600/771796</a>) so that users can download files. But I am not sure how to return these file path URLs to frontend. Can somebody guide me on how to develop this rest API?</p>\n\n<pre><code>               requests.POST(\"/upload\", func(c *gin.Context) {\n\n                    // Source\n                    file, err := c.FormFile(\"file\")\n                    if err != nil {\n                        c.String(http.StatusBadRequest, fmt.Sprintf(\"get form err: %s\", err.Error()))\n                        return\n                    }\n\n                    dt := time.Now()\n\n                    filename := \"/home/user/Desktop/files/\"+dt.String()+\"_\"+filepath.Base(file.Filename)\n\n                    if err := c.SaveUploadedFile(file, filename); err != nil {\n                        c.String(http.StatusBadRequest, fmt.Sprintf(\"upload file err: %s\", err.Error()))\n                        return\n                    }\n\n                    c.JSON(200, gin.H{\"message\": \"Files Uploaded Successfully\"})\n                }) \n</code></pre>\n"}, {"tags": ["javascript", "string", "go"], "comments": [{"owner": {"reputation": 253893, "user_id": 9515207, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/34932d3e923ffad9a4a1423e30b1d9fc?s=128&d=identicon&r=PG&f=1", "display_name": "CertainPerformance", "link": "https://stackoverflow.com/users/9515207/certainperformance"}, "edited": false, "score": 3, "creation_date": 1566766287, "post_id": 57649632, "comment_id": 101749767, "body": "Are you attempting to answer your own question? If so, you should put the answer in the Answer box. (or are you having a problem with the code? - in which case you should describe the problems you&#39;re having with it)"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1566766356, "creation_date": 1566766356, "answer_id": 57649647, "question_id": 57649632, "link": "https://stackoverflow.com/questions/57649632/convert-from-base-10-to-any-base-in-between-2-and-36-go/57649647#57649647", "title": "Convert from base 10 to any base in between 2 and 36 Go", "body": "<p>In Go you have <a href=\"https://golang.org/pkg/strconv/#FormatInt\" rel=\"noreferrer\"><code>strconv.FormatInt()</code></a> (and <a href=\"https://golang.org/pkg/strconv/#FormatUint\" rel=\"noreferrer\"><code>strconv.FormatUint()</code></a>):</p>\n\n<pre><code>fmt.Println(strconv.FormatInt(12345, 2))\nfmt.Println(strconv.FormatInt(12345, 16))\nfmt.Println(strconv.FormatInt(12345, 32))\n</code></pre>\n\n<p>This will output (try it on the <a href=\"https://play.golang.org/p/N4F44DAiB77\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>11000000111001\n3039\nc1p\n</code></pre>\n"}], "owner": {"reputation": 421, "user_id": 4934096, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/E5Yal.jpg?s=128&g=1", "display_name": "Bamidele Alegbe", "link": "https://stackoverflow.com/users/4934096/bamidele-alegbe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "closed_date": 1566838589, "answer_count": 1, "score": -2, "last_activity_date": 1575449389, "creation_date": 1566766228, "last_edit_date": 1575449389, "question_id": 57649632, "link": "https://stackoverflow.com/questions/57649632/convert-from-base-10-to-any-base-in-between-2-and-36-go", "closed_reason": "Needs details or clarity", "title": "Convert from base 10 to any base in between 2 and 36 Go", "body": "<p>how can one convert from base 10 to any base  2-36 in go?</p>\n\n<p>in javascript you just </p>\n\n<pre><code>Number.toString(radix?)\n</code></pre>\n\n<p>e.g.</p>\n\n<p>var number = 12345;\nconsole.log(my_number.toString(36).toUpperCase()); </p>\n\n<p>in go this is how you can achieve the same effect</p>\n\n<pre><code>func convertToAnyBase2to36(num int64, base int64) string {\n    var len int64 = base\n    var source_string = []string{\"0\", \"1\", \"2\", \"3\", \"4\", \"5\", \"6\", \"7\", \"8\", \"9\", \"A\", \"B\", \"C\", \"D\", \"E\", \"F\", \"G\", \"J\", \"I\", \"J\", \"K\",\n    \"L\", \"M\", \"N\", \"O\", \"P\", \"Q\", \"R\", \"S\", \"T\", \"U\", \"V\", \"W\", \"X\",\"Y\",\"Z\"}\n    code := \"\";\n    for {\n        if num &lt;= 0 {\n            break\n        }\n        mod := num % len;\n        num = (num - mod) / len;\n        code =  source_string[mod]+code;\n    }\n    return code\n}\n</code></pre>\n\n<p>e.g</p>\n\n<pre><code>fmt.Println(convertToAnyBase2to36(12354,2))\n</code></pre>\n"}, {"tags": ["go", "casting", "absolute-value"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1566816490, "post_id": 57648933, "comment_id": 101762494, "body": "Converting integers to floats to use the <code>math</code> package and then back to integers is almost never the correct thing to do. The only reason most of the simple <code>math</code> functions exists for <code>float64</code> is that floats often have a number of corner cases (e.g. involving NaN and infinities) that are annoying to get correct; integers don&#39;t have those issues."}], "answers": [{"tags": [], "owner": {"reputation": 311, "user_id": 11972391, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f1e6c78a40c69940c82bf775558db2?s=128&d=identicon&r=PG&f=1", "display_name": "cafster", "link": "https://stackoverflow.com/users/11972391/cafster"}, "is_accepted": true, "score": 11, "last_activity_date": 1566765321, "creation_date": 1566765321, "answer_id": 57649529, "question_id": 57648933, "link": "https://stackoverflow.com/questions/57648933/why-go-does-not-have-function-to-calculate-absolute-value-for-integer-datatype/57649529#57649529", "title": "Why go does not have function to calculate absolute value for integer datatype?", "body": "<p><a href=\"https://golang.org/doc/faq#x_in_std\" rel=\"noreferrer\">From Go's FAQ,</a></p>\n\n<blockquote>\n  <p>The standard library's purpose is to support the runtime, connect to the operating system, and provide key functionality that many Go programs require, such as formatted I/O and networking. It also contains elements important for web programming, including cryptography and support for standards like HTTP, JSON, and XML.</p>\n  \n  <p>There is no clear criterion that defines what is included because for a long time, this was the only Go library. There are criteria that define what gets added today, however.</p>\n  \n  <p>New additions to the standard library are rare and the bar for inclusion is high. Code included in the standard library bears a large ongoing maintenance cost (often borne by those other than the original author), is subject to the Go 1 compatibility promise (blocking fixes to any flaws in the API), and is subject to the Go release schedule, preventing bug fixes from being available to users quickly.</p>\n  \n  <p>Most new code should live outside of the standard library and be accessible via the go tool's go get command. Such code can have its own maintainers, release cycle, and compatibility guarantees. Users can find packages and read their documentation at godoc.org.</p>\n</blockquote>\n\n<p>In response to how easy it is to create integer versions of the math package's float functions, Go team member <a href=\"https://groups.google.com/forum/#!msg/golang-nuts/FQ5-kbbVmP0/UmaEdyMtXAEJ\" rel=\"noreferrer\">Russ Cox once quipped</a>,</p>\n\n<blockquote>\n  <p>Ceil, Floor, and Trunc are even easier!</p>\n</blockquote>\n\n<p>A reasonable interpretation would be that since this function is trivial to write (if x &lt; 0, x = -x), it does not meet the bar for inclusion. Compare with the <a href=\"https://github.com/golang/go/blob/master/src/math/abs.go\" rel=\"noreferrer\">float version</a>:</p>\n\n<pre><code>func Abs(x float64) float64 {\n    return Float64frombits(Float64bits(x) &amp;^ (1 &lt;&lt; 63))\n}\n</code></pre>\n\n<p>This being useful but also not obvious is a compelling reason to include it in the standard library.</p>\n"}, {"tags": [], "owner": {"reputation": 59, "user_id": 12637653, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-QphxFOh-dPc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcNf6Jw1cTdmELyEbCmdL74Far5jQ/photo.jpg?sz=128", "display_name": "LoveRick", "link": "https://stackoverflow.com/users/12637653/loverick"}, "is_accepted": false, "score": 0, "last_activity_date": 1613673011, "last_edit_date": 1613673011, "creation_date": 1578146636, "answer_id": 59591419, "question_id": 57648933, "link": "https://stackoverflow.com/questions/57648933/why-go-does-not-have-function-to-calculate-absolute-value-for-integer-datatype/59591419#59591419", "title": "Why go does not have function to calculate absolute value for integer datatype?", "body": "<p>Though there is no standard function, you always can write it yourself or use third party solution. <a href=\"https://github.com/adam-lavrik/go-imath/\" rel=\"nofollow noreferrer\">This package</a> contains <code>Abs</code> functions for all builtin signed integer types. Usage (after <code>go get</code>):</p>\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    &quot;fmt&quot;\n    &quot;github.com/adam-lavrik/go-imath/i64&quot; // Functions for i64 type\n)\n...\nx := int64(-2)\nfmt.Println(i64.Abs(x)) // Output: 2\nx = i64.Minimal // Minimal negative value of int64, has no positive pair\nfmt.Println(i64.Absu(x)) // Output: 9223372036854775808 (result is converted to uint64)\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 26723, "user_id": 995714, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/w1393.jpg?s=128&g=1", "display_name": "phuclv", "link": "https://stackoverflow.com/users/995714/phuclv"}, "edited": false, "score": 4, "creation_date": 1607939655, "post_id": 63322449, "comment_id": 115419986, "body": "this won&#39;t work if <code>t</code> fits in an <code>int64</code> but isn&#39;t exactly representable in float64, for example 18014398509481983"}], "tags": [], "owner": {"reputation": 382, "user_id": 5378884, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/n2Ath.png?s=128&g=1", "display_name": "Park Keeper", "link": "https://stackoverflow.com/users/5378884/park-keeper"}, "is_accepted": false, "score": 2, "last_activity_date": 1596947176, "creation_date": 1596947176, "answer_id": 63322449, "question_id": 57648933, "link": "https://stackoverflow.com/questions/57648933/why-go-does-not-have-function-to-calculate-absolute-value-for-integer-datatype/63322449#63322449", "title": "Why go does not have function to calculate absolute value for integer datatype?", "body": "<p>Just do this casting</p>\n<pre><code>int64(math.Abs(float64(t)))\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 9846711, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-4DMShwjaYSY/AAAAAAAAAAI/AAAAAAAAAAA/m7srYilxdhc/photo.jpg?sz=128", "display_name": "Piyush Singal", "link": "https://stackoverflow.com/users/9846711/piyush-singal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5468, "favorite_count": 2, "accepted_answer_id": 57649529, "answer_count": 3, "score": 7, "last_activity_date": 1613673011, "creation_date": 1566759946, "last_edit_date": 1566761284, "question_id": 57648933, "link": "https://stackoverflow.com/questions/57648933/why-go-does-not-have-function-to-calculate-absolute-value-for-integer-datatype", "title": "Why go does not have function to calculate absolute value for integer datatype?", "body": "<p>In go, why there is no function which directly calculates absolute value for integer datatypes. Currently all integer values has to be type casted to float64 and then it has to be used as a parameter in math.Abs() function. And it returns float64 datatype only, which again has to be type casted into integer datatype.</p>\n\n<p>Like this code is giving error as Go is statically typed language, so does not allows different datatype.</p>\n\n<blockquote>\n  <p>./prog.go:12:39: cannot use x (type int64) as type float64 in argument\n  to math.Abs</p>\n</blockquote>\n\n<pre><code>\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc main() {\n    fmt.Println(\"Hello, playground\")\n    var x int64 = -10\n\n    fmt.Println(\"Abolute value \",math.Abs(x))   \n}\n</code></pre>\n"}, {"tags": ["go", "methods", "interface", "specifications"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1566762034, "creation_date": 1566762034, "answer_id": 57649171, "question_id": 57648912, "link": "https://stackoverflow.com/questions/57648912/what-is-meant-by-non-interface-method-in-the-section-about-method-values-in-th/57649171#57649171", "title": "What is meant by &#39;non-interface method&#39; in the section about method values in the golang specification?", "body": "<p>Interface method means the method you refer to (you call) is a call on an interface value (whose method set contains the method). Similarly, non-interface method means the method you refer to (you call) is not a call on an interface value (but on a concrete type).</p>\n\n<p>For example:</p>\n\n<pre><code>var r io.Reader = os.Stdin\nr.Read(nil) // Interface method: type of r is an interface (io.Reader)\n\nvar p image.Point = image.Point{}\np.String() // Non-interface method, p is a concrete type (image.Point)\n</code></pre>\n\n<p>To demonstrate the auto-dereferencing and address taking, see this example:</p>\n\n<pre><code>type myint int\n\nfunc (m myint) ValueInt() int { return int(m) }\n\nfunc (m *myint) PtrInt() int { return int(*m) }\n\nfunc main() {\n    var m myint = myint(1)\n\n    fmt.Println(m.ValueInt()) // Normal\n    fmt.Println(m.PtrInt())   // (&amp;m).PtrInt()\n\n    var p *myint = new(myint)\n    *p = myint(2)\n\n    fmt.Println(p.ValueInt()) // (*p).ValueInt()\n    fmt.Println(p.PtrInt())   // Normal\n}\n</code></pre>\n\n<p>It outputs (try it on the <a href=\"https://play.golang.org/p/RBtLstqQvii\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>1\n1\n2\n2\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": -1, "last_activity_date": 1567120066, "last_edit_date": 1567120066, "creation_date": 1566762053, "answer_id": 57649172, "question_id": 57648912, "link": "https://stackoverflow.com/questions/57648912/what-is-meant-by-non-interface-method-in-the-section-about-method-values-in-th/57649172#57649172", "title": "What is meant by &#39;non-interface method&#39; in the section about method values in the golang specification?", "body": "<pre><code>type T struct {}\n\nfunc (t *T) f() {}\n\nfunc main() {\n  x := T{}\n  x.f()\n}\n</code></pre>\n\n<p>Above, x.f is a non-interface method.</p>\n"}], "owner": {"reputation": 81, "user_id": 11186295, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-jPwmX-rdTtc/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdeHVr8jv8P1X7k8AtIY9SUs_OcLA/mo/photo.jpg?sz=128", "display_name": "Ilya Ivyev", "link": "https://stackoverflow.com/users/11186295/ilya-ivyev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 91, "favorite_count": 0, "accepted_answer_id": 57649171, "answer_count": 2, "score": 2, "last_activity_date": 1567120066, "creation_date": 1566759752, "question_id": 57648912, "link": "https://stackoverflow.com/questions/57648912/what-is-meant-by-non-interface-method-in-the-section-about-method-values-in-th", "title": "What is meant by &#39;non-interface method&#39; in the section about method values in the golang specification?", "body": "<p><a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">The Go Programming Language Specification says</a>:</p>\n\n<blockquote>\n  <p>As with selectors, a reference to a non-interface method with a value receiver using a pointer will automatically dereference that pointer: pt.Mv is equivalent to (*pt).Mv.</p>\n</blockquote>\n\n<p>and:</p>\n\n<blockquote>\n  <p>As with method calls, a reference to a non-interface method with a pointer receiver using an addressable value will automatically take the address of that value: t.Mp is equivalent to (&amp;t).Mp.</p>\n</blockquote>\n\n<p>So, what is non-interface method in the given context?</p>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1566755002, "post_id": 57648290, "comment_id": 101747286, "body": "Have you tried running a <code>tree</code>/<code>ls -R</code> in your image?"}], "answers": [{"comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 3, "creation_date": 1566755243, "post_id": 57648348, "comment_id": 101747340, "body": "How is this different from what&#39;s in the question, and why will it help?  (Of note, the question doesn&#39;t appear to be using Go modules.)"}, {"owner": {"reputation": 1066, "user_id": 4133874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-r4bFQ4ePwtg/AAAAAAAAAAI/AAAAAAAAAII/qAPeHk4YIq0/photo.jpg?sz=128", "display_name": "Sagar Chilukuri", "link": "https://stackoverflow.com/users/4133874/sagar-chilukuri"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1566755518, "post_id": 57648348, "comment_id": 101747406, "body": "This will <code>download</code> all the dependencies mentioned in <code>go.mod</code> thereby not having to install any dependency manually. (I have tried something similar to fix dependencies error. Hope it helps OP too)"}, {"owner": {"reputation": 31, "user_id": 11975159, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tke9kLs-rIs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcf9jU-hKMJpQ-3Qye2v23eSoA8RQ/photo.jpg?sz=128", "display_name": "Manuel Aguilar", "link": "https://stackoverflow.com/users/11975159/manuel-aguilar"}, "edited": false, "score": 0, "creation_date": 1566773896, "post_id": 57648348, "comment_id": 101751067, "body": "yes, this worked. Thank you !!!  I wasn&#39;t aware of <code>go.mod</code> and I will look into it more. I just had to write <code>go mod init</code> and <code>go mod tidy</code> to create the additional files."}, {"owner": {"reputation": 714, "user_id": 1404361, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SUNs0.jpg?s=128&g=1", "display_name": "Roger Russel", "link": "https://stackoverflow.com/users/1404361/roger-russel"}, "edited": false, "score": 0, "creation_date": 1584496312, "post_id": 57648348, "comment_id": 107452477, "body": "There is no other option that doesn&#39;t require rebuild the image all the time?"}], "tags": [], "owner": {"reputation": 1066, "user_id": 4133874, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh4.googleusercontent.com/-r4bFQ4ePwtg/AAAAAAAAAAI/AAAAAAAAAII/qAPeHk4YIq0/photo.jpg?sz=128", "display_name": "Sagar Chilukuri", "link": "https://stackoverflow.com/users/4133874/sagar-chilukuri"}, "is_accepted": true, "score": 1, "last_activity_date": 1566755338, "last_edit_date": 1566755338, "creation_date": 1566755140, "answer_id": 57648348, "question_id": 57648290, "link": "https://stackoverflow.com/questions/57648290/golang-cannot-find-package-in-docker-image/57648348#57648348", "title": "Golang cannot find package in Docker image", "body": "<p>Try the following <code>Docker</code> file:</p>\n\n<pre><code># GO Repo base repo\nFROM golang:1.12.0-alpine3.9 as builder\n\nRUN apk add git\n\n# Add Maintainer Info\nLABEL maintainer=\"&lt;&gt;\"\n\nRUN mkdir /app\nADD . /app\nWORKDIR /app\n\nCOPY go.mod go.sum ./\n\n# Download all the dependencies\nRUN go mod download\n\nCOPY . .\n\n# Build the Go app\nRUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o main .\n\n# GO Repo base repo\nFROM alpine:latest\n\nRUN apk --no-cache add ca-certificates curl\n\nRUN mkdir /app\n\nWORKDIR /app/\n\n# Copy the Pre-built binary file from the previous stage\nCOPY --from=builder /app/main .\n\n# Expose port 8000\nEXPOSE 8000\n\n# Run Executable\nCMD [\"./main\"]\n</code></pre>\n\n<p>Here, we are creating an intermediate <code>docker builder</code> container, copying the code into it, build the code inside the <code>builder</code> container and then copy the <code>binary</code> image to the actual docker.</p>\n\n<p>This will help in both having all the dependencies in the final container and also, the size of the final image will be very small </p>\n"}], "owner": {"reputation": 31, "user_id": 11975159, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-tke9kLs-rIs/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcf9jU-hKMJpQ-3Qye2v23eSoA8RQ/photo.jpg?sz=128", "display_name": "Manuel Aguilar", "link": "https://stackoverflow.com/users/11975159/manuel-aguilar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1562, "favorite_count": 1, "accepted_answer_id": 57648348, "answer_count": 1, "score": 2, "last_activity_date": 1566755338, "creation_date": 1566754707, "question_id": 57648290, "link": "https://stackoverflow.com/questions/57648290/golang-cannot-find-package-in-docker-image", "title": "Golang cannot find package in Docker image", "body": "<p>So, I am trying to dockerize a golang application with different directories containing supplementary code for my main file. \nI am using <strong>gorilla/mux</strong>. The directory structure looks like this. </p>\n\n<pre><code>$GOPATH/src/github.com/user/server\n  |--- Dockerfile \n  |--- main.go \n  |--- routes/ \n         handlers.go \n  |--- public/ \n         index.gohtml \n</code></pre>\n\n<p>It works on my host machine with no problem. The problem is that when I try to deploy the docker image it does not run and exits shortly after creation. I have tried changing the <strong>WORKDIR</strong> command in my dockerfile to <strong>/go/src</strong> and dump all my files there, but still no luck. I have also tried the official documentation on <a href=\"https://hub.docker.com/_/golang\" rel=\"nofollow noreferrer\">docker hub</a>. Doesn't work either.</p>\n\n<p>My Dockerfile.</p>\n\n<pre><code>FROM golang:latest  \nWORKDIR /go/src/github.com/user/server\nCOPY . .\nRUN go get -d github.com/gorilla/mux\n\nEXPOSE 8000\nCMD [\"go\",\"run\",\"main.go\"]\n</code></pre>\n\n<p>My golang <strong>main.go</strong> </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main \n\nimport (\n    \"github.com/gorilla/mux\"\n    \"github.com/user/server/routes\"\n    \"log\"\n    \"net/http\"\n    \"time\"\n)\nfunc main(){\n  //... \n}\n</code></pre>\n\n<p>I get this error message when I check the logs of my docker image. </p>\n\n<p><strong>Error Message</strong> </p>\n\n<pre><code>main.go:5:2: cannot find package \"github.com/user/server/routes\" in any of:\n    /usr/local/go/src/github.com/user/server/routes (from $GOROOT)\n    /go/src/github.com/user/server/routes (from $GOPATH)\n</code></pre>\n"}, {"tags": ["go", "grpc"], "answers": [{"comments": [{"owner": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566755709, "post_id": 57648294, "comment_id": 101747465, "body": "Brilliant. Such a pleasure to see a professional at work."}, {"owner": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566825478, "post_id": 57648294, "comment_id": 101766827, "body": "@beserdar - can you vote up the question as someone downvoted it. I think this is due to an argument I had with someone who now seems to be following me downvoting everything I do."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566827698, "post_id": 57648294, "comment_id": 101768038, "body": "@TrevorLeeOakley I don&#39;t get involved in these things. Try to phrase your questions better."}, {"owner": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566827786, "post_id": 57648294, "comment_id": 101768077, "body": "@bsedar -  how better? It is a piece of program code."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566828376, "post_id": 57648294, "comment_id": 101768395, "body": "@TrevorLeeOakley what is the end result you need? What did you try and what errors did you get? &quot;add an array of strings into the content part of struct&quot; doesn&#39;t make much sense, but including the output you want would."}, {"owner": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "edited": false, "score": 0, "creation_date": 1566829738, "post_id": 57648294, "comment_id": 101769089, "body": "the output is fairly complex for this apps so I did not go into that. Hence I focused on the go part."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566754734, "creation_date": 1566754734, "answer_id": 57648294, "question_id": 57648232, "link": "https://stackoverflow.com/questions/57648232/how-to-build-an-array-of-structs-in-go-and-grpc/57648294#57648294", "title": "How to build an array of structs in Go and gRPC?", "body": "<p>If I understand your description correctly, you want to build an array of LongStoreRequests, where each element corresponding to an item in the string array, with Id giving the array index. If that's really what you need, something like this should work:</p>\n\n<pre><code>ss := []*storepb.LongStoreRequest{}\nfor i,str:=range s {\n  ss=append(ss,&amp;storepb.LongStoreRequest {\n                  Msg: &amp;storepb.StoreMessage{\n                            Content: str,\n                            Account:  \"trevor3\",\n                            Parent: \"parentrec\",\n                            Id: i,\n                    }})\n}\n</code></pre>\n"}], "owner": {"reputation": 212, "user_id": 2204000, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3438be2ebed4ad7281b065b587b740cc?s=128&d=identicon&r=PG", "display_name": "Trevor Lee Oakley", "link": "https://stackoverflow.com/users/2204000/trevor-lee-oakley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 99, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566754734, "creation_date": 1566754237, "question_id": 57648232, "link": "https://stackoverflow.com/questions/57648232/how-to-build-an-array-of-structs-in-go-and-grpc", "title": "How to build an array of structs in Go and gRPC?", "body": "<p>I am trying to add an array of strings into the content part of a struct with the Id as the array index. I have the code working for one element, but get various errors when I try and add the loop. Any ideas are welcome.  I am using Go.</p>\n\n<pre><code>func buildRequest(s []string) []*storepb.LongStoreRequest { \n//      ss:= []storepb.LongStoreRequest \n// int32 i =0 stringv := s[0] \n//      for i := 0; i &lt; len(s); i++ {\n    //              println(i, apps[i])\n    ss := []*storepb.LongStoreRequest{\n            &amp;storepb.LongStoreRequest {\n                    Msg: &amp;storepb.StoreMessage{\n                            Content: stringv,\n                            Account:  \"trevor3\",\n                            Parent: \"parentrec\",\n                            Id: 0,\n                    },\n                    }, \n            } //      }\n        return ss \n}\n</code></pre>\n"}, {"tags": ["docker", "go", "docker-compose", "dockerfile"], "answers": [{"tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": false, "score": 1, "last_activity_date": 1566784577, "last_edit_date": 1566784577, "creation_date": 1566751220, "answer_id": 57647862, "question_id": 57647727, "link": "https://stackoverflow.com/questions/57647727/what-to-code-in-dockerfile-and-docker-compose-yml-to-pass-local-package-in-docke/57647862#57647862", "title": "What to code in Dockerfile and docker-compose.yml to pass local package in docker environment", "body": "<p>Your docker context is ./api, but the go.mod is in the parent directory, so go.mod is not included in your image.</p>\n\n<p>One option could be to change your docker context to the root directory of the source tree (parent of api), and copy the files/directories into the image from there.</p>\n"}, {"tags": [], "owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "is_accepted": true, "score": 0, "last_activity_date": 1566920995, "creation_date": 1566920995, "answer_id": 57678297, "question_id": 57647727, "link": "https://stackoverflow.com/questions/57647727/what-to-code-in-dockerfile-and-docker-compose-yml-to-pass-local-package-in-docke/57678297#57678297", "title": "What to code in Dockerfile and docker-compose.yml to pass local package in docker environment", "body": "<p>I resolve this issue in following way.</p>\n\n<ol>\n<li><code>go mod init article/api</code> at <code>api</code> directory.</li>\n</ol>\n\n<pre><code>article\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c contoroller\n  \u2502  \u2502    \u2514 contoroller.go\n  \u2502  \u251c //\n  \u2502  \u251c go.mod \n  \u2502  \u251c go.sum\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u251c go.mod\n  \u251c go.sum\n  \u2514 docker-compose.yml\n</code></pre>\n\n<ol start=\"2\">\n<li>fix <code>Docekrfile</code></li>\n</ol>\n\n<pre><code>FROM golang:latest\nENV GO111MODULE=on\nWORKDIR /app\nCOPY go.mod .\nCOPY go.sum .\nRUN go mod download\nCOPY . .\nRUN go build\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build\nENTRYPOINT [\"/app/api\"]\n</code></pre>\n\n<ol start=\"3\">\n<li>command <code>docker-compose down</code> and then <code>docker-compose up --build</code></li>\n</ol>\n"}], "owner": {"reputation": 109, "user_id": 11964380, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/40b67e002f405c9ae7c855284e914fe2?s=128&d=identicon&r=PG&f=1", "display_name": "jpskgc.v5", "link": "https://stackoverflow.com/users/11964380/jpskgc-v5"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 57678297, "answer_count": 2, "score": -2, "last_activity_date": 1566920995, "creation_date": 1566750034, "question_id": 57647727, "link": "https://stackoverflow.com/questions/57647727/what-to-code-in-dockerfile-and-docker-compose-yml-to-pass-local-package-in-docke", "title": "What to code in Dockerfile and docker-compose.yml to pass local package in docker environment", "body": "<p>I introduced <code>local package</code> with <code>go modules</code> for server side api. <br>\nIt works fine in local environment without error by commanding <code>go run main.go</code>.</p>\n\n<p>But it does not work when commanding <code>docker-compose up</code>.</p>\n\n<p><strong>I want to know what to code Dockerfile and docker-compose.yml to fix.</strong></p>\n\n<p>I command <code>go mod init</code> at <code>article</code> directory.</p>\n\n<p>As result, it sets <code>module github.com/jpskgc/article</code> in <code>go.mod</code>.</p>\n\n<pre><code>article\n  \u251c db\n  \u251c client\n  \u251c api\n  \u2502  \u251c main.go\n  \u2502  \u251c controller\n  \u2502  \u2502    \u2514 controller.go\n  \u2502  \u2514 Dockerfile\n  \u251c nginx\n  \u251c docker-compose.yml\n  \u251c go.mod\n  \u2514 go.sum\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"os\"\n    \"time\"\n    \"github.com/gin-gonic/gin\"\n    \"github.com/jpskgc/article/api/controller\"\n)\n    api := router.Group(\"/api\")\n    {\n        api.GET(\"/articles\", func(c *gin.Context) {\n            controller.GetArticleController(c, db)\n        })\n    }\n    router.Run(\":2345\")\n}\n</code></pre>\n\n<p>Dockerfile</p>\n\n<pre><code>FROM golang:latest\nENV GO111MODULE=on\nWORKDIR /go/src/github.com/jpskgc/article/app\nCOPY . .\nRUN go mod download\nRUN go build\nRUN CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build\nENTRYPOINT [\"/go/src/github.com/jpskgc/article/app/api\"]\n</code></pre>\n\n<p>docker-compose.yml</p>\n\n<pre><code>version: '3'\nservices:\n  api:\n    build:\n      dockerfile: Dockerfile.dev\n      context: ./api\n    volumes:\n      - ./api:/go/src/github.com/jpskgc/article/app\n    depends_on:\n      - db\n    tty: true\n    environment:\n      - AWS_ACCESS_KEY_ID\n      - AWS_SECRET_ACCESS_KEY\n      - MYSQL_USER\n      - MYSQL_PASSWORD\n      - MYSQL_HOST\n      - GO111MODULE\n</code></pre>\n\n<p>go.mod</p>\n\n<pre><code>module github.com/jpskgc/article\n\ngo 1.12\n\nrequire (\n    github.com/aws/aws-sdk-go v1.23.7\n    github.com/gin-contrib/cors v1.3.0\n    github.com/gin-gonic/gin v1.4.0\n    github.com/go-sql-driver/mysql v1.4.1\n    github.com/google/uuid v1.1.1\n    github.com/joho/godotenv v1.3.0\n)\n</code></pre>\n\n<p>I expect server side api working fine without error in docker environment.<br>\nBut the actual is that docker environment for server side fails to run.</p>\n\n<p>Here is error message when commanding docker-compose up<br></p>\n\n<pre><code>build command-line-arguments: \ncannot load github.com/jpskgc/article/api/controller: \ncannot find module providing package github.com/jpskgc/article/api/controller\narticle_api_1 exited with code 1\n</code></pre>\n\n<p>Here is the entire source code on github (branch: try-golang-mod).\nI wish someone to give me answer code for <code>Dockerfile</code> and <code>docker-compose.yml</code>.\n<a href=\"https://github.com/jpskgc/article/tree/try-golang-mod\" rel=\"nofollow noreferrer\">https://github.com/jpskgc/article/tree/try-golang-mod</a></p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "edited": false, "score": 0, "creation_date": 1566765985, "post_id": 57647310, "comment_id": 101749707, "body": "Thank you @Ragav Sood this has complete the issue I had with Geofunction seen as a value and the url prints out."}], "tags": [], "owner": {"reputation": 78952, "user_id": 1069068, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/vw9qZ.png?s=128&g=1", "display_name": "Raghav Sood", "link": "https://stackoverflow.com/users/1069068/raghav-sood"}, "is_accepted": true, "score": 0, "last_activity_date": 1566746648, "creation_date": 1566746648, "answer_id": 57647310, "question_id": 57647256, "link": "https://stackoverflow.com/questions/57647256/insert-call-a-method-and-insert-values/57647310#57647310", "title": "Insert call a method and insert values", "body": "<p>You are missing a few pieces.</p>\n\n<ol>\n<li>The types for <code>x</code> and <code>y</code> in the function definition are missing. Since the are both <code>string</code>s, the type can be defined simultaneously.</li>\n<li>The function <code>GeoFunction</code> is missing a return type, which should be <code>string</code></li>\n</ol>\n\n<p>Go is quite strict about syntax and structure, unlike Python - I would strongly suggest completing the the <a href=\"https://tour.golang.org/\" rel=\"nofollow noreferrer\">Go Tour</a> before transpiling any code, it will make things a lot smoother for you.</p>\n\n<p>Try something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nvar Location1x, Location1y string\nvar Location1 string\nvar rev_geo string\n\nfunc Geofunction(x, y string) string {\n    var str1 string = \"https://eu1.locationiq.com/v1/reverse.php?key=\"\n    var str2 string = \"**********************\"  //API Key\n    var str3 string = x // '48.853106'\n    var str4 string = \"&amp;lon=\"\n    var str5 string = y // '2.384202'\n    var str6 string = \"&amp;format=json\"\n    var rev_geo string = str1 + str2 + str3 + str4 + str5 + str6\n\n    return rev_geo\n}\n\nfunc Locator() {\n    Location1x, Location1y = \"48.853106\", \"2.384202\"\n    Location1 = Geofunction(Location1x, Location1y)\n}\n\nfunc main() {\n    Locator()\n    fmt.Println(Location1)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "edited": false, "score": 0, "creation_date": 1566765998, "post_id": 57647326, "comment_id": 101749711, "body": "This has resolved this part of my issue. I will look at replacing with a string Builder once I get a complete running script."}, {"owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "edited": false, "score": 0, "creation_date": 1566774529, "post_id": 57647326, "comment_id": 101751143, "body": "As my reputation is less than 15. Upvotes are hidden from me"}], "tags": [], "owner": {"reputation": 532, "user_id": 3506300, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/74303643814c70273d978f9a8b3ef309?s=128&d=identicon&r=PG&f=1", "display_name": "kumarD", "link": "https://stackoverflow.com/users/3506300/kumard"}, "is_accepted": false, "score": -1, "last_activity_date": 1566746727, "creation_date": 1566746727, "answer_id": 57647326, "question_id": 57647256, "link": "https://stackoverflow.com/questions/57647256/insert-call-a-method-and-insert-values/57647326#57647326", "title": "Insert call a method and insert values", "body": "<p>Your method definition is wrong overe here, given go is a statically typed language your function definitions should have the type of the parameters which it takes alongside the parameter names</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar Location1x, Location1y string\nvar Location1 string\nvar rev_geo string\n\nfunc Geofunction(x string, y string) {\nvar str1 string = \"https://eu1.locationiq.com/v1/reverse.php?key=\"\nvar str2 string = \"**********************\"  //API Key\nvar str3 string = x // '48.853106'\nvar str4 string = \"&amp;lon=\"\nvar str5 string = y // '2.384202'\nvar str6 string = \"&amp;format=json\"\nvar rev_geo string = str1 + str2 + str3 + str4 + str5 + str6\n\nreturn rev_geo\n}\n\nfunc Locator() {\nLocation1x, Location1y = \"48.853106\", \"2.384202\"\nLocation1 = Geofunction(Location1x, Location1y)\n}\n\nfunc main() {\nLocator()\nfmt.Println(Location1)\n}\n</code></pre>\n\n<p>This should basically work, but a better approach to this would be to use a string builder instead of appending strings. That\u2019s more efficient</p>\n"}], "owner": {"reputation": 66, "user_id": 2648684, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/345598dc4a3606e8ed42f8336de1f8ab?s=128&d=identicon&r=PG", "display_name": "VC Healy", "link": "https://stackoverflow.com/users/2648684/vc-healy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 34, "favorite_count": 0, "accepted_answer_id": 57647310, "answer_count": 2, "score": -1, "last_activity_date": 1566746727, "creation_date": 1566746220, "question_id": 57647256, "link": "https://stackoverflow.com/questions/57647256/insert-call-a-method-and-insert-values", "title": "Insert call a method and insert values", "body": "<p>I have this working in another programming language, creating a url to reverse geocode a location. I am new to Go and I am slowly working building up the script.</p>\n\n<p>I have the method Geofunction(x,y) with the two variables x &amp; y \nFrom another method I call the above method and supply the values to the variables.</p>\n\n<p>I just can't get it to work as expected.</p>\n\n<p>Could someone point me to where to help me find the answer give me some help on this please.</p>\n\n<p>I have a working coy in Python, as I learn Go I am translating scripts  understand.</p>\n\n<p>I have made changes to allow certain variable to accessible to the other functions. I need to understand if the method called with be able to access the variable values. </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nvar Location1x, Location1y string\nvar Location1 string\nvar rev_geo string\n\nfunc Geofunction(x, y) {\n    var str1 string = \"https://eu1.locationiq.com/v1/reverse.php?key=\"\n    var str2 string = \"**********************\"  //API Key\n    var str3 string = x // '48.853106'\n    var str4 string = \"&amp;lon=\"\n    var str5 string = y // '2.384202'\n    var str6 string = \"&amp;format=json\"\n    var rev_geo string = str1 + str2 + str3 + str4 + str5 + str6\n\n    return rev_geo\n}\n\nfunc Locator() {\n    Location1x, Location1y = \"48.853106\", \"2.384202\"\n    Location1 = Geofunction(Location1x, Location1y)\n}\n\nfunc main() {\n    Locator()\n    fmt.Println(Location1)\n}```\n\nExpected:\nA string of a URL is printed.\n\nThe three errors are: \nmain.go:9:18: undefined: x\nmain.go:9:21: undefined: y\nGeofunction(Location1x, Location1y) used as value\n\n\nOnce I get the above sorted, I will then reuse the method to produce multiple strings in an API test that confirms specific data in the json files returned from the server\n</code></pre>\n"}, {"tags": ["docker", "go"], "comments": [{"owner": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 0, "creation_date": 1568948548, "post_id": 57646760, "comment_id": 102445598, "body": "Please post a comment before down-voting the question, or raise a flag to moderators if question quality is not into standards."}], "answers": [{"comments": [{"owner": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 0, "creation_date": 1566743828, "post_id": 57646859, "comment_id": 101744843, "body": "I will have to run <code>http.ListenAndServe(&quot;:8080&quot;, nil)</code> similar thing in <code>addmodule</code> and handle that request?"}, {"owner": {"reputation": 3848, "user_id": 6310593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c8c1b1dd4a0e7235b6b885ce88b870?s=128&d=identicon&r=PG&f=1", "display_name": "MaartenDev", "link": "https://stackoverflow.com/users/6310593/maartendev"}, "reply_to_user": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 1, "creation_date": 1566745406, "post_id": 57646859, "comment_id": 101745204, "body": "Yes, <code>HTTP</code> is the easiest way to setup communication between containers @Sachith"}, {"owner": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 0, "creation_date": 1566748893, "post_id": 57646859, "comment_id": 101745951, "body": "In my <code>mainmodule</code> I use <code>http.Get(&quot;http:&#47;&#47;addmodule:7070&quot;)</code>, and in <code>addmoudle</code> I have <code>http.ListenAndServe(&quot;http:&#47;&#47;addmodule:7070&quot;, nil)</code>, but it says can not send request."}, {"owner": {"reputation": 3848, "user_id": 6310593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c8c1b1dd4a0e7235b6b885ce88b870?s=128&d=identicon&r=PG&f=1", "display_name": "MaartenDev", "link": "https://stackoverflow.com/users/6310593/maartendev"}, "reply_to_user": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 1, "creation_date": 1566749062, "post_id": 57646859, "comment_id": 101745993, "body": "You will need to expose the ports in your dockerfile using <code>EXPOSE 7070</code>"}, {"owner": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 0, "creation_date": 1566750319, "post_id": 57646859, "comment_id": 101746257, "body": "still no luck, I have updated the question with latest changed codes."}, {"owner": {"reputation": 3848, "user_id": 6310593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c8c1b1dd4a0e7235b6b885ce88b870?s=128&d=identicon&r=PG&f=1", "display_name": "MaartenDev", "link": "https://stackoverflow.com/users/6310593/maartendev"}, "reply_to_user": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 1, "creation_date": 1566750491, "post_id": 57646859, "comment_id": 101746293, "body": "I updated the answer, the customer(<code>mainmodule</code>) should use the DNS address, the producer(<code>addmodule</code>) should use <code>0.0.0.0</code>. @Sachith"}, {"owner": {"reputation": 3848, "user_id": 6310593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c8c1b1dd4a0e7235b6b885ce88b870?s=128&d=identicon&r=PG&f=1", "display_name": "MaartenDev", "link": "https://stackoverflow.com/users/6310593/maartendev"}, "reply_to_user": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "edited": false, "score": 0, "creation_date": 1566750874, "post_id": 57646859, "comment_id": 101746377, "body": "Let us <a href=\"https://chat.stackoverflow.com/rooms/198447/discussion-between-maartendev-and-sachith\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 3848, "user_id": 6310593, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95c8c1b1dd4a0e7235b6b885ce88b870?s=128&d=identicon&r=PG&f=1", "display_name": "MaartenDev", "link": "https://stackoverflow.com/users/6310593/maartendev"}, "is_accepted": true, "score": 2, "last_activity_date": 1566755040, "last_edit_date": 1566755040, "creation_date": 1566742916, "answer_id": 57646859, "question_id": 57646760, "link": "https://stackoverflow.com/questions/57646760/communicating-multiple-containers-running-golang/57646859#57646859", "title": "Communicating multiple containers running golang", "body": "<p>Docker compose creates a network by default. The service names can be used to reach the contains in the same network.</p>\n\n<pre><code>version: '3'\n\nservices:\n  addmodule:\n    image: addmodule\n    build:\n      context: ./addmodule\n      dockerfile: Dockerfile\n    depends_on:\n      - mainmodule\n\n  mainmodule:\n    image : mainmodule\n    build:\n      context: ./mainmodule\n      dockerfile: Dockerfile\n</code></pre>\n\n<p>And the <code>mainmodule</code> would be able to reach the add module by connecting to <code>http://addmodule:&lt;port&gt;</code> and <code>addmodule</code> can reach <code>mainmodule</code> by: <code>http://mainmodule</code></p>\n\n<p>This assumes these are http services. Any other transport will work because the <code>addmodule</code> and <code>mainmodule</code> are made available using DNS.</p>\n\n<p>When using custom ports ensure that the ports are exposed in your Dockerfile:</p>\n\n<pre><code>FROM   golang:alpine\nRUN apk update\nCOPY . /go/src\nWORKDIR /go/src\n\nEXPOSE 7070\n</code></pre>\n\n<p>Your http should bind to 0.0.0.0 instead of localhost. This ensures that the service is reachable from outside the container: </p>\n\n<pre><code>http.ListenAndServe(\"0.0.0.0:7070\", nil)\n</code></pre>\n\n<p>The main code should use the following:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    log.Println(\"From main package\")\n\n    res, err := http.Get(\"http://addmodule:7070/add\")  // The mistake I made after a long chat. forgot http://\n\n    if err != nil {\n        log.Println(\"couldnt send get request\")\n    }\n\n    log.Println(res)\n\n}\n</code></pre>\n\n<p>Read more about the default network: <a href=\"https://docs.docker.com/compose/networking/\" rel=\"nofollow noreferrer\">https://docs.docker.com/compose/networking/</a></p>\n"}], "owner": {"reputation": 2299, "user_id": 3760216, "user_type": "registered", "accept_rate": 36, "profile_image": "https://i.stack.imgur.com/gEcRI.jpg?s=128&g=1", "display_name": "Sachith Muhandiram", "link": "https://stackoverflow.com/users/3760216/sachith-muhandiram"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 287, "favorite_count": 0, "accepted_answer_id": 57646859, "answer_count": 1, "score": -1, "last_activity_date": 1566755040, "creation_date": 1566742133, "last_edit_date": 1566750208, "question_id": 57646760, "link": "https://stackoverflow.com/questions/57646760/communicating-multiple-containers-running-golang", "title": "Communicating multiple containers running golang", "body": "<p>I am trying to make to simple micro service using <code>golang</code> and <code>Docker</code></p>\n\n<p>I dont understand how to call <code>add.go</code> functions from <code>mainmodule</code>. </p>\n\n<p><a href=\"https://www.callicoder.com/docker-compose-multi-container-orchestration-golang/\" rel=\"nofollow noreferrer\">This post</a> does the same, but it uses <code>github</code> repo and build it.</p>\n\n<p>I am new to both <code>golang</code> and <code>Docker</code>, so any suggestion to make this simple app working would be great.</p>\n\n<p>This is my folder structure.</p>\n\n<pre><code>- addmodule\n    - add.go\n    - Dockerfile\n- mainmodule\n    - main.go\n    - Dockerfile\n\n- docker-compose.yml\n</code></pre>\n\n<p><code>Dockerfile</code> in <code>addmodule</code></p>\n\n<pre><code>FROM   golang:alpine\nRUN apk update\nCOPY . /go/src\nWORKDIR /go/src\nRUN go build -o add .\nEXPOSE 7070\nRUN chmod 755 add\nCMD [ \"./add\" ]\n</code></pre>\n\n<p><code>Dockerfile</code> in <code>mainmodule</code></p>\n\n<pre><code>FROM golang:alpine\nRUN apk update\nCOPY . /go/src\nWORKDIR /go/src\nCMD [ \"go\",\"run\",\"main.go\" ]\n</code></pre>\n\n<p>docker-compose.yml</p>\n\n<pre><code>version: '3'\n\nservices:\n  addmodule:\n    image: addmodule\n    build:\n      context: ./addmodule\n      dockerfile: Dockerfile\n    depends_on:\n      - mainmodule\n\n  mainmodule:\n    image : mainmodule\n    build:\n      context: ./mainmodule\n      dockerfile: Dockerfile\n</code></pre>\n\n<p>My <code>add.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc add(reswt http.ResponseWriter, req *http.Request) {\n    log.Println(\"Request came to here\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/add\", add)\n    http.ListenAndServe(\"0.0.0.0:7070\", nil)\n\n}\n</code></pre>\n\n<p>My <code>main.go</code> in <code>mainmodule</code></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    log.Println(\"From main package\")\n\n    res, err := http.Get(\"0.0.0.0:7070/add\")\n\n    if err != nil {\n        log.Println(\"couldnt send get request\")\n    }\n\n    log.Println(res)\n\n}\n</code></pre>\n\n<p>When I run <code>sudo docker-compose up --build</code> , I just get <code>couldnt send get request</code></p>\n\n<p>PS : Question edited with modified codes according to suggestions given by @MaartenDev</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1566743443, "post_id": 57646756, "comment_id": 101744744, "body": "Just a reminder, in Go the word <i>embedding</i> has a specific, well defined meaning, and in the example code you&#39;ve provided there is no embedding going on. Do you have problems understanding <code>c.common.client = c</code>? Or is the lines that follow, e.g. <code>c.AccountApi = (*AccountApiService)(&amp;c.common), ...</code>?"}, {"owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566743581, "post_id": 57646756, "comment_id": 101744774, "body": "I have trouble understanding both statements.  Please elaborate.  Also I will take the word embedded out.  Thank you."}], "answers": [{"comments": [{"owner": {"reputation": 4248, "user_id": 1832966, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2bbc5a2b0d0f59c23c20aafce9309773?s=128&d=identicon&r=PG", "display_name": "Kyle Lemons", "link": "https://stackoverflow.com/users/1832966/kyle-lemons"}, "edited": false, "score": 1, "creation_date": 1566784342, "post_id": 57647529, "comment_id": 101752424, "body": "It&#39;s probably worth noting that this roundabout way to &quot;save memory&quot; isn&#39;t really doing a lot to save memory over the &quot;normal&quot; way to do it.  There&#39;s still a pointer per API type, and you could get the same effect by having <code>type AccountApiService struct { *APIService }</code> and defining the field as <code>AccountApi AccountApiService</code> (i.e. by value)."}], "tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": false, "score": 1, "last_activity_date": 1566748391, "creation_date": 1566748391, "answer_id": 57647529, "question_id": 57646756, "link": "https://stackoverflow.com/questions/57646756/reusing-struct-to-reduce-heap-usage/57647529#57647529", "title": "Reusing struct to reduce heap usage", "body": "<p>First, note that the expression <code>(*AccountApiService)(&amp;c.common)</code> is an <em>explicit</em> <a href=\"https://golang.org/ref/spec#Conversions\" rel=\"nofollow noreferrer\">conversion</a>:</p>\n\n<blockquote>\n  <p>A conversion changes the type of an expression to the type specified\n  by the conversion.</p>\n</blockquote>\n\n<p>There is a number of rules that allow you to convert an expression of one type to another type, but the one relevant to your use case is this one:</p>\n\n<blockquote>\n  <ul>\n  <li>ignoring struct tags (see below), x's type and T have identical underlying types.</li>\n  </ul>\n</blockquote>\n\n<hr>\n\n<p>So the assignment statement <code>c.AccountApi = (*AccountApiService)(&amp;c.common)</code> can be explained like this: Since the field <code>common</code> is of type <code>service</code> the expression <code>&amp;c.common</code> is of type <code>*service</code>, that type is then <em>converted</em> to <code>*AccountApiService</code> and the result of that conversion expression is then assigned to the <code>c.AccountApi</code> field.</p>\n\n<p>And as we established above, for the conversion to work the two types, <code>*AccountApiService</code> and <code>*service</code>, must have the same underlying type. So, even though you haven't provided the definitions to any of those <code>XxxApiService</code> types, it is safe to assume that, if the code actually compiles, they are all defined as either</p>\n\n<pre><code>type XxxApiService service\n</code></pre>\n\n<p>or </p>\n\n<pre><code>type XxxApiService struct {\n    client *APIClient\n}\n</code></pre>\n\n<p>effectively giving them the same underlying type as the <code>service</code>'s underlying type.</p>\n\n<hr>\n\n<p>You may ask yourself why not initialize the various services like a normal person, why not write this</p>\n\n<pre><code>c.AccountApi = &amp;AccountApiService{c}\n</code></pre>\n\n<p>instead? The answer to that is in the comment above the <code>common</code> field of <code>APIClient</code>.</p>\n\n<blockquote>\n  <p>Reuse a single struct instead of allocating one for each service on the heap.</p>\n</blockquote>\n\n<p>Which means that instead of allocating a new instance of <code>XxxApiService</code> for each service field, the value allocated to <code>common</code> is shared by all of the service fields. The intent here, I assume, is resource/performance optimization.</p>\n\n<hr>\n\n<p>And finally the assignment <code>c.common.client = c</code>. The <code>APIClient</code> has a field named <code>common</code> of type <code>service</code>, and the type <code>service</code> has a field named <code>client</code> of type <code>*APIClient</code>. This basically allows a client to hold a reference to itself through the <code>common</code> field, which, although it's not the primary aim here, is exactly what is happening in the example code. Basically recursion, an unintended feature of the <code>APIClient</code> design AFAICT, but it is there.</p>\n"}], "owner": {"reputation": 550, "user_id": 2665006, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/f5fc5207efb9ca551f6c5f3e4804beca?s=128&d=identicon&r=PG", "display_name": "phage", "link": "https://stackoverflow.com/users/2665006/phage"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 114, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1566815811, "creation_date": 1566742098, "last_edit_date": 1566815811, "question_id": 57646756, "link": "https://stackoverflow.com/questions/57646756/reusing-struct-to-reduce-heap-usage", "title": "Reusing struct to reduce heap usage", "body": "<p>Please explain what is happening in following code.  The part I don't understand is the service struct.  The service struct is a wrapper around the <code>APIClient</code> struct.  When the <code>NewAPIClient</code> is called, it is using the service struct inside and copying onto itself.  I cannot seem to wrap my head around this. Please advise and elaborate.  Thank you. </p>\n\n<pre><code>type APIClient struct {\n    cfg    *Configuration\n\n    // Reuse a single struct instead of \n    // allocating one for each service on the heap.\n    common service \n\n    // API Services\n    AccountApi          *AccountApiService\n    ContractApi         *ContractApiService\n    FYIApi              *FYIApiService\n    IBCustApi           *IBCustApiService\n    MarketDataApi       *MarketDataApiService\n    OrderApi            *OrderApiService\n    PnLApi              *PnLApiService\n    PortfolioApi        *PortfolioApiService\n    PortfolioAnalystApi *PortfolioAnalystApiService\n    ScannerApi          *ScannerApiService\n    SessionApi          *SessionApiService\n    TradesApi           *TradesApiService\n}\n\ntype service struct {    \n    client *APIClient    \n}\n\nfunc NewAPIClient(cfg *Configuration) *APIClient {    \n    if cfg.HTTPClient == nil {    \n            cfg.HTTPClient = http.DefaultClient    \n    }    \n\n    c := &amp;APIClient{}    \n    c.cfg = cfg    \n    c.common.client = c    \n\n    c.AccountApi = (*AccountApiService)(&amp;c.common)    \n    c.ContractApi = (*ContractApiService)(&amp;c.common)\n    c.FYIApi = (*FYIApiService)(&amp;c.common)\n    c.IBCustApi = (*IBCustApiService)(&amp;c.common)\n    c.MarketDataApi = (*MarketDataApiService)(&amp;c.common)\n    c.OrderApi = (*OrderApiService)(&amp;c.common)\n    c.PnLApi = (*PnLApiService)(&amp;c.common)\n    c.PortfolioApi = (*PortfolioApiService)(&amp;c.common)\n    c.PortfolioAnalystApi = (*PortfolioAnalystApiService)(&amp;c.common)\n    c.ScannerApi = (*ScannerApiService)(&amp;c.common)\n    c.SessionApi = (*SessionApiService)(&amp;c.common)\n    c.TradesApi = (*TradesApiService)(&amp;c.common)\n\n    return c\n}\n</code></pre>\n"}, {"tags": ["rest", "go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1566738493, "post_id": 57646145, "comment_id": 101743536, "body": "(a) You can use the <code>sync</code> package to synchronize access to a variable used by multiple goroutines. (b) Instead of declaring the variable at the package level you can declare it inside the handler and then pass it around to whatever functions the handler is calling."}, {"owner": {"reputation": 45, "user_id": 2092838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65bfeb821b2b2536e04a780a2c0be5f2?s=128&d=identicon&r=PG", "display_name": "Rahul Pol", "link": "https://stackoverflow.com/users/2092838/rahul-pol"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566744815, "post_id": 57646145, "comment_id": 101745068, "body": "a) sync package is used for mutual execution and would be good option for thread but I don&#39;t think it suits here. b) We can use this option but the value is used at very granular level around 6-7 level down and hence used as global variable.  ]Can creating global map an option? Like assigning id like uuid per request and using it."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1566749392, "post_id": 57646145, "comment_id": 101746059, "body": "Using a global map is an option, but just like with the global non-map value you would still need <code>sync</code> to avoid race conditions. However I do not think using a map is a good solution, it sounds more like a workaround. If passing values down 6-7 levels is a pain, that pain might indicate that you need to a redesign instead of a workaround."}], "answers": [{"comments": [{"owner": {"reputation": 45, "user_id": 2092838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65bfeb821b2b2536e04a780a2c0be5f2?s=128&d=identicon&r=PG", "display_name": "Rahul Pol", "link": "https://stackoverflow.com/users/2092838/rahul-pol"}, "edited": false, "score": 0, "creation_date": 1566866013, "post_id": 57651481, "comment_id": 101781312, "body": "Thanks will definitely try the approach."}], "tags": [], "owner": {"reputation": 722, "user_id": 4671382, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d55c20cb0c0d8044ffc5866b179ac8d2?s=128&d=identicon&r=PG&f=1", "display_name": "Cl&#233;ment", "link": "https://stackoverflow.com/users/4671382/cl%c3%a9ment"}, "is_accepted": false, "score": 1, "last_activity_date": 1566790544, "creation_date": 1566790544, "answer_id": 57651481, "question_id": 57646145, "link": "https://stackoverflow.com/questions/57646145/global-variable-in-golang-restful-api/57651481#57651481", "title": "Global variable in golang restful api", "body": "<p>One of the reasons the <code>context</code> package exists is to make it easy to pass request-scoped values, try it out. You will have to pass the context to your methods, but that seems to be a much better way than using some package level variable and a mutex for synchronization.</p>\n\n<p><a href=\"https://blog.golang.org/context\" rel=\"nofollow noreferrer\">https://blog.golang.org/context</a></p>\n"}], "owner": {"reputation": 45, "user_id": 2092838, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/65bfeb821b2b2536e04a780a2c0be5f2?s=128&d=identicon&r=PG", "display_name": "Rahul Pol", "link": "https://stackoverflow.com/users/2092838/rahul-pol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 277, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1566790544, "creation_date": 1566737219, "question_id": 57646145, "link": "https://stackoverflow.com/questions/57646145/global-variable-in-golang-restful-api", "title": "Global variable in golang restful api", "body": "<p>We have an post rest api in golang created using net/http package and used gorilla/mux as request router and dispatcher. The api takes an object as input, lets say x and set it as a global variable and through its course of action the api uses values within this object and provides result. </p>\n\n<p>Now everything was working fine until we found out that when multiple requests hits the api other request modifies the global object. For eg, let say I have sent request with x = 5 and before this request ends another request came in and set x = 10, which causes multiple result for first request one with x=5 and other with x=10.</p>\n\n<p>My query is, can I set a global variable per request? I understand session seems a straight forward answer but is it correct since its a REST api and it should be stateless, also if it is correct how can I do it in golang? What should be used as unique key in session? Also, if session is not the way to go then what is correct approach?</p>\n"}, {"tags": ["user-interface", "go", "font-size", "fyne"], "answers": [{"comments": [{"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566738524, "post_id": 57646220, "comment_id": 101743544, "body": "How do I add TextSize() in SetTheme() (or how to create a new theme)? Can you show me by modifying code from my question above."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "reply_to_user": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566740134, "post_id": 57646220, "comment_id": 101743907, "body": "There is an example in our fyne_demo app. The theme code is at <a href=\"https://github.com/fyne-io/fyne/blob/master/cmd/fyne_demo/screens/theme.go\" rel=\"nofollow noreferrer\">github.com/fyne-io/fyne/blob/master/cmd/fyne_demo/screens/&hellip;</a>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566748426, "post_id": 57646220, "comment_id": 101745865, "body": "Using <code>FYNE_SCALE</code> environment variable is a great method. Best wishes for your software."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566748741, "post_id": 57646220, "comment_id": 101745919, "body": "Any comment/answer to this question for which I have received no response: <a href=\"https://stackoverflow.com/questions/57503660/make-an-andlabs-ui-window-non-resizable\" title=\"make an andlabs ui window non resizable\">stackoverflow.com/questions/57503660/&hellip;</a>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566781911, "post_id": 57646220, "comment_id": 101752116, "body": "Is it possible to change settings like textsize and background color of individual components like a particular label or entry in <code>Fyne</code>?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566791420, "post_id": 57646220, "comment_id": 101753344, "body": "I have added above as as separate question: <a href=\"https://stackoverflow.com/questions/57651536/how-to-change-color-of-gui-components\" title=\"how to change color of gui components\">stackoverflow.com/questions/57651536/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "is_accepted": true, "score": 3, "last_activity_date": 1566737885, "creation_date": 1566737885, "answer_id": 57646220, "question_id": 57645973, "link": "https://stackoverflow.com/questions/57645973/increasing-default-font-size-of-this-simple-go-gui-application/57646220#57646220", "title": "Increasing default font size of this simple go gui application", "body": "<p>You can use TextSize() within theme - you would need to provide a custom theme as set it with myApp.Settings().SetTheme().</p>\n\n<p>If, however, you just wish a larger application for your own setup then you should try setting the environment variable FYNE_SCALE to something like 2.0 which will scale the whole user interface. This changes the size for your computer whereas setting the TextSize in a theme would change it for everyone.</p>\n\n<p>It\u2019s worth noting that this is not \u201ctrivial\u201d because Fyne widgets intentionally do not offer much customisation.</p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1010, "favorite_count": 0, "accepted_answer_id": 57646220, "answer_count": 1, "score": 2, "last_activity_date": 1566737885, "creation_date": 1566735814, "last_edit_date": 1566737232, "question_id": 57645973, "link": "https://stackoverflow.com/questions/57645973/increasing-default-font-size-of-this-simple-go-gui-application", "title": "Increasing default font size of this simple go gui application", "body": "<p>I am using following simple demo code to create a GUI using <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">Fyne</a> package: </p>\n\n<pre><code>package main\nimport (\n    \"fyne.io/fyne/widget\"\n    \"fyne.io/fyne/app\"\n)\nfunc main() {\n    app := app.New()\n    w := app.NewWindow(\"Hello\")\n    w.SetContent(widget.NewVBox(\n        widget.NewLabel(\"Hello Fyne!\"),\n        widget.NewButton(\"Quit\", func() {\n            app.Quit()\n        }),\n    ))\n    w.ShowAndRun()\n}\n</code></pre>\n\n<p>It works all right but I want to increase size default font of this GUI (so that font size should increase in label, button and any other widget like entry that may be added to it). </p>\n\n<p>I see there is <a href=\"https://github.com/fyne-io/fyne/blob/master/theme.go\" rel=\"nofollow noreferrer\"><code>theme</code></a> object (with a TextSize() function) that can possibly be used but I am not able to use it to increase font size. There is a also <code>RenderedTextSize(string, int, TextStyle) Size</code> in <code>type Driver interface</code>.</p>\n\n<p>How can I increase default font in this simple GUI application? Thanks for your help.</p>\n"}, {"tags": ["postgresql", "go", "orm"], "answers": [{"tags": [], "owner": {"reputation": 4438, "user_id": 1287899, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9626e5ccaaecaa83f3600427f271bfc8?s=128&d=identicon&r=PG", "display_name": "Ahmed Hashem", "link": "https://stackoverflow.com/users/1287899/ahmed-hashem"}, "is_accepted": false, "score": 4, "last_activity_date": 1566822738, "last_edit_date": 1566822738, "creation_date": 1566731987, "answer_id": 57645540, "question_id": 57645143, "link": "https://stackoverflow.com/questions/57645143/golang-orm-name-of-table/57645540#57645540", "title": "golang ORM name of table", "body": "<p>1) You can set Table's table name to be <code>table</code></p>\n\n<pre><code>func (Table) TableName() string {\n    return \"table\"\n}\n</code></pre>\n\n<p>Another way is to set singularTable true, then <code>Table</code>'s default table name will be <code>table</code> instead of <code>tables</code>. But it will affect all tables the same.</p>\n\n<pre><code>set db.SingularTable(true) \n</code></pre>\n\n<p>2) In ORM you should define your table object. Here is a struct called <code>Table</code>. Gorm will create a new table called <code>tables</code> in database unless you want to overwrite table's name you can follow step 1.</p>\n"}, {"tags": [], "owner": {"reputation": 41, "user_id": 11171720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-st4ZkxmMJ0U/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3retm4sDJbfueXEVV-wwPkyBUXrPRg/mo/photo.jpg?sz=128", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u0412\u043b\u0430\u0441\u043e\u0432", "link": "https://stackoverflow.com/users/11171720/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%92%d0%bb%d0%b0%d1%81%d0%be%d0%b2"}, "is_accepted": false, "score": -1, "last_activity_date": 1566924744, "last_edit_date": 1566924744, "creation_date": 1566733520, "answer_id": 57645714, "question_id": 57645143, "link": "https://stackoverflow.com/questions/57645143/golang-orm-name-of-table/57645714#57645714", "title": "golang ORM name of table", "body": "<p>My solving of this problem:</p>\n\n<pre><code>    db.Table(\"my_table\").CreateTable(&amp;Table{})\n\n    user := &amp;Table{Name: \"ololo\", Addr: \"pololo\"}\n    db.Table(\"my_table\").Create(user) \n\n</code></pre>\n\n<p>This code creates table <code>my_table</code> as I wanted</p>\n"}, {"tags": [], "owner": {"reputation": 3434, "user_id": 3831845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e11615bc42d260a85bc17e2d20b7f61?s=128&d=identicon&r=PG&f=1", "display_name": "Dat", "link": "https://stackoverflow.com/users/3831845/dat"}, "is_accepted": false, "score": 0, "last_activity_date": 1582822851, "creation_date": 1582822851, "answer_id": 60438313, "question_id": 57645143, "link": "https://stackoverflow.com/questions/57645143/golang-orm-name-of-table/60438313#60438313", "title": "golang ORM name of table", "body": "<p>By default, the golang Postgres Client will <strong>implicitly</strong> use the pluralized version of <em>your</em> <code>struct</code> name[1]. For example</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Student struct {\n   FirstName string\n   LastName string\n}\n// will create a table name `students`\n</code></pre>\n\n<p>You can override it like the following, depending on what you are using</p>\n\n<h2>GORM</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Set User's table name to be `profiles`\nfunc (Student) TableName() string {\n  return \"college_students\"\n}\n</code></pre>\n\n<h2>GO-PQ</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Student struct {\n    tableName struct{} `pg:\"college_students,alias:g\"``\n}\n</code></pre>\n\n<p><a href=\"https://gorm.io/docs/conventions.html#Pluralized-Table-Name\" rel=\"nofollow noreferrer\">https://gorm.io/docs/conventions.html#Pluralized-Table-Name</a></p>\n"}], "owner": {"reputation": 41, "user_id": 11171720, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-st4ZkxmMJ0U/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3retm4sDJbfueXEVV-wwPkyBUXrPRg/mo/photo.jpg?sz=128", "display_name": "\u0421\u0435\u0440\u0433\u0435\u0439 \u0412\u043b\u0430\u0441\u043e\u0432", "link": "https://stackoverflow.com/users/11171720/%d0%a1%d0%b5%d1%80%d0%b3%d0%b5%d0%b9-%d0%92%d0%bb%d0%b0%d1%81%d0%be%d0%b2"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "answer_count": 3, "score": 1, "last_activity_date": 1582822851, "creation_date": 1566728065, "question_id": 57645143, "link": "https://stackoverflow.com/questions/57645143/golang-orm-name-of-table", "title": "golang ORM name of table", "body": "<p>I have some code to create the table in Postgres DB</p>\n\n<pre><code>import (\n    \"github.com/jinzhu/gorm\"\n    _ \"github.com/lib/pq\"\n)\ntype Table struct {\n    Id   int    `gorm:\"primary_key\"`\n    Name string `gorm:\"type:varchar(100)\"`\n    Addr string `gorm:\"type:varchar(100)\"`\n}\nfunc main() {\n    db, _ := gorm.Open(\"postgres\", \"user=postgres password=poilo777 dbname=mydb sslmode=disable\")\n    defer db.Close()\n    db.CreateTable(&amp;Table{}) \n    user := &amp;Table{Name: \"ololo\", Addr: \"pololo\"}\n</code></pre>\n\n<p>there are 2 problems, i faced:\n1) in database created a table \"tables\" instead of \"Table\"\n2) how can I insert data in existing another tables? (for example \"users\")</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1566732397, "post_id": 57645232, "comment_id": 101742281, "body": "I guess you&#39;re missing <code>dbapi</code> in <code>func ReadConfig() dbapi.Configuration</code>"}, {"owner": {"reputation": 1, "user_id": 11836997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xANyn.jpg?s=128&g=1", "display_name": "Maina Wycliffe", "link": "https://stackoverflow.com/users/11836997/maina-wycliffe"}, "reply_to_user": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1566736413, "post_id": 57645232, "comment_id": 101743085, "body": "I don&#39;t understand what you mean? The Configs are read at the main package and passed to the test function in the dbapi package."}, {"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1566737274, "post_id": 57645232, "comment_id": 101743262, "body": "@Mania take a look at the output of <code>ReadConfig()</code> function inside your main package. You can&#39;t access <code>Configuration</code> structure directly."}], "tags": [], "owner": {"reputation": 1, "user_id": 11836997, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/xANyn.jpg?s=128&g=1", "display_name": "Maina Wycliffe", "link": "https://stackoverflow.com/users/11836997/maina-wycliffe"}, "is_accepted": false, "score": 0, "last_activity_date": 1566737379, "last_edit_date": 1566737379, "creation_date": 1566729064, "answer_id": 57645232, "question_id": 57645059, "link": "https://stackoverflow.com/questions/57645059/how-to-pass-struct-type-to-module-functions/57645232#57645232", "title": "How to pass struct type to module functions?", "body": "<p>AppConfig on your Test function of type Configuration struct, which you have declared on your main package. Since go doesn't support cyclic dependencies, you can not import Configuration struct into the dbapi package to use it there. So, I would move Configuration struct from the main package and declare it in the dbapi package.</p>\n\n<pre><code>package dbapi\n\nimport (...)\n\ntype Configuration struct {\n    ApiPort    string\n    DBHost     string\n    DBPort     string\n    DBUser     string\n    DBPassword string\n    DBName     string\n    Info       string\n}\n\n\nfunc Test (w http.ResponseWriter, Appconfig *Configuration) error {\n    fmt.Println(\"Test: \" + Appconfig.DBUser)\n}\n</code></pre>\n\n<p>And then, you can use the Configuration struct inside main, by importing it from the dbapi package.</p>\n\n<pre><code>var AppConfig = dbapi.Configuration{}\n</code></pre>\n\n<p>So, your main package would look like this: </p>\n\n<pre><code>package main\n\nimport(\n...\n\"github.com/wyrdnixx/go-server/src/go-server/dbapi\"\n)\n\nfunc handlerTest(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"INFO: /test was requested...\")\n    dbapi.Test(&amp;AppConfig)\n}\nfunc main() {\n    http.HandleFunc(\"/test\", handlerTest)\n    AppConfig = ReadConfig()\n    log.Fatal(http.ListenAndServe(AppConfig.ApiPort, nil))  \n}\n\nvar AppConfig = dbapi.Configuration{}\n\nfunc ReadConfig() dbapi.Configuration {\n\n    err := gonfig.GetConf(\"./config.development.json\", &amp;AppConfig)\n    if err != nil {\n        fmt.Println(\"ERROR: Config konnte nicht geladen werden: \",     err.Error())\n    } \n    return dbapi.AppConfig\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "is_accepted": true, "score": 0, "last_activity_date": 1566729214, "creation_date": 1566729214, "answer_id": 57645246, "question_id": 57645059, "link": "https://stackoverflow.com/questions/57645059/how-to-pass-struct-type-to-module-functions/57645246#57645246", "title": "How to pass struct type to module functions?", "body": "<p>Create another package under the main directory, name it <code>types</code> or whatever you want. Like bellow:</p>\n\n<p><a href=\"https://i.stack.imgur.com/DQ3Im.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DQ3Im.png\" alt=\"enter image description here\"></a></p>\n\n<p>Move your <code>structure</code> object to <code>types.go</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package types\n\ntype Configuration struct {\n    ApiPort    string\n    DBHost     string\n    DBPort     string\n    DBUser     string\n    DBPassword string\n    DBName     string\n    Info       string\n}\n</code></pre>\n\n<p>Now you can access it from both your <code>main.go</code> and <code>dbapi/test.go</code>.</p>\n\n<p><strong>main.go:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"... .../code/types\"\n\nfunc handlerTest(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"INFO: /test was requested...\")\n    dbapi.Test(&amp;AppConfig)\n}\nfunc main() {\n    http.HandleFunc(\"/test\", handlerTest)\n    AppConfig = ReadConfig()\n    log.Fatal(http.ListenAndServe(AppConfig.ApiPort, nil))\n}\n\n\nvar AppConfig = types.Configuration{}\n\nfunc ReadConfig() types.Configuration {\n\n    err := gonfig.GetConf(\"./config.development.json\", &amp;AppConfig)\n    if err != nil {\n        fmt.Println(\"ERROR: Config konnte nicht geladen werden: \",     err.Error())\n    }\n    return AppConfig\n}\n\n</code></pre>\n\n<p><strong>dbapi.go:</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dbapi\n\nimport \"... .../code/types\"\n\nfunc Test (w http.ResponseWriter, Appconfig *types.Configuration) error {\n    fmt.Println(\"Test: \" + Appconfig.DBUser)\n}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 11973944, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-TmPqH3ADmhE/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcHZhv_RsnSAT_sxpTW7fNUAyJqmw/photo.jpg?sz=128", "display_name": "Jo Jo", "link": "https://stackoverflow.com/users/11973944/jo-jo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 83, "favorite_count": 0, "accepted_answer_id": 57645246, "answer_count": 2, "score": 1, "last_activity_date": 1566737379, "creation_date": 1566727342, "last_edit_date": 1566731545, "question_id": 57645059, "link": "https://stackoverflow.com/questions/57645059/how-to-pass-struct-type-to-module-functions", "title": "How to pass struct type to module functions?", "body": "<p>I just play a little with Go to learn the handling.</p>\n\n<p>I have a main go program.\nI created a sub-folder for a database module, in that I want to do database operations.</p>\n\n<p>For the parameters I have a struct type with credentials etc.\nHow can I pass the struct to the module?</p>\n\n<p>I want all of the configuration and global variables needed in an configuration struct and pass it to the modules if needed.</p>\n\n<p>Is this a good method to achieve the goal?\nThanks for the help.</p>\n\n<p><code>./main.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    //...\n    \"github.com/wyrdnixx/go-server/src/go-server/dbapi\"\n)\n\nfunc handlerTest(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"INFO: /test was requested...\")\n    dbapi.Test(&amp;AppConfig)\n}\nfunc main() {\n    http.HandleFunc(\"/test\", handlerTest)\n    AppConfig = ReadConfig()\n    log.Fatal(http.ListenAndServe(AppConfig.ApiPort, nil))\n}\n\ntype Configuration struct {\n    ApiPort    string\n    DBHost     string\n    DBPort     string\n    DBUser     string\n    DBPassword string\n    DBName     string\n    Info       string\n}\n\nvar AppConfig = Configuration{}\n\nfunc ReadConfig() Configuration {\n\n    err := gonfig.GetConf(\"./config.development.json\", &amp;AppConfig)\n    if err != nil {\n        fmt.Println(\"ERROR: Config konnte nicht geladen werden: \", err.Error())\n    }\n    return AppConfig\n}\n</code></pre>\n\n<p><code>./dbapi/test.go</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package dbapi\n\nimport (\n    // ...\n)\n\nfunc Test (w http.ResponseWriter, Appconfig /* ?!? */) error {\n    fmt.Println(\"Test: \" + Appconfig.DBUser)\n}\n</code></pre>\n"}, {"tags": ["object", "go", "enums"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1566724690, "post_id": 57644525, "comment_id": 101740630, "body": "A map cannot be a const. Your current <code>const ( ... )</code> declaration is the correct way to do it."}], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 1830161, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/27bbaf4544d9d7a07d05dc1b8f9c3d94?s=128&d=identicon&r=PG", "display_name": "doglover1337", "link": "https://stackoverflow.com/users/1830161/doglover1337"}, "edited": false, "score": 0, "creation_date": 1566731184, "post_id": 57645096, "comment_id": 101742040, "body": "Hey @Bryant thanks for your answer. I am more interested in making a const variable that stores only constants regarding Tables that I could access with. ex: var Tables { UserTable: &quot;users&quot;, PostTable: &quot;posts&quot; } . And try to access it with Tables.UserTable"}, {"owner": {"reputation": 219, "user_id": 1599587, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ZlgGd.jpg?s=128&g=1", "display_name": "Bryant", "link": "https://stackoverflow.com/users/1599587/bryant"}, "reply_to_user": {"reputation": 137, "user_id": 1830161, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/27bbaf4544d9d7a07d05dc1b8f9c3d94?s=128&d=identicon&r=PG", "display_name": "doglover1337", "link": "https://stackoverflow.com/users/1830161/doglover1337"}, "edited": false, "score": 0, "creation_date": 1566821101, "post_id": 57645096, "comment_id": 101764668, "body": "i think you can not do that. if you make a const variable pointing to a map, it only means you cannot make this variable pointing to another map, but the key-value in the map can be changed, the key-value is not const."}], "tags": [], "owner": {"reputation": 219, "user_id": 1599587, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/ZlgGd.jpg?s=128&g=1", "display_name": "Bryant", "link": "https://stackoverflow.com/users/1599587/bryant"}, "is_accepted": false, "score": 0, "last_activity_date": 1566727622, "creation_date": 1566727622, "answer_id": 57645096, "question_id": 57644525, "link": "https://stackoverflow.com/questions/57644525/how-to-create-an-enum-map-of-key-values-in-go/57645096#57645096", "title": "How to create an enum/map of key values in Go", "body": "<p>You can declare enum like this:</p>\n\n<pre><code>const (\n    Running = iota       // value --&gt; 0\n    Stopped              // value --&gt; 1\n    Rebooting            // value --&gt; 2\n    Terminated           // value --&gt; 3\n)\n</code></pre>\n\n<p>And map declaration is like this, too.\nHope that this can help u.</p>\n"}, {"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1566733974, "creation_date": 1566733974, "answer_id": 57645767, "question_id": 57644525, "link": "https://stackoverflow.com/questions/57644525/how-to-create-an-enum-map-of-key-values-in-go/57645767#57645767", "title": "How to create an enum/map of key values in Go", "body": "<p>What you can declare as <code>const</code> in Go is limited to only the basic types like ints, strings, bools, etc. There is no way to declare non-basic types like structs, maps, slices, funcs, etc. as a <code>const</code>.</p>\n\n<p>So to get to <code>Tables.UsersTable</code> you can either declare your <code>Tables</code> as a struct <code>var</code>:</p>\n\n<pre><code>var Tables = struct{\n    UsersTable string\n    PostsTable string\n}{\n    UsersTable: \"users\",\n    PostsTable: \"posts\",\n}\n</code></pre>\n\n<p>Note that since this is a variable and not a constant, there's nothing that protects the fields' values from being modified by malice or bug.</p>\n\n<p>Or, the other option you have is to create a new package, name it <code>tables</code>, and in it declare your constants.</p>\n\n<pre><code>package tables\n\nconst (\n    UsersTable = \"users\"\n    PostsTable = \"posts\"\n)\n</code></pre>\n\n<p>Then you can use it by simply importing the package</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"path/to/tables\"\n)\n\nfunc main() {\n    fmt.Println(tables.UsersTable)\n}\n</code></pre>\n\n<p>Note that the first solution, if imported by another package will result in <code>fmt.Println(somepkg.Tables.UsersTable)</code> <em>(unless a <code>.</code> import is used)</em> which may not be what you're looking for, or maybe it is.</p>\n"}], "owner": {"reputation": 137, "user_id": 1830161, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/27bbaf4544d9d7a07d05dc1b8f9c3d94?s=128&d=identicon&r=PG", "display_name": "doglover1337", "link": "https://stackoverflow.com/users/1830161/doglover1337"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1974, "favorite_count": 0, "accepted_answer_id": 57645767, "answer_count": 2, "score": 0, "last_activity_date": 1566733974, "creation_date": 1566722643, "question_id": 57644525, "link": "https://stackoverflow.com/questions/57644525/how-to-create-an-enum-map-of-key-values-in-go", "title": "How to create an enum/map of key values in Go", "body": "<p>I am new to Go and love it so far but it seems that I cannot find a simple solution to this.</p>\n\n<p>I want to create a constant that I can reference in my code by Key and get its value</p>\n\n<p>I have this: </p>\n\n<pre><code>const (\n    DBName            = \"goApi\"\n    UsersTable string = \"users\"\n)\n</code></pre>\n\n<p>And would like to have a Tables constant variable that stores the value</p>\n\n<p>Example:</p>\n\n<pre><code>var Tables = {\n   UsersTable : \"users\",\n   PostsTable : \"posts\"\n}\n\n//Somewhere else in the code\nfmt.Println(Tables.UsersTable) //output \"users\"\n</code></pre>\n\n<p>How can I achieve this in Go?</p>\n"}, {"tags": ["user-interface", "go", "opengl", "fyne"], "comments": [{"owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 1, "creation_date": 1566719735, "post_id": 57643992, "comment_id": 101739529, "body": "Hi, I am not a Go developer, but typically opengl libraries come from your graphics card drivers. If it is failing to run, Chances are your drivers/hardware is too old to load the requested OpenGL context. And looks like Fyne needs OpenGL 3.2-core. ( <a href=\"https://github.com/fyne-io/fyne/blob/master/internal/driver/gl/window.go#L17\" rel=\"nofollow noreferrer\">github.com/fyne-io/fyne/blob/master/internal/driver/gl/&hellip;</a> ). Try updating your graphics card drivers, or try using the software renderer using mesa: <a href=\"https://fdossena.com/?p=mesa/index.frag\" rel=\"nofollow noreferrer\">fdossena.com/?p=mesa/index.frag</a> ."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 0, "creation_date": 1566720223, "post_id": 57643992, "comment_id": 101739631, "body": "So I should put Mesa3D dll in same folder and try to run the built executable again?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "edited": false, "score": 1, "creation_date": 1566720484, "post_id": 57643992, "comment_id": 101739697, "body": "Ok. It did not work after installing <code>3.2-core</code> version but it worked after <code>opengl32.dll</code> ! You may enter this as an answer and I will accept it."}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566723691, "post_id": 57643992, "comment_id": 101740404, "body": "I would like to fix Fyne so that others do not run into this problem- what hardware / operating system version are you using?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566730627, "post_id": 57643992, "comment_id": 101741907, "body": "I am working on <code>Intel(R) Core(TM) i3-3220 CPU @3.30GHz 3.30GHz</code> with <code>Windows7 64bit</code> with <code>4Gb RAM</code>"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566730843, "post_id": 57643992, "comment_id": 101741966, "body": "@ajwillia.ms : Could you comment on this question for which I have received not even one comment let alone answer: <a href=\"https://stackoverflow.com/questions/57630341/gui-not-running-not-finding-entry-point-in-dll\" title=\"gui not running not finding entry point in dll\">stackoverflow.com/questions/57630341/&hellip;</a>"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566740232, "post_id": 57643992, "comment_id": 101743932, "body": "Do you know what graphics card and driver are installed?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566746532, "post_id": 57643992, "comment_id": 101745463, "body": "I have NVIDIA GeForce 210 card installed."}], "answers": [{"comments": [{"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 1, "creation_date": 1566723538, "post_id": 57644350, "comment_id": 101740372, "body": "It actually only requires 2.0 - the 3.2 is just the version of the Go bindings. This older version was released in 2004, so I\u2019m really interested in what sort of computer didn\u2019t have it available?"}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "edited": false, "score": 0, "creation_date": 1566733753, "post_id": 57644350, "comment_id": 101742580, "body": "Actually, it builds and runs all right but font on label and button is very small. What can be done to increase size of font."}, {"owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1566735879, "post_id": 57644350, "comment_id": 101742986, "body": "@ajwillia.ms : I have posted above comment as a separate question: <a href=\"https://stackoverflow.com/questions/57645973/increasing-default-font-size-of-this-simple-go-gui-application\" title=\"increasing default font size of this simple go gui application\">stackoverflow.com/questions/57645973/&hellip;</a>"}, {"owner": {"reputation": 8993, "user_id": 1354537, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/24aaaba3c6140eaef24f9ed711644033?s=128&d=identicon&r=PG", "display_name": "Marged", "link": "https://stackoverflow.com/users/1354537/marged"}, "reply_to_user": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1579159821, "post_id": 57644350, "comment_id": 105674028, "body": "I just tested this because I had problems with Win 7 under Virtualbox: it works fine when I either use the injector or drop the DLL next to my exe. @andy.xyz is it possible to create a single exe that contains and uses the DLL ? Do you happen to know this ?"}, {"owner": {"reputation": 1242, "user_id": 672958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b76268f3a255915fa380139dac950652?s=128&d=identicon&r=PG", "display_name": "andy.xyz", "link": "https://stackoverflow.com/users/672958/andy-xyz"}, "edited": false, "score": 0, "creation_date": 1579180286, "post_id": 57644350, "comment_id": 105684450, "body": "We don&#39;t want to include software-only rendering in Fyne, it is so much slower than the code path that normally executes that it could be problematic. The root of the issue is, I think, that virtualBox has no OpenGL driver and so you need to install one, such as this DLL.  If you want to re-package the windows binary to ship a software renderer for your own uses that may be possible, but I don&#39;t know the details."}], "tags": [], "owner": {"reputation": 381, "user_id": 2563402, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c1980c8f6aa3c5fa1a8d91a67b6bd08?s=128&d=identicon&r=PG", "display_name": "Dinesh", "link": "https://stackoverflow.com/users/2563402/dinesh"}, "is_accepted": true, "score": 4, "last_activity_date": 1566724140, "last_edit_date": 1566724140, "creation_date": 1566720929, "answer_id": 57644350, "question_id": 57643992, "link": "https://stackoverflow.com/questions/57643992/how-to-install-opengl-for-this-to-run/57644350#57644350", "title": "How to install opengl for this to run", "body": "<p>The OpenGL libraries typically come from your graphics card drivers, and looks like Fyne-io needs fairly new Graphics Card Drivers. (<s>It uses OpenGL 3.2 which was released around 2009</s> It uses OpenGL 2.0). So you can try to:</p>\n\n<ul>\n<li>Use a Software Implementation of OpenGL using the Mesa project, which should be \"good enough\" for most desktop apps use cases - more details here: <a href=\"https://fdossena.com/?p=mesa/index.frag\" rel=\"nofollow noreferrer\">https://fdossena.com/?p=mesa/index.frag</a></li>\n</ul>\n\n<p>Or</p>\n\n<ul>\n<li>Update your Graphics Card drivers - If they are available for your hardware, to get GPU accelerated OpenGL. Definitely try this this if you are planning on making a graphics intensive application).</li>\n</ul>\n\n<p><strong>Edit:</strong> Updated the version of the OpenGL context Fyne uses</p>\n"}], "owner": {"reputation": 20623, "user_id": 3522130, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/f83ceae9da7eb5d15dba167d1ff9357e?s=128&d=identicon&r=PG&f=1", "display_name": "rnso", "link": "https://stackoverflow.com/users/3522130/rnso"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 1, "accepted_answer_id": 57644350, "answer_count": 1, "score": 2, "last_activity_date": 1566735841, "creation_date": 1566717231, "last_edit_date": 1566735841, "question_id": 57643992, "link": "https://stackoverflow.com/questions/57643992/how-to-install-opengl-for-this-to-run", "title": "How to install opengl for this to run", "body": "<p>I am trying following simple code to create a GUI using <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">Fyne</a> package: </p>\n\n<pre><code>// from: https://github.com/fyne-io/fyne\npackage main\nimport (\n    \"fyne.io/fyne/widget\"\n    \"fyne.io/fyne/app\"\n)\nfunc main() {\n    app := app.New()\n    w := app.NewWindow(\"Hello\")\n    w.SetContent(widget.NewVBox(\n        widget.NewLabel(\"Hello Fyne!\"),\n        widget.NewButton(\"Quit\", func() {\n            app.Quit()\n        }),\n    ))\n    w.ShowAndRun()\n}\n</code></pre>\n\n<p>It compiles and builds executable file without any error or even warning, but on trying to run it gives following error:</p>\n\n<pre><code>I:\\&gt;rnfynetest\n2019/08/25 12:37:18 Fyne error:  failed to initialise OpenGL\n2019/08/25 12:37:18   Cause: glBeginConditionalRender\n2019/08/25 12:37:18   At: C:/Users/ABCD/go/src/fyne.io/fyne/internal/driver/gl/window.go:1007\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x2c pc=0x572afd]\n\ngoroutine 1 [running, locked to thread]:\nfyne.io/fyne/internal/driver/gl.(*window).SetContent(0x0, 0x8fc5e0, 0x1386e0c0)\n        C:/Users/ABCD/go/src/fyne.io/fyne/internal/driver/gl/window.go:361 +0x1d\nmain.main()\n        I:/rnfynetest.go:10 +0x1ce\n</code></pre>\n\n<p>As given on <a href=\"https://github.com/fyne-io/fyne\" rel=\"nofollow noreferrer\">Fyne homepage</a> I need to install OpenGL. From <a href=\"https://github.com/go-gl/gl\" rel=\"nofollow noreferrer\">go bindings for OpenGL</a> it seems there are three ways to install it:</p>\n\n<pre><code>go get -u github.com/go-gl/gl/v{3.2,3.3,4.1,4.2,4.3,4.4,4.5,4.6}-{core,compatibility}/gl\ngo get -u github.com/go-gl/gl/v3.1/gles2\ngo get -u github.com/go-gl/gl/v2.1/gl\n</code></pre>\n\n<p>Which of these commands do I need to use? I am working on <code>Windows7</code> and using <code>go version go1.12.9 windows/386</code></p>\n\n<p>Thanks for your help.</p>\n\n<p><strong><em>Edit:</em></strong> </p>\n\n<p>I tried following commands:</p>\n\n<pre><code>go get -u github.com/go-gl/gl/v2.1/gl\ngo get -u github.com/go-gl/gl/v4.6-core/gl\ngo get -u github.com/go-gl/gl/v4.6-compatibility/gl\n</code></pre>\n\n<p>They all install all right but same error is persisting on trying to run built executable. </p>\n\n<p>I also tried gles2 but it does not install rather gives following error:</p>\n\n<pre><code>I:\\&gt;go get -u github.com/go-gl/gl/v3.1/gles2\n# github.com/go-gl/gl/v3.1/gles2\nC:\\Users\\ABCD\\go\\src\\github.com\\go-gl\\gl\\v3.1\\gles2\\package.go:38:11: fatal error: KHR/khrplatform.h: No such file or directory\n // #include &lt;KHR/khrplatform.h&gt;\n           ^~~~~~~~~~~~~~~~~~~\ncompilation terminated.\n</code></pre>\n"}, {"tags": ["bash", "go"], "comments": [{"owner": {"reputation": 68617, "user_id": 3776858, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/juunm.png?s=128&g=1", "display_name": "Cyrus", "link": "https://stackoverflow.com/users/3776858/cyrus"}, "edited": false, "score": 0, "creation_date": 1566716927, "post_id": 57643867, "comment_id": 101739008, "body": "Is this better? <code>nohup ping localhost &gt;&#47;dev&#47;null 2&gt;&amp;1</code>"}, {"owner": {"reputation": 81, "user_id": 3628322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f6c8dbc707a957bb6408f0efb3e88a?s=128&d=identicon&r=PG&f=1", "display_name": "Peach", "link": "https://stackoverflow.com/users/3628322/peach"}, "reply_to_user": {"reputation": 68617, "user_id": 3776858, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/juunm.png?s=128&g=1", "display_name": "Cyrus", "link": "https://stackoverflow.com/users/3776858/cyrus"}, "edited": false, "score": 0, "creation_date": 1566718712, "post_id": 57643867, "comment_id": 101739336, "body": "@Cyrus Nope, It also hangs."}, {"owner": {"reputation": 81, "user_id": 3628322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f6c8dbc707a957bb6408f0efb3e88a?s=128&d=identicon&r=PG&f=1", "display_name": "Peach", "link": "https://stackoverflow.com/users/3628322/peach"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566720010, "post_id": 57643867, "comment_id": 101739583, "body": "@torek Thanks. If  ping never stops printing.  I think <code>sh a.sh</code> should not exit. But it ends up immediately and prints <code>nohup: appending output to &#39;nohup.out&#39;</code>."}, {"owner": {"reputation": 81, "user_id": 3628322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f6c8dbc707a957bb6408f0efb3e88a?s=128&d=identicon&r=PG&f=1", "display_name": "Peach", "link": "https://stackoverflow.com/users/3628322/peach"}, "reply_to_user": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566723885, "post_id": 57643867, "comment_id": 101740453, "body": "@torek Thanks for the very detailed explanation of how redirections work. Now I may think that what prevents cmd from returning(exiting) is whether there&#39;s a program has write access to the output pipe cmd passed to, no matter what it writes. To verify this, I wrote another one line of code that just doing the <code>time.Sleep(...)</code>, cmd still doesn&#39;t return. <code>nohup ping ... &gt;&#47;dev&#47;null 2&gt;&amp;1 &amp;</code> works, but now their (nohup&#39;s and ping&#39;s) outputs are all gone because of redirection. The nohup.out file is gone. Kind of annoying thing."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1566724479, "post_id": 57643867, "comment_id": 101740580, "body": "I turned the comments into an answer, so I&#39;ll remove the comments now..."}], "answers": [{"comments": [{"owner": {"reputation": 81, "user_id": 3628322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f6c8dbc707a957bb6408f0efb3e88a?s=128&d=identicon&r=PG&f=1", "display_name": "Peach", "link": "https://stackoverflow.com/users/3628322/peach"}, "edited": false, "score": 0, "creation_date": 1566725370, "post_id": 57644731, "comment_id": 101740777, "body": "Before now, I think <code>exec.Cmd</code> just waits for the exit of the command being executed. <code>ping still has write access to the pipe object, so the Go runtime continues calling the OS read code until the pipe is closed\u2014which is never.</code> changes my point of view. I will take a deep look at the source code of package <code>exec</code>. Thanks again."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": false, "score": 2, "last_activity_date": 1566724455, "creation_date": 1566724455, "answer_id": 57644731, "question_id": 57643867, "link": "https://stackoverflow.com/questions/57643867/exec-command-hangs-on-bash-script-containing-nohup/57644731#57644731", "title": "exec.Command hangs on Bash script containing nohup", "body": "<p>(Converting comments, with glitches fixed, to answer)</p>\n\n<p>The use of <code>nohup</code> here is mostly a <a href=\"https://en.wikipedia.org/wiki/Red_herring\" rel=\"nofollow noreferrer\">red herring</a>.  The real problem is that <code>ping</code> never finishes.  However, <code>nohup</code> has some extra weirdness, which you can see if you run, from an interactive terminal, these two sets of commands:</p>\n\n<pre><code>$ nohup echo foo\nnohup: ignoring input and appending output to 'nohup.out'\n$ cat nohup.out\nfoo\n$ \n</code></pre>\n\n<p>vs:</p>\n\n<pre><code>$ nohup echo foo &lt;/dev/null 2&gt;&amp;1 | cat \nfoo\n$ \n</code></pre>\n\n<p>Note how the first one printed a weird message, and then the output <code>foo</code> went to a file; the second did not, and then the output <code>foo</code> showed up on the regular output stream.  This is because POSIX says that <code>nohup</code> should do these redirections if appropriate.<sup>1</sup>  When run with <code>exec.Cmd</code> and <code>cmd.Output</code>, the redirections are <em>not</em> performed.</p>\n\n<p>At the OS level, on a Linux- or other Unix-like system, the <code>exec</code> code creates an <a href=\"http://man7.org/linux/man-pages/man2/pipe.2.html\" rel=\"nofollow noreferrer\">OS <code>pipe</code> object</a> by which the invoked command can send output back to the Go runtime.  (There may be a separate pipe for its stderr output, or the two may both be directed to a single pipe, depending on how you run the command; see <a href=\"https://golang.org/src/os/exec/exec.go#L280\" rel=\"nofollow noreferrer\">https://golang.org/src/os/exec/exec.go#L280</a>.)  This pipe winds up being passed to <code>ping</code>, so that <code>ping</code> can keep writing output there as long as it likes.</p>\n\n<p>The <em>shell itself</em> exits, because the command <code>nohup ping localhost &amp;</code> is backgrounded.  However, <code>ping</code> still has write access to the pipe object, so the Go runtime continues calling the OS <code>read</code> code until the pipe is closed\u2014which is never.  If the pipe were ever closed, the Go runtime would receive EOF and call the <code>wait</code> system call to collect the shell's exit status, but that never happens.</p>\n\n<p>Redirecting <code>ping</code>'s output, such that the shell itself has the only write access to the pipe, should result in the pipe being closed as soon as the shell itself exits.</p>\n\n<p>(Some shells may have a builtin <code>nohup</code> that may behave weirdly, especially in the presence of redirection.  This is true of some particularly ancient shells.)</p>\n\n<hr>\n\n<p><sup>1</sup>See <a href=\"https://pubs.opengroup.org/onlinepubs/9699919799/utilities/nohup.html\" rel=\"nofollow noreferrer\">https://pubs.opengroup.org/onlinepubs/9699919799/utilities/nohup.html</a> for complete details.  The Linux variant redirects stdin as well as stdout and stderr, if the input is a terminal, and if the output and stderr are terminals.  The FreeBSD variant redirects only stdout and/or stderr.  The \"is a terminal\" test is based on the C language <code>isatty</code> function, which does the same thing as <a href=\"https://godoc.org/golang.org/x/crypto/ssh/terminal#IsTerminal\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/crypto/ssh/terminal#IsTerminal</a>.</p>\n"}], "owner": {"reputation": 81, "user_id": 3628322, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/28f6c8dbc707a957bb6408f0efb3e88a?s=128&d=identicon&r=PG&f=1", "display_name": "Peach", "link": "https://stackoverflow.com/users/3628322/peach"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 563, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1566725379, "creation_date": 1566715845, "last_edit_date": 1566725379, "question_id": 57643867, "link": "https://stackoverflow.com/questions/57643867/exec-command-hangs-on-bash-script-containing-nohup", "title": "exec.Command hangs on Bash script containing nohup", "body": "<p>When I use Go's <code>exec.Command{}</code> to execute some bash script that contains nohup, it will hang forever.</p>\n\n<p>I don't know what are the differences between ping and ifconfig. I tried to redirect the stdin (<code>&lt; /dev/null</code>), the stdout(<code>&gt; /dev/null</code>) and the stderr(<code>2&gt; /dev/null</code>), and their combination, some of them work some don't.</p>\n\n<p>When I use <code>sh</code> to execute the script, it just ends up immediately.</p>\n\n<p>The Go code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"sh\", \"a.sh\")\n    out, err := cmd.Output() // Or cmd.CombinedOutput()\n    fmt.Println(string(out), err)\n}\n</code></pre>\n\n<p>The Bash script (a.sh):</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>#!/bin/bash\n\n# hangs\n#nohup ping localhost &amp;\n\n# dot not hang\nnohup ifconfig &amp;\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2322, "user_id": 2553939, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1466975e31ecbcfde0be07ecdd4933ca?s=128&d=identicon&r=PG&f=1", "display_name": "washcloth", "link": "https://stackoverflow.com/users/2553939/washcloth"}, "edited": false, "score": 0, "creation_date": 1566699369, "post_id": 57642737, "comment_id": 101736982, "body": "thanks I believe this is better than making a struct with 1 element in side, although wouldn&#39;t it be nice if we could tag just a single variable pffft ty"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566732622, "post_id": 57642737, "comment_id": 101742334, "body": "Instead of a map (which has different undesirable unmarshalling behaviour) I&#39;d just use a anonymous struct variable: <a href=\"https://play.golang.org/p/70ggPCSt3Qe\" rel=\"nofollow noreferrer\">play.golang.org/p/70ggPCSt3Qe</a>"}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566733840, "post_id": 57642737, "comment_id": 101742592, "body": "@DaveC: sure, though you&#39;ll want to annotate it with a <code>json:&quot;accounts&quot;</code> tag to get the right json encoding, where needed ... but either way, you&#39;re back to what the OP asked to avoid: a struct just to hold the slice of structs."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566734202, "post_id": 57642737, "comment_id": 101742669, "body": "No tag required for unmarshalling. There is a difference between defining a package level struct type (what the OP wanted to avoid) and a one-line anonymous struct variable (which is just as short as your map version and has better unmarshalling behaviour; <code>json.Unmarshall</code> will treat the map different that does the struct type)."}], "tags": [], "owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "is_accepted": true, "score": 0, "last_activity_date": 1566736524, "last_edit_date": 1566736524, "creation_date": 1566698678, "answer_id": 57642737, "question_id": 57642677, "link": "https://stackoverflow.com/questions/57642677/better-way-of-decoding-json-values/57642737#57642737", "title": "Better way of decoding json values", "body": "<p>You need somewhere to store the json string <code>accounts</code>.  Using a:</p>\n\n<pre><code>var m map[string][]AccountProperties\n</code></pre>\n\n<p>suffices, though of course you then need to know to use the string literal <code>accounts</code> to access the (single) map entry thus created:</p>\n\n<pre><code>type AccountProperties struct {\n    ID           string   `json:\"id\"`\n    MT4AccountID int      `json:\"mt4AccountID,omitempty\"`\n    Tags         []string `json:\"tags\"`\n}\n\nfunc main() {\n    var m map[string][]AccountProperties\n    err := json.Unmarshal([]byte(data), &amp;m)\n    fmt.Println(err, m[\"accounts\"])\n}\n</code></pre>\n\n<p>See complete <a href=\"https://play.golang.org/p/4EnKGRjN7Gx\" rel=\"nofollow noreferrer\">Go Playground example</a> (I had to change the type of <code>ID</code> to <code>string</code> and fix the missing <code>{</code> in the json).</p>\n\n<hr>\n\n<p>As <a href=\"https://stackoverflow.com/questions/57642677/better-way-of-decoding-json-values/57642737?noredirect=1#comment101742334_57642737\">Dave C points out in comments</a>, this is no shorter than just using an anonymous struct type:</p>\n\n<pre><code>var a struct{ Accounts []AccountProperties }\n</code></pre>\n\n<p>in terms of the <code>Unmarshall</code> call (and when done this way it's more convenient to <em>use</em>).  Should you want to use an anonymous struct like this in a <code>json.Marshall</code> call, you'll need to tag its single element to get a lowercase encoding: without a tag it will be called <code>\"Accounts\"</code> rather than <code>\"accounts\"</code>.</p>\n\n<p>(I don't claim the map method to be <em>better</em>, just <em>an alternative</em>.)</p>\n"}], "owner": {"reputation": 2322, "user_id": 2553939, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/1466975e31ecbcfde0be07ecdd4933ca?s=128&d=identicon&r=PG&f=1", "display_name": "washcloth", "link": "https://stackoverflow.com/users/2553939/washcloth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 1, "accepted_answer_id": 57642737, "answer_count": 1, "score": -1, "last_activity_date": 1566736524, "creation_date": 1566697535, "last_edit_date": 1566725435, "question_id": 57642677, "link": "https://stackoverflow.com/questions/57642677/better-way-of-decoding-json-values", "title": "Better way of decoding json values", "body": "<p>Assume a JSON object with the general format </p>\n\n<pre><code>  \"accounts\": [\n    {\n      \"id\": \"&lt;ACCOUNT&gt;\", \n      \"tags\": []\n    }\n  ]\n}\n</code></pre>\n\n<p>I can create a struct with corresponding json tags to decode it like so</p>\n\n<pre><code> type AccountProperties struct {\n    ID AccountID `json:\"id\"`\n    MT4AccountID int `json:\"mt4AccountID,omitempty\"`\n    Tags []string `json:\"tags\"`\n  }\n\n  type Accounts struct {\n    Accounts []AccountProperties `json:\"accounts\"`\n  }\n</code></pre>\n\n<p>But the last struct with just one element seems incorrect to me. Is there a way I could simply say <code>type Accounts []AccountProperties `json:\"accounts\"`</code> instead of creating an entire new struct just to decode this object?</p>\n"}, {"tags": ["go", "gzip", "tar"], "comments": [{"owner": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 2, "creation_date": 1566663895, "post_id": 57639648, "comment_id": 101731177, "body": "What does \u201cit doesn\u2019t work in my case\u201d mean?"}, {"owner": {"reputation": 139, "user_id": 7663155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b47c62c4bda5e330e461c0ec9c1d2fd4?s=128&d=identicon&r=PG&f=1", "display_name": "Victor Rusnac", "link": "https://stackoverflow.com/users/7663155/victor-rusnac"}, "reply_to_user": {"reputation": 198293, "user_id": 707111, "user_type": "moderator", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/oXZkh.jpg?s=128&g=1", "display_name": "Ry-", "link": "https://stackoverflow.com/users/707111/ry"}, "edited": false, "score": 0, "creation_date": 1566664112, "post_id": 57639648, "comment_id": 101731209, "body": "I&#39;ve tried to run the code with my file and it returned an error."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 2, "creation_date": 1566664248, "post_id": 57639648, "comment_id": 101731235, "body": "Does it fail after unzipping some files? The code leaves the unzipped file open until the end of the function (defer outfile.Close()). Instead of that, close the file once io.Copy is done."}, {"owner": {"reputation": 139, "user_id": 7663155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b47c62c4bda5e330e461c0ec9c1d2fd4?s=128&d=identicon&r=PG&f=1", "display_name": "Victor Rusnac", "link": "https://stackoverflow.com/users/7663155/victor-rusnac"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566664980, "post_id": 57639648, "comment_id": 101731403, "body": "Yes @bserdar it unzips a part of files inside the folder and then crashes. I did as you said but it still crashes on Create()."}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566665464, "post_id": 57639648, "comment_id": 101731513, "body": "Could you show what you did?"}, {"owner": {"reputation": 139, "user_id": 7663155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b47c62c4bda5e330e461c0ec9c1d2fd4?s=128&d=identicon&r=PG&f=1", "display_name": "Victor Rusnac", "link": "https://stackoverflow.com/users/7663155/victor-rusnac"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566665727, "post_id": 57639648, "comment_id": 101731566, "body": "@bserdar of course I just moved close() after io.Copy like this                     if _, err := io.Copy(outFile, tarReader); err != nil {                 log.Fatalf(&quot;ExtractTarGz: Copy() failed: %s&quot;, err.Error())             } defer outFile.Close()"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 3, "creation_date": 1566665820, "post_id": 57639648, "comment_id": 101731590, "body": "That&#39;s wrong. You&#39;re still using defer, which defers the close until the function returns. Use outfile.Close(), not defer outfile.Close()."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1566729948, "post_id": 57640231, "comment_id": 101741766, "body": "Code only answers without any text describing what you changed/did and why are not very useful."}, {"owner": {"reputation": 197, "user_id": 2173542, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/419b54e4b0c805f8ed671451ea536e19?s=128&d=identicon&r=PG", "display_name": "funny_falcon", "link": "https://stackoverflow.com/users/2173542/funny-falcon"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1597754319, "post_id": 57640231, "comment_id": 112231842, "body": "@DaveC in this version he closes without defer."}], "tags": [], "owner": {"reputation": 139, "user_id": 7663155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b47c62c4bda5e330e461c0ec9c1d2fd4?s=128&d=identicon&r=PG&f=1", "display_name": "Victor Rusnac", "link": "https://stackoverflow.com/users/7663155/victor-rusnac"}, "is_accepted": false, "score": 5, "last_activity_date": 1566668389, "creation_date": 1566668389, "answer_id": 57640231, "question_id": 57639648, "link": "https://stackoverflow.com/questions/57639648/how-to-decompress-tar-gz-file-in-go/57640231#57640231", "title": "How to decompress tar.gz file in go?", "body": "<pre><code>package main\n\nimport (\n    \"archive/tar\"\n    \"compress/gzip\"\n    \"fmt\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc ExtractTarGz(gzipStream io.Reader) {\n    uncompressedStream, err := gzip.NewReader(gzipStream)\n    if err != nil {\n        log.Fatal(\"ExtractTarGz: NewReader failed\")\n    }\n\n    tarReader := tar.NewReader(uncompressedStream)\n\n    for true {\n        header, err := tarReader.Next()\n\n        if err == io.EOF {\n            break\n        }\n\n        if err != nil {\n            log.Fatalf(\"ExtractTarGz: Next() failed: %s\", err.Error())\n        }\n\n        switch header.Typeflag {\n        case tar.TypeDir:\n            if err := os.Mkdir(header.Name, 0755); err != nil {\n                log.Fatalf(\"ExtractTarGz: Mkdir() failed: %s\", err.Error())\n            }\n        case tar.TypeReg:\n            outFile, err := os.Create(header.Name)\n            if err != nil {\n                log.Fatalf(\"ExtractTarGz: Create() failed: %s\", err.Error())\n            }\n            if _, err := io.Copy(outFile, tarReader); err != nil {\n                log.Fatalf(\"ExtractTarGz: Copy() failed: %s\", err.Error())\n            }\n            outFile.Close()\n\n        default:\n            log.Fatalf(\n                \"ExtractTarGz: uknown type: %s in %s\",\n                header.Typeflag,\n                header.Name)\n        }\n\n    }\n}\nfunc main() {\n    r, err := os.Open(\"./file.tar.gz\")\n    if err != nil {\n        fmt.Println(\"error\")\n    }\n    ExtractTarGz(r)\n}\n</code></pre>\n"}], "owner": {"reputation": 139, "user_id": 7663155, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b47c62c4bda5e330e461c0ec9c1d2fd4?s=128&d=identicon&r=PG&f=1", "display_name": "Victor Rusnac", "link": "https://stackoverflow.com/users/7663155/victor-rusnac"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5480, "favorite_count": 1, "closed_date": 1566676170, "answer_count": 1, "score": 8, "last_activity_date": 1566676183, "creation_date": 1566663786, "last_edit_date": 1566676183, "question_id": 57639648, "link": "https://stackoverflow.com/questions/57639648/how-to-decompress-tar-gz-file-in-go", "closed_reason": "Duplicate", "title": "How to decompress tar.gz file in go?", "body": "<p>I have a file called <code>file.tar.gz</code> and it has a <code>folder</code> inside. Using go I want to decompress it and save the folder in the current directory.</p>\n\n<p>I've found these code on a forum but it doesn't work in my case.</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/tar\"\n    \"compress/gzip\"\n    \"io\"\n    \"log\"\n    \"os\"\n)\n\nfunc ExtractTarGz(gzipStream io.Reader) {\n    uncompressedStream, err := gzip.NewReader(gzipStream)\n    if err != nil {\n        log.Fatal(\"ExtractTarGz: NewReader failed\")\n    }\n\n    tarReader := tar.NewReader(uncompressedStream)\n\n    for true {\n        header, err := tarReader.Next()\n\n        if err == io.EOF {\n            break\n        }\n\n        if err != nil {\n            log.Fatalf(\"ExtractTarGz: Next() failed: %s\", err.Error())\n        }\n\n        switch header.Typeflag {\n        case tar.TypeDir:\n            if err := os.Mkdir(header.Name, 0755); err != nil {\n                log.Fatalf(\"ExtractTarGz: Mkdir() failed: %s\", err.Error())\n            }\n        case tar.TypeReg:\n            outFile, err := os.Create(header.Name)\n            if err != nil {\n                log.Fatalf(\"ExtractTarGz: Create() failed: %s\", err.Error())\n            }\n            defer outFile.Close()\n            if _, err := io.Copy(outFile, tarReader); err != nil {\n                log.Fatalf(\"ExtractTarGz: Copy() failed: %s\", err.Error())\n            }\n        default:\n            log.Fatalf(\n                \"ExtractTarGz: uknown type: %s in %s\",\n                header.Typeflag,\n                header.Name)\n        }\n    }\n}\nfunc main() {\n    r, err := os.Open(\"./file.tar.gz\")\n    if err != nil {\n        log.Fatalf(err.Error())\n    }\n    ExtractTarGz(r)\n}\n\n</code></pre>\n\n<p>It gives me the error:</p>\n\n<pre><code>ExtractTarGz: Create() failed: open go/pkg/linux_amd64_race/unicod/utf16.a: too many open files exit status 1 \n</code></pre>\n"}, {"tags": ["docker", "go", "elasticsearch"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566664518, "post_id": 57639542, "comment_id": 101731284, "body": "Just an idea, because I don&#39;t know the elasticsearch api: you&#39;re setting up tls but using http:// urls, shouldn&#39;t that be https://?"}, {"owner": {"reputation": 741, "user_id": 9210252, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5a7278056c0a66272dddde5c8d2fcd03?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian Coutsoftides", "link": "https://stackoverflow.com/users/9210252/adrian-coutsoftides"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566666232, "post_id": 57639542, "comment_id": 101731664, "body": "@bserdar changing it to https outputted a different error to do with tls, it won&#39;t even connect to the client"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566666390, "post_id": 57639542, "comment_id": 101731705, "body": "As I said, I&#39;m not familiar with the elastic api, so what you had might be the right way. It was just an idea..."}, {"owner": {"reputation": 741, "user_id": 9210252, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5a7278056c0a66272dddde5c8d2fcd03?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian Coutsoftides", "link": "https://stackoverflow.com/users/9210252/adrian-coutsoftides"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566666591, "post_id": 57639542, "comment_id": 101731750, "body": "@bserdar no problem! thank you for the advice anyway!"}, {"owner": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 0, "creation_date": 1566802394, "post_id": 57639542, "comment_id": 101756093, "body": "@AdrianCoutsoftides just a question: if you&#39;re already having the data in Redis why don&#39;t you just use RediSearch to query it?"}, {"owner": {"reputation": 741, "user_id": 9210252, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5a7278056c0a66272dddde5c8d2fcd03?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian Coutsoftides", "link": "https://stackoverflow.com/users/9210252/adrian-coutsoftides"}, "reply_to_user": {"reputation": 7374, "user_id": 593425, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/ad54f71e8e63bf711680cf8f5f1e53c1?s=128&d=identicon&r=PG", "display_name": "Guy Korland", "link": "https://stackoverflow.com/users/593425/guy-korland"}, "edited": false, "score": 0, "creation_date": 1566826884, "post_id": 57639542, "comment_id": 101767608, "body": "@GuyKorland This is because the client has a large datastore, as such I had to develop a multi-temperature storage solution, redis is being used as hot storage, and elastic search as warm storage because when the system goes into the production objects not residing within the redis cache will also need to be queried"}], "owner": {"reputation": 741, "user_id": 9210252, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/5a7278056c0a66272dddde5c8d2fcd03?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian Coutsoftides", "link": "https://stackoverflow.com/users/9210252/adrian-coutsoftides"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 475, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1589821559, "creation_date": 1566662871, "last_edit_date": 1566667784, "question_id": 57639542, "link": "https://stackoverflow.com/questions/57639542/elasticsearch-container-returns-malformed-http-status-response", "title": "Elasticsearch container returns malformed http status response", "body": "<p>I'm using the official <code>go-elasticsearch 7.x</code> api from golang to query an elasticsearch container:</p>\n\n<p>I keep getting this response when I try to index some documents (after connecting successfully)</p>\n\n<p><code>Error getting response: net/http: HTTP/1.x transport connection broken: malformed HTTP status code \"is\"</code></p>\n\n<p>From what I can tell my request to index the document seems normal and it appears as though the error is coming from within the container? I've tried different TLS configurations, including no tls configuration at all and I still get the same response.</p>\n\n<p>No error gets returns when I call <code>elasticClient.Info()</code> which it's connected to the client successfully</p>\n\n<h1>golang:</h1>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var err error\n    cfg := elasticsearch.Config{\n        Addresses: []string{\n            \"http://elasticsearch:9200\",\n            \"http://elasticsearch:9300\",\n        },\n        Transport: &amp;http.Transport{\n            TLSClientConfig: &amp;tls.Config{\n                Renegotiation: tls.RenegotiateOnceAsClient,\n                Certificates:  []tls.Certificate{cer},\n            },\n        },\n    }\n    elasticClient, err = elasticsearch.NewClient(cfg)\n    if err != nil {\n        return err\n    }\n    return nil\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nval, err := json.Marshal(&amp;load)\n    if err != nil {\n        log.Fatalf(\"Error marshalling load, %v\", err)\n    }\n    log.Printf(\"|| %s ||\", string(val))\n    req := esapi.IndexRequest{\n        Index:      \"load\",\n        DocumentID: strconv.Itoa(int(load.Id)),\n        Body:       strings.NewReader(string(val)),\n        Refresh:    \"true\",\n    }\n    info, err := elasticClient.Info()\n    if err != nil {\n        return err\n    }\n    log.Println(info)\n    // Perform the request with the client.\n    res, err := req.Do(context.Background(), elasticClient)\n    if err != nil {\n        log.Fatalf(\"Error getting response: %s\", err.Error())\n    }\n    if res.IsError() {\n        log.Printf(\"[%s] Error indexing document ID=%s\", res.Status(), strconv.Itoa(int(load.Id)))\n    } else {\n\n        // Deserialize the response into a map.\n        var r map[string]interface{}\n        if err := json.NewDecoder(res.Body).Decode(&amp;r); err != nil {\n            log.Printf(\"Error parsing the response body: %s\", err)\n        } else {\n            // Print the response status and indexed document version.\n            log.Printf(\"[%s] %s; version=%d\", res.Status(), r[\"result\"], int(r[\"_version\"].(float64)))\n        }\n    }\n    return nil\n</code></pre>\n\n<h1>typical json to index</h1>\n\n<p><code>string(val)</code> in <code>IndexRequest</code></p>\n\n<pre><code>{\"deliverydate\":\"2019-08-28T13:00:00-04:00\",\"temperature\":\"34\",\n\"firstname\":\"****\",\"loaddate\":\"2019-08-26T13:00:00-04:00\",\"id\":\"188244\",\"weight\":\"41918\",\"totalcust\":\"2609\",\"ponumber\":\"******\",\"tsize\":\"53 ft\",\"phone\":\"*******\",\"equipment\":\"***\",\"ext\":\"****\",\"lastname\":\"****\",\"pzip\":\"****\",\n\"pcity\":\"****\",\"pstate\":\"****\",\"dzip\":\"22153\",\"dcity\":\"*****\",\"dstate\":\"****\",\n\"locations\":{\"1\":{\"lat\":44.260059,\"long\":-72.575387},\"2\":{\"lat\":38.748411,\"long\":-77.234767},\"3\":{},\"4\":{\"lat\":39.192978,\"long\":-76.7238},\"5\":{\"lat\":38.694281,\"long\":-75.772155},\"6\":{\"lat\":39.149275,\"long\":-76.775249},\"7\":{\"lat\":39.606779,\"long\":-75.833272}},\"stopTypes\":{\"1\":\"P\",\"2\":\"D\",\"3\":\"D\",\"4\":\"D\",\"5\":\"D\",\"6\":\"D\",\"7\":\"D\"}}\n</code></pre>\n\n<h1>docker-compose.yml</h1>\n\n<pre><code>version: \"3\"\nservices:\n  redis_server:\n    image: \"redis\"\n    ports:\n      - \"6379:6379\"\n  lambda_server:\n    build: .\n    ports:\n      - \"8080:50051\"\n    depends_on:\n      - redis_server\n      - elasticsearch\n  elasticsearch:\n    image: docker.elastic.co/elasticsearch/elasticsearch:7.3.1\n    ports:\n      - \"9200:9200\"\n      - \"9300:9300\"      \n    environment:\n      - xpack.security.enabled=false\n      - discovery.type=single-node\n      - http.cors.enabled=true\n      - http.cors.allow-origin=*\n</code></pre>\n\n<h1>Edit 1:</h1>\n\n<p>Just tried wrapping the request in a loop to see if something changes and it appears to produce something more useful:</p>\n\n<p><code>lambda_server_1  | 2019/08/24 17:25:59 [400 Bad Request] Error indexing document ID=188243\nlambda_server_1  | 2019/08/24 17:25:59 [400 Bad Request] Error indexing document ID=189265</code></p>\n\n<p>It appears it's a poorly formed request? Despite following the <a href=\"https://github.com/elastic/go-elasticsearch/blob/master/_examples/main.go\" rel=\"nofollow noreferrer\">example</a> exactly.</p>\n\n<h2>edited code:</h2>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func cacheLoadsToSearch() {\n    data := redisClient.Scan(0, \"*\", totalNewLoads).Iterator()\n    accessedKeys := map[string]bool{}\n    for data.Next() {\n        id := data.Val()\n        if accessedKeys[id] {\n            continue //continue to next iteration of loop, Scan cursor may return duplicate results\n        } else {\n            accessedKeys[id] = true\n        }\n        loadItem, err := readFromRedis(id)\n        if err != nil {\n            log.Fatalf(\"Error reading from redis cache, %v\", err)\n        }\n        wg.Add(1)\n        pushToElasticSearch(loadItem)\n    }\n    wg.Wait()\n}\n\nfunc pushToElasticSearch(load *lambdapb.Load) error {\n    val, err := json.Marshal(&amp;load)\n    if err != nil {\n        log.Fatalf(\"Error marshalling load, %v\", err)\n    }\n    log.Printf(\"|| %s ||\", string(val))\n    req := esapi.IndexRequest{\n        Index:      \"load\",\n        DocumentID: strconv.Itoa(int(load.Id)),\n        Body:       strings.NewReader(string(val)),\n        Refresh:    \"true\",\n    }\n    info, err := elasticClient.Info()\n    if err != nil {\n        return err\n    }\n    log.Println(info)\n    // Perform the request with the client.\n    go func() {\n        defer wg.Done()\n        for {\n            res, err := req.Do(context.Background(), elasticClient)\n            if err != nil {\n                log.Printf(\"Error getting response fron indexRequest: %s\", err.Error())\n                time.Sleep(5 * time.Second)\n                continue\n            }\n            if res.IsError() {\n                log.Printf(\"[%s] Error indexing document ID=%s\", res.Status(), strconv.Itoa(int(load.Id)))\n                time.Sleep(5 * time.Second)\n                continue\n            } else {\n\n                // Deserialize the response into a map.\n                var r map[string]interface{}\n                if err := json.NewDecoder(res.Body).Decode(&amp;r); err != nil {\n                    log.Printf(\"Error parsing the response body: %s\", err)\n                } else {\n                    // Print the response status and indexed document version.\n                    log.Printf(\"[%s] %s; version=%d\", res.Status(), r[\"result\"], int(r[\"_version\"].(float64)))\n                }\n                break\n            }\n        }\n    }()\n    return nil\n}\n</code></pre>\n\n<p>I also edited the setup function</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func setupElasticSearch() error {\n    var err error\n    cfg := elasticsearch.Config{\n        Addresses: []string{\n            \"http://elasticsearch:9200\",\n            \"http://elasticsearch:9300\",\n        },\n        Transport: &amp;http.Transport{\n            TLSClientConfig: &amp;tls.Config{\n                Renegotiation: tls.RenegotiateOnceAsClient,\n                Certificates:  []tls.Certificate{cer},\n            },\n        },\n    }\n    elasticClient, err = elasticsearch.NewClient(cfg)\n    if err != nil {\n        return err\n    }\n    done := make(chan int)\n    go func(done chan&lt;- int) {\n        for {\n            res, err := elasticClient.Indices.Create(\"load\")\n            if err != nil {\n                log.Printf(\"Malformed response to create index: %s\", err)\n                time.Sleep(5 * time.Second)\n                continue\n            }\n            if res.IsError() {\n                log.Printf(\"Cannot create index: %s\", res)\n                time.Sleep(5 * time.Second)\n                continue\n            }\n            log.Print(\"Successfully created index\")\n            break\n        }\n        done &lt;- 1\n    }(done)\n    &lt;-done\n    return nil\n}\n</code></pre>\n"}, {"tags": ["html", "go", "go-gin"], "comments": [{"owner": {"reputation": 6258, "user_id": 11032044, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bz8vL.jpg?s=128&g=1", "display_name": "Kamol Hasan", "link": "https://stackoverflow.com/users/11032044/kamol-hasan"}, "edited": false, "score": 0, "creation_date": 1566668498, "post_id": 57638886, "comment_id": 101732182, "body": "what is your expected output for <code>fmt.Println(c.PostForm(&quot;submitForm&quot;))</code> ? actually I&#39;m trying to understand your requirements."}], "owner": {"reputation": 9868, "user_id": 6077803, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1a7abebd7e0f177743b3a9c2e7070ffc?s=128&d=identicon&r=PG&f=1", "display_name": "DenCowboy", "link": "https://stackoverflow.com/users/6077803/dencowboy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 173, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1566657271, "creation_date": 1566657271, "question_id": 57638886, "link": "https://stackoverflow.com/questions/57638886/get-all-content-of-post-html-form-in-gin", "title": "Get all content of POST HTML form in Gin", "body": "<p>I've an HTML form:</p>\n\n<pre><code>&lt;body&gt;\n&lt;div&gt;\n  &lt;form method=\"POST\" action=\"/add\"name=\"submitForm\"&gt;\n      &lt;label&gt;Message&lt;/label&gt;&lt;input type=\"text\" name=\"message\" value=\"\" /&gt;\n      &lt;input type=\"checkbox\" name=\"complete\" value=\"\"&gt; Complete&lt;br&gt;\n      &lt;input type=\"submit\" value=\"submit\" /&gt;\n  &lt;/form&gt;\n&lt;/div&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>Now I want to access both values (message and complete) at the same time when a POST occurs.</p>\n\n<p>How can I do this in Go (gin gonic)?</p>\n\n<p>I can do it in two times by using postForm but is there a way to collect them both?:</p>\n\n<pre><code>func AddTodoHandler(c *gin.Context) {\n    fmt.Println(c.PostForm(\"message\"))\n    fmt.Println(c.PostForm(\"complete\"))\n</code></pre>\n\n<p>I tried fmt.Println(c.PostForm(\"submitForm\")) but that did not work.</p>\n"}, {"tags": ["google-app-engine", "go", "deployment"], "comments": [{"owner": {"reputation": 1159, "user_id": 11765092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d90045980ae3429e306c75c5fe4b8688?s=128&d=identicon&r=PG&f=1", "display_name": "pessolato", "link": "https://stackoverflow.com/users/11765092/pessolato"}, "edited": false, "score": 0, "creation_date": 1566830970, "post_id": 57638064, "comment_id": 101769750, "body": "The sample code you are using is correct, I was able to deploy it and it worked for me. Have you tried downloading the files from the repository again and trying to deploy it?"}, {"owner": {"reputation": 492, "user_id": 763410, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/d134fc73057a9dc0901ce8d8d2c7ca88?s=128&d=identicon&r=PG", "display_name": "user763410", "link": "https://stackoverflow.com/users/763410/user763410"}, "reply_to_user": {"reputation": 1159, "user_id": 11765092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d90045980ae3429e306c75c5fe4b8688?s=128&d=identicon&r=PG&f=1", "display_name": "pessolato", "link": "https://stackoverflow.com/users/11765092/pessolato"}, "edited": false, "score": 0, "creation_date": 1566852487, "post_id": 57638064, "comment_id": 101778253, "body": "I didn&#39;t try it under the assumption it will not change anything. Since you suggested, I will download again and let you know how it goes. It is a weekend project for me. so I will take 3-4 days to post the result here. Thanks very much. If it helps, I cloned the repo and cd-ed into static directory. There I did gcloud app deploy. Did you also do the same thing? Is there a way to check the folder structure of the deployment?"}], "answers": [{"comments": [{"owner": {"reputation": 492, "user_id": 763410, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/d134fc73057a9dc0901ce8d8d2c7ca88?s=128&d=identicon&r=PG", "display_name": "user763410", "link": "https://stackoverflow.com/users/763410/user763410"}, "edited": false, "score": 1, "creation_date": 1566921932, "post_id": 57673546, "comment_id": 101803902, "body": "Thanks. I played around with what you suggested. It seems like when you do <code>cd golang-samples&#47;appengine&#47;go11x&#47;static</code>,it fails because (somehow) deployment thinks the root directory to put templates and static(s) is golang-samples(i.e. as a sibling of appengine). When I do <code>cp -r golang-samples&#47;tree&#47;master&#47;appengine&#47;go11x&#47;static ~&#47;staticmodified; cd ~&#47;staticmodified; gcloud app deploy </code>, it works very well. If it helps, I also copied go11x/static to $GOPATH/src, there also it worked well."}, {"owner": {"reputation": 492, "user_id": 763410, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/d134fc73057a9dc0901ce8d8d2c7ca88?s=128&d=identicon&r=PG", "display_name": "user763410", "link": "https://stackoverflow.com/users/763410/user763410"}, "edited": false, "score": 0, "creation_date": 1566922056, "post_id": 57673546, "comment_id": 101803956, "body": "Thans for being so responsive and following up with answer!"}], "tags": [], "owner": {"reputation": 1159, "user_id": 11765092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d90045980ae3429e306c75c5fe4b8688?s=128&d=identicon&r=PG&f=1", "display_name": "pessolato", "link": "https://stackoverflow.com/users/11765092/pessolato"}, "is_accepted": true, "score": 1, "last_activity_date": 1566904703, "creation_date": 1566904703, "answer_id": 57673546, "question_id": 57638064, "link": "https://stackoverflow.com/questions/57638064/how-should-one-handle-file-path-while-hosting-a-go-project-in-google-app-engine/57673546#57673546", "title": "How should one handle file path while hosting a Go project in Google App Engine ? open templates/index.html: no such file or directory", "body": "<p>So... I tested this deployment in 3 different ways and what I found was that:</p>\n\n<ol>\n<li><p>Directly cloning the repo with <code>git clone</code>, <code>cd</code> to the <strong>static</strong> folder, and deploying from there, reproduced the issue, but only if I did it from my Google Cloud Shell.</p>\n\n<p><strong>a.</strong> I later found out that the Go version I had in the Cloud Shell was the Go 1.12.</p>\n\n<p><strong>b.</strong> I created a new VM instance to test it from a fresh Go 1.11 environment and the same process worked like a treat.</p></li>\n<li><p>The same process as the above, but instead of deploying from the static, I moved its content to a different directory and then I deployed it from there.</p>\n\n<p><strong>a.</strong> This worked in the VM instance and in the Cloud Shell.</p></li>\n<li><p>As suggested in the <a href=\"https://cloud.google.com/appengine/docs/standard/go111/quickstart\" rel=\"nofollow noreferrer\">Quickstart for Go 1.11 in the App Engine Standard Environment</a>, I downloaded the sample code using the <code>go get</code> command, <code>cd</code> to the static folder and deployed from there.</p>\n\n<p><strong>a.</strong> This also worked in both environments.</p></li>\n</ol>\n\n<p>My suggestion is to always try to download Google's golang samples using the <code>go get</code> command, as it is suggested in the guides and it did not mess with the App Engine deployment in the tests I made.</p>\n\n<p>It is also important to mention that both environments had the same Cloud SDK version, which is the 259.</p>\n"}], "owner": {"reputation": 492, "user_id": 763410, "user_type": "registered", "accept_rate": 42, "profile_image": "https://www.gravatar.com/avatar/d134fc73057a9dc0901ce8d8d2c7ca88?s=128&d=identicon&r=PG", "display_name": "user763410", "link": "https://stackoverflow.com/users/763410/user763410"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 57673546, "answer_count": 1, "score": 1, "last_activity_date": 1566904703, "creation_date": 1566650632, "question_id": 57638064, "link": "https://stackoverflow.com/questions/57638064/how-should-one-handle-file-path-while-hosting-a-go-project-in-google-app-engine", "title": "How should one handle file path while hosting a Go project in Google App Engine ? open templates/index.html: no such file or directory", "body": "<p>I am trying to deploy a simple go language code on Google's app engine. This is the code I am trying to deploy. \n<a href=\"https://github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine/go11x/static\" rel=\"nofollow noreferrer\">https://github.com/GoogleCloudPlatform/golang-samples/tree/master/appengine/go11x/static</a></p>\n\n<p>main.go</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"html/template\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"path/filepath\"\n    \"time\"\n)\n\nvar (\n    indexTmpl = template.Must(\n        template.ParseFiles(filepath.Join(\"templates\", \"index.html\")),\n    )\n)\n\nfunc main() {\n    http.HandleFunc(\"/\", indexHandler)\n\n    // Serve static files out of the public directory.\n    // By configuring a static handler in app.yaml, App Engine serves all the\n    // static content itself. As a result, the following two lines are in\n    // effect for development only.\n    public := http.StripPrefix(\"/public\", http.FileServer(http.Dir(\"public\")))\n    http.Handle(\"/public/\", public)\n\n    port := os.Getenv(\"PORT\")\n    if port == \"\" {\n        port = \"8080\"\n        log.Printf(\"Defaulting to port %s\", port)\n    }\n\n    log.Printf(\"Listening on port %s\", port)\n    log.Fatal(http.ListenAndServe(fmt.Sprintf(\":%s\", port), nil))\n}\n\n// indexHandler uses a template to create an index.html.\nfunc indexHandler(w http.ResponseWriter, r *http.Request) {\n    if r.URL.Path != \"/\" {\n        http.NotFound(w, r)\n        return\n    }\n    type indexData struct {\n        Logo        string\n        Style       string\n        RequestTime string\n    }\n    data := indexData{\n        Logo:        \"/public/gcp-gopher.svg\",\n        Style:       \"/public/style.css\",\n        RequestTime: time.Now().Format(time.RFC822),\n    }\n    if err := indexTmpl.Execute(w, data); err != nil {\n        log.Printf(\"Error executing template: %v\", err)\n        http.Error(w, \"Internal server error\", http.StatusInternalServerError)\n    }\n}\n</code></pre>\n\n<p>When I deploy this code using  <code>gcloud app deploy</code> and use the browser to load the webpage, I see error </p>\n\n<pre><code>2019-08-24 06:32:19 default[]  \"GET / HTTP/1.1\" 500\n2019-08-24 06:32:20 default[]  panic: open templates/index.html: no such file or directory    goroutine 1 [running]:  html/template.Must(0x0, 0x800800, 0xc000078f90, 0\nx0)     /usr/local/go/src/html/template/template.go:372 +0x54\n</code></pre>\n\n<p>My app.yaml file looks like this. It has static mentioned but nothing about templates.</p>\n\n<pre><code>runtime: go111\nhandlers:\n# Configure App Engine to serve any static assets.\n- url: /public\n  static_dir: public\n# Use HTTPS for all requests.\n- url: /.*\n  secure: always\n  redirect_http_response_code: 301\n  script: auto\n</code></pre>\n\n<p>Question:\nHow do I handle templates and other small files that I want the application to read? Mine is a toy application so I do not need cloud storage or any such solution. I just want to read from a (local) directory.</p>\n"}, {"tags": ["go", "rust", "rust-tokio"], "comments": [{"owner": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 2, "creation_date": 1566642947, "post_id": 57636708, "comment_id": 101726740, "body": "Given that TCP is stream oriented while UDP is message oriented, I wonder what the Go interface looks like and how it even makes sense to handle these the same way."}, {"owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "reply_to_user": {"reputation": 20827, "user_id": 2733851, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MUOS4.png?s=128&g=1", "display_name": "mcarton", "link": "https://stackoverflow.com/users/2733851/mcarton"}, "edited": false, "score": 0, "creation_date": 1566642985, "post_id": 57636708, "comment_id": 101726750, "body": "@mcarton <a href=\"https://golang.org/pkg/net/#Conn\" rel=\"nofollow noreferrer\">golang.org/pkg/net/#Conn</a>"}, {"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 2, "creation_date": 1566649506, "post_id": 57636708, "comment_id": 101728035, "body": "Nobody uses UDP that way. TCP and UDP have distinct requirements, and it makes no sense to expect to send the same stream of data without knowing the underlying protocol. For example, UDP has packet loss and TCP does not. It would be unreliable to send UDP data directly like a stream."}, {"owner": {"reputation": 478015, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 1, "creation_date": 1566675679, "post_id": 57636708, "comment_id": 101733732, "body": "The first sentence of the linked documentation: &quot;<code>Conn</code> is a generic stream-oriented network connection.&quot; Yet, <code>UDPConn</code> indeed implements this interface, which is surprising. I wouldn&#39;t go as far as @SOFe and claim that <i>nobody</i> uses UDP for streaming data \u2013 in fact it&#39;s rather common for real-time applications \u2013 but it is very unusual to classify UDP as a stream-oriented rather than a message-oriented protocol."}, {"owner": {"reputation": 478015, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "reply_to_user": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1566676002, "post_id": 57636708, "comment_id": 101733800, "body": "(To clarify, I actually fully agree with what @SOFe said \u2013 even if you stream data via UDP, you need to know that you are using UDP.)"}, {"owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "reply_to_user": {"reputation": 478015, "user_id": 279627, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/2dceea858ad8f1577bec6ddaa0485d15?s=128&d=identicon&r=PG", "display_name": "Sven Marnach", "link": "https://stackoverflow.com/users/279627/sven-marnach"}, "edited": false, "score": 0, "creation_date": 1566695919, "post_id": 57636708, "comment_id": 101736694, "body": "@SvenMarnach That makes sense. For context, the Go library I mentioned implements a STUN client on top of <code>Conn</code>, and the STUN RFC specifies retry mechanism."}, {"owner": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1566705951, "post_id": 57636708, "comment_id": 101737606, "body": "@ZizhengTai But then retry mechanism.on TCP is a waste of bandwidth."}, {"owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "reply_to_user": {"reputation": 7096, "user_id": 3990767, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0a5741a212e3b0e6bd46a8a1e6d76a4a?s=128&d=identicon&r=PG", "display_name": "SOFe", "link": "https://stackoverflow.com/users/3990767/sofe"}, "edited": false, "score": 0, "creation_date": 1566706143, "post_id": 57636708, "comment_id": 101737627, "body": "@SOFe Well the protocol specifies different retry mechanisms for TCP and UDP. But you&#39;re right that I need to handle TCP and UDP quite differently anyway."}], "owner": {"reputation": 4849, "user_id": 3234803, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/FEjsw.png?s=128&g=1", "display_name": "Zizheng Tai", "link": "https://stackoverflow.com/users/3234803/zizheng-tai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 150, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1566642653, "creation_date": 1566639032, "last_edit_date": 1566642653, "question_id": 57636708, "link": "https://stackoverflow.com/questions/57636708/rust-abstraction-over-different-types-of-network-connections", "title": "Rust abstraction over different types of network connections", "body": "<p>I was recently working with a Go project and a Rust project, and noticed that in Go's standard library there is a <code>net.Conn</code> interface that represents \"a generic stream-oriented network connection,\" such as a UDP connection, a TCP connection, or a TLS-over-TCP connection.</p>\n\n<p>I'm wondering if there is something similar to this in Rust. I'm interested in the async ecosystem, so I looked at <code>tokio::net::{TcpStream, UdpSocket}</code> and <code>async_std::net::{TcpStream, UdpSocket}</code>, but they don't seem to implement some common trait.</p>\n\n<p>If I want to abstract over at least the aforementioned three types of network connections, is there some abstraction like a trait in the stdlib or elsewhere that I can use?</p>\n"}, {"tags": ["firebase", "authentication", "go", "google-cloud-firestore", "firebase-authentication"], "answers": [{"tags": [], "owner": {"reputation": 649, "user_id": 554480, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/m1Kjt.png?s=128&g=1", "display_name": "Mikhail", "link": "https://stackoverflow.com/users/554480/mikhail"}, "is_accepted": false, "score": 0, "last_activity_date": 1566646295, "creation_date": 1566646295, "answer_id": 57637556, "question_id": 57635910, "link": "https://stackoverflow.com/questions/57635910/how-to-authenticate-user-to-firestore-go-sdk/57637556#57637556", "title": "How to authenticate user to Firestore Go SDK?", "body": "<p><code>option.WithCredentialsJSON</code> accepts not JWT token, but Google Application Default Credentials.</p>\n\n<p>Other option is to provide path to the file with Google Application Default Credentials using environment variable <code>GOOGLE_APPLICATION_CREDENTIALS</code> since firebase sdk is a part of the <code>cloud.google.com/go</code> sdk.</p>\n\n<p>Check out the examples (also with other options).</p>\n\n<p><a href=\"https://cloud.google.com/docs/authentication/production#auth-cloud-implicit-go\" rel=\"nofollow noreferrer\">https://cloud.google.com/docs/authentication/production#auth-cloud-implicit-go</a></p>\n\n<p><a href=\"https://godoc.org/cloud.google.com/go#example-package--ApplicationDefaultCredentials\" rel=\"nofollow noreferrer\">https://godoc.org/cloud.google.com/go#example-package--ApplicationDefaultCredentials</a></p>\n"}, {"comments": [{"owner": {"reputation": 170, "user_id": 198507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7f25bdccde3229fa00055502199a535c?s=128&d=identicon&r=PG", "display_name": "0x5f3759df", "link": "https://stackoverflow.com/users/198507/0x5f3759df"}, "edited": false, "score": 0, "creation_date": 1575801707, "post_id": 57638716, "comment_id": 104681204, "body": "Can you explain how this decision &quot;<i>The Go SDK for Firestore is meant to be used in a trusted environment</i>&quot;  is beneficial to anybody or how it accomplishes the <i>trusted environment</i> requirement in the context of the OP? One can use the Firestore Go SDK in a trusted or untrusted environment, but by using the Go SDK <i>not</i> authorize users with an ID Token. However by using Firestore REST API on that same trusted or untrusted environment you can authorize users by setting the ID token in the <code>Authorization</code> header of the request."}, {"owner": {"reputation": 21333, "user_id": 226391, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/69dc78b59ef008c58e6e842f9f3e0624?s=128&d=identicon&r=PG", "display_name": "Michael Bleigh", "link": "https://stackoverflow.com/users/226391/michael-bleigh"}, "edited": false, "score": 0, "creation_date": 1603150162, "post_id": 57638716, "comment_id": 113939580, "body": "The Firebase Admin SDKs don&#39;t work like client SDKs -- as an example, they bypass security rules for Firestore and Cloud Storage, and offer non-client activities like listing and deleting users in Firebase Auth. Firebase does not offer a client SDK for Go, and the Admin SDK is not well-suited to an untrusted client environment."}], "tags": [], "owner": {"reputation": 411025, "user_id": 209103, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/12d378e6a9788ab9c94bbafe242b82b4?s=128&d=identicon&r=PG", "display_name": "Frank van Puffelen", "link": "https://stackoverflow.com/users/209103/frank-van-puffelen"}, "is_accepted": true, "score": 2, "last_activity_date": 1566655836, "creation_date": 1566655836, "answer_id": 57638716, "question_id": 57635910, "link": "https://stackoverflow.com/questions/57635910/how-to-authenticate-user-to-firestore-go-sdk/57638716#57638716", "title": "How to authenticate user to Firestore Go SDK?", "body": "<p>The Go SDK for Firestore is meant to be used in a trusted environment, such as your development machine, a server you control, or Cloud Functions. It doesn't have a way to sign the user of the application in, but instead authenticates itself with the server with administrative credentials, which you'll don't want to have on non-trusted devices.</p>\n"}], "owner": {"reputation": 58775, "user_id": 474189, "user_type": "registered", "accept_rate": 72, "profile_image": "https://i.stack.imgur.com/jzXIJ.jpg?s=128&g=1", "display_name": "Duncan Jones", "link": "https://stackoverflow.com/users/474189/duncan-jones"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 325, "favorite_count": 0, "accepted_answer_id": 57638716, "answer_count": 2, "score": 1, "last_activity_date": 1566655836, "creation_date": 1566631144, "question_id": 57635910, "link": "https://stackoverflow.com/questions/57635910/how-to-authenticate-user-to-firestore-go-sdk", "title": "How to authenticate user to Firestore Go SDK?", "body": "<p>I'm trying to use the <a href=\"https://godoc.org/cloud.google.com/go/firestore\" rel=\"nofollow noreferrer\">Firestore Go SDK</a> from a client application. This looks like a client-side SDK, based on the functions, but that might be my first error?</p>\n\n<p>I'm struggling to authenticate the user to Firestore. I've already logged them in using the <a href=\"https://firebase.google.com/docs/reference/rest/auth#section-sign-in-email-password\" rel=\"nofollow noreferrer\">REST API for Firebase Auth</a>. This returns me an ID token, refresh token, etc. How do I use this with the Firestore SDK?</p>\n\n<p>The docs suggest I need to call <a href=\"https://godoc.org/cloud.google.com/go/firestore#NewClient\" rel=\"nofollow noreferrer\"><code>firestore.NewClient(&lt;context&gt;, &lt;project-id&gt;, &lt;option&gt;)</code></a>. For the latter argument, I've tried <a href=\"https://godoc.org/google.golang.org/api/option#WithCredentialsJSON\" rel=\"nofollow noreferrer\"><code>option.WithCredentialsJSON(...)</code></a> passing a JWT-decoded ID token. I've also tried passing the raw refresh token. In both cases, the SDK complains about what I'm passing.</p>\n\n<p>How can I authenticate the user based on the tokens I've obtained?</p>\n"}, {"tags": ["go", "couchbase"], "answers": [{"comments": [{"owner": {"reputation": 1365, "user_id": 1848653, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/01b16c9fb1ae46f317a53694e944a1e6?s=128&d=identicon&r=PG", "display_name": "Tusshu", "link": "https://stackoverflow.com/users/1848653/tusshu"}, "edited": false, "score": 2, "creation_date": 1566630732, "post_id": 57634885, "comment_id": 101724414, "body": "changed line:  rows, _ := bucket.ExecuteN1qlQuery(query, []interface{}{&quot;African Swallows&quot;}) to rows, err := bucket.ExecuteN1qlQuery(query, []interface{}{&quot;African Swallows&quot;}) to handle error. Also changed bucketname in line below to actual name of the bucket: query := gocb.NewN1qlQuery(&quot;SELECT * FROM bucketname WHERE $1 IN interests&quot;) .  original example code is here:  <a href=\"https://docs.couchbase.com/go-sdk/current/start-using-sdk.html\" rel=\"nofollow noreferrer\">docs.couchbase.com/go-sdk/current/start-using-sdk.html</a>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1566617458, "creation_date": 1566617458, "answer_id": 57634885, "question_id": 57634695, "link": "https://stackoverflow.com/questions/57634695/panic-runtime-error-while-running-hello-couchbase-application/57634885#57634885", "title": "Panic runtime error while running Hello Couchbase application", "body": "<blockquote>\n  <p>Once you\u2019ve installed the SDK you can run this simple code snippet\n  showcasing some of its features.</p>\n  \n  <p>Error checking has been omitted for brevity.</p>\n  \n  <p><a href=\"https://docs.couchbase.com/go-sdk/current/start-using-sdk.html\" rel=\"nofollow noreferrer\">https://docs.couchbase.com/go-sdk/current/start-using-sdk.html</a></p>\n</blockquote>\n\n<hr>\n\n<p>In Go, always check for errors. If you check for errors, what errors occur?</p>\n\n<p>The error</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>often indicates that an error was ignored.</p>\n"}], "owner": {"reputation": 1365, "user_id": 1848653, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/01b16c9fb1ae46f317a53694e944a1e6?s=128&d=identicon&r=PG", "display_name": "Tusshu", "link": "https://stackoverflow.com/users/1848653/tusshu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 118, "favorite_count": 1, "closed_date": 1566644059, "accepted_answer_id": 57634885, "answer_count": 1, "score": 1, "last_activity_date": 1566629685, "creation_date": 1566614115, "last_edit_date": 1566629685, "question_id": 57634695, "link": "https://stackoverflow.com/questions/57634695/panic-runtime-error-while-running-hello-couchbase-application", "closed_reason": "Not suitable for this site", "title": "Panic runtime error while running Hello Couchbase application", "body": "<p>Installed go SDK 1.6 following the instructions given here:\n<a href=\"https://docs.couchbase.com/go-sdk/current/start-using-sdk.html\" rel=\"nofollow noreferrer\">https://docs.couchbase.com/go-sdk/current/start-using-sdk.html</a>\nCreated Hello Couchbase application as listed on the above page. While running the application, the program panics at the line :slight_smile:\nfor rows.Next(&amp;row) {\nand produces the following error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x30 pc=0x12d66b2]\n</code></pre>\n\n<p>Go version prints the following: go version go1.12.9 darwin/amd64\nmacOS version 10.14.6</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1566629380, "post_id": 57634527, "comment_id": 101724203, "body": "As you say, the problem is the body--which this code didn&#39;t generate. So this code can&#39;t help solve the problem."}], "answers": [{"tags": [], "owner": {"reputation": 2643, "user_id": 890517, "user_type": "registered", "accept_rate": 98, "profile_image": "https://www.gravatar.com/avatar/704aeeb86f1918a8e36790011987334f?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/890517/peter"}, "is_accepted": false, "score": 2, "last_activity_date": 1566615154, "last_edit_date": 1566615154, "creation_date": 1566614802, "answer_id": 57634737, "question_id": 57634527, "link": "https://stackoverflow.com/questions/57634527/how-to-fix-name-is-undefined-on-object-error/57634737#57634737", "title": "how to fix &#39;name&#39; is undefined on object error?", "body": "<p>That error message is probably being returned from the API Call you're making and not the JSON Marshal. I suspect it's due to the way you're marshalling your payload - you're writing JSON to the fields and then JSON marshalling it so you end up with a payload that looks like: </p>\n\n<pre><code>{\"maintenance_plan\":{\"name\":\"\\\"name\\\": \\\"scheduled host maintenance\\\",\",\"condition\":\"\\\"condition\\\": {\\\"=\\\": [\\\"host\\\", \\\"prod-api-1\\\"]},\",\"start\":\"\\\"start\\\": \\\"1566514810\\\",\",\"end\":\"\\\"end\\\": \\\"156651600\\\"\"}}\n\n</code></pre>\n\n<p>Notice the double \"name: \"\\name\\\".</p>\n\n<p>The way to fix it would be to do something like:</p>\n\n<pre><code>data := Payload{\n   MaintenancePlan: MaintenancePlan{\n      Name: \"scheduled host maintenance\",\n      Condition: map[string][]string{\n         \"=\": []string{\"host\", \"prod-api-1\"},\n      },\n      StartTime: \"1566514810\",\n      EndTime: \"156651600\",\n   },\n}\n\nvar buf bytes.Buffer\nerr := json.NewEncoder(&amp;buf).Encode(data)\nif err != nil {\n  // Handle me\n}\nreq, err := http.NewRequest(http.MethodPost, \"https://foo/bar\", &amp;buf)\n// continue\n</code></pre>\n\n<p>Example: <a href=\"https://play.golang.org/p/J6wrsLYkvwF\" rel=\"nofollow noreferrer\">https://play.golang.org/p/J6wrsLYkvwF</a></p>\n"}], "owner": {"reputation": 1, "user_id": 8234147, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee449d9dabb8830bc88c719492c74829?s=128&d=identicon&r=PG&f=1", "display_name": "svpr", "link": "https://stackoverflow.com/users/8234147/svpr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "closed_date": 1566644116, "answer_count": 1, "score": -6, "last_activity_date": 1566629328, "creation_date": 1566611181, "last_edit_date": 1566629328, "question_id": 57634527, "link": "https://stackoverflow.com/questions/57634527/how-to-fix-name-is-undefined-on-object-error", "closed_reason": "Not suitable for this site", "title": "how to fix &#39;name&#39; is undefined on object error?", "body": "<p>I'm making an API post request to bigpanda using Go.</p>\n\n<p><a href=\"https://docs.bigpanda.io/reference#create-plan\" rel=\"nofollow noreferrer\">https://docs.bigpanda.io/reference#create-plan</a></p>\n\n<p>I have below code and when I try to make API post getting <code>name</code> is <code>undefined</code> on object error.</p>\n\n<pre><code>2019/08/23 18:38:04 {\n  \"status\" : \"failure\",\n  \"error\" : \"{\\\"obj\\\":[{\\\"msg\\\":[\\\"'name' is undefined on object: {\\\\\\\"maintenance_plan\\\\\\\":{\\\\\\\"name\\\\\\\":\\\\\\\"\\\\\\\\\\\\\\\"name\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"scheduled host maintenance\\\\\\\\\\\\\\\",\\\\\\\",\\\\\\\"condition\\\\\\\":\\\\\\\"\\\\\\\\\\\\\\\"condition\\\\\\\\\\\\\\\": {\\\\\\\\\\\\\\\"=\\\\\\\\\\\\\\\": [\\\\\\\\\\\\\\\"host\\\\\\\\\\\\\\\", \\\\\\\\\\\\\\\"prod-api-1\\\\\\\\\\\\\\\"]},\\\\\\\",\\\\\\\"start\\\\\\\":\\\\\\\"\\\\\\\\\\\\\\\"start\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"1566514810\\\\\\\\\\\\\\\",\\\\\\\",\\\\\\\"end\\\\\\\":\\\\\\\"\\\\\\\\\\\\\\\"end\\\\\\\\\\\\\\\": \\\\\\\\\\\\\\\"156651600\\\\\\\\\\\\\\\"\\\\\\\"}}\\\"],\\\"args\\\":[]}]}\"\n}\n</code></pre>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\n\ntype Maintenace_Plan struct {\n    Name       string `json:\"name\"`\n    //Condition  map[string]map[string][]string  `json:condition`\n    Condition   string `json:\"condition\"`\n    Start      string `json:\"start\"`\n    End        string `json:\"end\"`\n}\n\n\ntype Payload struct {\n    Maintenace_Plan Maintenace_Plan `json:\"maintenance_plan\"`\n}\n\nfunc main() {\n    name        := `\"name\": \"scheduled host maintenance\",`\n    create_plan :=  `\"condition\": {\"=\": [\"host\", \"prod-api-1\"]},`\n    start_time  := `\"start\": \"1566514810\",`\n    end_time    := `\"end\": \"156651600\"`\n\n    data := Payload{\n        Maintenace_Plan: Maintenace_Plan{\n            Name:       name,\n            Condition:  create_plan,\n            Start:      start_time,\n            End:        end_time,\n        },\n    }\n\n    payloadBytes, err := json.Marshal(data)\n    if err != nil {\n        fmt.Println(err)\n    }\n    body := bytes.NewReader(payloadBytes)\n\n    req, err := http.NewRequest(\"POST\", \"https://api.bigpanda.io/resources/v2.0/maintenance-plans\", body)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    req.Header.Set(\"Content-Type\", \"application/json\")\n    req.Header.Set(\"Authorization\", \"Bearer &lt;token&gt;\")\n\n    resp, err := http.DefaultClient.Do(req)\n\n    defer resp.Body.Close()\n\n    body_1, err := ioutil.ReadAll(resp.Body)\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    log.Println(string(body_1))\n\n}\n</code></pre>\n\n<p>Looks like body is incorrect.\nIs there any way to fix the code.</p>\n"}, {"tags": ["http", "go", "byte"], "comments": [{"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566609168, "post_id": 57634385, "comment_id": 101721851, "body": "Use a multipart message. <a href=\"https://golang.org/pkg/mime/multipart/\" rel=\"nofollow noreferrer\">golang.org/pkg/mime/multipart</a>"}, {"owner": {"reputation": 1, "user_id": 11925128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ccb01e34d6ed7addc1d349499b3019?s=128&d=identicon&r=PG&f=1", "display_name": "golangbestlang", "link": "https://stackoverflow.com/users/11925128/golangbestlang"}, "reply_to_user": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "edited": false, "score": 0, "creation_date": 1566609879, "post_id": 57634385, "comment_id": 101721939, "body": "@bserdar could you provide an example for use with http.newrequest"}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 11925128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ccb01e34d6ed7addc1d349499b3019?s=128&d=identicon&r=PG&f=1", "display_name": "golangbestlang", "link": "https://stackoverflow.com/users/11925128/golangbestlang"}, "edited": false, "score": 0, "creation_date": 1566611127, "post_id": 57634496, "comment_id": 101722046, "body": "could you write something quick that uses http.NewRequest with a body that is formatted like:``` string []byte string```"}, {"owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "reply_to_user": {"reputation": 1, "user_id": 11925128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ccb01e34d6ed7addc1d349499b3019?s=128&d=identicon&r=PG&f=1", "display_name": "golangbestlang", "link": "https://stackoverflow.com/users/11925128/golangbestlang"}, "edited": false, "score": 0, "creation_date": 1566611288, "post_id": 57634496, "comment_id": 101722063, "body": "The example I have has two parts, a text part and an image part. Just add another text part. You realize, the other end of this, the receiver, has to read this as multipart as well."}], "tags": [], "owner": {"reputation": 26005, "user_id": 11923999, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/M84sB.png?s=128&g=1", "display_name": "Burak Serdar", "link": "https://stackoverflow.com/users/11923999/burak-serdar"}, "is_accepted": true, "score": 0, "last_activity_date": 1566610563, "creation_date": 1566610563, "answer_id": 57634496, "question_id": 57634385, "link": "https://stackoverflow.com/questions/57634385/combining-string-and-byte-for-payload/57634496#57634496", "title": "Combining string and []byte for payload", "body": "<p>Here's an example using multipart request. I modified this from a piece of code I have that deals with JSON docs, so there may be some mistakes in it, but it should give you the idea:</p>\n\n<pre><code>        body := bytes.Buffer{}\n        writer := multipart.NewWriter(&amp;body)\n        hdr := textproto.MIMEHeader{}\n        hdr.Set(\"Content-Type\", \"text/plain\")\n        part, _ := writer.CreatePart(hdr)\n        part.Write(data1)\n\n        hdr = textproto.MIMEHeader{}\n        hdr.Set(\"Content-Type\", &lt;image type&gt;)\n        part, _ = writer.CreatePart(hdr)\n        part.Write(imageData)\n\n        ... // Add more parts if you need to\n        writer.Close()\n\n        request, _ := http.NewRequest(http.MethodPost, url, &amp;body)\n        request.Header.Set(\"Content-Type\", fmt.Sprintf(\"multipart/mixed;boundary=%s\", writer.Boundary()))\n\n        hcli := http.Client{}\n        rsp, err := hcli.Do(request)\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 11925128, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/62ccb01e34d6ed7addc1d349499b3019?s=128&d=identicon&r=PG&f=1", "display_name": "golangbestlang", "link": "https://stackoverflow.com/users/11925128/golangbestlang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 57634496, "answer_count": 1, "score": -4, "last_activity_date": 1566610563, "creation_date": 1566608677, "question_id": 57634385, "link": "https://stackoverflow.com/questions/57634385/combining-string-and-byte-for-payload", "title": "Combining string and []byte for payload", "body": "<p>I'm trying to send an http request with a payload that contains 2 strings and a []byte. Any good ways of going about this? I've tried encryption/decryption (didn't work), converting the []byte to string (since the []byte is an image, it didn't work).</p>\n\n<p>Visual representation:</p>\n\n<p>string1\n[]byte\nstring2</p>\n"}]