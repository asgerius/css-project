[{"tags": ["mongodb", "go", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1501599312, "post_id": 30235834, "comment_id": 77843524, "body": "even this does not work. see this: <a href=\"https://github.com/go-mgo/mgo/issues/473\" rel=\"nofollow noreferrer\">github.com/go-mgo/mgo/issues/473</a>"}, {"owner": {"reputation": 2303, "user_id": 109274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a59b0daee5e5570e07a9f976721017e7?s=128&d=identicon&r=PG", "display_name": "mikezter", "link": "https://stackoverflow.com/users/109274/mikezter"}, "reply_to_user": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1523288177, "post_id": 30235834, "comment_id": 86487466, "body": "@InancGumus i don&#39;t see the connection between your issue and this question."}, {"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "reply_to_user": {"reputation": 2303, "user_id": 109274, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a59b0daee5e5570e07a9f976721017e7?s=128&d=identicon&r=PG", "display_name": "mikezter", "link": "https://stackoverflow.com/users/109274/mikezter"}, "edited": false, "score": 0, "creation_date": 1523302706, "post_id": 30235834, "comment_id": 86495308, "body": "@mikezter Subsequent requests getting EOF"}], "tags": [], "owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "is_accepted": true, "score": 4, "last_activity_date": 1431601742, "creation_date": 1431601742, "answer_id": 30235834, "question_id": 30086489, "link": "https://stackoverflow.com/questions/30086489/go-lang-and-labix-mgo-getting-eof-after-subsequent-requests/30235834#30235834", "title": "Go Lang and Labix mgo - getting EOF after subsequent requests", "body": "<p>The answer can be found here: <a href=\"https://groups.google.com/forum/#!topic/mgo-users/XM0rc6p-V-8\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/mgo-users/XM0rc6p-V-8</a></p>\n\n<blockquote>\n  <p>There are two easy ways to get rid of the error:</p>\n  \n  <p>1) Call Refresh on the session, which makes it discard (or put back in\n  the pool, if the connection is good) the connection it's holding, and\n  pick a new one when necessary.</p>\n  \n  <p>2) Instead of using a single session, use many by calling session.Copy\n  when you need a new session, and then call session.Close when you're\n  done with it. This will also mean you're using multiple connections to\n  the database, when necessary.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 6626, "user_id": 4907913, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2c2769a366bde01ddbf60008819e371c?s=128&d=identicon&r=PG&f=1", "display_name": "thewaywewere", "link": "https://stackoverflow.com/users/4907913/thewaywewere"}, "edited": false, "score": 0, "creation_date": 1496194399, "post_id": 44274165, "comment_id": 75556170, "body": "Welcome to SO. Please read this <a href=\"http://stackoverflow.com/help/how-to-answer\">how-to-answer</a> for providing quality answer."}], "tags": [], "owner": {"reputation": 9, "user_id": 6653958, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43c9c84d0991fccec20641719999a332?s=128&d=identicon&r=PG", "display_name": "lee", "link": "https://stackoverflow.com/users/6653958/lee"}, "is_accepted": false, "score": 1, "last_activity_date": 1496193257, "creation_date": 1496193257, "answer_id": 44274165, "question_id": 30086489, "link": "https://stackoverflow.com/questions/30086489/go-lang-and-labix-mgo-getting-eof-after-subsequent-requests/44274165#44274165", "title": "Go Lang and Labix mgo - getting EOF after subsequent requests", "body": "<p>session.Copy may create many many connections to mongodb, in big projects, you may got \"too many files open\", so you can try this:</p>\n\n<p><a href=\"https://github.com/ti/mdb\" rel=\"nofollow noreferrer\">https://github.com/ti/mdb</a></p>\n\n<p>this will auto call session.refresh if your connection is not stable.</p>\n\n<p>less connection and less error, for retry policy.</p>\n"}], "owner": {"reputation": 907, "user_id": 1279730, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/c143e62707810f29f4fb207c1cf797ad?s=128&d=identicon&r=PG", "display_name": "machete", "link": "https://stackoverflow.com/users/1279730/machete"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2828, "favorite_count": 2, "accepted_answer_id": 30235834, "answer_count": 2, "score": 3, "last_activity_date": 1496193257, "creation_date": 1430942671, "last_edit_date": 1430957553, "question_id": 30086489, "link": "https://stackoverflow.com/questions/30086489/go-lang-and-labix-mgo-getting-eof-after-subsequent-requests", "title": "Go Lang and Labix mgo - getting EOF after subsequent requests", "body": "<p>I have a web process, similar to</p>\n\n<pre><code>func main() {\n    // mgo\n    mongoDatabase, err := mgopath.Connect(envMongoPath)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    r := mux.NewRouter()\n    // ....\n    r.HandleFunc(\"/apps/{app:.+}\", stuffHandler(mongoDatabase)).Methods(\"GET\")\n    http.Handle(\"/\", r)\n\n    listen := fmt.Sprintf(\"%s:%s\", host, port)\n    log.Fatal(http.ListenAndServe(listen, nil))\n}\n</code></pre>\n\n<p>while mgopath.Connect looks like</p>\n\n<pre><code>func Connect(mongoPath string) (*mgo.Database, error) {\n    dbConfig, err := url.Parse(mongoPath)\n    if err != nil {\n        return nil, err\n    }\n\n    log.Printf(\"Connecting to %s\", dbConfig.Host)\n    sess, err := mgo.Dial(dbConfig.Host)\n    if err != nil {\n        return nil, err\n    }\n\n    dbName := dbConfig.Path\n    log.Printf(\"Using database %s\", dbName)\n    if len(dbName) &lt; 2 {\n        return nil, errors.New(\"No database name specified.\")\n    }\n\n    dbName = dbConfig.Path[1:len(dbConfig.Path)]\n    return sess.DB(dbName), err\n}\n</code></pre>\n\n<p>Somewhere down the road:</p>\n\n<pre><code>c := database.C(\"stuff\")\nerr = c.Find(bson.M{\"id\": id}).One(&amp;item) // First ~1-2 minutes work as expected, then I receive EOFs\n// c.Insert(), c.Update(), c.All()...\n</code></pre>\n\n<p>The problem is, that after a couple of minutes, all queries to mongodb return the error <code>EOF</code>. I have to restart the process to get things working again. Experienced both issues on Mac and (more frequently) on Windows. MongoDB runs inside of Docker, which in turn runs inside of boot2docker. VM Port forwarding have been done (that's why queries work for a certain amount of time).</p>\n\n<p>Does mgo require me to dial every time I'm doing a query? Is there some timeout I don't know about?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "edited": false, "score": 1, "creation_date": 1430942120, "post_id": 30086302, "comment_id": 48285773, "body": "Related: <a href=\"http://programmers.stackexchange.com/questions/210399/why-is-there-a-new-in-go\" title=\"why is there a new in go\">programmers.stackexchange.com/questions/210399/&hellip;</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430974659, "post_id": 30086302, "comment_id": 48297035, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/27827871/what-the-difference-between-tnil-and-t-newt-golang\">What the difference between (*T)(nil) and &amp;T{}/new(T)? Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "is_accepted": false, "score": 7, "last_activity_date": 1430942057, "creation_date": 1430942057, "answer_id": 30086303, "question_id": 30086302, "link": "https://stackoverflow.com/questions/30086302/what-is-the-difference-between-newt-and-t/30086303#30086303", "title": "What is the difference between new(T) and &amp;T{}?", "body": "<p>There is no difference. According to <a href=\"https://golang.org/doc/effective_go.html#composite_literals\">Effective Go</a>, they are equivalent.</p>\n\n<blockquote>\n  <p>As a limiting case, if a composite literal contains no fields at all, it creates a zero value for the type. The expressions new(File) and &amp;File{} are equivalent.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "edited": false, "score": 0, "creation_date": 1431097619, "post_id": 30091345, "comment_id": 48363856, "body": "Yes, good point. &amp;T{} is only for composite literals (i.e., structs, arrays, slices, and maps)."}], "tags": [], "owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "is_accepted": true, "score": 4, "last_activity_date": 1430968814, "creation_date": 1430968814, "answer_id": 30091345, "question_id": 30086302, "link": "https://stackoverflow.com/questions/30086302/what-is-the-difference-between-newt-and-t/30091345#30091345", "title": "What is the difference between new(T) and &amp;T{}?", "body": "<p>Extending @Doug answer: </p>\n\n<p>The two forms <code>new(T)</code> and <code>&amp;T{}</code> are completely equivalent: Both allocate a zero T and return a pointer to this allocated memory. The only difference is, that &amp;T{} doesn't work for <a href=\"https://play.golang.org/p/tKr3d_fehQ\" rel=\"nofollow\">builtin types like</a> <code>int</code>; you can only do <code>new(int)</code>.</p>\n"}], "owner": {"reputation": 9371, "user_id": 196964, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/df6zG.jpg?s=128&g=1", "display_name": "Doug Richardson", "link": "https://stackoverflow.com/users/196964/doug-richardson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "accepted_answer_id": 30091345, "answer_count": 2, "score": 2, "last_activity_date": 1430968814, "creation_date": 1430942057, "question_id": 30086302, "link": "https://stackoverflow.com/questions/30086302/what-is-the-difference-between-newt-and-t", "title": "What is the difference between new(T) and &amp;T{}?", "body": "<p>In Go, given struct type T, what is the difference between <code>new(T)</code> and <code>&amp;T{}</code>?</p>\n"}, {"tags": ["mongodb", "go", "mongodb-query", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 1739, "user_id": 1074847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kyb3y.jpg?s=128&g=1", "display_name": "Yauheni Leichanok", "link": "https://stackoverflow.com/users/1074847/yauheni-leichanok"}, "is_accepted": true, "score": 0, "last_activity_date": 1431385198, "last_edit_date": 1431385198, "creation_date": 1431018189, "answer_id": 30107487, "question_id": 30086060, "link": "https://stackoverflow.com/questions/30086060/overriding-default-writeconcern-in-labix-mgo/30107487#30107487", "title": "Overriding default writeConcern in Labix mgo", "body": "<p>Ok, after doing some research I ended up with a solution. There is a method <code>SetMode</code> that allows you to change a default consistency mode for a specific DB session. In our app we create a copy of the master session every time before making a request and then closing it after it's done:</p>\n\n<pre><code>// master session is configured to use monotonic consistency\nsession := masterSession.Copy()\n\n// tell mgo to read from the primary in this session\nsession.SetMode(mgo.Strong, true)\n\ncollection := session.DB(\"db\").C(\"collection\")\nvar obj interface{}\n\n// now we can be sure that the following request reads the data from the primary\n_ := collection.Find(bson.M{\"_id\": \"some_id\"}).One(&amp;obj)\n\nsession.Close()\n</code></pre>\n"}], "owner": {"reputation": 1739, "user_id": 1074847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Kyb3y.jpg?s=128&g=1", "display_name": "Yauheni Leichanok", "link": "https://stackoverflow.com/users/1074847/yauheni-leichanok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 255, "favorite_count": 1, "accepted_answer_id": 30107487, "answer_count": 1, "score": 2, "last_activity_date": 1431385198, "creation_date": 1430941211, "last_edit_date": 1430946109, "question_id": 30086060, "link": "https://stackoverflow.com/questions/30086060/overriding-default-writeconcern-in-labix-mgo", "title": "Overriding default writeConcern in Labix mgo", "body": "<p>I'm using <code>labix mgo</code> as a mongodb driver in my Go app and I'm wondering if there is a way to override the default <code>writeConcern</code> for specific queries. </p>\n\n<p>A few words about configuration: the replica set has three nodes - one primary and two secondaries, the <code>writeConcern</code> and <code>readPreference</code> are default. The driver uses <code>monotonic</code> consistency which means that all reads are done from the secondary (when it's available, otherwise - from the primary).</p>\n\n<p>There might be cases when I need to read the updated data right after writing to the database - and because of the above mongo might return the old data:</p>\n\n<pre><code>// update some data\n_ := collection.Update(bson.M{\"_id\": \"some_id\"}, bson.M{\"key\": \"value\"})\n\n// the data is still not updated when I read it immediately after update\nvar obj interface{}\n_ := collection.Find(bson.M{\"_id\": \"some_id\"}).One(&amp;obj)\n</code></pre>\n\n<p>The question is: is it possible to override the default <code>writeConcern</code> (or default <code>consistency</code> of the driver) and force the driver to wait until the data is written to the secondaries OR to read from the primary for some of the queries?</p>\n\n<p>Appreciate any suggestions.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 2, "creation_date": 1430928760, "post_id": 30082009, "comment_id": 48277363, "body": "You don&#39;t really need routines for web services. The libraries themselves are already capable of handling request separately. You just worry about how efficient your calls are handled and the libraries will just handle the rest. The whole <code>net</code> mechanics are mostly already made to work like that. It&#39;s mainly why Go is so awesome, offering out-of-box awesomeness."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1430928884, "post_id": 30082009, "comment_id": 48277433, "body": "thanks - but I assume if within a handler I need to grab data from a database then this could/should be done via a goroutine?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1430928976, "post_id": 30082009, "comment_id": 48277481, "body": "No the better mysql libraries (or any other popular ones) also handle their calls through the same logic. You don&#39;t need to start advanced queues like you might be used to in Objective-C/C/C++ when using libraries like SQlite3. So again; just focus on the lightness of your code. The libraries are already awesome-a-fied :D"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1430929004, "post_id": 30082009, "comment_id": 48277497, "body": "wow - sounds too good to be true ha ha"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1430929101, "post_id": 30082009, "comment_id": 48277560, "body": "Yep! I&#39;m pumping out tens of thousands of requests through my tiedot database on my 5 year old macbook pro. It&#39;s a relieve no matter from which language you come. You almost can&#39;t believe your code is done when your file isn&#39;t even 200 lines long. It&#39;s why I fell in love with Go :) Not one minute of worry for threading or overhead. Tweaking is also super easy in Go, where in other languages it&#39;s mostly the biggest pain in the *ss to late-optimize."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 1, "creation_date": 1430929840, "post_id": 30082413, "comment_id": 48278070, "body": "As Rob Pike points out over and over you also need to be weary that, even tho groroutines are very cheap, you shouldn&#39;t overuse them and see the actual use of them. To be very honest; when not really doing anything bi-directional (like chatting or live feedback systems) I never use goroutines. I prefer to only use them as a last resort when casual things need some form of distribution in load (this might also include some libraries that tend to not use cpu cycles most efficiently; having them run in paralel instead of tandem)."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1430929944, "post_id": 30082413, "comment_id": 48278139, "body": "@Allendar I did notice this blog post though that suggests using goroutines with MongoDB (which I will probably be using): <a href=\"http://blog.mongodb.org/post/80579086742/running-mongodb-queries-concurrently-with-go\" rel=\"nofollow noreferrer\">blog.mongodb.org/post/80579086742/&hellip;</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1467267"}, "edited": false, "score": 0, "creation_date": 1430930170, "post_id": 30082413, "comment_id": 48278278, "body": "Because NoSQL systems don&#39;t suffer that much from lock like RDBMS do. Glancing over that article quickly it seems they use the routines to spawn tasks to the database without waiting for direct confirmation. This might be handy when you don&#39;t care about the result. I mostly do stuff like that when placing orders for shops. Just tell the customer you&#39;re done and they&#39;ll get a mail when everything is processed. When the routines get&#39;s the confirmation from the payment provider it will mail the customer. This feels very fluent for the customer because the main process didn&#39;t have to wait."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1430930432, "post_id": 30082413, "comment_id": 48278432, "body": "@tommyd456 I didn&#39;t look at that example really but it makes sense if you have to aggregate the results of multiple queries. It only makes sense to use goroutines when the work can practically be divided, if I have to get objects from multiple collections and merge them (disregarding that its a poor use of Mongo and should probably just be using SQL) in memory then distributing some of that work might be a good use. However, these routines would be for an individual request, not at the request handler level. It&#39;s actually no different than my file example except the store is Mongo instead."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 1, "last_activity_date": 1430929627, "creation_date": 1430929627, "answer_id": 30082413, "question_id": 30082009, "link": "https://stackoverflow.com/questions/30082009/understanding-goroutines-for-web-api/30082413#30082413", "title": "Understanding goroutines for web API", "body": "<p>I'm providing an answer even though I voted to close for being too broad.</p>\n\n<p>Anyway, none of that is really necessary. You're over thinking it. If you haven't read this it looks like a decent tutorial; <a href=\"http://thenewstack.io/make-a-restful-json-api-go/\" rel=\"nofollow\">http://thenewstack.io/make-a-restful-json-api-go/</a></p>\n\n<p>You can really just set up routes like you would with most typical rest frameworks and let the webserver/framework worry about concurrency at the request handling level. You would only employ goroutines to generate the response of a request, say if you needed to aggregate data from 10 files that are all in a folder. Contrived example, but this is where you would spin off 1 goroutine per file, aggregate all the information by reading off a channel in a non-blocking select and then return the result. You can expect all points of entry to your code are called in an asynchronous, non-blocking fashion if that makes sense...</p>\n"}, {"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 8, "last_activity_date": 1430930806, "creation_date": 1430930806, "answer_id": 30082823, "question_id": 30082009, "link": "https://stackoverflow.com/questions/30082009/understanding-goroutines-for-web-api/30082823#30082823", "title": "Understanding goroutines for web API", "body": "<p>Assuming you're using the Go's <code>http.ListenAndServe</code> to serve your http requests, the documentation clearly states that each incoming connection is handled by a separate goroutine for you. <a href=\"http://golang.org/pkg/net/http/#Server.Serve\" rel=\"noreferrer\">http://golang.org/pkg/net/http/#Server.Serve</a>\nYou would usually call <code>ListenAndServe</code> from your <code>main</code> function.</p>\n\n<p>Gorilla mux is simply a package for more flexible routing of requests to your handlers than the <code>http.DefaultServeMux</code>. It doesn't actually handle the incoming connection or request just simply relays it to your handler. </p>\n\n<p>I highly suggest you read a bit of the documentation, specifically this guide <a href=\"https://golang.org/doc/articles/wiki/#tmp_3\" rel=\"noreferrer\">https://golang.org/doc/articles/wiki/#tmp_3</a> on writing web applications.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2243, "favorite_count": 2, "accepted_answer_id": 30082823, "answer_count": 2, "score": 4, "last_activity_date": 1430974252, "creation_date": 1430928417, "last_edit_date": 1430974252, "question_id": 30082009, "link": "https://stackoverflow.com/questions/30082009/understanding-goroutines-for-web-api", "title": "Understanding goroutines for web API", "body": "<p>Just starting out with Go and hoping to create a simple Web API. I'm looking into using Gorilla mux (<a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow\">http://www.gorillatoolkit.org/pkg/mux</a>) to handle web requests.</p>\n\n<p>I'm not sure how to best use Go's concurrency options to handle the requests. Did I read somewhere that the <code>main</code> function is actually a goroutine or should I dispatch each request to a goroutine as they are received? Apologies if I'm \"way off\".</p>\n"}, {"tags": ["windows", "multithreading", "go", "threadpool", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 1233, "user_id": 2965113, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9304f9474dce02e452751eeccd636661?s=128&d=identicon&r=PG&f=1", "display_name": "Ark", "link": "https://stackoverflow.com/users/2965113/ark"}, "edited": false, "score": 0, "creation_date": 1430910754, "post_id": 30074251, "comment_id": 48263442, "body": "Yes, it&#39;s look like C# <code>Tasks</code>. Tasks are queued like messages and executed by threads from threadpool. When 10 tasks are too short then may be sufficient only one OS thread to execute them all"}, {"owner": {"reputation": 1233, "user_id": 2965113, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9304f9474dce02e452751eeccd636661?s=128&d=identicon&r=PG&f=1", "display_name": "Ark", "link": "https://stackoverflow.com/users/2965113/ark"}, "edited": false, "score": 0, "creation_date": 1430910971, "post_id": 30074251, "comment_id": 48263572, "body": "What approach is faster in practice ? and how much ?"}, {"owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "reply_to_user": {"reputation": 1233, "user_id": 2965113, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9304f9474dce02e452751eeccd636661?s=128&d=identicon&r=PG&f=1", "display_name": "Ark", "link": "https://stackoverflow.com/users/2965113/ark"}, "edited": false, "score": 0, "creation_date": 1430911366, "post_id": 30074251, "comment_id": 48263847, "body": "@Ark Each have their pro&#39;s and con&#39;s - but I haven&#39;t really seen a case where you&#39;d see much of a difference. By far the biggest difference is the syntax and usage of each. And I&#39;m not sure, but I think goroutines are always co&#246;perative, while .NET&#39;s tasks are a mix of pre-emptive and co&#246;perative. Also, .NET tasks don&#39;t really have a stack the way goroutines (or threads) do - they really are just method calls that eventually <code>return</code>; they only have a stack when they&#39;re executing (and it&#39;s the thread&#39;s stack)."}, {"owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "reply_to_user": {"reputation": 1233, "user_id": 2965113, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9304f9474dce02e452751eeccd636661?s=128&d=identicon&r=PG&f=1", "display_name": "Ark", "link": "https://stackoverflow.com/users/2965113/ark"}, "edited": false, "score": 0, "creation_date": 1430911482, "post_id": 30074251, "comment_id": 48263922, "body": "@Ark Since goroutines always allocate at least 2 kiB of stack, it&#39;s actually possible for <code>Task</code>s to be lighter weight in some scenarios. But that&#39;s matter for profiling, not guessing. If you have some idea about what you&#39;re trying to do, it should be pretty easy to write some prototypes you can performance test directly, and find out which suits you better."}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430913825, "post_id": 30074251, "comment_id": 48265565, "body": "I like this answer - I was a bit worried when you started to compare goroutines to .NET <code>Task</code>s but you managed to not compare them one-to-one which made me happy :)"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1430994115, "post_id": 30074251, "comment_id": 48308097, "body": "The crucial difference of the Go approach to that of C# is that Go encourages you to only use blocking code for everything and the Go runtime scheduler makes sure goroutines are properly preempted when they are about to really block on some system resource. Hence when writing a goroutine you&#39;re writting sequential code and do not reason about any synchronous vs asyncoronous nonsense."}, {"owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1430994382, "post_id": 30074251, "comment_id": 48308297, "body": "@kostix Actually, that&#39;s not a difference. C# Tasks work really the same way - the only difference being that you explicitly use the <code>await</code> keyword when you&#39;re doing the asynchronous operation. But the method itself still appears entirely synchronous (as long as you avoid shared state, of course). The basic idea is still the same, you just have to understand that C# has to maintain backward compatibility, so you can&#39;t just change the blocking methods to suddenly be asynchronous. Goroutines are <i>not</i> pre-empted - it&#39;s just that blocking operations aren&#39;t blocking, they <code>yield</code> (co&#246;peratively)."}, {"owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1430995217, "post_id": 30074251, "comment_id": 48308906, "body": "@kostix I added some clarification to my answer, do you think it helps?"}], "tags": [], "owner": {"reputation": 57221, "user_id": 3032289, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9c171ec0f2c8040d24436a40a3bf075b?s=128&d=identicon&r=PG", "display_name": "Luaan", "link": "https://stackoverflow.com/users/3032289/luaan"}, "is_accepted": false, "score": 2, "last_activity_date": 1430995201, "last_edit_date": 1430995201, "creation_date": 1430908443, "answer_id": 30074251, "question_id": 30073441, "link": "https://stackoverflow.com/questions/30073441/goroutines-8kb-and-windows-os-thread-1-mb/30074251#30074251", "title": "Goroutines 8kb and windows OS thread 1 mb", "body": "<p>1 MiB is the <em>default</em>, as you correctly noted. You can pick your own stack size easily (however, the minimum is still a lot higher than ~8 kiB).</p>\n\n<p>That said, goroutines aren't threads. They're just tasks with co\u00f6perative multi-tasking, similar to Python's. The goroutine itself is just the code and data required to do what you want; there's also a separate scheduler (which runs on one on more OS threads), which actually executes that code.</p>\n\n<p>In pseudo-code:</p>\n\n<pre><code>loop forever\n take job from queue\n execute job\nend loop\n</code></pre>\n\n<p>Of course, the <code>execute job</code> part can be very simple, or very complicated. The simplest thing you can do is just execute a given delegate (if your language supports something like that). In effect, this is simply a method call. In more complicated scenarios, there can be also stuff like restoring some kind of context, handling continuations and co\u00f6perative task yields, for example.</p>\n\n<p>This is a very light-weight approach, and very useful when doing asynchronous programming (which is almost everything nowadays :)). Many languages now support something similar - Python is the first one I've seen with this (\"tasklets\"), long before go. Of course, in an environment without pre-emptive multi-threading, this was pretty much the default.</p>\n\n<p>In C#, for example, there's <code>Task</code>s. They're not entirely the same as goroutines, but in practice, they come pretty close - the main difference being that <code>Task</code>s use threads from the thread pool (usually), rather than a separate dedicated \"scheduler\" threads. This means that if you start 1000 tasks, it is <em>possible</em> for them to be run by 1000 separate threads; in practice, it would require you to write very bad <code>Task</code> code (e.g. using only blocking I/O, sleeping threads, waiting on wait handles etc.). If you use <code>Task</code>s for asynchronous non-blocking I/O and CPU work, they come pretty close to goroutines - in actual practice. The theory <em>is</em> a bit different :) </p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>To clear up some confusion, here is how a typical C# asynchronous method might look like:</p>\n\n<pre><code>async Task&lt;string&gt; GetData()\n{\n  var html = await HttpClient.GetAsync(\"http://www.google.com\");\n\n  var parsedStructure = Parse(html);\n  var dbData = await DataLayer.GetSomeStuffAsync(parsedStructure.ElementId);\n\n  return dbData.First().Description;\n}\n</code></pre>\n\n<p>From point of view of the <code>GetData</code> method, the entire processing is synchronous - it's just as if you didn't use the asynchronous methods at all. The crucial difference is that you're not using up threads while you're doing the \"waiting\"; but ignoring that, it's almost exactly the same as writing synchronous blocking code. This also applies to any issues with shared state, of course - there isn't much of a difference between multi-threading issues in <code>await</code> and in blocking multi-threaded I/O. It's easier to avoid with <code>Task</code>s, but just because of the tools you have, not because of any \"magic\" that <code>Task</code>s do.</p>\n\n<p>The main difference from goroutines in this aspect is that Go doesn't really have blocking methods in the usual sense of the word. Instead of blocking, they queue their particular asynchronous request, and yield. When the OS (and any other layers in Go - I don't have deep knowledge about the inner workings) receives the response, it posts it to the goroutine scheduler, which in turns knows that the goroutine that \"waits\" for the response is now ready to resume execution; when it actually gets a slot, it will continue on from the \"blocking\" call as if it had really been blocking - but in effect, it's very similar to what C#'s <code>await</code> does. There's no <em>fundamental</em> difference - there's quite a few differences between C#'s approach and Go's, but they're not all that <em>huge</em>. </p>\n\n<p>And also note that this is fundamentally the same approach used on old Windows systems without pre-emptive multi-tasking - any \"blocking\" method would simply yield the thread's execution back to the scheduler. Of course, on those systems, you only had a single CPU core, so you couldn't execute multiple threads at once, but the principle is still the same.</p>\n"}, {"tags": [], "owner": {"reputation": 70819, "user_id": 1624921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/keNmm.jpg?s=128&g=1", "display_name": "Games Brainiac", "link": "https://stackoverflow.com/users/1624921/games-brainiac"}, "is_accepted": false, "score": 0, "last_activity_date": 1430908451, "creation_date": 1430908451, "answer_id": 30074253, "question_id": 30073441, "link": "https://stackoverflow.com/questions/30073441/goroutines-8kb-and-windows-os-thread-1-mb/30074253#30074253", "title": "Goroutines 8kb and windows OS thread 1 mb", "body": "<p>goroutines are what we call <a href=\"http://en.wikipedia.org/wiki/Green_threads\" rel=\"nofollow\">green threads</a>. They are not OS threads, the go scheduler is responsible for them. This is why they can have much smaller memory footprints.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1430928315, "last_edit_date": 1430928315, "creation_date": 1430910326, "answer_id": 30074921, "question_id": 30073441, "link": "https://stackoverflow.com/questions/30073441/goroutines-8kb-and-windows-os-thread-1-mb/30074921#30074921", "title": "Goroutines 8kb and windows OS thread 1 mb", "body": "<p>Goroutines are not threads, they are (from the <a href=\"https://golang.org/ref/spec#Go_statements\" rel=\"nofollow\">spec</a>):</p>\n\n<blockquote>\n  <p>...an independent concurrent thread of control, or <em>goroutine</em>,  within the same address space.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#goroutines\" rel=\"nofollow\">Effective Go</a> defines them as:</p>\n\n<blockquote>\n  <p>They're called <em>goroutines</em> because the existing terms\u2014threads, coroutines, processes, and so on\u2014convey inaccurate connotations. A goroutine has a simple model: it is a function executing concurrently with other goroutines in the same address space. It is lightweight, costing little more than the allocation of stack space. And the stacks start small, so they are cheap, and grow by allocating (and freeing) heap storage as required.</p>\n</blockquote>\n\n<p>Goroutines don't have their own threads. Instead multiple goroutines are (may be) multiplexed onto the same OS threads so if one should block (e.g. waiting for I/O or a blocking channel operation), others continue to run.</p>\n\n<p>The actual number of threads executing goroutines simultaneously can be set with the <a href=\"http://golang.org/pkg/runtime/#GOMAXPROCS\" rel=\"nofollow\"><code>runtime.GOMAXPROCS()</code></a> function. Quoting from the <a href=\"http://golang.org/pkg/runtime/\" rel=\"nofollow\"><code>runtime</code></a> package documentation:</p>\n\n<blockquote>\n  <p>The GOMAXPROCS variable limits the number of operating system threads that can execute user-level Go code simultaneously. There is no limit to the number of threads that can be blocked in system calls on behalf of Go code; those do not count against the GOMAXPROCS limit.</p>\n</blockquote>\n\n<p>Note that in current implementation by default only 1 thread is used to execute goroutines.</p>\n"}], "owner": {"reputation": 1233, "user_id": 2965113, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/9304f9474dce02e452751eeccd636661?s=128&d=identicon&r=PG&f=1", "display_name": "Ark", "link": "https://stackoverflow.com/users/2965113/ark"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 597, "favorite_count": 0, "answer_count": 3, "score": 2, "last_activity_date": 1563274069, "creation_date": 1430906431, "last_edit_date": 1563274069, "question_id": 30073441, "link": "https://stackoverflow.com/questions/30073441/goroutines-8kb-and-windows-os-thread-1-mb", "title": "Goroutines 8kb and windows OS thread 1 mb", "body": "<p>As windows user, I know that OS threads consume ~1 Mb of memory due to <code>By default, Windows allocates 1 MB of memory for each thread\u2019s user-mode stack.</code> How does <code>golang</code> use ~8kb of memory for each <code>goroutine</code>, if OS thread is much more gluttonous. Are <code>goroutine</code> sort of virtual threads? </p>\n"}, {"tags": ["c", "go", "gccgo"], "answers": [{"comments": [{"owner": {"reputation": 1122, "user_id": 994308, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/99dd9c5b8b4106a03d7262eb7ec9e4f0?s=128&d=identicon&r=PG", "display_name": "Lopson", "link": "https://stackoverflow.com/users/994308/lopson"}, "edited": false, "score": 0, "creation_date": 1430952922, "post_id": 30079811, "comment_id": 48291141, "body": "Thanks for the answer. While the Android thing sounds like a decent way to get around this, waiting for version 1.5 sounds like &quot;the way to go&quot;."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 2, "last_activity_date": 1430934688, "last_edit_date": 1430934688, "creation_date": 1430922868, "answer_id": 30079811, "question_id": 30072281, "link": "https://stackoverflow.com/questions/30072281/using-go-on-existing-c-project/30079811#30079811", "title": "Using Go on existing C project", "body": "<p>There currently isn't a supported way to do what you want. Go always needs the support of its runtime, and the entry point for that is always <code>main</code>. AFAIK, gccgo also makes these same assumptions, and doesn't provide a way to easily link into from other programs.</p>\n\n<p>If you want to do this in a supported manner, you will have to wait until go1.5+ where work is being done to compile shared libraries from Go code.</p>\n\n<p>If you really want to hack on this now, you can look into how the Android port works using the default gc toolchain with <code>-linkmode external</code>, which renames <code>main</code> in the object file and calls it externally.</p>\n"}, {"comments": [{"owner": {"reputation": 1122, "user_id": 994308, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/99dd9c5b8b4106a03d7262eb7ec9e4f0?s=128&d=identicon&r=PG", "display_name": "Lopson", "link": "https://stackoverflow.com/users/994308/lopson"}, "edited": false, "score": 1, "creation_date": 1430952780, "post_id": 30083591, "comment_id": 48291095, "body": "A shame won&#39;t get to use it now, but it&#39;s nice to know the option will be there in the near future. Thank you for your detailed answer!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 8, "last_activity_date": 1432463322, "last_edit_date": 1432463322, "creation_date": 1430933056, "answer_id": 30083591, "question_id": 30072281, "link": "https://stackoverflow.com/questions/30072281/using-go-on-existing-c-project/30083591#30083591", "title": "Using Go on existing C project", "body": "<p>This may not be what you want, but in <strong>Go 1.5,</strong> that's coming this August, you'll be able to build C-compatible libraries with the go tool. So with this in your <code>_main.c</code></p>\n\n<pre><code>#include &lt;stdio.h&gt;\n\nint main()\n{\n    char *string_to_pass = NULL;\n    if (asprintf(&amp;string_to_pass, \"This is a test.\") &lt; 0) {\n        printf(\"asprintf fail\");\n        return -1;\n    }\n\n    PrintString(string_to_pass);\n    return 0;\n}\n</code></pre>\n\n<p>and this in your <code>main.go</code></p>\n\n<pre><code>package main\n\nimport \"C\"\nimport \"fmt\"\n\n//export PrintString\nfunc PrintString(cs *C.char) {\n    s := C.GoString(cs)\n    fmt.Println(s)\n}\n\nfunc main() {}\n</code></pre>\n\n<p>You can do, for static library:</p>\n\n<pre><code>go build -buildmode c-archive -o mygopkg.a\ngcc -o main _main.c mygopkg.a -lpthread\n</code></pre>\n\n<p>For shared library:</p>\n\n<pre><code>go build -buildmode c-shared -o mygopkg.so\nLD_RUN_PATH=$(pwd) gcc -o main _main.c mygopkg.so -lpthread\n</code></pre>\n\n<p>(<code>LD_RUN_PATH</code> is here to make the linker look for the shared library in the same directory you're building.)</p>\n\n<p>See the <a href=\"https://docs.google.com/document/d/1nr-TQHw_er6GOQRsF6T43GGhFDelrAP0NqSS_00RgZQ/edit\" rel=\"nofollow noreferrer\">Go execution modes design document</a> for more info.</p>\n"}], "owner": {"reputation": 1122, "user_id": 994308, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/99dd9c5b8b4106a03d7262eb7ec9e4f0?s=128&d=identicon&r=PG", "display_name": "Lopson", "link": "https://stackoverflow.com/users/994308/lopson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 787, "favorite_count": 1, "accepted_answer_id": 30083591, "answer_count": 2, "score": 5, "last_activity_date": 1470212515, "creation_date": 1430903302, "last_edit_date": 1495541342, "question_id": 30072281, "link": "https://stackoverflow.com/questions/30072281/using-go-on-existing-c-project", "title": "Using Go on existing C project", "body": "<p>I have a program entirely written in C that uses multiple object <code>(.o)</code> files in it. These files are all packed inside an archive file <code>(.a)</code> which, in turn, is used at compile-time of the program's main <code>(.c)</code> file.</p>\n\n<p>I want to write a new file for this project in Go. My idea is to write this <code>.go</code> file and then create an object <code>(.o)</code> file from it. Afterwards, I want to put this object file inside the already mentioned archive <code>(.a)</code> file.</p>\n\n<p>This basically means that <strong>I want to call Go functions from a C program</strong>. I've read <a href=\"https://stackoverflow.com/questions/6125683/call-go-functions-from-c\">this question</a>, and while it showed me that what I want is possible via GCCGO, it's not 100% clear as to how to do it.</p>\n\n<p>Even with the most basic of tests, I get errors during the linking phase. More specifically, here's one of such basic example:</p>\n\n<hr>\n\n<p><strong>printString.go</strong></p>\n\n<pre><code>package main\n\nimport\n(\n    \"fmt\"\n)\n\nfunc PrintString(buff string) int {\n    fmt.Printf(buff)\n    return 1\n}\n</code></pre>\n\n<p><strong>c_caller.c</strong></p>\n\n<pre><code>#define _GNU_SOURCE\n#include &lt;stdio.h&gt;\n\nextern int PrintString(char*) __asm__ (\"print.main.PrintString\");\n\nint main() {\n    char *string_to_pass= NULL;\n    asprintf(&amp;string_to_pass, \"This is a test.\");\n\n    int result= PrintString(string_to_pass);\n    if(result) {printf(\"Everything went as expected!\\n\");}\n    else       {printf(\"Uh oh, something went wrong!\\n\");}\n\n    return result;\n}\n</code></pre>\n\n<p><strong>Compiling</strong></p>\n\n<p>In order to compile the Go file, I used this command:</p>\n\n<pre><code>gccgo -c printString.go -o printString.o -fgo-prefix=print -Wall -Werror -march=native\n</code></pre>\n\n<p>In order to compile the entire thing, I used this command:</p>\n\n<pre><code>gccgo -o main c_caller.c printString.o -Wall -Werror -march=native\n</code></pre>\n\n<p>The return message I'm getting is:</p>\n\n<pre><code>/usr/lib64/libgo.so.4.0.0: undefined reference to `main.main'\n/usr/lib64/libgo.so.4.0.0: undefined reference to `__go_init_main'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Which means that GCCGO's expecting a main function in the Go file instead of the C one.</p>\n\n<p>Using the <code>--static-libgo</code>, <code>-static</code> and <code>-Wl,-R,/path/to/libgo.so's_folder</code> options on the second command yield a different result:</p>\n\n<pre><code>/usr/bin/ld: cannot find -lgo\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>Which makes no sense, since I have the LD_LIBRARY_PATH environment variable properly pointing to libgo.so's folder.</p>\n\n<hr>\n\n<p>I realize that I'm probably doing something wrong here, but I just can't see what that is. There's next to no examples of GCCGO and its interaction with C out there, and the only reference I could find was <a href=\"https://golang.org/doc/install/gccgo\" rel=\"nofollow noreferrer\">this page</a>, which I personally feel like it's not enough.</p>\n\n<p>I ask kindly for some advice on this matter and thank you for your time. :)</p>\n"}, {"tags": ["sockets", "go", "arguments"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430908832, "post_id": 30071686, "comment_id": 48262140, "body": "what about dial ? <a href=\"http://golang.org/pkg/net/\" rel=\"nofollow noreferrer\">golang.org/pkg/net</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430917123, "post_id": 30071686, "comment_id": 48268184, "body": "please provide more context. What is <code>conn</code> and and how did you create it?"}], "answers": [{"comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1430917408, "post_id": 30074645, "comment_id": 48268432, "body": "Slight correction: You don&#39;t supply <code>-p</code> and <code>-l</code> together with <code>nc</code> (its actually an error to do so). You just need <code>-l &lt;port here&gt;</code> for it to listen on a port."}, {"owner": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430921605, "post_id": 30074645, "comment_id": 48271896, "body": "@SimonWhitehead thanks for remind, but  I found the behavior of nc (<code>netcat</code>) will be different due to different implement, may be because of bsd version and traditional version?"}, {"owner": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430921668, "post_id": 30074645, "comment_id": 48271953, "body": "@SimonWhitehead I have once come into to a situation that <code>nc -l 8999</code> will not work in my debian box, since then, I use <code>nc -l -p 8999</code> instead, I just check the <a href=\"http://www.unix.com/man-page/all/1/nc/\" rel=\"nofollow noreferrer\">manual</a> of the bsd version, it says that using a <code>-p</code> is wrong, but I don&#39;t know what will go wrong. And I also find guys <a href=\"http://www.g-loaded.eu/2006/11/06/netcat-a-couple-of-useful-examples/#comment-19403\" rel=\"nofollow noreferrer\">complain</a> that<code>nc</code>will not work unless  given a <code>-p</code>, It will be very appreciate if you could clarify what will go wrong, and I highly doubt that the manual guy just want to scare us :-)"}], "tags": [], "owner": {"reputation": 6945, "user_id": 2288944, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/7qryD.jpg?s=128&g=1", "display_name": "armnotstrong", "link": "https://stackoverflow.com/users/2288944/armnotstrong"}, "is_accepted": false, "score": 0, "last_activity_date": 1430921899, "last_edit_date": 1430921899, "creation_date": 1430909552, "answer_id": 30074645, "question_id": 30071686, "link": "https://stackoverflow.com/questions/30071686/go-writing-to-socket-invalid-argument/30074645#30074645", "title": "Go writing to socket - invalid argument", "body": "<p>Here is a simple sample of what you want to do(maybe?), be aware that you should make a tcp server listen to the port <code>8999</code> first before run it</p>\n\n<pre><code>nc -l 8999     #or maybe nc -l -p 8999 \n</code></pre>\n\n<p>code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net\"\n)\n\nfunc main() {\n    conn, _ := net.Dial(\"tcp\", \"localhost:8999\")\n    conn.Write([]byte(\"test\"))\n}\n</code></pre>\n\n<p>If it's not your question, you should provide more information.</p>\n"}], "owner": {"reputation": 195, "user_id": 3713080, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/db1744b22f6bc4ca7bed18b81dd555a9?s=128&d=identicon&r=PG&f=1", "display_name": "user3713080", "link": "https://stackoverflow.com/users/3713080/user3713080"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1969, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1430921899, "creation_date": 1430901801, "question_id": 30071686, "link": "https://stackoverflow.com/questions/30071686/go-writing-to-socket-invalid-argument", "title": "Go writing to socket - invalid argument", "body": "<p>Im trying to write to a TCP socket in Go but only receive \"invalid argument\" with this code:</p>\n\n<pre><code>_, err := conn.Write([]byte(\"test\"))\nif err != nil {\n    fmt.Println(err.Error())\n}\n</code></pre>\n"}, {"tags": ["html", "go"], "answers": [{"tags": [], "owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "is_accepted": true, "score": 9, "last_activity_date": 1430910956, "last_edit_date": 1430910956, "creation_date": 1430876333, "answer_id": 30066033, "question_id": 30065203, "link": "https://stackoverflow.com/questions/30065203/golang-html-templating-range-limit/30066033#30066033", "title": "Golang - HTML Templating - Range limit", "body": "<p>First off, I should mention that if you're passing an <em>array</em> to the template, you're almost certainly doing something weird. Arrays are relatively rarely used in Go. Typically, you would use a <em>slice</em>.</p>\n\n<p>The easiest way would be to pass a slice of the first 5 elements of the array when running the template.</p>\n\n<p>If you need the full input in the template for some reason, you could define a function for taking slices, something like this:</p>\n\n<pre><code>func mkslice(a []string, start, end int) []string {\n    return a[start:end]\n}\n</code></pre>\n\n<p>(see <a href=\"http://golang.org/pkg/text/template/#Template.Funcs\" rel=\"nofollow noreferrer\">documentation for how to attach functions to templates</a>)</p>\n\n<p>And the template:</p>\n\n<pre><code>{{range mkslice .arr 0 5}}\n&lt;li&gt;{{.}}&lt;/li&gt;\n{{end}}\n</code></pre>\n\n<p>You could also use a form of the <code>range</code> action with an index.</p>\n\n<pre><code>{{range $i, $val := .arr}}\n{{if lt $i 5}}&lt;li&gt;{{$val}}&lt;/li&gt;{{end}}\n{{end}}\n</code></pre>\n"}], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2450, "favorite_count": 0, "accepted_answer_id": 30066033, "answer_count": 1, "score": 7, "last_activity_date": 1430910956, "creation_date": 1430870228, "last_edit_date": 1430883953, "question_id": 30065203, "link": "https://stackoverflow.com/questions/30065203/golang-html-templating-range-limit", "title": "Golang - HTML Templating - Range limit", "body": "<p>I have a slice which I am printing to an html file in go:</p>\n\n<pre><code>&lt;ul&gt;\n{{range .arr}}\n    &lt;li&gt;{{.}}&lt;/li&gt;\n{{end}}\n&lt;/ul&gt;\n</code></pre>\n\n<p>If <code>len(arr) &gt; 5</code>, how do I print only the first 5 elements of the slice?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "is_accepted": true, "score": 5, "last_activity_date": 1430870789, "last_edit_date": 1430870789, "creation_date": 1430870473, "answer_id": 30065234, "question_id": 30065194, "link": "https://stackoverflow.com/questions/30065194/errors-in-golang-assessing-errors/30065234#30065234", "title": "Errors in Golang - assessing errors", "body": "<pre><code>e.(*argError)\n</code></pre>\n\n<p>is a type assertion that casts the value e to *argError type.  This is the type f2() returns on error - it is a pointer to an argError struct, which implements the error interface. This type assertion evaluates multi-valued to (ae,ok), where ae is the *argError typed value, if successful, and ok is a boolean letting you know if it was successful.</p>\n\n<p>if statements in go can be separated into an initial assignment part, then a semicolon, then a boolean condition to evaluate to determine the branch.</p>\n\n<p>Altogether, then,</p>\n\n<pre><code>if ae, ok := e.(*argError); ok {\n</code></pre>\n\n<p>means:  try to cast e to *argError, if that is successful (do if block). </p>\n\n<p>Why do this?   Because argError has fields that are not in a plain error (arg, prob), and you might want to use those.  In real code where you do this, you'd likely also need to handle the case where e was not an argError, but some other error type, in an \"else\" branch.</p>\n"}], "owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 126, "favorite_count": 0, "accepted_answer_id": 30065234, "answer_count": 1, "score": 1, "last_activity_date": 1430870789, "creation_date": 1430870181, "question_id": 30065194, "link": "https://stackoverflow.com/questions/30065194/errors-in-golang-assessing-errors", "title": "Errors in Golang - assessing errors", "body": "<p>I am trying to understand the following example </p>\n\n<p><a href=\"https://gobyexample.com/errors\" rel=\"nofollow\">https://gobyexample.com/errors</a></p>\n\n<p>I understand most of it except for this part: </p>\n\n<pre><code>_, e := f2(42)\nif ae, ok := e.(*argError); ok {\n    fmt.Println(ae.arg)\n    fmt.Println(ae.prob)\n}\n</code></pre>\n\n<p>I'm not sure what this line does :</p>\n\n<pre><code>if ae, ok := e.(*argError); ok {\n</code></pre>\n"}, {"tags": ["http", "go", "mux"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 3, "creation_date": 1430862142, "post_id": 30063442, "comment_id": 48242381, "body": "There are a LOT of routers/muxes out there for Go. The built-in <code>net&#47;http</code> one is functional, and ones like <code>gorilla&#47;mux</code> have a significant number of features you can choose from. <code>httprouter</code> sits down the end at the slim end. I would think that the need to write your own\u2014if you have to ask the question\u2014would almost (but never say never!) not exist. Routers are only a small slice of the response-time pie."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 3, "creation_date": 1430867119, "post_id": 30063442, "comment_id": 48244179, "body": "So much agreement re: &quot;Routers are only a small slice of the response-time pie.&quot; Get something working whatever way is easiest first."}], "answers": [{"comments": [{"owner": {"reputation": 1181, "user_id": 25809, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/88Sju.jpg?s=128&g=1", "display_name": "rjarmstrong", "link": "https://stackoverflow.com/users/25809/rjarmstrong"}, "edited": false, "score": 0, "creation_date": 1507002131, "post_id": 30063908, "comment_id": 80028230, "body": "There is no &#39;SplitN&#39; method on req.URL.Path. Rather use: strings.SplitN(..."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 23, "last_activity_date": 1512059389, "last_edit_date": 1512059389, "creation_date": 1430862823, "answer_id": 30063908, "question_id": 30063442, "link": "https://stackoverflow.com/questions/30063442/when-to-use-golangs-default-mux-versus-doing-your-own/30063908#30063908", "title": "When to use Golang&#39;s default MUX versus doing your own", "body": "<p>There are two downsides to the builtin mux:</p>\n\n<ol>\n<li><p>If you need info from the url (for example id in <code>/users/:id</code>) you have to do it manually: </p>\n\n<pre><code>http.HandleFunc(\"/users/\", func(res http.ResponseWriter, req *http.Request) {\n    id := strings.SplitN(req.URL.Path, \"/\", 3)[2]\n})\n</code></pre>\n\n<p>Which is cumbersome.</p></li>\n<li><p>The default server mux is not the fastest.</p></li>\n</ol>\n\n<p>Consider the conclusions from <a href=\"https://github.com/julienschmidt/go-http-routing-benchmark#conclusions\" rel=\"noreferrer\">this benchmark</a>:</p>\n\n<blockquote>\n  <p>First of all, there is no reason to use net/http's default ServeMux, which is very limited and does not have especially good performance. There are enough alternatives coming in every flavor, choose the one you like best.</p>\n</blockquote>\n\n<p>So really its only advantage is that everyone already has it since it's included in <code>net/http</code>.</p>\n\n<p>Lately I've been moving in the direction of avoiding the default <code>http.Handle</code> and <code>http.HandleFunc</code> functions and defining an explicit <code>http.Handler</code> instead, which is then handed to <code>ListenAndServe</code>. (instead of <code>nil</code>:</p>\n\n<pre><code>handler := http.NewServeMux()\nhandler.Handle(\"/whatever\", ...)\nhttp.ListenAndServe(80, handler)\n</code></pre>\n\n<p>Newer developers find the distinction between <code>http.Handle</code> and <code>http.HandleFunc</code> subtle and confusing so I think it's worth understanding the <code>http.Handler</code> concept up front. A mux is just another kind of <code>http.Handler</code> (one that routes requests to other <code>http.Handler</code>s) and that reality is hidden away when you rely on the <code>DefaultServeMux</code>.</p>\n"}], "owner": {"reputation": 740, "user_id": 4488456, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4146daa51bdb93084db63bbf9b5d5c43?s=128&d=identicon&r=PG", "display_name": "jordan2175", "link": "https://stackoverflow.com/users/4488456/jordan2175"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11587, "favorite_count": 3, "closed_date": 1431215488, "accepted_answer_id": 30063908, "answer_count": 1, "score": 11, "last_activity_date": 1512059389, "creation_date": 1430860934, "last_edit_date": 1430892800, "question_id": 30063442, "link": "https://stackoverflow.com/questions/30063442/when-to-use-golangs-default-mux-versus-doing-your-own", "closed_reason": "Opinion-based", "title": "When to use Golang&#39;s default MUX versus doing your own", "body": "<p>I have seen a lot of posts talk about building your own MUX in Go, one of the many examples is here (<a href=\"http://thenewstack.io/building-a-web-server-in-go/\" rel=\"noreferrer\">http://thenewstack.io/building-a-web-server-in-go/</a>).</p>\n\n<p>When should you use the default versus defining your own? The Go docs and none of the blog posts say why you should use one over the other.</p>\n"}, {"tags": ["javascript", "node.js", "go", "reactjs", "flux"], "comments": [{"owner": {"reputation": 149272, "user_id": 62082, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/8283f4bb35589863b3b1e0f8ac0968a0?s=128&d=identicon&r=PG", "display_name": "Michelle Tilley", "link": "https://stackoverflow.com/users/62082/michelle-tilley"}, "edited": false, "score": 0, "creation_date": 1430865356, "post_id": 30063222, "comment_id": 48243560, "body": "You can also look at third-party libraries like <a href=\"https://github.com/asyncly/EventEmitter2\" rel=\"nofollow noreferrer\">EventEmitter2</a> or any other pub-sub style lib."}], "answers": [{"comments": [{"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1430887439, "post_id": 30063997, "comment_id": 48249798, "body": "Will browserify integrate well with requirejs? And would I need node to use browserify. Thanks for the help."}, {"owner": {"reputation": 21250, "user_id": 79354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SwMAy.jpg?s=128&g=1", "display_name": "Anders Ekdahl", "link": "https://stackoverflow.com/users/79354/anders-ekdahl"}, "reply_to_user": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 1, "creation_date": 1430895646, "post_id": 30063997, "comment_id": 48253432, "body": "@PabloKarlsson No, browserify does not integrate with requirejs. They are two different module systems and are designed differently. If you want to use requirejs with npm packages, I&#39;d recommend you look at Webpack."}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1430902453, "post_id": 30063997, "comment_id": 48257750, "body": "@Caleb do you prefer requirejs or browserify?"}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "edited": false, "score": 0, "creation_date": 1430929753, "post_id": 30063997, "comment_id": 48278006, "body": "You do need node. I tend to include scripts manually (though I&#39;ve used brunch or gulp too). You can use browserify to generate a bundle of just the lib you need, then include it like a regular file. See the &quot;standalone&quot; option here: <a href=\"https://github.com/substack/node-browserify#usage\" rel=\"nofollow noreferrer\">github.com/substack/node-browserify#usage</a>. With this approach you only need node once, after that it&#39;s just regular javascript."}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1432132349, "post_id": 30063997, "comment_id": 48797805, "body": "I ended up using eventemitter2."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 8, "last_activity_date": 1430863254, "creation_date": 1430863254, "answer_id": 30063997, "question_id": 30063222, "link": "https://stackoverflow.com/questions/30063222/building-flux-react-application-without-nodejs-eventemitter/30063997#30063997", "title": "Building Flux/React application without NodeJs EventEmitter", "body": "<p>You can use NodeJS libraries in the browser! Take a look at <a href=\"http://browserify.org/\">browserify</a>.</p>\n\n<p>First some code:</p>\n\n<pre><code>// index.js\nvar EventEmitter = require(\"events\").EventEmitter;\nvar ProductStore = function() {};\nProductStore.prototype = new EventEmitter;\n</code></pre>\n\n<p>Then you run browserify on it:</p>\n\n<pre><code>browserify index.js &gt; bundle.js\n</code></pre>\n\n<p>Also worth a look is <a href=\"http://webpack.github.io/\">WebPack</a> which does the same thing. (but has some additional features)</p>\n"}, {"tags": [], "owner": {"reputation": 2186, "user_id": 2745879, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/56f2389bd912f388cc79874ce65fc0dc?s=128&d=identicon&r=PG", "display_name": "atomrc", "link": "https://stackoverflow.com/users/2745879/atomrc"}, "is_accepted": false, "score": 2, "last_activity_date": 1446728194, "creation_date": 1446728194, "answer_id": 33545149, "question_id": 30063222, "link": "https://stackoverflow.com/questions/30063222/building-flux-react-application-without-nodejs-eventemitter/33545149#33545149", "title": "Building Flux/React application without NodeJs EventEmitter", "body": "<p>Well if you are using the flux implementation given by Facebook (<a href=\"https://github.com/facebook/flux\" rel=\"nofollow\">https://github.com/facebook/flux</a>), you can actually <strong>extends their FluxStore class</strong> which comes with a build in eventEmitter. </p>\n\n<p>The only thing if you want to do that is you must use es6 classes (and use babel to transpile to es5).</p>\n\n<p>The good thing about it is that you don't have to implement the <code>addListener</code> <code>removeListener</code> and <code>emitChange</code> methods, and that's very <a href=\"https://en.wikipedia.org/wiki/Don&#39;t_repeat_yourself\" rel=\"nofollow\">DRY</a> :)</p>\n\n<p>With this solution, your stores will end up looking like that : </p>\n\n<pre><code>var FluxStore = require(\"flux/utils\").Store,\n    thing;\n\nclass ThingStore extends FluxStore {\n    getThing() { \n        return thing;\n    }\n\n    __onDispatch(payload) {\n       //your code\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2059, "favorite_count": 1, "accepted_answer_id": 30063997, "answer_count": 2, "score": 2, "last_activity_date": 1446728194, "creation_date": 1430859842, "question_id": 30063222, "link": "https://stackoverflow.com/questions/30063222/building-flux-react-application-without-nodejs-eventemitter", "title": "Building Flux/React application without NodeJs EventEmitter", "body": "<p>Hi I'm trying to build a Flux/React application with a go-lang back-end. I have been following a tutorial I found <a href=\"https://scotch.io/tutorials/creating-a-simple-shopping-cart-with-react-js-and-flux\" rel=\"nofollow\">here</a>. But I have a problem when building the store. In the tutorial something like this is used to create a base for the store.</p>\n\n<pre><code>var ProductStore = _.extend({}, EventEmitter.prototype, {...});\n</code></pre>\n\n<p>The problem I have is I do not have access to the EventEmitter library which I understand is a Nodejs lib? Is there an alternative I can use?</p>\n"}, {"tags": ["error-handling", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430859540, "post_id": 30062949, "comment_id": 48241236, "body": "Just re-panic with whatever non-nil return <code>recover</code> gave."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1430859786, "post_id": 30062949, "comment_id": 48241370, "body": "Dave&#39;s answer is the best what works. The answer to your question is a plain &quot;No.&quot;."}, {"owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "edited": false, "score": 0, "creation_date": 1430876464, "post_id": 30062949, "comment_id": 48246866, "body": "Why do you think you need to do this?"}], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 8, "last_activity_date": 1548709135, "last_edit_date": 1548709135, "creation_date": 1430862587, "answer_id": 30063854, "question_id": 30062949, "link": "https://stackoverflow.com/questions/30062949/checking-for-panic-without-recovering-from-it/30063854#30063854", "title": "Checking for panic without recovering from it", "body": "<p>That exact thing isn't possible. You probably just want to re-panic, basically like re-throwing an exception in other languages;</p>\n\n<pre><code>        defer func() {\n             if e := recover(); e != nil {\n                 //log and so other stuff\n                 panic(e)\n             }\n          }()\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 16928, "user_id": 1047788, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/xA1rW.png?s=128&g=1", "display_name": "user7610", "link": "https://stackoverflow.com/users/1047788/user7610"}, "is_accepted": false, "score": 3, "last_activity_date": 1453109671, "creation_date": 1453109671, "answer_id": 34851358, "question_id": 30062949, "link": "https://stackoverflow.com/questions/30062949/checking-for-panic-without-recovering-from-it/34851358#34851358", "title": "Checking for panic without recovering from it", "body": "<p>You can set a bool flag and then reset it at the end of the body of your function. If the flag is still set inside defer, you know that the last statement did not execute. The only possible reason for that is that the function is panicking.</p>\n\n<p><a href=\"https://play.golang.org/p/PKeP9s-3tF\" rel=\"nofollow\">https://play.golang.org/p/PKeP9s-3tF</a></p>\n\n<pre><code>func do() {\n    panicking := true\n    defer func() {\n        if panicking {\n            fmt.Println(\"recover would return !nil here\")\n        }\n    }()\n\n    doStuff()\n\n    panicking = false\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 221394, "user_id": 366904, "user_type": "moderator", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3f8912af19fe86b7b34a0b011a962460?s=128&d=identicon&r=PG", "display_name": "Cody Gray", "link": "https://stackoverflow.com/users/366904/cody-gray"}, "edited": false, "score": 0, "creation_date": 1504529389, "post_id": 46036229, "comment_id": 79035020, "body": "Can you expand your answer to explain how this answers the question? What is this code doing, and how is it relevant?"}, {"owner": {"reputation": 11, "user_id": 8558341, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WKMyI1gacyU/AAAAAAAAAAI/AAAAAAAAABU/AO7covk1i90/photo.jpg?sz=128", "display_name": "\u0411\u043e\u0440\u0438\u0441 \u0422\u0435\u043b\u0435\u0441\u043d\u0438\u043d", "link": "https://stackoverflow.com/users/8558341/%d0%91%d0%be%d1%80%d0%b8%d1%81-%d0%a2%d0%b5%d0%bb%d0%b5%d1%81%d0%bd%d0%b8%d0%bd"}, "reply_to_user": {"reputation": 221394, "user_id": 366904, "user_type": "moderator", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3f8912af19fe86b7b34a0b011a962460?s=128&d=identicon&r=PG", "display_name": "Cody Gray", "link": "https://stackoverflow.com/users/366904/cody-gray"}, "edited": false, "score": 1, "creation_date": 1504686302, "post_id": 46036229, "comment_id": 79100997, "body": "code is an example of detecting panic without recovering"}], "tags": [], "owner": {"reputation": 11, "user_id": 8558341, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-WKMyI1gacyU/AAAAAAAAAAI/AAAAAAAAABU/AO7covk1i90/photo.jpg?sz=128", "display_name": "\u0411\u043e\u0440\u0438\u0441 \u0422\u0435\u043b\u0435\u0441\u043d\u0438\u043d", "link": "https://stackoverflow.com/users/8558341/%d0%91%d0%be%d1%80%d0%b8%d1%81-%d0%a2%d0%b5%d0%bb%d0%b5%d1%81%d0%bd%d0%b8%d0%bd"}, "is_accepted": false, "score": 0, "last_activity_date": 1504525179, "creation_date": 1504525179, "answer_id": 46036229, "question_id": 30062949, "link": "https://stackoverflow.com/questions/30062949/checking-for-panic-without-recovering-from-it/46036229#46036229", "title": "Checking for panic without recovering from it", "body": "<p>The solution does not have \"direct\" paths</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"runtime\"\n    \"regexp\"\n)\n\n\nvar re_runtimepanicdetector *regexp.Regexp = regexp.MustCompile(\"runtime/panic.go$\");\n\nfunc tester_for_panic( deferdepth int )bool{\n    _,file,_,_ := runtime.Caller(deferdepth+3)\n    return re_runtimepanicdetector.MatchString(file)\n}\n\nfunc tester_for_panic_worktest() bool {\n    defer func(){ \n        recover() ;\n        if !tester_for_panic(0) { panic(\"tester_for_panic: NOT WORK!!\") } \n    }();\n    panic(1)\n}\nvar Iswork_tester_for_panic bool= tester_for_panic_worktest();\n\n\nfunc testp( dopanic bool ) {  \n        defer func() { \n            fmt.Println(\"defer panic=\", tester_for_panic(0)) ; \n            recover() // optional   \n        }()\n     if (dopanic) { panic(\"test\")  }\n    }\n\n\nfunc main(){\n    testp(true) \n    testp(false)\n}\n</code></pre>\n"}], "owner": {"reputation": 2134, "user_id": 1527244, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/82b81a8c0375cf62e749e2b48fc553e6?s=128&d=identicon&r=PG", "display_name": "Danyel", "link": "https://stackoverflow.com/users/1527244/danyel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1625, "favorite_count": 1, "accepted_answer_id": 30063854, "answer_count": 3, "score": 6, "last_activity_date": 1548709135, "creation_date": 1430858747, "last_edit_date": 1536854958, "question_id": 30062949, "link": "https://stackoverflow.com/questions/30062949/checking-for-panic-without-recovering-from-it", "title": "Checking for panic without recovering from it", "body": "<p>In a defer function, I want to see whether a call to recover would yield a non-nil value (without recovering)</p>\n\n<p>Is it possible?</p>\n"}, {"tags": ["go", "webserver"], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 4, "last_activity_date": 1430859642, "creation_date": 1430859642, "answer_id": 30063181, "question_id": 30062703, "link": "https://stackoverflow.com/questions/30062703/ways-of-optimizing-a-cpu-intensive-golang-webapp/30063181#30063181", "title": "Ways of optimizing a CPU Intensive Golang WebApp", "body": "<p>Multiple goroutines can correspond to a single os thread. The design is described here: <a href=\"https://docs.google.com/document/d/1TTj4T2JO42uD5ID9e89oa0sLKhJYD0Y_kqxDv3I3XMw/edit\" rel=\"nofollow\">https://docs.google.com/document/d/1TTj4T2JO42uD5ID9e89oa0sLKhJYD0Y_kqxDv3I3XMw/edit</a>, which references this paper: <a href=\"http://supertech.csail.mit.edu/papers/steal.pdf\" rel=\"nofollow\">http://supertech.csail.mit.edu/papers/steal.pdf</a>.</p>\n\n<p>On to the questions:</p>\n\n<blockquote>\n  <p>Even when 500 concurrent requests arrive at the server the number of OS threads were still stuck at 35 OS threads [...] Can someone explain me this behaviour?</p>\n</blockquote>\n\n<p>Since you set GOMAXPROCS to the # of CPUs go will only run that many goroutines at a time. </p>\n\n<p>One thing that may be a little confusing is that goroutines aren't always running (sometimes they are \"busy\"). For example if you read a file, while the OS is doing that work the goroutine is busy and the scheduler will pick up another goroutine to run (assuming there is one). Once the file read is complete that goroutine goes back into the list of \"runnable\" goroutines.</p>\n\n<p>The creation of OS level threads is handled by the scheduler and there are additional complexities around system-level calls. (Sometimes you need a real, dedicated thread. See: <a href=\"https://golang.org/pkg/runtime/#LockOSThread\" rel=\"nofollow\">LockOSThread</a>) But you shouldn't expect a ton of threads.</p>\n\n<blockquote>\n  <p>Can the no. of OS threads be increased somehow (from OS or from GOlang)?</p>\n</blockquote>\n\n<p>I think using <code>LockOSThread</code> may result in the creation of new threads, but it won't matter:</p>\n\n<blockquote>\n  <p>Will this improve the performance if no. of OS threads are increased?</p>\n</blockquote>\n\n<p>No. Your CPU is fundamentally limited in how many things it can do at once. Goroutines work because it turns out most operations are IO bound in some way, but if you are truly doing something CPU bound, throwing more threads at the problem won't help. In fact it will probably make it worse, since there is overhead involved in switching between threads. </p>\n\n<p>In other words Go is making the right decision here.</p>\n\n<blockquote>\n  <p>Can someone suggest some other ways of optimizing this app?</p>\n</blockquote>\n\n<pre><code>for i := 0; i &lt; 200000000; i++ {\n   x = x + 1\n   x = x - 1\n}\n</code></pre>\n\n<p>I take it you wrote this code just to make the CPU do a lot of work? What does the actual code look like?</p>\n\n<p>Your best bet will be finding a way to optimize that code so it needs less CPU time. If that's not possible (its already highly optimized), then you will need to add more computers / CPUs to the mix. Get a better computer, or more of them.</p>\n\n<p>For multiple computers you can put a load balancer in front of all your machines and that should scale pretty easily.</p>\n\n<p>You may also benefit by pulling this work off of the webserver and moving it to some backend system. Consider using a work queue.</p>\n"}], "owner": {"reputation": 4123, "user_id": 785523, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/b51864374e248ee87686628bc8528677?s=128&d=identicon&r=PG", "display_name": "tuk", "link": "https://stackoverflow.com/users/785523/tuk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1849, "favorite_count": 1, "accepted_answer_id": 30063181, "answer_count": 1, "score": 1, "last_activity_date": 1430859642, "creation_date": 1430857846, "last_edit_date": 1430858454, "question_id": 30062703, "link": "https://stackoverflow.com/questions/30062703/ways-of-optimizing-a-cpu-intensive-golang-webapp", "title": "Ways of optimizing a CPU Intensive Golang WebApp", "body": "<p>I have a toy web app which is very cpu intensive</p>\n\n<pre><code>func PerfServiceHandler(w http.ResponseWriter, req *http.Request) \n{\n   start := time.Now()\n   w.Header().Set(\"Content-Type\", \"application/json\")\n\n   x := 0\n   for i := 0; i &lt; 200000000; i++ {\n       x = x + 1\n       x = x - 1\n    }\n    elapsed := time.Since(start)    \n    w.Write([]byte(fmt.Sprintf(\"Time Elapsed %s\", elapsed)))\n}\n\nfunc main() \n{\n    http.HandleFunc(\"/perf\", PerfServiceHandler)\n    http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>The above function takes about 120 ms to execute. But when I do a load test this app with 500 concurrent users(siege -t30s -i -v -c500 <a href=\"http://localhost:3000/perf\" rel=\"nofollow\">http://localhost:3000/perf</a>) the results I got </p>\n\n<ul>\n<li>Average Resp Time per request 2.51 secs </li>\n<li>Transaction Rate 160.57 transactions per second</li>\n</ul>\n\n<p>Can someone answer my queries below:-</p>\n\n<ul>\n<li>When I ran with 100, 200, 500 concurrent users I saw the no. of OS threads used by the above app got stuck to 35 from 7 when the app was just started. Increasing the no.of concurrent connection does not change this number. Even when 500 concurrent requests arrive at the server the number of OS threads were still stuck at 35 OS threads (The app was started with runtime.GOMAXPROCS(runtime.NumCPU())). When the test stopped the number was still 35.\n<ul>\n<li>Can someone explain me this behaviour?</li>\n<li>Can the no. of OS threads be increased somehow (from OS or from GOlang)?</li>\n<li>Will this improve the performance if no. of OS threads are increased?</li>\n</ul></li>\n<li>Can someone suggest some other ways of optimizing this app?</li>\n</ul>\n\n<p>Environment:-</p>\n\n<pre><code>Go - go1.4.1 linux/amd64\nOS - Linux 3.2.0-4-amd64 #1 SMP Debian 3.2.65-1+deb7u2 x86_64 GNU/Linux\nProcessor - 2.6Ghz (Intel(R) Xeon(R) CPU E5-2640 v3 @ 2.60GHz)\nRAM - 64 GB\n</code></pre>\n\n<p>OS Parameters -</p>\n\n<pre><code>nproc - 32\ncat /proc/sys/kernel/threads-max - 1031126\nulimit -u - 515563\nulimit -a\n    core file size          (blocks, -c) 0\n    data seg size           (kbytes, -d) unlimited\n    scheduling priority             (-e) 0\n    file size               (blocks, -f) unlimited\n    pending signals                 (-i) 515563\n    max locked memory       (kbytes, -l) 64\n    max memory size         (kbytes, -m) unlimited\n    open files                      (-n) 65536\n    pipe size            (512 bytes, -p) 8\n    POSIX message queues     (bytes, -q) 819200\n    real-time priority              (-r) 0\n    stack size              (kbytes, -s) 8192\n    cpu time               (seconds, -t) unlimited\n    max user processes              (-u) 515563\n    virtual memory          (kbytes, -v) unlimited\n    file locks                      (-x) unlimited\n</code></pre>\n"}, {"tags": ["go", "channel", "goroutine"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430857729, "post_id": 30062128, "comment_id": 48240420, "body": "You&#39;d want a <a href=\"https://golang.org/pkg/sync/#WaitGroup\" rel=\"nofollow noreferrer\"><code>sync.WaitGroup</code></a> so that <code>Partition</code> doesn&#39;t return until the goroutines finish or just a second for loop reading in the <code>pNum</code> results and appending right in <code>Partition</code>. But I don&#39;t see the point of using goroutines here, <code>SubImage</code> is usually quite fast as it normally only creates a new image object that shares the pixel data from the existing image (i.e. there is usually no data copying, just some bookkeeping)."}, {"owner": {"reputation": 353, "user_id": 2986350, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0fbcd2aac49ed0e01d129b4d7daaca4f?s=128&d=identicon&r=PG&f=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/2986350/miguel"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430878590, "post_id": 30062128, "comment_id": 48247386, "body": "Thanks but I was having issues with understanding how to create an array of image.Image after my imageReceiver() function... @evanmcdonnal gave an answer that pertained to my problem.  Thanks for the side note with the SubImage function... I am very new to concurrency with Go so figured this would be a perfect way to simultaneously create goroutines to split my image."}], "answers": [{"comments": [{"owner": {"reputation": 353, "user_id": 2986350, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0fbcd2aac49ed0e01d129b4d7daaca4f?s=128&d=identicon&r=PG&f=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/2986350/miguel"}, "edited": false, "score": 0, "creation_date": 1430878349, "post_id": 30062694, "comment_id": 48247324, "body": "Sweet this worked, I was having trouble wrapping my head around getting the data after my receiver function... I was planning on passing a []image.Image pointer to the receiver function but yes like you said, would have different goroutines fighting for access to the same array.  Thanks the select statement worked for me onto the real challege hehe"}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 0, "last_activity_date": 1430857792, "creation_date": 1430857792, "answer_id": 30062694, "question_id": 30062128, "link": "https://stackoverflow.com/questions/30062128/stuck-with-go-concurrency/30062694#30062694", "title": "Stuck with Go concurrency", "body": "<p>There are a few options for how you can do this but I would say your basic problem is that your receiver doesn't do aggregation and if you changed it so it did it would not be thread safe.</p>\n\n<p>The simple choice to modify your receiver to do aggregation would be to allocate an <code>Image</code> array before the loop and pass a pointer to it into the receiver method which would then just use append when it reads of the channel. But then you would have a bunch of different goroutines fighting for access to the same array. So really, you don't want the aggregation to be multithreaded. If it is you need a locking mechanism in order to write to the collection.</p>\n\n<p>Instead you want to block after the loop. The simplest way to do that would just be to put the body of your receiver right there inline after the loop like;</p>\n\n<pre><code>imgs := []image.Image{}\nimg := &lt;-imgChan\nimgs = append(imgs, img)\nspew.Dump(img.Bounds())\n</code></pre>\n\n<p>The problem is in the real world then your software would block on that line and be unresponsive (have no way of dying or exiting or anything) so instead you'd typically use a channel select where you have at least 2 channels/cases, an abort channel that the caller of <code>Partition</code> can use to kill it if it needs to exit and the case that receives from <code>imgChan</code>. That would look a little more like this;</p>\n\n<pre><code>imgs := []image.Image{}\n\nselect {\n    case img := &lt;-imgChan\n         imgs = append(imgs, img)\n         spew.Dump(img.Bounds())\n    case _ := &lt;-abortChan:\n        return MyCustomError();\n    }\n</code></pre>\n\n<p>Which make it so your aggregation is not concurrent, only the work to produce the results which I personally think is the better design. I could explain how to lock in your receiver method as well but I'm sure you can find plenty of examples of mutex's ect.</p>\n"}], "owner": {"reputation": 353, "user_id": 2986350, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/0fbcd2aac49ed0e01d129b4d7daaca4f?s=128&d=identicon&r=PG&f=1", "display_name": "Miguel", "link": "https://stackoverflow.com/users/2986350/miguel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 284, "favorite_count": 0, "accepted_answer_id": 30062694, "answer_count": 1, "score": 0, "last_activity_date": 1430857792, "creation_date": 1430855865, "question_id": 30062128, "link": "https://stackoverflow.com/questions/30062128/stuck-with-go-concurrency", "title": "Stuck with Go concurrency", "body": "<p>I can't seem to figure out what to do next. My goal is to create an array of all the sub images from the original image using the SubImage function from the image package. I am able to partition an image in the imageSplit() function and pass to imageReceiver() function via a channel.</p>\n\n<p>I actually receive the data in function imageReceiver(), but I don't know how to append to an array and use it after receiving all the images from imageSplit() function.</p>\n\n<pre><code>// Partitions Image\nfunc Partition(src image.Image) []image.Image {\n\n    newImg := image.NewNRGBA64(src.Bounds())\n\n    r := newImg.Rect\n    dx, dy := r.Dx(), r.Dy()\n\n   // partitionNum\n   pNum := 3\n\n    // partition x\n    px, py := (dx / pNum), (dy / pNum)\n\n    imgChan := make(chan image.Image)\n    imgStorage := make([]image.Image, 0)\n\n    for i := 1; i &lt; pNum; i++ {\n        for j := 1; j &lt; pNum; j++ {\n            startX, startY := ((px * i) - px), ((py * j) - py)\n            endX, endY := (px * i), (py * j)\n\n            go imageSplit(imgChan, newImg, startX, startY, endX, endY)\n            go imageReceiver(imgChan)\n        }\n    }\n\n    return imgStorage\n\n}\n\n// Creates sub-images of img\nfunc imageSplit(imgChan chan image.Image, img *image.NRGBA64, startX, startY, endX, endY int) {\n    r := image.Rect(startX, startY, endX, endY)\n    subImg := img.SubImage(r)\n\n    imgChan &lt;- subImg\n}\n\n// Receive sub-image from channel\nfunc imageReceiver(imgChan chan image.Image) {\n    img := &lt;-imgChan\n    spew.Dump(img.Bounds())\n}\n</code></pre>\n\n<p>I thought of creating a global array of image.Image but I'm unsure if this is the correct way to \"save\" all the sub images.</p>\n\n<p>I guess the reason this is a bit confusing is because this is the first time I'm working with concurrency in Go.\nThanks for any help :) </p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-s3", "aws-sdk-go"], "comments": [{"owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "edited": false, "score": 0, "creation_date": 1430849499, "post_id": 30059723, "comment_id": 48235480, "body": "can you post the logs of what is says ? usually it happens when you are accessing it to an http endpoint and is redirecting you to an httpS endpoint. Still the library should do it for you."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430889623, "post_id": 30059723, "comment_id": 48250502, "body": "Also suspect that maybe it wants the Config to specify the Endpoint for your region (<a href=\"http://godoc.org/github.com/awslabs/aws-sdk-go/aws#Config\" rel=\"nofollow noreferrer\">it&#39;s got a field for it</a>), and also think there shoul dbe some good way to get it filled in automatically -- there&#39;s <a href=\"http://godoc.org/github.com/awslabs/aws-sdk-go/service/ec2#EC2.DescribeRegions\" rel=\"nofollow noreferrer\">EC2.DescribeRegions</a>, but that seems backwards."}, {"owner": {"reputation": 2597, "user_id": 1715055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b29b29364de300edef57e8579ec8780?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/1715055/john"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430920394, "post_id": 30059723, "comment_id": 48271008, "body": "@twotwotwo Specified s3-us-west-2.amazon.com as an endpoint but it didn&#39;t work."}], "answers": [{"comments": [{"owner": {"reputation": 2597, "user_id": 1715055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b29b29364de300edef57e8579ec8780?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/1715055/john"}, "edited": false, "score": 0, "creation_date": 1431017404, "post_id": 30088360, "comment_id": 48325476, "body": "How do you know that it&#39;s definitely in us-west-2? On the top right it just mentions global."}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "reply_to_user": {"reputation": 2597, "user_id": 1715055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b29b29364de300edef57e8579ec8780?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/1715055/john"}, "edited": false, "score": 1, "creation_date": 1431017645, "post_id": 30088360, "comment_id": 48325617, "body": "In the AWS console, go to S3, then click on &quot;Properties&quot; on the right, and then select your bucket. It will show the region there."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 3, "last_activity_date": 1430949499, "last_edit_date": 1592644375, "creation_date": 1430949499, "answer_id": 30088360, "question_id": 30059723, "link": "https://stackoverflow.com/questions/30059723/saving-file-to-s3-using-aws-sdk-go/30088360#30088360", "title": "Saving file to S3 using aws-sdk-go", "body": "<p>According to <a href=\"http://docs.aws.amazon.com/AmazonS3/latest/dev/VirtualHosting.html\" rel=\"nofollow noreferrer\">Amazon</a>:</p>\n<blockquote>\n<p>Amazon S3 supports virtual-hosted-style and path-style access in all regions. The path-style syntax, however, requires that you use the region-specific endpoint when attempting to access a bucket. For example, if you have a bucket called mybucket that resides in the EU, you want to use path-style syntax, and the object is named puppy.jpg, the correct URI is <a href=\"http://s3-eu-west-1.amazonaws.com/mybucket/puppy.jpg\" rel=\"nofollow noreferrer\">http://s3-eu-west-1.amazonaws.com/mybucket/puppy.jpg</a>. You will receive a &quot;PermanentRedirect&quot; error, an HTTP response code 301, and a message indicating what the correct URI is for your resource if you try to access a bucket outside the US Standard region with path-style syntax that uses either of the following:</p>\n<ul>\n<li><p><a href=\"http://s3.amazonaws.com\" rel=\"nofollow noreferrer\">http://s3.amazonaws.com</a></p>\n</li>\n<li><p>An endpoint for a region different from the one where the bucket resides, for example, <a href=\"http://s3-eu-west-1.amazonaws.com\" rel=\"nofollow noreferrer\">http://s3-eu-west-1.amazonaws.com</a> for a bucket that was created in the US West (Northern California) region</p>\n</li>\n</ul>\n</blockquote>\n<p>I think the problem is that you are trying to access a bucket in the wrong region. Your request is going here:</p>\n<pre><code>https://my-bucket-123.s3-us-west-2.amazonaws.com/test/123\n</code></pre>\n<p>So make sure that <code>my-bucket-123</code> is actually in <code>us-west-2</code>. (I tried this with my own bucket and it worked fine)</p>\n<p>I also verified that it's using HTTPS by wrapping the calls: (their log message is just wrong)</p>\n<pre><code>type LogReadCloser struct {\n    io.ReadCloser\n}\n\nfunc (lr *LogReadCloser) Read(p []byte) (int, error) {\n    n, err := lr.ReadCloser.Read(p)\n    log.Println(string(p))\n    return n, err\n}\n\ntype LogRoundTripper struct {\n    http.RoundTripper\n}\n\nfunc (lrt *LogRoundTripper) RoundTrip(req *http.Request) (*http.Response, error) {\n    log.Println(&quot;REQUEST&quot;, req)\n    res, err := lrt.RoundTripper.RoundTrip(req)\n    log.Println(&quot;RESPONSE&quot;, res, err)\n    res.Body = &amp;LogReadCloser{res.Body}\n    return res, err\n}\n</code></pre>\n<p>And then:</p>\n<pre><code>svc := s3.New(&amp;aws.Config{\n    Region:      &quot;us-west-2&quot;,\n    Credentials: cred,\n    LogLevel:    0,\n    HTTPClient:  &amp;http.Client{Transport: &amp;LogRoundTripper{http.DefaultTransport}},\n})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 8554035, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-sC7C60NNAXs/AAAAAAAAAAI/AAAAAAAAWlI/uvUiSWAyP3U/photo.jpg?sz=128", "display_name": "Mat Jovanovic", "link": "https://stackoverflow.com/users/8554035/mat-jovanovic"}, "is_accepted": false, "score": 0, "last_activity_date": 1590563106, "creation_date": 1590563106, "answer_id": 62037275, "question_id": 30059723, "link": "https://stackoverflow.com/questions/30059723/saving-file-to-s3-using-aws-sdk-go/62037275#62037275", "title": "Saving file to S3 using aws-sdk-go", "body": "<p>I think you're better off using the S3 Uploader. Here's an example from my code, it's a web app, I use gin framework, and in my case I get a file from a web form, upload it to s3, and retrieve the URL to present a page in other HTMLs:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Create an S3 Uploader\n  uploader := s3manager.NewUploader(sess)\n\n  // Upload \n  result, err := uploader.Upload(&amp;s3manager.UploadInput{\n   Bucket: aws.String(bucket),\n   Key: aws.String(fileHeader.Filename),\n   Body: f,\n  })\n  if err != nil {\n   c.HTML(http.StatusBadRequest, \"create-project.html\", gin.H{\n    \"ErrorTitle\":   \"S3 Upload Failed\",\n    \"ErrorMessage\": err.Error()})\n  } else {\n   // Success, print URL to Console.\n   ///\"result.Location is the URL of an Image\"\n   fmt.Println(\"Successfully uploaded to\", result.Location)\n  }\n</code></pre>\n\n<p>You can find an entire example here, explained step by step:\n<a href=\"https://www.matscloud.com/docs/cloud-sdk/go-and-s3/\" rel=\"nofollow noreferrer\">https://www.matscloud.com/docs/cloud-sdk/go-and-s3/</a></p>\n"}], "owner": {"reputation": 2597, "user_id": 1715055, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/0b29b29364de300edef57e8579ec8780?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/1715055/john"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5283, "favorite_count": 3, "answer_count": 2, "score": 1, "last_activity_date": 1590563106, "creation_date": 1430847661, "last_edit_date": 1485812406, "question_id": 30059723, "link": "https://stackoverflow.com/questions/30059723/saving-file-to-s3-using-aws-sdk-go", "title": "Saving file to S3 using aws-sdk-go", "body": "<p>I'm having a bit of trouble saving a file in golang with the AWS S3 go sdk (<a href=\"https://github.com/awslabs/aws-sdk-go\" rel=\"nofollow\">https://github.com/awslabs/aws-sdk-go</a>). </p>\n\n<p>This is what I have:</p>\n\n<pre><code>import (\n        \"fmt\"\n        \"bytes\"\n\n        \"github.com/awslabs/aws-sdk-go/aws\"\n        \"github.com/awslabs/aws-sdk-go/aws/awsutil\"\n        \"github.com/awslabs/aws-sdk-go/service/s3\"\n)\n\nfunc main() {    \n    cred := aws.DefaultChainCredentials\n    cred.Get() // i'm using environment variable credentials and yes, I checked if they were in here\n    svc := s3.New(&amp;aws.Config{Region: \"us-west-2\", Credentials:cred, LogLevel: 1})\n    params := &amp;s3.PutObjectInput{\n                    Bucket:         aws.String(\"my-bucket-123\"),\n                    Key:            aws.String(\"test/123/\"),\n                    Body:         bytes.NewReader([]byte(\"testing!\")),\n            }\n    resp, err := svc.PutObject(params)\n    fmt.Printf(\"response %s\", awsutil.StringValue(resp))\n}\n</code></pre>\n\n<p>I keep receiving a <code>301 Moved Permanently</code> response. </p>\n\n<p>Edit: I created the bucket manually.\nEdit #2: Example response:</p>\n\n<pre><code>---[ RESPONSE ]--------------------------------------\nHTTP/1.1 301 Moved Permanently\nTransfer-Encoding: chunked\nContent-Type: application/xml\nDate: Tue, 05 May 2015 18:42:03 GMT\nServer: AmazonS3\n</code></pre>\n\n<p>POST sign is http as well.</p>\n"}, {"tags": ["deployment", "go", "docker", "static-files"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1430868560, "post_id": 30059122, "comment_id": 48244587, "body": "I would replace the static template path in your code with an environmental variable - e.g. <code>os.Getenv(&quot;TEMPLATE_PATH&quot;)</code> and then set that with an <code>ENV &#47;path&#47;to&#47;template&#47;file</code> in your Dockerfile. You could optionally fall back to a hardcoded path in the same directory if the <code>TEMPLATE_PATH == &quot;&quot;</code>. A package like <a href=\"https://github.com/kelseyhightower/envconfig\" rel=\"nofollow noreferrer\">github.com/kelseyhightower/envconfig</a> can be useful if you have multiple options to pass in."}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 1, "creation_date": 1430868847, "post_id": 30059122, "comment_id": 48244674, "body": "Also, in terms of conventions: binaries should <i>generally</i> be stored in <code>&#47;opt&#47;</code> or <code>&#47;usr&#47;local&#47;bin</code> depending on how you interpret the docs. <code>$HOME&#47;bin</code> is also acceptable. The templates/config files can be co-located in <code>&#47;opt&#47;</code> or potentially <code>&#47;etc&#47;&lt;yourapp&gt;&#47;...</code> - keeping in mind permissions can be a problem."}], "answers": [{"comments": [{"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1430933047, "post_id": 30064217, "comment_id": 48280120, "body": "I&#39;ve not tested Flynn yet, but your Dockerfile works like a charm. Thank you."}], "tags": [], "owner": {"reputation": 2422, "user_id": 2622394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2d36f32e6280af5bb307cead90e3844f?s=128&d=identicon&r=PG", "display_name": "lmars", "link": "https://stackoverflow.com/users/2622394/lmars"}, "is_accepted": true, "score": 6, "last_activity_date": 1430864437, "creation_date": 1430864437, "answer_id": 30064217, "question_id": 30059122, "link": "https://stackoverflow.com/questions/30059122/deploying-golang-web-app-static-files-with-docker-container/30064217#30064217", "title": "Deploying Golang web app static files with Docker container", "body": "<p>Since you are passing a relative pathname to <code>template.ParseGlob</code>, it will look for templates relative to the current working directory, which you are setting to <code>/go/bin</code> in your <code>ENTRYPOINT</code>.</p>\n\n<p>I would suggest modifying your <code>Dockerfile</code> to use the <code>WORKDIR</code> instruction to set the working directory to <code>/go/src/webserver</code>, which would avoid the need to copy files into <code>/go/bin</code>, for example:</p>\n\n<pre><code>FROM golang:latest\nADD . /go/src/webserver\nWORKDIR /go/src/webserver\nRUN go get\nRUN go install\nENV PORT=8000\nENV REDIRECT=mailtest-1.dev.search.km\nEXPOSE 8000\nENTRYPOINT /go/bin/webserver -manifest=manifest.json\n</code></pre>\n\n<p>You could also consider using <a href=\"https://flynn.io/\" rel=\"noreferrer\">Flynn</a> to deploy and manage your application (see <a href=\"https://flynn.io/docs/how-to-deploy-go\" rel=\"noreferrer\">here</a> for a walkthrough of deploying a Go web app).</p>\n"}], "owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2873, "favorite_count": 3, "accepted_answer_id": 30064217, "answer_count": 1, "score": 6, "last_activity_date": 1430864437, "creation_date": 1430845631, "question_id": 30059122, "link": "https://stackoverflow.com/questions/30059122/deploying-golang-web-app-static-files-with-docker-container", "title": "Deploying Golang web app static files with Docker container", "body": "<p>I'm working on a small web application that has some static files (configs and html templates):</p>\n\n<pre><code>\u251c\u2500\u2500 Dockerfile\n\u251c\u2500\u2500 manifest.json\n\u251c\u2500\u2500 session\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 config.go\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 handlers.go\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 restapi_client.go\n\u251c\u2500\u2500 templates\n\u2502\u00a0\u00a0 \u251c\u2500\u2500 header.tmpl\n\u2502\u00a0\u00a0 \u2514\u2500\u2500 index.tmpl\n\u2514\u2500\u2500 webserver.go\n</code></pre>\n\n<p>For instance, templates in the code are discovered with a local path (<em>is it a good practice?</em>):</p>\n\n<pre><code>func init() {\n    templates = template.Must(template.ParseGlob(\"templates/*.tmpl\"))\n}\n</code></pre>\n\n<p>Docker container is used for app deployment. As you can see in the <code>Dockerfile</code>, I have to copy all the static files in <code>/go/bin</code> directory:</p>\n\n<pre><code>FROM golang:latest\n\nENV PORT=8000\n\nADD . /go/src/webserver/\nRUN go install webserver\nRUN go get webserver\n\n# Copy static files\nRUN cp -r /go/src/webserver/templates /go/bin/templates\nRUN cp -r /go/src/webserver/manifest.json /go/bin/manifest.json\n\nEXPOSE $PORT\nENTRYPOINT cd /go/bin &amp;&amp; PORT=$PORT REDIRECT=mailtest-1.dev.search.km /go/bin/webserver -manifest=manifest.json\n</code></pre>\n\n<p>I think this workaround should be considered as incorrect since it violates standard Linux conventions (separate storing of the executable files and various data files). If anyone uses Docker for Golang web application deployment too, please share your experience:</p>\n\n<ul>\n<li>How do you store static content and how do you discover it in your code?</li>\n<li>What is the most proper method of deploying web application with a Docker containers?</li>\n</ul>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430826373, "post_id": 30052002, "comment_id": 48218532, "body": "What is your directory structure ?"}, {"owner": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430827996, "post_id": 30052002, "comment_id": 48219651, "body": "Added to the question"}], "answers": [{"comments": [{"owner": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430827480, "post_id": 30052112, "comment_id": 48219263, "body": "Thanks Von, I suspected that too. We want to serve a root index.html page, so entering &quot;<a href=\"http://localhost:8888\" rel=\"nofollow noreferrer\">localhost:8888</a>&quot; in a browser gives the user the static content. Hence r.PathPrefix(&quot;/&quot;).Handler(). Is there an alternative to &quot;/&quot; that would permit 404 handling and serving the static content?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430827531, "post_id": 30052112, "comment_id": 48219289, "body": "@CloomMagoo yes, but the side effect is that the <code>NotFoundHandler</code> would never be called."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430827602, "post_id": 30052112, "comment_id": 48219332, "body": "@CloomMagoo for &quot;/&quot;, use <code>mux.HandleFunc(&quot;&#47;&quot;, ...)</code>, not <code>PathPrefix</code>"}, {"owner": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430828747, "post_id": 30052112, "comment_id": 48220193, "body": "to use HandleFunc instead of PathPrefix, what would the actual handler func for serving the static directory look like? I&#39;ll investigate but if you have an example I&#39;d appreciate it. Thanks."}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430828874, "post_id": 30052112, "comment_id": 48220297, "body": "@CloomMagoo like any other httpHandler function."}, {"owner": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "edited": false, "score": 0, "creation_date": 1430910805, "post_id": 30052112, "comment_id": 48263474, "body": "mux.Handle(&quot;/&quot;, http.FileServer(http.Dir(staticPath))) works, thanks. Now, requests for static content pages (&quot;/content/page1&quot;) are getting intercepted by the NotFoundHandler. Still, progress."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1430826448, "creation_date": 1430826448, "answer_id": 30052112, "question_id": 30052002, "link": "https://stackoverflow.com/questions/30052002/serving-static-content-and-handling-404-not-found-with-gorilla-toolkit/30052112#30052112", "title": "Serving static content and handling 404 not found with Gorilla toolkit", "body": "<p>I suspect <code>r.PathPrefix(\"/\").Handler()</code> would match any path, making the <code>notfound</code> handler useless.</p>\n\n<p>As mentioned in \"<a href=\"https://github.com/gorilla/mux/blob/8a875a034c69b940914d83ea03d3f1299b4d094b/route.go#L302-L303\" rel=\"nofollow\"><code>route.go</code></a>\":</p>\n\n<pre><code>// Note that it does not treat slashes specially \n// (\"`/foobar/`\" will be matched by the prefix \"`/foo`\") \n// so you may want to use a trailing slash here.\n</code></pre>\n\n<p>If you are using <code>PathPrefix</code> (as in <a href=\"https://github.com/gorilla/mux/blob/8096f47503459bcc74d1f4c487b7e6e42e5746b5/mux_test.go#L261\" rel=\"nofollow\">those tests</a>), use it for a specific path, not for the generic \"<code>/</code>\".</p>\n"}], "owner": {"reputation": 466, "user_id": 2445393, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec034b9a35830fd7c7bb3a9d85bde0c9?s=128&d=identicon&r=PG", "display_name": "Cloom Magoo", "link": "https://stackoverflow.com/users/2445393/cloom-magoo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1726, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1485762835, "creation_date": 1430826095, "last_edit_date": 1433796574, "question_id": 30052002, "link": "https://stackoverflow.com/questions/30052002/serving-static-content-and-handling-404-not-found-with-gorilla-toolkit", "title": "Serving static content and handling 404 not found with Gorilla toolkit", "body": "<p>I recently asked about serving static content and handling 404 with Gorilla mux; when using Handle instead of PathPrefix, the app can serve the root page (<a href=\"http://localhost:8888\" rel=\"nofollow\">http://localhost:8888</a>):</p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/myService\", ServiceHandler)\n    r.Handle(\"/\", http.FileServer(http.Dir(\"./static\")))\n    r.NotFoundHandler = http.HandlerFunc(notFound)\n    l, _ := net.Listen(\"tcp\", \"8888\")\n    http.Serve(l, r)\n}\n</code></pre>\n\n<p>However requests for pages within the root page (e.g. <a href=\"http://localhost:8888/demo/page1.html\" rel=\"nofollow\">http://localhost:8888/demo/page1.html</a>) get intercepted by the 404 handler. Is there any way to prevent this, while catching requests for non-existent pages or services? This is the directory structure:</p>\n\n<pre><code>...\nmain.go\nstatic\\\n  | index.html\n  demo\\\n    page1.html\n    demo.js\n    demo.css\n    | jquery\\\n       | &lt;js files&gt;\n    | images\\\n       | &lt;png files&gt;\n</code></pre>\n\n<p>Previous Question:</p>\n\n<p>I am using the Gorilla mux toolkit to handle http requests in a web server app:</p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/myService\", ServiceHandler)\n    r.PathPrefix(\"/\").Handler(http.FileServer(http.Dir(\"./static\")))\n    l, _ := net.Listen(\"tcp\", \"8888\")\n    http.Serve(l, r)\n}\n</code></pre>\n\n<p>I want to add a handler for invalid URLS, but it is never called: </p>\n\n<pre><code>func main() {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/myService\", ServiceHandler)\n    r.NotFoundHandler = http.HandlerFunc(notFound)\n    r.PathPrefix(\"/\").Handler(http.FileServer(http.Dir(\"static\")))\n    l, _ := net.Listen(\"tcp\", \"8888\")\n    http.Serve(l, r)\n}\n</code></pre>\n\n<p>If I remove the static handler, the not found handler is called. However, the app needs to serve the static content, from a non-absolute path. Is there a way to combine that with 404 handling? </p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430827698, "post_id": 30047639, "comment_id": 48219410, "body": "The text file in question has multiple id values, but I&#39;m only interested in the ones in the port section"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "edited": false, "score": 1, "creation_date": 1430844074, "post_id": 30047639, "comment_id": 48232059, "body": "If it&#39;s more complex than this, try writing a parser/lexer: <a href=\"http://blog.gopheracademy.com/advent-2014/parsers-lexers/\" rel=\"nofollow noreferrer\">blog.gopheracademy.com/advent-2014/parsers-lexers</a>"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430815342, "post_id": 30047980, "comment_id": 48211183, "body": "Simple solution, but only works if the value of the <code>id</code>s does not contain spaces."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1430820068, "post_id": 30047980, "comment_id": 48214481, "body": "Good point. Added a second solution that will work with ids containing spaces as well."}, {"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430830803, "post_id": 30047980, "comment_id": 48221887, "body": "Is there a way to do the above when u have multiple id values but you&#39;re only interested in the ones contained in the &quot;port&quot; section?"}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1430831287, "post_id": 30047980, "comment_id": 48222242, "body": "Sure, how you&#39;d do that depends on the format your strings are in. If you have each section as a string like in my sample you can then simply test with <code>if strings.hasPrefix(input, &quot;port&quot;)</code>. Process the string when true and skip it otherwise."}, {"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430832376, "post_id": 30047980, "comment_id": 48223118, "body": "Not sure how it would work with the sample text I&#39;ve provided..care to share?"}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1430832823, "post_id": 30047980, "comment_id": 48223462, "body": "See the last edit. Added another section that would work with the file being read one line at a time and keeping track if you are in a port section or not. If instead you read the file a section at a time you do the check before processing the string that holds the entire section."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 1, "last_activity_date": 1430832694, "last_edit_date": 1430832694, "creation_date": 1430815023, "answer_id": 30047980, "question_id": 30047639, "link": "https://stackoverflow.com/questions/30047639/golang-read-non-valid-json-from-text-file/30047980#30047980", "title": "Golang: Read non valid JSON from text file", "body": "<p>If the structure is the same throughout and all you want is the id values you can do something like this (<a href=\"https://play.golang.org/p/6NJQ-r9Fzm\" rel=\"nofollow\">on the Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    // This will work only if ids don't have spaces\n    fields := strings.Fields(input1)\n    for i, field := range fields {\n        if field == \"id:\" {\n            fmt.Println(\"Got an id: \", fields[i+1][1:len(fields[i+1])-1])\n        }\n    }\n    fmt.Println()\n\n    // This will extract all strings enclosed in \"\"\n    for i1, i2 := 0, 0;; {\n        i := strings.Index(input2[i1:], \"\\\"\") // find the first \" starting after the last match\n        if i &gt; 0 { // if we found one carry on\n            i1 = i + 1 + i1 // set the start index to the absolute position in the string\n            i2 = strings.Index(input2[i1:], \"\\\"\") // find the second \"\n            fmt.Println(input2[i1 : i1+i2]) // print the string between \"\"\n            i1 += i2 + 1 // set the new starting index to after the last match\n        } else { // otherwise we are done\n            break\n        }\n    }\n\n\n    // Reading the text line by line and only processing port sections\n    parts := []string{\"port{\", \"  Entry {\", \"      id: \\\"foo bar\\\"\", \"  }\", \"   Entry {\", \"      id: \\\"more foo bar\\\"\", \"  }\", \"}\"}        \n    isPortSection := false\n    for _, part := range parts {\n        if string.HasPrefix(part, \"port\"){\n            isPortSection = true\n        }\n        if string.HasPrefix(part, \"host\"){\n            isPortSection = false\n        }\n        if isPortSection &amp;&amp; strings.HasPrefix(strings.TrimSpace(part),\"id:\") {\n            line := strings.TrimSpace(part)\n            fmt.Println(line[5:len(line)-1])\n        }\n    }\n}\n\nvar input1 string = `port{\n  Entry {\n      id: \"foo\"\n  }\n   Entry {\n      id: \"bar\"\n  }\n}`\n\nvar input2 string = `port{\n  Entry {\n      id: \"foo bar\"\n  }\n   Entry {\n      id: \"more foo bar\"\n  }\n}`\n</code></pre>\n\n<p>Prints:</p>\n\n<pre><code>Got an id:  foo\nGot an id:  bar\n\nfoo bar\nmore foo bar\n</code></pre>\n\n<p>Instead of printing them in the loop you can stick them into a slice or map or do whatever you want/need to. And of course instead of using the string literal you read in the lines from your file.</p>\n"}, {"comments": [{"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430828288, "post_id": 30050037, "comment_id": 48219870, "body": "thanks for the contrib...I&#39;m not a fan of &quot;magic numbers&quot; which is what I see in your code, what does &quot;state=1, state=2, state = 0&quot; mean? makes it quite hard for someone to look at the code and figure out what it&#39;s doing or not doing.."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430828897, "post_id": 30050037, "comment_id": 48220312, "body": "Sure, I just wanted to produce more compact example... or I was simply lazy. I&#39;ve updated my answer (and play link) with constants which should better explain the behaviour. As I said, this not validating the structure of you data, so IDs lying outside of your Entry blocks will be parsed as well. You&#39;d need more states to be able to validate that."}, {"owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430829353, "post_id": 30050037, "comment_id": 48220662, "body": "cool..thanks..what I actually now need is way to extract id values from only one section.."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "edited": false, "score": 0, "creation_date": 1430831925, "post_id": 30050037, "comment_id": 48222739, "body": "You will need to keep track of the current section stack (tracing curly brackets). I&#39;ve updated my answer for you, so you can, for example, take only IDs where first section on stack is <code>port</code>."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 1, "last_activity_date": 1430831742, "last_edit_date": 1430831742, "creation_date": 1430820463, "answer_id": 30050037, "question_id": 30047639, "link": "https://stackoverflow.com/questions/30047639/golang-read-non-valid-json-from-text-file/30050037#30050037", "title": "Golang: Read non valid JSON from text file", "body": "<p>I believe <a href=\"http://golang.org/pkg/text/scanner/\" rel=\"nofollow\"><code>text/scanner</code></a> might be very useful here. It's not plug&amp;play, but will allow you to tokenise input and will parse your strings nicely (spaces, escaped values etc.). A quick proof of concept, scanner with a simple state machine to capture all <code>id: {str}</code> patterns which are in <code>Entry</code> section:</p>\n\n<pre><code>var s scanner.Scanner\ns.Init(strings.NewReader(src))\n\n// Keep state of parsing process\nconst (\n    StateNone = iota\n    StateID\n    StateIDColon\n)\nstate := StateNone\n\nlastToken := \"\"        // last token text\nsections := []string{} // section stack\n\ntok := s.Scan()\nfor tok != scanner.EOF {\n    txt := s.TokenText()\n    switch txt {\n    case \"id\":\n        if state == StateNone {\n            state = StateID\n        } else {\n            state = StateNone\n        }\n    case \":\":\n        if state == StateID {\n            state = StateIDColon\n        } else {\n            state = StateNone\n        }\n    case \"{\":\n        // Add section\n        sections = append(sections, lastToken)\n    case \"}\":\n        // Remove section\n        if len(sections) &gt; 0 {\n            sections = sections[0 : len(sections)-1]    \n        }\n    default:\n        if state == StateIDColon &amp;&amp; sections[0] == \"port\" {\n            // Our string is here\n            fmt.Println(txt)\n        }\n        state = StateNone\n    }\n    lastToken = txt\n    tok = s.Scan()\n}\n</code></pre>\n\n<p>You can <a href=\"http://play.golang.org/p/7O_6WSXyIO\" rel=\"nofollow\">play it here</a>. This surely requires some more work if you need validate the input structure etc. but seems like a good starting point to me.</p>\n"}], "owner": {"reputation": 3847, "user_id": 251840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e3bf4bcc6dfbe7c13231f914334db925?s=128&d=identicon&r=PG", "display_name": "jwesonga", "link": "https://stackoverflow.com/users/251840/jwesonga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 0, "accepted_answer_id": 30047980, "answer_count": 2, "score": 1, "last_activity_date": 1430832694, "creation_date": 1430813912, "last_edit_date": 1430827226, "question_id": 30047639, "link": "https://stackoverflow.com/questions/30047639/golang-read-non-valid-json-from-text-file", "title": "Golang: Read non valid JSON from text file", "body": "<p>I have a txt file with the following sample data:</p>\n\n<pre><code>host{\n      Entry {\n          id: \"foo\"\n      }\n       Entry {\n          id: \"bar\"\n      }\n    }\n\nport{\n      Entry {\n          id: \"lorem\"\n      }\n       Entry {\n          id: \"ipsum\"\n      }\n    }\n</code></pre>\n\n<p>It has +300 of those Entry values. I'd like to read the file and extract the <strong>id</strong> values belonging to the <strong>port</strong> section. It's not valid JSON so I can't use the json decoder, is there any other way of extracting the values?</p>\n"}, {"tags": ["go", "gorp"], "answers": [{"tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": true, "score": 0, "last_activity_date": 1432050174, "creation_date": 1432050174, "answer_id": 30330227, "question_id": 30044331, "link": "https://stackoverflow.com/questions/30044331/how-to-set-default-value-for-a-column-on-createtables/30330227#30330227", "title": "How to set default value for a column on CreateTables()?", "body": "<p>An implementation of this feature is currently being reviewed by the project's collaborators.<br>\nSee the corresponding <a href=\"https://github.com/go-gorp/gorp/pull/209\" rel=\"nofollow\">pull request</a>.</p>\n"}], "owner": {"reputation": 2594, "user_id": 3090068, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/69636a28e85f584b8f264495494f3de0?s=128&d=identicon&r=PG&f=1", "display_name": "Yuki Inoue", "link": "https://stackoverflow.com/users/3090068/yuki-inoue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 182, "favorite_count": 1, "accepted_answer_id": 30330227, "answer_count": 1, "score": 1, "last_activity_date": 1432053666, "creation_date": 1430800263, "last_edit_date": 1432053666, "question_id": 30044331, "link": "https://stackoverflow.com/questions/30044331/how-to-set-default-value-for-a-column-on-createtables", "title": "How to set default value for a column on CreateTables()?", "body": "<p>I am using <a href=\"https://github.com/go-gorp/gorp\" rel=\"nofollow\">gorp</a>, and I want to create a table with <code>DbMap#CreateTables()</code> by setting a default value for a column.</p>\n\n<p>How can I achieve this?</p>\n"}, {"tags": ["pointers", "interface", "go"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1430798368, "post_id": 30043995, "comment_id": 48203495, "body": "Are you saying that a pointer type can&#39;t implement an interface? It&#39;s sure that they can. Can you create a minimal example that demonstrates the problem you&#39;re having? At the moment, there&#39;s lots of context in your question, but none of the important details."}, {"owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1430799302, "post_id": 30043995, "comment_id": 48203713, "body": "No.  I&#39;m under the impression that a pointer of an interface is unable to use call methods.  Also a struct is unable to update any of it&#39;s fields, because interfaces are not allowed pointer methods.  I did update with a minimal example of what&#39;s going on though.  Thanks for help in advance!"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1430844806, "post_id": 30043995, "comment_id": 48232540, "body": "BTW, a few side notes: When <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">naming</a> try to avoid stutter (e.g. <code>scripting.Lang</code> vs <code>scripting.ScriptingLag</code>). Error variables are often named <code>Err\u2026</code> and error types <code>\u2026Error</code> (e.g. <code>var ErrNoSuchLang = errors.New(\u2026)</code> or <code>type SomeCategoryError \u2026</code>). Watch out for data races if you intend to use any of this via goroutines; as-is your <code>Init</code> example is not safe for concurrency (which is fine if you expect the caller to deal with that); <code>sync.Once</code> can be helpful in such cases as well as the <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a>."}, {"owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "edited": false, "score": 0, "creation_date": 1430849293, "post_id": 30043995, "comment_id": 48235343, "body": "Apart from the races, this has all been fixed.  Godoc.org&#39;s linters bugged me about most of it.  The tool doesn&#39;t use any Goroutines for the moment.  Thanks Dave!"}], "answers": [{"comments": [{"owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "edited": false, "score": 0, "creation_date": 1430800115, "post_id": 30044265, "comment_id": 48203938, "body": "That won&#39;t satisfy the interface though; Lua does not implement ScriptingLang (Init method has pointer receiver)"}, {"owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "edited": false, "score": 0, "creation_date": 1430800976, "post_id": 30044265, "comment_id": 48204159, "body": "I&#39;m facepalming so hard right now.  For whatever reason I was attempting to store the pointer inside the interfaces as *ScriptingLang.  Much thanks on helping me understand that."}, {"owner": {"reputation": 14499, "user_id": 3589092, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/7ROkk.jpg?s=128&g=1", "display_name": "kemicofa ghost", "link": "https://stackoverflow.com/users/3589092/kemicofa-ghost"}, "edited": false, "score": 0, "creation_date": 1471609456, "post_id": 30044265, "comment_id": 65427387, "body": "Really great explanation and great example. Saved me a lot of time. Thanks."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 7, "last_activity_date": 1430800265, "last_edit_date": 1430800265, "creation_date": 1430799902, "answer_id": 30044265, "question_id": 30043995, "link": "https://stackoverflow.com/questions/30043995/interfaces-stored-as-value-methods-unable-to-update-struct-fields/30044265#30044265", "title": "Interfaces stored as value; Methods unable to update struct fields", "body": "<p>If you want to mutate state, you need a pointer receiver, and your <code>Init</code> method doesn't have one. The fact that you're storing the value inside an interface makes no difference.</p>\n\n<p>In your minimal(-ish) example, change the <code>Init</code> method (and any method that updates state) to have a pointer receiver, and point a pointer inside the interface and everything works:</p>\n\n<pre><code>func (l *Lua) Init() error {\n    l.state = \"Inited\"\n    return nil\n}\n\n...\n\nfunc main() {\n    lang = &amp;Lua{}\n    lang.Init()\n    lang.DoString(\"Stuff\")\n}\n</code></pre>\n\n<p>This article might help: <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\">http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go</a></p>\n"}], "owner": {"reputation": 197, "user_id": 1295863, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/7d891db1c3cffd1c11b393d6d6816f97?s=128&d=identicon&r=PG", "display_name": "THUNDERGROOVE", "link": "https://stackoverflow.com/users/1295863/thundergroove"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1337, "favorite_count": 0, "accepted_answer_id": 30044265, "answer_count": 1, "score": 4, "last_activity_date": 1546114144, "creation_date": 1430798139, "last_edit_date": 1546114144, "question_id": 30043995, "link": "https://stackoverflow.com/questions/30043995/interfaces-stored-as-value-methods-unable-to-update-struct-fields", "title": "Interfaces stored as value; Methods unable to update struct fields", "body": "<p>I have a tool that I'm writing that exposes some functions that pull information out of a static database to several scripting languages that I'm embedding into the tool.</p>\n\n<p>I thought; \"Hey sounds like a nice use case for interfaces\".  So I defined an interface like so in my package scripting</p>\n\n<pre><code>type ScriptingLang interface {\n    RunScript(filename string) error\n    RunString(s string) error\n    Interpreter() error\n    Init() error\n    IsInit() bool\n}\n</code></pre>\n\n<p>Then I store a map of them so I can look them up by a string defined like so in a different package.</p>\n\n<pre><code>var ScriptingLangs = make(map[string]scripting.ScriptingLang)\n</code></pre>\n\n<p>and a function to register them.  Also some little helper functions like</p>\n\n<pre><code>func RunString(lang, s string) error {\n    if v, ok := ScriptingLangs[lang]; ok {\n        if !v.IsInit() {\n            v.Init()\n        }\n        return v.RunString(s)\n    } else {\n        return NoSuchLangErr\n    }\n    return nil\n }\n</code></pre>\n\n<p>The problem that I ran into is it seams that interfaces can't have methods with pointer receivers. As a result my Lua struct that implements ScriptingLang isn't able to save it's *state because it's stored in ScriptingLangs.</p>\n\n<p>I've tried updating the value stored in the map at the end of functions that save state and it didn't update the value.</p>\n\n<p>To my understanding you shouldn't use pointers of interfaces so what are my options here?  I would like to really keep the interfaces so I can do some neat stuff with git submodules.</p>\n\n<p>A minimal example of my problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype ScriptingLang interface {\n    DoString(s string) error\n    Init() error\n}\n\ntype Lua struct {\n    state string\n}\n\nfunc (l Lua) DoString(s string) error {\n    fmt.Printf(\"Doing '%v' with state '%v'\\n\", s, l.state)\n    return nil\n}\n\nfunc (l Lua) Init() error {\n    l.state = \"Inited\"\n    return nil\n}\n\nvar lang ScriptingLang\n\nfunc main() {\n    lang = Lua{}\n    lang.Init()\n    lang.DoString(\"Stuff\")\n}\n</code></pre>\n"}, {"tags": ["mysql", "rest", "http", "go"], "comments": [{"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 1, "creation_date": 1430807825, "post_id": 30043912, "comment_id": 48206889, "body": "Can you show a sample of your select statement? Also see <a href=\"http://stackoverflow.com/a/20275714/1078890\">this</a> post which might answer your question."}], "answers": [{"comments": [{"owner": {"reputation": 2390, "user_id": 4259255, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/dce14d258ebddc717ca2cddb4d1577af?s=128&d=identicon&r=PG&f=1", "display_name": "Hundley", "link": "https://stackoverflow.com/users/4259255/hundley"}, "edited": false, "score": 1, "creation_date": 1430865882, "post_id": 30048100, "comment_id": 48243732, "body": "Lots of helpful info, thanks. I&#39;ve discovered that - like you mentioned - a MySQL prepared statement is limited to one particular connection. My Go server keeps a connection pool and allocates a different connection to each incoming request, so I don&#39;t see how prepared statements would be an advantage there. The go-mysql-driver documentation doesn&#39;t specify, but if the connection loses the prepared statement when it gets released back into the connection pool, that would require it to be re-prepared with every incoming request - eliminating any advantage."}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 3, "last_activity_date": 1430850587, "last_edit_date": 1430850587, "creation_date": 1430815394, "answer_id": 30048100, "question_id": 30043912, "link": "https://stackoverflow.com/questions/30043912/go-mysql-driver-prepared-statements-with-variable-query-parameters/30048100#30048100", "title": "Go-MySQL-Driver: Prepared Statements with Variable Query Parameters", "body": "<p>No RDBMS I'm aware of is able to bind an unknown number of parameters. It is never possible to match an array with an unknown number of parameter placeholders. It means there is not smart way to bind an array to a query such as:</p>\n\n<pre><code>SELECT xxx FROM xxx WHERE xxx in (?,...,?)\n</code></pre>\n\n<p>This is not a limitation of the client driver, this is simply not supported by database servers.</p>\n\n<p>There are various workarounds.</p>\n\n<p>You can create the query with 20 ?, bind the values you have, and complete the binding by NULL values. It works fine, because of the particular semantic of comparison operations involving NULL values. A condition like \"field = ?\" evaluates always to false when the parameter is bound to a NULL value, even if some rows would match. Supposing you have 5 values in your array, the database server will have to deal with 5 provided values, plus 15 NULL values. It is usually smart enough to just ignore the NULL values</p>\n\n<p>An alternative solution is to prepare all the queries (each one with a different number of parameters). It is only interesting if the maximum number of parameters is limited. It works well on database for which prepared statements really matters (such as Oracle).</p>\n\n<p>As far as MySQL is concerned, the gain of using a prepared statement is quite limited. Keep in mind that prepared statements are only maintained per session, they are not shared across sessions. If you have a lot of sessions, they take memory. On the other hand, parsing statements with MySQL does not involve much overhead (contrary to some other database systems). Generally, generating plenty of prepared statements to cover a single query is not worth it.</p>\n\n<p>Note that some MySQL drivers offer a prepared statement interface, while they do not use internally the prepared statement capability of the MySQL protocol (again, because often, it is not worth it).</p>\n\n<p>There are also some other solutions (like relying on a temporary table), but they are only interesting if the number of parameters is significant.</p>\n"}], "owner": {"reputation": 2390, "user_id": 4259255, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/dce14d258ebddc717ca2cddb4d1577af?s=128&d=identicon&r=PG&f=1", "display_name": "Hundley", "link": "https://stackoverflow.com/users/4259255/hundley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 507, "favorite_count": 0, "accepted_answer_id": 30048100, "answer_count": 1, "score": 3, "last_activity_date": 1430850587, "creation_date": 1430797563, "question_id": 30043912, "link": "https://stackoverflow.com/questions/30043912/go-mysql-driver-prepared-statements-with-variable-query-parameters", "title": "Go-MySQL-Driver: Prepared Statements with Variable Query Parameters", "body": "<p>I'd like to use prepared statements with MySQL on my Go server, but I'm not sure how to make it work with an unknown number of parameters.  One endpoint allows users to send an array of id's, and Go will SELECT the objects from the database matching the given id's.  This array could contain anywhere from 1 to 20 id's, so how would I construct a prepared statement to handle that?  All the examples I've seen require you to know exactly the number of query parameters.</p>\n\n<p>The only (very unlikely) option I can think is to prepare 20 different SELECT statements, and use the one that matches the number of id's the user submits - but this seems like a terrible hack.  Would I even see the performance benefits of prepared statements at that point?</p>\n\n<p>I'm pretty stuck here, so any help would be appreciated!</p>\n"}, {"tags": ["windows", "oracle", "go", "odbc"], "comments": [{"owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 1, "creation_date": 1430797426, "post_id": 30043488, "comment_id": 48203230, "body": "Your program does not compile. There is no package named &quot;github.com/odbc&quot;. Please show source of your program."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430810152, "post_id": 30043488, "comment_id": 48208134, "body": "Im trying to compile your code , to which packages you did go get ?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1430819899, "post_id": 30043488, "comment_id": 48214353, "body": "Check your errors instead of ignoring them. What do they tell you?"}, {"owner": {"reputation": 628, "user_id": 1888360, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f99d86764a53dac0f46420b6cacd08f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Peshave", "link": "https://stackoverflow.com/users/1888360/aditya-peshave"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430831925, "post_id": 30043488, "comment_id": 48222738, "body": "@MIkCode I edited the post. Please check it out."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 1, "creation_date": 1430832419, "post_id": 30043488, "comment_id": 48223154, "body": "@ADi Its look like line 23 i throwing the panic  im assuming that rows is nil can you check if rows isn&#39;t nil ?"}, {"owner": {"reputation": 628, "user_id": 1888360, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f99d86764a53dac0f46420b6cacd08f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Peshave", "link": "https://stackoverflow.com/users/1888360/aditya-peshave"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430832893, "post_id": 30043488, "comment_id": 48223515, "body": "@MIkCode : Yes, the <code>open()</code> method is throwing error. I edited the post."}, {"owner": {"reputation": 1967, "user_id": 1390507, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/53335e2b507fd457757eee3a39323159?s=128&d=identicon&r=PG", "display_name": "alex", "link": "https://stackoverflow.com/users/1390507/alex"}, "edited": false, "score": 0, "creation_date": 1430981736, "post_id": 30043488, "comment_id": 48300092, "body": "Your ODBC manager complains about you connection string. Try something different, for example &quot;Driver={Microsoft ODBC for Oracle};Server=myServerAddress;Uid=myUsername;Pwd=myPassword&zwnj;&#8203;;&quot;. I don&#39;t know for suer - I googled for it. I also don&#39;t know what ODBC driver you use, so, if different, change &quot;Driver&quot; value. Check your driver documentation for correct connection string syntax."}], "answers": [{"tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": false, "score": 0, "last_activity_date": 1430827605, "creation_date": 1430827605, "answer_id": 30052514, "question_id": 30043488, "link": "https://stackoverflow.com/questions/30043488/connecting-to-oracle-db-in-go/30052514#30052514", "title": "Connecting to Oracle DB in Go", "body": "<p>The error you get says you are trying to access a \"method\" on an non-initialised variable (nil value).\nYou should check you have no errors before using the values you get back.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/odbc\"\n    \"log\"\n)\n\nfunc main() {\n    conn, err := odbc.Connect(\"DSN=lnxcepd1db01.XXXXXX.com:51521*CBPDEV;UID=XXXXX;PWD=XXXXX\")\n    if err != nil {\n        log.Println(log)\n        return\n    }\n    defer conn.Close()\n\n    stmt, err := conn.Prepare(\"select * from XXXXX where XXXX = ?\")\n    if err != nil {\n        log.Println(log)\n        return\n    }\n    defer stmt.Close()\n\n    stmt.Execute(\"100044\")\n    rows, _ := stmt.FetchAll()\n    for i, row := range rows {\n        println(i, row)\n    }\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 628, "user_id": 1888360, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f99d86764a53dac0f46420b6cacd08f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Peshave", "link": "https://stackoverflow.com/users/1888360/aditya-peshave"}, "edited": false, "score": 0, "creation_date": 1431089181, "post_id": 30112855, "comment_id": 48357979, "body": "If you could correct my connection string format as well, that will be great !! Thanks :)"}, {"owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "reply_to_user": {"reputation": 628, "user_id": 1888360, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f99d86764a53dac0f46420b6cacd08f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Peshave", "link": "https://stackoverflow.com/users/1888360/aditya-peshave"}, "edited": false, "score": 0, "creation_date": 1432181301, "post_id": 30112855, "comment_id": 48819903, "body": "There is nothing special about the connections strings you use with any of the Go sql drivers. If you can configure a DSN in the control panel ODBC tool, use: <code>connString := fmt.Sprintf(&quot;DSN=%s;UID=%s;PWD=%s&quot;, dsn, user, password)</code> else <code>connString = fmt.Sprintf(&quot;Driver={%s};SERVER=(DESCRIPTION=(ADDRESS=(PROTO&zwnj;&#8203;COL=TCP)(HOST=%s)(PO&zwnj;&#8203;RT=%d))(CONNECT_DATA&zwnj;&#8203;=(SERVICE_NAME=%s)))&zwnj;&#8203;;uid=%s;pwd=%s;&quot;, driver, hostname, port, service_name, user, password)</code>. <b>BUT</b> Always check the error status so you know which func errored and what the error is. It will be a ODBC error msg if conn string is bad. Google that."}, {"owner": {"reputation": 1770, "user_id": 2777092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6725c0383a417d03b6d3d48c730d683d?s=128&d=identicon&r=PG", "display_name": "KingRider", "link": "https://stackoverflow.com/users/2777092/kingrider"}, "edited": false, "score": 0, "creation_date": 1478007537, "post_id": 30112855, "comment_id": 67975536, "body": "Thanks a example <code>conn&#47;prep&#47;query&#47;fetch</code> are perfect order, u can add too reconnect to <code>FOR &#47; ERR to CONTINUE &#47; BREAK</code> :D"}], "tags": [], "owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "is_accepted": true, "score": 2, "last_activity_date": 1431038418, "creation_date": 1431038418, "answer_id": 30112855, "question_id": 30043488, "link": "https://stackoverflow.com/questions/30043488/connecting-to-oracle-db-in-go/30112855#30112855", "title": "Connecting to Oracle DB in Go", "body": "<p>here is a function to do a complete conn/prep/query/fetch operation:</p>\n\n<pre><code>func getDatePrepQuery(driver string, connString string) error {\n    db, err := sql.Open(driver, connString)\n    if err != nil {\n        log.Printf(\"sql.Open(%s, %s)\\n\\t%s\\n\",\n            driver, connString, err.Error())\n        return err\n    }\n    defer db.Close()\n\n    query := \"select SYSDATE from dual\"\n    stmt, err := db.Prepare(query)\n    if err != nil {\n        log.Printf(\"db.Prepare(%s) failed.\\n\\t%s\\n\", query, err.Error())\n        return err\n    }\n    defer stmt.Close()\n\n    rows, err := stmt.Query()\n    if err != nil {\n        log.Printf(\"stmt.Query() failed.\\n\\t%s\\n\", err.Error())\n        return err\n    }\n    defer rows.Close()\n\n    var columns []string\n    columns, err = rows.Columns()\n    if err != nil {\n        log.Printf(\"rows.Columns() failed.\\n\\t%s\\n\", err.Error())\n    }\n    for i, c := range columns {\n        fmt.Printf(\"%3d %s\\n\", i, c)\n    }\n\n    for rows.Next() {\n        var sysdate time.Time\n        err = rows.Scan(&amp;sysdate)\n        if err != nil {\n            log.Printf(\"rows.Scan(...) failed.\\n\\t%s\\n\", err.Error())\n            return err\n        }\n        fmt.Println(\"SYSDATE:\", sysdate)\n    }\n    err = rows.Err()\n    if err != nil {\n        log.Printf(\"rows iteration failed.\\n\\t%s\\n\", err.Error())\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Using Scan is the tricky part as it may not be something Oracle programmers are used to. This function worked for all of the odbc, mgodbc, oci8, adodb and goracle packages that I tried.</p>\n"}], "owner": {"reputation": 628, "user_id": 1888360, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f99d86764a53dac0f46420b6cacd08f9?s=128&d=identicon&r=PG&f=1", "display_name": "Aditya Peshave", "link": "https://stackoverflow.com/users/1888360/aditya-peshave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2893, "favorite_count": 1, "accepted_answer_id": 30112855, "answer_count": 2, "score": 4, "last_activity_date": 1599475479, "creation_date": 1430794458, "last_edit_date": 1495540844, "question_id": 30043488, "link": "https://stackoverflow.com/questions/30043488/connecting-to-oracle-db-in-go", "title": "Connecting to Oracle DB in Go", "body": "<p>I am trying to connect to Oracle DB from Windows (64 bit Go, 32 bit client)</p>\n\n<p>I already reffered <a href=\"https://stackoverflow.com/questions/22217665/how-to-connect-to-oracle-in-go\">this</a> question but I am completely new to Go so I am clueless about the configuration he suggested.</p>\n\n<p>I have installed multiple clients, such as:</p>\n\n<pre><code>1. `code.google.com\\p\\odbc`\n2. `github.com\\mattn\\go-oci8`\n</code></pre>\n\n<p>I tried to create the <code>oci8.pc</code> file but it seems it is wrong.</p>\n\n<pre><code>prefix=/devel/target/1.0\nexec_prefix=${prefix}\nlibdir=C:/oracle/instantclient_12_1/sdk/lib/msvc\nincludedir=C:/oracle/instantclient_12_1/sdk/include\noralib=C:/oracle/instantclient_12_1/sdk/lib/msvc\norainclude=C:/oracle/instantclient_12_1/sdk/include\ngcclib=C:/TDM-GCC-64/lib\ngccinclude=C:/TDM-GCC-64/include\nglib_genmarshal=glib-genmarshal\ngobject_query=gobject-query\nglib_mkenums=glib-mkenums\nName: oci8\nVersion: 12.1\nDescription: oci8 library\nLibs: -L${oralib} -L${gcclib} -loci\nLibs.private:\nCflags: -I${orainclude} -I${gccinclude}\n</code></pre>\n\n<p>When I run the following code, I get error:</p>\n\n<pre><code>// TestDB\npackage main\n\nimport (\n\"github.com/odbc\"\n)\n\nfunc main() {\nconn, _ := odbc.Connect(\"DSN=lnxcepd1db01.XXXXXX.com:51521*CBPDEV;UID=XXXXX;PWD=XXXXX\")\ndefer conn.Close()\n\nstmt, _ := conn.Prepare(\"select * from XXXXX where XXXX = ?\")\ndefer stmt.Close()\n\nstmt.Execute(\"100044\")\nrows, _ := stmt.FetchAll()\nfor i, row := range rows {\nprintln(i, row)\n}\n\n}\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n    panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x8 pc=0x43c3a6]\n\ngoroutine 1 [running]:\ngithub.com/odbc.(*Connection).Close(0x0, 0x45)\n    C:/Go/UDL/src/github.com/odbc/odbc.go:263 +0x26\ngithub.com/odbc.(*Connection).newStmt(0x0, 0x36, 0xc0820120e0)\n    C:/Go/UDL/src/github.com/odbc/odbc.go:152 +0x50\ngithub.com/odbc.(*Connection).Prepare(0x0, 0x51cf70, 0x36, 0x0, 0x0, 0x0, 0xc082005e90, 0x9d6eb0)\n    C:/Go/UDL/src/github.com/odbc/odbc.go:162 +0x51\nmain.main()\n    C:/Go/My Codes/new/TestDB.go:12 +0xc4\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n</code></pre>\n\n<p>Am I missing anything? If anybody can point me into right direction, I will be really greatful. </p>\n\n<p>Thanks in advance.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>After browsing more I changed my code as follows:</p>\n\n<pre><code>// TestDB\npackage main\n\nimport (\n_ \"code.google.com/p/odbc\"\n    \"database/sql\"\n    \"fmt\"\n)\n\nfunc main() {\nfmt.Println(sql.Drivers())\n\ndb, err := sql.Open(\"odbc\",\"DSN=lnxcepd1db01.xxxx.com:51521*CBPDEV;UID=XXXX;PWD=XXXX\")\nif err != nil {\n        panic(err)\n}\n\nrows, err := db.Query(\"select TABLE_NAME from tabs\")\n\nvar TABLE_NAME string \n\ndefer rows.Close()\n    for rows.Next() {\n        fmt.Println(rows.Columns())\n         rows.Scan(&amp;TABLE_NAME)\n     fmt.Println(TABLE_NAME)\n    }\n    err = rows.Err()\n\n    if err != nil {\n        panic(err)\n    }\n\n    defer db.Close()\n\n}\n</code></pre>\n\n<p>The output + error stack:</p>\n\n<pre><code>[odbc]\npanic: runtime error: invalid memory address or nil pointer dereference\n    panic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xc0000005 code=0x0 addr=0x20 pc=0x453408]\n\ngoroutine 1 [running]:\ndatabase/sql.(*Rows).Close(0x0, 0x0, 0x0)\n    c:/go/src/database/sql/sql.go:1659 +0x38\ndatabase/sql.(*Rows).Next(0x0, 0xc082002400)\n    c:/go/src/database/sql/sql.go:1586 +0x2c\nmain.main()\n    C:/Go/My Codes/new/TestDB.go:23 +0x263\n\ngoroutine 2 [runnable]:\nruntime.forcegchelper()\n    c:/go/src/runtime/proc.go:90\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 3 [runnable]:\nruntime.bgsweep()\n    c:/go/src/runtime/mgc0.go:82\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 4 [runnable]:\nruntime.runfinq()\n    c:/go/src/runtime/malloc.go:712\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 5 [runnable]:\ndatabase/sql.(*DB).connectionOpener(0xc08205a000)\n    c:/go/src/database/sql/sql.go:588\ncreated by database/sql.Open\n    c:/go/src/database/sql/sql.go:452 +0x323\n</code></pre>\n\n<p>As you can see, when I am printing the available Drivers, I am getting <code>odbc</code>, I am not sure what I am missing.</p>\n\n<p>I am using this odbc driver. </p>\n\n<p><a href=\"https://code.google.com/p/odbc/wiki/GettingStartedOnWindows\" rel=\"nofollow noreferrer\">https://code.google.com/p/odbc/wiki/GettingStartedOnWindows</a></p>\n\n<p>I noticed 1 thing:</p>\n\n<p>When I use </p>\n\n<pre><code>db, err := sql.Open(\"odbc\", \"DSN=lnxcepd1db01.XXXXX.com:51521;USERID=XXXX;PASSWORD=XXXX;DATABASE=CBPDEV\")\n</code></pre>\n\n<p>I get error as,</p>\n\n<pre><code>%v SQLDriverConnect: {IM002} [Microsoft][ODBC Driver Manager] Data source name not found and no default driver specified\n</code></pre>\n\n<p>When I try,</p>\n\n<pre><code>db, err := sql.Open(\"odbc\", \"DSN=lnxcepd1db01.XXXXXX.com:51521*CBPDEV;UID=XXXX;PWD=XXXXX\")\n</code></pre>\n\n<p>I get error:</p>\n\n<pre><code>SQLDriverConnect: {IM010} [Microsoft][ODBC Driver Manager] Data source name too long\n</code></pre>\n\n<p>And this one as well:</p>\n\n<pre><code>db, err := sql.Open(\"odbc\",\"DSN=lnxcepd1db01.XXXXX.com:51521*cbpdev;UID=XXX;PWD=XXXX\")\n</code></pre>\n\n<p>Error:</p>\n\n<pre><code>SQLDriverConnect: {IM010} [Microsoft][ODBC Driver Manager] Data source name too long\n</code></pre>\n\n<p>I am completely lost as I cannot relate this to a driver issue, my code issue or I am missing some parameters in connection string.</p>\n\n<p><strong>I have the following questions :</strong> </p>\n\n<p><strong>Whats is wrong with my Connection String?\nDoes anyone has a working setup or instructions to be carried out starting from API building (I am sorry but I tried a few but no luck)??\nWhich API is better or easier to use ?</strong> </p>\n"}, {"tags": ["go", "dns", "nslookup"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1430805740, "post_id": 30043248, "comment_id": 48205938, "body": "You can try this library instead: <a href=\"https://github.com/miekg/dns\" rel=\"nofollow noreferrer\">github.com/miekg/dns</a>"}, {"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1430806436, "post_id": 30043248, "comment_id": 48206209, "body": "@Not_a_Golfer   github.com/miekg/dns is too heavy for me."}], "answers": [{"comments": [{"owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 2, "creation_date": 1430813455, "post_id": 30046511, "comment_id": 48210007, "body": "thanks for your advise.  I made a simple <a href=\"https://github.com/holys/nslookup\" rel=\"nofollow noreferrer\">wrapper</a> for <code>nslookup</code> command to suit my case."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "reply_to_user": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "edited": false, "score": 3, "creation_date": 1430818162, "post_id": 30046511, "comment_id": 48213118, "body": "If your concern was overhead, then shelling out to nslookup is likely to be more heavyweight than an in-process DNS library."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 4, "last_activity_date": 1430818060, "last_edit_date": 1430818060, "creation_date": 1430810256, "answer_id": 30046511, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter/30046511#30046511", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p>The <code>net.Lookup*</code> functions provide access to the local resolver.  While many requests will be answered with information from a DNS server, this is not always the case.</p>\n\n<p>For instance, <code>LookupHost</code> may return a name from the <code>/etc/hosts</code> file.  Or it might use mDNS to resolve a <code>.local</code> name.</p>\n\n<p>If you want to talk to an arbitrary DNS server rather than the local resolver, then you should use a general purpose DNS client library.  As suggested in the comments, <a href=\"https://github.com/miekg/dns\" rel=\"nofollow\">https://github.com/miekg/dns</a> might fit your needs.</p>\n"}, {"comments": [{"owner": {"reputation": 1063, "user_id": 2443833, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/lL91m.jpg?s=128&g=1", "display_name": "Langston", "link": "https://stackoverflow.com/users/2443833/langston"}, "edited": false, "score": 0, "creation_date": 1438014434, "post_id": 31627459, "comment_id": 51261494, "body": "Thank you for the example application, that&#39;s very useful."}], "tags": [], "owner": {"reputation": 4875, "user_id": 977939, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/lb34Y.jpg?s=128&g=1", "display_name": "jpillora", "link": "https://stackoverflow.com/users/977939/jpillora"}, "is_accepted": false, "score": 29, "last_activity_date": 1437834385, "creation_date": 1437834385, "answer_id": 31627459, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter/31627459#31627459", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p>@holys</p>\n\n<blockquote>\n  <p>\"github.com/miekg/dns is too heavy for me\"</p>\n</blockquote>\n\n<p>It's not that heavy:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n\n    \"github.com/miekg/dns\"\n)\n\nfunc main() {\n\n    target := \"microsoft.com\"\n    server := \"8.8.8.8\"\n\n    c := dns.Client{}\n    m := dns.Msg{}\n    m.SetQuestion(target+\".\", dns.TypeA)\n    r, t, err := c.Exchange(&amp;m, server+\":53\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Printf(\"Took %v\", t)\n    if len(r.Answer) == 0 {\n        log.Fatal(\"No results\")\n    }\n    for _, ans := range r.Answer {\n        Arecord := ans.(*dns.A)\n        log.Printf(\"%s\", Arecord.A)\n    }\n}\n</code></pre>\n\n<p>When run, you should see:</p>\n\n<pre><code>$ go run dns.go\n2015/07/26 00:24:46 Took 16.138928ms\n2015/07/26 00:24:46 134.170.188.221\n2015/07/26 00:24:46 134.170.185.46\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 13026, "user_id": 2125837, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/760b6ec2b6e1cba2b0218178425f4cde?s=128&d=identicon&r=PG", "display_name": "xpt", "link": "https://stackoverflow.com/users/2125837/xpt"}, "edited": false, "score": 0, "creation_date": 1507414048, "post_id": 32325270, "comment_id": 80201750, "body": "OP said, &quot;<i>github.com/miekg/dns is too heavy for me</i>&quot; but this one, github.com/bogdanovich/dns_resolver, is built <b>on top of</b> miekg/dns, so it is adding another layer, not &quot;<i>simple</i>&quot; at all."}], "tags": [], "owner": {"reputation": 875, "user_id": 1213341, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f8d3dc6ff251858d56451294f2efbbcc?s=128&d=identicon&r=PG", "display_name": "Anton", "link": "https://stackoverflow.com/users/1213341/anton"}, "is_accepted": false, "score": 12, "last_activity_date": 1441092140, "last_edit_date": 1441092140, "creation_date": 1441090268, "answer_id": 32325270, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter/32325270#32325270", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p>@holys</p>\n\n<p>You can use this simple <a href=\"http://github.com/bogdanovich/dns_resolver\" rel=\"noreferrer\">dns_resolver</a> based on miekg/dns </p>\n\n<pre><code>go get github.com/bogdanovich/dns_resolver\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"log\"\n    \"github.com/bogdanovich/dns_resolver\"\n)\n\nfunc main() {\n    resolver := dns_resolver.New([]string{\"8.8.8.8\", \"8.8.4.4\"})\n\n    // In case of i/o timeout\n    resolver.RetryTimes = 5\n\n    ip, err := resolver.LookupHost(\"google.com\")\n    if err != nil {\n        log.Fatal(err.Error())\n    }\n    log.Println(ip)\n    // Output [216.58.192.46]\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 334, "user_id": 1076507, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p1B16.png?s=128&g=1", "display_name": "0x574F4F54", "link": "https://stackoverflow.com/users/1076507/0x574f4f54"}, "edited": false, "score": 1, "creation_date": 1536549828, "post_id": 51839787, "comment_id": 91449097, "body": "I noticed that this can&#39;t be used to bypass the hosts file. If you want to direct-query a DNS server from Go it seems that github.com/miekg/dns is the best bet (as described in other answers)"}, {"owner": {"reputation": 467, "user_id": 9817778, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vyGWg.jpg?s=128&g=1", "display_name": "Time Killer", "link": "https://stackoverflow.com/users/9817778/time-killer"}, "edited": false, "score": 0, "creation_date": 1586040643, "post_id": 51839787, "comment_id": 107980526, "body": "Not on Windows 10?"}], "tags": [], "owner": {"reputation": 448, "user_id": 480673, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f7db33c79f4d18058f12cc4705747b55?s=128&d=identicon&r=PG", "display_name": "Dionysius", "link": "https://stackoverflow.com/users/480673/dionysius"}, "is_accepted": false, "score": 12, "last_activity_date": 1534244520, "last_edit_date": 1534244520, "creation_date": 1534244129, "answer_id": 51839787, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter/51839787#51839787", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p><a href=\"https://github.com/golang/go/issues/19268#issuecomment-345384876\" rel=\"noreferrer\">Since a little while</a> you can set the Dial for the Resolver, where you can define your nameserver in the DialContext</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>var resolver *net.Resolver\n\nif nameserver != \"\" {\n    resolver = &amp;net.Resolver{\n        PreferGo: true,\n        Dial: func(ctx context.Context, network, address string) (net.Conn, error) {\n            d := net.Dialer{}\n            return d.DialContext(ctx, \"udp\", net.JoinHostPort(nameserver, \"53\"))\n        },\n    }\n} else {\n    resolver = net.DefaultResolver\n}\n</code></pre>\n\n<p>After that you can go as you're used to:</p>\n\n<pre><code>ips, err := resolver.LookupIPAddr(context.Background(), \"www.example.com\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4884, "user_id": 1087001, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/8k294.jpg?s=128&g=1", "display_name": "Sam Whited", "link": "https://stackoverflow.com/users/1087001/sam-whited"}, "is_accepted": false, "score": 4, "last_activity_date": 1572966716, "creation_date": 1572966716, "answer_id": 58714269, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter/58714269#58714269", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p>Since Go 1.9 this is possible by overriding the <code>Dial</code> function on a <a href=\"https://golang.org/pkg/net/#Resolver\" rel=\"nofollow noreferrer\"><code>Resolver</code></a>. For example, to ignore the request for the local resolver over UDP and connect to <code>9.9.9.9</code> via TCP we might do something like this:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>r := &amp;net.Resolver{\n    Dial: func(ctx context.Context, _, _ string) (net.Conn, error) {\n        return net.Dial(\"tcp\", \"9.9.9.9\")\n    },\n}\naddrs, err := r.LookupIPAddr(context.TODO(), \"example.net\")\n</code></pre>\n"}], "owner": {"reputation": 11045, "user_id": 1297203, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/b213707b2fdedeacf904335b540f1e8f?s=128&d=identicon&r=PG", "display_name": "holys", "link": "https://stackoverflow.com/users/1297203/holys"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11900, "favorite_count": 6, "answer_count": 5, "score": 22, "last_activity_date": 1572966716, "creation_date": 1430792559, "question_id": 30043248, "link": "https://stackoverflow.com/questions/30043248/why-golang-lookup-function-cant-provide-a-server-parameter", "title": "Why golang Lookup*** function can&#39;t provide a server parameter?", "body": "<p>For <code>nslookup</code> command, it has <code>nslookup somewhere.com some.dns.server</code>. </p>\n\n<p>However, it seems that golang dnsclient only load config from <code>/etc/resolv.conf</code></p>\n\n<p>code here: <a href=\"https://golang.org/src/net/dnsclient_unix.go#L225\" rel=\"noreferrer\">https://golang.org/src/net/dnsclient_unix.go#L225</a></p>\n\n<p>Does the golang  standard  library provide something like \n<code>func LookupTXT(name string, dnsServer string) (txt []string, err error)</code> ?</p>\n\n<p><code>requirement</code>: \n1. Don't change the default <code>/etc/resolv.conf</code>.</p>\n"}, {"tags": ["design-patterns", "go", "refactoring"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1430781565, "post_id": 30041461, "comment_id": 48199139, "body": "Can you explain why <code>c</code> is even passed into <code>SaveChildren</code>? After I convert <code>data1</code> to some binary what use do I have for a channel that I can send the <code>BaseType</code> on? If you&#39;re downcasting these &#39;child types&#39; (there is no inheritance in go so I&#39;m not positive what that means) to the base type then sending the result back on a channel, you&#39;re doing it wrong. Pretty sure you can just define the serialization contract in a way that makes that unnecessary. Even if that isn&#39;t the case I can&#39;t imagine why the channel wouldn&#39;t be of type <code>[]byte</code>."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 4, "creation_date": 1430782237, "post_id": 30041461, "comment_id": 48199305, "body": "In case you&#39;ve overlooked them: I would considering having the objects implement either <a href=\"https://godoc.org/encoding#BinaryMarshaler\" rel=\"nofollow noreferrer\"><code>encoding&#47;BinaryMarshaler</code></a> or <a href=\"https://godoc.org/io#WriterTo\" rel=\"nofollow noreferrer\"><code>io&#47;WriterTo</code></a>. Additionally, you may find <a href=\"https://godoc.org/encoding/gob\" rel=\"nofollow noreferrer\"><code>gob</code></a> useful."}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1430809018, "creation_date": 1430809018, "answer_id": 30046137, "question_id": 30041461, "link": "https://stackoverflow.com/questions/30041461/which-design-pattern-to-use-to-store-streams-of-objects-of-different-types-to-di/30046137#30046137", "title": "Which design pattern to use to store streams of objects of different types to disk in go?", "body": "<p>The gob package seems like a good solution for your problem. There is a great <a href=\"http://blog.golang.org/gobs-of-data\" rel=\"nofollow\">article on the Go blog</a> that explains how and why. A short excerpt:</p>\n\n<blockquote>\n  <p>The gob package was designed with a number of goals in mind.</p>\n  \n  <p>First, and most obvious, it had to be very easy to use. First, because\n  Go has reflection, there is no need for a separate interface\n  definition language or \"protocol compiler\". The data structure itself\n  is all the package should need to figure out how to encode and decode\n  it. On the other hand, this approach means that gobs will never work\n  as well with other languages, but that's OK: gobs are unashamedly\n  Go-centric.</p>\n  \n  <p>Efficiency is also important. Textual representations, exemplified by\n  XML and JSON, are too slow to put at the center of an efficient\n  communications network. A binary encoding is necessary.</p>\n  \n  <p>Gob streams must be self-describing. Each gob stream, read from the\n  beginning, contains sufficient information that the entire stream can\n  be parsed by an agent that knows nothing a priori about its contents.\n  This property means that you will always be able to decode a gob\n  stream stored in a file, even long after you've forgotten what data it\n  represents.</p>\n</blockquote>\n\n<p>Further down the article is an example that shows how easy it is to use and how versatile it is.</p>\n"}], "owner": {"reputation": 1150, "user_id": 1058588, "user_type": "registered", "accept_rate": 29, "profile_image": "https://i.stack.imgur.com/Y6WFK.jpg?s=128&g=1", "display_name": "typedef", "link": "https://stackoverflow.com/users/1058588/typedef"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1430809018, "creation_date": 1430780563, "question_id": 30041461, "link": "https://stackoverflow.com/questions/30041461/which-design-pattern-to-use-to-store-streams-of-objects-of-different-types-to-di", "title": "Which design pattern to use to store streams of objects of different types to disk in go?", "body": "<p>Consider a function that saves streams of objects of different types to disk:</p>\n\n<pre><code>func Save(fill func(c chan BaseType), file string) {}\n</code></pre>\n\n<p>This function is used in the following way throughout the code:</p>\n\n<pre><code>// Here we've got different data structures data1, data2, ...\n// that must be stored to disk\nSave(\n  func(c chan BaseType) {\n    // SaveChildren1 generates objects of type Child1 based\n    // on the data1 data structure\n    SaveChildren1(c, data1) \n  },\n  filename1)\n\nSave(\n  func(c chan BaseType) {\n    // SaveChildren2 generates objects of type Child2 based\n    // on the data2 data structure\n    SaveChildren2(c, data2)\n  },\n  filename2)\n</code></pre>\n\n<p>And so on. There are a lot of different child types and each requires it's own generator -- a function SaveChildren1, SaveChildren2 etc. These functions actually fill the channels with objects.</p>\n\n<p>The question is how would you refactor these \"binders\" -- the functions that transform SaveChildren (a function of 2 args) into a function of 1 argument? Currently this code doesn't look like a well written go-style code.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 1, "creation_date": 1430777014, "post_id": 30040661, "comment_id": 48197506, "body": "Have you tried storing the path from your <code>walker</code> func? That would give you the complete path including the subdirectory and file name. Maybe use a map[string]os.FileInfo to store the path as the key then use that to open the file."}, {"owner": {"reputation": 1370, "user_id": 2895182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f0ec51ba1374938260bf7e9911b18afe?s=128&d=identicon&r=PG&f=1", "display_name": "Rich L", "link": "https://stackoverflow.com/users/2895182/rich-l"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1430777034, "post_id": 30040661, "comment_id": 48197513, "body": "I&#39;m aware that that would give me the full path, and I&#39;d be fine. As I said in the question though, I&#39;m not actually using filepath.Walk, so don&#39;t have the path string at the time."}, {"owner": {"reputation": 1370, "user_id": 2895182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f0ec51ba1374938260bf7e9911b18afe?s=128&d=identicon&r=PG&f=1", "display_name": "Rich L", "link": "https://stackoverflow.com/users/2895182/rich-l"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 2, "creation_date": 1430777248, "post_id": 30040661, "comment_id": 48197598, "body": "The code I actually have uses ioutil.ReadDir and is a lot more ugly than the example here. While I know there is a solution to the higher level problem I have (i.e. walking a directory tree, and storing the paths), my specific question is if I need to do all that refactoring, or if there is a simple way to go from os.FileInfo to an os.File?"}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1430777650, "post_id": 30040661, "comment_id": 48197758, "body": "I&#39;m fairly confident the answer is no but I&#39;m looking around a little to confirm that."}, {"owner": {"reputation": 41100, "user_id": 1938163, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/WV0Fi.png?s=128&g=1", "display_name": "Marco A.", "link": "https://stackoverflow.com/users/1938163/marco-a"}, "edited": false, "score": 0, "creation_date": 1593707616, "post_id": 30040661, "comment_id": 110881184, "body": "Besides there could be multiple paths and the user could only have access to some of them: <a href=\"https://github.com/golang/go/issues/32300#issuecomment-496984069\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/32300#issuecomment-496984069</a>"}], "answers": [{"tags": [], "owner": {"reputation": 24278, "user_id": 6013, "user_type": "registered", "accept_rate": 95, "profile_image": "https://www.gravatar.com/avatar/2c21bed614c58c9e1c48fe272e79efd2?s=128&d=identicon&r=PG", "display_name": "Joshua", "link": "https://stackoverflow.com/users/6013/joshua"}, "is_accepted": false, "score": 4, "last_activity_date": 1430778191, "creation_date": 1430778191, "answer_id": 30041044, "question_id": 30040661, "link": "https://stackoverflow.com/questions/30040661/opening-a-file-from-a-fileinfo/30041044#30041044", "title": "Opening a File from a FileInfo", "body": "<p>No, a file cannot be opened with just the FileInfo. os.Open only takes a string. You should always have the path or the parent path because that is the only way to get a FileInfo.</p>\n"}, {"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 19, "last_activity_date": 1430778380, "creation_date": 1430778380, "answer_id": 30041082, "question_id": 30040661, "link": "https://stackoverflow.com/questions/30040661/opening-a-file-from-a-fileinfo/30041082#30041082", "title": "Opening a File from a FileInfo", "body": "<p>No. The <code>FileInfo</code> interface simply does not expose the path and all provided methods in the <code>os</code> and <code>ioutil</code> packages accept the pathname as a string.</p>\n"}, {"tags": [], "owner": {"reputation": 4356, "user_id": 1115279, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/cafbe4c2176a981eff759177f3c2d6d5?s=128&d=identicon&r=PG&f=1", "display_name": "Dirk", "link": "https://stackoverflow.com/users/1115279/dirk"}, "is_accepted": false, "score": 2, "last_activity_date": 1557814369, "creation_date": 1557814369, "answer_id": 56124038, "question_id": 30040661, "link": "https://stackoverflow.com/questions/30040661/opening-a-file-from-a-fileinfo/56124038#56124038", "title": "Opening a File from a FileInfo", "body": "<p>As additional info, this is how to constructor the filename string including path:</p>\n\n<pre><code>filename := filepath.Join(path, info.Name())\n</code></pre>\n"}], "owner": {"reputation": 1370, "user_id": 2895182, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f0ec51ba1374938260bf7e9911b18afe?s=128&d=identicon&r=PG&f=1", "display_name": "Rich L", "link": "https://stackoverflow.com/users/2895182/rich-l"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16112, "favorite_count": 1, "accepted_answer_id": 30041082, "answer_count": 3, "score": 19, "last_activity_date": 1557814369, "creation_date": 1430776521, "last_edit_date": 1430776856, "question_id": 30040661, "link": "https://stackoverflow.com/questions/30040661/opening-a-file-from-a-fileinfo", "title": "Opening a File from a FileInfo", "body": "<p>In golang, if I have an <code>os.FileInfo</code>, is there any way to open an <code>*os.File</code> from that by itself without the original path?</p>\n\n<p>Let's say I had something like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nvar files []os.FileInfo\n\nfunc walker(path string, info os.FileInfo, err error) error {\n    if strings.HasSuffix(info.Name(), \".txt\") {\n        files = append(files, info)\n    }\n    return nil\n}\n\nfunc main() {\n    err := filepath.Walk(\"/tmp/foo\", walker)\n    if err != nil {\n        println(\"Error\", err)\n    } else {\n        for _, f := range files {\n            println(f.Name())\n            // This is where we'd like to open the file\n        }\n    }\n}\n</code></pre>\n\n<p>Is there a way to convert <code>FileInfo</code> to <code>* File</code>? The code I'm actually working with isn't based on <code>filepath.Walk</code>; but I do get an <code>[]os.FileInfo</code> slice back. I still have the root directory, and the file name, but it seems like any further sub-tree information has gone by this stage. </p>\n"}, {"tags": ["go", "slice"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1430765368, "post_id": 30037515, "comment_id": 48191272, "body": "Not clear what you mean. If you request <code>&#47;rss</code> once it will return all records in your database. Next your request <code>&#47;add</code> and add a record. So if you request <code>&#47;rss</code> once again after adding a record - all records include new one will be returned."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430767369, "post_id": 30037515, "comment_id": 48192442, "body": "You don&#39;t mention where <code>mux.NewRouter</code> comes from, is it <a href=\"https://godoc.org/github.com/gorilla/mux#NewRouter\" rel=\"nofollow noreferrer\">gorilla</a>? You say &quot;storing them in a slice&quot; what is &quot;them&quot;, does it matter or is just opaque objects?"}, {"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430767407, "post_id": 30037515, "comment_id": 48192465, "body": "The problem is when I add a record in my /add function, the added record is not available in the next call of my /rss function. I pass the <code>database</code> to my <code>rest.AddArticle</code> function, but it does not return anything. I think I need to let this function return the new database? @DaveC yes, I&#39;m using Gorilla. You can find my problem here: <a href=\"https://github.com/rogierlommers/go-read/blob/master/go-read.go\" rel=\"nofollow noreferrer\">github.com/rogierlommers/go-read/blob/master/go-read.go</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430767484, "post_id": 30037515, "comment_id": 48192510, "body": "There are likely better ways to do it, but you could just pass <code>&amp;database</code> instead so that you can modify it. However, you need synchronization or you&#39;ll have deadly data races."}, {"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430768640, "post_id": 30037515, "comment_id": 48193190, "body": "@daveC passing a pointer to the <code>database</code> indeed solved my problem. Thanks for that."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430768956, "post_id": 30037515, "comment_id": 48193361, "body": "BTW, I don&#39;t see any synchronization with your changes, use the <a href=\"https://blog.golang.org/race-detector\" rel=\"nofollow noreferrer\">race detector</a> to help identify your races and remove them. There is no such thing as a <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow noreferrer\">benign data race</a> so do not ignore them. Your code also ignores errors in several places (e.g. from <code>os.Create</code>); never do that."}], "answers": [{"comments": [{"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1430812604, "post_id": 30040734, "comment_id": 48209501, "body": "Thanks for your clear answer. It really helps a lot in learning Go! I have fixed my problem by applying your 3rd solution: using a pointer to the <code>database</code>."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 1, "last_activity_date": 1430776842, "creation_date": 1430776842, "answer_id": 30040734, "question_id": 30037515, "link": "https://stackoverflow.com/questions/30037515/adding-element-to-slice-in-handlerfunc-and-return-as-a-whole/30040734#30040734", "title": "Adding element to slice in handlerfunc and return as a whole", "body": "<p>From what I can tell the problem is that you're writing to your db but you're reading from the cached version so the response of rss just doesn't reflect the model at the time the request is made. If you look at this code;</p>\n\n<pre><code>database := model.ReadFileIntoSlice()\n\n// initialise mux router\nr := mux.NewRouter()\n\n// http handles\nr.HandleFunc(\"/add/{base64url}\", rest.AddArticle(database))\n</code></pre>\n\n<p>you somehow need to modify the value of <code>database</code>. There are many ways you could do this. A few options would be 1) define it on some object or at a package level and then directly modify it from wherever <code>AddArticle</code> is defined. 2) refresh your in memory version, ie before you return the results, read from the db again so you're assured to have the latest (obv performance implications) 3) don't pass <code>database</code> by value, make the argument a pointer instead. <code>AddArticle</code> is getting a copy of <code>database</code> rather than the address to the version you're reading from in your rss call. You could instead pass a pointer into that method so that the original copy is modified (it also performs substantially better as your model gets larger).</p>\n\n<p>Based on the simplicity of your program I'd probably do 3. Realistically 2 is a more robust solution and serious enterprise software probably would require something more along those lines (your model doesn't work if your app is load balanced or something like that).</p>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 30040734, "answer_count": 1, "score": 0, "last_activity_date": 1430776842, "creation_date": 1430764741, "last_edit_date": 1430765078, "question_id": 30037515, "link": "https://stackoverflow.com/questions/30037515/adding-element-to-slice-in-handlerfunc-and-return-as-a-whole", "title": "Adding element to slice in handlerfunc and return as a whole", "body": "<p>I'm writing a service to learn Go. My main function can be found below. It starts with reading an XML file and storing them in a slice. I have a <code>/rss</code> endpoint which outputs a RSS feed from the items stored in the \"database\". This is working fine. I also have an endpoint (<code>/add/{base64}</code>) which is used to add a new item to that slice. Unfortunately I don't know how to do this. For some reason I need to return the new <code>database</code> with the added record, so it gets available to the <code>/rss</code>. But how?</p>\n\n<p>My concrete problem is:</p>\n\n<ol>\n<li>I know how to add a record to <code>database</code></li>\n<li><p>But I don't know how to return the full (including the added) database so the <code>/rss</code> endpoint is able to use it. So I want to let the <code>rest.AddArticle</code> return the new database so the <code>/rss</code> endpoint knows the added item.</p>\n\n<pre><code>func main() {\ndefer glog.Flush()\n\n// read database\ndatabase := model.ReadFileIntoSlice()\n\n// initialise mux router\nr := mux.NewRouter()\n\n// http handles\nr.HandleFunc(\"/add/{base64url}\", rest.AddArticle(database))\nr.HandleFunc(\"/rss\", rest.GenerateRSS(database))\n\n// start server\nhttp.Handle(\"/\", r)\nglog.Infof(\"running on port %d\", *port)\nhttp.ListenAndServe(\":\"+strconv.Itoa(*port), nil)\n}\n</code></pre></li>\n</ol>\n\n<p>Or is there some other solution which does the job? I just want <code>database</code> to be available through all packages.</p>\n"}, {"tags": ["mysql", "database", "go", "scope"], "comments": [{"owner": {"reputation": 612, "user_id": 1943062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3236c8cffb50c09f4e9cf91c5c781df8?s=128&d=identicon&r=PG", "display_name": "semicircle21", "link": "https://stackoverflow.com/users/1943062/semicircle21"}, "edited": false, "score": 0, "creation_date": 1430755325, "post_id": 30034384, "comment_id": 48185253, "body": "<code>db, dberr = ...</code> and make <code>dberr</code> a global variable ?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430762347, "post_id": 30034384, "comment_id": 48189380, "body": "See related <a href=\"https://stackoverflow.com/questions/28284138/go-global-variable-and-short-variable-definition\">Go global variable and short variable definition</a>"}, {"owner": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "edited": false, "score": 0, "creation_date": 1430779327, "post_id": 30034384, "comment_id": 48198353, "body": "Thanks guys, yup.. handling the variables globally is something I&#39;ve got to get used to have years of avoiding! Thanks!"}], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "edited": false, "score": 0, "creation_date": 1430778727, "post_id": 30035048, "comment_id": 48198141, "body": "Yes, this works thanks Lander. I&#39;ll make sure to hold onto scope properly!"}, {"owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "reply_to_user": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "edited": false, "score": 0, "creation_date": 1430801676, "post_id": 30035048, "comment_id": 48204390, "body": "@freya19 Glad to hear! Also check out the <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a> document which may help you a little bit in your design process (e.g. using <code>func (u *types.User) Save()</code> so you can call <code>user.Save()</code> instead of <code>SaveUser(user)</code>)."}, {"owner": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "edited": false, "score": 0, "creation_date": 1430850691, "post_id": 30035048, "comment_id": 48236264, "body": "Thanks Lander! Will check it out. Thanks for suggesting."}], "tags": [], "owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "is_accepted": true, "score": 4, "last_activity_date": 1430756882, "creation_date": 1430756882, "answer_id": 30035048, "question_id": 30034384, "link": "https://stackoverflow.com/questions/30034384/golang-losing-scope-in-database/30035048#30035048", "title": "GoLang: Losing scope in database", "body": "<p>I think that your problem is that <code>db</code> in the <code>Connect()</code> scope is <a href=\"https://golang.org/doc/go1#shadowing\" rel=\"nofollow\">shadowed</a> due to your use of the <code>:=</code> operator. If you change your method to declare a <code>dberr</code> var:</p>\n\n<pre><code>func Connect() {\n    var dberr error\n    db, dberr = sql.Open(\u201c&lt;CONNECTION_STRING&gt;\u201c)\n\n    if dberr != nil {\n        fmt.Println(dberr)\n    }\n}\n</code></pre>\n\n<p>Your code will work as intended</p>\n"}, {"comments": [{"owner": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "edited": false, "score": 0, "creation_date": 1430778799, "post_id": 30035474, "comment_id": 48198158, "body": "Awesome, thanks IamNaN. I&#39;ll be careful about handing the connections and use defer once I have them in scope correctly. :)"}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1430758179, "last_edit_date": 1592644375, "creation_date": 1430758179, "answer_id": 30035474, "question_id": 30034384, "link": "https://stackoverflow.com/questions/30034384/golang-losing-scope-in-database/30035474#30035474", "title": "GoLang: Losing scope in database", "body": "<p>As noted by @Lander your out-of-scope happens because you are creating a local variable db through the <code>db, err :=</code> assignment which then goes out of scope when the Connect func returns.</p>\n<p>Generally on the use of sql.DB</p>\n<p>From the <a href=\"http://golang.org/pkg/database/sql/#DB\" rel=\"nofollow noreferrer\">database/sql package</a>:</p>\n<blockquote>\n<p>DB is a database handle representing a pool of zero or more underlying connections. It's safe for concurrent use by multiple goroutines.</p>\n<p>The sql package creates and frees connections automatically; it also maintains a free pool of idle connections.</p>\n</blockquote>\n<p>and</p>\n<blockquote>\n<p>The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.</p>\n</blockquote>\n<p>That said you want to open the connection once and then keep it open for the duration of the process. With that the only reliable way to actually close it when you are done (or run into a fatal or panic) would be to do the idiomatic go <code>defer db.Close()</code> right after opening it which would need to be done in the main function.</p>\n<p>You could still keep your Connect function in your package and also use it to initialize the global package variable db, but call it from main once and return *sql.DB to main so you can defer db.Close().</p>\n"}], "owner": {"reputation": 43, "user_id": 4862909, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2557b1c700110353791f9e18ee3eeb9f?s=128&d=identicon&r=PG&f=1", "display_name": "freya19", "link": "https://stackoverflow.com/users/4862909/freya19"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 423, "favorite_count": 0, "accepted_answer_id": 30035048, "answer_count": 2, "score": 2, "last_activity_date": 1430758602, "creation_date": 1430754723, "last_edit_date": 1430758602, "question_id": 30034384, "link": "https://stackoverflow.com/questions/30034384/golang-losing-scope-in-database", "title": "GoLang: Losing scope in database", "body": "<p>New to Go, come from .Net-land so bear with me... Would love some guidance on architecting my Go app specifically with regard to managing and reusing DB connections.</p>\n\n<p>I have split up my db code into a package to allow for db-lookups into package that handles sql lookups like a repository layer. I want to have flexibility to decouple my db layer from my app services, so I can easily replace my database if necessary. </p>\n\n<p>Basically I am looking for some guidance on how and when to handle sql connect and holding a sql.DB pointer in the app. Do I need to hold onto a global pointer in main.go or can I manage the connection in my mysql package? </p>\n\n<p>Here's my code: </p>\n\n<pre><code>package mysqlstorage\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"types\"\n)\n\nvar db *sql.DB\n\nfunc Connect() {\n    db, dberr := sql.Open(\u201c&lt;CONNECTION_STRING&gt;\u201c)\n\n    if dberr != nil {\n        fmt.Println(dberr)\n    }\n}\n\nfunc SaveUser(u types.User) {\n    // use db here! \n    ....\n}\n\nfunc GetUser(id string) types.User {\n    // use db here!\n    ....\n}\n</code></pre>\n\n<p>On running my main.go and using my userservices package to attempt to save a user, I hit a problem where I appear to lose scope of my pointer:- </p>\n\n<pre><code>2015/05/03 17:49:08 http: panic serving [::1]:50106: runtime error: invalid memory address or nil pointer dereference goroutine 7 [running]: net/http.func\u00b7011() \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1130 +0xbb database/sql.(*DB).conn(0x0, 0x10, 0x0, 0x0)   \n/usr/local/Cellar/go/1.4.2/libexec/src/database/sql/sql.go:634 +0x7ae database/sql.(*DB).Ping(0x0, 0x0, 0x0)    \n/usr/local/Cellar/go/1.4.2/libexec/src/database/sql/sql.go:462 +0x3a mysqlstorage.SaveUser(0x0, 0xc20805425a, 0x7, 0xc208054280, 0x11, 0xc208054268, 0x6, 0xc208054274, 0x5)    \n/Users/&lt;USERNAME&gt;/Desktop/go/&lt;APPNAME&gt;/api/src/mysqlstorage/mysqlstorage.go:24\n    +0x35 services.CreateUser(0x57c148, 0xc2080563c0, 0xc2080329c0)     \n/Users/&lt;USERNAME&gt;/Desktop/go/&lt;APPNAME&gt;/api/src/services/userservices.go:30\n    +0x398 net/http.HandlerFunc.ServeHTTP(0x3d02a0, 0x57c148, 0xc2080563c0, 0xc2080329c0)   \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1265 +0x41 github.com/gorilla/mux.(*Router).ServeHTTP(0xc20803c140, 0x57c148, 0xc2080563c0, 0xc2080329c0)     \n/Users/&lt;USERNAME&gt;/Desktop/go/&lt;APPNAME&gt;/api/src/github.com/gorilla/mux/mux.go:98\n    +0x297 net/http.(*ServeMux).ServeHTTP(0xc20803a720, 0x57c148, 0xc2080563c0, 0xc2080329c0)   \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1541 +0x17d net/http.serverHandler.ServeHTTP(0xc2080543c0, 0x57c148, 0xc2080563c0, 0xc2080329c0)  \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1703 +0x19a net/http.(*conn).serve(0xc208056320)  \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1204 +0xb57 created by net/http.(*Server).Serve   \n/usr/local/Cellar/go/1.4.2/libexec/src/net/http/server.go:1751 +0x35e\n</code></pre>\n\n<p>Any guidance would appreciated! Thanks guys!</p>\n"}, {"tags": ["html", "go", "martini"], "comments": [{"owner": {"reputation": 4530, "user_id": 2361497, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/ce788c4eb1189394cfe46a6e40a4dd11?s=128&d=identicon&r=PG", "display_name": "Vitaly Isaev", "link": "https://stackoverflow.com/users/2361497/vitaly-isaev"}, "edited": false, "score": 0, "creation_date": 1430845752, "post_id": 30033170, "comment_id": 48233077, "body": "please show place in your code where you&#39;re accessing your templates"}, {"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1430958952, "post_id": 30033170, "comment_id": 48292877, "body": "See here - <a href=\"http://elithrar.github.io/article/approximating-html-template-inheritance/\" rel=\"nofollow noreferrer\">elithrar.github.io/article/&hellip;</a> - you can define &quot;optional&quot; blocks in your templates by ``{{ define XXX }}` them in your base content, but leaving them empty."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 0, "last_activity_date": 1430958191, "creation_date": 1430958191, "answer_id": 30089883, "question_id": 30033170, "link": "https://stackoverflow.com/questions/30033170/golang-martini-code-block/30089883#30089883", "title": "Golang &amp; Martini code block", "body": "<p>I know it's counterintuitive, but for performance reasons it's better to bundle all of your javascript into a few files and include them on every page.</p>\n\n<p>But if you still want to do this, there are two ways you can solve the problem:</p>\n\n<ol>\n<li><p>Give the other <code>footer_extra</code> a different name and then reference it explicitly in your template:</p>\n\n<pre><code>&lt;script src=\"jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"scripts.min.js\"&gt;&lt;/script&gt;\n{{ admin_footer_extra }}\n</code></pre></li>\n<li><p>Make the footer part of the data you send to the template:</p>\n\n<pre><code>var buf bytes.Buffer\n// or ParseFiles if that's how you're reading these\ntpl := template.Must(template.New(\"\").Parse(tpls))\n// render the footer\ntpl.ExecuteTemplate(&amp;buf, \"footer_extra\", nil)\nfooter := buf.String()\nbuf.Reset()\n// send the footer to the main template\ntpl.ExecuteTemplate(&amp;buf, \"index\", map[string]interface{}{\n    \"Footer\": template.HTML(footer), \n                    //  ^   this makes it so go won't escape &lt; &amp; &gt;\n})\n</code></pre>\n\n<p>Then your template will just have:</p>\n\n<pre><code>{{define \"page1\"}}\n  {{.Footer}}\n{{end}}\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 1150, "user_id": 1988272, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/MKKR5.jpg?s=128&g=1", "display_name": "codingninja", "link": "https://stackoverflow.com/users/1988272/codingninja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 292, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430958191, "creation_date": 1430751038, "question_id": 30033170, "link": "https://stackoverflow.com/questions/30033170/golang-martini-code-block", "title": "Golang &amp; Martini code block", "body": "<p>I am trying to define code blocks that will get injected in the base template if they are defined. I don't want to include all the scripts that are required on one page onto another that doesn't require it.</p>\n\n<p>I am using:</p>\n\n<pre><code>\"github.com/go-martini/martini\"\n\"github.com/martini-contrib/binding\"\n\"github.com/martini-contrib/render\"\n</code></pre>\n\n<p>Basically what im trying to do is something like:</p>\n\n<p>on the layout: <code>admin.tmpl</code>:</p>\n\n<pre><code>&lt;script src=\"jquery.min.js\"&gt;&lt;/script&gt;\n&lt;script src=\"scripts.min.js\"&gt;&lt;/script&gt;\n{{ footer_extra }}\n</code></pre>\n\n<p>and on <code>new.tmpl</code>:</p>\n\n<pre><code>{{define \"footer_extra\"}}\n  &lt;!-- scripts just for this page --&gt;\n  &lt;script src=\"script-1.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"script-2.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"script-3.js\"&gt;&lt;/script&gt;\n{{end}}\n</code></pre>\n\n<p>It seemed to work when I used template instead.</p>\n\n<p>But I noticed that I can't define more than one template, which kinda defeats what I'm trying to achieve.</p>\n\n<p><code>index.tmpl</code></p>\n\n<pre><code>{{define \"footer_extra\"}}\n  &lt;!-- scripts just for this page --&gt;\n  &lt;script src=\"script-1.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"script-2.js\"&gt;&lt;/script&gt;\n{{end}}\n</code></pre>\n\n<p><code>new.tmpl</code></p>\n\n<pre><code>{{define \"footer_extra\"}}\n  &lt;!-- scripts just for this page --&gt;\n  &lt;script src=\"script-3.js\"&gt;&lt;/script&gt;\n  &lt;script src=\"script-4.js\"&gt;&lt;/script&gt;\n{{end}}\n</code></pre>\n\n<p><code>layout.tmpl</code></p>\n\n<pre><code>&lt;script src=\"main.js\"&gt;&lt;/script&gt;\n{{template \"footer_extra\"}}\n</code></pre>\n\n<p>will throw a <code>PANIC</code>\n<code>template: redefinition of template \"footer_extra\"</code></p>\n"}, {"tags": ["rest", "go", "office365"], "comments": [{"owner": {"reputation": 15641, "user_id": 3307985, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Bvlg9.jpg?s=128&g=1", "display_name": "Jason Johnston", "link": "https://stackoverflow.com/users/3307985/jason-johnston"}, "edited": false, "score": 0, "creation_date": 1430751370, "post_id": 30032241, "comment_id": 48182575, "body": "Just to be sure, the tenant ID you use for the request is the same as the tenant ID you use to build the aud parameter in the assertion, correct? And it is the tenant ID of the admin that is logging in to consent, not your tenant ID?"}], "owner": {"reputation": 95, "user_id": 4540462, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/14bf078b1e197e17779e63518d2c3fc4?s=128&d=identicon&r=PG&f=1", "display_name": "Aishwarya Gopalakrishnan", "link": "https://stackoverflow.com/users/4540462/aishwarya-gopalakrishnan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 572, "favorite_count": 1, "answer_count": 0, "score": 2, "last_activity_date": 1430748904, "creation_date": 1430748522, "last_edit_date": 1430748904, "question_id": 30032241, "link": "https://stackoverflow.com/questions/30032241/couldnot-get-access-token-for-daemon-applications-office-365", "title": "couldnot get access token for daemon applications office 365", "body": "<p>I have followed the blog <a href=\"http://blogs.msdn.com/b/exchangedev/archive/2015/01/22/building-demon-or-service-apps-with-office-365-mail-calendar-and-contacts-apis-oauth2-client-credential-flow.aspx\" rel=\"nofollow\">http://blogs.msdn.com/b/exchangedev/archive/2015/01/22/building-demon-or-service-apps-with-office-365-mail-calendar-and-contacts-apis-oauth2-client-credential-flow.aspx</a> to create a daemon application . I am able to get the app only token for the domain in which i have registered the application . But when I try to get for other organizations it throws an error \n\"</p>\n\n<pre><code>{\"error\":\"invalid_client\",\"error_description\":\"AADSTS70002: Error validating cre\ndentials. AADSTS50012: Client assertion audience claim does not match Realm issu\ner.\\r\\nTrace ID: 09e025f5-7db9-46c3-9df9-574c6820a011\\r\\nCorrelation ID: f4d0fa5\n7-ee8c-4443-b28b-d372d945f81f\\r\\nTimestamp: 2015-05-04 13:51:51Z\",\"error_codes\":\n[70002,50012],\"timestamp\":\"2015-05-04 13:51:51Z\",\"trace_id\":\"09e025f5-7db9-46c3-\n9df9-574c6820a011\",\"correlation_id\":\"f4d0fa57-ee8c-4443-b28b-d372d945f81f\",\"subm\nit_url\":null,\"context\":null}\"\n</code></pre>\n\n<p>But i have configured the application to be multi tenant . </p>\n\n<p>this is the request i make </p>\n\n<pre><code>request https://login.windows.net/&lt;tenantId&gt;/oauth2/to\nken\ngrant_type=client_credentials\nredirect_uri=http://localhost.com:9000\nresource=https://outlook.office365.com/\nclient_assertion_type =urn:ietf:params:oauth:client-assertion-type:jwt-bearer\nclient_assertion=\"eyJhbGciOiJSUzI1NiIsIng1dCI6IjZlLzEra01scHhuTHArZFJ4d1BqS21EdmZCQT0ifQ.eyJhdWQiOiJodHRwczovL2xvZ2luLndpbmRvd3MubmV0L2ZmNjQxNTFmLTIwM2EtNGM0MC1hZDcxLTExOTE2YjY2Yzg3My9vYXV0aDIvdG9rZW4iLCJleHAiOjE0MzEwMDYzMDMsImlzcyI6ImFkMTkzY2I1LWU2NmUtNDdmNS1iMTc4LTQxM2NlODA3ZDg2YiIsImp0aSI6IjMyMDZiYWI5LTVmYmUtNDA3ZS02OWY2LTJlNGRjNDQ3NzQxYSIsIm5iZiI6MTQzMTAxMTMwMywic3ViIjoiYWQxOTNjYjUtZTY2ZS00N2Y1LWIxNzgtNDEzY2U4MDdkODZiIn0.eEOlhsl-vbdzIiV3AfGFOH187Yb8zpGSGm6RbMhDX4NRJbwOWjJr3eFK3rGXSkl1vhSfJ_oFc69pB1AGfUK8u_SWRl7U3GgH3EJryE-FiVluCQ-ONZ3Qj1u6VggXgTodi0bdvhQF4WlwazXmJGbpeVRUZBm2rlTcd8JtQY96sOu1CRDpZJOFnHzjqleVdrnw8_pNVUafwlnaosRT9tOIgiK9apjN_KY5JMM1QTYKhKk5ZApjmr8agTZpObdz-_Y9znjaSxQcYkFnQeCGc-qwISzH1OqG_7JbCDq6Dp1-oBU5sJneJaF6IxX8-sWyaju3ntMWQyINeuHnRCoPrlp2tg\"\n</code></pre>\n\n<p>this is the assertion i create </p>\n\n<pre><code>token.Header[\"alg\"] = \"RS256\"\n    token.Header[\"x5t\"] = \"thumbprint of certificate \"\n    token.Claims[\"aud\"] = \"https://login.windows.net/\" + TenantId + \"/oauth2/token\"\n    token.Claims[\"exp\"] = time.Now().Add(time.Hour * 72).Unix()\n    token.Claims[\"iss\"] = client_id\n    token.Claims[\"jti\"] = some guid \n    token.Claims[\"nbf\"] = (time.Now().Add(time.Hour * 72).Unix()) + 5000\n    token.Claims[\"sub\"] = client_id\n</code></pre>\n\n<p>please let me what to be done so that i can get the access token for other organiztion's domain .\nThanks in advance </p>\n"}, {"tags": ["go", "circular-dependency"], "comments": [{"owner": {"reputation": 5164, "user_id": 1461269, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/f5507a725df760d1a9b0dd88505f8bd1?s=128&d=identicon&r=PG", "display_name": "arjabbar", "link": "https://stackoverflow.com/users/1461269/arjabbar"}, "edited": false, "score": 2, "creation_date": 1430747431, "post_id": 30029502, "comment_id": 48179952, "body": "Sounds like those 2 things need to be in the same package since they&#39;re so dependent on one another."}, {"owner": {"reputation": 612, "user_id": 1943062, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3236c8cffb50c09f4e9cf91c5c781df8?s=128&d=identicon&r=PG", "display_name": "semicircle21", "link": "https://stackoverflow.com/users/1943062/semicircle21"}, "edited": false, "score": 1, "creation_date": 1430748077, "post_id": 30029502, "comment_id": 48180374, "body": "maybe: 1. in Modifier package, define a IGame interface describes what the modifier needs from Game 2. when Game initiates Modifier, pass the Game as IGame to the Modifier."}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 0, "last_activity_date": 1430758344, "creation_date": 1430758344, "answer_id": 30035525, "question_id": 30029502, "link": "https://stackoverflow.com/questions/30029502/circular-import-with-structs/30035525#30035525", "title": "Circular import with structs", "body": "<p>Normally if package <code>B</code> has code that directly reads/modifies <code>A.Type</code> then that code should be in package <code>A</code>.\nAt least the parts of it if that need direct access should.</p>\n\n<p>To split something between separate packages <code>A</code> and <code>B</code> you'd normal try to isolate an API for access to <code>A.Type</code> that can be expressed as an interface. Then <code>B</code> would define and use this interface and <code>A.Type</code> would implement it (implicitly, without needing to include B's definition of it).</p>\n\n<p>Then something (possibly <code>A</code>, possibily a separate package) would use <code>B</code> by passing an <code>A.Type</code> or <code>*A.Type</code> value as appropriate.</p>\n\n<p>Or depending on your design the relationship could be reversed, with <code>B.OtherType</code> implicitly implementing an interface defined and used by <code>A</code>.\nOr both <code>A</code> and <code>B</code> could use each other only through interfaces; it all depends on the details.</p>\n\n<p>E.g. perhaps something like:</p>\n\n<pre><code>package Game // \"A\"\n\ntype State struct {\n        data int // etc\n}\n\nfunc (s State) IsValid() bool          { return true }\nfunc (s *State) ChangeY(arg int) error { return nil }\n// \u2026etc\u2026\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>package Modifier // \"B\"\n\ntype GameState interface {\n        IsValid() bool\n        ChangeY(int) error\n}\n\ntype M struct {\n        s GameState\n        //\u2026\n}\n\nfunc New(s GameState) *M {\n        return &amp;M{s: s}\n}\n\nfunc (m M) DoSomething() {\n        if s.IsValid() {\n                // \u2026\n        }\n        s.ChangeY(42)\n        // \u2026etc\u2026\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": false, "score": 0, "last_activity_date": 1430759253, "creation_date": 1430759253, "answer_id": 30035825, "question_id": 30029502, "link": "https://stackoverflow.com/questions/30029502/circular-import-with-structs/30035825#30035825", "title": "Circular import with structs", "body": "<p>I'd define type(Game in this case) and all its methods in same one package. You can't even define methods on type imported from another package according to language <a href=\"http://golang.org/ref/spec#Method_declarations\" rel=\"nofollow\">spec</a>,</p>\n\n<pre><code>//you should first do \ntype MyPackageType ImportedType\n//and only then\nfunc (foo MyPackageType) Modify() {\n...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1517476834, "post_id": 30036118, "comment_id": 84113932, "body": "So, it means i have to separate <code>interface</code> to other file and inport it?"}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "reply_to_user": {"reputation": 3258, "user_id": 1085848, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/86a0ff3564f750b3ed49cfc8b57f1275?s=128&d=identicon&r=PG", "display_name": "TomSawyer", "link": "https://stackoverflow.com/users/1085848/tomsawyer"}, "edited": false, "score": 0, "creation_date": 1517834933, "post_id": 30036118, "comment_id": 84242306, "body": "Interfaces in Go don&#39;t have to be explicit. Merely implementing the methods will be sufficient to implement the interface."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 3, "last_activity_date": 1430760225, "creation_date": 1430760225, "answer_id": 30036118, "question_id": 30029502, "link": "https://stackoverflow.com/questions/30029502/circular-import-with-structs/30036118#30036118", "title": "Circular import with structs", "body": "<p>With the 3rd package option:</p>\n\n<pre><code>yourgame/\n  state/\n    state.go\n  modifier/\n    modifier.go\n  main.go\n</code></pre>\n\n<p><code>main.go</code> would glue the two components together:</p>\n\n<pre><code>import \"yourgame/state\"\nimport \"yourgame/modifier\"\n\ntype Game struct {\n    state    state.State\n    modifier modifier.Modifier\n}\n\nfunc main() {\n    // something like: \n    var game Game\n    game.modifier.Modify(game.state)\n}\n</code></pre>\n\n<p>This approach is probably too tightly coupled though. Rather than manipulating an essentially global state object, I would try to slice up the data into just what you need for the modifier.</p>\n\n<p>Reasoning in the abstract is hard, so here's a concrete example of what I mean. In your game:</p>\n\n<pre><code>type Object struct {\n    ID, X, Y int\n    // more data here\n}\ntype Game struct {\n    Objects map[int]*Object\n}\n</code></pre>\n\n<p>In your \"modifier\", let's suppose we had an AI module that moves an object. If all he cares about is the position of a single object you can create an interface:</p>\n\n<pre><code>// in yourgame/modifier\ntype Object interface {\n    GetCoordinates() (int, int)\n    SetCoordinates(int, int)\n}\ntype Modifier struct {}\nfunc (m *Modifier) Update(obj Object) { }\n</code></pre>\n\n<p>Then we just have to add those methods to our original Object:</p>\n\n<pre><code>type (obj *Object) GetCoordinates() (int, int) {\n    return obj.X, obj.Y\n}\ntype (obj *Object) SetCoordinates(x, y int) {\n    obj.X, obj.Y = x, y\n}\n</code></pre>\n\n<p>And now you can pass objects to your modifier without needing a cyclic dependency.</p>\n\n<p>Now if it turns out your \"modifier\" interface ends up looking almost exactly the same as your game object, then a 3rd package of structs is probably reasonable so you aren't always repeating yourself. For an example consider <code>net/url</code>. </p>\n"}], "owner": {"reputation": 4687, "user_id": 1221132, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/a5046ae2fcac22bc44c6663a121f0cc8?s=128&d=identicon&r=PG", "display_name": "theva", "link": "https://stackoverflow.com/users/1221132/theva"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15488, "favorite_count": 5, "closed_date": 1431161001, "answer_count": 3, "score": 12, "last_activity_date": 1609148011, "creation_date": 1430740468, "last_edit_date": 1609148011, "question_id": 30029502, "link": "https://stackoverflow.com/questions/30029502/circular-import-with-structs", "closed_reason": "Duplicate", "title": "Circular import with structs", "body": "<p>I have a project with several modules in Go. I am having problem with circular imports because of the scenario below:</p>\n<h1>Details</h1>\n<p>A module Game contains a struct with the current Game state. Another module (Modifier) is doing some game specific stuff and calculations and therefore modifies the game state. Because of this, Modifier will need the struct Game, but not any methods from Game. Modifier is called from Game and here we have the circular import.</p>\n<h1>Problem:</h1>\n<ul>\n<li><p>Game initiates Modifier</p>\n</li>\n<li><p>Modifier needs Game struct</p>\n</li>\n</ul>\n<p>It seems to me that this is a common scenario, so I wonder how I should solve it in the best way. My solution would be to create a third module &quot;Structs&quot; which just contains all the structs for the whole application. Is this a good solution?</p>\n"}, {"tags": ["javascript", "sockets", "google-app-engine", "go", "channel-api"], "comments": [{"owner": {"reputation": 70403, "user_id": 29809, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/943a45958eb537b816a95920fb0be24c?s=128&d=identicon&r=PG", "display_name": "R Samuel Klatchko", "link": "https://stackoverflow.com/users/29809/r-samuel-klatchko"}, "edited": false, "score": 0, "creation_date": 1430756939, "post_id": 30029248, "comment_id": 48186197, "body": "If the client is generating data, you can <a href=\"http://stackoverflow.com/questions/692196/post-request-javascript\">POST</a> the data and the server can handle it with a standard handler."}, {"owner": {"reputation": 8978, "user_id": 1351600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/2noZs.jpg?s=128&g=1", "display_name": "Paul Collingwood", "link": "https://stackoverflow.com/users/1351600/paul-collingwood"}, "edited": false, "score": 0, "creation_date": 1430756961, "post_id": 30029248, "comment_id": 48186215, "body": "with the channel API data is sent from the client to the server by POSTs (or whatever) in any case, so it would not really help. Sockets are not really available on GAE unless you use a VM flavour."}, {"owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "edited": false, "score": 0, "creation_date": 1431076104, "post_id": 30029248, "comment_id": 48349898, "body": "Thanks for the comment. I finally solved with a simple POST method implemented in AJAX:"}], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "is_accepted": false, "score": 0, "last_activity_date": 1431090014, "creation_date": 1431090014, "answer_id": 30124540, "question_id": 30029248, "link": "https://stackoverflow.com/questions/30029248/gae-channel-api-vs-socket/30124540#30124540", "title": "GAE Channel Api vs Socket", "body": "<p>Maybe this could be useful to someone so here is the way I did that:</p>\n\n<pre><code>saveData : function saveData() {\n      var _this = this,\n          save = this.shadowRoot.querySelector('#save-data'),\n          subData = JSON.stringify(_this.app.userSession);\n\n      save.url=\"url\";\n      save.body = subData;\n      save.go();\n    }\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1431090014, "creation_date": 1430739649, "question_id": 30029248, "link": "https://stackoverflow.com/questions/30029248/gae-channel-api-vs-socket", "title": "GAE Channel Api vs Socket", "body": "<p>I have a Google app that runs using GO on the server side and Javascript on the client side. The client generate every certain timestep a javascript object (that could be \"stringified\") that needs to be sent back to the server and saved as json file. Based on the google app engine documentation it seems that this could achieved with both: </p>\n\n<ol>\n<li>channel api </li>\n<li>socket service</li>\n</ol>\n\n<p>but I couldn't find any examples for both of these and also it is not clear to me which one is the best to accomplish the goal. Can anyone help me?\nThanks a lot.</p>\n"}, {"tags": ["shell", "go", "command-line-interface"], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 0, "last_activity_date": 1430739418, "creation_date": 1430739418, "answer_id": 30029179, "question_id": 30027288, "link": "https://stackoverflow.com/questions/30027288/go-support-for-building-cli-tools-using-native-system-shell/30029179#30029179", "title": "GO support for building CLI tools using native system shell", "body": "<p><code>curl</code> has an interesting implementation in Go with <a href=\"https://github.com/astaxie/bat\" rel=\"nofollow\"><code>astaxie/bat</code></a></p>\n\n<blockquote>\n  <p>Go implemented CLI cURL-like tool for humans. Bat can be used for testing, debugging, and generally interacting with HTTP servers.</p>\n</blockquote>\n\n<p>That means you needs to implement your REST server in order for any curl-like tool to interact with it.<br>\nSee for instance \"<a href=\"http://thenewstack.io/make-a-restful-json-api-go/\" rel=\"nofollow\">Making a RESTful JSON API in Go</a>\".</p>\n"}], "owner": {"reputation": 35, "user_id": 4582060, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-g3EpqKVpOWA/AAAAAAAAAAI/AAAAAAAAAJ0/CiXxqnWaJx8/photo.jpg?sz=128", "display_name": "Fathima", "link": "https://stackoverflow.com/users/4582060/fathima"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 1, "closed_date": 1430739451, "accepted_answer_id": 30029179, "answer_count": 1, "score": -3, "last_activity_date": 1430739418, "creation_date": 1430733463, "last_edit_date": 1430733771, "question_id": 30027288, "link": "https://stackoverflow.com/questions/30027288/go-support-for-building-cli-tools-using-native-system-shell", "closed_reason": "Needs details or clarity", "title": "GO support for building CLI tools using native system shell", "body": "<p>I am planning to use GO to build a CLI tool executed in native system shell rather than a separate shell.\nWhat packages for GO can be used for this purpose other than codegangsta/cli ?</p>\n\n<p>Additionally,\nIs there any package to get REST API call support (such as curl)\nin GO? </p>\n"}, {"tags": ["string", "go", "unicode", "zip"], "answers": [{"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 1, "creation_date": 1564409221, "post_id": 30028491, "comment_id": 101010816, "body": "Note: this flag is added automatically since Go 1.10 if you use UTF-8 characters; see the <code>NonUFT8</code>  flag in <a href=\"https://golang.org/pkg/archive/zip/#FileHeader\" rel=\"nofollow noreferrer\"><code>zip.FileHeader</code></a>. Also see the comments in <a href=\"https://github.com/golang/go/blob/04dc1b2/src/archive/zip/writer.go#L266-L289\" rel=\"nofollow noreferrer\">the source</a>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1430742458, "last_edit_date": 1430742458, "creation_date": 1430737344, "answer_id": 30028491, "question_id": 30026083, "link": "https://stackoverflow.com/questions/30026083/creating-a-zip-archive-with-unicode-filenames-using-gos-archive-zip/30028491#30028491", "title": "Creating a zip archive with Unicode filenames using Go&#39;s archive/zip", "body": "<p>The problem is that by default in zip entry names only the ASCII characters are allowed by the <a href=\"https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT\" rel=\"noreferrer\">Zip specification</a>, more specifically: (Source: <a href=\"https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT\" rel=\"noreferrer\">APPENDIX D</a>)</p>\n\n<blockquote>\n  <p><strong>APPENDIX D.1</strong> The ZIP format has historically supported only the original IBM PC character \n  encoding set, commonly referred to as IBM Code Page 437.  This limits storing \n  file name characters to only those within the original MS-DOS range of values \n  and does not properly support file names in other character encodings, or \n  languages. To address this limitation, this specification will support the \n  following change.</p>\n</blockquote>\n\n<p>Later support for Unicode names has been added. This can be marked with a special bit referred to as <code>general purpose bit 11</code>, also called <code>Language encoding flag (EFS)</code>:</p>\n\n<blockquote>\n  <p><strong>Section 4.4.4</strong> - General purpose bit flag - Bit 11 - Language encoding flag (EFS).  If this bit is set, the filename and comment fields for this file MUST be encoded using UTF-8.</p>\n  \n  <p><strong>APPENDIX D.2</strong> If general purpose bit 11 is unset, the file name and comment should conform \n  to the original ZIP character encoding.  If general purpose bit 11 is set, the \n  filename and comment must support The Unicode Standard, Version 4.1.0 or \n  greater using the character encoding form defined by the UTF-8 storage \n  specification.  The Unicode Standard is published by the The Unicode\n  Consortium (www.unicode.org).  UTF-8 encoded data stored within ZIP files \n  is expected to not include a byte order mark (BOM). </p>\n</blockquote>\n\n<p>The <code>general purpose bit flag</code> is present and supported by Go: it is the <code>Flags</code> field of the <a href=\"https://golang.org/pkg/archive/zip/#FileHeader\" rel=\"noreferrer\"><code>FileHeader</code></a> struct. Unfortunately Go doesn't have methods to set this bit, and by default it is 0.</p>\n\n<p>So the easiest way to add support for Unicode names is to simply set <code>bit 11</code> to one. Instead of </p>\n\n<pre><code>FileName, _ := Zip.Create(Path)\n</code></pre>\n\n<p>Start your zip entry with:</p>\n\n<pre><code>h := &amp;zip.FileHeader{Name:Path, Method: zip.Deflate, Flags: 0x800}\nFileName, _ := Zip.CreateHeader(h)\n</code></pre>\n\n<p>The first line creates a <code>FileHeader</code> in which <code>0x800</code> (<code>bit 11</code>) value is set for the <code>Flags</code> field which tells that the file name will be encoded using <code>UTF-8</code> (which is what Go does when it writes a <code>string</code> to an <code>io.Writer</code>).</p>\n\n<p><strong>Note:</strong></p>\n\n<p>By doing this, UTF-8 filenames will be preserved, but not all zip reader/extractor supports it. For example on Windows, the windows file handler, the Windows Explorer will not decode it as UTF-8, but for example a more serious Zip handler (e.g. <a href=\"https://www.pkware.com/software/securezip\" rel=\"noreferrer\">SecureZip</a>) will see the UTF-8 file names and will extract the file names properly (using UTF-8 decoding).</p>\n"}, {"comments": [{"owner": {"reputation": 23477, "user_id": 660921, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3d53595cb2a89131fb3be7b55b3a9ef0?s=128&d=identicon&r=PG", "display_name": "Martin Tournoij", "link": "https://stackoverflow.com/users/660921/martin-tournoij"}, "edited": false, "score": 0, "creation_date": 1465691138, "post_id": 30041724, "comment_id": 63007817, "body": "It would be helpful if you could add an explanation on how this solves the problem."}], "tags": [], "owner": {"reputation": 301, "user_id": 4047001, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ca7dcf86ac790b67132a103a1b33eced?s=128&d=identicon&r=PG&f=1", "display_name": "xichen", "link": "https://stackoverflow.com/users/4047001/xichen"}, "is_accepted": false, "score": -2, "last_activity_date": 1465691068, "last_edit_date": 1465691068, "creation_date": 1430782078, "answer_id": 30041724, "question_id": 30026083, "link": "https://stackoverflow.com/questions/30026083/creating-a-zip-archive-with-unicode-filenames-using-gos-archive-zip/30041724#30041724", "title": "Creating a zip archive with Unicode filenames using Go&#39;s archive/zip", "body": "<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nfunc main() {\n    var (\n        Path = os.Args[1]\n        Name = os.Args[2]\n    )\n\n    File, _ := os.Create(Name)\n    PS := strings.Split(Path, \"\\\\\")\n    PathName := strings.Join(PS[:len(PS)-1], \"\\\\\")\n    os.Chdir(PathName)\n    Path = PS[len(PS)-1]\n    defer File.Close()\n    Zip := zip.NewWriter(File)\n    defer Zip.Close()\n    walk := func(Path string, info os.FileInfo, err error) error {\n        if err != nil {\n            fmt.Println(err)\n            return err\n        }\n        if info.IsDir() {\n            return nil\n        }\n        Src, _ := os.Open(Path)\n        defer Src.Close()\n        //FileName, _ := Zip.Create(Path)\n        h := &amp;zip.FileHeader{Name: Path, Method: zip.Deflate, Flags: 0x800}\n        FileName, _ := Zip.CreateHeader(h)\n        io.Copy(FileName, Src)\n        Zip.Flush()\n        return nil\n    }\n    if err := filepath.Walk(Path, walk); err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 301, "user_id": 4047001, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ca7dcf86ac790b67132a103a1b33eced?s=128&d=identicon&r=PG&f=1", "display_name": "xichen", "link": "https://stackoverflow.com/users/4047001/xichen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1367, "favorite_count": 1, "accepted_answer_id": 30028491, "answer_count": 2, "score": 4, "last_activity_date": 1475354792, "creation_date": 1430729395, "last_edit_date": 1475354792, "question_id": 30026083, "link": "https://stackoverflow.com/questions/30026083/creating-a-zip-archive-with-unicode-filenames-using-gos-archive-zip", "title": "Creating a zip archive with Unicode filenames using Go&#39;s archive/zip", "body": "<pre><code>package main\n\nimport (\n    \"archive/zip\"\n    \"fmt\"\n    \"io\"\n    \"os\"\n    \"path/filepath\"\n    \"strings\"\n)\n\nfunc main() {\n    var (\n        Path = os.Args[1]\n        Name = os.Args[2]\n    )\n\n    File, _ := os.Create(Name)\n    PS := strings.Split(Path, \"\\\\\")\n    PathName := strings.Join(PS[:len(PS)-1], \"\\\\\")\n    os.Chdir(PathName)\n    Path = PS[len(PS)-1]\n    defer File.Close()\n    Zip := zip.NewWriter(File)\n    defer Zip.Close()\n    walk := func(Path string, info os.FileInfo, err error) error {\n        if err != nil {\n            fmt.Println(err)\n            return err\n        }\n        if info.IsDir() {\n            return nil\n        }\n        Src, _ := os.Open(Path)\n        defer Src.Close()\n        fmt.Println(Path)\n        FileName, _ := Zip.Create(Path)\n        io.Copy(FileName, Src)\n        Zip.Flush()\n        return nil\n    }\n    if err := filepath.Walk(Path, walk); err != nil {\n        fmt.Println(err)\n    }\n}\n</code></pre>\n\n<p>This mydir path :</p>\n\n<pre><code>-----root\n    |---2015-05(dir)\n         |---\u4e2d\u6587.go\n    |---package(dir)\n    |---\u4f60\u597d.go\n</code></pre>\n\n<p>When I use this code directory, Chinese will be garbled. Who can help me solve the problem.</p>\n"}, {"tags": ["go", "goquery"], "answers": [{"tags": [], "owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "is_accepted": false, "score": 5, "last_activity_date": 1430720050, "creation_date": 1430720050, "answer_id": 30023656, "question_id": 30023633, "link": "https://stackoverflow.com/questions/30023633/goquery-select-metaproperty-ogimage/30023656#30023656", "title": "Goquery Select meta[property=og:image]?", "body": "<p>Just figured it out - hope this helps someone else out there</p>\n\n<pre><code>doc.Find(\"meta\").Each(func(i int, s *goquery.Selection) {\n    op, _ := s.Attr(\"property\")\n    con, _ := s.Attr(\"content\")\n    if op == \"og:image\" {\n        fmt.Fprintln(\"og data=\", con)\n    }\n\n})\n</code></pre>\n"}], "owner": {"reputation": 14145, "user_id": 1255956, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a6a3498ebb173fb2373fded6f46d65fd?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/1255956/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1199, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1445405473, "creation_date": 1430719927, "last_edit_date": 1495539845, "question_id": 30023633, "link": "https://stackoverflow.com/questions/30023633/goquery-select-metaproperty-ogimage", "title": "Goquery Select meta[property=og:image]?", "body": "<p><strong>Goquery</strong> <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow noreferrer\">Syntax-wise, it is as close as possible to jQuery, with the same function names when possible, and that warm and fuzzy chainable interface.</a> </p>\n\n<pre><code>doc.Find(\"meta[property='og:image']\").Each(func(i int, s *goquery.Selection) {\n    fmt.Fprintln(\"og data=\", s)\n})\n</code></pre>\n\n<p>Apparently not close enough to that <a href=\"https://stackoverflow.com/questions/8977652/jquery-select-metaproperty-ogimage\">j-thing</a>.</p>\n\n<p>How can you get the og data in a webpage from goquery?</p>\n"}, {"tags": ["json", "google-app-engine", "go", "google-cloud-endpoints"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430726673, "post_id": 30022002, "comment_id": 48167731, "body": "Why  do you want to store the json as is  ? Create struct  and unmarshal the json to the struct and store the struct . Much simple and correct way"}, {"owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430727217, "post_id": 30022002, "comment_id": 48167981, "body": "@MIkCode Because I want the original receipt as it is. Its nice to have that data if I need to re-verify or if I want to do something else with it in the future. The key value pair &quot;json&quot; is signed by Google."}], "answers": [{"tags": [], "owner": {"reputation": 3111, "user_id": 455678, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/ec6689b267447cdcd58fbe5d89332b25?s=128&d=identicon&r=PG", "display_name": "Lander", "link": "https://stackoverflow.com/users/455678/lander"}, "is_accepted": false, "score": 0, "last_activity_date": 1430712021, "creation_date": 1430712021, "answer_id": 30022425, "question_id": 30022002, "link": "https://stackoverflow.com/questions/30022002/golang-google-endpoints-receive-json-for-google-iab-verification-and-storage-to/30022425#30022425", "title": "golang Google endpoints receive JSON for Google IAB Verification and Storage to Google Datastore", "body": "<p>I don't have experience with Google App Engine, but it seems as though your core problem here is with deserializing the JSON so that you can just fetch the \"signature\" field?</p>\n\n<p>You can <code>json.Unmarshal</code> the data into a <code>map[string]interface{}</code> and refer to the <code>signature</code> field of that map like so:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n)\n\nconst data = `{\n    \"json\": {\n        \"orderId\": \"123456789.12341234\",\n        \"packageName\": \"com.company.name\",\n        \"productId\": \"productName\",\n        \"purchaseState\": 0,\n        \"purchaseTime\": 1410655975266,\n        \"purchaseToken\": \"tokenData\"\n    },\n    \"signature\": \"signatureData\"\n}`\n\nfunc main() {\n    receipt := make(map[string]interface{})\n    json.Unmarshal([]byte(data), &amp;receipt)\n\n    signature, ok := receipt[\"signature\"].(string)\n    if !ok {\n        fmt.Println(\"type assertion failed\")\n        return\n    }\n\n    fmt.Println(signature)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0r7rcSLrfC\" rel=\"nofollow\">Playground link</a></p>\n\n<p>In that same example you can do <code>fmt.Printf(\"%#v\\n\", receipt)</code> which will show you that <code>receipt[\"json\"]</code> is another <code>map[string]interface{}</code>. With this you could refer to the fields in <code>json</code> as:</p>\n\n<pre><code>foo, ok := receipt[\"json\"].(map[string]interface{})\n// ... assertion checking, etc.\norderId, ok := foo[\"orderId\"].(string)\n// ... assertion checking again\n</code></pre>\n\n<p>Not sure about storing the JSON in Google Datastore. Give their example <a href=\"https://cloud.google.com/appengine/docs/go/datastore/\" rel=\"nofollow\">here</a> a peek.</p>\n\n<p>As an aside I don't think that Go makes any guarantees about the ordering of key-value pairs so you shouldn't assume that they are going to retain their ordering.</p>\n"}, {"tags": [], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "is_accepted": false, "score": 0, "last_activity_date": 1430728676, "creation_date": 1430728676, "answer_id": 30025879, "question_id": 30022002, "link": "https://stackoverflow.com/questions/30022002/golang-google-endpoints-receive-json-for-google-iab-verification-and-storage-to/30025879#30025879", "title": "golang Google endpoints receive JSON for Google IAB Verification and Storage to Google Datastore", "body": "<p>Json as data type is not supported <a href=\"https://cloud.google.com/appengine/docs/go/datastore/entities#Go_Properties_and_value_types\" rel=\"nofollow\">data type</a></p>\n\n<p>So you have couple of option how to store your data </p>\n\n<ol>\n<li><p>as @Lander suggested, unmarshal  your data and store it as object.</p></li>\n<li><p>Create <a href=\"http://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow\">RawMessage</a> and store  it as <strong>[]byte</strong>.</p></li>\n<li>Create a struct  that contain each field of the json unmarshal it and store it. </li>\n</ol>\n\n<p>I cant figure out on another way to do it? </p>\n"}], "owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 277, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1430728676, "creation_date": 1430708622, "last_edit_date": 1430716491, "question_id": 30022002, "link": "https://stackoverflow.com/questions/30022002/golang-google-endpoints-receive-json-for-google-iab-verification-and-storage-to", "title": "golang Google endpoints receive JSON for Google IAB Verification and Storage to Google Datastore", "body": "<p>I'm new to Go and have been trying virtually everything to get my Google Endpoint that's run by Go, to receive a POST with JSON for verification, and then store that in Google Datastore.</p>\n\n<p>Golang endpoint package <a href=\"https://github.com/GoogleCloudPlatform/go-endpoints\" rel=\"nofollow\">https://github.com/GoogleCloudPlatform/go-endpoints</a></p>\n\n<p>Here's an example of the JSON I'm trying to POST to my Go endpoint:</p>\n\n<pre><code>{\\\"json\\\": {\\\"orderId\\\": \\\"123456789.12341234\\\",\\\"packageName\\\":\\\"com.company.name\\\",\\\"productId\\\":\\\"productName\\\",\\\"purchaseTime\\\": 1410655975266,\\\"purchaseState\\\": 0,\\\"purchaseToken\\\": \\\"tokenData\\\"},\\\"signature\\\": \\\"signatureData\\\"}\n</code></pre>\n\n<p>Here's an example of my Golang code for Google endpoints:</p>\n\n<pre><code>type RawReceipt struct {\n    Key  *datastore.Key `json:\"id\" datastore:\"-\"`\n    Receipt json.RawMessage `json:\"json\"`\n}\n\nfunc ReceiveJson(c endpoints.Context, rec *RawReceipt) error {\n    k := datastore.NewIncompleteKey(c, \"DatastoreTest\", nil)\n    _, err := datastore.Put(c, k, rec)\n    return err\n}\n</code></pre>\n\n<p>Pseudo code of what I'm trying to accomplish:</p>\n\n<pre><code>var data below will need to contain {\\\"orderId\\\": \\\"123456789.12341234\\\",\\\"packageName\\\":\\\"com.company.name\\\",\\\"productId\\\":\\\"productName\\\",\\\"purchaseTime\\\": 1410655975266,\\\"purchaseState\\\": 0,\\\"purchaseToken\\\": \\\"tokenData\\\"},\\\"signature\\\": \\\"signatureData\\\"}\n\nfunc Json(rawJson *RawJson) {\n    data := rawJson[\"json\"]\n    signature := rawJson[\"signature\"]\n\n    if Verify(jsonData, jsonSignature) {\n       // Store into Datastore\n       // The storing part works, just need to get the right data into it\n        k := datastore.NewIncompleteKey(c, \"DatastoreTest\", nil)\n        _, err := datastore.Put(c, k, rec)\n        return err\n    }\n}\n\nfunc Verify (jsonData *JData, jsonSignature, *Jsig) bool {\n  //I got this part working just fine.\n  if fail or err return false, else true\n}\n</code></pre>\n\n<p>I need to be able to grab the values from the keys <strong>json</strong> and <strong>signature</strong> so I can pass</p>\n\n<pre><code>{\\\"json\\\": {\\\"orderId\\\": \\\"123456789.12341234\\\",\\\"packageName\\\":\\\"com.company.name\\\",\\\"productId\\\":\\\"productName\\\",\\\"purchaseTime\\\": 1410655975266,\\\"purchaseState\\\": 0,\\\"purchaseToken\\\": \\\"tokenData\\\"}\n</code></pre>\n\n<p>to the verification method and the signature </p>\n\n<pre><code>\\\"signature\\\": \\\"signatureData\\\"\n</code></pre>\n\n<p>as the other parameter to the verification method as well.</p>\n\n<p>Whats weird is that if I look at the value rec.Receipt, the JSON is out of order e.g. productId is now at the bottom instead of its original position.</p>\n\n<p>And the last thing I need to happen is to take the entire JSON and store that in the Google Datastore.</p>\n\n<p>As a side note, I've been going at this for about 3 days now reading though the documentations, looking at other stackoverflow questions, and have been trying anything to get this work.</p>\n\n<p>Any and all your help(s) is <strong>greatly</strong> appreciated!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 15641, "user_id": 1567738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1065193e064ef75f6278754f7f02abb6?s=128&d=identicon&r=PG", "display_name": "Intermernet", "link": "https://stackoverflow.com/users/1567738/intermernet"}, "edited": false, "score": 0, "creation_date": 1430708839, "post_id": 30021296, "comment_id": 48161302, "body": "If you&#39;re after a Linux specific way, just read and parse <code>&#47;proc&#47;meminfo</code>. For a cross platform solution, you&#39;ll need to do OS specific calls."}], "answers": [{"tags": [], "owner": {"reputation": 74488, "user_id": 797495, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BKD7l.jpg?s=128&g=1", "display_name": "Pedro Lobito", "link": "https://stackoverflow.com/users/797495/pedro-lobito"}, "is_accepted": true, "score": 14, "last_activity_date": 1539201038, "last_edit_date": 1539201038, "creation_date": 1430702922, "answer_id": 30021354, "question_id": 30021296, "link": "https://stackoverflow.com/questions/30021296/how-to-get-total-memory-ram-in-go/30021354#30021354", "title": "How to get total memory/RAM in GO?", "body": "<p>Besides <a href=\"https://golang.org/pkg/runtime/#ReadMemStats\" rel=\"noreferrer\">runtime.MemStats</a> you can use <a href=\"https://github.com/cloudfoundry/gosigar\" rel=\"noreferrer\">gosigar</a> to monitor system memory.</p>\n"}, {"comments": [{"owner": {"reputation": 2703, "user_id": 2049333, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3de211d5b26ab932c16ab465d1791018?s=128&d=identicon&r=PG", "display_name": "mschuett", "link": "https://stackoverflow.com/users/2049333/mschuett"}, "edited": false, "score": 0, "creation_date": 1474302581, "post_id": 32234638, "comment_id": 66465619, "body": "unfortunately this seems to be the best option currently :("}, {"owner": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 2, "creation_date": 1552560991, "post_id": 32234638, "comment_id": 97060439, "body": "if I remember correctly, c in go is very slow. Am I right?"}, {"owner": {"reputation": 18225, "user_id": 152580, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/34b114b30616ba935061582133cceeb8?s=128&d=identicon&r=PG", "display_name": "Eloff", "link": "https://stackoverflow.com/users/152580/eloff"}, "reply_to_user": {"reputation": 137, "user_id": 1592177, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/ae1273dbd6cc27d2d7805b74521e1762?s=128&d=identicon&r=PG", "display_name": "kabanek", "link": "https://stackoverflow.com/users/1592177/kabanek"}, "edited": false, "score": 1, "creation_date": 1573850559, "post_id": 32234638, "comment_id": 104036001, "body": "@kabanek the system memory doesn&#39;t change often presumably, call it once and cache it"}, {"owner": {"reputation": 1704, "user_id": 2912740, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/4730dc939ce11655d239d1f54a9cd399?s=128&d=identicon&r=PG&f=1", "display_name": "Edwinner", "link": "https://stackoverflow.com/users/2912740/edwinner"}, "edited": false, "score": 0, "creation_date": 1607277500, "post_id": 32234638, "comment_id": 115215924, "body": "Exactly what i wanted"}], "tags": [], "owner": {"reputation": 111, "user_id": 5269986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13577607e5c68cbd8ec5a4c0f831d0f4?s=128&d=identicon&r=PG", "display_name": "user5269986", "link": "https://stackoverflow.com/users/5269986/user5269986"}, "is_accepted": false, "score": 11, "last_activity_date": 1440615552, "creation_date": 1440615552, "answer_id": 32234638, "question_id": 30021296, "link": "https://stackoverflow.com/questions/30021296/how-to-get-total-memory-ram-in-go/32234638#32234638", "title": "How to get total memory/RAM in GO?", "body": "<p>cgo &amp; linux solution</p>\n\n<pre><code>package main\n\n// #include &lt;unistd.h&gt;\nimport \"C\"\n\nfunc main() {\n    println(C.sysconf(C._SC_PHYS_PAGES)*C.sysconf(C._SC_PAGE_SIZE), \" bytes\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 72, "user_id": 12641379, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/PCOuL.jpg?s=128&g=1", "display_name": "Tobias Pfandzelter", "link": "https://stackoverflow.com/users/12641379/tobias-pfandzelter"}, "is_accepted": false, "score": 1, "last_activity_date": 1615566081, "last_edit_date": 1615566081, "creation_date": 1615561469, "answer_id": 66602405, "question_id": 30021296, "link": "https://stackoverflow.com/questions/30021296/how-to-get-total-memory-ram-in-go/66602405#66602405", "title": "How to get total memory/RAM in GO?", "body": "<p>In my research on this I came across the <a href=\"https://github.com/pbnjay/memory\" rel=\"nofollow noreferrer\">memory package</a> that implements this for a number of different platforms. If you're looking for a quick and easy solution without CGO, this might be your best option.</p>\n<p>From the README:</p>\n<pre><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/pbnjay/memory&quot;\n)\n\nfunc main() {\n    fmt.Printf(&quot;Total system memory: %d\\n&quot;, memory.TotalMemory())\n}\n</code></pre>\n<p>On <a href=\"https://play.golang.org/p/mDud5Vwnue_8\" rel=\"nofollow noreferrer\">go Playground</a>:</p>\n<pre><code>Total system memory: 104857600\n</code></pre>\n"}], "owner": {"reputation": 16082, "user_id": 706727, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/62b57726dde0fa4568fa73b135680bd5?s=128&d=identicon&r=PG", "display_name": "Usman Ismail", "link": "https://stackoverflow.com/users/706727/usman-ismail"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10463, "favorite_count": 0, "accepted_answer_id": 30021354, "answer_count": 3, "score": 18, "last_activity_date": 1615566081, "creation_date": 1430702341, "question_id": 30021296, "link": "https://stackoverflow.com/questions/30021296/how-to-get-total-memory-ram-in-go", "title": "How to get total memory/RAM in GO?", "body": "<p>How can I get the total amount of memory/RAM attached to a system in Go? I want to use native code only if possible. I have found a library that wraps linux sysinfo command. Is there a more elegant way?</p>\n"}, {"tags": ["testing", "go", "phantomjs", "agouti"], "comments": [{"owner": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 1, "creation_date": 1430738628, "post_id": 30021201, "comment_id": 48174119, "body": "There is an arbitrary limitation in PhantomJS that only enables you to upload for at most 30 seconds. Does your upload exceed this?"}, {"owner": {"reputation": 1260, "user_id": 943095, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3779eeed3e75fe4220c64778f72e03eb?s=128&d=identicon&r=PG", "display_name": "Harry", "link": "https://stackoverflow.com/users/943095/harry"}, "reply_to_user": {"reputation": 58084, "user_id": 1816580, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f30e6b41f1e2bd48b058e8e72c1f0f57?s=128&d=identicon&r=PG", "display_name": "Artjom B.", "link": "https://stackoverflow.com/users/1816580/artjom-b"}, "edited": false, "score": 0, "creation_date": 1431851856, "post_id": 30021201, "comment_id": 48667613, "body": "No it doesn&#39;t. The main problem was entering large amount of text into the textarea, which is why we replaced that step by uploading a file. Which is now working fine. Not a solution - but a workaround. Thnx anyways for giving a thougt."}], "owner": {"reputation": 1260, "user_id": 943095, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3779eeed3e75fe4220c64778f72e03eb?s=128&d=identicon&r=PG", "display_name": "Harry", "link": "https://stackoverflow.com/users/943095/harry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 279, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1453725217, "creation_date": 1430701388, "last_edit_date": 1453725217, "question_id": 30021201, "link": "https://stackoverflow.com/questions/30021201/go-agouti-testing-fill-textarea-with-phantomjs-perfomance-issue", "title": "Go agouti testing fill textarea with PhantomJS perfomance issue", "body": "<p>I am using agouti with gomega and ginkgo in Go to test an upload form of our application consisting of an textarea which we fill. </p>\n\n<p>This Code works fine for 1500 rows:</p>\n\n<pre><code>upload_externalData := page.Find(\"#upload_externalData\")\nbuf := bytes.NewBuffer(nil)\nf, err := os.Open(\"./files/external.log\")\nio.Copy(buf, f)\nexternalData := string(buf.Bytes())\nExpect(upload_externalData.Fill(string(externalData))).Should(Succeed())\n</code></pre>\n\n<p>When increasing the imported data to the normal 25000 rows, PhantomJS blocks one CPU Core at 100% and nothing else happens. </p>\n\n<p>Is there a way to achieve this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430678677, "post_id": 30017845, "comment_id": 48153130, "body": "Actually full path to project is $GOPATH/src/project. If I write import &quot;project/models&quot;, shouldn&#39;t it work?"}, {"owner": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430678782, "post_id": 30017845, "comment_id": 48153175, "body": "Anyway I get error saying: local import &quot;./models&quot; in non-local package"}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430678936, "post_id": 30017845, "comment_id": 48153228, "body": "If it sits in $GOPATH/src/project, then you have a proper go workspace and you can&#39;t use local imports."}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430678950, "post_id": 30017845, "comment_id": 48153237, "body": "And instead you can just <code>import &quot;projects&#47;models&quot;</code>"}, {"owner": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430679095, "post_id": 30017845, "comment_id": 48153298, "body": "Still get ./main.go:11: imported and not used: &quot;project/models&quot; ./main.go:32: undefined: User"}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 1, "creation_date": 1430680569, "post_id": 30017845, "comment_id": 48153866, "body": "Yes, because in go imported type names should be qualified:     <code>user := &amp;models.User{Name: &quot;Igor&quot;}</code>"}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": false, "score": 2, "last_activity_date": 1430678320, "creation_date": 1430678320, "answer_id": 30017845, "question_id": 30017777, "link": "https://stackoverflow.com/questions/30017777/import-local-package/30017845#30017845", "title": "Import local package", "body": "<p>If you are building the project outside of a go workspace you can use <a href=\"https://golang.org/cmd/go/#hdr-Relative_import_paths\" rel=\"nofollow\">relative imports</a>:</p>\n\n<pre><code>import \"./models\"\n</code></pre>\n\n<p>However, using relative imports is not good idea. The preferred way is to import the full package path (and putting your project in a <a href=\"https://golang.org/doc/code.html#Workspaces\" rel=\"nofollow\">proper go workspace</a>):</p>\n\n<pre><code>import \"github.com/igor/myproject/models\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "edited": false, "score": 0, "creation_date": 1430681013, "post_id": 30018257, "comment_id": 48154041, "body": "Now, that was useful! Thanks!"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 7, "last_activity_date": 1430692962, "last_edit_date": 1430692962, "creation_date": 1430680603, "answer_id": 30018257, "question_id": 30017777, "link": "https://stackoverflow.com/questions/30017777/import-local-package/30018257#30018257", "title": "Import local package", "body": "<p>Your setup is right, you are using the package wrong.</p>\n\n<p>change:</p>\n\n<pre><code>user := &amp;User{Name: \"Igor\"}\n</code></pre>\n\n<p>to:</p>\n\n<pre><code>user := &amp;models.User{Name: \"Igor\"}\n</code></pre>\n\n<p>or if you don't want to always say models.XXX, change your import to be. </p>\n\n<pre><code>import . \"project/models\"\n</code></pre>\n\n<p>I do find that doing this makes the code a bit harder to read, long term.\n  It's obvious to the reader where \"models.User\" comes from, not so much with a plain \"User\" as normally that means it comes from this package.</p>\n"}], "owner": {"reputation": 14611, "user_id": 468311, "user_type": "registered", "accept_rate": 72, "profile_image": "https://lh3.googleusercontent.com/-R2kbPXmZbho/AAAAAAAAAAI/AAAAAAAAAAA/AGDgw-jKxaTxYHTYxiImqnqvR0jJmhDlaw/mo/photo.jpg?sz=128", "display_name": "Igor Filippov", "link": "https://stackoverflow.com/users/468311/igor-filippov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3568, "favorite_count": 1, "accepted_answer_id": 30018257, "answer_count": 2, "score": 3, "last_activity_date": 1430692962, "creation_date": 1430677973, "question_id": 30017777, "link": "https://stackoverflow.com/questions/30017777/import-local-package", "title": "Import local package", "body": "<p>My project structure looks like this:</p>\n\n<pre><code>--/project\n----main.go\n----/models\n------user.go\n</code></pre>\n\n<p>In main.go I want to user user.go:</p>\n\n<p><strong>user.go:</strong></p>\n\n<pre><code>package models\n\ntype User struct {\n    Name string\n}\n</code></pre>\n\n<p><strong>main.go:</strong></p>\n\n<pre><code>package main\n\nimport (...)\n\nfunc main() {\n    user := &amp;User{Name: \"Igor\"}\n}\n</code></pre>\n\n<p>How do I import user.go from main.go?</p>\n\n<p>/project is under GOPATH, so I tried:</p>\n\n<pre><code>import \"project/models\"\n</code></pre>\n\n<p>but that does nothing.</p>\n"}, {"tags": ["go", "profiling"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430689231, "post_id": 30017522, "comment_id": 48156810, "body": "Can you add  your code"}, {"owner": {"reputation": 1782, "user_id": 2046109, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b604b61990af13e9aff4372a8c7a67?s=128&d=identicon&r=PG", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2046109/oliver"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430727536, "post_id": 30017522, "comment_id": 48168136, "body": "Not exactly sure what you mean. That is my question. How can I let <code>pprof</code> know about my code?"}], "answers": [{"tags": [], "owner": {"reputation": 366, "user_id": 4628371, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6yN6h.jpg?s=128&g=1", "display_name": "mrkovec", "link": "https://stackoverflow.com/users/4628371/mrkovec"}, "is_accepted": false, "score": 0, "last_activity_date": 1430747438, "last_edit_date": 1430747438, "creation_date": 1430747124, "answer_id": 30031759, "question_id": 30017522, "link": "https://stackoverflow.com/questions/30017522/golang-profiler-cannot-find-source-code/30031759#30031759", "title": "Golang profiler cannot find source code", "body": "<p>I had the same problem with <code>\"net/http/pprof\"</code>, albeit on windows. \nUsing <code>\"runtime/pprof\"</code> instead, with <code>pprof.StartCPUProfile / StopCPUProfile</code> solved it.</p>\n"}, {"tags": [], "owner": {"reputation": 1782, "user_id": 2046109, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b604b61990af13e9aff4372a8c7a67?s=128&d=identicon&r=PG", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2046109/oliver"}, "is_accepted": true, "score": 18, "last_activity_date": 1430762933, "creation_date": 1430762933, "answer_id": 30036944, "question_id": 30017522, "link": "https://stackoverflow.com/questions/30017522/golang-profiler-cannot-find-source-code/30036944#30036944", "title": "Golang profiler cannot find source code", "body": "<p>Found the answer with the help of the golang-nuts people. I needed to specify the binary:</p>\n\n<pre><code>go tool pprof mybinary http://localhost:9000/debug/pprof/profile\n</code></pre>\n\n<p>This way the source code is found and can be listed with the \"list\" command.</p>\n"}], "owner": {"reputation": 1782, "user_id": 2046109, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/91b604b61990af13e9aff4372a8c7a67?s=128&d=identicon&r=PG", "display_name": "Oliver", "link": "https://stackoverflow.com/users/2046109/oliver"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3472, "favorite_count": 1, "accepted_answer_id": 30036944, "answer_count": 2, "score": 10, "last_activity_date": 1430762933, "creation_date": 1430676577, "question_id": 30017522, "link": "https://stackoverflow.com/questions/30017522/golang-profiler-cannot-find-source-code", "title": "Golang profiler cannot find source code", "body": "<p>I've included the <code>net/http/pprof</code> package in my code. I can then comfortably run the <code>pprof</code> profiler (on Debian):</p>\n\n<pre><code>go tool pprof http://localhost:9000/debug/pprof/profile\n</code></pre>\n\n<p>Commands such as <code>top10</code> or even generating call graphs work as expected. However, as soon as I try to go into a function, it fails:</p>\n\n<pre><code>(pprof) list MyFunc\nNo source information for mypkg.MyFunc\n</code></pre>\n\n<p>My <code>GOPATH</code> is set to my project's directory. Do I need any special flags or environment variables while building my source code or while running pprof?</p>\n"}, {"tags": ["http", "go", "proxy", "panic"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 1, "creation_date": 1430662497, "post_id": 30014508, "comment_id": 48147315, "body": "Please <a href=\"https://stackoverflow.com/posts/30014508/edit\">edit</a> your question and shorten the code so that only the part necessary to reproduce the problem is included."}, {"owner": {"reputation": 13, "user_id": 4859206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23cad15dcf6d88b415787846cf8601f0?s=128&d=identicon&r=PG&f=1", "display_name": "bshaw", "link": "https://stackoverflow.com/users/4859206/bshaw"}, "edited": false, "score": 0, "creation_date": 1430663753, "post_id": 30014508, "comment_id": 48147660, "body": "I don&#39;t know which part of the code is causing the problem, if someone can tell me which part is causing the problem then I will shorten the code"}, {"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 2, "creation_date": 1430663814, "post_id": 30014508, "comment_id": 48147674, "body": "Which line is <code>&#47;home&#47;bradley&#47;turbocharger&#47;proxy.go:40</code>? Please read the stacktrace, it is telling you everything you need to know."}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4859206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23cad15dcf6d88b415787846cf8601f0?s=128&d=identicon&r=PG&f=1", "display_name": "bshaw", "link": "https://stackoverflow.com/users/4859206/bshaw"}, "edited": false, "score": 0, "creation_date": 1430756850, "post_id": 30016573, "comment_id": 48186141, "body": "Thanks, this helped me find that the request wasn&#39;t reaching the server because request.ContentLength didn&#39;t match the actual length of the body which was easily fixed"}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": true, "score": 1, "last_activity_date": 1430671820, "creation_date": 1430671820, "answer_id": 30016573, "question_id": 30014508, "link": "https://stackoverflow.com/questions/30014508/go-runtime-error-invalid-memory-address-or-nil-pointer-dereference/30016573#30016573", "title": "Go - runtime error: invalid memory address or nil pointer dereference", "body": "<p><code>response</code> is <code>nil</code>.</p>\n\n<p>From the doc: \"In case of error, resp will be nil, and ctx.RoundTrip.Error will contain the error.\"\n<a href=\"https://github.com/elazarl/goproxy/blob/master/actions.go#L22-L28\" rel=\"nofollow\">https://github.com/elazarl/goproxy/blob/master/actions.go#L22-L28</a></p>\n\n<p>So the correct way to implement your response handler is something like this:</p>\n\n<pre><code>func viewResponse(response *http.Response, ctx *goproxy.ProxyCtx) *http.Response {\n    if response == nil {\n        log.Printf(\"Error: %s\", ctx.RoundTrip.Error)\n    } else {\n        log.Printf(\"Response: %s\", response.Status)\n    }\n    return response\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 4859206, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/23cad15dcf6d88b415787846cf8601f0?s=128&d=identicon&r=PG&f=1", "display_name": "bshaw", "link": "https://stackoverflow.com/users/4859206/bshaw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2988, "favorite_count": 0, "accepted_answer_id": 30016573, "answer_count": 1, "score": -4, "last_activity_date": 1430671820, "creation_date": 1430660605, "last_edit_date": 1430664127, "question_id": 30014508, "link": "https://stackoverflow.com/questions/30014508/go-runtime-error-invalid-memory-address-or-nil-pointer-dereference", "title": "Go - runtime error: invalid memory address or nil pointer dereference", "body": "<p>I am trying to use Go to make a proxy server which changes certain values in the body of a request to an API however when the request is sent the following panic occurs and the request fails:</p>\n\n<pre><code>2015/05/03 14:17:52 http: panic serving 192.168.1.139:42818: runtime error: invalid memory address or nil pointer dereference\ngoroutine 72 [running]:\nnet/http.func\u00b7011()\n    /usr/lib/go/src/pkg/net/http/server.go:1100 +0xb1\nruntime.panic(0x8258ee0, 0x83b3733)\n    /usr/lib/go/src/pkg/runtime/panic.c:248 +0x176\nmain.viewResponse(0x0, 0x1861b470, 0x1860ed01)\n    /home/bradley/turbocharger/proxy.go:40 +0xa2\ngithub.com/elazarl/goproxy.FuncRespHandler.Handle(0x82e6480, 0x0, 0x1861b470, 0x1)\n    /home/bradley/gopath/src/github.com/elazarl/goproxy/actions.go:35 +0x39\ngithub.com/elazarl/goproxy.func\u00b7016(0x0, 0x1861b470, 0x827a768)\n    /home/bradley/gopath/src/github.com/elazarl/goproxy/dispatcher.go:279 +0x18f\ngithub.com/elazarl/goproxy.FuncRespHandler.Handle(0x1868c9b0, 0x0, 0x1861b470, 0x4)\n    /home/bradley/gopath/src/github.com/elazarl/goproxy/actions.go:35 +0x39\ngithub.com/elazarl/goproxy.(*ProxyHttpServer).filterResponse(0x18682640, 0x0, 0x1861b470, 0x0)\n    /home/bradley/gopath/src/github.com/elazarl/goproxy/proxy.go:69 +0x95\ngithub.com/elazarl/goproxy.(*ProxyHttpServer).ServeHTTP(0x18682640, 0xb74dd780, 0x18601260, 0x18600bd0)\n    /home/bradley/gopath/src/github.com/elazarl/goproxy/proxy.go:115 +0x39b\nnet/http.serverHandler.ServeHTTP(0x18681dc0, 0xb74dd780, 0x18601260, 0x18600bd0)\n    /usr/lib/go/src/pkg/net/http/server.go:1673 +0x155\nnet/http.(*conn).serve(0x18628a00)\n    /usr/lib/go/src/pkg/net/http/server.go:1174 +0x8c6\ncreated by net/http.(*Server).Serve\n    /usr/lib/go/src/pkg/net/http/server.go:1721 +0x2be\n</code></pre>\n\n<p>Here is the script:</p>\n\n<pre><code>func viewResponse(response *http.Response, ctx *goproxy.ProxyCtx) *http.Response {\n    log.Printf(\"Response: %s\", response.Status)\n\n    return response\n}\n</code></pre>\n"}, {"tags": ["go", "command-line-interface", "cloud-foundry"], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 2, "last_activity_date": 1430662131, "creation_date": 1430662131, "answer_id": 30014768, "question_id": 30014421, "link": "https://stackoverflow.com/questions/30014421/adapt-go-build-into-different-os/30014768#30014768", "title": "Adapt GO build into different OS", "body": "<p>Go can build from any OS to any OS. You control the OS and architecture with two environment variables, named <code>GOOS</code> and <code>GOARCH</code>. The former is the operating system, and the latter is the CPU architecture. </p>\n\n<p>Building for 64-bit Linux is set as:</p>\n\n<pre><code>GOARCH=amd64\nGOOS=linux\n</code></pre>\n\n<p>The options for GOARCH are <code>386, amd64</code> and <code>arm</code>.</p>\n\n<p>The options for GOOS are <code>darwin, dragonfly, freebsd, linux, netbsd, openbsd, plan9, solaris</code> and <code>windows</code></p>\n\n<p>There are a few more steps to enabling cross compilation, they are described in more detail here: <a href=\"http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go\" rel=\"nofollow\">http://dave.cheney.net/2012/09/08/an-introduction-to-cross-compilation-with-go</a></p>\n"}], "owner": {"reputation": 35, "user_id": 4582060, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-g3EpqKVpOWA/AAAAAAAAAAI/AAAAAAAAAJ0/CiXxqnWaJx8/photo.jpg?sz=128", "display_name": "Fathima", "link": "https://stackoverflow.com/users/4582060/fathima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 30014768, "answer_count": 1, "score": 2, "last_activity_date": 1430662131, "creation_date": 1430660119, "question_id": 30014421, "link": "https://stackoverflow.com/questions/30014421/adapt-go-build-into-different-os", "title": "Adapt GO build into different OS", "body": "<p>I need to evaluate 'GO' for my requirement of building a CLI tool which should be runnable in different OS s. How is this achieved in the CLI tools such as 'Cloud Foundry CLI'? \nHow does GO handle this adaption into OSs?  </p>\n"}, {"tags": ["json", "rest", "go", "odata"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430671534, "post_id": 30014137, "comment_id": 48150496, "body": "Do you want to allow the client specific fields and ignored the rest of the fields  ?"}], "answers": [{"comments": [{"owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1430674463, "post_id": 30016666, "comment_id": 48151521, "body": "Not quite, but close. See my added detail above. Thank you!"}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "reply_to_user": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "edited": false, "score": 0, "creation_date": 1430688874, "post_id": 30016666, "comment_id": 48156710, "body": "I didn&#39;t  use this  before but  u can validate your json with that  <a href=\"https://github.com/xeipuuv/gojsonschema\" rel=\"nofollow noreferrer\">github.com/xeipuuv/gojsonschema</a>"}], "tags": [], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "is_accepted": false, "score": 0, "last_activity_date": 1430672282, "creation_date": 1430672282, "answer_id": 30016666, "question_id": 30014137, "link": "https://stackoverflow.com/questions/30014137/limit-returned-fields-in-json-schema/30016666#30016666", "title": "Limit returned fields in Json schema", "body": "<p>If i understood  your question correctly you want to reveal the client specific fields.\nIf thats the case you can use  <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">Json tags </a>   like that.</p>\n\n<pre><code>type FileMD struct {\nFileName string `json:\"filename\"`\nFileSize int    `json:\"filesize\"`\nFileMD5  string **`json:\"-\"`**//this wil ignore the FileMD5 field\n</code></pre>\n\n<p>}</p>\n"}], "owner": {"reputation": 2431, "user_id": 232337, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b17ed9811882a5db9f185cde695cf8d?s=128&d=identicon&r=PG&f=1", "display_name": "RockyMountainHigh", "link": "https://stackoverflow.com/users/232337/rockymountainhigh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 117, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1430674408, "creation_date": 1430658247, "last_edit_date": 1592644375, "question_id": 30014137, "link": "https://stackoverflow.com/questions/30014137/limit-returned-fields-in-json-schema", "title": "Limit returned fields in Json schema", "body": "<p>I have a requirement to allow a client to only request a subset of fields from a large json schema. I have done this using ODATA and their concept of <a href=\"http://www.odata.org/documentation/odata-version-2-0/uri-conventions/\" rel=\"nofollow noreferrer\" title=\"$select\">$select</a> (I like a lot about ODATA. Except the lack of adoption) I know I can spin my own solution but feel there must be other open source solutions I can use or use as a base. ( my service is in go)</p>\n<p>Does anyone know of something similar? Common conventions?</p>\n<p>Adding some clarification:</p>\n<p>Say I have a schema like the following:</p>\n<pre>\n{\n    \"status\": {\n        \"enum\": [\n            \"active\",\n            \"inactive\"\n        ]\n    },\n    \"lastModified\": {\n        \"type\": \"string\",\n        \"format\": \"date-time\"\n    },\n    \"userId\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"username\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"firstName\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"lastName\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"email\": {\n        \"type\": \"string\"\n    },\n    \"address\": {\n        \"$ref\": \"#/definitions/address\"\n    }\n}</pre>\n<p>By default, a GET to our User resource will return all of these fields. What I would like is a way for a client say they just want something like the following:</p>\n<pre>\n{\n   \"firstName\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"lastName\": {\n        \"type\": \"string\",\n        \"minLength\": 1\n    },\n    \"email\": {\n        \"type\": \"string\"\n    }\n}</pre>\n<p>Using Odata you can specify this with a $select querystring argument. Ideally, I'd like to have a client specify the schema they would like and we just pass the full schema through a, sort of, filter that does just this each time. But, I feel that will likely be something I'll have to code myself. But, in the short-term, if there is a way to have a client specify the fields they want in this way per request, they would be satisfied until we get something a bit more robust.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 22421, "user_id": 306478, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f790d6d3f1a75a30f6e525890f1d1964?s=128&d=identicon&r=PG", "display_name": "Bijan", "link": "https://stackoverflow.com/users/306478/bijan"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430723470, "post_id": 30012910, "comment_id": 48166033, "body": "The other question is practically asking for the same thing but in terms of SEO: &quot;implementations intereface golang&quot; is way better found than the other question. I didn&#39;t find the older question and seeing this question and its answer uprated 9 times within less than 24h it seems that others also don&#39;t find it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430755212, "post_id": 30012910, "comment_id": 48185173, "body": "It&#39;s not the askers job to worry about search engines. In particular, the language is &quot;Go&quot;, not &quot;Golang&quot;, it&#39;s up to SO&#39;s tag to add whatever keywords, etc to help search engines out. (And unless it&#39;s relevant/helpful to the title readability, like an &quot;\u2026 in/with Go&quot; here, <a href=\"http://meta.stackexchange.com/a/130208/150469\">tags shouldn&#39;t be forced into titles</a>)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430755215, "post_id": 30012910, "comment_id": 48185175, "body": "IMO if you are concerned about (or had difficulty) finding the duplicate you could submit an edit to make that question better rather than duplicating it. SO is all about improving questions and answers, not duplicating effort or saying the same thing several different ways, in several different questions, for some search engine. (Note I&#39;m not complaining about you <i>creating</i> a duplicate, since you say you looked and couldn&#39;t find it; just your response when pointed out that there is a duplicate. This post would be improved by being closed with a link to the existing answers)."}, {"owner": {"reputation": 22421, "user_id": 306478, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f790d6d3f1a75a30f6e525890f1d1964?s=128&d=identicon&r=PG", "display_name": "Bijan", "link": "https://stackoverflow.com/users/306478/bijan"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430840875, "post_id": 30012910, "comment_id": 48229988, "body": "Okay. I have now marked the question as duplicate."}, {"owner": {"reputation": 1615, "user_id": 2779792, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gHE8l.png?s=128&g=1", "display_name": "Matthew James Briggs", "link": "https://stackoverflow.com/users/2779792/matthew-james-briggs"}, "edited": false, "score": 0, "creation_date": 1541261179, "post_id": 30012910, "comment_id": 93159499, "body": "I also found this one and not the duplicate. And this question has the correct answer &#39;accepted&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 18, "last_activity_date": 1430650635, "last_edit_date": 1430650635, "creation_date": 1430650326, "answer_id": 30012956, "question_id": 30012910, "link": "https://stackoverflow.com/questions/30012910/how-do-you-quickly-find-the-implementations-of-an-interface-in-golang/30012956#30012956", "title": "How do you quickly find the implementation(s) of an interface in Golang?", "body": "<p>You can use:</p>\n\n<ul>\n<li>the <a href=\"https://docs.google.com/document/d/1SLk36YRjjMgKqe490mSRzOPYEDe0Y_WQNRv-EiFYUyw/view#heading=h.15us5y9rxrbh\">go oracle implements</a> command</li>\n<li>the <a href=\"https://godoc.org/golang.org/x/tools/go/types#Implements\"><code>go types Implements()</code> function</a> (which was <a href=\"https://sourcegraph.com/blog/go-interfaces-and-implementations\">used by Sourcegraph at one time</a>)</li>\n</ul>\n\n<p>You also have:</p>\n\n<ul>\n<li><a href=\"https://github.com/dominikh/implements\"><code>dominikh/implements</code></a> (uses <code>go types</code> as well)</li>\n<li><a href=\"https://github.com/fzipp/pythia\"><code>fzipp/pythia</code></a>, a browser based user interface (uses <code>go oracle</code>)</li>\n</ul>\n"}], "owner": {"reputation": 22421, "user_id": 306478, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/f790d6d3f1a75a30f6e525890f1d1964?s=128&d=identicon&r=PG", "display_name": "Bijan", "link": "https://stackoverflow.com/users/306478/bijan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6675, "favorite_count": 9, "closed_date": 1430840834, "accepted_answer_id": 30012956, "answer_count": 1, "score": 18, "last_activity_date": 1430650635, "creation_date": 1430650057, "question_id": 30012910, "link": "https://stackoverflow.com/questions/30012910/how-do-you-quickly-find-the-implementations-of-an-interface-in-golang", "closed_reason": "Duplicate", "title": "How do you quickly find the implementation(s) of an interface in Golang?", "body": "<p>Let's say I want to find all implementations of the io.ReadCloser interface.</p>\n\n<p>How can I do this in Go?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1430642397, "post_id": 30011793, "comment_id": 48141770, "body": "thank you. They selected really strange name for it. At least for me it associates with <code>e^x</code>. And during this time I almost finished my implementation."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1430987144, "post_id": 30011793, "comment_id": 48303317, "body": "just found out that I can not use this function without <code>m</code> provided. So it looks like it is not the one I needed."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1431441423, "post_id": 30011793, "comment_id": 48493120, "body": "@SalvadorDali, that seems counter to the documentation &quot;if m == nil or m == 0, z = x^y&quot;; what&#39;s special about your usage that that doesn&#39;t work?"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431458841, "post_id": 30011793, "comment_id": 48505046, "body": "@DaveC in mathematics <code>a%0</code> is undefined, so I would never even think about putting <code>m=0</code>. If it would work, it would surprise me and I would find it shockingly counterintuitive (I would expect to see some sort of error). As for <code>m=nil</code>, I did not know this before yesterday. I kindly asked Daniel a couple of days ago what should I do in this case, have not seen a reply and unaccepted my accept vote. I would be happy to grant it again if you/him/anyone would edit the question with this information"}], "tags": [], "owner": {"reputation": 25533, "user_id": 3318517, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/fa52f0ed961993dce0a5c271dca0b4b7?s=128&d=identicon&r=PG", "display_name": "Daniel Darabos", "link": "https://stackoverflow.com/users/3318517/daniel-darabos"}, "is_accepted": true, "score": 3, "last_activity_date": 1430642123, "creation_date": 1430642123, "answer_id": 30011793, "question_id": 30011720, "link": "https://stackoverflow.com/questions/30011720/is-there-a-pow-method-in-bigint-package-in-go/30011793#30011793", "title": "Is there a pow method in bigInt package in Go", "body": "<pre><code>func (z *Int) Exp(x, y, m *Int) *Int\n</code></pre>\n\n<blockquote>\n  <p>Exp sets z = x^y mod |m| (i.e. the sign of m is ignored), and returns z. If y &lt;= 0, the result is 1 mod |m|; if m == nil or m == 0, z = x^y. See Knuth, volume 2, section 4.6.3.</p>\n</blockquote>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431443489, "post_id": 30011885, "comment_id": 48494822, "body": "For all values I tested with (your version doesn&#39;t work with n&lt;0 and takes too long for large n) the naive (reallocates too much) version of <code>new(big.Int).Exp(big.NewInt(int64(a)), big.NewInt(int64(n)), nil)</code> produced the <i>exact</i> same values (verified with <a href=\"https://play.golang.org/p/1Z01aZ31oB\" rel=\"nofollow noreferrer\"><code>testing&#47;quick</code></a>), but did so faster."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431458241, "post_id": 30011885, "comment_id": 48504694, "body": "@DaveC why would my answer work with n &lt; 0? Remembering just a small fraction of math, one would see that with n &lt; 0 the result would not be big integer. It would be a small real, so if I would like to calculate it, I can use just pow method in math. Also before you made another downvote I will confess that it also would not work with n=3.14. Have I ever told that my own function that I wrote in 10 minutes would work faster than highly tested and tuned version from the library (PS. seeing that you told that it would take too long: what value of n would end up with my function being 2 slower)?"}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1431406959, "last_edit_date": 1431406959, "creation_date": 1430642879, "answer_id": 30011885, "question_id": 30011720, "link": "https://stackoverflow.com/questions/30011720/is-there-a-pow-method-in-bigint-package-in-go/30011885#30011885", "title": "Is there a pow method in bigInt package in Go", "body": "<p>Because I almost finished my own implementation (Daniel's recommendation does not work, because you always have to provide a modulo there) I am adding it here in case someone would like to see how it might be <a href=\"http://en.wikipedia.org/wiki/Exponentiation_by_squaring\" rel=\"nofollow\">implemented efficiently</a>. Here is <a href=\"https://play.golang.org/p/NBZsvGtK0i\" rel=\"nofollow\">Go Playground</a> and my function:</p>\n\n<pre><code>func powBig(a, n int) *big.Int{\n    tmp := big.NewInt(int64(a))\n    res := big.NewInt(1)\n    for n &gt; 0 {\n        temp := new(big.Int)\n        if n % 2 == 1 {\n            temp.Mul(res, tmp)\n            res = temp\n        }\n        temp = new(big.Int)\n        temp.Mul(tmp, tmp)\n        tmp = temp\n        n /= 2\n    }\n    return res\n}\n</code></pre>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 167, "favorite_count": 0, "accepted_answer_id": 30011793, "answer_count": 2, "score": 0, "last_activity_date": 1431406959, "creation_date": 1430641583, "question_id": 30011720, "link": "https://stackoverflow.com/questions/30011720/is-there-a-pow-method-in-bigint-package-in-go", "title": "Is there a pow method in bigInt package in Go", "body": "<p>I am looking at the <a href=\"https://golang.org/pkg/math/big/\" rel=\"nofollow\">documentation of a big integer arithmetic</a> in Go and trying to find a method suitable for calculation of a^n (something like <code>pow(a, n)</code> in python).</p>\n\n<p>To my surprise among some straightforward functions like <a href=\"https://golang.org/pkg/math/big/#Int.GCD\" rel=\"nofollow\">GCD</a>, <a href=\"https://golang.org/pkg/math/big/#Int.Binomial\" rel=\"nofollow\">Binomial</a> and not really straightforward as <a href=\"https://golang.org/pkg/math/big/#Int.ModInverse\" rel=\"nofollow\">modinverse</a> I can not find pow. Am I missing it or should I write my own?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1430640824, "post_id": 30011242, "comment_id": 48141410, "body": "Which NoSQL storage ?"}], "answers": [{"comments": [{"owner": {"reputation": 775, "user_id": 5686966, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/vnRou.jpg?s=128&g=1", "display_name": "mapmalith", "link": "https://stackoverflow.com/users/5686966/mapmalith"}, "edited": false, "score": 1, "creation_date": 1545282782, "post_id": 30011789, "comment_id": 94573280, "body": "this return <code>non-name * (*data) on left side of :=</code> <code>syntax error: unexpected := at end of statement</code> error"}, {"owner": {"reputation": 469, "user_id": 2957055, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/2626bc69c9070ac46b36b31fda0ee446?s=128&d=identicon&r=PG&f=1", "display_name": "margincall", "link": "https://stackoverflow.com/users/2957055/margincall"}, "reply_to_user": {"reputation": 775, "user_id": 5686966, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/vnRou.jpg?s=128&g=1", "display_name": "mapmalith", "link": "https://stackoverflow.com/users/5686966/mapmalith"}, "edited": false, "score": 1, "creation_date": 1551098633, "post_id": 30011789, "comment_id": 96503334, "body": "@mapmalith remove **s. they are for emphasizing"}], "tags": [], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "is_accepted": true, "score": 4, "last_activity_date": 1430642062, "creation_date": 1430642062, "answer_id": 30011789, "question_id": 30011242, "link": "https://stackoverflow.com/questions/30011242/equivalent-to-curl-data-in-go-http-request-payload/30011789#30011789", "title": "equivalent to curl --data in go http request payload", "body": "<p>In order to post any data  you should  pass the value instead of <strong>nil</strong> \nin the    <a href=\"http://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow\">Newrequest</a> method.</p>\n\n<p>This should  work  </p>\n\n<pre><code>func setColumn(table string, key string, col string, value string) {\n\n    url := \"http://localhost:8123/\" + table + \"/\" + key + \"/\" + col\n    **data := bytes.NewReader([]byte(value))**\n    req, err := http.NewRequest(\"POST\", url, **data**)\n    req.Header.Set(\"Content-Type\", \"application/octet-stream\")\n\n    client := &amp;http.Client{}\n    resp, err := client.Do(req)\n    if err != nil {\n        // handle error\n    }\n    defer resp.Body.Close()\n    body, err := ioutil.ReadAll(resp.Body)\n    fmt.Println(string(body))\n}\n</code></pre>\n\n<p>Most of the NoSQL Servers has GO API use them instad of creating your own HTTP request.</p>\n"}], "owner": {"reputation": 6987, "user_id": 816415, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6718587772b15f57b3e7923aee8420ea?s=128&d=identicon&r=PG", "display_name": "gextra", "link": "https://stackoverflow.com/users/816415/gextra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1898, "favorite_count": 0, "accepted_answer_id": 30011789, "answer_count": 1, "score": -1, "last_activity_date": 1430642062, "creation_date": 1430637453, "question_id": 30011242, "link": "https://stackoverflow.com/questions/30011242/equivalent-to-curl-data-in-go-http-request-payload", "title": "equivalent to curl --data in go http request payload", "body": "<p>For the purpose of setting a K/V in a NoSQL storage, I need to create an equivalent to the following <strong>curl</strong> command in go:</p>\n\n<pre><code>curl -H \"Content-Type: text/xml\" --data '[...]' http://localhost:8000/test/testrow/test:testcolumn\n</code></pre>\n\n<p>I am trying to use something in the lines of the following code for that purpose, although I am unable to find how to set the binary data  <em>[]byte(value)</em> as a POST payload.</p>\n\n<pre><code>func setColumn(table string, key string, col string, value string) {\n\nurl := \"http://localhost:8123/\" + table + \"/\" + key + \"/\" + col\nreq, err := http.NewRequest(\"POST\", url, nil)\nreq.Header.Set(\"Content-Type\", \"application/octet-stream\")\n\ndata = []byte(value)\n\nclient := &amp;http.Client{}\nresp, err := client.Do(req)\nif err != nil {\n    // handle error\n}\ndefer resp.Body.Close()\nbody, err := ioutil.ReadAll(resp.Body)\nfmt.Println(string(body))\n</code></pre>\n\n<p>}</p>\n\n<p>So, how to map the data payload within the POST request ? Any indicators are welcome.</p>\n"}, {"tags": ["intellij-idea", "go"], "comments": [{"owner": {"reputation": 677, "user_id": 293790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f46653025eef5156e9dc1143b486f819?s=128&d=identicon&r=PG", "display_name": "oBlank", "link": "https://stackoverflow.com/users/293790/oblank"}, "edited": false, "score": 0, "creation_date": 1430633478, "post_id": 30010787, "comment_id": 48139687, "body": "Intellij IDEA is V14.1.2 Community Edition for Mac"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1430682982, "post_id": 30010787, "comment_id": 48154710, "body": "I&#39;ve never had this happen, can you please provide some more details on when this is happening or what are the steps to reproduce?"}, {"owner": {"reputation": 677, "user_id": 293790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f46653025eef5156e9dc1143b486f819?s=128&d=identicon&r=PG", "display_name": "oBlank", "link": "https://stackoverflow.com/users/293790/oblank"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1430703432, "post_id": 30010787, "comment_id": 48160161, "body": "when I use COMMAND+S to save file, the file will be closed auto, and then IEDA create another with suffix"}], "answers": [{"tags": [], "owner": {"reputation": 677, "user_id": 293790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f46653025eef5156e9dc1143b486f819?s=128&d=identicon&r=PG", "display_name": "oBlank", "link": "https://stackoverflow.com/users/293790/oblank"}, "is_accepted": false, "score": 0, "last_activity_date": 1430720912, "creation_date": 1430720912, "answer_id": 30023836, "question_id": 30010787, "link": "https://stackoverflow.com/questions/30010787/why-intellij-idea-close-file-on-save-and-then-copy-another/30023836#30023836", "title": "why Intellij IDEA close file on save and then copy another?", "body": "<p>fixed by install Intellij IDEA again, not Community Edition</p>\n"}], "owner": {"reputation": 677, "user_id": 293790, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/f46653025eef5156e9dc1143b486f819?s=128&d=identicon&r=PG", "display_name": "oBlank", "link": "https://stackoverflow.com/users/293790/oblank"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430720912, "creation_date": 1430633303, "question_id": 30010787, "link": "https://stackoverflow.com/questions/30010787/why-intellij-idea-close-file-on-save-and-then-copy-another", "title": "why Intellij IDEA close file on save and then copy another?", "body": "<p>How can I disable this? the file name be add suffix 201505031440055...</p>\n\n<p>I try to rename it, but IDEA will create another</p>\n\n<p><img src=\"https://i.stack.imgur.com/HQ7Sn.jpg\" alt=\"enter image description here\"></p>\n\n<p>thx</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 755, "user_id": 939530, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a30a8d2393b01d10f87da492038d30f3?s=128&d=identicon&r=PG", "display_name": "dv1729", "link": "https://stackoverflow.com/users/939530/dv1729"}, "edited": false, "score": 1, "creation_date": 1430604745, "post_id": 30007760, "comment_id": 48134479, "body": "I forced a panic and the stack trace clearly displayed function names and line numbers using both solutions :S"}, {"owner": {"reputation": 2611, "user_id": 872918, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b89d3f5413870b28a39767f0289c32b?s=128&d=identicon&r=PG", "display_name": "snap", "link": "https://stackoverflow.com/users/872918/snap"}, "reply_to_user": {"reputation": 755, "user_id": 939530, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a30a8d2393b01d10f87da492038d30f3?s=128&d=identicon&r=PG", "display_name": "dv1729", "link": "https://stackoverflow.com/users/939530/dv1729"}, "edited": false, "score": 4, "creation_date": 1430650517, "post_id": 30007760, "comment_id": 48143759, "body": "Any information that the Go runtime may require still stays in the binary. This includes information required for panic messages, type information, etc. I am not aware of any way of stripping it out. This is different from pure debugging information."}, {"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 8, "creation_date": 1430728199, "post_id": 30007760, "comment_id": 48168448, "body": "Strip is not recommended by the Go Team, it may break the executable. It is better to use <code>go build -ldflags &#39;-s&#39;</code> to omit the symbol table, however I&#39;m not sure if you can hide every symbol name completely."}], "tags": [], "owner": {"reputation": 2611, "user_id": 872918, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8b89d3f5413870b28a39767f0289c32b?s=128&d=identicon&r=PG", "display_name": "snap", "link": "https://stackoverflow.com/users/872918/snap"}, "is_accepted": false, "score": 10, "last_activity_date": 1430602522, "creation_date": 1430602522, "answer_id": 30007760, "question_id": 30005878, "link": "https://stackoverflow.com/questions/30005878/avoid-debugging-information-on-golang/30007760#30007760", "title": "Avoid debugging information on golang", "body": "<p>The go linker has a flag <code>-w</code> which disables DWARF debugging information generation. You can supply linker flags to go tool build commands as follows:</p>\n\n<pre><code>go build -ldflags '-w'\n</code></pre>\n\n<p>Another approach on Linux/Unix platforms is using command <code>strip</code> against the compiled binary. This seems to produce smaller binaries than the above linker option.</p>\n"}, {"tags": [], "owner": {"reputation": 1026, "user_id": 941493, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb97cb47fce441bfceffc8c3efadcbc2?s=128&d=identicon&r=PG", "display_name": "Tomas", "link": "https://stackoverflow.com/users/941493/tomas"}, "is_accepted": false, "score": 7, "last_activity_date": 1571350363, "creation_date": 1571350363, "answer_id": 58441379, "question_id": 30005878, "link": "https://stackoverflow.com/questions/30005878/avoid-debugging-information-on-golang/58441379#58441379", "title": "Avoid debugging information on golang", "body": "<p>I recommend usage of <code>-ldflags=\"-s -w\"</code> which removes symbol table and debugging information.</p>\n\n<p>As a bonus with Go 1.13 <code>-trimpath</code> can be <a href=\"https://golang.org/doc/go1.13#go-command\" rel=\"noreferrer\">used</a> to reduce length of file paths stored in the file</p>\n"}], "owner": {"reputation": 755, "user_id": 939530, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/a30a8d2393b01d10f87da492038d30f3?s=128&d=identicon&r=PG", "display_name": "dv1729", "link": "https://stackoverflow.com/users/939530/dv1729"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 11839, "favorite_count": 11, "answer_count": 2, "score": 17, "last_activity_date": 1571350363, "creation_date": 1430590786, "last_edit_date": 1430605485, "question_id": 30005878, "link": "https://stackoverflow.com/questions/30005878/avoid-debugging-information-on-golang", "title": "Avoid debugging information on golang", "body": "<p>I think that gc includes  debugging information by default. However, I want to avoid decompilation.</p>\n\n<p>How can I remove the debugging information when compiling go code with gc?</p>\n\n<p>Note:\nUsing gccgo doesn't solve the problem. If I don't compile with '-g' the executable is broken and only outputs: </p>\n\n<p>no debug info in ELF executable errno -1\nfatal error: no debug info in ELF executable</p>\n\n<p>runtime stack:\nno debug info in ELF executable errno -1\npanic during panic\"</p>\n"}, {"tags": ["go", "http-status-codes", "standard-library"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 0, "creation_date": 1430586850, "post_id": 30004945, "comment_id": 48128786, "body": "<i>Why</i> can the body not be read? Is it not valid JSON? Does the server code contain an error?"}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430587064, "post_id": 30004945, "comment_id": 48128854, "body": "Something like this will happen unlikely but Go&#39;s standard library will not offer an error as a potential return value if there&#39;s no reason as you can see in the <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow noreferrer\">official docs</a>."}], "answers": [{"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430587379, "post_id": 30005230, "comment_id": 48128959, "body": "Before I can validate the JSON I need to make the request <b>readable</b>. A 404-status will be send <b>afterwards</b>.  I don&#39;t think that the Go standard-libary will contain such an error, so it will unlikely be the fault of the server aka. Go&#39;s package.  The question, why the an error could be returned by the functions, remains open."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430587421, "post_id": 30005230, "comment_id": 48128975, "body": "I don&#39;t talk about 404 but 400. BTW: Is your question about REST and an API or about a Go implementation?"}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430587583, "post_id": 30005230, "comment_id": 48129041, "body": "The reason, why such an error is included in Go and what reason could cause it,  will answer the question about the statuscode. So it would have it focus on Go&#39;s implementation.  And I ment a 400-Error during the validation. My fault."}, {"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 2, "creation_date": 1430587702, "post_id": 30005230, "comment_id": 48129091, "body": "Then please edit your question to make it more clear."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430587932, "post_id": 30005230, "comment_id": 48129180, "body": "I updated the question and removed the rest api part."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "is_accepted": false, "score": 0, "last_activity_date": 1430587093, "creation_date": 1430587093, "answer_id": 30005230, "question_id": 30004945, "link": "https://stackoverflow.com/questions/30004945/why-couldnt-go-read-a-request-properly/30005230#30005230", "title": "Why couldn&#39;t Go read a request properly?", "body": "<p>If the client did send invalid JSON, it is the clients fault: <code>400 Bad Request</code>.</p>\n\n<p>If the JSON was valid but the server code contains a bug, its the servers fault:  <code>500 Internal Server error</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430590372, "post_id": 30005658, "comment_id": 48130035, "body": "Thanks for explaining this. Can the sending client cause any errors? I am asking because I want to implement an API and want to return a http status code."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430595576, "post_id": 30005658, "comment_id": 48131715, "body": "I&#39;m not certain what you mean here. A status code isn&#39;t an error; it&#39;s just a int. If you&#39;re asking whether you can set the status code, that&#39;s just <code>ResponseWriter.WriteHeader()</code>."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430595937, "post_id": 30005658, "comment_id": 48131836, "body": "I want to return an http status code, if  <code>ReadAll</code> returns an error. But what  is the correct status code? Either an internal server error (500) or a bad request (400) caused by the client."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1430598212, "post_id": 30005658, "comment_id": 48132577, "body": "Thanks for the help. That&#39;s what I finally wanted to know :)"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1430599447, "post_id": 30005658, "comment_id": 48132964, "body": "Another point of failure might be when your <code>r.Body</code> is wrapped with, for example, data decompressor \u2013 it would than fail if stream is not a valid (say) gzip. For this purpose it might be better to send 400."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 4, "last_activity_date": 1430589646, "creation_date": 1430589646, "answer_id": 30005658, "question_id": 30004945, "link": "https://stackoverflow.com/questions/30004945/why-couldnt-go-read-a-request-properly/30005658#30005658", "title": "Why couldn&#39;t Go read a request properly?", "body": "<p><code>ioutil.ReadAll</code> can fail for many reasons. It is capable of reading any <code>io.Reader</code>, not just an HTTP request body. And <code>Request.Body</code> is just an <code>io.ReadCloser</code>. It is totally legal for me to generate one that is tied to things other than the network socket (I do these kinds of things to http all the time to build proxies and tunneling protocols).</p>\n\n<p>It should be obvious that many kinds of <code>io.Reader</code> events can have errors (you may not have access to a file for instance, or the disk may be unmounted half-way through reading it). Specific to HTTP, you might similarly expect network failure errors. What would you expect to happen if the network socket received a RST packet half-way through reading the request body?</p>\n\n<p>Ultimately, though, the point you should take away is that you must deal with errors because the <code>Reader</code> interface can generate errors. Do not make assumptions about how that interface is implemented.</p>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 524, "favorite_count": 0, "accepted_answer_id": 30005658, "answer_count": 2, "score": -2, "last_activity_date": 1430645023, "creation_date": 1430585491, "last_edit_date": 1430645023, "question_id": 30004945, "link": "https://stackoverflow.com/questions/30004945/why-couldnt-go-read-a-request-properly", "title": "Why couldn&#39;t Go read a request properly?", "body": "<p>My API needs to parse incoming requests. In the first step, the data needs to be read by Go's <code>ReadAll()</code> function of the <code>ioutil</code> package. Why should there an error occur?</p>\n\n<p>The <a href=\"https://golang.org/pkg/io/ioutil/#ReadAll\" rel=\"nofollow\">official documentation</a> does not give a hint, because the reasons for such an error aren't described.\n</p>\n\n<pre><code>func ParseRequest(w http.ResponseWriter, r *http.Request) {\n    body, err := ioutil.ReadAll(r.Body)\n\n    if err != nil {\n        // handle the error\n    }\n}\n</code></pre>\n"}, {"tags": ["node.js", "amazon-web-services", "web-applications", "amazon-ec2", "go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 3, "creation_date": 1430586185, "post_id": 30004689, "comment_id": 48128510, "body": "Why not have Go do the routing as well and simplify your design?"}, {"owner": {"reputation": 18303, "user_id": 790224, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/auulQ.jpg?s=128&g=1", "display_name": "datasage", "link": "https://stackoverflow.com/users/790224/datasage"}, "edited": false, "score": 1, "creation_date": 1430625064, "post_id": 30004689, "comment_id": 48138237, "body": "If you are going to use two different languages, it will be much easier using something like nginx in front to proxy the requests to each service. This would also take care of the basic routing so no traffic has to go to golang or node and get routed to the other."}, {"owner": {"reputation": 335, "user_id": 4598336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efec5ca5e86331b1fb18f0764d50927c?s=128&d=identicon&r=PG&f=1", "display_name": "Darnell Campbell", "link": "https://stackoverflow.com/users/4598336/darnell-campbell"}, "edited": false, "score": 0, "creation_date": 1430630661, "post_id": 30004689, "comment_id": 48139160, "body": "OK, on EC2 with the default node.js setup, nginx is already used so I could use that to send certain requests to different ports (node.js listen on one port and golang on another port). But, are there other options, for instance if I wanted to call directly from node.js to golang?"}, {"owner": {"reputation": 335, "user_id": 4598336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efec5ca5e86331b1fb18f0764d50927c?s=128&d=identicon&r=PG&f=1", "display_name": "Darnell Campbell", "link": "https://stackoverflow.com/users/4598336/darnell-campbell"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1430630816, "post_id": 30004689, "comment_id": 48139178, "body": "@Not_a_Golfer, I would do everything in Go if it was my choice, but node.js is just faster to get something quick started with and I&#39;d like the option of then offloading these processor intensive tasks as time goes on."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 1, "last_activity_date": 1430959561, "creation_date": 1430959561, "answer_id": 30090060, "question_id": 30004689, "link": "https://stackoverflow.com/questions/30004689/node-js-golang-composite-architecture-for-web-application/30090060#30090060", "title": "node.js golang composite architecture for web application", "body": "<ol>\n<li>Go is trivial to deploy. Just build it on a linux box (or use gox) and deploy the binary. (You don't need go installed on the server to run a go program)</li>\n<li><p>There are many options for communicating between Go and Node.js. Here are a few:</p>\n\n<ol>\n<li>If the work you are doing takes a long time it may not be appropriate to have the user wait for a response. For background tasks you can use a queue (like Redis' <a href=\"http://redis.io/commands/rpoplpush\" rel=\"nofollow\">rpoplpush</a> or a real queue like Kafka or RabbitMQ, or since you're using Amazon: <a href=\"http://aws.amazon.com/sqs/\" rel=\"nofollow\">SQS</a>). Push your job as a JSON object onto the queue, then write a Go program that pulls from the queue, does its processing and then writes the final result somewhere.</li>\n<li>Go has a <a href=\"http://golang.org/pkg/net/rpc/jsonrpc/\" rel=\"nofollow\">jsonrpc library</a>. You can communicate over TCP, serialize a request in Node, read it in Go, then deserialize the response in Node. It's the jsonrpc 1.0 protocol and for TCP all you have to do is add some message framing (prefix your json string with a length) or just newline separate each request / response.</li>\n<li>Write a standard HTTP service in Go and just make HTTP calls from NodeJS. (PUT/POST/GET)</li>\n</ol></li>\n</ol>\n"}], "owner": {"reputation": 335, "user_id": 4598336, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/efec5ca5e86331b1fb18f0764d50927c?s=128&d=identicon&r=PG&f=1", "display_name": "Darnell Campbell", "link": "https://stackoverflow.com/users/4598336/darnell-campbell"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 288, "favorite_count": 0, "accepted_answer_id": 30090060, "answer_count": 1, "score": 0, "last_activity_date": 1430959561, "creation_date": 1430584046, "question_id": 30004689, "link": "https://stackoverflow.com/questions/30004689/node-js-golang-composite-architecture-for-web-application", "title": "node.js golang composite architecture for web application", "body": "<p>I am currently architecting a web app that will use node.js for basic routing. Some parts of the app are more processor intensive and I wanted to use golang for those parts. However, I'm not sure the best way to install and communicate between the two languages. I'm using Amazon Elastic Beanstalk for initial tests, so any specifics can be targeted for that platform.</p>\n\n<p>In essence it boils down to the following 2 questions:</p>\n\n<p>1) How do you install both node.js and a golang docker image on Amazon EC2? Amazon has guides for one or the other, but not both. </p>\n\n<p>2) What is the best way to offload processor intensive tasks from node.js to a golang codebase (I could imaging RPC, or just running golang on some localhost port, but I'm new to this type of thing)? The golang tasks might be things like serious number crunching or complex graph searches.</p>\n\n<p>Thanks for any guidance.</p>\n"}, {"tags": ["go", "bind", "argument-passing"], "answers": [{"comments": [{"owner": {"reputation": 41, "user_id": 2651150, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001403934339/picture?type=large", "display_name": "Anton Zhernov", "link": "https://stackoverflow.com/users/2651150/anton-zhernov"}, "edited": false, "score": 0, "creation_date": 1430574126, "post_id": 30002797, "comment_id": 48124406, "body": "Thanks for your answer! Sure, if I replace interface{} with int&lt;, it will work. But it won&#39;t be a general solution anymore. I am looking for general binder that can be used with all types (note, that its behavior is independent from types)"}, {"owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "reply_to_user": {"reputation": 41, "user_id": 2651150, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001403934339/picture?type=large", "display_name": "Anton Zhernov", "link": "https://stackoverflow.com/users/2651150/anton-zhernov"}, "edited": false, "score": 2, "creation_date": 1430598961, "post_id": 30002797, "comment_id": 48132802, "body": "My entire point is that you shouldn&#39;t be asking &quot;how to make a binder in Go&quot;, you should be asking &quot;how to solve this specific problem in Go&quot;."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 2, "creation_date": 1430665347, "post_id": 30002797, "comment_id": 48148156, "body": "This is more generally a question of &quot;how do I make Go behave as a generic language.&quot; The answer is that Go is not a generic language. Go only has specific types. This wasn&#39;t an oversight; the Go team designed it this way on purpose. You can argue whether they made a good or bad choice, but fighting it will just produce horrible Go."}], "tags": [], "owner": {"reputation": 2861, "user_id": 929510, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/z568f.png?s=128&g=1", "display_name": "Staven", "link": "https://stackoverflow.com/users/929510/staven"}, "is_accepted": false, "score": 4, "last_activity_date": 1430572969, "creation_date": 1430572969, "answer_id": 30002797, "question_id": 30002165, "link": "https://stackoverflow.com/questions/30002165/writing-a-generic-binder-in-go/30002797#30002797", "title": "Writing a generic binder in Go", "body": "<p>Replace <code>interface{}</code> with <code>int</code> and it will work.</p>\n\n<p>Or, more to the point, try to find a solution to your original problem using the features Go provides, instead of trying to force a solution from a different paradigm.</p>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 4, "last_activity_date": 1430574835, "last_edit_date": 1430574835, "creation_date": 1430574468, "answer_id": 30003051, "question_id": 30002165, "link": "https://stackoverflow.com/questions/30002165/writing-a-generic-binder-in-go/30003051#30003051", "title": "Writing a generic binder in Go", "body": "<p>I see what you're trying to do, some templates, right? But this is not going to work this way. Your <code>f func(a interface{}, b interface{})</code> argument is not an interface, so it must be of the matching type. You could achieve what you want by passing <code>f interface{}</code> and then manipulate it with <code>reflect</code> package.</p>\n\n<p>Some naive <a href=\"http://play.golang.org/p/poYw2pWSf4\" rel=\"nofollow\">example</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc bindSecond(value interface{}, f interface{}) func(c interface{}) {\n    return func(arg interface{}) {\n        reflect.ValueOf(f).Call([]reflect.Value{reflect.ValueOf(arg), reflect.ValueOf(value)})\n    }\n}\n\nfunc main() {\n    sum := func(x int, y int) { fmt.Println(x + y) }\n    inc := bindSecond(1, sum)\n    inc(10)\n}\n\n// Prints 11\n</code></pre>\n\n<p>Doable, but not very pretty. And panics in <em>runtime</em> if anything unexpected happens, for example <code>f</code> is not callable and doesn't take exactly two arguments. Or you pass a wrong type to <code>inc</code>. Complier won't help you anymore.</p>\n"}], "owner": {"reputation": 41, "user_id": 2651150, "user_type": "registered", "profile_image": "https://graph.facebook.com/100001403934339/picture?type=large", "display_name": "Anton Zhernov", "link": "https://stackoverflow.com/users/2651150/anton-zhernov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 269, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1430665170, "creation_date": 1430568806, "last_edit_date": 1430665170, "question_id": 30002165, "link": "https://stackoverflow.com/questions/30002165/writing-a-generic-binder-in-go", "title": "Writing a generic binder in Go", "body": "<p>Consider the following function -- a binder of the second argument.</p>\n\n<pre><code>func bindSecond(value interface{}, f func(a interface{}, b interface{})) func (c interface{}) {\n    return func(arg interface{}) {\n        f(arg, value)\n    }\n}\n</code></pre>\n\n<p>Consider a function</p>\n\n<pre><code>func f(x int, y int) {}\n</code></pre>\n\n<p>When trying to use it as a parameter in binder, go compiler says:</p>\n\n<pre><code>cannot use f (type func(int, int)) as type func(interface {}, interface {}) in argument to bindSecond.\n</code></pre>\n\n<p>Could you please suggest me the proper way of implementing binders in go (golang)?</p>\n"}, {"tags": ["xml", "json", "go"], "comments": [{"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 1, "creation_date": 1430553002, "post_id": 29999736, "comment_id": 48118583, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/25879570/how-to-convert-byte-xml-to-json-output-in-golang\">How to convert &#91;&#93;byte XML to JSON output in Golang</a>"}, {"owner": {"reputation": 15641, "user_id": 1567738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1065193e064ef75f6278754f7f02abb6?s=128&d=identicon&r=PG", "display_name": "Intermernet", "link": "https://stackoverflow.com/users/1567738/intermernet"}, "edited": false, "score": 1, "creation_date": 1430555717, "post_id": 29999736, "comment_id": 48119223, "body": "Firstly, please show the code you have already. Secondly, you will want to look at the json.Marshal function to achieve what you&#39;re after: <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\">golang.org/pkg/encoding/json/#Marshal</a>"}, {"owner": {"reputation": 2803, "user_id": 3186914, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/kkIb4.jpg?s=128&g=1", "display_name": "Prashant", "link": "https://stackoverflow.com/users/3186914/prashant"}, "edited": false, "score": 0, "creation_date": 1430559084, "post_id": 29999736, "comment_id": 48120083, "body": "<a href=\"http://stackoverflow.com/questions/25879570/how-to-convert-byte-xml-to-json-output-in-golang\" title=\"how to convert byte xml to json output in golang\">stackoverflow.com/questions/25879570/&hellip;</a> is not solving my problem because the mapping between XML and JSON is not straight forward. I need to make the mapping in struct object itself."}, {"owner": {"reputation": 1278, "user_id": 2036231, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/nYM74.png?s=128&g=1", "display_name": "Jose Bagatelli", "link": "https://stackoverflow.com/users/2036231/jose-bagatelli"}, "edited": false, "score": 0, "creation_date": 1430891149, "post_id": 29999736, "comment_id": 48251120, "body": "I&#39;d suggest you show the code you&#39;ve managed to come up with so far because it&#39;s easier to get help from people if you have a fiddle or similar. Otherwise, it will be hard to give you any other answer than &quot;use json.Marshal&quot; which should do the trick for you."}, {"owner": {"reputation": 2803, "user_id": 3186914, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/kkIb4.jpg?s=128&g=1", "display_name": "Prashant", "link": "https://stackoverflow.com/users/3186914/prashant"}, "edited": false, "score": 0, "creation_date": 1432027379, "post_id": 29999736, "comment_id": 48737906, "body": "I am new to Go. Actually Json.Marshal is good enough for what I wanted."}], "answers": [{"tags": [], "owner": {"reputation": 320, "user_id": 4855149, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9dtSx.jpg?s=128&g=1", "display_name": "Roozbeh hz", "link": "https://stackoverflow.com/users/4855149/roozbeh-hz"}, "is_accepted": true, "score": 1, "last_activity_date": 1430636280, "creation_date": 1430636280, "answer_id": 30011120, "question_id": 29999736, "link": "https://stackoverflow.com/questions/29999736/how-to-convert-xml-data-into-json-data-in-go/30011120#30011120", "title": "How to convert XML data into JSON data in Go?", "body": "<p>use </p>\n\n<pre><code>import \"encoding/json\"\n</code></pre>\n\n<p>and the function</p>\n\n<pre><code>json.Marshal\n</code></pre>\n\n<p><a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">http://golang.org/pkg/encoding/json/#Marshal</a></p>\n\n<p><a href=\"https://gobyexample.com/json\" rel=\"nofollow\">https://gobyexample.com/json</a></p>\n"}], "owner": {"reputation": 2803, "user_id": 3186914, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/kkIb4.jpg?s=128&g=1", "display_name": "Prashant", "link": "https://stackoverflow.com/users/3186914/prashant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1948, "favorite_count": 0, "accepted_answer_id": 30011120, "answer_count": 1, "score": 0, "last_activity_date": 1430636280, "creation_date": 1430552622, "last_edit_date": 1430559074, "question_id": 29999736, "link": "https://stackoverflow.com/questions/29999736/how-to-convert-xml-data-into-json-data-in-go", "title": "How to convert XML data into JSON data in Go?", "body": "<p>I want to create JSON object from a XML document in Go. Right now what I am doing is getting the XML data in struct object using xml.Unmarshall function and then programmatically format a string in JSON structure using fmt.Sprintf function.</p>\n\n<p>This code is not readable and I feel some better way should be there to do it. Can someone please suggest something better.</p>\n\n<p>My current code is</p>\n\n<pre><code>var root Root\n_ = xml.Unmarshal(data, &amp;root)\n\nfmt.Fprintln(w, fmt.Sprintf(\"{\\\"type\\\": \\\"%s\\\", \\\"action\\\": \\\"save\\\", \\\"entry\\\": {\\\"ads_enabled\\\": 1, \\\"comments_enabled\\\": 0, \\\"cover_headline\\\": \\\"%s\\\", }}\",\n            root.Type,\n            root.SeoHeadline, //coverheadline           ))\n\ntype Root struct {\n    Type                 string `xml:\"type,attr\"    json:\"type\"`\n    CoverHeadline        string `xml:\"Head&gt;PageHeadline&gt;p\" json:\"cover_headline\"`\n}\n</code></pre>\n\n<p>where data is byte[] object</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2138, "user_id": 2116520, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/84a8dc0af169f1b2b000e914ab6b9f96?s=128&d=identicon&r=PG", "display_name": "wwjdm", "link": "https://stackoverflow.com/users/2116520/wwjdm"}, "edited": false, "score": 1, "creation_date": 1430529084, "post_id": 29997262, "comment_id": 48114069, "body": "Thanks so much I was looking for the format. This is my answer."}, {"owner": {"reputation": 2138, "user_id": 2116520, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/84a8dc0af169f1b2b000e914ab6b9f96?s=128&d=identicon&r=PG", "display_name": "wwjdm", "link": "https://stackoverflow.com/users/2116520/wwjdm"}, "edited": false, "score": 1, "creation_date": 1430529708, "post_id": 29997262, "comment_id": 48114208, "body": "Thanks, but that means I have to switch day and month"}, {"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "reply_to_user": {"reputation": 2138, "user_id": 2116520, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/84a8dc0af169f1b2b000e914ab6b9f96?s=128&d=identicon&r=PG", "display_name": "wwjdm", "link": "https://stackoverflow.com/users/2116520/wwjdm"}, "edited": false, "score": 0, "creation_date": 1430529892, "post_id": 29997262, "comment_id": 48114256, "body": "ah, i thought it was the other way around for you."}, {"owner": {"reputation": 2138, "user_id": 2116520, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/84a8dc0af169f1b2b000e914ab6b9f96?s=128&d=identicon&r=PG", "display_name": "wwjdm", "link": "https://stackoverflow.com/users/2116520/wwjdm"}, "edited": false, "score": 0, "creation_date": 1430529985, "post_id": 29997262, "comment_id": 48114278, "body": "&quot;1/_2/2006, 15:04:05&quot; would work"}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 3, "last_activity_date": 1430538087, "last_edit_date": 1430538087, "creation_date": 1430528934, "answer_id": 29997262, "question_id": 29997234, "link": "https://stackoverflow.com/questions/29997234/go-date-and-time-parsing-in-go/29997262#29997262", "title": "GO: Date and Time Parsing in GO", "body": "<p>Rule #1 of fightclub, err Go, check your errors.</p>\n\n<p>That being said, the format for time parsing is defined in the <a href=\"http://golang.org/pkg/time/#pkg-overview\" rel=\"nofollow\">documentation</a> (scroll down to constants).</p>\n\n<p>For your specific question, the format is <code>1/_2/2006, 15:04:05</code>.</p>\n\n<p><a href=\"http://play.golang.org/p/E3w6Vm4Qei\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 2138, "user_id": 2116520, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/84a8dc0af169f1b2b000e914ab6b9f96?s=128&d=identicon&r=PG", "display_name": "wwjdm", "link": "https://stackoverflow.com/users/2116520/wwjdm"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "closed_date": 1430530463, "accepted_answer_id": 29997262, "answer_count": 1, "score": -4, "last_activity_date": 1430538087, "creation_date": 1430528689, "question_id": 29997234, "link": "https://stackoverflow.com/questions/29997234/go-date-and-time-parsing-in-go", "closed_reason": "Duplicate", "title": "GO: Date and Time Parsing in GO", "body": "<p>I have format string \"day/month/year, hour:minute:second\"</p>\n\n<p>How do I parse into a time object?</p>\n\n<p>I tried:</p>\n\n<pre><code>const longForm = \"5/01/2015, 12:00:00\"\n\nt1, _ := time.Parse(longForm, \"5/01/2015, 12:00:00\") \n\n0001-01-01 00:00:00 +0000 UTC\n</code></pre>\n\n<p>I get some UTC time, but this is not helpful if I want to compare times because I get the same UTC time for them all. Any help?</p>\n"}, {"tags": ["bash", "shell", "go"], "comments": [{"owner": {"reputation": 695058, "user_id": 20862, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/2343ae368d3241278581ce6c87f62a25?s=128&d=identicon&r=PG", "display_name": "Ignacio Vazquez-Abrams", "link": "https://stackoverflow.com/users/20862/ignacio-vazquez-abrams"}, "edited": false, "score": 2, "creation_date": 1430518312, "post_id": 29995741, "comment_id": 48111319, "body": "You can&#39;t. &quot;Sourcing&quot; is only possible within the shell process."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430577918, "post_id": 29995741, "comment_id": 48125642, "body": "BTW, <i>please</i> don&#39;t do anything like this in &quot;real&quot; code. At least not without <i>massive warnings</i>. Shell scripts can of course have arbitrary side effects, I can&#39;t think of any easy safe way to do this with a shell script but there are easy safe alternatives that cover almost all the use cases I can think of."}, {"owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "edited": false, "score": 0, "creation_date": 1430582539, "post_id": 29995741, "comment_id": 48127176, "body": "Thanks for your warning and concerns. I should have explain what I want to do. I&#39;m trying to initialize my shell with a Go program. So I have to copy/link some dotfiles and source some others. That&#39;s why side effects are expected in my case."}], "answers": [{"comments": [{"owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "edited": false, "score": 0, "creation_date": 1430574676, "post_id": 29995987, "comment_id": 48124586, "body": "Your sample works well for updating the environment of the run command, but it doesn&#39;t affect the current execution context of the Go program. See: <a href=\"http://beta.42grounds.io/s/7fa5ab8ec1b1e57d5b13ca9b71f3b4e1b107da4b11be01fb87c74893e12b2508\" rel=\"nofollow noreferrer\">beta.42grounds.io/s/&hellip;</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "edited": false, "score": 0, "creation_date": 1430577632, "post_id": 29995987, "comment_id": 48125553, "body": "@Pith, use play.golang.org for linking to Go code, your link is completely unreadable. E.g. <a href=\"https://play.golang.org/p/asAcntp-j8\" rel=\"nofollow noreferrer\">play.golang.org/p/asAcntp-j8</a>"}, {"owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "edited": false, "score": 1, "creation_date": 1430582574, "post_id": 29995987, "comment_id": 48127199, "body": "I don&#39;t understand why you find it unreadable. But why I didn&#39;t use the Go playground, is because the script doesn&#39;t run in the Go playground. Unlike the link I posted which run the script in a container."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 7, "last_activity_date": 1430575917, "last_edit_date": 1430575917, "creation_date": 1430518737, "answer_id": 29995987, "question_id": 29995741, "link": "https://stackoverflow.com/questions/29995741/how-can-i-source-a-shell-script-using-go/29995987#29995987", "title": "How can I source a shell script using Go?", "body": "<p>You can set environmental variables when running a program using <code>exec</code>:</p>\n\n<pre><code>cmd := exec.Command(\"whatever\")\ncmd.Env = []string{\"A=B\"}\ncmd.Run()\n</code></pre>\n\n<p>If you really need source then you can run your command through bash:</p>\n\n<pre><code>cmd := exec.Command(\"bash\", \"-c\", \"source \" + file.Name() + \" ; echo 'hi'\")\ncmd.Run()\n</code></pre>\n\n<p>Check out this library for a more full-featured workflow: <a href=\"https://github.com/progrium/go-basher\" rel=\"nofollow\">https://github.com/progrium/go-basher</a>.</p>\n\n<p><strong>Update</strong>: Here's an example that modifies the current environment:</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"bytes\"\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"os/exec\"\n    \"strings\"\n)\n\nfunc main() {\n    err := ioutil.WriteFile(\"example_source\", []byte(\"export FOO=bar; echo $FOO\"), 0777)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    cmd := exec.Command(\"bash\", \"-c\", \"source example_source ; echo '&lt;&lt;&lt;ENVIRONMENT&gt;&gt;&gt;' ; env\")\n    bs, err := cmd.CombinedOutput()\n    if err != nil {\n        log.Fatalln(err)\n    }\n    s := bufio.NewScanner(bytes.NewReader(bs))\n    start := false\n    for s.Scan() {\n        if s.Text() == \"&lt;&lt;&lt;ENVIRONMENT&gt;&gt;&gt;\" {\n            start = true\n        } else if start {\n            kv := strings.SplitN(s.Text(), \"=\", 2)\n            if len(kv) == 2 {\n                os.Setenv(kv[0], kv[1])\n            }\n        }\n    }\n}\n\nlog.Println(os.Getenv(\"FOO\"))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 366, "user_id": 4931501, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-TjU2jpTRxNI/AAAAAAAAAAI/AAAAAAAAEfA/qeYBbWgdM84/photo.jpg?sz=128", "display_name": "Daniel Mart&#237;", "link": "https://stackoverflow.com/users/4931501/daniel-mart%c3%ad"}, "is_accepted": false, "score": 2, "last_activity_date": 1516294811, "creation_date": 1516294811, "answer_id": 48326633, "question_id": 29995741, "link": "https://stackoverflow.com/questions/29995741/how-can-i-source-a-shell-script-using-go/48326633#48326633", "title": "How can I source a shell script using Go?", "body": "<p>I have recently added such a utility function to my shell/bash Golang library:</p>\n\n<p><a href=\"https://godoc.org/mvdan.cc/sh/shell#SourceFile\" rel=\"nofollow noreferrer\">https://godoc.org/mvdan.cc/sh/shell#SourceFile</a></p>\n\n<p>For example, you could do:</p>\n\n<pre><code>vars, err := shell.SourceFile(\"foo.sh\")\nif err != nil { ... }\nfmt.Println(vars[\"URL\"].Value)\n// http://the.url/value\n</code></pre>\n\n<p>It's decently safe, because it never actually calls bash nor any other program. It parses the shell script, then interprets it. But when interpreting, it has a whitelist of what files the script can open and what programs the script can execute.</p>\n\n<p>The interpreter also has a context.Context, so you can set a timeout if you want to be protected against forever loops or other bad code.</p>\n"}], "owner": {"reputation": 3272, "user_id": 1292605, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/knHw8.jpg?s=128&g=1", "display_name": "Pith", "link": "https://stackoverflow.com/users/1292605/pith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3706, "favorite_count": 2, "accepted_answer_id": 29995987, "answer_count": 2, "score": 8, "last_activity_date": 1516294811, "creation_date": 1430517469, "question_id": 29995741, "link": "https://stackoverflow.com/questions/29995741/how-can-i-source-a-shell-script-using-go", "title": "How can I source a shell script using Go?", "body": "<p>I want to source shell scripts using Go. Ideally the following code</p>\n\n<pre><code>cmd := exec.Command(\"/bin/bash\", \"source\", file.Name())\n</code></pre>\n\n<p>but, I know that \"source\" is a bash built-in function, not an executable.</p>\n\n<p>However, I have found some ways to mimic this behavior in Python:</p>\n\n<p><a href=\"http://pythonwise.blogspot.fr/2010/04/sourcing-shell-script.html\" rel=\"noreferrer\">http://pythonwise.blogspot.fr/2010/04/sourcing-shell-script.html</a></p>\n\n<p>Unfortunately, I don't know how to translate this in Go. Does anyone have an idea ?</p>\n\n<p>Thanks !</p>\n"}, {"tags": ["http", "struct", "go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430507284, "post_id": 29993365, "comment_id": 48106101, "body": "what packages are you using? I don&#39;t know what is providing <code>WriteEntity</code>"}, {"owner": {"reputation": 965, "user_id": 4031602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Colin Murphy", "link": "https://stackoverflow.com/users/4031602/colin-murphy"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430508435, "post_id": 29993365, "comment_id": 48106765, "body": "whoops sorry I forgot to mention that, I am using github.com/emicklei/go-restful"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430510061, "post_id": 29993365, "comment_id": 48107685, "body": "Can you not do what you want with Filters alone?"}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 1, "creation_date": 1430514384, "post_id": 29993365, "comment_id": 48109784, "body": "This is a language feature called &quot;functions&quot; hth."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1430519379, "creation_date": 1430519379, "answer_id": 29996087, "question_id": 29993365, "link": "https://stackoverflow.com/questions/29993365/golang-set-http-response-code-based-on-struct-field/29996087#29996087", "title": "Golang set http response code based on struct field", "body": "<p>You can make your own function:</p>\n\n<pre><code>func writeEntity(r *restful.Response, value interface{}) error {\n    // if value is an error\n    if perr, ok := value.(PodsError); ok {\n        r.WriteHeader(perr.ErrorCode)\n        // reassign value so it gets wrapped: `{\"error\": value}`\n        value = struct {\n            Error PodsError `json:\"error\"`\n        }{perr}\n    }\n    return r.WriteEntity(value)\n}\n</code></pre>\n\n<p>Then just always call that instead of <code>response.WriteEntity</code>:</p>\n\n<pre><code>writeEntity(response, PodsError{http.StatusNotFound, \"Calling Func\", \"Message\"})\n</code></pre>\n"}], "owner": {"reputation": 965, "user_id": 4031602, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Colin Murphy", "link": "https://stackoverflow.com/users/4031602/colin-murphy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1727, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430519379, "creation_date": 1430507046, "last_edit_date": 1430508486, "question_id": 29993365, "link": "https://stackoverflow.com/questions/29993365/golang-set-http-response-code-based-on-struct-field", "title": "Golang set http response code based on struct field", "body": "<p>Within an api I'm writing I have an error struct which marshals to json. When the api has an error it returns the struct and I set the http response code to be the appropriate value.</p>\n\n<pre><code>type PodsError struct {\n    ErrorCode       int     `json:\"error_code\"`\n    CallingFunction string  `json:\"calling_function\"`\n    Message         string  `json:\"error_message\"`\n}\n\ntype PodsErrorWrapper struct {\n    Error   PodsError   `json:\"error\"`\n}\n</code></pre>\n\n<p>Right now every time I write the struct I also write a header, but I don't like the amount of duplicate code I am seeing.</p>\n\n<pre><code>error := PodsError{http.StatusNotFound, \"Calling Func\", \"Message\"}\nresponse.WriteHeader(error.ErrorCode)\nresponse.WriteEntity(PodsErrorWrapper{error})\n</code></pre>\n\n<p>Is it possible to move the WriteHeader call to something that gets called whenever I pass the error to WriteEntity()? I figure there has to be a function I could implement for a PodsErrorWapper where I could just set the http status to be whatever the ErrorCode field is.</p>\n\n<p>Edit: Sorry I forgot to mention, I am using the go-restful package (github.com/emicklei/go-restful)</p>\n"}, {"tags": ["reflection", "interface", "go", "embedding"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430505851, "post_id": 29988632, "comment_id": 48105393, "body": "The <code>B</code> type has the method <code>Foo</code> -- there&#39;s no such thing as a &quot;real&quot; or &quot;not real&quot; method or function. You can either take this information as is, or you can call the method and see what happens (recover doesn&#39;t require a goroutine, just a deferred function)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430507949, "post_id": 29988632, "comment_id": 48106476, "body": "As I&#39;ve said, defer/recover is not an option, because the function might exist and have side effects."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430508274, "post_id": 29988632, "comment_id": 48106676, "body": "Then if you&#39;re not going to call it, does it matter? What problem are you trying to solve if you know that a type has a method that you don&#39;t want to call?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430508544, "post_id": 29988632, "comment_id": 48106839, "body": "I&#39;m going to call it later, not now.  The specific thing I&#39;m trying to do is to introspect interfaces for service patterns.   You look at the names and signatures of methods, and infer things about when/how those interfaces should be called in certain contexts, later.  The specific use case doesn&#39;t matter though, my question is about the best way to implement an SOA service introspector in Go, it&#39;s about a specific feature of the reflect package (which I might or might not be able to utilize to accomplish this, depending on the answer)..."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1587939332, "post_id": 29992861, "comment_id": 108700799, "body": "Actually there&#39;s a way with method values, I presented it in <a href=\"https://stackoverflow.com/a/61448767/1705598\">my answer</a>."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1430505153, "creation_date": 1430505153, "answer_id": 29992861, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions/29992861#29992861", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>I don't think this is possible. From what I can see in <code>reflect</code>'s documentation and <a href=\"https://github.com/golang/go/tree/release-branch.go1.4/src/reflect\" rel=\"nofollow\">code</a>, there is no way to know, whether a method is defined on the type or <a href=\"https://golang.org/ref/spec#Struct_types\" rel=\"nofollow\">promoted</a>. Seems like panic-recover is the best you can do here.</p>\n"}, {"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430508694, "post_id": 29992925, "comment_id": 48106911, "body": "Thanks, this is super-useful.  In fact, I was thinking about it wrong!  The key here is &quot;<b>dynamic type</b>&quot;.   Though I read it before, it didn&#39;t quite sink in:  <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Variables</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430508856, "post_id": 29992925, "comment_id": 48107008, "body": "What this means in my context is that it&#39;s not those static types which can either &quot;fully&quot; implement (ie. with &quot;real&quot; methods) an interface (or service contract in an SOA), it&#39;s the instances themselves.  And you&#39;ve got to check the runtime A in my example to even know if an implementation exists, if there is not one provided with receiver B.   Of course, A field nil, no impl, as you point out.   Perfect.  Means I have to change my stuff around a little, to not assume that types &#39;inherit&#39; methods, but makes clear sense now.  TYVM."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430508991, "post_id": 29992925, "comment_id": 48107090, "body": "(It would be nice if a reflect.Type had a isStaticType() or something similar, perhaps.   But the semantics of that are not totally clear, and I can do what I need to now... treating dynamic and static types differently, doing introspection on the first, and method resolution on the latter.)"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1430509175, "post_id": 29992925, "comment_id": 48107187, "body": "@BadZen: In Go, remove the word &quot;inherit&quot; from your vocabulary. There&#39;s no inheritance, static, class, super, etc. The semantics are very simple as long as you don&#39;t try to fit them into other forms of OOP."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430530637, "post_id": 29992925, "comment_id": 48114400, "body": "Yup.  I get the difference between inheritance and embedding - it&#39;s the idea of static vs. runtime typing that was confusing me.  Go has a mixture of both - I was assuming only static."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430559130, "post_id": 29992925, "comment_id": 48120089, "body": "@BadZen Interfaces in Go implement concept &#39;composition&#39; but &#39;inheritance&#39;. And anyway in your example what you suspect to inherit?"}], "tags": [], "owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "is_accepted": true, "score": 3, "last_activity_date": 1430505419, "creation_date": 1430505419, "answer_id": 29992925, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions/29992925#29992925", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>You needn't reflection to my mind</p>\n\n<pre><code>method_in_table := B.Foo\nfmt.Printf(\"%T \\n\", method_in_table)\n</code></pre>\n\n<p>will output you</p>\n\n<pre><code>func(main.B) string\n</code></pre>\n\n<p>Interface type A initialized at predeclared nil which has no dynamic type</p>\n\n<pre><code>var a A\nif a==nil{\n    fmt.Printf(\"It's nil\")\n}\na.Foo()\n</code></pre>\n\n<p>will give you same error. So practical check can be just</p>\n\n<pre><code>if b.A != nil { b.Foo()}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430507264, "post_id": 29993174, "comment_id": 48106092, "body": "I think your #1 with <code>io.Reader</code> to <code>io.ReadCloser</code> isn&#39;t correct. You&#39;d need a type assertion (in case the reader actually has it&#39;s own <code>Close</code>) or <a href=\"https://golang.org/pkg/io/ioutil/#NopCloser\" rel=\"nofollow noreferrer\"><code>ioutil.NopCloser</code></a> (Or just start with an io.ReadCloser). You don&#39;t magically gain methods. As-is I&#39;m pretty sure your <code>MyReadCloser{reader}</code> will not compile since reader doesn&#39;t implement read closer."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430507491, "post_id": 29993174, "comment_id": 48106212, "body": "1&amp;2 were prefaces, I was just explaining how I arrived at the real question - which is your 3.  As I said defer/recover is totally off the table - the only thing remaining it is basically re-implement MethodByName and have it return not found by explicitly checking for this sort of thing.  That however, is a huge ugly hack just to answer the question &quot;is there a method named &lt;X&gt; available on this object?&quot;   So still hoping someone comes up with a better way..."}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "edited": false, "score": 0, "creation_date": 1430509150, "post_id": 29993174, "comment_id": 48107177, "body": "&quot;is there a method named &lt;X&gt; available on this object?&quot;. <code>MethodByName</code> returns that. Go creates the method for you. What you&#39;re asking for is a way to know whether or not a method will throw a null pointer exception when called."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430509278, "post_id": 29993174, "comment_id": 48107253, "body": "@Caleb - Yeah, I saw in the panic that this reflect.Method that gets returned has a func that is &lt;autogenerated&gt;.   Side question:   what does that func (the one I&#39;m calling &quot;not real&quot;) actually do?   Is it the thing that looks in the actual field (A in this case), and calls whatever implementation is in the (dynamic) interface type?   And so it&#39;s panic&#39;ing nil because in my example A was nil?    Do I have that right?  It&#39;s a dynamic indirect call?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430509315, "post_id": 29993174, "comment_id": 48107270, "body": "That would mean the compiler could/does just map function call expressions to calls of that function, always - similar to virtual dispatch in C++..."}, {"owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "edited": false, "score": 0, "creation_date": 1430509727, "post_id": 29993174, "comment_id": 48107518, "body": "Yes that sounds right. Not sure if this is still correct, but here&#39;s an article on the details of the implementation: <a href=\"http://research.swtch.com/interfaces\" rel=\"nofollow noreferrer\">research.swtch.com/interfaces</a>. Basically data+method table."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1430509046, "last_edit_date": 1430509046, "creation_date": 1430506264, "answer_id": 29993174, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions/29993174#29993174", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>There are 3 questions here.</p>\n\n<ol>\n<li><p>An embedded interface does not mean \"implements A\". It's exactly the same as embedding any other type of object. If you want to implement A, just make a method: <code>func (b B) Foo() string</code>.</p>\n\n<p>When you say:</p>\n\n<blockquote>\n  <p>using embedded interfaces in structs is great for when you only want to \n  implement /part/ of an interface</p>\n</blockquote>\n\n<p>That does work, but you have to make sure to create the object properly.  Think of it like wrapping an existing object:</p>\n\n<pre><code>type MyReadCloser struct {\n    io.ReadCloser\n}\n\nfunc (mrc *MyReadCloser) Read(p []byte) (int64, error) {\n    // do your custom read logic here\n}\n\n// you get `Close` for free\n\nfunc main() {\n    // assuming we have some reader\n    var rc io.ReadCloser\n    // you have to build the object like this:\n    myReader := MyReadCloser{rc}\n}\n</code></pre>\n\n<p>I'm not sure how Go does it internally, but conceptually it's as if it creates a <code>Close</code> method for you:</p>\n\n<pre><code>func (mrc *MyReadCloser) Close() error {\n    return mrc.ReadCloser.Close()\n}\n</code></pre></li>\n<li><p>The panic is because <code>A</code> is <code>nil</code>. If you had:</p>\n\n<pre><code>type concrete string\nfunc (c concrete) Foo() string {\n    return string(c)\n}\nfunc main() {\n    b := B{A: c(\"test\")}\n    // etc...\n}\n</code></pre>\n\n<p>It would work. In other words when you call:</p>\n\n<pre><code>bMeth.Func.Call([]reflect.Value{reflect.ValueOf(B{})})\n</code></pre>\n\n<p>That's:</p>\n\n<pre><code>B{}.Foo()\n</code></pre>\n\n<p>Which is:</p>\n\n<pre><code>B{}.A.Foo()\n</code></pre>\n\n<p>And <code>A</code> is <code>nil</code> so you get a panic.</p></li>\n<li><p>As to the question about how to get only the methods directly implemented by an object (not methods implemented by an embedded field), I wasn't able to see a way using the <code>reflect</code> library. <code>MethodByName</code> gives no indication:</p>\n\n<pre><code>&lt;func(main.B) string Value&gt;\n</code></pre>\n\n<p>Internally that's basically a function like this:</p>\n\n<pre><code>func(b B) string {\n    return b.A.Foo()\n}\n</code></pre>\n\n<p>And I don't think there's anything in <code>reflect</code> that allows you to peer into the internals of a function. I tried looping over the fields, grabbing their methods and comparing the two, but that doesn't work either.</p></li>\n</ol>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430577184, "post_id": 30000716, "comment_id": 48125427, "body": "I don&#39;t really see the difference from <code>func (x *X) Foo() {_ = *x}</code> called like <code>(*X)(nil).Foo()</code> or via <code>func other(f FooInterface) { f.Foo() }; other(nil)</code>, etc. I think your answer boils down to: A type assertion just means the call is compilable, it says nothing what-so-ever about what will happen when you make the call (nor should it). (e.g. <code>func (x *X) Read([]byte) (int,error) {os.RemoveAll(&quot;&#47;&quot;); panic(&quot;ha ha&quot;)}</code> makes <code>X</code> compile as an io.Reader)."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430598731, "post_id": 30000716, "comment_id": 48132733, "body": "@DaveC: I agree, this would be a good TL;DR indeed. It was just I had this big cup of morning coffee and really felt like writing an essay."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430714321, "post_id": 30000716, "comment_id": 48162557, "body": "The spec on type assertions:  &quot;More precisely, if T is not an interface type, x.(T) asserts that the dynamic type of x is identical to the type T. In this case, T must implement the (interface) type of x; otherwise the type assertion is invalid since it is not possible for x to store a value of type T. If T is an interface type, x.(T) asserts that the dynamic type of x implements the interface T. &quot;"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430714640, "post_id": 30000716, "comment_id": 48162648, "body": "@tomasz - Your post is basically right along the lines of what seemed &quot;wrong&quot; to me.   Once I read about dynamic vs. static types again, it sorta made sense, but sorta not - especially in the light of the above excerpt.   In the example T is in fact an interface type (A).    We should then conclude that the dynamic type of the zero value in the anonymous field of b therefore implements A.  But... why/how?  (On the one hand, there is no function.  On the other hand, it is explicitly &quot;A&quot;.  The spec does not get into more detail about &quot;implements&quot; and dynamic types.)"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1430715076, "post_id": 30000716, "comment_id": 48162773, "body": "(Personally I&#39;d feel fine if the zero A was of an autogenerated dynamic type with actual method impls that had a better panic message, but note the actual behavior I was griping about in OP isn&#39;t incredibly far off from that, so...)"}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 2, "last_activity_date": 1430559453, "creation_date": 1430559453, "answer_id": 30000716, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions/30000716#30000716", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>Let me put my two cents in, after you've already received good answers for your question.</p>\n\n<blockquote>\n  <p>Presumably, this is because what is happening with this embed is just like in every other case - a value of type B would have an anonymous interface value of type A, as a field.</p>\n</blockquote>\n\n<p>You've basically solved the problem here. This is just a field, but because it's anonymous all its methods are being promoted and you can use them directly on the struct. This is not only related to interfaces, but the problem you've pointed to exists within ordinary structures as well:</p>\n\n<pre><code>package main\n\ntype A struct {\n}\n\nfunc (a A) Foo() {\n}\n\ntype B struct {\n    *A\n}\n\nfunc main() {\n    B{}.Foo()\n}\n</code></pre>\n\n<p>This will cause panic. I believe this is expected: we're saying <code>B</code> embeds <code>*A</code>, but then leave it uninitialised, so what am I thinking? We could try to find an analogy here with, for example, C++ and find out it is similar to a null pointer in C++ \u2013 how do we deal with it there? We either expect it to be non-null (by a contract) or need to check before using. The latter it what Uvelichitel suggested in the accepted answer and it's by no means correct and there is no better solution I think. Although it's not very plausible. We do expect the caller to know the method they're calling is a promoted method of an anonymous field which is a pointer (or interface) type and as such can be nil. As an author of such code I would either need to make sure it's never nil (contract) or state it clearly in documentation that a caller needs to check it (but why would I embed this type then instead of having normal field, I'm not sure).</p>\n\n<p>It bothers me with interfaces though, because looking back at your example and making <code>A</code> an interface, we have a following problem:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype A interface {\n    Foo()\n}\n\ntype B struct {\n    A\n}\n\nfunc main() {\n    var b interface{}\n    b = &amp;B{}\n\n    // Nicely check whether interface is implemented\n    if a, ok := b.(A); ok {\n        a.Foo()\n    }\n}\n</code></pre>\n\n<p>Whoops, panic. I explicitly don't use reflect package here to indicate your problem exists within \"normal\" language usage. I have an interface object <code>b</code> and want to check whether it implements interface <code>A</code>. The answer is yes, but I'm getting panic. Who is to blame? I would feel much more comforting saying the creator of object behind the interface <code>b</code> who advertise some functionality, but don't care to provide the implementation. As such I would like it to call a bad practice or at least force it to be clearly stated in the documentation rather than assuming <code>ok</code> in the above type assertion means actually ok.</p>\n\n<p>It's getting too long and off topic I think. My answer to your question is then a mixture of already given answers: directly check <code>A</code> is not null and if it's not possible (you don't know the exact field promoting the method), hope for the best and blame someone else.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1587939505, "last_edit_date": 1587939505, "creation_date": 1587938964, "answer_id": 61448767, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions/61448767#61448767", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>This question is old with some good answers, but none presents the possibility that this can be done.</p>\n\n<p>Before presenting the solution: I think it's not your job to make sure the implementation does not panic because it fails to set an embedded interface field. Someone could pass an implementation which explicitly defines the methods in which \n <code>panic()</code> is called explicitly. You could not detect that case, yet, that implementation wouldn't be any better than a <code>nil</code> embedded interface field.</p>\n\n<p>OK, so how to tell if a method cannot be called because it would panic due to the implementation not being available because the embedded interface field is <code>nil</code>?</p>\n\n<p>You said you can't / don't want to call the method and recover from a panic because if the method is available, this would call it and have its side effect.</p>\n\n<p>The fact is that we don't have to call it. We can just refer to the method via an instance (not type), and then the actual receiver has to be resolved. Of course if the receiver would be the dynamic value of an embedded interface, and if that interface is <code>nil</code>, the resolving will cause a runtime panic, but the method will not be called even if the embedded interface is not <code>nil</code>. Note that this is in fact a <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">Method value</a>, and obtaining a method value evaluates and saves the receiver. This receiver evaluation is what will fail.</p>\n\n<p>Let's see an example:</p>\n\n<pre><code>type A interface {\n    Foo() string\n}\n\ntype B struct {\n    A\n}\n\nfunc (b B) Int() int {\n    fmt.Println(\"B.Int() called\")\n    return 0\n}\n\nfunc main() {\n    b := B{}\n    _ = b.Int\n    fmt.Println(\"We got this far, b.Int is realized\")\n}\n</code></pre>\n\n<p>What will this program output? Only <code>\"We got this far, b.Int is realized\"</code>. Because the <code>Int()</code> method is explicitly defined for the <code>B</code> type, and so <code>b.Int</code> can be resolved. And since it's not called, <code>\"B.Int() called\"</code> will not be printed.</p>\n\n<p>What if we do this:</p>\n\n<pre><code>_ = b.Foo\n</code></pre>\n\n<p>Since <code>Foo</code> is a promoted method from <code>B.A</code> embedded interface, and <code>b.A</code> is <code>nil</code>, resolving <code>b.Foo</code> will fail at runtime, and produce a runtime error, something like this:</p>\n\n<pre><code>panic: runtime error: invalid memory address or nil pointer dereference\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x0 pc=0x47d382]\n\ngoroutine 1 [running]:\nmain.main()\n    /tmp/sandbox877757882/prog.go:24 +0x2\n</code></pre>\n\n<p>But we can recover from this:</p>\n\n<pre><code>defer func() {\n    if r := recover(); r != nil {\n        fmt.Println(\"Recovered:\", r)\n        fmt.Println(\"This means b.Foo is not realized!\")\n    }\n}()\n_ = b.Foo\n</code></pre>\n\n<p>This will output:</p>\n\n<pre><code>Recovered: runtime error: invalid memory address or nil pointer dereference\nThis means b.Foo is not realized!\n</code></pre>\n\n<p>Try the examples on the <a href=\"https://play.golang.org/p/VIUuJ7Ea63E\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2167, "favorite_count": 0, "accepted_answer_id": 29992925, "answer_count": 5, "score": 6, "last_activity_date": 1587939505, "creation_date": 1430490057, "last_edit_date": 1495541192, "question_id": 29988632, "link": "https://stackoverflow.com/questions/29988632/go-reflection-with-interface-embedded-in-struct-how-to-detect-real-functions", "title": "Go reflection with interface embedded in struct - how to detect &quot;real&quot; functions?", "body": "<p>The situation I have now is the same as was asked about in this thread:  <a href=\"https://stackoverflow.com/questions/24537443/meaning-of-a-struct-with-embedded-anonymous-interface\">Meaning of a struct with embedded anonymous interface?</a> </p>\n\n<pre><code>  type A interface {\n     Foo() string\n  }\n\n  type B struct {\n     A\n     bar string\n  }\n</code></pre>\n\n<p>Idiomatically, coming from a backround in OOP languages, what it looks like this pattern is \"trying to say\" to me is that B must implement interface A.   But I get by now that \"Go is different\".  So, rather than the compile-time check I expected at first, this is happy to compile with or without a</p>\n\n<pre><code>  func (B) Foo() string { .... }\n</code></pre>\n\n<p>present.  As the above question points out (paraphrased): \"using embedded interfaces in structs is great for when you only want to implement /part/ of an interface\".  </p>\n\n<p>Presumably, this is because what is happening with this embed is just like in every other case - a value of type B would have an anonymous interface value of type A, as a field.  Personally while I find that orthogonality comforting, I also find it confusing that the reflection package would then let me get methods of A directly from B's type this way, and not error/nil if no method with receiver B is present.  But - this question isn't about the thinking behind that - it is about how that interface value is initialized after <code>b := B{}</code>:</p>\n\n<pre><code> func main() {\n    bType := reflect.TypeOf(B{})\n    bMeth, has := bType.MethodByName(\"Foo\")\n    if has {\n      fmt.Printf(\"HAS IT: %s\\n\",bMeth.Type.Kind())\n      res := bMeth.Func.Call([]reflect.Value{reflect.ValueOf(B{})})\n      val := res[0].Interface()\n      fmt.Println(val)\n  } else {\n      fmt.Println(\"DOESNT HAS IT\")\n  }\n}\n</code></pre>\n\n<p>When this is run, it causes a horrible panic </p>\n\n<pre><code> HAS IT: func\n panic: runtime error: invalid memory address or nil pointer dereference\n</code></pre>\n\n<p>... <em>or doesn't</em> - depending on if the compiler/runtime was able to find the above method.  So:  <strong>How can I detect that situation before I trigger it?</strong>  </p>\n\n<p>That is - is there something about the bMeth value I can use to see that there is no \"real\" implementation present in the reflection-returned returned Method and func values?  Is that more precisely something like \"is the pointer to the function in the function table of the anonymous interface value in zero\", or what exactly is going on with methods you pull from an interface with reflection where there is no implementation?  </p>\n\n<p>Wrapping the whole thing in a goroutine and attempting to run the function under defer/panic isn't the answer - not only because of the expense of the panic/defer but because the function in general might, if it <em>does</em> exist, have side effects I don't want right now...</p>\n\n<p>Do I want something like a run-time implementation that mirrors the compiler's type check?  Or is there an easier way?   Am I thinking about this incorrectly?</p>\n\n<p><a href=\"https://play.golang.org/p/oumQBnJVD8\" rel=\"nofollow noreferrer\">Above example in a Go playground</a></p>\n"}, {"tags": ["go", "redis", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1430508917, "last_edit_date": 1430508917, "creation_date": 1430508565, "answer_id": 29993770, "question_id": 29987793, "link": "https://stackoverflow.com/questions/29987793/whats-an-idiomatic-way-to-reconnect-to-redis-subscription-in-go/29993770#29993770", "title": "What&#39;s an idiomatic way to reconnect to Redis subscription in Go?", "body": "<p>Yes, using a label and a loop is standard practice for reconnecting.</p>\n\n<p>The only thing you're missing is closing the connection. </p>\n\n<pre><code>            psc.Close()\n            break ReceiveLoop\n</code></pre>\n\n<p>For a little more resilience, you may want <code>redis.DialTimeout</code> so that a Dial call can't hang indefinitely.</p>\n"}], "owner": {"reputation": 16513, "user_id": 95642, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/36cf75fa7751ef674df65ab65cecd255?s=128&d=identicon&r=PG", "display_name": "Drew LeSueur", "link": "https://stackoverflow.com/users/95642/drew-lesueur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2431, "favorite_count": 5, "accepted_answer_id": 29993770, "answer_count": 1, "score": 9, "last_activity_date": 1444672513, "creation_date": 1430487116, "question_id": 29987793, "link": "https://stackoverflow.com/questions/29987793/whats-an-idiomatic-way-to-reconnect-to-redis-subscription-in-go", "title": "What&#39;s an idiomatic way to reconnect to Redis subscription in Go?", "body": "<p>I am using the redigo library to try to subscribe to a Redis channel and then handle a published message.\nHow do I handle the case where it errors out?\nHere's what I came up with. Is this a good way to do it? Is there a better way?</p>\n\n<p>Note: this question is specific to redigo, but I think it applies to other places where reconnections need to happen.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n\n    \"github.com/garyburd/redigo/redis\"\n)\n\nfunc main() {\n    for {\n        fmt.Println(\"connecting...\")\n        c, err := redis.Dial(\"tcp\", \"localhost:6379\")\n        if err != nil {\n            fmt.Println(\"error connecting to redis\")\n            time.Sleep(5 * time.Second)\n            continue\n        }\n        psc := redis.PubSubConn{c}\n        psc.Subscribe(\"example\")\n    ReceiveLoop:\n        for {\n            switch v := psc.Receive().(type) {\n            case redis.Message:\n                fmt.Printf(\"%s: message: %s\\n\", v.Channel, v.Data)\n            case redis.Subscription:\n                fmt.Printf(\"%s: %s %d\\n\", v.Channel, v.Kind, v.Count)\n            case error:\n                fmt.Println(\"there was an error\")\n                fmt.Println(v)\n                time.Sleep(5 * time.Second)\n                break ReceiveLoop\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>I just put it in the main() function for the example. It would really run in some goroutine.</p>\n"}, {"tags": ["rest", "go", "directory-structure"], "comments": [{"owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "edited": false, "score": 0, "creation_date": 1430511927, "post_id": 29987122, "comment_id": 48108628, "body": "Folders have a very different semantic meaning in Go than in Ruby. Unfortunately the same way that Rails doesn&#39;t can&#39;t really be applied to Go."}], "answers": [{"comments": [{"owner": {"reputation": 1066, "user_id": 1814139, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ff3008d4b4f58a53479d60feeab2e70e?s=128&d=identicon&r=PG", "display_name": "Aliou", "link": "https://stackoverflow.com/users/1814139/aliou"}, "edited": false, "score": 0, "creation_date": 1430554664, "post_id": 29996244, "comment_id": 48118943, "body": "Than you. How would you handle model and database ? Would you use an ORM or just call queries to the database directly ?"}], "tags": [], "owner": {"reputation": 15950, "user_id": 324978, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/9a271d8f6946301fa1f0c0fc4c7b9f14?s=128&d=identicon&r=PG", "display_name": "robbrit", "link": "https://stackoverflow.com/users/324978/robbrit"}, "is_accepted": false, "score": 2, "last_activity_date": 1430520496, "creation_date": 1430520496, "answer_id": 29996244, "question_id": 29987122, "link": "https://stackoverflow.com/questions/29987122/rest-application-folder-structure-in-golang/29996244#29996244", "title": "REST application folder structure in golang", "body": "<p>It's probably do-able, but because of static compilation you're going to have a bit of a mess if you want a lot of Rails' automagic for figuring out routes.</p>\n\n<p>I'd probably just have a <code>models</code> package with all the database models, and then something based on <a href=\"http://www.gorillatoolkit.org/pkg/mux\" rel=\"nofollow\">Gorilla's mux</a> to bind some routes to some actions.</p>\n\n<p>If things are getting complicated you can try a larger framework like <a href=\"https://revel.github.io/\" rel=\"nofollow\">Revel</a>, which might be more suitable for a larger MVC application.</p>\n"}], "owner": {"reputation": 1066, "user_id": 1814139, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ff3008d4b4f58a53479d60feeab2e70e?s=128&d=identicon&r=PG", "display_name": "Aliou", "link": "https://stackoverflow.com/users/1814139/aliou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2607, "favorite_count": 2, "answer_count": 1, "score": 3, "last_activity_date": 1430520496, "creation_date": 1430484470, "last_edit_date": 1430502506, "question_id": 29987122, "link": "https://stackoverflow.com/questions/29987122/rest-application-folder-structure-in-golang", "title": "REST application folder structure in golang", "body": "<p>I'm just getting started with Go and as a first project I decided to make a simple REST API server. Unfortunately, I've hit a problem as I can't seem to find the best way to structure my project.</p>\n\n<p>So far, I'm using the same structure as a Rails project meaning having controllers and models in their own folders, but it doesn't as idiomatic as go code should be.</p>\n\n<p>Does anyone have any advice on how to properly structure a project?</p>\n"}, {"tags": ["logging", "go", "revel"], "answers": [{"comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430520138, "post_id": 29996095, "comment_id": 48111925, "body": "Composition for the win! :)"}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1430716364, "post_id": 29996095, "comment_id": 48163176, "body": "Great answer! Thank you. I will definatley use it allthough for now I turned off the log by simply setting all writes to null."}, {"owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "edited": false, "score": 0, "creation_date": 1430716685, "post_id": 29996095, "comment_id": 48163267, "body": "Works like a charm! Thanks again."}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1430519429, "creation_date": 1430519429, "answer_id": 29996095, "question_id": 29986674, "link": "https://stackoverflow.com/questions/29986674/programmatically-turn-off-logging-revel-framework/29996095#29996095", "title": "Programmatically turn off logging revel framework", "body": "<p>From package <a href=\"http://godoc.org/github.com/revel/revel\" rel=\"nofollow\"><code>revel</code></a> you have:</p>\n\n<blockquote>\n<pre><code>var (\n    // Loggers\n    TRACE = log.New(ioutil.Discard, \"TRACE \", log.Ldate|log.Ltime|log.Lshortfile)\n    INFO  = log.New(ioutil.Discard, \"INFO  \", log.Ldate|log.Ltime|log.Lshortfile)\n    WARN  = log.New(ioutil.Discard, \"WARN  \", log.Ldate|log.Ltime|log.Lshortfile)\n    ERROR = log.New(&amp;error_log, \"ERROR \", log.Ldate|log.Ltime|log.Lshortfile)\n)\n</code></pre>\n</blockquote>\n\n<p>From package <a href=\"http://godoc.org/log\" rel=\"nofollow\"><code>log</code></a> you have:</p>\n\n<blockquote>\n  <p>func New</p>\n\n<pre><code>func New(out io.Writer, prefix string, flag int) *Logger\n</code></pre>\n  \n  <p>New creates a new Logger. The out variable sets the destination to\n  which log data will be written. The prefix appears at the beginning of\n  each generated log line. The flag argument defines the logging\n  properties.</p>\n</blockquote>\n\n<p>From package <a href=\"http://godoc.org/?q=ioutil\" rel=\"nofollow\"><code>ioutil</code></a> you have:</p>\n\n<blockquote>\n<pre><code>var Discard io.Writer = devNull(0)\n</code></pre>\n  \n  <p>Discard is an io.Writer on which all Write calls succeed without doing\n  anything.</p>\n</blockquote>\n\n<p>Therefore, to turn off the <code>revel.INFO</code> log try:</p>\n\n<pre><code>revel.INFO = log.New(ioutil.Discard, \"INFO  \", log.Ldate|log.Ltime|log.Lshortfile)\n</code></pre>\n"}], "owner": {"reputation": 7938, "user_id": 1511332, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/E2WEq.jpg?s=128&g=1", "display_name": "Pablo Jomer", "link": "https://stackoverflow.com/users/1511332/pablo-jomer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 369, "favorite_count": 1, "accepted_answer_id": 29996095, "answer_count": 1, "score": 1, "last_activity_date": 1430519429, "creation_date": 1430482511, "question_id": 29986674, "link": "https://stackoverflow.com/questions/29986674/programmatically-turn-off-logging-revel-framework", "title": "Programmatically turn off logging revel framework", "body": "<p>How can I programatically turn of logs like the one below. I need this to be able to run my testsuites with out filling the test logs with warnings and info logs.</p>\n\n<pre><code>revel.INFO.printf(\"\")\n</code></pre>\n\n<p>Thanks for your help.</p>\n"}, {"tags": ["go", "channel"], "answers": [{"comments": [{"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1430472096, "post_id": 29984354, "comment_id": 48087996, "body": "I don&#39;t understand what you mean, it blocks before that. The problem is not the receiver blocking, the receiver is meant to block. The problem is the <code>chin</code> channel blocking. Also they do not need to be closed as the whole thing is looped infinitely, although you don&#39;t see that code here."}, {"owner": {"reputation": 4052, "user_id": 731647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1025f04529c68572c09e9f6bfe4e0d?s=128&d=identicon&r=PG", "display_name": "Timofey Stolbov", "link": "https://stackoverflow.com/users/731647/timofey-stolbov"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 1, "creation_date": 1430472487, "post_id": 29984354, "comment_id": 48088168, "body": "Your <code>worker()</code> can&#39;t send to <code>chout</code> as no goroutine reads <code>chout</code> yet."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1430472638, "post_id": 29984354, "comment_id": 48088233, "body": "Does it not just collect in a queue?"}, {"owner": {"reputation": 4052, "user_id": 731647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1025f04529c68572c09e9f6bfe4e0d?s=128&d=identicon&r=PG", "display_name": "Timofey Stolbov", "link": "https://stackoverflow.com/users/731647/timofey-stolbov"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 1, "creation_date": 1430472871, "post_id": 29984354, "comment_id": 48088328, "body": "No. <code>make(chan in)</code> creates unbuffered (synchronous) channel."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1430472885, "post_id": 29984354, "comment_id": 48088333, "body": "OK, I see... so is there not a way to make channels accept any number of records rather than block after they reach a particular size?"}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1430473046, "post_id": 29984354, "comment_id": 48088394, "body": "OK, I understand now. You&#39;re right. I didn&#39;t realize channels worked like that."}, {"owner": {"reputation": 4052, "user_id": 731647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1025f04529c68572c09e9f6bfe4e0d?s=128&d=identicon&r=PG", "display_name": "Timofey Stolbov", "link": "https://stackoverflow.com/users/731647/timofey-stolbov"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1430473057, "post_id": 29984354, "comment_id": 48088401, "body": "You get it. Common way is to run producers and consumers as separate goroutines leaving to main goroutine setup and correct finish."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 1, "creation_date": 1430490259, "post_id": 29984354, "comment_id": 48096631, "body": "@Alasdair, if you really want an unlimited buffer/queue between a channel writer and reader you can do that by using two channels with a relatively straight forward goroutine queuing in the middle."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 1, "creation_date": 1430574899, "post_id": 29984354, "comment_id": 48124656, "body": "This is good, but be careful with large buffers - they might hide a deadlock and then you&#39;d get unexpected behaviour in some different way. It often helps to get everything working first with zero buffering (which entails designing out deadlocks), then add buffering as an optimisation step."}], "tags": [], "owner": {"reputation": 4052, "user_id": 731647, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f1025f04529c68572c09e9f6bfe4e0d?s=128&d=identicon&r=PG", "display_name": "Timofey Stolbov", "link": "https://stackoverflow.com/users/731647/timofey-stolbov"}, "is_accepted": true, "score": 2, "last_activity_date": 1430472006, "creation_date": 1430472006, "answer_id": 29984354, "question_id": 29984040, "link": "https://stackoverflow.com/questions/29984040/go-channels-how-to-make-this-non-blocking/29984354#29984354", "title": "Go Channels: How to make this non-blocking?", "body": "<blockquote>\n  <p>Receivers always block until there is data to receive. If the channel is unbuffered, the sender blocks until the receiver has received the value.</p>\n</blockquote>\n\n<p><a href=\"https://golang.org/doc/effective_go.html#channels\" rel=\"nofollow\">https://golang.org/doc/effective_go.html#channels</a></p>\n\n<p>So you can rewrite your consumer-code to something like:</p>\n\n<pre><code>go func(){\n    for res := range chout {\n        update5.Exec(res.data, res.id)\n    }\n}()\n</code></pre>\n\n<p>Also you need to <code>close(chin)</code> and <code>close(chout)</code> for proper usage of <code>range</code> statement.</p>\n"}], "owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1895, "favorite_count": 1, "accepted_answer_id": 29984354, "answer_count": 1, "score": 2, "last_activity_date": 1430472808, "creation_date": 1430470374, "last_edit_date": 1430472808, "question_id": 29984040, "link": "https://stackoverflow.com/questions/29984040/go-channels-how-to-make-this-non-blocking", "title": "Go Channels: How to make this non-blocking?", "body": "<p>I have a script which is selecting some data from a database and sending this to a channel to be processed by multiple goroutines, with the results then sent back to the main thread to be updated on the database.</p>\n\n<p>However, it is hanging (probably blocking) on sending the data to first channel.</p>\n\n<p>The channels are created globally with:</p>\n\n<pre><code>var chin = make(chan in)\nvar chout = make(chan out)\n</code></pre>\n\n<p><code>in</code> and <code>out</code> are both <code>structs</code></p>\n\n<p>First the goroutines are started:</p>\n\n<pre><code>for i:=0; i&lt;5; i++ {\n     go worker()\n}\n</code></pre>\n\n<p>The code to load the channels is then:</p>\n\n<pre><code>        if verbose {\n            fmt.Println(`Getting nextbatch2 and sending to workers`)\n        }\n\n        rows, err = nextbatch2.Query()\n        if err != nil {\n            panic(err)\n        }\n\n        var numtodo int\n        for rows.Next() {\n            err = rows.Scan(&amp;id, &amp;data)\n            if err != nil {\n                rows.Close()\n                panic(err)\n            }\n\n            // Start\n            var vin in\n            vin.id = id\n            vin.data = data\n            chin &lt;- vin\n            numtodo++\n        }\n        rows.Close()\n</code></pre>\n\n<p>Then immediately after this:</p>\n\n<pre><code>        if verbose {\n            fmt.Println(`Processing out channel from workers`)\n        }\n\n        for res := range chout {\n            update5.Exec(res.data, res.id)\n            if numtodo--; numtodo == 0 {\n                break\n            }\n        }\n</code></pre>\n\n<p>And in the background are multiple <code>worker()</code> goroutines running:</p>\n\n<pre><code>func worker() {\n      for res := range chin {\n            var v out\n            v.id = res.id\n            v.data = process(res.data)\n            chout &lt;- v\n      }\n}\n</code></pre>\n\n<p>This code hangs after printing <code>Getting nextbatch2 and sending to workers</code>. It never gets to <code>Processing out channel from workers</code>. So it's hanging somewhere inside the <code>rows.Next()</code> loop, for which I can't figure out the reason as the <code>chin</code> channel should be non-blocking - even if the <code>worker()</code> goroutines were not processing it should still at least finish that loop.</p>\n\n<p>Any ideas?</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>By adding on <code>fmt.Println(\" on\", numtodo)</code> at the end of the <code>rows.Next()</code> loop I can see that it blocks after 5, which I don't understand as it should be non-blocking, right?</p>\n\n<p><strong>EDIT 2:</strong></p>\n\n<p>By changing the channels to <code>make(chan in/out, 100)</code> it now will block after 105.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1430467717, "post_id": 29983559, "comment_id": 48086289, "body": "Do you use <code>bufio</code>? Why <code>fmt.Scanf</code> and not just <code>strconv.Atoi</code>? Post the code, there&#39;s not enough info."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1430467967, "post_id": 29983559, "comment_id": 48086372, "body": "@Ainar-G what code are you looking for. All I do reading a bunch of integers from stdin. And I clearly stated how I have done it (with <code>fmt.Scanf</code> which means that no, I have not used <code>bufio</code>). Why not just <code>strconv.Atoi</code> because I found how to read an integer in the answer on stackoverflow and it was telling to use scanf. I think it is more than enough info to understand what I am talking about."}, {"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1430475594, "post_id": 29983559, "comment_id": 48089488, "body": "@Salvador Dali Just curious, how you provide 10^5 integers to stdin? Can you do that at 2.5 seconds?"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 0, "creation_date": 1430505890, "post_id": 29983559, "comment_id": 48105408, "body": "@Uvelichitel as I wrote, I am using Go to solve programming competitions. In all of them you receive input on <code>stdin</code> and have to write your answer in <code>stdout</code>"}], "answers": [{"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1430469725, "post_id": 29983882, "comment_id": 48087045, "body": "do you have any idea why scanf is so slow (it is kind of strange to have a function which does something super inefficient when there is an efficient approach to do something. P.S. thanks, I will try your answer"}, {"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1430469879, "post_id": 29983882, "comment_id": 48087109, "body": "Well my code assumes that input is an integer. Scanf has multiple placeholders and is more flexible. This flexibility should come at a performance cost (more branches)."}, {"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 5, "creation_date": 1430470265, "post_id": 29983882, "comment_id": 48087263, "body": "if you look at the source code <a href=\"http://golang.org/src/fmt/scan.go?s=3461:3523#L74\" rel=\"nofollow noreferrer\">golang.org/src/fmt/scan.go?s=3461:3523#L74</a>, and go through the function calls, the critical inner function seems to be scanOne (line 930)  which has lots of case branches"}, {"owner": {"reputation": 15946, "user_id": 4606734, "user_type": "registered", "accept_rate": 100, "profile_image": "https://graph.facebook.com/858769040849894/picture?type=large", "display_name": "ameyCU", "link": "https://stackoverflow.com/users/4606734/ameycu"}, "edited": false, "score": 1, "creation_date": 1470672234, "post_id": 29983882, "comment_id": 65032897, "body": "@metakeule To see output why <code>Ctrl + D</code> has to be pressed ?"}], "tags": [], "owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "is_accepted": true, "score": 5, "last_activity_date": 1430472363, "last_edit_date": 1495542329, "creation_date": 1430469486, "answer_id": 29983882, "question_id": 29983559, "link": "https://stackoverflow.com/questions/29983559/how-can-i-efficiently-read-numbers-from-stdin-in-go-or-why-fmt-scanf-is-so-inef/29983882#29983882", "title": "how can I efficiently read numbers from stdin in Go (or why fmt.Scanf is so inefficient)", "body": "<p>If you have only the integer as input, this should be faster (not tested though)</p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n)\n\nfunc read() (int64, error) {\n    b, err := ioutil.ReadAll(os.Stdin)\n    if err != nil {\n        return 0, err\n    }\n\n    // use strconv.ParseUint and strconv.ParseFloat in a similar way\n    return strconv.ParseInt(string(b[:len(b)-1]), 10, 0)\n}\n\nfunc main() {\n    i, err := read()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    println(i)\n}\n</code></pre>\n\n<p>run it like this</p>\n\n<pre><code>echo 123 | go run main.go\n</code></pre>\n\n<p>for interactive input, you might want to use bufio.NewReader, see <a href=\"https://stackoverflow.com/questions/20895552/how-to-read-input-from-console-line\">How to read input from console line?</a></p>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1527, "favorite_count": 1, "accepted_answer_id": 29983882, "answer_count": 1, "score": 4, "last_activity_date": 1430472363, "creation_date": 1430467629, "last_edit_date": 1495542730, "question_id": 29983559, "link": "https://stackoverflow.com/questions/29983559/how-can-i-efficiently-read-numbers-from-stdin-in-go-or-why-fmt-scanf-is-so-inef", "title": "how can I efficiently read numbers from stdin in Go (or why fmt.Scanf is so inefficient)", "body": "<p>I started to do programming contests in go (just to learn the language) and to my surprise found that </p>\n\n<pre><code>var T int\nfmt.Scanf(\"%d\", &amp;T)\n</code></pre>\n\n<p>is unimaginably slow. How slow? To <a href=\"https://stackoverflow.com/questions/3751429/reading-an-integer-from-standard-input-in-golang\">read 10^5 integers</a> it take me 2.5 seconds (in comparison python does it in 0.8 secs).</p>\n\n<p>So why is it so slow and how should I properly read <code>int</code>, <code>uint64</code> and <code>float64</code>?</p>\n"}, {"tags": ["postgresql", "templates", "go", "martini"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1430467499, "post_id": 29982966, "comment_id": 48086220, "body": "Your template looks like it works on a single struct, but you put in a slice of structs. Does it print if you call <code>c.Render</code> with <code>books[0]</code>?"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1430469386, "post_id": 29982966, "comment_id": 48086905, "body": "Great. It works now. Thanks a lot :)"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 1, "last_activity_date": 1430469785, "creation_date": 1430469785, "answer_id": 29983936, "question_id": 29982966, "link": "https://stackoverflow.com/questions/29982966/go-variable-from-postgresql-in-template-not-output-value-echo-framework/29983936#29983936", "title": "Go: Variable from PostgreSQL in template not output value (Echo framework)", "body": "<p>As I mentioned in a comment, you shouldn't execute a template that takes a struct with a slice of structs. Either use <code>{{range}}</code> in your template, or do</p>\n\n<pre><code>c.Render(http.StatusOK, \"onlytestingtpl\", books[0])\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 184, "favorite_count": 1, "accepted_answer_id": 29983936, "answer_count": 1, "score": 1, "last_activity_date": 1430469785, "creation_date": 1430464221, "question_id": 29982966, "link": "https://stackoverflow.com/questions/29982966/go-variable-from-postgresql-in-template-not-output-value-echo-framework", "title": "Go: Variable from PostgreSQL in template not output value (Echo framework)", "body": "<p>Many codes taken from Martini example, but this using Echo framework.</p>\n\n<p>I can make it works in Martini but not in Echo.</p>\n\n<p><code>server.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"github.com/labstack/echo\"\n    _ \"github.com/lib/pq\"\n    \"html/template\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Book struct {\n    Title, Author, Description string\n}\n\ntype (\n    Template struct {\n        templates *template.Template\n    }\n)\n\nfunc (t *Template) Render(w io.Writer, name string, data interface{}) error {\n    return t.templates.ExecuteTemplate(w, name, data)\n}\n\nfunc main() {\n    e := echo.New()\n\n    db, err := sql.Open(\"postgres\", \"user=postgres password=apassword dbname=lesson4 sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    t := &amp;Template{\n        templates: template.Must(template.ParseFiles(\"public/views/testhere.html\")),\n    }\n    e.Renderer(t)\n\n    e.Get(\"/post/:idnumber\", func(c *echo.Context) {\n\n        rows, err := db.Query(\"SELECT title, author, description FROM books WHERE id=$1\", c.Param(\"idnumber\"))\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        books := []Book{}\n\n        for rows.Next() {\n            b := Book{}\n            err := rows.Scan(&amp;b.Title, &amp;b.Author, &amp;b.Description)\n\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            books = append(books, b)\n        }\n\n        c.Render(http.StatusOK, \"onlytestingtpl\", books)\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n\n<p><code>public/views/testhere.html</code>:</p>\n\n<pre><code>{{define \"onlytestingtpl\"}}Book title is {{.Title}}. Written by {{.Author}}. The book is about {{.Description}}.{{end}}\n</code></pre>\n\n<p>I cannot figure out since no error message, and no SQL documentation of this framework. When running, it gives:</p>\n\n<p><code>Book title is</code></p>\n\n<p>(The variable not output value)</p>\n"}, {"tags": ["arrays", "pointers", "indexing", "go"], "comments": [{"owner": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 1, "creation_date": 1430456146, "post_id": 29981710, "comment_id": 48083015, "body": "The code declares a new variable <code>b</code> inside loop that shadows the outer <code>b</code>. I am not sure if you want that or not.  I don&#39;t understand what you are trying to do with the image."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430456260, "post_id": 29981710, "comment_id": 48083035, "body": "BTW, your <code>fourSwap</code> can be simplified with Go&#39;s multi-assignment. <code>*a, *b, *c, *d = *c, *a, *d, *b</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 196, "user_id": 4752457, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ee3e44ad3132013d9ea4ed720bb5ee4a?s=128&d=identicon&r=PG", "display_name": "user4752457", "link": "https://stackoverflow.com/users/4752457/user4752457"}, "edited": false, "score": 0, "creation_date": 1430456376, "post_id": 29981710, "comment_id": 48083059, "body": "As @tvblah says, it&#39;s due to shadowing <code>b</code>. Simplest fix is to change your slice of slices from <code>b := [][]int{</code> to some other name. Otherwise right after <code>b := &amp;b[x][y]</code> you have a new <code>b</code> of type <code>int</code> and can no longer index it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430456511, "post_id": 29981710, "comment_id": 48083100, "body": "Also note you&#39;re using <a href=\"https://blog.golang.org/slices\" rel=\"nofollow noreferrer\">slices, not arrays</a>. If you <i>really</i> want to use arrays just change your definition to <code>notb := [...][...]int{&#47;*values as before*&#47;}</code>. The &quot;...&quot; makes the compiler figure out the size."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1430456311, "creation_date": 1430456311, "answer_id": 29981820, "question_id": 29981710, "link": "https://stackoverflow.com/questions/29981710/invalid-operation-index-of-type-int-golang/29981820#29981820", "title": "Invalid operation: index of type *int golang", "body": "<p>You declare <code>b</code> inside the loop, and that shadows your slice.</p>\n\n<pre><code>for row := 0; row &lt; N / 2; row++ {\n    for col := row; col &lt; N - row - 1; col++ {\n        a := &amp;b[row][col]\n        b := &amp;b[col][N - row - 1] &lt;&lt;&lt;&lt; b is now an *int\n        c := &amp;b[N - col - 1][col] // &lt;-- Error here\n        d := &amp;b[N - row - 1][N - col - 1] // &lt;-- Error here\n        fourSwap(a, b, c, d)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 1, "last_activity_date": 1430456418, "creation_date": 1430456418, "answer_id": 29981832, "question_id": 29981710, "link": "https://stackoverflow.com/questions/29981710/invalid-operation-index-of-type-int-golang/29981832#29981832", "title": "Invalid operation: index of type *int golang", "body": "<p>You are creating a new local variable b which is a pointer on the line before you get the error:</p>\n\n<pre><code>b := &amp;b[col][N - row - 1]\n</code></pre>\n"}], "owner": {"reputation": 620, "user_id": 2303172, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/B3J3L.png?s=128&g=1", "display_name": "Jurko Guba", "link": "https://stackoverflow.com/users/2303172/jurko-guba"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 434, "favorite_count": 0, "accepted_answer_id": 29981820, "answer_count": 2, "score": 0, "last_activity_date": 1430456418, "creation_date": 1430455473, "question_id": 29981710, "link": "https://stackoverflow.com/questions/29981710/invalid-operation-index-of-type-int-golang", "title": "Invalid operation: index of type *int golang", "body": "<p><strong>Objective:</strong> I have been solving question 6 from the book 'Cracking the Coding interview' by using Go. </p>\n\n<p><strong>NOTE I DO NOT WAN'T HELP OR SOLUTIONS TO THIS QUESTION</strong></p>\n\n<p>Given an image represented by an NxN matrix, where each pixel in the image is 4\nbytes, write a method to rotate the image by 90 degrees. Can you do this in place?</p>\n\n<p><strong>Problem:</strong> I made an array of arrays to represent the matrix and I created a swap function to swap the elements clockwise in the matrix. For some reason I get this really weird error when trying to compile:</p>\n\n<pre><code>./Q6.go:29: invalid operation: b[N - col - 1] (index of type *int)\n./Q6.go:30: invalid operation: b[N - row - 1] (index of type *int)\n</code></pre>\n\n<p>Where am I getting type *int as an index? In the Go documenation, len(v) returns type int and everything else is in the value of 'N - col - 1' is type int so how am I getting type *int index?</p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    b := [][]int{{1, 2, 3, 4}, {5, 6, 7, 8}, {9, 10, 11, 12}, {13, 14, 15, 16}} // 4 by 4 array going from 1 to 16\n    N := len(b)\n\n    for row := 0; row &lt; N / 2; row++ {\n        for col := row; col &lt; N - row - 1; col++ {\n            a := &amp;b[row][col]\n            b := &amp;b[col][N - row - 1]\n            c := &amp;b[N - col - 1][col] // &lt;-- Error here\n            d := &amp;b[N - row - 1][N - col - 1] // &lt;-- Error here\n            fourSwap(a, b, c, d)\n        }\n    }\n\n    for r := range b {\n        for c:= range b[0] {\n            fmt.Print(b[r][c])\n        }\n        fmt.Print(\"\\n\")\n    }\n\n}\n\n// [a][-][-][b]     [c][-][-][a]\n// [-][-][-][-] --&gt; [-][-][-][-]\n// [-][-][-][-] --&gt; [-][-][-][-]\n// [c][-][-][d]     [d][-][-][b]\n\nfunc fourSwap(a, b, c, d *int) {\n    temp := *b\n    *b = *a\n    *a = *c\n    *c = *d\n    *d = temp\n}\n</code></pre>\n"}, {"tags": ["go", "synchronization"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430451325, "post_id": 29981050, "comment_id": 48082025, "body": "I&#39;m not sure how it works on other operating systems .. but generally a lock is acquired while writing to StdOut on Windows at least at line breaks."}, {"owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430451410, "post_id": 29981050, "comment_id": 48082052, "body": "@SimonWhitehead So you&#39;re saying that the operating system might be handling the lock at a lower level and that it might not be directly handled in go."}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 15, "last_activity_date": 1430451975, "creation_date": 1430451975, "answer_id": 29981337, "question_id": 29981050, "link": "https://stackoverflow.com/questions/29981050/concurrent-writing-to-a-file/29981337#29981337", "title": "Concurrent writing to a file", "body": "<p>There are many ways to control concurrent access. The easiest is to use a <a href=\"http://golang.org/pkg/sync/#Mutex\" rel=\"noreferrer\">Mutex</a>:</p>\n\n<pre><code>var mu sync.Mutex\n\nfunc WriteToFile( i int, f *os.File, w *sync.WaitGroup ){\n    mu.Lock()\n    defer mu.Unlock()\n    // etc...\n}\n</code></pre>\n\n<p>As to why you're not seeing problems, Go uses operating system calls to implement file access, and those system calls are <a href=\"http://man7.org/linux/man-pages/man2/write.2.html\" rel=\"noreferrer\">thread safe</a> (emphasis added):</p>\n\n<blockquote>\n  <p>According to POSIX.1-2008/SUSv4 Section XSI 2.9.7 (\"Thread Interactions with Regular File Operations\"):</p>\n  \n  <blockquote>\n    <p>All of the following functions shall be atomic with respect to\n      each other in the effects specified in POSIX.1-2008 when they\n      operate on regular files or symbolic links: ...</p>\n  </blockquote>\n  \n  <p>Among the APIs subsequently listed are write() and writev(2).  And\n    among the effects that should be atomic across threads (and\n    processes) are updates of the file offset.  However, on Linux before\n    version 3.14, this was not the case: if two processes that share an\n    open file description (see open(2)) perform a write() (or writev(2))\n    at the same time, then the I/O operations were not atomic with\n    respect updating the file offset, with the result that the blocks of\n    data output by the two processes might (incorrectly) overlap.  <strong>This\n    problem was fixed in Linux 3.14.</strong> </p>\n</blockquote>\n\n<p>I would still use a lock though, since Go code is not automatically thread safe. (two goroutines modifying the same variable will result in strange behavior)</p>\n"}, {"comments": [{"owner": {"reputation": 3318, "user_id": 793459, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/473585fcd84f96d5ee2b1c52adba3a5c?s=128&d=identicon&r=PG", "display_name": "Peiti Li", "link": "https://stackoverflow.com/users/793459/peiti-li"}, "edited": false, "score": 0, "creation_date": 1616603270, "post_id": 29991600, "comment_id": 118056195, "body": "wondering what does CSP stand for?"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 3318, "user_id": 793459, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/473585fcd84f96d5ee2b1c52adba3a5c?s=128&d=identicon&r=PG", "display_name": "Peiti Li", "link": "https://stackoverflow.com/users/793459/peiti-li"}, "edited": false, "score": 0, "creation_date": 1616664002, "post_id": 29991600, "comment_id": 118075087, "body": "Communicating Sequential Processes (<a href=\"https://en.wikipedia.org/wiki/Communicating_sequential_processes\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Communicating_sequential_processes</a>) - a process algebra from Tony Hoare at Oxford University"}, {"owner": {"reputation": 2301, "user_id": 3448879, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/y7XPi.png?s=128&g=1", "display_name": "Jairo Lozano", "link": "https://stackoverflow.com/users/3448879/jairo-lozano"}, "edited": false, "score": 0, "creation_date": 1617046665, "post_id": 29991600, "comment_id": 118187536, "body": "Inside the service goroutine, would you open/close the file every time a new message comes in? or would you leave it open for as long as the goroutine lives?"}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1617093471, "post_id": 29991600, "comment_id": 118199837, "body": "That depends on the application, but the &#39;normal&#39; case would involve opening the file once at the start, then ranging over the messages on the input channel, writing each one to the file. When the channel has closed then the file can be closed."}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 38, "last_activity_date": 1430500429, "creation_date": 1430500429, "answer_id": 29991600, "question_id": 29981050, "link": "https://stackoverflow.com/questions/29981050/concurrent-writing-to-a-file/29991600#29991600", "title": "Concurrent writing to a file", "body": "<p>A simple approach to controlling concurrent access is via a service goroutine, receiving messages from a channel. This goroutine would have sole access to the file. Access would therefore be sequential, without any race problems.</p>\n\n<p>Channels do a good job of interleaving requests. The clients write to the channel instead of directly to the file. Messages on the channel are automatically interleaved for you.</p>\n\n<p>The benefit of this approach over simply using a Mutex is that you start viewing your program as a collection of microservices. This is the CSP way and leads to easy composition of large systems from smaller components.</p>\n"}], "owner": {"reputation": 3498, "user_id": 528578, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/Qgscj.png?s=128&g=1", "display_name": "Jerry Saravia", "link": "https://stackoverflow.com/users/528578/jerry-saravia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 17675, "favorite_count": 4, "accepted_answer_id": 29981337, "answer_count": 2, "score": 15, "last_activity_date": 1430500429, "creation_date": 1430449184, "last_edit_date": 1430453347, "question_id": 29981050, "link": "https://stackoverflow.com/questions/29981050/concurrent-writing-to-a-file", "title": "Concurrent writing to a file", "body": "<p>In go, how can I control the concurrent writing to a text file?</p>\n\n<p>I ask this because I will have multiple goroutines writing to a text file using the same file handler.</p>\n\n<p>I wrote this bit of code to try and see what happens but I'm not sure if I did it \"right\":</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"sync\"\n    \"fmt\"\n    \"time\"\n    \"math/rand\"\n    \"math\"\n)\n\n\nfunc WriteToFile( i int, f *os.File, w *sync.WaitGroup ){\n    //sleep for either 200 or 201 milliseconds\n    randSleep := int( math.Floor( 200 + ( 2 * rand.Float64() ) ) )\n    fmt.Printf( \"Thread %d waiting %d\\n\", i, randSleep )\n    time.Sleep( time.Duration(randSleep) * time.Millisecond )\n\n    //write to the file\n    fmt.Fprintf( f, \"Printing out: %d\\n\", i )\n    //write to stdout\n    fmt.Printf( \"Printing out: %d\\n\", i )\n    w.Done()\n}\n\nfunc main() {\n    rand.Seed( time.Now().UnixNano() )\n\n    d, err := os.Getwd()\n    if err != nil {\n        fmt.Println( err )\n    }\n    filename := d + \"/log.txt\"\n\n    f, err := os.OpenFile( filename, os.O_CREATE | os.O_WRONLY | os.O_TRUNC, 0666 )\n\n    if err != nil {\n        fmt.Println( err )\n    }\n    var w *sync.WaitGroup = new(sync.WaitGroup)\n    w.Add( 10 )\n\n    //start 10 writers to the file\n    for i:=1; i &lt;= 10; i++ {\n        go WriteToFile( i, f, w )\n    }\n\n    //wait for writers to finish\n    w.Wait()\n\n}\n</code></pre>\n\n<p>I half expected that the output would show something like this in the file instead of the coherent output I got:</p>\n\n<pre><code>Printing Printing out: 2\nout: 5\nPoriuntitng: 6\n</code></pre>\n\n<p>Essentially, I expected the characters to come out incoherently and interweaved due to a lack of synchronization. Did I not write code that would coax this behavior out? Or is some mechanism during calls to <code>fmt.Fprintf</code> synchronizing the writing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430439903, "post_id": 29979858, "comment_id": 48079430, "body": "Did you want: <a href=\"https://play.golang.org/p/IwuO7b5kPG\" rel=\"nofollow noreferrer\">play.golang.org/p/IwuO7b5kPG</a> ?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430440269, "post_id": 29979858, "comment_id": 48079527, "body": "In particular, your <code>handler</code> type is &quot;a function that takes a function that takes an <code>int</code>&quot; which seems like an extra level of wrapping compared to your comment out calls of just <code>h(5)</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430440558, "post_id": 29979858, "comment_id": 48079594, "body": "If you <i>really</i> did want <code>func(func(int))</code> for some reason: <a href=\"https://play.golang.org/p/yRzZSuEXgs\" rel=\"nofollow noreferrer\">play.golang.org/p/yRzZSuEXgs</a>"}, {"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430440564, "post_id": 29979858, "comment_id": 48079596, "body": "Hello Dave, thank you for your comment. No I was trying to better understand closures. And yes I want a function that takes a function that takes an int. So am not looking for the code above, but something to the extent of    func(func(b int)"}, {"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430444731, "post_id": 29979858, "comment_id": 48080558, "body": "@DaveC can you please tell me why this isn&#39;t running <a href=\"http://play.golang.org/p/5tUhd4yi7K\" rel=\"nofollow noreferrer\">play.golang.org/p/5tUhd4yi7K</a> ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1430465932, "post_id": 29979858, "comment_id": 48085745, "body": "@Marin compare the location of brackets in your code and in example who gave you DaveC"}], "answers": [{"comments": [{"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "edited": false, "score": 0, "creation_date": 1430507781, "post_id": 29980691, "comment_id": 48106368, "body": "Thank you Roma for all the examples. funcArg is deemed as not a type when you run the first example. But isn&#39;t funcArg (maps to func(b int) ) part of the type definition above?"}, {"owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "edited": false, "score": 0, "creation_date": 1430512908, "post_id": 29980691, "comment_id": 48109074, "body": "The last example was perfect! That was exactly what I needed"}], "tags": [], "owner": {"reputation": 446, "user_id": 1368121, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1a8fb4fc57f3e3a75758c06a64604f82?s=128&d=identicon&r=PG", "display_name": "Roma", "link": "https://stackoverflow.com/users/1368121/roma"}, "is_accepted": true, "score": 0, "last_activity_date": 1430446219, "creation_date": 1430446219, "answer_id": 29980691, "question_id": 29979858, "link": "https://stackoverflow.com/questions/29979858/closures-in-go-declaring-functions-that-take-functions-as-parameters/29980691#29980691", "title": "Closures in Go - declaring functions that take functions as parameters", "body": "<p>To see why it won't compile it might be helpful to pull your innermost function out into an argument as shown at <a href=\"https://play.golang.org/p/QPBturZ6GG\" rel=\"nofollow\">https://play.golang.org/p/QPBturZ6GG</a></p>\n\n<p>I think you are looking for something like the following, but it won't do much \n<a href=\"https://play.golang.org/p/2tEEwoZRC6\" rel=\"nofollow\">https://play.golang.org/p/2tEEwoZRC6</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype handler func(a func(b int))\n\nfunc HandleSomething(h handler) {\n    //...\n    //d := h(5)\n    //h(5)\n    // ...\n}\n\nfunc main() {\n    var foo int\n    HandleSomething(handler(func(a func(b int)) {\n        //This doesn't make sense as you don't have access to b\n        //fmt.Printf(\"debug: foo in main is %d and %d\", foo, b)\n        fmt.Printf(\"debug: foo in main is %d\", foo)\n\n        //You can call your function argument like\n        a(6)\n        a(7)\n    }))\n}\n</code></pre>\n\n<p>The following example might give you something more to play with</p>\n\n<p><a href=\"https://play.golang.org/p/BuxA8JXibG\" rel=\"nofollow\">https://play.golang.org/p/BuxA8JXibG</a></p>\n"}], "owner": {"reputation": 11061, "user_id": 419730, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UwQpu.png?s=128&g=1", "display_name": "Marin", "link": "https://stackoverflow.com/users/419730/marin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 62, "favorite_count": 0, "accepted_answer_id": 29980691, "answer_count": 1, "score": 0, "last_activity_date": 1430446219, "creation_date": 1430439307, "question_id": 29979858, "link": "https://stackoverflow.com/questions/29979858/closures-in-go-declaring-functions-that-take-functions-as-parameters", "title": "Closures in Go - declaring functions that take functions as parameters", "body": "<p>I've been trying to figure out why this is not working but am not sure. The error in the sandbox is </p>\n\n<pre><code>main.go:16: syntax error: unexpected {, expecting )   \n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype handler func(a func(b int))\n\nfunc HandleSomething(h handler)  {\n    //...\n    //d := h(5)\n//h(5)\n    // ...\n}\n\nfunc main() {\n    var foo int\n    HandleSomething(handler(func(func(b int){\n            fmt.Printf(\"debug: foo in main is %d and %d\", foo, b)\n    })))\n}\n</code></pre>\n"}, {"tags": ["go", "embedding", "composite-literals"], "comments": [{"owner": {"reputation": 16259, "user_id": 115363, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/49cf5d5ff161eed26b99e75694299fe1?s=128&d=identicon&r=PG", "display_name": "inanc", "link": "https://stackoverflow.com/users/115363/inanc"}, "edited": false, "score": 0, "creation_date": 1498392388, "post_id": 29979056, "comment_id": 76473207, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/33098460/getting-error-unknown-field-in-struct-literal\">Getting error: unknown field in struct literal</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1430436613, "post_id": 29979419, "comment_id": 48078505, "body": "Apt quote from the spec :). But I don&#39;t follow your guess at the reason. I don&#39;t see the big difference to supporting <code>b := B{FName:&quot;x&quot;, &quot;LName:&quot;y&quot;}</code> given than it supports <code>b := B{}; b.FName=&quot;x&quot;; b.LName=&quot;y&quot;</code>."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430438019, "post_id": 29979419, "comment_id": 48078903, "body": "Yeah that quote clearly states my code won&#39;t compile. I agree with @DaveC though... If it was a conscious design decision, it was the wrong one. Dave&#39;s comment points out my MAJOR problem with the design. On one line I access the field without complaint, on another the compiler claims it doesn&#39;t exist on that struct. That&#39;s fundamentally a contradiction."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430438982, "post_id": 29979419, "comment_id": 48079156, "body": "@Not_a_Golfer, great addition/edit. It makes sense that there should be no issue with the compiler doing the assignments in a composite literal in whatever order it feels like. Having to explicitly say either <code>B.X=2; B.A=a</code> <i>or</i> <code>B.A=a; B.X=2</code> on the other hand makes it unambiguous/clear."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1430438359, "last_edit_date": 1430438359, "creation_date": 1430436133, "answer_id": 29979419, "question_id": 29979056, "link": "https://stackoverflow.com/questions/29979056/composite-literal-and-fields-from-an-embedded-type/29979419#29979419", "title": "Composite literal and fields from an embedded type", "body": "<p>It's not a compiler <em>bug</em> but a design decision. The language spec just states:</p>\n\n<blockquote>\n  <p>Promoted fields act like ordinary fields of a struct except that they cannot be used as field names in composite literals of the struct.</p>\n</blockquote>\n\n<p>I guess the reasoning behind this is to avoid ambiguity. There are a few rules to resolve name conflicts when using selectors, and they would have to be complicated in order to allow what you're suggesting. On top of that, it might create ambiguity if you're using an existing instance of an embedded struct inside a struct literal of the embedding type. </p>\n\n<p>EDIT: Here's an example where this approach might backfire:</p>\n\n<p>Think of a case where you have A embedding B, and an instance of A you want to embed:</p>\n\n<pre><code>type A {\n   X int\n}\n\ntype B {\n   A\n}\n</code></pre>\n\n<p>It's simple enough to do</p>\n\n<pre><code>b := B{ X: 1 } \n</code></pre>\n\n<p>And infer what should be done.\nBut what if we already have an instance of A? This doesn't make sense:</p>\n\n<pre><code>a := A { X: 1 }\n\nb := B { X: 2, A: a, } \n</code></pre>\n\n<p>are you first assigning 2 to a zero instance of A and then assigning the initialized instance of A over it? And is it identical to:</p>\n\n<pre><code>b := B { A: a, X: 2 }  ?\n</code></pre>\n\n<p>It breaks the assumption that initialization order is irrelevant in a composite literal with field names.</p>\n"}], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 994, "favorite_count": 0, "accepted_answer_id": 29979419, "answer_count": 1, "score": 0, "last_activity_date": 1430438359, "creation_date": 1430433956, "last_edit_date": 1430435140, "question_id": 29979056, "link": "https://stackoverflow.com/questions/29979056/composite-literal-and-fields-from-an-embedded-type", "title": "Composite literal and fields from an embedded type", "body": "<p>I was working on a sample program to answer another question here on SO and found myself somewhat baffled by the fact that the following code will not compile; </p>\n\n<p><a href=\"https://play.golang.org/p/wxBGcgfs1o\" rel=\"nofollow\">https://play.golang.org/p/wxBGcgfs1o</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype A struct {\n    FName string\n    LName string\n}\n\ntype B struct {\n    A\n}\n\nfunc (a *A) Print() {\n     fmt.Println(a.GetName())\n}\n\nfunc (a *A) GetName() string {\n     return a.FName\n}\n\nfunc (b *B) GetName() string {\n     return b.LName\n}\n\nfunc main() {\n    a := &amp;A{FName:\"evan\", LName:\"mcdonnal\"}\n    b := &amp;B{FName:\"evan\", LName:\"mcdonnal\"}\n\n    a.Print()\n    b.Print()\n}\n</code></pre>\n\n<p>The error is;</p>\n\n<pre><code>/tmp/sandbox596198095/main.go:28: unknown B field 'FName' in struct literal\n/tmp/sandbox596198095/main.go:28: unknown B field 'LName' in struct literal\n</code></pre>\n\n<p>Is it possible to set the value of fields from an embedded type in a static initializer? How? To me this seems like a compiler bug; if I didn't have the sources in front of me and was familiar with type I would be beating my head against a wall saying \"clearly FName exists on B what is the compiler saying!?!?!\".</p>\n\n<p>Quickly, to preempt typical answers I am aware that the closest working syntax is this <code>b := &amp;B{A{FName:\"evan\", LName:\"mcdonnal\"}}</code> but that syntax is in my opinion conceptually contradictory to embedding so I would be disappointed if it is the only option. If this is the only way, is it a short coming of the Go compiler or is there actually a theoretical limitation that would prevent a compiler from interpreting the syntax in my non-working example?</p>\n"}, {"tags": ["dictionary", "struct", "go", "key", "slice"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430435201, "post_id": 29978855, "comment_id": 48078051, "body": "Perhaps use a hash as the key? E.g. <a href=\"https://play.golang.org/p/zzvF2EVxrk\" rel=\"nofollow noreferrer\">play.golang.org/p/zzvF2EVxrk</a> only better. Basically, make a method on your type that returns something usable as a map key."}, {"owner": {"reputation": 1188, "user_id": 625518, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1a276a14c6e9f315b8928d0392ff4cd9?s=128&d=identicon&r=PG", "display_name": "foob", "link": "https://stackoverflow.com/users/625518/foob"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430491469, "post_id": 29978855, "comment_id": 48097379, "body": "Thanks Dave, this is definitely a solution that works. It does seem a little bit hackish, but I don&#39;t know of any better approach."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430491900, "post_id": 29978855, "comment_id": 48097636, "body": "The hack in the code linked is only in how the key is being generated (I just did something ugly as a demo). It&#39;s up to you to figure out a way to generate a unique key per item for your own data set. If that doesn&#39;t fit for you then you need to look for an alternative."}], "answers": [{"comments": [{"owner": {"reputation": 1188, "user_id": 625518, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1a276a14c6e9f315b8928d0392ff4cd9?s=128&d=identicon&r=PG", "display_name": "foob", "link": "https://stackoverflow.com/users/625518/foob"}, "edited": false, "score": 0, "creation_date": 1430449113, "post_id": 29980814, "comment_id": 48081543, "body": "Unfortunately, I won&#39;t know the size of the slices at compile time so this isn&#39;t an option for this specific case."}], "tags": [], "owner": {"reputation": 587, "user_id": 3587115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/veo3Q.jpg?s=128&g=1", "display_name": "Sundrique", "link": "https://stackoverflow.com/users/3587115/sundrique"}, "is_accepted": false, "score": 0, "last_activity_date": 1430447260, "creation_date": 1430447260, "answer_id": 29980814, "question_id": 29978855, "link": "https://stackoverflow.com/questions/29978855/whats-the-idiomatic-way-to-use-a-struct-containing-a-slice-field-as-a-map-key-i/29980814#29980814", "title": "What&#39;s the idiomatic way to use a struct containing a slice field as a map key in Go?", "body": "<p>You cannot use slice as a map key, but if you know the size of such slices, you may use arrays instead. Arrays are allowed to be map keys.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    m := make(map[[2]int]int)\n\n    m[[2]int{1, 2}] = 3\n    m[[2]int{3, 4}] = 1\n\n    fmt.Println(m)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/NnzkRJcq3I\" rel=\"nofollow\">Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 327, "user_id": 895931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/96864e378f03cab7a18fa31674f550d6?s=128&d=identicon&r=PG", "display_name": "Alaska", "link": "https://stackoverflow.com/users/895931/alaska"}, "is_accepted": false, "score": 0, "last_activity_date": 1430836128, "last_edit_date": 1430836128, "creation_date": 1430773620, "answer_id": 30039980, "question_id": 29978855, "link": "https://stackoverflow.com/questions/29978855/whats-the-idiomatic-way-to-use-a-struct-containing-a-slice-field-as-a-map-key-i/30039980#30039980", "title": "What&#39;s the idiomatic way to use a struct containing a slice field as a map key in Go?", "body": "<p>Even if you defined slice equality in terms of \"same ptr, cap and len\", what you want still wouldn't work as the slices in your example point to different underlying memory, so a deep analysis would be necessary and ruin the speed of map access.</p>\n\n<p>Even if there was an interface called <code>Hasher</code> that you could implement and make your type mappable, your example would still require an element-by element inspection, memoization of the resultant hash, and some method of tracking whether or not the slice had changed.  I'd probably recommend you just use a \n<code>map[*ContainerStruct]int</code> and just deal with the fact that, conceptually, you might have two distinct structure pointers that have slice members with identical data.</p>\n\n<p>Given all this, I'd probably recommend rearchitecting first, and, failing that, Dave C.'s suggestion above, along with some kind of memoization of the hash value and some way to track when it needs to be re-computed.</p>\n"}], "owner": {"reputation": 1188, "user_id": 625518, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1a276a14c6e9f315b8928d0392ff4cd9?s=128&d=identicon&r=PG", "display_name": "foob", "link": "https://stackoverflow.com/users/625518/foob"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 383, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1430836128, "creation_date": 1430432775, "question_id": 29978855, "link": "https://stackoverflow.com/questions/29978855/whats-the-idiomatic-way-to-use-a-struct-containing-a-slice-field-as-a-map-key-i", "title": "What&#39;s the idiomatic way to use a struct containing a slice field as a map key in Go?", "body": "<p>I have a struct that contains a slice and I would like to use it as a key to a map. I understand that this is not allowed because equality is not currently defined for slices in Go. I also know that I can't override equality for the struct to do the slice comparison by hand. My question is: what is the most idiomatic way to accomplish what I'm trying to do here?</p>\n\n<p>This is a bit of example code that makes the structure more clear:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype InternalStruct struct {\n    item1, item2 bool\n}\n\ntype ContainerStruct struct {\n    internals []InternalStruct\n}\n\nfunc main() {\n    container1 := ContainerStruct{}\n    container1.internals = append(container1.internals, InternalStruct{item1: true})\n\n    container2 := ContainerStruct{}\n    container2.internals = append(container2.internals, InternalStruct{item1: true})\n\n    m := make(map[ContainerStruct]int)\n    m[container1] = 10\n\n    fmt.Printf(\"container1 maps to: %d\\n\", m[container1])\n    fmt.Printf(\"container1 maps to: %d\\n\", m[container2])\n}\n</code></pre>\n\n<p>This code doesn't compile (as expected), but I'm looking for something equivalent that would output \"10\" twice. What's the best way to go about achieving this result?</p>\n"}, {"tags": ["json", "go", "stream", "decode"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1430435654, "post_id": 29978394, "comment_id": 48078196, "body": "Yeah, if you know the format will be this, &quot;pre-parsing&quot; to extract and decode an object at a time sounds as good as any approach to me. And that&#39;s some solid sample text. :)"}, {"owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1430436775, "post_id": 29978394, "comment_id": 48078567, "body": "The sample text is from the Go docs- actually didn&#39;t read it until now!"}], "answers": [{"comments": [{"owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 0, "creation_date": 1430522442, "post_id": 29981531, "comment_id": 48112582, "body": "This is great, but I&#39;m looking for something that will handle nested objects with arbitrary structure. I&#39;ll update the question and add to your code if I can figure it out."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 1, "last_activity_date": 1430453824, "creation_date": 1430453824, "answer_id": 29981531, "question_id": 29978394, "link": "https://stackoverflow.com/questions/29978394/unmarshal-a-json-stream-not-newline-separated/29981531#29981531", "title": "Unmarshal a json stream (not newline-separated)", "body": "<p>You can use a streaming parser. For example <a href=\"https://github.com/benbjohnson/megajson/tree/master/scanner\" rel=\"nofollow\">megajson's scanner</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n\n    \"github.com/benbjohnson/megajson/scanner\"\n)\n\nfunc main() {\n    // our incoming data\n    rdr := strings.NewReader(`[\n        {\"Name\": \"Ed\", \"Text\": \"Knock knock.\"},\n        {\"Name\": \"Sam\", \"Text\": \"Who's there?\"},\n        {\"Name\": \"Ed\", \"Text\": \"Go fmt.\"},\n        {\"Name\": \"Sam\", \"Text\": \"Go fmt who?\"},\n        {\"Name\": \"Ed\", \"Text\": \"Go fmt yourself!\"}\n    ]`)\n\n    // we want to create a list of these\n    type Object struct {\n        Name string\n        Text string\n    }\n    objects := make([]Object, 0)\n\n    // scan the JSON as we read\n    s := scanner.NewScanner(rdr)\n\n    // this is how we keep track of where we are parsing the JSON\n    // if you needed to support nested objects you would need to\n    // use a stack here ([]state{}) and push / pop each time you\n    // see a brace\n    var state struct {\n        inKey   bool\n        lastKey string\n        object  Object\n    }\n    for {\n        tok, data, err := s.Scan()\n        if err != nil {\n            break\n        }\n\n        switch tok {\n        case scanner.TLBRACE:\n            // just saw '{' so start a new object\n            state.inKey = true\n            state.lastKey = \"\"\n            state.object = Object{}\n        case scanner.TRBRACE:\n            // just saw '}' so store the object\n            objects = append(objects, state.object)\n        case scanner.TSTRING:\n            // for `key: value`, we just parsed 'key'\n            if state.inKey {\n                state.lastKey = string(data)\n            } else {\n                // now we are on `value`\n                if state.lastKey == \"Name\" {\n                    state.object.Name = string(data)\n                } else {\n                    state.object.Text = string(data)\n                }\n            }\n            state.inKey = !state.inKey\n        }\n    }\n    fmt.Println(objects)\n}\n</code></pre>\n\n<p>This is probably as efficient as you can get, but it does require a lot of manual processing.</p>\n"}, {"comments": [{"owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 1, "creation_date": 1471987216, "post_id": 39100998, "comment_id": 65569143, "body": "step 3 is dangerous: <code>load some chars, and find the first &quot;}&quot;</code> If the &quot;}&quot; is within a quote, we don&#39;t want to stop scanning there. Example: <code>{&quot;key&quot;: &quot;value with }} brackets&quot;}</code>. The pseudocode you provided is for a naive parser, but what&#39;s needed is a full-fledged parser."}, {"owner": {"reputation": 1, "user_id": 6747871, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8ea6ceb35d463a86158e80e7d64a5090?s=128&d=identicon&r=PG", "display_name": "Yujian", "link": "https://stackoverflow.com/users/6747871/yujian"}, "reply_to_user": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "edited": false, "score": 0, "creation_date": 1472096289, "post_id": 39100998, "comment_id": 65617453, "body": "yes, step 3 is dangerous, but step 4/5/6 will guarantee the work corrent."}], "tags": [], "owner": {"reputation": 1, "user_id": 6747871, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8ea6ceb35d463a86158e80e7d64a5090?s=128&d=identicon&r=PG", "display_name": "Yujian", "link": "https://stackoverflow.com/users/6747871/yujian"}, "is_accepted": false, "score": 0, "last_activity_date": 1471954697, "creation_date": 1471954697, "answer_id": 39100998, "question_id": 29978394, "link": "https://stackoverflow.com/questions/29978394/unmarshal-a-json-stream-not-newline-separated/39100998#39100998", "title": "Unmarshal a json stream (not newline-separated)", "body": "<p>Assume the json stream like:</p>\n\n<pre><code>{\"Name\": \"Ed\", \"Text\": \"Knock knock.\"}{\"Name\": \"Sam\", \"Text\": \"Who's there?\"}{\"Name\": \"Ed\", \"Text\": \"Go fmt.\"}\n</code></pre>\n\n<p>I have idea, pseudo code like below:</p>\n\n<pre><code>1: skip prefix whitespace\n2: if first char not {, throw error\n3: load some chars, and find the first \"}\"\n    4: if found, try json.Unmarshal()\n        5: if unmarshal fail, load more chars, and find second \"}\"\n             6: redo STEP 4\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 6747871, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/8ea6ceb35d463a86158e80e7d64a5090?s=128&d=identicon&r=PG", "display_name": "Yujian", "link": "https://stackoverflow.com/users/6747871/yujian"}, "is_accepted": false, "score": 0, "last_activity_date": 1472097839, "last_edit_date": 1472097839, "creation_date": 1472096722, "answer_id": 39136366, "question_id": 29978394, "link": "https://stackoverflow.com/questions/29978394/unmarshal-a-json-stream-not-newline-separated/39136366#39136366", "title": "Unmarshal a json stream (not newline-separated)", "body": "<p>Below is an implementation, already working in my project:</p>\n\n<pre><code>package json\n\nimport (\n    \"bytes\"\n    j \"encoding/json\"\n    \"errors\"\n    \"io\"\n    \"strings\"\n)\n\n// Stream represent a json stream\ntype Stream struct {\n    stream *bytes.Buffer\n    object *bytes.Buffer\n    scrap  *bytes.Buffer\n}\n\n// NewStream return a Stream that based on src\nfunc NewStream(src []byte) *Stream {\n    return &amp;Stream{\n        stream: bytes.NewBuffer(src),\n        object: new(bytes.Buffer),\n        scrap:  new(bytes.Buffer),\n    }\n}\n\n// Read read a json object\nfunc (s *Stream) Read() ([]byte, error) {\n    var obj []byte\n\n    for {\n        // read a rune from stream\n        r, _, err := s.stream.ReadRune()\n        switch err {\n        case nil:\n        case io.EOF:\n            if strings.TrimSpace(s.object.String()) != \"\" {\n                return nil, errors.New(\"Invalid JSON\")\n            }\n\n            fallthrough\n        default:\n            return nil, err\n        }\n\n        // write the rune to object buffer\n        if _, err := s.object.WriteRune(r); err != nil {\n            return nil, err\n        }\n\n        if r == '}' {\n            obj = s.object.Bytes()\n\n            // check whether json string valid\n            err := j.Compact(s.scrap, obj)\n            s.scrap.Reset()\n            if err != nil {\n                continue\n            }\n\n            s.object.Reset()\n\n            break\n        }\n    }\n\n    return obj, nil\n}\n</code></pre>\n\n<p>Usage like below:</p>\n\n<pre><code>func process(src []byte) error {\n    s := json.NewStream(src)\n\n    for {\n        obj, err := s.Read()\n        switch err {\n        case nil:\n        case io.EOF:\n            return nil \n        default:\n            return err \n        }   \n\n        // now you can try to decode the obj to a struct/map/...\n        // it is also support mix stream, ex.:\n        a = new(TypeOne)\n        b = new(TypeTwo)\n        if err := j.Unmarshal(obj, a); err == nil &amp;&amp; a.Error != \"\" {\n             // it is a TypeOne object\n        } else if err := j.Unmarshal(obj, b); err == nil &amp;&amp; a.ID != \"\" {\n             // it is a TypeTwo object\n        } else {\n             // unkown type\n        }\n    }\n\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 10154, "user_id": 2482570, "user_type": "registered", "accept_rate": 73, "profile_image": "https://i.stack.imgur.com/1U8oq.jpg?s=128&g=1", "display_name": "Max Heiber", "link": "https://stackoverflow.com/users/2482570/max-heiber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1079, "favorite_count": 0, "answer_count": 3, "score": 3, "last_activity_date": 1472097839, "creation_date": 1430430465, "last_edit_date": 1592644375, "question_id": 29978394, "link": "https://stackoverflow.com/questions/29978394/unmarshal-a-json-stream-not-newline-separated", "title": "Unmarshal a json stream (not newline-separated)", "body": "<p>I want to turn a stream of JSON into a stream of objects. This is easy to do with newline-separated JSON. From the Go docs: <a href=\"https://golang.org/pkg/encoding/json/#Decoder.Buffered\" rel=\"nofollow noreferrer\">https://golang.org/pkg/encoding/json/#Decoder.Buffered</a></p>\n<p>However, I need to generate a stream from JSON arrays like this one:</p>\n<pre><code>        [{&quot;Name&quot;: &quot;Ed&quot;, &quot;Text&quot;: &quot;Knock knock.&quot;},\n        {&quot;Name&quot;: &quot;Sam&quot;, &quot;Text&quot;: &quot;Who's there?&quot;},\n        {&quot;Name&quot;: &quot;Ed&quot;, &quot;Text&quot;: &quot;Go fmt.&quot;},\n        {&quot;Name&quot;: &quot;Sam&quot;, &quot;Text&quot;: &quot;Go fmt who?&quot;},\n        {&quot;Name&quot;: &quot;Ed&quot;, &quot;Text&quot;: &quot;Go fmt yourself!&quot;}]\n</code></pre>\n<p>What is a performant way to do this?</p>\n<p>I've considered this method:</p>\n<ol>\n<li>Drop the outside angle brackets</li>\n<li>When there are matching top-level curly braces, unmarshal the string between the braces (inclusive) to get one top-level object at a time.</li>\n</ol>\n<p>I don't want to do it because of the performance implications of scanning each portion of the string twice.</p>\n<p>The best alternative I can thing of is to copy the source code for the decoder in the Golang encoding/json package and modify it so it returns a Reader that spits out one object at a time. But that seems like too much work for such a simple requirement.</p>\n<p>Is there a better way to decode a stream that is a JSON array?</p>\n<h2>EDIT</h2>\n<p>I'm looking to parse JSON with nested objects and arbitrary structure.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "edited": false, "score": 3, "creation_date": 1430421690, "post_id": 29976025, "comment_id": 48071787, "body": "Obvious to you, but maybe not the next guy working on your code :) Isn&#39;t it possible to check the Go byte code to see if there&#39;s any optimization done by the compiler?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 6, "creation_date": 1430421693, "post_id": 29976025, "comment_id": 48071788, "body": "To know for sure what is happening you&#39;d need to look at the compiler output, perhaps with <code>go build -gcflags=&quot;-S&quot;</code>."}, {"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 4, "creation_date": 1430421732, "post_id": 29976025, "comment_id": 48071809, "body": "Have you tried any benchmarks? These sorts of optimizations have been standard in compilers for at least two decades. Write code that makes sense and let the compiler optimize. If you have a situation where the compiler can&#39;t deal, write a comment in the form of an apology as to why you&#39;re writing such odd code."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430421968, "post_id": 29976025, "comment_id": 48071951, "body": "E.g. you could examine the <code>go build -gcflags=&quot;-S&quot;</code> output from something simple like <a href=\"https://play.golang.org/p/KxkhL6hYzM\" rel=\"nofollow noreferrer\">this</a>. It would appear as if <code>a*2</code> is identical but the others are ever so slightly different (although I think equally as fast)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430422196, "post_id": 29976025, "comment_id": 48072057, "body": "And it appears as if those differences go away if the type is <code>uint</code> vs <code>int</code>, likely due to algorithmic vs logical shift."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430422252, "post_id": 29976025, "comment_id": 48072080, "body": "@DaveC thanks for a link. I will try it."}, {"owner": {"reputation": 13112, "user_id": 749622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NicQS.jpg?s=128&g=1", "display_name": "Cory Danielson", "link": "https://stackoverflow.com/users/749622/cory-danielson"}, "edited": false, "score": 6, "creation_date": 1430422403, "post_id": 29976025, "comment_id": 48072155, "body": "<code>because these techniques are so obvious, that it is not even optimization and more like a matter of preferences how to write code.</code> If these techniques are so obvious, why did you have to do side-by-side comparisons in your question? hint hint"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 13112, "user_id": 749622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NicQS.jpg?s=128&g=1", "display_name": "Cory Danielson", "link": "https://stackoverflow.com/users/749622/cory-danielson"}, "edited": false, "score": 0, "creation_date": 1430441908, "post_id": 29976025, "comment_id": 48079934, "body": "@CoryDanielson I did it to explain what kind of microoptimization I am talking about. How would you expect me to write the question without mentioning them?"}, {"owner": {"reputation": 13112, "user_id": 749622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NicQS.jpg?s=128&g=1", "display_name": "Cory Danielson", "link": "https://stackoverflow.com/users/749622/cory-danielson"}, "edited": false, "score": 1, "creation_date": 1430443947, "post_id": 29976025, "comment_id": 48080351, "body": "I&#39;m pointing out the fact that this premature optimization is not as obvious as you&#39;re implying."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 13112, "user_id": 749622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NicQS.jpg?s=128&g=1", "display_name": "Cory Danielson", "link": "https://stackoverflow.com/users/749622/cory-danielson"}, "edited": false, "score": 0, "creation_date": 1430444038, "post_id": 29976025, "comment_id": 48080377, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/76690/discussion-between-salvador-dali-and-cory-danielson\">continue this discussion in chat</a>."}, {"owner": {"reputation": 13112, "user_id": 749622, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/NicQS.jpg?s=128&g=1", "display_name": "Cory Danielson", "link": "https://stackoverflow.com/users/749622/cory-danielson"}, "edited": false, "score": 3, "creation_date": 1430444184, "post_id": 29976025, "comment_id": 48080418, "body": "I really don&#39;t care too. The overwhelming sentiment among the comments seems to disagree with your opinion."}], "answers": [{"comments": [{"owner": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 7, "creation_date": 1430422984, "post_id": 29976386, "comment_id": 48072460, "body": "It&#39;s important to note here that the compiler correctly identifies cases where the optimization can be made, such as on unsigned ints, and avoids those where it cannot be done, such as signed ints where potentially shifting the sign bit would be completely wrong."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 193600, "user_id": 87189, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/98e7d6edce863e7a1bf8199b082eb25e?s=128&d=identicon&r=PG", "display_name": "tadman", "link": "https://stackoverflow.com/users/87189/tadman"}, "edited": false, "score": 1, "creation_date": 1430423400, "post_id": 29976386, "comment_id": 48072673, "body": "Actually, it&#39;s more than &quot;an instruction or two&quot;, but it doesn&#39;t have <code>DIVQ</code>, <code>MULQ</code>, or <code>IMULQ</code> that you see with &quot;normal&quot; math operations and as tadman rightly points out, they do need to be longer to be fully correct for signed integers."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 10, "last_activity_date": 1430424474, "last_edit_date": 1430424474, "creation_date": 1430422828, "answer_id": 29976386, "question_id": 29976025, "link": "https://stackoverflow.com/questions/29976025/is-go-compiler-smart-enough-to-pick-up-microoptimization/29976386#29976386", "title": "Is Go compiler smart enough to pick up microoptimization?", "body": "<p>Short answer, yes, the compiler optimises those.\nBut it does so slightly differently for <code>int</code> vs <code>uint</code> (and presumably any signed vs unsigned integer types such as <code>byte</code>).</p>\n\n<p>In both cases multiplication and division instructions are avoided but it's only a single instruction for unsigned integers (and a small number of instructions for signed integers).\nThat's because your pairs of statments are only exactly equivalent for unsigned integers and not for signed integers.</p>\n\n<p><strong>Longer answer:</strong></p>\n\n<p>Taking a simple program like:</p>\n\n<pre><code>package main\n\nfunc main() {}\n\nfunc div2(a int) {\n        b := a / 2\n        c := a &gt;&gt; 1\n        _, _ = b, c\n}\n\nfunc mul2(a int) {\n        b := a * 2\n        c := a &lt;&lt; 1\n        _, _ = b, c\n}\n\nfunc mod2(a int) {\n        b := a % 2\n        c := a &amp; 1\n        _, _ = b, c\n}\n</code></pre>\n\n<p>and running <code>go build -gcflags=\"-S\"</code> will give you assembly output such as:</p>\n\n<pre><code>\"\".mod2 t=1 size=32 value=0 args=0x8 locals=0x0\n        0x0000 00000 (\u2026/opt.go:17)       TEXT    \"\".mod2+0(SB),4,$0-8\n        \u2026\n        0x0000 00000 (\u2026/opt.go:17)       MOVQ    \"\".a+8(FP),BX\n        \u2026\n        0x0005 00005 (\u2026/opt.go:18)       MOVQ    BX,AX\n        0x0008 00008 (\u2026/opt.go:18)       SARQ    $63,AX\n        0x000c 00012 (\u2026/opt.go:18)       MOVQ    BX,DX\n        0x000f 00015 (\u2026/opt.go:18)       SUBQ    AX,DX\n        0x0012 00018 (\u2026/opt.go:18)       ANDQ    $1,DX\n        0x0016 00022 (\u2026/opt.go:18)       ADDQ    AX,DX\n        0x0019 00025 (\u2026/opt.go:19)       ANDQ    $1,BX\n        0x001d 00029 (\u2026/opt.go:21)       RET     ,\n</code></pre>\n\n<p>Here <code>BX</code> is the argument and <code>DX</code> and <code>BX</code> appear to be the two results\n(<code>BX</code> being reused as one of the results).\nHere they are slightly different, but only by a few instructions\n(look at the source line numbers shown)\nand without any division or multiplication instructions\n(so basically just as fast).\nThe difference is due to algorithmic vs logical shifts and how Go does mod for negative values.</p>\n\n<p>You can confirm this by changing <code>int</code> to <code>uint</code> in the program and then the output contains things like:</p>\n\n<pre><code>        0x0008 00008 (\u2026/opt.go:18)       ANDQ    $1,CX\n        0x000c 00012 (\u2026/opt.go:19)       ANDQ    $1,BX\n</code></pre>\n\n<p>i.e.\u00a0the exact same instruction.\nThis is true for each of the examples you gave.</p>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 150, "favorite_count": 0, "accepted_answer_id": 29976386, "answer_count": 1, "score": -2, "last_activity_date": 1430424474, "creation_date": 1430421591, "last_edit_date": 1430422217, "question_id": 29976025, "link": "https://stackoverflow.com/questions/29976025/is-go-compiler-smart-enough-to-pick-up-microoptimization", "title": "Is Go compiler smart enough to pick up microoptimization?", "body": "<p>I am curious whether it makes sense to use microoptimizations like </p>\n\n<ul>\n<li><code>a / 2</code> versus <code>a &gt;&gt; 1</code> when a is an integer</li>\n<li><code>a * 2</code> vs <code>a &lt;&lt; 1</code></li>\n<li><code>a % 2</code> vs <code>a &amp; 1</code></li>\n<li>and some others like these</li>\n</ul>\n\n<p>I know that any decent C compiler is good enough handle this. Also please do not write about premature optimization, because these techniques are so obvious, that it is not even optimization and more like a matter of preferences how to write code.</p>\n\n<p><strong>P.S.</strong> I tried to do benchmarks and the difference in timing is not statistically significant. I do not know how to check go's bytecode so thank you for pointing it.</p>\n"}, {"tags": ["go", "gorilla"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1430418430, "post_id": 29973639, "comment_id": 48069957, "body": "What&#39;s wrong with handling them as 2 routes? They can both point to the same handler function. You have to declare both paths and the host somehow, so there&#39;s no real way to make this shorter."}, {"owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430434303, "post_id": 29973639, "comment_id": 48077755, "body": "I&#39;ve got about 100 handlers and was hoping to avoid the code bloat/maintenance issues with having duplicate routes for each."}, {"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "edited": false, "score": 0, "creation_date": 1430467620, "post_id": 29973639, "comment_id": 48086257, "body": "@MarkFletcher see my solution"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430493683, "post_id": 29973639, "comment_id": 48098638, "body": "You have 2 routes here, so you need to define them somehow, and listing them separately probably makes maintenance easier. If combining the host+name pairs into a map of handlers (a la metakeule&#39;s answer) doesn&#39;t work for you either, then I think you need to make a better example for the problem you&#39;re trying to solve."}], "answers": [{"comments": [{"owner": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 0, "creation_date": 1430426722, "post_id": 29977324, "comment_id": 48074483, "body": "Sorry this may be a dumb question (but I learn more this way) - please can you explain how this Dispatcher approach reduces the code, as the above code has both <code>r.Handle</code> and <code>r.Host</code> calls from the OP.  It seems a different way to achieve the same, what have I missed?"}, {"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "reply_to_user": {"reputation": 5268, "user_id": 302164, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/XucHp.png?s=128&g=1", "display_name": "miltonb", "link": "https://stackoverflow.com/users/302164/miltonb"}, "edited": false, "score": 0, "creation_date": 1430426977, "post_id": 29977324, "comment_id": 48074618, "body": "It just makes it easy to add further handlers for a combination of domain and name. I guess that it the final goal. Say if you have 20 domain/name handlers just write the handler and add one new entry to the Dispatcher for each handler."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430430365, "post_id": 29977324, "comment_id": 48076243, "body": "This doesn&#39;t change any of the routing, adding new pairs of handlers still takes almost exactly the same 2 lines. All you have done is added code to the original <code>promoteView</code> function, and made it an <code>http.Handler</code>."}, {"owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430467376, "post_id": 29977324, "comment_id": 48086171, "body": "@JimB Yes, so what? The whole thing only makes sense in the context of dispatching, so I&#39;ve tried to provide a complete solution. Also solves comment of Mark &quot;I&#39;ve got about 100 handlers...&quot; from above"}], "tags": [], "owner": {"reputation": 3216, "user_id": 1273978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0dd2212a18f9aba8d63b14c552027a12?s=128&d=identicon&r=PG", "display_name": "metakeule", "link": "https://stackoverflow.com/users/1273978/metakeule"}, "is_accepted": true, "score": 1, "last_activity_date": 1430473809, "last_edit_date": 1430473809, "creation_date": 1430426133, "answer_id": 29977324, "question_id": 29973639, "link": "https://stackoverflow.com/questions/29973639/golang-gorilla-mux-best-way-to-match-against-two-url-signatures/29977324#29977324", "title": "Golang Gorilla mux, best way to match against two url signatures", "body": "<p>With a dispatcher like this you only have to add one line per router/handler.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"github.com/gorilla/mux\"\n    \"net/http\"\n)\n\ntype key struct {\n    subdomain, name string\n}\n\ntype dispatcher map[key]http.Handler\n\nfunc (d dispatcher) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    vars := mux.Vars(r)\n    handler, ok := d[key{vars[\"subdomain\"], vars[\"name\"]}]\n\n    if ok {\n        handler.ServeHTTP(w, r)\n        return\n    }\n    http.NotFound(w, r)\n}\n\nfunc handleA(rw http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(rw, \"handleA serving\")\n}\n\nfunc handleB(rw http.ResponseWriter, req *http.Request) {\n    fmt.Fprintln(rw, \"handleB serving\")\n}\n\nvar Dispatcher = dispatcher{\n    key{\"subA\", \"nameA\"}: http.HandlerFunc(handleA),\n    key{\"subB\", \"nameB\"}: http.HandlerFunc(handleB),\n    // add your new routes here\n}\n\nfunc main() {\n    r := mux.NewRouter()\n    r.Handle(\"/org/{subdomain}/{name}/promote\", Dispatcher)\n    r.Host(\"{subdomain:[a-z]+}.domain.com\").Path(\"/{name}/promote\").Handler(Dispatcher)\n\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n"}], "owner": {"reputation": 601, "user_id": 1347268, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/abd1a63352cf4aa1e8e18228eb2c88c3?s=128&d=identicon&r=PG", "display_name": "Mark Fletcher", "link": "https://stackoverflow.com/users/1347268/mark-fletcher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1303, "favorite_count": 0, "accepted_answer_id": 29977324, "answer_count": 1, "score": 0, "last_activity_date": 1430473809, "creation_date": 1430413121, "question_id": 29973639, "link": "https://stackoverflow.com/questions/29973639/golang-gorilla-mux-best-way-to-match-against-two-url-signatures", "title": "Golang Gorilla mux, best way to match against two url signatures", "body": "<p>Using gorilla mux, I currently have many URLs that are of the form: </p>\n\n<p>domain.com/org/{subdomain}/{name}/pagename</p>\n\n<p>such that the code looks like:</p>\n\n<pre><code>rtr.HandleFunc(\"/org/{subdomain}/{name}/promote\", promoteView)\n</code></pre>\n\n<p>I'd like to also match against:</p>\n\n<p>subdomain.domain.com/{name}/pagename</p>\n\n<p>I know I can do something like</p>\n\n<pre><code>rtr.Host(\"{subdomain:[a-z]+}.domain.com\").HandleFunc(\"/{name}/promote\", promoteView)\n</code></pre>\n\n<p>to match on the subdomain. Is it possible to only have one HandleFunc() that will match both types of URLs, or do I need to have two HandleFunc()s, one for the first case and one for the subdomain.domain.com case?</p>\n"}, {"tags": ["go", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430413246, "post_id": 29973382, "comment_id": 48067058, "body": "<code>Ctrl+C</code> is fine. Why would you have to change the port number?"}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1430414020, "post_id": 29973382, "comment_id": 48067528, "body": "Is it really a terminal where you&#39;re doing ctrl+c or some sort of IDE? I had trouble with Atom and the most popular app runners there, as killing the process would only kill <code>go run</code> and leave the child process running. Make sure your server is killed properly and not running in the background."}, {"owner": {"reputation": 883, "user_id": 2296440, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f5ebf3fc6ae512402b176a2fa4392048?s=128&d=identicon&r=PG", "display_name": "mnordber", "link": "https://stackoverflow.com/users/2296440/mnordber"}, "edited": false, "score": 0, "creation_date": 1430414093, "post_id": 29973382, "comment_id": 48067579, "body": "If I don&#39;t change the port number I get an error &quot;Error listening: listen tcp 127.0.0.1:8080: bind: normally only one user is allowed. exit status 1&quot;.  If I pick a new port number, everything works as expected"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430415924, "post_id": 29973382, "comment_id": 48068596, "body": "Sounds like you&#39;re using windows, so I might not be much help. I do know Windows allows immediately reusing ports by default. Are you certain the old process is actually being shut down on Ctrl+C?"}, {"owner": {"reputation": 883, "user_id": 2296440, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f5ebf3fc6ae512402b176a2fa4392048?s=128&d=identicon&r=PG", "display_name": "mnordber", "link": "https://stackoverflow.com/users/2296440/mnordber"}, "edited": false, "score": 0, "creation_date": 1430418469, "post_id": 29973382, "comment_id": 48069985, "body": "I&#39;m using cygwin on Windows and when I run <code>ps</code> I only have bash and mintty running"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430418529, "post_id": 29973382, "comment_id": 48070030, "body": "You could use <a href=\"https://golang.org/pkg/os/signal/#Notify\" rel=\"nofollow noreferrer\"><code>signal.Notify</code></a> with <a href=\"https://golang.org/pkg/os/#Interrupt\" rel=\"nofollow noreferrer\"><code>os.Interrupt</code></a> to return from <code>main</code> (and let all the defer&#39;s run) when you see Ctrl+C. E.g. <a href=\"https://play.golang.org/p/_j__5gBpG2\" rel=\"nofollow noreferrer\">play.golang.org/p/_j__5gBpG2</a> but perhaps with a close on the listen socket too."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430419152, "post_id": 29973382, "comment_id": 48070367, "body": "Or perhaps: <a href=\"https://play.golang.org/p/R3e7TW3dPg\" rel=\"nofollow noreferrer\">play.golang.org/p/R3e7TW3dPg</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430430945, "post_id": 29973382, "comment_id": 48076510, "body": "cygwin is likely the problem here (it&#39;s not officially supported, since Go runs natively on windows). There&#39;s probably some mismatch between Go setting SO_REUSEADDR and how it&#39;s translated to windows, since the semantics on each platform are different. I would recommend using Go natively if you can."}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430746926, "post_id": 29989902, "comment_id": 48179592, "body": "All open file descriptors are closed by the OS when a process exits. While the user may want to register a signal handler for other reasons, there&#39;s no way for the socket to still be open after the process terminates."}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1430756379, "post_id": 29989902, "comment_id": 48185868, "body": "@JimB Yeah that&#39;s what I thought, I don&#39;t use Windows but when I googled a bit I saw this answer <a href=\"http://serverfault.com/a/273727\">serverfault.com/a/273727</a> that made me believe that an explicit close would solve the problem and knowing that defer statements don&#39;t get run on SIGINT I thought if he handled the signal he could ensure that his server got closed."}], "tags": [], "owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "is_accepted": false, "score": 1, "last_activity_date": 1430494295, "creation_date": 1430494295, "answer_id": 29989902, "question_id": 29973382, "link": "https://stackoverflow.com/questions/29973382/what-is-the-correct-way-to-shut-down-a-server-from-the-terminal/29989902#29989902", "title": "What is the correct way to shut down a server from the terminal?", "body": "<p>Unless you are using <a href=\"https://golang.org/pkg/os/signal/\" rel=\"nofollow\"><code>os/signal</code></a> package to Notify you when you hit <code>Ctrl+C</code> your defer statement will not get run.</p>\n\n<p>Here is an example of a handled SIGINT (Ctrl+C) to exit a program cleanly. </p>\n\n<pre><code>func main() {\n    done := make(chan os.Signal)\n    go signal.Notify(done, syscall.SIGINT)\n\n    go func() {\n         // your tcp server goes here along with the defer to clean up your server\n    }()\n\n    &lt;-done\n\n    // exit cleanly\n}\n</code></pre>\n"}], "owner": {"reputation": 883, "user_id": 2296440, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/f5ebf3fc6ae512402b176a2fa4392048?s=128&d=identicon&r=PG", "display_name": "mnordber", "link": "https://stackoverflow.com/users/2296440/mnordber"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1430494295, "creation_date": 1430412310, "last_edit_date": 1430422594, "question_id": 29973382, "link": "https://stackoverflow.com/questions/29973382/what-is-the-correct-way-to-shut-down-a-server-from-the-terminal", "title": "What is the correct way to shut down a server from the terminal?", "body": "<p>I am trying my hands on some basic chat (server + client) stuff in Go so I have a server which listens on a specific port and I have a client which writes to this port.</p>\n\n<p>However, as I am new to this, I constantly make changes and have to restart the server etc. I've been doing 'Ctrl + C' everytime I want to stop server but this is obviously stupid as I have to change the port number on every compilation... What is the correct way of doing this? I'm currently just doing</p>\n\n<pre><code>defer ln.Close()\n</code></pre>\n\n<p>in the main function of the server after the connection has been established but I guess Ctrl + C just kills the process without closing the connection? </p>\n\n<p>EDIT: More information.\nI am running cygwin on Windows. ps shows no old processes but I found a looot of \"server.exe\" (my server file is named server.go) in the task manager.</p>\n"}, {"tags": ["http", "go", "httpresponse"], "comments": [{"owner": {"reputation": 3099, "user_id": 1978011, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/ca7712f5e45279a01ee1b7f273248e15?s=128&d=identicon&r=PG", "display_name": "user1978011", "link": "https://stackoverflow.com/users/1978011/user1978011"}, "edited": false, "score": 0, "creation_date": 1430411136, "post_id": 29972502, "comment_id": 48065770, "body": "Can you specify where <i>exactly</i> you have to add <code>&#47;home (http.HandleFunc(&quot;&#47;home&quot;, foo))</code> to avoid any ambiguity."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430413312, "post_id": 29972502, "comment_id": 48067107, "body": "Just log what the requests are, and you&#39;ll see what&#39;s happening."}], "answers": [{"tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": true, "score": 5, "last_activity_date": 1430410090, "creation_date": 1430410090, "answer_id": 29972672, "question_id": 29972502, "link": "https://stackoverflow.com/questions/29972502/http-responsewriter-duplicate-answer-golang/29972672#29972672", "title": "http ResponseWriter duplicate answer golang", "body": "<p>Because modern browsers send an extra request for <code>/favicon.ico</code> which is also handled in your <code>/</code> request handler. </p>\n\n<p>If you ping your server with <code>curl</code> for example, you'll see only one request being sent:</p>\n\n<pre><code> curl localhost:3000\n</code></pre>\n"}], "owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 320, "favorite_count": 0, "accepted_answer_id": 29972672, "answer_count": 1, "score": 0, "last_activity_date": 1430412934, "creation_date": 1430409596, "last_edit_date": 1430412934, "question_id": 29972502, "link": "https://stackoverflow.com/questions/29972502/http-responsewriter-duplicate-answer-golang", "title": "http ResponseWriter duplicate answer golang", "body": "<pre><code>func main() {\n\n  http.HandleFunc(\"/\", foo)\n\n  http.ListenAndServe(\":3000\", nil)\n}\n\nfunc foo(w http.ResponseWriter, r *http.Request) {\n\n  s:= \"name\"\n\n  fp := path.Join(\"templates\", \"index.html\")\n\n  tmpl, err := template.ParseFiles(fp)\n  if err != nil {\n    panic(err)\n  }\n\n  if  err := tmpl.Execute(w, s); err != nil {\n    panic(err)\n  }\n\n  fmt.Println(\"successfull Operation!!\")\n\n}\n</code></pre>\n\n<p>This code displays 2 \"successfull Operation!!\" but when I add <code>/home</code> (<code>http.HandleFunc(\"/home\", foo)</code>), it doesn't. I want to know why it displays \"successfull Operation!!\" twice. Thank you in advance.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 4045, "user_id": 689990, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/c9baee4e96ed5b21f3c0589418d4e73c?s=128&d=identicon&r=PG", "display_name": "egor7", "link": "https://stackoverflow.com/users/689990/egor7"}, "edited": false, "score": 2, "creation_date": 1430489172, "post_id": 29972619, "comment_id": 48096030, "body": "Thank for pointing the direction and providing with useful example."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 5, "last_activity_date": 1430409925, "creation_date": 1430409925, "answer_id": 29972619, "question_id": 29971363, "link": "https://stackoverflow.com/questions/29971363/golang-reflection-on-interface-vs-pointer-to-interface/29972619#29972619", "title": "Golang reflection on interface vs pointer-to-interface", "body": "<p>It seems to me that the relevant part is <a href=\"http://blog.golang.org/laws-of-reflection#TOC_3.\" rel=\"noreferrer\">this</a>:</p>\n\n<blockquote>\n  <p>Continuing, we can do this:</p>\n\n<pre><code>var empty interface{}\nempty = w\n</code></pre>\n  \n  <p><strong>and our empty interface value empty will again contain that same pair, (tty, *os.File).</strong> That's handy: an empty interface can hold any value and contains all the information we could ever need about that value. </p>\n</blockquote>\n\n<p><em>(emphasis added)</em></p>\n\n<p>When you assign an interface value to a value of type <code>interface{}</code>, the \"pointer to data\" part of the new value doesn't point to the old value, but rather to the data old value was pointing to. We can prove that with a bit of <code>unsafe</code> code:</p>\n\n<pre><code>type iface struct {\n    Type, Data unsafe.Pointer\n}\n\nvar r io.Reader = &amp;bytes.Buffer{}\nvar i interface{} = r\n\nrr := *(*iface)(unsafe.Pointer(&amp;r))\nii := *(*iface)(unsafe.Pointer(&amp;i))\n\nfmt.Printf(\"%v\\n\", ii.Data == rr.Data) // Prints true.\n</code></pre>\n\n<p>On the other hand, if we use a pointer, it <em>will</em> point to the interface value itself. So now <code>reflect</code> can actually see, what interface exactly are we talking about. E.g.:</p>\n\n<pre><code>var i2 interface{} = &amp;r\nii2 := *(*iface)(unsafe.Pointer(&amp;i2))\nfmt.Printf(\"%v\\n\", ii2.Data == unsafe.Pointer(&amp;r)) // Prints true.\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/0ZEMdIFhIj\" rel=\"noreferrer\">http://play.golang.org/p/0ZEMdIFhIj</a></p>\n"}], "owner": {"reputation": 4045, "user_id": 689990, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/c9baee4e96ed5b21f3c0589418d4e73c?s=128&d=identicon&r=PG", "display_name": "egor7", "link": "https://stackoverflow.com/users/689990/egor7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2206, "favorite_count": 0, "accepted_answer_id": 29972619, "answer_count": 1, "score": 2, "last_activity_date": 1430409925, "creation_date": 1430406556, "last_edit_date": 1430407413, "question_id": 29971363, "link": "https://stackoverflow.com/questions/29971363/golang-reflection-on-interface-vs-pointer-to-interface", "title": "Golang reflection on interface vs pointer-to-interface", "body": "<p>In the example of gob usage <a href=\"http://golang.org/src/encoding/gob/example_interface_test.go\" rel=\"nofollow\">http://golang.org/src/encoding/gob/example_interface_test.go</a> they provide the following thesis:\n<code>Pass pointer to interface so Encode sees (and hence sends) a value of interface type.  If we passed p directly it would see the concrete type instead. See the blog post, \"The Laws of Reflection\" for background.</code></p>\n\n<p>I've read The Laws of reflection twice, and a related Russ Cox article too. But I can't find a distinction between pointer-to-interface and interface there.</p>\n\n<p>So why is it that through the pointer it sees a value of interface type, and with no pointer it sees (surprisingly to me) the concrete type?</p>\n"}, {"tags": ["reflection", "go"], "answers": [{"comments": [{"owner": {"reputation": 30317, "user_id": 279776, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9c368b605cfa34be3390a983b6bce441?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/279776/alex"}, "edited": false, "score": 0, "creation_date": 1430398283, "post_id": 29967733, "comment_id": 48056010, "body": "Too bad... Yeah that could actually work well with code generation."}, {"owner": {"reputation": 30317, "user_id": 279776, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9c368b605cfa34be3390a983b6bce441?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/279776/alex"}, "edited": false, "score": 0, "creation_date": 1430398499, "post_id": 29967733, "comment_id": 48056165, "body": "But then it&#39;s easier to simply do <code>var Foo_Bar = &quot;Bar&quot;</code> :)"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 30317, "user_id": 279776, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9c368b605cfa34be3390a983b6bce441?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/279776/alex"}, "edited": false, "score": 0, "creation_date": 1430399036, "post_id": 29967733, "comment_id": 48056551, "body": "@Alex if you want code generation than you don&#39;t need reflect. Simply parse the struct definition and output a file that has consts for all fields. It will actually be cool, but again, just manually writing consts is also good."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 3, "last_activity_date": 1430396718, "creation_date": 1430396718, "answer_id": 29967733, "question_id": 29967157, "link": "https://stackoverflow.com/questions/29967157/reflect-how-to-get-the-name-of-a-struct-field/29967733#29967733", "title": "reflect: How to get the name of a struct field?", "body": "<p>You can't do that. The closest thing I can think of, but it's damn ugly so <strong>do not take it as the answer</strong> is something like this:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"reflect\"\n)\n\ntype Foo struct {\n    Bar string\n    Baz int\n}\n\nvar Foo_Bar = reflect.TypeOf(Foo{}).Field(0).Name\nvar Foo_Baz = reflect.TypeOf(Foo{}).Field(1).Name\n\nfunc main(){\n    fmt.Println(Foo_Bar, Foo_Baz)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 30317, "user_id": 279776, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9c368b605cfa34be3390a983b6bce441?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/279776/alex"}, "edited": false, "score": 0, "creation_date": 1430402218, "post_id": 29968751, "comment_id": 48059003, "body": "Interesting, thanks! But I have about 50 SQL fields in my application, that would require creating 50 new types."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": false, "score": 1, "last_activity_date": 1430399668, "creation_date": 1430399668, "answer_id": 29968751, "question_id": 29967157, "link": "https://stackoverflow.com/questions/29967157/reflect-how-to-get-the-name-of-a-struct-field/29968751#29968751", "title": "reflect: How to get the name of a struct field?", "body": "<p>You can make this work by defining a new type that is based off of string, and use that as the type inside of your struct:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"reflect\"\n\ntype Name string\ntype User struct {\n    Name Name\n}\n\nfunc test(o interface{}) {\n    t := reflect.TypeOf(o)\n    fmt.Println(t.Name())\n}\n\nfunc main() {\n    u := &amp;User{\"Bob\"}\n    test(u.Name) // Prints \"Name\"\n    test(\"Tim\") // Prints \"string\"\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Iit-4VzNDR\" rel=\"nofollow\">Playground</a>.</p>\n"}], "owner": {"reputation": 30317, "user_id": 279776, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9c368b605cfa34be3390a983b6bce441?s=128&d=identicon&r=PG", "display_name": "Alex", "link": "https://stackoverflow.com/users/279776/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1116, "favorite_count": 0, "accepted_answer_id": 29967733, "answer_count": 2, "score": 0, "last_activity_date": 1430399668, "creation_date": 1430394999, "question_id": 29967157, "link": "https://stackoverflow.com/questions/29967157/reflect-how-to-get-the-name-of-a-struct-field", "title": "reflect: How to get the name of a struct field?", "body": "<pre><code>type User struct { Name string }\n\nfunc test(o interface{}) {\n    t := reflect.TypeOf(o)\n    fmt.Println(t)\n}\n\nu := &amp;User{\"Bob\"}\ntest(u.Name) // prints \"string\", but I need \"Name\"\n</code></pre>\n\n<p>Is this possible in Go? I want to have as few \"magic strings\" as possible, so instead of having</p>\n\n<p><code>UpdateFields(\"Name\", \"Password\")</code></p>\n\n<p>I'd much rather use</p>\n\n<p><code>UpdateFields(user.Name, user.Password)</code></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "reply_to_user": {"reputation": 29817, "user_id": 462604, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7176c041527db5489a2181a0f87f57d9?s=128&d=identicon&r=PG", "display_name": "Jakob Bowyer", "link": "https://stackoverflow.com/users/462604/jakob-bowyer"}, "edited": false, "score": 0, "creation_date": 1430391711, "post_id": 29965857, "comment_id": 48051612, "body": "i cant because i don&#39;t know the type statically"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1430391875, "post_id": 29965857, "comment_id": 48051725, "body": "You switch on reflect.Type.Kind() and call the reflect.Value.{Int,String,Float,...}() accordingly."}, {"owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "edited": false, "score": 0, "creation_date": 1430392333, "post_id": 29965857, "comment_id": 48052031, "body": "i cannot do that, because the type of responseObject could be any struct anyone has defined and i don&#39;t know ithese"}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1430392624, "post_id": 29965857, "comment_id": 48052238, "body": "@billdoor: You should describe in your question what you are planning on doing with the slice of <code>reflect.Value</code>s. Because what you are proposing, in its current form, cannot be done."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1430394577, "post_id": 29965857, "comment_id": 48053492, "body": "@bildor: You do know which types a reflect.Value can be converted to, because this is a <i>fixed</i> list. Of course you cannot do dynamic type casts, but then just find a different design like we tried to explain. The whole ideo of a dynamic type cast is nonsensical as the resulting object <i>needs</i> a static type known at compile time."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1430399594, "post_id": 29965857, "comment_id": 48056960, "body": "if you don&#39;t know the type statically, then there&#39;s no reason to do a type assertion, and you can leave it in an <code>interface{}</code>. If you&#39;re doing a type assertion, it&#39;s because you have a specific, known type you need."}], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 2, "last_activity_date": 1430402195, "creation_date": 1430402195, "answer_id": 29969721, "question_id": 29965857, "link": "https://stackoverflow.com/questions/29965857/golang-cast-to-relfect-type/29969721#29969721", "title": "golang cast to relfect.Type", "body": "<p>If you have code using the normal type assertion syntax like:</p>\n\n<pre><code>x := v.(mytype)\n</code></pre>\n\n<p>Then the compiler knows that the variable <code>x</code> is of type <code>mytype</code>, and generates code accordingly.  If the language let you use an expression in place of the type, then the compiler would have no way of knowing what type <code>x</code> is, and consequently no way to generate code that uses that variable.</p>\n\n<p>If you only know the type of value at runtime, then you will need to stick with the <code>reflect.Value</code> API.  You can determine the value's type using its <code>Type</code> method, and there are methods that will let you access struct fields, indexes in slices or arrays, etc.</p>\n\n<p>You will only be able to move back to regular syntax when you have a type you know about at compile time.</p>\n"}, {"tags": [], "owner": {"reputation": 109950, "user_id": 86989, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4bd262de5d82a235eeb64f71e4058198?s=128&d=identicon&r=PG", "display_name": "newacct", "link": "https://stackoverflow.com/users/86989/newacct"}, "is_accepted": true, "score": 1, "last_activity_date": 1430725916, "creation_date": 1430725916, "answer_id": 30025177, "question_id": 29965857, "link": "https://stackoverflow.com/questions/29965857/golang-cast-to-relfect-type/30025177#30025177", "title": "golang cast to relfect.Type", "body": "<p>What is a cast (type assertion)? It has two effects:</p>\n\n<ol>\n<li>At compile time, the compile-time of the whole type assertion expression is the type casted to.</li>\n<li>At runtime, a check is made on the actual runtime type of the value, and if it is not the type casted to, it will generate a runtime error.</li>\n</ol>\n\n<p>Obviously, #1 doesn't make sense for a type that is not known at compile-time, because how can the compile-time type of something depend on something not known at compile time?</p>\n\n<p>You can still do manually do #2 for a type that is not known at compile time. Just get the runtime type of the value using <code>reflect.TypeOf()</code> and compare it against the <code>runtime.Type</code> you have.</p>\n"}], "owner": {"reputation": 1841, "user_id": 1495550, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/56b9da65c0fbf232e45e80a79e9304fa?s=128&d=identicon&r=PG", "display_name": "billdoor", "link": "https://stackoverflow.com/users/1495550/billdoor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1432, "favorite_count": 0, "closed_date": 1430999344, "accepted_answer_id": 30025177, "answer_count": 2, "score": 1, "last_activity_date": 1430725916, "creation_date": 1430391349, "question_id": 29965857, "link": "https://stackoverflow.com/questions/29965857/golang-cast-to-relfect-type", "closed_reason": "Duplicate", "title": "golang cast to relfect.Type", "body": "<p>My Problem is as follows:</p>\n\n<p>I have a slice of <code>reflect.Value</code>, that was returned from a <code>MethodByName(\"foo\").Call()</code>.</p>\n\n<p>now i want to cast the contained values to their types, which i dont know statically, but in form of <code>relflect.Type</code></p>\n\n<p>Basically what i want to do is:</p>\n\n<pre><code>values[0].Interface().(mytype)\n</code></pre>\n\n<p>but with reflection</p>\n\n<pre><code>values[0].Interface().(reflect.TypeOf(responseObject))\n</code></pre>\n\n<p>This gives me the compilation error:</p>\n\n<pre><code>reflect.TypeOf(responseObject) is not a type\n</code></pre>\n\n<p>Is there a way to do this in go?</p>\n\n<p>Thanks and regards</p>\n\n<p>BillDoor</p>\n"}, {"tags": ["macos", "debugging", "go", "gdb"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430417309, "post_id": 29964753, "comment_id": 48069322, "body": "<code>go test -c</code> builds <code>dirname.test</code> but discards the temporary source that it marked up and used to build the test executable. Perhaps something like <code>go test -c -work</code> may do what you want, but then it&#39;d be up to you to remove that temporary work directory when finished."}, {"owner": {"reputation": 101, "user_id": 3247841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/084eeb46faee14b2eea5590a43c53f85?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Han", "link": "https://stackoverflow.com/users/3247841/robin-han"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430527035, "post_id": 29964753, "comment_id": 48113582, "body": "@DaveC , When I run <code>go test -c -work</code> ,command line output <code>WORK=&#47;var&#47;folders&#47;rn&#47;ff65_68n0kg4_ml_v420yg5m0000gn&#47;T&#47;go-bui&zwnj;&#8203;ld702663380 </code>. And there is not <b>00</b>  in <b>/var/folders</b> . It still fails"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430528443, "post_id": 29964753, "comment_id": 48113926, "body": "Sorry, I hadn&#39;t actually read the link you gave, and assumed it was something to do with you debugging a test (my bad!). But they use a test executable as their example and do so <i>without</i> using <code>-work</code>. Did you do <code>gdb xxx.test -d $GOROOT</code> (with GOROOT set, or substitute <code>$(go env GOROOT)</code>)? Did you try sourcing <code>runtime-gdb.py</code> from within gdb if the previous failed? I don&#39;t use OS X so I can&#39;t help more than those useless suggestions; sorry. :("}, {"owner": {"reputation": 101, "user_id": 3247841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/084eeb46faee14b2eea5590a43c53f85?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Han", "link": "https://stackoverflow.com/users/3247841/robin-han"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430530130, "post_id": 29964753, "comment_id": 48114311, "body": "@DaveC , thanks! it work fine referencing official doc in Ubuntu. But still don&#39;t work in OS X."}], "owner": {"reputation": 101, "user_id": 3247841, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/084eeb46faee14b2eea5590a43c53f85?s=128&d=identicon&r=PG&f=1", "display_name": "Robin Han", "link": "https://stackoverflow.com/users/3247841/robin-han"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1062, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1430850002, "creation_date": 1430388224, "last_edit_date": 1430530938, "question_id": 29964753, "link": "https://stackoverflow.com/questions/29964753/golang-debug-with-gbd-cant-open-to-read-symbols", "title": "Golang debug with gbd can&#39;t open to read symbols?", "body": "<p>I debug my code referencing <a href=\"https://golang.org/doc/gdb\" rel=\"nofollow\">Debugging Go Code</a></p>\n\n<p>But when I run <code>gdb xxx.test</code>, I get a list Warning:</p>\n\n<pre><code>Reading symbols from markdown.test...\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_amd64.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_darwin_amd64.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_setenv.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_util.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/rn/ff65_68n0kg4_ml_v420yg5m0000gn/T/go-build619623895/github.com/glenn-brown/golang-pkg-pcre/src/pkg/pcre/_obj/pcre.cgo2.o': can't open to read symbols: No such file or directory.\n(no debugging symbols found)...done.\n</code></pre>\n\n<p>Using <code>go test -c -work</code> instead of <code>go test -c</code></p>\n\n<pre><code>warning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_amd64.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_darwin_amd64.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_setenv.o': can't open to read symbols: No such file or directory.\n\nwarning: `/var/folders/00/0sdwh000h01000cxqpysvccm0035qk/T/go-build765783040/runtime/cgo/_obj/gcc_util.o': can't open to read symbols: No such file or directory.\n</code></pre>\n\n<p><code>source /usr/local/go/src/runtime/runtime-gdb.py</code> within gdb</p>\n\n<pre><code>Loading Go Runtime support.\nTraceback (most recent call last):\n  File \"/usr/local/go/src/runtime/runtime-gdb.py\", line 205, in &lt;module&gt;\n    _rctp_type = gdb.lookup_type(\"struct runtime.rtype\").pointer()\ngdb.error: No struct type named runtime.rtype.\n</code></pre>\n\n<p>After editing <strong>runtime-gdb.py</strong> <br/></p>\n\n<pre><code>line 205: `#_rctp_type = gdb.lookup_type(\"struct runtime._type\").pointer()`\nline 216: `return go_type_ptr.cast(gdb.lookup_type(\"struct reflect.rtype\").pointer()).dereference()`\n</code></pre>\n\n<p>source runtime-gdb.py within gdb</p>\n\n<pre><code>(gdb) source /usr/local/go/src/runtime/runtime-gdb.py\nLoading Go Runtime support.\n</code></pre>\n\n<p>And then I cannot do next step.Is anyone know how to fix it?</p>\n\n<ul>\n<li>go version go1.4.2 darwin/amd64</li>\n<li>GDB:7.9 (using homebrew to install)</li>\n<li>OS:Mac OS X 10.10.3 </li>\n</ul>\n"}, {"tags": ["multithreading", "concurrency", "go"], "comments": [{"owner": {"reputation": 3525, "user_id": 1440433, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/mKFTJ.jpg?s=128&g=1", "display_name": "Joker_vD", "link": "https://stackoverflow.com/users/1440433/joker-vd"}, "edited": false, "score": 4, "creation_date": 1430386920, "post_id": 29964104, "comment_id": 48048626, "body": "Make sure your <code>GOMAXPROCS</code> is greater than 1 \u2014 otherwise, all goroutines will be executed in one physical thread sequentially."}, {"owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "reply_to_user": {"reputation": 3525, "user_id": 1440433, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/mKFTJ.jpg?s=128&g=1", "display_name": "Joker_vD", "link": "https://stackoverflow.com/users/1440433/joker-vd"}, "edited": false, "score": 0, "creation_date": 1430388837, "post_id": 29964104, "comment_id": 48049820, "body": "Code modified after @Dean Elbaz comments. <a href=\"http://play.golang.org/p/QemdM3ElsX\" rel=\"nofollow noreferrer\">play.golang.org/p/QemdM3ElsX</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1430391986, "post_id": 29964104, "comment_id": 48051811, "body": "Concurrency is not parallelism. Concurrency is a way to think about code, not a synonym for &quot;this runs faster&quot;. Albeit doing concurrency correct may help using all your cores."}], "answers": [{"tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 7, "last_activity_date": 1430387140, "last_edit_date": 1430387140, "creation_date": 1430386776, "answer_id": 29964209, "question_id": 29964104, "link": "https://stackoverflow.com/questions/29964104/why-concurrent-code-takes-more-time-to-execute/29964209#29964209", "title": "Why concurrent code takes more time to execute", "body": "<p>The overhead of all the concurrency related functions(channel creation, channel sending, goroutine creation) is way bigger than the two instructions that you execute in each of your goroutine. </p>\n\n<p>In addition, your goroutine version is basically serial because you spawn a goroutine and immediately wait for the result of its channel. The waitgroup version is similar.</p>\n\n<p>Try again with a small number of goroutines each executing a chunk of your loop. @Joker_vD also has a good point to make sure that <code>GOMAXPROCS</code> is bigger than one.</p>\n"}, {"comments": [{"owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "edited": false, "score": 0, "creation_date": 1430390049, "post_id": 29964327, "comment_id": 48050554, "body": "Thanks for pointing out the biggest blunder ... I did corrected that and again the I see no major benefit in executing it with *wg here are the some quick stats... Normal execution takes.. 38.ms and modified code for wg tooks 1.82s Now that I have also added code  <code>nCPU := runtime.NumCPU() runtime.GOMAXPROCS(nCPU)</code> Can there a overhead as suggested by @inf ?"}, {"owner": {"reputation": 549, "user_id": 3040816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/43fdb4f835d35ff0f78867a4d2007b4f?s=128&d=identicon&r=PG&f=1", "display_name": "smnpl", "link": "https://stackoverflow.com/users/3040816/smnpl"}, "edited": false, "score": 0, "creation_date": 1430396603, "post_id": 29964327, "comment_id": 48054866, "body": "Yes, overhead is possible. If there are lots of context switches back and forth that costs. Running in parallel makes more sense if the parallel routines each do bigger, long running calculations / processing. Small chunks of processing, and then a need for sync of another thread can then be very slow."}], "tags": [], "owner": {"reputation": 1855, "user_id": 1558705, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e1563795271fe55bf0beab2d12cd69b0?s=128&d=identicon&r=PG", "display_name": "Dean Elbaz", "link": "https://stackoverflow.com/users/1558705/dean-elbaz"}, "is_accepted": false, "score": 3, "last_activity_date": 1430387088, "creation_date": 1430387088, "answer_id": 29964327, "question_id": 29964104, "link": "https://stackoverflow.com/questions/29964104/why-concurrent-code-takes-more-time-to-execute/29964327#29964327", "title": "Why concurrent code takes more time to execute", "body": "<p>Your problem is that you don't actually do anything concurrently.</p>\n\n<p>in the workgroup example, you need to call <code>go linearizeWithWg(...)</code></p>\n\n<p>In the goroutine example, you start a goroutine, but then wait for it to end in the function. To run it concurrently, you would need a buffered response channel, and having another goroutine getting the responses</p>\n"}], "owner": {"reputation": 192, "user_id": 1083135, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/650f7ee67c04d81685d76db49b385850?s=128&d=identicon&r=PG&f=1", "display_name": "VimleshS", "link": "https://stackoverflow.com/users/1083135/vimleshs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 29964209, "answer_count": 2, "score": -2, "last_activity_date": 1430405791, "creation_date": 1430386510, "last_edit_date": 1430405791, "question_id": 29964104, "link": "https://stackoverflow.com/questions/29964104/why-concurrent-code-takes-more-time-to-execute", "title": "Why concurrent code takes more time to execute", "body": "<p>I have a function named linearize...I'm trying to speed up its execution but surprised to find that it had become slower. Have I missed something or have messed up with fundamentals.. </p>\n\n<p>As per my understanding things should improve..</p>\n\n<p>Thanks,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n    \"sync\"\n    \"time\"\n)\n\nvar rgb []float64\n\nfunc linearizeWithWg(v float64, idx int, wg *sync.WaitGroup) {\n    defer wg.Done()\n\n    if v &lt;= 0.04045 {\n        rgb[idx] = v / 12.92\n    } else {\n        rgb[idx] = math.Pow((v+0.055)/1.055, 2.4)\n    }\n}\n\nfunc linearizeWithGoR(v float64) float64 {\n    res := make(chan float64)\n\n    go func(input float64) {\n        if input &lt;= 0.04045 {\n            res &lt;- input / 12.92\n        } else {\n            res &lt;- math.Pow((input+0.055)/1.055, 2.4)\n        }\n    }(v)\n    return &lt;-res\n}\n\nfunc linearizeNomal(v float64) float64 {\n    if v &lt;= 0.04045 {\n        return v / 12.92\n    }\n    return math.Pow((v+0.055)/1.055, 2.4)\n}\n\nfunc main() {\n    start := time.Now()\n    const C = 1.0 / 255.0\n\n    //Normal Execution\n    for i := 0; i &lt; 100000; i++ {\n        linearizeNomal(float64(i) * C * 0.5)\n        linearizeNomal(float64(i) * C * 1.5)\n        linearizeNomal(float64(i) * C * 4.5)\n    }\n    elaspsed := time.Since(start)\n    fmt.Println(elaspsed)\n\n    //With GoRoutines.. Slow\n    start = time.Now()\n    for i := 0; i &lt; 100000; i++ {\n        linearizeWithGoR(float64(i) * C * 0.5)\n        linearizeWithGoR(float64(i) * C * 1.5)\n        linearizeWithGoR(float64(i) * C * 2.5)\n    }\n    elaspsed = time.Since(start)\n    fmt.Println(elaspsed)\n\n    //With WaitGroup. Slow\n\n    for i := 0; i &lt; 100000; i++ {\n        rgb = make([]float64, 3)\n        var wg sync.WaitGroup\n        wg.Add(3)\n        linearizeWithWg(float64(i)*C*0.5, 0, &amp;wg)\n        linearizeWithWg(float64(i)*C*1.5, 1, &amp;wg)\n        linearizeWithWg(float64(i)*C*4.5, 2, &amp;wg)\n        wg.Wait()\n    }\n    elaspsed = time.Since(start)\n    fmt.Println(elaspsed)\n\n}\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 4849978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52d749a917c6c66ddc5f90494b6b62f8?s=128&d=identicon&r=PG", "display_name": "Ad van der Veer", "link": "https://stackoverflow.com/users/4849978/ad-van-der-veer"}, "edited": false, "score": 0, "creation_date": 1430725734, "post_id": 29975311, "comment_id": 48167250, "body": "In the end I got it to work at some point, I THINK it was because i ran &#39;appcfg.py update&#39; or &#39;appcfg.py update_cron&#39; so I think you were correct, i was unable to reproduce the effect. It worked btw while keeping my cron.yaml neatly in the designated module folder."}], "tags": [], "owner": {"reputation": 37127, "user_id": 4495081, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/OuWYd.jpg?s=128&g=1", "display_name": "Dan Cornilescu", "link": "https://stackoverflow.com/users/4495081/dan-cornilescu"}, "is_accepted": true, "score": 0, "last_activity_date": 1430419150, "creation_date": 1430419150, "answer_id": 29975311, "question_id": 29963881, "link": "https://stackoverflow.com/questions/29963881/appengine-cron-yaml-definitions-not-showing-in-developer-console/29975311#29975311", "title": "Appengine cron.yaml definitions not showing in developer console", "body": "<p>In the <a href=\"https://cloud.google.com/appengine/docs/python/modules/#Python_Configuration\" rel=\"nofollow\">Configuration</a> section of the doc it's stated:</p>\n\n<blockquote>\n  <p>Optional application-level configuration files (dispatch.yaml,\n  cron.yaml, index.yaml, and queue.yaml) are included in the top level\n  app directory.</p>\n</blockquote>\n\n<p>I agree, the paragraph context appears to leave room for interpretation (<strong>typically...</strong>). But the quoted text also indicates that these files are considered app-level configs. So I'd keep them at the top.</p>\n\n<p>About the update: I noticed, for example, that the index.yaml file was <strong>NOT</strong> uploaded with the rest of the multi-module app at my first deployment, I had to explicitly use <strong>appcfg.py update_indexes</strong>. This was not happening with a single module app. Maybe <strong>appcfg.py update_cron</strong> also needs to be explicit?</p>\n"}], "owner": {"reputation": 23, "user_id": 4849978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52d749a917c6c66ddc5f90494b6b62f8?s=128&d=identicon&r=PG", "display_name": "Ad van der Veer", "link": "https://stackoverflow.com/users/4849978/ad-van-der-veer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 452, "favorite_count": 0, "accepted_answer_id": 29975311, "answer_count": 1, "score": 2, "last_activity_date": 1496925053, "creation_date": 1430385872, "question_id": 29963881, "link": "https://stackoverflow.com/questions/29963881/appengine-cron-yaml-definitions-not-showing-in-developer-console", "title": "Appengine cron.yaml definitions not showing in developer console", "body": "<p>I have a basic appengine project with multiple modules and a dispatch.yaml:</p>\n\n<ul>\n<li>my-project/boxes/app.yaml  (default module)</li>\n<li>my-project/users/app.yaml  (users module)</li>\n<li>my-project/dispatch.yaml</li>\n</ul>\n\n<p>I'm trying to configure a single hourly cronjob with the following definition:</p>\n\n<pre><code>cron:\n- description: hourly box purging\n  url: /api/boxes.purge\n  schedule: every 1 hours\n  target: default\n</code></pre>\n\n<p>I've tried adding it to the module it concerns, so put the above definition in file: 'my-project/boxes/cron.yaml' and running <code>appcfg.py cron_info boxes/</code>. My terminal seems to indicate all went well: </p>\n\n<pre><code>hourly box purging:\nURL: /api/boxes.purge\nSchedule: every 1 hours (UTC)\n2015-04-30 10:08:00Z, 0:59:55 from now\n2015-04-30 11:08:00Z, 1:59:55 from now\n2015-04-30 12:08:00Z, 2:59:55 from now\n2015-04-30 13:08:00Z, 3:59:55 from now\n2015-04-30 14:08:00Z, 4:59:55 from now\n</code></pre>\n\n<p>Ye the Appengine Developer console fails to reflect this and cron jobs are not run. It does show on the local development panel.</p>\n\n<p>Putting the definition in the root of the projects (besides dispatch.yaml) yields the same results. Other things i've tried (in vain): Redeploying all code, <code>appcfg.py update_dispatch</code>, waiting a while before refreshing the developer console.</p>\n\n<p>Hopefull someone is able to help me find the obvious mistake, or confirm that their is some bug.</p>\n"}, {"tags": ["go", "rust"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1430385023, "post_id": 29963449, "comment_id": 48047326, "body": "I don&#39;t know a lot of Rust, but wouldn&#39;t a function that takes a closure suffice?"}, {"owner": {"reputation": 9443, "user_id": 3616050, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yQfMD.png?s=128&g=1", "display_name": "bluss", "link": "https://stackoverflow.com/users/3616050/bluss"}, "edited": false, "score": 1, "creation_date": 1430393877, "post_id": 29963449, "comment_id": 48053029, "body": "Of course, regular files opened using Rust&#39;s libstd will close in their drop glue by themselves."}, {"owner": {"reputation": 20384, "user_id": 220060, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/56533d50fdfceb887852bf50be54678b?s=128&d=identicon&r=PG", "display_name": "nalply", "link": "https://stackoverflow.com/users/220060/nalply"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1581863360, "post_id": 29963449, "comment_id": 106570690, "body": "@Ainar-G, sorry for the late answer and the jargon. Defer could be achieved with a Newtype implementing <code>Drop</code> and executing a closure you passed when creating the Newtype. However closures close over variables and then lifetimes are problematic. Let&#39;s say you close over a variable you already moved when the Newtype is going out of scope. This won&#39;t compile. I think you&#39;ll need a closure where the variables you close over move into the closure and will not be available anymore. I am not sure, but using huon&#39;s <code>defer!</code> macro seems to solve this problem because it doesn&#39;t close over anything."}], "answers": [{"tags": [], "owner": {"reputation": 74030, "user_id": 1256624, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/EdJaa.jpg?s=128&g=1", "display_name": "huon", "link": "https://stackoverflow.com/users/1256624/huon"}, "is_accepted": true, "score": 36, "last_activity_date": 1430400181, "last_edit_date": 1430400181, "creation_date": 1430385270, "answer_id": 29963675, "question_id": 29963449, "link": "https://stackoverflow.com/questions/29963449/golang-like-defer-in-rust/29963675#29963675", "title": "Golang-like defer in Rust", "body": "<p>(<em>e:</em> don't miss bluss's answer and their <a href=\"https://crates.io/crates/scopeguard\" rel=\"noreferrer\">scopedguard</a> crate, below.)</p>\n\n<p>The correct way to achieve this by having code that runs in a destructor, like the <code>defer!</code> macro you link to does. For anything more than ad-hoc testing I would recommend writing a handle type with a proper destructor, e.g. one interacts with <code>std::sync::Mutex</code> via its <a href=\"http://doc.rust-lang.org/nightly/std/sync/struct.MutexGuard.html\" rel=\"noreferrer\"><code>MutexGuard</code></a> type (returned by <code>lock</code>): there's no need to call <code>unlock</code> on the mutex itself. (The explicit handle-with-destructor approach is more flexible too: it has mutable access to the data, whereas the deferred approach may not be able to, due to Rust's strong aliasing controls.)</p>\n\n<p>In any case, that macro is now (much!) improved due to recent changes, in particular, pnkfelix's <a href=\"https://github.com/rust-lang/rfcs/blob/master/text/0769-sound-generic-drop.md\" rel=\"noreferrer\">sound generic drop work</a>, which removes the necessity for <code>#[unsafe_destructor]</code>. The direct update would be:</p>\n\n<pre><code>struct ScopeCall&lt;F: FnMut()&gt; {\n    c: F\n}\nimpl&lt;F: FnMut()&gt; Drop for ScopeCall&lt;F&gt; {\n    fn drop(&amp;mut self) {\n        (self.c)();\n    }\n}\n\nmacro_rules! defer {\n    ($e:expr) =&gt; (\n        let _scope_call = ScopeCall { c: || -&gt; () { $e; } };\n    )\n}\n\nfn main() {\n    let x = 42u8;\n    defer!(println!(\"defer 1\"));\n    defer!({\n        println!(\"defer 2\");\n        println!(\"inside defer {}\", x)\n    });\n    println!(\"normal execution {}\", x);\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>normal execution 42\ndefer 2\ninside defer 42\ndefer 1\n</code></pre>\n\n<hr>\n\n<p>Although, it would be syntactically nicer as:</p>\n\n<pre><code>macro_rules! expr { ($e: expr) =&gt; { $e } } // tt hack\nmacro_rules! defer {\n    ($($data: tt)*) =&gt; (\n        let _scope_call = ScopeCall { \n            c: || -&gt; () { expr!({ $($data)* }) }\n        };\n    )\n}\n</code></pre>\n\n<p>(The <code>tt hack</code> is necessary due to <a href=\"https://github.com/rust-lang/rust/issues/5846\" rel=\"noreferrer\">#5846</a>.)</p>\n\n<p>The use of the generic <code>tt</code> (\"token tree\") allows one to invoke it without the inner <code>{ ... }</code> when there are multiple statements (i.e. it behaves more like a \"normal\" control flow structure):</p>\n\n<pre><code>defer! {\n    println!(\"defer 2\");\n    println!(\"inside defer {}\", x)\n}\n</code></pre>\n\n<p>Also, for maximum flexibility about what the deferred code can do with captured variables, one could use <code>FnOnce</code> instead of <code>FnMut</code>:</p>\n\n<pre><code>struct ScopeCall&lt;F: FnOnce()&gt; {\n    c: Option&lt;F&gt;\n}\nimpl&lt;F: FnOnce()&gt; Drop for ScopeCall&lt;F&gt; {\n    fn drop(&amp;mut self) {\n        self.c.take().unwrap()()\n    }\n}\n</code></pre>\n\n<p>That will also require constructing the <code>ScopeCall</code> with a <code>Some</code> around the value for <code>c</code>. The <code>Option</code> dance is required because calling a <code>FnOnce</code> moves ownership, which isn't possible from behind <code>self: &amp;mut ScopeCall&lt;F&gt;</code> without it. (Doing this is OK, since the destructor only executes once.)</p>\n\n<p>All in all:</p>\n\n<pre><code>struct ScopeCall&lt;F: FnOnce()&gt; {\n    c: Option&lt;F&gt;\n}\nimpl&lt;F: FnOnce()&gt; Drop for ScopeCall&lt;F&gt; {\n    fn drop(&amp;mut self) {\n        self.c.take().unwrap()()\n    }\n}\n\nmacro_rules! expr { ($e: expr) =&gt; { $e } } // tt hack\nmacro_rules! defer {\n    ($($data: tt)*) =&gt; (\n        let _scope_call = ScopeCall {\n            c: Some(|| -&gt; () { expr!({ $($data)* }) })\n        };\n    )\n}\n\nfn main() {\n    let x = 42u8;\n    defer!(println!(\"defer 1\"));\n    defer! {\n        println!(\"defer 2\");\n        println!(\"inside defer {}\", x)\n    }\n    println!(\"normal execution {}\", x);\n}\n</code></pre>\n\n<p>(Same output as the original.)</p>\n"}, {"comments": [{"owner": {"reputation": 31241, "user_id": 242493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8893e2e206c0377ff776d2535887d23f?s=128&d=identicon&r=PG", "display_name": "Jimmy Cuadra", "link": "https://stackoverflow.com/users/242493/jimmy-cuadra"}, "edited": false, "score": 2, "creation_date": 1430449742, "post_id": 29966656, "comment_id": 48081692, "body": "I wish I could accept both answers, cause this is really awesome, and likely what I will actually use. Thank you!"}], "tags": [], "owner": {"reputation": 9443, "user_id": 3616050, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/yQfMD.png?s=128&g=1", "display_name": "bluss", "link": "https://stackoverflow.com/users/3616050/bluss"}, "is_accepted": false, "score": 17, "last_activity_date": 1430395554, "last_edit_date": 1430395554, "creation_date": 1430393695, "answer_id": 29966656, "question_id": 29963449, "link": "https://stackoverflow.com/questions/29963449/golang-like-defer-in-rust/29966656#29966656", "title": "Golang-like defer in Rust", "body": "<p>I use the following for a scope guard. It uses the <code>Deref</code> traits to provide shared &amp; mutable access to the guarded value, without moving it out (that would invalidate the guard!)</p>\n\n<p>My use case is correctly resetting the terminal when the program exits, even if panicking:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>extern crate scopeguard;\nuse scopeguard::guard;\n\n// ... terminal setup omitted ...\n\n// Use a scope guard to restore terminal settings on quit/panic\nlet mut tty = guard(tty, |tty| {\n    // ... I use tty.write() here too ...\n    ts::tcsetattr(tty.as_raw_fd(), ts::TCSANOW, &amp;old_attr).ok();\n});\ngame_main(&amp;mut tty).unwrap();   // Deref coercion magic hands off the inner &amp;mut TTY pointer here.\n</code></pre>\n\n<p>Module scopeguard.rs:</p>\n\n<pre class=\"lang-rust prettyprint-override\"><code>use std::ops::{Deref, DerefMut};\n\npub struct Guard&lt;T, F&gt; where\n    F: FnMut(&amp;mut T)\n{\n    __dropfn: F,\n    __value: T,\n}\n\npub fn guard&lt;T, F&gt;(v: T, dropfn: F) -&gt; Guard&lt;T, F&gt; where\n    F: FnMut(&amp;mut T)\n{\n    Guard{__value: v, __dropfn: dropfn}\n}\n\nimpl&lt;T, F&gt; Deref for Guard&lt;T, F&gt; where\n    F: FnMut(&amp;mut T)\n{\n    type Target = T;\n    fn deref(&amp;self) -&gt; &amp;T\n    {\n        &amp;self.__value\n    }\n\n}\n\nimpl&lt;T, F&gt; DerefMut for Guard&lt;T, F&gt; where\n    F: FnMut(&amp;mut T)\n{\n    fn deref_mut(&amp;mut self) -&gt; &amp;mut T\n    {\n        &amp;mut self.__value\n    }\n}\n\nimpl&lt;T, F&gt; Drop for Guard&lt;T, F&gt; where\n    F: FnMut(&amp;mut T)\n{\n    fn drop(&amp;mut self) {\n        (self.__dropfn)(&amp;mut self.__value)\n    }\n}\n</code></pre>\n\n<p>This is now the crate <a href=\"https://crates.io/crates/scopeguard\">scopeguard  on crates.io.</a></p>\n"}], "owner": {"reputation": 31241, "user_id": 242493, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/8893e2e206c0377ff776d2535887d23f?s=128&d=identicon&r=PG", "display_name": "Jimmy Cuadra", "link": "https://stackoverflow.com/users/242493/jimmy-cuadra"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6363, "favorite_count": 10, "accepted_answer_id": 29963675, "answer_count": 2, "score": 27, "last_activity_date": 1430400181, "creation_date": 1430384644, "question_id": 29963449, "link": "https://stackoverflow.com/questions/29963449/golang-like-defer-in-rust", "title": "Golang-like defer in Rust", "body": "<p>In Go, you can use the <code>defer</code> keyword to execute a function when the current function returns, similar to the traditional <code>finally</code> keyword in other languages. This is useful for cleaning up state regardless of what happens throughout the function body. Here's an example from the Go blog:</p>\n\n<pre><code>func CopyFile(dstName, srcName string) (written int64, err error) {\n    src, err := os.Open(srcName)\n    if err != nil {\n        return\n    }\n    defer src.Close()\n\n    dst, err := os.Create(dstName)\n    if err != nil {\n        return\n    }\n    defer dst.Close()\n\n    return io.Copy(dst, src)\n}\n</code></pre>\n\n<p>How can this functionality be achieved in Rust? I know about RAII, but in my specific case the state is in an external system. I'm writing a test that writes a key to a key-value store, and I need to make sure it's deleted at the end of the test regardless of whether or not the assertions in the test cause a panic.</p>\n\n<p>I found <a href=\"https://gist.github.com/karablin/8568808\">this Gist</a> but I don't know if this is a recommended approach. The unsafe destructor is worrisome.</p>\n\n<p>There is also <a href=\"https://github.com/rust-lang/rust/issues/1523\">this issue</a> on the Rust GitHub repository, but it's three years old and clearly not very relevant anymore.</p>\n"}, {"tags": ["php", "sockets", "go"], "comments": [{"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 3, "creation_date": 1430385978, "post_id": 29963401, "comment_id": 48048028, "body": "bufio.Reader.Readstring returns an error that you are not checking."}, {"owner": {"reputation": 195, "user_id": 3713080, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/db1744b22f6bc4ca7bed18b81dd555a9?s=128&d=identicon&r=PG&f=1", "display_name": "user3713080", "link": "https://stackoverflow.com/users/3713080/user3713080"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1430386927, "post_id": 29963401, "comment_id": 48048630, "body": "If i check the error it says &quot;E0F&quot;"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430416970, "post_id": 29963401, "comment_id": 48069167, "body": "Never ignore errors. Don&#39;t create a new <code>bufio.Reader</code> each iteration through the loop! Handle <code>io.EOF</code>."}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430417147, "post_id": 29966068, "comment_id": 48069259, "body": "Your comment about blocking and <code>bufio</code> makes no sense to me. <code>bufio.ReadString</code> blocks as requred."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 1, "last_activity_date": 1430392287, "last_edit_date": 1430392287, "creation_date": 1430391894, "answer_id": 29966068, "question_id": 29963401, "link": "https://stackoverflow.com/questions/29963401/php-go-socket-communication/29966068#29966068", "title": "PHP/Go socket communication", "body": "<p>The <a href=\"http://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"nofollow\">documentation</a> for <code>ReadString</code> says:</p>\n\n<blockquote>\n  <p>If ReadString encounters an error before finding a delimiter, it returns the data read before the error and the error itself (often io.EOF).</p>\n</blockquote>\n\n<p>This means that you're getting <code>io.EOF</code> (indicating that there's no more data to be read from the connection) and an empty string.</p>\n\n<p>If you want to block on ReadString when no data is available, don't use <code>bufio</code> but rather read directly from the connection.</p>\n\n<p>See also: <a href=\"http://golang.org/pkg/net/#Conn\" rel=\"nofollow\">documentation</a> for <code>net.Conn</code></p>\n\n<blockquote>\n  <p>Another problem is that the server doesn't receive \"test\" unless i comment out the socket_read($socket, 4); in PHP.</p>\n</blockquote>\n\n<p>That's described <a href=\"http://php.net/socket_write\" rel=\"nofollow\">here</a>, <code>socket_write</code> buffers:</p>\n\n<blockquote>\n  <p>socket_write() does not necessarily write all bytes from the given buffer. [...]</p>\n</blockquote>\n\n<p>use</p>\n\n<pre><code>fflush($socket);\n</code></pre>\n\n<p>after the write.</p>\n"}], "owner": {"reputation": 195, "user_id": 3713080, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/db1744b22f6bc4ca7bed18b81dd555a9?s=128&d=identicon&r=PG&f=1", "display_name": "user3713080", "link": "https://stackoverflow.com/users/3713080/user3713080"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 208, "favorite_count": 1, "answer_count": 1, "score": -2, "last_activity_date": 1430392287, "creation_date": 1430384518, "last_edit_date": 1430384919, "question_id": 29963401, "link": "https://stackoverflow.com/questions/29963401/php-go-socket-communication", "title": "PHP/Go socket communication", "body": "<p>Im trying to communicate between Go and PHP with a socket. The code im using is:</p>\n\n<p>Go:</p>\n\n<pre><code>fmt.Println(\"Launching server...\")\nln, _ := net.Listen(\"tcp\", \":8080\")\nconn, _ := ln.Accept()\n\nfor {\n    message, _ := bufio.NewReader(conn).ReadString('\\n')\n    fmt.Print(\"Message Received:\", string(message))\n    conn.Write([]byte(\"test\" +\"\\n\"))\n\n}\n</code></pre>\n\n<p>PHP:</p>\n\n<pre><code>$address = gethostbyaddr($ip);\n    $socket = socket_create(AF_INET, SOCK_STREAM, SOL_TCP);\n    if($socket === false){\n        echo \"socket_create() failed: reason: \" . socket_strerror(socket_last_error());\n    }\n\n    $result = socket_connect($socket, $address, $port);\n    if ($result === false) {\n        echo \"socket_connect() failed.\\nReason: ($result) \" . socket_strerror(socket_last_error($socket));\n    } \n    socket_write($socket, \"test\", 4);\n    socket_read($socket, 4);\n</code></pre>\n\n<p>The problem is that the Go server keeps thinking it's receiving something all the time so it prints \"Message Recieved:\" constantly. If i do if(message!=\"\") it sort of works but the cpu usage is high. </p>\n\n<p>Another problem is that the server doesn't receive \"test\" unless i comment out the socket_read($socket, 4); in PHP.</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 3201, "user_id": 2616179, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fb90669caa64288bdb5767f736152bbe?s=128&d=identicon&r=PG", "display_name": "Makpoc", "link": "https://stackoverflow.com/users/2616179/makpoc"}, "edited": false, "score": 1, "creation_date": 1430383853, "post_id": 29962542, "comment_id": 48046555, "body": "see <a href=\"http://stackoverflow.com/questions/21268000/unmarshaling-nested-json-objects-in-golang\" title=\"unmarshaling nested json objects in golang\">stackoverflow.com/questions/21268000/&hellip;</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430411114, "post_id": 29962542, "comment_id": 48065750, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/16674059/how-to-access-deeply-nested-json-keys-and-values\" title=\"how to access deeply nested json keys and values\">stackoverflow.com/questions/16674059/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "edited": false, "score": 0, "creation_date": 1430469228, "post_id": 29962788, "comment_id": 48086849, "body": "Your code is almost exactly what I need, however, it returns the data <b>without</b> the slashes. Is there a way to get it to keep the data exactly like <code>{\\&quot;data\\&quot;:\\&quot;Some data\\&quot;} </code> returned as a string?"}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "edited": false, "score": 0, "creation_date": 1430471404, "post_id": 29962788, "comment_id": 48087719, "body": "Yes, 2 small changes will do that. See the edited answer. The map definition changes to use <code>json.RawMessage</code> and <code>fmt.Printf</code> is used to print the message."}, {"owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "edited": false, "score": 0, "creation_date": 1430500136, "post_id": 29962788, "comment_id": 48102440, "body": "Awesome! Thanks for all your help thus far! I have one more question for you. How would I go about storing <code>{\\&quot;data\\&quot;:\\&quot;Some data\\&quot;}</code> in a variable (with the slashes included) as well?"}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "edited": false, "score": 0, "creation_date": 1430501167, "post_id": 29962788, "comment_id": 48102953, "body": "Use <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">fmt.Sprintf</a> which returns a string. You can assign the result to a variable and it&#39;ll contain the slashes as well."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 2, "last_activity_date": 1430471289, "last_edit_date": 1495535283, "creation_date": 1430382731, "answer_id": 29962788, "question_id": 29962542, "link": "https://stackoverflow.com/questions/29962542/golang-return-nested-json/29962788#29962788", "title": "Golang return nested JSON", "body": "<p>If you know the key (\"Outer\") you can do it like this (<a href=\"https://play.golang.org/p/xds9Re5Tk3\" rel=\"nofollow noreferrer\">on the Playground</a>):</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"   \n)\n\nfunc main() {\n    //Creating the maps for JSON\n    m := map[string]json.RawMessage{}\n\n    //Parsing/Unmarshalling JSON encoding/json\n    err := json.Unmarshal([]byte(input), &amp;m)\n\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%s\", m[\"Outer\"])\n}\n\nconst input = `\n{\n \"Outer\": \"{\\\"data\\\":\\\"Some data\\\"}\"\n}\n`\n</code></pre>\n\n<p>Note that your example json is missing the final escape after data. Without that you'll get an error.</p>\n\n<p>If you don't know your structure see <a href=\"https://stackoverflow.com/questions/29366038/looping-iterate-over-the-second-level-nested-json-in-go-lang/29382205#29382205\">this reply</a> for how to do it with arbitrary nested data.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1430489958, "post_id": 29974552, "comment_id": 48096462, "body": "Note, this answers the original question, not the changed/edited question."}, {"owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "edited": false, "score": 0, "creation_date": 1430503354, "post_id": 29974552, "comment_id": 48104163, "body": "I really appreciate the examples, these can prove really useful when I need to break down and manipulate JSON in the future!"}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 2, "last_activity_date": 1430416255, "last_edit_date": 1495535283, "creation_date": 1430416255, "answer_id": 29974552, "question_id": 29962542, "link": "https://stackoverflow.com/questions/29962542/golang-return-nested-json/29974552#29974552", "title": "Golang return nested JSON", "body": "<p>This started out as just a comment on a <a href=\"https://stackoverflow.com/a/29962788/55504\">previous answer</a> but grew.</p>\n\n<p>Although you can unmarshal into a temporary <code>map[string]interface{}</code> (or <code>map[string]json.RawMessage</code>) that can do a lot of extra work if there are other \"outer\" fields that you just want to ignore and it also requires checking the type that was found\n(e.g.\u00a0for the case of bad/unexpected input like <code>{\"Outer\": 42}</code>).\nThat probably means adding something like this to the previous answer:</p>\n\n<pre><code>    str, ok := m[\"Outer\"].(string)\n    if !ok { return errors.New(\"\u2026\") }\n    err := json.Unmarshal([]byte(str), &amp;actual)\n</code></pre>\n\n<p>Much simpler is probably to use a temporary wrapping type like so:</p>\n\n<pre><code>    var tmp struct{ Outer string }\n    err := json.Unmarshal(b, &amp;tmp)\n    if err != nil { \u2026 }\n\n    var data actualType\n    err := json.Unmarshal([]byte(tmp.Outer), &amp;data)\n</code></pre>\n\n<p>You could either do this in a separate function that returns the type you wanted (or an error, e.g. <code>func foo(b []byte) (actualType, error)</code>).\nOr you could put a variation of this into a custom <code>UnmarshalJSON</code> method on a wrapper type so as to implement <code>json.Unmarshaler</code>.\nYou could also do the reverse if you wanted to be able to marshal back into the same format.</p>\n\n<p>Full runnable examples on the playground: <a href=\"https://play.golang.org/p/IXU2koyJ1A\" rel=\"nofollow noreferrer\">https://play.golang.org/p/IXU2koyJ1A</a></p>\n"}], "owner": {"reputation": 13, "user_id": 4849743, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0830bf7a9685de2b8b0e9119245d4c0f?s=128&d=identicon&r=PG&f=1", "display_name": "Brandon Linux", "link": "https://stackoverflow.com/users/4849743/brandon-linux"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 403, "favorite_count": 0, "closed_date": 1430425027, "accepted_answer_id": 29962788, "answer_count": 2, "score": 0, "last_activity_date": 1430471289, "creation_date": 1430381947, "last_edit_date": 1430469658, "question_id": 29962542, "link": "https://stackoverflow.com/questions/29962542/golang-return-nested-json", "closed_reason": "Needs details or clarity", "title": "Golang return nested JSON", "body": "<p>I'm new to Go and have been trying to figure out how to output the raw inner JSON \n\"{\\\"data\\\":\\\"Some data\"}\" from \"Outer\". So far, no luck...</p>\n\n<p>This is the input data:</p>\n\n<pre><code>{\n \"Outer\": \"{\\\"data\\\":\\\"Some data\\\"}\"\n}\n</code></pre>\n\n<p>What I would like to get is the following as a string with the slashes:</p>\n\n<pre><code>{\\\"data\\\":\\\"Some data\\\"}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "is_accepted": true, "score": 14, "last_activity_date": 1576100517, "last_edit_date": 1576100517, "creation_date": 1430371545, "answer_id": 29959644, "question_id": 29959506, "link": "https://stackoverflow.com/questions/29959506/is-there-a-go-analog-of-pythons-bisect-module/29959644#29959644", "title": "Is there a Go analog of Python&#39;s bisect module?", "body": "<p>Yes. <a href=\"http://golang.org/pkg/sort/#Search\" rel=\"noreferrer\"><code>sort.Search()</code></a> is what you want. It takes a length and a comparison function, and returns the first index for which the function returns true. The example in the linked docs includes:</p>\n\n<pre><code>i := sort.Search(len(data), func(i int) bool { return data[i] &gt;= x })\n</code></pre>\n\n<p>That sets <code>i</code> to the index of the first value <code>&gt;=</code> x (or to <code>len(data)</code> if no items are <code>&gt;=</code> x), so it's like <code>bisect.bisect_left()</code> in Python. Change it to <code>&gt;</code> to get something like <code>bisect_right</code>. </p>\n\n<p>The Python functions will also search through a range within a list; to do something similar, you could search a subslice of your slice, and add its starting offset to the index <code>Search</code> returns if you need an index into the original slice. There are other ways, but that seems simple and readable.</p>\n\n<p>Though this is also true of Python lists, insertion into a sorted slice is O(n), i.e., it averages twice as slow on twice as much data. If either the number of items or the number of inserts is small you might get away the \"bad\" complexity. If you add a bunch then search a bunch, you could add everything to the end, sort once, then do all your searches, amortizing the cost of the sort. </p>\n\n<p>But for general-purpose sorted collections where inserts, deletes, searches, etc. take logarithmic time regardless of what order you do them in, you may want to turn to tools for ordered collections or databases. There are lots of options, but a couple easy 'starter' ones are <a href=\"https://github.com/cznic/b\" rel=\"noreferrer\"><code>github.com/cznic/b</code></a> and <a href=\"https://github.com/mattn/go-sqlite3\" rel=\"noreferrer\"><code>github.com/mattn/go-sqlite3</code></a>.</p>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1288, "favorite_count": 0, "accepted_answer_id": 29959644, "answer_count": 1, "score": 8, "last_activity_date": 1576100517, "creation_date": 1430370839, "last_edit_date": 1430371837, "question_id": 29959506, "link": "https://stackoverflow.com/questions/29959506/is-there-a-go-analog-of-pythons-bisect-module", "title": "Is there a Go analog of Python&#39;s bisect module?", "body": "<p>I am looking for an out-of-the-box implementation of <a href=\"https://docs.python.org/2/library/bisect.html\" rel=\"noreferrer\">Python's <code>bisect</code> module</a> in Go. All that I need is to find a position for inserting an item in a sorted array from the <a href=\"https://docs.python.org/2/library/bisect.html#bisect.bisect_left\" rel=\"noreferrer\">left</a> and from the <a href=\"https://docs.python.org/2/library/bisect.html#bisect.bisect_right\" rel=\"noreferrer\">right</a>.</p>\n\n<p>I know the logic behind the implementation, but I do not want to <a href=\"http://en.wikipedia.org/wiki/Reinventing_the_wheel\" rel=\"noreferrer\">reinvent the wheel</a> with all of its edge cases.</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 1, "creation_date": 1430362579, "post_id": 29958132, "comment_id": 48037076, "body": "What exactly is not working though? I notice you pass the <code>p</code> variable to the <code>Render</code> method, which is an instance of a <code>Person</code> <b>without</b> a <code>Mynumber</code> value set (only <code>Age</code> and <code>Name</code>). Perhaps that&#39;s your problem? We need more details as to the actual error occurring."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430363099, "post_id": 29958132, "comment_id": 48037204, "body": "The <code>Name</code> &amp; <code>Age</code> is working, but the problem is <code>:mynumber</code>"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1430363641, "post_id": 29958132, "comment_id": 48037363, "body": "I have no idea how to include <code>:mynumber</code> together with <code>Name</code> &amp; <code>Age</code>"}], "answers": [{"tags": [], "owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "is_accepted": true, "score": 1, "last_activity_date": 1430365674, "creation_date": 1430365674, "answer_id": 29958675, "question_id": 29958132, "link": "https://stackoverflow.com/questions/29958132/go-print-uri-in-template-files-echo-framework/29958675#29958675", "title": "Go: print URI in template files (echo framework)", "body": "<p>You simply need to retrieve it from the URL as per your working sample:</p>\n\n<pre><code>number := c.Param(\"mynumber\")\n</code></pre>\n\n<p>And set it on the <code>Person</code> instance you're passing in:</p>\n\n<pre><code>p.Mynumber = number\n</code></pre>\n\n<p>Which would result in:</p>\n\n<pre><code>e.Get(\"/testing/:mynumber\", func(c *echo.Context) {\n    number := c.Param(\"mynumber\")\n    p.Mynumber = number\n    c.Render(http.StatusOK, \"onlytestingtpl\", p)\n})\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1556, "favorite_count": 0, "accepted_answer_id": 29958675, "answer_count": 1, "score": 2, "last_activity_date": 1430365674, "creation_date": 1430361876, "last_edit_date": 1430363410, "question_id": 29958132, "link": "https://stackoverflow.com/questions/29958132/go-print-uri-in-template-files-echo-framework", "title": "Go: print URI in template files (echo framework)", "body": "<p>I'm using <code>echo</code> framework. I'm stuck when trying to print URI <code>:mynumber</code> as variable in template files.</p>\n\n<p>All variable working fine except the URI <code>:mynumber</code>. I have no idea how to include <code>:mynumber</code> together with <code>Name</code> &amp; <code>Age</code></p>\n\n<p>Below is my <code>server.go</code>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    \"html/template\"\n    \"io\"\n    \"net/http\"\n)\n\ntype Person struct {\n    Name, Age, Mynumber string\n}\n\ntype (\n    Template struct {\n        templates *template.Template\n    }\n)\n\nfunc (t *Template) Render(w io.Writer, name string, data interface{}) error {\n    return t.templates.ExecuteTemplate(w, name, data)\n}\n\nfunc main() {\n    e := echo.New()\n\n    p := Person{Name: \"Mike San\", Age: \"35\"}\n\n    t := &amp;Template{\n        templates: template.Must(template.ParseFiles(\"public/views/testhere.html\")),\n    }\n    e.Renderer(t)\n\n    e.Get(\"/testing/:mynumber\", func(c *echo.Context) {\n        c.Render(http.StatusOK, \"onlytestingtpl\", p)\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n\n<p>Below is <code>public/views/testhere.html</code>:</p>\n\n<pre><code>{{define \"onlytestingtpl\"}}My name is {{.Name}}. I'm {{.Age}} years old. My number is {{.Mynumber}}.{{end}}\n</code></pre>\n\n<p>For your reference, below is example is print URI without template file:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    \"net/http\"\n)\n\nfunc main() {\n    e := echo.New()\n\n    e.Get(\"/users/:id\", func(c *echo.Context) {\n        id := c.Param(\"id\")\n        c.String(http.StatusOK, \"My number is \"+id)\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n"}, {"tags": ["http", "go", "server", "servemux"], "answers": [{"comments": [{"owner": {"reputation": 270, "user_id": 2130247, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/tLNtM.jpg?s=128&g=1", "display_name": "sourdesi", "link": "https://stackoverflow.com/users/2130247/sourdesi"}, "edited": false, "score": 0, "creation_date": 1430407919, "post_id": 29969630, "comment_id": 48063396, "body": "Agreed, thanks for such a comprehensive answer! And yeah, I realize that this is certainly not best practice for Go code or just Networking in general, but at this point Im just trying to make a quick refactor for some existing code. I think Ill go with creating a custom net.Conn interface and a custom net.Listener so I can just use a net.Server and have it listening on my custom net.Listener. That way I don&#39;t need to deal with creating a custom ResponseWriter, which may be problematic. But all things said, I agree, this is a total hack. Good thing this isn&#39;t production code or anything though"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1430402461, "last_edit_date": 1430402461, "creation_date": 1430401964, "answer_id": 29969630, "question_id": 29957596, "link": "https://stackoverflow.com/questions/29957596/how-to-use-servemux-with-serverconn/29969630#29969630", "title": "How to Use ServeMux with ServerConn?", "body": "<p>I would avoid doing this altogether if at all possible. Mixing protocols on the same connection is bound to lead to hard-to-trace bugs, and unexpected behavior. If you really want to do it, and have all the http/1.1 mechanisms work correctly, leave as much as possible to the http package. </p>\n\n<p>Since ResponseWriter is an interface, you would implement your own type to satisfy it. Look at the unexported <code>response</code> type in the http package for a full example. There's a lot to get right, and using it in combination with a ServerConn (which is documented as \"do no use\") is probably not a good idea.</p>\n\n<p>The place to do this at a lower level would be in <code>Accept</code> inside the Server's <code>net.Listener</code>. Since you're going to have to parse the start of every request twice, you would need a <code>net.Conn</code> that can be \"rewound\" partly. </p>\n\n<p>Make yourself a net.Listener that checks the start of the stream on a new connection, and if it looks like an http request, return a <code>net.Conn</code> that replays the first chunk you read off the wire on its first Reads. Something like:</p>\n\n<pre><code>type replayConn struct {\n    net.Conn\n    buf []byte\n    pos int\n}\n\nfunc (c *replayConn) Read(b []byte) (int, error) {\n    if c.pos &lt; len(c.buf) {\n        n := copy(b, c.buf[c.pos:])\n        c.pos += n\n        return n, nil\n    }\n    return c.Conn.Read(b)\n}\n</code></pre>\n\n<p>If the connection isn't http, then send the connection off to your other type of handler, and continue blocking on <code>Accept</code>.</p>\n"}], "owner": {"reputation": 270, "user_id": 2130247, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/tLNtM.jpg?s=128&g=1", "display_name": "sourdesi", "link": "https://stackoverflow.com/users/2130247/sourdesi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 103, "favorite_count": 0, "accepted_answer_id": 29969630, "answer_count": 1, "score": 1, "last_activity_date": 1430402461, "creation_date": 1430357924, "question_id": 29957596, "link": "https://stackoverflow.com/questions/29957596/how-to-use-servemux-with-serverconn", "title": "How to Use ServeMux with ServerConn?", "body": "<p>Im creating a Networking API and want people to be able to route requests to specific endpoints using a <a href=\"http://golang.org/pkg/net/http/#ServeMux\" rel=\"nofollow\">ServeMux</a>. Instead of using a <a href=\"http://golang.org/pkg/net/http/#Server\" rel=\"nofollow\">Server</a> instance, I need to use my own low level <a href=\"http://golang.org/pkg/net/http/httputil/#ServerConn\" rel=\"nofollow\">ServerConn</a>. This is because I am receiving both incoming HTTP requests and plain text data from the same port.</p>\n\n<p>The problem, however, is that if I want to forward a request using my ServeMux, I would use it's <a href=\"http://golang.org/pkg/net/http/#ServeMux.ServeHTTP\" rel=\"nofollow\">ServeHTTP</a> method. For this, I need to provide a ResponseWriter, which I don't know how to create an instance of since it is an interface, not a struct. Should a I create my own ResponseWriter struct? Is there one given by the Golang Standard Library? Or is there an alternate solution to this altogether?</p>\n"}]