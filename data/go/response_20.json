[{"tags": ["go", "zeromq"], "comments": [{"owner": {"reputation": 12998, "user_id": 545332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d8d3c844a9033a1c70daaaff2c4ab5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/545332/jason"}, "edited": false, "score": 0, "creation_date": 1432824304, "post_id": 30493492, "comment_id": 49095196, "body": "Please provide more of your code, or at least a more fully fleshed out example.  Are you intending to do this in one thread or multiple threads?  What socket types are you using both on this (client?) end and on the peer that you&#39;re messaging with?  How are you connecting/binding?  What distinguishes one &quot;routine&quot; from another &quot;routine&quot; in your code/data?  There are any number of possible solutions depending on the answers to these questions."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432826066, "post_id": 30493492, "comment_id": 49096566, "body": "I have zero experience/knowledge of ZeroMQ, but in the past when I had multiple goroutines making requests over a shared websocket I had a central goroutine where requests where actually written and responses read. That function had an input channel (of {request, response channel}), a map of the outstanding request ids (generated in sequence) and just used that map to find the appropriate channel to send the response body on (or to log and drop it if there was no map entry)."}, {"owner": {"reputation": 12998, "user_id": 545332, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/71d8d3c844a9033a1c70daaaff2c4ab5?s=128&d=identicon&r=PG", "display_name": "Jason", "link": "https://stackoverflow.com/users/545332/jason"}, "edited": false, "score": 0, "creation_date": 1432906023, "post_id": 30493492, "comment_id": 49135163, "body": "Well, I have zero experience/knowledge of Go, so don&#39;t we make a pair :). If you haven&#39;t read <a href=\"http://zguide.zeromq.org/page:all\" rel=\"nofollow noreferrer\">The Guide</a> I highly recommend you do so, there are all sorts of examples in Go throughout the document (whenever you see a code sample, there will be a link to a version in many different languages, with a quick glance it appears that most of them have a Go variant).  You&#39;ll probably see what you&#39;re trying to do, and see an example of it being done."}], "answers": [{"comments": [{"owner": {"reputation": 155, "user_id": 3554230, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1f2f1ec6616b27d3bb9a548a3736113f?s=128&d=identicon&r=PG&f=1", "display_name": "user3554230", "link": "https://stackoverflow.com/users/3554230/user3554230"}, "edited": false, "score": 0, "creation_date": 1571049728, "post_id": 30494682, "comment_id": 103099125, "body": "the other option is to have a socket for sending and a socket for recv. One being REP and the other REQ. Having them on separate routines to process the data."}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1432768426, "creation_date": 1432768426, "answer_id": 30494682, "question_id": 30493492, "link": "https://stackoverflow.com/questions/30493492/zeromq-knows-which-go-routine-a-request-came-from/30494682#30494682", "title": "ZeroMQ knows which go routine a request came from", "body": "<p>I don't believe a socket can be shared, concurrently, between threads using zeromq</p>\n\n<p>Likely you need to do some kind of goroutine that listens for requests, sends / receives zmq, and then replies.</p>\n\n<p>for example: (untested code)</p>\n\n<pre><code>type Req struct {\n   Data []byte \n   Reply chan []byte\n}\n\ngo func() { // probably not the zmq api, but you should get the idea here\n    for req := &lt;- requests {\n         socket.send(req.Data)\n         req.Reply &lt;- socket.recv() \n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 155, "user_id": 3554230, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/1f2f1ec6616b27d3bb9a548a3736113f?s=128&d=identicon&r=PG&f=1", "display_name": "user3554230", "link": "https://stackoverflow.com/users/3554230/user3554230"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 0, "accepted_answer_id": 30494682, "answer_count": 1, "score": 4, "last_activity_date": 1432768542, "creation_date": 1432762213, "last_edit_date": 1432768542, "question_id": 30493492, "link": "https://stackoverflow.com/questions/30493492/zeromq-knows-which-go-routine-a-request-came-from", "title": "ZeroMQ knows which go routine a request came from", "body": "<p>I am trying to figure out if i have two routines calling the same zeromq socket if when the return from socket.recv() on routine1 returns.. the socket will know to return to routine1 (ditto for routine2, ... routinen).</p>\n\n<p>Hence... using a messaging bus with request/response semantics, what is the best pattern to approach this in go?</p>\n\n<p>If it helps.. think about the simple pirate pattern and implementing an RPC style call set in that pattern with zeromq. </p>\n\n<pre><code>Socket; //zeromq socket\n//routine 1\nsocket.send(data) // do i need some identifier here for this routine?\nsocket.recv() // wait until i get a response from that send\n//routine 2 \nsocket.send(data)\nsocket.recv()\n</code></pre>\n\n<p>so in this case i have no idea if the response from routine1 or routine2 will come back first. How can i make sure that when i get a response to socket... i can notify the correct routines' recv() function.</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["json", "go", "amazon-dynamodb", "gob"], "answers": [{"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": false, "score": 0, "last_activity_date": 1432793071, "creation_date": 1432793071, "answer_id": 30498405, "question_id": 30493462, "link": "https://stackoverflow.com/questions/30493462/error-when-sending-blob-of-binary-data-to-dynamodb/30498405#30498405", "title": "Error when sending blob of binary data to dynamodb", "body": "<p>\"Client applications must encode binary values in base64 format\" according to the binary data type description of <a href=\"http://docs.aws.amazon.com/amazondynamodb/latest/developerguide/DataModel.html#DataModel.DataTypes\" rel=\"nofollow\">Amazon DynamoDB Data Types</a>.</p>\n\n<p>Your code could encode the value if you want, see golang's base64 package:\n<a href=\"https://golang.org/pkg/encoding/base64\" rel=\"nofollow\">https://golang.org/pkg/encoding/base64</a></p>\n\n<p>The godynamo library provides functions that will encode it for you, have a look at <a href=\"https://github.com/smugmug/godynamo/blob/5dbd3b0146cd832f25d80fdb8a04e174c83ff74e/types/attributevalue/attributevalue.go\" rel=\"nofollow\">AttributeValue</a>:</p>\n\n<pre><code>    // InsertB_unencoded adds a new plain string to the B field.\n    // The argument is assumed to be plaintext and will be base64 encoded.\n    func (a *AttributeValue) InsertB_unencoded(k string) error {\n</code></pre>\n"}], "owner": {"reputation": 588, "user_id": 2159333, "user_type": "registered", "accept_rate": 34, "profile_image": "https://www.gravatar.com/avatar/63358b101e0b167066b6cd7868d36998?s=128&d=identicon&r=PG", "display_name": "Daniel Imberman", "link": "https://stackoverflow.com/users/2159333/daniel-imberman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 946, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432793071, "creation_date": 1432762070, "question_id": 30493462, "link": "https://stackoverflow.com/questions/30493462/error-when-sending-blob-of-binary-data-to-dynamodb", "title": "Error when sending blob of binary data to dynamodb", "body": "<p>I'm running into an issue with attempting to manage a dynamodb instance using godynamo.</p>\n\n<p>My code is meant to take a gob encoded byte array and put it into dynamodb.</p>\n\n<pre><code>func (c *checkPointManager) CommitGraph(pop *Population) {\n    var blob, err = pop.GobEncodeColorGraphs()\n    fitness := pop.GetTotalFitness()\n    if err != nil {\n            log.Fatal(err)\n    }\n\n    put1 := put.NewPutItem()\n    put1.TableName = \"CheckPoint\"\n    put1.Item[\"fitnessScore\"] = &amp;attributevalue.AttributeValue{N: string(fitness)}\n    put1.Item[\"population\"] = &amp;attributevalue.AttributeValue{N: string(1)}\n    put1.Item[\"graph\"] = &amp;attributevalue.AttributeValue{B: string(blob)}\n    body, code, err := put1.EndpointReq()\n    if err != nil || code != http.StatusOK {\n            log.Fatalf(\"put failed %d %v %s\\n\", code, err, body)\n    }\n    fmt.Printf(\"values checkpointed:  %d\\n %v\\n %s\\n\", code, err, body)\n</code></pre>\n\n<p>}</p>\n\n<p>Every time I run this code though, I get the following error.\n     can not be converted to a Blob: Base64 encoded length is expected a multiple of 4 bytes but found: 25</p>\n\n<p>Does godynamo not handle making sure a binary array specifically converts to base64? Is there an easy way for me to handle this issue?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432760139, "post_id": 30492568, "comment_id": 49063646, "body": "Do you know the types of the unknown fields?"}, {"owner": {"reputation": 8503, "user_id": 1946861, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/2ObQs.jpg?s=128&g=1", "display_name": "jlhonora", "link": "https://stackoverflow.com/users/1946861/jlhonora"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432760258, "post_id": 30492568, "comment_id": 49063713, "body": "@inf no, not really. But if you hace a workaround that involves knowing the types then I guess I could work something out"}], "answers": [{"tags": [], "owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "is_accepted": false, "score": 3, "last_activity_date": 1432864693, "last_edit_date": 1432864693, "creation_date": 1432862189, "answer_id": 30519605, "question_id": 30492568, "link": "https://stackoverflow.com/questions/30492568/go-modify-json-on-the-fly/30519605#30519605", "title": "Go - Modify JSON on the fly", "body": "<p>Change</p>\n\n<pre><code>j[\"object\"][\"array\"][i]\n</code></pre>\n\n<p>to</p>\n\n<pre><code>j[\"object\"].(map[string]interface{})[\"array\"].([]interface{})[i]\n</code></pre>\n"}], "owner": {"reputation": 8503, "user_id": 1946861, "user_type": "registered", "accept_rate": 66, "profile_image": "https://i.stack.imgur.com/2ObQs.jpg?s=128&g=1", "display_name": "jlhonora", "link": "https://stackoverflow.com/users/1946861/jlhonora"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1257, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432864693, "creation_date": 1432758673, "last_edit_date": 1432763147, "question_id": 30492568, "link": "https://stackoverflow.com/questions/30492568/go-modify-json-on-the-fly", "title": "Go - Modify JSON on the fly", "body": "<p>Considering the following input:</p>\n\n<pre><code>\"object\": {\n  \"array\": [\n    {\n      \"element_field_1\": some_value_1,\n      \"element_field_2\": some_value_1,\n      ... // More unknown fields\n    },\n    ...\n  ],\n  \"object_field\": foo,\n  ... // Some more unknown fields\n}\n</code></pre>\n\n<p>I need to iterate over every element of the array, modify fields 1 and 2 and then output the JSON object. Here's what I have for now, but it is far from being valid Go code:</p>\n\n<pre><code>func handler(w http.ResponseWriter, r *http.Request) {\n    // Transform the request's body to an interface\n    j := getDecodedJSON(r)\n\n    // Iterate over every element of the array\n    for i := 0; i &lt; len(j[\"object\"][\"array\"]); i++ {\n        rewrite(j[\"object\"][\"array\"][i])\n    }\n\n    // Encoding back to JSON shouldn't be a problem\n}\n\nfunc getDecodedJSON(r *http.Request) map[string]interface{} {\n    dec := json.NewDecoder(r.Body)\n    var j map[string]interface{}\n    if err := dec.Decode(&amp;j); err != nil {\n        log.Fatal(err)\n    }\n    return j\n}\n\nfunc rewrite(element *map[string]interface{}) {\n    element[\"element_field_1\"], element[\"element_field_2\"] = lookupValues(element)\n}\n</code></pre>\n\n<p>Basically the error is:</p>\n\n<pre><code>invalid operation: j[\"object\"][\"array\"] \\\n(type interface {} does not support indexing)\n</code></pre>\n\n<p>but of course there's a more conceptual mistake on my approach.</p>\n\n<p>Writing a <code>struct</code> that details the content of the input isn't really an option, since I don't know the JSON keys beforehand.</p>\n\n<p>How can I do this \"the Go way\"?</p>\n\n<p><strong>EDIT</strong>: This is the actual use case:</p>\n\n<ul>\n<li>I have two web services that need a \"translator\" between them.</li>\n<li>Service 1 makes a request to the translator, where a couple of fields are modified, everything else is left intact.</li>\n<li>Then the translator takes the modified JSON and replicates the request to service 2.</li>\n</ul>\n\n<p>In other words, this translator acts like a man in the middle for both services. Go seems to be a good option for this given its fast startup times and fast JSON handling.</p>\n\n<p>I don't think it makes sense to detail every JSON field in a Go struct, since I only need to change a few fields. I'm willing to make a tradeoff in efficiency because of reflection (parsing to a <code>map[string]interface{}</code> should be slower than using a full-blown struct), in exchange of making the code more generic to variations of the JSON input.</p>\n"}, {"tags": ["go", "initializer-list"], "answers": [{"comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1432777246, "post_id": 30491922, "comment_id": 49069010, "body": "Or array: <code>range [...]string{&quot;foo&quot;, &quot;bar&quot;, &quot;baz&quot;}</code>"}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1432792448, "post_id": 30491922, "comment_id": 49073211, "body": "@kostya Thanks for the hint, added it to the answer."}, {"owner": {"reputation": 37732, "user_id": 407731, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/793650b627e1896cebe3ad7c3348046e?s=128&d=identicon&r=PG", "display_name": "Dave Dopson", "link": "https://stackoverflow.com/users/407731/dave-dopson"}, "edited": false, "score": 0, "creation_date": 1432846605, "post_id": 30491922, "comment_id": 49108925, "body": "Oh, interesting.  I didn&#39;t realize that the [] and [...] had different effects (slice vs array).  I ended up using this technique.  It&#39;s rather verbose, especially if the type name is long, but it does work."}], "tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 4, "last_activity_date": 1432792431, "last_edit_date": 1432792431, "creation_date": 1432756339, "answer_id": 30491922, "question_id": 30491865, "link": "https://stackoverflow.com/questions/30491865/what-is-the-go-equivalent-of-c-initializer-lists/30491922#30491922", "title": "What is the Go equivalent of C++ initializer lists?", "body": "<p>Simply use a slice:</p>\n\n<pre><code>for _, value := range []string{\"foo\", \"bar\", \"baz\"} {\n    fmt.Println(value)\n}\n</code></pre>\n\n<p>or alternatively an array:</p>\n\n<pre><code>for _, value := range [...]string{\"foo\", \"bar\", \"baz\"} {\n    fmt.Println(value)\n}\n</code></pre>\n"}], "owner": {"reputation": 37732, "user_id": 407731, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/793650b627e1896cebe3ad7c3348046e?s=128&d=identicon&r=PG", "display_name": "Dave Dopson", "link": "https://stackoverflow.com/users/407731/dave-dopson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51, "favorite_count": 0, "accepted_answer_id": 30491922, "answer_count": 1, "score": 0, "last_activity_date": 1432792431, "creation_date": 1432756127, "last_edit_date": 1432757630, "question_id": 30491865, "link": "https://stackoverflow.com/questions/30491865/what-is-the-go-equivalent-of-c-initializer-lists", "title": "What is the Go equivalent of C++ initializer lists?", "body": "<p>In C++, I might do the following:</p>\n\n<pre><code>for (const string&amp; key : {\"foo\", \"bar\", \"baz\"}) {\n  DoSomeThingWithKey(key);\n}\n</code></pre>\n\n<p>The <code>{\"foo\", \"bar\", \"baz\"}</code> is a <code>std:initializer_list</code>.  Awesomeness.</p>\n\n<p>Is there an equivalent idiomatic pattern for Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1432754640, "post_id": 30490473, "comment_id": 49060606, "body": "You can achieve this with reflection, but the verbose way will give you much better performance. If you want an example on how to do this with reflection I can write a simplified example."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1432754674, "post_id": 30490473, "comment_id": 49060624, "body": "BTW you can also use code generation to automatically generate explicit merging functions."}], "answers": [{"comments": [{"owner": {"reputation": 183, "user_id": 2442282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70e2ccc2b68213ec050b5ea239fc3fd6?s=128&d=identicon&r=PG", "display_name": "Jon Molnar", "link": "https://stackoverflow.com/users/2442282/jon-molnar"}, "edited": false, "score": 0, "creation_date": 1432833762, "post_id": 30491395, "comment_id": 49101508, "body": "Thanks. I figured that would be the way to go, but I haven&#39;t actually done any reflection code in Go yet. It&#39;s much simpler than I expected!"}], "tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 7, "last_activity_date": 1432754685, "creation_date": 1432754685, "answer_id": 30491395, "question_id": 30490473, "link": "https://stackoverflow.com/questions/30490473/updating-objects-from-rest-api-calls-struct-merge/30491395#30491395", "title": "Updating objects from REST API calls - struct merge?", "body": "<p>Well, if you are open to using reflection, the problem becomes fairly simple:</p>\n\n<p><a href=\"http://play.golang.org/p/dc-OnO1cZ4\" rel=\"noreferrer\">http://play.golang.org/p/dc-OnO1cZ4</a></p>\n\n<pre><code>func (m1 Model) Update(m2 Model) (m3 Model) {\n    old := reflect.ValueOf(m1)\n    new := reflect.ValueOf(m2)\n    final := reflect.ValueOf(&amp;m3).Elem()\n    for i := 0; i &lt; old.NumField(); i++ {\n        if !new.Field(i).IsNil()  {\n           final.Field(i).Set(new.Field(i))\n        } else {\n           final.Field(i).Set(old.Field(i))\n        }      \n    }\n    return\n}\n</code></pre>\n\n<p>The reason we do <code>reflect.ValueOf(&amp;m3).Elem()</code> is that v3 needs to be settable, see <a href=\"http://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">http://blog.golang.org/laws-of-reflection</a></p>\n\n<p>But basically, by using reflection, we can loop through the struct fields, see if the updated one is nil, and if so, we use the old value.</p>\n"}, {"comments": [{"owner": {"reputation": 2828, "user_id": 158119, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c45b21d940a6c5b78da7205268b60604?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/158119/tom"}, "edited": false, "score": 1, "creation_date": 1487447646, "post_id": 30493588, "comment_id": 71793135, "body": "This is good and just what I was looking for too, but only works if your struct types are pointers because the <code>IsNil()</code> call. If, for example, <code>Field1 *string</code> was <code>Field string</code> it&#39;d panic. So you&#39;ll need to see if the field is a pointer first (<code>reflect.Ptr</code>) before calling <code>IsNil()</code> else check for a Zero value. See updated: <a href=\"https://play.golang.org/p/cg9pQrfVOl\" rel=\"nofollow noreferrer\">play.golang.org/p/cg9pQrfVOl</a>"}, {"owner": {"reputation": 2828, "user_id": 158119, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c45b21d940a6c5b78da7205268b60604?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/158119/tom"}, "edited": false, "score": 0, "creation_date": 1487448473, "post_id": 30493588, "comment_id": 71793390, "body": "I forgot to note that this also assumes you want to merge in empty values. Look at Field3 for example. Since it is not set on the new struct, it will get its empty string value which will replace the value in the old struct. So this merge/update assumes you want to be able to remove values. If not, then you may wish to work with nil values or write in some sort of exception."}, {"owner": {"reputation": 2828, "user_id": 158119, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/c45b21d940a6c5b78da7205268b60604?s=128&d=identicon&r=PG", "display_name": "Tom", "link": "https://stackoverflow.com/users/158119/tom"}, "edited": false, "score": 0, "creation_date": 1487450132, "post_id": 30493588, "comment_id": 71793976, "body": "For completeness, you can check <code>if x.String() != &quot;&quot;</code> where the <code>.Set()</code> call is made. <code>String()</code> is special in that it won&#39;t panic so you can easily choose to skip the field and keep the old original value. See field 3 now: <a href=\"https://play.golang.org/p/dUgelcIjJ2\" rel=\"nofollow noreferrer\">play.golang.org/p/dUgelcIjJ2</a>"}], "tags": [], "owner": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "is_accepted": false, "score": 2, "last_activity_date": 1432764761, "last_edit_date": 1432764761, "creation_date": 1432762602, "answer_id": 30493588, "question_id": 30490473, "link": "https://stackoverflow.com/questions/30490473/updating-objects-from-rest-api-calls-struct-merge/30493588#30493588", "title": "Updating objects from REST API calls - struct merge?", "body": "<h2>Use reflection</h2>\n\n<p>You can update the <code>Model</code> using reflection, and <a href=\"http://golang.org/pkg/reflect/\" rel=\"nofollow\">the <code>reflect</code> package</a>.</p>\n\n<p>The following function updates the old <code>Model</code> in-place:</p>\n\n<pre><code>func (old *Model) MergeInPlace(new Model) {\n    for ii := 0; ii &lt; reflect.TypeOf(old).Elem().NumField(); ii++ {\n        if x := reflect.ValueOf(&amp;new).Elem().Field(ii); !x.IsNil() {\n            reflect.ValueOf(old).Elem().Field(ii).Set(x)\n        }\n    }\n}\n</code></pre>\n\n<p>You would call this method by saying <code>x.MergeInPlace(y)</code>, where <code>x</code> and <code>y</code> are <code>Model</code>s. <code>x</code> will be modified after you call this function.</p>\n\n<h2>Sample output</h2>\n\n<p>\"Merging\" the following,</p>\n\n<pre><code>{  \n   \"id\":\"1\",\n   \"field1\":\"one\",\n   \"field2\":\"two\",\n   \"field3\":\"three\"\n}\n{  \n   \"id\":\"1\",\n   \"field3\":\"THREE\"\n}    \n</code></pre>\n\n<p>yields:</p>\n\n<pre><code>{  \n   \"id\":\"1\",\n   \"field1\":\"one\",\n   \"field2\":\"two\",\n   \"field3\":\"THREE\"\n}\n</code></pre>\n\n<p>That is, it overwrites all values present in the new struct in the old one, ignoring values that are \"undefined\".</p>\n\n<p>Obviously, you can Marshal (or not) as you please.</p>\n\n<h2>Complete program</h2>\n\n<p><a href=\"http://play.golang.org/p/_l9srHDHKo\" rel=\"nofollow\">See a complete, working example at the Go Playground.</a></p>\n\n<p>The normal caveats (check returned errors in production!) apply.</p>\n"}, {"tags": [], "owner": {"reputation": 231, "user_id": 5735967, "user_type": "registered", "profile_image": "https://graph.facebook.com/855224311241649/picture?type=large", "display_name": "Thiago Zanivan Felisberto", "link": "https://stackoverflow.com/users/5735967/thiago-zanivan-felisberto"}, "is_accepted": false, "score": 4, "last_activity_date": 1451653394, "creation_date": 1451653394, "answer_id": 34556370, "question_id": 30490473, "link": "https://stackoverflow.com/questions/30490473/updating-objects-from-rest-api-calls-struct-merge/34556370#34556370", "title": "Updating objects from REST API calls - struct merge?", "body": "<p>Another option, if you don't want to use reflection, is to retrieve the object from the database and pass it's address to the JSON decoder. Only the fields defined in the JSON of the update method will be updated. Then you can use a normal method to save the changes to the database. Here's a sample code using gin and gorm.</p>\n\n<pre><code>func TodoUpdate(c *gin.Context) {\n    var todo Todo\n    todoId := c.Param(\"todoId\")\n    DB.First(&amp;todo, todoId)\n    if err := json.NewDecoder(c.Request.Body).Decode(&amp;todo); err != nil {\n        log.Fatal(\"Update error. Error:\", err.Error())\n    }\n    DB.Save(&amp;todo)\n}\n</code></pre>\n\n<p>So, for example, if you have <code>{\"ID\":1,\"name\":\"Do stuff\",\"completed\":false}</code> in your database, and send something like <code>{\"completed\":true}</code> to your update method (<code>/todos/1</code>, where 1 is <code>todoId</code>) you'll end up with this: <code>{\"ID\":1,\"name\":\"Do stuff\",\"completed\":true}</code>.</p>\n"}], "owner": {"reputation": 183, "user_id": 2442282, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/70e2ccc2b68213ec050b5ea239fc3fd6?s=128&d=identicon&r=PG", "display_name": "Jon Molnar", "link": "https://stackoverflow.com/users/2442282/jon-molnar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2106, "favorite_count": 3, "accepted_answer_id": 30491395, "answer_count": 3, "score": 6, "last_activity_date": 1451653394, "creation_date": 1432751611, "last_edit_date": 1432848369, "question_id": 30490473, "link": "https://stackoverflow.com/questions/30490473/updating-objects-from-rest-api-calls-struct-merge", "title": "Updating objects from REST API calls - struct merge?", "body": "<p>I have a JSON REST API accepting sparse updates, but the pattern I've come up with seems exceptionally verbose. Am I going about this the wrong way?</p>\n\n<p>(Assume this is using a data store with no sparse update support built in.)</p>\n\n<pre><code>func choose(a, b *string) *string {\n    if a != nil {\n        return a\n    }\n    return b\n}\n\ntype Model {\n    Id     *string `json:\"id\"`\n    Field1 *string `json:\"field1\"`\n    Field2 *string `json:\"field2\"`\n    Field3 *string `json:\"field3\"`\n    ...\n}\n\nfunc (m1 Model) Update(m2 Model) (m3 Model) {\n    m3.Id = choose(m2.Id, m1.Id)\n    m3.Field1 = choose(m2.Field1, m1.Field1)\n    m3.Field2 = choose(m2.Field2, m1.Field2)\n    m3.Field3 = choose(m2.Field3, m1.Field3)\n    ...\n    return\n}\n\nfunc UpdateController(input Model) error {\n    previous, _ := store.Get(*input.Id)\n    updated := previous.Update(input)\n    return store.Put(updated)\n}\n</code></pre>\n\n<p>Ideally I'd be able to write <code>UpdateController</code> like this instead:</p>\n\n<pre><code>func UpdateController(input Model) {\n    previous, _ := store.Get(*input.Id)\n    updated, _ := structs.Update(previous, input)\n    return store.Put(updated)\n}\n</code></pre>\n\n<p>(Error-handling elided for clarity.)</p>\n"}, {"tags": ["json", "go", "negroni"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432747668, "post_id": 30489268, "comment_id": 49056776, "body": "If <code>str</code> is already json, why are you trying to marshal it? (you&#39;re also trying to re-marshal it twice)"}, {"owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "edited": false, "score": 0, "creation_date": 1432747701, "post_id": 30489268, "comment_id": 49056787, "body": "You already have json, you don&#39;t need to encode it as json, just use it"}, {"owner": {"reputation": 1833, "user_id": 1269987, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/109257bc96f7c7102148e6e02a361405?s=128&d=identicon&r=PG", "display_name": "dylanjha", "link": "https://stackoverflow.com/users/1269987/dylanjha"}, "edited": false, "score": 0, "creation_date": 1432747737, "post_id": 30489268, "comment_id": 49056807, "body": "so the first example I have should work?"}, {"owner": {"reputation": 1833, "user_id": 1269987, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/109257bc96f7c7102148e6e02a361405?s=128&d=identicon&r=PG", "display_name": "dylanjha", "link": "https://stackoverflow.com/users/1269987/dylanjha"}, "edited": false, "score": 0, "creation_date": 1432747756, "post_id": 30489268, "comment_id": 49056819, "body": "or use <code>w.Write()</code> ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1432748147, "post_id": 30489268, "comment_id": 49057026, "body": "yes, just write the json to your <code>ResponseWriter</code>"}], "answers": [{"comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 4, "creation_date": 1432750455, "post_id": 30489974, "comment_id": 49058296, "body": "Instead of all those <code>\\&quot;</code>, use <code>`raw strings`</code>."}, {"owner": {"reputation": 18578, "user_id": 4031815, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/a945fa2f0e9ecbcf3f670e0865fa7169?s=128&d=identicon&r=PG&f=1", "display_name": "CommonSenseCode", "link": "https://stackoverflow.com/users/4031815/commonsensecode"}, "edited": false, "score": 0, "creation_date": 1527329158, "post_id": 30489974, "comment_id": 88094356, "body": "this is bad security practice, your languages default encoding and decoding json methods should always be used."}], "tags": [], "owner": {"reputation": 1833, "user_id": 1269987, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/109257bc96f7c7102148e6e02a361405?s=128&d=identicon&r=PG", "display_name": "dylanjha", "link": "https://stackoverflow.com/users/1269987/dylanjha"}, "is_accepted": true, "score": 2, "last_activity_date": 1432749897, "creation_date": 1432749897, "answer_id": 30489974, "question_id": 30489268, "link": "https://stackoverflow.com/questions/30489268/encode-arbitrary-string-to-json-in-http-response/30489974#30489974", "title": "Encode arbitrary string to JSON in http response", "body": "<p>Solution (w is the responseWriter)</p>\n\n<pre><code>str := \"{\\\"key1\\\":{\\\"key2\\\":\\\"value1\\\",\\\"key3\\\":\\\"value2\\\"}}\"\nw.Write([]byte(str))\n</code></pre>\n"}], "owner": {"reputation": 1833, "user_id": 1269987, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/109257bc96f7c7102148e6e02a361405?s=128&d=identicon&r=PG", "display_name": "dylanjha", "link": "https://stackoverflow.com/users/1269987/dylanjha"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 304, "favorite_count": 0, "accepted_answer_id": 30489974, "answer_count": 1, "score": -5, "last_activity_date": 1432749897, "creation_date": 1432747504, "question_id": 30489268, "link": "https://stackoverflow.com/questions/30489268/encode-arbitrary-string-to-json-in-http-response", "title": "Encode arbitrary string to JSON in http response", "body": "<p>I have a string of JSON that I want to encode as json into an http response.</p>\n\n<p>This returns a string in the response:</p>\n\n<pre><code>str := \"{\\\"key1\\\":{\\\"key2\\\":\\\"value1\\\",\\\"key3\\\":\\\"value2\\\"}}\"\nerr := json.NewEncoder(w).Encode(str)\n</code></pre>\n\n<p>I'm trying to first marshal the string to JSON. Which gives me another string of random bytes.</p>\n\n<pre><code>str := \"{\\\"key1\\\":{\\\"key2\\\":\\\"value1\\\",\\\"key3\\\":\\\"value2\\\"}}\"\njs, _ := json.Marshal(str)\nerr := json.NewEncoder(w).Encode(js)\n</code></pre>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432748877, "post_id": 30489163, "comment_id": 49057447, "body": "Which PostgreSQL database driver are you using? Did you read through it&#39;s documentation (such a feature would be provided by the driver)? Failing that, you could probably just make a slice type that implements <a href=\"https://golang.org/pkg/database/sql/#Scanner\" rel=\"nofollow noreferrer\"><code>sql.Scanner</code></a>."}, {"owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432750127, "post_id": 30489163, "comment_id": 49058123, "body": "Using <a href=\"http://godoc.org/github.com/lib/pq\" rel=\"nofollow noreferrer\">godoc.org/github.com/lib/pq</a> Ok thanks Ill look into that, abit disappointing this isnt available out of the box"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432755836, "post_id": 30489163, "comment_id": 49061360, "body": "BTW, you shouldn&#39;t even be looking at <code>len(arr)</code> without checking the error return from <code>Scan</code> (which would likely be something like: &quot;reflect.Set: value of type []uint8 is not assignable to type []string&quot;, i.e. the database driver gets the column as a <code>[]byte</code>)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432755863, "post_id": 30489163, "comment_id": 49061377, "body": "A quick search of <a href=\"https://github.com/lib/pq/issues?utf8=%E2%9C%93&amp;q=is%3Aissue+is%3Aopen+array\" rel=\"nofollow noreferrer\">issues for that package</a> turns up: <a href=\"https://github.com/lib/pq/issues/49\" rel=\"nofollow noreferrer\">Support Postgresql array types #49</a> and <a href=\"https://github.com/lib/pq/issues/49\" rel=\"nofollow noreferrer\">Array Support #327</a>. You could comment on or track one of those."}, {"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1527617205, "post_id": 30489163, "comment_id": 88190157, "body": "check this <a href=\"https://www.opsdash.com/blog/postgres-arrays-golang.html\" rel=\"nofollow noreferrer\">opsdash.com/blog/postgres-arrays-golang.html</a>, following this tutorial i was able to overcome the mapping between slices (go) and arrays (postgres)"}], "answers": [{"tags": [], "owner": {"reputation": 38917, "user_id": 445210, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/9b689cc1d73c4f1e7378d045a54abcca?s=128&d=identicon&r=PG", "display_name": "Herman Schaaf", "link": "https://stackoverflow.com/users/445210/herman-schaaf"}, "is_accepted": false, "score": 2, "last_activity_date": 1433438445, "last_edit_date": 1433438445, "creation_date": 1433437469, "answer_id": 30649967, "question_id": 30489163, "link": "https://stackoverflow.com/questions/30489163/read-a-postgresql-array-directly-into-a-golang-slice/30649967#30649967", "title": "Read a Postgresql array directly into a Golang Slice", "body": "<p>At the moment, there is no direct way to load a PostgreSQL array into a Go slice using the <code>lib/pq</code> library. It may be at some point, but there has been some debate over whether such a thing should be handled transparently by the library itself.</p>\n\n<p>However, one option is to load the result into a string (that looks like <code>{item1,item2,\"comma,item\"}</code>), and then split that string into a string slice using a regular expression, as done in the code below (taken in part from <a href=\"https://gist.github.com/adharris/4163702\" rel=\"nofollow\">this Gist</a> by Andrew Harris):</p>\n\n<pre><code>import (\n    \"regexp\"\n    \"strings\"\n)\n\nvar (\n    // unquoted array values must not contain: (\" , \\ { } whitespace NULL)\n    // and must be at least one char\n    unquotedChar  = `[^\",\\\\{}\\s(NULL)]`\n    unquotedValue = fmt.Sprintf(\"(%s)+\", unquotedChar)\n\n    // quoted array values are surrounded by double quotes, can be any\n    // character except \" or \\, which must be backslash escaped:\n    quotedChar  = `[^\"\\\\]|\\\\\"|\\\\\\\\`\n    quotedValue = fmt.Sprintf(\"\\\"(%s)*\\\"\", quotedChar)\n\n    // an array value may be either quoted or unquoted:\n    arrayValue = fmt.Sprintf(\"(?P&lt;value&gt;(%s|%s))\", unquotedValue, quotedValue)\n\n    // Array values are separated with a comma IF there is more than one value:\n    arrayExp = regexp.MustCompile(fmt.Sprintf(\"((%s)(,)?)\", arrayValue))\n)\n\n// Parse the output string from the array type.\n// Regex used: (((?P&lt;value&gt;(([^\",\\\\{}\\s(NULL)])+|\"([^\"\\\\]|\\\\\"|\\\\\\\\)*\")))(,)?)\nfunc pgArrayToSlice(array string) []string {\n    var valueIndex int\n    results := make([]string, 0)\n    matches := arrayExp.FindAllStringSubmatch(array, -1)\n    for _, match := range matches {\n        s := match[valueIndex]\n        // the string _might_ be wrapped in quotes, so trim them:\n        s = strings.Trim(s, \"\\\"\")\n        results = append(results, s)\n    }\n    return results\n}\n</code></pre>\n\n<p>Here is how it might be used:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT link FROM links\")\nif err != nil {\n    panic(err)\n}\nvar tmp string\nfor rows.Next() {\n    rows.Scan(&amp;tmp)\n    links := pgArrayToSlice(tmp)\n    fmt.Println(len(links), links)\n}\n</code></pre>\n\n<p>With the following in the database:</p>\n\n<pre><code># \\d links\n    Table \"public.links\"\n Column |  Type  | Modifiers \n--------+--------+-----------\n link   | text[] | \n\n# select * from links;\n             link             \n------------------------------\n {this,that}\n {another,thing}\n\n {}\n {\"test,123\",\"one,two,three\"}\n(5 rows)\n</code></pre>\n\n<p>This is what is output by the Go code above:</p>\n\n<pre><code>2 []string{\"this,\", \"that\"}\n2 []string{\"another,\", \"thing\"}\n2 []string{\"another,\", \"thing\"}\n0 []string{}\n2 []string{\"test,123\\\",\", \"one,two,three\"}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3188, "user_id": 387176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4e7f15382707eba1868cfcf1981771a4?s=128&d=identicon&r=PG", "display_name": "Russ Egan", "link": "https://stackoverflow.com/users/387176/russ-egan"}, "is_accepted": false, "score": 2, "last_activity_date": 1468553054, "creation_date": 1468553054, "answer_id": 38387392, "question_id": 30489163, "link": "https://stackoverflow.com/questions/30489163/read-a-postgresql-array-directly-into-a-golang-slice/38387392#38387392", "title": "Read a Postgresql array directly into a Golang Slice", "body": "<p>I've seen variations of this code all over the place, but it doesn't work for me for certain test sets.</p>\n\n<p>Here something I wrote which handles all the test values I've thrown at it (test cases follow).  It's also about 80% faster.</p>\n\n<pre><code>func ParsePGArray(array string) ([]string, error) {\n  var out []string\n  var arrayOpened,quoteOpened,escapeOpened bool\n  item := &amp;bytes.Buffer{}\n  for _, r := range array {\n    switch {\n    case !arrayOpened:\n      if r != '{' {\n        return nil, errors.New(\"Doesn't appear to be a postgres array.  Doesn't start with an opening curly brace.\")\n      }\n      arrayOpened = true\n    case escapeOpened:\n      item.WriteRune(r)\n      escapeOpened = false\n    case quoteOpened:\n      switch r {\n      case '\\\\':\n        escapeOpened = true\n      case '\"':\n        quoteOpened = false\n        if item.String() == \"NULL\" {\n          item.Reset()\n        }\n      default:\n        item.WriteRune(r)\n      }\n    case r == '}':\n      // done\n      out = append(out, item.String())\n      return out, nil\n    case r == '\"':\n      quoteOpened = true\n    case r == ',':\n      // end of item\n      out = append(out, item.String())\n      item.Reset()\n    default:\n      item.WriteRune(r)\n    }\n  }\n  return nil, errors.New(\"Doesn't appear to be a postgres array.  Premature end of string.\")\n}\n</code></pre>\n\n<p>Here are the tests cases:</p>\n\n<pre><code>scanTests := []struct {\n  in   string\n  out  []string\n}{\n  {\"{one,two}\", []string{\"one\", \"two\"}},\n  {`{\"one, sdf\",two}`, []string{\"one, sdf\", \"two\"}},\n  {`{\"\\\"one\\\"\",two}`, []string{`\"one\"`, \"two\"}},\n  {`{\"\\\\one\\\\\",two}`, []string{`\\one\\`, \"two\"}},\n  {`{\"{one}\",two}`, []string{`{one}`, \"two\"}},\n  {`{\"one two\"}`, []string{`one two`}},\n  {`{\"one,two\"}`, []string{`one,two`}},\n  {`{abcdef:83bf98cc-fec9-4e77-b4cf-99f9fb6655fa-0NH:zxcvzxc:wers:vxdfw-asdf-asdf}`, []string{\"abcdef:83bf98cc-fec9-4e77-b4cf-99f9fb6655fa-0NH:zxcvzxc:wers:vxdfw-asdf-asdf\"}},\n  {`{\"\",two}`, []string{\"\",\"two\"}},\n  {`{\" \",\"NULL\"}`, []string{\" \",\"\"}},\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 899, "user_id": 3260209, "user_type": "registered", "accept_rate": 44, "profile_image": "https://graph.facebook.com/100000966234908/picture?type=large", "display_name": "Prata", "link": "https://stackoverflow.com/users/3260209/prata"}, "is_accepted": false, "score": 12, "last_activity_date": 1491830545, "creation_date": 1491830545, "answer_id": 43324362, "question_id": 30489163, "link": "https://stackoverflow.com/questions/30489163/read-a-postgresql-array-directly-into-a-golang-slice/43324362#43324362", "title": "Read a Postgresql array directly into a Golang Slice", "body": "<p>I think this should do the job. Using <strong>array_to_json</strong> in sql. Then <strong>unmarshalling</strong> the json-string to golang slice</p>\n\n<pre><code>sql-&gt; select array_to_json(arr) from ....\n\nvar arrStr string\nvar arr []string\n\nfor rows.Next() {\n    rows.Scan(&amp;arrStr)\n    json.Unmarshal([]byte(arrStr), &amp;arr)\n    fmt.Println(len(arr))\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 879, "user_id": 3778355, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/57af174c54dc32e59d8a528805e4a9db?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/3778355/richard"}, "edited": false, "score": 2, "creation_date": 1569221381, "post_id": 51549696, "comment_id": 102511228, "body": "Note that <code>pq.Array()</code> only works with <code>[]bool</code>, <code>[]float64</code>, <code>[]int64</code> or <code>[]string</code>. This is easy to check with the code source."}, {"owner": {"reputation": 1124, "user_id": 5628642, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cTRoG.jpg?s=128&g=1", "display_name": "chinmayan", "link": "https://stackoverflow.com/users/5628642/chinmayan"}, "edited": false, "score": 0, "creation_date": 1585035315, "post_id": 51549696, "comment_id": 107618256, "body": "Is there any side effects for using <code>pq.Array()</code>. Like any performance impacts?"}], "tags": [], "owner": {"reputation": 370, "user_id": 8210633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5bfc2d3ce85f67f84f06bfc9e6b8811?s=128&d=identicon&r=PG", "display_name": "lukeic", "link": "https://stackoverflow.com/users/8210633/lukeic"}, "is_accepted": true, "score": 12, "last_activity_date": 1569462084, "last_edit_date": 1569462084, "creation_date": 1532656018, "answer_id": 51549696, "question_id": 30489163, "link": "https://stackoverflow.com/questions/30489163/read-a-postgresql-array-directly-into-a-golang-slice/51549696#51549696", "title": "Read a Postgresql array directly into a Golang Slice", "body": "<p>As mentioned by Victor in the comments on the original post, <a href=\"https://www.opsdash.com/blog/postgres-arrays-golang.html\" rel=\"nofollow noreferrer\">this</a> post answers the question well with its explanation of <code>pq.Array()</code>.</p>\n\n<p>Taken directly from the link:</p>\n\n<blockquote>\n  <p>To read a Postgres array value into a Go slice, use:</p>\n\n<pre><code>func getTags(db *sql.DB, title string) (tags []string) {\n    // the select query, returning 1 column of array type\n    sel := \"SELECT tags FROM posts WHERE title=$1\"\n\n    // wrap the output parameter in pq.Array for receiving into it\n    if err := db.QueryRow(sel, title).Scan(pq.Array(&amp;tags)); err != nil {\n        log.Fatal(err)\n    }\n\n    return\n}\n</code></pre>\n</blockquote>\n\n<p>I've just got this working in a project of my own as well, so can confirm it works.</p>\n"}], "owner": {"reputation": 2349, "user_id": 653331, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/8a4bf914078e4f4732891156dd917d69?s=128&d=identicon&r=PG&f=1", "display_name": "p_mcp", "link": "https://stackoverflow.com/users/653331/p-mcp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16159, "favorite_count": 3, "accepted_answer_id": 51549696, "answer_count": 4, "score": 16, "last_activity_date": 1569462084, "creation_date": 1432747125, "question_id": 30489163, "link": "https://stackoverflow.com/questions/30489163/read-a-postgresql-array-directly-into-a-golang-slice", "title": "Read a Postgresql array directly into a Golang Slice", "body": "<p>I have a query which returns a row with a single column containing an array of strings (<code>character varying[]</code>):</p>\n\n<pre><code>{http://wp.me/p62MJv-Jc,http://tyrant.click/1LGBoD6}\n</code></pre>\n\n<p>Is there any easy way to read this directly into a Golang slice? E.g.</p>\n\n<pre><code>var arr []string\n\nfor rows.Next() {\n    rows.Scan(&amp;arr)\n    fmt.Println(len(arr))\n}\n</code></pre>\n\n<p>Produces:</p>\n\n<pre><code>0\n</code></pre>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 1458, "user_id": 1394885, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1bd0f98dad76d9b2f7efc49a984f69aa?s=128&d=identicon&r=PG", "display_name": "Logiraptor", "link": "https://stackoverflow.com/users/1394885/logiraptor"}, "is_accepted": true, "score": 2, "last_activity_date": 1432780101, "creation_date": 1432780101, "answer_id": 30496222, "question_id": 30488629, "link": "https://stackoverflow.com/questions/30488629/datastore-object-key-field/30496222#30496222", "title": "Datastore object Key field", "body": "<p>You have to maintain that field yourself. You can write a function using reflection which can perform that work on any struct, but there is no method in the appengine SDK to do what you want. </p>\n"}], "owner": {"reputation": 27885, "user_id": 187676, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/61a0f26f59f608dcde6bf8bfdd3e421e?s=128&d=identicon&r=PG", "display_name": "Erik Aigner", "link": "https://stackoverflow.com/users/187676/erik-aigner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 30496222, "answer_count": 1, "score": 1, "last_activity_date": 1432780101, "creation_date": 1432745374, "question_id": 30488629, "link": "https://stackoverflow.com/questions/30488629/datastore-object-key-field", "title": "Datastore object Key field", "body": "<p>Does the GAE datastore API (Go) support returning the key on an object by default?</p>\n\n<p>Currently I'm solving this by updating an ignored <code>Key</code> field manually in code after writes and fetches like this:</p>\n\n<pre><code>type User struct {\n  Key    *datastore.Key `datastore:\"-\"`\n  Email  string\n  ...\n}\n</code></pre>\n\n<p>Do I have to do this or is there a way that makes that redundant?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440322462, "post_id": 30487979, "comment_id": 52217331, "body": "Thanks, so any suggestions on what SHOULD be done?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440327480, "post_id": 30487979, "comment_id": 52218651, "body": "I should make clear that the <code>context</code> in this question is not a request context but instead an &quot;application context&quot; that stores database and cache connections amongst other things. I don&#39;t see the problem of passing this around to make it available elsewhere in the project. This is an old question though so I have removed the global variable <code>c</code> since I asked this."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440341919, "post_id": 30487979, "comment_id": 52222740, "body": "I may have been mistaken about the immutable context. I thought you were using net/context, but I see your variable is called core.Context... so I don&#39;t really know what that does."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440341968, "post_id": 30487979, "comment_id": 52222752, "body": "In any case, you shouldn&#39;t use a global, if you can avoid it. It&#39;s bad practice... and where it matters most often for singleton process like yours probably is, is in writing unit tests."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440342638, "post_id": 30487979, "comment_id": 52222964, "body": "Yes I&#39;m in the same camp as you regarding globals - this was an early setup and they&#39;re not in use now. Regarding the context, I use Gorilla for the request context, but the Context in the question stores values from a config file that a user can set. Therefore, other files need access to these settings so I have two Contexts - unorthodox perhaps but it gets the job done!"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1440342851, "post_id": 30487979, "comment_id": 52223033, "body": "Ah, okay. Gorilla contexts are protected by a mutex, so there&#39;s no need to worry about their immutability. I had net/context on my brain yesterday when I looked up this question, so I inadvertently overlooked that detail. I&#39;ve removed my above comment now."}], "answers": [{"tags": [], "owner": {"reputation": 4624, "user_id": 863924, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/J9N3K.jpg?s=128&g=1", "display_name": "km6zla", "link": "https://stackoverflow.com/users/863924/km6zla"}, "is_accepted": true, "score": 1, "last_activity_date": 1440292935, "last_edit_date": 1440292935, "creation_date": 1432744134, "answer_id": 30488201, "question_id": 30487979, "link": "https://stackoverflow.com/questions/30487979/passing-context-to-sub-directory/30488201#30488201", "title": "Passing context to sub-directory", "body": "<p>You can redefine your Create function as a function that returns the handler function:</p>\n\n<pre><code>func Create(ctx *core.Context) httprouter.Handle {\n    return func(w http.ResponseWriter, r *http.Request, params httprouter.Params) {\n        // Now you have the context to do things\n    }\n}\n</code></pre>\n\n<p>Where <code>httprouter.Handle</code> is a func type defined by httprouter to be <code>type Handle func(http.ResponseWriter, *http.Request, Params)</code>.</p>\n\n<p>And then you would use it like this in <code>ConfigureRouter</code>:</p>\n\n<pre><code>func ConfigureRouter(ctx *core.Context, router *httprouter.Router) {\n    router.POST(\"/v1/tokens/create\", token.Create(ctx))\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 49, "favorite_count": 0, "accepted_answer_id": 30488201, "answer_count": 1, "score": 0, "last_activity_date": 1440292935, "creation_date": 1432743490, "question_id": 30487979, "link": "https://stackoverflow.com/questions/30487979/passing-context-to-sub-directory", "title": "Passing context to sub-directory", "body": "<p>I have a <code>Context</code> struct that is used for the Application Context. The <code>ConfigureRouter</code> function receives the context as a parameter and sets the global variable <code>c</code> so middleware in the same file can use it.</p>\n\n<pre><code>var c *core.Context\n\nfunc ConfigureRouter(ctx *core.Context, router *httprouter.Router) {\n    c = ctx //make context available in all middleware\n    router.POST(\"/v1/tokens/create\", token.Create) //using httprouter\n}\n</code></pre>\n\n<p>The one route listed above calls <code>token.Create</code> ( from the token package which is a sub-directory) but it needs the context too.</p>\n\n<pre><code>//token/token.go\nfunc Create(w http.ResponseWriter, r *http.Request, params httprouter.Params) {\n    //Help! I need the context to do things\n}\n</code></pre>\n\n<p>How can I pass the context to the token package?</p>\n"}, {"tags": ["concurrency", "go"], "comments": [{"owner": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "edited": false, "score": 4, "creation_date": 1432743549, "post_id": 30487703, "comment_id": 49054237, "body": "I believe that this is done simply so that the same program can listen on two ports, and not for performance, since <code>http.ListenAndServe</code> binds to a single port and then blocks."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "edited": false, "score": 0, "creation_date": 1432743786, "post_id": 30487703, "comment_id": 49054389, "body": "Good idea but if you look <a href=\"https://github.com/emmasteimann/filemonitor/blob/2d6dd37589b6a89a76d44700a94e68543fd1979b/filemonitor/filemonitor.go\" rel=\"nofollow noreferrer\">here</a>, <a href=\"https://github.com/omniscale/imposm3/blob/0807c33eaaa5146d3f8088bf23e058524055c4fd/stats/http.go\" rel=\"nofollow noreferrer\">here</a> and <a href=\"https://github.com/oxfeeefeee/kaiju/blob/9e97515d5425f2eeb0c8070dec8ab054debce991/profiling/profiling.go\" rel=\"nofollow noreferrer\">here</a> you&#39;ll see that the server only listens on a single port."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 7084, "user_id": 640277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14f57fec5c9a807c0eeff896afb5ad86?s=128&d=identicon&r=PG", "display_name": "Ezra", "link": "https://stackoverflow.com/users/640277/ezra"}, "edited": false, "score": 1, "creation_date": 1432745535, "post_id": 30487703, "comment_id": 49055473, "body": "@Ezra is correct about the example listed, the <a href=\"https://github.com/openshift/origin/commit/7719a17648413ee0775d00dedfaf5c94025f798c\" rel=\"nofollow noreferrer\">commit log</a> for the change to this says &quot;serve on multiple ports&quot;. In each of the other cases you gave, it is done is for the same reason: the call to <code>ListenAndServe</code> blocks, if you want/need to return you need to put it in a goroutine."}], "answers": [{"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432744006, "post_id": 30488138, "comment_id": 49054550, "body": "What do you exactly mean with &#39;run in the background&#39;"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 1, "creation_date": 1432748454, "post_id": 30488138, "comment_id": 49057190, "body": "Run in its own goroutine."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 1, "last_activity_date": 1432743955, "creation_date": 1432743955, "answer_id": 30488138, "question_id": 30487703, "link": "https://stackoverflow.com/questions/30487703/goroutines-with-listenandserve-increases-performance/30488138#30488138", "title": "Goroutines with ListenAndServe increases performance?", "body": "<p>No it does not have any special benefits beside being \"run in the background\".</p>\n"}, {"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432745407, "post_id": 30488255, "comment_id": 49055390, "body": "Thanks for this extensive answer by commenting the examples. <a href=\"https://stackoverflow.com/users/640277/ezra\">Ezra</a>&#39;s assumption was right."}, {"owner": {"reputation": 694, "user_id": 6528719, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jyH70.jpg?s=128&g=1", "display_name": "Dinesh Gowda", "link": "https://stackoverflow.com/users/6528719/dinesh-gowda"}, "edited": false, "score": 0, "creation_date": 1580898019, "post_id": 30488255, "comment_id": 106246270, "body": "@Rob This would work. But how to close the program gracefully. If i stop the program running this code won&#39;t there be go routine leak. How would you stop go func() ??"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 694, "user_id": 6528719, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jyH70.jpg?s=128&g=1", "display_name": "Dinesh Gowda", "link": "https://stackoverflow.com/users/6528719/dinesh-gowda"}, "edited": false, "score": 0, "creation_date": 1580910631, "post_id": 30488255, "comment_id": 106253010, "body": "@DineshGowda When a process terminates, all goroutines are automatically destroyed. This is a feature of Unix; Go doesn&#39;t have to do anything here (and couldn&#39;t prevent it)."}, {"owner": {"reputation": 694, "user_id": 6528719, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/jyH70.jpg?s=128&g=1", "display_name": "Dinesh Gowda", "link": "https://stackoverflow.com/users/6528719/dinesh-gowda"}, "edited": false, "score": 0, "creation_date": 1580914291, "post_id": 30488255, "comment_id": 106255316, "body": "Oh I get it. Thanks. I thought there would be a go routine leak as we don&#39;t return from that routine call when so one stops the process."}, {"owner": {"reputation": 93, "user_id": 3770602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/775497bb4ca21603b9cf26f09060d1be?s=128&d=identicon&r=PG&f=1", "display_name": "Weana", "link": "https://stackoverflow.com/users/3770602/weana"}, "edited": false, "score": 0, "creation_date": 1605693237, "post_id": 30488255, "comment_id": 114727024, "body": "From a standpoint of concurrency - can you explain, why it is safe to pass the same handler function to both the ListenandServe calls in the two separate go routines? Thank you!"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 93, "user_id": 3770602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/775497bb4ca21603b9cf26f09060d1be?s=128&d=identicon&r=PG&f=1", "display_name": "Weana", "link": "https://stackoverflow.com/users/3770602/weana"}, "edited": false, "score": 1, "creation_date": 1605710622, "post_id": 30488255, "comment_id": 114734993, "body": "@Weana I&#39;m not quite certain what you mean here. What concurrency issue are you worried about? (Handler functions are just functions; if the function is thread-safe, then calling the function indirectly is safe in the same ways.)"}, {"owner": {"reputation": 93, "user_id": 3770602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/775497bb4ca21603b9cf26f09060d1be?s=128&d=identicon&r=PG&f=1", "display_name": "Weana", "link": "https://stackoverflow.com/users/3770602/weana"}, "edited": false, "score": 0, "creation_date": 1605711706, "post_id": 30488255, "comment_id": 114735612, "body": "Sure, thanks for your quick response. In the example above we have (at least) two separate go routines running. What does now happen, when two requests arrive on the two ports? Both go routines would now invoke the same handler. I am unfortunately not that deep into Go programming. But what happens now e.g. when the handler function accesses a package level (global) variable? Do we have two instances of the handler function running in parallel and is it not possible that those two try to access this P-L-variable concurrently? Or is this the specific definition of thread-safety, you mentioned?"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1605711982, "post_id": 30488255, "comment_id": 114735767, "body": "&quot;when the handler function accesses a package level (global) variable?&quot;  A handler function must never do that without using some kind of exclusive access (a lock, another go routine). This is what I meant by &quot;if the function is thread-safe.&quot;"}, {"owner": {"reputation": 93, "user_id": 3770602, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/775497bb4ca21603b9cf26f09060d1be?s=128&d=identicon&r=PG&f=1", "display_name": "Weana", "link": "https://stackoverflow.com/users/3770602/weana"}, "edited": false, "score": 0, "creation_date": 1605713521, "post_id": 30488255, "comment_id": 114736580, "body": "Great, then I have understood the crucial point here. Thanks for clarification :)!"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 20, "last_activity_date": 1432744613, "last_edit_date": 1432744613, "creation_date": 1432744301, "answer_id": 30488255, "question_id": 30487703, "link": "https://stackoverflow.com/questions/30487703/goroutines-with-listenandserve-increases-performance/30488255#30488255", "title": "Goroutines with ListenAndServe increases performance?", "body": "<p><code>http.ListenAndServe</code> is a blocking call. If you want to go one doing more work (like making a second <code>http.ListenAndServe</code> call), you need to move it over to a separate goroutine. That's all they're doing here.</p>\n\n<p>They're using <code>select{}</code> at the end to block the main goroutine, since all their calls to <code>http.ListenAndServe</code> are on other goroutines. If they didn't call <code>select{}</code>, the program would terminate because <code>main()</code> would return.</p>\n\n<p>They could have achieved the same thing by dropping <code>select{}</code>, and removing the <code>go func()</code> wrapper around the last block of code. But I suspect they did it this way so that all the code is consistent.</p>\n\n<p>But this has nothing to do with performance.</p>\n\n<p>In the comments you provided some other examples that are similar. In the <a href=\"https://github.com/emmasteimann/filemonitor/blob/2d6dd37589b6a89a76d44700a94e68543fd1979b/filemonitor/filemonitor.go\" rel=\"noreferrer\">first example</a>:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", responsehandler.Handler)\n    go func() {\n      http.ListenAndServe(\":8888\", nil)\n    }()\n    fileservice.NewWatcher()\n}\n</code></pre>\n\n<p>This calls <code>http.ListenAndServe</code> and then calls <code>fileservice.NewWatcher()</code> (which blocks). If they hadn't wrapped the call in a goroutine, <code>fileservice.NewWatcher()</code> would never have been called.</p>\n\n<p>The other <a href=\"https://github.com/omniscale/imposm3/blob/0807c33eaaa5146d3f8088bf23e058524055c4fd/stats/http.go\" rel=\"noreferrer\">two</a> <a href=\"https://github.com/oxfeeefeee/kaiju/blob/9e97515d5425f2eeb0c8070dec8ab054debce991/profiling/profiling.go\" rel=\"noreferrer\">examples</a> are a common piece of boilerplate:</p>\n\n<pre><code>func init() {\n    go func() {\n        log.Println(http.ListenAndServe(\"localhost:6060\", nil))\n    }()\n}\n</code></pre>\n\n<p>This turns on the debug profiler web server. Again, it's a goroutine so that calling <code>init</code> returns immediately rather than blocking. This particular case allows the caller to just <code>import _ \"profiling\"</code> and \"magically\" get the debug profiler web server.</p>\n"}, {"tags": [], "owner": {"reputation": 63, "user_id": 9445386, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-Bs9iifRWGsM/AAAAAAAAAAI/AAAAAAAAA8k/TdemYKpAH0M/photo.jpg?sz=128", "display_name": "Andy Parinas", "link": "https://stackoverflow.com/users/9445386/andy-parinas"}, "is_accepted": false, "score": 1, "last_activity_date": 1525529590, "creation_date": 1525529590, "answer_id": 50190373, "question_id": 30487703, "link": "https://stackoverflow.com/questions/30487703/goroutines-with-listenandserve-increases-performance/50190373#50190373", "title": "Goroutines with ListenAndServe increases performance?", "body": "<p>I don't think you need a go routine to start ListenAndServe. According to the Go Documentations. </p>\n\n<p>\"ListenAndServe calls Serve\". Serve is  go routine.</p>\n\n<p>ListenAndServe listens on the TCP network address addr and then calls Serve with handler to handle requests on incoming connections. Accepted connections are configured to enable TCP keep-alives. Handler is typically nil, in which case the DefaultServeMux is used.\n<a href=\"https://golang.org/pkg/net/http/#ListenAndServe\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#ListenAndServe</a></p>\n\n<p>func Serve(l net.Listener, handler Handler) error\nServe accepts incoming HTTP connections on the listener l, creating a new service goroutine for each. The service goroutines read requests and then call handler to reply to them. Handler is typically nil, in which case the DefaultServeMux is used.\n<a href=\"https://golang.org/pkg/net/http/#Serve\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/#Serve</a></p>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8892, "favorite_count": 3, "accepted_answer_id": 30488255, "answer_count": 3, "score": 14, "last_activity_date": 1525529590, "creation_date": 1432742721, "question_id": 30487703, "link": "https://stackoverflow.com/questions/30487703/goroutines-with-listenandserve-increases-performance", "title": "Goroutines with ListenAndServe increases performance?", "body": "<p>I'm not very familiar with Go's routines but since I'm working with the router of <code>net/http</code> I saw a few times that<code>ListenAndServe()</code> is wrapped by a go routine.</p>\n\n<p>A server needs to be able to handle multiple requests simultaneously out of the box to be efficient. So why are go routines as 'lightweight threads' used?\nDoes the concurrency provide any advantages?</p>\n\n<p>Here's an example by <a href=\"https://github.com/openshift/origin/blob/67ef8497bbcd4f7ea8bc4e0e2daa75ba0c613f20/examples/hello-openshift/hello_openshift.go\" rel=\"noreferrer\">OpenShift</a>\n</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n)\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprintln(w, \"Hello OpenShift!\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", helloHandler)\n\n    go func() {\n        fmt.Println(\"serving on 8080\")\n        err := http.ListenAndServe(\":8080\", nil)\n        if err != nil {\n            panic(\"ListenAndServe: \" + err.Error())\n        }\n    }()\n\n    go func() {\n        fmt.Println(\"serving on 8888\")\n        err := http.ListenAndServe(\":8888\", nil)\n        if err != nil {\n            panic(\"ListenAndServe: \" + err.Error())\n        }\n    }()\n    select {}\n}\n</code></pre>\n"}, {"tags": ["regex", "go", "capture-group"], "answers": [{"comments": [{"owner": {"reputation": 2672, "user_id": 223936, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/j58Xn.jpg?s=128&g=1", "display_name": "Plastikfan", "link": "https://stackoverflow.com/users/223936/plastikfan"}, "edited": false, "score": 1, "creation_date": 1432733470, "post_id": 30483899, "comment_id": 49046479, "body": "Ok great that looks encouraging, but how would I get access to the individual values, year, month and day?"}, {"owner": {"reputation": 2672, "user_id": 223936, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/j58Xn.jpg?s=128&g=1", "display_name": "Plastikfan", "link": "https://stackoverflow.com/users/223936/plastikfan"}, "edited": false, "score": 0, "creation_date": 1432734010, "post_id": 30483899, "comment_id": 49046890, "body": "Forget that last comment, I just found that answer. Its all in the ?P, as you say :)"}, {"owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "edited": false, "score": 0, "creation_date": 1455060076, "post_id": 30483899, "comment_id": 58318612, "body": "I&#39;m still confused by this; I&#39;m not sure they are addressable by Year, Month, etc. I get back an array with four values and can index into it, but that&#39;s it."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "edited": false, "score": 0, "creation_date": 1455100841, "post_id": 30483899, "comment_id": 58334756, "body": "@KevinBurke see the example in <a href=\"https://golang.org/pkg/regexp/#example_Regexp_SubexpNames\" rel=\"nofollow noreferrer\"><code>Regexp.SubexpNames</code></a>"}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1468857310, "post_id": 30483899, "comment_id": 64287842, "body": "@thwd Now, this is begging a question: what should happen if you named two groups in the same way? This is not a well-defined behavior, but the regex compiler doesn&#39;t complain about it. Your code throws away the first match for example, but I can imagine situations where it would make sense to throw all but first, or maybe collect all of them... Designing a language has lots of subtleties..."}, {"owner": {"reputation": 585, "user_id": 1351845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27c99f53a3d404b190dee9200fb471f5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Bauer", "link": "https://stackoverflow.com/users/1351845/vladimir-bauer"}, "reply_to_user": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1480428668, "post_id": 30483899, "comment_id": 68951332, "body": "@wvxvw (?P&lt;name&gt;group) syntax was first introduced by Python re module. It is not Go specific syntax. <a href=\"http://www.regular-expressions.info/named.html\" rel=\"nofollow noreferrer\">Read more</a>"}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "reply_to_user": {"reputation": 585, "user_id": 1351845, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/27c99f53a3d404b190dee9200fb471f5?s=128&d=identicon&r=PG&f=1", "display_name": "Vladimir Bauer", "link": "https://stackoverflow.com/users/1351845/vladimir-bauer"}, "edited": false, "score": 4, "creation_date": 1480495156, "post_id": 30483899, "comment_id": 68981422, "body": "@VladimirBauer I&#39;m not sure of what you are getting at. I know it&#39;s not specific to Go, I&#39;m arguing that specifically in Go, the built-in library implementation of this feature is bad because it duplicates another simpler feature of this library, but with an additional meaningless syntactical element."}, {"owner": {"reputation": 744, "user_id": 1392953, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/111f7728dfee50bdca97cb8dcf195e9f?s=128&d=identicon&r=PG", "display_name": "Eric Lindsey", "link": "https://stackoverflow.com/users/1392953/eric-lindsey"}, "reply_to_user": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1599550597, "post_id": 30483899, "comment_id": 112799940, "body": "@wvxvw this is well-defined behavior now: <a href=\"https://golang.org/pkg/regexp/#Regexp.SubexpIndex\" rel=\"nofollow noreferrer\">golang.org/pkg/regexp/#Regexp.SubexpIndex</a> but still without the additional possibilities you mentioned."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 90, "last_activity_date": 1518579549, "last_edit_date": 1518579549, "creation_date": 1432733231, "answer_id": 30483899, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/30483899#30483899", "title": "How to get capturing group functionality in Go regular expressions", "body": "<blockquote>\n  <p>how should I re-write these expressions?</p>\n</blockquote>\n\n<p>Add some Ps, as defined <a href=\"http://golang.org/pkg/regexp/syntax/\" rel=\"noreferrer\">here</a>:</p>\n\n<pre><code>(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})\n</code></pre>\n\n<p>Cross reference capture group names with <code>re.SubexpNames()</code>.</p>\n\n<p>And use <a href=\"https://play.golang.org/p/8LtH7lj1S7S\" rel=\"noreferrer\">as follows</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    r := regexp.MustCompile(`(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})`)\n    fmt.Printf(\"%#v\\n\", r.FindStringSubmatch(`2015-05-27`))\n    fmt.Printf(\"%#v\\n\", r.SubexpNames())\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4700, "user_id": 1470961, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/28216f158ce772dd67fcee384406b2c9?s=128&d=identicon&r=PG", "display_name": "Elliot Chance", "link": "https://stackoverflow.com/users/1470961/elliot-chance"}, "is_accepted": false, "score": 2, "last_activity_date": 1454797309, "creation_date": 1454797309, "answer_id": 35247204, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/35247204#35247204", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>If you need to replace based on a function while capturing groups you can use this:</p>\n\n<pre><code>import \"regexp\"\n\nfunc ReplaceAllGroupFunc(re *regexp.Regexp, str string, repl func([]string) string) string {\n    result := \"\"\n    lastIndex := 0\n\n    for _, v := range re.FindAllSubmatchIndex([]byte(str), -1) {\n        groups := []string{}\n        for i := 0; i &lt; len(v); i += 2 {\n            groups = append(groups, str[v[i]:v[i+1]])\n        }\n\n        result += str[lastIndex:v[0]] + repl(groups)\n        lastIndex = v[1]\n    }\n\n    return result + str[lastIndex:]\n}\n</code></pre>\n\n<p>Example:</p>\n\n<pre><code>str := \"abc foo:bar def baz:qux ghi\"\nre := regexp.MustCompile(\"([a-z]+):([a-z]+)\")\nresult := ReplaceAllGroupFunc(re, str, func(groups []string) string {\n    return groups[1] + \".\" + groups[2]\n})\nfmt.Printf(\"'%s'\\n\", result)\n</code></pre>\n\n<p><a href=\"https://gist.github.com/elliotchance/d419395aa776d632d897\" rel=\"nofollow\">https://gist.github.com/elliotchance/d419395aa776d632d897</a></p>\n"}, {"tags": [], "owner": {"reputation": 3289, "user_id": 1501696, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/ded81c0ab7a7e67e6222b945412be154?s=128&d=identicon&r=PG", "display_name": "eluleci", "link": "https://stackoverflow.com/users/1501696/eluleci"}, "is_accepted": false, "score": 28, "last_activity_date": 1612527952, "last_edit_date": 1612527952, "creation_date": 1474536486, "answer_id": 39635221, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/39635221#39635221", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>I had created a function for handling url expressions but it suits your needs too. You can check <a href=\"https://play.golang.org/p/ozUtfyrXNZ\" rel=\"nofollow noreferrer\">this</a> snippet but it simply works like this:</p>\n<pre><code>/**\n * Parses url with the given regular expression and returns the \n * group values defined in the expression.\n *\n */\nfunc getParams(regEx, url string) (paramsMap map[string]string) {\n\n    var compRegEx = regexp.MustCompile(regEx)\n    match := compRegEx.FindStringSubmatch(url)\n\n    paramsMap = make(map[string]string)\n    for i, name := range compRegEx.SubexpNames() {\n        if i &gt; 0 &amp;&amp; i &lt;= len(match) {\n            paramsMap[name] = match[i]\n        }\n    }\n    return paramsMap\n}\n</code></pre>\n<p>You can use this function like:</p>\n<pre><code>params := getParams(`(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})`, `2015-05-27`)\nfmt.Println(params)\n</code></pre>\n<p>and the output will be:</p>\n<pre><code>map[Year:2015 Month:05 Day:27]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "reply_to_user": {"reputation": 13228, "user_id": 8398549, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8tzrl.jpg?s=128&g=1", "display_name": "Cid", "link": "https://stackoverflow.com/users/8398549/cid"}, "edited": false, "score": 0, "creation_date": 1566146904, "post_id": 50740704, "comment_id": 101556327, "body": "Yes, there is a better and worse solution if you consider wasted clock cycles, wasted RAM, etc. With modesty you would let a farmer publish code in production."}], "tags": [], "owner": {"reputation": 476, "user_id": 5065312, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85f77cad3f3081a18d4645f5579a9f1e?s=128&d=identicon&r=PG&f=1", "display_name": "VasileM", "link": "https://stackoverflow.com/users/5065312/vasilem"}, "is_accepted": false, "score": 16, "last_activity_date": 1528475888, "last_edit_date": 1528475888, "creation_date": 1528372940, "answer_id": 50740704, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/50740704#50740704", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>To improve RAM and CPU usage without calling anonymous functions inside loop and without copying arrays in memory inside loop with \"append\" function see the next example:</p>\n\n<p>You can store more than one subgroup with multiline text, without appending string with '+' and without using for loop inside for loop (like other examples posted here).</p>\n\n<pre><code>txt := `2001-01-20\n2009-03-22\n2018-02-25\n2018-06-07`\n\nregex := *regexp.MustCompile(`(?s)(\\d{4})-(\\d{2})-(\\d{2})`)\nres := regex.FindAllStringSubmatch(txt, -1)\nfor i := range res {\n    //like Java: match.group(1), match.gropu(2), etc\n    fmt.Printf(\"year: %s, month: %s, day: %s\\n\", res[i][1], res[i][2], res[i][3])\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>year: 2001, month: 01, day: 20\nyear: 2009, month: 03, day: 22\nyear: 2018, month: 02, day: 25\nyear: 2018, month: 06, day: 07\n</code></pre>\n\n<p>Note: res[i][0] =~ match.group(0) Java</p>\n\n<p>If you want to store this information use a struct type:</p>\n\n<pre><code>type date struct {\n  y,m,d int\n}\n...\nfunc main() {\n   ...\n   dates := make([]date, 0, len(res))\n   for ... {\n      dates[index] = date{y: res[index][1], m: res[index][2], d: res[index][3]}\n   }\n}\n</code></pre>\n\n<hr>\n\n<p>It's better to use anonymous groups (performance improvement)</p>\n\n<p>Using \"ReplaceAllGroupFunc\" posted on Github is bad idea because:</p>\n\n<ol>\n<li>is using loop inside loop</li>\n<li>is using anonymous function call inside loop</li>\n<li>has a lot of code</li>\n<li>is using the \"append\" function inside loop and that's bad.\nEvery time a call is made to \"append\" function, is copying the array to new memory position</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 568, "user_id": 3758361, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b524d9d51c0df47bd9c5cefc7ea787d?s=128&d=identicon&r=PG", "display_name": "spiil", "link": "https://stackoverflow.com/users/3758361/spiil"}, "is_accepted": false, "score": 5, "last_activity_date": 1561211909, "creation_date": 1561211909, "answer_id": 56716065, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/56716065#56716065", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>Simple way to determine group names based on @VasileM answer.</p>\n\n<p>Disclaimer: it's not about memory/cpu/time optimization</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc main() {\n    r := regexp.MustCompile(`^(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})$`)\n\n    res := r.FindStringSubmatch(`2015-05-27`)\n    names := r.SubexpNames()\n    for i, _ := range res {\n        if i != 0 {\n            fmt.Println(names[i], res[i])\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/Y9cIVhMa2pU\" rel=\"noreferrer\">https://play.golang.org/p/Y9cIVhMa2pU</a></p>\n"}, {"tags": [], "owner": {"reputation": 779, "user_id": 1682833, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/595fb2f94e576e4ac9f79268f412456c?s=128&d=identicon&r=PG", "display_name": "Ori Seri", "link": "https://stackoverflow.com/users/1682833/ori-seri"}, "is_accepted": false, "score": 0, "last_activity_date": 1610462788, "creation_date": 1610462788, "answer_id": 65686238, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/65686238#65686238", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>You can use <code>regroup</code> library for that\n<a href=\"https://github.com/oriser/regroup\" rel=\"nofollow noreferrer\">https://github.com/oriser/regroup</a></p>\n<p>Example:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/oriser/regroup&quot;\n)\n\nfunc main() {\n    r := regroup.MustCompile(`(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})`)\n    mathces, err := r.Groups(&quot;2015-05-27&quot;)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;%+v\\n&quot;, mathces)\n}\n</code></pre>\n<p>Will print: <code>map[Year:2015 Month:05 Day:27]</code></p>\n<p>Alternatively, you can use it like this:</p>\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    &quot;fmt&quot;\n    &quot;github.com/oriser/regroup&quot;\n)\n\ntype Date struct {\n    Year   int `regroup:&quot;Year&quot;`\n    Month  int `regroup:&quot;Month&quot;`\n    Day    int `regroup:&quot;Day&quot;`\n}\n\nfunc main() {\n    date := &amp;Date{}\n    r := regroup.MustCompile(`(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})`)\n    if err := r.MatchToTarget(&quot;2015-05-27&quot;, date); err != nil {\n        panic(err)\n    }\n    fmt.Printf(&quot;%+v\\n&quot;, date)\n}\n</code></pre>\n<p>Will print: <code>&amp;{Year:2015 Month:5 Day:27}</code></p>\n"}, {"tags": [], "owner": {"reputation": 342, "user_id": 2946413, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/B7hRw.jpg?s=128&g=1", "display_name": "Angel Santiago Jaime Zavala", "link": "https://stackoverflow.com/users/2946413/angel-santiago-jaime-zavala"}, "is_accepted": false, "score": 2, "last_activity_date": 1612469559, "creation_date": 1612469559, "answer_id": 66053163, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/66053163#66053163", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>As of GO 1.15, you can simplify the process by using <a href=\"https://golang.org/pkg/regexp/#Regexp.SubexpIndex\" rel=\"nofollow noreferrer\"><code>Regexp.SubexpIndex</code></a>. You can check the release notes at <a href=\"https://golang.org/doc/go1.15#regexp\" rel=\"nofollow noreferrer\">https://golang.org/doc/go1.15#regexp</a>.</p>\n<p>Based in your example, you'd have something like the following:</p>\n<pre><code>re := regexp.MustCompile(`(?P&lt;Year&gt;\\d{4})-(?P&lt;Month&gt;\\d{2})-(?P&lt;Day&gt;\\d{2})`)\nmatches := re.FindStringSubmatch(&quot;Some random date: 2001-01-20&quot;)\nyearIndex := re.SubexpIndex(&quot;Year&quot;)\nfmt.Println(matches[yearIndex])\n</code></pre>\n<p>You can check and execute this example at <a href=\"https://play.golang.org/p/ImJ7i_ZQ3Hu\" rel=\"nofollow noreferrer\">https://play.golang.org/p/ImJ7i_ZQ3Hu</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 40, "user_id": 10430633, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e4a4bec7e2f97a47e785e9dc23027b70?s=128&d=identicon&r=PG", "display_name": "derv-dice", "link": "https://stackoverflow.com/users/10430633/derv-dice"}, "is_accepted": false, "score": 0, "last_activity_date": 1618516828, "last_edit_date": 1618516828, "creation_date": 1618512940, "answer_id": 67114507, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions/67114507#67114507", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>Function for get regexp parameters wit nil pointer checking. Returns map[] if error ocured</p>\n<pre class=\"lang-golang prettyprint-override\"><code>// GetRxParams - Get all regexp params from string with provided regular expression\nfunc GetRxParams(rx *regexp.Regexp, str string) (pm map[string]string) {\n    if !rx.MatchString(str) {\n        return nil\n    }\n    p := rx.FindStringSubmatch(str)\n    n := rx.SubexpNames()\n    pm = map[string]string{}\n    for i := range n {\n        if i == 0 {\n            continue\n        }\n\n        if n[i] != &quot;&quot; &amp;&amp; p[i] != &quot;&quot; {\n            pm[n[i]] = p[i]\n        }\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 2672, "user_id": 223936, "user_type": "registered", "accept_rate": 59, "profile_image": "https://i.stack.imgur.com/j58Xn.jpg?s=128&g=1", "display_name": "Plastikfan", "link": "https://stackoverflow.com/users/223936/plastikfan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84401, "favorite_count": 13, "accepted_answer_id": 30483899, "answer_count": 8, "score": 67, "last_activity_date": 1618516828, "creation_date": 1432732626, "last_edit_date": 1565937144, "question_id": 30483652, "link": "https://stackoverflow.com/questions/30483652/how-to-get-capturing-group-functionality-in-go-regular-expressions", "title": "How to get capturing group functionality in Go regular expressions", "body": "<p>I'm porting a library from Ruby to Go, and have just discovered that regular expressions in Ruby are not compatible with Go (google RE2). It's come to my attention that Ruby &amp; Java (plus other languages use PCRE regular expressions (perl compatible, which supports capturing groups)), so I need to re-write my expressions so that they compile ok in Go.</p>\n\n<p>For example, I have the following regex:</p>\n\n<pre><code>`(?&lt;Year&gt;\\d{4})-(?&lt;Month&gt;\\d{2})-(?&lt;Day&gt;\\d{2})`\n</code></pre>\n\n<p>This should accept input such as:</p>\n\n<pre><code>2001-01-20\n</code></pre>\n\n<p>The capturing groups allow the year, month and day to be captured into variables. To get the value of each group, it's very easy; you just index into the returned matched data with the group name and you get the value back. So, for example to get the year, something like this pseudo code:</p>\n\n<pre><code>m=expression.Match(\"2001-01-20\")\nyear = m[\"Year\"]\n</code></pre>\n\n<p>This is a pattern I use a lot in my expressions, so I have a lot of re-writing to do.</p>\n\n<p>So, is there a way to get this kind of functionality in Go regexp; how should I re-write these expressions?</p>\n"}, {"tags": ["amazon-ec2", "go", "docker", "iptables", "coreos"], "answers": [{"tags": [], "owner": {"reputation": 7483, "user_id": 902751, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f818a4a4d5e72627a81443a0cd1fc2da?s=128&d=identicon&r=PG", "display_name": "spg", "link": "https://stackoverflow.com/users/902751/spg"}, "is_accepted": true, "score": 0, "last_activity_date": 1432815268, "creation_date": 1432815268, "answer_id": 30506293, "question_id": 30483157, "link": "https://stackoverflow.com/questions/30483157/docker-hiding-ip-of-calling-container/30506293#30506293", "title": "Docker hiding IP of calling container", "body": "<p>After a bit of experimenting, I found that running the proxy container in <code>--net=host</code> mode solved the problem. </p>\n\n<p>By using this option, the proxy container shares the same networking stack as the host, thus bypassing the the docker0 bridge.</p>\n"}], "owner": {"reputation": 7483, "user_id": 902751, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/f818a4a4d5e72627a81443a0cd1fc2da?s=128&d=identicon&r=PG", "display_name": "spg", "link": "https://stackoverflow.com/users/902751/spg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 791, "favorite_count": 2, "closed_date": 1433734263, "accepted_answer_id": 30506293, "answer_count": 1, "score": 2, "last_activity_date": 1432815268, "creation_date": 1432731396, "last_edit_date": 1432735082, "question_id": 30483157, "link": "https://stackoverflow.com/questions/30483157/docker-hiding-ip-of-calling-container", "closed_reason": "Not suitable for this site", "title": "Docker hiding IP of calling container", "body": "<p><strong>Disclaimer:</strong></p>\n\n<p>I am a networking newbie. Forgive me if I don't use proper vocabulary to describe my problem.</p>\n\n<p><strong>Context:</strong></p>\n\n<p>So I have a couple of app containers (Docker) that are to run on CoreOS. Each container must have different IAM roles. Since there will be potentially be N containers with N different IAM roles running on the same host, this poses a problem to use the EC2 Instance Metadata (<a href=\"http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html\" rel=\"nofollow\">http://docs.aws.amazon.com/AWSEC2/latest/UserGuide/ec2-instance-metadata.html</a>) to retrieve the instance credentials. Each container needs a different set of credentials (since each container will have different roles).</p>\n\n<p>In order to fix that problem, I stumbled upon this project <a href=\"https://github.com/dump247/docker-ec2-metadata\" rel=\"nofollow\">https://github.com/dump247/docker-ec2-metadata</a> which is a Go proxy that intercepts (using iptables rules) calls to <a href=\"http://169.254.169.254/latest/meta-data/iam/security-credentials/\" rel=\"nofollow\">http://169.254.169.254/latest/meta-data/iam/security-credentials/</a> and provides proper credentials based on the calling container\u2019s IAM role.</p>\n\n<p>The iptables rule (see <a href=\"https://github.com/dump247/docker-ec2-metadata/blob/master/README.md\" rel=\"nofollow\">https://github.com/dump247/docker-ec2-metadata/blob/master/README.md</a>) to reroute calls is:</p>\n\n<pre><code># Get the host IP address. You can use a different mechanism if you wish.\n# Note that IP can not be 127.0.0.1 because DNAT for loopback is not possible.\nPROXY_IP=$(ifconfig eth0 | grep -Eo \"inet addr:[0-9.]+\" | grep -Eo \"[0-9.]+\")\n\n# Port that the proxy service runs on. Default is 18000.\nPROXY_PORT=18000\n\n# Drop any traffic to the proxy service that is NOT coming from docker containers\niptables                   \\\n   -I INPUT                \\\n   -p tcp                  \\\n   --dport ${PROXY_PORT}   \\\n   ! -i docker0            \\\n   -j DROP\n\n# Redirect any requests from docker containers to the proxy service\niptables                                       \\\n   -t nat                                      \\\n   -I PREROUTING                               \\\n   -p tcp                                      \\\n   -d 169.254.169.254 --dport 80              \\\n   -j DNAT                                     \\\n   --to-destination ${PROXY_IP}:${PROXY_PORT}  \\\n   -i docker0\n</code></pre>\n\n<p>Since we\u2019re running on CoreOS, we want to deploy that proxy inside a Docker container. We don\u2019t want to install the proxy directly on the EC2 host.</p>\n\n<p>Suppose I have 2 containers running 2 apps with different IAM roles:</p>\n\n<ul>\n<li>containerA: IP: 172.17.0.7, IAM role: roleA</li>\n<li>containerB: IP: 172.17.0.8, IAM role: roleB</li>\n</ul>\n\n<p>When the proxy intercepts a request to <a href=\"http://169.254.169.254/latest/meta-data/iam/security-credentials/\" rel=\"nofollow\">http://169.254.169.254/latest/meta-data/iam/security-credentials/</a> , the proxy needs to know the requesting container\u2019s IP (e.g. 172.17.0.8), in order to use the Docker client (<a href=\"https://github.com/fsouza/go-dockerclient\" rel=\"nofollow\">https://github.com/fsouza/go-dockerclient</a>) to retrieve the requesting container\u2019s IAM role (which is passed to the container using an environment variable, e.g.: <code>docker run -e IAM_ROLE=arn:aws:iam::123456789012:role/roleA --name containerA myapp</code>) </p>\n\n<p><strong>Problem:</strong></p>\n\n<p>Retrieving the requesting container\u2019s IP (in our example, 172.17.0.[7, 8]) works perfectly fine when the proxy runs natively on the EC2 host. Here's my mental model of what happens when the proxy runs natively on the host:</p>\n\n<p>containerA calls <a href=\"http://169.254.169.254\" rel=\"nofollow\">http://169.254.169.254</a> -> iptables routing happens -> call is redirected to localhost:18000 -> the proxy container sees containerA's IP as the incoming request's source</p>\n\n<p>However, it does not work so well when the proxy runs inside a Docker container. Note that I start the proxy using <code>docker run -p 18000:18000 -v /var/run/docker.sock:/var/run/docker.sock ec2-metadata-proxy</code></p>\n\n<p>When the proxy runs in a Docker container, the requesting container\u2019s IP is that of the docker0 interface (e.g. 172.17.42.1), making it impossible to determine the requesting container. Again, here's my mental model of what happens when the proxy runs in a container:</p>\n\n<p>containerA calls <a href=\"http://169.254.169.254\" rel=\"nofollow\">http://169.254.169.254</a> -> iptables routing happens -> call is redirected to localhost:18000 -> Docker routes that call to the proxy container -> the proxy container sees docker0's IP as the incoming request's source</p>\n\n<p><strong>Question:</strong></p>\n\n<p>How can I make sure that the IP address that the proxy will see is that of the requesting container (e.g. containerA), and not that of the docker0 interface?</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 159902, "user_id": 3297613, "user_type": "registered", "accept_rate": 74, "profile_image": "https://i.stack.imgur.com/KHhzd.jpg?s=128&g=1", "display_name": "Avinash Raj", "link": "https://stackoverflow.com/users/3297613/avinash-raj"}, "edited": false, "score": 7, "creation_date": 1432730589, "post_id": 30482793, "comment_id": 49044169, "body": "try <code>regexp.MustCompile(&quot;\\\\p{L}+&quot;)</code>"}], "answers": [{"comments": [{"owner": {"reputation": 185, "user_id": 4944691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3885bb78d941bec3416a35e83f4861f5?s=128&d=identicon&r=PG", "display_name": "Keir", "link": "https://stackoverflow.com/users/4944691/keir"}, "edited": false, "score": 0, "creation_date": 1432732221, "post_id": 30483020, "comment_id": 49045469, "body": "Ouu, I see. Just a habit of using \\w, while I need word. My bad. Thanks for your help!"}, {"owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "edited": false, "score": 12, "creation_date": 1484251727, "post_id": 30483020, "comment_id": 70445471, "body": "Bonus - if you use backticks, you don&#39;t have to double-escape:  <code>regexp.MustCompile(`[\\p{L}\\d_]+`)</code>"}, {"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 0, "creation_date": 1484252454, "post_id": 30483020, "comment_id": 70445884, "body": "Yes, I posted this when I was not aware of raw <a href=\"https://golang.org/ref/spec#String_literals\" rel=\"nofollow noreferrer\">string literals in Go</a>."}], "tags": [], "owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "is_accepted": true, "score": 24, "last_activity_date": 1432731073, "creation_date": 1432731073, "answer_id": 30483020, "question_id": 30482793, "link": "https://stackoverflow.com/questions/30482793/golang-regexp-with-non-latin-characters/30483020#30483020", "title": "Golang regexp with non-latin characters", "body": "<p>The <code>\\w</code> shorthand class only matches ASCII letters in <a href=\"https://golang.org/pkg/regexp/syntax/\">GO regex</a>, thus, you need a Unicode character class <code>\\p{L}</code>.</p>\n\n<blockquote>\n  <p><code>\\w</code>             word characters (== <code>[0-9A-Za-z_]</code>)</p>\n</blockquote>\n\n<p>Use a character class to include the digits and underscore:</p>\n\n<pre><code>    regexp.MustCompile(\"[\\\\p{L}\\\\d_]+\")\n</code></pre>\n\n<p>Output of the <a href=\"http://play.golang.org/p/fWfI58QEEq\">demo</a>:</p>\n\n<pre><code>[One two three]\n[\u0420\u0430\u0437 \u0434\u0432\u0430 \u0442\u0440\u0438]\n[Jedna dva t\u0159i \u010dty\u0159i p\u011bt]\n</code></pre>\n"}], "owner": {"reputation": 185, "user_id": 4944691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3885bb78d941bec3416a35e83f4861f5?s=128&d=identicon&r=PG", "display_name": "Keir", "link": "https://stackoverflow.com/users/4944691/keir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7654, "favorite_count": 3, "accepted_answer_id": 30483020, "answer_count": 1, "score": 17, "last_activity_date": 1432755535, "creation_date": 1432730531, "last_edit_date": 1432755535, "question_id": 30482793, "link": "https://stackoverflow.com/questions/30482793/golang-regexp-with-non-latin-characters", "title": "Golang regexp with non-latin characters", "body": "<p>I need some advice from skilled gophers. </p>\n\n<p>I am parsing words from some sentences and my <code>\\w+</code> regexp works fine with Latin characters. However, it totally fails with some Cyrillic characters.</p>\n\n<p>Here is a sample app:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"regexp\"\n)\n\nfunc get_words_from(text string) []string {\n    words := regexp.MustCompile(\"\\\\w+\")\n    return words.FindAllString(text, -1)\n}\n\nfunc main() {\n    text := \"One, two three!\"\n    text2 := \"\u0420\u0430\u0437, \u0434\u0432\u0430 \u0442\u0440\u0438!\"\n    text3 := \"Jedna, dva t\u0159i \u010dty\u0159i p\u011bt!\"\n    fmt.Println(get_words_from(text))\n    fmt.Println(get_words_from(text2))\n    fmt.Println(get_words_from(text3))\n}\n</code></pre>\n\n<p>It yields the following results:</p>\n\n<pre><code> [One two three]\n []\n [Jedna dva t i ty i p t]\n</code></pre>\n\n<p>It returns empty values for Russian, and extra syllables for Czech.\nI have no idea how to solve this issue. Could someone give me a piece of advice?</p>\n\n<p>Or maybe there is a better way to split a sentence into words without punctuation?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1432731435, "post_id": 30481373, "comment_id": 49044826, "body": "The date and time are available via cgo, but C doesn&#39;t have macros for the other things you&#39;re describing."}], "answers": [{"comments": [{"owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "edited": false, "score": 0, "creation_date": 1432728510, "post_id": 30481488, "comment_id": 49042643, "body": "This will clearly work but I was hoping for something more built-in to isolate any changes from every developer and production build command line. Is injecting this information via the linker the only way?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "edited": false, "score": 2, "creation_date": 1432729876, "post_id": 30481488, "comment_id": 49043606, "body": "@Richard This is the only way I know, apart from straight-up code generation. There isn&#39;t something like gcc&#39;s <code>__DATE__</code> and <code>__TIME__</code> macros in Go."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 5, "last_activity_date": 1432727632, "last_edit_date": 1432727632, "creation_date": 1432727067, "answer_id": 30481488, "question_id": 30481373, "link": "https://stackoverflow.com/questions/30481373/how-can-a-golang-error-reporting-function-get-compilation-information/30481488#30481488", "title": "How can a golang error reporting function get compilation information", "body": "<p>You can use the -X linker flag to set the value of a string variable when building:</p>\n\n<pre><code>go build -ldflags \"-X main.Uname '$(uname -a)' -X main.CompileTime '$(date)'\"\n</code></pre>\n\n<p>With such command, this code</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n// Set by the linker.\nvar CompileTime, Uname string\n\nfunc main() {\n    fmt.Println(Uname)\n    fmt.Println(CompileTime)\n}\n</code></pre>\n\n<p>will print something like</p>\n\n<pre><code>Linux user 3.13.0-53 Wed May 20 10:34:39 UTC 2015 x86_64 GNU/Linux\nWed May 27 12:00:00 UTC 2015\n</code></pre>\n\n<p>See the <a href=\"http://golang.org/cmd/ld/\" rel=\"noreferrer\">linker docs</a> for more info.</p>\n"}], "owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 0, "accepted_answer_id": 30481488, "answer_count": 1, "score": 3, "last_activity_date": 1432727632, "creation_date": 1432726755, "question_id": 30481373, "link": "https://stackoverflow.com/questions/30481373/how-can-a-golang-error-reporting-function-get-compilation-information", "title": "How can a golang error reporting function get compilation information", "body": "<p>How can a function establish the following details from the runtime so that it can craft appropriate error reporting as part of a error library to be used using in many products (we are changing over to golang):</p>\n\n<ul>\n<li>Compilation date and time of the executable</li>\n<li>Compilation machine used to create the executable  </li>\n</ul>\n\n<p>I would like to be able to retrieve both of these to augment the various file revision numbers that I can report along with some stack trace information</p>\n\n<p>Useful related but off-topic information:<br>\n - You can get stack traces out of the runtime as illustrated here <a href=\"http://technosophos.com/2014/03/19/generating-stack-traces-in-go.html\" rel=\"nofollow\">http://technosophos.com/2014/03/19/generating-stack-traces-in-go.html</a><br>\n - The reflect package <a href=\"http://golang.org/pkg/reflect/\" rel=\"nofollow\">http://golang.org/pkg/reflect/</a> can be used to examine an identified function</p>\n\n<p>Thank you for your assistance,<br>\nRichard</p>\n"}, {"tags": ["c", "go", "language-interoperability"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1432726567, "post_id": 30481268, "comment_id": 49041178, "body": "Have you tried adding <code>#include &lt;stdlib.h&gt;</code> in your cgo comment?"}], "answers": [{"comments": [{"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1432731331, "post_id": 30481688, "comment_id": 49044748, "body": "+1 This worked perfectly and answers my question. To be honest I was misled by documentation that seems suggest that <code>C.free()</code> is part of the special <code>C</code> package. But in reality we&#39;re talking of standard <code>stdlib::free()</code>."}, {"owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "edited": false, "score": 0, "creation_date": 1432788584, "post_id": 30481688, "comment_id": 49071735, "body": "Like other runtimes also Go libs lack an API for managing already running OS processes, so I&#39;m trying to writing one. For now just a stub (<a href=\"https://github.com/gsscoder/goproc\" rel=\"nofollow noreferrer\">github.com/gsscoder/goproc</a>)."}], "tags": [], "owner": {"reputation": 8356, "user_id": 443265, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f10e24ce2786d8a6ddb4d79462dce5?s=128&d=identicon&r=PG", "display_name": "Martin T&#246;rnwall", "link": "https://stackoverflow.com/users/443265/martin-t%c3%b6rnwall"}, "is_accepted": true, "score": 19, "last_activity_date": 1432727640, "creation_date": 1432727640, "answer_id": 30481688, "question_id": 30481268, "link": "https://stackoverflow.com/questions/30481268/c-and-go-interoperability-issue-involving-c-free/30481688#30481688", "title": "C and Go interoperability issue involving C.free()", "body": "<p><code>libproc.h</code> doesn't include <code>stdlib.h</code>, where <code>free()</code> is declared. As such, the compiler cannot resolve the name. After I added <code>#include &lt;stdlib.h&gt;</code> at the beginning of the cgo comment block your code built successfully on my system.</p>\n"}], "owner": {"reputation": 2282, "user_id": 1035792, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/cQjEY.png?s=128&g=1", "display_name": "gsscoder", "link": "https://stackoverflow.com/users/1035792/gsscoder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5762, "favorite_count": 1, "accepted_answer_id": 30481688, "answer_count": 1, "score": 13, "last_activity_date": 1432727640, "creation_date": 1432726445, "question_id": 30481268, "link": "https://stackoverflow.com/questions/30481268/c-and-go-interoperability-issue-involving-c-free", "title": "C and Go interoperability issue involving C.free()", "body": "<p>I've a Go function that wraps the <code>proc_name(pid,...)</code> function from <code>lib_proc.h</code>.</p>\n\n<p>This is the complete <strong>C prototype</strong>:</p>\n\n<pre><code>\nint proc_name(int pid, void * buffer, uint32_t buffersize) __OSX_AVAILABLE_STARTING(__MAC_10_5, __IPHONE_2_0);\n</code></pre>\n\n<p>that can be found here <code>/Applications/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.10.sdk/usr/include/libproc.h</code> (at least on my system).</p>\n\n<p>It follows Go code:</p>\n\n<pre><code>\npackage goproc\n\n    /*\n    #include \"libproc.h\"\n\n    int call_proc_name(int pid, char *name, int name_size) {\n      return proc_name(pid, name, name_size);\n    }\n    */\n    import \"C\"\n    import \"unsafe\"\n    import \"strings\"\n\n    type DarwinProcess struct {\n        Process\n    }\n\n    func (DarwinProcess) NameOf(pid int) string {\n        name := C.CString(strings.Repeat(\"\\x00\", 1024))\n        defer C.free(unsafe.Pointer(name))\n        nameLen := C.call_proc_name(C.int(pid), name, C.int(1024))\n        var result string\n\n        if (nameLen > 0) {\n            result = C.GoString(name);\n        } else {\n            result = \"\"\n        }\n\n        return result;\n    }\n</code></pre>\n\n<p>This code won't compile unless the call to <code>C.free(unsafe.Pointer(...))</code> and <code>import \"unsafe\"</code> clause are removed.\n<code>DarwinProcess::NameOf(pid)</code> method is meant to work only on <strong>Mac OS X</strong> and <em>it actually works</em> if <code>C.free(...)</code> is removed from code.</p>\n\n<p>In its actual form after <code>go build</code> I get the following error message:\n<code>could not determine kind of name for C.free</code> (and nothing more, this is the whole compiler output).</p>\n\n<p>Removing <code>C.free(...)</code> is not acceptable to me, I must find how to properly free the memory allocated with <code>C.CString()</code>.</p>\n\n<p>I'm puzzled since, according to <a href=\"https://golang.org/cmd/cgo/\" rel=\"noreferrer\">documentation</a>, everything is done properly. I have not been able to find a solution nor searching here nor on the web.</p>\n"}, {"tags": ["algorithm", "go", "average"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1432725293, "post_id": 30480782, "comment_id": 49040282, "body": "You can&#39;t have a <code>nil</code> value in a <code>[]int16</code> slice or array. That is compile time error. You should really try your example codes before posting the question."}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432725477, "post_id": 30480782, "comment_id": 49040396, "body": "@icza ...., so how can I have a similar thing? I am new to golang"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1471955293, "last_edit_date": 1471955293, "creation_date": 1432726053, "answer_id": 30481134, "question_id": 30480782, "link": "https://stackoverflow.com/questions/30480782/how-to-calculate-weighted-average-of-non-zero-values/30481134#30481134", "title": "How to calculate weighted average of non-zero values?", "body": "<p>You can calculate the sum weight of non-zero values while iterating over them, and do the division by the sum weight at the end:</p>\n\n<pre><code>vs := []int{500, 400, 0, 300}\nws := []float64{0.1, 0.2, 0.3, 0.4}\n\nsumWeight, avg := 0.0, 0.0\nfor i, v := range vs {\n    if v == 0 {\n        continue\n    }\n    sumWeight += ws[i]\n    avg += float64(v) * ws[i]\n}\navg /= sumWeight\n\nfmt.Println(\"Average:\", avg)\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/URqnOUBDSv\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>Average: 357.1428571428571\n</code></pre>\n\n<p><strong>Note:</strong></p>\n\n<p>This solution does not require weights to sum up to <code>1.0</code> neither to be in the range of <code>0..1</code> (but they can't be negative).</p>\n\n<p><strong>Note #2:</strong></p>\n\n<p>If the input slices are empty (either by having <code>len == 0</code> or all values being <code>0</code>) or <code>sumWeight</code> of non-zero values is <code>0.0</code>, the result will be <code>NaN</code> due to dividing by <code>sumWeight</code> which is <code>0.0</code>. You might want to check this case and do something else:</p>\n\n<pre><code>if sumWeight &gt; 0.0 {\n    avg /= sumWeight\n}\n</code></pre>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1090, "favorite_count": 0, "accepted_answer_id": 30481134, "answer_count": 1, "score": 1, "last_activity_date": 1471955293, "creation_date": 1432725079, "last_edit_date": 1432849166, "question_id": 30480782, "link": "https://stackoverflow.com/questions/30480782/how-to-calculate-weighted-average-of-non-zero-values", "title": "How to calculate weighted average of non-zero values?", "body": "<p>I am new to Go, I am doing the following:</p>\n\n<p>I have a slice:</p>\n\n<pre><code>valueList := []int16{500, 400, 0, 300}\n</code></pre>\n\n<p>and a weight slice:</p>\n\n<pre><code>weightList := []float64{0.1, 0.2, 0.3, 0.4}\n</code></pre>\n\n<p>Now I want to do this:</p>\n\n<pre><code>res := make([]float64, 4)\nfor i, value := range valueList {\n    res[i] = float64(value) * weightList[i]\n}\n</code></pre>\n\n<p>But as you can see, I get a <code>0</code> in <code>valueList</code>, now I want to average the weight to the others if value is not <code>0</code>, so in this example, it should be:</p>\n\n<pre><code>500 * (0.1 + 0.3/3) + 400 * (0.2 + 0.3/3) + 300 * (0.4 + 0.3/3)\n</code></pre>\n\n<p>If another <code>0</code> shows up, average the weight again.</p>\n\n<p>How can I do this simply?</p>\n"}, {"tags": ["go", "int", "typeconverter"], "comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1432719572, "post_id": 30478544, "comment_id": 49036301, "body": "What version of go are you using? This gives an error, &quot;constant 0.25 truncated to integer&quot; in go1.4. <a href=\"http://play.golang.org/p/SJmHxgXm9k\" rel=\"nofollow noreferrer\">play.golang.org/p/SJmHxgXm9k</a>"}, {"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1432719696, "post_id": 30478544, "comment_id": 49036393, "body": "this does report an error, I want to know how to do this quickly?"}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 1, "last_activity_date": 1432719775, "creation_date": 1432719775, "answer_id": 30478717, "question_id": 30478544, "link": "https://stackoverflow.com/questions/30478544/int16-number-plus-float64-in-golang/30478717#30478717", "title": "int16 number plus float64 in golang", "body": "<p>Your constants (0.25) are being truncated to intergers (0).</p>\n\n<p>Two ways to solve:</p>\n\n<p>cast the score1 etc variables to float32:</p>\n\n<pre><code>var score1 int16 = 500\nvar score2 int16 = 400\nvar score3 int16 = 300\nvar score4 int16 = 200\nres := float32(score1)*0.25 + float32(score2)*0.25 + float32(score3)*0.25 + float32(score4)*0.25\n\nfmt.Println(\"Score\", res)\n</code></pre>\n\n<p>or more sensible, instead of declaring them as int16 declare them as float32 to begin with:</p>\n\n<pre><code>var score1a float32 = 500\nvar score2a float32 = 400\nvar score3a float32 = 300\nvar score4a float32 = 200\nres2 := score1a * 0.25 + score2a * 0.25 + score3a * 0.25 + score4a * 0.25\n\nfmt.Println(\"Result 1\", res)\nfmt.Println(\"Result 2\", res2)\n</code></pre>\n\n<p>On the <a href=\"https://play.golang.org/p/JL4ygQ8U4z\" rel=\"nofollow\">Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 0, "last_activity_date": 1432719841, "creation_date": 1432719841, "answer_id": 30478741, "question_id": 30478544, "link": "https://stackoverflow.com/questions/30478544/int16-number-plus-float64-in-golang/30478741#30478741", "title": "int16 number plus float64 in golang", "body": "<p>There's no automatic type promotion in go and you need to include explicit conversions instead.</p>\n\n<p>I'd write your code something like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc getScore() float64 {\n    s1, s2, s3, s4 := int16(500), int16(400), int16(300), int16(200)\n    return (float64(s1) + float64(s2) + float64(s3) + float64(s4)) * 0.25\n}\n\nfunc main() {\n    fmt.Println(getScore())\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1432726148, "post_id": 30478886, "comment_id": 49040847, "body": "Number 3 suffers from <code>int16</code> overflow/underflow problems."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "edited": false, "score": 0, "creation_date": 1432726344, "post_id": 30478886, "comment_id": 49040986, "body": "@PaulHankin Yes, that has to be kept in mind. Given the example numbers it&#39;s not a problem in this case. And if numbers would be big enough so that adding 4 of them would cause an overflow, <code>int16</code> would already be a bad choice to represent scores anyway."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1432721803, "last_edit_date": 1432721803, "creation_date": 1432720186, "answer_id": 30478886, "question_id": 30478544, "link": "https://stackoverflow.com/questions/30478544/int16-number-plus-float64-in-golang/30478886#30478886", "title": "int16 number plus float64 in golang", "body": "<p>Go does not provide implicit numeric conversion, see this FAQ: <a href=\"https://golang.org/doc/faq#conversions\" rel=\"nofollow\">Why does Go not provide implicit numeric conversion?</a>.</p>\n\n<p>This means you can't mix different types when doing arithmetic operations. They have to be of the same type. <a href=\"https://golang.org/ref/spec#Operators\" rel=\"nofollow\">Spec</a>:</p>\n\n<blockquote>\n  <p>The operand types must be <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow\">identical</a> unless the operation involves shifts or untyped <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">constants</a>.</p>\n</blockquote>\n\n<p>Your case is a little different because <code>0.25</code> is an <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">untyped constant</a> but since it has a fraction part it can't be converted/interpreted as <code>int16</code> so you get a compile time error. From the <a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow\">spec</a>:</p>\n\n<blockquote>\n  <p>It is an error if the constant value cannot be represented as a value of the respective type.</p>\n</blockquote>\n\n<p>You have 3 options in this case:</p>\n\n<ol>\n<li><p>Explicitly convert scores to <code>float64</code>:</p>\n\n<pre><code>res = float64(score1) * 0.25 + float64(score2) * 0.25 +\n    float64(score3) * 0.25 + float64(score4) * 0.25\n</code></pre></li>\n<li><p>Use <code>float64</code> type for your <code>score</code> variables.</p>\n\n<pre><code>var score1 float64 = 500\nvar score2 float64 = 400\n// ...\n</code></pre></li>\n<li><p>Since your algorithm calculates average, you can simply do:</p>\n\n<pre><code>res = float64(score1 + score2 + score3 + score4) / 4\n</code></pre></li>\n</ol>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 775, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1432721854, "creation_date": 1432719342, "last_edit_date": 1432721854, "question_id": 30478544, "link": "https://stackoverflow.com/questions/30478544/int16-number-plus-float64-in-golang", "title": "int16 number plus float64 in golang", "body": "<p>I want to do a simple thing:</p>\n\n<pre><code>func (this *ScoreProvider) getScore()(res float64) {\n    var score1 int16 = 500\n    var score2 int16 = 400\n    var score3 int16 = 300\n    var score4 int16 = 200\n    res = score1 * 0.25 + score2 * 0.25 + score3 * 0.25 + score4 * 0.25\n\n    return\n}\n</code></pre>\n\n<p>But this reports an error:</p>\n\n<pre><code>can not use score1 * 0 + score2 * 0 + score3 * 0 + score4 * 0 (type int16) as type float64 in assignment\n</code></pre>\n\n<p>How can I do this right?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"tags": [], "owner": {"reputation": 479, "user_id": 887549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ARJYR.jpg?s=128&g=1", "display_name": "bezigon", "link": "https://stackoverflow.com/users/887549/bezigon"}, "is_accepted": true, "score": 1, "last_activity_date": 1432795363, "creation_date": 1432795363, "answer_id": 30499024, "question_id": 30478485, "link": "https://stackoverflow.com/questions/30478485/im-really-confused-with-importing-required-packages-but-all-its-files-were-excl/30499024#30499024", "title": "I&#39;m really confused with importing required packages but all its files were excluded by nobuild_files", "body": "<p>Following link has the answer</p>\n\n<p><a href=\"https://groups.google.com/d/msg/google-appengine-go/mGuMV4tVR0U/A3qaCau7zY4J\" rel=\"nofollow\">https://groups.google.com/d/msg/google-appengine-go/mGuMV4tVR0U/A3qaCau7zY4J</a></p>\n\n<p>Briefly, the reason is</p>\n\n<blockquote>\n  <p>\"cgo\" is not supported on classic App Engine.  If you want to build your app, you will need to use Go on Managed VMs (\"vm: true\" in your app.yaml).\n  Please see <a href=\"https://cloud.google.com/appengine/docs/go/managed-vms/\" rel=\"nofollow\">https://cloud.google.com/appengine/docs/go/managed-vms/</a> for more information.</p>\n</blockquote>\n"}], "owner": {"reputation": 479, "user_id": 887549, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/ARJYR.jpg?s=128&g=1", "display_name": "bezigon", "link": "https://stackoverflow.com/users/887549/bezigon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 280, "favorite_count": 0, "accepted_answer_id": 30499024, "answer_count": 1, "score": 3, "last_activity_date": 1432795363, "creation_date": 1432719211, "last_edit_date": 1432740631, "question_id": 30478485, "link": "https://stackoverflow.com/questions/30478485/im-really-confused-with-importing-required-packages-but-all-its-files-were-excl", "title": "I&#39;m really confused with importing required packages but all its files were excluded by nobuild_files", "body": "<p>I have latest tools installed, in the <code>app.go</code> I have following imports</p>\n\n<pre><code>\"github.com/go-martini/martini\"\n\"github.com/martini-contrib/binding\"\n\"github.com/martini-contrib/render\"\n\"github.com/moovweb/gokogiri\"\n\"github.com/moovweb/gokogiri/xml\"\n</code></pre>\n\n<p>And in <code>app.yaml</code></p>\n\n<pre><code>application: app\nversion: 1\nruntime: go\napi_version: go1\n\nhandlers:\n- url: /.*\n  script: _go_app\n</code></pre>\n\n<p>I saved external dependencies using <code>godep save</code> tool. But while trying to execute <code>goapp serve</code> command following error occured</p>\n\n<pre><code>SRSLY-2:app bezigon$ goapp serve\nINFO     2015-05-27 09:11:22,645 devappserver2.py:745] Skipping SDK update check.\nINFO     2015-05-27 09:11:23,048 api_server.py:190] Starting API server at: http://localhost:57449\nINFO     2015-05-27 09:11:23,071 dispatcher.py:192] Starting module \"default\" running at: http://localhost:8080\nINFO     2015-05-27 09:11:23,073 admin_server.py:118] Starting admin server at: http://localhost:8000\nERROR    2015-05-27 09:11:24,772 go_runtime.py:180] Failed to build Go application: (Executed command: /Users/bezigon/google-cloud-sdk/platform/google_appengine/goroot/bin/go-app-builder -app_base /Users/bezigon/go/src/github.com/bezigon/app -arch 6 -dynamic -goroot /Users/bezigon/google-cloud-sdk/platform/google_appengine/goroot -nobuild_files ^^$ -unsafe -gopath /Users/bezigon/go -print_extras_hash Godeps/_workspace/src/github.com/moovweb/gokogiri/html/xpath_test.go Godeps/_workspace/src/github.com/martini-contrib/binding/validate_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/attribute.go Godeps/_workspace/src/github.com/martini-contrib/binding/file_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/document_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xpath/util.go Godeps/_workspace/src/github.com/go-martini/martini/logger.go Godeps/_workspace/src/github.com/martini-contrib/binding/misc_test.go Godeps/_workspace/src/github.com/go-martini/martini/response_writer_test.go Godeps/_workspace/src/github.com/codegangsta/inject/inject_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/text.go Godeps/_workspace/src/github.com/go-martini/martini/go_version.go Godeps/_workspace/src/github.com/go-martini/martini/router_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/nodeset.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xpath/xpath_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xpath/xpath.go Godeps/_workspace/src/github.com/martini-contrib/binding/errors.go Godeps/_workspace/src/github.com/moovweb/gokogiri/mem/mem_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/help/help_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/fragment_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/node_test.go Godeps/_workspace/src/github.com/martini-contrib/render/render.go Godeps/_workspace/src/github.com/moovweb/gokogiri/help/help.go Godeps/_workspace/src/github.com/moovweb/gokogiri/mem/mem.go Godeps/_workspace/src/github.com/go-martini/martini/recovery.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/document.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/document.go Godeps/_workspace/src/github.com/moovweb/gokogiri/gokogiri.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/element.go Godeps/_workspace/src/github.com/martini-contrib/binding/errors_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/util/util_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/fragment.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/attribute_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/css/css_test.go Godeps/_workspace/src/github.com/oxtoacart/bpool/bytepool.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/fragment_test.go Godeps/_workspace/src/github.com/martini-contrib/binding/errorhandler_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/utils_test.go Godeps/_workspace/src/github.com/oxtoacart/bpool/bpool.go Godeps/_workspace/src/github.com/moovweb/gokogiri/util/util.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/utils_test.go Godeps/_workspace/src/github.com/go-martini/martini/response_writer.go Godeps/_workspace/src/github.com/moovweb/gokogiri/css/css.go Godeps/_workspace/src/github.com/go-martini/martini/env.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/search_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/gokogiri_test.go Godeps/_workspace/src/github.com/go-martini/martini/static_test.go Godeps/_workspace/src/github.com/codegangsta/inject/inject.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xpath/expression.go Godeps/_workspace/src/github.com/martini-contrib/binding/form_test.go Godeps/_workspace/src/github.com/go-martini/martini/static.go Godeps/_workspace/src/github.com/go-martini/martini/martini.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/fragment.go Godeps/_workspace/src/github.com/martini-contrib/binding/bind_test.go app.go Godeps/_workspace/src/github.com/martini-contrib/render/render_test.go Godeps/_workspace/src/github.com/martini-contrib/binding/binding.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/cdata.go Godeps/_workspace/src/github.com/go-martini/martini/martini_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/node_test.go Godeps/_workspace/src/github.com/oxtoacart/bpool/bufferpool.go Godeps/_workspace/src/github.com/martini-contrib/binding/json_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xpath/util_test.go Godeps/_workspace/src/github.com/go-martini/martini/router.go Godeps/_workspace/src/github.com/martini-contrib/binding/common_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/pi.go Godeps/_workspace/src/github.com/go-martini/martini/logger_test.go Godeps/_workspace/src/github.com/go-martini/martini/recovery_test.go Godeps/_workspace/src/github.com/go-martini/martini/return_handler.go Godeps/_workspace/src/github.com/moovweb/gokogiri/help/util_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/document_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/crash_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/comment.go Godeps/_workspace/src/github.com/martini-contrib/binding/multipart_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/xml/node.go Godeps/_workspace/src/github.com/go-martini/martini/env_test.go Godeps/_workspace/src/github.com/moovweb/gokogiri/html/encoding_test.go)\n\n2015/05/27 12:11:24 go-app-builder: Failed parsing input: package github.com/moovweb/gokogiri/html required, but all its files were excluded by nobuild_files\n</code></pre>\n\n<p>What should I do?</p>\n\n<p>By the way it looks to <a href=\"https://blog.golang.org/the-app-engine-sdk-and-workspaces-gopath\" rel=\"nofollow\">https://blog.golang.org/the-app-engine-sdk-and-workspaces-gopath</a>, but I have not found the answer.</p>\n\n<p>UPD: I have added a testcase, check it out <a href=\"https://github.com/bezigon/testcase\" rel=\"nofollow\">https://github.com/bezigon/testcase</a></p>\n"}, {"tags": ["logging", "go", "sidekiq", "middleware"], "comments": [{"owner": {"reputation": 3000, "user_id": 1335245, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b201e069f3e6868c1c0285f6e31801c?s=128&d=identicon&r=PG", "display_name": "Charney Kaye", "link": "https://stackoverflow.com/users/1335245/charney-kaye"}, "edited": false, "score": 0, "creation_date": 1432715154, "post_id": 30476990, "comment_id": 49033281, "body": "Posted <a href=\"https://github.com/jrallison/go-workers/issues/50\" rel=\"nofollow noreferrer\">github.com/jrallison/go-workers/issues/50</a>"}], "answers": [{"tags": [], "owner": {"reputation": 3000, "user_id": 1335245, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b201e069f3e6868c1c0285f6e31801c?s=128&d=identicon&r=PG", "display_name": "Charney Kaye", "link": "https://stackoverflow.com/users/1335245/charney-kaye"}, "is_accepted": true, "score": 1, "last_activity_date": 1432771859, "last_edit_date": 1432771859, "creation_date": 1432763001, "answer_id": 30493680, "question_id": 30476990, "link": "https://stackoverflow.com/questions/30476990/golang-go-workers-custom-logging-middleware/30493680#30493680", "title": "Golang go-workers custom logging middleware?", "body": "<p>Quoting <a href=\"https://github.com/jrallison\" rel=\"nofollow\">jrallison</a> from <a href=\"https://github.com/jrallison/go-workers/issues/50\" rel=\"nofollow\">github.com/jrallison/go-workers/issues/50</a>:</p>\n\n<blockquote>\n  <p>It looks like you're replacing the worker logging middleware (which logs information about each and every message processed by your workers).</p>\n  \n  <p>The only logging I see in your output is the processing/quitting log entries from the manager which are logged on startup and shutdown.</p>\n  \n  <p><a href=\"https://github.com/jrallison/go-workers/blob/571e6b3b7be959e99024ec12b83b2ad261b06ff7/manager.go#L47\" rel=\"nofollow\">https://github.com/jrallison/go-workers/blob/571e6b3b7be959e99024ec12b83b2ad261b06ff7/manager.go#L47</a></p>\n  \n  <p>If you'd like these to not be logged, you may want to replace workers.Logger with an object that meets the WorkersLogger interface, but doesn't actually log anything (... or perhaps for your use-case, logs it in JSON format):</p>\n</blockquote>\n\n<p>Issue is resolved by my final code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (a *App) ConfigureWorkers() {\n  workers.Middleware = workers.NewMiddleware( &amp;WorkMiddleware{ App: a } )\n  workers.Logger = &amp;WorkersLogger{ App: a }\n}\n\ntype WorkersLogger struct {\n  App *App\n}\n\nfunc (l *WorkersLogger) Println(args ...interface{}) {\n  l.App.Log.WithFields( log.Fields{\n    \"instanceId\": l.App.Id,\n    }).Println(args...)\n}\n\nfunc (l *WorkersLogger) Printf(fmt string, args ...interface{}) {\n  l.App.Log.WithFields( log.Fields{\n    \"instanceId\": l.App.Id,\n    }).Printf(fmt, args...)\n}\n</code></pre>\n"}], "owner": {"reputation": 3000, "user_id": 1335245, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/3b201e069f3e6868c1c0285f6e31801c?s=128&d=identicon&r=PG", "display_name": "Charney Kaye", "link": "https://stackoverflow.com/users/1335245/charney-kaye"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 692, "favorite_count": 0, "accepted_answer_id": 30493680, "answer_count": 1, "score": 0, "last_activity_date": 1432771859, "creation_date": 1432715139, "last_edit_date": 1432716367, "question_id": 30476990, "link": "https://stackoverflow.com/questions/30476990/golang-go-workers-custom-logging-middleware", "title": "Golang go-workers custom logging middleware?", "body": "<p>I'm building a <a href=\"http://golang.org\" rel=\"nofollow\">Golang</a> app that implements a <a href=\"http://sidekiq.org/\" rel=\"nofollow\">Sidekiq</a>-compatible <a href=\"https://github.com/jrallison/go-workers\" rel=\"nofollow\">jrallison/go-workers</a> work queue and a custom logging wrapper around <a href=\"https://github.com/Sirupsen/logrus\" rel=\"nofollow\">Sirupsen/logrus</a> for marshaled JSON logs.</p>\n\n<p>Now, all of my app (except for <code>go-workers</code> so far) uses my logger-wrapper in a central place to ensure that 100% of its output is JSON compatible.</p>\n\n<p>Note that lines #1 and #2 are proper JSON from our central logger, but when <code>go-workers</code> initializes we see line #3 come from the wrong logger in plain text.</p>\n\n<pre class=\"lang-json prettyprint-override\"><code>{\"db\":{\"Mapper\":{}},\"instance_id\":\"1\",\"level\":\"info\",\"msg\":\"Db: Connected to MySQL\",\"time\":\"2015-05-27T04:15:15-04:00\"}\n{\"concurrency\":10,\"instance_id\":\"1\",\"level\":\"info\",\"msg\":\"Worker: Commencing work\",\"time\":\"2015-05-27T04:15:15-04:00\"}\nworkers: 2015/05/27 04:15:15.211217 processing queue contact with 10 workers.\n</code></pre>\n\n<p>And when we send the signal to close the program, we see first on line #1 the wrong logger in plain text, followed by the proper JSON from our central logger on line #2.</p>\n\n<pre class=\"lang-json prettyprint-override\"><code>^C\nworkers: 2015/05/27 04:15:17.197504 quitting queue contact (waiting for 0 / 10 workers).\n{\"instance_id\":\"1\",\"level\":\"info\",\"msg\":\"Closed correctly\",\"time\":\"2015-05-27T04:15:17-04:00\"}\n</code></pre>\n\n<p>I cannot seem to get this custom MiddlewareLogging to replace the <code>go-workers</code> default logging middleware.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func (a *App) ConfigureWorkers() {\n  workers.Middleware = workers.NewMiddleware(\n    &amp;WorkMiddleware{ App: a },\n    )\n}\n\ntype WorkMiddleware struct{\n  App *App\n}\n\nfunc (m *WorkMiddleware) Call(queue string, message *workers.Msg, next func() bool) (acknowledge bool) {\n  // before each message is processed:\n  job_json := message.Args().GetIndex(0).MustString()\n  job := ContactJob{}\n  err := json.Unmarshal([]byte(job_json), &amp;job)\n  if err != nil {\n  m.App.Log.WithFields( log.Fields{\n    \"job_json\": job_json,\n    }).Fatal(\"Worker: Could not Unmarshal job JSON\")\n    return\n  }\n  SetMessageJob(message, job)\n  start := time.Now()\n  m.App.Log.WithFields( log.Fields{\n    \"job_id\": message.Jid(),\n    \"queue\": queue,\n    \"args\": message.Args(),\n    }).Print(\"Work: Job Starting\")\n  defer func() {\n    if e := recover(); e != nil {\n      buf := make([]byte, 4096)\n      buf = buf[:runtime.Stack(buf, false)]\n      m.App.Log.WithFields( log.Fields{\n          \"job_id\": message.Jid(),\n          \"queue\": queue,\n          \"duration\": time.Since(start),\n          \"error\": e,\n          \"stack\": buf,\n        }).Fatal(\"Work: Job Failed\")\n    }\n  }()\n  acknowledge = next()\n  result := GetMessageResult(message)\n  m.App.Log.WithFields( log.Fields{\n    \"job_id\": message.Jid(),\n    \"result\": result,\n    \"queue\": queue,\n    \"duration\": time.Since(start),\n    }).Print(\"Work: Job Done\")\n  return\n}\n</code></pre>\n\n<p>Is it actually possible to replace the default <code>go-workers</code> logging middleware for those lines?</p>\n"}, {"tags": ["interface", "go", "factory"], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 1, "creation_date": 1432717989, "post_id": 30477573, "comment_id": 49035088, "body": "Of course! Why didn&#39;t I think of that? Thank you! I didn&#39;t know the <code>%T</code> flag by the way."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 1, "last_activity_date": 1471854985, "last_edit_date": 1471854985, "creation_date": 1432716782, "answer_id": 30477573, "question_id": 30476861, "link": "https://stackoverflow.com/questions/30476861/go-factory-returning-pointer-and-interface-type/30477573#30477573", "title": "Go: factory returning pointer and interface{} type", "body": "<p>In your 2nd example <code>NewTypeA()</code> returns <code>Entity</code> not <code>*TypeA</code>, so it is no different from a solution where <code>NewTypeA()</code> would return <code>interface{}</code> which renders the <code>Entity</code> type completely needless/redundant:</p>\n\n<pre><code>type TypeA struct {\n    placeholder int\n}\n\nfunc NewTypeA() interface{} {\n    return new(TypeA)\n}\n\nfunc main() {\n    factory := make(map[string]func() interface{})\n    factory[\"TypeA\"] = NewTypeA\n\n    tmp := factory[\"TypeA\"]()\n    fmt.Printf(\"%T\", tmp)\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"http://play.golang.org/p/77E92GDnv5\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>*main.TypeA\n</code></pre>\n\n<h3>Keeping the <code>*TypeA</code> return type</h3>\n\n<p>For convenience if you want your <code>NewTypeA()</code> factory function to still return <code>*TypeA</code>, you can do so by putting an anonymous wrapper function in your <code>factory</code> map:</p>\n\n<pre><code>func NewTypeA() *TypeA {\n    return new(TypeA)\n}\n\nfunc main() {\n    factory := make(map[string]func() interface{})\n    factory[\"TypeA\"] = func() interface{} { return NewTypeA() }\n\n    tmp := factory[\"TypeA\"]()\n    fmt.Printf(\"%T\", tmp)\n}\n</code></pre>\n\n<p>Output again (<a href=\"http://play.golang.org/p/vUrCaJeXlw\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>*main.TypeA\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 0, "creation_date": 1432718111, "post_id": 30477620, "comment_id": 49035177, "body": "Thank you for the article! I red it when I started to use go couple months ago. This is still not entirely clear to me, I&#39;ll read it again."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 3, "last_activity_date": 1432716907, "creation_date": 1432716907, "answer_id": 30477620, "question_id": 30476861, "link": "https://stackoverflow.com/questions/30476861/go-factory-returning-pointer-and-interface-type/30477620#30477620", "title": "Go: factory returning pointer and interface{} type", "body": "<p>I don't think you fully understand what an interface{} is and thus are trying to use it incorrectly.</p>\n\n<p>As stated in <a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow\">this article</a>:</p>\n\n<blockquote>\n  <p>The interface{} type, the empty interface, is the source of much\n  confusion.</p>\n</blockquote>\n\n<p>I'd recommend that you read that article and then have another look at what you are trying to do.</p>\n\n<p>An interface{} is not a placeholder for any other type, it's a <a href=\"http://golang.org/ref/spec#Interface_types\" rel=\"nofollow\">type itself</a>.</p>\n\n<p>So if you create a map that takes functions that return interface{} as keys then that's the type the functions needs to return. Not a pointer or int or anything else.</p>\n\n<p>While you can assign a value of any type to an interface, including pointer types, you can't use other types in place of an interface{} type.</p>\n\n<p>It seems that what you are trying to accomplish is have a map with functions that can return a value of any type. You can only do that indirectly by designing your functions differently. You'd have to use an interface{} type in the function, assign the value you want to return to it and then return the interface{}. But you have to return type interface{} and not type int or string or *TypeA or whatever.</p>\n"}], "owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 68, "favorite_count": 0, "accepted_answer_id": 30477573, "answer_count": 2, "score": -1, "last_activity_date": 1471854985, "creation_date": 1432714759, "question_id": 30476861, "link": "https://stackoverflow.com/questions/30476861/go-factory-returning-pointer-and-interface-type", "title": "Go: factory returning pointer and interface{} type", "body": "<p>Consider the following factory: <a href=\"http://play.golang.org/p/AUyBFoqaW3\" rel=\"nofollow\">Go playground</a></p>\n\n<pre><code>type TypeA struct {\n    placeholder int\n}\n\nfunc NewTypeA() *TypeA {\n    return new(TypeA)\n}\n\nfunc main() {\n  factory := make(map[string]func() interface{})\n  factory[\"TypeA\"] = NewTypeA\n}\n</code></pre>\n\n<p>This gives me the following error: <code>cannot use NewTypeA (type func() *TypeA) as type func() interface {} in assignment</code> which is pretty clear.</p>\n\n<p>I thought that <code>interface{}</code> was able to be matched with a pointer. </p>\n\n<p>I found this solution: <a href=\"http://play.golang.org/p/k7hJew9lvn\" rel=\"nofollow\">Go playground</a></p>\n\n<pre><code>type Entity interface {}\n\ntype TypeA struct {\n    Entity\n    placeholder int\n}\n\nfunc NewTypeA() Entity {\n    return new(TypeA)\n}\n\nfunc main() {\n  var tmp interface{}\n  factory := make(map[string]func() Entity)\n  factory[\"TypeA\"] = NewTypeA\n  tmp = factory[\"TypeA\"]()\n  log.Println(reflect.TypeOf(tmp))\n}\n</code></pre>\n\n<p>Which gives me the expected type <code>*TypeA</code>.\nIs there an other way to do this using the <code>interface{}</code> type directly instead of a \"dumb\" interface (<code>Entity</code>)?</p>\n"}, {"tags": ["go", "extract", "meta", "goquery"], "answers": [{"comments": [{"owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "edited": false, "score": 0, "creation_date": 1432841547, "post_id": 30475058, "comment_id": 49106194, "body": "Thanks, you helped me a lot!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1432710117, "last_edit_date": 1432710117, "creation_date": 1432709238, "answer_id": 30475058, "question_id": 30474991, "link": "https://stackoverflow.com/questions/30474991/extract-meta-description-field-with-goquery/30475058#30475058", "title": "Extract meta description field with goquery", "body": "<p>Just examine the value of the <code>name</code> attribute whether it matches <code>\"description\"</code>:</p>\n\n<pre><code>doc.Find(\"meta\").Each(func(i int, s *goquery.Selection) {\n    if name, _ := s.Attr(\"name\"); name == \"description\" {\n        description, _ := s.Attr(\"content\")\n        fmt.Printf(\"Description field: %s\\n\", description)\n    }\n})\n</code></pre>\n\n<p>You may want to compare the value of the <code>name</code> attribute in a case insensitive manner, for that you can use <a href=\"https://golang.org/pkg/strings/#EqualFold\" rel=\"noreferrer\"><code>strings.EqualFold()</code></a>:</p>\n\n<pre><code>if name, _ := s.Attr(\"name\"); strings.EqualFold(name, \"description\") {\n    // proceed to extract and use the content of description\n}\n</code></pre>\n"}], "owner": {"reputation": 1757, "user_id": 1909569, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/0a02066c0046ce77af47b86c30cd720d?s=128&d=identicon&r=PG", "display_name": "Rogier Lommers", "link": "https://stackoverflow.com/users/1909569/rogier-lommers"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1875, "favorite_count": 2, "accepted_answer_id": 30475058, "answer_count": 1, "score": 3, "last_activity_date": 1445405486, "creation_date": 1432708991, "last_edit_date": 1445405486, "question_id": 30474991, "link": "https://stackoverflow.com/questions/30474991/extract-meta-description-field-with-goquery", "title": "Extract meta description field with goquery", "body": "<p>I'm using the <a href=\"https://github.com/PuerkitoBio/goquery\" rel=\"nofollow\">goquery</a> package to extract pieces of information from a webpage. Please see my code below. The outcome when after running the function is: </p>\n\n<pre><code>Description field: text/html; charset=iso-8859-15\nDescription field: width=device-width\nDescription field: THIS IS THE TEXT I WANT TO EXTRACT\n</code></pre>\n\n<p>I'm almost there, however I only want to get the meta field where the name == 'description'. Unfortunately I can't figure out how to add this extra condition to my code.</p>\n\n<pre><code>func ExampleScrapeDescription() {\n    htmlCode :=\n        `&lt;!doctype html&gt;\n&lt;html lang=\"NL\"&gt;\n    &lt;head&gt;\n        &lt;meta http-equiv=\"content-type\" content=\"text/html; charset=iso-8859-15\"&gt;\n        &lt;meta name=\"viewport\" content=\"width=device-width\"&gt;\n        &lt;meta name=\"description\" content=\"THIS IS THE TEXT I WANT TO EXTRACT\"&gt;\n        &lt;title&gt;page title&lt;/title&gt;\n    &lt;/head&gt;\n    &lt;body class=\"fixedHeader\"&gt;\n        page body\n    &lt;/body&gt;\n&lt;/html&gt;`\n\n    doc, err := goquery.NewDocumentFromReader(strings.NewReader((htmlCode)))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    doc.Find(\"meta\").Each(func(i int, s *goquery.Selection) {\n        description, _ := s.Attr(\"content\")\n        fmt.Printf(\"Description field: %s\\n\", description)\n    })\n}\n</code></pre>\n"}, {"tags": ["regex", "http", "go", "url-routing"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 10, "last_activity_date": 1432708373, "last_edit_date": 1432708373, "creation_date": 1432708040, "answer_id": 30474723, "question_id": 30474313, "link": "https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang/30474723#30474723", "title": "How to use regexp get url pattern in golang?", "body": "<p><a href=\"https://golang.org/pkg/net/http/#HandleFunc\" rel=\"noreferrer\"><code>http.HandleFunc()</code></a> can not be used to register a pattern to match a regular expression. In short, the pattern specified at <code>HandleFunc()</code> can match a fixed, rooted path (like <code>/favico.ico</code>) or rooted subtrees (like <code>/images/</code>), longer patterns take precedence over shorter ones. You can find more details at the doc of the <a href=\"https://golang.org/pkg/net/http/#ServeMux\" rel=\"noreferrer\"><code>ServeMux</code></a> type.</p>\n\n<p>What you can do is register your handler to a rooted subtree which may be  everything with the <code>/</code> pattern, and inside your handler you can do further regexp matching and routing.</p>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n    http.HandleFunc(\"/\", route) // Match everything\n    http.ListenAndServe(\":8080\", nil)\n}\n\nvar rNum = regexp.MustCompile(`\\d`)  // Has digit(s)\nvar rAbc = regexp.MustCompile(`abc`) // Contains \"abc\"\n\nfunc route(w http.ResponseWriter, r *http.Request) {\n    switch {\n    case rNum.MatchString(r.URL.Path):\n        digits(w, r)\n    case rAbc.MatchString(r.URL.Path):\n        abc(w, r)\n    default:\n        w.Write([]byte(\"Unknown Pattern\"))\n    }\n}\n\nfunc digits(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Has digits\"))\n}\n\nfunc abc(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Has abc\"))\n}\n</code></pre>\n\n<p>Or use an external library like Gorilla MUX.</p>\n"}, {"tags": [], "owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "is_accepted": false, "score": 1, "last_activity_date": 1432708064, "creation_date": 1432708064, "answer_id": 30474731, "question_id": 30474313, "link": "https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang/30474731#30474731", "title": "How to use regexp get url pattern in golang?", "body": "<p>Golang doesn't have built-in <em>regex</em> support for URL matching. And it's somewhat complicated to implement from scratch.</p>\n\n<p>Maybe using a <em>framework</em> would be a better choice, such as <a href=\"https://github.com/astaxie/beego\" rel=\"nofollow\">beego</a> or <a href=\"https://github.com/go-martini/martini#routing\" rel=\"nofollow\">martin</a>, etc.</p>\n"}, {"tags": [], "owner": {"reputation": 13897, "user_id": 1713660, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c5aa62fae5a22b542d2a188b95384aee?s=128&d=identicon&r=PG", "display_name": "vladkras", "link": "https://stackoverflow.com/users/1713660/vladkras"}, "is_accepted": false, "score": 4, "last_activity_date": 1519295062, "creation_date": 1519295062, "answer_id": 48924986, "question_id": 30474313, "link": "https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang/48924986#48924986", "title": "How to use regexp get url pattern in golang?", "body": "<p>I use <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a> package. So router looks like:</p>\n\n<pre><code>func main() {\n\n    r := mux.NewRouter()\n\n    r.HandleFunc(\"/{name:pattern}\", handle)\n    http.ListenAndServe(\":8080\", r)\n}\n</code></pre>\n\n<p>where <code>{name:pattern}</code> could be simply <code>{slug}</code> (without pattern) or <code>{id:[0-9]+}</code> or combination of them <code>/{category}/{id:[0-9]+}</code>. And get them in handler func:</p>\n\n<pre><code>func handle(w http.ResponseWriter, r *http.Request) {\n\n    params := mux.Vars(r)\n\n    // for /{category}/{id:[0-9]+} pattern\n    category := params[\"category\"]\n    id := params[\"id\"]\n}\n</code></pre>\n\n<p>run it and try <code>curl http://localhost:8080/whatever/1</code></p>\n"}], "owner": {"reputation": 301, "user_id": 4047001, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/ca7dcf86ac790b67132a103a1b33eced?s=128&d=identicon&r=PG&f=1", "display_name": "xichen", "link": "https://stackoverflow.com/users/4047001/xichen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18157, "favorite_count": 3, "accepted_answer_id": 30474723, "answer_count": 3, "score": 6, "last_activity_date": 1519295062, "creation_date": 1432706582, "last_edit_date": 1432708161, "question_id": 30474313, "link": "https://stackoverflow.com/questions/30474313/how-to-use-regexp-get-url-pattern-in-golang", "title": "How to use regexp get url pattern in golang?", "body": "<p>How to use regular expression matching URL, which does decide to use the corresponding function processing</p>\n\n<pre><code>package main\n\nimport(\n  \"fmt\"\n  \"net/http\"\n)\n\nfunc main() {\n  http.HandleFunc(\"/pattern\", resolve)\n  http.ListenAndServe(\":8080\", nil)\n}\n\nfunc resolve(w http.ResponseWriter, r * http.Request) {\n  fmt.Println(r.URL.Host)\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 0, "creation_date": 1432692944, "post_id": 30471978, "comment_id": 49024304, "body": "I was thinking of this exact solution as well. Seems a bit more readable. Could also make <code>findValue(m map[string]interface{}, keys ...string)</code>"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 2, "last_activity_date": 1432692389, "creation_date": 1432692389, "answer_id": 30471978, "question_id": 30471586, "link": "https://stackoverflow.com/questions/30471586/idiomatic-else-if-chain-for-a-map-key/30471978#30471978", "title": "Idiomatic else if chain for a map key", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc findValue(m map[string]interface{}, keys []string) (interface{}, bool) {\n    for _, key := range keys {\n        if value, ok := m[key]; ok {\n            return value, true\n        }\n    }\n    return nil, false\n}\n\nfunc main() {\n    m := map[string]interface{}{\"keyn\": \"valuen\"}\n    keys := []string{\"key1\", \"key2\", \"keyn\"}\n    s, found := findValue(m, keys)\n    if !found {\n        return\n    }\n    id := s.(string)\n    fmt.Println(id)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>valuen\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "edited": false, "score": 1, "creation_date": 1432694375, "post_id": 30472223, "comment_id": 49024649, "body": "That is why I didn&#39;t write the findValue function. Also I believe using <code>:=</code> would not work as the variable is only scoped to the if statement when you do that"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1432695603, "last_edit_date": 1432695603, "creation_date": 1432694265, "answer_id": 30472223, "question_id": 30471586, "link": "https://stackoverflow.com/questions/30471586/idiomatic-else-if-chain-for-a-map-key/30472223#30472223", "title": "Idiomatic else if chain for a map key", "body": "<p>Actually I think the code you provided is very easy to read and understand. It is a bit verbose but there is no magic ;). So if there is only one place where you have to write this code I would leave it as it is. If you need to write it a few times I would consider writing <code>findValue</code> function mentioned in another comment.</p>\n"}], "owner": {"reputation": 1079, "user_id": 3591723, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/226c74589745a877b4dbd474fb66951e?s=128&d=identicon&r=PG&f=1", "display_name": "user3591723", "link": "https://stackoverflow.com/users/3591723/user3591723"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1432707049, "creation_date": 1432689634, "last_edit_date": 1432707049, "question_id": 30471586, "link": "https://stackoverflow.com/questions/30471586/idiomatic-else-if-chain-for-a-map-key", "title": "Idiomatic else if chain for a map key", "body": "<p>I have a fairly long else if chain looking for keys in a map and setting a specific value if found. The way I chose to do it with the least amount of code was this (<code>m</code> is a <code>map[string]interface{}</code>)</p>\n\n<pre><code>var ok bool\nvar s interface{}\nif s, ok = m[\"key1\"]; ok {\n} else if s, ok = m[\"key2\"]; ok {\n           ....\n} else if s, ok = m[\"keyN\"]; ok {\n} else {\n   return RuhRohError\n}\ng.Id = s.(string)\n</code></pre>\n\n<p>This feels kinda clunky, I am doing all of these <code>else if</code>'s to set a variable in the condition. Is there an idiomatic way to do this? I think this way doesn't make it immediately obvious what I am trying to do.</p>\n"}, {"tags": ["google-app-engine", "go", "seo"], "comments": [{"owner": {"reputation": 6963, "user_id": 151316, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/549acdbbe6ac79e0684543945d83fcfb?s=128&d=identicon&r=PG", "display_name": "RiddlerDev", "link": "https://stackoverflow.com/users/151316/riddlerdev"}, "edited": false, "score": 0, "creation_date": 1432688651, "post_id": 30471471, "comment_id": 49023256, "body": "I left my site off here because I am trying to make sure I am not considered to be advertising it. If it is needed I can provide that as well."}, {"owner": {"reputation": 92307, "user_id": 167735, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5deb8de031f80c23f19e9b6d389e5afe?s=128&d=identicon&r=PG", "display_name": "slebetman", "link": "https://stackoverflow.com/users/167735/slebetman"}, "edited": false, "score": 2, "creation_date": 1432694985, "post_id": 30471471, "comment_id": 49024802, "body": "Google&#39;s algorithm works by finding your page through links on other websites. In the past, the only way I managed to get my site to be indexed by Google is to post a link to it from somewhere. Usually a forum or blog. This is where things like Stack Overflow&#39;s user profile or LinkedIn comes in useful for personal websites - list your url in your profile and soon Google will index it."}, {"owner": {"reputation": 51551, "user_id": 520957, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/bLCif.jpg?s=128&g=1", "display_name": "J&#233;r&#244;me Verstrynge", "link": "https://stackoverflow.com/users/520957/j%c3%a9r%c3%b4me-verstrynge"}, "edited": false, "score": 0, "creation_date": 1432824814, "post_id": 30471471, "comment_id": 49095605, "body": "What does site:yoursite.com return in the google search box?"}, {"owner": {"reputation": 12348, "user_id": 64046, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a86a311e34d94a802e8bf88e2807ede3?s=128&d=identicon&r=PG", "display_name": "JasonMArcher", "link": "https://stackoverflow.com/users/64046/jasonmarcher"}, "edited": false, "score": 0, "creation_date": 1432841865, "post_id": 30471471, "comment_id": 49106397, "body": "I&#39;m voting to close this question as off-topic because it is an <a href=\"http://meta.stackoverflow.com/questions/281380/can-we-ask-seo-questions-on-stack-overflow\">SEO question</a>."}], "owner": {"reputation": 6963, "user_id": 151316, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/549acdbbe6ac79e0684543945d83fcfb?s=128&d=identicon&r=PG", "display_name": "RiddlerDev", "link": "https://stackoverflow.com/users/151316/riddlerdev"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 65, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1456129677, "creation_date": 1432688608, "last_edit_date": 1495535297, "question_id": 30471471, "link": "https://stackoverflow.com/questions/30471471/custom-domain-goapp-site-not-indexing-on-search-engines", "title": "Custom Domain GoApp Site Not Indexing on Search Engines", "body": "<p>I have been building several GoApp sites with GoLang backend and a lightweight html5/css3/javascript (usually AngularJS) front end. Most of these were for practice, but I have recently created my own personal site with this same pattern and decided that I wanted my own custom domain for it.</p>\n\n<p>I followed the steps outlined here: <a href=\"https://cloud.google.com/appengine/docs/domain\" rel=\"nofollow noreferrer\">Google App Custom Domains</a> and everything seemed great. People were able to hit my site (with and without the www) and I was seeing traffic come through Google Analytics.</p>\n\n<p>Now for the problem... as I was looking at various search engines and attempting to submit my site to the index, I am getting \"Site Not Found\" errors from the Search Engines. For Google and Bing I went into webmaster tools and everything looked fine on the diagnostics (Robots.txt and SiteMap.xml). However after a few days, I am still showing the site is not being indexed.</p>\n\n<p>So the question is, does anyone know why I might be having issues? Nothing I have found seems to point to what the cause might be.</p>\n\n<p>Some of the other SO pages I looked at first:</p>\n\n<ul>\n<li><a href=\"https://stackoverflow.com/questions/25107756/are-appspot-google-app-engine-sites-restricted-in-crawl-search-engine-ranking\">are .appspot google app engine sites restricted in crawl / search engine rankings?</a></li>\n<li><a href=\"https://stackoverflow.com/questions/17864750/wordpress-site-will-not-index-in-google\">Wordpress Site Will Not Index In Google</a></li>\n<li><a href=\"https://stackoverflow.com/questions/11280542/google-app-engine-custom-domain\">Google App Engine + Custom domain</a></li>\n</ul>\n"}, {"tags": ["recursion", "concurrency", "go", "mutex"], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432699743, "post_id": 30470872, "comment_id": 49026110, "body": "Your A() and B() are explicitly synchronous/serialized; you are not implementing the concurrency pattern I am talking about.  In your example B starts after A finishes.  Now - start both A and B invocations as goroutines, and (assuming A gets the channel first) ensure that B&#39;s invocation of A blocks until the first invocation frame of A completes, and we&#39;re closer to what I want.  The problem is that there is no way I can see for a select or any other concurrency mechanism in the language to distinguish between B&#39;s first invocation of A, and A&#39;s first, second, third, etc..."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432699827, "post_id": 30470872, "comment_id": 49026143, "body": "As for that link,  &quot;Code that takes the lock, and then takes it again appears to be written in a very sloppy way (in my opinion).&quot;  Some people I know say any/all recursion is &quot;sloppy&quot;.   They&#39;re entitled to their opinions, I guess."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432700822, "post_id": 30470872, "comment_id": 49026395, "body": "Looks like the best bet here is going to be going with some kind of worker queue pattern, where A and B are passed along with their arguments over a channel and called reflectively, in a single goroutine, in serial order.  Initial testing looks like this is a huge performance hit, but I can&#39;t see any other way...   hopefully some Go guru will have something further to say on this.... =/"}, {"owner": {"reputation": 1966, "user_id": 2739942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbb10b8c7115b8c44459363fb6476cf?s=128&d=identicon&r=PG", "display_name": "divan", "link": "https://stackoverflow.com/users/2739942/divan"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432718732, "post_id": 30470872, "comment_id": 49035645, "body": "Yes, in this specific example A() and B() start synchronously, but I made that intentionaly to simplify the code. You can add &#39;go&#39; keyword to A() and B() and implement WaitGroup or even add time.Sleep() to wait until A() and B() finished. But this code shows the core idea.  Regarding performance, you usually don&#39;t have huge performance hit, there are a lot of benchmarks about that, see <a href=\"https://github.com/mdmarek/go-lock-vs-channel\" rel=\"nofollow noreferrer\">github.com/mdmarek/go-lock-vs-channel</a> for example.  Also there is nice and precise wiki page on where to use mutexes and channels in Go: <a href=\"https://code.google.com/p/go-wiki/wiki/MutexOrChannel\" rel=\"nofollow noreferrer\">code.google.com/p/go-wiki/wiki/MutexOrChannel</a>."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432741753, "post_id": 30470872, "comment_id": 49053038, "body": "I think you&#39;re not understanding what I&#39;m asking for...   You can&#39;t just add &#39;go&#39; in front of A and B.  If you do, it&#39;s possible that at some point in the resulting execution the channel will send the value 12 - say one goroutine has a stack of A 6 frames deep and another has a B &gt; A, 2 frames deep.  That would not be allowed if the code was properly guarding according to my constraints. (again assuming the A() call executes first - the other way you should not see a value like 7)."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432741877, "post_id": 30470872, "comment_id": 49053125, "body": "If you can provide an example using WaitGroup that prevents an A under a B from executing concurrently with another goroutine invocation of A, I&#39;d love to see it - WaitGroup had the most promise but I think you&#39;d still need a goroutine identifier."}, {"owner": {"reputation": 1966, "user_id": 2739942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbb10b8c7115b8c44459363fb6476cf?s=128&d=identicon&r=PG", "display_name": "divan", "link": "https://stackoverflow.com/users/2739942/divan"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1432742415, "post_id": 30470872, "comment_id": 49053505, "body": "Yeah, I guess, I misunderstood your constraints. But your constraints are inherently described using locks terminology, so probably it&#39;s better to ask for the real-world example of the situation to understand how to re-implement them."}], "tags": [], "owner": {"reputation": 1966, "user_id": 2739942, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3fbb10b8c7115b8c44459363fb6476cf?s=128&d=identicon&r=PG", "display_name": "divan", "link": "https://stackoverflow.com/users/2739942/divan"}, "is_accepted": false, "score": 1, "last_activity_date": 1432684092, "creation_date": 1432684092, "answer_id": 30470872, "question_id": 30469808, "link": "https://stackoverflow.com/questions/30469808/recursive-critical-sections-in-go/30470872#30470872", "title": "Recursive critical sections in Go", "body": "<p>Say, your example above looks like:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct {\n    // here must be reentrant mutex\n    Value int\n}\n\nvar F Foo\n\nfunc A() {\n    F.Value += 1\n    if F.Value &lt; 10 {\n        A()\n    }\n}\n\nfunc B() {\n    F.Value += 5\n    if F.Value &lt; 20 {\n        A()\n    }\n}\n\nfunc main() {\n    F = Foo{\n        Value: 0,\n    }\n    A()\n    B()\n    fmt.Println(\"F is\", F.Value)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/STnaLUCaqP\" rel=\"nofollow\">http://play.golang.org/p/STnaLUCaqP</a></p>\n\n<p>Then implementation in channels should follow simple principle - only one place where F.Value is read or written, wrapped by <em>select</em> statement. Something like this:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Foo struct {\n    Value int\n}\n\nvar (\n    F  Foo\n    ch = make(chan int)\n)\n\nfunc A() {\n    val := &lt;-ch\n    ch &lt;- val+1\n    if val &lt; 10 {\n        A()\n    }\n}\n\nfunc B() {\n    val := &lt;-ch\n    ch &lt;- val+5\n    if val &lt; 20 {\n        A()\n    }\n}\n\nfunc main() {\n    F = Foo{\n        Value: 0,\n    }\n    go func() {\n        for {\n            select {\n            case val := &lt;-ch:\n                F.Value = val\n            case ch &lt;- F.Value:\n            }\n        }\n    }()\n    A()\n    B()\n    fmt.Println(\"F is\", F.Value)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/e5M4vTeet2\" rel=\"nofollow\">http://play.golang.org/p/e5M4vTeet2</a></p>\n\n<p>Here we use bidirectional buffered channel for getting/setting F.Value. One reader, one writer, select does all the magic to handling access.</p>\n\n<p>You may also be interested in relevant topic in golang-nuts on the reentrant mutexes: <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/vN5ncBdtkcA\" rel=\"nofollow\">https://groups.google.com/forum/#!topic/golang-nuts/vN5ncBdtkcA</a> There are good explanation why reentrant mutexes are not useful in Go (and it's not the question of danger).</p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 313, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1432684092, "creation_date": 1432678265, "last_edit_date": 1432683318, "question_id": 30469808, "link": "https://stackoverflow.com/questions/30469808/recursive-critical-sections-in-go", "title": "Recursive critical sections in Go", "body": "<p>I understand that there is no support for recursive mutexes in Go (and that a lot of folks consider these dangerous), and that channels are the preferred way to implement complex concurrency patterns.</p>\n\n<p>However, I cannot figure out any sensible way to implement a very common concurrency pattern - that of the re-entrant or recursive critical section.</p>\n\n<p>Roughly:   goroutines A and B will compete for a lock over a critical section (say some state in a struct needs to be atomically modified).  Let's say A receives the lock.  However, A will recurse, possibly needing to enter the critical section many times.  When it has exited the critical section as it has entered it, goroutine B will get the lock, etc.</p>\n\n<p>I want to implement this with channels (or in any way possible in Go otherwise), without having to pass some string or token back and forth through the whole call tree of functions that might pass through the critical section (there is no \"goroutine id\" available)., and without having messy/expensive stack introspection necessary using <code>runtime</code> package.</p>\n\n<p>How can this be done?</p>\n"}, {"tags": ["go", "shellcode"], "comments": [{"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 2, "creation_date": 1432673319, "post_id": 30468532, "comment_id": 49017785, "body": "&quot;does not run anymore&quot; is not an error message. -1"}, {"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "reply_to_user": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "edited": false, "score": 0, "creation_date": 1432673479, "post_id": 30468532, "comment_id": 49017886, "body": "added the error, sorry!"}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1432678623, "post_id": 30468532, "comment_id": 49020180, "body": "There are multiple issues here - the biggest being that dump seems to be 64 bit - yet you appear to have grabbed some ASM that is a 32-bit sample. You&#39;re using the stack to pass parameters which 64 bit Windows does not do (its ABI is &quot;fastcall&quot; which is register based). The code also uses some 32-bit registers where 64 bit ones should probably be used."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432679523, "post_id": 30468532, "comment_id": 49020522, "body": "similar to: <a href=\"http://stackoverflow.com/questions/30263520/executing-byte-array-in-go\">Executing Byte Array in Go</a>"}, {"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1432735293, "post_id": 30468532, "comment_id": 49047967, "body": "Dave, yes, that&#39;s where I got my initial idea from. Hmmm x64 systems can run 32bit code so I don&#39;t know if that&#39;s the problem, Simon. It didnt worked with a 64bit shellcode either so I have no clue."}], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1432746878, "post_id": 30488660, "comment_id": 49056300, "body": "Well I understand that. Check <a href=\"http://pastebin.com/eHb6zMyD\" rel=\"nofollow noreferrer\">pastebin.com/eHb6zMyD</a> please, a more elaborated example. This is also working and does not make sense to me why the shellcode I put in it wont run. The shellcode was tested in C, works fine."}, {"owner": {"reputation": 9494, "user_id": 128629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4f527fd568a4b80e220341067a7841?s=128&d=identicon&r=PG", "display_name": "Xavier Combelle", "link": "https://stackoverflow.com/users/128629/xavier-combelle"}, "reply_to_user": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1432756961, "post_id": 30488660, "comment_id": 49062059, "body": "What you pass to SystemCall give a random result. Did you test the way I given ?"}, {"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1432761379, "post_id": 30488660, "comment_id": 49064287, "body": "Yes, no luck. Anyway, so here: <a href=\"https://github.com/debasishm89/C-Codes/blob/master/shellcode-exp.c\" rel=\"nofollow noreferrer\">github.com/debasishm89/C-Codes/blob/master/shellcode-exp.c</a> we have a working C example. I did ported it (except the shellcode itself, which im using other - tested and working fine): <a href=\"http://pastebin.com/mRjGL6G3\" rel=\"nofollow noreferrer\">pastebin.com/mRjGL6G3</a> is not working either.. i believe is a pretty decent port and it should work but nothing so far.. Windows 8.1 x64"}, {"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1433362194, "post_id": 30488660, "comment_id": 49325181, "body": "This is still not answered!"}, {"owner": {"reputation": 9494, "user_id": 128629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4f527fd568a4b80e220341067a7841?s=128&d=identicon&r=PG", "display_name": "Xavier Combelle", "link": "https://stackoverflow.com/users/128629/xavier-combelle"}, "reply_to_user": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1433789121, "post_id": 30488660, "comment_id": 49491007, "body": "It is still not answered, maybe it&#39;s because it&#39;s impossible to answer in one of your satisfying way. Because a C shell code is not suitable to a go program, because (at least) the stack layout are all different"}, {"owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1433879432, "post_id": 30488660, "comment_id": 49538878, "body": "I dont think that is the case. I have presented a few examples of working code, just wanted to know why some instruction run and others doesnt in Go."}, {"owner": {"reputation": 9494, "user_id": 128629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4f527fd568a4b80e220341067a7841?s=128&d=identicon&r=PG", "display_name": "Xavier Combelle", "link": "https://stackoverflow.com/users/128629/xavier-combelle"}, "reply_to_user": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "edited": false, "score": 0, "creation_date": 1433948495, "post_id": 30488660, "comment_id": 49573166, "body": "the instructions you use use PUSH  and CALL so the C stack. and C call convention"}], "tags": [], "owner": {"reputation": 9494, "user_id": 128629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec4f527fd568a4b80e220341067a7841?s=128&d=identicon&r=PG", "display_name": "Xavier Combelle", "link": "https://stackoverflow.com/users/128629/xavier-combelle"}, "is_accepted": true, "score": 1, "last_activity_date": 1432814060, "last_edit_date": 1432814060, "creation_date": 1432745485, "answer_id": 30488660, "question_id": 30468532, "link": "https://stackoverflow.com/questions/30468532/how-can-i-execute-native-instructions-in-golang/30488660#30488660", "title": "How can I execute native instructions in GoLang?", "body": "<p><code>syscall.Syscall</code> don't do what you think.</p>\n\n<p>It make a <a href=\"https://en.wikipedia.org/wiki/System_call\" rel=\"nofollow\">System Call</a>, a call to OS kernel function, not an arbitrary jump to a location</p>\n\n<p>Moreover the shellcode expect the C calling conventions, for example the stack pointer to be to a C stack etc. this conditions are not fulfilled in go runtime</p>\n"}], "owner": {"reputation": 23, "user_id": 4942172, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-maIXkF6dyyE/AAAAAAAAAAI/AAAAAAAAB50/Lvg39O1y0_I/photo.jpg?sz=128", "display_name": "Guilherme Thomazi", "link": "https://stackoverflow.com/users/4942172/guilherme-thomazi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1462, "favorite_count": 1, "accepted_answer_id": 30488660, "answer_count": 1, "score": 0, "last_activity_date": 1432814060, "creation_date": 1432673062, "last_edit_date": 1432673452, "question_id": 30468532, "link": "https://stackoverflow.com/questions/30468532/how-can-i-execute-native-instructions-in-golang", "title": "How can I execute native instructions in GoLang?", "body": "<p>I was wondering how can I execute bytes (shellcode, basically) in GoLang. Anyway I found something that helped me getting started, check the code below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"syscall\"\n    \"unsafe\"\n)\n\nconst (\n    MEM_COMMIT  = 0x1000\n    MEM_RESERVE = 0x2000\n\n    PAGE_EXECUTE_READWRITE = 0x40\n)\n\nvar (\n    kernel32     = syscall.MustLoadDLL(\"kernel32.dll\")\n    VirtualAlloc = kernel32.MustFindProc(\"VirtualAlloc\")\n)\n\nfunc SysAlloc(n uintptr) (uintptr, error) {\n    addr, _, err := VirtualAlloc.Call(0, n, MEM_RESERVE|MEM_COMMIT, PAGE_EXECUTE_READWRITE)\n    if addr == 0 {\n        return 0, err\n    }\n    return addr, nil\n}\n\nfunc mkprog() error {\n    const size = 64 * 1024\n    addr, err := SysAlloc(size)\n    if err != nil {\n        return err\n    }\n    b := (*[size]byte)(unsafe.Pointer(addr))\n    b[0] = 0xc3 // RET \n    b[1] = 0x90 // NOP\n    syscall.Syscall(addr, 0, 0, 0, 0)\n    return nil\n}\n\nfunc main() {\n    err := mkprog()\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Printf(\"HELLO\\n\")\n}\n</code></pre>\n\n<p>It works, it executes the NOP and the RET and the program exits sucessfully.\nThe thing is: if I replace b[] with a shellcode (WinExec calc.exe) like this</p>\n\n<pre><code>b[0] = 0x33\nb[1] = 0xc0                          \nb[2] = 0x50                              \nb[3] = 0x68\nb[4] = 0x2E\nb[5] = 0x65\nb[6] = 0x78\nb[7] = 0x65              \nb[8] = 0x68\nb[9] = 0x63\nb[10] = 0x61\nb[11] = 0x6C\nb[12] = 0x63              \nb[13] = 0x8B\nb[14] = 0xC4                          \nb[15] = 0x6A\nb[16] = 0x01                          \nb[17] = 0x50                              \nb[18] = 0xBB\nb[19] = 0xED\nb[20] = 0x2A\nb[21] = 0x86\nb[22] = 0x7C              \nb[23] = 0xFF\nb[24] = 0xD3\n</code></pre>\n\n<p>It does not run anymore. Shouldnt it run properly or am I missing something here? </p>\n\n<p>This is the shellcode in C/Python, for reference:</p>\n\n<pre><code>\"\\x33\\xc0\"                          # XOR EAX,EAX\n\"\\x50\"                              # PUSH EAX      =&gt; padding for lpCmdLine\n\"\\x68\\x2E\\x65\\x78\\x65\"              # PUSH \".exe\"\n\"\\x68\\x63\\x61\\x6C\\x63\"              # PUSH \"calc\"\n\"\\x8B\\xC4\"                          # MOV EAX,ESP\n\"\\x6A\\x01\"                          # PUSH 1\n\"\\x50\"                              # PUSH EAX\n\"\\xBB\\xED\\x2A\\x86\\x7C\"              # MOV EBX,kernel32.WinExec\n\"\\xFF\\xD3\"                          # CALL EBX\n</code></pre>\n\n<p>And the error</p>\n\n<pre><code>Exception 0xc0000005 0x8 0x7c862aed 0x7c862aed\nPC=0x7c862aed\nsignal arrived during cgo execution\n\nmain.mkprog(0x0, 0x0)\n    C:/Users/guitmz/Documents/Go_test4/test_4.go:64 +0xfe\nmain.main()\n    C:/Users/guitmz/Documents/Go_test4/test_4.go:69 +0x2e\n\ngoroutine 2 [runnable]:\nruntime.forcegchelper()\n    c:/go/src/runtime/proc.go:90\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 3 [runnable]:\nruntime.bgsweep()\n    c:/go/src/runtime/mgc0.go:82\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 4 [runnable]:\nruntime.runfinq()\n    c:/go/src/runtime/malloc.go:712\nruntime.goexit()\n    c:/go/src/runtime/asm_amd64.s:2232 +0x1\nrax     0x7fe10\nrbx     0x7c862aed\nrcx     0x0\nrdx     0x0\nrdi     0x7ff5ffffd000\nrsi     0xc082021ec0\nrbp     0x569ae0\nrsp     0x7fdf8\nr8      0x0\nr9      0x50\nr10     0x8\nr11     0x4d5520\nr12     0x3d\nr13     0x0\nr14     0x0\nr15     0x0\nrip     0x7c862aed\nrflags  0x10246\ncs      0x33\nfs      0x53\ngs      0x2b\nError: process exited with code 2.\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["regex", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1432670356, "post_id": 30467647, "comment_id": 49015999, "body": "<code>regexp</code> operates on UTF-8 encoded strings; <code>{0x80}</code> is not a valid UTF-8 encoded string."}, {"owner": {"reputation": 9, "user_id": 4941997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d0c63e20b86aa710b72c028cb38fef?s=128&d=identicon&r=PG&f=1", "display_name": "algebrain", "link": "https://stackoverflow.com/users/4941997/algebrain"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1432671490, "post_id": 30467647, "comment_id": 49016693, "body": "Sad. I move my code from PowerShell where I had no such restriction for binary data."}, {"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1432671569, "post_id": 30467647, "comment_id": 49016751, "body": "<a href=\"https://godoc.org/bytes#Contains\" rel=\"nofollow noreferrer\"><code>bytes.Contains</code></a> may work for you instead."}, {"owner": {"reputation": 9, "user_id": 4941997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d0c63e20b86aa710b72c028cb38fef?s=128&d=identicon&r=PG&f=1", "display_name": "algebrain", "link": "https://stackoverflow.com/users/4941997/algebrain"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1432671653, "post_id": 30467647, "comment_id": 49016791, "body": "Thanks, but  know. It is not enough."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 3, "creation_date": 1432673947, "post_id": 30467647, "comment_id": 49018182, "body": "@algebrain <i>&quot;It is not enough&quot;</i> You haven&#39;t stated your original intent. <code>bytes.Contains</code> solves the problem you stated. If you want help for your original problem, maybe you should reveal it."}, {"owner": {"reputation": 9, "user_id": 4941997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d0c63e20b86aa710b72c028cb38fef?s=128&d=identicon&r=PG&f=1", "display_name": "algebrain", "link": "https://stackoverflow.com/users/4941997/algebrain"}, "edited": false, "score": 0, "creation_date": 1432674792, "post_id": 30467647, "comment_id": 49018618, "body": "Sure, my original problem is following: I need to check many different regular expressions for non-utf8 binary samples."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1432675454, "post_id": 30467647, "comment_id": 49018930, "body": "@algebrain You could convert your input byte sequence to its hexadecimal representation (which has a valid utf-8 encoding) and define your regexp (or convert your existing ones) to operate on the hex input string."}], "answers": [{"comments": [{"owner": {"reputation": 9, "user_id": 4941997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d0c63e20b86aa710b72c028cb38fef?s=128&d=identicon&r=PG&f=1", "display_name": "algebrain", "link": "https://stackoverflow.com/users/4941997/algebrain"}, "edited": false, "score": 0, "creation_date": 1432725651, "post_id": 30472446, "comment_id": 49040532, "body": "Thanks. I think this restriction is proper in case of FindStringSubmatch, but for FindSubmatch it is strange and inconvenient."}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": false, "score": 1, "last_activity_date": 1432696010, "creation_date": 1432696010, "answer_id": 30472446, "question_id": 30467647, "link": "https://stackoverflow.com/questions/30467647/regexp-findsubmatch-with-hex-character-codes/30472446#30472446", "title": "regexp.FindSubmatch with hex character codes", "body": "<p>As mentioned <a href=\"http://golang.org/pkg/regexp/#pkg-overview\" rel=\"nofollow\">in the package documentation</a>:</p>\n\n<blockquote>\n  <p>All characters are UTF-8-encoded code points.</p>\n</blockquote>\n\n<p>So the regular expression <code>\\x80</code> does not match the byte value <code>0x80</code>, but rather the UTF-8 representation of the character <code>U+0080</code>.  This is evident if we change your test program to:</p>\n\n<pre><code>func main() {\n    assigned := regexp.MustCompile(`\\x80`)\n    group := assigned.FindSubmatch([]byte{1, 2, 3, 0xc2, 0x80})\n    fmt.Println(group)\n}\n</code></pre>\n\n<p>We now get a match for the two byte sequence <code>[[194 128]]</code>, which represents that character in question.</p>\n\n<p>There is no way to switch the <code>regexp</code> package into a binary mode, so you will either need to convert your inputs to valid UTF-8, or use a different package to match your data.</p>\n"}], "owner": {"reputation": 9, "user_id": 4941997, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/84d0c63e20b86aa710b72c028cb38fef?s=128&d=identicon&r=PG&f=1", "display_name": "algebrain", "link": "https://stackoverflow.com/users/4941997/algebrain"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 575, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432696010, "creation_date": 1432669876, "question_id": 30467647, "link": "https://stackoverflow.com/questions/30467647/regexp-findsubmatch-with-hex-character-codes", "title": "regexp.FindSubmatch with hex character codes", "body": "<p>I cannot regexp.FindSubmatch in certain simple cases. For example, following code works properly:</p>\n\n<pre><code>assigned := regexp.MustCompile(`\\x7f`)\ngroup := assigned.FindSubmatch([]byte{0x7f})\nfmt.Println(group)\n</code></pre>\n\n<p>(<a href=\"http://play.golang.org/p/RPNVwDPC74\" rel=\"nofollow\">in playground it prints [[127]]</a>)</p>\n\n<p>But if I change byte to 0x80 it <a href=\"http://play.golang.org/p/jc1Ebjpad_\" rel=\"nofollow\">does not work</a>. Why?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432650769, "post_id": 30461446, "comment_id": 49003472, "body": "Thanks - what does derefencing actually mean then?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432650941, "post_id": 30461446, "comment_id": 49003600, "body": "When you dereference a pointer, you get the value the pointer (which is an address) was pointing to. The type <code>*Profile</code> is an address of a <code>Profile</code> value. <code>*p</code>, where <code>p</code> is of type <code>*Profile</code>, will get the value."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1432650567, "creation_date": 1432650567, "answer_id": 30461446, "question_id": 30461409, "link": "https://stackoverflow.com/questions/30461409/cannot-embed-struct-in-struct/30461446#30461446", "title": "Cannot embed struct in struct", "body": "<p>Your <code>profile</code> is a pointer. Either redefine your <code>Session</code> to be</p>\n\n<pre><code>type Session struct {\n    Token  string    `json:\"token\"`\n    User   *Profile  `json:\"user\"`\n}\n</code></pre>\n\n<p>or dereference it.</p>\n\n<pre><code>session := Session{token, *profile}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 64, "favorite_count": 0, "accepted_answer_id": 30461446, "answer_count": 1, "score": 0, "last_activity_date": 1432651803, "creation_date": 1432650453, "question_id": 30461409, "link": "https://stackoverflow.com/questions/30461409/cannot-embed-struct-in-struct", "title": "Cannot embed struct in struct", "body": "<p>I have the following two structs:</p>\n\n<pre><code>type Profile struct {\n    Email        string   `json:\"email\"`\n    Username     string   `json:\"username\"`\n    Name         string   `json:\"name\"`\n    Permissions  []string `json:\"permissions\"`\n}\n\ntype Session struct {\n    Token  string   `json:\"token\"`\n    User   Profile  `json:\"user\"`\n}\n</code></pre>\n\n<p>and I'm trying to create a new <code>Session</code> using:</p>\n\n<pre><code>session := Session{token, profile}\n</code></pre>\n\n<p>where <code>token</code> is a string and profile is a <code>Profile</code> both created earlier.</p>\n\n<p>I'm getting the error <strong>cannot use profile (type *Profile) as type Profile in field value</strong> when I compile.</p>\n\n<p>Am I missing something?</p>\n"}, {"tags": ["go", "web-frameworks", "beego"], "comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432707385, "post_id": 30459311, "comment_id": 49028671, "body": "why no replies for this question. what is the problem with this.."}], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432716825, "post_id": 30477286, "comment_id": 49034318, "body": "thanks . I AM getting error: incompatible types in binary expression   fmt.Println(&quot;username:&quot; + &quot; &quot; + username)"}, {"owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432717097, "post_id": 30477286, "comment_id": 49034494, "body": "@VijayKumar <code>username := c.GetSession(&lt;key&gt;).(string)</code> Remember that golang is sensitive with type. While <code>GetSession</code> returns a type of <code>interface{}</code>, you should explicitly convert it to the type which you set into session."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 1, "creation_date": 1432717462, "post_id": 30477286, "comment_id": 49034743, "body": "i am trying it like this                                                          username := c.GetSession(userName).(string) c.Data[&quot;user&quot;] = username"}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432718895, "post_id": 30477286, "comment_id": 49035762, "body": "its giving this error now even though field name is same as i have mentioned                                                                                       error: reference to undefined name \u2018userName\u2019   username := c.GetSession(userName).(string)"}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432720581, "post_id": 30477286, "comment_id": 49037062, "body": "and when i try this                                                             username := c.GetSession(&quot;userName&quot;).(string) c.Data[&quot;user&quot;] = username                                                                                  i got this error on browsers display                                                --Handler crashed with error interface conversion: interface is nil, not string"}, {"owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432720744, "post_id": 30477286, "comment_id": 49037180, "body": "@VijayKumar Make sure that you&#39;ve set the <code>userName</code> into session by <code>c.SetSession(&quot;userName&quot;, &lt;value&gt;)</code> while doing login."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432721430, "post_id": 30477286, "comment_id": 49037638, "body": "shall i put all controller code for better undersanding."}, {"owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 1, "creation_date": 1432721764, "post_id": 30477286, "comment_id": 49037857, "body": "That would be better, login controller and the controller which you want to use <code>username</code>."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432721939, "post_id": 30477286, "comment_id": 49037974, "body": "still its the same. Can you please specify that in your answer. Field name is userName."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432722474, "post_id": 30477286, "comment_id": 49038303, "body": "can you see my updated question where i have updated my controllers."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432722641, "post_id": 30477286, "comment_id": 49038427, "body": "i want to display that username in landing page particularly in header"}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432723815, "post_id": 30477286, "comment_id": 49039253, "body": "but  no where &amp;User is defined"}, {"owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "reply_to_user": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1432729903, "post_id": 30477286, "comment_id": 49043624, "body": "well, you should change it into a simple string, <code>User</code> is a struct I define."}], "tags": [], "owner": {"reputation": 594, "user_id": 3374759, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/L5xEp.jpg?s=128&g=1", "display_name": "Jiang", "link": "https://stackoverflow.com/users/3374759/jiang"}, "is_accepted": true, "score": 1, "last_activity_date": 1432722632, "last_edit_date": 1432722632, "creation_date": 1432715977, "answer_id": 30477286, "question_id": 30459311, "link": "https://stackoverflow.com/questions/30459311/beegodisplay-logged-in-username-taken-from-input-field-of-form/30477286#30477286", "title": "Beego:Display logged in username taken from input field of form", "body": "<p>Enable <em>session</em> support in <code>app.conf</code> with:</p>\n\n<pre><code>sessionon = true\n</code></pre>\n\n<p>Save the username into session if login is valid:</p>\n\n<pre><code>func (c *LoginController) Post() {\n    var json JsonObject\n    u := &amp;User{}\n    if err := c.ParseForm(u); err != nil {\n        json = JsonObject{\n            Success: false,\n            Message: \"Server error\",\n        }\n    } else {\n        if u.Username == \"admin\" &amp;&amp; u.Password == \"123456\" {\n            json = JsonObject{\n                Success: true,\n            }\n            // successfully login, put the user into session, you may put just username in\n            c.SetSession(\"User\", u)\n        } else {\n            json = JsonObject{\n                Success: false,\n                Message: \"Incorrect username or password\",\n            }\n        }\n    }\n    c.Data[\"json\"] = json\n    c.ServeJson()\n}\n</code></pre>\n\n<p>Then you can recover the username in every <code>Controller</code>:</p>\n\n<pre><code>func (c *IndexController) Get() {\n    // get user from session, you may get just username\n    u := c.GetSession(\"User\")\n    if u == nil {\n        c.Redirect(\"/login\", 302)\n    }\n    // set user from session into response data\n    c.Data[\"User\"] = u\n    c.TplNames = \"index.html\"\n}\n</code></pre>\n\n<p>Get it on the html with template format:</p>\n\n<pre><code>{{ .User.username }}\n</code></pre>\n\n<p>You can just use <code>{{ .userName }}</code></p>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1098, "favorite_count": 0, "accepted_answer_id": 30477286, "answer_count": 1, "score": 2, "last_activity_date": 1432722632, "creation_date": 1432645202, "last_edit_date": 1432722055, "question_id": 30459311, "link": "https://stackoverflow.com/questions/30459311/beegodisplay-logged-in-username-taken-from-input-field-of-form", "title": "Beego:Display logged in username taken from input field of form", "body": "<p>I am using Beego framework for my purpose and i have two html view files one is login and other is landing\nlogin.html </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;form action=\"/commonDashboard\" name=\"loginForm\" method=\"post\" autocomplete=\"off\" id=\"loginForm\" &gt;\r\n            \t&lt;input type=\"text\" placeholder=\"Enter your user name\" id=\"userName\" name=\"userName\" taborder=\"1\"&gt;\r\n                &lt;input type=\"password\" class=\"qwerty\" placeholder=\"Enter your password\" id=\"userPassword\" name=\"userPassword\" taborder=\"2\"&gt;\r\n                &lt;input type=\"button\" value=\"Login\" onclick=\"validatelogin();\" taborder=\"3\"&gt;\r\n                &lt;input type=\"button\" value=\"Clear\" onclick=\"resetForm();\" taborder=\"3\"&gt;\r\n\t\t\t\t&lt;span class=\"forgot\"&gt;&lt;a href=\"#\"&gt;forgot password ?&lt;/a&gt;&lt;/span&gt;\r\n            &lt;!-- Virtual Keyboard --&gt;\r\n                &lt;span class=\"virtual\"&gt;&lt;a href=\"#\" id=\"passwd\" class=\"tooltip-tipsy\" title=\"Click to open the virtual keyboard\"&gt;Virtual Keyboard  \r\n\t\t\t\t&lt;/span&gt;\r\n            &lt;/form&gt;\r\n        </code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>and landing page is</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>&lt;header class=\"top\"&gt;\r\n\t&lt;div class=\"container-fluid\"&gt;\r\n    \t&lt;aside class=\"logo\"&gt;&lt;img src=\"img.jpg\"  class=\"img-responsive\"&gt;&lt;/aside&gt;\r\n        \r\n        &lt;aside class=\"top-right\"&gt;\r\n        \t&lt;div class=\"profile\"&gt;\r\n            \t&lt;ul&gt;\r\n                \t&lt;li class=\"name\"&gt;&lt;img src=\"../static/img/profile-img.jpg\" alt=\"Shri Ram\"&gt; Hi &lt;a href=\"#\"&gt;Shri&lt;/a&gt;&lt;/li&gt;\r\n                    &lt;li class=\"logout\"&gt;&lt;a href=\"/login\"&gt;Logout&lt;/a&gt;&lt;/li&gt;\r\n                    &lt;li&gt;&lt;a href=\"#\"&gt;Contacts&lt;/a&gt;&lt;/li&gt;\r\n                    &lt;li class=\"last\"&gt;&lt;a href=\"#\"&gt;Help&lt;/a&gt;&lt;/li&gt;\r\n                &lt;/ul&gt;\r\n            &lt;/div&gt;\r\n            \r\n            &lt;div class=\"login-time\"&gt;\r\n            \t&lt;ul&gt;\r\n                \t&lt;li&gt;&lt;span&gt;Current Login:&lt;/span&gt; Mon 22 Sep 2014 03:28 PM&lt;/li&gt;\r\n                    &lt;li class=\"last\"&gt;&lt;span&gt;Last Login:&lt;/span&gt; Sun 21 Sep 2014 02:28 PM&lt;/li&gt;\r\n                &lt;/ul&gt;\r\n            &lt;/div&gt;\r\n        &lt;/aside&gt;\r\n    &lt;/div&gt;\r\n&lt;/header&gt;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>and controller is as follows</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package controllers\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"github.com/astaxie/beego\"\r\n)\r\n\r\ntype MainController struct {\r\n\tbeego.Controller\r\n}\r\n\r\nfunc (c *MainController) Get() {\r\n\tc.TplNames = \"login.html\"\r\n\tfmt.Println(\"login Get Method\")\r\n}\r\n\r\ntype LoginController struct {\r\n\tbeego.Controller\r\n}\r\n\r\nfunc (c *LoginController) Post() {\r\n\tc.TplNames = \"commonDashboard.html\"\r\n\tfmt.Println(\"this is dashboard\")\r\n\tpassword := c.Input().Get(\"userPassword\")\r\n\tusername := c.GetSession(\"userName\").(string)\r\n\tc.SetSession(\"userName\", username)\r\n\tc.Data[\"user\"] = username\r\n\tfmt.Println(\"password:\" + \" \" + password)\r\n}\r\n\r\ntype HeaderController struct {\r\n\tbeego.Controller\r\n}\r\n\r\nfunc (c *HeaderController) Get() {\r\n\tfmt.Println(\"this is Header\")\r\n\tusername := c.Input().Get(\"userName\")\r\n\tfmt.Println(username)\r\n\tc.TplNames = \"commonHeader.html\"\r\n}\r\n\r\ntype FooterController struct {\r\n\tbeego.Controller\r\n}\r\n\r\nfunc (c *FooterController) Get() {\r\n\tfmt.Println(\"this is footer\")\r\n\tc.TplNames = \"commonFooter.html\"\r\n}\r\n\r\ntype MenuController struct {\r\n\tbeego.Controller\r\n}\r\n\r\nfunc (c *MenuController) Get() {\r\n\tfmt.Println(\"this is menu\")\r\n\tc.TplNames = \"commonMenu.html\"\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>i want to display the currently logged in username in header of html file </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432660461, "post_id": 30455537, "comment_id": 49010194, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/28406122/using-binary-packages-directly-golang\">Using binary packages directly - Golang</a>"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1432636598, "last_edit_date": 1432636598, "creation_date": 1432635416, "answer_id": 30455687, "question_id": 30455537, "link": "https://stackoverflow.com/questions/30455537/how-to-use-distribute-a-binary-package-without-go-source-code/30455687#30455687", "title": "How to use/distribute a binary package without Go source code", "body": "<p>You put your compiled package into the wrong folder.</p>\n\n<p>The <code>pkg</code> folder of your Go workspace contains compiled package objects organized into subfolders based on the target architecture they are compiled to, for example <code>linux_amd64</code> or <code>windows_amd64</code>. Inside that the path of the parent package follows, and the direct parent folder is the place to put the compiled package object into.</p>\n\n<p>Check where <code>go install</code> puts your package object, and mirror that folder structure.</p>\n\n<p>So for example if your package is <code>path/to/parent/package/abc</code> and you compile to linux 64-bit, you should put its compiled package file into a folder like:</p>\n\n<pre><code>myworkspace/pkg/linux_amd64/path/to/parent/package/abc.a\n</code></pre>\n\n<p>or in case of Windows 64-bit:</p>\n\n<pre><code>myworkspace/pkg/windows_amd64/path/to/parent/package/abc.a\n</code></pre>\n\n<p>This page gives you more details: <a href=\"http://golang.org/doc/code.html\" rel=\"nofollow\">How to Write Go Code</a></p>\n\n<p><strong>Notes:</strong></p>\n\n<p>By doing this you will limit the possible targets to compile your app to, as a compiled package object is only for a specific platform. The preferred way to distribute your packages in Go is in source code form.</p>\n"}], "owner": {"reputation": 51, "user_id": 4939965, "user_type": "registered", "profile_image": "https://graph.facebook.com/10152842383186905/picture?type=large", "display_name": "Bryan Toh", "link": "https://stackoverflow.com/users/4939965/bryan-toh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 844, "favorite_count": 1, "answer_count": 1, "score": 5, "last_activity_date": 1432661007, "creation_date": 1432635027, "last_edit_date": 1432661007, "question_id": 30455537, "link": "https://stackoverflow.com/questions/30455537/how-to-use-distribute-a-binary-package-without-go-source-code", "title": "How to use/distribute a binary package without Go source code", "body": "<p>Basically my folder structure is as below:</p>\n\n<pre><code>bin/               \npkg/\n    linux_amd64/         \n        github.com/user/\n            stringutil.a  \nsrc/\n    github.com/user/\n        hello/\n            hello.go   (main file)  \n        stringutil/\n            stringutil.go\n</code></pre>\n\n<p><code>hello.go</code> is the main program that imports some function from <code>stringutil.go</code>.</p>\n\n<p>After running <code>go install</code>, <code>stringutil.a</code> is created under <code>pkg</code> (as above).</p>\n\n<p>My question is, can I run <code>go install</code> again without <code>stringutil.go</code> source since I already have <code>stringutil.a</code>?</p>\n\n<p>I'm a Java programmer and new to Go. Usually in Java, during compilation, we can import the compiled jar file to the classpath and do compilation.</p>\n\n<p>How can I do the same thing in Go? If I have a compiled package, <code>stringutil.a</code>, how can I distribute this file to someone and let them use it without exposing the original source code?</p>\n"}, {"tags": ["ssh", "go", "websocket"], "comments": [{"owner": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1432726525, "post_id": 30452901, "comment_id": 49041148, "body": "Yes - for a browser-based client."}], "answers": [{"comments": [{"owner": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "edited": false, "score": 0, "creation_date": 1432726639, "post_id": 30459384, "comment_id": 49041232, "body": "Thanks - I do need to forward it to a remote browser-based client though - which is where I&#39;m getting stuck. Executing a single command is a good start, but ideally I&#39;d like to forward for an interactive session."}, {"owner": {"reputation": 1877, "user_id": 382700, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/2752422e98586f8451b6bf22c3af4a18?s=128&d=identicon&r=PG", "display_name": "Gurjeet Singh", "link": "https://stackoverflow.com/users/382700/gurjeet-singh"}, "edited": false, "score": 0, "creation_date": 1481943398, "post_id": 30459384, "comment_id": 69589757, "body": "For posterity: GoTTY project allows you to run a command on remote server and allows you to see the terminal session from a web browser. You may use command-line utility gotty-client instead of a browser, since that uses websockets to talk to GoTTY server."}], "tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": false, "score": 1, "last_activity_date": 1432645374, "creation_date": 1432645374, "answer_id": 30459384, "question_id": 30452901, "link": "https://stackoverflow.com/questions/30452901/golang-forward-ssh-over-websocket/30459384#30459384", "title": "Golang: forward ssh over websocket", "body": "<p>If you want to use SSH for a remote shell session you should not use the websocket package but the <a href=\"http://golang.org/x/crypto/ssh\" rel=\"nofollow\">golang.org/x/crypto/ssh</a> package. There is an  excellent example at <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Dial\" rel=\"nofollow\">godoc.org</a> which I repeat here:</p>\n\n<pre><code>// An SSH client is represented with a ClientConn. Currently only\n// the \"password\" authentication method is supported.\n//\n// To authenticate with the remote server you must pass at least one\n// implementation of AuthMethod via the Auth field in ClientConfig.\nconfig := &amp;ssh.ClientConfig{\n    User: \"username\",\n    Auth: []ssh.AuthMethod{\n        ssh.Password(\"yourpassword\"),\n    },\n}\nclient, err := ssh.Dial(\"tcp\", \"yourserver.com:22\", config)\nif err != nil {\n    panic(\"Failed to dial: \" + err.Error())\n}\n\n// Each ClientConn can support multiple interactive sessions,\n// represented by a Session.\nsession, err := client.NewSession()\nif err != nil {\n    panic(\"Failed to create session: \" + err.Error())\n}\ndefer session.Close()\n\n// Once a Session is created, you can execute a single command on\n// the remote side using the Run method.\nvar b bytes.Buffer\nsession.Stdout = &amp;b\nif err := session.Run(\"/usr/bin/whoami\"); err != nil {\n    panic(\"Failed to run: \" + err.Error())\n}\nfmt.Println(b.String())\n</code></pre>\n\n<p>You probably want to use the fields of the <code>ssh.Session</code> struct instead of using <code>StdoutPipe()</code>.</p>\n\n<pre><code>type Session struct {\n    Stdin io.Reader\n    Stdout io.Writer\n    Stderr io.Writer\n}\n</code></pre>\n\n<p>The line in the example <code>session.Stdout = &amp;b</code> means that the stdout from the remote process will be written to <code>b</code>. Likewise, you can assign any <code>io.Reader</code> to <code>session.Stdin</code> which will be read as stdin by the remote process. The detailed behavior of <code>ssh.Session</code> can be found at <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session\" rel=\"nofollow\">godoc.org</a></p>\n"}, {"comments": [{"owner": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "edited": false, "score": 0, "creation_date": 1432726546, "post_id": 30459818, "comment_id": 49041164, "body": "I tried using the Gorilla websocket implementation and get an error: <code>cannot use wsConn (type *websocket.Conn) as type io.Reader in argument to io.Copy: \t*websocket.Conn does not implement io.Reader (missing Read method) and  cannot use wsConn (type *websocket.Conn) as type io.Writer in argument to io.Copy: \t*websocket.Conn does not implement io.Writer (missing Write method) \t\thave websocket.write(int, time.Time, ...[]byte) error \t\twant Write([]byte) (int, error)</code>  I&#39;m trying using NextReader() and NextWriter() but no luck so far."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "edited": false, "score": 0, "creation_date": 1432728039, "post_id": 30459818, "comment_id": 49042303, "body": "You should look at golang.org/x/net/websocket instead. But you can also wrap the gorilla version in your own type and then add Read and Write methods to it."}, {"owner": {"reputation": 1092, "user_id": 95765, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/44dc98a7f91886e6cf5a746ba7c73f82?s=128&d=identicon&r=PG", "display_name": "John", "link": "https://stackoverflow.com/users/95765/john"}, "reply_to_user": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "edited": false, "score": 0, "creation_date": 1528494824, "post_id": 30459818, "comment_id": 88545136, "body": "@SimonKnight Any luck using the Gorilla websocket library?"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 1, "last_activity_date": 1432646443, "creation_date": 1432646443, "answer_id": 30459818, "question_id": 30452901, "link": "https://stackoverflow.com/questions/30452901/golang-forward-ssh-over-websocket/30459818#30459818", "title": "Golang: forward ssh over websocket", "body": "<p>A <code>websocket.Conn</code> is a <code>ReadWriter</code>, so it can be both the source and destination for <code>io.Copy</code>. Both <code>Cmd.StdoutPipe</code> and <code>Session.StdoutPipe</code> are <code>io.Reader</code> and the <code>Stdin</code> versions are <code>io.Writer</code>. So everything should glue together just fine. You just have to copy in both directions.</p>\n\n<pre><code>go io.Copy(targetStdin, wsconn)\nio.Copy(wsconn, targetStdout)\n</code></pre>\n"}], "owner": {"reputation": 430, "user_id": 189795, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cd77b2ab2e12ba051d78fddd7e2e3e52?s=128&d=identicon&r=PG", "display_name": "Simon Knight", "link": "https://stackoverflow.com/users/189795/simon-knight"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3116, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1432646443, "creation_date": 1432627562, "question_id": 30452901, "link": "https://stackoverflow.com/questions/30452901/golang-forward-ssh-over-websocket", "title": "Golang: forward ssh over websocket", "body": "<p>I've been able to forward telnet over a websocket using golang, using something like</p>\n\n<pre><code>func forwardtcp(wsconn *websocket.Conn, conn *telnet.Conn) {\n    connbuf := bufio.NewReader(conn)\n    tcpbuffer := make([]byte, 128)\n\n    for {\n        n, err := connbuf.Read(tcpbuffer)\n\n        if err != nil {\n            log.Println(\"TCP Read failed\")\n            break\n        }\n        if err == nil {\n            wsconn.WriteMessage(websocket.BinaryMessage, tcpbuffer[:n])\n        }\n    }\n}\n</code></pre>\n\n<p>However I'm unable to do similar with an SSH or shell session. I'm not understanding a fundamental concept with the using the </p>\n\n<pre><code>targetStdout, _ := session.StdoutPipe()\ntargetStdin, _ := session.StdinPipe()\n</code></pre>\n\n<p>pieces.</p>\n\n<p>I am able to use io.Copy, but not sure how to format these into a datagram that can be sent with the websocket connection.</p>\n\n<p>Is it possible to treat the targetStdin and targetStdout pipes in a manner that they can be read and written to with bytes, such as those received from the websocket connection?\nOr is there a better approach to get io from the SSH connection?</p>\n"}, {"tags": ["dictionary", "go", "set"], "comments": [{"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 1, "creation_date": 1432626606, "post_id": 30452433, "comment_id": 48986076, "body": "Also see <a href=\"http://stackoverflow.com/questions/15323767/how-to-if-x-in-array-in-golang\">http://stackoverflow.com/questions/15323767/how-to-if-x-in-a&zwnj;&#8203;rray-in-golang</a>"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432627424, "post_id": 30452433, "comment_id": 48986571, "body": "any reason why it was not closed as a duplicate?"}], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1432654497, "post_id": 30452518, "comment_id": 49006327, "body": "For large sets, using a map[string]struct{} instead of a map[string]bool might save space because the empty struct occupies zero space. Testing for existence needs to use the two-value form <code>_, exists := valid[x]</code>. Create the map in the first place using empty struct literals <code>{}</code> instead of the bool <code>true</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1471847403, "last_edit_date": 1471847403, "creation_date": 1432626304, "answer_id": 30452518, "question_id": 30452433, "link": "https://stackoverflow.com/questions/30452433/check-if-a-value-is-in-a-list/30452518#30452518", "title": "Check if a value is in a list", "body": "<p>You can use a <code>map[string]bool</code> as a set. When testing and a key is not in the map, the zero value for <code>bool</code> is returned which is <code>false</code>.</p>\n\n<p>So fill the map with the valid values as keys and <code>true</code> as value. If a tested key-value is in the map, its stored <code>true</code> value will be the result. If a tested key-value is not in the map, the zero value for the value type is returned which is <code>false</code>.</p>\n\n<p>Using this, the test becomes this simple:</p>\n\n<pre><code>valid := map[string]bool{\"red\": true, \"green\": true, \"yellow\": true, \"blue\": true}\n\nif valid[x] {\n    fmt.Println(\"found\")\n} else {\n    fmt.Println(\"not found\")\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/wBV4ZnBzEH\" rel=\"noreferrer\">Go Playground</a> (with the variants mentioned below).</p>\n\n<p>This is mentioned in the blog post: <a href=\"https://blog.golang.org/go-maps-in-action#TOC_4.\" rel=\"noreferrer\"><strong>Go maps in action: Exploiting zero values</strong></a></p>\n\n<p><strong>Note:</strong></p>\n\n<p>If you have many valid values, since all the values to be stored in the map are <code>true</code>, it may be more compact to use a slice to list the valid values and use a <code>for range</code> loop to initialize your map, something like this:</p>\n\n<pre><code>for _, v := range []string{\"red\", \"green\", \"yellow\", \"blue\"} {\n    valid[v] = true\n}\n</code></pre>\n\n<p><strong>Note #2:</strong></p>\n\n<p>If you don't want to go with the <code>for range</code> loop initialization, you can still optimize it a little by creating an untyped (or <code>bool</code>-typed) one-letter <code>const</code>:</p>\n\n<pre><code>const t = true\nvalid := map[string]bool{\"red\": t, \"green\": t, \"yellow\": t, \"blue\": t}\n</code></pre>\n"}], "owner": {"reputation": 7466, "user_id": 288424, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cf91d37f026ddaccc28c9907b567ab13?s=128&d=identicon&r=PG&f=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/288424/neil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10531, "favorite_count": 1, "accepted_answer_id": 30452518, "answer_count": 1, "score": 7, "last_activity_date": 1535011977, "creation_date": 1432626081, "last_edit_date": 1535011977, "question_id": 30452433, "link": "https://stackoverflow.com/questions/30452433/check-if-a-value-is-in-a-list", "title": "Check if a value is in a list", "body": "<p>Does Go have something similar to Python's <code>in</code> keyword? I want to check if a value is in a list.</p>\n\n<p>For example in Python:</p>\n\n<pre><code>x = 'red'\n\nif x in ['red', 'green', 'yellow', 'blue']:\n    print \"found\"\nelse:\n    print \"not found\"\n</code></pre>\n\n<p>In Go I've come up with using the set idiom but I don't think it's ideal as I have to specify a int value that I'm not using.</p>\n\n<pre><code>x := \"red\"\n\nvalid := map[string]int{\"red\": 0, \"green\": 0,\"yellow\": 0, \"blue\": 0}\n\nif _, ok := valid[x]; ok {\n    fmt.Println(\"found\")\n} else {\n    fmt.Println(\"not found\")\n}\n</code></pre>\n\n<p>I understand having an <code>in</code> keyword is probably related to generics. Is there a way to do this using go generate or something?</p>\n"}, {"tags": ["email", "go", "smtp", "smtp-auth"], "answers": [{"comments": [{"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1432621369, "post_id": 30450522, "comment_id": 48983055, "body": "Thanks... at what point does the connection reset for sending another email? Do I use <code>client.Quit()</code> at the end of each message or at the end of sending all messages?"}, {"owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "reply_to_user": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1432651687, "post_id": 30450522, "comment_id": 49004204, "body": "quit means &quot;I am done and ready to disconnect.&quot; Only send it at the end of all messages."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1432658926, "post_id": 30450522, "comment_id": 49009293, "body": "No need for step one (opening a <code>net.Conn</code> yourself). You can just use <code>smtp.Dial</code>. Basically, just do almost exactly what <code>smtp.SendMail</code> does except that before calling <code>Quit</code> loop back and do more <code>Mail</code>, <code>Rcpt</code>, and <code>Data</code> calls."}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1432709754, "post_id": 30450522, "comment_id": 49029966, "body": "In this case then, I will never run Quit() or Close() since the Go webapp remains dialed into the SMTP server at all times. Will the connection automatically terminate when the Go app exits?"}, {"owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "edited": false, "score": 0, "creation_date": 1432710253, "post_id": 30450522, "comment_id": 49030256, "body": "It worked! Thanks a lot. I put the Quit and Close as deferred in the goroutine that waits on the channels anyway. So when the goroutine is terminated then it will close the connection."}, {"owner": {"reputation": 5383, "user_id": 961092, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8b2d47d99e6af64b89e6a0721e3485eb?s=128&d=identicon&r=PG", "display_name": "Dmitry Verhoturov", "link": "https://stackoverflow.com/users/961092/dmitry-verhoturov"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1576052458, "post_id": 30450522, "comment_id": 104769076, "body": "@DaveC I think you are not correct. In case something goes wrong within any call, not calling <code>Quit</code> and <code>Dial</code> again will leave you with errors like on every message after the faulty one (in case of an error happening after first <code>Mail</code> call, in <code>Rcpt</code> or <code>Data</code>, every next message will fail on <code>Mail</code> call with error  <code>503 Only one sender per message, please</code> for example)."}], "tags": [], "owner": {"reputation": 19300, "user_id": 121660, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/39396b815c9a804b8b99000ee9ea50e8?s=128&d=identicon&r=PG", "display_name": "captncraig", "link": "https://stackoverflow.com/users/121660/captncraig"}, "is_accepted": true, "score": 7, "last_activity_date": 1432738677, "last_edit_date": 1432738677, "creation_date": 1432619817, "answer_id": 30450522, "question_id": 30450221, "link": "https://stackoverflow.com/questions/30450221/go-connect-to-smtp-server-and-send-multiple-emails-in-one-connection/30450522#30450522", "title": "Go: Connect to SMTP server and send multiple emails in one connection?", "body": "<p>You are correct that <code>smtp.SendMail</code> does not provide a way to reuse the connection. </p>\n\n<p>If you want that fine grained control, you should use a persistent client connection. This will require knowing a bit more about the smtp commands and protocol.</p>\n\n<ol>\n<li>Use <code>smtp.Dial</code> to open a connection and create a client object.</li>\n<li>Use <code>client.Hello</code>, <code>client.Auth</code>, and <code>client.StartTLS</code> as appropriate.</li>\n<li>Use <code>Rcpt</code>, <code>Mail</code>, <code>Data</code> as approprate to send messages.</li>\n<li><code>client.Quit()</code> and close connection when you are all done.</li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 1664, "user_id": 1306228, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1e732e5ac9820eeb35a70276cf6c05f7?s=128&d=identicon&r=PG", "display_name": "Ale", "link": "https://stackoverflow.com/users/1306228/ale"}, "is_accepted": false, "score": 3, "last_activity_date": 1441196370, "creation_date": 1441196370, "answer_id": 32352964, "question_id": 30450221, "link": "https://stackoverflow.com/questions/30450221/go-connect-to-smtp-server-and-send-multiple-emails-in-one-connection/32352964#32352964", "title": "Go: Connect to SMTP server and send multiple emails in one connection?", "body": "<p>Gomail v2 now supports sending multiple emails in one connection. The <a href=\"https://godoc.org/gopkg.in/gomail.v2#example-package--Daemon\" rel=\"nofollow\">Daemon example</a> from the documentation seems to match your use case:</p>\n\n<pre><code>ch := make(chan *gomail.Message)\n\ngo func() {\n    d := gomail.NewPlainDialer(\"smtp.example.com\", 587, \"user\", \"123456\")\n\n    var s gomail.SendCloser\n    var err error\n    open := false\n    for {\n        select {\n        case m, ok := &lt;-ch:\n            if !ok {\n                return\n            }\n            if !open {\n                if s, err = d.Dial(); err != nil {\n                    panic(err)\n                }\n                open = true\n            }\n            if err := gomail.Send(s, m); err != nil {\n                log.Print(err)\n            }\n        // Close the connection to the SMTP server if no email was sent in\n        // the last 30 seconds.\n        case &lt;-time.After(30 * time.Second):\n            if open {\n                if err := s.Close(); err != nil {\n                    panic(err)\n                }\n                open = false\n            }\n        }\n    }\n}()\n\n// Use the channel in your program to send emails.\n\n// Close the channel to stop the mail daemon.\nclose(ch)\n</code></pre>\n"}], "owner": {"reputation": 11711, "user_id": 1018582, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/d18789a2f20eee6dfe637fef8bd7ebf5?s=128&d=identicon&r=PG", "display_name": "Alasdair", "link": "https://stackoverflow.com/users/1018582/alasdair"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3631, "favorite_count": 3, "accepted_answer_id": 30450522, "answer_count": 2, "score": 7, "last_activity_date": 1441196370, "creation_date": 1432618508, "question_id": 30450221, "link": "https://stackoverflow.com/questions/30450221/go-connect-to-smtp-server-and-send-multiple-emails-in-one-connection", "title": "Go: Connect to SMTP server and send multiple emails in one connection?", "body": "<p>I'm writing a package which I intend to make one initial connection to the local SMTP server and then it waits on a channel which will be populated with emails to send when they are needed to be sent.</p>\n\n<p>Looking at net/http it appears to be expecting that the SMTP server should be dialed into and authenticated each time an email is to be sent. Surely I can dial and authenticate once, keep the connection open and just add new emails as they come?</p>\n\n<p>Looking at the source for <code>smtp.SendMail</code>, I don't see how this can be done, as there does not appear to be a way to recycle the <code>*Client</code>:\n<a href=\"http://golang.org/src/net/smtp/smtp.go?s=7610:7688#L263\" rel=\"noreferrer\">http://golang.org/src/net/smtp/smtp.go?s=7610:7688#L263</a></p>\n\n<p>There is a <code>Reset</code> function for <code>*Client</code>, but the description for that is:</p>\n\n<pre><code> Reset sends the RSET command to the server, aborting the current mail transaction.\n</code></pre>\n\n<p>I don't want to abort the current mail transaction, I want to have multiple mail transactions.</p>\n\n<p>How can I keep the connection to the SMTP server open and send multiple emails on that one connection?</p>\n"}, {"tags": ["pointers", "go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 4208576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12a6195f71817b4add6fb0208772c188?s=128&d=identicon&r=PG&f=1", "display_name": "Chloe", "link": "https://stackoverflow.com/users/4208576/chloe"}, "edited": false, "score": 0, "creation_date": 1432612566, "post_id": 30448627, "comment_id": 48979938, "body": "Thank you--this explains it."}], "tags": [], "owner": {"reputation": 3753, "user_id": 451641, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/811b28e7b085e2e493fd32c5913a1ae8?s=128&d=identicon&r=PG", "display_name": "Frederik Deweerdt", "link": "https://stackoverflow.com/users/451641/frederik-deweerdt"}, "is_accepted": true, "score": 5, "last_activity_date": 1432608420, "creation_date": 1432608420, "answer_id": 30448627, "question_id": 30448483, "link": "https://stackoverflow.com/questions/30448483/how-does-this-go-code-set-the-value-of-an-object-through-a-pointer-without-dere/30448627#30448627", "title": "How does this Go code set the value of an object through a pointer, without dereferencing?", "body": "<p>In go, the compiler automatically converts the expression to <code>(*p).X</code>. From the the <a href=\"http://golang.org/ref/spec#Selectors\">language spec</a>:</p>\n\n<blockquote>\n  <p>if the type of x is a named pointer type and (*x).f is a valid\n  selector expression denoting a field (but not a method), x.f is\n  shorthand for (*x).f.</p>\n</blockquote>\n"}], "owner": {"reputation": 43, "user_id": 4208576, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/12a6195f71817b4add6fb0208772c188?s=128&d=identicon&r=PG&f=1", "display_name": "Chloe", "link": "https://stackoverflow.com/users/4208576/chloe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 58, "favorite_count": 0, "accepted_answer_id": 30448627, "answer_count": 1, "score": 2, "last_activity_date": 1432608420, "creation_date": 1432607225, "question_id": 30448483, "link": "https://stackoverflow.com/questions/30448483/how-does-this-go-code-set-the-value-of-an-object-through-a-pointer-without-dere", "title": "How does this Go code set the value of an object through a pointer, without dereferencing?", "body": "<p>I'm learning Go from a Java/Python background, and am confused by this code from the Go tutorial. In the following code, the line</p>\n\n<pre><code>p.X = 1e9\n</code></pre>\n\n<p>sets the value of v.X to 1e9 using pointer p. <strong>As p is merely a pointer to v, isn't dereferencing necessary to set v's value?</strong> Thus the correct statement would be:</p>\n\n<pre><code>*p.X = 1e9 \n</code></pre>\n\n<p>Naturally, this results in an error. Can someone explain why the Go example code works as it is?</p>\n\n<p>Code in question:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype Vertex struct {\n    X int\n    Y int\n}\n\nfunc main() {\n    v := Vertex{1, 2}\n    p := &amp;v\n    p.X = 1e9\n    fmt.Println(v)\n}\n</code></pre>\n"}, {"tags": ["go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 538, "user_id": 939496, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d632962562a7a605c9ee55eac4daf608?s=128&d=identicon&r=PG&f=1", "display_name": "Pedro Muniz", "link": "https://stackoverflow.com/users/939496/pedro-muniz"}, "is_accepted": false, "score": 0, "last_activity_date": 1447416637, "creation_date": 1447416637, "answer_id": 33692473, "question_id": 30447088, "link": "https://stackoverflow.com/questions/30447088/how-to-use-beegos-localize/33692473#33692473", "title": "How to use beego&#39;s localize?", "body": "<p>The best way I found was that:</p>\n\n<ol>\n<li>Create translation files inside conf/ folder</li>\n<li><p>Configure your translation list at conf/app.conf. My languages are en-US and pt-BR</p>\n\n<pre><code>lang_types = \"en-US|pt-BR\"\n</code></pre></li>\n<li><p>Create file baseController.go inside controller/baseController/ folder\nwith this code</p>\n\n<pre><code>package controllers\nimport (\n      \"github.com/astaxie/beego\"\n      \"github.com/beego/i18n\"\n      \"strings\"\n)\nvar langTypes []string // Languages that are supported.\n// baseController represents base router for all other app routers.\n// It implemented some methods for the same implementation;\n// thus, it will be embedded into other routers.\ntype BaseController struct {\n    beego.Controller // Embed struct that has stub implementation of the                     interface.\n    i18n.Locale      // For i18n usage when process data and render template.\n}\n\nfunc init() {\n    beego.AddFuncMap(\"i18n\", i18n.Tr)\n\n    // Initialize language type list.\n    langTypes = strings.Split(beego.AppConfig.String(\"lang_types\"), \"|\")\n\n    // Load locale files according to language types.\n    for _, lang := range langTypes {\n        beego.Trace(\"Loading language: \" + lang)\n        if err := i18n.SetMessage(lang, \"conf/\"+\"locale_\"+lang+\".ini\"); err != nil {\n            beego.Error(\"Fail to set message file:\", err)\n            return\n        }\n    }\n}\n\n// Prepare implemented Prepare() method for baseController.\n// It's used for language option check and setting.\nfunc (this *BaseController) Prepare() {\n    // Reset language option.\n    this.Lang = \"\" // This field is from i18n.Locale.\n    beego.Trace(\"running prepare\")\n    // 1. Get language information from 'Accept-Language'.\n    al := this.Ctx.Request.Header.Get(\"Accept-Language\")\n    if len(al) &gt; 4 {\n        al = al[:5] // Only compare first 5 letters.\n        if i18n.IsExist(al) {\n            this.Lang = al\n        }\n    }\n\n    beego.Trace(\"Accept-Language is \" + al)\n    // 2. Default language is English.\n    if len(this.Lang) == 0 {\n        this.Lang = \"en-US\"\n    }\n\n    // Set template level language option.\n    this.Data[\"Lang\"] = this.Lang\n}\n</code></pre></li>\n<li><p>Use your custom BaseController in other controller.</p>\n\n<pre><code>package controllers\n\nimport (\n    bc \"github.com/myFirstApp/controllers/baseController\"\n)\n\ntype LoginController struct {\n    bc.BaseController\n}\n\nfunc (c *LoginController) Get() {\n    c.TplNames = \"login.tpl\"\n}\n</code></pre></li>\n<li><p>Use i18n in templates</p>\n\n<pre><code>{{i18n .Lang \"login.capitalized\"}}\n</code></pre></li>\n</ol>\n\n<p>My locale_en-US.ini</p>\n\n<pre><code>    login = login\n    [login]\n    uppercase = LOGIN\n    capitalized = Login\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 556, "user_id": 2645856, "user_type": "registered", "accept_rate": 17, "profile_image": "https://i.stack.imgur.com/s3W1B.gif?s=128&g=1", "display_name": "wawa", "link": "https://stackoverflow.com/users/2645856/wawa"}, "is_accepted": false, "score": 0, "last_activity_date": 1452767988, "last_edit_date": 1452767988, "creation_date": 1452763851, "answer_id": 34785910, "question_id": 30447088, "link": "https://stackoverflow.com/questions/30447088/how-to-use-beegos-localize/34785910#34785910", "title": "How to use beego&#39;s localize?", "body": "<pre><code>package controllers\n\nimport (\n    \"github.com/astaxie/beego\"\n    \"github.com/beego/i18n\"\n    \"os\"\n    \"strings\"\n)\n\ntype BaseController struct {\n    beego.Controller\n}\n\nfunc (b *BaseController) settingLocales() {\n    // load locales with locale_LANG.ini files\n    langs := \"en-US|zh-CN\"\n    for _, lang := range strings.Split(langs, \"|\") {\n        lang = strings.TrimSpace(lang)\n        files := []string{\"conf/\" + \"locale_\" + lang + \".ini\"}\n        if fh, err := os.Open(files[0]); err == nil {\n            fh.Close()\n        } else {\n            files = nil\n        }\n        if err := i18n.SetMessage(lang, \"conf/\"+\"locale_\"+lang+\".ini\", files...); err != nil {\n            beego.Error(\"Fail to set message file: \" + err.Error())\n            os.Exit(2)\n        }\n    }\n    Las := i18n.ListLangs()\n    beego.Debug(\"langs:\", Las)\n}\n\nfunc (b *BaseController) Get() {\n    b.settingLocales()\n    if i18n.IsExist(\"en-US\") {\n        b.Data[\"json\"] = i18n.Tr(\"en-US\", \"hi\")\n    } else {\n        b.Data[\"json\"] = s\n    }\n    b.ServeJson()\n}\n</code></pre>\n\n<p>create file locale_en-US.ini and locale_zh-CN.ini in conf/</p>\n\n<p>in locale_en-US.ini like:</p>\n\n<pre><code>hi = hello\nbye = goodbye\n</code></pre>\n"}], "owner": {"reputation": 314, "user_id": 1321456, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/4bd54ccbccbb1bb894075339e4f3a42f?s=128&d=identicon&r=PG", "display_name": "shinriyo", "link": "https://stackoverflow.com/users/1321456/shinriyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 883, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1551715626, "creation_date": 1432595038, "last_edit_date": 1432596687, "question_id": 30447088, "link": "https://stackoverflow.com/questions/30447088/how-to-use-beegos-localize", "title": "How to use beego&#39;s localize?", "body": "<p>I tried to use i18n but it can't work\ni18n is below.\n<a href=\"http://beego.me/docs/module/i18n.md\" rel=\"nofollow\">http://beego.me/docs/module/i18n.md</a></p>\n\n<p>routers/init.go:</p>\n\n<pre><code>// Initialized language type list.\nlangs := strings.Split(models.Cfg.MustValue(\"lang\", \"types\"), \"|\")\nnames := strings.Split(models.Cfg.MustValue(\"lang\", \"names\"), \"|\")\nlangTypes = make([]*langType, 0, len(langs))\nfor i, v := range langs {\n    langTypes = append(langTypes, &amp;langType{\n        Lang: v,\n        Name: names[i],\n    })\n}\n\nfor _, lang := range langs {\n    beego.Trace(\"Loading language: \" + lang)\n    if err := i18n.SetMessage(lang, \"conf/\"+\"locale_\"+lang+\".ini\"); err != nil {\n        beego.Error(\"Fail to set message file: \" + err.Error())\n        return\n    }\n}\n</code></pre>\n\n<p>routers/router.go</p>\n\n<pre><code>// Initialized language type list.\nlangs := strings.Split(models.Cfg.MustValue(\"lang\", \"types\"), \"|\")\nnames := strings.Split(models.Cfg.MustValue(\"lang\", \"names\"), \"|\")\nlangTypes = make([]*langType, 0, len(langs))\nfor i, v := range langs {\n    langTypes = append(langTypes, &amp;langType{\n        Lang: v,\n        Name: names[i],\n    })\n}\n\nfor _, lang := range langs {\n    beego.Trace(\"Loading language: \" + lang)\n    if err := i18n.SetMessage(lang, \"conf/\"+\"locale_\"+lang+\".ini\"); err != nil {\n        beego.Error(\"Fail to set message file: \" + err.Error())\n        return\n    }\n}\n</code></pre>\n\n<p>I just copied and paste.</p>\n\n<p>It is my full code.\n<a href=\"https://github.com/shinriyo/sample_i18n\" rel=\"nofollow\">https://github.com/shinriyo/sample_i18n</a></p>\n\n<p>I'd like to know minimum code.</p>\n\n<p>it is error</p>\n\n<pre><code>bee run\n2015/05/24 17:48:56 [INFO] Uses 'sample_i18n' as 'appname'\n2015/05/24 17:48:56 [INFO] Initializing watcher...\n2015/05/24 17:48:56 [TRAC] Directory(/Users/shinriyo/src/sample_i18n/controllers)\n2015/05/24 17:48:56 [TRAC] Directory(/Users/shinriyo/src/sample_i18n)\n2015/05/24 17:48:56 [TRAC] Directory(/Users/shinriyo/src/sample_i18n/routers)\n2015/05/24 17:48:56 [TRAC] Directory(/Users/shinriyo/src/sample_i18n/tests)\n2015/05/24 17:48:56 [INFO] Start building...\nmain.go:4:2:\nrouters/init.go:2:1: expected 'package', found 'IDENT' langs\n2015/05/24 17:48:56 [ERRO] ============== Build failed ===================\n</code></pre>\n"}, {"tags": ["function", "go"], "comments": [{"owner": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "edited": false, "score": 0, "creation_date": 1432595572, "post_id": 30447073, "comment_id": 48976147, "body": "What do you mean by &quot;I tried to mirror the <code>Mail</code> struct &quot;?"}, {"owner": {"reputation": 165, "user_id": 4891517, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/71e2a6293b83f5da7fd6709b50444880?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Morks", "link": "https://stackoverflow.com/users/4891517/karsten-morks"}, "reply_to_user": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "edited": false, "score": 0, "creation_date": 1432595701, "post_id": 30447073, "comment_id": 48976175, "body": "The called function lives in another module, so I basically did there: <code>type mailConfig struct { \tfrom string \tto string \tpassword string }</code>"}], "answers": [{"tags": [], "owner": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "is_accepted": true, "score": 0, "last_activity_date": 1432597413, "creation_date": 1432597413, "answer_id": 30447372, "question_id": 30447073, "link": "https://stackoverflow.com/questions/30447073/golang-pass-struct-as-argument-to-function/30447372#30447372", "title": "Golang - pass struct as argument to function", "body": "<p><code>utils.mailConfig</code> fields should be exported, as in the literal struct field in <code>Config</code> type.</p>\n\n<pre><code>type mailConfig struct {\n    From     string\n    To       string\n    Password string\n}\n</code></pre>\n\n<p>I suggest declaring inner structs as types themselves instead of using struct literals.</p>\n\n<pre><code>type Mail struct {\n    From     string\n    To       string\n    Password string\n}\n\ntype Summary struct {\n    Send     bool\n    Interval int\n}\n\ntype Config struct {\n    Mail\n    Summary\n}\n\nfunc StartNewMailer(Mail mailConfig)\n</code></pre>\n"}], "owner": {"reputation": 165, "user_id": 4891517, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/71e2a6293b83f5da7fd6709b50444880?s=128&d=identicon&r=PG&f=1", "display_name": "Karsten Morks", "link": "https://stackoverflow.com/users/4891517/karsten-morks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3269, "favorite_count": 0, "accepted_answer_id": 30447372, "answer_count": 1, "score": 1, "last_activity_date": 1432597413, "creation_date": 1432594920, "last_edit_date": 1432595022, "question_id": 30447073, "link": "https://stackoverflow.com/questions/30447073/golang-pass-struct-as-argument-to-function", "title": "Golang - pass struct as argument to function", "body": "<p>I have to parse some nested JSON, which translates into a Go type, like this:  </p>\n\n<pre><code>type Config struct {\nMail           struct {\n                   From     string\n                   To       string\n                   Password string\n               }\nSummary        struct {\n                   Send     bool\n                   Interval int\n               }\n}\n</code></pre>\n\n<p>Now I want to call a function for each key (Mail, Summary), I tried it like this: \n<code>\nutils.StartNewMailer(config.Mail)\n</code>\nThe problem is, how do I construct the called function, I tried to mirror the <code>Mail</code> struct (and called it <code>mailConfig</code>), since I can't pass an arbitrary struct as an argument.<br>\n<code>func StartNewMailer(conf mailConfig){ //...</code>, but that doesn't work either, I get the following compiler error message:\n<code>\ncannot use config.Mail (type struct { From string; To string; Password string }) as type utils.mailConfig in argument to utils.StartNewMailer\n</code><br>\nDo I have to pass in every single value to the called function or is there a nicer way to do this? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1432586893, "post_id": 30445622, "comment_id": 48973617, "body": "Did you set the go path and go root ? If yes can you try go get -u golang.org/x/net/html"}, {"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1432587365, "post_id": 30445622, "comment_id": 48973804, "body": "Just so I&#39;m making sure I did it correctly, in eclipse I went to window-&gt;preferences-&gt;Go-&gt;then set my GOROOT to C:\\Go is this correct?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1432588855, "post_id": 30445622, "comment_id": 48974321, "body": "Have you already <code>go get</code>-ed it?"}, {"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "edited": false, "score": 0, "creation_date": 1432589700, "post_id": 30445622, "comment_id": 48974574, "body": "When it comes to using &quot;go get code.google.com/p/go.net/html&quot; I&#39;m not quite sure how to use it. Putting it in the import doesn&#39;t work and I really don&#39;t understand where else I&#39;m supposed to put it"}, {"owner": {"reputation": 57021, "user_id": 1517578, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/gd070.png?s=128&g=1", "display_name": "Simon Whitehead", "link": "https://stackoverflow.com/users/1517578/simon-whitehead"}, "edited": false, "score": 0, "creation_date": 1432595088, "post_id": 30445622, "comment_id": 48976041, "body": "Your import in your code is <code>golang.org&#47;x&#47;net&#47;html</code>. This means you should be opening a Command Prompt/Terminal and typing: <code>go get golang.org&#47;x&#47;net&#47;html</code> into there. Once you&#39;ve done that, try building."}, {"owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "edited": false, "score": 1, "creation_date": 1432599898, "post_id": 30445622, "comment_id": 48977061, "body": "Oh ok I see, however I&#39;m getting the error message &quot;cannot download, $GOPATH not set&quot;, so I must have not set up my path correctly : /. Sorry again for how silly this is. My programming experience outside visual studios is very small. After actually creating a path and trying to do the go get golang.org/x/net/html I ran into another issue: go: missing Git command.... Any ideas?"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1432605091, "post_id": 30445622, "comment_id": 48978278, "body": "@ElegantMetal -- go workspace setup in brief: <a href=\"http://stackoverflow.com/questions/20628918/cannot-download-gopath-not-set/20629533#20629533\" title=\"cannot download gopath not set\">stackoverflow.com/questions/20628918/&hellip;</a> -- I&#39;m not sure how you get git for Windows since I&#39;m not on Windows, but <a href=\"https://msysgit.github.io/\" rel=\"nofollow noreferrer\">msysgit.github.io</a> is a top Google hit for it."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1432605140, "post_id": 30445622, "comment_id": 48978290, "body": "(There is also <a href=\"https://git-scm.com/download/win\" rel=\"nofollow noreferrer\">git-scm.com/download/win</a> -- but since I have no special insight into Git on Windows, probably not that useful for me to keep throwing things out there.)"}], "answers": [{"tags": [], "owner": {"reputation": 4897, "user_id": 1188357, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cKQ6S.png?s=128&g=1", "display_name": "Kiril", "link": "https://stackoverflow.com/users/1188357/kiril"}, "is_accepted": false, "score": 2, "last_activity_date": 1450341174, "creation_date": 1450341174, "answer_id": 34329932, "question_id": 30445622, "link": "https://stackoverflow.com/questions/30445622/golang-import-issue/34329932#34329932", "title": "Golang import issue", "body": "<p>You can take a look at <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">https://golang.org/doc/code.html</a>. It contains a very good description on how to start coding in Go. The issues you are mentioning are described there.</p>\n\n<p>So, you set <code>GOROOT</code> to your installation path. Then you set <code>GOPATH</code> to your go workspace(s), which obey the <code>bin, pkg, src</code> structure. The first entry in your <code>GOPATH</code> is used to store the <code>go get ...</code> which you install on your machine.</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 9292229, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7e49cce34f11eba5f473d6c811f57dbb?s=128&d=identicon&r=PG&f=1", "display_name": "storm", "link": "https://stackoverflow.com/users/9292229/storm"}, "is_accepted": false, "score": 1, "last_activity_date": 1525775892, "creation_date": 1525775892, "answer_id": 50231591, "question_id": 30445622, "link": "https://stackoverflow.com/questions/30445622/golang-import-issue/50231591#50231591", "title": "Golang import issue", "body": "<p>You can execute at the command line\u3000\u201cgo get golang.org/x/net/html\u201d</p>\n"}], "owner": {"reputation": 119, "user_id": 4883216, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/73a6db6ae7d0691b4448877e3f607ee4?s=128&d=identicon&r=PG&f=1", "display_name": "Elegant Metal", "link": "https://stackoverflow.com/users/4883216/elegant-metal"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6056, "favorite_count": 1, "answer_count": 2, "score": 4, "last_activity_date": 1545124285, "creation_date": 1432585825, "last_edit_date": 1495542735, "question_id": 30445622, "link": "https://stackoverflow.com/questions/30445622/golang-import-issue", "title": "Golang import issue", "body": "<p>I'm having issues importing \"golang.org/x/net/html\" it's simply telling me it can't find the package. Looking around the internet has only confused me more with some people saying that you can't use it anymore, some people saying to do this: <a href=\"https://stackoverflow.com/questions/18888093/install-exp-html-in-go\">Install exp/html in Go</a> and some people saying that just using \"golang.org/x/net/html\" works just fine.</p>\n\n<p>Here is just a small part of the code I'm trying to run:</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n    \"html\"\n    \"net/http\"\n    \"golang.org/x/net/html\"\n    \"os\"\n    \"strings\"\n)\n\n// Helper function to pull the href attribute from a Token\nfunc getHref(t html.Token) (ok bool, href string) {\n    // Iterate over all of the Token's attributes until we find an \"href\"\n    for _, a := range t.Attr {\n        if a.Key == \"href\" {\n            href = a.Val\n            ok = true\n        }\n    }\n\n    return\n}\n</code></pre>\n\n<p>It obviously won't let me use the html token because I can't import the package.</p>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 116, "user_id": 2357544, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5UMr7.jpg?s=128&g=1", "display_name": "Donald", "link": "https://stackoverflow.com/users/2357544/donald"}, "edited": false, "score": 6, "creation_date": 1555316370, "post_id": 30445480, "comment_id": 98053764, "body": "what if out is an array and you don&#39;t know how many  elements are there in json."}], "tags": [], "owner": {"reputation": 1700, "user_id": 8137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca45063da41a9f3aa9028295d8b66d89?s=128&d=identicon&r=PG", "display_name": "JW.", "link": "https://stackoverflow.com/users/8137/jw"}, "is_accepted": true, "score": 68, "last_activity_date": 1432585115, "creation_date": 1432585115, "answer_id": 30445480, "question_id": 30445479, "link": "https://stackoverflow.com/questions/30445479/how-to-specify-default-values-when-parsing-json-in-go/30445480#30445480", "title": "How to specify default values when parsing JSON in Go", "body": "<p>This is possible using encoding/json: when calling <code>json.Unmarshal</code>, you do not need to give it an empty struct, you can give it one with default values.</p>\n\n<p>For your example:</p>\n\n<pre><code>var example []byte = []byte(`{\"A\": \"1\", \"C\": \"3\"}`)\n\nout := Test{\n    A: \"default a\",\n    B: \"default b\",\n    // default for C will be \"\", the empty value for a string\n}\nerr := json.Unmarshal(example, &amp;out) // &lt;--\nif err != nil {\n    panic(err)\n}\nfmt.Printf(\"%+v\", out)\n</code></pre>\n\n<p>Running <a href=\"https://play.golang.org/p/-iiZnh5uhy\">this example in the Go playground</a> returns <code>{A:1 B:default b C:3}</code>.</p>\n\n<p>As you can see, <code>json.Unmarshal(example, &amp;out)</code> unmarshals the JSON into <code>out</code>, overwriting the values specified in the JSON, but leaving the other fields unchanged.</p>\n"}, {"tags": [], "owner": {"reputation": 3095, "user_id": 178597, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/13148e76e55c7429e663480dc900bf77?s=128&d=identicon&r=PG", "display_name": "Christian", "link": "https://stackoverflow.com/users/178597/christian"}, "is_accepted": false, "score": 17, "last_activity_date": 1481552635, "creation_date": 1481552635, "answer_id": 41102996, "question_id": 30445479, "link": "https://stackoverflow.com/questions/30445479/how-to-specify-default-values-when-parsing-json-in-go/41102996#41102996", "title": "How to specify default values when parsing JSON in Go", "body": "<p>In case u have a list or map of <code>Test</code> structs the accepted answer is not possible anymore but it can easily be extended with a UnmarshalJSON method:</p>\n\n<pre><code>func (t *Test) UnmarshalJSON(data []byte) error {\n  type testAlias Test\n  test := &amp;testAlias{\n    B: \"default B\",\n  }\n\n  _ = json.Unmarshal(data, test)\n\n  *t = Test(*test)\n  return nil\n}\n</code></pre>\n\n<p>The testAlias is needed to prevent recursive calls to UnmarshalJSON. This works because a new type has no methods defined.</p>\n\n<p><a href=\"https://play.golang.org/p/qiGyjRbNHg\" rel=\"noreferrer\">https://play.golang.org/p/qiGyjRbNHg</a></p>\n"}], "owner": {"reputation": 1700, "user_id": 8137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca45063da41a9f3aa9028295d8b66d89?s=128&d=identicon&r=PG", "display_name": "JW.", "link": "https://stackoverflow.com/users/8137/jw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 30830, "favorite_count": 5, "accepted_answer_id": 30445480, "answer_count": 2, "score": 32, "last_activity_date": 1481552635, "creation_date": 1432585115, "question_id": 30445479, "link": "https://stackoverflow.com/questions/30445479/how-to-specify-default-values-when-parsing-json-in-go", "title": "How to specify default values when parsing JSON in Go", "body": "<p>I want to parse a JSON object in Go, but want to specify default values for fields that are not given. For example, I have the struct type:</p>\n\n<pre><code>type Test struct {\n    A string\n    B string\n    C string\n}\n</code></pre>\n\n<p>The default values for A, B, and C, are \"a\", \"b\", and \"c\" respectively. This means that when I parse the json:</p>\n\n<pre><code>{\"A\": \"1\", \"C\": 3}\n</code></pre>\n\n<p>I want to get the struct:</p>\n\n<pre><code>Test{A: \"1\", B: \"b\", C: \"3\"}\n</code></pre>\n\n<p>Is this possible using the built-in package <code>encoding/json</code>? Otherwise, is there any Go library that has this functionality?</p>\n"}, {"tags": ["tcp", "go", "timeout"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1432579194, "creation_date": 1432579194, "answer_id": 30444267, "question_id": 30442624, "link": "https://stackoverflow.com/questions/30442624/idiomatic-way-to-timeout-tcp-handshake-in-go/30444267#30444267", "title": "Idiomatic way to timeout TCP handshake in Go", "body": "<p>To timeout the initial connection, you use <code>net.DialTimeout</code>, or more specifically, set the <code>Timeout</code> parameter on a <a href=\"http://golang.org/pkg/net/#Dialer\" rel=\"nofollow\"><code>net.Dialer</code></a>. </p>\n\n<p>To timeout individual operations on a TCP connection while it's in use, you use <a href=\"http://golang.org/pkg/net/#TCPConn.SetDeadline\" rel=\"nofollow\"><code>SetDeadline</code></a>, <a href=\"http://golang.org/pkg/net/#TCPConn.SetReadDeadline\" rel=\"nofollow\"><code>SetReadDeadline</code></a>, or <a href=\"http://golang.org/pkg/net/#TCPConn.SetWriteDeadline\" rel=\"nofollow\"><code>SetWriteDeadline</code></a> on the connection.</p>\n\n<p>If you need to cancel operations on a connection immediately, the way to do that in Go is to <code>Close()</code> the connection. Connections are safe for concurrent operations, and you can call <code>Close()</code> from a goroutine other than the one blocking on the network operation.</p>\n"}], "owner": {"reputation": 723, "user_id": 1065474, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/ccbe7da9a44a8737ca2eda4462c42fe1?s=128&d=identicon&r=PG", "display_name": "Martin Sustrik", "link": "https://stackoverflow.com/users/1065474/martin-sustrik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 207, "favorite_count": 0, "accepted_answer_id": 30444267, "answer_count": 1, "score": 0, "last_activity_date": 1551801321, "creation_date": 1432572288, "last_edit_date": 1551801321, "question_id": 30442624, "link": "https://stackoverflow.com/questions/30442624/idiomatic-way-to-timeout-tcp-handshake-in-go", "title": "Idiomatic way to timeout TCP handshake in Go", "body": "<p>What is the idiomatic way in Go to timeout a TCP conversation, such as initial protocol handshake? Let's say there is a goroutine that handles the TCP conversation. I can launch it, then launch a <code>time.After()</code>, then <code>select</code> for both of them and if timeout was hit, proceed on doing other stuff.</p>\n\n<p>However, that means that the TCP goroutine will linger on after the timeout keeping the TCP connection alive even though nobody will ever need it.</p>\n"}, {"tags": ["database", "go", "sqlite"], "answers": [{"tags": [], "owner": {"reputation": 387, "user_id": 3812959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ea5e258f3f19dd1b2bc039bf239638?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/3812959/jeff"}, "is_accepted": true, "score": 2, "last_activity_date": 1432817814, "creation_date": 1432817814, "answer_id": 30507257, "question_id": 30442449, "link": "https://stackoverflow.com/questions/30442449/go-sqlite3-database-connection-using-sql-open/30507257#30507257", "title": "Go SQLite3 database connection using sql.Open", "body": "<p>For the case when there is no username or password simply put in the full path to the DB including the file name. </p>\n\n<p>ex:</p>\n\n<p><code>db, err := sql.Open(\"sqlite3\", \"/user/home/workspace/myDBname.db\")</code></p>\n"}], "owner": {"reputation": 387, "user_id": 3812959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/97ea5e258f3f19dd1b2bc039bf239638?s=128&d=identicon&r=PG&f=1", "display_name": "Jeff", "link": "https://stackoverflow.com/users/3812959/jeff"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1761, "favorite_count": 0, "accepted_answer_id": 30507257, "answer_count": 1, "score": 0, "last_activity_date": 1432817814, "creation_date": 1432571488, "last_edit_date": 1495540766, "question_id": 30442449, "link": "https://stackoverflow.com/questions/30442449/go-sqlite3-database-connection-using-sql-open", "title": "Go SQLite3 database connection using sql.Open", "body": "<p>I am new to golang and I am a having a hard time connecting to an SQLite3 database hosted on the local machine. I have the SQLite3 database created and have worked through a few tutorials I have fond but they are not working. currently my code is based on another <a href=\"https://stackoverflow.com/questions/17560232/how-do-i-connect-to-mysql-server-with-go-and-go-sql-driver\">post</a> but I am still unable to make a connection with my database. I believe my problem is in my use of \"sql.Open\" as I am not clear on the information that I need to provide even after consulting <a href=\"http://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\">the sql package</a>.</p>\n\n<p>the code builds fine but reports </p>\n\n<pre><code>unable to open database file\nerror Two tripped\n</code></pre>\n\n<p>when I try to run the code below</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"false\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>package main\r\n\r\nimport (\r\n    \"database/sql\"\r\n    \"fmt\"\r\n    _ \"github.com/go-sql-driver/mysql\"\r\n    _\"github.com/mattn/go-sqlite3\"\r\n)\r\n\r\nfunc main() {\r\n       \r\n    db, err := sql.Open(\"sqlite3\", \"myuser:mypassword@/myDBname\") //not clear on what is needed for the user and password\r\n    if err != nil {\r\n        fmt.Println(err)\r\n        fmt.Println(\"error one tripped\")\r\n        return\r\n    }\r\n    defer db.Close()\r\n    err = db.Ping()\r\n    if err != nil {\r\n        fmt.Println(err)\r\n        fmt.Println(\"error Two tripped\")\r\n        return\r\n    }\r\n    fmt.Println(\"Ping\")\r\n    \r\n    return\r\n\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I have not set a username or password for the database I am using, which is hosted on the local machine. I tried several combinations of my computer username/password and no username/password in \"sql.Open\" but I still have the same problem.</p>\n\n<p>I have installed and imported package code.google.com/p/go-sqlite/go1/sqlite3\nand my DB is in the same folder as my Go code. </p>\n\n<p>How do I use make the connection to the SQLite Database? what am I doing wrong with the sql.Open command?</p>\n"}, {"tags": ["go", "revel"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432659184, "post_id": 30441268, "comment_id": 49009456, "body": "Sawtan, <a href=\"https://stackoverflow.com\">Stack Overflow</a> isn&#39;t a forum. Here you don&#39;t edit an answer into the question and use tags like &#39;[solved]. Instead, if you have an answer to your own question you simply &quot;Post Your Answer&quot; (see <a href=\"https://stackoverflow.com/questions/how-to-answer\">How to Answer</a> and <a href=\"http://stackoverflow.com/help/self-answer\">Can I answer my own question</a>) and accept it."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 1959343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd13df73e6c269e512d0b4ce7e3e362b?s=128&d=identicon&r=PG", "display_name": "Sawtan", "link": "https://stackoverflow.com/users/1959343/sawtan"}, "edited": false, "score": 0, "creation_date": 1432620281, "post_id": 30441361, "comment_id": 48982548, "body": "Looks like my revel binary was way old, had to remove it and get the revel cmd package, now it seems to work as per usual! Thanks for the help!"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 0, "last_activity_date": 1432566847, "creation_date": 1432566847, "answer_id": 30441361, "question_id": 30441268, "link": "https://stackoverflow.com/questions/30441268/undefined-revel-testsuites/30441361#30441361", "title": "Undefined: revel.TestSuites", "body": "<p>I don't use Revel, but <a href=\"https://godoc.org/github.com/revel/revel/testing\" rel=\"nofollow\">Godoc tells us</a> that <code>TestSuites</code> is now in <code>github.com/revel/revel/testing</code> package. The Revel developers might've moved the testing related stuff into a separate package.</p>\n"}], "owner": {"reputation": 31, "user_id": 1959343, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fd13df73e6c269e512d0b4ce7e3e362b?s=128&d=identicon&r=PG", "display_name": "Sawtan", "link": "https://stackoverflow.com/users/1959343/sawtan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 155, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432659954, "creation_date": 1432566495, "last_edit_date": 1432659954, "question_id": 30441268, "link": "https://stackoverflow.com/questions/30441268/undefined-revel-testsuites", "title": "Undefined: revel.TestSuites", "body": "<p>I'm having some problems getting <a href=\"http://revel.github.io/\" rel=\"nofollow\">Revel</a> up and running after I did an update on the package. Each time I try to run a revel app I get the following error message:</p>\n\n<pre><code>Go Compilation Error\nThe Go code go/src/github.com/revel/samples/booking/app/tmp/main.go does not compile: undefined: revel.TestSuites\n</code></pre>\n\n<p>At first I thought this was due to some legacy code in my current project, but then I tried to get the official sample projects to work, but the same error comes up in these as well. Don't know how to push this further. I don't even use the <code>testrunner</code>, so it shouldn't even get generated in the <code>main.go</code> file.</p>\n\n<p><em>Update</em></p>\n\n<p>Looks like I had a old revel binary, had to remove this and get the revel cmd package, after I did this the <code>TestSuites</code> problem got solved.</p>\n"}, {"tags": ["python", "memory", "go", "redis", "redigo"], "comments": [{"owner": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1432563285, "post_id": 30440144, "comment_id": 48963189, "body": "Can you do an info after you restart your redis service ? You seem to just flush the data and reinserting them."}, {"owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "reply_to_user": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1432565261, "post_id": 30440144, "comment_id": 48964131, "body": "@TasosVogiatzoglou I&#39;ve updated info output."}], "answers": [{"comments": [{"owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "edited": false, "score": 0, "creation_date": 1432565778, "post_id": 30440383, "comment_id": 48964387, "body": "Wooah, such a silly mistake I&#39;ve make! Indeed, it looks like I pass 512kb []byte slice (which was created while parsing multipart/data form). I&#39;ve checked my Redis code here and there numerous times, but didn&#39;t guess to check the place from where []byte slice comes. I&#39;ll come back with results in a moment!"}, {"owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "edited": false, "score": 0, "creation_date": 1432566094, "post_id": 30440383, "comment_id": 48964571, "body": "Yeah, that was the problem! Thank you very much!"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "edited": false, "score": 0, "creation_date": 1432566781, "post_id": 30440383, "comment_id": 48964867, "body": "@Shemhamforasch heh, my detective skills are not that bad if I may say so myself :) nevertheless, you are better off setting the optimization I recommended, it will save some memory if you have tons of objects regardless."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 7, "last_activity_date": 1432565116, "last_edit_date": 1432565116, "creation_date": 1432563346, "answer_id": 30440383, "question_id": 30440144, "link": "https://stackoverflow.com/questions/30440144/inadequate-ram-usage-by-redis/30440383#30440383", "title": "Inadequate RAM usage by Redis", "body": "<p>You have lots and lots of small HASH objects, and that's fine. But each of them has a lot of overhead in the redis memory, since it has a separate dictionary. There is a small optimization for this that usually improves things significantly, and it's to keep hashes in a memory optimized but slightly slower data structure, which at these object sizes should not matter much. From the config:</p>\n\n<pre><code># Hashes are encoded using a memory efficient data structure when they have a\n# small number of entries, and the biggest entry does not exceed a given\n# threshold. These thresholds can be configured using the following directives. \nhash-max-ziplist-entries 512\nhash-max-ziplist-value 64\n</code></pre>\n\n<p>Now, you have large values which causes this optimization not to work.\nI'd set <code>hash-max-ziplist-value</code> to a few kbs (depending on the size of your largest object), and it should improve this (you should not see any performance degradation in this HASH size). </p>\n\n<p>Also, keep in mind that redis compresses its RDB files relative to what you have in memory, so a ~50% reduction over memory is to be expected anyway. </p>\n\n<p><strong>[EDIT]</strong> After re-reading your question and seeing it's a go only problem, and considering the fact that the compressed rdb is small, something tells me you're writing a bigger size than you'd expect for the image. Any chance you're writing that off a <code>[]byte</code> slice? If so, perhaps you did not trim it and you're writing a much bigger buffer or something similar? I've worked like this with redigo tons of times and never seen what you're describing.</p>\n"}], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 144, "favorite_count": 1, "accepted_answer_id": 30440383, "answer_count": 1, "score": 1, "last_activity_date": 1432566253, "creation_date": 1432562527, "last_edit_date": 1432566253, "question_id": 30440144, "link": "https://stackoverflow.com/questions/30440144/inadequate-ram-usage-by-redis", "title": "Inadequate RAM usage by Redis", "body": "<p>I'm developing an API using Go and Redis. The problem is that RAM usage is inadequate and I can't find the root of the problem. </p>\n\n<p><strong>TL;DR version</strong> </p>\n\n<p>There are hundreds/thousands of hash objects. Each one of 1 KB objects (key+value) takes ~0.5 MB of RAM. However, there is no memory fragmentation (<code>INFO</code> shows none).</p>\n\n<p>Also, dump.rdb is 70x times smaller than the RAM set (360KB dump.rdb vs 25MB RAM for 50 objects, and 35.5MB vs 2.47GB for 5000 objects).</p>\n\n<p><strong>Long version</strong></p>\n\n<p>Redis instance is filled mostly with <code>task:123</code> hashes of the following kind:</p>\n\n<pre><code>    \"task_id\"       : int\n    \"client_id\"     : int\n    \"worker_id\"     : int\n    \"text\"          : string (0..255 chars)\n    \"is_processed\"  : boolean\n    \"timestamp\"     : int\n    \"image\"         : byte array (1 kbyte) \n</code></pre>\n\n<p>Also, there are a couple of integer counters, one list and one sorted set (both consist of task_id's). </p>\n\n<p><strong><em>RAM usage has a linear dependency on the number of task objects.</em></strong></p>\n\n<p>INFO output for 50 tasks:</p>\n\n<pre><code># Memory\nused_memory:27405872\nused_memory_human:26.14M\nused_memory_rss:45215744\nused_memory_peak:31541400\nused_memory_peak_human:30.08M\nused_memory_lua:35840\nmem_fragmentation_ratio:1.65\nmem_allocator:jemalloc-3.6.0\n</code></pre>\n\n<p>and 5000 tasks:</p>\n\n<pre><code># Memory\nused_memory:2647515776\nused_memory_human:2.47G\nused_memory_rss:3379187712\nused_memory_peak:2651672840\nused_memory_peak_human:2.47G\nused_memory_lua:35840\nmem_fragmentation_ratio:1.28\nmem_allocator:jemalloc-3.6.0\n</code></pre>\n\n<p>Size of <code>dump.rdb</code> for 50 tasks is 360kB and for 5000 tasks it's 35553kB.</p>\n\n<p>Every task object has serializedlength of ~7KB:</p>\n\n<pre><code>127.0.0.1:6379&gt; DEBUG OBJECT task:2000\nValue at:0x7fcb403f5880 refcount:1 encoding:hashtable serializedlength:7096 lru:6497592 lru_seconds_idle:180\n</code></pre>\n\n<p>I've written a Python script trying to reproduce the problem:</p>\n\n<pre><code>import redis\nimport time\nimport os \nfrom random import randint\n\nimg_size = 1024 * 1 # 1 kb\nr = redis.StrictRedis(host='localhost', port=6379, db=0)\n\nfor i in range(0, 5000):\n    values = { \n        \"task_id\"   : randint(0, 65536),\n        \"client_id\" : randint(0, 65536),\n        \"worker_id\" : randint(0, 65536),\n        \"text\"      : \"\",\n        \"is_processed\" : False,\n        \"timestamp\" : int(time.time()),\n        \"image\"     : bytearray(os.urandom(img_size)),\n    }\n    key = \"task:\" + str(i)\n    r.hmset(key, values)\n    if i % 500 == 0: print(i)\n</code></pre>\n\n<p>And it consumes just 80MB of RAM!</p>\n\n<p>I would appreciate any ideas on how to figure out what's going on.</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1432545133, "post_id": 30434742, "comment_id": 48953106, "body": "it helps to start writing some code."}, {"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432545373, "post_id": 30434742, "comment_id": 48953230, "body": "@SalvadorDali I try to find before insert if there is a document with same name and last name but I don&#39;t think that cover whole case when both goroutines check in same time. I tried ensure index by two fields (name, lastName) but it also didn&#39;t help"}, {"owner": {"reputation": 44359, "user_id": 2363712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/beAJU.jpg?s=128&g=1", "display_name": "Sylvain Leroux", "link": "https://stackoverflow.com/users/2363712/sylvain-leroux"}, "edited": false, "score": 0, "creation_date": 1432551192, "post_id": 30434742, "comment_id": 48956558, "body": "@PaolaJ. I didn&#39;t see you last comment when I posted my answer. <i>&quot;I tried ensure index by two fields (name, lastName) but it also didn&#39;t help&quot;</i> Could you show <i>how</i> you created your index and <i>how</i> you were able to insert two documents with the same <code>(name, lastName)\u0300</code> ?"}], "answers": [{"comments": [{"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1432547201, "post_id": 30434941, "comment_id": 48954210, "body": "@Sylvain Leroux Should I call this only once, in main or in init function, correct ?"}, {"owner": {"reputation": 44359, "user_id": 2363712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/beAJU.jpg?s=128&g=1", "display_name": "Sylvain Leroux", "link": "https://stackoverflow.com/users/2363712/sylvain-leroux"}, "reply_to_user": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1432550201, "post_id": 30434941, "comment_id": 48955948, "body": "@PaolaJ. I&#39;ve edited the answer to provide additional informations and pointers to some related documentation. But as I am <i>not</i> a Go specialist, other answers might come with more details than I can provide."}], "tags": [], "owner": {"reputation": 44359, "user_id": 2363712, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/beAJU.jpg?s=128&g=1", "display_name": "Sylvain Leroux", "link": "https://stackoverflow.com/users/2363712/sylvain-leroux"}, "is_accepted": false, "score": 3, "last_activity_date": 1432551087, "last_edit_date": 1495539845, "creation_date": 1432545515, "answer_id": 30434941, "question_id": 30434742, "link": "https://stackoverflow.com/questions/30434742/how-to-prevent-to-multiple-goroutines-inserts-document-in-persons-collections-if/30434941#30434941", "title": "How to prevent to multiple goroutines inserts document in persons collections if already exists person with same name and last name?", "body": "<blockquote>\n  <p>How to prevent to multiple <em>goroutines/process/thread/applications/...</em> to insert documents in persons collections if already exists person with same name and last name</p>\n</blockquote>\n\n<p><strong>The only way</strong> to prevent duplicate entries esp. in concurrent environment is by using an <a href=\"http://docs.mongodb.org/manual/core/index-unique/\" rel=\"nofollow noreferrer\">unique index</a> on <code>{name:1, lastname:1}</code>. Then in your code, you should be prepared to gracefully handle the exception raised by a potential collision.</p>\n\n<p><strong>Never</strong> ever <em>check-before-insert</em>, as in MongoDB you don't have transaction, so it is quite possible that a record was concurrently inserted by an other client after your <em>check</em> and before your <em>insert</em>.</p>\n\n<hr>\n\n<p>Other peoples might certainly help you more with the correct Go syntax, but something along the lines of the following code (borrowed from <a href=\"https://gist.github.com/border/3489566#file-mgoexample-go-L43\" rel=\"nofollow noreferrer\">here</a>) will allow you to create the required index:</p>\n\n<pre><code>index := mgo.Index{\nKey: []string{\"name\", \"lastName\"},\nUnique: true,\n}\n\nerr = c.EnsureIndex(index)\n</code></pre>\n\n<p>Then, every time you insert a document, you need to use the <a href=\"http://godoc.org/labix.org/v2/mgo#IsDup\" rel=\"nofollow noreferrer\"><code>mgo.isDup</code></a> function to test if an error was caused by a duplicate key. As an example from a previous <a href=\"https://stackoverflow.com/a/24775437/2363712\">answer by @elithrar</a>:</p>\n\n<pre><code>err := users.Insert(user) // where user is type *mgo.Collection\nif err != nil {\n    if mgo.IsDup(err) {\n        // Is a duplicate key, but we don't know which one \n    }\n    // Is another error\n}\n</code></pre>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432551492, "creation_date": 1432544870, "last_edit_date": 1432551492, "question_id": 30434742, "link": "https://stackoverflow.com/questions/30434742/how-to-prevent-to-multiple-goroutines-inserts-document-in-persons-collections-if", "title": "How to prevent to multiple goroutines inserts document in persons collections if already exists person with same name and last name?", "body": "<p>How to prevent multiple goroutines to insert document in persons collections if already exists person with same name and last name ?</p>\n\n<pre><code>type Person struct {\n\n    Id                      bson.ObjectId   `bson:\"_id\"`\n    Name            string          `bson:\"name\"`\n    LastName            string          `bson:\"lastName\"`\n\n}\n</code></pre>\n\n<p>I am using Mongo with mgo driver for go language.</p>\n\n<p>I try to find before insert if there is a document with same name and last name but I don't think that cover whole case when both goroutines check in same time. I tried ensure index by two fields <code>(name, lastName)</code> but it also didn't help.</p>\n"}, {"tags": ["linux", "windows", "macos", "go"], "comments": [{"owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1432536179, "post_id": 30432169, "comment_id": 48949185, "body": "Why do you care about the exact OS version?"}, {"owner": {"reputation": 27694, "user_id": 194175, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56badf521701d4f9b3a394d3ef6e90c4?s=128&d=identicon&r=PG", "display_name": "rdegges", "link": "https://stackoverflow.com/users/194175/rdegges"}, "reply_to_user": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "edited": false, "score": 0, "creation_date": 1432576178, "post_id": 30432169, "comment_id": 48969110, "body": "This is an API client library that&#39;s going to be (eventually) used by a lot of developers worldwide, so I&#39;d like to be able to know what OS versions to support / invest in. EG: Maybe I end up with a big userbase of Windows developers, and want to expand my Windows client support."}], "answers": [{"comments": [{"owner": {"reputation": 27694, "user_id": 194175, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56badf521701d4f9b3a394d3ef6e90c4?s=128&d=identicon&r=PG", "display_name": "rdegges", "link": "https://stackoverflow.com/users/194175/rdegges"}, "edited": false, "score": 0, "creation_date": 1432576088, "post_id": 30432293, "comment_id": 48969060, "body": "This is being used in an API client library -- so I can&#39;t use browser agent stuff :("}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 4, "last_activity_date": 1432538663, "last_edit_date": 1432538663, "creation_date": 1432534774, "answer_id": 30432293, "question_id": 30432169, "link": "https://stackoverflow.com/questions/30432169/how-can-i-detect-the-os-version-in-go/30432293#30432293", "title": "How Can I Detect the OS Version in Go?", "body": "<p>Based on the extensive discussion in <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/NzEPGqlHIYQ\" rel=\"nofollow\">Go google group</a> it looks like nothing reliable exists. I still suggest you to take a look at the discussion, as there are some useful ideas how to extract some information for particular OS.</p>\n\n<p><strong>P.S.</strong> does not the browser send this information in User_Agent?</p>\n\n<pre><code>User-Agent:Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/42.0.2311.135 Safari/537.36\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432572745, "post_id": 30432566, "comment_id": 48967480, "body": "Most Posix systems have <code>uname</code> as a library routine, not a syscall (and therefore not in the syscall package). However, cgo can be used to call uname (and <code>C.struct_utsname</code> is more directly usable than how the Linux syscall and golang.org/x/sys/unix packages define <code>syscall.Utsname</code>)."}], "tags": [], "owner": {"reputation": 208003, "user_id": 841108, "user_type": "registered", "accept_rate": 61, "profile_image": "https://i.stack.imgur.com/Fm52y.png?s=128&g=1", "display_name": "Basile Starynkevitch", "link": "https://stackoverflow.com/users/841108/basile-starynkevitch"}, "is_accepted": false, "score": 1, "last_activity_date": 1432542684, "last_edit_date": 1432542684, "creation_date": 1432536151, "answer_id": 30432566, "question_id": 30432169, "link": "https://stackoverflow.com/questions/30432169/how-can-i-detect-the-os-version-in-go/30432566#30432566", "title": "How Can I Detect the OS Version in Go?", "body": "<p>Use <a href=\"https://golang.org/pkg/syscall/#Uname\" rel=\"nofollow\">uname</a> (for the <a href=\"http://man7.org/linux/man-pages/man2/uname.2.html\" rel=\"nofollow\">uname(2)</a> syscall), which should be available on POSIX systems like Linux &amp; MacOSX.</p>\n\n<p>I don't understand why you need such precise information; BTW, on Linux, and probably MacOSX, it is in not enough, the version of the <a href=\"http://en.wikipedia.org/wiki/C_standard_library\" rel=\"nofollow\">libc</a> (and of course, of the GO runtime) matters at least as much.</p>\n\n<p><sup>(You should find something similar for Windows if you care)</sup></p>\n"}], "owner": {"reputation": 27694, "user_id": 194175, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56badf521701d4f9b3a394d3ef6e90c4?s=128&d=identicon&r=PG", "display_name": "rdegges", "link": "https://stackoverflow.com/users/194175/rdegges"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1218, "favorite_count": 1, "accepted_answer_id": 30432293, "answer_count": 2, "score": 4, "last_activity_date": 1432542684, "creation_date": 1432534148, "last_edit_date": 1432535100, "question_id": 30432169, "link": "https://stackoverflow.com/questions/30432169/how-can-i-detect-the-os-version-in-go", "title": "How Can I Detect the OS Version in Go?", "body": "<p>I'm currently writing a REST API client, and I'm trying to determine what OS the user is using in order to generate a useful User Agent string. This is going to allow me to (hopefully) make good decisions about what OS's I should bother supporting in the future.</p>\n\n<p>What I'd like to do is this: generate a string that looks something like:</p>\n\n<p>Linux/1.3.2 OR Darwin/1.3.2 OR Windows/1.3.2</p>\n\n<p>It should work across Linux / Mac / Windows.</p>\n\n<p>Currently, I'm able to retrieve the OS type (eg: 'linux' / 'windows' / 'darwin') using</p>\n\n<pre><code>runtime.GOOS\n</code></pre>\n\n<p>But I'm unable to find a way to grab the OS major/minor/micro versions.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432529260, "post_id": 30431331, "comment_id": 48947017, "body": "what is <code>f</code> in your code?"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432529654, "post_id": 30431331, "comment_id": 48947113, "body": "Also why do you have <code>line1 \\` in the output if the input has only </code>line1 `?"}, {"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432534003, "post_id": 30431331, "comment_id": 48948390, "body": "<code>f, err := os.Open(filename)</code>"}, {"owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1432534096, "post_id": 30431331, "comment_id": 48948421, "body": "\\ is returned by the current bufio.ScanLines func."}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": -3, "last_activity_date": 1432560023, "creation_date": 1432560023, "answer_id": 30439397, "question_id": 30431331, "link": "https://stackoverflow.com/questions/30431331/bufio-scanlines-with-escaped-new-lines/30439397#30439397", "title": "bufio.ScanLines with escaped new lines", "body": "<p>A few obvious approaches come to mind.</p>\n\n<p>First, take a look at the <a href=\"https://github.com/golang/go/blob/883bc6ed0ea815293fe6309d66f967ea60630e87/src/bufio/scan.go#L276-304\" rel=\"nofollow\">source for <code>bufio.ScanLines</code></a>, it's not large and you could easily implement your own <a href=\"https://golang.org/pkg/bufio/#SplitFunc\" rel=\"nofollow\"><code>bufio.SplitFunc</code></a> from scratch starting from a copy of that modified to do what you want.</p>\n\n<p>Second, you could write a <code>bufio.SplitFunc</code> that called <code>bufio.ScanLines</code> in a loop, combining tokens as long as it returns ones that end in your escape character, and then returning the combined token.</p>\n\n<p>Given the short size and simplicity of the first approach that's what I'd probably do. The second approach would likely end up just as long, be less efficient, and probably require state since you'd need to store the combined-token-so-far when returning <code>(0, nil, nil)</code> to ask for more input.</p>\n\n<p>Another solution would be to implement a <a href=\"https://godoc.org/golang.org/x/text/transform/#Transformer\" rel=\"nofollow\"><code>Transformer</code></a> (from the <code>golang.org/x/text/transform</code> package) that strips relevant escaped characters from the input (e.g.\u00a0removes <code>\"\\\\\\n\"</code>) and use <code>transform.NewReader</code> to make a filtered reader that you'd then do use however you want (e.g.\u00a0passing to a <code>bufio.Scanner</code> with the regular <code>ScanLines</code>).</p>\n\n<p>In any case, you could copy the appropriate tests from <code>scan_test.go</code> as well as adding your own for the escaped newline behaviour. Beware of <code>bufio.MaxScanTokenSize</code> as well.</p>\n"}], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1513, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1432560023, "creation_date": 1432528763, "question_id": 30431331, "link": "https://stackoverflow.com/questions/30431331/bufio-scanlines-with-escaped-new-lines", "title": "bufio.ScanLines with escaped new lines", "body": "<p>I am trying to adapt <code>bufio.ScanLines</code> so it is aware of escaped new lines <code>\\\\n</code>. </p>\n\n<p>Input:</p>\n\n<pre><code>line1 \\\ncontinues on line2\n</code></pre>\n\n<p>Expected output:</p>\n\n<pre><code>[\"line1 continues on line2\"]\n</code></pre>\n\n<p>Right now the output of <code>bufio.ScanLines</code> (see example code below) is:</p>\n\n<pre><code>[\"line1 \\\\\", \"continues on line2\"]\n</code></pre>\n\n<p>Example code:</p>\n\n<pre><code>s := bufio.NewScanner(f)\ns.Split(bufio.ScanLines)\n\nfor s.Scan() {\n    fmt.Println(s.Text())\n}\n</code></pre>\n\n<p>What would be the best approach here? Looking for an implementation that still passes the tests in <a href=\"https://golang.org/src/bufio/scan_test.go\" rel=\"nofollow\">https://golang.org/src/bufio/scan_test.go</a>.</p>\n"}, {"tags": ["amazon-web-services", "go", "docker", "amazon-elastic-beanstalk"], "comments": [{"owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "edited": false, "score": 0, "creation_date": 1433261031, "post_id": 30428926, "comment_id": 49270618, "body": "Can you post your <code>Dockerfile</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 142, "user_id": 1552650, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/f6d4a2d0bb321d82aac9b885f804d5fe?s=128&d=identicon&r=PG", "display_name": "Brian Graham", "link": "https://stackoverflow.com/users/1552650/brian-graham"}, "is_accepted": true, "score": 1, "last_activity_date": 1433191446, "last_edit_date": 1433191446, "creation_date": 1432747419, "answer_id": 30489243, "question_id": 30428926, "link": "https://stackoverflow.com/questions/30428926/go-web-app-on-aws-with-elastic-beanstalk-not-showing-output-in-logs/30489243#30489243", "title": "Go Web app on AWS with Elastic Beanstalk not showing output in logs", "body": "<p>I think <code>import \"github.com/rdegges/ipify-api/api\"</code> is being built from the copy on Github, not from the local copy. The most recent commit of the <code>api</code> package doesn't have the extraneous <code>fmt</code> statements. Also, the <code>log</code> statement in <code>main.go</code> works fine, as does the <code>fmt.Fprintf</code> already in the <code>api</code> package. Try to verify the <code>api</code> package is getting built from the source you think it is. </p>\n\n<p>EDIT 6/1/2015: </p>\n\n<p>All my tests indicate this is a problem stemming from having an internal subpackage, and the remote service having trouble with that. The <code>api</code> package is not getting built from the local copy. <code>fmt.Print</code> works just fine from <code>main.go</code>, and moving <code>GetIP</code> from the <code>api</code> package to the <code>main</code> package lets <code>fmt</code> print just fine to stdout during web requests. </p>\n\n<p>Basically, all changes made to the local <code>api</code> subpackage are getting ignored.</p>\n\n<p>The EB logs probably say something about which packages are being downloaded remotely; mine did.</p>\n\n<p>I'm not a Godep pro, so maybe a Godep pro can elaborate. But FWIW, it seems like it might be related to <a href=\"https://github.com/tools/godep/issues/134\" rel=\"nofollow\">this issue</a>, tangentially. It might also be a problem with the remote service not building with <code>godep go build</code>, but like I said, I'm not a Godep pro, so I'm unsure.</p>\n"}, {"tags": [], "owner": {"reputation": 80, "user_id": 2267356, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1657d09e160f6799ba66edb43f35f2e6?s=128&d=identicon&r=PG", "display_name": "feelobot", "link": "https://stackoverflow.com/users/2267356/feelobot"}, "is_accepted": false, "score": 0, "last_activity_date": 1437688366, "creation_date": 1437688366, "answer_id": 31598706, "question_id": 30428926, "link": "https://stackoverflow.com/questions/30428926/go-web-app-on-aws-with-elastic-beanstalk-not-showing-output-in-logs/31598706#31598706", "title": "Go Web app on AWS with Elastic Beanstalk not showing output in logs", "body": "<p>It is possible you are running an older version of the app, when I try to build the container locally I get the following error:</p>\n\n<pre><code>\u279c docker build .\n# Executing 3 build triggers\nTrigger 0, COPY . /go/src/app\nStep 0 : COPY . /go/src/app\nTrigger 1, RUN go-wrapper download\nStep 0 : RUN go-wrapper download\n ---&gt; Running in c1854666d13c\n+ exec go get -v -d\ngithub.com/julienschmidt/httprouter (download)\ngithub.com/rdegges/ipify-api (download)\ngithub.com/rs/cors (download)\nTrigger 2, RUN go-wrapper install\nStep 0 : RUN go-wrapper install\n ---&gt; Running in 0bbdec1b99d7\n+ exec go install -v\ngithub.com/julienschmidt/httprouter\ngithub.com/rdegges/ipify-api/models\ngithub.com/rs/cors\ngithub.com/rdegges/ipify-api/api\napp\n# app\n./main.go:27: cannot use api.NotFound (type func(http.ResponseWriter, *http.Request)) as type http.Handler in assignment:\n    func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)\n./main.go:28: cannot use api.MethodNotAllowed (type func(http.ResponseWriter, *http.Request)) as type http.Handler in assignment:\n    func(http.ResponseWriter, *http.Request) does not implement http.Handler (missing ServeHTTP method)\nThe command '/bin/sh -c go-wrapper install' returned a non-zero code: 2\n</code></pre>\n\n<p>Are there any errors in your event stream after you deploy? \"eb events\" i believe.</p>\n"}], "owner": {"reputation": 27694, "user_id": 194175, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/56badf521701d4f9b3a394d3ef6e90c4?s=128&d=identicon&r=PG", "display_name": "rdegges", "link": "https://stackoverflow.com/users/194175/rdegges"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 691, "favorite_count": 1, "accepted_answer_id": 30489243, "answer_count": 2, "score": 13, "last_activity_date": 1437688366, "creation_date": 1432506017, "last_edit_date": 1432743112, "question_id": 30428926, "link": "https://stackoverflow.com/questions/30428926/go-web-app-on-aws-with-elastic-beanstalk-not-showing-output-in-logs", "title": "Go Web app on AWS with Elastic Beanstalk not showing output in logs", "body": "<p>This is sort of an in-depth question, so I'll try to explain it as best I can.</p>\n\n<p>I've built a small API service in Go that I'm trying to deploy to AWS using the relatively new AWS Elastic Beanstalk Docker <a href=\"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/create_deploy_go.html\" rel=\"noreferrer\">support</a>.</p>\n\n<p>Here's what I've done (the code is all open source, so you can follow along if you'd like):</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>$ git clone https://github.com/rdegges/ipify-api.git\n$ cd ipify-api\n$ git fetch origin aws:aws\n$ git checkout aws\n$ eb init\n$ eb create\n$ eb deploy\n</code></pre>\n\n<p>This will use elastic beanstalk to create a new app (with docker), and deploy it.</p>\n\n<p>If I then run <code>eb open</code>\nto open my web app, I'll see my public IP address displayed (this is the correct behavior), so I know that my application is running / functional.</p>\n\n<p>Now, in my source code, I've got several lines of debugging output:</p>\n\n<pre><code>fmt.Println(\"WOOOOOOOOOOOO\")\n</code></pre>\n\n<p>The above statement just prints \"WOO\u2026\" to the console. This is run every time a new request is made.</p>\n\n<p>Unfortunately, when I run <code>eb logs</code> to view my instance logs, this debug line never shows up \u2013 and I can't figure out why.</p>\n\n<p>I've tried printing to STDERR, printing to STDOUT, etc. \u2013 but I'm absolutely unable to get any output.</p>\n\n<p>I've scoured the internet looking for solutions, but have yet to find any.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1432503851, "last_edit_date": 1432503851, "creation_date": 1432503394, "answer_id": 30428605, "question_id": 30428571, "link": "https://stackoverflow.com/questions/30428571/how-to-initialize-struct-fields/30428605#30428605", "title": "How to initialize struct fields", "body": "<p>There is no way to do that directly. The common pattern is to provide a <code>New</code> method that initializes your fields:</p>\n\n<pre><code>func NewMyType() *MyType {\n    myType := &amp;MyType{}\n    myType.Field = \"default\"\n    return myType\n\n    // If no special logic is needed\n    // return &amp;myType{\"default\"}\n}\n</code></pre>\n\n<p>Alternatively, you can return a non-pointer type. Finally, if you can work it out you should make the zero values of your struct sensible defaults so that no special constructor is needed.</p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 8, "last_activity_date": 1532467255, "last_edit_date": 1532467255, "creation_date": 1432503444, "answer_id": 30428608, "question_id": 30428571, "link": "https://stackoverflow.com/questions/30428571/how-to-initialize-struct-fields/30428608#30428608", "title": "How to initialize struct fields", "body": "<p>You can't have \"default\" values like that, you can either create a default \"constructor\" function that will return the defaults or simply assume that an empty / zero value is the \"default\".</p>\n\n<pre><code>type MyType struct {\n    Field string\n} \n\nfunc New(fld string) *MyType {\n    return &amp;MyType{Field: fld}\n}\n\nfunc Default() *MyType {\n    return &amp;MyType{Field: \"default\"}\n}\n</code></pre>\n\n<p>Also I highly recommend going through <a href=\"https://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">Effective Go</a>.</p>\n"}], "owner": {"reputation": 1550, "user_id": 464623, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/ba8c707b3cddf068a978d436a66f218e?s=128&d=identicon&r=PG", "display_name": "Dmitry", "link": "https://stackoverflow.com/users/464623/dmitry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3555, "favorite_count": 0, "accepted_answer_id": 30428608, "answer_count": 2, "score": 6, "last_activity_date": 1532467255, "creation_date": 1432503173, "last_edit_date": 1432504960, "question_id": 30428571, "link": "https://stackoverflow.com/questions/30428571/how-to-initialize-struct-fields", "title": "How to initialize struct fields", "body": "<p>How can to initialize any fields in golang types? For example:</p>\n\n<pre><code>type MyType struct {\n    Field string = \"default\" \n} \n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 13734, "user_id": 938694, "user_type": "registered", "accept_rate": 59, "profile_image": "https://www.gravatar.com/avatar/b6678a430a805dd78366d6e135b49f2d?s=128&d=identicon&r=PG", "display_name": "Cubic", "link": "https://stackoverflow.com/users/938694/cubic"}, "is_accepted": true, "score": 2, "last_activity_date": 1432496198, "creation_date": 1432496198, "answer_id": 30427553, "question_id": 30427413, "link": "https://stackoverflow.com/questions/30427413/golang-how-do-you-use-a-pointer-on-a-struct-that-hasnt-been-initialized-yet/30427553#30427553", "title": "Golang: How do you use a pointer on a struct that hasn&#39;t been initialized yet", "body": "<p>Go is a <a href=\"http://en.wikipedia.org/wiki/Garbage_collection_%28computer_science%29\" rel=\"nofollow\">garbage collected</a> language. The struct the pointer is pointing to will be valid as long as there's a reference to it. Multiple connections have nothing to do with this, as this creates a new <code>record</code> every time <code>LogAccess</code> is called, and if you follow the code in question you'll see that the reference lives at least to the end of <code>writeAccessLog</code>, possibly longer depending on the implementation of <code>glog.Infoln</code>.</p>\n\n<p>To be clear <code>&amp;someType { ... fields ...}</code> creates a new (unnamed) instance of <code>someType</code>, and then returns the address of that instance.</p>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "accepted_answer_id": 30427553, "answer_count": 1, "score": -2, "last_activity_date": 1432496198, "creation_date": 1432495398, "last_edit_date": 1432495761, "question_id": 30427413, "link": "https://stackoverflow.com/questions/30427413/golang-how-do-you-use-a-pointer-on-a-struct-that-hasnt-been-initialized-yet", "title": "Golang: How do you use a pointer on a struct that hasn&#39;t been initialized yet", "body": "<p>So I was looking at the <a href=\"https://github.com/jadekler/git-go-websiteskeleton/blob/master/app/common/access.go\" rel=\"nofollow\">file here</a>.</p>\n\n<p>They call <code>record := &amp;accessLog</code> but they don't ever Initialize it as a variable first and if they do it that way if there are multiple simultaneous connections is there a possibility record will get over written with somebody else's data? </p>\n\n<pre><code>type accessLog struct {\nip, method, uri, protocol, host     string\nelapsedTime                         time.Duration\n}\n\nfunc LogAccess(w http.ResponseWriter, req *http.Request, duration time.Duration) {\nclientIP := req.RemoteAddr\n\nif colon := strings.LastIndex(clientIP, \":\"); colon != -1 {\n    clientIP = clientIP[:colon]\n}\n\nrecord := &amp;accessLog{\n    ip:             clientIP,\n    method:         req.Method,\n    uri:            req.RequestURI,\n    protocol:       req.Proto,\n    host:           req.Host,\n    elapsedTime:    duration,\n}\n\nwriteAccessLog(record)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 3, "creation_date": 1432498346, "post_id": 30427289, "comment_id": 48940602, "body": "See section &quot;Build Constraints&quot; in <a href=\"http://golang.org/pkg/go/build/\" rel=\"nofollow noreferrer\">golang.org/pkg/go/build</a>. But please think of a different solution first (maybe command line flags?). Go is not C."}], "answers": [{"comments": [{"owner": {"reputation": 76487, "user_id": 34218, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f657c6adf1e623cd6f8818408ecd8f75?s=128&d=identicon&r=PG", "display_name": "Jason Coco", "link": "https://stackoverflow.com/users/34218/jason-coco"}, "edited": false, "score": 0, "creation_date": 1432587715, "post_id": 30427615, "comment_id": 48973924, "body": "Glad I saw this answer! I was about to research how to do something like this in Go specifically for version numbers and commit tagging at build!"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 6, "last_activity_date": 1432496913, "last_edit_date": 1432496913, "creation_date": 1432496587, "answer_id": 30427615, "question_id": 30427289, "link": "https://stackoverflow.com/questions/30427289/can-i-pass-to-build-command-flag-and-read-inside-code/30427615#30427615", "title": "Can I pass to build command flag and read inside code?", "body": "<p>Create a string variable that you can test. Then set that string variable using <code>-X</code> passed to the linker. For example:</p>\n\n<pre><code>package main\n\nvar MODE string\n\nfunc main() {\n    if MODE == \"PROD\" {\n        println(\"I'm in prod mode\")\n    } else {\n        println(\"I'm NOT in prod mode\")\n    }\n\n}\n</code></pre>\n\n<p>Now, if you build this with just <code>go build</code>, <code>MODE</code> will be <code>\"\"</code>. But you can also build it this way:</p>\n\n<pre><code>go build -ldflags \"-X main.MODE PROD\"\n</code></pre>\n\n<p>And now <code>MODE</code> will be <code>\"PROD\"</code>. You can use that to modify your logic based on build settings. I generally use this technique to set version numbers in the binary; but it can be used for all kinds of build-time configuration. Note that it can only set strings. So you couldn't make <code>MODE</code> a bool or integer.</p>\n\n<hr>\n\n<p>You can also achieve this with tags, which are slightly more complicated to set up, but much more powerful. Create three files:</p>\n\n<h3>main.go</h3>\n\n<pre><code>package main\n\nfunc main() {\n    doThing()\n}\n</code></pre>\n\n<h3>main_prod.go</h3>\n\n<pre><code>// +build prod\n\npackage main\n\nfunc doThing() {\n    println(\"I'm in prod mode\")\n}\n</code></pre>\n\n<h3>main_devel.go</h3>\n\n<pre><code>// +build !prod\n\npackage main\n\nfunc doThing() {\n    println(\"I'm NOT in prod mode\")\n}\n</code></pre>\n\n<p>Now when you build with <code>go build</code>, you'll get your <code>main_devel.go</code> version (the filename doesn't matter; just the <code>// +build !prod</code> line at the top). But you can get a production build by building with <code>go build -tags prod</code>.</p>\n\n<p>See the section on Build Constraints in the <a href=\"http://golang.org/pkg/go/build/\" rel=\"noreferrer\">build</a> documentation.</p>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 298, "favorite_count": 1, "accepted_answer_id": 30427615, "answer_count": 1, "score": 1, "last_activity_date": 1432496913, "creation_date": 1432494685, "question_id": 30427289, "link": "https://stackoverflow.com/questions/30427289/can-i-pass-to-build-command-flag-and-read-inside-code", "title": "Can I pass to build command flag and read inside code?", "body": "<p>I want in init function to execute one of those two lines</p>\n\n<pre><code>func init() {\n    log.SetPrefix(\"&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;   \")\n\n\n    log.SetOutput(ioutil.Discard)\n}\n</code></pre>\n\n<p>How to achieve something similiar to C and macro definition in make file ?\nI build go program like go build my_project and I don't have any custom make file. Can I pass to build command flag and read inside code ?</p>\n"}, {"tags": ["unit-testing", "testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 6442, "user_id": 10452, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fcbed0b3168e95ca616f886bca3d464d?s=128&d=identicon&r=PG", "display_name": "DonGar", "link": "https://stackoverflow.com/users/10452/dongar"}, "edited": false, "score": 0, "creation_date": 1432519477, "post_id": 30427313, "comment_id": 48945183, "body": "I was trying to keep the question simple, but maybe I over did it.. I&#39;m sending data to one component that may passf to other components, who may pass to other components. The pass off chain can include branches and forks and all kinds of complexity.  That makes this (otherwise excellent) suggestion not so useful."}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 6442, "user_id": 10452, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fcbed0b3168e95ca616f886bca3d464d?s=128&d=identicon&r=PG", "display_name": "DonGar", "link": "https://stackoverflow.com/users/10452/dongar"}, "edited": false, "score": 0, "creation_date": 1432559527, "post_id": 30427313, "comment_id": 48961179, "body": "Yeah, that&#39;s the point. All your components in the chain should receive the <code>done</code> channel as a part of their aysnc job. Otherwise, you&#39;ll be wasting CPU and your go-routines will have to wake up and poll."}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 6442, "user_id": 10452, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fcbed0b3168e95ca616f886bca3d464d?s=128&d=identicon&r=PG", "display_name": "DonGar", "link": "https://stackoverflow.com/users/10452/dongar"}, "edited": false, "score": 0, "creation_date": 1432573499, "post_id": 30427313, "comment_id": 48967831, "body": "@DonGar You may also be interested in <code>net&#47;context</code> and <a href=\"http://blog.golang.org/pipelines\" rel=\"nofollow noreferrer\">blog.golang.org/pipelines</a>. There are some very good existing Go patterns for complex cross-component chains. (Doesn&#39;t change the testability question, but may influence your concurrency design.)"}, {"owner": {"reputation": 1967, "user_id": 1031871, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/7g8bJ.jpg?s=128&g=1", "display_name": "Arun Gopalpuri", "link": "https://stackoverflow.com/users/1031871/arun-gopalpuri"}, "edited": false, "score": 0, "creation_date": 1614158523, "post_id": 30427313, "comment_id": 117297459, "body": "Isn&#39;t select without default blocking and causes race conditions in the above example? e.g. <a href=\"https://gobyexample.com/non-blocking-channel-operations\" rel=\"nofollow noreferrer\">gobyexample.com/non-blocking-channel-operations</a>"}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": false, "score": 8, "last_activity_date": 1432494817, "creation_date": 1432494817, "answer_id": 30427313, "question_id": 30427013, "link": "https://stackoverflow.com/questions/30427013/testing-for-asynchronous-results-without-sleep-in-go/30427313#30427313", "title": "Testing for asynchronous results without sleep in Go", "body": "<p>The idiomatic way is to pass a <code>done</code> channel along with your data to the worker go-routine. The go-routine should <code>close</code> the <code>done</code> channel and your code should wait until the channel is closed:</p>\n\n<pre><code>done := make(chan bool)\n\n// Send notification event.\nmock.devices &lt;- Job {\n    Data: []sparkapi.Device{deviceA, deviceFuncs, deviceRefresh},\n    Done: done,\n}\n\n// Wait until `done` is closed.\n&lt;-done\n\n// Check that no refresh method was called.\nc.Check(mock.actionArgs, check.DeepEquals, mockFunctionCall{})\n</code></pre>\n\n<p>Using this pattern, you can also implement a timeout for your test:</p>\n\n<pre><code>// Wait until `done` is closed.\nselect {\ncase &lt;-done:\ncase &lt;-time.After(10 * time.Second):\n    panic(\"timeout\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 7, "last_activity_date": 1432495876, "last_edit_date": 1432495876, "creation_date": 1432495063, "answer_id": 30427356, "question_id": 30427013, "link": "https://stackoverflow.com/questions/30427013/testing-for-asynchronous-results-without-sleep-in-go/30427356#30427356", "title": "Testing for asynchronous results without sleep in Go", "body": "<p>Soheil Hassas Yeganeh's solution is usually a good way to go, or at least something like it. But it is a change to the API, and it can create some overhead for the caller (though not much; the caller doesn't <em>have</em> to pass a <code>Done</code> channel if the caller doesn't need it). That said, there are cases where you don't want that kind of ACK system.</p>\n\n<p>I highly recommend the testing package <a href=\"http://onsi.github.io/gomega/\" rel=\"noreferrer\">Gomega</a> for that kind of problem. It's designed to work with <a href=\"http://onsi.github.io/ginkgo/\" rel=\"noreferrer\">Ginkgo</a>, but can be used standalone. It includes excellent async support via the <code>Consistently</code> and <code>Eventually</code> matchers.</p>\n\n<p>That said, while Gomega works well with non-BDD test systems (and integrates fine into <code>testing</code>), it is a pretty big thing and can be a commitment. If you just want that one piece, you can write your own version of these assertions. I recommend following Gomega's approach though, which is polling rather than just a single sleep (this still sleeps; it isn't possible to fix that without redesigning your API).</p>\n\n<p>Here's how to watch for things in testing. You create a helper function like:</p>\n\n<p><a href=\"http://play.golang.org/p/qpdEOsWYh0\" rel=\"noreferrer\">http://play.golang.org/p/qpdEOsWYh0</a></p>\n\n<pre><code>const iterations = 10\nconst interval = time.Millisecond\n\nfunc Consistently(f func()) {\n    for i := 0; i &lt; iterations; i++ {\n        f() // Assuming here that `f()` panics on failure\n        time.Sleep(interval)\n    }\n}\n\nmock.devices &lt;- []sparkapi.Device{deviceA, deviceFuncs, deviceRefresh}\nConsistently(c.Check(mock.actionArgs, check.DeepEquals, mockFunctionCall{}))\n</code></pre>\n\n<p>Obviously you can tweak iterations and interval to match your needs. (Gomega uses a 1 second timeout, polling every 10ms.)</p>\n\n<p>The downside of any implementation of <code>Consistently</code> is that whatever your timeout, you have to eat that every test run. But there's really no way around that. You have to decide how long is long enough to \"not happen.\" When possible, it's nice to turn your test around to check for <code>Eventually</code>, since that can succeed faster.</p>\n\n<p><code>Eventually</code> is a little more complicated, since you'll need to use <code>recover</code> to catch the panics until it succeeds, but it's not too bad. Something like this:</p>\n\n<pre><code>func Eventually(f func()) {\n    for i := 0; i &lt; iterations; i++ {\n        if !panics(f) {\n            return\n        }\n        time.Sleep(interval)\n    }\n    panic(\"FAILED\")\n}\n\nfunc panics(f func()) (success bool) {\n    defer func() {\n        if e := recover(); e != nil {\n            success = true\n        }\n    }()\n    f()\n    return\n}\n</code></pre>\n\n<p>Ultimately, this is just a slightly more complicated version of what you have, but it wraps the logic up into a function so it reads a bit better.</p>\n"}], "owner": {"reputation": 6442, "user_id": 10452, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fcbed0b3168e95ca616f886bca3d464d?s=128&d=identicon&r=PG", "display_name": "DonGar", "link": "https://stackoverflow.com/users/10452/dongar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8787, "favorite_count": 2, "accepted_answer_id": 30427356, "answer_count": 2, "score": 12, "last_activity_date": 1432495876, "creation_date": 1432492886, "question_id": 30427013, "link": "https://stackoverflow.com/questions/30427013/testing-for-asynchronous-results-without-sleep-in-go", "title": "Testing for asynchronous results without sleep in Go", "body": "<p>I have quite a few components in my code that have persistent go-routines that listen for events to trigger actions. Most of the time, there is no reason (outside of testing) for them to send back a notification when they have completed that action.</p>\n\n<p>However, my unittests are using sleep to wait for these async tasks to complete:</p>\n\n<pre><code>// Send notification event.\nmock.devices &lt;- []sparkapi.Device{deviceA, deviceFuncs, deviceRefresh}\n\n// Wait for go-routine to process event.\ntime.Sleep(time.Microsecond)\n\n// Check that no refresh method was called.\nc.Check(mock.actionArgs, check.DeepEquals, mockFunctionCall{})\n</code></pre>\n\n<p>That seems broken, but I haven't been able to come up with a better solution that doesn't add unreasonable overhead to non-test usage. Is there a reasonable solution that I've missed?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "edited": false, "score": 0, "creation_date": 1432482477, "post_id": 30424935, "comment_id": 48935914, "body": "It&#39;s a convenience construct ... same goes with var <code>var x,y &lt;T&gt; or var( x &lt;T&gt; y &lt;T2&gt; )</code>"}, {"owner": {"reputation": 3643, "user_id": 4206925, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/PhlNi.png?s=128&g=1", "display_name": "MewX", "link": "https://stackoverflow.com/users/4206925/mewx"}, "edited": false, "score": 1, "creation_date": 1520155154, "post_id": 30424935, "comment_id": 85192776, "body": "Well, a member said Go was opinionated to do so: <a href=\"https://github.com/golang/go/issues/14428\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/14428</a>"}], "answers": [{"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 18, "last_activity_date": 1548582720, "last_edit_date": 1548582720, "creation_date": 1432480480, "answer_id": 30425069, "question_id": 30424935, "link": "https://stackoverflow.com/questions/30424935/why-is-the-factored-import-statement-better/30425069#30425069", "title": "Why is the factored import statement better?", "body": "<p>There is no difference except for the amount of typing you have to do. A good sized program or package can easily have a dozen or more imported packages so why keep typing the same word (<code>import</code>) time and again when you can achieve the same with a pair of ().</p>\n\n<p>Though most people probably use <a href=\"https://godoc.org/golang.org/x/tools/cmd/goimports\" rel=\"noreferrer\">GoImports</a> nowadays anyway.</p>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 6, "last_activity_date": 1432495664, "creation_date": 1432495664, "answer_id": 30427459, "question_id": 30424935, "link": "https://stackoverflow.com/questions/30424935/why-is-the-factored-import-statement-better/30427459#30427459", "title": "Why is the factored import statement better?", "body": "<p>There is absolutely no difference for a go compiler. The difference is only for a go programmer in how many times he has to copy/type import. You can look at it in the same way as:</p>\n\n<pre><code>func f1(n1, n2, n3 int){\n    ...\n}\n</code></pre>\n\n<p>vs</p>\n\n<pre><code>func f1(n1 int, n2 int, n3 int){\n    ...\n}\n</code></pre>\n\n<p>or <code>var n1, n2, n3 int</code> vs</p>\n\n<pre><code>var n1 int\nvar n2 int\nvar n3 int\n</code></pre>\n\n<p>both will produce the same result.</p>\n"}], "owner": {"reputation": 109227, "user_id": 1709587, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/cP8pZ.jpg?s=128&g=1", "display_name": "Mark Amery", "link": "https://stackoverflow.com/users/1709587/mark-amery"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1561, "favorite_count": 3, "answer_count": 2, "score": 20, "last_activity_date": 1548582720, "creation_date": 1432479825, "last_edit_date": 1592644375, "question_id": 30424935, "link": "https://stackoverflow.com/questions/30424935/why-is-the-factored-import-statement-better", "title": "Why is the factored import statement better?", "body": "<p>The official tour of Go, after exhibiting a factored import like this...</p>\n<pre><code>import (\n    &quot;fmt&quot;\n    &quot;math&quot;\n)\n</code></pre>\n<p>... <a href=\"https://tour.golang.org/basics/2\" rel=\"noreferrer\">contains the following slightly unclear remark</a>:</p>\n<blockquote>\n<p>You can also write multiple import statements, like:</p>\n<pre><code>import &quot;fmt&quot;\nimport &quot;math&quot;\n</code></pre>\n<p>But it is good style to use the factored import statement.</p>\n</blockquote>\n<p>Is there actually any concrete advantage to using one approach over the other - such as a difference in behaviour or an easy-to-make typo that is only a danger with one of the two syntaxes - or is this just an arbitrary style convention?</p>\n"}, {"tags": ["linux", "go", "cross-compiling", "cloud-foundry"], "comments": [{"owner": {"reputation": 1871, "user_id": 2453153, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/cMVfU.jpg?s=128&g=1", "display_name": "sunshinekitty", "link": "https://stackoverflow.com/users/2453153/sunshinekitty"}, "edited": false, "score": 2, "creation_date": 1432480261, "post_id": 30424567, "comment_id": 48935250, "body": "I would recommend upgrading to the latest golang version and filing a bug if it continues to not work."}], "answers": [{"tags": [], "owner": {"reputation": 21, "user_id": 2971386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6e448e8a905610bc3a499cac6822985?s=128&d=identicon&r=PG&f=1", "display_name": "tutturu", "link": "https://stackoverflow.com/users/2971386/tutturu"}, "is_accepted": false, "score": 0, "last_activity_date": 1436539296, "creation_date": 1436539296, "answer_id": 31343654, "question_id": 30424567, "link": "https://stackoverflow.com/questions/30424567/error-building-cf-cli-go-build-runtime-linux-386-must-be-bootstrapped-using-ma/31343654#31343654", "title": "Error building cf-cli: go build runtime: linux/386 must be bootstrapped using make.bash", "body": "<p>Please make sure you have golang-go-linux-386 installed.</p>\n\n<pre><code>sudo apt-get install golang-go-linux-386\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 4582060, "user_type": "registered", "accept_rate": 75, "profile_image": "https://lh4.googleusercontent.com/-g3EpqKVpOWA/AAAAAAAAAAI/AAAAAAAAAJ0/CiXxqnWaJx8/photo.jpg?sz=128", "display_name": "Fathima", "link": "https://stackoverflow.com/users/4582060/fathima"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 394, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436539296, "creation_date": 1432477516, "last_edit_date": 1432497726, "question_id": 30424567, "link": "https://stackoverflow.com/questions/30424567/error-building-cf-cli-go-build-runtime-linux-386-must-be-bootstrapped-using-ma", "title": "Error building cf-cli: go build runtime: linux/386 must be bootstrapped using make.bash", "body": "<p>The CLI tool for Cloud Foundry available at <a href=\"https://github.com/cloudfoundry/cli\" rel=\"nofollow\">cloudfoundry/cli</a> is written in Go. I'm trying to build the CLI tool but getting this error:</p>\n\n<p><strong>go build runtime: linux/386 must be bootstrapped using make.bash</strong></p>\n\n<p>How to solve this problem?</p>\n\n<p>Here are the contents of the <code>cli/bin/build-all.sh</code> script:</p>\n\n<pre><code>#!/bin/bash\n\nset -e\nset -x\n\nOUTDIR=$(dirname $0)/../out\n\nGOARCH=amd64 GOOS=windows $(dirname $0)/build &amp;&amp; cp $OUTDIR/cf $OUTDIR/cf-windows-amd64.exe\nGOARCH=386 GOOS=windows $(dirname $0)/build &amp;&amp; cp $OUTDIR/cf $OUTDIR/cf-windows-386.exe\nGOARCH=amd64 GOOS=linux $(dirname $0)/build  &amp;&amp; cp $OUTDIR/cf $OUTDIR/cf-linux-amd64\nGOARCH=386 GOOS=linux $(dirname $0)/build  &amp;&amp; cp $OUTDIR/cf $OUTDIR/cf-linux-386\nGOARCH=amd64 GOOS=darwin $(dirname $0)/build  &amp;&amp; cp $OUTDIR/cf $OUTDIR/cf-darwin-amd64\n</code></pre>\n\n<p>Everything works fine and gets cross compiled except for the line <code>GOARCH=386 GOOS=linux</code>, which produces this error:</p>\n\n<p><strong>go build runtime: linux/386 must be bootstrapped using make.bash</strong></p>\n\n<p>I'm running on Ubuntu 14.04 and my go version is go1.3.3 </p>\n\n<p>How to solve this problem?</p>\n"}, {"tags": ["go", "python-requests"], "answers": [{"comments": [{"owner": {"reputation": 121, "user_id": 1594410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c38d09e34d404cd8ab385e12c4d5f4f?s=128&d=identicon&r=PG", "display_name": "Jerome Guiard", "link": "https://stackoverflow.com/users/1594410/jerome-guiard"}, "edited": false, "score": 0, "creation_date": 1432541161, "post_id": 30425411, "comment_id": 48951296, "body": "Thank you for your answer : fmt.Println(r.Close) is used in order to check if the connection is close or not, the result is that as you mentionned I am running out of available ports. I was looking for a method to just release the connection after the request."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 121, "user_id": 1594410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c38d09e34d404cd8ab385e12c4d5f4f?s=128&d=identicon&r=PG", "display_name": "Jerome Guiard", "link": "https://stackoverflow.com/users/1594410/jerome-guiard"}, "edited": false, "score": 0, "creation_date": 1432559624, "post_id": 30425411, "comment_id": 48961235, "body": "@JeromeGuiard: Are you certain the ports are still open? If so, what state are they in? What OS are you using? You&#39;re probably just cycling though ephemeral ports faster than the OS will return them."}, {"owner": {"reputation": 121, "user_id": 1594410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c38d09e34d404cd8ab385e12c4d5f4f?s=128&d=identicon&r=PG", "display_name": "Jerome Guiard", "link": "https://stackoverflow.com/users/1594410/jerome-guiard"}, "edited": false, "score": 0, "creation_date": 1432566857, "post_id": 30425411, "comment_id": 48964898, "body": "I am using Ubuntu. when I use netstat there is a lot of connection to my port  8080 (http_alt) as Foreign Address with the status TIME_WAIT"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 121, "user_id": 1594410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c38d09e34d404cd8ab385e12c4d5f4f?s=128&d=identicon&r=PG", "display_name": "Jerome Guiard", "link": "https://stackoverflow.com/users/1594410/jerome-guiard"}, "edited": false, "score": 0, "creation_date": 1432578438, "post_id": 30425411, "comment_id": 48970155, "body": "@JeromeGuiard: Your ports are closed, and in TIME_WAIT. You can prevent that by allowing allowing both sides to keep the connections open so they can reused."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1432555016, "last_edit_date": 1432555016, "creation_date": 1432482687, "answer_id": 30425411, "question_id": 30424044, "link": "https://stackoverflow.com/questions/30424044/cannot-assign-requested-address-with-golang-and-net-http-packages/30425411#30425411", "title": "Cannot assign requested address with golang and net/http packages", "body": "<p>You're running out of ports. </p>\n\n<p>Since you're setting <code>w.Header().Set(\"Connection\", \"close\")</code> each request is going to take a new connection entirely. If you don't want to use up ports, re-use the connections.</p>\n\n<p>In your client, you're closing entire connection pool, which also will use up more resources. Call <code>r.close()</code> to return the connection to the pool and it will be reused if possible. Even though the response is small, it's still good practice to ensure the client consumes the entire response body. If the server can't flush its send buffers, it won't be able to efficiently handle the connections either, and it may take longer to close them. </p>\n"}], "owner": {"reputation": 121, "user_id": 1594410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c38d09e34d404cd8ab385e12c4d5f4f?s=128&d=identicon&r=PG", "display_name": "Jerome Guiard", "link": "https://stackoverflow.com/users/1594410/jerome-guiard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7439, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1551185732, "creation_date": 1432474147, "last_edit_date": 1551185732, "question_id": 30424044, "link": "https://stackoverflow.com/questions/30424044/cannot-assign-requested-address-with-golang-and-net-http-packages", "title": "Cannot assign requested address with golang and net/http packages", "body": "<p>I have this server in golang : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n )\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    w.WriteHeader(204)\n    fmt.Fprintf(w, \"Hi there, I love %s!\", r.URL.Path[1:])\n\n    w.Header().Set(\"Connection\", \"close\")\n\n    fmt.Println(r.Close)\n}\n\nfunc main() {\n\n    http.HandleFunc(\"/\", hello)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>Then I wanted to try to quickly benchmark how it can handle requests whit this python script:</p>\n\n<pre><code>import requests\n\npayload = \"test\"\n\nwhile True:\n    r = requests.post(\"http://127.0.0.1:8080/test\", data = payload)\n    r.connection.close()\n</code></pre>\n\n<p>After multiple loops it cannot assign new ports. I deduce that my server doesn't close connection (or my client).</p>\n\n<p>How should I manage connection from server side?</p>\n"}, {"tags": ["go", "reference"], "comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 3, "creation_date": 1432460296, "post_id": 30421921, "comment_id": 48929735, "body": "For the same reason <code>z := 0; x := []int{z}; update2(x); fmt.Println(z)</code> doesn&#39;t print 1000. You&#39;ve <i>copied</i> <code>my</code> into an array, modifies array element (copied one) and print out the original one (unmodified)."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1432460378, "post_id": 30421921, "comment_id": 48929752, "body": "Makes sense... Now I see the difference.."}], "answers": [{"comments": [{"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1432459950, "post_id": 30421976, "comment_id": 48929631, "body": "How is that? why update(x []int) doesn&#39;t behave same? (i.e. copy value int) What makes the struct a special case?"}, {"owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "reply_to_user": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1432460187, "post_id": 30421976, "comment_id": 48929708, "body": "@Theuserwithnohat Your code with the primitive is similar to the second approach I mention"}], "tags": [], "owner": {"reputation": 332764, "user_id": 263525, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ec289925069b35f18f1230b90dc654e5?s=128&d=identicon&r=PG", "display_name": "Denys S&#233;guret", "link": "https://stackoverflow.com/users/263525/denys-s%c3%a9guret"}, "is_accepted": true, "score": 2, "last_activity_date": 1432460421, "last_edit_date": 1432460421, "creation_date": 1432459816, "answer_id": 30421976, "question_id": 30421921, "link": "https://stackoverflow.com/questions/30421921/why-a-slice-struct-doesnt-behave-same-as-builtin/30421976#30421976", "title": "Why a slice []struct doesn&#39;t behave same as []builtin?", "body": "<p>What you do when calling <code>update3</code> is you pass a new array, containing copies of the value, and you immediately discard the array. This is different from what you do with the primitive, as you keep the array.</p>\n\n<p>There are two approaches here.</p>\n\n<p><strong>1)</strong> use an array of pointers instead of an array of values:</p>\n\n<p>You could define <code>update3</code> like this:</p>\n\n<pre><code>func update3(x []*My) {\n    x[0].Name = \"many\"\n    return\n}\n</code></pre>\n\n<p>and call it using</p>\n\n<pre><code>update3([]*My{&amp;my})\n</code></pre>\n\n<p><strong>2)</strong> write in the array (in the same way you deal with the primitive)</p>\n\n<pre><code>arr := make([]My,1)\narr[0] = My{Name: \"\"}\nupdate3(arr)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 0, "last_activity_date": 1432460123, "creation_date": 1432460123, "answer_id": 30422013, "question_id": 30421921, "link": "https://stackoverflow.com/questions/30421921/why-a-slice-struct-doesnt-behave-same-as-builtin/30422013#30422013", "title": "Why a slice []struct doesn&#39;t behave same as []builtin?", "body": "<p>From the <a href=\"https://golang.org/doc/faq#pass_by_value\" rel=\"nofollow\">GO FAQ:</a></p>\n\n<blockquote>\n  <p>As in all languages in the C family, everything in Go is passed by\n  value. That is, a function always gets a copy of the thing being\n  passed, as if there were an assignment statement assigning the value\n  to the parameter. For instance, passing an int value to a function\n  makes a copy of the int, and passing a pointer value makes a copy of\n  the pointer, but not the data it points to. (See the next section for\n  a discussion of how this affects method receivers.)</p>\n  \n  <p>Map and slice values behave like pointers: they are descriptors that\n  contain pointers to the underlying map or slice data. Copying a map or\n  slice value doesn't copy the data it points to.</p>\n</blockquote>\n\n<p>Thus when you pass <code>my</code> you are passing a copy of your struct and the calling code won't see any changes made to that copy.</p>\n\n<p>To have the function change the data in teh struct you have to pass a pointer to the struct.</p>\n"}, {"tags": [], "owner": {"reputation": 606, "user_id": 4257143, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-q195EKev0qQ/AAAAAAAAAAI/AAAAAAAAAxM/R2bEEt98Yrc/photo.jpg?sz=128", "display_name": "Doug Henderson", "link": "https://stackoverflow.com/users/4257143/doug-henderson"}, "is_accepted": false, "score": 0, "last_activity_date": 1432492563, "creation_date": 1432492563, "answer_id": 30426956, "question_id": 30421921, "link": "https://stackoverflow.com/questions/30421921/why-a-slice-struct-doesnt-behave-same-as-builtin/30426956#30426956", "title": "Why a slice []struct doesn&#39;t behave same as []builtin?", "body": "<p>Your third test is not the same as the first two. Look at this  <a href=\"https://play.golang.org/p/mHjS14FlN8\" rel=\"nofollow\">(Playground)</a>. In this case, you do not need to use pointers as you are not modifying the slice itself. You are modifying an element of the underlying array. If you wanted to modify the slice, by for instance, appending a new element, you would need to use a pointer to pass the slice by reference. Notice that I changed the prints to display the type as well as the value.</p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 65, "favorite_count": 0, "accepted_answer_id": 30421976, "answer_count": 3, "score": 1, "last_activity_date": 1432492563, "creation_date": 1432459422, "last_edit_date": 1432460225, "question_id": 30421921, "link": "https://stackoverflow.com/questions/30421921/why-a-slice-struct-doesnt-behave-same-as-builtin", "title": "Why a slice []struct doesn&#39;t behave same as []builtin?", "body": "<p>The slices are references to the underlying array. This makes sense and seems to work on builtin/primitive types but why is not working on structs? I assume that even if I update a struct field the reference/address is still the same.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype My struct {\n    Name string\n}\n\nfunc main() {\n    x := []int{1}\n    update2(x)\n    fmt.Println(x[0])\n    update(x)\n    fmt.Println(x[0])\n    my := My{Name: \"\"}\n    update3([]My{my})\n    // Why my[0].Name is not \"many\" ?\n    fmt.Println(my)\n}\n\nfunc update(x []int) {\n    x[0] = 999\n    return\n}\nfunc update2(x []int) {\n    x[0] = 1000\n    return\n}\nfunc update3(x []My) {\n    x[0].Name = \"many\"\n    return\n}\n</code></pre>\n\n<p>To clarify: I'm aware that I could use pointers for both cases. I'm only intrigued why the struct is not updated (unlike the int). </p>\n"}, {"tags": ["syntax", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1432422698, "post_id": 30418259, "comment_id": 48922679, "body": "Because <code>:=</code> would create a new <code>foo</code> shadowing the other you can&#39;t use it here. What you have is the way to do it (<code>:=</code> is just a short cut after all)."}], "answers": [{"tags": [], "owner": {"reputation": 20459, "user_id": 1120221, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/0977d36f1cf30241c35121f1d741c8e9?s=128&d=identicon&r=PG&f=1", "display_name": "Salah Eddine Taouririt", "link": "https://stackoverflow.com/users/1120221/salah-eddine-taouririt"}, "is_accepted": true, "score": 5, "last_activity_date": 1432429930, "creation_date": 1432429930, "answer_id": 30419155, "question_id": 30418259, "link": "https://stackoverflow.com/questions/30418259/how-to-differentiate-between-assigning-and-declaring-values-from-a-function-with/30419155#30419155", "title": "How to differentiate between assigning and declaring values from a function with multiple returns?", "body": "<p>In this case you can't use the short variable declarations <code>\":=\"</code> for redeclaring the <code>foo</code> variable, according to the <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>Unlike regular variable declarations, a short variable declaration may\n  redeclare variables provided they were originally declared earlier in\n  the same block with the same type, and at least one of the non-blank\n  variables is new. As a consequence, redeclaration can only appear in a\n  multi-variable short declaration. Redeclaration does not introduce a\n  new variable; it just assigns a new value to the original.</p>\n</blockquote>\n\n<p>by eliminating  <code>./app.go:16: foo declared and not used</code>.</p>\n\n<pre><code>func main() {\n    var foo = \"default\"\n    var condition = true\n    if condition {\n        foo, bar := getFooAndBar()\n        fmt.Println(bar) // prints: Bar\n        fmt.Println(foo) // prints: Foo\n        // _ = foo\n    }\n    fmt.Println(foo) // prints: default\n}\n</code></pre>\n\n<p>in this case <code>foo</code> is declared in the <code>if</code> block, this declaration will <strong>create a new variable</strong> shadowing the original <code>foo</code> variable in the outer block, the redeclaration of <code>foo</code> will happen only if you have declared <code>foo</code> and redeclared it with multi-variable short declaration within the <strong>same block</strong>.</p>\n\n<pre><code>func main() {\n    var foo = \"default\"     \n    foo, bar := getFooAndBar()\n    fmt.Println(bar) //prints: Bar\n    fmt.Println(foo) //prints: Foo\n}\n</code></pre>\n"}], "owner": {"reputation": 361, "user_id": 1859989, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f3b3166b15b7b95101d5930bb2fe8c2e?s=128&d=identicon&r=PG", "display_name": "Lorentz Lasson", "link": "https://stackoverflow.com/users/1859989/lorentz-lasson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 111, "favorite_count": 1, "accepted_answer_id": 30419155, "answer_count": 1, "score": 3, "last_activity_date": 1432429930, "creation_date": 1432420810, "question_id": 30418259, "link": "https://stackoverflow.com/questions/30418259/how-to-differentiate-between-assigning-and-declaring-values-from-a-function-with", "title": "How to differentiate between assigning and declaring values from a function with multiple returns?", "body": "<p>When retrieving multiple returns from a function, I get that you can declare variables for the values on the fly by using <code>:=</code> or assign the values to already existing variables by simply using <code>=</code>. My issue occurs when I want to assign one of the return values to an already existing variable while declaring a new variable for the other.</p>\n\n<p>I have currently solved it by only assigning the values and declaring the required variables (<code>bar</code> in this case) beforehand, as in this snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc getFooAndBar() (foo string, bar string) {\n    return \"Foo\", \"Bar\"\n}\n\nfunc main() {\n    var foo = \"default\"\n    var condition = true\n    if condition {\n        var bar string // Would like to avoid this step if possible\n        foo, bar = getFooAndBar()\n        fmt.Println(bar)\n    }\n    fmt.Println(foo)\n}\n</code></pre>\n\n<p>If I use <code>:=</code> it fails to build due to:</p>\n\n<blockquote>\n  <p>./app.go:16: foo declared and not used</p>\n</blockquote>\n\n<p>So, is it possible to somehow avoid the step declaring <code>bar</code> separately?</p>\n"}, {"tags": ["mysql", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1432414204, "post_id": 30417386, "comment_id": 48920873, "body": "You can&#39;t initialize an unexported (<code>db</code>) field in a structure from another package. Either export it (e.g. <code>DB</code>) or make a <code>New\u2026</code> function within your <code>controller</code> package that takes it as an argument."}], "answers": [{"tags": [], "owner": {"reputation": 4281, "user_id": 1491850, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/fd1125371f70fe174275e950d64885b7?s=128&d=identicon&r=PG", "display_name": "Daniel Perez", "link": "https://stackoverflow.com/users/1491850/daniel-perez"}, "is_accepted": false, "score": 1, "last_activity_date": 1432448661, "creation_date": 1432448661, "answer_id": 30420708, "question_id": 30417386, "link": "https://stackoverflow.com/questions/30417386/go-getting-unexpected-error/30420708#30420708", "title": "Go: Getting unexpected error", "body": "<p>As said in the comment, <code>db</code> is not exported, so inaccessible from other packages.</p>\n\n<p>In Go, initialization of structures is usually done with a function called <code>NewMyStructure</code>, so for example:</p>\n\n<p><code>\nfunc NewAppContext(db *sql.DB) AppContext {\n    return AppContext{db: db}\n}\n</code></p>\n\n<p>and then in your main:</p>\n\n<p><code>\nappC := controller.NewAppContext(db)\n</code></p>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 71, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1432448661, "creation_date": 1432413722, "question_id": 30417386, "link": "https://stackoverflow.com/questions/30417386/go-getting-unexpected-error", "title": "Go: Getting unexpected error", "body": "<p>In my controller package, I have a AppContext struct that looks like this:</p>\n\n<pre><code>type AppContext struct {\n      db *sql.DB\n}\n\nfunc (c *AppContext) getDB() *sql.DB {\n      return c.db\n}\n</code></pre>\n\n<p>Then I have the following codes in my main package:</p>\n\n<pre><code>func main {\n\ndb, err := sql.Open(\"mysql\",\n        //other info)\n    if err != nil {\n        log.Fatal(err)\n                return \n    }\n        err = db.Ping() \n        if err != nil {\n            log.Fatal(err)\n                return\n        }\n    defer db.Close()\n        appC := controller.AppContext{db}\n\n}\n</code></pre>\n\n<p>When building it, I get this unexpected error:</p>\n\n<pre><code>implicit assignment of unexported field 'db' in controller.AppContext literal\n</code></pre>\n\n<p>I tried looking that error up, but could not find much information on it. Is there a way to resolve this problem? </p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "edited": false, "score": 0, "creation_date": 1432398697, "post_id": 30414954, "comment_id": 48916050, "body": "Lets say i go with door number three, could you elaborate on how to do that ? Or better yet just share an example. And thanks for your answer"}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "edited": false, "score": 1, "creation_date": 1432399528, "post_id": 30414954, "comment_id": 48916318, "body": "Done, added the example. :-)"}, {"owner": {"reputation": 927, "user_id": 1208557, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cfea2437a796a38fd79e25a648a3ef6?s=128&d=identicon&r=PG&f=1", "display_name": "Jinxmcg", "link": "https://stackoverflow.com/users/1208557/jinxmcg"}, "edited": false, "score": 1, "creation_date": 1469192612, "post_id": 30414954, "comment_id": 64448481, "body": "What example? Am I missing something?"}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": true, "score": 10, "last_activity_date": 1432408238, "last_edit_date": 1432408238, "creation_date": 1432398135, "answer_id": 30414954, "question_id": 30414871, "link": "https://stackoverflow.com/questions/30414871/sharing-structs-across-multiple-packages/30414954#30414954", "title": "Sharing structs across multiple packages", "body": "<p>There are three different approaches:</p>\n\n<ol>\n<li>Keeping both server and client in the same package, as does the\n<a href=\"https://github.com/golang/go/tree/master/src/net/http\" rel=\"noreferrer\"><code>http</code></a> package.</li>\n<li>Creating separate packages (say <code>message</code>, <code>common</code>, <code>types</code>, ...) and adding your shared structures there, as does <a href=\"https://github.com/coreos/etcd/tree/master/pkg\" rel=\"noreferrer\"><code>etcd</code></a></li>\n<li>Putting them in the <code>server</code> package and importing that in the <code>client</code> package. For example, the <a href=\"https://github.com/golang/net/blob/master/websocket\" rel=\"noreferrer\"><code>x/net/websocket</code></a> package imports <code>net/http</code>.</li>\n</ol>\n\n<p>It's really a matter of personal taste.</p>\n"}], "owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1614, "favorite_count": 0, "accepted_answer_id": 30414954, "answer_count": 1, "score": 1, "last_activity_date": 1432408238, "creation_date": 1432397585, "question_id": 30414871, "link": "https://stackoverflow.com/questions/30414871/sharing-structs-across-multiple-packages", "title": "Sharing structs across multiple packages", "body": "<p>Lets say we have a client server scenario, in this situation both the server and the client speak to each other using a common message structure. So, one use <code>struct</code> to define that message structure, something like this</p>\n\n<pre><code>type Message struct {\n    SenderId int\n    Content string\n    AuthCode string\n}\n</code></pre>\n\n<p>Now to avoid repeating yourself and having a <code>Message</code> structure in both the client package and server package, what is the GoWay to address this problem ?</p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1432400131, "creation_date": 1432400131, "answer_id": 30415293, "question_id": 30414606, "link": "https://stackoverflow.com/questions/30414606/returning-multiple-values-from-function/30415293#30415293", "title": "Returning multiple values from function", "body": "<p>Unless documented otherwise (e.g. <code>io.Reader</code>),\nit's normal for Go functions/methods returning <code>a, b, c, \u2026, error</code> to expect that if <code>err != nil</code> that all other returned values are undefined and should not be used/examined.\nIt's usual (but not required) that when returning an error\nthe function/method uses whatever <a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow\">the zero value</a> is for those other return values.</p>\n\n<p>As mentioned, some functions/methods such as an <a href=\"https://golang.org/pkg/io/#Reader\" rel=\"nofollow\"><code>io.Reader</code></a>'s <code>Read(p []byte) (n int, err error)</code> explicitly state other behaviour:</p>\n\n<blockquote>\n  <p>Callers should always process the n > 0 bytes returned before\n  considering the error err.</p>\n</blockquote>\n\n<p>And any functions/methods you create that return useful values even in the case of (some) errors should probably explicitly state that.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 197, "favorite_count": 0, "accepted_answer_id": 30415293, "answer_count": 1, "score": 0, "last_activity_date": 1432400131, "creation_date": 1432395919, "question_id": 30414606, "link": "https://stackoverflow.com/questions/30414606/returning-multiple-values-from-function", "title": "Returning multiple values from function", "body": "<p>I have this function:</p>\n\n<pre><code>func GetBasicAuth(w http.ResponseWriter, r *http.Request) (string, error) {\n    secret, _, ok := r.BasicAuth()\n    if !ok {\n        return \"\", err //is this right?\n    }\n    return secret, nil\n}\n</code></pre>\n\n<p>I've had to declare that the function will return a string and an error but in reality it will return one or the other. If the BasicAuth function wasn't <code>ok</code> then I have no string to return so what do I do here - just send an empty string? This seems weird!</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 1, "creation_date": 1432391920, "post_id": 30413581, "comment_id": 48913995, "body": "Simply change the <code>NewClient</code> method to take the parameters directly instead of passing them via the object. Alternatively, make all the config members members of the client class."}, {"owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432395779, "post_id": 30413581, "comment_id": 48915159, "body": "How do i make all the config members members of the client class ?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432399241, "post_id": 30413581, "comment_id": 48916216, "body": "Your question is unclear to me. Are you writing and wanting to change the API of <code>jsonclient</code> or is it a third party package you&#39;re using? If the later, you have no guarantee the config values themselves aren&#39;t need in <code>New</code> so you can&#39;t do much other just create the Config on the fly and don&#39;t store it; like so: <a href=\"https://play.golang.org/p/YJU7Peln3p\" rel=\"nofollow noreferrer\">play.golang.org/p/YJU7Peln3p</a>"}, {"owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "edited": false, "score": 0, "creation_date": 1432405026, "post_id": 30413581, "comment_id": 48918232, "body": "This is a package i wrote, just for learning purposes. What i want, and i not sure if its possible in Go, is to create an instance of jsonclient, with all its structs and methods and get data based on the context of that package, being the context defined by me, the config part.  Your example creates a copy of struct and only allows me to set and get properties, i wish to also run methods"}, {"owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "edited": false, "score": 0, "creation_date": 1432405602, "post_id": 30413581, "comment_id": 48918387, "body": "Something like this <a href=\"https://play.golang.org/p/GOXA1ZXcIO\" rel=\"nofollow noreferrer\">play.golang.org/p/GOXA1ZXcIO</a> but that works across packages"}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1432441076, "post_id": 30413581, "comment_id": 48925851, "body": "There is nothing in that playground program that won&#39;t work across packages.  All the methods are exported, so could be called from other packages."}], "answers": [{"comments": [{"owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "edited": false, "score": 0, "creation_date": 1432395437, "post_id": 30414096, "comment_id": 48915062, "body": "Heres a snippet of what i have now <a href=\"http://pastebin.com/hWAPVJr1\" rel=\"nofollow noreferrer\">pastebin.com/hWAPVJr1</a> But on the main package i get <code>type jsonclient.Client has no field or method SetUrl)</code> i&#39;ve tried setting the retrieval param as value and as pointer and got the same error"}], "tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 4, "last_activity_date": 1432392738, "creation_date": 1432392738, "answer_id": 30414096, "question_id": 30413581, "link": "https://stackoverflow.com/questions/30413581/accessing-methods-on-a-struct-from-a-different-package/30414096#30414096", "title": "Accessing methods on a struct from a different package", "body": "<p>You can call methods on types from another package provided those methods are exported (that is, starting with a capital letter).  So there is nothing stopping you from adding such methods to your type: you'd just need to name them e.g. <code>SetUrl</code> instead of <code>setUrl</code>.</p>\n"}], "owner": {"reputation": 218, "user_id": 1116856, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/de68f666ad4ecf47e1c0bf43a12c74d9?s=128&d=identicon&r=PG", "display_name": "norwat", "link": "https://stackoverflow.com/users/1116856/norwat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 492, "favorite_count": 0, "accepted_answer_id": 30414096, "answer_count": 1, "score": -2, "last_activity_date": 1432392738, "creation_date": 1432389710, "last_edit_date": 1495542251, "question_id": 30413581, "link": "https://stackoverflow.com/questions/30413581/accessing-methods-on-a-struct-from-a-different-package", "title": "Accessing methods on a struct from a different package", "body": "<p>My question is somewhat related to <a href=\"https://stackoverflow.com/questions/21198858/go-how-to-import-a-struct-that-is-inside-of-other-package\">this</a> but rather than extending an existing type im trying to create my own. My goal is to have something like this, coming from java</p>\n\n<pre><code>JsonClient j = new JsonClient()\nj.setUrl(\"x.com\")\nj.setMethod(GET)\nj.setData(\"{crap: morecrap}\")\nString result = j.send\n</code></pre>\n\n<p>But in go the best i can do is</p>\n\n<pre><code>config := jsonclient.Config{}\nconfig.Url = \"http://foaas.com/version\"\nconfig.Data = []byte(`{datadatadata}`)\nconfig.Method = \"GET\"\n\ns, err := jsonclient.NewClient(&amp;config)\ncheckErr(err)\n\nresponse := jsonclient.Dial(s)\n</code></pre>\n\n<p>I do not wish to have a config object just to setup a jsonclient\ninstance, since it only has meaning in the, dont hit me, jsonclient\nclass so i should be able to do jsonclient.SetUrl and so on, seams more\nefficient and would help me understand a couple of key points im missing\nin go.</p>\n\n<p>You can find the jsonclient <a href=\"http://pastebin.com/ndyeVL6j\" rel=\"nofollow noreferrer\">here</a></p>\n"}, {"tags": ["unit-testing", "go", "mocking"], "answers": [{"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 4, "last_activity_date": 1432395864, "last_edit_date": 1432395864, "creation_date": 1432393612, "answer_id": 30414214, "question_id": 30413537, "link": "https://stackoverflow.com/questions/30413537/how-to-mock-http-head/30414214#30414214", "title": "How to mock http.Head()", "body": "<p>The <code>http.Head</code> function simply calls the <a href=\"http://golang.org/pkg/net/http/#Client.Head\" rel=\"nofollow\"><code>Head</code> method</a> on the default HTTP client (exposed as <code>http.DefaultClient</code>).  By replacing the default client within your test, you can change the behaviour of these standard library functions.</p>\n\n<p>In particular, you will want a client that sets a custom transport (any object implementing the <a href=\"http://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow\"><code>http.RoundTripper</code></a> interface).  Something like the following:</p>\n\n<pre><code>type testTransport struct{}\n\nfunc (t testTransport) RoundTrip(request *http.Request) (*http.Response, error) {\n    # Check expectations on request, and return an appropriate response\n}\n\n...\n\nsavedClient := http.DefaultClient\nhttp.DefaultClient = &amp;http.Client{\n    Transport: testTransport{},\n}\n\n# perform tests that call http.Head, http.Get, etc\n\nhttp.DefaultClient = savedClient\n</code></pre>\n\n<p>You could also use this technique to mock network errors by returning an error from your transport rather than an HTTP response.</p>\n"}], "owner": {"reputation": 232, "user_id": 382816, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2f0fd44e10fa4184965b22ebf5cdbd30?s=128&d=identicon&r=PG", "display_name": "stijnvn", "link": "https://stackoverflow.com/users/382816/stijnvn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 384, "favorite_count": 1, "accepted_answer_id": 30414214, "answer_count": 1, "score": 3, "last_activity_date": 1432395864, "creation_date": 1432389418, "question_id": 30413537, "link": "https://stackoverflow.com/questions/30413537/how-to-mock-http-head", "title": "How to mock http.Head()", "body": "<p>I'm studying the outyet example project from <a href=\"https://github.com/golang/example/tree/master/outyet\" rel=\"nofollow\">https://github.com/golang/example/tree/master/outyet</a>. The <a href=\"https://github.com/golang/example/blob/master/outyet/main_test.go\" rel=\"nofollow\">test file</a> does not cover the case where <a href=\"https://github.com/golang/example/blob/master/outyet/main.go#L98\" rel=\"nofollow\"><code>http.Head(url)</code></a> returns an error. I would like to extend the unit tests to cover the if statement where the error is logged (<a href=\"https://github.com/golang/example/blob/master/outyet/main.go#L100\" rel=\"nofollow\">https://github.com/golang/example/blob/master/outyet/main.go#L100</a>). I would like to mock <code>http.Head()</code>, but I'm not sure how to do this. How can this be done?</p>\n"}, {"tags": ["macos", "ubuntu", "go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432396820, "post_id": 30413783, "comment_id": 48915483, "body": "Your given format strings are not applicable to Go (which is what this question is about). In Go format strings you use &quot;05.000&quot; if you want exactly three digits after the decimal or &quot;05.999&quot; if you want up-to three with trailing zeros removed (of course use fewer or more 0&#39;s or 9&#39;s as desired). In Go when parsing, it will always accept and parse fractional seconds."}, {"owner": {"reputation": 1417, "user_id": 2531850, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/BZU8G.jpg?s=128&g=1", "display_name": "Kyle Truscott", "link": "https://stackoverflow.com/users/2531850/kyle-truscott"}, "edited": false, "score": 0, "creation_date": 1432411582, "post_id": 30413783, "comment_id": 48920075, "body": "Thanks for the reply @gnasher729. You inferred correctly that I&#39;m working on an iOS app. I wish NSDateFormatter was a little smarter with this stuff. There&#39;s no <i>easy</i> way to normalize the dates from Go to whole seconds, so I&#39;ll just try a pair of formatters like you suggest"}], "tags": [], "owner": {"reputation": 47569, "user_id": 3255455, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5993e7ece129141878cd6419d39cc26e?s=128&d=identicon&r=PG&f=1", "display_name": "gnasher729", "link": "https://stackoverflow.com/users/3255455/gnasher729"}, "is_accepted": false, "score": 0, "last_activity_date": 1432390922, "creation_date": 1432390922, "answer_id": 30413783, "question_id": 30413324, "link": "https://stackoverflow.com/questions/30413324/golang-json-time-default-layout-varies-by-platform/30413783#30413783", "title": "Golang JSON time default layout varies by platform?", "body": "<p>RFC3339 doesn't say anything about the precision of the time. Seems that Ubuntu insists on adding another nine decimal digits of precision, which is fine according to RFC3339. </p>\n\n<p>On iOS / MacOS X the same date format parser cannot parse seconds with and without a decimal point, so I use two formats</p>\n\n<pre><code>\"yyyy'-'MM'-'dd'T'HH':'mm':'ssX5\"\n\"yyyy'-'MM'-'dd'T'HH':'mm':'ss.SSSSSSSSSX5\"\n</code></pre>\n\n<p>and try both. (Actually I had six S characters because I thought nobody sane would use more than six decimals. That was wrong). </p>\n\n<p>I think the date formats in iOS / MacOS X are standardised by the Unicode standard, so that might apply to other parsers as well. For efficiency reasons, I would remember which parser worked the last time and try that one first - if you got one date with nanoseconds, then the next date is likely to have nanoseconds as well. </p>\n"}, {"comments": [{"owner": {"reputation": 1417, "user_id": 2531850, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/BZU8G.jpg?s=128&g=1", "display_name": "Kyle Truscott", "link": "https://stackoverflow.com/users/2531850/kyle-truscott"}, "edited": false, "score": 0, "creation_date": 1432411279, "post_id": 30414880, "comment_id": 48919999, "body": "Thanks! Yeah I realize now it&#39;s not really a go problem. The client consuming this will have to be able to take both. I assume there&#39;s some difference on the filesystem."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 2, "last_activity_date": 1432397618, "creation_date": 1432397618, "answer_id": 30414880, "question_id": 30413324, "link": "https://stackoverflow.com/questions/30413324/golang-json-time-default-layout-varies-by-platform/30414880#30414880", "title": "Golang JSON time default layout varies by platform?", "body": "<p>The source for <code>time.Time</code>'s <a href=\"https://golang.org/pkg/time/#Time.MarshalJSON\" rel=\"nofollow\"><code>MarshalJSON</code></a> is:</p>\n\n<pre><code>// MarshalJSON implements the json.Marshaler interface.\n// The time is a quoted string in RFC 3339 format, with sub-second precision added if present.\nfunc (t Time) MarshalJSON() ([]byte, error) {\n        if y := t.Year(); y &lt; 0 || y &gt;= 10000 {\n                // RFC 3339 is clear that years are 4 digits exactly.\n                // See golang.org/issue/4556#c15 for more discussion.\n                return nil, errors.New(\"Time.MarshalJSON: year outside of range [0,9999]\")\n        }\n        return []byte(t.Format(`\"` + RFC3339Nano + `\"`)), nil\n}\n</code></pre>\n\n<p>[<a href=\"https://github.com/golang/go/blob/883bc6ed0ea815293fe6309d66f967ea60630e87/src/time/time.go#L932\" rel=\"nofollow\"><code>time.MarshalJSON</code> source on GitHub</a>]</p>\n\n<p>and is the same on all platforms.\nNote:</p>\n\n<blockquote>\n  <p>[\u2026] with sub-second precision added if present.</p>\n</blockquote>\n\n<p>And that <code>RFC3339Nano = \"2006-01-02T15:04:05.999999999Z07:00\"</code>.\nThe \"9\"'s mean use <strong>up-to</strong> that many digits but remove trailing zeros.\nSo it looks like both your examples can match this format.\n(And when parsing times Go always accepts and parses fractional seconds no matter what the format says).</p>\n\n<p>Section\u00a05.6 of <a href=\"https://www.ietf.org/rfc/rfc3339.txt\" rel=\"nofollow\">RFC3339</a> specifies that the fractional seconds are optional and may or may not be included (only saying that if the decimal point is present it must be followed by at least one digit).</p>\n\n<p>For some reason does the time you're using on one system only have second accuracy or some such? (e.g.\u00a0does this come from some filesystem or other sub-system that only stores seconds on one of the OSes?).</p>\n"}], "owner": {"reputation": 1417, "user_id": 2531850, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/BZU8G.jpg?s=128&g=1", "display_name": "Kyle Truscott", "link": "https://stackoverflow.com/users/2531850/kyle-truscott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 758, "favorite_count": 0, "accepted_answer_id": 30414880, "answer_count": 2, "score": 2, "last_activity_date": 1432397618, "creation_date": 1432388057, "question_id": 30413324, "link": "https://stackoverflow.com/questions/30413324/golang-json-time-default-layout-varies-by-platform", "title": "Golang JSON time default layout varies by platform?", "body": "<p>I'm having a strange issue where the JSON encoded string of a <code>time.Time</code> is varying between my development environment (OSX) and production environment (Ubuntu 14.04 x64). </p>\n\n<pre><code>type Thang struct {\n  CreatedAt time.Time `json:\"created_at\"`\n}\n</code></pre>\n\n<p>OSX:</p>\n\n<pre><code>{\n  // RFC3339 layout\n  created_at: \"2015-04-24T22:39:59Z\",\n}\n</code></pre>\n\n<p>Ubuntu 14.04 x64:</p>\n\n<pre><code>{\n  // RFC3339Nano layout\n  created_at: \"2015-05-21T15:00:46.546000003Z\",\n}\n</code></pre>\n\n<p>I've googled around forever. Can't figure this one out. Here's some more info:</p>\n\n<ul>\n<li>It's a straight forward web services app</li>\n<li>Running <code>go 1.4.1</code> on my OSX machine</li>\n<li>I cross compile the app on my OSX machine for deployment like this:\n<ul>\n<li><code>GOOS=linux GOARCH=amd64 go build</code></li>\n</ul></li>\n</ul>\n\n<p>Would appreciate any insight!</p>\n"}, {"tags": ["google-app-engine", "go", "google-cloud-platform"], "answers": [{"tags": [], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "is_accepted": true, "score": 1, "last_activity_date": 1432385669, "creation_date": 1432385669, "answer_id": 30412915, "question_id": 30412885, "link": "https://stackoverflow.com/questions/30412885/go-appengine-panic-proto-duplicate-enum-registered-appengine-logserviceerror/30412915#30412915", "title": "go appengine: panic: proto: duplicate enum registered: appengine.LogServiceError_ErrorCode", "body": "<p>OK, I got it: I had to delete my $GOPATH/src/google.golang.org/appengine/ folder, and then re-run goapp get from my app to re-fetch the deps in the new format. This fixed the issue mentioned above. </p>\n"}], "owner": {"reputation": 5183, "user_id": 2534777, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f9d1450403b864d6b17f30ba0ce0aee3?s=128&d=identicon&r=PG", "display_name": "orcaman", "link": "https://stackoverflow.com/users/2534777/orcaman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1050, "favorite_count": 0, "accepted_answer_id": 30412915, "answer_count": 1, "score": 2, "last_activity_date": 1432385669, "creation_date": 1432385491, "question_id": 30412885, "link": "https://stackoverflow.com/questions/30412885/go-appengine-panic-proto-duplicate-enum-registered-appengine-logserviceerror", "title": "go appengine: panic: proto: duplicate enum registered: appengine.LogServiceError_ErrorCode", "body": "<p>I've recently updated my golang GAE SDK (goapp version is now go1.4.2 (appengine-1.9.21) darwin/amd64), and I'm getting this error now when trying to serve the app:</p>\n\n<pre><code>orcaman$ goapp version\ngo version go1.4.2 (appengine-1.9.21) darwin/amd64\n\nOrs-MacBook-Pro:main orcaman$ goapp serve\n\nINFO     2015-05-23 12:45:38,666 devappserver2.py:745] Skipping SDK update check.\nINFO     2015-05-23 12:45:38,778 api_server.py:190] Starting API server at: http://localhost:57135\nINFO     2015-05-23 12:45:38,784 dispatcher.py:192] Starting module \"default\" running at: http://localhost:8080\nINFO     2015-05-23 12:45:38,785 admin_server.py:118] Starting admin server at: http://localhost:8000\nERROR    2015-05-23 12:45:43,640 http_runtime.py:343] bad runtime process port ['']\npanic: proto: duplicate enum registered: appengine.LogServiceError_ErrorCode\n\ngoroutine 1 [running]:\ngithub.com/golang/protobuf/proto.RegisterEnum(0x5be130, 0x23, 0xc2080b1470, 0xc2080b14a0)\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/github.com/golang/protobuf/proto/properties.go:739 +0xe1\ngoogle.golang.org/appengine/internal/log.init\u00b71()\n    /Users/orcaman/github.com/streamrail/go/src/google.golang.org/appengine/internal/log/log_service.pb.go:897 +0x4c\ngoogle.golang.org/appengine/internal/log.init()\n    /var/folders/dv/g8_pdljx49gdtbs25_1ch7vm0000gn/T/tmpW9bYiGappengine-go-bin/_extra_imports_9.go:7 +0x191\ngoogle.golang.org/appengine/log.init()\n    /var/folders/dv/g8_pdljx49gdtbs25_1ch7vm0000gn/T/tmpW9bYiGappengine-go-bin/_extra_imports_25.go:7 +0x4f\ngithub.com/streamrail/appengine/website.init()\n    /var/folders/dv/g8_pdljx49gdtbs25_1ch7vm0000gn/T/tmpW9bYiGappengine-go-bin/_extra_imports_36.go:7 +0x68\nmain04809.init()\n    _extra_imports_42.go:7 +0x51\nmain.init()\n    _go_main.go:18 +0x42\n\ngoroutine 2 [runnable]:\nruntime.forcegchelper()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/proc.go:90\nruntime.goexit()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 3 [runnable]:\nruntime.bgsweep()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/mgc0.go:82\nruntime.goexit()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/asm_amd64.s:2232 +0x1\n\ngoroutine 4 [runnable]:\nruntime.runfinq()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/malloc.go:712\nruntime.goexit()\n    /private/var/folders/00/0v42r000h01000cxqpysvccm003chb/T/appengine/go_appengine/goroot/src/runtime/asm_amd64.s:2232 +0x1\n</code></pre>\n\n<p>after reading <a href=\"https://code.google.com/p/googleappengine/issues/detail?id=11670\" rel=\"nofollow\">this</a>, I though this might be related to having refs to both the new \"google.golang.org/appengine\" and old \"appengine\" packages at the same time, but my application now does not have a single ref to \"appengine\". </p>\n\n<p>help?</p>\n"}, {"tags": ["if-statement", "go"], "comments": [{"owner": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1432371254, "post_id": 30410558, "comment_id": 48908330, "body": "<a href=\"http://play.golang.org/p/587tQh8urW\" rel=\"nofollow noreferrer\">play.golang.org/p/587tQh8urW</a>"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 3244, "user_id": 687438, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5cabf9d1f557d1ebb90dbe683981aca6?s=128&d=identicon&r=PG", "display_name": "Martin Gallagher", "link": "https://stackoverflow.com/users/687438/martin-gallagher"}, "edited": false, "score": 0, "creation_date": 1432372283, "post_id": 30410558, "comment_id": 48908581, "body": "@MartinGallagher, I&#39;ve tried that way before. It not works with error <code>panic: echo: unknown handler</code>"}], "answers": [{"comments": [{"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432378233, "post_id": 30411207, "comment_id": 48909992, "body": "Got error <code>undefined: echo.NewHTTPError</code> - Is it typo or different Echo version? Another one, recent version Echo use <code>*echo.HTTPError</code> instead of <code>error</code>"}, {"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "reply_to_user": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432404672, "post_id": 30411207, "comment_id": 48918105, "body": "I just <code>go get</code>&#39;ed the last version of <code>Echo</code>. The version I used also returns a <code>*echo.HTTPError</code> which implement the <code>Error()</code> method from <code>error</code> interface. The handler seems to be able to return both <code>error</code> and <code>*echo.HTTPError</code>."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432405543, "post_id": 30411207, "comment_id": 48918365, "body": "I just updated Echo to latest version and your solution works now. Thanks a lot"}], "tags": [], "owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "is_accepted": true, "score": 2, "last_activity_date": 1432374285, "creation_date": 1432374285, "answer_id": 30411207, "question_id": 30410558, "link": "https://stackoverflow.com/questions/30410558/golang-provide-return-after-if-statement-when-using-framework/30411207#30411207", "title": "Golang - Provide return after &quot;if&quot; statement when using framework", "body": "<p>Your handler here is not what <code>echo.Get</code> is waiting for that's why you're getting this: <code>panic: echo: unknown handler</code>.\nTo get rid of this error change your handler to something like this: <code>func(c *echo.Context) error</code>\nIf you need to access the <code>http.Request</code> from inside the <code>handler</code> you can do it by using the <code>*echo.Context</code> which also contains a <code>*echo.Response</code>.</p>\n\n<p>Working solution:</p>\n\n<pre><code>e.Get(\"/\", func(c *echo.Context) error {\n    deviceType := goDevice.GetType(c.Request())\n\n    if deviceType == \"Mobile\" {\n        return echo.NewHTTPError(http.StatusOK, \"Mobile!\")\n    } else if deviceType == \"Web\" {\n        return echo.NewHTTPError(http.StatusOK, \"Desktop!\")\n    } else if deviceType == \"Tab\" {\n        return echo.NewHTTPError(http.StatusOK, \"Tablet!\")\n    }\n\n    return echo.NewHTTPError(http.StatusNoContent, \"Alien probe\")\n})\n</code></pre>\n\n<p>Hope it helps</p>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 721, "favorite_count": 0, "accepted_answer_id": 30411207, "answer_count": 1, "score": 0, "last_activity_date": 1432374285, "creation_date": 1432369521, "last_edit_date": 1495542608, "question_id": 30410558, "link": "https://stackoverflow.com/questions/30410558/golang-provide-return-after-if-statement-when-using-framework", "title": "Golang - Provide return after &quot;if&quot; statement when using framework", "body": "<p>It give error <code>missing return at end of function</code>. I've tried add <code>return nil</code>, <code>return \"\"</code>, <code>return c.String</code>, and several others but none works.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/hiteshmodha/goDevice\"\n    \"github.com/labstack/echo\"\n    \"net/http\"\n)\n\nfunc main() {\n    e := echo.New()\n\n    e.Get(\"/\", func(c *echo.Context, w http.ResponseWriter, r *http.Request) *echo.HTTPError {\n\n        deviceType := goDevice.GetType(r)\n\n        if deviceType == \"Mobile\" {\n            return c.String(http.StatusOK, \"Mobile!\")\n        } else if deviceType == \"Web\" {\n            return c.String(http.StatusOK, \"Desktop!\")\n        } else if deviceType == \"Tab\" {\n            return c.String(http.StatusOK, \"Tablet!\")\n        }\n\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n\n<p>This one quite different that other case such as in <a href=\"https://stackoverflow.com/questions/20099144/go-provide-function-return-from-an-if-statement-issues\">here</a>.</p>\n\n<p>Without framework, it works fine.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2842, "user_id": 648741, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/47813cc59b0edb414b88601f1defe02a?s=128&d=identicon&r=PG", "display_name": "jochen", "link": "https://stackoverflow.com/users/648741/jochen"}, "edited": false, "score": 1, "creation_date": 1432369337, "post_id": 30409099, "comment_id": 48907935, "body": "As an aside: I believe you can write <code>10000 * time.Millisecond</code>, without casting the constant to <code>time.Duration</code>."}], "answers": [{"comments": [{"owner": {"reputation": 51, "user_id": 4666487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32a5cc5696adfb72310a91156d1699a1?s=128&d=identicon&r=PG&f=1", "display_name": "satrix", "link": "https://stackoverflow.com/users/4666487/satrix"}, "edited": false, "score": 0, "creation_date": 1432360427, "post_id": 30409272, "comment_id": 48905935, "body": "Wow, can&#39;t believe I overlooked that. Thanks!"}], "tags": [], "owner": {"reputation": 1641, "user_id": 3828156, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/scFYI.jpg?s=128&g=1", "display_name": "chendesheng", "link": "https://stackoverflow.com/users/3828156/chendesheng"}, "is_accepted": true, "score": 5, "last_activity_date": 1432359493, "creation_date": 1432359493, "answer_id": 30409272, "question_id": 30409099, "link": "https://stackoverflow.com/questions/30409099/sending-data-through-channel-gets-stuck/30409272#30409272", "title": "Sending data through channel gets stuck", "body": "<p>You have to make a channel first before using it</p>\n\n<pre><code>var resp = make(chan string)\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 4666487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/32a5cc5696adfb72310a91156d1699a1?s=128&d=identicon&r=PG&f=1", "display_name": "satrix", "link": "https://stackoverflow.com/users/4666487/satrix"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 0, "accepted_answer_id": 30409272, "answer_count": 1, "score": 3, "last_activity_date": 1432359493, "creation_date": 1432357760, "question_id": 30409099, "link": "https://stackoverflow.com/questions/30409099/sending-data-through-channel-gets-stuck", "title": "Sending data through channel gets stuck", "body": "<p>I'm writing a server that uses long polling, and basically I have a go routine that runs periodically and sends a response over a channel. However the program gets stuck when it tries to send into the channel.</p>\n\n<p>I've made a simple program that demonstrates the problem:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"time\"\n)\n\nvar resp chan string\n\nfunc main() {\n    go send()\n    listen()\n}\n\nfunc listen() {\n    select {\n    case response := &lt;-resp:\n        log.Printf(\"Writing response: %s\\n\", response)\n    }\n}\n\nfunc send() {\n    ticker := time.NewTicker(time.Duration(10000) * time.Millisecond)\n\n    select {\n    case &lt;-ticker.C:\n        // program gets stuck here\n        log.Println(\"Sending\")\n        resp &lt;- \"Message\"\n    }\n}\n</code></pre>\n\n<p>Does anyone see what the problem could be? Thanks</p>\n"}, {"tags": ["arrays", "algorithm", "go"], "comments": [{"owner": {"reputation": 165, "user_id": 2570591, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/754270329/picture?type=large", "display_name": "Ruben", "link": "https://stackoverflow.com/users/2570591/ruben"}, "edited": false, "score": 1, "creation_date": 1432333649, "post_id": 30406728, "comment_id": 48901119, "body": "you have an array of array correct ? why cant you have 2 foor loops?"}, {"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "reply_to_user": {"reputation": 165, "user_id": 2570591, "user_type": "registered", "accept_rate": 60, "profile_image": "https://graph.facebook.com/754270329/picture?type=large", "display_name": "Ruben", "link": "https://stackoverflow.com/users/2570591/ruben"}, "edited": false, "score": 0, "creation_date": 1432333805, "post_id": 30406728, "comment_id": 48901178, "body": "@Ruben check each its element"}, {"owner": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 1, "creation_date": 1432335461, "post_id": 30406728, "comment_id": 48901690, "body": "If you&#39;re doing a minesweeper, you should probably keep track of the number of mines instead of calculating it everytime."}, {"owner": {"reputation": 7290, "user_id": 4785110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1bae5c00f27770d807c943268438bb6?s=128&d=identicon&r=PG&f=1", "display_name": "maraca", "link": "https://stackoverflow.com/users/4785110/maraca"}, "edited": false, "score": 0, "creation_date": 1432335639, "post_id": 30406728, "comment_id": 48901737, "body": "@Avdept you can use the trick with min max shown in my answer and it makes use of the special value -1. I think in your last picture the 3rd line needs to be <code>[0 1 2 3 2]</code> and the following lines <code>[0 0 2 -1 -1]</code>"}, {"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "reply_to_user": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 0, "creation_date": 1432367732, "post_id": 30406728, "comment_id": 48907594, "body": "@sturcotte06 i have number of mines in one of variables. however i don&#39;t track its coordinates"}, {"owner": {"reputation": 1828, "user_id": 2584754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/Q3gFD.jpg?s=128&g=1", "display_name": "sturcotte06", "link": "https://stackoverflow.com/users/2584754/sturcotte06"}, "edited": false, "score": 0, "creation_date": 1432523363, "post_id": 30406728, "comment_id": 48945766, "body": "Use objects instead of integers."}], "answers": [{"comments": [{"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1432369158, "post_id": 30406873, "comment_id": 48907894, "body": "Thanks. This is what i was looking for. But could you in 2 words describe your logic?"}, {"owner": {"reputation": 7290, "user_id": 4785110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1bae5c00f27770d807c943268438bb6?s=128&d=identicon&r=PG&f=1", "display_name": "maraca", "link": "https://stackoverflow.com/users/4785110/maraca"}, "reply_to_user": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 0, "creation_date": 1432375090, "post_id": 30406873, "comment_id": 48909208, "body": "@Avdept I tried to put it in words now, it was surprisingly difficult compared to the algorithm itself."}], "tags": [], "owner": {"reputation": 7290, "user_id": 4785110, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b1bae5c00f27770d807c943268438bb6?s=128&d=identicon&r=PG&f=1", "display_name": "maraca", "link": "https://stackoverflow.com/users/4785110/maraca"}, "is_accepted": true, "score": 2, "last_activity_date": 1432386159, "last_edit_date": 1432386159, "creation_date": 1432334418, "answer_id": 30406873, "question_id": 30406728, "link": "https://stackoverflow.com/questions/30406728/count-all-amount-of-numbers-in-2d-array/30406873#30406873", "title": "Count all amount of numbers in 2d array", "body": "<pre><code>for i := 0; i &lt; row; i++ {\n    for j := 0; j &lt; col; j++ {\n        if ary[i][j] == -1 {\n            for k := max(0, i - 1); k &lt;= min(row - 1, i + 1); k++ {\n                for l := max(0, j - 1); l &lt;= min(col - 1, j + 1); l++ {\n                    if ary[k][l] != -1 {\n                        ary[k][l] ++\n                    }\n                }\n            } \n        }\n    }\n}\n</code></pre>\n\n<p>The first two outer loops go through the array. If the observed number is <code>-1</code> then it increases all surrounding cells unless there is a mine on that field. To avoid the checks if <code>ary[k][l]</code> is not outside of bounds the bounds are calculated before by using the trick with min / max to ensure that <code>k</code> and <code>l</code> are not outside of bounds. E.g. <code>max(0, i-1)</code> will always return <code>i-1</code> unless <code>i-1</code> is smaller than <code>0</code>, then it returns <code>0</code>.</p>\n"}], "owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 84, "favorite_count": 0, "accepted_answer_id": 30406873, "answer_count": 1, "score": 1, "last_activity_date": 1432386159, "creation_date": 1432333543, "question_id": 30406728, "link": "https://stackoverflow.com/questions/30406728/count-all-amount-of-numbers-in-2d-array", "title": "Count all amount of numbers in 2d array", "body": "<p>I'm trying to write console minesweeper, but cant figure out how to iterate over 2d array, and count amount of \"-1\" around each of element. My array looks like</p>\n\n<pre><code>[0 0 0 0 0]\n[0 0 -1 0 0]\n[0 0 0 0 0]\n[0 0 0 -1 -1]\n[0 0 0 -1 -1]\n</code></pre>\n\n<p>Where \"-1\" that is mine. I've tried to simply iterate over it with code</p>\n\n<pre><code>for i := 0; i &lt; row; i++ {\nnumb := 0\n    for j := 0; j &lt; col; j++ {\n         if ary[i-1][j-1] == -1 {\n             numb ++ } \n         }\n         if ary[i-1][j] == 1 {\n             numb ++ }\n         //rest of code omitted\n\n    }\n</code></pre>\n\n<p>But that resulted in huge amout of code, which is hard to read and understand. Is there more flexible way, to check all elements around <code>current</code> in <code>for-iterator</code>, so in result it would look like</p>\n\n<pre><code>[0 1  1   1 0]\n[0 1 -1   1 0]\n[0 1  2   2 1]\n[0 0  1  -1 -1]\n[0 0  1  -1 -1]\n</code></pre>\n"}, {"tags": ["go", "docker"], "answers": [{"tags": [], "owner": {"reputation": 7020, "user_id": 4822566, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/HlNVB.png?s=128&g=1", "display_name": "Alex Taylor", "link": "https://stackoverflow.com/users/4822566/alex-taylor"}, "is_accepted": true, "score": 1, "last_activity_date": 1432332566, "creation_date": 1432332566, "answer_id": 30406556, "question_id": 30406363, "link": "https://stackoverflow.com/questions/30406363/how-to-obtain-docker-image-id-from-api-after-building/30406556#30406556", "title": "How to obtain Docker image ID from API after building?", "body": "<p>Use the <code>InspectImage</code> function. It will give you an <code>Image</code> with an <code>ID</code> field: <a href=\"https://godoc.org/github.com/fsouza/go-dockerclient#Client.InspectImage\" rel=\"nofollow\">https://godoc.org/github.com/fsouza/go-dockerclient#Client.InspectImage</a></p>\n"}], "owner": {"reputation": 63413, "user_id": 193619, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/11e74c6cb64be4d24fdee076ddb374b0?s=128&d=identicon&r=PG", "display_name": "Nathan Osman", "link": "https://stackoverflow.com/users/193619/nathan-osman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 505, "favorite_count": 0, "accepted_answer_id": 30406556, "answer_count": 1, "score": 0, "last_activity_date": 1432332566, "creation_date": 1432331390, "question_id": 30406363, "link": "https://stackoverflow.com/questions/30406363/how-to-obtain-docker-image-id-from-api-after-building", "title": "How to obtain Docker image ID from API after building?", "body": "<p>According to <a href=\"https://docs.docker.com/reference/api/docker_remote_api_v1.18/#build-image-from-a-dockerfile\" rel=\"nofollow\">the Docker v1.18 API documentation</a>, the <code>/build</code> method accepts a TAR stream (with a Dockerfile) and attempts to build the image.</p>\n\n<p>However, unless I'm missing something, there seems to be no way to obtain the image ID after the build process completes.</p>\n\n<p>For example, I'm using the <a href=\"https://godoc.org/github.com/fsouza/go-dockerclient\" rel=\"nofollow\">go-dockerclient library</a> to connect to the Docker API and build the image using the following snippet:</p>\n\n<pre><code>//...\n\nopts := docker.BuildImageOptions{\n    Name:         \"test-image\",\n    InputStream:  input,\n    OutputStream: output,\n}\n\nif err := client.BuildImage(opts); err != nil {\n    fmt.Println(err)\n}\n\n//...\n</code></pre>\n\n<p>The <code>BuildImage()</code> method executes and I can confirm (through Docker's CLI client) that the image is indeed created. However, the only value returned from <code>BuildImage()</code> is an error. There doesn't seem to be a way to obtain the ID of the image.</p>\n\n<p>Am I missing something?</p>\n"}, {"tags": ["c", "go", "bit-manipulation"], "comments": [{"owner": {"reputation": 10901, "user_id": 1076479, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/eLQUX.jpg?s=128&g=1", "display_name": "Gil Hamilton", "link": "https://stackoverflow.com/users/1076479/gil-hamilton"}, "edited": false, "score": 5, "creation_date": 1432324634, "post_id": 30404905, "comment_id": 48897581, "body": "Check out <a href=\"http://graphics.stanford.edu/~seander/bithacks.html\" rel=\"nofollow noreferrer\">graphics.stanford.edu/~seander/bithacks.html</a> . Search for &quot;Counting bits set, in parallel&quot;"}, {"owner": {"reputation": 260120, "user_id": 103167, "user_type": "registered", "accept_rate": 53, "profile_image": "https://i.stack.imgur.com/rX1ss.png?s=128&g=1", "display_name": "Ben Voigt", "link": "https://stackoverflow.com/users/103167/ben-voigt"}, "edited": false, "score": 2, "creation_date": 1432324645, "post_id": 30404905, "comment_id": 48897588, "body": "All that bit manipulation is a fairly common implementation of the <code>popcount</code> function.... it&#39;s counting how many bits are set in the buffer."}, {"owner": {"reputation": 3984, "user_id": 164344, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/c978ca7e1c3da231710b8c114009faa5?s=128&d=identicon&r=PG&f=1", "display_name": "Tim", "link": "https://stackoverflow.com/users/164344/tim"}, "edited": false, "score": 6, "creation_date": 1432330615, "post_id": 30404905, "comment_id": 48900108, "body": "Wow. That code should really have a comment describing what it&#39;s doing."}, {"owner": {"reputation": 30739, "user_id": 1804599, "user_type": "registered", "accept_rate": 84, "profile_image": "https://i.stack.imgur.com/v91P3.jpg?s=128&g=1", "display_name": "rightfold", "link": "https://stackoverflow.com/users/1804599/rightfold"}, "reply_to_user": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 1, "creation_date": 1434444042, "post_id": 30404905, "comment_id": 49767541, "body": "@Jongware the project Go used its own C compiler which supports this."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1434468856, "post_id": 30404905, "comment_id": 49785704, "body": "rollback note: I don&#39;t think this should be tagged Go. It&#39;s C code, it just happens to be in the old Go run-time (which has since been rewritten in Go btw). The only non-standard C thing is the use of <code>&#183;</code> in an identifier (the Go ABI uses that)."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 1, "creation_date": 1434550465, "post_id": 30404905, "comment_id": 49827539, "body": "@Ishay Peled Ishay Peled it&#39;s one thing to re-add the Go tag, but you removed the C tag as well!!. The <i>only</i> non-standard C thing, the use of a <code>&#183;</code> in an identifier, is completely irrelevant to this question. If the function happened to come from SillyOS and happened to contain an irrelevant call to SillyOSSpecificButObviousSyscall before the asked about bit fiddling, would that then require a useless SillyOS tag on the question? There is nothing in this question that anyone following or searching the <code>tag:go</code> tag would care about but the lots that those following/searching tag:c would."}, {"owner": {"reputation": 2592, "user_id": 2963819, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/bcc08ce2a4490cf3496020812fe10ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Ishay Peled", "link": "https://stackoverflow.com/users/2963819/ishay-peled"}, "edited": false, "score": 0, "creation_date": 1434628251, "post_id": 30404905, "comment_id": 49866220, "body": "Flagged, let someone else decide."}, {"owner": {"reputation": 20968, "user_id": 2564301, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/a6b5734cdcb5ce19598ccf9a7d8cc1ff?s=128&d=identicon&r=PG&f=1", "display_name": "Jongware", "link": "https://stackoverflow.com/users/2564301/jongware"}, "edited": false, "score": 0, "creation_date": 1434631710, "post_id": 30404905, "comment_id": 49868698, "body": "So <b>rename</b> that one function call to something less conspicuous, as it seems <b>not relevant</b> and only distracts from the actual question. Renaming it removes the &#39;need&#39; (or &#39;want&#39;) for a Go compatible compiler, and thus, logically, the Go tag. What remains is a clear C-only question."}], "answers": [{"tags": [], "owner": {"reputation": 2531, "user_id": 3696619, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/LueSz.jpg?s=128&g=1", "display_name": "Jay Bosamiya", "link": "https://stackoverflow.com/users/3696619/jay-bosamiya"}, "is_accepted": false, "score": 2, "last_activity_date": 1434721891, "last_edit_date": 1592644375, "creation_date": 1434721891, "answer_id": 30939889, "question_id": 30404905, "link": "https://stackoverflow.com/questions/30404905/what-is-this-getproccount/30939889#30939889", "title": "What is this? getproccount", "body": "<p>The <code>for</code> loop runs over as many elements that get filled into the <code>buf</code> array. For each of those elements, it calculates the number of bits that are set in that element (the bit fiddling with <code>t</code> does just that) and that is added into <code>cnt</code>. At the end <code>cnt</code> is returned (or 1 if <code>cnt</code> is 0).</p>\n<h2>Explanation for the bit fiddling:</h2>\n<p><strong>Bit fiddling line 1</strong></p>\n<p>The line <code>t = t - ((t &gt;&gt; 1) &amp; 0x5555555555555555ULL);</code> basically groups off the bits of <code>t</code> into 2 bits and replaces each group with the count of the number of set bits in that group. This works like follows:</p>\n<p>Consider <code>t = ... w x y z</code> where w,x,y,z are individual bits. Then</p>\n<pre><code>t                 = ... w x y z\nt&gt;&gt;1              = ..... w x y\nt&gt;&gt;1 &amp; 0x...55ULL = ... 0 w 0 y\n</code></pre>\n<p>From above, it is clear to see why the grouping happens into 2 bits (for example, y and z get grouped together here). Now <code>t - ((t &gt;&gt; 1) &amp; 0x5555555555555555ULL)</code> will have each group of 2 bits <code>y z</code> transformed to <code>(y-z)</code>. Using a table of the 4 possibilities (00, 01, 10, 11), we see that the answers are (00, 01, 01, 10) which matches with the number of bits set in that group of 2 bits.</p>\n<p><strong>Bit fiddling line 2</strong></p>\n<p>Moving on to the next bit fiddling line <code>t = (t &amp; 0x3333333333333333ULL) + ((t &gt;&gt; 2) &amp; 0x3333333333333333ULL);</code>, we can see that it is adding up adjacent groups of 2 in groups of 2.</p>\n<p><code>t &amp; 0x..33ULL</code> takes the rightmost 2 bits of each group of 4 bits.<br />\n<code>(t&gt;&gt;2) &amp; 0x..33ULL</code> takes the leftmost 2 bits of each group of 4 bits and shifts them right by 2.<br />\nSince these two groups of 2 bits were the number of bits set in the original number, it has added up the number of bits set in every group of 4 bits. (i.e. now, each group of 4 bits has the number of bits that were set originally in those positions)</p>\n<p><strong>Bit fiddling line 3</strong></p>\n<p>As for the last bit fiddling line <code>cnt += (int32)((((t + (t &gt;&gt; 4)) &amp; 0xF0F0F0F0F0F0F0FULL) * 0x101010101010101ULL) &gt;&gt; 56);</code>, we can break it down into a few parts for easier understanding.</p>\n<pre><code>(int32)(\n  (\n    (\n      (\n        t + (t &gt;&gt; 4)\n      ) &amp; 0xF0F0F0F0F0F0F0FULL\n    ) * 0x101010101010101ULL\n  ) &gt;&gt; 56\n)\n</code></pre>\n<p>Currently, each group of 4 bits stores the number of bits that were set originally in the number. Shifting the number over by 4 and adding would add all adjecent groups together. <code>&amp;</code>ing with <code>0x..0F0FULL</code> picks out the right 4 bits of each group of 8 bits. Hence, at the end of <code>(t + (t &gt;&gt; 4)) &amp; 0x...0F0FULL</code>, there are groups of 8 bits which contain the number of bits that were there in those locations in the original number. Let's just call this number <code>s = (t + (t &gt;&gt; 4)) &amp; 0x...0F0FULL</code> for simplicity.</p>\n<p>We now have to do <code>(s * 0x...0101ULL) &gt;&gt; 56</code>. Notice that <code>t</code> and thus <code>s</code> are 64 bits in size. This means that there are 8 groups of 8 bits. By simple multiplication with <code>0x...0101ULL</code> (which is just the rightmost bit turned on for each group), the leftmost group will now be the sum of all the groups. By shifting right by 56 (i.e. <code>(64 - 8)</code>), we move this leftmost group into the rigthmost position. This means that the rightmost group of 8 bits now has the sum of all the groups of <code>s</code>. But <code>s</code>'s groups were the number of set bits in those locations in the number, therefore, after the <code>&gt;&gt;56</code> operation, we have the total number of set bits in the original number. The <code>(int32)</code> is just typecasting to a lower size datatype (which is actually enough to store this number.</p>\n<p>Note: A bit being set means that the bit is equal to 1.</p>\n"}], "owner": {"reputation": 3436, "user_id": 1520878, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/6822b07182b8c0ae366325f2ae4fab4f?s=128&d=identicon&r=PG", "display_name": "brooks94", "link": "https://stackoverflow.com/users/1520878/brooks94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 359, "favorite_count": 2, "answer_count": 1, "score": 14, "last_activity_date": 1434721891, "creation_date": 1432324462, "last_edit_date": 1434631334, "question_id": 30404905, "link": "https://stackoverflow.com/questions/30404905/what-is-this-getproccount", "title": "What is this? getproccount", "body": "<p>What is going on in this code?  From the name and the context it's finding the number of cores on the machine, but how does it work?  What's all that bit fiddling for?</p>\n\n<pre><code>static int32\ngetproccount(void)\n{\n        uintptr buf[16], t;\n        int32 r, cnt, i;\n\n        cnt = 0;\n        r = runtime\u00b7sched_getaffinity(0, sizeof(buf), buf);\n        if(r &gt; 0)\n        for(i = 0; i &lt; r/sizeof(buf[0]); i++) {\n                t = buf[i];\n                t = t - ((t &gt;&gt; 1) &amp; 0x5555555555555555ULL);\n                t = (t &amp; 0x3333333333333333ULL) + ((t &gt;&gt; 2) &amp; 0x3333333333333333ULL);\n                cnt += (int32)((((t + (t &gt;&gt; 4)) &amp; 0xF0F0F0F0F0F0F0FULL) * 0x101010101010101ULL) &gt;&gt; 56);\n        }\n\n        return cnt ? cnt : 1;\n}\n</code></pre>\n\n<p>Note: ignore the <code>\u00b7</code> in <code>runtime\u00b7sched_getaffinity</code>, think of that line as just an arbitrary library/system call that does what the name and arguments imply. (In this case this specific call comes from <a href=\"https://github.com/golang/go/blob/release-branch.go1.4/src/runtime/os_linux.c\" rel=\"nofollow\">the <em>old</em> pre-Go1.4 runtime</a> written in a slight variation of C that deals with <code>\u00b7</code>).</p>\n"}, {"tags": ["http", "redirect", "go"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "edited": false, "score": 1, "creation_date": 1432325750, "post_id": 30404024, "comment_id": 48898089, "body": "Why do you want to set a body in a redirect? The client wil probably ignore the body and just follow the <code>Location</code>."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432327122, "post_id": 30404024, "comment_id": 48898671, "body": "@LutzHorn, e.g. see the <a href=\"https://en.wikipedia.org/wiki/HTTP_redirect#HTTP_status_codes_3xx\" rel=\"nofollow noreferrer\">Wikipedia example</a> with a 301 and a body."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432328317, "post_id": 30404024, "comment_id": 48899208, "body": "Also note that <a href=\"https://golang.org/pkg/net/http/#Redirect\" rel=\"nofollow noreferrer\"><code>http.Redirect</code></a> follows the RFC2616 recommendation of <a href=\"https://golang.org/src/net/http/server.go?s=38049:38117#L1357\" rel=\"nofollow noreferrer\">putting a simple body for GET requests</a>. If that&#39;s all you need you could just call it; or you could look at the source to roll your own version with a custom body."}, {"owner": {"reputation": 5856, "user_id": 904992, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b6ff0bfd7521b66a4284f8740936e016?s=128&d=identicon&r=PG", "display_name": "funerr", "link": "https://stackoverflow.com/users/904992/funerr"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432328614, "post_id": 30404024, "comment_id": 48899325, "body": "@DaveC, Yes I read that part of the RFC, and I saw the go implementation, but I need a custom body with the redirect."}], "answers": [{"comments": [{"owner": {"reputation": 5856, "user_id": 904992, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b6ff0bfd7521b66a4284f8740936e016?s=128&d=identicon&r=PG", "display_name": "funerr", "link": "https://stackoverflow.com/users/904992/funerr"}, "edited": false, "score": 0, "creation_date": 1432321719, "post_id": 30404084, "comment_id": 48896029, "body": "Thanks! but, if you test this on chrome and view the Network pane, chrome won&#39;t show any body :\\ (it would output: &quot;Failed to load response data&quot;)"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 5856, "user_id": 904992, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b6ff0bfd7521b66a4284f8740936e016?s=128&d=identicon&r=PG", "display_name": "funerr", "link": "https://stackoverflow.com/users/904992/funerr"}, "edited": false, "score": 0, "creation_date": 1432327880, "post_id": 30404084, "comment_id": 48899022, "body": "@funerr <a href=\"https://play.golang.org/p/CPWIVR0_sk\" rel=\"nofollow noreferrer\">play.golang.org/p/CPWIVR0_sk</a> works for me with Firefox but I think it&#39;s up to the browser (and add-ons and settings)  if it displays the body or just follows the redirect quietly."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 5, "last_activity_date": 1432321282, "creation_date": 1432321282, "answer_id": 30404084, "question_id": 30404024, "link": "https://stackoverflow.com/questions/30404024/why-cant-i-add-a-body-to-an-http-redirect/30404084#30404084", "title": "Why can&#39;t I add a body to an http redirect?", "body": "<p>This is documented in the <a href=\"https://godoc.org/net/http#ResponseWriter\"><code>net/http</code></a> package:</p>\n\n<blockquote>\n  <h3>type ResponseWriter</h3>\n\n<pre><code>type ResponseWriter interface {\n    // Header returns the header map that will be sent by WriteHeader.\n    // Changing the header after a call to WriteHeader (or Write) has\n    // no effect.\n    Header() Header\n\n    // Write writes the data to the connection as part of an HTTP reply.\n    // If WriteHeader has not yet been called, Write calls WriteHeader(http.StatusOK)\n    // before writing the data.  If the Header does not contain a\n    // Content-Type line, Write adds a Content-Type set to the result of passing\n    // the initial 512 bytes of written data to DetectContentType.\n    Write([]byte) (int, error)\n\n    // WriteHeader sends an HTTP response header with status code.\n    // If WriteHeader is not called explicitly, the first call to Write\n    // will trigger an implicit WriteHeader(http.StatusOK).\n    // Thus explicit calls to WriteHeader are mainly used to\n    // send error codes.\n    WriteHeader(int)\n}\n</code></pre>\n</blockquote>\n\n<p>The above states that you cannot change <code>Header()</code> after a call to <code>Write()</code> or <code>WriteHeader()</code>.  You should change your code to the following:</p>\n\n<pre><code>w.Header().Set(\"Location\", \"/myredirecturl\")\nw.WriteHeader(301)\nw.Write('Redirecting...')\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5856, "user_id": 904992, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b6ff0bfd7521b66a4284f8740936e016?s=128&d=identicon&r=PG", "display_name": "funerr", "link": "https://stackoverflow.com/users/904992/funerr"}, "edited": false, "score": 0, "creation_date": 1432321955, "post_id": 30404087, "comment_id": 48896157, "body": "Like I commented in Tim&#39;s answer, the body isn&#39;t shown in the chrome Network when I view the redirect response."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 3, "last_activity_date": 1432321299, "creation_date": 1432321299, "answer_id": 30404087, "question_id": 30404024, "link": "https://stackoverflow.com/questions/30404024/why-cant-i-add-a-body-to-an-http-redirect/30404087#30404087", "title": "Why can&#39;t I add a body to an http redirect?", "body": "<p>The problem is that once you call Write or WriteHeader, the headers get flushed to the client. Anything headers set after that will get ignored. So just changing the order of commands will fix this:</p>\n\n<pre><code>w.Header().Set(\"Location\", \"/myredirecturl\")\nw.Header().Set(\"Content-Length\", contentLength) // I thought this might \nw.WriteHeader(301)\nw.Write('Redirecting...')\n</code></pre>\n"}], "owner": {"reputation": 5856, "user_id": 904992, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/b6ff0bfd7521b66a4284f8740936e016?s=128&d=identicon&r=PG", "display_name": "funerr", "link": "https://stackoverflow.com/users/904992/funerr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1360, "favorite_count": 0, "accepted_answer_id": 30404084, "answer_count": 2, "score": 0, "last_activity_date": 1432321769, "creation_date": 1432321033, "last_edit_date": 1432321769, "question_id": 30404024, "link": "https://stackoverflow.com/questions/30404024/why-cant-i-add-a-body-to-an-http-redirect", "title": "Why can&#39;t I add a body to an http redirect?", "body": "<p>Here is what I've tried:</p>\n\n<pre><code>w.WriteHeader(301)\nw.Write([]byte(\"Redirecting...\"))\nw.Header().Set(\"Location\", \"/myredirecturl\")\nw.Header().Set(\"Content-Length\", contentLength) // I thought this might help\n</code></pre>\n\n<p>It won't add the <code>Location</code> header for some odd reason.<br>\nWhy isn't it possible to add a body and redirect golang's http package?</p>\n"}, {"tags": ["pointers", "interface", "go"], "comments": [{"owner": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 6, "creation_date": 1432320149, "post_id": 30403642, "comment_id": 48895247, "body": "<a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"nofollow noreferrer\">See this post</a>."}, {"owner": {"reputation": 1732, "user_id": 1337498, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/FvEma.jpg?s=128&g=1", "display_name": "Hephaestus", "link": "https://stackoverflow.com/users/1337498/hephaestus"}, "reply_to_user": {"reputation": 426981, "user_id": 596781, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/a18405dd4b022837867d1f5453a05f41?s=128&d=identicon&r=PG", "display_name": "Kerrek SB", "link": "https://stackoverflow.com/users/596781/kerrek-sb"}, "edited": false, "score": 3, "creation_date": 1466802647, "post_id": 30403642, "comment_id": 63486025, "body": "As sort of a side note: the article referenced by @KerrekSB was helpful for me to understand that when Go complains &quot;MyFoo does not implement Foo (Bar method has pointer receiver)&quot;, it doesn&#39;t mean that you <i>can&#39;t</i> use a pointer receiver. It means that either <i>none</i> of the methods of <code>MyFoo</code> that  implement <code>Bar</code> should have pointer receivers, or <i>all</i> of them must. That&#39;s a different issue than @0xor1 was having, but others might find this question because they are mixing their receiver types (like I was) and not understanding the error they&#39;re getting."}], "answers": [{"comments": [{"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "edited": false, "score": 4, "creation_date": 1432320386, "post_id": 30403752, "comment_id": 48895389, "body": "They can be either *Faz or Faz but they all must match. Define them all Faz if you intend to <code>return Faz{}</code> or *Faz if you intend to <code>return &amp;Faz{}</code>. How they maintain state is considered an implementation detail that you are basically hiding from the user."}], "tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 53, "last_activity_date": 1432320036, "creation_date": 1432320036, "answer_id": 30403752, "question_id": 30403642, "link": "https://stackoverflow.com/questions/30403642/why-cant-the-interface-be-implemented-with-pointer-receivers/30403752#30403752", "title": "Why can&#39;t the interface be implemented with pointer receivers", "body": "<p>Because it's <code>*Faz</code> not <code>Faz</code>.</p>\n\n<pre><code>func main() {\n    foo := New().(*Faz)\n    log.Println(foo)\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3358, "user_id": 852385, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/5c0eac51aaa99541fb966854b5dcb131?s=128&d=identicon&r=PG", "display_name": "Helin Wang", "link": "https://stackoverflow.com/users/852385/helin-wang"}, "edited": false, "score": 0, "creation_date": 1489594571, "post_id": 40254464, "comment_id": 72742658, "body": "I don&#39;t agree with your explanation, following program works (type *foo satisfies String() defined for type foo):package main  import ( \t&quot;fmt&quot; )  type foo struct{}  func (f foo) String() string { \treturn &quot;111&quot; }  func main() { \tf := foo{} \ta := &amp;foo{} \tvar s fmt.Stringer \ts = a \ts = f \tfmt.Println(f.String(), a.String(), s) }"}], "tags": [], "owner": {"reputation": 536, "user_id": 614887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6e3bb13fb694f48126df8cd509507e02?s=128&d=identicon&r=PG&f=1", "display_name": "dtx", "link": "https://stackoverflow.com/users/614887/dtx"}, "is_accepted": false, "score": 4, "last_activity_date": 1482299139, "last_edit_date": 1482299139, "creation_date": 1477460213, "answer_id": 40254464, "question_id": 30403642, "link": "https://stackoverflow.com/questions/30403642/why-cant-the-interface-be-implemented-with-pointer-receivers/40254464#40254464", "title": "Why can&#39;t the interface be implemented with pointer receivers", "body": "<p>I think the answer to this question needs to a more retrospective approach towards the grammar, and how would implement it through software engineering. <em>(Excuse the over simplification)</em></p>\n\n<hr>\n\n<p>First a quick flashback of what are <code>types</code>?<br/>\nThey are just memory blocks with compiler logic on top. What makes an <code>array</code> different from a <code>string</code> is what the compiler allows us to do with those memory blocks. (Think deeper and you may begin to realize the true difference between <code>strongly typed</code> and <code>dynamically typed</code> languages.)</p>\n\n<p>Now next you need to realize that pointers are their own types per say. <br/><code>*variable</code> is a different memory block (aka type) than <code>variable</code>. It's just that the compiler always assumes that content of <code>*variable</code> is always going to be an address to a memory block of type to the right of the declaration along with other restriction/features it imposes.</p>\n\n<p>Then let's recap what an interface is.<br/>\n<em>Pseudo-scientific definition</em>: A set of requirements for any first class citizen to be of a specific type. \nTranslated to software engineering- any block of memory (types) that has the same memory structure (think back to <em><a href=\"http://www.catb.org/esr/structure-packing/\" rel=\"nofollow noreferrer\">structure packing</a></em>) associated to it as described in a contract (<code>interface</code>) can be passed around as with the <em>type name</em> that the contract mentions. </p>\n\n<hr>\n\n<p>Now you may begin to realize that when you say </p>\n\n<p><code>func (f *Faz) Bar() string</code> is <code>f</code>'s block of memory holding a function, where <code>f</code>'s type is <em>a pointer to <code>Faz</code></em></p>\n\n<p>where areas </p>\n\n<p><code>func (f Faz) Bar() string</code> is <code>f</code>'s block of memory, where <code>f</code>'s type is <code>Faz</code> </p>\n\n<p>So when you are saying that a variable of <code>*Faz</code> type is satisfying a contract, then how can you assume that a variable of <code>Faz</code> type will qualify as interface type in the code? Chose who satisfies your contract, and only that type can assume the interface type in your code.</p>\n"}], "owner": {"reputation": 10946, "user_id": 1259261, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/2a105607c3fd93df0d386c6d6a6b4aad?s=128&d=identicon&r=PG", "display_name": "Daniel Robinson", "link": "https://stackoverflow.com/users/1259261/daniel-robinson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 21132, "favorite_count": 12, "accepted_answer_id": 30403752, "answer_count": 2, "score": 54, "last_activity_date": 1482299139, "creation_date": 1432319735, "question_id": 30403642, "link": "https://stackoverflow.com/questions/30403642/why-cant-the-interface-be-implemented-with-pointer-receivers", "title": "Why can&#39;t the interface be implemented with pointer receivers", "body": "<p>I'm confused as to why this fails to compile with:</p>\n\n<blockquote>\n  <blockquote>\n    <p>impossible type assertion:\n         Faz does not implement Foo (Bar method has pointer receiver)</p>\n  </blockquote>\n</blockquote>\n\n<p>if I make the receiver for Faz.Bar a Faz value rather than a Faz pointer then it compiles fine, but I thought it was always better to have pointer receivers so values aren't being copied around?</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n)\n\nfunc main() {\n    foo := New().(Faz)\n    log.Println(foo)\n}\n\ntype Foo interface {\n    Bar() string\n}\n\nfunc New() Foo {\n    return &amp;Faz{}\n}\n\ntype Faz struct {\n}\n\nfunc (f *Faz) Bar() string {\n    return `Bar`\n}\n</code></pre>\n"}, {"tags": ["interface", "go", "overriding"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 4, "creation_date": 1432307157, "post_id": 30399963, "comment_id": 48887812, "body": "Not sure if I understand the question at all: How on earth would could you possibly call a method without a receiver? If you do not have a TypeB at hand inside <code>func(*TypeA) Method()</code> you cannot call it&#39;s method. You try <code>func (*TypeA) Method(TypeB)</code> and pass in a TypeB, but thats for not what you try to do. What <i>does</i> help: Stop thinking about inheritance, overriding and all that Java stuff."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1432307211, "post_id": 30399963, "comment_id": 48887844, "body": "One more: Have runnable playground code available, this helps providing answers."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1432310775, "post_id": 30399963, "comment_id": 48890172, "body": "@Volker you mean like <a href=\"http://play.golang.org/p/tkfVUYnffb\" rel=\"nofollow noreferrer\">this</a>? :D"}, {"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1432311643, "post_id": 30399963, "comment_id": 48890709, "body": "@Volker Of course passing a pointer as a parameter is another solution, but I was wondering if it was against golang principles and if so what are the alternatives? I added a working example but it is not really the point of my question."}, {"owner": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 2, "creation_date": 1432312044, "post_id": 30399963, "comment_id": 48890955, "body": "What problem are you trying to solve? This, to be honest, looks more like speculation about the type system than exploration of the possible-design-space for solving a specific problem."}, {"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "reply_to_user": {"reputation": 18805, "user_id": 34771, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7c1a3f9227c0cb408f8831d27d611ab2?s=128&d=identicon&r=PG", "display_name": "Vatine", "link": "https://stackoverflow.com/users/34771/vatine"}, "edited": false, "score": 0, "creation_date": 1432313662, "post_id": 30399963, "comment_id": 48891773, "body": "@Vatine I&#39;m not looking for a solution I just feel like it is not right. I&#39;ve been working on a big project lately, and the global architecture is based on that usage of interfaces. I just want to know every possibilities to make it right. Maybe it&#39;s not the appropriate stackexchange network?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "reply_to_user": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "edited": false, "score": 0, "creation_date": 1432316746, "post_id": 30399963, "comment_id": 48893334, "body": "@thwd: Cute, but it&#39;s just a nil *TypeB in disguise. Or?"}], "answers": [{"comments": [{"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 0, "creation_date": 1432316525, "post_id": 30402037, "comment_id": 48893210, "body": "Type assertion or castsis what I&#39;m trying to avoid here. `TypeA"}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 0, "creation_date": 1432316682, "post_id": 30402037, "comment_id": 48893290, "body": "There are no conversions and no assertions in that code."}, {"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 0, "creation_date": 1432317354, "post_id": 30402037, "comment_id": 48893694, "body": "Type assertion or casts is what I&#39;m trying to avoid here. <code>TypeA</code>  need to call <code>TypeB</code> &#39;s <code>Method()</code> to change the behavior of <code>TypeA</code>&#39;s <code>Specific()</code> method to create <code>CustomTypes</code> based on <code>TypeA</code>"}, {"owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "edited": false, "score": 0, "creation_date": 1432318231, "post_id": 30402037, "comment_id": 48894170, "body": "Sorry I missred your post! The problem with that solution is that I need to know the type of <code>TypeB</code>. I forgot to mention main constraint on this situation, <code>(*TypeA) Specific()</code> must be able to call <code>Method()</code> from any type that implements <code>Intf</code> interface."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": false, "score": 0, "last_activity_date": 1432313490, "creation_date": 1432313490, "answer_id": 30402037, "question_id": 30399963, "link": "https://stackoverflow.com/questions/30399963/go-interface-method-override-from-embedded-structure/30402037#30402037", "title": "Go: Interface method override from embedded structure", "body": "<blockquote>\n  <p>Is there another way to call func (*TypeB) Method() from inside func (t *TypeA) Specific() than storing a pointer to a TypeB's instance inside the embedded TypeA instance of TypeB?</p>\n</blockquote>\n\n<p>Yes, <a href=\"http://play.golang.org/p/tkfVUYnffb\" rel=\"nofollow\">there is</a>:</p>\n\n<pre><code>package main\n\nimport \"log\"\n\ntype TypeB struct{}\n\nfunc (*TypeB) Method() {\n    log.Println(\"TypeB's Method\")\n}\n\nfunc main() {\n    (*TypeB).Method(nil)\n}\n</code></pre>\n\n<p>But it only works for nilable receivers (without requiring an instance of the receiver).</p>\n\n<blockquote>\n  <p>Is it against golang principles?</p>\n</blockquote>\n\n<p>Not that I know of, but I personally have never required this in any project ever.</p>\n"}], "owner": {"reputation": 160, "user_id": 3574791, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/UywtN.jpg?s=128&g=1", "display_name": "Ganitzsh", "link": "https://stackoverflow.com/users/3574791/ganitzsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 84, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432313490, "creation_date": 1432306616, "last_edit_date": 1432311575, "question_id": 30399963, "link": "https://stackoverflow.com/questions/30399963/go-interface-method-override-from-embedded-structure", "title": "Go: Interface method override from embedded structure", "body": "<p>Consider the following code:</p>\n\n<pre><code>type Intf interface {\n    Method()\n}\n\ntype TypeA struct {\n    TypeBInst Intf\n}\n\nfunc (*TypeA) Method() {\n    log.Println(\"TypeA's Method\")\n}\n\nfunc (t *TypeA) Specific() {\n    t.TypeBInst.Method() // Call override from TypeB\n    log.Println(\"Specific method of TypeA\")\n}\n\ntype TypeB struct {\n    *TypeA\n}\n\nfunc (*TypeB) Method() {\n    log.Println(\"TypeB's Method\")\n}\n</code></pre>\n\n<p>Is there another way to call <code>func (*TypeB) Method()</code> from inside <code>func (t *TypeA) Specific()</code>  than storing a pointer to a <code>TypeB</code>'s instance inside the embedded <code>TypeA</code> instance of <code>TypeB</code>? Is it against golang principles?</p>\n\n<p>Working example: <a href=\"http://play.golang.org/p/1rM0wEBluL\" rel=\"nofollow\">playground</a></p>\n"}, {"tags": ["go", "google-bigquery"], "comments": [{"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432296116, "post_id": 30395813, "comment_id": 48880000, "body": "I am not a Golang expert, but <code>visits</code> should be a map of <code>bigquery.JsonValue</code>"}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432296533, "post_id": 30395813, "comment_id": 48880298, "body": "Could you give an example?"}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432296753, "post_id": 30395813, "comment_id": 48880476, "body": "<code>visits := make(map[string]bigquery.JsonValue)</code>"}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432296829, "post_id": 30395813, "comment_id": 48880536, "body": "I am not sure why you have used: <code>TableDataInsertAllRequestRows</code> that should be only used one time for the payload descriptor."}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432296889, "post_id": 30395813, "comment_id": 48880574, "body": "And you are reusing the wrong <code>i</code> value also, <code>i</code> is different for <code>rows</code>, and a different must be on multiple <code>visits</code>."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432297056, "post_id": 30395813, "comment_id": 48880696, "body": "@Pentium10 Thank you - let me try. I wasn&#39;t aware about the &#39;TableDataInsertAllRequestRows&#39;. And yes, that&#39;s a copy paste error as I had a loop previously."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432297677, "post_id": 30395813, "comment_id": 48881129, "body": "If this is supposed to be a nested array as such, don&#39;t I need to create a slice and then append to it? If I use the map, I don&#39;t see how to add multiple elements into it."}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432297758, "post_id": 30395813, "comment_id": 48881186, "body": "Go try slice and append to it."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432298482, "post_id": 30395813, "comment_id": 48881693, "body": "Slicing and appending looks like it&#39;s working but it&#39;s not updating the table. I&#39;m assuming therefore I have something wrong with the key &quot;visit&quot;. Have checked my schema and that&#39;s defo it&#39;s name."}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432298626, "post_id": 30395813, "comment_id": 48881782, "body": "This looks ok now, you should have your data good. Streaming insert has a few minutes delay until it shows up in your table."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432299204, "post_id": 30395813, "comment_id": 48882172, "body": "Yeah, it does look right but still no datas. If I resort back to visit_duration and remove the slice I see the table update almost instantly. Is jsonRow[&quot;visit&quot;] = visits actually correct syntax. Somehow feels wrong."}, {"owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432299825, "post_id": 30395813, "comment_id": 48882611, "body": "OK. Awesome. Thanks for the help. Human error - when I copied the table to a new one, I didn&#39;t notice the option: &#39;Flatten results&#39;, The copy was therefore not taking the old schema."}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1432301088, "post_id": 30395813, "comment_id": 48883481, "body": "That&#39;s cool, I posted an answer to summarize these."}], "answers": [{"tags": [], "owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "is_accepted": true, "score": 2, "last_activity_date": 1433156331, "last_edit_date": 1433156331, "creation_date": 1432300465, "answer_id": 30397686, "question_id": 30395813, "link": "https://stackoverflow.com/questions/30395813/insert-nested-data-into-bigquery-using-golang/30397686#30397686", "title": "Insert nested data into BigQuery using Golang", "body": "<p>Visits should be a slice of <code>bigquery.JsonValue</code> I am not sure why you have used: TableDataInsertAllRequestRows that should be only used one time for the payload descriptor.</p>\n\n<pre><code>var visits []bigquery.JsonValue\nvisit := make(map[string]bigquery.JsonValue)\nvisit[\"duration\"] = rand.Intn(100)\nvisits = append(visits, visit)\n\njsonRow[\"visit\"] = visits\n</code></pre>\n\n<p>ps. also make sure you have your schema flatten</p>\n"}], "owner": {"reputation": 2714, "user_id": 1080650, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/251b01b1393a8c8a83d73f53e942dc63?s=128&d=identicon&r=PG", "display_name": "simonmorley", "link": "https://stackoverflow.com/users/1080650/simonmorley"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2098, "favorite_count": 0, "accepted_answer_id": 30397686, "answer_count": 1, "score": 4, "last_activity_date": 1433156331, "creation_date": 1432294948, "last_edit_date": 1432299908, "question_id": 30395813, "link": "https://stackoverflow.com/questions/30395813/insert-nested-data-into-bigquery-using-golang", "title": "Insert nested data into BigQuery using Golang", "body": "<p>I can insert a flat object into BigQuery using Golang - how I can insert nested data into a table?</p>\n\n<p>My BigQuery schema looks like this (from the example):</p>\n\n<pre><code>[{\n    \"name\": \"kind\",\n    \"mode\": \"nullable\",\n    \"type\": \"string\"\n  },\n  {\n    \"name\": \"fullName\",\n    \"type\": \"string\",\n    \"mode\": \"required\"\n  },\n  { \"name\": \"visit\",\n    \"type\": \"record\",\n    \"mode\": \"repeated\",\n    \"fields\": [\n    {\n       \"name\": \"time\",\n       \"type\": \"timestamp\",\n       \"mode\": \"nullable\"\n    },\n    {\n       \"name\": \"duration\",\n       \"type\": \"integer\",\n       \"mode\": \"nullable\"\n    }\n   ]\n  }\n]\n</code></pre>\n\n<p>My first attempt to insert looked like this (example):</p>\n\n<pre><code>func ExampleInsert(f string,) {\n\n  jsonRow := make(map[string]bigquery.JsonValue)\n\n  bq, _ := bigquery.New(client)\n  request := new(bigquery.TableDataInsertAllRequest)\n\n  rows := make([]*bigquery.TableDataInsertAllRequestRows, 1)\n\n  jsonRow[\"kind\"] = bigquery.JsonValue(kind)\n  jsonRow[\"visit_duration\"] = bigquery.JsonValue(duration)\n\n  rows[i] = new(bigquery.TableDataInsertAllRequestRows)\n  rows[i].Json = jsonRow\n\n  bq.Tabledata.InsertAll(projectID, \"visits\", \"visitsv4\", request)\n  ...\n}\n</code></pre>\n\n<p>Which flattens and inserts without problems. I'm just using visit_duration</p>\n\n<p>But, I need to loop through a slice and add to the visits record. I've tried to build a <strong>visit</strong> object (without a loop to test) and add that to the row but it's not inserting and I get no errors:</p>\n\n<pre><code>func ExampleInsert(f string,) {\n\n  jsonRow := make(map[string]bigquery.JsonValue)\n\n  bq, _ := bigquery.New(client)\n  request := new(bigquery.TableDataInsertAllRequest)\n\n  rows := make([]*bigquery.TableDataInsertAllRequestRows, 1)\n\n  jsonRow[\"kind\"] = bigquery.JsonValue(kind)\n\n  visits := make([]*bigquery.TableDataInsertAllRequestRows, 1)\n\n  jsonVisit := make(map[string]bigquery.JsonValue)\n  jsonVisit[\"duration\"] = rand.Intn(1000)\n  visits[0] = new(bigquery.TableDataInsertAllRequestRows)\n  visits[0].Json = jsonVisit\n\n  jsonRow[\"visit\"] = visits\n\n  rows[i] = new(bigquery.TableDataInsertAllRequestRows)\n  rows[i].Json = jsonRow\n\n  bq.Tabledata.InsertAll(projectID, \"visits\", \"visitsv4\", request)\n\n  _, err := Call.Do()\n}\n</code></pre>\n\n<p>---[SOLUTION]----</p>\n\n<p>As suggested in the comments, I have also tried creating a slice and then appending the visit:</p>\n\n<pre><code>var visits []bigquery.JsonValue\nvisit := make(map[string]bigquery.JsonValue)\nvisit[\"duration\"] = rand.Intn(100)\nvisits = append(visits, visit)\n\njsonRow[\"visit\"] = visits\n</code></pre>\n\n<p>I can confirm this does in fact work :) For those of you reading this, the reason it wasn't initially, even after adding a slice, was because I had copied the table. In doing so, I had also flattened the results. Watch out.</p>\n"}, {"tags": ["mysql", "database", "go"], "comments": [{"owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "reply_to_user": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1432289562, "post_id": 30393756, "comment_id": 48875743, "body": "Thx so much for link. I didn&#39;t find it."}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 0, "last_activity_date": 1432289019, "creation_date": 1432289019, "answer_id": 30393826, "question_id": 30393756, "link": "https://stackoverflow.com/questions/30393756/create-database-in-mysql-with-golang/30393826#30393826", "title": "Create database in mysql with golang", "body": "<p>Yes, just omit the database name from the url, and run a <code>CREATE</code> query. After that you can open a connection to your database.</p>\n"}], "owner": {"reputation": 19574, "user_id": 350294, "user_type": "registered", "accept_rate": 97, "profile_image": "https://i.stack.imgur.com/uPBSX.jpg?s=128&g=1", "display_name": "Alex Pliutau", "link": "https://stackoverflow.com/users/350294/alex-pliutau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2537, "favorite_count": 0, "closed_date": 1432289572, "accepted_answer_id": 30393826, "answer_count": 1, "score": 0, "last_activity_date": 1432289019, "creation_date": 1432288794, "last_edit_date": 1432288842, "question_id": 30393756, "link": "https://stackoverflow.com/questions/30393756/create-database-in-mysql-with-golang", "closed_reason": "Duplicate", "title": "Create database in mysql with golang", "body": "<p>I have a code that should create automatically database and table in mysql if they are not exist.</p>\n\n<p>I can create table if I have DB, but I cannot create DB, because in connection string I should provide dbname.</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", \"user:pass@tcp(localhost:3306)/dbname?charset=utf8\")\n</code></pre>\n\n<p>Is it possible to do it with sql package?</p>\n"}, {"tags": ["go", "binary", "bit-shift", "bits"], "comments": [{"owner": {"reputation": 34086, "user_id": 787480, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/91cDR.png?s=128&g=1", "display_name": "Sneftel", "link": "https://stackoverflow.com/users/787480/sneftel"}, "edited": false, "score": 3, "creation_date": 1432280986, "post_id": 30391141, "comment_id": 48870631, "body": "This might be a better question for codereview.stackexchange.com."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432313328, "post_id": 30391141, "comment_id": 48891612, "body": "Depending on the actual read/write access paterns this may not get you anything over the simpler code using two <code>uint32</code>&#39;s and <code>atomic.AddUint32</code>. Make sure that other than initialization <b>all</b> access to such a counter is done only via <code>atomic.LoadUint64</code> and other atomic functions."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432315329, "post_id": 30391141, "comment_id": 48892594, "body": "There was an answer (now deleted) that wrapped this in functions <a href=\"https://stackoverflow.com/questions/30391141/store-2-values-in-one-variable#comment48877000_30392396\">with a comment</a> by @thwd suggesting doing it as a type with methods. Possibly something like this: <a href=\"https://play.golang.org/p/hjhs_6061n\" rel=\"nofollow noreferrer\">play.golang.org/p/hjhs_6061n</a> (although personally I doubt I&#39;d use such a thing)."}, {"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1432369834, "post_id": 30391141, "comment_id": 48908009, "body": "The idea is to get consistent state of 2 counters atomically, this is why I used 1 variable for both counters, atomic.Add* will change and return consistent state of both values stored in this variable. My requirements changed, I have to reset both counters to 0 if their sum = N and it&#39;s impossible with single atomic op, only by 2 sequential calls (incr one, compare, reset if sum &gt;= N) and this is not consistent. So I am going to end up with locks. Deleted answer was great beside it is not what I asked, I used almost the same code. Also combined type with method is great suggestion."}], "answers": [{"comments": [{"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 0, "creation_date": 1432285261, "post_id": 30392103, "comment_id": 48873009, "body": "I can even downgrade to uint32 and uint16 and even low because actually i don&#39;t such big capacity for both counters. Can I avoid CAS-loop in this case?"}, {"owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "edited": false, "score": 1, "creation_date": 1432285277, "post_id": 30392103, "comment_id": 48873018, "body": "And also, this is mostly for educational purposes, I didn&#39;t perform performance tests with locks and atomic ops. I believe it&#39;s just efficient, but &quot;believe&quot; is a word that should not be used in software engineering."}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 0, "last_activity_date": 1432285677, "last_edit_date": 1432285677, "creation_date": 1432284053, "answer_id": 30392103, "question_id": 30391141, "link": "https://stackoverflow.com/questions/30391141/store-2-values-in-one-variable/30392103#30392103", "title": "Store 2 values in one variable", "body": "<blockquote>\n  <p>Is this Go code correct and portable</p>\n</blockquote>\n\n<p>It is correct, as long as you work with unsigned integers of 64-bit width.</p>\n\n<p>Portability in this case is provided by the <code>sync/atomic</code> packages to the architectures supported by the Go compiler. Note, however, that not all architectures support \"true\" atomic operations on 64-bit wide data. For example, <a href=\"http://golang.org/src/sync/atomic/asm_386.s#L113\" rel=\"nofollow\">the i386 implementation</a> uses a CAS-loop:</p>\n\n<pre><code>TEXT \u00b7AddUint64(SB),NOSPLIT,$0-20\n    // no XADDQ so use CMPXCHG8B loop\n    MOVL    addr+0(FP), BP\n    TESTL   $7, BP\n    JZ  2(PC)\n    MOVL    0, AX // crash with nil ptr deref\n    // DI:SI = delta\n    MOVL    delta_lo+4(FP), SI\n    MOVL    delta_hi+8(FP), DI\n    // DX:AX = *addr\n    MOVL    0(BP), AX\n    MOVL    4(BP), DX\naddloop:\n    // CX:BX = DX:AX (*addr) + DI:SI (delta)\n    MOVL    AX, BX\n    MOVL    DX, CX\n    ADDL    SI, BX\n    ADCL    DI, CX\n\n    // if *addr == DX:AX {\n    //  *addr = CX:BX\n    // } else {\n    //  DX:AX = *addr\n    // }\n    // all in one instruction\n    LOCK\n    CMPXCHG8B   0(BP)\n\n    JNZ addloop\n\n    // success\n    // return CX:BX\n    MOVL    BX, new_lo+12(FP)\n    MOVL    CX, new_hi+16(FP)\n    RET\n</code></pre>\n\n<p>That may open the question: why not use a struct with a lock? </p>\n\n<hr>\n\n<p>Edit to answer question in comments: Yes, using a 32-bit integer would result in actual atomic operations on all Go-supported architectures because they all support <code>XADDL</code> (or analog) to the best of my knowledge.</p>\n"}], "owner": {"reputation": 502, "user_id": 4896540, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/87995a686ab93aa90a57360c43ea00b6?s=128&d=identicon&r=PG&f=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/4896540/alex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 139, "favorite_count": 2, "accepted_answer_id": 30392103, "answer_count": 1, "score": 2, "last_activity_date": 1432285677, "creation_date": 1432280887, "last_edit_date": 1432281598, "question_id": 30391141, "link": "https://stackoverflow.com/questions/30391141/store-2-values-in-one-variable", "title": "Store 2 values in one variable", "body": "<p>Is this Go code correct and portable, I need to store 2 counters (each call only one counter will be updated) in one variable to avoid locks in actual code where I am going to use single atomic.AddUint64() instead of locking whole struct.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nvar long uint64 // Actual counters storage\n\nfunc main() {\n    left := uint32(100) // First counter\n    right := uint32(200) // Second counter\n    long = uint64(left)\n    long = long &lt;&lt; 32 | uint64(right)\n    fmt.Println(left, right)\n\n    long += uint64(1 &lt;&lt; 32) // Increment left\n    long += 1 // Increment right\n\n    xLeft := uint32(long &gt;&gt; 32) // Get left\n    xRight := uint32(long) // Get right\n    fmt.Println(xLeft, xRight)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/aBlp-Zatgn\" rel=\"nofollow\">http://play.golang.org/p/aBlp-Zatgn</a></p>\n"}, {"tags": ["file", "go", "atomic"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1432246685, "post_id": 30385225, "comment_id": 48859827, "body": "If you restrict yourself to POSIX systems, the Rename is the correct way. Windows however doesn&#39;t support this on all versions, and not supported by Go on windows."}, {"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432248343, "post_id": 30385225, "comment_id": 48860412, "body": "@JimB, what do you think about step 1? are there other (significant) steps missing?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 6, "creation_date": 1432248421, "post_id": 30385225, "comment_id": 48860436, "body": "For #1 I&#39;d use <a href=\"https://golang.org/pkg/io/ioutil/#TempFile\" rel=\"nofollow noreferrer\"><code>ioutil.TempFile</code></a> (with <code>dir</code> set to the final directory so that rename won&#39;t involve a cross device copy) for creating the temporary rather than trying to generate a random one and handle race conditions yourself."}, {"owner": {"reputation": 2888, "user_id": 3555300, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e7112ac796e7b182256ac77ab9724d2b?s=128&d=identicon&r=PG&f=1", "display_name": "Jiang YD", "link": "https://stackoverflow.com/users/3555300/jiang-yd"}, "edited": false, "score": 1, "creation_date": 1432256261, "post_id": 30385225, "comment_id": 48862702, "body": "but its not about golang."}, {"owner": {"reputation": 15641, "user_id": 1567738, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1065193e064ef75f6278754f7f02abb6?s=128&d=identicon&r=PG", "display_name": "Intermernet", "link": "https://stackoverflow.com/users/1567738/intermernet"}, "edited": false, "score": 0, "creation_date": 1432286297, "post_id": 30385225, "comment_id": 48873627, "body": "For windows, it may be possible to use <code>ReplaceFile</code> <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa365512(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a> which supports XP to current versions, but you would need to add it alongside shims to the POSIX Rename functions within your own package to make it os-independent. More info at <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/hh802690(v=vs.85).aspx\" rel=\"nofollow noreferrer\">msdn.microsoft.com/en-us/library/windows/desktop/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4984, "user_id": 1013460, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61b92f3751fd7ac0f3e78c676d8f5b0a?s=128&d=identicon&r=PG", "display_name": "voidlogic", "link": "https://stackoverflow.com/users/1013460/voidlogic"}, "is_accepted": true, "score": 9, "last_activity_date": 1433015781, "last_edit_date": 1495541798, "creation_date": 1433008304, "answer_id": 30549434, "question_id": 30385225, "link": "https://stackoverflow.com/questions/30385225/is-there-an-os-independent-way-to-atomically-overwrite-a-file/30549434#30549434", "title": "Is there an os-independent way to atomically overwrite a file?", "body": "<p><a href=\"https://golang.org/pkg/os/#Rename\" rel=\"noreferrer\"><code>os.Rename</code></a> calls <a href=\"https://golang.org/pkg/syscall/#Rename\" rel=\"noreferrer\"><code>syscall.Rename</code></a> which for Linux/UNIXs uses the rename syscall (which is atomic*). On Windows <a href=\"https://golang.org/pkg/syscall/#Rename\" rel=\"noreferrer\"><code>syscall.Rename</code></a> calls <a href=\"https://msdn.microsoft.com/en-us/library/windows/desktop/aa365239%28v=vs.85%29.aspx\" rel=\"noreferrer\"><code>MoveFileW</code></a> which assuming the source and destination are on the same device (which can be arranged) and the filesystem is <a href=\"http://en.wikipedia.org/wiki/NTFS\" rel=\"noreferrer\">NTFS</a> (which is often the case) is atomic*.</p>\n\n<p>I would take care to make sure the source and destination are on the same device so the Linux rename does not fail, and the Windows rename is actually atomic. As Dave C mentions above creating your temporary file (usually using <a href=\"https://golang.org/pkg/io/ioutil/#TempFile\" rel=\"noreferrer\"><code>ioutil.TempFile</code></a>) in the same directory as existing file is the way to go; this is how I do my atomic renames.</p>\n\n<p>This works for me in my use case which is:</p>\n\n<ol>\n<li>One Go process gets updates and renames files to swap updates in.</li>\n<li>Another Go process is watching for file updates with <a href=\"https://github.com/howeyc/fsnotify\" rel=\"noreferrer\">fsnotify</a> and re-<a href=\"http://en.wikipedia.org/wiki/Mmap\" rel=\"noreferrer\">mmap</a>s the file when it is updated.</li>\n</ol>\n\n<p>In the above use case simply using <a href=\"https://golang.org/pkg/os/#Rename\" rel=\"noreferrer\"><code>os.Rename</code></a> has worked perfectly well for me.</p>\n\n<p>Some further reading:</p>\n\n<ol>\n<li><a href=\"https://stackoverflow.com/questions/7054844/is-rename-atomic\">Is rename() atomic?</a> \"Yes and no. rename() is atomic assuming the OS does not crash....\"</li>\n<li><a href=\"https://stackoverflow.com/questions/167414/is-an-atomic-file-rename-with-overwrite-possible-on-windows\">Is an atomic file rename (with overwrite) possible on Windows?</a></li>\n</ol>\n\n<p>*Note: I do want to point out that when people talk about atomic filesystem <em>file</em> operations, from an application perspective, they usually mean the operation happens or does not happen (which <a href=\"http://en.wikipedia.org/wiki/Journaling_file_system\" rel=\"noreferrer\">journaling</a> can help with) from the users perspective. If you are using atomic in the sense of an atomic memory operation, very few filesystem operations (outside of direct I/O [<a href=\"https://stackoverflow.com/questions/5055859/how-are-the-o-sync-and-o-direct-flags-in-open2-different-alike\">O_DIRECT</a>] one block writes and reads with disk buffering disabled) can be considered truly atomic.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3252, "favorite_count": 1, "accepted_answer_id": 30549434, "answer_count": 1, "score": 8, "last_activity_date": 1560973354, "creation_date": 1432246318, "last_edit_date": 1560973354, "question_id": 30385225, "link": "https://stackoverflow.com/questions/30385225/is-there-an-os-independent-way-to-atomically-overwrite-a-file", "title": "Is there an os-independent way to atomically overwrite a file?", "body": "<p>If the file already exists, I want to overwrite it. If it doesn't exist, I want to create it and write to it. I'd prefer to not have to use a 3rd party library like <a href=\"https://github.com/nightlyone/lockfile\" rel=\"noreferrer\">lockfile</a> (which seems to handle all types of locking.)</p>\n\n<p>My initial idea was to:</p>\n\n<ol>\n<li>Write to a temporary file with a randomly generated large id to avoid conflict.</li>\n<li><a href=\"https://golang.org/pkg/os/#Rename\" rel=\"noreferrer\">Rename</a> the temp filename -> new path name.</li>\n</ol>\n"}, {"tags": ["algorithm", "data-structures", "go", "heap", "max-heap"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432244847, "post_id": 30384899, "comment_id": 48859005, "body": "You should probably include your <code>MaxHeap</code> type definition."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432244943, "post_id": 30384899, "comment_id": 48859052, "body": "BTW, have you looked at <a href=\"https://golang.org/pkg/container/heap/\" rel=\"nofollow noreferrer\"><code>container&#47;heap</code></a>? In particluar you could compare your implementation with what they do for <a href=\"https://golang.org/pkg/container/heap/#Fix\" rel=\"nofollow noreferrer\"><code>heap.Fix</code></a> (click through to the source)."}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432245066, "post_id": 30384899, "comment_id": 48859114, "body": "Yes - but I was trying to implement it the way it was done in Cormen&#39;s algorithms book"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432245186, "post_id": 30384899, "comment_id": 48859168, "body": "Another BTW (that doesn&#39;t address the issue, sorry): you can just do <code>slice[i], slice[largest] = slice[largest], slice[i]</code> to swap two entries."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432245401, "post_id": 30384899, "comment_id": 48859260, "body": "Playground runnable version of your code: <a href=\"https://play.golang.org/p/QyhBY_cuyn\" rel=\"nofollow noreferrer\">play.golang.org/p/QyhBY_cuyn</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432245852, "post_id": 30384899, "comment_id": 48859471, "body": "Your use of <code>left, right := 2*i, 2*i + 1</code> looks suspicious. For <code>i = 0</code> the &quot;left child&quot; is itself. Should this perhaps be <code>left, right := 2*i+1, 2*i+2</code>??"}, {"owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432246038, "post_id": 30384899, "comment_id": 48859550, "body": "I think that might be it - that gives me an array of [16 14 10 8 7 9 3 2 4 1] - that&#39;s a valid max-heap right? Could you check my heapsort method as well?"}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 8, "last_activity_date": 1432247795, "last_edit_date": 1592644375, "creation_date": 1432247795, "answer_id": 30385483, "question_id": 30384899, "link": "https://stackoverflow.com/questions/30384899/golang-heap-and-heapsort/30385483#30385483", "title": "GoLang Heap and Heapsort", "body": "<p>The issue was that slice indexes start at zero so your:</p>\n<pre><code>left := 2*i\nright := 2*i + 1\n</code></pre>\n<p>gives a left child of 0 for index 0 (i.e., itself).\nJust add one to each of those.</p>\n<p>Your <code>heapSort</code> had a similar issue calling <code>h.MaxHeapify(1)</code> instead of 0. That effectively left whatever value was at the front there.</p>\n<p>Here is a modified version of your code that works (test file also included that uses <code>testing/quick</code> to verify it against <code>container/heap</code> and <code>sort</code>).</p>\n<h3>heap.go:</h3>\n<pre><code>package main\n\nimport &quot;fmt&quot;\n\ntype MaxHeap struct {\n    slice    []int\n    heapSize int\n}\n\nfunc BuildMaxHeap(slice []int) MaxHeap {\n    h := MaxHeap{slice: slice, heapSize: len(slice)}\n    for i := len(slice) / 2; i &gt;= 0; i-- {\n        h.MaxHeapify(i)\n    }\n    return h\n}\n\nfunc (h MaxHeap) MaxHeapify(i int) {\n    l, r := 2*i+1, 2*i+2\n    max := i\n\n    if l &lt; h.size() &amp;&amp; h.slice[l] &gt; h.slice[max] {\n        max = l\n    }\n    if r &lt; h.size() &amp;&amp; h.slice[r] &gt; h.slice[max] {\n        max = r\n    }\n    //log.Printf(&quot;MaxHeapify(%v): l,r=%v,%v; max=%v\\t%v\\n&quot;, i, l, r, max, h.slice)\n    if max != i {\n        h.slice[i], h.slice[max] = h.slice[max], h.slice[i]\n        h.MaxHeapify(max)\n    }\n}\n\nfunc (h MaxHeap) size() int { return h.heapSize } // ???\n\nfunc heapSort(slice []int) []int {\n    h := BuildMaxHeap(slice)\n    //log.Println(slice)\n    for i := len(h.slice) - 1; i &gt;= 1; i-- {\n        h.slice[0], h.slice[i] = h.slice[i], h.slice[0]\n        h.heapSize--\n        h.MaxHeapify(0)\n    }\n    return h.slice\n}\n\nfunc main() {\n    s := []int{4, 1, 3, 2, 16, 9, 10, 14, 8, 7}\n    h := BuildMaxHeap(s)\n    fmt.Println(h)\n\n    s = heapSort(s)\n    fmt.Println(s)\n}\n</code></pre>\n<p><a href=\"https://play.golang.org/p/sZp2NkAQx1\" rel=\"noreferrer\"><kbd>Playground</kbd></a></p>\n<h3>heap_test.go:</h3>\n<pre><code>package main\n\nimport (\n    &quot;container/heap&quot;\n    &quot;reflect&quot;\n    &quot;sort&quot;\n    &quot;testing&quot;\n    &quot;testing/quick&quot;\n)\n\n// Compare against container/heap implementation:\n// https://golang.org/pkg/container/heap/#example__intHeap\n\ntype IntHeap []int\n\nfunc (h IntHeap) Len() int            { return len(h) }\nfunc (h IntHeap) Less(i, j int) bool  { return h[i] &gt; h[j] } // use &gt; for MaxHeap\nfunc (h IntHeap) Swap(i, j int)       { h[i], h[j] = h[j], h[i] }\nfunc (h *IntHeap) Push(x interface{}) { *h = append(*h, x.(int)) }\nfunc (h *IntHeap) Pop() interface{} {\n    old := *h\n    n := len(old)\n    x := old[n-1]\n    *h = old[:n-1]\n    return x\n}\n\nfunc TestMaxHeap(t *testing.T) {\n    f := func(s []int) bool {\n        //t.Log(&quot;testing heap len&quot;, len(s))\n        h := BuildMaxHeap(s)\n        h2 := make(IntHeap, len(h.slice))\n        copy(h2, h.slice)\n        for i := range h2 {\n            heap.Fix(&amp;h2, i)\n        }\n        eq := reflect.DeepEqual(h.slice, []int(h2))\n        if !eq {\n            t.Logf(&quot;MaxHeap: %v\\n\\t IntHeap: %v&quot;, h.slice, h2)\n        }\n        return eq\n    }\n    if err := quick.Check(f, nil); err != nil {\n        t.Error(err)\n    }\n}\n\nfunc TestHeapSort(t *testing.T) {\n    f := func(s []int) bool {\n        s = heapSort(s)\n        return sort.IntsAreSorted(s)\n    }\n    if err := quick.Check(f, nil); err != nil {\n        t.Error(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1458, "user_id": 2032771, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/UNFib.jpg?s=128&g=1", "display_name": "avrono", "link": "https://stackoverflow.com/users/2032771/avrono"}, "is_accepted": false, "score": 0, "last_activity_date": 1528545453, "creation_date": 1528545453, "answer_id": 50774030, "question_id": 30384899, "link": "https://stackoverflow.com/questions/30384899/golang-heap-and-heapsort/50774030#50774030", "title": "GoLang Heap and Heapsort", "body": "<p>Here's a way to do the same thing without the addition of the structure to hold the data and heapsize:</p>\n\n<pre><code>// AS described in Introduction to Algorithms (3rd Edition)\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc left(i int) int {\n    return 2 * i\n}\n\nfunc right(i int) int {\n    return 2*i + 1\n}\n\nfunc parent(i int) int {\n    return i / 2\n}\n\nfunc maxHeapify(a []int, i int) []int {\n\n    fmt.Printf(\"Array: %v\\n\", a)\n\n    l := left(i) + 1\n    r := right(i) + 1\n    var largest int\n    if l &lt; len(a) &amp;&amp; l &gt;= 0 &amp;&amp; a[l] &gt; a[i] {\n        largest = l\n    } else {\n        largest = i\n    }\n    if r &lt; len(a) &amp;&amp; r &gt;= 0 &amp;&amp; a[r] &gt; a[largest] {\n        largest = r\n    }\n    if largest != i {\n        fmt.Printf(\"Exchanging: %d index (%d) with %d index (%d)\\n\", a[i], i, a[largest], largest)\n        a[i], a[largest] = a[largest], a[i]\n        a = maxHeapify(a, largest)\n    }\n    return a\n}\n\nfunc buildMaxHeap(a []int) []int {\n    for i := len(a)/2 - 1; i &gt;= 0; i-- {\n        fmt.Printf(\"Building: %d index %d\\n\", a[i], i)\n        a = maxHeapify(a, i)\n    }\n    return a\n}\n\nfunc heapsort(a []int) []int {\n\n    a = buildMaxHeap(a)\n    fmt.Printf(\"Starting sort ... array is %v\\n\", a)\n    size := len(a)\n    for i := size - 1; i &gt;= 1; i-- {\n        a[0], a[i] = a[i], a[0]\n        size--\n        maxHeapify(a[:size], 0)\n    }\n    return a\n}\n\nfunc main() {\n\n    a := [10]int{4, 1, 3, 2, 16, 9, 10, 14, 8, 7}\n    fmt.Printf(\"Array: %v\\n\", a)\n\n    b := heapsort(a[:])\n    fmt.Printf(\"Array: %v\\n\", b)\n\n}\n</code></pre>\n"}], "owner": {"reputation": 5712, "user_id": 915672, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/e098cd6eb0f9064f197a2a6e016f3d63?s=128&d=identicon&r=PG&f=1", "display_name": "praks5432", "link": "https://stackoverflow.com/users/915672/praks5432"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3240, "favorite_count": 1, "accepted_answer_id": 30385483, "answer_count": 2, "score": 1, "last_activity_date": 1577826996, "creation_date": 1432244672, "last_edit_date": 1432245880, "question_id": 30384899, "link": "https://stackoverflow.com/questions/30384899/golang-heap-and-heapsort", "title": "GoLang Heap and Heapsort", "body": "<p>So I'm trying to implement a max heap for practice so I can get familiar with Go. </p>\n\n<pre><code>type MaxHeap struct {\n    slice []int\n    heapSize int\n}\nfunc BuildMaxHeap(slice []int) MaxHeap{\n    h := MaxHeap{slice: slice, heapSize: len(slice)}\n    for i := len(slice)/2; i &gt;= 0; i-- {\n        h.MaxHeapify(i)\n    }\n    return h\n}\n\nfunc (h MaxHeap) MaxHeapify(i int) {\n    left := 2*i\n    right := 2*i + 1\n    largest := i\n    slice := h.slice\n\n    if left &lt; h.size() {\n        if slice[left] &gt; slice[i] {\n            largest = left\n        } else {\n            largest = i\n        }\n    }\n    if right &lt; h.size() {\n        if slice[right] &gt; slice[largest] {\n            largest = right\n        }\n    }\n    if largest != i {\n        prevLargest := slice[i]\n        slice[i] = slice[largest]\n        slice[largest] = prevLargest\n        h.MaxHeapify(largest)\n    }\n}\n</code></pre>\n\n<p>On an array of <code>[4,1,3,2,16,9,10,14,8,7]</code> I produce <code>[16 14 9 10 8 1 4 2 3 7]</code></p>\n\n<p>which is wrong as the 9 is one level too high and should be switched with the 10. </p>\n\n<p>Where am I going wrong? </p>\n\n<p>I also know something is weird, because when I try and heapsort </p>\n\n<pre><code>func heapSort(slice []int) []int {\n    h := BuildMaxHeap(slice)\n    fmt.Println(slice)\n    for i := len(h.slice) - 1; i &gt;=1 ; i-- {\n        first := h.slice[0]\n        last := h.slice[i]\n        h.slice[0] = last\n        h.slice[i] = first\n        h.heapSize--\n        h.MaxHeapify(1)\n    }\n    return h.slice\n}\n</code></pre>\n\n<p>It does not work.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 2, "creation_date": 1432233171, "post_id": 30381558, "comment_id": 48852535, "body": "I think you have mistaken <code>time.Tick</code> for <code>time.Sleep</code>."}, {"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "reply_to_user": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 1, "creation_date": 1432233414, "post_id": 30381558, "comment_id": 48852705, "body": "Turns out this change fixes it so it runs as expected (with GOMAXPROCS=2)."}, {"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "edited": false, "score": 0, "creation_date": 1432233508, "post_id": 30381558, "comment_id": 48852766, "body": "Yup, all mysteries solved in under 10 minutes. Viva SO!"}], "answers": [{"comments": [{"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 0, "creation_date": 1432233247, "post_id": 30381655, "comment_id": 48852588, "body": "Excellent answer (can&#39;t accept it for another 6 minutes)."}, {"owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "edited": false, "score": 1, "creation_date": 1432233532, "post_id": 30381655, "comment_id": 48852800, "body": "Switching to time.Sleep() with GOMAXPROCS=2 and it works as expected.  I know this bit of code was a mess with a data race in it, but I was trying to distill the problem from something much bigger in order to ask the question you ended up answering.  Thank you."}], "tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 6, "last_activity_date": 1432233532, "last_edit_date": 1432233532, "creation_date": 1432232989, "answer_id": 30381655, "question_id": 30381558, "link": "https://stackoverflow.com/questions/30381558/main-thread-never-yields-to-goroutine/30381655#30381655", "title": "Main thread never yields to goroutine", "body": "<p>There is nothing in your tight <code>for</code> loop that lets the Go scheduler run.\nThe schedule considers other goroutines whenever one blocks or on some (which? all?) function calls.</p>\n\n<p>Since you do neither the easiest solution is to add a call to <a href=\"https://golang.org/pkg/runtime/#Gosched\" rel=\"nofollow\"><code>runtime.Gosched</code></a>. E.g.:</p>\n\n<pre><code>for {\n    count++\n    if count % someNum == 0 {\n        runtime.Gosched()\n    }\n}\n</code></pre>\n\n<p>Also note that writing and reading the same variable from different goroutines without locking or synchronization is a data race and <a href=\"https://software.intel.com/en-us/blogs/2013/01/06/benign-data-races-what-could-possibly-go-wrong\" rel=\"nofollow\"><strong>there are no benign data races</strong></a>, your program could do <em>anything</em> when reading a value as it's being written. (And synchronization would also let the Go scheduler run.)</p>\n\n<p>For a simple counter you can avoid locks by using <a href=\"https://golang.org/pkg/sync/atomic/#AddInt64\" rel=\"nofollow\"><code>atomic.AddInt64(&amp;var, 1)</code></a> and <a href=\"https://golang.org/pkg/sync/atomic/#LoadInt64\" rel=\"nofollow\"><code>atomic.LoadInt64(&amp;var)</code></a>.</p>\n\n<p>Further note (as pointed out by @tomasz and completely missed by me), <code>time.Tick</code> doesn't delay anything, you may have wanted <code>time.Sleep</code> or <code>for range time.Tick(\u2026)</code>.</p>\n"}], "owner": {"reputation": 1667, "user_id": 359660, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/73a63c1f44ef127e609753975421ef7f?s=128&d=identicon&r=PG", "display_name": "LanceH", "link": "https://stackoverflow.com/users/359660/lanceh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 590, "favorite_count": 0, "accepted_answer_id": 30381655, "answer_count": 1, "score": 2, "last_activity_date": 1432233768, "creation_date": 1432232719, "last_edit_date": 1432233768, "question_id": 30381558, "link": "https://stackoverflow.com/questions/30381558/main-thread-never-yields-to-goroutine", "title": "Main thread never yields to goroutine", "body": "<ul>\n<li>edit * -- uncomment the two runtime lines and change Tick() to Sleep() and it works as expected, printing one number every second.  Leaving code as is so answer/comments make sense.</li>\n</ul>\n\n<p>go version go1.4.2 darwin/amd64</p>\n\n<p>When I run the following, I never see anything printed from <code>go Counter()</code>.</p>\n\n<pre><code>package main\n\nimport (\n  \"fmt\"\n  \"time\"\n  //\"runtime\"\n)\n\nvar count int64 = 0\n\nfunc main() {\n  //runtime.GOMAXPROCS(2)\n  fmt.Println(\"main\")\n  go Counter()\n  fmt.Println(\"after Counter()\")\n  for {\n    count++\n  }\n}\n\nfunc Counter() {\n  fmt.Println(\"In Counter()\")\n  for {\n    fmt.Println(count)\n    time.Tick(time.Second)\n  }\n}\n\n&gt; go run a.go\nmain\nafter Counter()\n</code></pre>\n\n<p>If I uncomment the runtime stuff, I will get some strange results like the following all printed at once (not a second apart):</p>\n\n<pre><code>&gt; go run a.go\nmain\nafter Counter()\nIn Counter()\n10062\n36380\n37351\n38036\n38643\n39285\n39859\n40395\n40904\n43114\n</code></pre>\n\n<p>What I expect is that <code>go Counter()</code> will print whatever count is at every second while it is incremented continuously by the main thread.  I'm not so much looking for different code to get the same thing done.  My question is more about what is going on and where am I wrong in my expectations?  The second results in particular don't make any sense, being printed all at once.  They should never be printed closer than a second apart as far as I can tell, right?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 4, "creation_date": 1432232653, "post_id": 30381233, "comment_id": 48852240, "body": "<a href=\"http://stackoverflow.com/a/30178766/55504\">This answer</a> (by me) covers various ways to make testable errors. It also links to <a href=\"https://blog.golang.org/error-handling-and-go\" rel=\"nofollow noreferrer\">The Go Blog: Error handling and Go</a>."}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 5, "last_activity_date": 1432232244, "last_edit_date": 1432232244, "creation_date": 1432231935, "answer_id": 30381323, "question_id": 30381233, "link": "https://stackoverflow.com/questions/30381233/handling-multiple-errors/30381323#30381323", "title": "Handling multiple errors", "body": "<p>You have 3 main options:</p>\n\n<ol>\n<li><p>string based, i.e. looking into the message. This is of course pretty bad because if you later change one letter in the message, you need to rewrite all the checking code, so I'd avoid it.</p></li>\n<li><p>If the error messages can stay constant, simply create errors as global variables, and then compare the received error with a known pre-defined one.</p></li>\n</ol>\n\n<p>For example:</p>\n\n<pre><code>var ErrDB = errors.New(\"Database Error\")\nvar ErrTimeout = errors.New(\"Timeout\") //or whatever\n</code></pre>\n\n<p>and then</p>\n\n<pre><code>if err := someFunc(); err != nil {\n  switch err {\n  case ErrDB:\n    //do stuff that needs to be done here\n  case ErrTimeout:\n    //etc /etc\n  }\n}\n</code></pre>\n\n<ol start=\"3\">\n<li>Create a custom error type, since errors are just interfaces, that can have some identifier or other contextual data. </li>\n</ol>\n\n<p>For example:</p>\n\n<pre><code>const (\n  ErrDB = 1\n  ErrTimeout = 2\n  ...\n)\n\ntype MyError struct {\n   Code int\n   Message string\n}\n\n// This is what you need to be an error\nfunc (e MyError)Error() string {\n   return e.Message\n}\n\n\nfunc NewError(s string, code int) error {\n   return MyError{s,code}\n}\n</code></pre>\n\n<p>and then when you return it do something like this:</p>\n\n<pre><code>// Return a MyError with a DB code for db operations\nfunc someFunc() error {\n   if err := talkToDB(); err != nil {\n      return NewError(err.Error(), ErrDB)\n   }\n   return nil\n}\n</code></pre>\n\n<p>and when analyzing it:</p>\n\n<pre><code>if err := someFunc(); err != nil {\n\n   // check if this is a MyError\n   if me, ok := err.(MyError); ok {\n     // now we can check the code\n     switch me.Code {\n       case ErrDB:\n         //handle this\n       ....\n     }  \n   }\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 425, "favorite_count": 1, "accepted_answer_id": 30381323, "answer_count": 1, "score": 4, "last_activity_date": 1432232244, "creation_date": 1432231603, "question_id": 30381233, "link": "https://stackoverflow.com/questions/30381233/handling-multiple-errors", "title": "Handling multiple errors", "body": "<p>I have Function 1:</p>\n\n<pre><code>func Function1() {\n    if err := Function2(); err != nil {\n\n    }\n}\n</code></pre>\n\n<p>and Function2:</p>\n\n<pre><code>func Function2() error {\n    if err := doSomethingThatMightCauseError(); err != nil {\n        return errors.New(\"Error Type 1\")\n    }\n\n    if err := doSomethingElseThatMightCauseError(); err != nil {\n        return errors.New(\"Error Type 2\")\n    }\n}\n</code></pre>\n\n<p>How can I detect what type of error has happened (internal, no results found in db etc) and then handle accordingly in Function 1?</p>\n"}, {"tags": ["go", "http-referer"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432228523, "post_id": 30379822, "comment_id": 48849784, "body": "what &quot;real referer value&quot; are you trying to read? What do you want to do?"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432228805, "post_id": 30379822, "comment_id": 48849996, "body": "I mean, I need <code>referer-parser</code> to read real value instead of placeholder. Please read carefully the codes. In production, we need to change the placeholder value."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432231076, "post_id": 30379822, "comment_id": 48851340, "body": "Are you asking how to read <code>referer_value</code> from some type of configuration, so you can replace it at runtime?"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432234535, "post_id": 30379822, "comment_id": 48853376, "body": "Get from the HTTP header. When someone come from Bing or Yahoo, I can get the HTTP referer data like referer URL &amp; referer keyword"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1432234959, "creation_date": 1432234959, "answer_id": 30382230, "question_id": 30379822, "link": "https://stackoverflow.com/questions/30379822/referer-parser-golang-production-setting-instead-of-using-placeholder-value/30382230#30382230", "title": "referer-parser Golang: Production setting instead of using placeholder value?", "body": "<p>Read the value you want from the http headers inside your handler:</p>\n\n<pre><code>e.Get(\"/users\", func(c *echo.Context) *echo.HTTPError {\n    refererURL := c.Request.Header.Get(\"Referer\")\n    r := refererparser.Parse(refererURL)\n    return c.String(http.StatusOK, \"The search term is: \"+r.SearchTerm)\n})\n</code></pre>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 888, "favorite_count": 0, "accepted_answer_id": 30382230, "answer_count": 1, "score": -1, "last_activity_date": 1432234959, "creation_date": 1432227035, "last_edit_date": 1432229550, "question_id": 30379822, "link": "https://stackoverflow.com/questions/30379822/referer-parser-golang-production-setting-instead-of-using-placeholder-value", "title": "referer-parser Golang: Production setting instead of using placeholder value?", "body": "<p><code>referer-parser</code> read placeholder value in the example, while the production setting is not documented.</p>\n\n<p>I need <code>referer-parser</code> to read real referer value instead of placeholder value.</p>\n\n<p>Below is my code (the <code>referer_url</code> read placeholder value):</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/labstack/echo\"\n    \"github.com/snowplow/referer-parser/go\"\n    \"net/http\"\n)\n\nfunc main() {\n    e := echo.New()\n\n    referer_url := \"http://www.google.com/search?q=gateway+oracle+cards+denise+linn&amp;hl=en&amp;client=safari\"\n    r := refererparser.Parse(referer_url)\n\n    e.Get(\"/users\", func(c *echo.Context) *echo.HTTPError {\n        return c.String(http.StatusOK, \"The search term is: \"+r.SearchTerm)\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n"}, {"tags": ["ssl", "https", "go", "proxy"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432304018, "post_id": 30379647, "comment_id": 48885651, "body": "You can&#39;t listen to http and http on the same port, they&#39;re different protocols. They are also 2 different proxy settings, because you need to MITM https in order to proxy it. If you want to block https, do it at the firewall, or set the https proxy to a closed port."}, {"owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "edited": false, "score": 0, "creation_date": 1432315014, "post_id": 30379647, "comment_id": 48892434, "body": "If you set an HTTPS proxy in your browser, it will connect to the proxy over HTTP, and use a CONNECT request. If you&#39;re running a transparent proxy, HTTPS needs to be listening on a separate port from HTTP so that it&#39;s ready to accept encrypted connections."}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1432658645, "post_id": 30379647, "comment_id": 49009099, "body": "I want to kill the CONNECT and respond with a HTTP/HTML page stating that secure connections are denied through this proxy. This catches the CONNECT, but I don&#39;t know how to respond with a custom response: ``` \t\tproxy.OnRequest().HandleConnectFunc(func(host string, ctx *goproxy.ProxyCtx) (*goproxy.ConnectAction, string) { \t\t\tlog.Println(&quot;connecting: &quot;, ctx.Req.URL.Host) \t\treturn goproxy.OkConnect, host \t}) ```"}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "edited": false, "score": 0, "creation_date": 1465131038, "post_id": 30379647, "comment_id": 62763991, "body": "@amlwwalker did you solve this problem ?"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1465132350, "post_id": 30379647, "comment_id": 62764454, "body": "I did! If u check my github for projects I have contributed to, and see Mustard, I&#39;ve got it working in there. When I&#39;m by computer can link to it, otherwise ask me questions using the issues in github"}, {"owner": {"reputation": 621, "user_id": 4851387, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/92ef9e7d030494e2e142ce9d7a1f436b?s=128&d=identicon&r=PG&f=1", "display_name": "abdel", "link": "https://stackoverflow.com/users/4851387/abdel"}, "edited": false, "score": 0, "creation_date": 1465304212, "post_id": 30379647, "comment_id": 62836961, "body": "@amlwwalker done, I added an issue"}, {"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1465304611, "post_id": 30379647, "comment_id": 62837265, "body": "Responded on github"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1933, "favorite_count": 3, "answer_count": 0, "score": 1, "last_activity_date": 1432227677, "creation_date": 1432226477, "last_edit_date": 1432227677, "question_id": 30379647, "link": "https://stackoverflow.com/questions/30379647/goproxy-ssl-interception-in-golang", "title": "GoProxy SSL interception in golang", "body": "<p>I am trying to block requests to anything over HTTPS</p>\n\n<p>It works perfectly for HTTP, however HTTPS seems able to completely avoid my proxy. I am using foxyproxy in firefox to set it to use my proxy.</p>\n\n<p>The following code will print the URL when the request from the browser requests over HTTP, but over HTTPS I see nothing.</p>\n\n<p>Any ideas why??</p>\n\n<pre><code>func DropHTTPS() net.Listener {\n    listener, _ = net.Listen(CONN_TYPE, CONN_HOST+\":\"+CONN_PORT)\n    proxy := goproxy.NewProxyHttpServer()\n    proxy.OnRequest().DoFunc(func (req *http.Request, ctx *goproxy.ProxyCtx) (*http.Request, *http.Response) {\n        log.Println(\"url: \", req.URL)\n        return req, nil\n    })\n    go http.Serve(listener, proxy)\n    return listener\n}\n</code></pre>\n\n<p>EDIT: \nI just read about <code>HTTPS CONNECT</code> and perhaps that is how I need to handle the fact that an HTTPS request is made.\nThe goproxy library seems to have <code>HTTPSHandler()</code> and <code>HijackConnect()</code> available, although I don't want to MITM the connection, I just want to block it. </p>\n\n<p>EDIT AGAIN:\nThis code, seems to run the HTTPS proxy on a different port to HTTP. Im not sure if this needs to be configured in Firefox, or my proxy can just listen on one port for both HTTP and HTTPS.</p>\n\n<p>Also, do I need to 'listen' differently?</p>\n\n<p><code>HandleConnectFunc()</code> or something?</p>\n"}, {"tags": ["struct", "go"], "answers": [{"comments": [{"owner": {"reputation": 869, "user_id": 2620356, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d9d70e7de8674154dc8b6a5dde5d5c75?s=128&d=identicon&r=PG", "display_name": "kingSlayer", "link": "https://stackoverflow.com/users/2620356/kingslayer"}, "edited": false, "score": 0, "creation_date": 1432229796, "post_id": 30378324, "comment_id": 48850603, "body": "@Elliot Reeve You should also look this <a href=\"http://stackoverflow.com/questions/10998222/json-parsing-of-int64-in-go-null-values\">answer</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 6, "last_activity_date": 1432224661, "last_edit_date": 1432224661, "creation_date": 1432222674, "answer_id": 30378324, "question_id": 30377861, "link": "https://stackoverflow.com/questions/30377861/golang-0-not-as-null/30378324#30378324", "title": "Golang - 0 not as null", "body": "<p>Structures for serialization often use pointer to indicate a nullable field. It can make working with the structure a little more cumbersome to work with, but has the advantage of discerning between <code>nil</code> and <code>0</code></p>\n\n<pre><code>type T struct {\n    Offset *uint64 `json:\"offset,omitempty\"`\n}\n</code></pre>\n\n<p>With a nil pointer</p>\n\n<pre><code>t := T{}\n// marshals to \"{}\"\n</code></pre>\n\n<p>And after allocating a zero value</p>\n\n<pre><code>t.Offset = new(uint64)\n// marshals to `{\"offset\":0}`\n</code></pre>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 483, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1432224661, "creation_date": 1432221496, "question_id": 30377861, "link": "https://stackoverflow.com/questions/30377861/golang-0-not-as-null", "title": "Golang - 0 not as null", "body": "<p>I am passing values to a struct in which the value has <code>omitempty</code></p>\n\n<p><code>Offset     uint64 'json:\"offset,omitempty\"'</code></p>\n\n<p>However when I pass 0 as the value of offset it is also omitted.</p>\n\n<p>Can I somehow declare 0 as a value which is not defined as null?</p>\n"}, {"tags": ["file", "go", "copy"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1432219383, "post_id": 30376921, "comment_id": 48843587, "body": "<code>io.Copy</code> returns the number of bytes written. You should inspect that, maybe it&#39;ll help."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1432220000, "post_id": 30376921, "comment_id": 48844115, "body": "Also, your code works for me. Can you show how you use the function?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432221154, "post_id": 30376921, "comment_id": 48845000, "body": "What are you providing to <code>in</code>? Are you seeing <i>any</i> errors? Does the bad file already exist (you return silently in that case)?"}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1432221238, "post_id": 30376921, "comment_id": 48845064, "body": "@Ainar-G I updated the question with details of using <code>filepath.Walk()</code>. @JimB I&#39;m not seeing any errors and the file does not exist before I create it."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1432226809, "post_id": 30376921, "comment_id": 48848722, "body": "BTW, your <code>os.Stat</code> check for existance followed by <code>os.Create</code> (which will truncate existing files) is a race; you can end up truncating and overwriting recently/simultaneously created files. It&#39;s better to use <a href=\"https://golang.org/pkg/os/#OpenFile\" rel=\"nofollow noreferrer\"><code>os.OpenFile</code></a> with <code>os.O_EXCL</code> and test the error with <a href=\"https://golang.org/pkg/os/#IsExist\" rel=\"nofollow noreferrer\"><code>os.IsExist</code></a> to safely detect existing files."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432228699, "post_id": 30376921, "comment_id": 48849922, "body": "@DaveC I tried <code>out, err := os.OpenFile(dst, os.O_WRONLY|os.O_CREATE|os.O_EXCL, 0644)</code> instead of Stat()+Create() but it still gives corrupted files. <a href=\"https://golang.org/pkg/os/#pkg-constants\" rel=\"nofollow noreferrer\">docs here</a>"}, {"owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 1, "creation_date": 1432229727, "post_id": 30376921, "comment_id": 48850561, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/21060945/simple-way-to-copy-a-file-in-golang\">Simple way to copy a file in golang</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432232192, "post_id": 30376921, "comment_id": 48851961, "body": "@Xeoncross, sorry I didn&#39;t mean to imply using <code>O_EXCL</code> would fix the issue you asked about; just that as a &quot;by the way&quot; (BTW) your example has a separate issue with a race condition."}, {"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "reply_to_user": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 0, "creation_date": 1432232322, "post_id": 30376921, "comment_id": 48852045, "body": "@RickSmith that question does not provide sufficient answers"}, {"owner": {"reputation": 8149, "user_id": 616644, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/wVwGC.png?s=128&g=1", "display_name": "Rick Smith", "link": "https://stackoverflow.com/users/616644/rick-smith"}, "edited": false, "score": 0, "creation_date": 1432232609, "post_id": 30376921, "comment_id": 48852208, "body": "@Xeoncross Gotcha, thanks for updating the question to explain the difference."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432272408, "post_id": 30376921, "comment_id": 48866590, "body": "The folder you walk through, do all the files exist and complete in it before you start walking the directory? The code you posted should work. I&#39;m leaning toward OS or file system (or hardware) errors. Can it be the files are modified during the run of your code?"}, {"owner": {"reputation": 3343, "user_id": 442396, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/2c7ec89489bfcad5a94119f7bd9a1abf?s=128&d=identicon&r=PG", "display_name": "Sentinel", "link": "https://stackoverflow.com/users/442396/sentinel"}, "edited": false, "score": 0, "creation_date": 1567055641, "post_id": 30376921, "comment_id": 101849823, "body": "Was this in a docker image? I am getting similar corruption on a Windows machine and can&#39;t work out the issue"}], "answers": [{"tags": [], "owner": {"reputation": 91, "user_id": 2616277, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ebf262b64d42c2bd0103eafe5940eee4?s=128&d=identicon&r=PG", "display_name": "Manan", "link": "https://stackoverflow.com/users/2616277/manan"}, "is_accepted": false, "score": -1, "last_activity_date": 1432333482, "creation_date": 1432333482, "answer_id": 30406716, "question_id": 30376921, "link": "https://stackoverflow.com/questions/30376921/how-do-you-copy-a-file-in-go/30406716#30406716", "title": "How do you copy a file in Go?", "body": "<p>Easiest way to do a copy golang is - <a href=\"http://golang.org/pkg/io/#Copy\" rel=\"nofollow\">http://golang.org/pkg/io/#Copy</a></p>\n"}, {"comments": [{"owner": {"reputation": 812, "user_id": 597430, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fbbcf771a630a0e452083fdc08cfaa6c?s=128&d=identicon&r=PG", "display_name": "Matthias Loibl", "link": "https://stackoverflow.com/users/597430/matthias-loibl"}, "edited": false, "score": 0, "creation_date": 1478457170, "post_id": 35353594, "comment_id": 68151323, "body": "Just to be clear: One should always check err before using defer."}, {"owner": {"reputation": 615, "user_id": 4762316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9df8162515eab0a6d4fed9c4674aa36?s=128&d=identicon&r=PG&f=1", "display_name": "Apoorva Manjunath", "link": "https://stackoverflow.com/users/4762316/apoorva-manjunath"}, "reply_to_user": {"reputation": 812, "user_id": 597430, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fbbcf771a630a0e452083fdc08cfaa6c?s=128&d=identicon&r=PG", "display_name": "Matthias Loibl", "link": "https://stackoverflow.com/users/597430/matthias-loibl"}, "edited": false, "score": 1, "creation_date": 1482813252, "post_id": 35353594, "comment_id": 69880658, "body": "Right. Made changes."}, {"owner": {"reputation": 1549, "user_id": 13631587, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1c4714de792628cb0aa0a4e39cf6eaa1?s=128&d=identicon&r=PG", "display_name": "Jon Nickles", "link": "https://stackoverflow.com/users/13631587/jon-nickles"}, "edited": false, "score": 0, "creation_date": 1618933387, "post_id": 35353594, "comment_id": 118750432, "body": "io.Copy efficiently implements the copy operation by calling destFile.ReadFrom(srcFile). It&#39;s good practice to call io.Copy as shown in this answer because io.Copy does the &quot;right thing&quot; for any source and destination."}], "tags": [], "owner": {"reputation": 615, "user_id": 4762316, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c9df8162515eab0a6d4fed9c4674aa36?s=128&d=identicon&r=PG&f=1", "display_name": "Apoorva Manjunath", "link": "https://stackoverflow.com/users/4762316/apoorva-manjunath"}, "is_accepted": false, "score": 8, "last_activity_date": 1482813174, "last_edit_date": 1482813174, "creation_date": 1455242584, "answer_id": 35353594, "question_id": 30376921, "link": "https://stackoverflow.com/questions/30376921/how-do-you-copy-a-file-in-go/35353594#35353594", "title": "How do you copy a file in Go?", "body": "<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io\"\n    \"os\"\n)\n\nfunc main() {\n    srcFile, err := os.Open(\"test.txt\")\n    check(err)\n    defer srcFile.Close()\n\n    destFile, err := os.Create(\"test_copy.txt\") // creates if file doesn't exist\n    check(err)\n    defer destFile.Close()\n\n    _, err = io.Copy(destFile, srcFile) // check first var for number of bytes copied\n    check(err)\n\n    err = destFile.Sync()\n    check(err)\n}\n\nfunc check(err error) {\n    if err != nil {\n        fmt.Println(\"Error : %s\", err.Error())\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>This code works for me. Do check the number of bytes copied with the return value from <code>io.Copy</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": 0, "last_activity_date": 1618924134, "creation_date": 1618924134, "answer_id": 67179604, "question_id": 30376921, "link": "https://stackoverflow.com/questions/30376921/how-do-you-copy-a-file-in-go/67179604#67179604", "title": "How do you copy a file in Go?", "body": "<p>Another option is <code>ReadFrom</code>:</p>\n<pre><code>package main\nimport &quot;os&quot;\n\nfunc copyFile(in, out string) (int64, error) {\n   i, e := os.Open(in)\n   if e != nil { return 0, e }\n   defer i.Close()\n   o, e := os.Create(out)\n   if e != nil { return 0, e }\n   defer o.Close()\n   return o.ReadFrom(i)\n}\n\nfunc main() {\n   _, e := copyFile(&quot;in.txt&quot;, &quot;out.txt&quot;)\n   if e != nil {\n      panic(e)\n   }\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/os#File.ReadFrom\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os#File.ReadFrom</a></p>\n"}], "owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10288, "favorite_count": 3, "answer_count": 3, "score": 9, "last_activity_date": 1618924134, "creation_date": 1432219022, "last_edit_date": 1495541431, "question_id": 30376921, "link": "https://stackoverflow.com/questions/30376921/how-do-you-copy-a-file-in-go", "title": "How do you copy a file in Go?", "body": "<p>I have the following function to copy a file (io.Reader actually) to the destination string location. However, it seems only part of the file is actually copied resulting in a corrupt file. What am I doing wrong?</p>\n\n<pre><code>func CopyFile(in io.Reader, dst string) (err error) {\n\n    // Does file already exist? Skip\n    if _, err := os.Stat(dst); err == nil {\n        return nil\n    }\n\n    err = nil\n\n    out, err := os.Create(dst)\n    if err != nil {\n        fmt.Println(\"Error creating file\", err)\n        return\n    }\n\n    defer func() {\n        cerr := out.Close()\n        if err == nil {\n            err = cerr\n        }\n    }()\n\n\n    var bytes int64\n    if bytes, err = io.Copy(out, in); err != nil {\n        fmt.Println(\"io.Copy error\")\n        return\n    }\n    fmt.Println(bytes)\n\n    err = out.Sync()\n    return\n}\n</code></pre>\n\n<p>I'm using this with the <code>filepath.Walk(dir, visit)</code> method to process files in a directory.</p>\n\n<pre><code>// Process each matching file on our walk down the filesystem\nfunc visit(path string, f os.FileInfo, err error) error {\n\n    if reader, err := os.Open(path); err == nil {\n        defer reader.Close()\n\n        // http://golang.org/pkg/os/#FileInfo\n        statinfo, err := reader.Stat()\n\n        if err != nil {\n            fmt.Println(err)\n            return nil\n        }\n\n        fmt.Println()\n        fmt.Println(statinfo.Size())\n\n        // Directory exists and is writable\n        err = CopyFile(reader, \"/tmp/foo/\"+f.Name())\n\n        if err != nil {\n            fmt.Println(err)\n        }\n\n    } else {\n        fmt.Println(\"Impossible to open the file:\", err)\n    }\n}\n</code></pre>\n\n<p>The current <a href=\"https://stackoverflow.com/questions/21060945/simple-way-to-copy-a-file-in-golang\">closest question</a> I could has an accepted answer that recommends using hard/soft links and doesn't abort if the file already exists.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 3, "last_activity_date": 1432220834, "creation_date": 1432220834, "answer_id": 30377630, "question_id": 30375504, "link": "https://stackoverflow.com/questions/30375504/how-to-modify-two-or-more-fields-in-document-by-single-command/30377630#30377630", "title": "How to modify two or more fields in document by single command", "body": "<p>The <a href=\"http://docs.mongodb.org/manual/reference/operator/update/inc\" rel=\"nofollow\">official mongo documentation</a> is very good. The way you use <code>$inc</code> for several fields is:</p>\n\n<pre><code>{ $inc: { &lt;field1&gt;: &lt;amount1&gt;, &lt;field2&gt;: &lt;amount2&gt;, ... } }\n</code></pre>\n\n<p>And</p>\n\n<blockquote>\n  <p>To specify a field in an embedded document or in an array, use dot notation.</p>\n</blockquote>\n\n<p>So, basically, change your update spec to something like:</p>\n\n<pre><code>bson.M{ \"$inc\": bson.M{ \"score\": 20, \"hist_score\": 10 } }\n</code></pre>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 30377630, "answer_count": 1, "score": -2, "last_activity_date": 1432220834, "creation_date": 1432215731, "question_id": 30375504, "link": "https://stackoverflow.com/questions/30375504/how-to-modify-two-or-more-fields-in-document-by-single-command", "title": "How to modify two or more fields in document by single command", "body": "<p>I am trying to add 20 points to two fields inside document with findAndModify through Go (mgo for mongo)</p>\n\n<p>like</p>\n\n<pre><code>change := mgo.Change{\n        Update: bson.M{ \"$inc\": bson.M{ \"score\": 20 } },   // here I need  to add 20 to hist_score also\n        ReturnNew: true,\n}\n\n\n\ncollection.Find( bson.M{ \"_id\": id } ).Apply( change, &amp;doc )\n</code></pre>\n\n<p>How to through one apply update two fields score and hist_score ?</p>\n"}, {"tags": ["go", "routes", "goji"], "comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432224421, "post_id": 30374089, "comment_id": 48847282, "body": "Usually I do so but I don&#39;t wanted to keep the example as simple as possible. Thanks for the tip with <code>init()</code>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432225036, "post_id": 30374089, "comment_id": 48847650, "body": "wrt errors, that&#39;s fine; it&#39;s just I see that too often in &quot;real&quot; code, probably from niave people cut-n-pasting, which is why I sometimes point it out and I prefer to simplify examples to no less than a comment about checking the error (i.e. <code>&#47;&#47; \u2026 handle error \u2026</code> or somesuch)"}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432225361, "post_id": 30374089, "comment_id": 48847826, "body": "I added an annotion."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432225415, "post_id": 30374089, "comment_id": 48847862, "body": "Would you stick with the switch-case approach?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432226103, "post_id": 30374089, "comment_id": 48848289, "body": "I don&#39;t know/use <code>goji</code> so I&#39;m unfamilar with it. However, your two cases call functions with identical signatures so perhaps you could consider using either an interface or a <code>type x func(string, web.Handler)</code>, either as the argument or as a map entry (or a field of <code>Route</code>) or whatever. As this may be getting off-topic from the question or too chatty we could take this to <a href=\"https://chat.stackoverflow.com/\">Stack Overflow Chat</a> if you liked."}], "answers": [{"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": true, "score": 1, "last_activity_date": 1432232396, "last_edit_date": 1432232396, "creation_date": 1432224173, "answer_id": 30378916, "question_id": 30374089, "link": "https://stackoverflow.com/questions/30374089/mapping-all-routes-and-its-http-methods-in-goji/30378916#30378916", "title": "Mapping all routes and its http methods in Goji", "body": "<p>The easiest way to avoid the initialization loop is to break the loop by delaying one of the initializations.</p>\n\n<p>E.g.:</p>\n\n<pre><code>var routes []Route\n\nfunc init() {\n    routes = []Route{\n        Route{\"Get\", \"/index\", hello},\n        Route{\"Get\", \"/sitemap\", sitemap},\n    }\n}\n</code></pre>\n\n<p>With this change your code compiles.</p>\n\n<p>[Edit after <a href=\"https://chat.stackoverflow.com/transcript/message/23438971#23438971\">chat</a>:]</p>\n\n<p>A fully edited and runnable example that also addresses your question about the <code>switch</code> follows:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n\n    \"github.com/zenazn/goji\"\n    \"github.com/zenazn/goji/web\"\n)\n\nvar routes []Route\n\nfunc init() {\n    // Initialzed in init() to avoid an initialization loop\n    // since `routes` refers to `sitemap` refers to `routes`.\n    routes = []Route{\n        Route{\"Get\", \"/index\", hello},\n        Route{\"Get\", \"/sitemap\", sitemap},\n        //Route{\"Post\", \"/somewhereElse\", postHandlerExample},\n    }\n}\n\ntype Route struct {\n    Method  string          `json:\"method\"`\n    Pattern string          `json:\"pattern\"`\n    Handler web.HandlerType `json:\"-\"`\n}\n\nvar methods = map[string]func(web.PatternType, web.HandlerType){\n    \"Get\":  goji.Get,\n    \"Post\": goji.Post,\n    // \u2026 others?\n}\n\nfunc (r Route) Add() {\n    //log.Println(\"adding\", r)\n    methods[r.Method](r.Pattern, r.Handler)\n}\n\nfunc hello(c web.C, w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello world\"))\n}\n\nfunc sitemap(c web.C, w http.ResponseWriter, r *http.Request) {\n    resp, err := json.MarshalIndent(routes, \"\", \"    \")\n    if err != nil {\n        http.Error(w, \"Can't generate response properly.\", 500)\n        return\n    }\n\n    w.Write(resp)\n}\n\nfunc main() {\n    for _, r := range routes {\n        r.Add()\n    }\n    goji.Serve()\n}\n</code></pre>\n\n<p>Available as a <a href=\"https://gist.github.com/dchapes/cedcfbaf31d731127cff\" rel=\"nofollow\">gist</a>.</p>\n\n<p>I'll note there is nothing wrong with a switch like you had it,\nand in this case if there are only two methods a map may be overkill.\nA <a href=\"https://gist.github.com/dchapes/cedcfbaf31d731127cff/0d56ee3df367f7d7e454dedcaa7e1ff343daa10e\" rel=\"nofollow\">previous version of the example</a>\ndidn't use a map and explicitly specified both the function and method name (which were expected to match).</p>\n\n<p>Also this version doesn't check for invalid method names (which if <code>routes</code> is always hard coded and never changed at runtime is reasonable). It would be straight forward to do <code>fn, ok := methods[r.Method]</code> and do something else if/when <code>!ok</code> if desired.</p>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 457, "favorite_count": 0, "accepted_answer_id": 30378916, "answer_count": 1, "score": 0, "last_activity_date": 1432232396, "creation_date": 1432212037, "last_edit_date": 1432225266, "question_id": 30374089, "link": "https://stackoverflow.com/questions/30374089/mapping-all-routes-and-its-http-methods-in-goji", "title": "Mapping all routes and its http methods in Goji", "body": "<p>I would like to map each route and it's request type (GET, POST, PUT, ...) to generate something like a sitemap.xml in JSON for my restful API.</p>\n\n<p>Goji uses functions to create a new route. I could store the paths and handlers in a map.</p>\n\n<p>My approach would be something like this, except that the compiler gives the following initialization loop error, because <code>sitemap</code> and <code>routes</code> refer to each other (the routemap contains the handler sitemap that should marhsall itself). </p>\n\n<pre><code>main.go:18: initialization loop:\n    main.go:18 routes refers to\n    main.go:41 sitemap refers to\n    main.go:18 routes\n</code></pre>\n\n<p>Can this be achieved in a more idiomatic way? </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n\n    \"github.com/zenazn/goji\"\n    \"github.com/zenazn/goji/web\"\n)\n\nvar routes = []Route{\n    Route{\"Get\", \"/index\", hello},\n    Route{\"Get\", \"/sitemap\", sitemap},\n}\n\ntype Route struct {\n    Method  string          `json:\"method\"`\n    Pattern string          `json:\"pattern\"`\n    Handler web.HandlerType `json:\"-\"`\n}\n\nfunc NewRoute(method, pattern string, handler web.HandlerType) {\n    switch method {\n    case \"Get\", \"get\":\n        goji.DefaultMux.Get(pattern, handler)\n    case \"Post\", \"post\":\n        goji.DefaultMux.Post(pattern, handler)\n        // and so on...\n    }\n\n}\n\nfunc hello(c web.C, w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello world\"))\n}\n\nfunc sitemap(c web.C, w http.ResponseWriter, r *http.Request) {\n    // BUG: sitemap tries to marshall itself recursively\n    resp, _ := json.MarshalIndent(routes, \"\", \"    \")\n// some error handling...\n    w.Write(resp)\n}\n\nfunc main() {\n\n    for _, r := range routes {\n        NewRoute(r.Method, r.Pattern, r.Handler)\n    }\n\n    goji.Serve()\n}\n</code></pre>\n"}, {"tags": ["go", "hive"], "comments": [{"owner": {"reputation": 3296, "user_id": 559885, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/6ac5d484694e3d6f8ac6dfef05c27263?s=128&d=identicon&r=PG", "display_name": "ecem", "link": "https://stackoverflow.com/users/559885/ecem"}, "edited": false, "score": 0, "creation_date": 1449145608, "post_id": 30372480, "comment_id": 55884986, "body": "Have you found anything about this? I had a similar issue and it was about SASL authentication. Disabling SASL got me connected but I need SASL, any idea about that?"}], "answers": [{"comments": [{"owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1432210503, "post_id": 30373046, "comment_id": 48836747, "body": "Port is open and works fine. Because when I access legacy hiveserver via port 10000 from Mr.mattbird&#39;s legacy wrapper I can insert,update, query the data in hive. I wanted to use hiveserver2 because I need to use Apache Ranger with it."}, {"owner": {"reputation": 98, "user_id": 4289319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e23b79af682151595db188d9c04ba301?s=128&d=identicon&r=PG&f=1", "display_name": "J&#233;r&#233;my", "link": "https://stackoverflow.com/users/4289319/j%c3%a9r%c3%a9my"}, "reply_to_user": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "edited": false, "score": 0, "creation_date": 1432211927, "post_id": 30373046, "comment_id": 48837766, "body": "I have the exact same issue (i.e. it just hangs) on a small test cluster here. Maybe you could file an issue to hivething."}], "tags": [], "owner": {"reputation": 98, "user_id": 4289319, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e23b79af682151595db188d9c04ba301?s=128&d=identicon&r=PG&f=1", "display_name": "J&#233;r&#233;my", "link": "https://stackoverflow.com/users/4289319/j%c3%a9r%c3%a9my"}, "is_accepted": false, "score": 1, "last_activity_date": 1432209367, "creation_date": 1432209367, "answer_id": 30373046, "question_id": 30372480, "link": "https://stackoverflow.com/questions/30372480/communicating-with-hiveserver2-using-golang/30373046#30373046", "title": "Communicating with hiveserver2 using Golang", "body": "<p>I can't comment so I'll post this as an answer.</p>\n\n<p>Check if hiveserver2\u00a0is actually listening by trying to </p>\n\n<blockquote>\n  <p>telnet localhost 10000</p>\n</blockquote>\n\n<p>from your VM first, then from your machine.\nIt should show you where to look at first.</p>\n"}], "owner": {"reputation": 123, "user_id": 4924412, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NZ579.jpg?s=128&g=1", "display_name": "PrasadJay", "link": "https://stackoverflow.com/users/4924412/prasadjay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 554, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432209367, "creation_date": 1432207868, "question_id": 30372480, "link": "https://stackoverflow.com/questions/30372480/communicating-with-hiveserver2-using-golang", "title": "Communicating with hiveserver2 using Golang", "body": "<p>I have hortonworks HDP sandbox installed inside Oracle Virtual Box. And I've given access to port 10000. In hive configurations hiveserver2 thrift port is set to 10000 also. I'm using <a href=\"https://github.com/derekgr/hivething\" rel=\"nofollow\">https://github.com/derekgr/hivething</a> wrapper to get the connection. Even though hiveserver2 is running I can't seem to connect with the wrapper mentioned above.</p>\n\n<p>I tried the sample program. But it doesn't go anywhere after \" db, err := hivething.Connect(\"127.0.0.1:10000\", hivething.DefaultOptions)\" line. It doesn't even reach the if condition beneath it. So it's trying to get the connection and stays just as that.</p>\n\n<p>What am I doing wrong?</p>\n\n<p>Is there anymore good wrappers that works with hiveserver2?</p>\n"}, {"tags": ["datetime", "go", "unix-timestamp"], "answers": [{"comments": [{"owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 0, "creation_date": 1432209910, "post_id": 30372823, "comment_id": 48836310, "body": "Thanks for response, but what is reference string for ? I should get milliseconds in UTC ( from 1970. I think )"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "edited": false, "score": 2, "creation_date": 1432210088, "post_id": 30372823, "comment_id": 48836442, "body": "@PaolaJ. When parsing a time specified as a <code>string</code>, you have to specify the layout, the format of the input string. This basically tells what part of the input is the year, month, day, hour, min etc. The solution in this answer does print the milliseconds since the <a href=\"http://en.wikipedia.org/wiki/Unix_time\" rel=\"nofollow noreferrer\">epoch</a>. Please click on the link and run the code."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 1, "creation_date": 1432216031, "post_id": 30372823, "comment_id": 48840886, "body": "Btw <code>UTC()</code> in <code>t.UTC().UnixNano()</code> is not necessary. Number of milliseconds since the epoch doesn&#39;t depend on time zone."}, {"owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1432220537, "post_id": 30372823, "comment_id": 48844559, "body": "@kostya that&#39;s what I thought but still put it in there for good measure :P"}], "tags": [], "owner": {"reputation": 21289, "user_id": 532430, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/uAwnB.png?s=128&g=1", "display_name": "thwd", "link": "https://stackoverflow.com/users/532430/thwd"}, "is_accepted": true, "score": 8, "last_activity_date": 1432208983, "last_edit_date": 1432208983, "creation_date": 1432208823, "answer_id": 30372823, "question_id": 30372462, "link": "https://stackoverflow.com/questions/30372462/convert-formatted-time-to-utc-milliseconds/30372823#30372823", "title": "Convert formatted time to UTC milliseconds", "body": "<p>Use <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"noreferrer\"><code>time.Parse</code></a>.</p>\n\n<p>Demo: <a href=\"http://play.golang.org/p/ouiDtIVjQI\" rel=\"noreferrer\">http://play.golang.org/p/ouiDtIVjQI</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    t, e := time.Parse(`2006-01-02T15:04:05.000-07:00`, `2009-01-01T01:02:01.111+02:00`)\n\n    if e != nil {\n        panic(e)\n    }\n\n    fmt.Println(t.UTC().UnixNano() / 1000000)\n}\n</code></pre>\n\n<p>Use the format string <code>2006-01-02T15:04:05.000-07:00</code> for the reference date.</p>\n"}, {"tags": [], "owner": {"reputation": 11257, "user_id": 10197418, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/be8Y6.jpg?s=128&g=1", "display_name": "MrFuppes", "link": "https://stackoverflow.com/users/10197418/mrfuppes"}, "is_accepted": false, "score": 0, "last_activity_date": 1605033158, "creation_date": 1605033158, "answer_id": 64774731, "question_id": 30372462, "link": "https://stackoverflow.com/questions/30372462/convert-formatted-time-to-utc-milliseconds/64774731#64774731", "title": "Convert formatted time to UTC milliseconds", "body": "<p>the format is pretty standard ISO8601, so you can use the <code>time.RFC3339</code> layout, e.g.</p>\n<pre class=\"lang-golang prettyprint-override\"><code>t, e := time.Parse(time.RFC3339, &quot;2009-01-01T01:02:01.111+02:00&quot;)\n</code></pre>\n<ul>\n<li><a href=\"https://play.golang.org/p/M7bukF-4Pk6\" rel=\"nofollow noreferrer\">playground example</a></li>\n</ul>\n<p>...and proceed with <code>.UnixNano()</code> as in <a href=\"https://stackoverflow.com/a/30372823/10197418\">thwd</a>'s answer. More predefined layouts can be found in <a href=\"https://golang.org/src/time/format.go\" rel=\"nofollow noreferrer\">src/time/format.go</a>.</p>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6659, "favorite_count": 0, "accepted_answer_id": 30372823, "answer_count": 2, "score": 1, "last_activity_date": 1605082558, "creation_date": 1432207819, "last_edit_date": 1605082558, "question_id": 30372462, "link": "https://stackoverflow.com/questions/30372462/convert-formatted-time-to-utc-milliseconds", "title": "Convert formatted time to UTC milliseconds", "body": "<p>How to convert time in format</p>\n\n<pre><code>2009-01-01T01:02:01.111+02:00\n</code></pre>\n\n<p>to UTC in milliseconds?</p>\n\n<p>Is there already package for this conversion? I looked at the <a href=\"https://golang.org/src/time/format.go\" rel=\"nofollow\">https://golang.org/src/time/format.go</a> but couldn't find same format to convert. </p>\n"}, {"tags": ["json", "struct", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1471850194, "last_edit_date": 1471850194, "creation_date": 1432205219, "answer_id": 30371519, "question_id": 30371353, "link": "https://stackoverflow.com/questions/30371353/how-to-store-object-in-a-struct/30371519#30371519", "title": "How to store object in a struct", "body": "<p>You can use a <code>map[string]string</code> for the properties and a <code>[]string</code> slice for the permissions:</p>\n\n<pre><code>type User struct {\n    Name        string            `json:\"name\"`\n    Email       string            `json:\"email\"`\n    Username    string            `json:\"username\"`\n    Properties  map[string]string `json:\"properties\"`\n    Permissions []string          `json:\"permissions\"`\n}\n</code></pre>\n\n<p>Output (wrapped):</p>\n\n<pre><code>{Name:Mr Robinson Email:test@test.com Username:robbo123 \n    Properties:map[property1:a property property2:another property]\n    Permissions:[perm1 perm2 perm3]}\n</code></pre>\n\n<p>Try the complete runnable app on the <a href=\"http://play.golang.org/p/JHqOd-me65\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 0, "accepted_answer_id": 30371519, "answer_count": 1, "score": 0, "last_activity_date": 1471850194, "creation_date": 1432204741, "last_edit_date": 1432206239, "question_id": 30371353, "link": "https://stackoverflow.com/questions/30371353/how-to-store-object-in-a-struct", "title": "How to store object in a struct", "body": "<p>I'm not sure how to create a <code>struct</code> to store a JSON object that is being posted to my API.</p>\n\n<p>The JSON looks like this:</p>\n\n<pre><code>{ \n    \"name\" : \"Mr Robinson\",\n    \"email\" : \"test@test.com\",\n    \"username\" : \"robbo123\",\n    \"properties\" : {\n        \"property1\" : \"a property\",\n        \"property2\" : \"another property\"\n    },\n    \"permissions\" : [\"perm1\", \"perm2\", \"perm3\"]\n}\n</code></pre>\n\n<p>There can be any number of <code>properties</code> and the <code>permissions</code> array can contain any number of values.</p>\n\n<p>I am using this to decode the posted values:</p>\n\n<pre><code>err := json.NewDecoder(req.Body).Decode(my_struct)\n</code></pre>\n\n<p>So far my struct looks like this:</p>\n\n<pre><code>type User struct {\n    Name      string      `json:\"name\"`\n    Email     string      `json:\"email\"`\n    Username  string      `json:\"username\"`\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 0, "creation_date": 1432201264, "post_id": 30369818, "comment_id": 48830298, "body": "Where in your <code>main_test.go</code> are you defining the variable? Keep in mind that your <code>init()</code> function is executed at startup, but <code>main()</code> isn&#39;t."}, {"owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "reply_to_user": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "edited": false, "score": 0, "creation_date": 1432201872, "post_id": 30369818, "comment_id": 48830716, "body": "im defining it outside of any function in my test file"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1432202698, "post_id": 30369818, "comment_id": 48831261, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/28476307/in-go-how-to-get-test-environment-at-run-time\">In Go,how to get test environment at run time?</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432222867, "post_id": 30369818, "comment_id": 48846243, "body": "BTW, this is a bad way to handle test stubbing. The standard way would be to have the relevant code use an interface (or in this case perhaps a <code>*sql.DB</code> variable) that the test code can replace with a mock implementation (or a in memory <code>*sql.DB</code>)."}, {"owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "edited": false, "score": 0, "creation_date": 1432266778, "post_id": 30369818, "comment_id": 48865096, "body": "interesting. can you point to a link with more information about this?"}], "answers": [{"comments": [{"owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "edited": false, "score": 0, "creation_date": 1432201919, "post_id": 30370089, "comment_id": 48830749, "body": "i want test to be false when executed regularly, i only want testing to be true when I run &quot;go test&quot;"}, {"owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "reply_to_user": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "edited": false, "score": 1, "creation_date": 1432202389, "post_id": 30370089, "comment_id": 48831044, "body": "With this new example, <code>testingMode</code> will be false by default (golang zero value), and set to <code>true</code> by the <code>main_test.go</code> init function."}], "tags": [], "owner": {"reputation": 6756, "user_id": 1606248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/0lXId.jpg?s=128&g=1", "display_name": "Pierre Prinetti", "link": "https://stackoverflow.com/users/1606248/pierre-prinetti"}, "is_accepted": true, "score": 13, "last_activity_date": 1432206332, "last_edit_date": 1432206332, "creation_date": 1432201359, "answer_id": 30370089, "question_id": 30369818, "link": "https://stackoverflow.com/questions/30369818/setting-a-variable-from-test-file-in-golang/30370089#30370089", "title": "setting a variable from test file in golang", "body": "<p>Try this:</p>\n\n<p>Define your variable as global in <code>main.go</code>:</p>\n\n<pre><code>var testingMode bool\n</code></pre>\n\n<p>And then set it to be <code>true</code> in your test file <code>main_test.go</code>:</p>\n\n<pre><code>func init() {\n    testingMode = true\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 219, "user_id": 5432076, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TwANx.png?s=128&g=1", "display_name": "VolatileCoder", "link": "https://stackoverflow.com/users/5432076/volatilecoder"}, "is_accepted": false, "score": 1, "last_activity_date": 1568671701, "creation_date": 1568671701, "answer_id": 57964979, "question_id": 30369818, "link": "https://stackoverflow.com/questions/30369818/setting-a-variable-from-test-file-in-golang/57964979#57964979", "title": "setting a variable from test file in golang", "body": "<p>Pierre Prinetti's Answer doesn't work in 2019.</p>\n\n<p>Instead, do this. It's less then ideal, but gets the job done</p>\n\n<pre><code>//In the module that you are testing (not your test module:\nfunc init() {\n    if len(os.Args) &gt; 1 &amp;&amp; os.Args[1][:5] == \"-test\" {\n        log.Println(\"testing\")//special test setup goes goes here\n        return // ...or just skip the setup entirely\n    }\n    //...\n}\n</code></pre>\n"}], "owner": {"reputation": 3291, "user_id": 462575, "user_type": "registered", "accept_rate": 58, "profile_image": "https://graph.facebook.com/524849342/picture?type=large", "display_name": "Allen", "link": "https://stackoverflow.com/users/462575/allen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12381, "favorite_count": 1, "accepted_answer_id": 30370089, "answer_count": 2, "score": 8, "last_activity_date": 1568671701, "creation_date": 1432200656, "question_id": 30369818, "link": "https://stackoverflow.com/questions/30369818/setting-a-variable-from-test-file-in-golang", "title": "setting a variable from test file in golang", "body": "<p>i'm trying to set a variable from my unit tests file </p>\n\n<p>main_test.go</p>\n\n<pre><code>var testingMode bool = true\n</code></pre>\n\n<p>main.go</p>\n\n<pre><code>if testingMode == true {\n  //use test database\n} else {\n  //use regular database\n}\n</code></pre>\n\n<p>If I run \"go test\", this works fine. If I do \"go build\", golang complains that testingMode is not defined (which should be the case since tests aren't part of the program).</p>\n\n<p>But it seems if I set the global variable in main.go, I'm unable to set it in main_test.</p>\n\n<p>What's the correct way to about this?</p>\n"}, {"tags": ["google-app-engine", "go", "goroutine"], "comments": [{"owner": {"reputation": 3386, "user_id": 1668204, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0bc95f5cf4f7a5da0f8c3d9bd745ab45?s=128&d=identicon&r=PG", "display_name": "tx802", "link": "https://stackoverflow.com/users/1668204/tx802"}, "edited": false, "score": 0, "creation_date": 1432202089, "post_id": 30369661, "comment_id": 48830868, "body": "Are you able to provide any more details about your code?  According to the <a href=\"https://cloud.google.com/appengine/docs/go/\" rel=\"nofollow noreferrer\">docs</a>, <i>&quot;The Go runtime environment for App Engine provides full support for goroutines, but not for parallel execution&quot;</i>. It&#39;s not clear from the docs, but a <a href=\"https://cloud.google.com/appengine/docs/go/managed-vms/\" rel=\"nofollow noreferrer\">Managed VM</a> may not have the same restriction."}], "answers": [{"comments": [{"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1432204573, "post_id": 30371239, "comment_id": 48832506, "body": "so basically i have to block the goroutine ? what can i do to avoid the blocking"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 1, "creation_date": 1432204676, "post_id": 30371239, "comment_id": 48832583, "body": "@MIkCode No, you have to block the request handler until the goroutine is finished (not the other way around). When the request handler returns, that&#39;s the end."}, {"owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1432205500, "post_id": 30371239, "comment_id": 48833124, "body": "im just wondering if their  any option to return the user a response before the  goroutine end ?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 2, "creation_date": 1432205621, "post_id": 30371239, "comment_id": 48833222, "body": "@MIkCode The goroutine is not stopped or anything when the request handler returns. The goroutine may continue to run even after the handler returned, but the goroutine can&#39;t do any request related tasks after that (would either result in an error or would have no effect)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1432209362, "post_id": 30371239, "comment_id": 48835887, "body": "@MIkCode And also note that AppEngine does not send any data back to the client until the request handler returns. Data written by the request handler is first written into a buffer, and data is only sent to the user after the handler returned."}, {"owner": {"reputation": 381, "user_id": 5193766, "user_type": "registered", "accept_rate": 17, "profile_image": "https://lh5.googleusercontent.com/-ijH86FwAgd0/AAAAAAAAAAI/AAAAAAAAAXc/VxUFFDcM_38/photo.jpg?sz=128", "display_name": "Gaurav Sharma", "link": "https://stackoverflow.com/users/5193766/gaurav-sharma"}, "reply_to_user": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "edited": false, "score": 0, "creation_date": 1556976808, "post_id": 30371239, "comment_id": 98615314, "body": "@MIkCode I&#39;m trying to do same stuff here <a href=\"https://stackoverflow.com/questions/55967066/publishing-to-google-pub-sub-asynchronously-through-goroutine\" title=\"publishing to google pub sub asynchronously through goroutine\">stackoverflow.com/questions/55967066/&hellip;</a> Tried this approach as well but not able to do that  <a href=\"https://stackoverflow.com/questions/27185405/can-i-use-goroutines-in-google-app-engine-standard-environment\" title=\"can i use goroutines in google app engine standard environment\">stackoverflow.com/questions/27185405/&hellip;</a> can you tell how you solve this problem"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1477557748, "last_edit_date": 1477557748, "creation_date": 1432204395, "answer_id": 30371239, "question_id": 30369661, "link": "https://stackoverflow.com/questions/30369661/how-to-use-goroutine-inside-appengine/30371239#30371239", "title": "How to use goroutine inside AppEngine?", "body": "<p>The Go runtime for AppEngine supports goroutines, quoting from the doc: <a href=\"https://cloud.google.com/appengine/docs/go/runtime\" rel=\"nofollow\">Go Runtime Environment: Introduction</a>:</p>\n\n<blockquote>\n  <p>The Go runtime environment for App Engine provides full support for goroutines, but not for parallel execution: goroutines are scheduled onto a single operating system thread.</p>\n</blockquote>\n\n<p>The problem is that when your <a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow\"><code>HandleFunc()</code></a> or <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\"><code>Handler.ServeHTTP()</code></a> returns, the AppEngine platform (and the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\"><code>http</code></a> package too) <strong>does not wait</strong> for any goroutines started by the handler function to complete.</p>\n\n<p>Quoting from the doc: <a href=\"https://cloud.google.com/appengine/docs/go/requests#Go_Responses\" rel=\"nofollow\">Handling Requests: Responses</a>:</p>\n\n<blockquote>\n  <p>App Engine calls the handler with a <code>Request</code> and a <code>ResponseWriter</code>, then waits for the handler to write to the <code>ResponseWriter</code> and return. When the handler returns, the data in the <code>ResponseWriter</code>'s internal buffer is sent to the user.</p>\n</blockquote>\n\n<p>You have to synchronize your request handling and goroutine, and only return once the goroutine has completed its work, for example:</p>\n\n<pre><code>func doStuff(done chan int) {\n    // Do your stuff\n    // and finally signal that you're done:\n    done &lt;- 0\n}\n\nfunc someHandler(w http.ResponseWriter, r *http.Request) {\n    done := make(chan int)\n    go doStuff(done)\n    // Wait for the goroutine to complete:\n    &lt;-done\n}\n</code></pre>\n"}], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 612, "favorite_count": 0, "accepted_answer_id": 30371239, "answer_count": 1, "score": 2, "last_activity_date": 1477557748, "creation_date": 1432200254, "last_edit_date": 1432204538, "question_id": 30369661, "link": "https://stackoverflow.com/questions/30369661/how-to-use-goroutine-inside-appengine", "title": "How to use goroutine inside AppEngine?", "body": "<p>I'm using Cloud Endpoints and Go and I'm trying to call a method in asynchronous way by using a goroutine.</p>\n\n<p>When I'm running the following code locally I can see the debug prints but on the server it looks like the method did not get called.</p>\n\n<p>I'm basically trying to do  </p>\n\n<pre><code>go doStuff()\n\nreturn type \n</code></pre>\n"}, {"tags": ["http", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1432201212, "last_edit_date": 1432201212, "creation_date": 1432200324, "answer_id": 30369694, "question_id": 30369575, "link": "https://stackoverflow.com/questions/30369575/golang-http-post-using-http-1-0/30369694#30369694", "title": "Golang HTTP POST using HTTP/1.0", "body": "<p>Apparently you can't. The <code>Request.Proto</code> field is ignored when making the request by the <a href=\"https://golang.org/pkg/net/http/#Client\" rel=\"nofollow\"><code>Client</code></a>.</p>\n\n<p>Quoting from the doc of <a href=\"https://golang.org/pkg/net/http/#Request\" rel=\"nofollow\"><code>http.Request</code></a>:</p>\n\n<pre><code>// The protocol version for incoming requests.\n// Client requests always use HTTP/1.1.\nProto      string // \"HTTP/1.0\"\n</code></pre>\n\n<blockquote>\n  <p>Client requests <strong>always</strong> use HTTP/1.1.</p>\n</blockquote>\n"}], "owner": {"reputation": 305, "user_id": 680134, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/4fa49ac041856525cdebfc3f79a85177?s=128&d=identicon&r=PG", "display_name": "plithner", "link": "https://stackoverflow.com/users/680134/plithner"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2159, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1432201212, "creation_date": 1432200058, "question_id": 30369575, "link": "https://stackoverflow.com/questions/30369575/golang-http-post-using-http-1-0", "title": "Golang HTTP POST using HTTP/1.0", "body": "<p>Is it possible to send HTTP requests using HTTP/1.0 with golang?</p>\n\n<p>I tried the following:</p>\n\n<pre><code>req, _ := http.NewRequest(\"POST\", url, buffer)\nreq.Proto = \"HTTP/1.0\"\nclient := &amp;http.Client{}\nresp, err = client.Do(req)\n</code></pre>\n\n<p>But it seems req.Proto is ignored. The message is sent out using HTTP/1.1.</p>\n"}, {"tags": ["go", "registry", "docker"], "comments": [{"owner": {"reputation": 476, "user_id": 12817546, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-7Y79xcMm5cw/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rePp9zs2ylgFHtZKiaQLj2QI9Xc7w/photo.jpg?sz=128", "display_name": "Tom L", "link": "https://stackoverflow.com/users/12817546/tom-l"}, "edited": false, "score": 0, "creation_date": 1584070418, "post_id": 30367803, "comment_id": 107329890, "body": "Does this answer your question? <a href=\"https://stackoverflow.com/a/60663003\">Ensure a type implements an interface at compile time in Go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432225302, "post_id": 30367931, "comment_id": 48847791, "body": "To avoid confusion I like to include a comment like <code>&#47;&#47; Verify FileInfoInternal implements os.FileInfo</code> right above such variables. Personally I also stick those in <code>_test.go</code> files since I consider them a test like any other."}, {"owner": {"reputation": 68, "user_id": 253486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bde162f1d6702057fbf9ed41c05ab72e?s=128&d=identicon&r=PG", "display_name": "stevvooe", "link": "https://stackoverflow.com/users/253486/stevvooe"}, "edited": false, "score": 1, "creation_date": 1432239156, "post_id": 30367931, "comment_id": 48855990, "body": "Author here. Looking at this, I cannot recall why I put both declarations. The value assertion should be sufficient.  We&#39;ve been using these as annotations next to declarations for clarity in the following implementation. I&#39;ve seen the convention of putting in the <code>_test.go</code> files and have accepted contributions in that manner."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 24, "last_activity_date": 1432282556, "last_edit_date": 1432282556, "creation_date": 1432195444, "answer_id": 30367931, "question_id": 30367803, "link": "https://stackoverflow.com/questions/30367803/why-declare-like-var-i-t-and-var-i-t-continuously/30367931#30367931", "title": "Why declare like &quot;var _ I = T{}&quot; and &quot;var _ I = &amp;T{}&quot; continuously?", "body": "<p>From the <a href=\"https://golang.org/doc/faq#guarantee_satisfies_interface\" rel=\"noreferrer\">FAQ</a>:</p>\n\n<blockquote>\n  <p>You can ask the compiler to check that the type T implements the\n  interface I by attempting an assignment:</p>\n\n<pre><code>type T struct{} \nvar _ I = T{}   // Verify that T implements I.\n</code></pre>\n</blockquote>\n\n<p>In this case the blank identifier _ stands for the variable name which is not needed here (and thus prevents a \"declared but not used\" error).</p>\n\n<p>And more general from the <a href=\"https://golang.org/ref/spec#Assignments\" rel=\"noreferrer\">spec</a>:</p>\n\n<blockquote>\n  <p>The blank identifier provides a way to ignore right-hand side values\n  in an assignment:</p>\n\n<pre><code>_ = x       // evaluate x but ignore it \nx, _ = f()  // evaluate f() but ignore second result value\n</code></pre>\n</blockquote>\n\n<p>By testing both <code>FileInfoInternal{}</code> and <code>&amp;FileInfoInternal{}</code> you check if the interface is implemented with a value receiver. A value receiver will accept both a value and a pointer whereas the pointer receiver will only work with a pointer and the first assignment by value will fail.</p>\n\n<p>The second test with <code>&amp;FileInfoInternal{}</code> is not actually needed (as confirmed by the author in the comments) since the first test will pass with a value receiver and fail with a pointer received. Thus the second test is redundant.</p>\n\n<p><a href=\"http://jordanorelli.com/post/32665860244/how-to-use-interfaces-in-go\" rel=\"noreferrer\">This</a> is an excellent article that explains the difference between value and pointer receivers and how they are used very well.</p>\n"}, {"comments": [{"owner": {"reputation": 119, "user_id": 4200926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d364819f9116282ba0bbf3580f7a5c60?s=128&d=identicon&r=PG&f=1", "display_name": "JCheng", "link": "https://stackoverflow.com/users/4200926/jcheng"}, "edited": false, "score": 0, "creation_date": 1432196457, "post_id": 30368006, "comment_id": 48827088, "body": "But why should check both FileInfoInternal and &amp;FileInfoInternal?"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 119, "user_id": 4200926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d364819f9116282ba0bbf3580f7a5c60?s=128&d=identicon&r=PG&f=1", "display_name": "JCheng", "link": "https://stackoverflow.com/users/4200926/jcheng"}, "edited": false, "score": 0, "creation_date": 1432196531, "post_id": 30368006, "comment_id": 48827124, "body": "@JCheng the second part is not clear to me and I wait by myself to see the answer for this one."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 1, "last_activity_date": 1432195679, "creation_date": 1432195679, "answer_id": 30368006, "question_id": 30367803, "link": "https://stackoverflow.com/questions/30367803/why-declare-like-var-i-t-and-var-i-t-continuously/30368006#30368006", "title": "Why declare like &quot;var _ I = T{}&quot; and &quot;var _ I = &amp;T{}&quot; continuously?", "body": "<p><code>FileInfo</code> is an <a href=\"https://github.com/docker/distribution/blob/master/registry/storage/driver/fileinfo.go#L7\" rel=\"nofollow\">interface</a> and the code checks whether <code>FileInfoInternal</code> <a href=\"https://golang.org/doc/faq#guarantee_satisfies_interface\" rel=\"nofollow\">implements</a> this interface.</p>\n"}], "owner": {"reputation": 119, "user_id": 4200926, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d364819f9116282ba0bbf3580f7a5c60?s=128&d=identicon&r=PG&f=1", "display_name": "JCheng", "link": "https://stackoverflow.com/users/4200926/jcheng"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2859, "favorite_count": 7, "closed_date": 1601474145, "accepted_answer_id": 30367931, "answer_count": 2, "score": 10, "last_activity_date": 1570041244, "creation_date": 1432195009, "last_edit_date": 1570041244, "question_id": 30367803, "link": "https://stackoverflow.com/questions/30367803/why-declare-like-var-i-t-and-var-i-t-continuously", "closed_reason": "Duplicate", "title": "Why declare like &quot;var _ I = T{}&quot; and &quot;var _ I = &amp;T{}&quot; continuously?", "body": "<p>When I read a copy of the docker/distribution source code, I find there are variables declared which make me quite confused.\n<a href=\"https://github.com/docker/distribution/blob/65b0d73cb749fd9757352f472e399024f1c597df/registry/storage/driver/fileinfo.go#L55-56\" rel=\"noreferrer\">The code is</a>:</p>\n\n<pre><code>var _ FileInfo = FileInfoInternal{}\nvar _ FileInfo = &amp;FileInfoInternal{}\n</code></pre>\n\n<p>I don't know what the declare mean, and hope to get some help.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432192406, "post_id": 30366868, "comment_id": 48824629, "body": "the $SSHKey has spaces in the string"}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 0, "last_activity_date": 1432193345, "last_edit_date": 1432193345, "creation_date": 1432192613, "answer_id": 30366978, "question_id": 30366868, "link": "https://stackoverflow.com/questions/30366868/post-params-with-spaces-in-it/30366978#30366978", "title": "POST params with spaces in it", "body": "<p>In a lot of languages you encode space with something like <code>%20</code> or <code>+</code>. I would suggest you to try simple <a href=\"https://golang.org/pkg/strings/\" rel=\"nofollow\">string</a> replacement. For example:</p>\n\n<p><code>strings.Replace(params, \" \", \"%20\", -1)</code></p>\n"}, {"tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": false, "score": 2, "last_activity_date": 1432193082, "creation_date": 1432193082, "answer_id": 30367149, "question_id": 30366868, "link": "https://stackoverflow.com/questions/30366868/post-params-with-spaces-in-it/30367149#30367149", "title": "POST params with spaces in it", "body": "<p>You should use <a href=\"https://golang.org/pkg/net/url/#QueryEscape\" rel=\"nofollow\"><code>url.QueryEscape</code></a>. </p>\n\n<pre><code>reqURL := fmt.Sprintf(\"https://website.com/api?key=%s\",\n    url.QueryEscape(\"ssh-rsa abcde abc@abc.com\"))\n\n// https://website.com/api?key=ssh-rsa+abcde+abc%40abc.com\n</code></pre>\n\n<p>Also note that you are talking of POST parameters but you are actually setting GET url parameters.</p>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "reply_to_user": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "edited": false, "score": 1, "creation_date": 1432196011, "post_id": 30367158, "comment_id": 48826781, "body": "Thank you for the question. This is my first upvote for Go :)"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user1907906"}, "is_accepted": true, "score": 2, "last_activity_date": 1432195170, "last_edit_date": 1432195170, "creation_date": 1432193107, "answer_id": 30367158, "question_id": 30366868, "link": "https://stackoverflow.com/questions/30366868/post-params-with-spaces-in-it/30367158#30367158", "title": "POST params with spaces in it", "body": "<p>You could URL encode the parameter using <a href=\"https://golang.org/pkg/net/url/#Values.Encode\" rel=\"nofollow\"><code>net.url.Values.Encode</code></a>:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"net/url\"    \n\nfunc main() {\n    values := url.Values{}\n    values.Set(\"key\", \"foo bar baz\")\n    fmt.Println(values.Encode())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>key=foo+bar+baz\n</code></pre>\n"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 401, "favorite_count": 0, "accepted_answer_id": 30367158, "answer_count": 3, "score": 0, "last_activity_date": 1432195170, "creation_date": 1432192242, "last_edit_date": 1432192614, "question_id": 30366868, "link": "https://stackoverflow.com/questions/30366868/post-params-with-spaces-in-it", "title": "POST params with spaces in it", "body": "<p>How do I make a POST request when the post param has spaces in it? Eg. in bash I would do this:</p>\n\n<pre><code>curl -X POST \"https://website.com/api\" --data-urlencode \"key=$SSHKey\" &lt;- \"ssh-rsa abcde abc@abc.com\"\n</code></pre>\n\n<p>I'm using the http.NewRequest method to send POST requests. <a href=\"http://golang.org/pkg/net/http/#NewRequest\" rel=\"nofollow\">http://golang.org/pkg/net/http/#NewRequest</a></p>\n\n<pre><code>reqURL := fmt.Sprintf(\"https://website.com/api?key=%s\", \"ssh-rsa abcde abc@abc.com\")\n\nclient := &amp;http.Client{}\nr, _ := http.NewRequest(\"POST\", reqURL, nil)\nclient.Do(r)\n</code></pre>\n"}, {"tags": ["multithreading", "go"], "answers": [{"tags": [], "owner": {"reputation": 2636, "user_id": 878228, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3515cd8666891a37751eb00a0523b0cd?s=128&d=identicon&r=PG", "display_name": "MoreFreeze", "link": "https://stackoverflow.com/users/878228/morefreeze"}, "is_accepted": false, "score": 0, "last_activity_date": 1432193000, "creation_date": 1432193000, "answer_id": 30367112, "question_id": 30366551, "link": "https://stackoverflow.com/questions/30366551/why-this-go-code-output-like-this/30367112#30367112", "title": "Why this go code output like this?", "body": "<p>I think it is a bug of this tutorial. If the output window (left-bottom) is too small, it will display without <strong>the last line</strong>, so the 9th won't be display immediately.</p>\n\n<p>if I add <code>fmt.Println(\"foo\")</code> after <code>fmt.Println(i,&lt;-c)</code>, it won't output the last line contains <code>foo</code> string, but the 9th fibonacci will be displayed.</p>\n\n<p>I capture the response in Chrome, it can tell how to display the result including what time it will output. So it must be a bug of page that swallow the last line. :D</p>\n\n<p>PS: The response like this:</p>\n\n<pre><code>{\n   \"Errors\":\"\",\n   \"Events\":[\n      {\n         \"Message\":\"0 0\\nfoo\\n1 1\\nfoo\\n2 1\\nfoo\\n3 2\\nfoo\\n4 3\\nfoo\\n5 5\\nfoo\\n6 8\\nfoo\\n7 13\\nfoo\\n8 21\\nfoo\\n9 34\\nfoo\\n\",\n         \"Kind\":\"stdout\",\n         \"Delay\":0\n      },\n      {\n         \"Message\":\"quit\\n\",\n         \"Kind\":\"stdout\",\n         \"Delay\":2000000000\n      }\n   ]\n}\n</code></pre>\n"}], "owner": {"reputation": 2636, "user_id": 878228, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/3515cd8666891a37751eb00a0523b0cd?s=128&d=identicon&r=PG", "display_name": "MoreFreeze", "link": "https://stackoverflow.com/users/878228/morefreeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 47, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432193714, "creation_date": 1432191238, "last_edit_date": 1432193714, "question_id": 30366551, "link": "https://stackoverflow.com/questions/30366551/why-this-go-code-output-like-this", "title": "Why this go code output like this?", "body": "<p>I'm learning Go langue in <a href=\"https://tour.golang.org/concurrency/5\" rel=\"nofollow\">here</a>, and I modify a little code like this, I add a sleep(2s) before <code>quit &lt;- 0</code>, and output index of fibonacci with <code>i</code>, below is my code:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"time\"\n\nfunc fibonacci(c, quit chan int) {\n    x, y := 0, 1\n    for {\n        select {\n        case c &lt;- x:\n            x, y = y, x+y\n        case &lt;-quit:\n            fmt.Println(\"quit\")\n            return\n        }\n    }\n}\n\nfunc main() {\n    c := make(chan int)\n    quit := make(chan int)\n    go func() {\n        for i := 0; i &lt; 10; i++ {\n            fmt.Println(i,&lt;-c) // output index for result clearly\n        }\n        time.Sleep(2000*time.Millisecond) // add sleep for result clearly\n        quit &lt;- 0\n    }()\n    fibonacci(c, quit)\n}\n</code></pre>\n\n<p>I find the stdout output 0-8 immediately, but wait 2 seconds it output 9th and then is \"quit\". </p>\n\n<p>I move this code to a single go file and run it. At first it output 0-8 like above described, but after I change total number (from 10 to 9,8 or 3, whatever) some times, it output directly all fibonacci number immediately as I was excepted (of course it output <code>quit</code> after 2 seconds)! </p>\n\n<p>I run the code in the browser (I used Chrome) it still output 9th delay, when I change 10 to 3, it output 0-2 immediately. </p>\n\n<p>So I'm confused why does it output 9th delay?</p>\n\n<p>UPDATE: I think I know why, because my output window too small to output whole result, but I always scroll down all time it still display 8th. If I scale output window larger, it will output 0-9 immediately. So is it a bug of this tutorial?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 9116, "user_id": 813523, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/80566534177eef1ed8ef0931ca52fc4b?s=128&d=identicon&r=PG", "display_name": "Scott Selby", "link": "https://stackoverflow.com/users/813523/scott-selby"}, "edited": false, "score": 0, "creation_date": 1432189624, "post_id": 30366045, "comment_id": 48823081, "body": "how come go gets a little icon in it&#39;s tag, that&#39;s not fair to the other tags :("}, {"owner": {"reputation": 53111, "user_id": 41596, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e3d742bdb6a1937a032125eef40aa874?s=128&d=identicon&r=PG", "display_name": "alexn", "link": "https://stackoverflow.com/users/41596/alexn"}, "edited": false, "score": 0, "creation_date": 1432189711, "post_id": 30366045, "comment_id": 48823128, "body": "It&#39;s because that tag is sponsored. There are several other examples, like <code>android</code>, <code>realm</code>, etc. <a href=\"http://meta.stackexchange.com/questions/30187/what-do-icons-on-the-tags-mean\" title=\"what do icons on the tags mean\">meta.stackexchange.com/questions/30187/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 0, "last_activity_date": 1432191646, "last_edit_date": 1432191646, "creation_date": 1432191056, "answer_id": 30366489, "question_id": 30366045, "link": "https://stackoverflow.com/questions/30366045/parse-net-json-date-with-go/30366489#30366489", "title": "Parse .Net JSON date with Go", "body": "<p>The value comes back unassigned for many reasons. First of all your MyStruct does not look right. Your JSON has <code>data</code> key as the parent key, which consists an array of objects.</p>\n\n<p>But your struct for some reason does not even resembles this. It has to have <code>Date</code> as a field at least. So make your struct look like the json you are receiving.</p>\n\n<p>Another thing is that your <code>time.Time</code> will not be able to parse this string: <code>Date(1432187580000-0500)</code> in a normal date.</p>\n\n<p><strong>P.S.</strong> now that you have updated your struct to normal way, you have to find a way to parse your strange sting to a date. If you have power over your .net application, I would rather recommend changing json to a normal timestamp or something that can be easily parsable.</p>\n\n<p>If not, then you have to change <code>SomeTime time.Time</code> to <code>SomeTime string</code> and then parse string to a normal timestamp and then parse this timestamp to a date.</p>\n"}, {"tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 1, "last_activity_date": 1432191453, "creation_date": 1432191453, "answer_id": 30366617, "question_id": 30366045, "link": "https://stackoverflow.com/questions/30366045/parse-net-json-date-with-go/30366617#30366617", "title": "Parse .Net JSON date with Go", "body": "<p>I am going to provide a few suggestions. You will have to write the code yourself though ;)</p>\n\n<p>First of all is it possible to change .NET application that produced this JSON to generate something more parsable? If you make it output datetime in RFC3339 format (something like 1990-12-31T15:59:12-08:00) then go will automatically converts it to time.Time instance thanks to <a href=\"http://golang.org/pkg/time/#Time.UnmarshalJSON\" rel=\"nofollow\">http://golang.org/pkg/time/#Time.UnmarshalJSON</a></p>\n\n<p>If you cannot change the client then you will have to parse this date yourself:</p>\n\n<ol>\n<li><p>extract time part (1432187580000) from the string. this looks like number of milliseconds (ms) since UNIX epoch. You can convert it to time.Time instance using time.Unix(sec, nsec).</p></li>\n<li><p>(optional). The time that was created in the last step already accurately represent a point in time. However if you want to add the original timezone to it (e.g. to print it) you will need to:</p>\n\n<ul>\n<li>parse the offset part (-0500) from the string</li>\n<li>create time.FixedZone</li>\n<li>call <a href=\"http://golang.org/pkg/time/#Time.In\" rel=\"nofollow\">http://golang.org/pkg/time/#Time.In</a> on the instance of time.Time created in the first step</li>\n</ul></li>\n</ol>\n\n<p>Example: <a href=\"http://play.golang.org/p/Pkahyg2vZa\" rel=\"nofollow\">http://play.golang.org/p/Pkahyg2vZa</a></p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1471854872, "last_edit_date": 1471854872, "creation_date": 1432191601, "answer_id": 30366663, "question_id": 30366045, "link": "https://stackoverflow.com/questions/30366045/parse-net-json-date-with-go/30366663#30366663", "title": "Parse .Net JSON date with Go", "body": "<p>First you model is wrong, it doesn't model the data structure in your JSON. It should be:</p>\n\n<pre><code>type Data struct {\n    Data []MyStruct `json:\"data`\n}\ntype MyStruct struct {\n    SomeTime string\n}\n</code></pre>\n\n<p>It works with this, try it on the <a href=\"http://play.golang.org/p/7VH7b0MMxc\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p>Problem is that we still have the time as <code>string</code>.</p>\n\n<p>Now if you want <code>SomeTime</code> to be <a href=\"https://golang.org/pkg/time/#Time\" rel=\"nofollow\"><code>time.Time</code></a>, you need to parse it yourself, you can do it by implementing <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow\"><code>json.Unmarshaler</code></a>:</p>\n\n<pre><code>type Data struct {\n    Data []MyStruct `json:\"data`\n}\n\ntype MyStruct struct {\n    SomeTime time.Time\n}\n\nfunc (m *MyStruct) UnmarshalJSON(data []byte) error {\n    // First unmashal it into a string:\n    ms := struct{ SomeTime string }{}\n    if err := json.Unmarshal(data, &amp;ms); err != nil {\n        return err\n    }\n\n    s := ms.SomeTime\n\n    // s is of format: \"/Date(1432187580000-0500)/\"\n    // extract millis and time zone offset hours\n    i1 := strings.Index(s, \"(\")\n    i3 := strings.Index(s, \")\")\n    i2 := strings.Index(s, \"-\")\n    if i2 &lt; 0 {\n        i2 = strings.Index(s, \"+\")\n    }\n    if i1 &lt; 0 || i2 &lt; 0 || i3 &lt; 0 {\n        return errors.New(\"Invalid format\")\n    }\n\n    millis, err := strconv.ParseInt(s[i1+1:i2], 10, 64)\n    if err != nil {\n        return err\n    }\n    m.SomeTime = time.Unix(0, millis*1000000)\n\n    // Apply timezone:\n    zoneHours, err := strconv.ParseInt(s[i2:i3], 10, 64)\n    if err != nil {\n        return err\n    }\n    zone := time.FixedZone(\"something\", int(zoneHours)*3600)\n    m.SomeTime = m.SomeTime.In(zone)\n    return nil\n}\n</code></pre>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/gt5QKJMsj6\" rel=\"nofollow\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 1904, "user_id": 2216634, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/6b28c2e1f5c27649a9755d732878619a?s=128&d=identicon&r=PG", "display_name": "JohnWrensby", "link": "https://stackoverflow.com/users/2216634/johnwrensby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 557, "favorite_count": 0, "accepted_answer_id": 30366663, "answer_count": 3, "score": 1, "last_activity_date": 1471854872, "creation_date": 1432189528, "last_edit_date": 1432191021, "question_id": 30366045, "link": "https://stackoverflow.com/questions/30366045/parse-net-json-date-with-go", "title": "Parse .Net JSON date with Go", "body": "<p>How can I parse this .Net JSON date with Go? \nThe value comes back unassigned.\nIt appears to parse up to the date field.</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"time\"\n)\n\ntype MyStruct struct {\n    FirstField string\n    SomeTime time.Time\n    LastField string\n}\n\ntype MyStructSlice struct {\n    MyStructs []MyStruct\n}\n\nfunc main() {\n    var s MyStructSlice \n    str := `{\"MyStructs\":[{\"FirstField\":\"123\", \"SomeTime\":\"\\/Date(1432187580000-0500)\\/\", \"LastField\":\"456\"}]}`\n    json.Unmarshal([]byte(str), &amp;s)\n    fmt.Println(s)\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/tXDs9n8hcG\" rel=\"nofollow\">Go Playground</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1432178027, "post_id": 30363790, "comment_id": 48819040, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/2137357/getpasswd-functionality-in-go\">getpasswd functionality in Go?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 592, "user_id": 4722804, "user_type": "registered", "accept_rate": 45, "profile_image": "https://www.gravatar.com/avatar/3561fae975588cc1d98ffd80f5332f8f?s=128&d=identicon&r=PG", "display_name": "Krismorte", "link": "https://stackoverflow.com/users/4722804/krismorte"}, "edited": false, "score": 0, "creation_date": 1561397921, "post_id": 30363839, "comment_id": 100041897, "body": "Works fine in linux, any tips about the windows promp?"}], "tags": [], "owner": {"reputation": 1075, "user_id": 1648357, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a9503bd0d94f44875a9402146d54e840?s=128&d=identicon&r=PG", "display_name": "Bhullnatik", "link": "https://stackoverflow.com/users/1648357/bhullnatik"}, "is_accepted": false, "score": 13, "last_activity_date": 1463429725, "last_edit_date": 1495535400, "creation_date": 1432177387, "answer_id": 30363839, "question_id": 30363790, "link": "https://stackoverflow.com/questions/30363790/silence-user-input-in-scan-function/30363839#30363839", "title": "Silence user input in Scan function", "body": "<p>The best way would be to use <a href=\"https://godoc.org/golang.org/x/crypto/ssh/terminal#ReadPassword\" rel=\"noreferrer\"><code>ReadPassword()</code></a> from the terminal package. Else you can also look in this <a href=\"https://stackoverflow.com/questions/2137357/getpasswd-functionality-in-go\">question</a> for more ways to do so.</p>\n\n<p>Code example:</p>\n\n<pre><code>package main\n\nimport \"golang.org/x/crypto/ssh/terminal\"\nimport \"fmt\"\n\nfunc main() {\n fmt.Println(\"Enter password: \")\n password, err := terminal.ReadPassword(0)\n if err == nil {\n    fmt.Println(\"Password typed: \" + string(password))\n }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 673, "user_id": 3856754, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/IcwyY.png?s=128&g=1", "display_name": "Ignasi", "link": "https://stackoverflow.com/users/3856754/ignasi"}, "is_accepted": false, "score": 2, "last_activity_date": 1432177485, "creation_date": 1432177485, "answer_id": 30363853, "question_id": 30363790, "link": "https://stackoverflow.com/questions/30363790/silence-user-input-in-scan-function/30363853#30363853", "title": "Silence user input in Scan function", "body": "<p>I have no idea about go, so I'm not sure if you can call other programs. If so, just call <strong>stty -echo</strong> to hide input and <strong>stty echo</strong> to show it again.</p>\n\n<p>Otherwise you could try the following:</p>\n\n<pre><code>fmt.Println(\"password: \")\nfmt.Println(\"\\033[8m\") // Hide input\nfmt.Scan(&amp;password)\nfmt.Println(\"\\033[28m\") // Show input\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 699, "user_id": 1126290, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/b05a05b697f6245e72f30975ca80a781?s=128&d=identicon&r=PG", "display_name": "David Brophy", "link": "https://stackoverflow.com/users/1126290/david-brophy"}, "is_accepted": false, "score": 0, "last_activity_date": 1432313620, "creation_date": 1432313620, "answer_id": 30402068, "question_id": 30363790, "link": "https://stackoverflow.com/questions/30363790/silence-user-input-in-scan-function/30402068#30402068", "title": "Silence user input in Scan function", "body": "<p>I tried a couple of different methods for this and found issues (e.g. Ctrl+C not breaking out of the program if it's waiting for a password). </p>\n\n<p>This is how I got it working in the end - this works perfectly in OSX. Haven't tried in other environments:</p>\n\n<pre><code>import (\n\n    \"log\"\n    \"code.google.com/p/go.crypto/ssh/terminal\"\n    \"github.com/seehuhn/password\"\n\n)\n\nfunc StringPrompt() (password string, err error) {\n    state, err := terminal.MakeRaw(0)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer terminal.Restore(0, state)\n    term := terminal.NewTerminal(os.Stdout, \"\")\n    password, err = term.ReadLine()\n    if err != nil {\n        log.Fatal(err)\n    }\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 1353127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mBkcl.jpg?s=128&g=1", "display_name": "Cedric Zhuang", "link": "https://stackoverflow.com/users/1353127/cedric-zhuang"}, "is_accepted": false, "score": 1, "last_activity_date": 1567396978, "creation_date": 1567396978, "answer_id": 57751290, "question_id": 30363790, "link": "https://stackoverflow.com/questions/30363790/silence-user-input-in-scan-function/57751290#57751290", "title": "Silence user input in Scan function", "body": "<p>To support windows, as mentioned <a href=\"https://stackoverflow.com/questions/2137357/getpasswd-functionality-in-go\">here</a>, please use:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import \"syscall\"\nimport \"golang.org/x/crypto/ssh/terminal\"\n\npasswd, err := terminal.ReadPassword(int(syscall.Stdin))\n</code></pre>\n"}], "owner": {"reputation": 3424, "user_id": 3918985, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/4349dc6a41c144c486e982afb327fca7?s=128&d=identicon&r=PG&f=1", "display_name": "user3918985", "link": "https://stackoverflow.com/users/3918985/user3918985"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5485, "favorite_count": 0, "answer_count": 4, "score": 4, "last_activity_date": 1567396978, "creation_date": 1432177032, "question_id": 30363790, "link": "https://stackoverflow.com/questions/30363790/silence-user-input-in-scan-function", "title": "Silence user input in Scan function", "body": "<p>How do I hide user input (password field) in terminal similar to the <code>-s</code> command in <code>read -s p \"password \" password</code> in bash. ?</p>\n\n<pre><code>var password string\nfmt.Println(\"password: \")\nfmt.Scan(&amp;password)\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/xAPDDPjKb4\" rel=\"nofollow\">http://play.golang.org/p/xAPDDPjKb4</a></p>\n"}]