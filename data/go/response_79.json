[{"tags": ["go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 2, "creation_date": 1468453023, "post_id": 38363230, "comment_id": 64139034, "body": "I&#39;m pretty sure the compiler will inline the string and not allocate it X number of times. If a language did that, I would not use it."}, {"owner": {"reputation": 9866, "user_id": 368552, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/3672308feaff9d9167de4fcc7dc6d077?s=128&d=identicon&r=PG", "display_name": "Luke Hutton", "link": "https://stackoverflow.com/users/368552/luke-hutton"}, "edited": false, "score": 1, "creation_date": 1468453623, "post_id": 38363230, "comment_id": 64139169, "body": "Compare the assembly outputs of both examples with <code>go tool compile -S</code>"}], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 6, "last_activity_date": 1468455477, "creation_date": 1468455477, "answer_id": 38363661, "question_id": 38363230, "link": "https://stackoverflow.com/questions/38363230/how-do-constants-work-in-go/38363661#38363661", "title": "How do constants work in Go?", "body": "<p>Here's an adaptation of your program that prints out the underlying string representation in both cases.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n    \"unsafe\"\n)\n\nconst (\n    Hello string = \"hello\"\n)\n\nfunc main() {\n    for i := 0; i &lt; 3; i++ {\n        a := \"hello\"\n        sh := (*reflect.StringHeader)(unsafe.Pointer(&amp;a))\n        fmt.Println(a, \" \", *sh)\n    }\n\n    fmt.Println()\n\n    for i := 0; i &lt; 3; i++ {\n        a := Hello\n        sh := (*reflect.StringHeader)(unsafe.Pointer(&amp;a))\n        fmt.Println(a, \" \", *sh)\n    }\n}\n</code></pre>\n\n<p>Here's the output:</p>\n\n<pre><code>hello   {4870353 5}\nhello   {4870353 5}\nhello   {4870353 5}\n\nhello   {4870353 5}\nhello   {4870353 5}\nhello   {4870353 5}\n</code></pre>\n\n<p>The string header in <code>{}</code> in the output shows a pointer to the character data (\"hello\"), and the length of the string.</p>\n\n<p>You can see that the pointer to the string data is the same throughout the program: the bytes data \"hello\" is referenced at exactly one memory address (here 4870353), no matter the loop count, and no matter whether it's a hardcoded string or a constant.</p>\n\n<p>The language spec itself makes no guarantees about such behavior, but constant string interning is such a natural optimisation that it would be surprising if go behaved in any significantly different way.</p>\n"}, {"tags": [], "owner": {"reputation": 503, "user_id": 529998, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6ba79d1d36c4b5e03e4b524ebff09c9?s=128&d=identicon&r=PG", "display_name": "wonsky", "link": "https://stackoverflow.com/users/529998/wonsky"}, "is_accepted": false, "score": 1, "last_activity_date": 1468480201, "creation_date": 1468480201, "answer_id": 38367702, "question_id": 38363230, "link": "https://stackoverflow.com/questions/38363230/how-do-constants-work-in-go/38367702#38367702", "title": "How do constants work in Go?", "body": "<p>The easiest way to find whether Go makes some allocations or not is writing the benchmark. In your case code might look like:</p>\n\n<pre><code>package sof\n\nimport \"log\"\n\nconst (\n    HELLO = \"hello\"\n)\n\nfunc forString(max int) {\n    for i := 0; i &lt; max; i++ {\n        logMsg(\"hello\", false)\n    }\n}\n\nfunc forConst(max int) {\n    for i := 0; i &lt; max; i++ {\n        logMsg(HELLO, false)\n    }\n}\n\nfunc logMsg(msg string, stdOut bool) {\n    if stdOut {\n        log.Println(msg)\n    }\n}\n</code></pre>\n\n<p>And benchmark:</p>\n\n<pre><code>package sof\n\nimport \"testing\"\n\nfunc BenchmarkForString(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        forString(i)\n    }\n}\n\nfunc BenchmarkForConst(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        forConst(i)\n    }\n}\n</code></pre>\n\n<p>Then you can just run the benchmark:</p>\n\n<pre><code>go test -bench=. -benchmem\n</code></pre>\n\n<p>Very important is -benchmem flag. Without it your benchmark tells you only about the benchmark time - you don't get info about number of allocations and average size of allocation per operation.</p>\n\n<p>Output of the benchmark:</p>\n\n<pre><code>testing: warning: no tests to run\nBenchmarkForString-4      100000        133551 ns/op           0 B/op          0 allocs/op\nBenchmarkForConst-4       100000        128585 ns/op           0 B/op          0 allocs/op\nPASS\nok      .../sof 26.475s\n</code></pre>\n\n<p>In last 2 columns you have an information about the size of allocations and its number. In your example there are only zeros which means that both funcs don't make any allocations : )</p>\n"}], "owner": {"reputation": 891, "user_id": 4381110, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8ba3b0252ad9321924c81c724c829fa3?s=128&d=identicon&r=PG&f=1", "display_name": "tomwassing", "link": "https://stackoverflow.com/users/4381110/tomwassing"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 38363661, "answer_count": 2, "score": 2, "last_activity_date": 1468480201, "creation_date": 1468451861, "question_id": 38363230, "link": "https://stackoverflow.com/questions/38363230/how-do-constants-work-in-go", "title": "How do constants work in Go?", "body": "<p>In Go which snippet allocates less objects? Or do they both use the same amount of allocations, if so; why? (:</p>\n\n<pre><code>for i := 0; i &lt; 10000000; i++ {\n        log.println(\"hello\")\n    }\n</code></pre>\n\n<p>Does the code below allocates only 1 string?</p>\n\n<pre><code>const (\n    HELLO string = \"hello\"\n)\n\nfor i := 0; i &lt; 10000000; i++ {\n    log.println(HELLO)\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1468448369, "post_id": 38362631, "comment_id": 64137633, "body": "What do you mean you &quot;expect&quot; a slice is a dynamic array? <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">Read what a slice actually is</a>."}, {"owner": {"reputation": 2023, "user_id": 1698398, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/90a6b9d6a6d9f099bc6ad6158e096b2c?s=128&d=identicon&r=PG&f=1", "display_name": "user937284", "link": "https://stackoverflow.com/users/1698398/user937284"}, "edited": false, "score": 1, "creation_date": 1468448450, "post_id": 38362631, "comment_id": 64137668, "body": "Thats what Slices are made for in Go. Under the hood they are just pointers to arrays."}, {"owner": {"reputation": 9249, "user_id": 456809, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a8e60ef50534769dba78843acf8bb82d?s=128&d=identicon&r=PG", "display_name": "Breedly", "link": "https://stackoverflow.com/users/456809/breedly"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1468449089, "post_id": 38362631, "comment_id": 64137889, "body": "@TimCooper interesting. Instead of giving Array&#39;s a complex interface themselves slices are another layer that makes array manipulation simpler?"}], "answers": [{"comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 5, "creation_date": 1468449222, "post_id": 38362784, "comment_id": 64137925, "body": "<i>That or you could use slices.</i> slices <i>are</i> being used in your example; it&#39;s what is returned."}], "tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": true, "score": 129, "last_activity_date": 1468450409, "last_edit_date": 1468450409, "creation_date": 1468449086, "answer_id": 38362784, "question_id": 38362631, "link": "https://stackoverflow.com/questions/38362631/go-error-non-constant-array-bound/38362784#38362784", "title": "Go error: non-constant array bound", "body": "<p>You can't instantiate an array like that with a value calculated at runtime. Instead use make to initialize a slice with the desired length. It would look like this;</p>\n\n<pre><code>left := make([]int, leftLength)\n</code></pre>\n"}], "owner": {"reputation": 9249, "user_id": 456809, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/a8e60ef50534769dba78843acf8bb82d?s=128&d=identicon&r=PG", "display_name": "Breedly", "link": "https://stackoverflow.com/users/456809/breedly"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 38832, "favorite_count": 7, "accepted_answer_id": 38362784, "answer_count": 1, "score": 65, "last_activity_date": 1468450409, "creation_date": 1468448281, "last_edit_date": 1468448398, "question_id": 38362631, "link": "https://stackoverflow.com/questions/38362631/go-error-non-constant-array-bound", "title": "Go error: non-constant array bound", "body": "<p>I'm trying to calculate the necessary length for an array in a merge sort implementation I'm writing in <code>go</code>. It looks like this:</p>\n\n<pre><code>func merge(array []int, start, middle, end int) {\n  leftLength := middle - start + 1\n  rightLength := end - middle\n  var left [leftLength]int\n  var right [rightLength]int\n  //...\n}\n</code></pre>\n\n<p>I then get this complaint when running <code>go test</code>:</p>\n\n<pre><code>./mergesort.go:6: non-constant array bound leftLength\n./mergesort.go:7: non-constant array bound rightLength\n</code></pre>\n\n<p>I assume <code>go</code> does not enjoy users instantiating an Array's length with a calculated value. It only accepts <em>constants</em>. Should I just give up and use a slice instead? I expect a <em>slice</em> is a dynamic array meaning it's either a linked list or copies into a larger array when it gets full.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 10, "last_activity_date": 1468445861, "last_edit_date": 1468445861, "creation_date": 1468445459, "answer_id": 38362031, "question_id": 38361919, "link": "https://stackoverflow.com/questions/38361919/how-do-i-cleanly-separate-user-facing-errors-from-internal-errors-in-golang/38362031#38362031", "title": "How do I cleanly separate user-facing errors from internal errors in Golang?", "body": "<p>Returning multiple <code>error</code> does not seem very Go-like to me.</p>\n\n<p>Why not have an interface called <code>UserError</code> that defines a method that returns a message suitable to show the user. If the returned error does not implement <code>UserError</code>, show a standard \"Internal Server Error\" message. Example:</p>\n\n<pre><code>type UserError interface {\n    error\n    UserError() string\n}\n\ntype emptyInput struct {}\n\nfunc (e emptyInput) Error() string {\n    return e.UserError()\n}    \n\nfunc (emptyInput) UserError() string {\n    return \"Empty input\"\n}\n\nfunc ProcessInput(input string) (*ProcessedValue, error) {\n    if input == \"\" {\n        return nil, &amp;emptyInput{}\n    }\n}\n\nfunc httpHandler() {\n    val, err := ProcessInput(input)\n    if err != nil {\n        if userErr := err.(UserError); userErr != nil {\n            // show userError.UserError() to user\n        } else {\n            // Log error\n            // show Internal server error message\n        }\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 1, "last_activity_date": 1468570438, "last_edit_date": 1468570438, "creation_date": 1468495893, "answer_id": 38373058, "question_id": 38361919, "link": "https://stackoverflow.com/questions/38361919/how-do-i-cleanly-separate-user-facing-errors-from-internal-errors-in-golang/38373058#38373058", "title": "How do I cleanly separate user-facing errors from internal errors in Golang?", "body": "<blockquote>\n  <p>Should I have a single error return and distinguish by type on the\n  caller side?</p>\n</blockquote>\n\n<p>That's what I would recommend. You could create a global error variables for different types of errors. And caller can check what kind of error was returned.</p>\n\n<pre><code>var ErrValidation = fmt.Errorf(\"Validation failed.\")\n\nfunc ProcessInput(input string) (ProcessedValue, error) {\n    if !validate(input) {\n        return nil, ErrValidation\n    }\n    // process stuff and return\n}\n</code></pre>\n\n<p>And on caller side:</p>\n\n<pre><code>value, err := ProcessInput(input)\nif err != nil {\n    if err == ErrValidation {\n        // Tell user validation failed\n    } else {\n        // Show internal server error message\n    }\n}\n// do things with value\n</code></pre>\n"}], "owner": {"reputation": 389, "user_id": 1566921, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/f9e82f5ce51b38fd69d6ccb3e215cfd7?s=128&d=identicon&r=PG", "display_name": "william", "link": "https://stackoverflow.com/users/1566921/william"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 463, "favorite_count": 0, "accepted_answer_id": 38362031, "answer_count": 2, "score": 7, "last_activity_date": 1468570438, "creation_date": 1468444947, "question_id": 38361919, "link": "https://stackoverflow.com/questions/38361919/how-do-i-cleanly-separate-user-facing-errors-from-internal-errors-in-golang", "title": "How do I cleanly separate user-facing errors from internal errors in Golang?", "body": "<p>I am running into a common pattern where I have a function that takes user input, and either returns a successful output value or an error.  But it can return different types of errors, some of which are the result of bad user input and others which are the result of internal errors (DB unavailable, for instance).</p>\n\n<p>My functions have signatures that look like this:</p>\n\n<pre><code>// ProcessInput takes a user-input string and returns a processed value\nfunc ProcessInput(input string) (ProcessedValue, error, error) {}\n</code></pre>\n\n<p>The first return value is meaningful (not nil) if no errors were encountered, the second return value is an error if the user input failed validation, and the third return value is an error if an unexpected internal error occurred.</p>\n\n<p>This works fine but it does not feel very clean, and it's not obvious from looking at the signature what the different errors are.  I considered naming the error returns but I don't like the side-effects of naming return parameters.</p>\n\n<p>Are there any other patterns I could apply that are cleaner?  Should I have a single error return and distinguish by type on the caller side?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1468443281, "post_id": 38361397, "comment_id": 64135402, "body": "From the Go docs: &quot;4. If an operand implements the error interface, the Error method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 3344, "user_id": 903998, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/pZCd4.jpg?s=128&g=1", "display_name": "Victor", "link": "https://stackoverflow.com/users/903998/victor"}, "edited": false, "score": 0, "creation_date": 1591710943, "post_id": 38361512, "comment_id": 110155031, "body": "basically, if you make an struct implements an <code>Error() string</code> method it becomes for the existing core libraries an error object, but not for your custom code. The discussion would be : what is the sense of having a Error() string into an IntSlice..."}], "tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 8, "last_activity_date": 1468443258, "creation_date": 1468443258, "answer_id": 38361512, "question_id": 38361397, "link": "https://stackoverflow.com/questions/38361397/why-printing-slice-using-fmt-printlnslice-is-different-in-golang/38361512#38361512", "title": "why printing slice using fmt.Println(slice) is different in Golang", "body": "<p>This is <a href=\"https://godoc.org/fmt\">documented</a> as part of the behaviour of <code>fmt</code> (emphasis mine):</p>\n\n<blockquote>\n  <p>Except when printed using the verbs %T and %p, special formatting considerations apply for operands that implement certain interfaces. In order of application:</p>\n  \n  <ol>\n  <li><p>If the operand is a reflect.Value, the operand is replaced by the concrete value that it holds, and printing continues with the next rule.</p></li>\n  <li><p>If an operand implements the Formatter interface, it will be invoked. Formatter provides fine control of formatting.</p></li>\n  <li><p>If the %v verb is used with the # flag (%#v) and the operand implements the GoStringer interface, that will be invoked.</p>\n  \n  <p>If the format (which is implicitly %v for Println etc.) is valid for a string (%s %q %v %x %X), the following two rules apply:</p></li>\n  <li><p><strong>If an operand implements the error interface, the Error method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).</strong></p></li>\n  <li><p>If an operand implements method String() string, that method will be invoked to convert the object to a string, which will then be formatted as required by the verb (if any).</p></li>\n  </ol>\n  \n  <p>For compound operands such as slices and structs, the format applies to the elements of each operand, recursively, not to the operand as a whole. Thus %q will quote each element of a slice of strings, and %6.2f will control formatting for each element of a floating-point array.</p>\n</blockquote>\n\n<p>The <code>fmt</code> package sees that <code>slice</code> implements <code>error</code> and prints <code>value.Error()</code>, rather than iterating over the slice and applying formatting to each element.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2652, "favorite_count": 1, "accepted_answer_id": 38361512, "answer_count": 1, "score": 6, "last_activity_date": 1471463769, "creation_date": 1468442843, "last_edit_date": 1471463769, "question_id": 38361397, "link": "https://stackoverflow.com/questions/38361397/why-printing-slice-using-fmt-printlnslice-is-different-in-golang", "title": "why printing slice using fmt.Println(slice) is different in Golang", "body": "<p>code A:  </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    slice := IntSlice{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n    fmt.Println(slice)\n}\n\ntype IntSlice []int\n</code></pre>\n\n<p>output A:   </p>\n\n<pre><code>[0 1 2 3 4 5 6 7 8 9]\n</code></pre>\n\n<p>code B:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    slice := IntSlice{0, 1, 2, 3, 4, 5, 6, 7, 8, 9}\n    fmt.Println(slice)\n}\n\ntype IntSlice []int\n\nfunc (slice IntSlice) Error() string { return \"this is called.\" }\n</code></pre>\n\n<p>output B:  </p>\n\n<pre><code>this is called.\n</code></pre>\n\n<p>why the behavior of <code>fmt.Println(slice)</code> is different for these two codes( A and B)?<br>\nor why <code>fmt.Println(slice)</code> calls <code>slice.Error()</code> automatically?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1468442742, "creation_date": 1468442742, "answer_id": 38361370, "question_id": 38361328, "link": "https://stackoverflow.com/questions/38361328/publish-a-golang-based-binary-on-github-to-be-installed-with-go-get/38361370#38361370", "title": "publish a golang based binary on github to be installed with &quot;go get&quot;", "body": "<p>To get your project building as an executable, you need to have:</p>\n\n<ul>\n<li>All of the buildable Go files as part of the package <code>main</code>, and</li>\n<li>Define a <code>main</code> function to be the entry point for your program</li>\n</ul>\n\n<p>However, if your package can also be used as a library, a common pattern is to have your executable stored in <code>$PACKAGE/cmd/$EXECUTABLE_NAME</code>. This would mean your package executable would be fetched using:</p>\n\n<pre><code>go get -u github.com/kfirufk/glpm/cmd/glpm\n</code></pre>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 360, "favorite_count": 0, "accepted_answer_id": 38361370, "answer_count": 1, "score": 1, "last_activity_date": 1468443096, "creation_date": 1468442538, "last_edit_date": 1468443096, "question_id": 38361328, "link": "https://stackoverflow.com/questions/38361328/publish-a-golang-based-binary-on-github-to-be-installed-with-go-get", "title": "publish a golang based binary on github to be installed with &quot;go get&quot;", "body": "<p>I created a simple lazy package manager for go.\nI published it at <a href=\"https://github.com/kfirufk/glpm\" rel=\"nofollow\">https://github.com/kfirufk/glpm</a>.</p>\n\n<p>when I execute <code>go get github.com/kfirufk/glpm</code> I get no errors, but it compiles it as a module since the resulted pkg content at <code>$GOPATH/pkg/darwin_amd64/github.com/kfirufk</code>is <code>glpm.a</code>. </p>\n\n<p>I want it to be compiled as an executable. what am I missing?</p>\n\n<p>thanks</p>\n"}, {"tags": ["xml", "intellij-idea", "go"], "answers": [{"comments": [{"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1468455253, "post_id": 38362791, "comment_id": 64139528, "body": "That was essentially the fix, I went with <code>os.O_CREATE | os.O_TRUNC | os.O_RDWR</code> as my file modes, and that worked just fine. As for the IntelliJ issue, I just had bad XML; not documented very well. Thanks!"}], "tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": true, "score": 2, "last_activity_date": 1468452848, "last_edit_date": 1468452848, "creation_date": 1468449126, "answer_id": 38362791, "question_id": 38360026, "link": "https://stackoverflow.com/questions/38360026/golang-write-marshal-xml-to-file/38362791#38362791", "title": "Golang: write marshal xml to file", "body": "<p>In the <code>OpenFile</code> call, the file already exists and is being reopened and not truncated. The data written is smaller than the content of the file, so overwrites only the start of the file, leaving junk at the end.</p>\n\n<p>According to <a href=\"https://golang.org/pkg/os/#pkg-constants\" rel=\"nofollow\">os flags</a> you can truncate the file upon opening:</p>\n\n<pre><code>os.OpenFile(\"filename\", os.O_CREATE | os.O_TRUNC, 0644)\n</code></pre>\n\n<p>Or use <a href=\"https://golang.org/pkg/os/#Create\" rel=\"nofollow\">os.Create()</a>.</p>\n\n<p>This is basically what iotuil.WriteFile is doing (see <a href=\"https://golang.org/src/io/ioutil/ioutil.go?s=2520:2588#L66\" rel=\"nofollow\">source</a>). </p>\n\n<p>IntelliJ might not be able to open the file if it doesn't have sufficient permissions. Try changing permissions to 0666 in the code, and check the file is created with these permissions. Note the permission parameter is ignored if the file already exists. Also, the permissions set when creating a file may be restricted by the <a href=\"https://en.wikipedia.org/wiki/Umask\" rel=\"nofollow\">umask</a> of the process.</p>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 300, "favorite_count": 0, "accepted_answer_id": 38362791, "answer_count": 1, "score": 0, "last_activity_date": 1468452848, "creation_date": 1468437613, "question_id": 38360026, "link": "https://stackoverflow.com/questions/38360026/golang-write-marshal-xml-to-file", "title": "Golang: write marshal xml to file", "body": "<p>I have a byte array of marshalled XML, if I write it to a file using the os library:</p>\n\n<pre><code>fh, _ := os.OpenFile(\"filename\", os.O_CREATE, 0644)\n_, err := fh.Write(XMLByteArray)\n</code></pre>\n\n<p>I get a bunch of junk at the end of the file as if it was a bad write:</p>\n\n<pre><code>&lt;project version=\"4\"&gt;\n  &lt;component name=\"test\"&gt;\n    &lt;option name=\"urls\"&gt;\n      &lt;list&gt;&lt;/list&gt;\n    &lt;/option&gt;\n  &lt;/component&gt;\n&lt;/project&gt;    &lt;/option&gt;\n  &lt;/component&gt;\n&lt;/project&gt;on&gt;\n            &lt;/component&gt;\n    &lt;/project&gt;\n</code></pre>\n\n<p>If I write it with io/ioutil library like this:</p>\n\n<pre><code>err = ioutil.WriteFile(\"filename\", XMLByteArray, 0644)\n    if err != nil {\n        log.Fatal(err)\n    }\n</code></pre>\n\n<p>I get proper XML:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;project version=\"4\"&gt;\n  &lt;component name=\"test\"&gt;\n    &lt;option name=\"urls\"&gt;\n      &lt;list&gt;&lt;/list&gt;\n    &lt;/option&gt;\n  &lt;/component&gt;\n&lt;/project&gt;\n</code></pre>\n\n<p>Here's the part I really don't understand. This file is the result of a dynamic path generation, and is the configuration for IntelliJ. If I use <code>os.Write()</code> and then properly close the file handler, IntelliJ reads the file immediately, but errors out because the XML is messed up. If I write the file with <code>ioutil.WriteFile()</code>, the file looks correct, but IntelliJ isn't recognising the file to exist.</p>\n\n<p>So my questions are:</p>\n\n<ol>\n<li>What is the difference between <code>os.Write()</code> and <code>ioutil.WriteFile()</code>?</li>\n<li>Why is that difference causing the byte array to be written differently?</li>\n</ol>\n"}, {"tags": ["go", "protocol-buffers", "grpc"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1468460107, "post_id": 38359034, "comment_id": 64140540, "body": "Can you elaborate on &quot;...keep the unrecognized fields around.&quot;?"}, {"owner": {"reputation": 31, "user_id": 6432655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aeyFiZPfg-A/AAAAAAAAAAI/AAAAAAAAW6w/Br2K2SHYQOk/photo.jpg?sz=128", "display_name": "Rohit Saboo", "link": "https://stackoverflow.com/users/6432655/rohit-saboo"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1468461036, "post_id": 38359034, "comment_id": 64140732, "body": "Server Y would keep field bar as &quot;unknown fields&quot; on unmarshalling when it received the proto from Z. In turn, when Y would marshal and send this to X, bar would still be included in the wire format. Thus, X would receive the contents of bar, too, instead of them being dropped at Y."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1468463622, "post_id": 38359034, "comment_id": 64141270, "body": "As you say, it looks like this is a deliberate change between protocol versions <a href=\"https://developers.google.com/protocol-buffers/docs/proto#updating\" rel=\"nofollow noreferrer\">proto2</a>: &quot;...unknown fields are not discarded, and if the message is later serialized, the unknown fields are serialized along with it...&quot; whereas in <a href=\"https://developers.google.com/protocol-buffers/docs/proto3#updating\" rel=\"nofollow noreferrer\">proto3</a>: &quot;...unknown fields are discarded when the message is deserialized...&quot;. I&#39;d prefer to stick with proto2 rather than mix versions."}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1468465081, "post_id": 38359034, "comment_id": 64141593, "body": "I think this protocol change is reasonable; the format of messages from server Y should remain unchanged if server Y remains unchanged."}, {"owner": {"reputation": 31, "user_id": 6432655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aeyFiZPfg-A/AAAAAAAAAAI/AAAAAAAAW6w/Br2K2SHYQOk/photo.jpg?sz=128", "display_name": "Rohit Saboo", "link": "https://stackoverflow.com/users/6432655/rohit-saboo"}, "reply_to_user": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1468518619, "post_id": 38359034, "comment_id": 64171755, "body": "I can see that we would at times want the format of messages to stay fixed. At other times, we would want Y to transmit fields it doesn&#39;t know about so that we don&#39;t have to redeploy servers for every small change in schema."}], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6432655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aeyFiZPfg-A/AAAAAAAAAAI/AAAAAAAAW6w/Br2K2SHYQOk/photo.jpg?sz=128", "display_name": "Rohit Saboo", "link": "https://stackoverflow.com/users/6432655/rohit-saboo"}, "edited": false, "score": 0, "creation_date": 1468518737, "post_id": 38367634, "comment_id": 64171813, "body": "any does help for submessages and work like extensions from proto2. It is definitely a part solution; it doesn&#39;t address all the issues though."}], "tags": [], "owner": {"reputation": 7877, "user_id": 914716, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d0ed96380268ce904eb69d0895915cfa?s=128&d=identicon&r=PG", "display_name": "jpa", "link": "https://stackoverflow.com/users/914716/jpa"}, "is_accepted": false, "score": 0, "last_activity_date": 1468480034, "creation_date": 1468480034, "answer_id": 38367634, "question_id": 38359034, "link": "https://stackoverflow.com/questions/38359034/older-services-transmitting-newer-versions-of-protocol-buffer-3-messages/38367634#38367634", "title": "Older services transmitting newer versions of protocol buffer 3 messages", "body": "<p>You can add an Any field for the future expansion needs:</p>\n\n<p><a href=\"https://developers.google.com/protocol-buffers/docs/proto3#any\" rel=\"nofollow\">https://developers.google.com/protocol-buffers/docs/proto3#any</a></p>\n\n<p>I haven't used it myself, but if I understand correctly, even unrecognized Any field values should remain when the message is decoded and re-encoded.</p>\n"}], "owner": {"reputation": 31, "user_id": 6432655, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-aeyFiZPfg-A/AAAAAAAAAAI/AAAAAAAAW6w/Br2K2SHYQOk/photo.jpg?sz=128", "display_name": "Rohit Saboo", "link": "https://stackoverflow.com/users/6432655/rohit-saboo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 152, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468518818, "creation_date": 1468433790, "last_edit_date": 1468518818, "question_id": 38359034, "link": "https://stackoverflow.com/questions/38359034/older-services-transmitting-newer-versions-of-protocol-buffer-3-messages", "title": "Older services transmitting newer versions of protocol buffer 3 messages", "body": "<p>Say, I have a protocol buffer message (in proto3) of the form</p>\n\n<pre><code>message A {\n  int32 foo = 1;\n}\n</code></pre>\n\n<p>I'm running servers X, Y, and Z written in Go that use these messages and pass them around with gRPC such that X talks with Y and Y talks with Z, i.e., X and Z talk via Y.</p>\n\n<p>Alice designs a cool, new feature that requires adding a new field, bar, to message A and updates servers X and Z.</p>\n\n<pre><code>message A {\n  int32 foo = 1;\n  int32 bar = 2;\n}\n</code></pre>\n\n<p>However, the deployed version of server Y does not recognize this new field and redeploying server Y to achieve this would quickly become very difficult in larger systems.</p>\n\n<p>In a previous life, we used proto2 and all this worked fine because it would keep the unrecognized fields around. However, Google now recommends we use proto3 with gRPC and from my understanding, keeping unrecognized fields around is no longer supported at least in Go.</p>\n\n<p>What is the recommended way to address this issue with proto3?</p>\n\n<p><b>Update:</b><br>\nThere is an open github issue about this\n<a href=\"https://github.com/google/protobuf/issues/272\" rel=\"nofollow\">https://github.com/google/protobuf/issues/272</a></p>\n"}, {"tags": ["go", "xml-parsing"], "comments": [{"owner": {"reputation": 432, "user_id": 6542561, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uEiJr.png?s=128&g=1", "display_name": "Bruce David Wilner", "link": "https://stackoverflow.com/users/6542561/bruce-david-wilner"}, "edited": false, "score": 0, "creation_date": 1468441313, "post_id": 38358558, "comment_id": 64134409, "body": "What on earth do you mean by &quot;How can I get this struct instead?&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "is_accepted": true, "score": 3, "last_activity_date": 1468445125, "creation_date": 1468445125, "answer_id": 38361957, "question_id": 38358558, "link": "https://stackoverflow.com/questions/38358558/go-xml-parsing-use-attributes-as-struct-field-name/38361957#38361957", "title": "Go XML parsing : use attributes as struct field name", "body": "<p>You can define a custom unmarshaler for the <code>&lt;row&gt;</code> elements that does this \"unpacking\" for you:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"strconv\"\n)\n\nvar xmlstr = `&lt;data&gt;\n    &lt;row&gt;\n        &lt;col name='firstname'&gt;John&lt;/col&gt;\n        &lt;col name='age'&gt;2&lt;/col&gt;\n    &lt;/row&gt;\n    &lt;row&gt;\n        &lt;col name='firstname'&gt;3&lt;/col&gt;\n        &lt;col name='age'&gt;4&lt;/col&gt;\n    &lt;/row&gt;\n&lt;/data&gt;`\n\ntype Data struct {\n    XMLName xml.Name `xml:\"data\"`\n    Person  []Person `xml:\"row\"`\n}\n\ntype Person struct {\n    Firstname string\n    Age       int\n}\n\nfunc (p *Person) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    x := struct {\n        Col []struct {\n            Name  string `xml:\"name,attr\"`\n            Value string `xml:\",chardata\"`\n        } `xml:\"col\"`\n    }{}\n    err := d.DecodeElement(&amp;x, &amp;start)\n    if err != nil {\n        return err\n    }\n    for _, col := range x.Col {\n        switch col.Name {\n        case \"firstname\":\n            p.Firstname = col.Value\n        case \"age\":\n            p.Age, err = strconv.Atoi(col.Value)\n            if err != nil {\n                return err\n            }\n        }\n    }\n    return nil\n}\n\nfunc main() {\n    b := []byte(xmlstr)\n\n    var d Data\n    if err := xml.Unmarshal(b, &amp;d); err != nil {\n        panic(err)\n    }\n\n    for _, person := range d.Person {\n        fmt.Println(person)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DRF5axeBc0\" rel=\"nofollow\">https://play.golang.org/p/DRF5axeBc0</a></p>\n"}], "owner": {"reputation": 67, "user_id": 6216060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59cda67b2d33dd3dbf64ed3d1c89153e?s=128&d=identicon&r=PG&f=1", "display_name": "guillaume0811", "link": "https://stackoverflow.com/users/6216060/guillaume0811"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 225, "favorite_count": 0, "accepted_answer_id": 38361957, "answer_count": 1, "score": 2, "last_activity_date": 1468445125, "creation_date": 1468432248, "question_id": 38358558, "link": "https://stackoverflow.com/questions/38358558/go-xml-parsing-use-attributes-as-struct-field-name", "title": "Go XML parsing : use attributes as struct field name", "body": "<p>How can I use XML attributes as struct field?</p>\n\n<p>This is my test: \nEach row correspond to a Person</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n)\n\nvar xmlstr = `&lt;data&gt;\n    &lt;row&gt;\n        &lt;col name='firstname'&gt;John&lt;/col&gt;\n        &lt;col name='age'&gt;2&lt;/col&gt;\n    &lt;/row&gt;\n    &lt;row&gt;\n        &lt;col name='firstname'&gt;3&lt;/col&gt;\n        &lt;col name='age'&gt;4&lt;/col&gt;\n    &lt;/row&gt;\n&lt;/data&gt;`\n\ntype Data struct {\n    XMLName xml.Name `xml:\"data\"`\n    Person  []Person `xml:\"row\"`\n}\n\ntype Person struct {\n    PersonField []PersonField `xml:\"col\"`\n}\n\ntype PersonField struct {\n    Name  string `xml:\"name,attr\"`\n    Value string `xml:\",chardata\"`\n}\n\nfunc main() {\n    b := []byte(xmlstr)\n\n    var d Data\n    xml.Unmarshal(b, &amp;d)\n\n    for _, person := range d.Person {\n        fmt.Println(person)\n    }\n}\n</code></pre>\n\n<p>I go a slice of 2 struct:</p>\n\n<pre><code>{[{firstname John} {age 2}]}\n{[{firstname 3} {age 4}]}\n</code></pre>\n\n<p>How can I get this struct instead ? Where xml attributes is use as a struct field name?</p>\n\n<pre><code>type Person struct {\n    Firstname string\n    Age       int\n}\n</code></pre>\n"}, {"tags": ["go", "build", "bazel"], "comments": [{"owner": {"reputation": 2738, "user_id": 482260, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ca1f8e79dd043842258c467dd16bc5c0?s=128&d=identicon&r=PG", "display_name": "Laurent", "link": "https://stackoverflow.com/users/482260/laurent"}, "edited": false, "score": 0, "creation_date": 1469526682, "post_id": 38358504, "comment_id": 64561374, "body": "What we generally do at Google is to manually run the code generator when you need it (it can also be automated in the IDE), and check in the output in the source control."}], "answers": [{"comments": [{"owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "edited": false, "score": 0, "creation_date": 1468514495, "post_id": 38378377, "comment_id": 64169422, "body": "Thanks! I wonder if this is an accepted behavior for bazel projects ? are there any downsides?"}, {"owner": {"reputation": 21554, "user_id": 4243, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/501b2f1d20a7a8f9539d46776a640225?s=128&d=identicon&r=PG", "display_name": "kristina", "link": "https://stackoverflow.com/users/4243/kristina"}, "reply_to_user": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "edited": false, "score": 0, "creation_date": 1468528597, "post_id": 38378377, "comment_id": 64177518, "body": "I mean, it&#39;s a little hacky and fragile (you&#39;re manually specifying directories that might change)."}, {"owner": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 0, "creation_date": 1559062398, "post_id": 38378377, "comment_id": 99298703, "body": "Why do Skylark remote repositories allow this? What is the intended use?"}, {"owner": {"reputation": 721, "user_id": 481537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e33c31ff36ebef4f4517017ee4515199?s=128&d=identicon&r=PG", "display_name": "Alex Garcia", "link": "https://stackoverflow.com/users/481537/alex-garcia"}, "reply_to_user": {"reputation": 18645, "user_id": 50385, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/2faf0c72f6a7f65431e7df489878be24?s=128&d=identicon&r=PG", "display_name": "Joseph Garvin", "link": "https://stackoverflow.com/users/50385/joseph-garvin"}, "edited": false, "score": 0, "creation_date": 1612366700, "post_id": 38378377, "comment_id": 116745646, "body": "@JosephGarvin to be able to support 3rd party packages/repositories that do not have BUILD files (e.g. including a header from a downloaded zip file)"}], "tags": [], "owner": {"reputation": 21554, "user_id": 4243, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/501b2f1d20a7a8f9539d46776a640225?s=128&d=identicon&r=PG", "display_name": "kristina", "link": "https://stackoverflow.com/users/4243/kristina"}, "is_accepted": true, "score": 4, "last_activity_date": 1565345459, "last_edit_date": 1565345459, "creation_date": 1468510290, "answer_id": 38378377, "question_id": 38358504, "link": "https://stackoverflow.com/questions/38358504/can-i-generate-a-build-file-in-bazel/38378377#38378377", "title": "Can I generate a BUILD file in Bazel?", "body": "<p>In general, you cannot generate BUILD files, they must be there at the beginning of the build.  Bazel's general build phases are:</p>\n\n<ul>\n<li>Parse the targets you specified on the command line.</li>\n<li>Look up BUILD files in each directory those specify.</li>\n<li>Parse BUILD files that those targets mention (and so on).</li>\n<li>Generate a tree of actions to execute (e.g., \"Run shell script\").</li>\n<li>Actually execute the actions.</li>\n</ul>\n\n<p>So, by the time your script is executed, the time for reading BUILD files is long over.</p>\n\n<p>Also, outputs are put in their own directory (under bazel-out) so they wouldn't even be present in your source tree without munging.</p>\n\n<p>That said...</p>\n\n<p>Skylark remote repositories do let you execute code to write files, including BUILD files, in other repositories.  So you could, theoretically, have something like (untested):</p>\n\n<pre><code>def _gen_repo_impl(repo_ctx):\n  # Writes external/reponame/BUILD\n  repo_ctx.execute(\"/your/bash/script.sh\")\n  for path in repo_ctx.attr.paths:\n    repo_ctx.symlink(path, path.basename)\n\ngenerated_repo = repository_rule(\n    implementation = _gen_repo_impl,\n    attrs = {\"paths\": attr.label_list(allow_files = True)}\n)\n</code></pre>\n\n<p>Then in your WORKSPACE file, do something like:</p>\n\n<pre><code>load('//path/to/your:genrepo.bzl', 'generated_repo')\ngenerated_repo(\n    name = \"pwd\",\n    paths = [\"src\", \"test\", \"third_party\"],\n)\n</code></pre>\n\n<p>Then you could build/depend on <code>@pwd//...</code> and the repository rule would generate an external repo with symlinks to src, test, and third_party (theoretically... my code's probably got some typos).</p>\n"}], "owner": {"reputation": 40934, "user_id": 121687, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/359b919642638c5b67555a1bc89dfd3e?s=128&d=identicon&r=PG", "display_name": "fabrizioM", "link": "https://stackoverflow.com/users/121687/fabriziom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2336, "favorite_count": 2, "accepted_answer_id": 38378377, "answer_count": 1, "score": 3, "last_activity_date": 1565345459, "creation_date": 1468432026, "question_id": 38358504, "link": "https://stackoverflow.com/questions/38358504/can-i-generate-a-build-file-in-bazel", "title": "Can I generate a BUILD file in Bazel?", "body": "<p>I want to use the go lint tool to generate a BUILD file for bazel.</p>\n\n<p>I would have a go binary that would perform something like this bash script:</p>\n\n<pre><code>#!/bin/bash\n\ncat &lt;&lt;EOF &gt; BUILD\n# THIS FILE IS AUTOGENERATED\n\npackage(default_visibility = [\"//visibility:public\"])\n\nload(\"//go:def.bzl\", \"go_prefix\", \"go_library\", \"go_binary\", \"go_test\")\nEOF\n\nfor pkg in `go list -f {{.ImportPath}} ./...`; do\n    go list -f \"`cat test.in`\" $pkg &gt;&gt; \"BUILD\";\ndone\n\nbuildifier -mode fix BUILD\n</code></pre>\n\n<p>The test.in file contains:</p>\n\n<pre><code>{{ if eq .Name \"main\" }}\ngo_binary\n{{else}}\ngo_library\n{{end}}\n(\"{{.Name}}\",\n    srcs=[\n        {{range .GoFiles}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    deps=[\n        {{range .Imports}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    csrcs=[\n        {{range .CgoFiles}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    swig_srcs=[\n        {{range .SwigFiles}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    cxxswig=[\n        {{range .SwigCXXFiles}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    cflags=[\n        {{range .CgoCFLAGS}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    cxxflags=[\n        {{range .CgoCXXFLAGS}}\n            \"{{.}}\",\n        {{end}} \n    ],\n    cppflags=[\n        {{range .CgoCPPFLAGS}}\n            \"{{.}}\",\n        {{end}} \n    ],           \n    {{ with $ctx := context}}\n        {{$ctx.InstallSuffix}}\n    {{end}}    \n)\n</code></pre>\n\n<p>And this generates:</p>\n\n<pre><code># THIS FILE IS AUTOGENERATED\n\npackage(default_visibility = [\"//visibility:public\"])\n\nload(\"//go:def.bzl\", \"go_prefix\", \"go_library\", \"go_binary\", \"go_test\")\n\ngo_library\n\n(\n    \"tensorflow\",\n    srcs = [\n        \"doc.go\",\n        \"gen.go\",\n        \"graph.go\",\n        \"session.go\",\n    ],\n    deps = [\n        \"C\",\n        \"encoding/binary\",\n        \"fmt\",\n        \"github.com/golang/protobuf/proto\",\n        \"github.com/tensorflow/tensorflow/tensorflow/contrib/go/proto\",\n        \"math\",\n        \"reflect\",\n        \"runtime\",\n        \"strings\",\n        \"unsafe\",\n    ],\n    csrcs = [\n        \"lib.go\",\n        \"tensor.go\",\n    ],\n    swig_srcs = [\n    ],\n    cxxswig = [\n        \"tensorflow.swigcxx\",\n    ],\n    cflags = [\n        \"-I/Users/fmilo/workspace/gopath/src/github.com/tensorflow/tensorflow/tensorflow/contrib/go/../../../\",\n    ],\n    cxxflags = [\n        \"-I/Users/fmilo/workspace/gopath/src/github.com/tensorflow/tensorflow/tensorflow/contrib/go/../../../\",\n        \"-std=c++11\",\n    ],\n    cppflags = [\n    ],\n)\n\ngo_library\n\n(\n    \"tensorflow\",\n    srcs = [\n        \"allocation_description.pb.go\",\n        \"attr_value.pb.go\",\n        \"config.pb.go\",\n        \"cost_graph.pb.go\",\n        \"device_attributes.pb.go\",\n        \"event.pb.go\",\n        \"function.pb.go\",\n        \"graph.pb.go\",\n        \"kernel_def.pb.go\",\n        \"log_memory.pb.go\",\n        \"master.pb.go\",\n        \"memmapped_file_system.pb.go\",\n        \"meta_graph.pb.go\",\n        \"named_tensor.pb.go\",\n        \"op_def.pb.go\",\n        \"queue_runner.pb.go\",\n        \"saved_tensor_slice.pb.go\",\n        \"saver.pb.go\",\n        \"step_stats.pb.go\",\n        \"summary.pb.go\",\n        \"tensor.pb.go\",\n        \"tensor_description.pb.go\",\n        \"tensor_shape.pb.go\",\n        \"tensor_slice.pb.go\",\n        \"tensorflow_server.pb.go\",\n        \"test_log.pb.go\",\n        \"tf_ops_def.go\",\n        \"types.pb.go\",\n        \"variable.pb.go\",\n        \"versions.pb.go\",\n        \"worker.pb.go\",\n    ],\n    deps = [\n        \"fmt\",\n        \"github.com/golang/protobuf/proto\",\n        \"github.com/golang/protobuf/ptypes/any\",\n        \"math\",\n    ],\n    csrcs = [\n    ],\n    swig_srcs = [\n    ],\n    cxxswig = [\n    ],\n    cflags = [\n    ],\n    cxxflags = [\n    ],\n    cppflags = [\n    ],\n)\n\ngo_library\n\n(\n    \"tensorflow_error\",\n    srcs = [\n        \"error_codes.pb.go\",\n    ],\n    deps = [\n        \"fmt\",\n        \"github.com/golang/protobuf/proto\",\n        \"math\",\n    ],\n    csrcs = [\n    ],\n    swig_srcs = [\n    ],\n    cxxswig = [\n    ],\n    cflags = [\n    ],\n    cxxflags = [\n    ],\n    cppflags = [\n    ],\n)\n\ngo_library\n\n(\n    \"tensorflow_grpc\",\n    srcs = [\n        \"master_service.pb.go\",\n        \"worker_service.pb.go\",\n    ],\n    deps = [\n        \"fmt\",\n        \"github.com/golang/protobuf/proto\",\n        \"math\",\n        \"tensorflow/core/protobuf\",\n    ],\n    csrcs = [\n    ],\n    swig_srcs = [\n    ],\n    cxxswig = [\n    ],\n    cflags = [\n    ],\n    cxxflags = [\n    ],\n    cppflags = [\n    ],\n)\n</code></pre>\n\n<p>of course the above BUILD file does not work yet, but I want to make sure first that the approach that I am pursuing is valid.</p>\n\n<ul>\n<li>How can I specify a pre-BUILD phase in bazel ? </li>\n<li>is it possible? </li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1468436052, "last_edit_date": 1468436052, "creation_date": 1468430655, "answer_id": 38358096, "question_id": 38357842, "link": "https://stackoverflow.com/questions/38357842/empty-string-but-len-is-500-bytes-somehow/38358096#38358096", "title": "Empty string, but len is 500 bytes somehow", "body": "<p>The program is working with the entire <code>request</code>, not the portion filled in by <code>Read</code>. Change the line</p>\n\n<pre><code>    request_string := string(request)\n</code></pre>\n\n<p>to </p>\n\n<pre><code>    request_string := string(request[:read_len])\n</code></pre>\n\n<p>to fix this issue.</p>\n\n<p>A better fix is to use <a href=\"http://godoc.org/bufio#Scanner\" rel=\"nofollow\">bufio.Scanner</a> to scan for message terminators. </p>\n\n<pre><code>func scanTerminator(data []byte, atEOF bool) (advance int, token []byte, err error) {\n    if atEOF &amp;&amp; len(data) == 0 {\n       return 0, nil, nil\n    }\n    if i := bytes.Index(data, []byte(\"||\")); i &gt;= 0 {\n        return i + 2, data[:i], nil\n    }\n    if atEOF {\n        return len(data), data, nil\n    }\n    return 0, nil, nil\n}\n\nfunc main() {\n    ...\n    for {\n        conn, err := listener.Accept()\n        if err != nil {\n            // handle error\n        }\n\n        s := bufio.NewScanner(conn)\n        s.Split(scanTerminator)\n        for s.Scan() {\n           message := s.Text()\n           // process message\n        }\n        if s.Err() != nil {\n          // handle error\n        }\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1835, "user_id": 963319, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/1b950873c444db9f4ae35d86563b430b?s=128&d=identicon&r=PG", "display_name": "Jenia Ivanov", "link": "https://stackoverflow.com/users/963319/jenia-ivanov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 127, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468436052, "creation_date": 1468429777, "question_id": 38357842, "link": "https://stackoverflow.com/questions/38357842/empty-string-but-len-is-500-bytes-somehow", "title": "Empty string, but len is 500 bytes somehow", "body": "<p>I can't figure out why an empty string turns out to be 506 bytes long.</p>\n\n<p>So what happens is that I print a string to screen like this:</p>\n\n<p><code>fmt.Printf(\"The last element '%s'\\n\", messages[1])</code> </p>\n\n<p>and I get:</p>\n\n<p><code>The last element ''</code></p>\n\n<p>But then, when I print its length:</p>\n\n<p><code>fmt.Printf(\"The last element len is '%s'\\n\", len(messages[len(messages) - 1]))</code></p>\n\n<p>I get:</p>\n\n<pre><code>The last element len is '%!s(int=506)'\n</code></pre>\n\n<p>I don't get it. Does anyone know what is happening? </p>\n\n<p>I left the entire program here (it's pretty small). To pass input to this program just do:</p>\n\n<pre><code>printf \"asti||\"  | netcat localhost 7777\n</code></pre>\n\n<p>Here is the program itself:</p>\n\n<pre><code>package main\n\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"os\"\n    \"strings\"\n\n\n)\n\n\nfunc main() {\n\n    end_of_message_terminator := \"||\"\n    beginning_of_next_message := \"\"\n    request := make([]byte, 512)\n\n    service_port := \":7777\"\n    tcpAddr, err := net.ResolveTCPAddr(\"tcp4\", service_port)\n    checkError(err)\n    listener, err := net.ListenTCP(\"tcp\", tcpAddr)\n    checkError(err)\n\n\n\n\n    response_port := \":8887\"\n    tcpAddr_res, err := net.ResolveTCPAddr(\"tcp4\", response_port)\n    checkError(err)\n    response_writer, err := net.ListenTCP(\"tcp\", tcpAddr_res)\n\n\n\n\n    for {\n        conn, err := listener.Accept()\n\n        if err != nil {\n\n            continue\n\n        }\n\n        read_len, err := conn.Read(request)\n\n        if read_len == 0 {\n            continue\n        }\n\n        request_string := string(request)\n        fmt.Printf(\"Request String %s\\\\END\", request_string)\n\n        messages := strings.Split(request_string, end_of_message_terminator)\n        fmt.Printf(\"%q\\n\", messages)\n\n                messages[0] = beginning_of_next_message + messages[0]\n        fmt.Printf(\"%s\\n\", messages[0])\n        fmt.Printf(\"The last element '%s'\\n\", messages[1])\n        fmt.Printf(\"The last element '%s'\\n\", messages[len(messages) - 1])\n        fmt.Printf(\"The last element len is '%s'\\n\", len(messages[len(messages) - 1]))\n        fmt.Printf(\"The last element is equal to empty string? %s\\n\", messages[len(messages) - 1] == \"\")\n        if messages[len(messages) - 1] != \"\" {\n            beginning_of_next_message = messages[len(messages) - 1]\n            messages[len(messages) - 1] = \"\"\n            fmt.Printf(\"was here 00\\n\")\n        }\n\n        if len(messages) == 1 {\n            continue\n        }\n\n\n\n        conn.Close()\n\n    }\n\n}\n\n\n\n\n\nfunc checkError(err error) {\n\n    if err != nil {\n\n        fmt.Fprintf(os.Stderr, \"Fatal error: %s\", err.Error())\n        os.Exit(1)\n\n    }\n\n}\n</code></pre>\n"}, {"tags": ["memory", "go", "nullpointerexception", "runtime-error"], "comments": [{"owner": {"reputation": 157, "user_id": 3657748, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e58ffd59014cd6d78cd04fb22cfda72d?s=128&d=identicon&r=PG&f=1", "display_name": "Chaitanya Lala", "link": "https://stackoverflow.com/users/3657748/chaitanya-lala"}, "edited": false, "score": 1, "creation_date": 1468431325, "post_id": 38357694, "comment_id": 64128816, "body": "Please paste your code and explain the debugging steps you did..."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1468432405, "post_id": 38357694, "comment_id": 64129457, "body": "Handle the error returned from <code>loadPage</code>."}], "owner": {"reputation": 3199, "user_id": 2828227, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/CEPMO.jpg?s=128&g=1", "display_name": "Casper", "link": "https://stackoverflow.com/users/2828227/casper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 363, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468429592, "creation_date": 1468429231, "last_edit_date": 1468429592, "question_id": 38357694, "link": "https://stackoverflow.com/questions/38357694/encountering-runtime-error-invalid-memory-address-or-nil-pointer-dereference", "title": "Encountering Runtime Error : invalid memory address or nil pointer dereference", "body": "<p>I tried to follow the <a href=\"https://golang.org/doc/articles/wiki/\" rel=\"nofollow noreferrer\">tutorial</a> from the official website. In <code>Using net/http to serve wiki pages</code> section, I directly copy the code at <a href=\"https://golang.org/doc/articles/wiki/part2.go?m=text\" rel=\"nofollow noreferrer\">Click here to view the code we've written so far</a> but I cannot access <a href=\"http://localhost:8080/view/test\" rel=\"nofollow noreferrer\">http://localhost:8080/view/test</a> and get the following.</p>\n\n<p><a href=\"https://i.stack.imgur.com/Xp48j.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Xp48j.png\" alt=\"enter image description here\"></a></p>\n\n<p>Since I use LiteIDE, I can see the following things appeared.</p>\n\n<pre><code>Killing current process...\nError: process crashed or was terminated while running.\nF:/Go/bin/go.exe build -i [E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server]\nSuccess: process exited with code 0.\nE:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server/server.exe  [E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server]\n2016/07/14 00:49:14 http: panic serving [::1]:65281: runtime error: invalid memory address or nil pointer dereference\ngoroutine 5 [running]:\nnet/http.(*conn).serve.func1(0xc08200a300)\n    F:/Go/src/net/http/server.go:1389 +0xc8\npanic(0x711700, 0xc0820060f0)\n    F:/Go/src/runtime/panic.go:443 +0x4f7\nmain.viewHandler(0xea0058, 0xc0820be000, 0xc0820a81c0)\n    E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server/main.go:35 +0x241\nnet/http.HandlerFunc.ServeHTTP(0x80b890, 0xea0058, 0xc0820be000, 0xc0820a81c0)\n    F:/Go/src/net/http/server.go:1618 +0x41\nnet/http.(*ServeMux).ServeHTTP(0xc082050870, 0xea0058, 0xc0820be000, 0xc0820a81c0)\n    F:/Go/src/net/http/server.go:1910 +0x184\nnet/http.serverHandler.ServeHTTP(0xc08200a280, 0xea0058, 0xc0820be000, 0xc0820a81c0)\n    F:/Go/src/net/http/server.go:2081 +0x1a5\nnet/http.(*conn).serve(0xc08200a300)\n    F:/Go/src/net/http/server.go:1472 +0xf35\ncreated by net/http.(*Server).Serve\n    F:/Go/src/net/http/server.go:2137 +0x455\n2016/07/14 00:49:14 http: panic serving [::1]:65282: runtime error: invalid memory address or nil pointer dereference\ngoroutine 17 [running]:\nnet/http.(*conn).serve.func1(0xc0820ae100)\n    F:/Go/src/net/http/server.go:1389 +0xc8\npanic(0x711700, 0xc0820060f0)\n    F:/Go/src/runtime/panic.go:443 +0x4f7\nmain.viewHandler(0xea0058, 0xc0820be1a0, 0xc0820e20e0)\n    E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server/main.go:35 +0x241\nnet/http.HandlerFunc.ServeHTTP(0x80b890, 0xea0058, 0xc0820be1a0, 0xc0820e20e0)\n    F:/Go/src/net/http/server.go:1618 +0x41\nnet/http.(*ServeMux).ServeHTTP(0xc082050870, 0xea0058, 0xc0820be1a0, 0xc0820e20e0)\n    F:/Go/src/net/http/server.go:1910 +0x184\nnet/http.serverHandler.ServeHTTP(0xc08200a280, 0xea0058, 0xc0820be1a0, 0xc0820e20e0)\n    F:/Go/src/net/http/server.go:2081 +0x1a5\nnet/http.(*conn).serve(0xc0820ae100)\n    F:/Go/src/net/http/server.go:1472 +0xf35\ncreated by net/http.(*Server).Serve\n    F:/Go/src/net/http/server.go:2137 +0x455\n2016/07/14 00:50:30 http: panic serving [::1]:65288: runtime error: invalid memory address or nil pointer dereference\ngoroutine 6 [running]:\nnet/http.(*conn).serve.func1(0xc08200a380)\n    F:/Go/src/net/http/server.go:1389 +0xc8\npanic(0x711700, 0xc0820060f0)\n    F:/Go/src/runtime/panic.go:443 +0x4f7\nmain.viewHandler(0xea0058, 0xc0820be270, 0xc0820a8380)\n    E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server/main.go:35 +0x241\nnet/http.HandlerFunc.ServeHTTP(0x80b890, 0xea0058, 0xc0820be270, 0xc0820a8380)\n    F:/Go/src/net/http/server.go:1618 +0x41\nnet/http.(*ServeMux).ServeHTTP(0xc082050870, 0xea0058, 0xc0820be270, 0xc0820a8380)\n    F:/Go/src/net/http/server.go:1910 +0x184\nnet/http.serverHandler.ServeHTTP(0xc08200a280, 0xea0058, 0xc0820be270, 0xc0820a8380)\n    F:/Go/src/net/http/server.go:2081 +0x1a5\nnet/http.(*conn).serve(0xc08200a380)\n    F:/Go/src/net/http/server.go:1472 +0xf35\ncreated by net/http.(*Server).Serve\n    F:/Go/src/net/http/server.go:2137 +0x455\n2016/07/14 00:50:30 http: panic serving [::1]:65289: runtime error: invalid memory address or nil pointer dereference\ngoroutine 18 [running]:\nnet/http.(*conn).serve.func1(0xc0820ae280)\n    F:/Go/src/net/http/server.go:1389 +0xc8\npanic(0x711700, 0xc0820060f0)\n    F:/Go/src/runtime/panic.go:443 +0x4f7\nmain.viewHandler(0xea0058, 0xc0820be340, 0xc0820e22a0)\n    E:/Users/User/Desktop/New folder (36)/codespace_v2.6/codespace/dev/server_side/golang/go_codespace_v2.0/server/main.go:35 +0x241\nnet/http.HandlerFunc.ServeHTTP(0x80b890, 0xea0058, 0xc0820be340, 0xc0820e22a0)\n    F:/Go/src/net/http/server.go:1618 +0x41\nnet/http.(*ServeMux).ServeHTTP(0xc082050870, 0xea0058, 0xc0820be340, 0xc0820e22a0)\n    F:/Go/src/net/http/server.go:1910 +0x184\nnet/http.serverHandler.ServeHTTP(0xc08200a280, 0xea0058, 0xc0820be340, 0xc0820e22a0)\n    F:/Go/src/net/http/server.go:2081 +0x1a5\nnet/http.(*conn).serve(0xc0820ae280)\n    F:/Go/src/net/http/server.go:1472 +0xf35\ncreated by net/http.(*Server).Serve\n    F:/Go/src/net/http/server.go:2137 +0x455\n</code></pre>\n\n<p>I have tried to use CMD to build the go program but I still get the same result. It keeps saying <code>invalid memory address or nil pointer dereference</code>. How to solve this problem?</p>\n"}, {"tags": ["memory-management", "go"], "comments": [{"owner": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 0, "creation_date": 1468428191, "post_id": 38356480, "comment_id": 64126962, "body": "Not trying to be snarky, but you can always read the <a href=\"https://golang.org/src/bytes/buffer.go?s=402:854#L7\" rel=\"nofollow noreferrer\">source</a> too."}, {"owner": {"reputation": 2005, "user_id": 910553, "user_type": "registered", "accept_rate": 63, "profile_image": "https://graph.facebook.com/9101644/picture?type=large", "display_name": "Scott Frazer", "link": "https://stackoverflow.com/users/910553/scott-frazer"}, "reply_to_user": {"reputation": 28990, "user_id": 1114966, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af8712b05e5cfb862323a07c83749054?s=128&d=identicon&r=PG", "display_name": "squiguy", "link": "https://stackoverflow.com/users/1114966/squiguy"}, "edited": false, "score": 1, "creation_date": 1468435147, "post_id": 38356480, "comment_id": 64131148, "body": "You&#39;re right, and Go&#39;s source code is actually <i>very</i> readable :)"}], "answers": [{"comments": [{"owner": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 1, "creation_date": 1468429056, "post_id": 38356703, "comment_id": 64127453, "body": "Re: &quot;performs linearly&quot;... Linear complexity is O(n).  The buffer expansion method of doubling the capacity produces amortized constant time complexity or O(1).  Nominally, an insert operation runs in O(1) with occasional expansions costing O(n).  The amortized cost becomes O(1)."}, {"owner": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468429333, "post_id": 38356703, "comment_id": 64127613, "body": "Also, be aware that the expansion method is actual twice the current capacity <i><b>plus</b></i> the size of the desired growth (length of string being inserted).  Inserting 500 bytes into an empty buffer allocates 500 bytes.  Inserting 500 bytes into a buffer that currently has 100000 bytes allocates 200500 bytes.  For a long running, logging application like the OP suggests, this might lead to a panic if the buffer is not being drained."}, {"owner": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468429614, "post_id": 38356703, "comment_id": 64127780, "body": "Also, be aware of the small buffer optimization that exists.  there is a static buffer (64 bytes?) that is part of the bytes type.  This buffer is used until exhausted.   A single allocation of a bytes instance allocates 64 bytes storage at the same time."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468430140, "post_id": 38356703, "comment_id": 64128128, "body": "Noted. Implementation details can be found here. They are pretty straight forward: <a href=\"https://github.com/golang/go/blob/master/src/bytes/buffer.go#L87\" rel=\"nofollow noreferrer\">github.com/golang/go/blob/master/src/bytes/buffer.go#L87</a>"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 1, "last_activity_date": 1468429167, "last_edit_date": 1468429167, "creation_date": 1468426009, "answer_id": 38356703, "question_id": 38356480, "link": "https://stackoverflow.com/questions/38356480/does-bytes-buffer-perform-a-lot-of-reallocs/38356703#38356703", "title": "Does bytes.Buffer perform a lot of reallocs?", "body": "<p>This would be the standard way to write to a bytes buffer.</p>\n\n<p><code>bytes.Buffer</code> type grows similar to slices. So a buffer, which is a byte slice internally, doubles each time the data going into it exceeds the current byte slice's capacity. Then the data from old slice is copied over to this new slice after which new data is appended to it.</p>\n\n<p>This algorithm on average performs in constant time (amortized), so there is no major performance penalty.</p>\n"}], "owner": {"reputation": 2005, "user_id": 910553, "user_type": "registered", "accept_rate": 63, "profile_image": "https://graph.facebook.com/9101644/picture?type=large", "display_name": "Scott Frazer", "link": "https://stackoverflow.com/users/910553/scott-frazer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 109, "favorite_count": 0, "accepted_answer_id": 38356703, "answer_count": 1, "score": 0, "last_activity_date": 1468429167, "creation_date": 1468425304, "question_id": 38356480, "link": "https://stackoverflow.com/questions/38356480/does-bytes-buffer-perform-a-lot-of-reallocs", "title": "Does bytes.Buffer perform a lot of reallocs?", "body": "<p>What I'm trying to do is have a <code>io.MultiWriter</code> that writes to a stdout and to a byte buffer.  Something like this:</p>\n\n<pre><code>package main\n\nimport \"bytes\"\nimport \"fmt\"\nimport \"io\"\nimport \"os\"\n\nfunc main() {\n    var b bytes.Buffer\n    multi := io.MultiWriter(&amp;b, os.Stdout)\n    fmt.Fprintf(multi, \"each of these strings\\n\")\n    fmt.Fprintf(multi, \"might be large\\n\")\n    fmt.Fprintf(multi, \"and there are many of them\\n\")\n    fmt.Println(b.String())\n}\n</code></pre>\n\n<p>What I'm wondering is if I'm shooting myself in the foot by doing this?  Does this re-alloc the array for every insert into it? and if so, perhaps there is a better way?  Am I prematurely optimizing?</p>\n"}, {"tags": ["sql", "oracle", "stored-procedures", "go"], "comments": [{"owner": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468425870, "post_id": 38354000, "comment_id": 64125571, "body": "What SQL type is being returned to Go?  (I know the answer.) How do you handle this type in Go?  What type does <code>Select 1,2,3;</code> return?"}, {"owner": {"reputation": 185, "user_id": 4944691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3885bb78d941bec3416a35e83f4861f5?s=128&d=identicon&r=PG", "display_name": "Keir", "link": "https://stackoverflow.com/users/4944691/keir"}, "reply_to_user": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468478963, "post_id": 38354000, "comment_id": 64145939, "body": "Well, it doesn<code>t matter in this case. Let it be sql.NullInt64. But I can replace NUBER with VARCHAR2, and use string in Go. I</code>m just intereting - how can I bind go variables to oracle variables."}, {"owner": {"reputation": 750, "user_id": 1212565, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b0cc2208baa8138cdb6fc898bd298500?s=128&d=identicon&r=PG", "display_name": "David Thomas", "link": "https://stackoverflow.com/users/1212565/david-thomas"}, "edited": false, "score": 0, "creation_date": 1468506029, "post_id": 38354000, "comment_id": 64163584, "body": "The SQL type returned is a RECORD. How would you bind to the returned record of <code>SELECT &#39;a&#39;, 3 LIMIT 1;</code>?"}], "owner": {"reputation": 185, "user_id": 4944691, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3885bb78d941bec3416a35e83f4861f5?s=128&d=identicon&r=PG", "display_name": "Keir", "link": "https://stackoverflow.com/users/4944691/keir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 782, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468418823, "creation_date": 1468418823, "question_id": 38354000, "link": "https://stackoverflow.com/questions/38354000/golang-sql-how-to-handle-procedure-out-params", "title": "Golang sql - how to handle Procedure OUT params", "body": "<p>I have an oracle procedure, which i call like that:</p>\n\n<pre><code>DECLARE\n  ID       NUMBER := 12345;\n  Var1     NUMBER := NULL;\n  Var2     NUMBER := NULL;\nBEGIN\n  PKG_A.GET_ACCOUNT_VALUES(\n    ACCOUNT_ID     =&gt; ID,\n    SOMEVALUE1     =&gt; Var1,\n    SOMEVALUE2     =&gt; Var2\n  );\nEND;\n</code></pre>\n\n<p>ID param is IN/OUT, Var1 and Var2 - OUT.</p>\n\n<p>It's an external system, I can`t change this procedure.\nHow can I get this three values with the help of database/sql library (oci8 driver)?\nCan I bind somehow, to this Params, or maybe get them with DBMS_OUTPUT some way.\nThanks for your help.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 83, "user_id": 5713466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d656dc836c338d736124b2c83861dab?s=128&d=identicon&r=PG&f=1", "display_name": "FreeApe", "link": "https://stackoverflow.com/users/5713466/freeape"}, "is_accepted": false, "score": -2, "last_activity_date": 1468415664, "last_edit_date": 1468415664, "creation_date": 1468412801, "answer_id": 38351718, "question_id": 38351486, "link": "https://stackoverflow.com/questions/38351486/golangcgo-not-determine-kind-of-name-for-c-quit/38351718#38351718", "title": "golang(cgo) --- not determine kind of name for C.quit", "body": "<p><strong>I used the function 'quit' (A careless mistake), but there isnot the function in C code.</strong> </p>\n"}], "owner": {"reputation": 83, "user_id": 5713466, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d656dc836c338d736124b2c83861dab?s=128&d=identicon&r=PG&f=1", "display_name": "FreeApe", "link": "https://stackoverflow.com/users/5713466/freeape"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 783, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1468415664, "creation_date": 1468412147, "question_id": 38351486, "link": "https://stackoverflow.com/questions/38351486/golangcgo-not-determine-kind-of-name-for-c-quit", "title": "golang(cgo) --- not determine kind of name for C.quit", "body": "<p>There is not any <code>errors</code>,but the \"not determine kind of name for C.quit\"</p>\n\n<p>I linked the shared library with #cgo LDFLAGS  in my project. What are the possible reasons? </p>\n"}, {"tags": ["go", "compilation", "tags"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468417537, "post_id": 38350360, "comment_id": 64119281, "body": "Can you post a few examples where you found these?"}, {"owner": {"reputation": 327, "user_id": 4549287, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a31748d17948cce3da5972f46ab40613?s=128&d=identicon&r=PG&f=1", "display_name": "darthfather", "link": "https://stackoverflow.com/users/4549287/darthfather"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468419591, "post_id": 38350360, "comment_id": 64120870, "body": "For example here: <a href=\"https://github.com/adonovan/gopl.io/blob/master/ch7/bytecounter/main.go\" rel=\"nofollow noreferrer\">github.com/adonovan/gopl.io/blob/master/ch7/bytecounter/main&zwnj;&#8203;.go</a>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1468420166, "post_id": 38350360, "comment_id": 64121359, "body": "These aren&#39;t part of the language or build chain. Most likely its for some type of display markup"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1468420213, "post_id": 38350360, "comment_id": 64121397, "body": "The example you posted is not handled by the standard go tools. They are most likely inserted by a generator for debugging purposes, or they are intended for an automatic processor tool which may use these when generating documentation or some other output. They are not standard."}], "answers": [{"comments": [{"owner": {"reputation": 1012, "user_id": 5160450, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/b9XUM.jpg?s=128&g=1", "display_name": "Francesco Dondi", "link": "https://stackoverflow.com/users/5160450/francesco-dondi"}, "edited": false, "score": 0, "creation_date": 1468486039, "post_id": 38352210, "comment_id": 64150061, "body": "It&#39;s not the correct answer, but it does look like it, and it is interesting."}], "tags": [], "owner": {"reputation": 1700, "user_id": 5674583, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/8WOaR.png?s=128&g=1", "display_name": "Blue Bot", "link": "https://stackoverflow.com/users/5674583/blue-bot"}, "is_accepted": false, "score": 0, "last_activity_date": 1468414093, "creation_date": 1468414093, "answer_id": 38352210, "question_id": 38350360, "link": "https://stackoverflow.com/questions/38350360/what-are-these-tags-in-golang/38352210#38352210", "title": "What are these //!+ //!- tags in golang?", "body": "<p>This looks like conditional compilation, it means that you can choose what sections to build when you build for multi platform, for example you can \nstate:</p>\n\n<pre><code>// +build windows\n</code></pre>\n\n<p>for windows and etc\nyou can find more information about it and the full list here:</p>\n\n<p><a href=\"http://blog.ralch.com/tutorial/golang-conditional-compilation/\" rel=\"nofollow\">http://blog.ralch.com</a></p>\n\n<p>also take a look at the build go package:</p>\n\n<p><a href=\"https://golang.org/pkg/go/build/\" rel=\"nofollow\">https://golang.org/pkg/go/build/</a></p>\n"}, {"tags": [], "owner": {"reputation": 397892, "user_id": 95592, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/utY5u.jpg?s=128&g=1", "display_name": "Matthew Rankin", "link": "https://stackoverflow.com/users/95592/matthew-rankin"}, "is_accepted": true, "score": 3, "last_activity_date": 1468421632, "last_edit_date": 1468421632, "creation_date": 1468421243, "answer_id": 38354969, "question_id": 38350360, "link": "https://stackoverflow.com/questions/38350360/what-are-these-tags-in-golang/38354969#38354969", "title": "What are these //!+ //!- tags in golang?", "body": "<p>No, those comments don't mean something to the Go compiler. As stated in the <a href=\"https://github.com/adonovan/gopl.io\" rel=\"nofollow\">gopl.io</a> project's <code>README.md</code>:</p>\n\n<blockquote>\n  <p>Many of the programs contain comments of the form //!+ and //!-. These comments bracket the parts of the programs that are excerpted in the book; you can safely ignore them. In a few cases, programs have been reformatted in an unnatural way so that they can be presented in stages in the book.</p>\n</blockquote>\n\n<p>For instance all code between the two snippets <code>//!+bytecounter</code> and <code>//!-bytecounter</code> are in the <code>gopl.io/ch7/bytecounter</code> snippet shown on p. 173 of the book.</p>\n"}, {"tags": [], "owner": {"reputation": 850, "user_id": 5723127, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/XCD9w.png?s=128&g=1", "display_name": "Wesam", "link": "https://stackoverflow.com/users/5723127/wesam"}, "is_accepted": false, "score": 0, "last_activity_date": 1468422161, "creation_date": 1468422161, "answer_id": 38355357, "question_id": 38350360, "link": "https://stackoverflow.com/questions/38350360/what-are-these-tags-in-golang/38355357#38355357", "title": "What are these //!+ //!- tags in golang?", "body": "<p>wont be compiled on run time , i think it still considered as a comment </p>\n"}], "owner": {"reputation": 327, "user_id": 4549287, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/a31748d17948cce3da5972f46ab40613?s=128&d=identicon&r=PG&f=1", "display_name": "darthfather", "link": "https://stackoverflow.com/users/4549287/darthfather"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 123, "favorite_count": 0, "accepted_answer_id": 38354969, "answer_count": 3, "score": 2, "last_activity_date": 1468422161, "creation_date": 1468409100, "last_edit_date": 1468421422, "question_id": 38350360, "link": "https://stackoverflow.com/questions/38350360/what-are-these-tags-in-golang", "title": "What are these //!+ //!- tags in golang?", "body": "<p>I am reading <a href=\"http://www.informit.com/store/go-programming-language-9780134190587\" rel=\"nofollow\">The Go Programming Language</a>, and while browsing the source code I find certain tags, like:</p>\n\n<pre><code>//!+\n//!-\n</code></pre>\n\n<p>or </p>\n\n<pre><code>//!+main\n//!-main\n</code></pre>\n\n<p>Do they mean something to the compiler? </p>\n"}, {"tags": ["arrays", "string", "go"], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user6583848"}, "edited": false, "score": 0, "creation_date": 1468410375, "post_id": 38350677, "comment_id": 64113995, "body": "thank you but I need to access other than Nodes element so how can I map them in a map for example I need to access Nodes,Status ,Containers ..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468410680, "post_id": 38350677, "comment_id": 64114209, "body": "@saidsaifi Please see edited answer, conversion to map has been included."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6583848"}, "edited": false, "score": 0, "creation_date": 1468410769, "post_id": 38350677, "comment_id": 64114257, "body": "Thankyou I upvoted and accepted your answer but I still did not reach 15 reputations"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6583848"}, "edited": false, "score": 0, "creation_date": 1468414191, "post_id": 38350677, "comment_id": 64116717, "body": "how can i get status of each node and all of them are elements of systemstatus for example SystemStatus{[&quot;Nodes&quot;,&quot;2&quot;],[&quot;Node1&quot;,&quot;10.0.1.1&quot;],[&quot;Status&quot;,&quot;H&zwnj;&#8203;ealthy&quot;],[&quot;Node2&quot;,&quot;1&zwnj;&#8203;0.0.1.2&quot; ],[&quot;Status&quot;,&quot;Pending&quot;]}... there are 9 attributes for each Node and they all are under SystemStatus I could access it by indexing but i should find another way"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468415367, "post_id": 38350677, "comment_id": 64117588, "body": "@saidsaifi In this case I recommend you the first solution using a <code>for</code> loop. Once you find the node your looking for, subsequent elements will be what you&#39;re looking for. Modify the loop to also return the index for you to use, e.g. <code>for i, v := range dockerinfo.SystemStatus {}</code>"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1468410276, "last_edit_date": 1468410276, "creation_date": 1468409895, "answer_id": 38350677, "question_id": 38350108, "link": "https://stackoverflow.com/questions/38350108/how-to-convert-2string-to-mapstring-string-in-go/38350677#38350677", "title": "How to convert [ ][2]string to map[string] string in go?", "body": "<p>Use a simple <code>for</code> loop to iterate over the values of the <code>dockerinfo.SystemStatus</code> slice, and compare the first value to <code>\"Nodes\"</code>:</p>\n\n<pre><code>for _, v := range dockerinfo.SystemStatus {\n    if v[0] == \"Nodes\" {\n        // Got it!\n        value := v[1] // This will be \"6\" in your example\n        fmt.Println(\"Nodes value:\", value)\n        break\n    }\n}\n</code></pre>\n\n<p>This <code>value</code> will be of type <code>string</code> but it looks it holds a numerical data. If you want it as an <code>int</code> for example, you may use <a href=\"https://golang.org/pkg/strconv/#Atoi\" rel=\"nofollow\"><code>strconv.Atoi()</code></a> to parse the number:</p>\n\n<pre><code>value := v[1]\nif n, err := strconv.Atoi(value); err == nil {\n    // n is of type int, use it like so\n} else {\n    // Not a number!\n}\n</code></pre>\n\n<p>If you have to lookup values many times, it may be profitable to build a map from it. This is how you could do it:</p>\n\n<pre><code>ssmap := map[string]string{}\nfor _, v := range dockerinfo.SystemStatus {\n    ssmap[v[0]] = v[1]\n}\n\n// And then you can do simple lookup:\nif nodes, ok := ssmap[\"Nodes\"]; ok {\n    fmt.Println(\"Nodes value:\", nodes)\n} else {\n    // Nodes not found!\n}\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user6583848"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 54, "favorite_count": 1, "accepted_answer_id": 38350677, "answer_count": 1, "score": 2, "last_activity_date": 1468427354, "creation_date": 1468408449, "last_edit_date": 1468427354, "question_id": 38350108, "link": "https://stackoverflow.com/questions/38350108/how-to-convert-2string-to-mapstring-string-in-go", "title": "How to convert [ ][2]string to map[string] string in go?", "body": "<p>I am retrieving an object called <a href=\"https://godoc.org/github.com/fsouza/go-dockerclient#DockerInfo\" rel=\"nofollow\"><code>DockerInfo</code></a> which has a field inside it called <code>SystemStatus</code> which is <code>[][2]string</code>, then in order to access the elements inside <code>SystemStatus</code> I am doing this, for example if the 4th element in <code>SystemStatus</code> is <code>[\"Nodes\",\"6\"]</code> then to access the number <code>6</code></p>\n\n<pre><code>dockerinfo.SystemStatus[3][1]\n</code></pre>\n\n<p>But the <code>Nodes</code> elements are not fixed in 4th position always so I can not use indexing and instead I want to find number of nodes by for example writing </p>\n\n<pre><code>dockerinfo.SystemStatus[\"Nodes\"] \n</code></pre>\n\n<p>How can I do that? Or how to transform the <code>SystemStatus</code> to <code>map[string]string</code> format?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2779, "user_id": 2500806, "user_type": "registered", "accept_rate": 65, "profile_image": "https://i.stack.imgur.com/RZjRl.jpg?s=128&g=1", "display_name": "Khamidulla", "link": "https://stackoverflow.com/users/2500806/khamidulla"}, "edited": false, "score": 1, "creation_date": 1468400219, "post_id": 38346956, "comment_id": 64107143, "body": "What you did so far? Can you show some code?"}, {"owner": {"reputation": 3137, "user_id": 2525941, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2e687ea39a9115c22147d1aaed68a888?s=128&d=identicon&r=PG", "display_name": "Danilo", "link": "https://stackoverflow.com/users/2525941/danilo"}, "edited": false, "score": 1, "creation_date": 1468403737, "post_id": 38346956, "comment_id": 64109549, "body": "as a side note: you have a spelling mistake in your content-type."}, {"owner": {"reputation": 882, "user_id": 3984522, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/6D9an.jpg?s=128&g=1", "display_name": "hsrv", "link": "https://stackoverflow.com/users/3984522/hsrv"}, "edited": false, "score": 0, "creation_date": 1468407414, "post_id": 38346956, "comment_id": 64111929, "body": "15 seconds could be okay if your users use default connection timeouts (<a href=\"http://stackoverflow.com/questions/13582409/http-client-timeout-and-server-timeout\" title=\"http client timeout and server timeout\">stackoverflow.com/questions/13582409/&hellip;</a>); but as I see you use jQuery, so you could just make callback later when the work will be done on the server"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1468419265, "post_id": 38346956, "comment_id": 64120619, "body": "What is the return type from compressFiles? What is zipPath?"}, {"owner": {"reputation": 911, "user_id": 4728636, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/yQ2Rl.jpg?s=128&g=1", "display_name": "anonrose", "link": "https://stackoverflow.com/users/4728636/anonrose"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1468423860, "post_id": 38346956, "comment_id": 64124166, "body": "@XyMcXface zippedFile is the name of the zipped file, and zipPath is the path to the file."}, {"owner": {"reputation": 818, "user_id": 5292835, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/61f2a5019f9a977706135c3f8246bba1?s=128&d=identicon&r=PG&f=1", "display_name": "mrd0ll4r", "link": "https://stackoverflow.com/users/5292835/mrd0ll4r"}, "edited": false, "score": 0, "creation_date": 1468428835, "post_id": 38346956, "comment_id": 64127332, "body": "Have you tried just sending the headers first?"}], "owner": {"reputation": 911, "user_id": 4728636, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/yQ2Rl.jpg?s=128&g=1", "display_name": "anonrose", "link": "https://stackoverflow.com/users/4728636/anonrose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 92, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1468400473, "creation_date": 1468400051, "last_edit_date": 1468400473, "question_id": 38346956, "link": "https://stackoverflow.com/questions/38346956/serving-a-file-to-a-user-to-download", "title": "Serving a file to a user to download", "body": "<p>I am writing a program that scrapes assets from a site(images &amp; text), which will require the user to input which URL they would like to gather assets from. I then collect them all and zip all of them into a single file. I would like to then serve this zipped file to the user however I feel like the time to gather and zip the file is causing me to lose my connection to the user(10-15 seconds). Is there any way I can keep the connection to the user alive if this is my issue?</p>\n\n<pre><code>//Jquery post:\n$.post( \"GatherContent\", { structure: userSelection, url: userURL } );\n\n//lots of golang code server side to find all assets and compile them\n\nzippedFile := compressfiles(directory)\n\nw.Header().Set(\"Content-Type\", \"applicaiton/zip\")\nw.Header().Set(\"Content-Disposition\", \"attachment; filename='\"+zippedFile+\"'\")\nfmt.Println(zippedFile, zipPath)\nhttp.ServeFile(w, r, zippedFile)\n</code></pre>\n"}, {"tags": ["go", "cgo"], "answers": [{"tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": false, "score": 2, "last_activity_date": 1468435967, "last_edit_date": 1495535349, "creation_date": 1468394314, "answer_id": 38345040, "question_id": 38343414, "link": "https://stackoverflow.com/questions/38343414/how-do-i-set-errno-from-go/38345040#38345040", "title": "How do I set errno from Go", "body": "<p>You can't refer directly to errno from go, see <a href=\"https://github.com/golang/go/issues/1360\" rel=\"nofollow noreferrer\">cgo doesn't like errno on Linux</a>. From that thread:</p>\n\n<blockquote>\n  <p>I don't know what's wrong, but it doesn't matter since that's not a\n  safe use of errno anyway.  Every call into  C might happen in a\n  different OS thread, which means that referring to errno directly is\n  not guaranteed to get the value you want.</p>\n</blockquote>\n\n<p>As of <a href=\"https://groups.google.com/forum/#!topic/golang-dev/pOmTeW_hZ8M\" rel=\"nofollow noreferrer\">3880041</a> attempts to refer to <code>C.errno</code> will elicit an error message:</p>\n\n<pre><code>cannot refer to errno directly; see documentation\n</code></pre>\n\n<hr>\n\n<p>As <a href=\"https://stackoverflow.com/a/38358903/714501\">pointed out in another answer</a>, setting it from a C function works.</p>\n"}, {"tags": [], "owner": {"reputation": 389, "user_id": 3385070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pU0nE.jpg?s=128&g=1", "display_name": "tez", "link": "https://stackoverflow.com/users/3385070/tez"}, "is_accepted": true, "score": 3, "last_activity_date": 1473279303, "last_edit_date": 1473279303, "creation_date": 1468433355, "answer_id": 38358903, "question_id": 38343414, "link": "https://stackoverflow.com/questions/38343414/how-do-i-set-errno-from-go/38358903#38358903", "title": "How do I set errno from Go", "body": "<p>Just to clarify, you can still set it via C-function that you call via cgo.</p>\n\n<pre><code>package main\n\n// #include &lt;errno.h&gt;\n// #include &lt;stdio.h&gt;\n//\n// void setErrno(int err) {\n//      errno = err;\n// }\n//\nimport \"C\"\n\nfunc main() {\n        C.setErrno(C.EACCES)\n        C.perror(C.CString(\"error detected\"))\n        C.setErrno(C.EDOM)\n        C.perror(C.CString(\"error detected\"))\n        C.setErrno(C.ERANGE)\n        C.perror(C.CString(\"error detected\"))\n}\n</code></pre>\n\n<p>On my system it outputs</p>\n\n<pre><code>error detected: Permission denied\nerror detected: Numerical argument out of domain\nerror detected: Numerical result out of range\n</code></pre>\n"}], "owner": {"reputation": 1579, "user_id": 1354514, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/e83e6f559891e7489995dfa43e010fa3?s=128&d=identicon&r=PG", "display_name": "steve landiss", "link": "https://stackoverflow.com/users/1354514/steve-landiss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 798, "favorite_count": 0, "accepted_answer_id": 38358903, "answer_count": 2, "score": 2, "last_activity_date": 1473279303, "creation_date": 1468388288, "question_id": 38343414, "link": "https://stackoverflow.com/questions/38343414/how-do-i-set-errno-from-go", "title": "How do I set errno from Go", "body": "<p>I have a C function calling a Go routine via cgo.  I need to Go routine to set the errno correctly so the C thread can inspect it's errno and act accordingly.  Unable to google on how to set the errno via Go</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1468382110, "creation_date": 1468382110, "answer_id": 38342409, "question_id": 38342365, "link": "https://stackoverflow.com/questions/38342365/matching-structure-to-mgo-result/38342409#38342409", "title": "Matching structure to mgo result", "body": "<p>By default, the bson codec uses the lowercased field name as the key. Use the field tag to specify a different key:</p>\n\n<pre><code>type City struct {\n    ID bson.ObjectId `bson:\"_id,omitempty\"`\n    Name string\n    InitialDiseaseColouring string `bson:\"initialDiseaseColouring\"`\n}\n</code></pre>\n\n<p>The addition of the field tag changes the key from \"initialdiseasecolouring\" to \"initialDiseaseColouring\".</p>\n"}], "owner": {"reputation": 270, "user_id": 4885131, "user_type": "registered", "accept_rate": 60, "profile_image": "https://lh3.googleusercontent.com/-RI3vHUxroiY/AAAAAAAAAAI/AAAAAAAAAC0/J3RxzWh-4Ys/photo.jpg?sz=128", "display_name": "AlwaysNull", "link": "https://stackoverflow.com/users/4885131/alwaysnull"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 38342409, "answer_count": 1, "score": 0, "last_activity_date": 1468382110, "creation_date": 1468381776, "question_id": 38342365, "link": "https://stackoverflow.com/questions/38342365/matching-structure-to-mgo-result", "title": "Matching structure to mgo result", "body": "<p>I have the following document in my local mongodb:</p>\n\n<pre><code>_id 25dd9d29-efd5-4b4e-8af0-360c49fdba31\nname Reykjavik\ninitialDiseaseColouring blue\n</code></pre>\n\n<p>In my code I set up a city structure as the following:</p>\n\n<pre><code>type City struct {\n    ID bson.ObjectId `bson:\"_id,omitempty\"`\n    Name string\n    InitialDiseaseColouring string\n}\n</code></pre>\n\n<p>I'm querying it using</p>\n\n<pre><code>result := City{}\ncollection.Find(bson.M{\"name\":\"Reykjavik\"}).One(&amp;result)\n</code></pre>\n\n<p>When I try to access the <code>initialDiseaseColouring</code> attribute it's not there</p>\n\n<p>This is result when I print it:</p>\n\n<p><code>{ObjectIdHex(\"32356464396432392d656664352d346234652d386166302d333630633439666462613331\") Reykjavik }</code></p>\n\n<p>Does anyone know why?</p>\n\n<p>I was following the example on <a href=\"https://gist.github.com/border/3489566\" rel=\"nofollow\">https://gist.github.com/border/3489566</a></p>\n"}, {"tags": ["json", "parsing", "go"], "comments": [{"owner": {"reputation": 417, "user_id": 3049386, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/754afefdb87c446066459a9857d9a0cf?s=128&d=identicon&r=PG&f=1", "display_name": "Bestbug", "link": "https://stackoverflow.com/users/3049386/bestbug"}, "edited": false, "score": 0, "creation_date": 1468403099, "post_id": 38340990, "comment_id": 64109127, "body": "what&#39;s inside consul, docker and maltl-api?"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1468385973, "last_edit_date": 1468385973, "creation_date": 1468375053, "answer_id": 38341472, "question_id": 38340990, "link": "https://stackoverflow.com/questions/38340990/how-can-i-parse-the-following-json-structure-in-go/38341472#38341472", "title": "How can I parse the following JSON structure in Go", "body": "<p>Unmarshal the JSON to a map type: <code>map[string][]string</code></p>\n\n<pre><code>var m map[string][]string\nif err := json.Unmarshal(data, &amp;m); err != nil {\n    // handle error\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/bR_igb55tQ\" rel=\"nofollow\">playground example</a></p>\n"}, {"comments": [{"owner": {"reputation": 529, "user_id": 1540739, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4c9e558372c8a4422060f277b3f73886?s=128&d=identicon&r=PG", "display_name": "arshpreet", "link": "https://stackoverflow.com/users/1540739/arshpreet"}, "edited": false, "score": 0, "creation_date": 1555931540, "post_id": 38341661, "comment_id": 98255778, "body": "Is there no way Consul provide any inernal parser to  parse data if in the form .HCL or .YAML?"}], "tags": [], "owner": {"reputation": 1294, "user_id": 589590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a83885421a7b4b8aff3325bd4e7f9954?s=128&d=identicon&r=PG", "display_name": "Tarsis Azevedo", "link": "https://stackoverflow.com/users/589590/tarsis-azevedo"}, "is_accepted": true, "score": 7, "last_activity_date": 1468376558, "creation_date": 1468376558, "answer_id": 38341661, "question_id": 38340990, "link": "https://stackoverflow.com/questions/38340990/how-can-i-parse-the-following-json-structure-in-go/38341661#38341661", "title": "How can I parse the following JSON structure in Go", "body": "<p>If json values are always an <code>[]string</code> you can convert it with </p>\n\n<pre><code>json.Unmarshal(value, &amp;map[string][]string)\n</code></pre>\n\n<p>But if not, best way to do this is Unmarshal JSON in a map[string]interface{} and check each field type you want to.</p>\n"}, {"tags": [], "owner": {"reputation": 389, "user_id": 3385070, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/pU0nE.jpg?s=128&g=1", "display_name": "tez", "link": "https://stackoverflow.com/users/3385070/tez"}, "is_accepted": false, "score": 0, "last_activity_date": 1468432885, "creation_date": 1468432885, "answer_id": 38358766, "question_id": 38340990, "link": "https://stackoverflow.com/questions/38340990/how-can-i-parse-the-following-json-structure-in-go/38358766#38358766", "title": "How can I parse the following JSON structure in Go", "body": "<p>You can also provide Go' structure for more fluent unmarshaling...</p>\n\n<pre><code>type Rec struct {\n    Consul      []string // `json:\"consul\"`\n    Docker      []string // `json:\"docker\"`\n    Etcd        []string // `json:\"etcd\"`\n    Kubernetes  []string // `json:\"kubernetes\"`\n    MantlApi    []string // `json:\"mantl-api\"`\n    Marathon    []string // `json:\"marathon\"`\n    Mesos       []string // `json:\"mesos\"`\n    MesosConsul []string // `json:\"mesos-consul\"`\n    Zookeeper   []string // `json:\"zookeeper\"`\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/rtNW8aqkvK\" rel=\"nofollow\">Working example on playground</a></p>\n"}], "owner": {"reputation": 123, "user_id": 6513431, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3518355968fbbcd1a6a23bb76a988d6c?s=128&d=identicon&r=PG&f=1", "display_name": "jisan", "link": "https://stackoverflow.com/users/6513431/jisan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 231, "favorite_count": 0, "accepted_answer_id": 38341661, "answer_count": 3, "score": 5, "last_activity_date": 1468432885, "creation_date": 1468370926, "last_edit_date": 1468375764, "question_id": 38340990, "link": "https://stackoverflow.com/questions/38340990/how-can-i-parse-the-following-json-structure-in-go", "title": "How can I parse the following JSON structure in Go", "body": "<p>In Go, how can I parse the following JSON?\nI know to use <code>struct</code> to parse, but the keys are different for each entry, also they are not fixed, they can be more or less. </p>\n\n<pre><code>{\n  \"consul\": [],\n  \"docker\": [],\n  \"etcd\": [\"etcd\"],\n  \"kubernetes\": [\"secure\"],\n  \"mantl-api\": [],\n  \"marathon\": [\"marathon\"],\n  \"mesos\": [\"agent\", \"follower\", \"leader\", \"master\"],\n  \"mesos-consul\": [],\n  \"zookeeper\": [\"mantl\"]\n}\n</code></pre>\n\n<p>Thanks for help! </p>\n"}, {"tags": ["json", "postgresql", "go"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 4, "last_activity_date": 1468393128, "last_edit_date": 1468393128, "creation_date": 1468392171, "answer_id": 38344353, "question_id": 38340859, "link": "https://stackoverflow.com/questions/38340859/retrieve-relation-one-to-many-into-json-sql-pure-golang-performance/38344353#38344353", "title": "Retrieve relation one to many into JSON sql pure, Golang, Performance", "body": "<p>1) Bad about this would be the sql request per iteration. So here a solution that does not make an extra request per Publisher:</p>\n\n<pre><code>func (r *PublisherRepository) GetAllPublishers() []*Publisher {\n    sql := \"SELECT * FROM publishers\"\n    ps := make(map[int]*Publisher)\n    rows, err := connection.Query(sql)\n    if err != nil { \n       // log \n    }\n    for rows.Next() {\n       p := &amp;Publisher{}\n       rows.Scan(&amp;p.ID,&amp;p.Name)\n       ps[p.ID] = p\n    }\n\n    sql = \"SELECT * FROM books\"\n    rows, err := connection.Query(sql)\n    if err != nil {\n      //log\n    }\n    for rows.Next() {\n      b := &amp;Book{}\n      rows.Scan(&amp;b.ID, &amp;b.Name, &amp;b.PublisherID)\n\n      ps[b.PublisherID].Books = append(ps[b.PublisherID].Books, b)\n    }\n\n    // you might choose to keep the map as a return value, but otherwise:\n\n    // preallocate memory for the slice\n    publishers := make([]*Publisher, 0, len(ps))\n    for _, p := range ps {\n        publishers = append(publishers, p)\n    }\n\n    return publishers\n}\n</code></pre>\n\n<p>2) Unless you create the PublisherRepository only once, this might be a bad idea creating and closing loads of connections. Depending also on your sql client implementation I would suggest (and also have seen it for many other go database clients) to have one connection for the entire server. Pooling is done internally by many of the sql clients, that is why you should check your sql client.\nIf your sql client library does pooling internally use a global variable for the \"connection\" (it's not really one connection if pooling is done internally):</p>\n\n<pre><code>connection *sql.DB\n\nfunc New () *PublisherRepository {\n    repo := &amp;PublisherRepository{}\n    return repo.connect()\n}\n\ntype PublisherRepository struct{\n}\n\nfunc (r *PublisherRepository) connect() *PublisherRepository {\n    // open new connection if connection is nil \n    // or not open (if there is such a state)\n    // you can also check \"once.Do\" if that suits your needs better\n    if connection == nil {\n        // ...\n    }\n    return r\n}\n</code></pre>\n\n<p>So each time you create a new PublisherRepository, it will only check if connection already exists. If you use once.Do, go will only create the \"connection\" once and you are done with it.</p>\n\n<p>If you have other structs that will use the connection as well, you need a global place for your connection variable or (even better) you write a little wrapper package for your sql client, that is in turn used in all your structs.</p>\n"}, {"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": false, "score": 1, "last_activity_date": 1468393812, "last_edit_date": 1468393812, "creation_date": 1468393201, "answer_id": 38344681, "question_id": 38340859, "link": "https://stackoverflow.com/questions/38340859/retrieve-relation-one-to-many-into-json-sql-pure-golang-performance/38344681#38344681", "title": "Retrieve relation one to many into JSON sql pure, Golang, Performance", "body": "<ol>\n<li><p>In your case, the simplest way would be to use <code>json_agg</code> in the query. Like here <a href=\"http://sqlfiddle.com/#!15/97c41/4\" rel=\"nofollow\">http://sqlfiddle.com/#!15/97c41/4</a> (sqlfiddle is slow so here is screenshot <a href=\"http://i.imgur.com/hxMPkUa.png\" rel=\"nofollow\">http://i.imgur.com/hxMPkUa.png</a>) Not very Go friendly (you need to unmarshal query result data if you want to do something with the books) but all books in one query as you wanted without <code>for</code> loops.</p></li>\n<li><p>As @TehSphinX said it is better to have single global <code>db</code> connection.</p></li>\n</ol>\n\n<p>But before implementing strange queries I really suggest you to think: why do you need to return the full list of publishers and their books in one API query? I can't imagine the situation in web or mobile app where your idea might be a good decision. Usually, you just show users list of publishers then users chooses one and you show him the list of books by this publisher. This is \"win-win\" situation for you and your users - you can make simple queries and your users just get small sets of data that they actually need without paying for unnecessary traffic/wasting browser memory. As you said there can be 200 publishers with 100 books and I'm sure your users don't need 20000 books loaded in one request. Of course, if you are not trying to make your API more data theft friendly.</p>\n\n<p>Even if you have something like a short preview-like list of books for each publisher you should think about pagination for publishers and/or denormalisation of books data for this case (add a column to <code>publishers</code> table with the short list of books in JSON format).</p>\n"}], "owner": {"reputation": 1335, "user_id": 1527290, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/c90b45a5bde3f27dcffe26ef54760faf?s=128&d=identicon&r=PG", "display_name": "Cristian Chaparro A.", "link": "https://stackoverflow.com/users/1527290/cristian-chaparro-a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1858, "favorite_count": 1, "accepted_answer_id": 38344353, "answer_count": 2, "score": 4, "last_activity_date": 1468393812, "creation_date": 1468369802, "last_edit_date": 1468372780, "question_id": 38340859, "link": "https://stackoverflow.com/questions/38340859/retrieve-relation-one-to-many-into-json-sql-pure-golang-performance", "title": "Retrieve relation one to many into JSON sql pure, Golang, Performance", "body": "<p>Suppose that I've the following structures that it's  the mapped tables.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Publisher struct{\n   ID int       `db:\"id\"`\n   Name  string `db:\"name\"`\n   Books []*Book  \n}\n\ntype Book struct {\n   ID int       `db:\"id\"`\n   Name string  `db:\"name\"`\n   PublisherID   `db:\"publisher_id\"` \n}\n</code></pre>\n\n<p>So, What if I wanna retrieve all the Publisher  with all related Books I would like to get a <code>JSON</code> like this:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>[ //Publisher 1 \n  {\n    \"id\" : \"10001\", \n    \"name\":\"Publisher1\",\n    \"books\" : [\n       { \"id\":321,\"name\": \"Book1\"}, \n       { \"id\":333,\"name\": \"Book2\"}\n    ]\n  },\n  //Publisher 2\n  {\n    \"id\" : \"10002\", \n    \"name\":\"Slytherin Publisher\",\n    \"books\" : [\n       { \"id\":4021,\"name\": \"Harry Potter and the Chamber of Secrets\"}, \n       { \"id\":433,\"name\": \"Harry Potter and the Order of the Phoenix\"}\n    ]\n  },\n]\n</code></pre>\n\n<p>So I've the following structure that I use to retrieve all kind of query related with <code>Publisher</code></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type PublisherRepository struct{\n   Connection *sql.DB\n}\n// GetEbooks return all the books related with a publisher\nfunc (r *PublisherRepository) GetBooks(idPublisher int) []*Book {\n    bs := make([]Book,0)\n    sql := \"SELECT * FROM books b WHERE b.publisher_id =$1 \"\n    row, err := r.Connection.Query(sql,idPublisher)\n    if err != nil {\n      //log\n    }\n    for rows.Next() {\n      b := &amp;Book{}\n      rows.Scan(&amp;b.ID, &amp;b.Name, &amp;b.PublisherID)\n      bs := append(bs,b)\n    }\n    return bs\n}\nfunc (r *PublisherRepository) GetAllPublishers() []*Publisher {\n    sql := \"SELECT * FROM publishers\"\n    ps := make([]Publisher,0)\n    rows, err := r.Connection.Query(sql)\n    if err != nil { \n       // log \n    }\n    for rows.Next() {\n       p := &amp;Publisher{}\n       rows.Scan(&amp;p.ID,&amp;p.Name)\n       // Is this the best way? \n       books := r.GetBooks(p.ID)\n       p.Books  = books\n    }\n    return ps\n\n}\n</code></pre>\n\n<p>So , here my questions</p>\n\n<ol>\n<li><p>What is the best approach to retrieve all the <code>publisher</code> with the best performance, because a <code>for</code> inside a <code>for</code> is not the best solution, what if I've 200 publisher and in the average of each publisher has 100 books.</p></li>\n<li><p>Is  in GoLang idiomatic <code>PublisherRepository</code> or is there another way to create something to manage the transactions of an entity with pure sql?</p></li>\n</ol>\n"}, {"tags": ["api", "testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 330, "user_id": 1524867, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/R1Wat.jpg?s=128&g=1", "display_name": "Drew Ogryzek", "link": "https://stackoverflow.com/users/1524867/drew-ogryzek"}, "edited": false, "score": 1, "creation_date": 1468436313, "post_id": 38341705, "comment_id": 64131842, "body": "Thank you! This is what I was looking for."}], "tags": [], "owner": {"reputation": 1294, "user_id": 589590, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a83885421a7b4b8aff3325bd4e7f9954?s=128&d=identicon&r=PG", "display_name": "Tarsis Azevedo", "link": "https://stackoverflow.com/users/589590/tarsis-azevedo"}, "is_accepted": true, "score": 11, "last_activity_date": 1468376874, "creation_date": 1468376874, "answer_id": 38341705, "question_id": 38339541, "link": "https://stackoverflow.com/questions/38339541/test-go-golang-api-outgoing-requests-without-actually-hitting-third-party-api/38341705#38341705", "title": "Test Go (Golang) API Outgoing Requests without Actually Hitting Third Party API", "body": "<p>You can use <code>net/http/httptest.NewServer</code> like this:</p>\n\n<pre><code>ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(`desired response here`))\n}))\ndefer ts.Close()\nThirdPartyAPI = ts.URL\n...\nyour test here\n</code></pre>\n"}], "owner": {"reputation": 330, "user_id": 1524867, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/R1Wat.jpg?s=128&g=1", "display_name": "Drew Ogryzek", "link": "https://stackoverflow.com/users/1524867/drew-ogryzek"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1329, "favorite_count": 4, "accepted_answer_id": 38341705, "answer_count": 1, "score": 7, "last_activity_date": 1468376874, "creation_date": 1468360790, "last_edit_date": 1468361745, "question_id": 38339541, "link": "https://stackoverflow.com/questions/38339541/test-go-golang-api-outgoing-requests-without-actually-hitting-third-party-api", "title": "Test Go (Golang) API Outgoing Requests without Actually Hitting Third Party API", "body": "<p>I'm working on a Go API that translates between an internal backend and several third party APIs. I'm trying to understand how to test its functionality without actually hitting an outside API.</p>\n\n<p>For example, here's a server that handles incoming requests to make new songs, and sends the request to a third party API:</p>\n\n<pre><code>package main\n\nimport (\n        \"bytes\"\n        \"encoding/json\"\n        \"fmt\"\n        \"net/http\"\n)\n\nvar ThirdPartyApi = \"http://www.coolsongssite.api\"\n\ntype IncomingRequest struct {\n        username string         `json:\"username\"`\n        password string         `json:\"password\"`\n        songs    []IncomingSong `json:\"songs\"`\n}\n\ntype OutgoingRequest struct {\n        username string         `json:\"username\"`\n        password string         `json:\"password\"`\n        songs    []OutgoingSong `json:\"songs\"`\n}\n\ntype IncomingSong struct {\n        artist string `json:\"artist\"`\n        album  string `json:\"album\"`\n        title  string `json:\"title\"`\n}\n\ntype OutgoingSong struct {\n        musician string `json:\"musician\"`\n        record   string `json:\"record\"`\n        name     string `json:\"name\"`\n}\n\nfunc main() {\n        http.HandleFunc(\"/songs/create\", createSong)\n        http.ListenAndServe(\":8080\", nil)\n}\n\nfunc createSong(rw http.ResponseWriter, req *http.Request) {\n         decoder := json.NewDecoder(req.Body)\n         var incomingRequest IncomingRequest\n         decoder.Decode(&amp;incomingRequest)\n         outgoingRequest := incomingRequestToOutgoingRequest(incomingRequest)\n\n         r, _ := json.Marshal(outgoingRequest)\n         request, _ := http.NewRequest(\"POST\", ThirdPartyApi, bytes.NewBuffer(r))\n         request.Header.Set(\"Content-Type\", \"application/json\")\n\n         client := http.Client{}\n\n         response, _ := client.Do(request)\n         fmt.Fprintln(rw, response)\n}\n\nfunc incomingRequestToOutgoingRequest(inc IncomingRequest) OutgoingRequest {\n        outgoingRequest := OutgoingRequest{\n                username: inc.username,\n                password: inc.password,\n        }\n\n        for _, s := range inc.songs {\n                outgoingRequest.songs = append(\n                        outgoingRequest.songs, OutgoingSong{\n                                musician: s.artist,\n                                record:   s.album,\n                                name:     s.title,\n                        },\n                )\n        }\n\n        return outgoingRequest\n}\n</code></pre>\n\n<p>So I might hit the app running on <code>localhost:8080</code> with something like this:</p>\n\n<pre><code>curl -X POST http://localhost:8080/songs/new --data \\\n'{\"username\": \"&lt;my-username&gt;\", \"password\": \"&lt;my-password&gt;\", \"songs\": \\\n[\"artist\": \"&lt;song-artist&gt;\", \"title\": \"&lt;song-title&gt;\", \"album\": \"&lt;song-album&gt;\"]}'\n</code></pre>\n\n<p><strong>My question is</strong>:\nHow do I write tests that test that the request that goes out (in this case to <code>http://www.coolsongssite.api</code>) is correct, without actually sending it?</p>\n\n<p>Should I rewrite the <code>createSong</code> handler so I can isolate what is happening in <code>client.Do(request)</code>?</p>\n\n<p>Any help/advice/points in the right direction are appreciated.</p>\n\n<p>Here I can test <code>incomingRequestToOutgoingRequest</code> like so:</p>\n\n<pre><code>package main\n\nimport (\n        \"testing\"\n)\n\nfunc TestincomingRequestToOutgoingRequest(t *testing.T) {\n        incomingRequest := IncomingRequest{\n                username: \"myuser\",\n                password: \"mypassword\",\n        }\n\n        var songs []IncomingSong\n        songs = append(\n                songs, IncomingSong{\n                artist: \"White Rabbits\",\n                album:  \"Milk Famous\",\n                title:  \"I'm Not Me\",\n                },\n        )\n\n        outgoingRequest := incomingRequestToOutgoingRequest(incomingRequest)\n\n        if outgoingRequest.songs[0].musician != \"White Rabbits\" {\n                t.Error(\"Expected musican name to be 'White Rabbits'. Got: \", outgoingRequest.songs[0].musician)\n        }\n}\n</code></pre>\n"}, {"tags": ["api", "go", "struct", "podio"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1468419852, "post_id": 38338781, "comment_id": 64121124, "body": "Can you provide us with a sample of the input structure you wish to grap portions out of?"}, {"owner": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468475364, "post_id": 38338781, "comment_id": 64144302, "body": "Hi TehSphinX. Here is a sample of the input structure: <a href=\"https://github.com/andreas/podio-go/blob/master/item.go#L39\" rel=\"nofollow noreferrer\">github.com/andreas/podio-go/blob/master/item.go#L39</a> and <a href=\"https://github.com/andreas/podio-go/blob/master/item.go#L98\" rel=\"nofollow noreferrer\">github.com/andreas/podio-go/blob/master/item.go#L98</a>"}], "answers": [{"comments": [{"owner": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "edited": false, "score": 0, "creation_date": 1468387351, "post_id": 38339197, "comment_id": 64100117, "body": "Hi Benjamin, thanks for your quick response. With your first snippet I get <code>error: interface conversion: interface is []interface {}, not []podio.TextValue</code> and with the second it fails silently and <code>myTexts</code> does not have any values"}, {"owner": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "edited": false, "score": 0, "creation_date": 1468387917, "post_id": 38339197, "comment_id": 64100307, "body": "Btw, <code>field.Values.([]interface{})</code> does work but I can&#39;t figure out how to then get the <code>values</code> out of the map."}, {"owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "reply_to_user": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "edited": false, "score": 0, "creation_date": 1468420730, "post_id": 38339197, "comment_id": 64121803, "body": "Try using a for loop on the result of the assertion"}, {"owner": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "edited": false, "score": 0, "creation_date": 1468430357, "post_id": 38339197, "comment_id": 64128251, "body": "I tried <code>for _, myText := range myTexts {</code> but without success. What other syntax do you suggest?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468490733, "post_id": 38339197, "comment_id": 64153193, "body": "What map are you talking about? Or do you mean &quot;slice&quot;? Maybe you can also create a new question, since we do not have any context here. What is <code>myTexts</code>, for example."}], "tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": false, "score": 2, "last_activity_date": 1468358969, "creation_date": 1468358969, "answer_id": 38339197, "question_id": 38338781, "link": "https://stackoverflow.com/questions/38338781/golang-access-raw-podio-field-values/38339197#38339197", "title": "Golang access raw Podio field values", "body": "<p>Try a <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertion</a></p>\n\n<pre><code>myTexts := field.Values.([]TextValue)\n</code></pre>\n\n<p>You can also check for a valid assertion so your program doesn't panic</p>\n\n<pre><code> myTexts, assertionSucceeded := field.Values.([]TextValue)\n</code></pre>\n"}], "owner": {"reputation": 79, "user_id": 996756, "user_type": "registered", "accept_rate": 20, "profile_image": "https://i.stack.imgur.com/piBQ1.jpg?s=128&g=1", "display_name": "pjmuller", "link": "https://stackoverflow.com/users/996756/pjmuller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1468358969, "creation_date": 1468357145, "question_id": 38338781, "link": "https://stackoverflow.com/questions/38338781/golang-access-raw-podio-field-values", "title": "Golang access raw Podio field values", "body": "<p>Hi Podio people (and maybe more specifically Andreas),</p>\n\n<p>I'm trying to dig deeper into the Golang API library but bumping into my rookie Golang skills.</p>\n\n<p>After doing a <code>client.getItems(...)</code> call I wish to loop over the fields inside of the items and only grab relevant portions. The end goal is that I can create a very much simplified json object like this</p>\n\n<pre><code>{\n    1000: \"John\", // key = app field id, value = text\n    5490: [{item_id: 4031294, app_id: 94392}],  // relations\n    5163: [1,2,5] // categories\n}\n</code></pre>\n\n<p>However I cannot seem to get a hold of the <code>item.Fields</code> nested <code>Values</code> struct {}. I tried using reflect but without any luck.</p>\n\n<p>Could someone help me complete this code please?</p>\n\n<pre><code>for _, field := range item.Fields {\n  switch field.PartialField.Type {\n  case \"text\":\n    simpleValue := field.Values.Value // not working as I can't access Value in struct {}\n  }\n}\n</code></pre>\n\n<p>Greetings,\nPJ</p>\n"}, {"tags": ["macos", "go", "path", "installation"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1468355395, "post_id": 38337790, "comment_id": 64090950, "body": "I&#39;m voting to close this question as off-topic because it&#39;s about the design decisions made in creating the installer for a software development toolchain, unrelated to any act of software development itself."}, {"owner": {"reputation": 1326, "user_id": 438273, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/88ad8bc15f1a9e787531e9b20340973a?s=128&d=identicon&r=PG", "display_name": "jsejcksn", "link": "https://stackoverflow.com/users/438273/jsejcksn"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1468355998, "post_id": 38337790, "comment_id": 64091291, "body": "@Adrian Where do you suggest is the appropriate site to post? There is not a SE site for Go and this has the largest Go community by posts. Don&#39;t vote to close, but vote to migrate."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1468356197, "post_id": 38337790, "comment_id": 64091403, "body": "This isn&#39;t a Go question. You could rephrase it to replace &quot;Go&quot; with &quot;some program&quot; and it would have no impact. I would vote to migrate if I thought there was an appropriate SE site for this question, but I&#39;m not sure there is."}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468393816, "post_id": 38337790, "comment_id": 64103141, "body": "The right place to ask this would probably be at <a href=\"https://groups.google.com/forum/#!forum/golang-nuts\" rel=\"nofollow noreferrer\">golang-nuts</a>"}, {"owner": {"reputation": 1326, "user_id": 438273, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/88ad8bc15f1a9e787531e9b20340973a?s=128&d=identicon&r=PG", "display_name": "jsejcksn", "link": "https://stackoverflow.com/users/438273/jsejcksn"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1468400708, "post_id": 38337790, "comment_id": 64107487, "body": "@TehSphinX I already did."}], "answers": [{"tags": [], "owner": {"reputation": 667, "user_id": 5627286, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UeYlo.jpg?s=128&g=1", "display_name": "aMike", "link": "https://stackoverflow.com/users/5627286/amike"}, "is_accepted": false, "score": 0, "last_activity_date": 1468722225, "creation_date": 1468722225, "answer_id": 38417338, "question_id": 38337790, "link": "https://stackoverflow.com/questions/38337790/go-installer-behavior-on-mac-path-modification-vs-symlink/38417338#38417338", "title": "Go installer behavior on Mac: PATH modification vs symlink", "body": "<p>Sorry for using an answer; I don't have enough reputation points to comment. ((which seems backwards to me))</p>\n\n<p>@jsejksn says \"I have never seen another software take this approach.\"</p>\n\n<p>My /etc/paths.d contains entries for Xquartz, CrossPack-AVR, aria2c and go. From reading google'd articles about /etc/paths.d, I see that ImageMagik also adds an entry to /etc/paths.d.</p>\n\n<p>I'd guess that it's an easy way to let users run binaries without having to mess around with amending the PATH in their own profile scripts, or lose track of symlinks, or whatever.</p>\n\n<p>Maybe sym-links is more of a Gnu thing, while /etc/paths.d is more of a BSD thing?</p>\n\n<p>Personally, I like it.</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 2, "last_activity_date": 1468728500, "creation_date": 1468728500, "answer_id": 38417823, "question_id": 38337790, "link": "https://stackoverflow.com/questions/38337790/go-installer-behavior-on-mac-path-modification-vs-symlink/38417823#38417823", "title": "Go installer behavior on Mac: PATH modification vs symlink", "body": "<p>From <a href=\"http://www.kilala.nl/Sysadmin/index.php?id=934\" rel=\"nofollow\">this thread</a>, the <code>path_helper</code> (<a href=\"http://opensource.apple.com/source/shell_cmds/shell_cmds-179/path_helper/path_helper.c\" rel=\"nofollow\">source</a>) is:</p>\n\n<blockquote>\n  <p>because automatic software installation (and what's more important UNinstallation) is much easier this way. Many Linux distros switch to <code>.d</code> directories for many configuration files (Apache 2.0 was AFAIK the first program to support this kind of stuff) because it makes administration much easier. </p>\n</blockquote>\n\n<p>The <a href=\"https://golang.org/doc/install#uninstall\" rel=\"nofollow\">Uninstall Go section</a> does mention:</p>\n\n<blockquote>\n  <p>If you installed Go with the <a href=\"https://golang.org/doc/install#osx\" rel=\"nofollow\">Mac OS X package</a> then you should remove the <code>/etc/paths.d/go</code> file. </p>\n</blockquote>\n\n<p>Those <a href=\"https://lists.macosforge.org/pipermail/xquartz-dev/2015-November/003910.html\" rel=\"nofollow\">files in <code>/etc/paths.d</code> are processed in order</a> (so you can manage <code>PATH</code> order as opposed to symlinks in <code>/usr/local/bin</code>).</p>\n\n<p>Note that <code>path_helper</code> is only called by login shells, not by non-interactive shells.</p>\n"}], "owner": {"reputation": 1326, "user_id": 438273, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/88ad8bc15f1a9e787531e9b20340973a?s=128&d=identicon&r=PG", "display_name": "jsejcksn", "link": "https://stackoverflow.com/users/438273/jsejcksn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 2, "accepted_answer_id": 38417823, "answer_count": 2, "score": 2, "last_activity_date": 1468728500, "creation_date": 1468353251, "last_edit_date": 1468353789, "question_id": 38337790, "link": "https://stackoverflow.com/questions/38337790/go-installer-behavior-on-mac-path-modification-vs-symlink", "title": "Go installer behavior on Mac: PATH modification vs symlink", "body": "<p>In my experience, most software for OS X that installs cli components installs to <code>/usr/local/</code> and then creates symbolic links to executables in <code>/usr/local/bin/</code>, as not to modify my <code>$PATH</code>. However, the Go installer differs in approach by creating a new entry in <code>/etc/paths.d/</code> for <a href=\"https://developer.apple.com/legacy/library/documentation/Darwin/Reference/ManPages/man8/path_helper.8.html\" rel=\"nofollow\"><code>path_helper</code></a> to read and then modify my <code>$PATH</code>. Can someone please explain the thinking behind this design decision? Is it more common on Linux to have a lot of path additions instead of symbolic links to executables in an existing directory?</p>\n\n<p>I'd love to get a better understanding of why this choice. I have never seen another software take this approach.</p>\n"}, {"tags": ["amazon-web-services", "go", "amazon-ec2", "scheduled-tasks"], "answers": [{"comments": [{"owner": {"reputation": 2180, "user_id": 120763, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3e99c1c02e97e422a2e18bea199bf9c2?s=128&d=identicon&r=PG", "display_name": "elmonty", "link": "https://stackoverflow.com/users/120763/elmonty"}, "edited": false, "score": 0, "creation_date": 1468458995, "post_id": 38340254, "comment_id": 64140303, "body": "It is a static web site on S3. Lambda does not appear to support Golang executables."}, {"owner": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "reply_to_user": {"reputation": 2180, "user_id": 120763, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3e99c1c02e97e422a2e18bea199bf9c2?s=128&d=identicon&r=PG", "display_name": "elmonty", "link": "https://stackoverflow.com/users/120763/elmonty"}, "edited": false, "score": 0, "creation_date": 1468459630, "post_id": 38340254, "comment_id": 64140426, "body": "You can deploy Golang executables to Lambda using the Apex framework, as I noted in my answer."}], "tags": [], "owner": {"reputation": 137816, "user_id": 13070, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/pio3A.jpg?s=128&g=1", "display_name": "Mark B", "link": "https://stackoverflow.com/users/13070/mark-b"}, "is_accepted": false, "score": 1, "last_activity_date": 1468365133, "creation_date": 1468365133, "answer_id": 38340254, "question_id": 38336763, "link": "https://stackoverflow.com/questions/38336763/how-to-configure-a-golang-executable-to-run-as-a-scheduled-job-in-aws/38340254#38340254", "title": "How to configure a Golang executable to run as a scheduled job in AWS?", "body": "<ol>\n<li><p>What is the web server environment tier exactly? Is it an Elastic Beanstalk app? If it's just a static website you should be hosting it on S3, and if it is on S3 you can certainly write to that from your Golang executable.</p></li>\n<li><p>If you just want to run a nightly task, using Elastic Beanstalk worker environments seems like total overkill. Just run a small EC2 instance and schedule the task via cron. Alternatively, deploy it to Lambda via the Apex framework.</p></li>\n</ol>\n\n<p>If you can get your static website working on S3 and your nightly jobs running on Lambda it will cost a small fraction of what Beanstalk and/or EC2 will.</p>\n"}, {"tags": [], "owner": {"reputation": 391, "user_id": 4375384, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-_RqBl08cXag/AAAAAAAAAAI/AAAAAAAAAH4/YeJ8_X9cdiw/photo.jpg?sz=128", "display_name": "Noah Zoschke", "link": "https://stackoverflow.com/users/4375384/noah-zoschke"}, "is_accepted": false, "score": 1, "last_activity_date": 1522419746, "creation_date": 1522419746, "answer_id": 49576175, "question_id": 38336763, "link": "https://stackoverflow.com/questions/38336763/how-to-configure-a-golang-executable-to-run-as-a-scheduled-job-in-aws/49576175#49576175", "title": "How to configure a Golang executable to run as a scheduled job in AWS?", "body": "<p>As of January 2018, Lambda support Go, and running Lambda functions on a schedule is easy.</p>\n\n<p>Take a look at this guide: <a href=\"https://github.com/nzoschke/gofaas/blob/master/docs/worker-functions.md\" rel=\"nofollow noreferrer\">Go Worker Functions with Lambda, S3, and CloudWatch Events</a>.</p>\n\n<p>The trick is to configure your Lambda function with a <code>Schedule</code> event, as well as permissions to access the S3 bucket. Here's an excerpt CloudFormation template:</p>\n\n<pre><code>Resources:\n  WorkerPeriodicFunction:\n    Properties:\n      CodeUri: ./handlers/worker-periodic/main.zip\n      Environment:\n        Variables:\n          BUCKET: !Ref Bucket\n      Events:\n        Request:\n          Properties:\n            Schedule: rate(1 day)\n          Type: Schedule\n      Handler: main\n      Policies:\n        - Statement:\n            - Action:\n                - s3:DeleteObject\n              Effect: Allow\n              Resource: !Sub \"arn:aws:s3:::${Bucket}/*\"\n            - Action:\n                - s3:ListBucket\n              Effect: Allow\n              Resource: !Sub \"arn:aws:s3:::${Bucket}\"\n      Runtime: go1.x\n      Timeout: 15\n    Type: AWS::Serverless::Function\n</code></pre>\n\n<p>Check out my open-source <a href=\"https://github.com/nzoschke/gofaas\" rel=\"nofollow noreferrer\">gofaas Lambda and Go app</a> to experiment with this technique. </p>\n"}], "owner": {"reputation": 2180, "user_id": 120763, "user_type": "registered", "accept_rate": 35, "profile_image": "https://www.gravatar.com/avatar/3e99c1c02e97e422a2e18bea199bf9c2?s=128&d=identicon&r=PG", "display_name": "elmonty", "link": "https://stackoverflow.com/users/120763/elmonty"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1053, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1522419746, "creation_date": 1468349428, "question_id": 38336763, "link": "https://stackoverflow.com/questions/38336763/how-to-configure-a-golang-executable-to-run-as-a-scheduled-job-in-aws", "title": "How to configure a Golang executable to run as a scheduled job in AWS?", "body": "<p>I have a static web site that will be running in AWS EC2. I also have a Golang executable that is intended to update some Javascript data files nightly. I understand that I need to set up a Worker Environment Tier to do this. I have two questions:</p>\n\n<ol>\n<li><p>Can such a job in a Worker Environment Tier write files in the Web Server Environment Tier?</p></li>\n<li><p>Since scheduled jobs are invoked via https POST, how do I configure my Golang executable to respond to POST requests when it isn't itself acting as the web server?</p></li>\n</ol>\n"}, {"tags": ["http", "go", "middleware"], "answers": [{"comments": [{"owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "edited": false, "score": 0, "creation_date": 1468340356, "post_id": 38334159, "comment_id": 64082771, "body": "sorry - I don&#39;t see how that differs from my first code snippet?"}, {"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "reply_to_user": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "edited": false, "score": 0, "creation_date": 1468340490, "post_id": 38334159, "comment_id": 64082841, "body": "The position of write header vs h.ServeHTTP, diff the code."}, {"owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "edited": false, "score": 0, "creation_date": 1468340546, "post_id": 38334159, "comment_id": 64082877, "body": "Ah - I have two code snippets in my question, the first matches what you have written, the second is an example of what I want to do, and I note that it&#39;s incorrect."}, {"owner": {"reputation": 17158, "user_id": 177591, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0f96caf21e8d14e1062fde39db81ed66?s=128&d=identicon&r=PG", "display_name": "Kugel", "link": "https://stackoverflow.com/users/177591/kugel"}, "edited": false, "score": 0, "creation_date": 1515640443, "post_id": 38334159, "comment_id": 83379730, "body": "How does this answer the question? You just repeated the code in the Question."}], "tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": -1, "last_activity_date": 1468340166, "creation_date": 1468340166, "answer_id": 38334159, "question_id": 38334072, "link": "https://stackoverflow.com/questions/38334072/control-http-headers-from-outer-go-middleware/38334159#38334159", "title": "Control HTTP headers from outer Go middleware", "body": "<p>It's not possible to change headers (add/remove/modify) after you use WriteHeader(Status).</p>\n\n<p>For this to work, change to:</p>\n\n<pre><code>// Server attaches a Server header to the response.\nfunc Server(h http.Handler, serverName string) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Server\", serverName)\n    h.ServeHTTP(w, r)\n  })\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1468490735, "post_id": 38335233, "comment_id": 64153196, "body": "This is a perfect example of overengineering it. Really all that you need to do is change the place of where the header gets written and write it before calling WriteHeader()."}, {"owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "reply_to_user": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "edited": false, "score": 0, "creation_date": 1468504615, "post_id": 38335233, "comment_id": 64162677, "body": "I&#39;m really confused by your comment. It&#39;s impossible to override an internal middleware from an outer middleware. In this case I&#39;m calling httputil.ReverseProxy.ServeHTTP to proxy to code I don&#39;t control. ReverseProxy.ServeHTTP calls WriteHeader on whatever the proxy returns; I can&#39;t control that."}], "tags": [], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "is_accepted": true, "score": 3, "last_activity_date": 1522229796, "last_edit_date": 1522229796, "creation_date": 1468343742, "answer_id": 38335233, "question_id": 38334072, "link": "https://stackoverflow.com/questions/38334072/control-http-headers-from-outer-go-middleware/38335233#38335233", "title": "Control HTTP headers from outer Go middleware", "body": "<p>You can define a custom type which wraps a ResponseWriter and inserts the Server header just before all headers are written, at the cost of an additional layer of indirection. Here is an example:</p>\n\n<pre><code>type serverWriter struct {\n    w           http.ResponseWriter\n    name        string\n    wroteHeader bool\n}\n\nfunc (s serverWriter) WriteHeader(code int) {\n    if s.wroteHeader == false {\n        s.w.Header().Set(\"Server\", s.name)\n        s.wroteHeader = true\n    }\n    s.w.WriteHeader(code)\n}\n\nfunc (s serverWriter) Write(b []byte) (int, error) {\n    return s.w.Write(b)\n}\n\nfunc (s serverWriter) Header() http.Header {\n    return s.w.Header()\n}\n\n// Server attaches a Server header to the response.\nfunc Server(h http.Handler, serverName string) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        sw := serverWriter{\n            w:           w,\n            name:        serverName,\n            wroteHeader: false,\n        }\n        h.ServeHTTP(sw, r)\n    })\n}\n</code></pre>\n\n<p>I wrote more about this here. <a href=\"https://kev.inburke.com/kevin/how-to-write-go-middleware/\" rel=\"nofollow noreferrer\">https://kev.inburke.com/kevin/how-to-write-go-middleware/</a></p>\n"}], "owner": {"reputation": 48731, "user_id": 329700, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/41910a452554b187d044c00c576866b1?s=128&d=identicon&r=PG", "display_name": "Kevin Burke", "link": "https://stackoverflow.com/users/329700/kevin-burke"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1844, "favorite_count": 0, "accepted_answer_id": 38335233, "answer_count": 2, "score": 3, "last_activity_date": 1522229796, "creation_date": 1468339858, "question_id": 38334072, "link": "https://stackoverflow.com/questions/38334072/control-http-headers-from-outer-go-middleware", "title": "Control HTTP headers from outer Go middleware", "body": "<p>Let's say I have a middleware in Go where I want to override any existing <code>Server</code> headers with my own value.</p>\n\n<pre><code>// Server attaches a Server header to the response.\nfunc Server(h http.Handler, serverName string) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Server\", serverName)\n        h.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>Then I add it to a response chain like this</p>\n\n<pre><code>http.Handle(\"/\", authHandler)\nhttp.ListenAndServe(\":8000\", Server(http.DefaultServeMux, \"myapp\"))\n</code></pre>\n\n<p>Unfortunately, if the authHandler or anything handled by DefaultServeMux calls <code>w.Header().Add(\"Server\", \"foo\")</code> (like, say, <a href=\"https://golang.org/src/net/http/httputil/reverseproxy.go?s=3769:3844#L221\" rel=\"nofollow\">httputil.ReverseProxy.ServeHTTP</a>), I end up with two Server headers in the response.</p>\n\n<pre><code>$ http localhost:5962/v1/hello_world\nHTTP/1.1 200 OK\nContent-Length: 11\nContent-Type: text/plain\nDate: Tue, 12 Jul 2016 04:54:04 GMT\nServer: inner-middleware\nServer: myapp\n</code></pre>\n\n<p>What I really want is something like this:</p>\n\n<pre><code>// Server attaches a Server header to the response.\nfunc Server(h http.Handler, serverName string) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        h.ServeHTTP(w, r)\n        w.Header().Set(\"Server\", serverName)\n    })\n}\n</code></pre>\n\n<p>However, this is <a href=\"https://golang.org/pkg/net/http/#Handler\" rel=\"nofollow\">disallowed by the semantics of ServeHTTP</a>:</p>\n\n<blockquote>\n  <p>ServeHTTP should write reply headers and data to the ResponseWriter and then return. Returning signals that the request is finished; it is not valid to use the ResponseWriter or read from the Request.Body after or concurrently with the completion of the ServeHTTP call.</p>\n</blockquote>\n\n<p>I have seen some fairly ugly hacks around this, for example the code in <a href=\"https://golang.org/src/net/http/httputil/reverseproxy.go?s=3769:3844#L221\" rel=\"nofollow\">httputil.ReverseProxy.ServeHTTP</a>, which copies headers and rewrites the response code, or using httptest.ResponseRecorder, which reads the entire body into a byte buffer.</p>\n\n<p>I could also reverse the traditional middleware order and put my Server middleware last, somehow, or make it the inner-most middleware.</p>\n\n<p>Is there any simple method I'm missing?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1468409547, "post_id": 38333481, "comment_id": 64113383, "body": "I have actually re-read your question several more times and now leaning to think you actually wanted to ask how to find hardlinked files <i>on the source filesystem</i> when they are being added to the archive, and not how to count the number of hardlinked files which are in a tar archive (the question I answered). Could you please elaborated on what really you wanted to ask?"}, {"owner": {"reputation": 113, "user_id": 6406168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/28dd9fe5587c7b329b09858e1baf498f?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/6406168/steve"}, "reply_to_user": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1468432671, "post_id": 38333481, "comment_id": 64129646, "body": "Hey kostix,  I actually did mean to ask how to count the number of hardlinks whilst streaming a tar archive. Thank you for your input though!"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1468439073, "post_id": 38333481, "comment_id": 64133194, "body": "Okay, updated my code with a PoC implementation.  Works for my test directory with hardlinks (modulo imperfect handling of file/directory names); I have no time tweaking it to work like the stock <code>tar</code>, sorry."}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6406168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/28dd9fe5587c7b329b09858e1baf498f?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/6406168/steve"}, "edited": false, "score": 0, "creation_date": 1468535426, "post_id": 38335098, "comment_id": 64180357, "body": "wow I wasn&#39;t expecting this much feedback! these are some really helpful points, thank you for sharing :)"}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 7, "last_activity_date": 1566042152, "last_edit_date": 1566042152, "creation_date": 1468343222, "answer_id": 38335098, "question_id": 38333481, "link": "https://stackoverflow.com/questions/38333481/tar-archive-preserving-hardlinks/38335098#38335098", "title": "Tar archive preserving hardlinks", "body": "<p><code>tar</code> does preserve the hardlinks.</p>\n\n<p>Here's a sample directory with three hard-linked files and one file with a single link:</p>\n\n<pre><code>foo% vdir .\ntotal 16\n-rw-r--r-- 3 kostix kostix 5 Jul 12 19:37 bar.txt\n-rw-r--r-- 3 kostix kostix 5 Jul 12 19:37 foo.txt\n-rw-r--r-- 3 kostix kostix 5 Jul 12 19:37 test.txt\n-rw-r--r-- 1 kostix kostix 9 Jul 12 19:49 xyzzy.txt\n</code></pre>\n\n<p>Now we archive it using GNU <code>tar</code> and verify it indeed added the links\n(because we didn't pass it the <code>--hard-dereferece</code> command-line option):</p>\n\n<pre><code>foo% tar -cf ../foo.tar .\nfoo% tar -tvf ../foo.tar\ndrwxr-xr-x kostix/kostix     0 2016-07-12 19:49 ./\n-rw-r--r-- kostix/kostix     9 2016-07-12 19:49 ./xyzzy.txt\n-rw-r--r-- kostix/kostix     5 2016-07-12 19:37 ./bar.txt\nhrw-r--r-- kostix/kostix     0 2016-07-12 19:37 ./test.txt link to ./bar.txt\nhrw-r--r-- kostix/kostix     0 2016-07-12 19:37 ./foo.txt link to ./bar.txt\n</code></pre>\n\n<p>The documentation of <code>archive/tar</code> refers to a bunch of documents defining the standard on the <code>tar</code> archive (and unfortunately, there's no a single standard: for instance, GNU tar does not support POSIX extended attributes, while BSD tar (which relies on <code>libarchive</code>) does, and so does <code>pax</code>).\nTo cite its bit on the hardlinks:</p>\n\n<blockquote>\n  <p>LNKTYPE</p>\n  \n  <p>This flag represents a file linked to another file, of any type,\n  previously archived. Such files are identified in Unix by each file having\n  the same device and inode number. The linked-to name is specified in the\n  linkname field with a trailing null.</p>\n</blockquote>\n\n<p>So, a hadrlink is an enrty of a special type ('1') which refers to some\n<em>preceding</em> (already archived) file by its name.</p>\n\n<p>So let's create a playground example.</p>\n\n<p>We base64-encode our archive:</p>\n\n<pre><code>foo% base64 &lt;../foo.tar | xclip -selection clipboard\n</code></pre>\n\n<p>&hellip;and write <a href=\"https://play.golang.org/p/fnxJfH8nU4\" rel=\"nofollow noreferrer\">the code</a>.\nThe archive contains a single directory, one file (type '0') another file (type '0') followed by two hardlinks (type '1') to it.</p>\n\n<p>The output from the playground example:</p>\n\n<pre><code>Archive entry '5': ./\nArchive entry '0': ./xyzzy.txt\nArchive entry '0': ./bar.txt\nArchive entry '1': ./test.txt link to ./bar.txt\nArchive entry '1': ./foo.txt link to ./bar.txt\n</code></pre>\n\n<p>So your link-counting code should:</p>\n\n<ol>\n<li><p>Scan the entire archive record-by-record.</p></li>\n<li><p>Remember any regular file (type <code>archive/tar.TypeReg</code>\nor type <code>archive/tar.TypeRegA</code>) already processed, and have a counter associated with it, which starts at 1.</p>\n\n<p>Well, in reality, you'd better be exclusive and record entries\nof all types except symbolic links and directories &mdash; because tar\narchives can contain nodes for character and block devices, and FIFOs (named pipes).</p></li>\n<li><p>When you encounter a hard link (type <code>archive/tar.TypeReg</code>),</p>\n\n<ol>\n<li>Read the <code>Linkname</code> field of its header.</li>\n<li>Look your list of \"seen\" files up and increase the counter\nof its entry which matches that name.</li>\n</ol></li>\n</ol>\n\n<h2>Update</h2>\n\n<p>As the OP actually wanted to know how to manage hardlinks on the\nsource filesystem, here's the update.</p>\n\n<p>The chief idea is that on a filesystem with POSIX semantics:</p>\n\n<ul>\n<li><p>A directory entry designating a file actually points to a special\nfilesystem metadata block called \"inode\".\nThe inode contains the number of directory entries\npointing to it.</p>\n\n<p>Creating a hardlink is actually just:</p>\n\n<ol>\n<li>Creating a new directory entry pointing to the inode\nof the original (source) file &mdash; \"the link target\" in the <code>ln</code>s terms.</li>\n<li>Incrementing the link counter in that inode.</li>\n</ol></li>\n<li><p>Hence any file is uniquely identified by two integer numbers:\nthe \"device number\" identifying the physical device hosting the filesystem\non which the file is located, and inode number identifying the file's data.</p>\n\n<p>It follows, that if two files have the same (device, inode) pairs,\nthey represent the same content.  Or, if we put it differently, one\nis a hardlink to the other.</p></li>\n</ul>\n\n<p>So, adding files to a <code>tar</code> archive while preserving the hardlinks works this way:</p>\n\n<ol>\n<li><p>Having added a file, save its (device, inode) pair to some lookup table.</p></li>\n<li><p>When adding another file, figure out its (device, inode) pair and\nlook it up in that table.</p>\n\n<p>If a matching entry is found, the file's data was already streamed,\nand we should add a hardlink.</p>\n\n<p>Otherwise, behave as in step (1).</p></li>\n</ol>\n\n<p>So here's the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"archive/tar\"\n    \"io\"\n    \"log\"\n    \"os\"\n    \"path/filepath\"\n    \"syscall\"\n)\n\ntype devino struct {\n    Dev uint64\n    Ino uint64\n}\n\nfunc main() {\n    log.SetFlags(0)\n\n    if len(os.Args) != 2 {\n        log.Fatalf(\"Usage: %s DIR\\n\", os.Args[0])\n    }\n\n    seen := make(map[devino]string)\n\n    tw := tar.NewWriter(os.Stdout)\n\n    err := filepath.Walk(os.Args[1],\n        func(fn string, fi os.FileInfo, we error) (err error) {\n            if we != nil {\n                log.Fatal(\"Error processing directory\", we)\n            }\n\n            hdr, err := tar.FileInfoHeader(fi, \"\")\n            if err != nil {\n                return\n            }\n\n            if fi.IsDir() {\n                err = tw.WriteHeader(hdr)\n                return\n            }\n\n            st := fi.Sys().(*syscall.Stat_t)\n            di := devino{\n                Dev: st.Dev,\n                Ino: st.Ino,\n            }\n\n            orig, ok := seen[di]\n            if ok {\n                hdr.Typeflag = tar.TypeLink\n                hdr.Linkname = orig\n                hdr.Size = 0\n\n                err = tw.WriteHeader(hdr)\n                return\n            }\n\n            fd, err := os.Open(fn)\n            if err != nil {\n                return\n            }\n            err = tw.WriteHeader(hdr)\n            if err != nil {\n                return\n            }\n            _, err = io.Copy(tw, fd)\n            fd.Close() // Ignoring error for a file opened R/O\n            if err == nil {\n                seen[di] = fi.Name()\n            }\n            return err\n        })\n\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    err = tw.Close()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return\n}\n</code></pre>\n\n<p>Note that it's quite inadequate:</p>\n\n<ul>\n<li><p>It improperly deals with file and directory names.</p></li>\n<li><p>It does not attempt to properly work with symlinks and FIFOs,\nand skip Unix-domain sockets etc.</p></li>\n<li><p>It assumes it works in a POSIX environment.</p>\n\n<p>On non-POSIX systems, the <code>Sys()</code> method called on a value of type\n<code>os.FileInfo</code> might return something else rather than the POSIX'y\n<code>syscall.Stat_t</code>.</p>\n\n<p>Say, on Windows, there are multiple filesystems hosted by different\n\"disks\" or \"drives\".  I have no idea how Go handles that.\nMaybe the \"device number\" had to be emulated somehow for this case.</p></li>\n</ul>\n\n<p>On the other hand, it shows how to handle hardlinks:</p>\n\n<ul>\n<li>Set the \"Linkname\" field of the header struct.</li>\n<li>Reset the \"Size\" field of the header to 0 (because no data will follow).</li>\n</ul>\n\n<p>You might also want to use another approach to maintain the lookup table: if most of your files are expected to be located on the same physical filesystem, each entry wastes an <code>uint64</code> for the device number of each entry.  So a hierarchy of maps might be a sensible thing to do: the first maps device numbers to another map which maps inode numbers to file names.</p>\n"}, {"tags": [], "owner": {"reputation": 249, "user_id": 5287455, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/--FV3Z7RE96U/AAAAAAAAAAI/AAAAAAAAHBg/VN3UdkiUKzg/photo.jpg?sz=128", "display_name": "Azat Khadiev", "link": "https://stackoverflow.com/users/5287455/azat-khadiev"}, "is_accepted": false, "score": 0, "last_activity_date": 1551601321, "creation_date": 1551601321, "answer_id": 54966889, "question_id": 38333481, "link": "https://stackoverflow.com/questions/38333481/tar-archive-preserving-hardlinks/54966889#54966889", "title": "Tar archive preserving hardlinks", "body": "<p>answer from kostix is good and detailed. just to add my 50 cents on how to save those hard links during extraction.</p>\n\n<p>during a loop on all files in tar archive (tr.Next())</p>\n\n<pre><code>if f.Size == 0 &amp;&amp; f.Linkname != \"\" {\n  // this is a hard link for another file. save it in map and create at the end\n  seen[abs] = filepath.Join(extractDir, f.Linkname)\n  continue\n}\n</code></pre>\n\n<p>and at the end:</p>\n\n<pre><code>for path, target := range seen {\n  if err := os.Link(target, path); err != nil {\n    return fmt.Errorf(\"failed to create hard link: %v\", err)\n  }\n}\n</code></pre>\n"}], "owner": {"reputation": 113, "user_id": 6406168, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/28dd9fe5587c7b329b09858e1baf498f?s=128&d=identicon&r=PG&f=1", "display_name": "steve", "link": "https://stackoverflow.com/users/6406168/steve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4013, "favorite_count": 1, "accepted_answer_id": 38335098, "answer_count": 2, "score": 4, "last_activity_date": 1566044498, "creation_date": 1468338255, "last_edit_date": 1566044498, "question_id": 38333481, "link": "https://stackoverflow.com/questions/38333481/tar-archive-preserving-hardlinks", "title": "Tar archive preserving hardlinks", "body": "<p>Using the <code>archive/tar</code> package in Go, it doesn't seem possible to access the number of hardlinks a file has. However, I remember reading somewhere that tar'ing a directory or file can preserve the hardlinks.</p>\n\n<p>Is there some package in Go that can help me do this?</p>\n"}, {"tags": ["go", "goroutine"], "answers": [{"tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": false, "score": 1, "last_activity_date": 1468337266, "creation_date": 1468337266, "answer_id": 38333134, "question_id": 38333083, "link": "https://stackoverflow.com/questions/38333083/whats-the-difference-between-for-loop-with-select-and-only-select/38333134#38333134", "title": "whats the difference between for loop with select and only select?", "body": "<p>If your program sends data to the 'something' channel a bunch of times you are going to want to repeat the select clause until you receive a done signal. </p>\n\n<p>For example imagine you are running the following routine</p>\n\n<pre><code>.... (some calculations)\nsomething &lt;- x \n.... (some calculations)\nsomething &lt;- y\ntrue &lt;- z \n</code></pre>\n\n<p>If your routine doesn't have the for loop it will only receive the value 'x' and won't receive y or z.</p>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 11, "last_activity_date": 1468337322, "creation_date": 1468337322, "answer_id": 38333155, "question_id": 38333083, "link": "https://stackoverflow.com/questions/38333083/whats-the-difference-between-for-loop-with-select-and-only-select/38333155#38333155", "title": "whats the difference between for loop with select and only select?", "body": "<p>Code with loop will <strong>keep printing</strong> data from channel <code>something</code> <strong>until</strong> it receives anything on channel <code>done</code>.</p>\n\n<p>Select-only code will <strong>either</strong> print data from channel <code>something</code> <strong>or</strong> will quit when it receives anything on channel <code>done</code>. <strong>Only one case</strong> will be executed. Keep in mind there is no fallthrough in Go <code>select</code> and <code>switch</code> statements by default.</p>\n"}, {"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 2, "last_activity_date": 1468338434, "creation_date": 1468338434, "answer_id": 38333553, "question_id": 38333083, "link": "https://stackoverflow.com/questions/38333083/whats-the-difference-between-for-loop-with-select-and-only-select/38333553#38333553", "title": "whats the difference between for loop with select and only select?", "body": "<p><code>select</code> statement executes through its <code>cases</code> (sending/receiving a the channel) once. If none of its cases are ready to be executed, it blocks until at least one of the <code>case</code> is ready to execute. If more than one cases are ready at the same time, one of the ready case is selected to be executed at random.</p>\n\n<p>So in second case, if there is some data on the <code>something</code> channel, it would be read and put into <code>s</code>. But there is also a chance of <code>true</code> being sent on <code>done</code> while the  <code>case s := &lt;-something:</code> will never be executed.</p>\n\n<p>In the first case, you probably want something like this (also in second case):</p>\n\n<pre><code>for{\n   select{\n   case s := &lt;-something:\n       fmt.Println(s)\n   case &lt;-done: // note the difference\n       return \n   }\n}\n</code></pre>\n\n<p>What this now does is that it waits for data on <code>something</code> and also keeps an eye on <code>done</code>. If there is data on <code>something</code> channel (and no data on <code>done</code>), it will be read and put into <code>s</code> (case branch <code>case s := &lt;-something:</code> will be executed with <code>s</code> having the value read from <code>something</code>). This will account for one full execution of <code>select</code> statement and the control will go back to <code>for</code> loop and it will start over again.</p>\n\n<p>If there is no data on <code>something</code> channel, <code>select</code> blocks and waits for data on either <code>something</code> or <code>done</code>. If data arrives on <code>something</code>, similar execution as above happens, otherwise if it arrives in <code>done</code>, the function returns (breaks out of loop). This way some other process can write to <code>done</code> and signal the function containing above <code>for</code> loop to stop processing <code>something</code> and return.</p>\n"}], "owner": {"reputation": 1700, "user_id": 5674583, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/8WOaR.png?s=128&g=1", "display_name": "Blue Bot", "link": "https://stackoverflow.com/users/5674583/blue-bot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 562, "favorite_count": 1, "accepted_answer_id": 38333155, "answer_count": 3, "score": 4, "last_activity_date": 1468338434, "creation_date": 1468337124, "question_id": 38333083, "link": "https://stackoverflow.com/questions/38333083/whats-the-difference-between-for-loop-with-select-and-only-select", "title": "whats the difference between for loop with select and only select?", "body": "<p>Could not fully understand it from the docs or google:</p>\n\n<p>What are the differences between the two and in \nWhich case would you use each one?</p>\n\n<pre><code>    for{\n       select{\n       case s := &lt;-something:\n           fmt.Println(s)\n       case done := &lt;-true:\n           return \n       }\n    }\n</code></pre>\n\n<p>and</p>\n\n<pre><code>       select{\n       case s := &lt;-something:\n           fmt.Println(s)\n       case done := &lt;-true:\n           return \n       }\n</code></pre>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "godoc"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1468869114, "post_id": 38331224, "comment_id": 64293952, "body": "Maybe <a href=\"https://github.com/robertkrimen/godocdown\" rel=\"nofollow noreferrer\"><code>godocdowm</code></a> + some converter like <code>pandoc</code> could work for you?"}], "answers": [{"comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 1, "creation_date": 1468420765, "post_id": 38338422, "comment_id": 64121837, "body": "this answer only says, that there is no way of packaging &quot;sub packages&quot; into one file. But what about the &quot;dead links&quot; to other packages (trying to avoid calling them sub packages)? There must be a way to create a documentation page(s) for all the packages I created with references between the packages!?"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 1, "last_activity_date": 1468355676, "creation_date": 1468355676, "answer_id": 38338422, "question_id": 38331224, "link": "https://stackoverflow.com/questions/38331224/godoc-create-html-for-entire-package/38338422#38338422", "title": "Godoc, create html for entire package", "body": "<p>Go has no notion of \"sub packages\" in reality - all packages are just packages, as you can tell by the package declaration at the top of the file not having any hierarchy. It would be unidiomatic to package all documentation for nested subdirectories into a single file - as the subdirectories contain different packages, the documentation should be separate.</p>\n"}], "owner": {"reputation": 7718, "user_id": 225885, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/pKYBo.jpg?s=128&g=1", "display_name": "jim", "link": "https://stackoverflow.com/users/225885/jim"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2189, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1589609913, "creation_date": 1468332424, "last_edit_date": 1468332814, "question_id": 38331224, "link": "https://stackoverflow.com/questions/38331224/godoc-create-html-for-entire-package", "title": "Godoc, create html for entire package", "body": "<p>How can I use <code>godoc</code> to create html documentation for an entire package. i.e. recursively. At the moment when I run:</p>\n\n<pre><code>godoc -html -goroot=\"mypath\" pkg &gt; index.html\n</code></pre>\n\n<p>I just get an <code>index.html</code> that contains information on the <code>.go</code> files in the current directory.</p>\n\n<p>There is no documentation for the other sub packages but the <code>index.html</code> does include dead links for them.</p>\n\n<p>How can I run the above command in a recursive fashion? Perhaps I am missing something because there is no mention of recursion in the <code>godoc</code> documentation.</p>\n"}, {"tags": ["go", "jwt", "microservices", "kite"], "owner": {"reputation": 8678, "user_id": 278659, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a10f8a52a8c247d8e20ee9ab59ee22f2?s=128&d=identicon&r=PG", "display_name": "j3d", "link": "https://stackoverflow.com/users/278659/j3d"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 110, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1468332045, "creation_date": 1468331627, "last_edit_date": 1468332045, "question_id": 38330918, "link": "https://stackoverflow.com/questions/38330918/how-to-use-jwt-with-kodings-kite-library", "title": "How to use JWT with Koding&#39;s Kite Library", "body": "<p>I'm trying to implement a REST API based on microservices, and the technical stack I selected for my proof of concept is:</p>\n\n<ul>\n<li>Go as the programming language</li>\n<li>Koding's Kite as the microservice library</li>\n<li>Labstack's Echo as the HTTP framework to implement the API Gateway</li>\n</ul>\n\n<p>My idea is to implement an authentication microservice that returns a JWT and a dummy test microservice that requires authentication.</p>\n\n<p>Reading some articles here and there, I thought authentication was a deal of the API Gateway and microservices didn't care about security, but looking at the Kite API it looks like I was wrong.</p>\n\n<p>Unfortunately Kite's documentation doesn't contain much info on how to use kites (services) securely.</p>\n\n<p>Given I know how to deal with JWT in a traditional REST API, could someone explain me how to use JWT with Kite?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 13641, "user_id": 1871033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30bea353b9b21b063e2be8ab57a1465e?s=128&d=identicon&r=PG", "display_name": "CherryDT", "link": "https://stackoverflow.com/users/1871033/cherrydt"}, "edited": false, "score": 0, "creation_date": 1468322943, "post_id": 38327467, "comment_id": 64069544, "body": "Not entirely sure what you mean because json.Number is a type (basically just a string) which stands for a numeral literal inside the loaded JSON structure, used because you can&#39;t map the JSON number type 1:1. As I understand, it&#39;s not a conversion function the way you think. You just need to access the field you want and convert it to a string if you want a string..."}, {"owner": {"reputation": 13641, "user_id": 1871033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30bea353b9b21b063e2be8ab57a1465e?s=128&d=identicon&r=PG", "display_name": "CherryDT", "link": "https://stackoverflow.com/users/1871033/cherrydt"}, "edited": false, "score": 0, "creation_date": 1468323094, "post_id": 38327467, "comment_id": 64069668, "body": "(JSON string fields don&#39;t need their own special type, they are just stored as Go string in the structure.)"}, {"owner": {"reputation": 13641, "user_id": 1871033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30bea353b9b21b063e2be8ab57a1465e?s=128&d=identicon&r=PG", "display_name": "CherryDT", "link": "https://stackoverflow.com/users/1871033/cherrydt"}, "edited": false, "score": 0, "creation_date": 1468323154, "post_id": 38327467, "comment_id": 64069705, "body": "Plus, the <code>json.Number</code> type is only used if you use <code>Decoder.UseNumber()</code>, I think. Otherwise it is just stored as <code>float64</code> and the problem is that huge numbers can&#39;t properly stored this way (that&#39;s why the <code>json.Number</code> type exists). See <a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/#decoderusenumber-to-the-rescue\" rel=\"nofollow noreferrer\">attilaolah.eu/2013/11/29/json-decoding-in-go/&hellip;</a>"}, {"owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "reply_to_user": {"reputation": 13641, "user_id": 1871033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/30bea353b9b21b063e2be8ab57a1465e?s=128&d=identicon&r=PG", "display_name": "CherryDT", "link": "https://stackoverflow.com/users/1871033/cherrydt"}, "edited": false, "score": 0, "creation_date": 1468323985, "post_id": 38327467, "comment_id": 64070254, "body": "@CherryDT A use case for me would be where I want to read a url query param from json. I don&#39;t care what the type of the json value is, it must always be decoded as a string"}], "answers": [{"tags": [], "owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "is_accepted": true, "score": 4, "last_activity_date": 1468324830, "last_edit_date": 1468324830, "creation_date": 1468324119, "answer_id": 38328078, "question_id": 38327467, "link": "https://stackoverflow.com/questions/38327467/decode-any-json-value-to-string-in-golang/38328078#38328078", "title": "Decode any JSON value to string in Golang", "body": "<p>Inspired by this <a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\" rel=\"nofollow\">post</a> I created a JsonString type. It will decode any string, number, boolean or null values to a string.</p>\n\n<p><a href=\"https://play.golang.org/p/ucAxwriL2K\" rel=\"nofollow\">https://play.golang.org/p/ucAxwriL2K</a></p>\n\n<pre><code>type JsonString string\ntype jsonString JsonString\nfunc (st *JsonString) UnmarshalJSON(bArr []byte) (err error) {\n    j, n, f, b := jsonString(\"\"), uint64(0), float64(0), bool(false)\n    if err = json.Unmarshal(bArr, &amp;j); err == nil {\n        *st = JsonString(j)\n        return\n    }\n    if err = json.Unmarshal(bArr, &amp;n); err == nil {\n        *st = JsonString(string(bArr[:]))\n        return\n    }\n    if err = json.Unmarshal(bArr, &amp;f); err == nil {\n        *st = JsonString(string(bArr[:]))\n        return\n    }\n    if err = json.Unmarshal(bArr, &amp;b); err == nil {\n        *st = JsonString(string(bArr[:]))\n        return\n    }\n    return\n}\n</code></pre>\n"}], "owner": {"reputation": 1885, "user_id": 639133, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4781a491e1923d56755de71fbec9d5d4?s=128&d=identicon&r=PG", "display_name": "mozey", "link": "https://stackoverflow.com/users/639133/mozey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 343, "favorite_count": 0, "accepted_answer_id": 38328078, "answer_count": 1, "score": 0, "last_activity_date": 1468408089, "creation_date": 1468322530, "last_edit_date": 1468408089, "question_id": 38327467, "link": "https://stackoverflow.com/questions/38327467/decode-any-json-value-to-string-in-golang", "title": "Decode any JSON value to string in Golang", "body": "<p>Is there a way in golang to decode any json value to a string. Similar to <a href=\"https://golang.org/pkg/encoding/json/#Number\" rel=\"nofollow\">json.Number</a> why isn't there a json.String?</p>\n\n<p>For example, the following could be decoded as indicated</p>\n\n<pre><code>{\"number\": 123}      =&gt; \"123\"\n{\"string\": \"123\"}    =&gt; \"123\"\n{\"float\" : 123.45}   =&gt; \"123.45\"\n{\"bool\"  : true}     =&gt; \"true\"\n{\"empty\" : \"\"}       =&gt; \"\"\n{\"null\"  : null}     =&gt; \"\"\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1468328946, "post_id": 38328211, "comment_id": 64074144, "body": "How can I be sure if <code>time.Location</code> is safe for concurrent use? It has not any public methods to modify it&#39;s state. But it reacts to daylight time automatically. Is this daylight time awareness concurrent-safe? Isn&#39;t something mutating back there?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1468340172, "post_id": 38328211, "comment_id": 64082682, "body": "I&#39;m sorry but I don&#39;t get the &quot;daylight time awareness&quot; bit. A <code>time.Location</code> object once created should not change its value. Do you know of some method that can perhaps mutate this object?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1468354361, "post_id": 38328211, "comment_id": 64090327, "body": "If you use <code>t.In(location)</code> (for different <code>t</code> times spanned over a year) you&#39;ll see it considers daylight saving time; despite the fact it got created just once. How does it do that? It&#39;s obviously not a <code>pure</code> (side effect free) computation. Now; if so; is it concurrent-safe?"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1468410815, "post_id": 38328211, "comment_id": 64114289, "body": "I did a quick test by creating two different objects of same location and passing in one of those to <code>t.In</code>. After this, <code>reflect.DeepEqual</code> on their values returns true. So I don&#39;t think the actual contents of <code>Location</code> object are changed even after the call to <code>In</code>. But having looked at some of the details I&#39;ll say it&#39;s probably not safe to assume concurrent access safety. So i&#39;ll be retracting my answer. Sorry about not being much help."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 1, "creation_date": 1468434783, "post_id": 38328211, "comment_id": 64130943, "body": "Actually I think participating in programming thinkering is always a great help for all of us, for this helps others to go on faster! Thanks!"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1476046257, "post_id": 38328211, "comment_id": 67177079, "body": "Would you please update your answer based on your comment, so I mark it as the answer?"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 0, "last_activity_date": 1468324505, "creation_date": 1468324505, "answer_id": 38328211, "question_id": 38326313, "link": "https://stackoverflow.com/questions/38326313/concurrent-safety-of-time-location/38328211#38328211", "title": "Concurrent Safety of time.Location", "body": "<p>The only exposed method on <code>Location</code> is <code>String</code>. <code>Location</code> itself is defined with no exported fields:</p>\n\n<pre><code>type Location struct {\n        // contains filtered or unexported fields\n}\n</code></pre>\n\n<p>So once created, it should remain unmodifiable for the rest of its life. Hence it should be safe concurrent access.</p>\n\n<p>As for <code>LoadLocation</code>, it does read from a file. So you can have a mutex protect every call to <code>LoadLocation</code>.</p>\n\n<blockquote>\n  <p>The time zone database needed by LoadLocation may not be present on\n  all systems, especially non-Unix systems. LoadLocation looks in the\n  directory or uncompressed zip file named by the ZONEINFO environment\n  variable, if any, then looks in known installation locations on Unix\n  systems, and finally looks in $GOROOT/lib/time/zoneinfo.zip.</p>\n</blockquote>\n"}], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 156, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468324505, "creation_date": 1468319447, "question_id": 38326313, "link": "https://stackoverflow.com/questions/38326313/concurrent-safety-of-time-location", "title": "Concurrent Safety of time.Location", "body": "<p>Is a <code>time.Location</code>, got from <code>time.LoadLocation(\"...\")</code> safe to be accessed concurrently?</p>\n\n<p>I ask this because I see that it does consider daylight saving time in it's calculations (Does it access a map loaded from the data zip file? Does it calculate it live? Do we need a lock for it? Or reloading is fast enough to do it every time?).</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468316472, "post_id": 38325035, "comment_id": 64065172, "body": "What&#39;s <code>true</code> in your case? Did you invoke the <code>sigHandler()</code> in a new goroutine?"}, {"owner": {"reputation": 1, "user_id": 6578511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88984a5cb62b753abe1ce8b93229237c?s=128&d=identicon&r=PG&f=1", "display_name": "Harry_LH", "link": "https://stackoverflow.com/users/6578511/harry-lh"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468316585, "post_id": 38325035, "comment_id": 64065253, "body": "No, I didn&#39;t use goroutine in the program. Sorry, what &#39;s meaning of &quot;true&quot; ?  Thanks!"}, {"owner": {"reputation": 1, "user_id": 6578511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88984a5cb62b753abe1ce8b93229237c?s=128&d=identicon&r=PG&f=1", "display_name": "Harry_LH", "link": "https://stackoverflow.com/users/6578511/harry-lh"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468316671, "post_id": 38325035, "comment_id": 64065319, "body": "Oh I see,  I mean, for true {} is an endless loop to receive signals"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468320158, "post_id": 38325035, "comment_id": 64067714, "body": "You can simply write for { without the true. I guess that is confused us a bit."}, {"owner": {"reputation": 1, "user_id": 6578511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88984a5cb62b753abe1ce8b93229237c?s=128&d=identicon&r=PG&f=1", "display_name": "Harry_LH", "link": "https://stackoverflow.com/users/6578511/harry-lh"}, "edited": false, "score": 0, "creation_date": 1468320836, "post_id": 38325035, "comment_id": 64068181, "body": "Yes, I should delete true.  Thanks.  And I also removed unnecessary codes to simply the problem.  just using main() and sighandler() codes above, I could reproduce the problem."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1468341305, "post_id": 38325035, "comment_id": 64083308, "body": "The reason fork isn&#39;t supported is because all go programs are multithreaded, and can only safely fork if immediately followed by an exec."}, {"owner": {"reputation": 1, "user_id": 6578511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88984a5cb62b753abe1ce8b93229237c?s=128&d=identicon&r=PG&f=1", "display_name": "Harry_LH", "link": "https://stackoverflow.com/users/6578511/harry-lh"}, "edited": false, "score": 0, "creation_date": 1468392414, "post_id": 38325035, "comment_id": 64102285, "body": "I use syscall.ForkExec according to your comments.  It works well now. Thank you all !"}], "owner": {"reputation": 1, "user_id": 6578511, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88984a5cb62b753abe1ce8b93229237c?s=128&d=identicon&r=PG&f=1", "display_name": "Harry_LH", "link": "https://stackoverflow.com/users/6578511/harry-lh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 218, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1468321188, "creation_date": 1468316026, "last_edit_date": 1468321188, "question_id": 38325035, "link": "https://stackoverflow.com/questions/38325035/golang-program-is-blocked-by-notify", "title": "golang program is blocked by Notify()", "body": "<p>I am a new learner of golang. I completed a daemon program and make it ready to receive signals. It worked well for the normal case. </p>\n\n<p>But if I kill the process using \"kill -9\" and restart it again, I find it is always blocked at Notify(). Until I restart OS, it could work well again. OS is centOS 7.0. Could anyone know the problem ?  I could not find any similar problem by google. Thanks a lot !</p>\n\n<p>Codes like that: Updated codes so that use following codes to reproduce problem:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"os\"\n    \"os/signal\"\n    \"syscall\"\n)\nfunc sigHandler() {\n    c := make (chan os.Signal, 1)\n    fmt.Println(\"Daemon: before Notify() \") //always appear succussfully\n\n    signal.Notify(c)\n\n    fmt.Println(\"Daemon: block to receive signal \") \n    /*if restart after \"kill\", above msg will not appear again. And this  program could not receive any sigal again...*/\n\n    //for true {  //remove true according to comments \n    for {\n        s := &lt;-c\n        fmt.Println(\"Daemon: receive signal \", s)\n    }\n}\n\nfunc main() {\n       ret, _, _:= syscall.RawSyscall(syscall.SYS_FORK, 0, 0, 0)\n       if ret &gt; 0 { //parent exit\n            os.Exit(0)\n       }\n       sigHandler() //block main to receive signal\n }\n</code></pre>\n"}, {"tags": ["go", "golint"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468317210, "post_id": 38324783, "comment_id": 64065711, "body": "Do you already have an <code>golang.org&#47;x&#47;tools&#47;go&#47;gcimporter</code> empty directory?"}, {"owner": {"reputation": 91, "user_id": 5109610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbd3dd2c66e312365cb6cfd710df7fc5?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#250;\u0161 Ka\u010dm&#225;r", "link": "https://stackoverflow.com/users/5109610/mat%c3%ba%c5%a1-ka%c4%8dm%c3%a1r"}, "reply_to_user": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468320711, "post_id": 38324783, "comment_id": 64068091, "body": "No I dont have. I&#39;ve deleted tools directory and tryed to go get it again but it result in same output"}], "owner": {"reputation": 91, "user_id": 5109610, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/fbd3dd2c66e312365cb6cfd710df7fc5?s=128&d=identicon&r=PG&f=1", "display_name": "Mat&#250;\u0161 Ka\u010dm&#225;r", "link": "https://stackoverflow.com/users/5109610/mat%c3%ba%c5%a1-ka%c4%8dm%c3%a1r"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 550, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1468397082, "creation_date": 1468315270, "last_edit_date": 1468397082, "question_id": 38324783, "link": "https://stackoverflow.com/questions/38324783/golang-package-installation-fails", "title": "Golang package installation fails", "body": "<p>I'm having a problem with package installation it worked before but suddenly I'm getting this message:</p>\n\n<pre><code>package github.com/golang/lint/golint\n    imports github.com/golang/lint\n    imports go/types: unrecognized import path \"go/types\"\npackage github.com/golang/lint/golint\n    imports github.com/golang/lint\n    imports golang.org/x/tools/go/gcimporter15\n    imports golang.org/x/tools/go/gcimporter15\n    imports golang.org/x/tools/go/gcimporter15: no buildable Go source files in /go/src/golang.org/x/tools/go/gcimporter15\n</code></pre>\n\n<p>Heres my GO env output:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/student/Documents/GO_WORKSPACE\"\nGORACE=\"\"\nGOROOT=\"/usr/local/go\"\nGOTOOLDIR=\"/usr/local/go/pkg/tool/darwin_amd64\"\nGO15VENDOREXPERIMENT=\"1\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n"}, {"tags": ["go", "redigo"], "answers": [{"tags": [], "owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "is_accepted": false, "score": 4, "last_activity_date": 1468307957, "creation_date": 1468307957, "answer_id": 38322358, "question_id": 38321645, "link": "https://stackoverflow.com/questions/38321645/how-to-expect-non-string-values-in-redigomock/38322358#38322358", "title": "How to expect non-string values in redigomock", "body": "<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-js lang-js prettyprint-override\"><code>func TestCheckPasswordFailures_LessThan5(t *testing.T) {\r\n\r\nconn := redigomock.NewConn()\r\n\r\nconn.Command(\"EXISTS\", \"test@xxx.com_pwf\").Expect([]byte(\"true\"))\r\nconn.Command(\"GET\", \"test@xxx.com_pwf\").Expect(int64(1))\r\n\r\nactual := checkPasswordFailures(conn, mockUser)\r\n\r\nassert.True(t, actual)\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n"}], "owner": {"reputation": 1768, "user_id": 899671, "user_type": "registered", "accept_rate": 37, "profile_image": "https://i.stack.imgur.com/EPYny.jpg?s=128&g=1", "display_name": "Michael Draper", "link": "https://stackoverflow.com/users/899671/michael-draper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 775, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1468339755, "creation_date": 1468305556, "last_edit_date": 1468339755, "question_id": 38321645, "link": "https://stackoverflow.com/questions/38321645/how-to-expect-non-string-values-in-redigomock", "title": "How to expect non-string values in redigomock", "body": "<p>I'm new to redigomock, and through the documentation and googling I simply can't find a valid example. I'm missing something obvious, but I would like my tests to work.</p>\n\n<p>Given this code:</p>\n\n<pre><code>var checkPasswordFailures = func(client redis.Conn, u *User) bool {\n    var userkey = getPasswordFailKey(u)\n    var existing, err = redis.Bool(client.Do(\"EXISTS\", userkey))\n\n    fmt.Printf(\"%s - existing = %v\\n\", userkey, existing)\n\n    if err != nil {\n        Log.Errorf(\"error in checkPasswordFailures: %s\", err.Error())\n    }\n    if existing == true {\n        fmt.Println(\"Existing true\")\n        reply, err := redis.Int(client.Do(\"GET\", userkey))\n\n        Log.Debug(\"Attempt Count: %d\", reply)\n\n        if err != nil {\n            Log.Errorf(\"error in checkPasswordFailures: %s\", err.Error())\n        }\n        return reply &lt; 5\n    }\n    fmt.Println(\"Using default\")\n    return true\n}\n</code></pre>\n\n<p>And this test:</p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>func TestCheckPasswordFailures_LessThan5(t *testing.T) {\r\n\r\n\tconn := redigomock.NewConn()\r\n\r\n\tconn.Command(\"EXISTS\", \"test@xxx.com_pwf\").Expect(true)\r\n\tconn.Command(\"GET\", \"test@xxx.com_pwf\").Expect(3)\r\n\r\n\tactual := checkPasswordFailures(conn, mockUser)\r\n\r\n\tassert.True(t, actual)\r\n\r\n}</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>I receive an error: </p>\n\n<blockquote>\n  <p>redigo: unexpected type for Bool, got type bool</p>\n</blockquote>\n\n<p>I've tried many approaches to coerce the value into the expected result, but to no avail.</p>\n\n<p>Any help is appreciated, thank you in advance!</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1468360115, "post_id": 38321621, "comment_id": 64093265, "body": "You need to be careful here: taking this out of your source code means that you have the potential for what&#39;s in your JSON file to not exist in your code, and so you have to test carefully (e.g. iterate over the routes.Handler field and call each one). Is there a reason that you need to have this in a JSON file instead of (say) a <code>routes.go</code> that achieves the same result? Does your service run into the scenario where you need to add routes without recompiling?"}], "answers": [{"comments": [{"owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "edited": false, "score": 0, "creation_date": 1468306668, "post_id": 38321944, "comment_id": 64059158, "body": "Thanks, but can you give an example please?"}, {"owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "reply_to_user": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "edited": false, "score": 0, "creation_date": 1468420588, "post_id": 38321944, "comment_id": 64121675, "body": "Sorry, I made a mistake - I though, that is possible to recognize all the functions from module. It is not possible - only I could is find method and execute method from object or type. That means reflect could be use only if all methods would be a method of same object."}], "tags": [], "owner": {"reputation": 938, "user_id": 4951096, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/b61a485cb682ddf00bf756e3680b3c50?s=128&d=identicon&r=PG&f=1", "display_name": "lofcek", "link": "https://stackoverflow.com/users/4951096/lofcek"}, "is_accepted": false, "score": 2, "last_activity_date": 1468306594, "creation_date": 1468306594, "answer_id": 38321944, "question_id": 38321621, "link": "https://stackoverflow.com/questions/38321621/golang-router-config-in-json-file/38321944#38321944", "title": "Golang: Router config in json file", "body": "<p>The problem is, that not every data could be marshaled to json (or unmarshaled). http.HandlerFunc is not a function (<a href=\"https://golang.org/pkg/net/http/#HandlerFunc\" rel=\"nofollow\">https://golang.org/pkg/net/http/#HandlerFunc</a>). You cannot put it directly - but you can change handler to string and on the place when you trying to call it obtain HandlerFunc from reflect (a quite complicated) or from prepared map[string]HandlerFunc.</p>\n"}, {"comments": [{"owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "edited": false, "score": 0, "creation_date": 1468307555, "post_id": 38322054, "comment_id": 64059638, "body": "I tried: var handlers = map[string]http.HandlerFunc { \t&quot;index&quot;: Index, \t&quot;countsIndex&quot;: CountsIndex, } but when I assign it I get this error: cannot use route.HandlerFunc (type http.HandlerFunc) as type string in map index"}, {"owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "edited": false, "score": 0, "creation_date": 1468307947, "post_id": 38322054, "comment_id": 64059861, "body": "Ok, I made the handler a string in the struct and then it works. But now I have to add handlers everytime I extend the config, hmm.."}, {"owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "reply_to_user": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "edited": false, "score": 0, "creation_date": 1468311076, "post_id": 38322054, "comment_id": 64061712, "body": "unfortunately in go you can&#39;t enumerate all the functions declared in a package, this should have solved the problem to add every time the handler to the map"}, {"owner": {"reputation": 764, "user_id": 1969935, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0d6f6c9d8a6b99e363bf439c42280621?s=128&d=identicon&r=PG", "display_name": "Paul A.T. Wilson", "link": "https://stackoverflow.com/users/1969935/paul-a-t-wilson"}, "edited": false, "score": 0, "creation_date": 1490808889, "post_id": 38322054, "comment_id": 73282413, "body": "Small change to this to make it work for me:  var functions = map[string]http.HandlerFunc"}], "tags": [], "owner": {"reputation": 1778, "user_id": 2303988, "user_type": "registered", "accept_rate": 38, "profile_image": "https://i.stack.imgur.com/VcVRc.jpg?s=128&g=1", "display_name": "Alessio", "link": "https://stackoverflow.com/users/2303988/alessio"}, "is_accepted": true, "score": 4, "last_activity_date": 1468306921, "creation_date": 1468306921, "answer_id": 38322054, "question_id": 38321621, "link": "https://stackoverflow.com/questions/38321621/golang-router-config-in-json-file/38322054#38322054", "title": "Golang: Router config in json file", "body": "<p>The simplest solution is to have a string instead of the http.HandlerFunc as type, and define a map with the functions.</p>\n\n<pre><code>var functions = map[string]interface{}{\n    \"func1\": func1,\n}\n</code></pre>\n\n<p>then after unmarshalling your json you can assign the handler using the handlername of each route</p>\n"}], "owner": {"reputation": 1912, "user_id": 1345266, "user_type": "registered", "accept_rate": 39, "profile_image": "https://i.stack.imgur.com/kZ0QR.jpg?s=128&g=1", "display_name": "KiwiJuicer", "link": "https://stackoverflow.com/users/1345266/kiwijuicer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 656, "favorite_count": 0, "accepted_answer_id": 38322054, "answer_count": 2, "score": 0, "last_activity_date": 1468306921, "creation_date": 1468305458, "question_id": 38321621, "link": "https://stackoverflow.com/questions/38321621/golang-router-config-in-json-file", "title": "Golang: Router config in json file", "body": "<p>I want to put my router config in an extern json config file like so:</p>\n\n<pre><code>{\n  \"routes\": [\n    {\n      \"name\": \"Index\",\n      \"method\": \"GET\",\n      \"pattern\": \"/\",\n      \"handler\": \"Index\"\n    },\n    {\n      \"name\": \"CountsIndex\",\n      \"method\": \"GET\",\n      \"pattern\": \"/counts\",\n      \"handler\": \"CountsIndex\"\n    }\n  ]\n}\n</code></pre>\n\n<p>My related struct looks like so:</p>\n\n<pre><code>type Route struct {\n    Name        string      `json:\"name\"`\n    Method      string      `json:\"method\"`\n    Pattern     string      `json:\"pattern\"`\n    HandlerFunc http.HandlerFunc    `json:\"handler\"`\n}\n\ntype Routes []Route\n</code></pre>\n\n<p>The Problem is the handlerFunc. When I get the config it will be a string but how to make it a go value? Can I cast it somehow?</p>\n\n<p>Following error occures:</p>\n\n<blockquote>\n  <p>json: cannot unmarshal string into Go value of type http.HandlerFunc</p>\n</blockquote>\n\n<p>Thanks</p>\n"}, {"tags": ["unit-testing", "google-app-engine", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1468313285, "post_id": 38322844, "comment_id": 64063010, "body": "Thanks for the answer! It works!  I chose to go with option 1 as it seemed easier to add that one line per test rather than modifying the codebase."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1468313713, "post_id": 38322844, "comment_id": 64063312, "body": "@cheeze Please see edited answer. Note that I would add this to a package <code>init()</code> function, as if you have multiple tests, you should not run the code multiple times (if it contains directives to the current folder and not absolute path)."}, {"owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "edited": false, "score": 0, "creation_date": 1468315572, "post_id": 38322844, "comment_id": 64064493, "body": "You are right - it would not make sense to call it repeatedly. Thanks for the note!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1544047411, "last_edit_date": 1544047411, "creation_date": 1468309546, "answer_id": 38322844, "question_id": 38320920, "link": "https://stackoverflow.com/questions/38320920/how-to-specify-path-of-template-for-app-engine-with-go-for-unit-testing/38322844#38322844", "title": "How to Specify Path of Template for App Engine with Go for Unit Testing?", "body": "<p>The problem is that when you run your app e.g. with <code>goapp serve</code>, the current directory is the app root (where <code>app.yaml</code> resides). So normally you provide paths relative to app root.</p>\n\n<p>But when you run tests e.g. with <code>goapp test</code>, the current directory is always the folder containing the test file being run (<code>*_test.go</code>). If the test file is not in the app root (normally it isn't), relative paths that are correctly resolved to the app root will not work when being resolved to another folder (containing the test file).</p>\n\n<p>Here are 2 options for your problem:</p>\n\n<h3>1. Change the working directory to the app root</h3>\n\n<p>You may use <a href=\"https://golang.org/pkg/os/#Chdir\" rel=\"nofollow noreferrer\"><code>os.Chdir()</code></a> to change the working directory to your app's root folder prior to calling code that uses relative paths. You may even put this into an <code>init()</code> function, or call it from your test method (whichever suits you).</p>\n\n<p>Let's assume your test file is in the folder: <code>[APP_ROOT]/my/package/some_test.go</code>. You may set the app's root like this (2 levels up in the hierarchy):</p>\n\n<pre><code>if err := os.Chdir(\"../..\"); err != nil {\n    panic(err)\n}\n</code></pre>\n\n<p>Note that I would add this line in a package init function in the test file like this:</p>\n\n<pre><code>func init() {\n    if err := os.Chdir(\"../..\"); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Because if you have multiple test functions in the test file and you run this code multiple times, the result will not be what you want (as we specified to go up 2 levels from the current).</p>\n\n<h3>2. Refactoring code</h3>\n\n<p>If you want to test code that uses relative paths, you may change / refactor the code to take the base of relative path e.g. from a variable which the test may change (knowing the current directory is its containing folder) so that the original relative path will also work when running from test and being resolved to a different base path.</p>\n\n<p>For example this base path may be the empty string <code>\"\"</code> when your app is running normally (so it will mean the current folder which in this case is the app root), and when tests are running, you may set it to the app's root (absolute path) or something like <code>\"../..\"</code> to step 2 levels up in the directory hierarchy (because current directory is the containing folder of the test file).</p>\n\n<p>You can also make the base path to which relative paths are resolved against more configurable, see this question for details: <a href=\"https://stackoverflow.com/questions/31059023/how-to-reference-a-relative-file-from-code-and-tests\">how to reference a relative file from code and tests</a></p>\n"}], "owner": {"reputation": 367, "user_id": 1075283, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/f0c08aacf97ba9d099e8575212681d1a?s=128&d=identicon&r=PG", "display_name": "cheeze", "link": "https://stackoverflow.com/users/1075283/cheeze"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 811, "favorite_count": 1, "accepted_answer_id": 38322844, "answer_count": 1, "score": 4, "last_activity_date": 1544047411, "creation_date": 1468302614, "question_id": 38320920, "link": "https://stackoverflow.com/questions/38320920/how-to-specify-path-of-template-for-app-engine-with-go-for-unit-testing", "title": "How to Specify Path of Template for App Engine with Go for Unit Testing?", "body": "<p>I'm using the built-in template package with Go on App Engine.</p>\n\n<p>I have a handler that renders a template to the output.</p>\n\n<pre><code>templates := []string{\"templates/head.html\", \"templates/footer.html\"}\n\nfunc pageIndex(w http.ResponseWriter, r *http.Request) {\n  tpls := append([]string{\"templates/index.html\"}, templates...)\n  tpl := template.Must(template.ParseFiles(tpls...))\n  err := tpl.ExecuteTemplate(w, \"index\", map[string]string{\n    \"Title\": \"Index Page\",\n  })\n\n  if err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n  }\n}\n</code></pre>\n\n<p>When I run the local development server this works fine.</p>\n\n<p>When I run the unit test to test the page, it panics and gives me the message:</p>\n\n<blockquote>\n  <p>panic: open templates/index.html: no such file or directory [recovered]</p>\n</blockquote>\n\n<p>The unit test is as follows:</p>\n\n<pre><code>func TestPageIndex(t *testing.T) {\n  inst, _ := aetest.NewInstance(nil)\n  //ignoring the errors for brevity\n  defer inst.Close()\n\n  req, _ := inst.NewRequest(\"GET\", \"/\", nil)\n  resp := httptest.NewRecorder()\n  pageIndex(resp, req)\n}\n</code></pre>\n\n<p>Basically, the problem is that for the unit test, the server is unable to find the path of the template.</p>\n\n<p>How do I specify the path for the template files when running the test?</p>\n"}, {"tags": ["json", "go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1468296467, "post_id": 38319869, "comment_id": 64055347, "body": "Define &quot;doesn&#39;t work&quot;"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1468296553, "post_id": 38319869, "comment_id": 64055372, "body": "Your struct specifies &quot;info&quot; as array of strings, but your actual json has &quot;information&quot; as an array of hashes. What&#39;s up with this?"}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 4, "last_activity_date": 1468297309, "creation_date": 1468297309, "answer_id": 38319976, "question_id": 38319869, "link": "https://stackoverflow.com/questions/38319869/parsing-a-json-file-in-go/38319976#38319976", "title": "Parsing a JSON file in Go", "body": "<p>Your problem is that your JSON data is a map of string to the struct type you defined, not the struct type directly.   If you modify your code slightly as below it works, but you need to index into the map to get each struct value:</p>\n\n<pre><code>package main\n\nimport (\n        \"encoding/json\"\n        \"fmt\"\n        \"os\"\n)\n\n//PluginInfo - struct for plugins.json\nvar PluginInfo map[string]struct { // NOTICE map of string to struct\n        LatestVersion string   `json:\"latest_version\"`\n        LastUpdated   string   `json:\"last_updated\"`\n        Popular       bool     `json:\"popular\"`\n        Info          []string `json:\"Info\"`\n}\n\n//ParsePlugins - parses plugins.json\nfunc ParsePlugins() {\n        pluginsFile, err := os.Open(\"test.json\")\n        if err != nil {\n                fmt.Println(\"opening config file\", err.Error())\n        }\n        jsonParser := json.NewDecoder(pluginsFile)\n        if err = jsonParser.Decode(&amp;PluginInfo); err != nil {\n                fmt.Println(\"parsing config file\", err.Error())\n        } else {\n                for key, val := range PluginInfo {\n                        fmt.Printf(\"Key %q, last updated %s\\n\", key, val.LastUpdated)\n                }\n        }\n        return\n}\n\nfunc main() {\n        ParsePlugins()\n}\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 3358392, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/1554063580/picture?type=large", "display_name": "user3358392", "link": "https://stackoverflow.com/users/3358392/user3358392"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 81, "favorite_count": 0, "accepted_answer_id": 38319976, "answer_count": 1, "score": 0, "last_activity_date": 1468298875, "creation_date": 1468296379, "last_edit_date": 1468298875, "question_id": 38319869, "link": "https://stackoverflow.com/questions/38319869/parsing-a-json-file-in-go", "title": "Parsing a JSON file in Go", "body": "<p>I am having trouble parsing a JSON file in Go.</p>\n\n<p>I am not getting any errors, but I am not getting an output.</p>\n\n<p>I have tried a few different methods, but I can't seem to get any to work. \nAny help would be greatly appreciated. Thanks in advance. </p>\n\n<pre><code>package simplefiles\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\n//PluginInfo - struct for plugins.json\nvar PluginInfo struct {\n    LatestVersion   string   `json:\"latest_version\"`\n    LastUpdated     string   `json:\"last_updated\"`\n    Popular         bool     `json:\"popular\"`\n    Info            []string `json:\"Info\"`\n}\n\n//ParsePlugins - parses plugins.json\nfunc ParsePlugins() {\n    pluginsFile, err := os.Open(\"test.json\")\n    if err != nil {\n        fmt.Println(\"opening config file\", err.Error())\n    }\n    jsonParser := json.NewDecoder(pluginsFile)\n    if err = jsonParser.Decode(&amp;PluginInfo); err != nil {\n        fmt.Println(\"parsing config file\", err.Error())\n    } else {\n        fmt.Printf(PluginInfo.LastUpdated)\n    }\n    return\n}\n</code></pre>\n\n<p><strong>JSON Sample:</strong></p>\n\n<pre><code>{  \n   \"my-test-site\":{  \n      \"latest_version\":\"6.4.5\",\n      \"last_updated\":\"2016-05-22T00:23:00.000Z\",\n      \"popular\":true,\n      \"infomation\":[  \n         {  \n            \"id\":6043,\n            \"title\":\"Test info 1\",\n            \"created_at\":\"2014-08-01T10:58:35.000Z\",\n            \"updated_at\":\"2015-05-15T13:47:24.000Z\",\n            \"published_date\":null,\n            \"references\":{  \n               \"url\":[  \n                  \"http://samplesite1.com\",\n                  \"http://samplesite2.com\"\n               ]\n            },\n            \"site_type\":\"info\",\n            \"fixed_v\":\"1.10\"\n         }\n      ]\n   },\n   \"another-test-site\":{  \n      \"latest_version\":\"2.1.0\",\n      \"last_updated\":\"2016-06-12T08:36:00.000Z\",\n      \"popular\":false,\n      \"infomation\":[  \n         {  \n            \"id\":6044,\n            \"title\":\"Test site 2 info\",\n            \"created_at\":\"2014-08-01T10:58:35.000Z\",\n            \"updated_at\":\"2015-05-15T13:47:24.000Z\",\n            \"published_date\":null,\n            \"references\":{  \n               \"otherinfo\":[  \n                  \"blah blah blah\"\n               ]\n            },\n            \"site_type\":\"search\",\n            \"fixed_v\":\"1.2.0\"\n         }\n      ]\n   }\n}\n</code></pre>\n"}, {"tags": ["go", "deadlock", "channel"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1468355938, "post_id": 38319358, "comment_id": 64091256, "body": "This isn&#39;t actually a deadlock - you don&#39;t have two threads contending a resource, you have one thread waiting on data that&#39;s never going to come. There is no locking involved."}, {"owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1468370365, "post_id": 38319358, "comment_id": 64096077, "body": "In go error message a very similar situation calls for a deadlock: <code>throw: all goroutines are asleep - deadlock!</code>; but I see your point"}], "answers": [{"tags": [], "owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "is_accepted": true, "score": 7, "last_activity_date": 1468292592, "creation_date": 1468292592, "answer_id": 38319359, "question_id": 38319358, "link": "https://stackoverflow.com/questions/38319358/undetected-deadlock-while-reading-from-channel/38319359#38319359", "title": "Undetected &quot;deadlock&quot; while reading from channel", "body": "<p>The trick is to use <code>sync.WaitGroup</code> and wait for the tasks to finish in a non-blocking way.</p>\n\n<pre><code>var wg sync.WaitGroup\n\n// we can't know how many tasks there will be\nfor i := 0; i &lt; rand.Intn(1&lt;&lt;8)+1&lt;&lt;8; i++ {\n    wg.Add(1)\n    go func(i int) {\n        time.Sleep(time.Second)\n        results &lt;- i\n        wg.Done()\n    }(i)\n}\n\n// wait for all tasks to finish in other thread\ngo func() {\n    wg.Wait()\n    close(results)\n}()\n\n// execution continues here so you can print results\n</code></pre>\n\n<p>See also: <a href=\"https://blog.golang.org/pipelines#TOC_4.\">Go Concurrency Patterns: Pipelines and cancellation - The Go Blog</a></p>\n"}], "owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "accepted_answer_id": 38319359, "answer_count": 1, "score": 4, "last_activity_date": 1468370398, "creation_date": 1468292592, "last_edit_date": 1495540736, "question_id": 38319358, "link": "https://stackoverflow.com/questions/38319358/undetected-deadlock-while-reading-from-channel", "title": "Undetected &quot;deadlock&quot; while reading from channel", "body": "<p>How do I deal with a situation where undetected deadlock occurs when reading results of execution of uncertain number tasks from a channel in a complex program, e.g. web server?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc main() {\n    rand.Seed(time.Now().UTC().UnixNano())\n\n    results := make(chan int, 100)\n\n    // we can't know how many tasks there will be\n    for i := 0; i &lt; rand.Intn(1&lt;&lt;8)+1&lt;&lt;8; i++ {\n        go func(i int) {\n            time.Sleep(time.Second)\n            results &lt;- i\n        }(i)\n    }\n\n    // can't close channel here \n    // because it is still written in\n    //close(results)\n\n    // something else is going on other threads (think web server)\n    // therefore a deadlock won't be detected\n    go func() {\n        for {\n            time.Sleep(time.Second)\n        }\n    }()\n\n    for j := range results {\n        fmt.Println(j)\n        // we just stuck in here\n    }\n}\n</code></pre>\n\n<p>In case of simpler programs go <a href=\"https://stackoverflow.com/questions/12398359/throw-all-goroutines-are-asleep-deadlock\">detects a deadlock and properly fails</a>. Most examples either fetch a known number of results, or write to the channel sequentially.</p>\n"}, {"tags": ["performance", "go"], "comments": [{"owner": {"reputation": 2536, "user_id": 6452829, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-YQenITiE8GQ/AAAAAAAAAAI/AAAAAAAAAEE/x6XN5G1_FWA/photo.jpg?sz=128", "display_name": "Mario Santini", "link": "https://stackoverflow.com/users/6452829/mario-santini"}, "edited": false, "score": 3, "creation_date": 1468270069, "post_id": 38315860, "comment_id": 64048306, "body": "According to the documentation initialize a map literal it is &#39;functional identical&#39; to do it with &#39;make&#39;. I think this could be take as performance ==."}], "answers": [{"tags": [], "owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "is_accepted": true, "score": 5, "last_activity_date": 1468290210, "last_edit_date": 1468290210, "creation_date": 1468289801, "answer_id": 38318985, "question_id": 38315860, "link": "https://stackoverflow.com/questions/38315860/in-golang-is-there-any-performance-difference-between-maps-initialized-using-ma/38318985#38318985", "title": "in golang, is there any performance difference between maps initialized using make vs {}", "body": "<p>On my machine they appear to be about equivalent.</p>\n\n<p>You can easily make a benchmark test to compare.  For example:</p>\n\n<pre><code>package bench\n\nimport \"testing\"\n\nvar result map[string]int\n\nfunc BenchmarkMakeLiteral(b *testing.B) {\n        var m map[string]int\n        for n := 0; n &lt; b.N; n++ {\n                m = InitMapLiteral()\n        }\n        result = m\n}\n\nfunc BenchmarkMakeMake(b *testing.B) {\n        var m map[string]int\n        for n := 0; n &lt; b.N; n++ {\n                m = InitMapMake()\n        }\n        result = m\n}\n\nfunc InitMapLiteral() map[string]int {\n        return map[string]int{}\n}\n\nfunc InitMapMake() map[string]int {\n        return make(map[string]int)\n}\n</code></pre>\n\n<p>Which on 3 different runs yielded results that are close enough to be insignificant:</p>\n\n<h3>First Run</h3>\n\n<pre><code>$ go test -bench=.\ntesting: warning: no tests to run\nPASS\nBenchmarkMakeLiteral-8  10000000               160 ns/op\nBenchmarkMakeMake-8     10000000               171 ns/op\nok      github.com/johnweldon/bench     3.664s\n</code></pre>\n\n<h3>Second Run</h3>\n\n<pre><code>$ go test -bench=.\ntesting: warning: no tests to run\nPASS\nBenchmarkMakeLiteral-8  10000000               182 ns/op\nBenchmarkMakeMake-8     10000000               173 ns/op\nok      github.com/johnweldon/bench     3.945s\n</code></pre>\n\n<h3>Third Run</h3>\n\n<pre><code>$ go test -bench=.\ntesting: warning: no tests to run\nPASS\nBenchmarkMakeLiteral-8  10000000               170 ns/op\nBenchmarkMakeMake-8     10000000               170 ns/op\nok      github.com/johnweldon/bench     3.751s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 2, "last_activity_date": 1468324982, "creation_date": 1468324982, "answer_id": 38328384, "question_id": 38315860, "link": "https://stackoverflow.com/questions/38315860/in-golang-is-there-any-performance-difference-between-maps-initialized-using-ma/38328384#38328384", "title": "in golang, is there any performance difference between maps initialized using make vs {}", "body": "<p>When allocating empty maps there is no difference but with <code>make</code> you can pass second parameter to pre-allocate space in map. This will save a lot of reallocations when maps are being populated.</p>\n\n<h2>Benchmarks</h2>\n\n<pre><code>package maps\n\nimport \"testing\"\n\nconst SIZE = 10000\n\nfunc fill(m map[int]bool, size int) {\n    for i := 0; i &lt; size; i++ {\n        m[i] = true\n    }\n}\n\nfunc BenchmarkEmpty(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        m := make(map[int]bool)\n        fill(m, SIZE)\n    }\n}\n\nfunc BenchmarkAllocated(b *testing.B) {\n    for n := 0; n &lt; b.N; n++ {\n        m := make(map[int]bool, 2*SIZE)\n        fill(m, SIZE)\n    }\n}\n</code></pre>\n\n<h2>Results</h2>\n\n<pre><code>go test -benchmem -bench .\nBenchmarkEmpty-8             500       2988680 ns/op      431848 B/op        625 allocs/op\nBenchmarkAllocated-8        1000       1618251 ns/op      360949 B/op         11 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 802, "user_id": 2018909, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/10ebdad579fc333db3830e893baf977e?s=128&d=identicon&r=PG", "display_name": "srini", "link": "https://stackoverflow.com/users/2018909/srini"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 875, "favorite_count": 1, "accepted_answer_id": 38318985, "answer_count": 2, "score": 7, "last_activity_date": 1468324982, "creation_date": 1468269703, "question_id": 38315860, "link": "https://stackoverflow.com/questions/38315860/in-golang-is-there-any-performance-difference-between-maps-initialized-using-ma", "title": "in golang, is there any performance difference between maps initialized using make vs {}", "body": "<p>as we know there are two ways to initialize a map (as listed below). I'm wondering if there is any performance difference between the two approaches.</p>\n\n<pre><code>var myMap map[string]int\n</code></pre>\n\n<p>then</p>\n\n<pre><code>myMap = map[string]int{}\n</code></pre>\n\n<p>vs </p>\n\n<pre><code>myMap = make(map[string]int)\n</code></pre>\n"}, {"tags": ["rest", "go", "instagram", "instagram-api"], "comments": [{"owner": {"reputation": 86, "user_id": 5311270, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5e0939c9669e62e2da3b0f2a6ecb70f?s=128&d=identicon&r=PG&f=1", "display_name": "Sujay Menasinakai", "link": "https://stackoverflow.com/users/5311270/sujay-menasinakai"}, "edited": false, "score": 0, "creation_date": 1468309168, "post_id": 38312188, "comment_id": 64060579, "body": "Please Check this link <a href=\"http://stackoverflow.com/questions/38136783/get-access-token-using-windows-services-or-console-app-for-instagram-api/38149095#38149095\">http://stackoverflow.com/questions/38136783/get-access-token&zwnj;&#8203;-using-windows-servi&zwnj;&#8203;ces-or-console-app-f&zwnj;&#8203;or-instagram-api/381&zwnj;&#8203;49095#38149095</a>"}], "answers": [{"tags": [], "owner": {"reputation": 2747, "user_id": 3521420, "user_type": "registered", "profile_image": "https://graph.facebook.com/1054781629/picture?type=large", "display_name": "Jonathan Allen Grant", "link": "https://stackoverflow.com/users/3521420/jonathan-allen-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1468257896, "creation_date": 1468257896, "answer_id": 38312748, "question_id": 38312188, "link": "https://stackoverflow.com/questions/38312188/when-i-try-to-connect-to-oauth2-0-with-the-instagram-api-i-get-a-400-bad-resu/38312748#38312748", "title": "When I try to connect to oauth2.0 with the Instagram API, I get a 400 - Bad Result back from api.instagram.com. Why?", "body": "<p>Both the code I was passing in and the redirectURI were wrong. The redirectURI has to match the one used in the authorization step.</p>\n"}], "owner": {"reputation": 2747, "user_id": 3521420, "user_type": "registered", "profile_image": "https://graph.facebook.com/1054781629/picture?type=large", "display_name": "Jonathan Allen Grant", "link": "https://stackoverflow.com/users/3521420/jonathan-allen-grant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 0, "accepted_answer_id": 38312748, "answer_count": 1, "score": 2, "last_activity_date": 1468257896, "creation_date": 1468255788, "question_id": 38312188, "link": "https://stackoverflow.com/questions/38312188/when-i-try-to-connect-to-oauth2-0-with-the-instagram-api-i-get-a-400-bad-resu", "title": "When I try to connect to oauth2.0 with the Instagram API, I get a 400 - Bad Result back from api.instagram.com. Why?", "body": "<p>Here is my code in golang to connect to the instagram api</p>\n\n<pre><code>if resp, err := http.PostForm(\"https://api.instagram.com/oauth/access_token\", url.Values{\"client_secret\": {appSecret}, \"grant_type\": {\"authorization_code\"},\n        \"redirect_uri\": {redirectUri}, \"client_id\": {appId}, \"code\": {code},\n    }); err == nil {\n        log.Info(\"%s\", resp)\n    } else {\n        return 500, ctr.ErrorResponse(500, err.Error())\n    }\n</code></pre>\n\n<p>and when I print out my response, I get this</p>\n\n<pre><code>&amp;{400 Bad Request %!s(int=400) HTTP/2.0 %!s(int=2) %!s(int=0) map[Content-Length:[114] Expires:[Sat, 01 Jan 2000 00:00:00 GMT] Vary:[Cookie, Accept-Language] Pragma:[no-cache] Cache-Control:[private, no-cache, no-store, must-revalidate] Set-Cookie:[csrftoken=gUnoNsIbM8edetUJO126sp28WZmC1BuO; expires=Mon, 10-Jul-2017 16:45:38 GMT; Max-Age=31449600; Path=/] Content-Language:[en] Date:[Mon, 11 Jul 2016 16:45:38 GMT] Content-Type:[application/json]] {%!s(*http.http2clientStream=&amp;{0xc8201a6f20 0xc82017e380 1 0xc820a26b40 {{0 0} {0xc820d12160 {0 &lt;nil&gt; &lt;nil&gt;} 0 859544035736} 0xc82022e3f0 0xc82000a0e0 &lt;nil&gt; &lt;nil&gt; 0x1f3760} true {10485760 0xc8201a6f68} {4194190 0xc8201a6f78} 114 &lt;nil&gt; 0xc82000b280 0xc820a26ba0 &lt;nil&gt; 0xc820a26c00 true false map[] 0xc820dc6078})} %!s(int64=114) [] %!s(bool=false) map[] %!s(*http.Request=&amp;{POST 0xc82040a180 HTTP/1.1 1 1 map[Content-Type:[application/x-www-form-urlencoded]] {0xc82043b820} 234 [] false api.instagram.com map[] map[] &lt;nil&gt; map[]   &lt;nil&gt; &lt;nil&gt;}) %!s(*tls.ConnectionState=&amp;{771 true false 49199 h2 true  [0xc8201fcd80 0xc8201fd200] [[0xc8201fcd80 0xc8201fd200 0xc820b28900]] [] [] [203 149 65 158 231 245 216 167 215 32 166 255]})}\n</code></pre>\n\n<p>What's going on and how can I fix it?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 36869, "user_id": 102371, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/262d914b9ff3f5b7f599de600cf463a8?s=128&d=identicon&r=PG", "display_name": "John Weldon", "link": "https://stackoverflow.com/users/102371/john-weldon"}, "edited": false, "score": 0, "creation_date": 1468296584, "post_id": 38311467, "comment_id": 64055379, "body": "Your import paths don&#39;t appear to be valid.  At least the third_party folder does not exist on the github repository."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1468304357, "post_id": 38311467, "comment_id": 64057937, "body": "I don&#39;t understand what you are asking? You want to import a package without using import? Could you make a smaller example, where it is clear what you want to do."}, {"owner": {"reputation": 1288, "user_id": 5938227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O9cUT.png?s=128&g=1", "display_name": "dieuhd", "link": "https://stackoverflow.com/users/5938227/dieuhd"}, "reply_to_user": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1468304506, "post_id": 38311467, "comment_id": 64058006, "body": "@apxp: yes, i want to import a package and run funcs of this package without <code>import</code>"}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1468304826, "post_id": 38311467, "comment_id": 64058154, "body": "@dieuhd But Go is a compiled language. If you use a function this function should be compiled. To do so you need to import that package or at least copy just the function inside your package."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1468305559, "post_id": 38311467, "comment_id": 64058537, "body": "Vendoring and dependencies are really a very big thing inside the Go community. Maybe you are interested in vendoring: <a href=\"https://docs.google.com/document/d/1Bz5-UB7g2uPBdOx-rw5t9MxJwkfpx90cqG9AFL0JAYo/edit#\" rel=\"nofollow noreferrer\">docs.google.com/document/d/&hellip;</a>!"}], "owner": {"reputation": 1288, "user_id": 5938227, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/O9cUT.png?s=128&g=1", "display_name": "dieuhd", "link": "https://stackoverflow.com/users/5938227/dieuhd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 125, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1468371129, "creation_date": 1468253138, "last_edit_date": 1468371129, "question_id": 38311467, "link": "https://stackoverflow.com/questions/38311467/how-to-run-a-function-with-package-name-and-function-name-in-golang", "title": "how to run a function with package name and function name in golang?", "body": "<p>I want to run a function without <code>import</code>, if i have function name and package name.</p>\n\n<p>I tried use <code>loader</code>,<code>ssa</code> ... lib, but only get package name and function name. same the <a href=\"https://play.golang.org/p/YHj2WuSiEK\" rel=\"nofollow\">example</a>. I want to get output when run function with package name and function name</p>\n\n<p>Have any solution?</p>\n"}, {"tags": ["go", "yaml"], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1468251797, "creation_date": 1468251797, "answer_id": 38311054, "question_id": 38310894, "link": "https://stackoverflow.com/questions/38310894/golang-nested-yaml-values/38311054#38311054", "title": "Golang nested Yaml values", "body": "<p>I think you have an extra level of nesting. The <code>Config</code> struct may not be required. Could you try the following definitions:</p>\n\n<pre><code>type Ecs struct {\n    Services []Service\n}\n\ntype Service struct {\n    Name           string\n    TaskDefinition string\n    DesiredCount   int\n}\n</code></pre>\n\n<p>And then try to unmarshal the yaml data. You can then perhaps access the data as <code>ecs.Services</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 5861, "user_id": 951414, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/82155035c493a583d2d92aa1d13eaf7e?s=128&d=identicon&r=PG", "display_name": "dlsniper", "link": "https://stackoverflow.com/users/951414/dlsniper"}, "is_accepted": false, "score": 1, "last_activity_date": 1468265312, "creation_date": 1468265312, "answer_id": 38314714, "question_id": 38310894, "link": "https://stackoverflow.com/questions/38310894/golang-nested-yaml-values/38314714#38314714", "title": "Golang nested Yaml values", "body": "<p>You should use struct tags since you name the fields with lower case letters. This applies to different named fields as well.</p>\n\n<p>See the example for how to fix this: <a href=\"https://play.golang.org/p/WMmlQsqYeB\" rel=\"nofollow\">https://play.golang.org/p/WMmlQsqYeB</a> the other answer is incorrect.</p>\n"}, {"comments": [{"owner": {"reputation": 1452, "user_id": 1502378, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/5194b3f8ade37c7ff8ef968db456b8e7?s=128&d=identicon&r=PG", "display_name": "meh", "link": "https://stackoverflow.com/users/1502378/meh"}, "edited": false, "score": 0, "creation_date": 1557968893, "post_id": 47198590, "comment_id": 98947355, "body": "My use case was go templates. Unmarshalling yaml into <code>map[interface{}]interface{}</code> is working so far (I&#39;ve been using it for a full 30 seconds)."}], "tags": [], "owner": {"reputation": 41, "user_id": 3440704, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/T8PCR.jpg?s=128&g=1", "display_name": "Santosh Srinivas", "link": "https://stackoverflow.com/users/3440704/santosh-srinivas"}, "is_accepted": false, "score": 4, "last_activity_date": 1510220843, "creation_date": 1510220843, "answer_id": 47198590, "question_id": 38310894, "link": "https://stackoverflow.com/questions/38310894/golang-nested-yaml-values/47198590#47198590", "title": "Golang nested Yaml values", "body": "<p>I had a similar requirement where on a yaml file i was needed to perform nested retrievals. As i found no out of the box solution i had to write it myself. </p>\n\n<p>I have a yaml file having content like below</p>\n\n<pre><code>\"a\": \"Easy!\"\n\"b\":\n  \"c\": \"2\"\n  \"d\": [\"3\", \"4\"]\n\"e\":\n  \"f\": {\"g\":\"hi\",\"h\":\"6\"}\n</code></pre>\n\n<p>I wanted to access and print nested values from this structure and the output should be like below</p>\n\n<pre><code>--- yaml-&gt;a: Easy!\n--- yaml-&gt;b-&gt;c: 2\n--- yaml-&gt;b-&gt;x: None  //not existing in the yaml\n--- yaml-&gt;y-&gt;w: None  //not existing in the yaml\n--- yaml-&gt;b-&gt;d[0]: 3   //accessing value from a list\n--- yaml-&gt;e-&gt;f-&gt;g: hi \n</code></pre>\n\n<p>I also did not want to define a structure to hold the parsed yaml. The most generic structure in golang is interface{}. The most suitable structure to unmarshall the yaml is <code>map[interface{}]interface{}</code>. For folks coming from java this is akin to <code>Map&lt;Object,Object&gt;</code>. Once the data is unmarshalled i had to write a function which can traverse the structure using nested keys and return the value.</p>\n\n<p>Below is the code to do it. Turn on the comments and execute to know how the code traverses nested structure and finally gets the value. Though this example assumes all the values in the yaml are string this can be extended for numerical keys and values as well.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v2\"\n    \"io/ioutil\"\n    \"reflect\"\n)\n\nfunc main() {\n\n    testFile := \"test.yaml\"\n    testYaml, rerr := ioutil.ReadFile(testFile)\n    if rerr != nil {\n        fmt.Errorf(\"error reading yaml file: %v\", rerr)\n    }\n\n    m := make(map[interface{}]interface{})\n    if uerr := yaml.Unmarshal([]byte(testYaml), &amp;m); uerr != nil {\n        fmt.Errorf(\"error parsing yaml file: %v\", uerr)\n    }\n\n    fmt.Printf(\"--- yaml-&gt;a: %v\\n\\n\", getValue(m, []string{\"a\"}, -1))         //single value in a map\n    fmt.Printf(\"--- yaml-&gt;b-&gt;c: %v\\n\\n\", getValue(m, []string{\"b\", \"c\"}, -1)) //single value in a nested map\n    fmt.Printf(\"--- yaml-&gt;b-&gt;x: %v\\n\\n\", getValue(m, []string{\"b\", \"x\"}, -1)) //value for a non existent nest key\n    fmt.Printf(\"--- yaml-&gt;y-&gt;w: %v\\n\\n\", getValue(m, []string{\"y\", \"w\"}, -1)) //value for a non existent nest key\n    fmt.Printf(\"--- yaml-&gt;b-&gt;d[0]: %v\\n\\n\", getValue(m, []string{\"b\", \"d\"}, 0))\n    fmt.Printf(\"--- yaml-&gt;e-&gt;f-&gt;g: %v\\n\\n\", getValue(m, []string{\"e\", \"f\", \"g\"}, -1))\n}\n\nfunc getValue(obj map[interface{}]interface{}, keys []string, indexOfElementInArray int) string {\n\n    //fmt.Printf(\"--- Root object:\\n%v\\n\\n\", obj)\n    value := \"None\"\n    queryObj := obj\n    for i := range keys {\n        if queryObj == nil {\n            break\n        }\n        if i == len(keys)-1 {\n            break\n        }\n        key := keys[i]\n        //fmt.Printf(\"--- querying for sub object keyed by %v\\n\", key)\n        if queryObj[key] != nil {\n            queryObj = queryObj[key].(map[interface{}]interface{})\n            //fmt.Printf(\"--- Sub object keyed by %v :\\n%v\\n\\n\", key, queryObj)\n        } else {\n            //fmt.Printf(\"--- No sub object keyed by %v :\\n%v\\n\\n\", key)\n            break\n        }\n    }\n    if queryObj != nil {\n        lastKey := keys[len(keys)-1]\n        //fmt.Printf(\"--- querying for value keyed by %v\\n\", lastKey)\n\n        if queryObj[lastKey] != nil {\n            objType := reflect.TypeOf(queryObj[lastKey])\n            //fmt.Printf(\"Type of value %v\\n\", objType)\n            if objType.String() == \"[]interface {}\" {\n                //fmt.Printf(\"Object is a array %v\\n\", objType)\n                tempArr := queryObj[lastKey].([]interface{})\n                //fmt.Printf(\"Length of array is %v\\n\", len(tempArr))\n                if indexOfElementInArray &gt;= 0 &amp;&amp; indexOfElementInArray &lt; len(tempArr) {\n                    value = queryObj[lastKey].([]interface{})[indexOfElementInArray].(string)\n                }\n            } else {\n                value = queryObj[lastKey].(string)\n            }\n        }\n    }\n\n    return value\n}\n</code></pre>\n"}], "owner": {"reputation": 567, "user_id": 2442168, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d37ccab219555941fa5b88bd02284a05?s=128&d=identicon&r=PG", "display_name": "smugcloud", "link": "https://stackoverflow.com/users/2442168/smugcloud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9702, "favorite_count": 0, "answer_count": 3, "score": 5, "last_activity_date": 1510220843, "creation_date": 1468251314, "question_id": 38310894, "link": "https://stackoverflow.com/questions/38310894/golang-nested-yaml-values", "title": "Golang nested Yaml values", "body": "<p>I am trying to access Yaml files and grab individual values, but am struggling with the Struct syntax to achieve this.  The code below processes the Yaml and I can print the full Struct, but how can I access the individual <code>ecs.services.name</code> attribute?</p>\n\n<p>Any recommendations on how to handle this is welcome as I have come across several Yaml libraries but haven't been able to get any of them to fully work.</p>\n\n<p><strong>test.yaml:</strong></p>\n\n<pre><code>ecs:\n  services:\n    - name: my-service\n      taskDefinition: my-task-def\n      desiredCount: 1\n</code></pre>\n\n<p><strong>Yaml.go</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"io/ioutil\"\n    \"path/filepath\"\n\n    \"gopkg.in/yaml.v2\"\n)\n\ntype Config struct {\n    //Ecs []map[string]string this works for ecs with name\n    Ecs struct {\n        Services []struct {\n            Name           string\n            TaskDefinition string\n            DesiredCount   int\n        }\n    }\n    //Services []map[string][]string\n}\n\nfunc main() {\n    filename, _ := filepath.Abs(\"test.yaml\")\n\n    yamlFile, err := ioutil.ReadFile(filename)\n    check(err)\n\n    var config Config\n\n    err = yaml.Unmarshal(yamlFile, &amp;config)\n    check(err)\n\n    fmt.Printf(\"Description: %#v\\n\", config.Ecs.Services)\n}\n\nfunc check(e error) {\n    if e != nil {\n        panic(e)\n    }\n}\n</code></pre>\n\n<p><strong>Output</strong></p>\n\n<pre><code>$ go run yaml.go\nDescription: []struct { Name string; TaskDefinition string; DesiredCount int }{struct { Name string; TaskDefinition string; DesiredCount int }{Name:\"my-service\", TaskDefinition:\"\", DesiredCount:0}}\n</code></pre>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1468250822, "post_id": 38309982, "comment_id": 64038116, "body": "You might want to post your C code.  Having trouble determining exactly where your problem lies."}, {"owner": {"reputation": 71, "user_id": 6508692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1191626897555168/picture?type=large", "display_name": "Marcin Szydelski", "link": "https://stackoverflow.com/users/6508692/marcin-szydelski"}, "reply_to_user": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1468250980, "post_id": 38309982, "comment_id": 64038220, "body": "All needed C code is in /* */ -&gt; function test is my problem in a pill."}, {"owner": {"reputation": 5779, "user_id": 876686, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/0dc9f06a29ef13328a46d31db59634ea?s=128&d=identicon&r=PG", "display_name": "tier1", "link": "https://stackoverflow.com/users/876686/tier1"}, "edited": false, "score": 0, "creation_date": 1468269971, "post_id": 38309982, "comment_id": 64048264, "body": "For reference, a somewhat related question.  <a href=\"http://stackoverflow.com/questions/492384/how-to-find-the-sizeofa-pointer-pointing-to-an-array\" title=\"how to find the sizeofa pointer pointing to an array\">stackoverflow.com/questions/492384/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 71, "user_id": 6508692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1191626897555168/picture?type=large", "display_name": "Marcin Szydelski", "link": "https://stackoverflow.com/users/6508692/marcin-szydelski"}, "edited": false, "score": 0, "creation_date": 1468314110, "post_id": 38310862, "comment_id": 64063539, "body": "Unfortunately it is still not working as expected. When You change snprintf(out, 16, &quot;1234567890abcd&quot;); into something longer than 26 chars, for example: snprintf(out, 30, &quot;123456789012345678901234567&quot;); program crashes:  *** Error in `/tmp/go-build755328986/command-line-arguments/_obj/exe/stri&zwnj;&#8203;ngs&#39;: free(): invalid next size (fast): 0x0000000001f99010 *** ======= Backtrace: ========= /lib64/libc.so.6(+0x7d053)[0x7f3fa64f2053] /tmp/go-build755328986/command-line-arguments/_obj/exe/strin&zwnj;&#8203;gs[0x436925] ======= Memory map: ======== ..."}], "tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": false, "score": 7, "last_activity_date": 1468251208, "creation_date": 1468251208, "answer_id": 38310862, "question_id": 38309982, "link": "https://stackoverflow.com/questions/38309982/change-value-of-golang-c-string-variable-in-c-function/38310862#38310862", "title": "Change value of golang C.String variable in C function", "body": "<p>You are calling the function <code>sizeof</code> on a pointer. The size of a pointer is 8 bytes on your computer so you are getting back a string of length 8.</p>\n\n<p>I don't know all the details of how exactly you should be managing your pointer size, since i'm not that good at C but this example illustrates how to solve your immediate issue.</p>\n\n<pre><code>package main\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\nint test(char *out){\n  snprintf(out, 16, \"1234567890abcd\");\n  return 0;\n}\n\n*/\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"unsafe\"\n)\n\nfunc main() {\n    foo := C.CString(\"\")\n    defer C.free(unsafe.Pointer(foo))\n    C.test(foo)\n    fmt.Println(\"Output is: \"+C.GoString(foo))\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 71, "user_id": 6508692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1191626897555168/picture?type=large", "display_name": "Marcin Szydelski", "link": "https://stackoverflow.com/users/6508692/marcin-szydelski"}, "is_accepted": true, "score": 4, "last_activity_date": 1468317033, "creation_date": 1468317033, "answer_id": 38325417, "question_id": 38309982, "link": "https://stackoverflow.com/questions/38309982/change-value-of-golang-c-string-variable-in-c-function/38325417#38325417", "title": "Change value of golang C.String variable in C function", "body": "<p>After a research i found a solution:</p>\n\n<pre><code>package main\n\n\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\nint test(char *out, int len){\n  snprintf(out, len, \"1234567890123456789012345671`iknvcap9nv1-93hbf1-39b\");\n  return 0;\n\n}\n\n*/\nimport \"C\"\n\nimport (\n  \"fmt\"\n  \"unsafe\"\n)\n\nfunc main() {\n  buf := make([]byte, 8192)\n  C.test((*C.char)(unsafe.Pointer(&amp;buf[0])), C.int(len(buf)))\n  fmt.Println(string(buf))\n}\n</code></pre>\n\n<p>To receive 'string' from C function, i had to create a slice:</p>\n\n<pre><code>  buf := make([]byte, 8192)\n</code></pre>\n\n<p>and pass a pointer to it:</p>\n\n<pre><code>  C.test((*C.char)(unsafe.Pointer(&amp;buf[0])), C.int(len(buf)))\n</code></pre>\n\n<p><strong>Using C.String in that situation is not working.</strong></p>\n"}, {"tags": [], "owner": {"reputation": 985, "user_id": 1345639, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/65bf9f6495938e6dcad5300af72ba5f3?s=128&d=identicon&r=PG", "display_name": "Adam B", "link": "https://stackoverflow.com/users/1345639/adam-b"}, "is_accepted": false, "score": 0, "last_activity_date": 1597850923, "last_edit_date": 1597850923, "creation_date": 1597850304, "answer_id": 63490178, "question_id": 38309982, "link": "https://stackoverflow.com/questions/38309982/change-value-of-golang-c-string-variable-in-c-function/63490178#63490178", "title": "Change value of golang C.String variable in C function", "body": "<p>For anyone coming across this in the future, C.CString does actually work, you just can't use sizeof with a pointer as this is always 8 chars. I did it the following way:</p>\n<pre><code>package main\n\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n\nint test(char* out){\n  strcpy(out, &quot;1234567890123456789012345671`iknvcap9nv1-93hbf1-39b&quot;);\n  return 0;\n}\n\n*/\nimport &quot;C&quot;\n\nimport (\n    &quot;fmt&quot;\n    &quot;unsafe&quot;\n)\n\nfunc main() {\n    foo := C.CString(&quot;&quot;)\n    defer C.free(unsafe.Pointer(foo))\n    C.test(foo)\n    fmt.Println(&quot;Output is: &quot; + C.GoString(foo))\n}\n</code></pre>\n"}], "owner": {"reputation": 71, "user_id": 6508692, "user_type": "registered", "profile_image": "https://graph.facebook.com/1191626897555168/picture?type=large", "display_name": "Marcin Szydelski", "link": "https://stackoverflow.com/users/6508692/marcin-szydelski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2095, "favorite_count": 1, "accepted_answer_id": 38325417, "answer_count": 3, "score": 3, "last_activity_date": 1597850923, "creation_date": 1468248646, "last_edit_date": 1468251028, "question_id": 38309982, "link": "https://stackoverflow.com/questions/38309982/change-value-of-golang-c-string-variable-in-c-function", "title": "Change value of golang C.String variable in C function", "body": "<p>i want to get an int and string from C function.\nint - error code, string - the data.</p>\n\n<p>Tried that way:</p>\n\n<pre><code>package main\n/*\n#include &lt;stdlib.h&gt;\n#include &lt;string.h&gt;\n#include &lt;stdio.h&gt;\n\nint test(char *out){\n  snprintf(out, sizeof out, \"1234567890abcd\");\n  return 0;\n}\n\n*/\nimport \"C\"\n\nimport (\n  \"fmt\"\n  \"unsafe\"\n)\n\nfunc main() {\n  foo := C.CString(\"\")\n  defer C.free(unsafe.Pointer(foo))\n  C.test(foo)\n  fmt.Println(\"Output is: \"+C.GoString(foo))\n}\n</code></pre>\n\n<p>and it almost worked.</p>\n\n<blockquote>\n  <blockquote>\n    <blockquote>\n      <p>Output is: 1234567</p>\n    </blockquote>\n  </blockquote>\n</blockquote>\n\n<p>but should be: 1234567890abcd</p>\n\n<p>I think that size of C.String passed to C function is 8.\nBut don't know how can I extend it (fixed size &lt;> 8) or change into dynamic.</p>\n\n<p>So the question is: How should I pass that variable to C?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 2, "creation_date": 1468246630, "post_id": 38307373, "comment_id": 64035229, "body": "this will lead to an infinite loop if e isn&#39;t in the buffer."}], "tags": [], "owner": {"reputation": 3895, "user_id": 3169754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sP8Pj.png?s=128&g=1", "display_name": "gavv", "link": "https://stackoverflow.com/users/3169754/gavv"}, "is_accepted": true, "score": 4, "last_activity_date": 1468267412, "last_edit_date": 1468267412, "creation_date": 1468241321, "answer_id": 38307373, "question_id": 38307234, "link": "https://stackoverflow.com/questions/38307234/why-am-i-getting-an-never-ending-loop-when-reading-from-a-byte-buffer/38307373#38307373", "title": "Why am I getting an never ending loop when reading from a byte.Buffer", "body": "<p>Because your <a href=\"https://tour.golang.org/flowcontrol/1\" rel=\"nofollow\"><em>post statement</em></a> of the for-loop is empty (you have only <em>init statement</em>), so you don't read next byte every iteration (<code>v</code> is always <code>'u'</code>).</p>\n\n<p>Here is the <a href=\"https://play.golang.org/p/O09kf0f6aI\" rel=\"nofollow\">fixed version</a>:</p>\n\n<pre><code>b := bytes.NewBuffer([]byte(\"uoiea\"))\nfor v, _ := b.ReadByte(); v != 'e'; v, _ = b.ReadByte() {\n    println(\"The value is \" + string(v))\n}\n</code></pre>\n\n<p>As mentioned in comments, it's also recommended to check the error to avoid infinite loop when there is no <code>'e'</code> byte:</p>\n\n<pre><code>b := bytes.NewBuffer([]byte(\"uoiea\"))\nfor v, e := b.ReadByte(); v != 'e' &amp;&amp; e == nil; v, e = b.ReadByte() {\n    println(\"The value is \" + string(v))\n}\n</code></pre>\n\n<p><code>ReadBytes</code> returns <code>io.EOF</code> error when buffer is empty.</p>\n"}, {"tags": [], "owner": {"reputation": 2547, "user_id": 6255980, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/454bc16f39711097b06e71a597725238?s=128&d=identicon&r=PG&f=1", "display_name": "jussius", "link": "https://stackoverflow.com/users/6255980/jussius"}, "is_accepted": false, "score": 3, "last_activity_date": 1468251910, "creation_date": 1468251910, "answer_id": 38311096, "question_id": 38307234, "link": "https://stackoverflow.com/questions/38307234/why-am-i-getting-an-never-ending-loop-when-reading-from-a-byte-buffer/38311096#38311096", "title": "Why am I getting an never ending loop when reading from a byte.Buffer", "body": "<p>You are only reading the buffer once, when you are entering the loop. So the value of <code>v</code> will always be <code>'u'</code>. You could solve it by reading the next byte in for loop's post statement also:</p>\n\n<pre><code>for v, _ := b.ReadByte(); v != 'e'; v, _ = b.ReadByte() {\n    // This works as long as there is an 'e' in your buffer\n    // Otherwise this goes to infinite loop also, as you are discarding error\n</code></pre>\n\n<p>But your second example is actually better and less ugly way to do this. There's nothing wrong with using <code>break</code> in loops like this. Actually it's very idiomatic in Go to write <code>Read()</code> loops as conditionless <code>for</code> loops and <code>break</code> from the loop when appropriate (usually when you get an <code>io.EOF</code> error indicating you reached the end of whatever you are reading). It leads to code that is easier to read, especially when there are many conditions that should cause <code>break</code>. The idiomatic and preferred (IMHO) way to write the code would be this:</p>\n\n<pre><code>b := bytes.NewBuffer([]byte(\"uoiea\"))\nfor {\n    v, err := b.ReadByte()\n\n    if err == io.EOF {\n        // End of buffer. Should always break here to avoid infinite loop.\n        break\n    }\n    if err != nil {\n        // Error other than io.EOF means something went wrong with reading.\n        // Should handle it appropriately. Here I'll just panic.\n        panic(err)\n    }\n\n    if v == 'e' {\n        break\n    }\n    println(\"The value is \" + string(v))\n}\n</code></pre>\n\n<p>Which is almost the same as your working example. Just with error checks. But the <code>io.EOF</code> error check especially is very important, otherwise you''ll be stuck in infinite loop if there is no <code>'e'</code> in your buffer.</p>\n"}], "owner": {"reputation": 268, "user_id": 1309003, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/0267b02cd6a5c643fdb454835b590db2?s=128&d=identicon&r=PG", "display_name": "Kunashu", "link": "https://stackoverflow.com/users/1309003/kunashu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 708, "favorite_count": 0, "accepted_answer_id": 38307373, "answer_count": 2, "score": 1, "last_activity_date": 1468267412, "creation_date": 1468240933, "question_id": 38307234, "link": "https://stackoverflow.com/questions/38307234/why-am-i-getting-an-never-ending-loop-when-reading-from-a-byte-buffer", "title": "Why am I getting an never ending loop when reading from a byte.Buffer", "body": "<p>Currently I'm writing a program that is reading a buffer from bytes.Buffer. Its supposed to stop reading when it finds the character e. But when I was reading the buffer using a for loop I noticed something odd. When I put the byte reading as part of the for statement I get an infinity loop (<a href=\"https://play.golang.org/p/fV50sqvI8x\" rel=\"nofollow\">example in go playground</a>):</p>\n\n<pre><code>b := bytes.NewBuffer([]byte(\"uoiea\"))\nfor v, _ := b.ReadByte(); v != 'e'; {\n    println(\"The value is \" + string(v))\n}\n</code></pre>\n\n<p>But if I removed it and put it inside the for loop, it doesn't (<a href=\"https://play.golang.org/p/1UwENFqj0X\" rel=\"nofollow\">example in go playground</a>):</p>\n\n<pre><code>b := bytes.NewBuffer([]byte(\"uoiea\"))\nfor ;; {\n    v, _ := b.ReadByte()\n    println(\"The value is \" + string(v))\n    if v == 'e'{\n        break\n    }\n}\n</code></pre>\n\n<p>Does anyone know why is this? I find it that adding the break expression is a very ugly and error prone way to solve this.</p>\n"}, {"tags": ["go", "unicode", "utf-8"], "comments": [{"owner": {"reputation": 20069, "user_id": 596219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a385671d1a06953de272d02e8095dd?s=128&d=identicon&r=PG", "display_name": "\u4e00\u4e8c\u4e09", "link": "https://stackoverflow.com/users/596219/%e4%b8%80%e4%ba%8c%e4%b8%89"}, "edited": false, "score": 0, "creation_date": 1468241072, "post_id": 38305668, "comment_id": 64031038, "body": "What&#39;s a &quot;Unicode newline&quot;?"}, {"owner": {"reputation": 11297, "user_id": 49560, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fd84d6f2c427f22ffc1b06982bb7bdf0?s=128&d=identicon&r=PG", "display_name": "simplfuzz", "link": "https://stackoverflow.com/users/49560/simplfuzz"}, "reply_to_user": {"reputation": 20069, "user_id": 596219, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d4a385671d1a06953de272d02e8095dd?s=128&d=identicon&r=PG", "display_name": "\u4e00\u4e8c\u4e09", "link": "https://stackoverflow.com/users/596219/%e4%b8%80%e4%ba%8c%e4%b8%89"}, "edited": false, "score": 0, "creation_date": 1468241879, "post_id": 38305668, "comment_id": 64031613, "body": "<a href=\"https://en.wikipedia.org/wiki/Newline#Unicode\" rel=\"nofollow noreferrer\">en.wikipedia.org/wiki/Newline#Unicode</a>"}, {"owner": {"reputation": 1506, "user_id": 8689709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cd57855e7bff23fbca35abc8ddc0073?s=128&d=identicon&r=PG", "display_name": "Bill Zelenko", "link": "https://stackoverflow.com/users/8689709/bill-zelenko"}, "edited": false, "score": 0, "creation_date": 1536979642, "post_id": 38305668, "comment_id": 91629207, "body": "t := strings.TrimSpace(s)"}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 4, "last_activity_date": 1468247282, "creation_date": 1468247282, "answer_id": 38309489, "question_id": 38305668, "link": "https://stackoverflow.com/questions/38305668/golang-removing-all-unicode-newline-characters-from-a-string/38309489#38309489", "title": "Golang - Removing all Unicode newline characters from a string", "body": "<p>You can use <a href=\"https://golang.org/pkg/strings/#Map\" rel=\"nofollow\"><code>strings.Map</code></a>:</p>\n\n<pre><code>func filterNewLines(s string) string {\n    return strings.Map(func(r rune) rune {\n        switch r {\n        case 0x000A, 0x000B, 0x000C, 0x000D, 0x0085, 0x2028, 0x2029:\n            return -1\n        default:\n            return r\n        }\n    }, s)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/43I9ckDVzH\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}], "owner": {"reputation": 11297, "user_id": 49560, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/fd84d6f2c427f22ffc1b06982bb7bdf0?s=128&d=identicon&r=PG", "display_name": "simplfuzz", "link": "https://stackoverflow.com/users/49560/simplfuzz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2918, "favorite_count": 2, "accepted_answer_id": 38309489, "answer_count": 1, "score": 4, "last_activity_date": 1468247282, "creation_date": 1468236045, "last_edit_date": 1495541342, "question_id": 38305668, "link": "https://stackoverflow.com/questions/38305668/golang-removing-all-unicode-newline-characters-from-a-string", "title": "Golang - Removing all Unicode newline characters from a string", "body": "<p>How do I remove all Unicode newlines from a UTF-8 string in GoLang? I found <a href=\"https://stackoverflow.com/a/7836692/49560\">this answer for PHP</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468224546, "post_id": 38301657, "comment_id": 64020517, "body": "From the link you posted: -m=&quot;GET&quot;: the http request method"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468224579, "post_id": 38301657, "comment_id": 64020535, "body": "I would guess you simply write -m=&quot;POST&quot; instead."}, {"owner": {"reputation": 2713, "user_id": 3664629, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd0e689accf22b71e7b020f321538a0?s=128&d=identicon&r=PG&f=1", "display_name": "Kumaran", "link": "https://stackoverflow.com/users/3664629/kumaran"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468226567, "post_id": 38301657, "comment_id": 64021640, "body": "@TehSphinX -m=&quot;POST&quot; just specifies the method. How do I send parameters?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468227523, "post_id": 38301657, "comment_id": 64022203, "body": "Hmmm... I followed the -m parameter in the code where it finally ends up being given to this function: req, _ := http.NewRequest(meth, url_, nil) -- meth in there is the -m parameter. But the third parameter is nil and that is where the body (your params) would have to go."}, {"owner": {"reputation": 2713, "user_id": 3664629, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd0e689accf22b71e7b020f321538a0?s=128&d=identicon&r=PG&f=1", "display_name": "Kumaran", "link": "https://stackoverflow.com/users/3664629/kumaran"}, "reply_to_user": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468227875, "post_id": 38301657, "comment_id": 64022434, "body": "@TehSphinX Can you explain me using an example go-wrk command with post params?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "edited": false, "score": 0, "creation_date": 1468230824, "post_id": 38301657, "comment_id": 64024389, "body": "see my answer below."}], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1468231569, "last_edit_date": 1468231569, "creation_date": 1468230800, "answer_id": 38303965, "question_id": 38301657, "link": "https://stackoverflow.com/questions/38301657/how-to-send-post-data-value-in-go-wrk-command/38303965#38303965", "title": "How to send post data value in go-wrk command?", "body": "<p>Unless I am mistaken, it is (currently) not supported to pass post parameters.</p>\n\n<p>I figured that from the code of go-wrk by following the -m=\"POST\" parameter which suggests otherwise. (Offering the method \"POST\" of course does not imply you can also pass parameters)</p>\n\n<p>The parameter is parsed in <a href=\"https://github.com/adjust/go-wrk/blob/master/main.go\" rel=\"nofollow\">main.go</a>:19:</p>\n\n<pre><code>method            = flag.String(\"m\", \"GET\", \"the http request method\")\n</code></pre>\n\n<p>then passed on to client in <a href=\"https://github.com/adjust/go-wrk/blob/master/single_node.go\" rel=\"nofollow\">single_node.go</a>:16:</p>\n\n<pre><code>go StartClient(\n    toCall,\n    *headers,\n    *method,\n    *disableKeepAlives,\n    responseChannel,\n    wg,\n    *totalCalls,\n)\n</code></pre>\n\n<p>where it is received in third place in \"meth\" variable (<a href=\"https://github.com/adjust/go-wrk/blob/master/client.go\" rel=\"nofollow\">client.go</a>:14):</p>\n\n<pre><code>func StartClient(url_, heads, meth string, dka bool, responseChan chan *Response, waitGroup *sync.WaitGroup, tc int) {\n</code></pre>\n\n<p>and then used here (<a href=\"https://github.com/adjust/go-wrk/blob/master/client.go\" rel=\"nofollow\">client.go</a>:55): </p>\n\n<pre><code>req, _ := http.NewRequest(meth, url_, nil)\nsets := strings.Split(heads, \"\\n\")\n\n//Split incoming header string by \\n and build header pairs\nfor i := range sets {\n    split := strings.SplitN(sets[i], \":\", 2)\n    if len(split) == 2 {\n        req.Header.Set(split[0], split[1])\n    }\n}\n\ntimer := NewTimer()\nfor {\n    timer.Reset()\n\n    resp, err := tr.RoundTrip(req)\n\n    respObj := &amp;Response{}\n\n    (...)\n\n    responseChan &lt;- respObj\n}\n</code></pre>\n\n<p>If post parameters would be passable, they would have to be put somewhere into the Request as you can lookup on the <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow\">golang http package</a> website:</p>\n\n<pre><code>func NewRequest(method, urlStr string, body io.Reader) (*Request, error)\n</code></pre>\n\n<p><em>NewRequest returns a new Request given a method, URL, and optional body.</em></p>\n"}], "owner": {"reputation": 2713, "user_id": 3664629, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/8cd0e689accf22b71e7b020f321538a0?s=128&d=identicon&r=PG&f=1", "display_name": "Kumaran", "link": "https://stackoverflow.com/users/3664629/kumaran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 393, "favorite_count": 0, "accepted_answer_id": 38303965, "answer_count": 1, "score": 0, "last_activity_date": 1468231569, "creation_date": 1468223182, "question_id": 38301657, "link": "https://stackoverflow.com/questions/38301657/how-to-send-post-data-value-in-go-wrk-command", "title": "How to send post data value in go-wrk command?", "body": "<p>In curl, I can send post data by -d flag like below example <br></p>\n\n<pre><code>curl -X POST -d'{\"accountID\":\"1\"}' localhost:1234/geInfo\n</code></pre>\n\n<p>How am I supposed to send accountID value in <a href=\"https://github.com/adjust/go-wrk\" rel=\"nofollow\">go-wrk</a> command for a post request?</p>\n"}, {"tags": ["image", "go", "fonts", "draw"], "comments": [{"owner": {"reputation": 10358, "user_id": 1211175, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/il5eC.jpg?s=128&g=1", "display_name": "Endre Simo", "link": "https://stackoverflow.com/users/1211175/endre-simo"}, "edited": false, "score": 0, "creation_date": 1468219640, "post_id": 38299930, "comment_id": 64017885, "body": "This package explicitly states that it only provides an interface for font faces. <code>&quot;Other packages provide font face implementations. For example, a truetype package would provide one based on .ttf font files.&quot;</code>"}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468222401, "post_id": 38300583, "comment_id": 64019338, "body": "@sanmai See edited answer, I included an example how to use <code>basicfont.Face7x13</code>."}, {"owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "edited": false, "score": 0, "creation_date": 1468223166, "post_id": 38300583, "comment_id": 64019751, "body": "thanks, just about it! Only it prints the lines <a href=\"http://i.imgur.com/sPoxcAb.png\" rel=\"nofollow noreferrer\">half cut</a>"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "edited": false, "score": 0, "creation_date": 1468223666, "post_id": 38300583, "comment_id": 64020015, "body": "@sanmai Is your <code>img</code> you pass big enough? Maybe it&#39;s cut because you position the text below the bottom of the image?"}, {"owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "edited": false, "score": 0, "creation_date": 1468224021, "post_id": 38300583, "comment_id": 64020237, "body": "Well, that was all my fault because I overdraw the label later in the program. Thanks!"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "edited": false, "score": 0, "creation_date": 1468231195, "post_id": 38300583, "comment_id": 64024626, "body": "@sanmai Good to hear (that issue wasn&#39;t in my code). Added a usage example which creates an images, draws text on it and saves result in a file."}, {"owner": {"reputation": 6092, "user_id": 34441, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95b4df79451afb371e0d5f60e86d9988?s=128&d=identicon&r=PG", "display_name": "ellisbben", "link": "https://stackoverflow.com/users/34441/ellisbben"}, "edited": false, "score": 1, "creation_date": 1490729090, "post_id": 38300583, "comment_id": 73239685, "body": "<code>One or more of the answers is exemplary and worthy of an additional bounty.</code> indeed!"}, {"owner": {"reputation": 4719, "user_id": 2676845, "user_type": "registered", "accept_rate": 56, "profile_image": "https://i.stack.imgur.com/TTFOs.jpg?s=128&g=1", "display_name": "fstanis", "link": "https://stackoverflow.com/users/2676845/fstanis"}, "edited": false, "score": 2, "creation_date": 1496534252, "post_id": 38300583, "comment_id": 75701592, "body": "There&#39;s a newer <a href=\"https://github.com/golang/freetype/blob/master/example/drawer/main.go\" rel=\"nofollow noreferrer\">example/drawer/main.go</a> which I&#39;d urge anyone looking into using this to check out - it features some newer functions like MeasureText which make things a whole lot easier."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 65, "last_activity_date": 1468393955, "last_edit_date": 1468393955, "creation_date": 1468219234, "answer_id": 38300583, "question_id": 38299930, "link": "https://stackoverflow.com/questions/38299930/how-to-add-a-simple-text-label-to-an-image-in-go/38300583#38300583", "title": "How to add a simple text label to an image in Go?", "body": "<p>The <a href=\"https://godoc.org/golang.org/x/image/font\" rel=\"noreferrer\"><code>golang.org/x/image/font</code></a> package just defines interfaces for font faces and drawing text on images.</p>\n\n<p>You may use the Go implementation of Freetype font rasterizer: <a href=\"https://github.com/golang/freetype\" rel=\"noreferrer\"><code>github.com/golang/freetype</code></a>.</p>\n\n<p>The key type is <a href=\"http://godoc.org/github.com/golang/freetype#Context\" rel=\"noreferrer\"><code>freetype.Context</code></a>, it has all the methods you need.</p>\n\n<p>For a complete example, check out this file: <a href=\"https://github.com/golang/freetype/blob/master/example/freetype/main.go\" rel=\"noreferrer\"><code>example/freetype/main.go</code></a>. This example loads a font file, creates and configures <code>freetype.Context</code>, draws text on image and saves the result image to file.</p>\n\n<p>Let's assume you already have the font file loaded, and a <code>c</code> context configured (see the example how to do that). Then your <code>addLabel()</code> function could look like this:</p>\n\n<pre><code>func addLabel(img *image.RGBA, x, y int, label string) {\n    c.SetDst(img)\n    size := 12.0 // font size in pixels\n    pt := freetype.Pt(x, y+int(c.PointToFixed(size)&gt;&gt;6))\n\n    if _, err := c.DrawString(label, pt); err != nil {\n        // handle error\n    }\n}\n</code></pre>\n\n<p>If you don't want to hassle with the <code>freetype</code> package and external font files, the <a href=\"https://godoc.org/golang.org/x/image/font/basicfont\" rel=\"noreferrer\"><code>font/basicfont</code></a> package contains a basic font named <code>Face7x13</code> whose graphical data is entirely self-contained. This is how you could use that:</p>\n\n<pre><code>import (\n    \"golang.org/x/image/font\"\n    \"golang.org/x/image/font/basicfont\"\n    \"golang.org/x/image/math/fixed\"\n    \"image\"\n    \"image/color\"\n)\n\nfunc addLabel(img *image.RGBA, x, y int, label string) {\n    col := color.RGBA{200, 100, 0, 255}\n    point := fixed.Point26_6{fixed.Int26_6(x * 64), fixed.Int26_6(y * 64)}\n\n    d := &amp;font.Drawer{\n        Dst:  img,\n        Src:  image.NewUniform(col),\n        Face: basicfont.Face7x13,\n        Dot:  point,\n    }\n    d.DrawString(label)\n}\n</code></pre>\n\n<p>This is how this <code>addLabel()</code> function can be used: the code below creates a new image, draws the <code>\"Hello Go\"</code> text on it and saves it in a file named <code>hello-go.png</code>:</p>\n\n<pre><code>func main() {\n    img := image.NewRGBA(image.Rect(0, 0, 300, 100))\n    addLabel(img, 20, 30, \"Hello Go\")\n\n    f, err := os.Create(\"hello-go.png\")\n    if err != nil {\n        panic(err)\n    }\n    defer f.Close()\n    if err := png.Encode(f, img); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n\n<p>Note the above code also requires the <a href=\"https://golang.org/pkg/image/png/\" rel=\"noreferrer\"><code>\"image/png\"</code></a> package import.</p>\n\n<p>Also note that the <code>y</code> coordinate given will be the bottom line of the text. So if you want to draw a line to the top left corner, you have to use <code>x = 0</code> and <code>y = 13</code> (13 is the height of this <code>Face7x13</code> font). If you wish, you could build this into the <code>addLabel()</code> function by subtracting <code>13</code> from the <code>y</code> coordinate, so that the passed <code>y</code> coordinate would be the top coordinate at which the text will be drawn.</p>\n\n<p>There is also an additional self-contained font in the <a href=\"https://godoc.org/golang.org/x/image/font/inconsolata\" rel=\"noreferrer\"><code>golang.org/x/image/font/inconsolata</code></a> package with regular and bold style, to use them, you only need to specify a different <a href=\"https://godoc.org/golang.org/x/image/font#Face\" rel=\"noreferrer\"><code>Face</code></a> in <code>addLabel()</code>:</p>\n\n<pre><code>import \"golang.org/x/image/font/inconsolata\"\n\n        // To use regular Inconsolata font family:\n        Face: inconsolata.Regular8x16,\n\n        // To use bold Inconsolata font family:\n        Face: inconsolata.Bold8x16,\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2305, "user_id": 2549212, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/QxlCO.jpg?s=128&g=1", "display_name": "Yatender Singh", "link": "https://stackoverflow.com/users/2549212/yatender-singh"}, "is_accepted": false, "score": 13, "last_activity_date": 1488017883, "creation_date": 1488017883, "answer_id": 42454716, "question_id": 38299930, "link": "https://stackoverflow.com/questions/38299930/how-to-add-a-simple-text-label-to-an-image-in-go/42454716#42454716", "title": "How to add a simple text label to an image in Go?", "body": "<p>here is the sample code using gg library where we already have src.jpg or any image and we write text over it.. you can adjust canvas size accordingly .. it's just example. let me know if it doesn't work.</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/fogleman/gg\"\n    \"log\"\n)\n\nfunc main() {\n    const S = 1024\n    im, err := gg.LoadImage(\"src.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    dc := gg.NewContext(S, S)\n    dc.SetRGB(1, 1, 1)\n    dc.Clear()\n    dc.SetRGB(0, 0, 0)\n    if err := dc.LoadFontFace(\"/Library/Fonts/Arial.ttf\", 96); err != nil {\n        panic(err)\n    }\n    dc.DrawStringAnchored(\"Hello, world!\", S/2, S/2, 0.5, 0.5)\n\n    dc.DrawRoundedRectangle(0, 0, 512, 512, 0)\n    dc.DrawImage(im, 0, 0)\n    dc.DrawStringAnchored(\"Hello, world!\", S/2, S/2, 0.5, 0.5)\n    dc.Clip()\n    dc.SavePNG(\"out.png\")\n}\n</code></pre>\n"}], "owner": {"reputation": 23249, "user_id": 93540, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/0c65ea6e0452cb127010585a52b66d34?s=128&d=identicon&r=PG", "display_name": "sanmai", "link": "https://stackoverflow.com/users/93540/sanmai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20668, "favorite_count": 16, "accepted_answer_id": 38300583, "answer_count": 2, "score": 43, "last_activity_date": 1490322470, "creation_date": 1468216159, "last_edit_date": 1468235611, "question_id": 38299930, "link": "https://stackoverflow.com/questions/38299930/how-to-add-a-simple-text-label-to-an-image-in-go", "title": "How to add a simple text label to an image in Go?", "body": "<p>Given <code>image.RGBA</code>, coordinates, and a line of text, how do I add a simple label with any plain fixed font? E.g. <code>Face7x13</code> from <a href=\"https://godoc.org/golang.org/x/image/font/basicfont\" rel=\"noreferrer\"><code>font/basicfont</code></a>.</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/png\"\n    \"os\"\n)\n\nfunc main() {\n    img := image.NewRGBA(image.Rect(0, 0, 320, 240))\n    x, y := 100, 100\n    addLabel(img, x, y, \"Test123\")\n    png.Encode(os.Stdout, img)\n}\n\nfunc addLabel(img *image.RGBA, x, y int, label string) {\n     col := color.Black\n     // now what?\n}\n</code></pre>\n\n<p>Alignment doesn't really matter, but best if I could write the label above a line which starts at the coordinates.</p>\n\n<p>And I would like to avoid external loadable dependencies like fonts.</p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "edited": false, "score": 0, "creation_date": 1468237392, "post_id": 38300611, "comment_id": 64028497, "body": "I want to test if code works when there is an error in  <code>v, err := strconv.Atoi(env)</code> inside the Sync() method"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "edited": false, "score": 1, "creation_date": 1468239627, "post_id": 38300611, "comment_id": 64030034, "body": "Like mentioned above, <code>SetTestEnv(&quot;PORT&quot;, &quot;any string&quot;)</code> sets the port number to a string that cannot be converted to a number. In this case, calling <code>Sync</code> would result is an error that the first <code>if</code> in the test function is testing."}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1468240438, "last_edit_date": 1468240438, "creation_date": 1468219359, "answer_id": 38300611, "question_id": 38299819, "link": "https://stackoverflow.com/questions/38299819/how-to-test-method-with-reflect/38300611#38300611", "title": "How to test method with reflect?", "body": "<p>If you want to test changes made to <code>Cofig</code> after calling <code>Sync</code>, in your tests define a function that sets the environment:</p>\n\n<pre><code>func SetTestEnv(key, value string) error; err != nil {\n    if err := os.Setenv(key, value string) {\n        return err\n    }\n    return nil\n}\n</code></pre>\n\n<p>Now in you test function for <code>Sync</code>, create a test config, initialize test environment using the above method and call <code>Sync</code> on the config value. <code>strconv</code> defines <code>NumError</code> specifically for failed conversions. You can make use of that:</p>\n\n<pre><code>func TestSync(t *testing.T) {\n    c : Config{ \n        // initialize config, or do it through another method\n        // e.g. func InitConfig(...) *Config {..}\n    }\n\n    // set the environment\n    SetTestEnv(\"APP_NAME\", \"app name\")\n    SetTestEnv(\"BASE_URL\", \"base url\")\n    SetTestEnv(\"PORT\", \"port number\") // will cause error\n    // etc..\n\n    if err := c.Sync(); err != nil {\n        e, ok := err.(*strconv.NumError)\n        if !ok {\n            t.Errorf(\"Unexpected error\")\n        } else if e.Err != strconv.ErrSyntax { // check specifically for expected syntax error\n            t.Errorf(\"Expected conversion to fail\")\n        }\n\n    }\n\n    SetTestEnv(\"PORT\", \"1000\") // correct port number\n\n    if err := c.Sync(); err != nil {\n        t.Errorf(\"Unexpected error in Sync: %v\", err)\n    }\n}\n</code></pre>\n\n<p>Since you are ensuring <code>Set</code> is called with correct value type using type switches, there should not be any cause for panic to occur.</p>\n"}], "owner": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 160, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1468240438, "creation_date": 1468215594, "question_id": 38299819, "link": "https://stackoverflow.com/questions/38299819/how-to-test-method-with-reflect", "title": "How to test method with reflect?", "body": "<p>I have a method Sync() that overrides <code>Config</code> field's values that are set in the environment.\nThe environment variable names are derived from config fields by underscoring, and uppercasing the name. E.g. AppName will have a corresponding environment variable APP_NAME</p>\n\n<p>Please help me to test the following cases. There are complex things like <a href=\"https://golang.org/pkg/reflect/#Value.Set\" rel=\"nofollow\">https://golang.org/pkg/reflect/#Value.Set</a>:      </p>\n\n<blockquote>\n  <p>Set assigns x to the value v. It panics if CanSet returns false. As in\n  Go, x's value must be assignable to v's type.</p>\n</blockquote>\n\n<p>So I don't know how to test this case?</p>\n\n<pre><code>import (\n    \"encoding/json\"\n    \"errors\"\n    \"fmt\"\n     \"os\"\n    \"path/filepath\"\n    \"reflect\"\n    \"strconv\"\n    \"strings\"\n    \"github.com/BurntSushi/toml\"\n    \"github.com/fatih/camelcase\"\n    \"gopkg.in/yaml.v2\"\n)\n\ntype Config struct {\n    AppName   string \n    BaseURL   string \n    Port      int    \n    Verbose   bool   \n    StaticDir string \n    ViewsDir  string \n}\n\nfunc (c *Config) Sync() error {\n    cfg := reflect.ValueOf(c).Elem()\n    cTyp := cfg.Type()\n\n    for k := range make([]struct{}, cTyp.NumField()) {\n        field := cTyp.Field(k)\n\n        cm := getEnvName(field.Name)\n        env := os.Getenv(cm)\n        if env == \"\" {\n            continue\n        }\n        switch field.Type.Kind() {\n        case reflect.String:\n            cfg.FieldByName(field.Name).SetString(env)\n        case reflect.Int:\n            v, err := strconv.Atoi(env)\n            if err != nil {\n                return fmt.Errorf(\"loading config field %s %v\", field.Name, err)\n            }\n            cfg.FieldByName(field.Name).Set(reflect.ValueOf(v))\n        case reflect.Bool:\n            b, err := strconv.ParseBool(env)\n            if err != nil {\n                return fmt.Errorf(\"loading config field %s %v\", field.Name, err)\n            }\n            cfg.FieldByName(field.Name).SetBool(b)\n        }\n\n    }\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "edited": false, "score": 0, "creation_date": 1468210417, "post_id": 38299019, "comment_id": 64014774, "body": "Perfect that worked, I&#39;m going to read the docs now, so basically whenever I use a GoRoutine that prints to the browser then always use WaitGoup right ?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "edited": false, "score": 1, "creation_date": 1468214591, "post_id": 38299019, "comment_id": 64015849, "body": "If the application writes to the response from a goroutine, then the application must do something to ensure that the handler waits for the goroutine. WaitGroups are a convenient way to do this. Channels can also be used.  To avoid races on the response writer, it&#39;s usually best to write to the response from the handler&#39;s goroutine.  It&#39;s not an issue in this example, but consider what happens if app runs two queries async."}, {"owner": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "edited": false, "score": 0, "creation_date": 1468243285, "post_id": 38299019, "comment_id": 64032618, "body": "Thanks a lot that explains it perfectly I will rewrite the response from the Goroutine handler now."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 3, "last_activity_date": 1468211361, "last_edit_date": 1468211361, "creation_date": 1468209973, "answer_id": 38299019, "question_id": 38298960, "link": "https://stackoverflow.com/questions/38298960/golang-when-trying-to-make-method-concurrent-nothing-returns/38299019#38299019", "title": "Golang when trying to make method concurrent nothing returns", "body": "<p>The net/http server completes the response when the handler returns. Anything written to the response after the handler returns is ignored.</p>\n\n<p>The handler function <code>Listing_Expiration</code> is returning before the anonymous function executes <code>fmt.Fprintf(w,result)</code>.</p>\n\n<p>To fix this, use a <a href=\"http://godoc.org/sync#WaitGroup\" rel=\"nofollow\">sync.WaitGroup</a>:</p>\n\n<pre><code>func Listing_Expiration(w http.ResponseWriter, r *http.Request)  {\n  var wg sync.WaitGroup\n  wg.Add(1)\n  go func(){\n    defer wg.Done()\n    // same code here as in question\n  }()\n  wg.Wait()\n}\n</code></pre>\n\n<p>The net/http server starts a goroutine for each connection and runs handlers in those goroutines. If the code in the question is the complete handler, then there's no reason to start yet another goroutine.</p>\n"}], "owner": {"reputation": 2015, "user_id": 1591668, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cb658beece55f9525bd4cbb682fadc44?s=128&d=identicon&r=PG", "display_name": "user1591668", "link": "https://stackoverflow.com/users/1591668/user1591668"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "accepted_answer_id": 38299019, "answer_count": 1, "score": 1, "last_activity_date": 1468211361, "creation_date": 1468209525, "question_id": 38298960, "link": "https://stackoverflow.com/questions/38298960/golang-when-trying-to-make-method-concurrent-nothing-returns", "title": "Golang when trying to make method concurrent nothing returns", "body": "<p>I have a method that returns Json from the database and it works correctly, however when I try to make it concurrent it does not return anything and does not give any errors. For example this is the method working correctly</p>\n\n<pre><code>func Listing_Expiration(w http.ResponseWriter, r *http.Request)  {\n\n        db,err := sql.Open(\"DB_Connect\")\n\n        if err != nil {\n            log.Fatal(err)\n            println(err)\n        }\n\n\n\n        var result string\n\n        errr := db.QueryRow(\"select json_build_object('Expiration', array_to_json(array_agg(t))) from (select fullname,ad_end from profiles where id=32)t\").Scan(&amp;result)\n\n\n        defer db.Close()\n        switch {\n        case errr != nil:\n            log.Fatal(errr)\n\n\n        }\n\n\n        fmt.Fprintf(w,result)\n\n}\n</code></pre>\n\n<p>The above method works correctly and the data is returned to the browser then I try to make this method async</p>\n\n<pre><code> func Listing_Expiration(w http.ResponseWriter, r *http.Request)  {\n        go func(){\n\n            db,err := sql.Open(\"DB_Connect\")\n\n            if err != nil {\n                log.Fatal(err)\n                println(err)\n            }\n\n\n\n            var result string\n\n            errr := db.QueryRow(\"select json_build_object('Expiration', array_to_json(array_agg(t))) from (select fullname,ad_end from profiles where id=32)t\").Scan(&amp;result)\n\n\n            defer db.Close()\n            switch {\n            case errr != nil:\n                log.Fatal(errr)\n\n\n            }\n\n\n            fmt.Fprintf(w,result)\n\n        }()\n    }\n</code></pre>\n\n<p>The async above returns nothing the only thing I have changed is that I added the <strong>Go func()</strong> inside the method so that it is async and everything else is the same . I checked and the database is returning the same content back just have no idea why the async is not printing the results back to the browser.</p>\n"}, {"tags": ["multithreading", "go", "mutex", "goroutine"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 1, "creation_date": 1468208606, "post_id": 38298713, "comment_id": 64014327, "body": "show us some code."}], "answers": [{"tags": [], "owner": {"reputation": 463, "user_id": 882700, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/32b241fb2372cc4f18e643d4d9032f19?s=128&d=identicon&r=PG", "display_name": "Vikram3891", "link": "https://stackoverflow.com/users/882700/vikram3891"}, "is_accepted": false, "score": 0, "last_activity_date": 1468214561, "creation_date": 1468214561, "answer_id": 38299639, "question_id": 38298713, "link": "https://stackoverflow.com/questions/38298713/how-does-sync-mutex-work-in-a-concurrent-golang-program/38299639#38299639", "title": "How does sync.Mutex work in a concurrent Golang program", "body": "<p>While writing the sample code as reference, I got the answer. if we have <code>var mu sync.Mutex</code> then Locking and Unlocking of <code>mu</code> will be serialized. It cannot be locked at the same time at two places which could be totally independent code bases. but if we have <code>var mu1 sync.Mutex</code> and <code>var mu2 sync.Mutex</code> then <code>mu1</code> and <code>mu2</code> can be locked concurrently. Following is a small program for the POC:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n    \"time\"\n)\n\nvar mu sync.Mutex\nvar mu1 sync.Mutex\nvar wg sync.WaitGroup\n\n// var anotherBalance int\n\nfunc code1() {\n    mu.Lock()\n    defer mu.Unlock()\n    fmt.Println(\"Entering code1\")\n    time.Sleep(1 * time.Second)\n    fmt.Println(\"Exiting code1\")\n}\n\nfunc code2() {\n    mu1.Lock()\n    defer mu1.Unlock()\n    fmt.Println(\"Entering code2\")\n    time.Sleep(1 * time.Second)\n    fmt.Println(\"Exiting code2\")\n}\n\nfunc main() {\n    wg.Add(1)\n    go func() {\n        code1()\n        wg.Done()\n    }()\n    wg.Add(1)\n    go func() {\n        code2()\n        wg.Done()\n    }()\n    wg.Wait()\n}\n</code></pre>\n\n<p>And after running it,</p>\n\n<p>Entering code2</p>\n\n<p>Entering code1</p>\n\n<p>Exiting code2</p>\n\n<p>Exiting code1</p>\n\n<p>real    0m1.335s</p>\n\n<p>user    0m0.307s</p>\n\n<p>sys 0m0.069s</p>\n"}], "owner": {"reputation": 463, "user_id": 882700, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/32b241fb2372cc4f18e643d4d9032f19?s=128&d=identicon&r=PG", "display_name": "Vikram3891", "link": "https://stackoverflow.com/users/882700/vikram3891"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 663, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1468214561, "creation_date": 1468207537, "question_id": 38298713, "link": "https://stackoverflow.com/questions/38298713/how-does-sync-mutex-work-in-a-concurrent-golang-program", "title": "How does sync.Mutex work in a concurrent Golang program", "body": "<p>When working with a concurrent program in <code>Go</code>, we use <code>var mutex sync.Mutex</code> and then if we have to write execute some synchronized code block, we call <code>mutex.Lock()</code> and <code>mutex.Unlock()</code>. Now I have some doubts here:</p>\n\n<p>1) Is there only one instance of <code>mutex</code> i.e. if <code>mutex</code> is being used for locking for operation of CodeBlockA, and at the same time some other <code>goroutine B</code> has to use it for some other CodeBlockB that also uses <code>mutex</code>, will <code>goroutine B</code> be blocked till <code>goroutine A</code> relieves <code>mutex</code>.</p>\n\n<p>2) Is it possible that we can have more instances of muteness guarding their own dedicated code blocks. </p>\n"}, {"tags": ["arrays", "matrix", "go", "slice"], "comments": [{"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 1, "creation_date": 1468202261, "post_id": 38297882, "comment_id": 64013116, "body": "A slice contains a pointer to an underlying array, so a function modifying a slice passed as a parameter does modify the underlying array. See <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">slices</a> for more info. I suspect the problem is transpose logic is not doing what you expect. Printing out the matrix on each iteration of the loop may help."}], "answers": [{"comments": [{"owner": {"reputation": 55, "user_id": 4752624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcceab631075ad9254c5616ba851dead?s=128&d=identicon&r=PG&f=1", "display_name": "Sean_J", "link": "https://stackoverflow.com/users/4752624/sean-j"}, "edited": false, "score": 0, "creation_date": 1468207231, "post_id": 38298484, "comment_id": 64014032, "body": "D&#39;oh! Thanks for the great in-depth explanation!"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 2, "last_activity_date": 1468206847, "last_edit_date": 1468206847, "creation_date": 1468205448, "answer_id": 38298484, "question_id": 38297882, "link": "https://stackoverflow.com/questions/38297882/cant-swap-elements-of-2d-array-slice-using-golang/38298484#38298484", "title": "Can&#39;t swap elements of 2D array slice using Golang", "body": "<p>Your Transpose logic is not correct (<strong>you transposed it twice</strong>),<br>\nSee this working test sample (not using swap to demonstrate the idea):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc Transpose(a [][]bool) {\n    n := len(a)\n    b := make([][]bool, n)\n    for i := 0; i &lt; n; i++ {\n        b[i] = make([]bool, n)\n        for j := 0; j &lt; n; j++ {\n            b[i][j] = a[j][i]\n        }\n    }\n    copy(a, b)\n}\nfunc main() {\n    a := [][]bool{\n        []bool{true, true, true},\n        []bool{false, true, false},\n        []bool{true, true, true},\n    }\n    BoolArrayViz(a)\n    Transpose(a)\n    BoolArrayViz(a)\n}\n\nfunc BoolArrayViz(a [][]bool) {\n    n := len(a)\n    for i := 0; i &lt; n; i++ {\n        for j := 0; j &lt; n; j++ {\n            if a[i][j] {\n                fmt.Printf(\"*\")\n            } else {\n                fmt.Printf(\" \")\n            }\n        }\n        fmt.Println()\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>output:  </p>\n\n<pre><code>***\n * \n***\n\n* *\n***\n* *\n</code></pre>\n\n<p>using swap (<strong>the inner loop, j should start at i+1 instead of 0</strong>):  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc Transpose(a [][]bool) {\n    n := len(a)\n    for i := 0; i &lt; n; i++ {\n        for j := i + 1; j &lt; n; j++ {\n            a[i][j], a[j][i] = a[j][i], a[i][j]\n        }\n    }\n}\nfunc main() {\n    a := [][]bool{\n        []bool{true, true, true},\n        []bool{false, true, false},\n        []bool{true, true, true},\n    }\n    BoolArrayViz(a)\n    Transpose(a)\n    BoolArrayViz(a)\n}\n\nfunc BoolArrayViz(a [][]bool) {\n    n := len(a)\n    for i := 0; i &lt; n; i++ {\n        for j := 0; j &lt; n; j++ {\n            if a[i][j] {\n                fmt.Printf(\"*\")\n            } else {\n                fmt.Printf(\" \")\n            }\n        }\n        fmt.Println()\n    }\n    fmt.Println()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": false, "score": 1, "last_activity_date": 1468206645, "last_edit_date": 1468206645, "creation_date": 1468205835, "answer_id": 38298517, "question_id": 38297882, "link": "https://stackoverflow.com/questions/38297882/cant-swap-elements-of-2d-array-slice-using-golang/38298517#38298517", "title": "Can&#39;t swap elements of 2D array slice using Golang", "body": "<p>You transpose function is wrong. The way it is, you're transposing the matrix and then transposing it back. In the inner loop, <code>j</code> should start at <code>i + 1</code> instead of <code>0</code>.</p>\n"}], "owner": {"reputation": 55, "user_id": 4752624, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bcceab631075ad9254c5616ba851dead?s=128&d=identicon&r=PG&f=1", "display_name": "Sean_J", "link": "https://stackoverflow.com/users/4752624/sean-j"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1190, "favorite_count": 0, "accepted_answer_id": 38298484, "answer_count": 2, "score": 1, "last_activity_date": 1468206847, "creation_date": 1468199445, "last_edit_date": 1468199510, "question_id": 38297882, "link": "https://stackoverflow.com/questions/38297882/cant-swap-elements-of-2d-array-slice-using-golang", "title": "Can&#39;t swap elements of 2D array slice using Golang", "body": "<p>I am trying to write a simple function that transposes a square matrix (i.e. swaps the columns and rows). Here is the function in question:</p>\n\n<pre><code>func Transpose(a [][]bool) {\n    for i := 0; i &lt; len(a); i++ {\n        for j := 0; j &lt; len(a[i]); j++ {\n            a[i][j], a[j][i] = a[j][i], a[i][j]\n        }\n    }\n}\n</code></pre>\n\n<p>It doesn't seem to work. If I run this function</p>\n\n<pre><code>func TestTranspose(t *testing.T) {\n    a := make([][]bool, 3)\n    a[0] = []bool{true, true, true}\n    a[1] = []bool{false, true, false}\n    a[2] = []bool{true, true, true}\n\n    fmt.Println(BoolArrayViz(a))\n\n    Transpose(a)\n\n    fmt.Println(BoolArrayViz(a))\n}\n</code></pre>\n\n<p>It gives the following output (BoolArrayViz simply prints the bool as '*' if true ' ' if false):</p>\n\n<pre><code>***\n * \n***\n\n***\n * \n***\n</code></pre>\n\n<p>I believe it has something to do with pointers and the fact that I'm passing around slices. Any help is appreciated! </p>\n"}, {"tags": ["go", "network-programming", "http2"], "answers": [{"comments": [{"owner": {"reputation": 709, "user_id": 3494590, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/4f84aa8fd828d0d8d5306bd577f2d94f?s=128&d=identicon&r=PG&f=1", "display_name": "Dhumil Agarwal", "link": "https://stackoverflow.com/users/3494590/dhumil-agarwal"}, "edited": false, "score": 0, "creation_date": 1483635757, "post_id": 40279634, "comment_id": 70186886, "body": "You have not used the Variables &#39;t&#39; and &#39;r&#39; anywhere after their definition. So why have you defined them ?"}, {"owner": {"reputation": 3815, "user_id": 1081942, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/21ce821be14be01f49366434da97cbbb?s=128&d=identicon&r=PG", "display_name": "G4bri3l", "link": "https://stackoverflow.com/users/1081942/g4bri3l"}, "edited": false, "score": 0, "creation_date": 1607533955, "post_id": 40279634, "comment_id": 115304987, "body": "<code>t</code> is used as a Transport in <code>http.Client</code>, <code>r</code> is used in the call <code>c.Do(r)</code> and it represents the request."}], "tags": [], "owner": {"reputation": 3546, "user_id": 2651741, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1baed77332f7c161914158fa44a0a0f8?s=128&d=identicon&r=PG&f=1", "display_name": "Larry.Z", "link": "https://stackoverflow.com/users/2651741/larry-z"}, "is_accepted": false, "score": 2, "last_activity_date": 1477556576, "creation_date": 1477556576, "answer_id": 40279634, "question_id": 38297503, "link": "https://stackoverflow.com/questions/38297503/how-to-write-read-send-a-data-frame-using-http-2-in-golang/40279634#40279634", "title": "How to write/read/send a data Frame using HTTP/2 in Golang?", "body": "<p>try to send http2 request like this</p>\n\n<p>first of all, you need to import http2 package</p>\n\n<pre><code>import \"golang.org/x/net/http2\"\n</code></pre>\n\n<p>then, write some request code</p>\n\n<pre><code>t := &amp;http2.Transport{}\nc := &amp;http.Client{\n    Transport: t,\n}\nr, _ := http.NewRequest(\"GET\", \"https://http2.golang.org/reqinfo\", bytes.NewBuffer([]byte(\"hello\")))\nresp, err := c.Do(r)\nif err != nil {\n    fmt.Printf(\"request error\")\n}\ndefer resp.Body.Close()\ncontent, _ := ioutil.ReadAll(resp.Body)\nfmt.Printf(\"body length:%d\\n\", len(content))\n</code></pre>\n"}], "owner": {"reputation": 89, "user_id": 5423291, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5b39dc5f9b774591c40f85c36d1dfba4?s=128&d=identicon&r=PG&f=1", "display_name": "Razvi Certezeanu", "link": "https://stackoverflow.com/users/5423291/razvi-certezeanu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1422, "favorite_count": 0, "answer_count": 1, "score": 7, "last_activity_date": 1477556576, "creation_date": 1468195384, "question_id": 38297503, "link": "https://stackoverflow.com/questions/38297503/how-to-write-read-send-a-data-frame-using-http-2-in-golang", "title": "How to write/read/send a data Frame using HTTP/2 in Golang?", "body": "<p>I was wondering how would one go about writing, reading and sending a Frame, for example a Data Frame, using of course HTTP/2. I know Golang library net/http supports this new protocol, but I do not know how to correctly do the above mentioned aspects. </p>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go", "directory"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 21, "last_activity_date": 1521798455, "last_edit_date": 1521798455, "creation_date": 1468169371, "answer_id": 38294243, "question_id": 38294216, "link": "https://stackoverflow.com/questions/38294216/filepath-walk-can-i-provides-rules-on-which-directories-not-to-walk-on/38294243#38294243", "title": "filepath.Walk() - can i provides rules on which directories not to walk on?", "body": "<p>You can skip directories by returning the error <a href=\"https://godoc.org/path/filepath#SkipDir\" rel=\"noreferrer\">filepath.SkipDir</a> from your visit function. </p>\n\n<p>Here's how to skip .git directories:</p>\n\n<pre><code>func visit(path string, f os.FileInfo, err error) error {\n    if f.IsDir() &amp;&amp; f.Name() == \".git\" {\n        return filepath.SkipDir\n    }\n    fmt.Printf(\"Visited: %s\\n\", path)\n    return nil\n}\n</code></pre>\n\n<p>The test <code>f.IsDir()</code> is required to avoid skipping the remainder of a directory that contains a normal file named \".git\". </p>\n"}], "owner": {"reputation": 26308, "user_id": 80932, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/c8df6a60fa19ec03cde467dad65c8f24?s=128&d=identicon&r=PG", "display_name": "ufk", "link": "https://stackoverflow.com/users/80932/ufk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5523, "favorite_count": 0, "accepted_answer_id": 38294243, "answer_count": 1, "score": 13, "last_activity_date": 1605464746, "creation_date": 1468169177, "question_id": 38294216, "link": "https://stackoverflow.com/questions/38294216/filepath-walk-can-i-provides-rules-on-which-directories-not-to-walk-on", "title": "filepath.Walk() - can i provides rules on which directories not to walk on?", "body": "<p>I'm writing a GoLang app using Go 1.7rc1.</p>\n\n<p>now I want to find all go files in a specific path. besides that I want not to walk on some directories.. for example.. hidden directories like <code>.git</code>.</p>\n\n<p>is there a way to provide <code>Walk()</code> with some rules ? or.. is there a diferent libraries that provide these capabilities ?</p>\n\n<p>for now this is my code:</p>\n\n<pre><code>func visit(path string, f os.FileInfo, err error) error {\n    fmt.Printf(\"Visited: %s\\n\", path)\n    return nil\n}\n\nfunc main() {\n    filepath.Walk(path,visit)\n}\n</code></pre>\n\n<p>any information regarding the issue would be greatly appreciated. thanks!</p>\n"}, {"tags": ["dictionary", "go", "struct"], "answers": [{"comments": [{"owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "edited": false, "score": 0, "creation_date": 1468167895, "post_id": 38293965, "comment_id": 64005027, "body": "ohhh that makes sense! Thank you very much!"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1468167518, "last_edit_date": 1495542151, "creation_date": 1468167518, "answer_id": 38293965, "question_id": 38293924, "link": "https://stackoverflow.com/questions/38293924/cant-increase-value-of-struct-in-map/38293965#38293965", "title": "Can&#39;t increase value of struct in map", "body": "<p>You must first assign the struct to a variable, update the value and then store it back in the map again:</p>\n\n<pre><code>e, exists := bot.epm[pmsg.Emotes[0].Name]\n    if exists {\n        e.EPM++\n        bot.epm[pmsg.Emotes[0].Name] = e\n    } \n</code></pre>\n\n<p>You can find more details here: <a href=\"https://stackoverflow.com/questions/17438253/access-struct-in-map-without-copying\">Access Struct in Map (without copying)</a></p>\n"}], "owner": {"reputation": 1282, "user_id": 3648229, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/6b730f6984c01d9409a83abacb234580?s=128&d=identicon&r=PG", "display_name": "gempir", "link": "https://stackoverflow.com/users/3648229/gempir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 44, "favorite_count": 0, "accepted_answer_id": 38293965, "answer_count": 1, "score": 1, "last_activity_date": 1468167624, "creation_date": 1468167255, "last_edit_date": 1468167624, "question_id": 38293924, "link": "https://stackoverflow.com/questions/38293924/cant-increase-value-of-struct-in-map", "title": "Can&#39;t increase value of struct in map", "body": "<p>I have a struct like this</p>\n\n<pre><code>type EPMEmote struct {\n    EmoteID   string\n    EmoteCode string\n    EPM       int64\n} \n</code></pre>\n\n<p>inside this map</p>\n\n<pre><code>map[string]EPMEmote\n</code></pre>\n\n<p>I can add stuff easily like this:</p>\n\n<pre><code>bot.epm[pmsg.Emotes[0].Name] = EPMEmote{\n            EmoteCode: pmsg.Emotes[0].Name,\n            EmoteID:   pmsg.Emotes[0].ID,\n            EPM:       1,\n        }\n</code></pre>\n\n<p>but I can't increase the value of EPM when I check beforehand if the value exists</p>\n\n<pre><code>_, exists := bot.epm[pmsg.Emotes[0].Name]\n    if exists {\n        bot.epm[pmsg.Emotes[0].Name].EPM++\n    } \n</code></pre>\n\n<p>Why does the compiler throw the error </p>\n\n<p>cannot assign to bot.epm[pmsg.Emotes[0].Name].EPM</p>\n\n<p>What am I doing wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 606, "user_id": 3496382, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/58b1d5358aca39b65581c1a1c2750dc2?s=128&d=identicon&r=PG&f=1", "display_name": "gan_", "link": "https://stackoverflow.com/users/3496382/gan"}, "edited": false, "score": 3, "creation_date": 1468166604, "post_id": 38293759, "comment_id": 64004627, "body": "You have a &#39;#&#39; somewhere in your code which is invalid."}, {"owner": {"reputation": 3202, "user_id": 3358074, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/vnKYD.png?s=128&g=1", "display_name": "dmitryro", "link": "https://stackoverflow.com/users/3358074/dmitryro"}, "edited": false, "score": 1, "creation_date": 1468166705, "post_id": 38293759, "comment_id": 64004662, "body": "Use this link to verify your terminal&#39;s UTF-8 settings <a href=\"http://stackoverflow.com/questions/4606570/os-x-terminal-utf-8-issues\" title=\"os x terminal utf 8 issues\">stackoverflow.com/questions/4606570/os-x-terminal-utf-8-issu&zwnj;&#8203;es</a>"}], "answers": [{"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 4, "last_activity_date": 1468212525, "last_edit_date": 1468212525, "creation_date": 1468209733, "answer_id": 38298985, "question_id": 38293759, "link": "https://stackoverflow.com/questions/38293759/hello-go11-illegal-character-u0023/38298985#38298985", "title": "hello.go:1:1: illegal character U+0023", "body": "<p>you have '#' in first line of your code which is invalid,<br>\nsee this test sample code:</p>\n\n<pre><code># just remove this line\npackage main\n\nimport \"fmt\" \n\nfunc main() {\n    fmt.Println(\"Hello World!\") \n}\n</code></pre>\n\n<p>this will give this error:  </p>\n\n<pre><code>hello.go:1:1: illegal character U+0023 '#'\n</code></pre>\n\n<p>but if you remove lines containing <code>#</code> it works fine:  </p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"Hello World!\")\n}\n</code></pre>\n\n<p>it seems your IDE is not for Go. See:<br>\n<a href=\"https://github.com/visualfc/liteide\" rel=\"nofollow\">https://github.com/visualfc/liteide</a><br>\n<a href=\"https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins\" rel=\"nofollow\">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a><br>\n<a href=\"http://www.distilnetworks.com/setup-go-golang-ide-for-mac-os-x/\" rel=\"nofollow\">http://www.distilnetworks.com/setup-go-golang-ide-for-mac-os-x/</a>  </p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11002956, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/67ec94adb7f3b8be59aa9de3c557e9f5?s=128&d=identicon&r=PG", "display_name": "Ed Bell", "link": "https://stackoverflow.com/users/11002956/ed-bell"}, "is_accepted": false, "score": -1, "last_activity_date": 1549051417, "creation_date": 1549051417, "answer_id": 54486459, "question_id": 38293759, "link": "https://stackoverflow.com/questions/38293759/hello-go11-illegal-character-u0023/54486459#54486459", "title": "hello.go:1:1: illegal character U+0023", "body": "<p>I had the same problem but had no '#' in the source whatsoever. My LOCALE was set correctly. My problem was that I created the source via cut and paste from:</p>\n\n<p><a href=\"https://medium.com/@singh.shreya8/how-to-install-go-lang-in-ubuntu-14-04-ubuntu-16-04-ubuntu-18-04-linux-19e4c8aad4b8\" rel=\"nofollow noreferrer\">https://medium.com/@singh.shreya8/how-to-install-go-lang-in-ubuntu-14-04-ubuntu-16-04-ubuntu-18-04-linux-19e4c8aad4b8</a></p>\n\n<p>The problem was solved by deleting and retyping the double quotes in the source. Just for grins I tried a cut and paste from:</p>\n\n<p><a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n\n<p>and had no problems. Go figure.</p>\n"}], "owner": {"reputation": 6804, "user_id": 1934510, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/3f2e521fe728bb5d6e87db48df3c9114?s=128&d=identicon&r=PG", "display_name": "Filipe Ferminiano", "link": "https://stackoverflow.com/users/1934510/filipe-ferminiano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4434, "favorite_count": 0, "accepted_answer_id": 38298985, "answer_count": 2, "score": 0, "last_activity_date": 1549051417, "creation_date": 1468166298, "question_id": 38293759, "link": "https://stackoverflow.com/questions/38293759/hello-go11-illegal-character-u0023", "title": "hello.go:1:1: illegal character U+0023", "body": "<p>I'm trying to run the hello world from golang <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow\">in this link</a>\nBut when I run go install, I'm getting this error:</p>\n\n<pre><code>hello.go:1:1: illegal character U+0023\n</code></pre>\n\n<p>This is my hello.go</p>\n\n<pre><code>package main    \nimport \"fmt\"\nfunc main() {\n  fmt.Printf(\"hello, world\")\n}\n</code></pre>\n\n<p>I'm using Mac OS El Captain\nWhat is wrong?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 901, "user_id": 1241479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRrrO.png?s=128&g=1", "display_name": "Donovan Solms", "link": "https://stackoverflow.com/users/1241479/donovan-solms"}, "edited": false, "score": 1, "creation_date": 1468238308, "post_id": 38293657, "comment_id": 64029098, "body": "I&#39;m not 100%, but I think you also filed the issue on <a href=\"https://github.com/golang/go/issues/16318\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/16318</a> a couple of minutes ago. I think this is related to that since the image is in a <code>noscript</code> tag"}, {"owner": {"reputation": 573, "user_id": 1522697, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/X5mNJ.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/1522697/george"}, "reply_to_user": {"reputation": 901, "user_id": 1241479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRrrO.png?s=128&g=1", "display_name": "Donovan Solms", "link": "https://stackoverflow.com/users/1241479/donovan-solms"}, "edited": false, "score": 0, "creation_date": 1468239951, "post_id": 38293657, "comment_id": 64030265, "body": "@DonovanSolms thank you. I linked this post in the thread you linked."}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 901, "user_id": 1241479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRrrO.png?s=128&g=1", "display_name": "Donovan Solms", "link": "https://stackoverflow.com/users/1241479/donovan-solms"}, "edited": false, "score": 1, "creation_date": 1468247878, "post_id": 38293657, "comment_id": 64036103, "body": "@DonovanSolms I filed the issue. And yes it is related :-)"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "edited": false, "score": 0, "creation_date": 1468254845, "post_id": 38293657, "comment_id": 64040510, "body": "@georg <a href=\"https://github.com/bearburger/net/commit/42ac75393ced8c48137b574278522df1f3fa2cec\" rel=\"nofollow noreferrer\">here is the fix</a> if you need it right there right now and able to fix package code. The behaviour of <code>x&#47;net&#47;html</code> (<code>&lt;noscript&gt;</code> content as text) is not unexpected according to their tests."}, {"owner": {"reputation": 573, "user_id": 1522697, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/X5mNJ.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/1522697/george"}, "reply_to_user": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "edited": false, "score": 0, "creation_date": 1468260333, "post_id": 38293657, "comment_id": 64043284, "body": "@RomanR. thank you. So someone of you guys post the answer which i can accept as the solution?"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "edited": false, "score": 0, "creation_date": 1468263925, "post_id": 38293657, "comment_id": 64045119, "body": "@georg There is no solution yet :-) But ok I can post the link to issue and the fix."}], "answers": [{"tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 2, "last_activity_date": 1468276637, "last_edit_date": 1468276637, "creation_date": 1468264223, "answer_id": 38314423, "question_id": 38293657, "link": "https://stackoverflow.com/questions/38293657/html-parser-ignores-img-tag-golang/38314423#38314423", "title": "Html parser ignores img tag (Golang)", "body": "<p>This is not a bug but expected behaviour of <code>x/net/html</code> which affects all parsers based on <code>x/net/html</code>.</p>\n\n<p>There are four possible solutions:</p>\n\n<ol>\n<li><p>Remove <code>&lt;noscript&gt;</code> and <code>&lt;/noscript&gt;</code> in HTML so <code>x/net/html</code> would parse its content as expected. Something like:</p>\n\n<pre><code>package main\n\nimport (\n    \"golang.org/x/net/html\"\n    \"log\"\n    \"net/http\"\n    \"io/ioutil\"\n    \"strings\"\n)\n\nfunc main() {\n\n    url := \"http://www.ozon.ru/context/detail/id/34498204/\"\n\n    if resp, err := http.Get(url); err == nil {\n        defer resp.Body.Close()\n\n        log.Println(\"Load page complete\")\n\n        if resp != nil {\n            log.Println(\"Page response is NOT nil\")\n            // --------------\n            data, _ := ioutil.ReadAll(resp.Body)\n            resp.Body.Close()\n\n            hdata := strings.Replace(string(data), \"&lt;noscript&gt;\", \"\", -1)\n            hdata = strings.Replace(hdata, \"&lt;/noscript&gt;\", \"\", -1)\n            // --------------\n\n            if document, err := html.Parse(strings.NewReader(hdata)); err == nil {\n                var parser func(*html.Node)\n                parser = func(n *html.Node) {\n                    if n.Type == html.ElementNode &amp;&amp; n.Data == \"img\" {\n\n                        var imgSrcUrl, imgDataOriginal string\n\n                        for _, element := range n.Attr {\n                            if element.Key == \"src\" {\n                                imgSrcUrl = element.Val\n                            }\n                            if element.Key == \"data-original\" {\n                                imgDataOriginal = element.Val\n                            }\n                        }\n\n                        log.Println(imgSrcUrl, imgDataOriginal)\n                    }\n\n                    for c := n.FirstChild; c != nil; c = c.NextSibling {\n                        parser(c)\n                    }\n\n                }\n                parser(document)\n            } else {\n                log.Panicln(\"Parse html error\", err)\n            }\n\n        } else {\n            log.Println(\"Page response IS nil\")\n        }\n    }\n\n}\n</code></pre></li>\n<li><p>Patch <code>x/net/html</code> with <a href=\"https://github.com/bearburger/net/commit/42ac75393ced8c48137b574278522df1f3fa2cec\" rel=\"nofollow\">https://github.com/bearburger/net/commit/42ac75393ced8c48137b574278522df1f3fa2cec</a></p></li>\n<li><p>Use gokogiri with go 1.4 (I'm pretty sure this is last version supported)</p></li>\n<li><p>Wait for decision on <a href=\"https://github.com/golang/go/issues/16318\" rel=\"nofollow\">https://github.com/golang/go/issues/16318</a> If this is real bug I'll make the pull request.</p></li>\n</ol>\n"}], "owner": {"reputation": 573, "user_id": 1522697, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/X5mNJ.jpg?s=128&g=1", "display_name": "George", "link": "https://stackoverflow.com/users/1522697/george"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1914, "favorite_count": 0, "accepted_answer_id": 38314423, "answer_count": 1, "score": 2, "last_activity_date": 1468276637, "creation_date": 1468165648, "question_id": 38293657, "link": "https://stackoverflow.com/questions/38293657/html-parser-ignores-img-tag-golang", "title": "Html parser ignores img tag (Golang)", "body": "<p>My task is to find images urls inside an html</p>\n\n<p><strong>The problem</strong></p>\n\n<p>Html parser <code>golang.org/x/net/html</code> as well as \n<code>github.com/PuerkitoBio/goquery</code> igonores the biggest image on the page <a href=\"http://www.ozon.ru/context/detail/id/34498204/\" rel=\"nofollow\">http://www.ozon.ru/context/detail/id/34498204/</a></p>\n\n<p><strong>The question</strong></p>\n\n<ul>\n<li>What is wrong in my code</li>\n<li>Why required <code>img</code> tag with <code>src=\"\"</code> is ignored?</li>\n<li>Is there are way to get all images from html with go?</li>\n</ul>\n\n<p><strong>Notes:</strong></p>\n\n<ul>\n<li><p>When i used <a href=\"https://github.com/tid-kijyun/Kanna\" rel=\"nofollow\">parser written in Swift</a> this image has been found on the page <code>//static2.ozone.ru/multimedia/spare_covers/1013531536.jpg</code></p></li>\n<li><p>This image tag has been found when i use regex search.</p></li>\n<li><p>This image tag has been found when i use third party service <a href=\"http://saveallimages.com/\" rel=\"nofollow\">saveallimages.com</a></p></li>\n<li><p>I tried to use gokogiri but has no success to compile it on my mac. <code>Go get</code> is successful, but <code>Go build</code> stuck forever. </p></li>\n</ul>\n\n<p><strong>Parsed html page source</strong></p>\n\n<p><a href=\"https://drive.google.com/open?id=0Bw-eomJ7SS0EVElORE1Sd3JDaTA\" rel=\"nofollow\">This is the html</a> which is result of <code>resp, _ := http.Get(url)</code></p>\n\n<p><strong>Code:</strong></p>\n\n<pre><code>package main\n\nimport (\n  \"golang.org/x/net/html\"\n  \"log\"\n  \"net/http\"\n)\n\n\nfunc main() {\n\n  url := \"http://www.ozon.ru/context/detail/id/34498204/\"\n\n  if resp, err := http.Get(url); err == nil {\n    defer resp.Body.Close()\n\n    log.Println(\"Load page complete\")\n\n    if resp != nil {\n      log.Println(\"Page response is NOT nil\")\n\n      if document, err := html.Parse(resp.Body); err == nil {\n\n        var parser func(*html.Node)\n        parser = func(n *html.Node) {\n          if n.Type == html.ElementNode &amp;&amp; n.Data == \"img\" {\n\n            var imgSrcUrl, imgDataOriginal string\n\n            for _, element := range n.Attr {\n              if element.Key == \"src\" {\n                imgSrcUrl = element.Val\n              }\n              if element.Key == \"data-original\" {\n                imgDataOriginal = element.Val\n              }\n            }\n\n            log.Println(imgSrcUrl, imgDataOriginal)\n          }\n\n          for c := n.FirstChild; c != nil; c = c.NextSibling {\n            parser(c)\n          }\n\n        }\n        parser(document)\n      } else {\n        log.Panicln(\"Parse html error\", err)\n      }\n\n    } else {\n      log.Println(\"Page response IS nil\")\n    }\n  }\n\n}\n</code></pre>\n"}, {"tags": ["go", "docker", "ibm-cloud", "blockchain", "hyperledger"], "answers": [{"tags": [], "owner": {"reputation": 174, "user_id": 6269723, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/0c7492745e7c0736adac1b8b6ac5e941?s=128&d=identicon&r=PG", "display_name": "muralisrini", "link": "https://stackoverflow.com/users/6269723/muralisrini"}, "is_accepted": false, "score": 0, "last_activity_date": 1468898905, "creation_date": 1468898905, "answer_id": 38449125, "question_id": 38293279, "link": "https://stackoverflow.com/questions/38293279/error-starting-container-api-error-500-hyperledger/38449125#38449125", "title": "(Error starting container: API error (500) Hyperledger", "body": "<p>The error likely happened during the deploy phase (the logs just shows the query). The \"deploy\" being an asynchronous transaction returning an ID (just \"submits\" the transaction to be processed later) cannot indicate if the actual execution of the transaction will be successful or not. But the \"query\" request is synchronous and shows a failure.</p>\n\n<p>Looking at the chaincode, the error is almost certainly due to the import and use of \"github.com/op/go-logging\" package. As the fabric only copies the chaincode and does not pick up its dependencies, that package is not available at deploy time. </p>\n\n<p>Note that the same code will work when under \"github.com/hyperledger/fabric\" path as \"github.com/op/go-logging\" is available as a \"vendor\" package in that path.</p>\n\n<p>To test this, try commenting out the import statement and all logging from the code (make sure \"go build\" works locally first with the changes).</p>\n"}], "owner": {"reputation": 656, "user_id": 827968, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/379f562f33b0bd36fe023e79643fceda?s=128&d=identicon&r=PG", "display_name": "tortuga", "link": "https://stackoverflow.com/users/827968/tortuga"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 317, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1468898905, "creation_date": 1468163026, "last_edit_date": 1468890702, "question_id": 38293279, "link": "https://stackoverflow.com/questions/38293279/error-starting-container-api-error-500-hyperledger", "title": "(Error starting container: API error (500) Hyperledger", "body": "<p>I am using bluemix network to deploy and test my custom chaincode( <a href=\"https://github.com/tortuga90/chaincode/blob/master/test/test.go\" rel=\"nofollow noreferrer\">link</a> to the chaincode). I'm using hte Swagger API to deploy, invoke and query my chaincode. The deploy and invoke work fine but when I try to query my chaincode, I keep getting the following error<a href=\"https://i.stack.imgur.com/mXXaC.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/mXXaC.png\" alt=\"enter image description here\"></a>\nFollowing is the validating peer logs :\n<a href=\"https://i.stack.imgur.com/DhKRz.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/DhKRz.png\" alt=\"enter image description here\"></a></p>\n\n<p>Is it some problem with my query code or network issue. Any help is appreciated.</p>\n"}, {"tags": ["image", "go"], "answers": [{"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 1, "last_activity_date": 1468249975, "last_edit_date": 1468249975, "creation_date": 1468226679, "answer_id": 38302641, "question_id": 38293180, "link": "https://stackoverflow.com/questions/38293180/go-image-draw-square/38302641#38302641", "title": "Go image draw square", "body": "<p>After pondering it a bit, I think I know the issue. It is with this line:</p>\n\n<pre><code>draw.Draw(img, image.Rect(x, y, x+size, y+size), patch, image.ZP, draw.Src)\n</code></pre>\n\n<p>You add the size only to make each rectangle large, but you do not multiply it with the position.</p>\n\n<pre><code>draw.Draw(img, image.Rect(x*size, y*size, x+size, y+size), patch, image.ZP, draw.Src)\n</code></pre>\n\n<p>You might need to tweek this depending on your grid.</p>\n"}], "owner": {"reputation": 2694, "user_id": 2452442, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/4a9391ca25cfccbc8ec92536da744257?s=128&d=identicon&r=PG", "display_name": "Raggaer", "link": "https://stackoverflow.com/users/2452442/raggaer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 592, "favorite_count": 0, "accepted_answer_id": 38302641, "answer_count": 1, "score": 2, "last_activity_date": 1468249975, "creation_date": 1468162378, "question_id": 38293180, "link": "https://stackoverflow.com/questions/38293180/go-image-draw-square", "title": "Go image draw square", "body": "<p>I currently want to set pixel images on a loop</p>\n\n<pre><code>func ParseMap(path string) {\n    ...\n    for _, h := range serverMap.Houses {\n        houseData := Houses.GetHouse(h.ID)\n        houseImage := image.NewRGBA(image.Rect(int(houseData.EntryX)-32, int(houseData.EntryY)-32, int(houseData.EntryX)+32, int(houseData.EntryY)+32))\n        draw.Draw(houseImage, houseImage.Bounds(), &amp;image.Uniform{\n            backgroundColor,\n        }, image.ZP, draw.Src)\n        for _, tile := range h.Tiles {\n            pos := tile.Position()\n            if pos.Z != uint8(houseData.EntryZ) {\n                continue\n            }\n            drawSquare(houseImage, tileColor, 12, int(pos.X), int(pos.Y))\n        imgFile, _ := os.Create(fmt.Sprintf(\"%v/%v/%v.png\", pigo.Config.String(\"template\"), \"public/houses\", houseData.Name))\n        png.Encode(imgFile, houseImage)\n        imgFile.Close()\n    }\n    ...\n}\n</code></pre>\n\n<p>I loop on a slice of Tiles that contains X, Y, Z fields but since 1 pixel looks very small I want to be each pixel 6 pixel square with the given function</p>\n\n<pre><code>func drawSquare(img *image.RGBA, c color.Color, size int, x, y int) {\n    patch := image.NewRGBA(image.Rect(0, 0, size, size))\n    draw.Draw(patch, patch.Bounds(), &amp;image.Uniform{\n        c,\n    }, image.ZP, draw.Src)\n    draw.Draw(img, image.Rect(x, y, x+size, y+size), patch, image.ZP, draw.Src)\n}\n</code></pre>\n\n<p>However there is a problem with this function. If I want to paint one pixel this is how it will look</p>\n\n<p><a href=\"https://i.stack.imgur.com/ajl4P.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/ajl4P.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>The red borders means how big the square will be  BUT if I go to the next pixel the size will be overwritten</p>\n\n<p><a href=\"https://i.stack.imgur.com/QJTyR.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/QJTyR.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>Instead of beeing what I am looking for</p>\n\n<p><a href=\"https://i.stack.imgur.com/gtP5c.jpg\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/gtP5c.jpg\" alt=\"enter image description here\"></a></p>\n\n<p>I hope it is clear enough what I want to achieve but I dont really know what type of algorithm I should use (if I even need one) or its just pure logic</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 50179, "user_id": 594589, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/0f9d5953607841d6a50b843a1107e51e?s=128&d=identicon&r=PG", "display_name": "dm03514", "link": "https://stackoverflow.com/users/594589/dm03514"}, "edited": false, "score": 0, "creation_date": 1468166818, "post_id": 38292632, "comment_id": 64004696, "body": "<a href=\"https://stackoverflow.com/questions/38125001/how-can-you-test-code-that-relies-on-net-conn-without-creating-an-actual-network/38185106#38185106\" title=\"how can you test code that relies on net conn without creating an actual network\">stackoverflow.com/questions/38125001/&hellip;</a>  <a href=\"https://stackoverflow.com/questions/37766632/golang-testing-with-filesystem-and-reaching-100\" title=\"golang testing with filesystem and reaching 100\">stackoverflow.com/questions/37766632/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "edited": false, "score": 0, "creation_date": 1468162215, "post_id": 38293128, "comment_id": 64003329, "body": "I want to test <code>GetDataFromFile</code> only so I want to have a test case when <code>if err != nil {</code>"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 1, "last_activity_date": 1468162031, "creation_date": 1468162031, "answer_id": 38293128, "question_id": 38292632, "link": "https://stackoverflow.com/questions/38292632/how-to-test-the-ioutil-readfile-and-os-stat/38293128#38293128", "title": "How to test the ioutil.ReadFile and os.Stat?", "body": "<p>Is there any specific reason you want to test these library functions?</p>\n\n<p>You should only concern yourself with testing your own code and logic. Libraries are tested by those who create and maintain them and you should use them fully expecting to perform as per their documentation. Any genuine deviation from expected behavior should be reported to the authors/maintainers of the library.</p>\n\n<p>As for testing <code>GetDataFromFile</code>, it would be perfectly legitimate to test it by supplying incorrect path. For more specific errors you can also read up on the input parameters that would cause them and call the functions with those arguments.</p>\n"}, {"tags": [], "owner": {"reputation": 1662, "user_id": 983716, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/3f160db8b018350c8d1a513c8abf827f?s=128&d=identicon&r=PG&f=1", "display_name": "user983716", "link": "https://stackoverflow.com/users/983716/user983716"}, "is_accepted": true, "score": 4, "last_activity_date": 1468162437, "creation_date": 1468162437, "answer_id": 38293190, "question_id": 38292632, "link": "https://stackoverflow.com/questions/38292632/how-to-test-the-ioutil-readfile-and-os-stat/38293190#38293190", "title": "How to test the ioutil.ReadFile and os.Stat?", "body": "<p>I agree with abhink here, I would not expect you to test this particular function.  But in practice, similar situation happens often.</p>\n\n<p>My best solution is to use a factory to create <code>GetDataFromFile</code>. In this case, you inject the dependencies.</p>\n\n<h3>main.go</h3>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"os\"\n)\n\nfunc getDataFromFileFactory(\n    stat func(filename string) (os.FileInfo, error),\n    readFile func(filename string) ([]byte, error),\n) func(path string) ([]byte, error) {\n\n    return func(path string) ([]byte, error) {\n        _, err := stat(path)\n        if err != nil {\n            return nil, err\n        }\n        data, err := readFile(path)\n        if err != nil {\n            return nil, err\n        }\n        return data, nil\n    }\n}\n\nvar GetDataFromFile = getDataFromFileFactory(os.Stat, ioutil.ReadFile)\n\nfunc main() {}\n</code></pre>\n\n<h3>main_test.go</h3>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"os\"\n    \"testing\"\n)\n\nfunc TestGetDataFromFile(t *testing.T) {\n    stat := func(filename string) (os.FileInfo, error) {\n        return nil, errors.New(\"err msg\")\n    }\n\n    readfile := func(filename string) ([]byte, error) {\n        t.Error(\"should not call this function\")\n        return nil, nil\n    }\n\n    getDataFromFile := getDataFromFileFactory(stat, readfile)\n\n    if _, err := getDataFromFile(\"foo\"); err.Error() != \"err msg\" {\n        t.Error(\"expected an error to be thrown\")\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1610, "favorite_count": 0, "accepted_answer_id": 38293190, "answer_count": 2, "score": 0, "last_activity_date": 1468162437, "creation_date": 1468158916, "question_id": 38292632, "link": "https://stackoverflow.com/questions/38292632/how-to-test-the-ioutil-readfile-and-os-stat", "title": "How to test the ioutil.ReadFile and os.Stat?", "body": "<p>I have the following function:</p>\n\n<pre><code>func GetDataFromFile(path string) ([]byte, error) {\n    _, err := os.Stat(path)\n    if err != nil {\n        return nil, err\n    }\n    data, err := ioutil.ReadFile(path)\n    if err != nil {\n        return nil, err\n    }\n    return data, nil\n}\n</code></pre>\n\n<p>I want to do tests for functions ioutil.ReadFile and os.Stat(path) when they throw errors.\nI know that I can create non-exist path for os.Stat(path), but how to test such kind functions without \"workarounds\" and guessing how functions are working?</p>\n\n<p>Regards.</p>\n"}, {"tags": ["pointers", "go", "static-analysis"], "owner": {"reputation": 559, "user_id": 265767, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/4cc3470aa2b9554612ea406ae169be2c?s=128&d=identicon&r=PG", "display_name": "user265767", "link": "https://stackoverflow.com/users/265767/user265767"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 75, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1468157907, "creation_date": 1468157907, "question_id": 38292484, "link": "https://stackoverflow.com/questions/38292484/golang-pointer-analysis-to-determine-if-buffer-has-been-flushed", "title": "Golang Pointer Analysis to determine if buffer has been flushed", "body": "<p>I'm new to pointer analysis and static analysis in general, I hope someone can give me a brief answer and push me in the right direction.</p>\n\n<p>Basically what I want to achieve is to do static analysis of Go source, looking after potential buggy code, e.g. forgetting to Flush() a buffer.</p>\n\n<p>Its maybe trivial to check after an Flush() operation on a buffer variable in a single function. But as in the code under, it\u00b4s harder to detect that the buffer actually is closed in another function called. </p>\n\n<p>How can one nicely do static checking to solve this, I can only think of using the Go tools pointer package <a href=\"https://godoc.org/golang.org/x/tools/go/pointer#example-package\" rel=\"nofollow\">1</a>, but it\u00b4s not easy to get grasp on the documentation.</p>\n\n<pre><code>package main\n\nimport (\n    \"bufio\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    w := bufio.NewWriter(os.Stdout)\n    fmt.Fprint(w, \"Hello, World\")\n    closeBuffer(w)\n}\n\nfunc closeBuffer(buf *bufio.Writer) {\n    buf.Flush()\n}\n</code></pre>\n"}, {"tags": ["go", "reflection", "export", "influxdb", "go-reflect"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 1, "creation_date": 1468142130, "post_id": 38290302, "comment_id": 63998379, "body": "As per <a href=\"https://github.com/influxdata/influxdb/blob/master/client/v2/client.go#L78\" rel=\"nofollow noreferrer\">github.com/influxdata/influxdb/blob/master/client/v2/&hellip;</a> , <code>Client</code> is an interface type and it is exported. <code>Client</code> type is also what&#39;s being returned from <code>NewHTTPClient</code> (<a href=\"https://github.com/influxdata/influxdb/blob/master/client/v2/client.go#L95\" rel=\"nofollow noreferrer\">github.com/influxdata/influxdb/blob/master/client/v2/&hellip;</a>). Are you looking for some other type?"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1468144625, "post_id": 38290302, "comment_id": 63998891, "body": "So what kind of error do you get here?"}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1468164825, "post_id": 38290302, "comment_id": 64004093, "body": "@SalvadorDali - I am getting the following error for the lower case <code>client</code>,  <code>..&#47;influxclient&#47;influxclient.go:67: cannot refer to unexported name client.client ..&#47;influxclient&#47;influxclient.go:67: undefined: client.client</code>"}], "answers": [{"comments": [{"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1468164733, "post_id": 38290665, "comment_id": 64004064, "body": "Thank you for the answer. I am getting the following error for upper case Client. <code>..&#47;influxclient&#47;influxclient.go:42: c.Write undefined (type *client.Client is pointer to interface, not interface) ..&#47;influxclient&#47;influxclient.go:62: c.Write undefined (type *client.Client is pointer to interface, not interface) ..&#47;influxclient&#47;influxclient.go:77: cannot use c (type client.Client) as type *client.Client in return argument: \t*client.Client is pointer to interface, not interface</code>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1468173537, "post_id": 38290665, "comment_id": 64006735, "body": "@dany: do not use pointer to client.Client. or just copy my sample code."}, {"owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "edited": false, "score": 0, "creation_date": 1468188565, "post_id": 38290665, "comment_id": 64010650, "body": "ah got it. It worked. I am not sure again why <code>reflect.TypeOf(object)</code> is giving the pointer <code>*client.Client</code> even though the type is <code>client.Client</code>"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 4, "last_activity_date": 1468145016, "last_edit_date": 1468145016, "creation_date": 1468144698, "answer_id": 38290665, "question_id": 38290302, "link": "https://stackoverflow.com/questions/38290302/how-to-use-an-un-exported-object-from-third-party-package-as-return-type-in-gola/38290665#38290665", "title": "How to use an un exported object from third party package as return type in golang?", "body": "<p>the <code>package client // import \"github.com/influxdata/influxdb/client/v2\"</code><br>\nhas exported <code>Client interface</code> so use <code>client.Client</code> instead of <code>*client.client</code>:  </p>\n\n<pre><code>package influxclient\n\nimport (\n    \"log\"\n    \"time\"\n\n    \"github.com/influxdata/influxdb/client/v2\"\n    //\"net/http\"\n    \"fmt\"\n    \"reflect\"\n)\n\nconst (\n    INFLUXDB_NAME = \"XXXX\"\n    USERNAME      = \"YYYY\"\n    PASSWORD      = \"ZZZZ\"\n    HOST          = \"http://localhost:8086\"\n)\n\nvar c = getHTTPClient()\n\nfunc test() {\n    // Create a new point batch\n    bp, _ := client.NewBatchPoints(client.BatchPointsConfig{\n        Database:  INFLUXDB_NAME,\n        Precision: \"s\",\n    })\n\n    // Create a point and add to batch\n    tags := map[string]string{\"cpu\": \"cpu-total\"}\n    fields := map[string]interface{}{\n        \"idle\":   10.1,\n        \"system\": 53.3,\n        \"user\":   46.6,\n    }\n    fmt.Println(reflect.TypeOf(c))\n    pt, _ := client.NewPoint(\"cpu_usage\", tags, fields, time.Now())\n    bp.AddPoint(pt)\n\n    // Write the batch\n    c.Write(bp)\n}\n\n//publish metrics to metrics db\nfunc PublishMetrics(metricName string, tags map[string]string, fields map[string]interface{}, time time.Time) error {\n    fmt.Println(\"type of client c \", reflect.TypeOf(c))\n    // Create a new point batch\n    bp, err := client.NewBatchPoints(client.BatchPointsConfig{\n        Database:  INFLUXDB_NAME,\n        Precision: \"s\",\n    })\n    if err != nil {\n        return err\n    }\n    pt, err := client.NewPoint(metricName, tags, fields, time)\n    if err != nil {\n        return err\n    }\n    bp.AddPoint(pt)\n    // Write the batch\n    c.Write(bp)\n    return nil\n}\n\nfunc getHTTPClient() client.Client {\n    //make http client for metrics db\n    c, err := client.NewHTTPClient(client.HTTPConfig{\n        Addr:     HOST,\n        Username: USERNAME,\n        Password: PASSWORD,\n    })\n    if err != nil {\n        log.Printf(\"FATAL :: Error occured in getting influxdb metric client %s \", err.Error())\n    }\n    return c\n}\n</code></pre>\n"}], "owner": {"reputation": 2144, "user_id": 3103732, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/ddea83f3d0a1cde074665d4c1382c3cc?s=128&d=identicon&r=PG&f=1", "display_name": "Dany", "link": "https://stackoverflow.com/users/3103732/dany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 375, "favorite_count": 0, "accepted_answer_id": 38290665, "answer_count": 1, "score": 1, "last_activity_date": 1471842690, "creation_date": 1468141617, "last_edit_date": 1471842690, "question_id": 38290302, "link": "https://stackoverflow.com/questions/38290302/how-to-use-an-un-exported-object-from-third-party-package-as-return-type-in-gola", "title": "How to use an un exported object from third party package as return type in golang?", "body": "<p>In my use case I am using influxdb. I am trying to create a global client to influxdb in Golang. But when I return the influxdb client from a function, the client object is not exported in the influxdb package. So I am not able to return this.</p>\n\n<p>Here is my code:  </p>\n\n<pre><code>package influxclient\n\nimport (\n    \"github.com/influxdata/influxdb/client/v2\"\n    \"log\"\n    \"time\"\n    //\"net/http\"\n    \"fmt\"\n    \"reflect\"\n)\n\nconst (\n    INFLUXDB_NAME = \"XXXX\"\n    USERNAME      = \"YYYY\"\n    PASSWORD      = \"ZZZZ\"\n    HOST          = \"http://localhost:8086\"\n)\n\nvar (\n    c             = getHTTPClient()\n)\n\nfunc test() {\n    // Create a new point batch\n    bp, _ := client.NewBatchPoints(client.BatchPointsConfig{\n        Database:  INFLUXDB_NAME,\n        Precision: \"s\",\n    })\n\n    // Create a point and add to batch\n    tags := map[string]string{\"cpu\": \"cpu-total\"}\n    fields := map[string]interface{}{\n        \"idle\":   10.1,\n        \"system\": 53.3,\n        \"user\":   46.6,\n    }\n    fmt.Println(reflect.TypeOf(c))\n    pt, _ := client.NewPoint(\"cpu_usage\", tags, fields, time.Now())\n    bp.AddPoint(pt)\n\n    // Write the batch\n    c.Write(bp)\n}\n\n//publish metrics to metrics db\nfunc PublishMetrics(metricName string, tags map[string]string, fields map[string]interface{}, time time.Time) error {\n    fmt.Println(\"type of client c \", reflect.TypeOf(c))\n    // Create a new point batch\n    bp, err := client.NewBatchPoints(client.BatchPointsConfig{\n        Database:  INFLUXDB_NAME,\n        Precision: \"s\",\n    })\n    if err != nil {\n        return err\n    }\n    pt, err := client.NewPoint(metricName, tags, fields, time)\n    if err != nil {\n        return err\n    }\n    bp.AddPoint(pt)\n    // Write the batch\n    c.Write(bp)\n    return nil\n}\n\n\nfunc getHTTPClient() *client.client {\n    //make http client for metrics db\n    c, err := client.NewHTTPClient(client.HTTPConfig{\n        Addr:     HOST,\n        Username: USERNAME,\n        Password: PASSWORD,\n    })\n    if err != nil {\n        log.Printf(\"FATAL :: Error occured in getting influxdb metric client %s \", err.Error())\n    }\n    return c\n}\n</code></pre>\n\n<p><code>getHTTPClient()</code> function is trying to return the client object <code>*client.client</code>.<br>\nBut the client object is not exported in influxdb golang package.<br>\nSo how can I handle this problem?<br>\nCould anyone help me with this?</p>\n\n<p>Thanks</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1468124009, "post_id": 38288459, "comment_id": 63995338, "body": "Someone might have a different idea, but I think if you&#39;re thinking of your goal as sharing users, a <code>Mutex</code> (or <code>RWLock</code>, like a mutex but with multiple concurrent readers allowed) is what that naturally maps to. If one goroutine naturally &quot;owned&quot; the user list, a channel might make more sense, but as asked, would go with a lock."}, {"owner": {"reputation": 74246, "user_id": 80911, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9e9b4f80c65dc6076d74cd421084e4fc?s=128&d=identicon&r=PG", "display_name": "Evert", "link": "https://stackoverflow.com/users/80911/evert"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1468126240, "post_id": 38288459, "comment_id": 63995671, "body": "@twotwotwo great answer, thank you."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": true, "score": 2, "last_activity_date": 1468123686, "creation_date": 1468123686, "answer_id": 38288472, "question_id": 38288459, "link": "https://stackoverflow.com/questions/38288459/sharing-a-slice-across-a-few-different-goroutines/38288472#38288472", "title": "Sharing a slice across a few different goroutines", "body": "<p>The mutex approach is the best, safest and most manageable approach to that problem and is the fastest.</p>\n\n<p>Channels are complex beasts on the inside and are much slower than a rwmutex-guarded map/slice.</p>\n"}, {"comments": [{"owner": {"reputation": 74246, "user_id": 80911, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9e9b4f80c65dc6076d74cd421084e4fc?s=128&d=identicon&r=PG", "display_name": "Evert", "link": "https://stackoverflow.com/users/80911/evert"}, "edited": false, "score": 0, "creation_date": 1468185023, "post_id": 38295110, "comment_id": 64009832, "body": "Great answer! The internal microservice approach makes sense, but it&#39;s also quite scary to have to develop pretty elaborate services for every bit of information I want to share. I&#39;m not sure yet how to reconcile this.  Creating a channel for every communication stream also seems like a LOT of work, even if it&#39;s idiomatic.  I&#39;m fairly new to this and I really just need to wrap my head around how Go wants me to architect this. Maybe I get there over time."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "reply_to_user": {"reputation": 74246, "user_id": 80911, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9e9b4f80c65dc6076d74cd421084e4fc?s=128&d=identicon&r=PG", "display_name": "Evert", "link": "https://stackoverflow.com/users/80911/evert"}, "edited": false, "score": 0, "creation_date": 1468228221, "post_id": 38295110, "comment_id": 64022657, "body": "Channels shouldn&#39;t scare you - we deal with values and function values too. Just remember that channels are quite like Unix pipes - a tube with two ends. The flow is conventionally one way (but Go channels are not limited to this). If in doubt, draw a picture of the channel wiring and think of it being like digital hardware design or a microservice network, whichever is easier."}], "tags": [], "owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "is_accepted": false, "score": 3, "last_activity_date": 1468174925, "creation_date": 1468174925, "answer_id": 38295110, "question_id": 38288459, "link": "https://stackoverflow.com/questions/38288459/sharing-a-slice-across-a-few-different-goroutines/38295110#38295110", "title": "Sharing a slice across a few different goroutines", "body": "<p>The idiomatic Go way to share data between concurrent activities is summed up in this:</p>\n\n<blockquote>\n  <p>Do not communicate by sharing memory; instead, share memory by\n  communicating.</p>\n</blockquote>\n\n<p>Andrew Gerrand <a href=\"https://blog.golang.org/share-memory-by-communicating\" rel=\"nofollow\">blogged about this</a>, for example.</p>\n\n<p>It need not be overly-complex; you can think of designing internal microservices, expressed using goroutines with channels.</p>\n\n<p>In your case, this probably means designing a service element to contain the master copy of the list of users.</p>\n\n<p>The main advantages of the Go/CSP strategy are that</p>\n\n<ul>\n<li>concurrency is a design choice, along with your other aspects of design</li>\n<li>only local knowledge is needed to understand the concurrent behaviour: this arises because a goroutine can itself consist of internal goroutines, and this applies all the way down if needed. Understanding the external behaviour of the higher-level goroutines depends only on its interfaces, not on the hidden internals.</li>\n</ul>\n\n<p><strong>But...</strong></p>\n\n<p>There are times when a safely shared data structure (protected by mutexes) will be sufficient now and always. It might then be argued that the extra complexity of goroutines and channels is a non-requirement.</p>\n\n<p>A safely shared list data structure is something you will find several people have provided as open-source APIs. (I have one myself - see the built-ins in <a href=\"https://github.com/rickb777/runtemplate\" rel=\"nofollow\">runtemplate</a>).</p>\n"}], "owner": {"reputation": 74246, "user_id": 80911, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/9e9b4f80c65dc6076d74cd421084e4fc?s=128&d=identicon&r=PG", "display_name": "Evert", "link": "https://stackoverflow.com/users/80911/evert"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1048, "favorite_count": 0, "accepted_answer_id": 38288472, "answer_count": 2, "score": 1, "last_activity_date": 1468174925, "creation_date": 1468123483, "question_id": 38288459, "link": "https://stackoverflow.com/questions/38288459/sharing-a-slice-across-a-few-different-goroutines", "title": "Sharing a slice across a few different goroutines", "body": "<p>Given that I have an slice of structs of type User</p>\n\n<pre><code>Users := make([]User)\n</code></pre>\n\n<p>I am listening for TCP connections, and when a user connects, I'm adding an new user to this slice.</p>\n\n<p>The way I've done this, is by setting up a NewUsers channel</p>\n\n<pre><code>NewUsers := make(chan User)\n</code></pre>\n\n<p>Upon new TCP connects, a User gets sent to this channel, and a central function waits for a User to arrive to add it to the Users slice.</p>\n\n<p>But now I would like multiple subsystems (packages/functions) to use this list of Users. One function might simply want to receive a list of users, while a different function might want to broadcast messages to every user, or just users matching a certain condition.</p>\n\n<p>How do multiple functions (which are possibly executed from different goroutines) safely access the list of users. I see two possible ways:</p>\n\n<ol>\n<li>Every subsystem that needs access to this list needs their own AddUser channel and maintain their own slice of users and something needs to broadcast new users to every one of these channels.</li>\n<li>Block access with a Mutex</li>\n</ol>\n\n<p>Option 1 seems very convoluted and would generate a fair bit of duplication, but my understanding that Mutexes are best to be avoided if you try to stick to the \"Share Memory By Communicating\" mantra.</p>\n"}, {"tags": ["javascript", "html", "go", "server", "filesystems"], "comments": [{"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1468121078, "post_id": 38288170, "comment_id": 63994875, "body": "I am getting Error : ./main.go:9: undefined: NewRouter Can you fix and push code so I can check!"}, {"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1468121663, "post_id": 38288170, "comment_id": 63994979, "body": "I couldn&#39;t see your css and image folder?"}, {"owner": {"reputation": 569, "user_id": 5759262, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/10208150398865304/picture?type=large", "display_name": "Sammy Roberts", "link": "https://stackoverflow.com/users/5759262/sammy-roberts"}, "reply_to_user": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1468122453, "post_id": 38288170, "comment_id": 63995121, "body": "@PravinMishra try go run *.go also I dont have the css or image up yet, just scripts, I figure if i can get scripts working I can get the rest working."}, {"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1468122990, "post_id": 38288170, "comment_id": 63995188, "body": "Please have a look to this code: <a href=\"https://github.com/diatmpravin/aakash/blob/master/main.go\" rel=\"nofollow noreferrer\">github.com/diatmpravin/aakash/blob/master/main.go</a>"}, {"owner": {"reputation": 569, "user_id": 5759262, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/10208150398865304/picture?type=large", "display_name": "Sammy Roberts", "link": "https://stackoverflow.com/users/5759262/sammy-roberts"}, "reply_to_user": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "edited": false, "score": 0, "creation_date": 1468134112, "post_id": 38288170, "comment_id": 63996849, "body": "@PravinMishra trying your code updated to look like this|  func serveResource(w http.ResponseWriter, req *http.Request) { \tprint(&quot;serving&quot;) \tpath := req.URL.Path \tprint(req.URL.Path) \thttp.ServeFile(w, req, path) } func main() { \trouter := NewRouter() \thttp.HandleFunc(&quot;/scripts/app.js&quot;, serveResource) \thttp.HandleFunc(&quot;/scripts/todoCtrl.js&quot;, serveResource) \tlog.Fatal(http.ListenAndServe(&quot;:8080&quot;, router)) }  however i never enter serve function"}], "answers": [{"comments": [{"owner": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1468136738, "post_id": 38289633, "comment_id": 63997382, "body": "Better still: don&#39;t use relative paths. Have your application use absolute paths, be they simply passed via environmental variables or config file."}, {"owner": {"reputation": 569, "user_id": 5759262, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/10208150398865304/picture?type=large", "display_name": "Sammy Roberts", "link": "https://stackoverflow.com/users/5759262/sammy-roberts"}, "reply_to_user": {"reputation": 19878, "user_id": 556573, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/az7kz.png?s=128&g=1", "display_name": "elithrar", "link": "https://stackoverflow.com/users/556573/elithrar"}, "edited": false, "score": 0, "creation_date": 1468212628, "post_id": 38289633, "comment_id": 64015266, "body": "@elithrar good idea, will you give me an example? I am still pretty new to backend stuff with go."}], "tags": [], "owner": {"reputation": 569, "user_id": 5759262, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/10208150398865304/picture?type=large", "display_name": "Sammy Roberts", "link": "https://stackoverflow.com/users/5759262/sammy-roberts"}, "is_accepted": true, "score": 1, "last_activity_date": 1468600800, "last_edit_date": 1468600800, "creation_date": 1468135422, "answer_id": 38289633, "question_id": 38288170, "link": "https://stackoverflow.com/questions/38288170/trouble-finding-assets-on-my-html-serving-from-a-go-web-server/38289633#38289633", "title": "Trouble finding assets on my HTML, serving from a Go web server", "body": "<p>Finally got it working, YOU MUST HAVE THE ./ IN FRONT OR IT WONT WORK.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n\n    \"github.com/gorilla/mux\"\n)\n\nfunc ServeStatic(router *mux.Router, staticDirectory string) {\n    staticPaths := map[string]string{\n        \"styles\":           staticDirectory + \"/styles/\",\n        \"bower_components\": staticDirectory + \"/bower_components/\",\n        \"images\":           staticDirectory + \"/images/\",\n        \"scripts\":          staticDirectory + \"/scripts/\",\n    }\n    fmt.Println(staticPaths)\n\n    for pathName, pathValue := range staticPaths {\n        pathPrefix := \"/\" + pathName + \"/\"\n        router.PathPrefix(pathPrefix).Handler(http.StripPrefix(pathPrefix,\n            http.FileServer(http.Dir(pathValue))))\n        fmt.Println(pathValue)\n    }\n}\nfunc main() {\n    router := NewRouter()\n\n    staticDirectory := \"./static\"\n    ServeStatic(router, staticDirectory)\n\n    log.Fatal(http.ListenAndServe(\":8080\", router))\n}\n</code></pre>\n\n<p>my scripts are in ./static/scripts/\nI.E. ./static/scripts/app.js\nTLDR treat each asset route as a route on your router, not a space on your file system</p>\n"}], "owner": {"reputation": 569, "user_id": 5759262, "user_type": "registered", "accept_rate": 65, "profile_image": "https://graph.facebook.com/10208150398865304/picture?type=large", "display_name": "Sammy Roberts", "link": "https://stackoverflow.com/users/5759262/sammy-roberts"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 80, "favorite_count": 0, "accepted_answer_id": 38289633, "answer_count": 1, "score": 1, "last_activity_date": 1468600800, "creation_date": 1468119469, "question_id": 38288170, "link": "https://stackoverflow.com/questions/38288170/trouble-finding-assets-on-my-html-serving-from-a-go-web-server", "title": "Trouble finding assets on my HTML, serving from a Go web server", "body": "<p>I am editing some tutorial code I found online, and wanted to add a front end. I got my router spitting out my html no problem, but the html cannot find my static files.\nhere is my main function</p>\n\n<pre><code>func main() {\n   router := NewRouter()\n   cssHandler := http.FileServer(http.Dir(\"./css/\"))\n   imagesHandler := http.FileServer(http.Dir(\"./images/\"))\n   scriptHandler := http.FileServer(http.Dir(\"./scripts/\"))\n\n   http.Handle(\"/scripts/\", http.StripPrefix(\"/scripts/\", scriptHandler))\n   http.Handle(\"/css/\", http.StripPrefix(\"/css/\", cssHandler))\n   http.Handle(\"/images/\", http.StripPrefix(\"/images/\", imagesHandler))\n   log.Fatal(http.ListenAndServe(\":8080\", router))\n</code></pre>\n\n<p>}</p>\n\n<p>here is my index</p>\n\n<pre><code>&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n  &lt;head&gt;\n    &lt;title&gt;Go Do IT&lt;/title&gt;\n    &lt;link href=\"https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css\" rel=\"stylesheet\" integrity=\"sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7\" crossorigin=\"anonymous\"&gt;\n    &lt;script src=\"https://ajax.googleapis.com/ajax/libs/angularjs/1.5.6/angular.min.js\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\" src=\"./scripts/app.js\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\" src=\"./scripts/toDoCtrl.js\"&gt;&lt;/script&gt;\n  &lt;/head&gt;\n  &lt;body ng-app=\"app\"&gt;\n    &lt;div ng-controller=\"toDoCtrl as ctrl\"&gt;\n      &lt;div ng-repeat =\"todo in ctrl.todos\"&gt;\n        {{todo}}\n      &lt;/div&gt;\n    &lt;/div&gt;\n  &lt;/body&gt;\n</code></pre>\n\n<p></p>\n\n<p>if you want to see all the code, here is a repo i am working on <a href=\"https://github.com/kekeoki/go-do-it\" rel=\"nofollow\">https://github.com/kekeoki/go-do-it</a>\nI have tried putting things in a grouped static folder, and most recently I moved the scripts folder to the base directory. If you have any good tutorial links, please let me know, everything I have found so far has not helped.\nThanks</p>\n"}, {"tags": ["bash", "go"], "answers": [{"comments": [{"owner": {"reputation": 24240, "user_id": 495935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d310e51ac60b2a54b68b96e90593277b?s=128&d=identicon&r=PG", "display_name": "Surreal Dreams", "link": "https://stackoverflow.com/users/495935/surreal-dreams"}, "edited": false, "score": 0, "creation_date": 1468121183, "post_id": 38288103, "comment_id": 63994899, "body": "I&#39;d thought of this, and had mocked it up with a static string as a test.  It works.  However, I was hoping that I could do this without dumping the contents of the data into a pipe like this.  However, if it&#39;s the only way, that&#39;ll have to do."}, {"owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "reply_to_user": {"reputation": 24240, "user_id": 495935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d310e51ac60b2a54b68b96e90593277b?s=128&d=identicon&r=PG", "display_name": "Surreal Dreams", "link": "https://stackoverflow.com/users/495935/surreal-dreams"}, "edited": false, "score": 0, "creation_date": 1468122004, "post_id": 38288103, "comment_id": 63995047, "body": "calling like ` exec.Command(&quot;/sbin/iptables-restore&quot;, &quot;&lt;&quot;, &quot;/etc/iptables.conf&quot;)` will not work: the &quot;&lt;&quot; and  &quot;/etc/iptables.conf&quot; used as Args to &quot;/sbin/iptables-restore&quot;.  I think you need <code>exec.Command(&quot;&#47;sbin&#47;iptables-restore &lt; &#47;etc&#47;iptables.conf&quot;)</code> but this doesn&#39;t work either. with error:file not found(in my case), you may call one external shell file which it calls &quot;/sbin/iptables-restore &lt; /etc/iptables.conf&quot;."}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 5, "last_activity_date": 1468119139, "last_edit_date": 1468119139, "creation_date": 1468118527, "answer_id": 38288103, "question_id": 38288012, "link": "https://stackoverflow.com/questions/38288012/exec-command-with-input-redirection/38288103#38288103", "title": "exec.Command with input redirection", "body": "<p>first read this <code>/etc/iptables.conf</code> file content then write it to <code>cmd.StdinPipe()</code>  like this:  </p>\n\n<pre><code>package main\n\nimport (\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    bytes, err := ioutil.ReadFile(\"/etc/iptables.conf\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    cmd := exec.Command(\"/sbin/iptables-restore\")\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = cmd.Start()\n    if err != nil {\n        log.Fatal(err)\n    }\n    _, err = io.WriteString(stdin, string(bytes))\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1, "user_id": 4426051, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YkJjN.jpg?s=128&g=1", "display_name": "r3call.404", "link": "https://stackoverflow.com/users/4426051/r3call-404"}, "is_accepted": false, "score": 0, "last_activity_date": 1546172440, "creation_date": 1546172440, "answer_id": 53977540, "question_id": 38288012, "link": "https://stackoverflow.com/questions/38288012/exec-command-with-input-redirection/53977540#53977540", "title": "exec.Command with input redirection", "body": "<pre><code>cmd := exec.Command(\"/usr/sbin/iptables-restore\", \"--binary\", iptablesFilePath)\n_, err := cmd.CombinedOutput()\nif err != nil {\n    return err\n}\nreturn nil\n</code></pre>\n\n<p>this work fine on my Raspberry Pi3</p>\n"}], "owner": {"reputation": 24240, "user_id": 495935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d310e51ac60b2a54b68b96e90593277b?s=128&d=identicon&r=PG", "display_name": "Surreal Dreams", "link": "https://stackoverflow.com/users/495935/surreal-dreams"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3232, "favorite_count": 0, "accepted_answer_id": 38288103, "answer_count": 2, "score": 4, "last_activity_date": 1609327117, "creation_date": 1468117144, "last_edit_date": 1609327117, "question_id": 38288012, "link": "https://stackoverflow.com/questions/38288012/exec-command-with-input-redirection", "title": "exec.Command with input redirection", "body": "<p>I'm trying to run a fairly simple bash command from my Go code.  My program writes out an IPTables config file and I need to issue a command to make IPTables refresh from this config.  This is very straightforward at the commandline:</p>\n\n<p><code>/sbin/iptables-restore &lt; /etc/iptables.conf</code></p>\n\n<p>However, I can't for the life of me figure out how to issue this command with exec.Command().  I tried a few things to accomplish this:</p>\n\n<pre><code>cmd := exec.Command(\"/sbin/iptables-restore\", \"&lt;\", \"/etc/iptables.conf\")\n// And also\ncmd := exec.Command(\"/sbin/iptables-restore\", \"&lt; /etc/iptables.conf\")\n</code></pre>\n\n<p>No surprise, neither of those worked.  I also tried to feed the filename into the command by piping in the file name to stdin:</p>\n\n<pre><code>cmd := exec.Command(\"/sbin/iptables-restore\")\nstdin, err := cmd.StdinPipe()\nif err != nil {\n    log.Fatal(err)\n}\n\nerr = cmd.Start()\nif err != nil {\n    log.Fatal(err)\n}\n\nio.WriteString(stdin, \"/etc/iptables.conf\")\n</code></pre>\n\n<p>That doesn't work either, no surprise.  I <em>can</em> use stdin to pipe in the contents of the file, but this seems silly when I can just tell iptables-restore what data to go read.  So how might I get Go to run the command <code>/sbin/iptables-restore &lt; /etc/iptables.conf</code>?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1222, "user_id": 5806017, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/TXRib.jpg?s=128&g=1", "display_name": "Garvit Jain", "link": "https://stackoverflow.com/users/5806017/garvit-jain"}, "edited": false, "score": 0, "creation_date": 1506836448, "post_id": 38288215, "comment_id": 79973235, "body": "how to gzip it ?"}], "tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": true, "score": 1, "last_activity_date": 1468120916, "last_edit_date": 1468120916, "creation_date": 1468120252, "answer_id": 38288215, "question_id": 38287922, "link": "https://stackoverflow.com/questions/38287922/os-exec-to-dump-mysql-data-to-file/38288215#38288215", "title": "os/exec to dump mysql data to file", "body": "<p>use this ( separate Args):  </p>\n\n<pre><code>cmd := exec.Command(\"mysqldump\", \"-P3306\", \"-hhost\", \"-uuser\", \"-ppassword\", \"database_name\")\n</code></pre>\n\n<p>my test sample code:  </p>\n\n<pre><code>package main\n\nimport (\n    \"io/ioutil\"\n    \"log\"\n    \"os/exec\"\n)\n\nfunc main() {\n    cmd := exec.Command(\"mysqldump\", \"-P3306\", \"-hhost\", \"-uuser\", \"-ppassword\", \"database_name\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    bytes, err := ioutil.ReadAll(stdout)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = ioutil.WriteFile(\"./out.sql\", bytes, 0644)\n    if err != nil {\n        panic(err)\n    }\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1016, "user_id": 1694962, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/271238f63f992d2bd704d78bb311e9e8?s=128&d=identicon&r=PG&f=1", "display_name": "Chait", "link": "https://stackoverflow.com/users/1694962/chait"}, "edited": false, "score": 0, "creation_date": 1482371650, "post_id": 41274498, "comment_id": 69750814, "body": "Hello, looks like the answer is incomplete - please fix by completing."}], "tags": [], "owner": {"reputation": 31, "user_id": 5009890, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2901cb2859b4fbd8d8892c52861288b5?s=128&d=identicon&r=PG&f=1", "display_name": "Walker Wei", "link": "https://stackoverflow.com/users/5009890/walker-wei"}, "is_accepted": false, "score": 0, "last_activity_date": 1482370052, "creation_date": 1482370052, "answer_id": 41274498, "question_id": 38287922, "link": "https://stackoverflow.com/questions/38287922/os-exec-to-dump-mysql-data-to-file/41274498#41274498", "title": "os/exec to dump mysql data to file", "body": "<p><code>cmd := exec.Command(\"mysqldump\", \"-P3306\", \"-hhost\", \"-uuser\", \"-ppassword\", \"database_name\" \"table_name\")</code>\nJust add the table name w</p>\n"}], "owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2841, "favorite_count": 1, "accepted_answer_id": 38288215, "answer_count": 2, "score": 2, "last_activity_date": 1569304772, "creation_date": 1468115983, "last_edit_date": 1569304772, "question_id": 38287922, "link": "https://stackoverflow.com/questions/38287922/os-exec-to-dump-mysql-data-to-file", "title": "os/exec to dump mysql data to file", "body": "<p>Hi guys its almost 3AM here in London and I am losing this fight. I am trying to dump a mysql database into a sql file. It works fine from the command line but not when I try to do the same from Go (using the <code>os/exec</code> library). I have tried almost everything my stupid head could come up with... It works fine with echo command, but it completely ignores mysqldump. Could you please point me in the right direction?</p>\n\n<pre><code>package main\n\nimport (\n    \"os/exec\"\n    \"log\"\n    \"bufio\"\n    \"os\"\n    \"io\"\n)\n\nfunc main() {\n    // This Doesn't\n    // cmd := exec.Command(\"mysqldump\", \"-P3306 -hhost -uuser -ppassword database_name\")\n    // This Works\n    cmd := exec.Command(\"echo\", \"Hello World bla bla\")\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    outfile, err := os.Create(\"./out.sql\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer outfile.Close()\n\n    // start the command after having set up the pipe\n    if err := cmd.Start(); err != nil {\n        log.Fatal(err)\n    }\n\n    // read command's stdout line by line\n    in := bufio.NewWriter(outfile)\n    defer in.Flush()\n\n    io.Copy(outfile, stdout)\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "bson"], "answers": [{"comments": [{"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1468474317, "post_id": 38324656, "comment_id": 64143947, "body": "Ah, I see how it works, that makes more sense. Thanks!"}, {"owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1468517638, "post_id": 38324656, "comment_id": 64171130, "body": "I am getting a maximum batch size error, though. I&#39;m doing <code>bulk.Upsert()</code> in batches of 100, then calling <code>bulk.Run()</code> to push those upserts. that should be the proper way to work around that, correct?"}, {"owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "reply_to_user": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "edited": false, "score": 0, "creation_date": 1468518296, "post_id": 38324656, "comment_id": 64171544, "body": "@mynameismevin yes, your way is right. Also, <a href=\"https://github.com/go-mgo/mgo/issues/288\" rel=\"nofollow noreferrer\">according to <code>mgo</code> issue</a> limit is 1000 entries per batch so you should be able to increase the number of auctions per batch."}], "tags": [], "owner": {"reputation": 3587, "user_id": 580709, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/04b8519613c122e8f395187d27eb5bef?s=128&d=identicon&r=PG&f=1", "display_name": "CrazyCrow", "link": "https://stackoverflow.com/users/580709/crazycrow"}, "is_accepted": true, "score": 1, "last_activity_date": 1468336276, "last_edit_date": 1468336276, "creation_date": 1468314953, "answer_id": 38324656, "question_id": 38287439, "link": "https://stackoverflow.com/questions/38287439/mgo-wrong-type-for-field/38324656#38324656", "title": "Mgo wrong type for field", "body": "<p>Don't know if this is still actual. Here is the code:</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/mgo.v2\"\n    \"log\"\n    \"io/ioutil\"\n    \"encoding/json\"\n    \"gopkg.in/mgo.v2/bson\"\n)\n\ntype Auctions struct {\n    Auc   int `json:\"auc\" bson:\"_id\"`\n    Owner string `json:\"owner\" bson:\"owner\"`\n}\n\ntype AuctionResponse struct {\n    Auctions []Auctions `json:\"auctions\"`\n}\n\nfunc main() {\n    session, err := mgo.Dial(\"mongodb://127.0.0.1:27017/aucs\")\n\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    db := session.DB(\"aucs\")\n\n    var AuctionData AuctionResponse\n    AuctionBody, _ := ioutil.ReadFile(\"auctions.json\")\n    err = json.Unmarshal(AuctionBody, &amp;AuctionData)\n\n    log.Println(\"performing bulk upsert for %s\", \"realm\")\n\n    bulk := db.C(\"realm\").Bulk()\n    for _, auc := range AuctionData.Auctions {\n        bulk.Upsert(bson.M{\"_id\": auc.Auc}, auc)\n    }\n    _, err = bulk.Run()\n    if err != nil {\n        log.Panic(\"error performing upsert! error: \", err)\n    }\n}\n</code></pre>\n\n<p>There are some changes that I've made to check if I was right on real data but I hope it's not hard to understand what's going on. Now let me explain a bit Mongo's part.</p>\n\n<ol>\n<li>You don't need to get <code>existing</code> documents. That would be strange to request all existing documents before updating or inserting them especially on huge databases.</li>\n<li><code>mgo</code>'s <code>upsert</code> function requires two parameters: \n\n<ul>\n<li><code>selector</code> document (I prefer to think about it as about <code>WHERE</code> condition in terms of SQL) </li>\n<li><code>document</code> that you actually have and that will be inserted into DB if selector query fails</li>\n</ul></li>\n<li>In case of bulk <code>upsert</code> there is unlimited amount of <code>selector - document</code> pairs available to push in one request like <code>bulk.Upsert(sel1, doc1, sel2, doc2, sel3, doc3)</code> but in your case there is no point to use this feature.</li>\n<li><p><code>upsert</code> affect only single document so even if you <code>selector</code> fits multiple documents only first will be updated. In other words, <code>upsert</code> is more similar to MySQL's <code>INSERT ... ON DUPLICATE KEY UPDATE</code> than to  <code>UPDATE ... WHERE</code>. In your case (with unique auction's IDs) single <code>upsert</code> looks like MySQL query: </p>\n\n<pre><code>INSERT INTO realm (auc, owner) VALUES ('1', 'Hogger') ON DUPLICATE KEY UPDATE owner = 'Hogger';\n</code></pre></li>\n<li><p>With <code>bulk</code> we can just make multiple upserts in the loop and then run them at once.</p></li>\n</ol>\n"}], "owner": {"reputation": 1256, "user_id": 4949938, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/7586b74526dc4ef59eb6f8b6d4cb6a94?s=128&d=identicon&r=PG", "display_name": "mxplusb", "link": "https://stackoverflow.com/users/4949938/mxplusb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2243, "favorite_count": 0, "accepted_answer_id": 38324656, "answer_count": 1, "score": 0, "last_activity_date": 1468336276, "creation_date": 1468109596, "question_id": 38287439, "link": "https://stackoverflow.com/questions/38287439/mgo-wrong-type-for-field", "title": "Mgo wrong type for field", "body": "<p>I am trying to do a bulk upsert with the mgo library. I was reading the <a href=\"http://godoc.org/gopkg.in/mgo.v2#Bulk.Upsert\" rel=\"nofollow\">documentation</a> regarding bulk upserts since this is the first time I've ever used MongoDB, and it looks like I have to provide pairs of documents to update.</p>\n\n<p>In my function, I'm performing a find all query, then using the results from the query to use as the existing part of the pair for the <code>bulk.Upsert()</code> operation. I'm not sure if this is the right way to go about it, but I have to do upserts on ~65k documents at a time.</p>\n\n<p>Here are the type structs, and the worker pool function which reads from a channel to perform the aforementioned MongoDB operations.</p>\n\n<pre><code>// types from my project's `lib` package.\ntype Auctions struct {\n    Auc          int `json:\"auc\" bson:\"_id\"`\n    Item         int `json:\"item\" bson:\"item\"`\n    Owner        string `json:\"owner\" bson:\"owner\"`\n    OwnerRealm   string `json:\"ownerRealm\" bson:\"ownerRealm\"`\n    Bid          int `json:\"bid\" bson:\"bid\"`\n    Buyout       int `json:\"buyout\" bson:\"buyout\"`\n    Quantity     int `json:\"quantity\" bson:\"quantity\"`\n    TimeLeft     string `json:\"timeLeft\" bson:\"timeLeft\"`\n    Rand         int `json:\"rand\" bson:\"rand\"`\n    Seed         int `json:\"seed\" bson:\"seed\"`\n    Context      int `json:\"context\" bson:\"context\"`\n    BonusLists   []struct {\n        BonusListID int `json:\"bonusListId\" bson:\"bonusListId\"`\n    } `json:\"bonusLists,omitempty\" bson:\"bonusLists,omitempty\"`\n    Modifiers    []struct {\n        Type  int `json:\"type\" bson:\"type\"`\n        Value int `json:\"value\" bson:\"value\"`\n    } `json:\"modifiers,omitempty\" bson:\"modifiers,omitempty\"`\n    PetSpeciesID int `json:\"petSpeciesId,omitempty\" bson:\"petSpeciesId,omitempty\"`\n    PetBreedID   int `json:\"petBreedId,omitempty\" bson:\"petBreedId,omitempty\"`\n    PetLevel     int `json:\"petLevel,omitempty\" bson:\"petLevel,omitempty\"`\n    PetQualityID int `json:\"petQualityId,omitempty\" bson:\"petQualityId,omitempty\"`\n}\n\ntype AuctionResponse struct {\n    Realms   []struct {\n        Name string `json:\"name\"`\n        Slug string `json:\"slug\"`\n    } `json:\"realms\"`\n    Auctions []Auctions `json:\"auctions\"`\n}\n\nfunc (b *Blizzard) RealmAuctionGrabber(realms chan string, db *mgo.Database, wg *sync.WaitGroup) {\n    defer wg.Done()\n    for i := range realms {\n        NewReq, err := http.NewRequest(\"GET\", fmt.Sprintf(\"%s/auction/data/%s\", b.Url, i), nil)\n        if err != nil {\n            fmt.Printf(\"Cannot create new request for realm %s: %s\", i, err)\n        }\n\n        // Update the request with the default parameters and grab the files links.\n        Request := PopulateDefaultParams(NewReq)\n        log.Debugf(\"downloading %s auction locations.\", i)\n        Response, err := b.Client.Do(Request)\n        if err != nil {\n            fmt.Printf(\"Error request realm auction data: %s\\n\", err)\n        }\n        defer Response.Body.Close()\n\n        Body, err := ioutil.ReadAll(Response.Body)\n        if err != nil {\n            fmt.Printf(\"Error parsing request body: %s\\n\", err)\n        }\n\n        var AuctionResp lib.AuctionAPI\n        err = json.Unmarshal(Body, &amp;AuctionResp)\n        if err != nil {\n            fmt.Printf(\"Error marshalling auction repsonse body: %s\\n\", err)\n        }\n\n        for _, x := range AuctionResp.Files {\n            NewDataReq, err := http.NewRequest(\"GET\", x.URL, nil)\n            if err != nil {\n                log.Error(err)\n            }\n\n            AuctionResponse, err := b.Client.Do(NewDataReq)\n            if err != nil {\n                fmt.Printf(\"Error request realm auction data: %s\\n\", err)\n            }\n            defer Response.Body.Close()\n\n            AuctionBody, err := ioutil.ReadAll(AuctionResponse.Body)\n            if err != nil {\n                fmt.Printf(\"Error parsing request body: %s\\n\", err)\n            }\n\n            var AuctionData lib.AuctionResponse\n            err = json.Unmarshal(AuctionBody, &amp;AuctionData)\n\n            // grab all the current records, then perform an Upsert!\n            var existing []lib.Auctions\n            col := db.C(i)\n            err = col.Find(nil).All(&amp;existing)\n            if err != nil {\n                log.Error(err)\n            }\n\n            log.Infof(\"performing bulk upsert for %s\", i)\n\n            auctionData, err := bson.Marshal(AuctionData.Auctions)\n            if err != nil {\n                log.Error(\"error marshalling bson: %s\", err)\n            }\n\n            existingData, _ := bson.Marshal(existing)\n            bulk := db.C(i).Bulk()\n            bulk.Upsert(existingData, auctionData)\n            _, err = bulk.Run()\n            if err != nil {\n                log.Error(\"error performing upsert! error: \", err)\n            }\n        }\n    }\n}\n</code></pre>\n\n<p>When I call <code>bulk.Upsert(existingData,auctionData)</code>, things are fine. However, when I call <code>bulk.Run()</code>, I'm getting this logged error message:</p>\n\n<pre><code>{\"level\":\"error\",\"msg\":\"error performing upsert! error: wrong type for 'q' field, expected object, found q: BinData(0, 0500000000)\",\"time\":\"2016-07-09T16:53:45-07:00\"}\n</code></pre>\n\n<p>I'm assuming this is related to how I'm doing the BSON tagging in the <code>Auction</code> struct, but I'm not sure because this is the first time I've worked with MongoDB. Right now there are no collections in the database, </p>\n\n<p>Is the error message related to the BSON tagging, and how can I fix it?</p>\n"}, {"tags": ["go", "tibco-ems"], "comments": [{"owner": {"reputation": 18722, "user_id": 1702943, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/nqRAA.png?s=128&g=1", "display_name": "Rao", "link": "https://stackoverflow.com/users/1702943/rao"}, "edited": false, "score": 0, "creation_date": 1468213566, "post_id": 38286086, "comment_id": 64015544, "body": "What is your ems version?"}, {"owner": {"reputation": 4201, "user_id": 2654100, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9f05fb88dda64324acdc6390b4a38a1a?s=128&d=identicon&r=PG", "display_name": "Ostati", "link": "https://stackoverflow.com/users/2654100/ostati"}, "reply_to_user": {"reputation": 18722, "user_id": 1702943, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/nqRAA.png?s=128&g=1", "display_name": "Rao", "link": "https://stackoverflow.com/users/1702943/rao"}, "edited": false, "score": 0, "creation_date": 1468255591, "post_id": 38286086, "comment_id": 64040874, "body": "I got two separate versions 6.3 and 8.2"}, {"owner": {"reputation": 18722, "user_id": 1702943, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/nqRAA.png?s=128&g=1", "display_name": "Rao", "link": "https://stackoverflow.com/users/1702943/rao"}, "edited": false, "score": 0, "creation_date": 1468257580, "post_id": 38286086, "comment_id": 64041876, "body": "I think you should be able to find the supported api&#39;s under EMS installation/samples"}, {"owner": {"reputation": 4201, "user_id": 2654100, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9f05fb88dda64324acdc6390b4a38a1a?s=128&d=identicon&r=PG", "display_name": "Ostati", "link": "https://stackoverflow.com/users/2654100/ostati"}, "reply_to_user": {"reputation": 18722, "user_id": 1702943, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/nqRAA.png?s=128&g=1", "display_name": "Rao", "link": "https://stackoverflow.com/users/1702943/rao"}, "edited": false, "score": 0, "creation_date": 1468328428, "post_id": 38286086, "comment_id": 64073703, "body": "There&#39;s nothing Go related there."}, {"owner": {"reputation": 4201, "user_id": 2654100, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9f05fb88dda64324acdc6390b4a38a1a?s=128&d=identicon&r=PG", "display_name": "Ostati", "link": "https://stackoverflow.com/users/2654100/ostati"}, "reply_to_user": {"reputation": 18722, "user_id": 1702943, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/nqRAA.png?s=128&g=1", "display_name": "Rao", "link": "https://stackoverflow.com/users/1702943/rao"}, "edited": false, "score": 0, "creation_date": 1468346635, "post_id": 38286086, "comment_id": 64086101, "body": "Disappointing response from TIBCO:   Thank you for contacting TIBCO Support.EMS client libraries are provided in C, Java, .NET and COBOL languages. We do not have any client libraries or sample code for EMS for GO programming language."}], "answers": [{"tags": [], "owner": {"reputation": 123, "user_id": 6262157, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/uG6Hz.jpg?s=128&g=1", "display_name": "hanneslehmann", "link": "https://stackoverflow.com/users/6262157/hanneslehmann"}, "is_accepted": false, "score": 1, "last_activity_date": 1547463581, "creation_date": 1547463581, "answer_id": 54180193, "question_id": 38286086, "link": "https://stackoverflow.com/questions/38286086/go-api-for-tibco-ems/54180193#54180193", "title": "Go API for Tibco EMS", "body": "<p>AFAIK is JMS a standard describing the application interface (API) for using a messaging system. EMS is one flavour implemented by TIBCO. The standard leaves room in some details of implementation of the interface and does not describe the protocol used on the wire (tcp). To cut it short, for a pure Go client the internal EMS protocol would be needed to make the raw tcp stuff in Go and make the mapping to the JMS/EMS API. As EMS ships with C header only files (the pure API) and shared object files I guess that this mapping is completely TIBCO internal know how - and cannot be taken up by anyone else than TIBCO. I myself tried with Cgo, but that hinders to make the interesting stuff, like (for example) compile for ARM and do some IoT use cases :)</p>\n"}], "owner": {"reputation": 4201, "user_id": 2654100, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/9f05fb88dda64324acdc6390b4a38a1a?s=128&d=identicon&r=PG", "display_name": "Ostati", "link": "https://stackoverflow.com/users/2654100/ostati"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 710, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1547463581, "creation_date": 1468096149, "last_edit_date": 1468213535, "question_id": 38286086, "link": "https://stackoverflow.com/questions/38286086/go-api-for-tibco-ems", "title": "Go API for Tibco EMS", "body": "<p>Anyone aware of there any Go API for Tibco EMS? I've been searching, but came up empty handed. Some people seem to be using C API via Cgo, but that's not what I'm after. I'd prefer pure Go API at this point.</p>\n\n<p>P.S. Not sure SO is appropriate for this question, but cannot seem to ask on Stack Exchange.</p>\n"}, {"tags": ["json", "go", "struct", "marshalling"], "comments": [{"owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1468089259, "post_id": 38284984, "comment_id": 63988653, "body": "I&#39;m a bit confused, so you&#39;re saying if you run the same code, that&#39;s in the playground, locally it doesn&#39;t display the same output?"}, {"owner": {"reputation": 41, "user_id": 1249931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec66a9f67d0fe181bdcac53918680789?s=128&d=identicon&r=PG", "display_name": "Traveller", "link": "https://stackoverflow.com/users/1249931/traveller"}, "reply_to_user": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "edited": false, "score": 0, "creation_date": 1468091593, "post_id": 38284984, "comment_id": 63989265, "body": "i edited the original question and made it much simpler."}], "answers": [{"tags": [], "owner": {"reputation": 16564, "user_id": 1261399, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/679444399bbf92e3a5d3f16347809f3f?s=128&d=identicon&r=PG", "display_name": "Leo Correa", "link": "https://stackoverflow.com/users/1261399/leo-correa"}, "is_accepted": true, "score": 2, "last_activity_date": 1468092008, "creation_date": 1468092008, "answer_id": 38285485, "question_id": 38284984, "link": "https://stackoverflow.com/questions/38284984/json-marshal-behaves-differently-with-two-objects-go-golang/38285485#38285485", "title": "json.Marshal behaves differently with two objects (Go/Golang)", "body": "<p>You're trying to print the representation of what <code>json.Marshal</code> outputs with <code>%+v</code>. </p>\n\n<p><a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">json.Marshal</a> returns a byte slice which is exactly what you're looking at. </p>\n\n<pre><code>jsonObject, err := json.Marshal(DatabaseObject{})\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%+v\", jsonObject)\n</code></pre>\n\n<p>Will print the bytes for the JSON string. If instead you use <code>fmt.Printf(\"%s\", jsonObject)</code> you'll get what you're looking for.</p>\n\n<p>Another option would be <code>fmt.Printf(\"%+v\", string(jsonObject))</code> just so you can see what I'm talking about I've modified the playground you provided. <a href=\"https://play.golang.org/p/ipbSbryk1L\" rel=\"nofollow\">https://play.golang.org/p/ipbSbryk1L</a></p>\n"}], "owner": {"reputation": 41, "user_id": 1249931, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec66a9f67d0fe181bdcac53918680789?s=128&d=identicon&r=PG", "display_name": "Traveller", "link": "https://stackoverflow.com/users/1249931/traveller"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 38285485, "answer_count": 1, "score": -2, "last_activity_date": 1468092008, "creation_date": 1468088844, "last_edit_date": 1468091532, "question_id": 38284984, "link": "https://stackoverflow.com/questions/38284984/json-marshal-behaves-differently-with-two-objects-go-golang", "title": "json.Marshal behaves differently with two objects (Go/Golang)", "body": "<p>So i want to marshal data to JSON. The basic struct looks like this:</p>\n\n<pre><code>type DatabaseObject struct {\n    Preferences []int             `json:\"preferences\"`\n    Texts       map[string]string `json:\"texts\"`\n    Options     map[string]string `json:\"options\"`\n    Gender      string            `json:\"gender\"`\n    EMail       string            `json:\"email\"`\n}\n</code></pre>\n\n<p>Here is the (working) Playground version: <a href=\"https://play.golang.org/p/GI3nAo7L4a\" rel=\"nofollow\">https://play.golang.org/p/GI3nAo7L4a</a></p>\n\n<p>When i use this code in my program however, the result is very different. Here is my code:</p>\n\n<pre><code>jsonObject, err := json.Marshal(DatabaseObject{})\nif err != nil {\n    log.Fatal(err)\n}\nfmt.Printf(\"%+v\", jsonObject)\n</code></pre>\n\n<p>It prints:</p>\n\n<pre><code>[123 34 112 114 101 102 101 114 101 110 99 101 115 34 58 110 117 108 108 44 34 116 101 120 116 115 34 58 110 117 108 108 44 34 111 112 116 105 111 110 115 34 58 110 117 108 108 44 34 103 101 110 100 101 114 34 58 34 34 44 34 101 109 97 105 108 34 58 34 34 125]\n</code></pre>\n\n<p>Does anyone know why json.Marshal does not work here? It's an empty struct, it should look like this</p>\n\n<pre><code>{\"preferences\":null,\"texts\":null,\"options\":null,\"gender\":\"\",\"email\":\"\"}\n</code></pre>\n"}, {"tags": ["algorithm", "recursion", "go"], "answers": [{"comments": [{"owner": {"reputation": 3196, "user_id": 4245174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qhbam.jpg?s=128&g=1", "display_name": "ifma", "link": "https://stackoverflow.com/users/4245174/ifma"}, "edited": false, "score": 1, "creation_date": 1468074310, "post_id": 38282674, "comment_id": 63984219, "body": "@nexus66 Because your function recursively returns 5, then 4, then 3... etc. So your j variable was equal to 5 at first, then it gets overwritten to 4, then 3, ..., until it hits 1, which you print."}, {"owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "edited": false, "score": 0, "creation_date": 1468074345, "post_id": 38282674, "comment_id": 63984227, "body": "Thanks ! I got the logic behind."}], "tags": [], "owner": {"reputation": 3196, "user_id": 4245174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qhbam.jpg?s=128&g=1", "display_name": "ifma", "link": "https://stackoverflow.com/users/4245174/ifma"}, "is_accepted": true, "score": 3, "last_activity_date": 1468073328, "last_edit_date": 1495540942, "creation_date": 1468073328, "answer_id": 38282674, "question_id": 38282610, "link": "https://stackoverflow.com/questions/38282610/algorithm-understanding-recursive-function/38282674#38282674", "title": "Algorithm: Understanding recursive function", "body": "<p>This line in the <code>func rec(i int)</code> function</p>\n\n<pre><code>rec(i+1) // recurse at the i+1 value\nfmt.Println(\"i = \", i)\n</code></pre>\n\n<p>Recursively iterates i until it reaches 5, after which your if condition triggers, which is why 5 is first printed, and then it successively goes down through the call stack, printing 4, then 3, ... etc.</p>\n\n<p>This is a question r.e. recursion, not Go specifically. There are numerous resources to help you understand, here is an explanation of recursion in the <a href=\"https://stackoverflow.com/questions/717725/understanding-recursion\">Towers of Hanoi problem</a>.</p>\n"}], "owner": {"reputation": 7745, "user_id": 3926995, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/2l63X.jpg?s=128&g=1", "display_name": "Chiheb Nexus", "link": "https://stackoverflow.com/users/3926995/chiheb-nexus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 38282674, "answer_count": 1, "score": 0, "last_activity_date": 1494088584, "creation_date": 1468072840, "last_edit_date": 1494088584, "question_id": 38282610, "link": "https://stackoverflow.com/questions/38282610/algorithm-understanding-recursive-function", "title": "Algorithm: Understanding recursive function", "body": "<p>I'm learning Golang and i'm trying to understand the logic behind the output of a recursive function.</p>\n\n<p>Here is my program :</p>\n\n<pre><code>package main \n\nimport(\n    \"fmt\"\n)\n\nfunc rec(i int) (int){\n    if i == 5{\n        fmt.Println(\"Break\", i)\n        return i\n    }\n\n    rec(i+1)\n    fmt.Println(\"i = \", i)\n\n    return i\n}\n\nfunc main(){\n    j := 0\n    j = rec(1)\n\n    fmt.Println(\"Value j = \", j)\n\n}\n</code></pre>\n\n<p>The output: </p>\n\n<pre><code>Break 5\ni =  4\ni =  3\ni =  2\ni =  1\nValue j =  1\n</code></pre>\n\n<p>My questions are: </p>\n\n<p>Why the first output (break 5) is in the top of outputs? Isn't the last output in my function to be printed ?</p>\n\n<p>And why in the main function</p>\n\n<pre><code>j = rec(1) \n</code></pre>\n\n<p>return 1 and ignore the return of the condition ?</p>\n\n<pre><code>if i == 5{ \n        fmt.Println(\"Break\", i)\n        return i // Here normally the return will be: return 5 ??\n    }\n</code></pre>\n\n<p>PS: I'm using Go version go1.2.1 linux/386 under Ubuntu 14.04</p>\n\n<p>Thanks for your answers.</p>\n"}, {"tags": ["http", "iframe", "go", "reverse-proxy", "same-origin-policy"], "answers": [{"tags": [], "owner": {"reputation": 75, "user_id": 1711461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e89b57e015f7e69b2e0a68006b9e0de?s=128&d=identicon&r=PG", "display_name": "Cruel", "link": "https://stackoverflow.com/users/1711461/cruel"}, "is_accepted": true, "score": 0, "last_activity_date": 1468577801, "creation_date": 1468577801, "answer_id": 38393589, "question_id": 38281971, "link": "https://stackoverflow.com/questions/38281971/golang-reverse-proxy-to-avoid-sop/38393589#38393589", "title": "Golang Reverse Proxy to avoid SOP", "body": "<p>After some investigation with <a href=\"https://www.telerik.com/download/fiddler/fiddler2\" rel=\"nofollow\">fiddler</a> I was able to find out that the specified address (<a href=\"http://google.com\" rel=\"nofollow\">http://google.com</a>) sends a redirect-response back. The transaction was basically like this:</p>\n\n<p>Client -> MyProxy -> RealWebsite</p>\n\n<p>Client &lt;- Myproxy &lt;- RealWebsite: Location <a href=\"https://www.google.com\" rel=\"nofollow\">https://www.google.com</a></p>\n\n<p>Client -> <a href=\"https://www.google.com\" rel=\"nofollow\">https://www.google.com</a></p>\n\n<p>Therefore, the Client tried to open \"<a href=\"https://www.google.com\" rel=\"nofollow\">https://www.google.com</a>\" within the IFrame which has a conflict with the same-origin-policy. After some research I found <a href=\"https://github.com/golang/go/issues/14237\" rel=\"nofollow\">this github issue</a>. It seems like the golang Reverse Proxy doesn't transform the \"Location\"-Header (which is a redirect).</p>\n\n<p>I could now rewrite the Location-Header but I decided to use an existing reverse proxy (nginx). </p>\n"}], "owner": {"reputation": 75, "user_id": 1711461, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8e89b57e015f7e69b2e0a68006b9e0de?s=128&d=identicon&r=PG", "display_name": "Cruel", "link": "https://stackoverflow.com/users/1711461/cruel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 832, "favorite_count": 0, "accepted_answer_id": 38393589, "answer_count": 1, "score": 1, "last_activity_date": 1468577801, "creation_date": 1468068532, "last_edit_date": 1468130058, "question_id": 38281971, "link": "https://stackoverflow.com/questions/38281971/golang-reverse-proxy-to-avoid-sop", "title": "Golang Reverse Proxy to avoid SOP", "body": "<p>I am currently working on a web application (in golang) which will be used as a main portal for other internal applications (running in docker containers). This web application should simply serve a HTML-Page where a navigation bar is at the top and the rest of the page will be an IFrame. On the navigation bar we have multiple links which will change the source of the IFrame. It is important to know that the links on the navigation bar are dynamically created. </p>\n\n<p>I faced really soon the issue that the Iframe couldn't display the other internal applications because of the Same-Origin-Policy which blocks all content. To workaround this, I thought it might be a good idea to implement my own reverse proxy in golang. </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"net/http/httputil\"\n    \"net/url\"\n)\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    fmt.Fprint(w, \"&lt;html&gt;&lt;body&gt;&lt;iframe src=\\\"/\\\" width=\\\"100%\\\" height=\\\"100%\\\"/&gt;&lt;/body&gt;&lt;/html&gt;\")\n}\n\nfunc proxyHandle(r *http.Request) {\n    r.Host = \"google.com\"\n    r.URL.Host = r.Host\n    r.URL.Scheme = \"http\"\n}\n\nfunc main() {\n    proxy := httputil.NewSingleHostReverseProxy(&amp;url.URL{\n        Scheme: \"http\",\n        Host:   \"google.com\",\n    })\n    proxy.Director = proxyHandle\n\n    http.Handle(\"/\", proxy)\n    http.HandleFunc(\"/index\", handler)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>I still get the SOP error message. I basically have now two questions:</p>\n\n<ul>\n<li>Is this the right way to go? Or is there a better way to do this?</li>\n<li>I do not understand what is happening here. In my opinion, the request will be send to my application and then the HTML will be in the response. The browser notices the iframe and requests for \"/\". This GET-Request arrives at my application and then should be forwarded to google.com. The response should go back to my application and from my application then back to the client. Is this correct?</li>\n</ul>\n"}, {"tags": ["go", "struct", "slice", "side-effects"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468061001, "post_id": 38280715, "comment_id": 63980450, "body": "The remove logic is correct (your output confirms this too). The problem might be the lack of or improper synchronization between multiple goroutines (your question says nothing about this), or there might be other issues in other parts of your code which you haven&#39;t posted."}, {"owner": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1468064271, "post_id": 38280715, "comment_id": 63981387, "body": "It is true that there is not effort made to make sure this works with multiple goroutines but i thought, let&#39;s make sure it work with a single one and add concurrency check later when it works for one thread (maybe this is a bad mindset). I have all the code in a <a href=\"https://gist.github.com/Oliv95/f79c97cc7d0cba8a1fa3536a5e3caa7a\" rel=\"nofollow noreferrer\">gist</a> if you have the time to look"}], "answers": [{"comments": [{"owner": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "edited": false, "score": 0, "creation_date": 1468063834, "post_id": 38281038, "comment_id": 63981243, "body": "The problem still persists even after the suggested change. I made a gist of all  code, maybe the source of the bug is somewhere else.  <a href=\"https://gist.github.com/Oliv95/f79c97cc7d0cba8a1fa3536a5e3caa7a\" rel=\"nofollow noreferrer\">gist.github.com/Oliv95/f79c97cc7d0cba8a1fa3536a5e3caa7a</a>"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "edited": false, "score": 0, "creation_date": 1468067064, "post_id": 38281038, "comment_id": 63982197, "body": "Do the <code>Before remove</code>, <code>After remove</code> messages get printed?"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": false, "score": 0, "last_activity_date": 1468061504, "last_edit_date": 1495540465, "creation_date": 1468061504, "answer_id": 38281038, "question_id": 38280715, "link": "https://stackoverflow.com/questions/38280715/go-how-do-i-remove-an-element-from-a-slice-and-modify-it-in-memory/38281038#38281038", "title": "Go: How do I remove an element from a slice and modify it in memory", "body": "<p>You are using a pointer to an interface (<code>Visitors []*net.Conn</code>) in your <code>Room</code> type. You should never need a pointer to an interface value. An interface is value is like a generic content holder and its in memory representation is different than a struct that implements that interface.</p>\n\n<p>You should simply use declare the <code>Visitors</code> type to be an interface:</p>\n\n<pre><code>type Room struct {\n    Name     string\n    Visitors []net.Conn // should not be a pointer to interface value\n} \n\n\nfunc (r *Room) Leave(pc net.Conn) { // same thing as above\n    for i, pv := range r.Visitors {\n        // found the connection we want to remove\n        // in the comparison below actual concrete types are being compared.\n        // both these concrete types must be comparable (they can't be slices for example\n        if pc == pv {\n            r.Visitors = append(r.Visitors[:i], r.Visitors[i+1:]...)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Note that the comparision above (<code>pc == pv</code>) is not so trivial. Read about it here: <a href=\"https://golang.org/ref/spec#Comparison_operators\" rel=\"nofollow noreferrer\">https://golang.org/ref/spec#Comparison_operators</a> </p>\n\n<p>Also, refer to this question: <a href=\"https://stackoverflow.com/questions/13511203/why-cant-i-assign-a-struct-to-an-interface\">Why can&#39;t I assign a *Struct to an *Interface?</a></p>\n"}, {"comments": [{"owner": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "edited": false, "score": 0, "creation_date": 1468083428, "post_id": 38281809, "comment_id": 63986850, "body": "I added the mutex lock for the leave function and I&#39;m assigning nil to the element before i remove it (i think this is what you mead by zeroing the element that is freed) but the problem is still there in a sense, i now just end up with a bunch of nil elements in my slice. <a href=\"http://imgur.com/a/X98oo\" rel=\"nofollow noreferrer\">example</a>          r.Visiting[i]=nil         r.Visiting = append(r.Visiting[:i],r.Visiting([i+1:]...)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "edited": false, "score": 0, "creation_date": 1468087092, "post_id": 38281809, "comment_id": 63987999, "body": "@AxelOlivecrona No. The free space after removing an element will be the last element (before removing). So to zero it, save the slice value (the header), remove the element, and zero the last value in the saved slice (assign <code>nil</code> in case of interfaces). You are not zeroing the last element, only the one being removed (and soon to be overwritten), so it has no real effect (unless the removable is the last element)."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "edited": false, "score": 0, "creation_date": 1468087139, "post_id": 38281809, "comment_id": 63988016, "body": "@AxelOlivecrona Please make sure you synchronize all other shared variable access, not just <code>Room.Visitors</code>, that was just an example."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 2, "last_activity_date": 1580126856, "last_edit_date": 1580126856, "creation_date": 1468067391, "answer_id": 38281809, "question_id": 38280715, "link": "https://stackoverflow.com/questions/38280715/go-how-do-i-remove-an-element-from-a-slice-and-modify-it-in-memory/38281809#38281809", "title": "Go: How do I remove an element from a slice and modify it in memory", "body": "<p>The remove logic is correct (your output confirms this too). The problem is the lack of synchronization between multiple goroutines (your question says nothing about this).</p>\n\n<p>You said (in your comment) that you wanted this to get working with 1 goroutine first, and deal with synchronization later. But your code already uses multiple goroutines, so you can't have that luxury:</p>\n\n<pre><code>//Let a goroutine Handle the connection\ngo handleConnection(conn)\n</code></pre>\n\n<p>Multiple goroutines are reading and writing the <code>Room.Visitors</code> slice, so you have no choice but to synchronize access to it.</p>\n\n<p>An example would be to use <a href=\"https://golang.org/pkg/sync/#RWMutex\" rel=\"nofollow noreferrer\"><code>sync.RWLock</code></a>:</p>\n\n<p><code>utils.go</code>:</p>\n\n<pre><code>type Room struct {\n    mu       sync.RWLock\n    Name     string\n    Visitors []net.Conn\n}\n\n\nfunc (r *Room) Leave(c net.Conn) {\n    r.mu.Lock()\n    defer r.mu.Unlock()\n    for i, v := range r.Visitors {\n        //found the connection we want to remove\n        if c == v {\n            fmt.Printf(\"Before remove %v\\n\", r.Visitors)\n            r.Visitors = append(r.Visitors[:i], r.Visitors[i+1:]...)\n            fmt.Printf(\"After remove %v\\n\", r.Visitors)\n            return\n        }\n    }\n}\n</code></pre>\n\n<p>Also whenever any other code touches <code>Room.Visitors</code>, also lock the code (you may use <a href=\"https://golang.org/pkg/sync/#RWMutex.RLock\" rel=\"nofollow noreferrer\"><code>RWMutex.RLock()</code></a> if you're just reading it).</p>\n\n<p>Similarly you need to synchronize access to all variables that are read/changed by multiple goroutines.</p>\n\n<p>Also consider zeroing the element that is freed after the removal, else the underlying array will still hold that value, preventing the garbage collector to properly free memory used by it. For more information about this, see <a href=\"https://stackoverflow.com/questions/28432658/does-go-garbage-collect-parts-of-slices\">Does go garbage collect parts of slices?</a></p>\n"}], "owner": {"reputation": 113, "user_id": 6568289, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/k9V9f.jpg?s=128&g=1", "display_name": "Axel Olivecrona", "link": "https://stackoverflow.com/users/6568289/axel-olivecrona"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 817, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1580126856, "creation_date": 1468059164, "last_edit_date": 1468061218, "question_id": 38280715, "link": "https://stackoverflow.com/questions/38280715/go-how-do-i-remove-an-element-from-a-slice-and-modify-it-in-memory", "title": "Go: How do I remove an element from a slice and modify it in memory", "body": "<p>I'm trying to write a simple server/client chat program for learning purposes but I'm stuck. I want to have the <code>Leave</code> function remove the pointer it gets passed and update the slice in the struct so that the pointer is no longer there. But it's not working.</p>\n\n<p>Example: <a href=\"http://i.stack.imgur.com/UJNU9.png\" rel=\"nofollow\">Input</a>,<a href=\"http://i.stack.imgur.com/Ddn0y.png\" rel=\"nofollow\">Output</a></p>\n\n<pre><code>type Room struct {\n    Name     string\n    Visitors []*net.Conn\n} \n\n\nfunc (r *Room) Leave(pc *net.Conn) {\n    for i, pv := range r.Visitors {\n        //found the connection we want to remove\n        if pc == pv {\n            fmt.Printf(\"Before %v\\n\",r.Visitors)\n            r.Visitors = append(r.Visitors[:i], r.Visitors[i+1:]...)\n            fmt.Printf(\"Before %v\\n\",r.Visitors)                \n            return\n        }\n    }\n}\n</code></pre>\n"}, {"tags": ["for-loop", "go", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 157, "user_id": 3771392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38bcc632a7a944f2fce2b9064894aa96?s=128&d=identicon&r=PG&f=1", "display_name": "Ghost Bunnies", "link": "https://stackoverflow.com/users/3771392/ghost-bunnies"}, "edited": false, "score": 0, "creation_date": 1468058726, "post_id": 38280479, "comment_id": 63979788, "body": "Thank you very much, this seems to solve my issue indeed! Could you please explain me why we needed the first goroutine wrapping the <code>for</code> loop as well? If I remove it, there is a <code>fatal error: all goroutines are asleep - deadlock!</code> but I don&#39;t see the reason. Thanks again!"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 157, "user_id": 3771392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38bcc632a7a944f2fce2b9064894aa96?s=128&d=identicon&r=PG&f=1", "display_name": "Ghost Bunnies", "link": "https://stackoverflow.com/users/3771392/ghost-bunnies"}, "edited": false, "score": 0, "creation_date": 1468059810, "post_id": 38280479, "comment_id": 63980061, "body": "Not sure how you modified the code, but I quess that it deadlocks at the wg.Wait - the consumer loop won&#39;t be reached then as the code would be stuck there. I used the WaitGroup so that the channel can be closed when all <code>Frequency</code> calls return. Thats the usual pattern when you return channel."}, {"owner": {"reputation": 157, "user_id": 3771392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38bcc632a7a944f2fce2b9064894aa96?s=128&d=identicon&r=PG&f=1", "display_name": "Ghost Bunnies", "link": "https://stackoverflow.com/users/3771392/ghost-bunnies"}, "edited": false, "score": 0, "creation_date": 1468061285, "post_id": 38280479, "comment_id": 63980542, "body": "So if there is not a first-level goroutine closure, <code>wg.Wait()</code> timeouts the rest? My undestanding is that <code>wg.Done()</code> decrements the WaitGroup counter as soon as the goroutine closure in the<code>for</code>loop returns; then why is there a deadlock when <code>wg.Wait()</code> is placed in the <code>ConcurrentFrequency()</code> level and not in a nested goroutine? Sorry to bother you once again, just trying to understand the most of it and your feedback is much appreciated!"}, {"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "reply_to_user": {"reputation": 157, "user_id": 3771392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38bcc632a7a944f2fce2b9064894aa96?s=128&d=identicon&r=PG&f=1", "display_name": "Ghost Bunnies", "link": "https://stackoverflow.com/users/3771392/ghost-bunnies"}, "edited": false, "score": 0, "creation_date": 1468063215, "post_id": 38280479, "comment_id": 63981056, "body": "Added explanation in the end of answer as it was too long for a comment."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": true, "score": 9, "last_activity_date": 1468066919, "last_edit_date": 1468066919, "creation_date": 1468057567, "answer_id": 38280479, "question_id": 38279990, "link": "https://stackoverflow.com/questions/38279990/trouble-with-goroutines-in-a-for-loop/38280479#38280479", "title": "Trouble with goroutines in a for loop", "body": "<p>Your code seems to make only one iteration because <code>ConcurrentFrequency</code> returns the first value from the channel and thats it. I quess you want something like this:</p>\n\n<pre><code>func ConcurrentFrequency(l []string) chan FreqMap {\n    c := make(chan FreqMap)\n    go func() {\n        var wg sync.WaitGroup\n        wg.Add(len(l))\n        for _, s := range l {\n            go func(s string) {\n                defer wg.Done()\n                c &lt;- Frequency(s)\n            }(s)\n        }\n        wg.Wait()\n        close(c)\n    }()\n    return c\n}\n</code></pre>\n\n<p>Now it returns the channel of maps, these you probaly want to combine into sigle map:</p>\n\n<pre><code>func main() {\n    m := make(FreqMap)\n    for v := range ConcurrentFrequency([]string{\"foo\", \"bar\",\"zoo\"}) {\n        for k, v := range v {\n            m[k] += v\n        }\n    }\n    fmt.Println(m)\n}\n</code></pre>\n\n<hr>\n\n<p><strong>Longer explanation that doesn't fit into comment:</strong></p>\n\n<p>In the <code>for _, s := range l</code> loop all goroutines write into the same channel, but as that channel is not buffered, as soon as the first value is written into it, it is \"full\", meaning that no other values can be written into it. So only one goroutine in the loop can complete, and <code>wg.Done</code> is called only once. Thus if the source array has more than one string, the rest of the gorutines can't complete until something starts to consume values from the channel. But in your version it would be stuck in <code>wg.Wait</code> as not all goroutines are done and thus the <code>ConcurrentFrequency</code> can't return the channel to the consumer. \nIn the way I wrote the <code>ConcurrentFrequency</code>, the cannel can be returned to the consumer and this (reading from the channel) enables the other <code>Frequency(s)</code> calls to write into channel.</p>\n"}], "owner": {"reputation": 157, "user_id": 3771392, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/38bcc632a7a944f2fce2b9064894aa96?s=128&d=identicon&r=PG&f=1", "display_name": "Ghost Bunnies", "link": "https://stackoverflow.com/users/3771392/ghost-bunnies"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7426, "favorite_count": 1, "accepted_answer_id": 38280479, "answer_count": 1, "score": 9, "last_activity_date": 1468066919, "creation_date": 1468053625, "last_edit_date": 1468066132, "question_id": 38279990, "link": "https://stackoverflow.com/questions/38279990/trouble-with-goroutines-in-a-for-loop", "title": "Trouble with goroutines in a for loop", "body": "<p>I am trying to solve this problem on <a href=\"http://exercism.io/exercises/go/parallel-letter-frequency/readme\" rel=\"noreferrer\">Exercism</a>:</p>\n\n<blockquote>\n  <p>Write a program that counts the frequency of letters in texts using parallel computation.</p>\n</blockquote>\n\n<p>Basically, I have a <code>FreqMap</code> type:</p>\n\n<pre><code>type FreqMap map[rune]int\n</code></pre>\n\n<p>And a <code>Frequency</code> function:</p>\n\n<pre><code>func Frequency(s string) FreqMap {\n    m := make(FreqMap)\n    for _, v := range s {\n        m[v]++\n    }\n    return m\n}\n</code></pre>\n\n<p>Exercism provides an example implementing a concurrent version using recursion, but I would like to implement my own version using a <code>for</code>  loop. I came up with the following solution, which does not work:</p>\n\n<pre><code>func ConcurrentFrequency(l []string) FreqMap {\n    c := make(chan FreqMap)\n    for i := 0; i &lt; len(l); i++ {\n        go func(i int) {\n            c &lt;- Frequency(l[i])\n        }(i)\n    }\n    return &lt;- c\n}\n</code></pre>\n\n<p>This seems to return after only 1 iteration, <code>c</code> seems to contain the result of only 1 goroutine; I get the same result if I add a <code>sync.WaitGroup</code>.</p>\n\n<p>Could you please explain what I am missing here?</p>\n\n<p>Thank you in advance for your help!</p>\n"}, {"tags": ["json", "rest", "go"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 6567562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SC06d9IeoqY/AAAAAAAAAAI/AAAAAAAAUhg/ttvwzqZMdKc/photo.jpg?sz=128", "display_name": "Tom Tunguz", "link": "https://stackoverflow.com/users/6567562/tom-tunguz"}, "edited": false, "score": 0, "creation_date": 1468034452, "post_id": 38277771, "comment_id": 63974902, "body": "Thanks. Super helpful. Quick follow up question: why can&#39;t I print out the contents of the response body and see it in the command line? Is it encoded?"}], "tags": [], "owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "is_accepted": false, "score": 3, "last_activity_date": 1468037062, "last_edit_date": 1468037062, "creation_date": 1468032326, "answer_id": 38277771, "question_id": 38277710, "link": "https://stackoverflow.com/questions/38277710/golang-api-issues-with-encoding/38277771#38277771", "title": "Golang API Issues with Encoding", "body": "<p>You have error in unmarshal: <code>cannot unmarshal number into Go value of type string</code> if you print error. UserId and Id should be int. </p>\n\n<p>Please don't ignore error! </p>\n\n<p>try this code: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype Post struct {\n    UserID int\n    ID     int\n    Title  string\n    Body   string\n}\n\nfunc getJson(url string, target interface{}) error {\n    r, err := http.Get(url)\n    if err != nil {\n        return err\n    }\n    defer r.Body.Close()\n    fmt.Println(r)\n    return json.NewDecoder(r.Body).Decode(target)\n}\n\nfunc main() {\n    post := new(Post) // or &amp;Foo{}\n    err := getJson(\"http://jsonplaceholder.typicode.com/posts/1\", &amp;post)\n    if err != nil {\n        panic(err)\n    }\n\n    println(post.Body)\n    fmt.Printf(\"Post: %+v\\n\", post)\n}\n</code></pre>\n\n<p>Edited:\nWhy can't I print out the contents of the response body and see it in the command line? Is it encoded?\nAns: HTTP request or response used to be in a format or encoded defined by the response-header fields.</p>\n\n<p>The response-body is obtained from the message-body by decoding any Transfer-Encoding that might have been applied to ensure safe and proper transfer of the message.</p>\n\n<p>If you print: <code>fmt.Println(\"Header: %#v\\n\", r.Header)</code><br>\nYou will see, <code>Content-Type:[application/json; charset=utf-8]</code> That's why you are decoding with Json. It also could be xml. </p>\n"}, {"comments": [{"owner": {"reputation": 113073, "user_id": 141555, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/oOW8R.jpg?s=128&g=1", "display_name": "sberry", "link": "https://stackoverflow.com/users/141555/sberry"}, "edited": false, "score": 0, "creation_date": 1468048222, "post_id": 38278522, "comment_id": 63977284, "body": "I actually thought this was a joke making fun of ignoring errors :)"}], "tags": [], "owner": {"reputation": 1, "user_id": 4800397, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e5ffaca0d89d7e553babde58f209d592?s=128&d=identicon&r=PG&f=1", "display_name": "wyiwt", "link": "https://stackoverflow.com/users/4800397/wyiwt"}, "is_accepted": false, "score": 0, "last_activity_date": 1468040388, "creation_date": 1468040388, "answer_id": 38278522, "question_id": 38277710, "link": "https://stackoverflow.com/questions/38277710/golang-api-issues-with-encoding/38278522#38278522", "title": "Golang API Issues with Encoding", "body": "<p>maybe you should try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"net/http\"\n)   \n\ntype Result struct {\n    UserID int    `json:\"userId\"`\n    ID     int    `json:\"id\"`\n    Title  string `json:\"title\"`\n    Body   string `json:\"body\"`\n}   \n\nfunc main() {\n\n    url := \"http://jsonplaceholder.typicode.com/posts/1\"\n\n    req, _ := http.NewRequest(\"GET\", url, nil)\n\n    res, _ := http.DefaultClient.Do(req)\n\n    defer res.Body.Close()\n    body, _ := ioutil.ReadAll(res.Body)\n\n    var result Result\n    err := json.Unmarshal(body, &amp;result)\n    if err != nil {\n        fmt.Println(err)\n    }   \n\n    fmt.Println(res)\n    fmt.Println(string(body))\n\n    fmt.Println(result)\n    //fmt.Println(result.Title)\n    //fmt.Println(result.Body)\n}\n</code></pre>\n\n<p>You will get a Result struct</p>\n"}], "owner": {"reputation": 31, "user_id": 6567562, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-SC06d9IeoqY/AAAAAAAAAAI/AAAAAAAAUhg/ttvwzqZMdKc/photo.jpg?sz=128", "display_name": "Tom Tunguz", "link": "https://stackoverflow.com/users/6567562/tom-tunguz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 718, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1468040388, "creation_date": 1468031452, "last_edit_date": 1495535331, "question_id": 38277710, "link": "https://stackoverflow.com/questions/38277710/golang-api-issues-with-encoding", "title": "Golang API Issues with Encoding", "body": "<p>I'm trying to consume JSON apis through golang, but having a terrible time getting the response back. I'm using a sample JSON endpoint <a href=\"http://jsonplaceholder.typicode.com/posts/1\" rel=\"nofollow noreferrer\">http://jsonplaceholder.typicode.com/posts/1</a> that returns </p>\n\n<pre><code>{\n  \"userId\": 1,\n  \"id\": 1,\n  \"title\": \"sunt aut facere repellat provident occaecati excepturi optio reprehenderit\",\n  \"body\": \"quia et suscipit\\nsuscipit recusandae consequuntur expedita et cum\\nreprehenderit molestiae ut ut quas totam\\nnostrum rerum est autem sunt rem eveniet architecto\"\n}\n</code></pre>\n\n<p>This is my code which comes from <a href=\"https://stackoverflow.com/questions/17156371/how-to-get-json-response-in-golang\">this Stack Overflow Answer</a>: </p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"fmt\"\n)\n\ntype Post struct {\n    UserID string\n    ID string\n    Title string\n    Body string\n}\n\nfunc getJson(url string, target interface{}) error {\n    r, err := http.Get(url)\n    if err != nil {\n        return err\n    }\n    defer r.Body.Close()\n    fmt.Println(r)\n    return json.NewDecoder(r.Body).Decode(target)\n}\n\nfunc main() {\n    post := new(Post) // or &amp;Foo{}\n    getJson(\"http://jsonplaceholder.typicode.com/posts/1\", &amp;post)\n    println(post.Body)\n\n}\n</code></pre>\n\n<p>And this is the output: </p>\n\n<pre><code>go run main.go \n&amp;{200 OK 200 HTTP/1.1 1 1 map[Cf-Cache-Status:[HIT] Cf-Ray:[2bf857d2e55e0d91-SJC] Access-Control-Allow-Credentials:[true] Cache-Control:[public, max-age=14400] Expires:[Sat, 09 Jul 2016 06:28:31 GMT] X-Content-Type-Options:[nosniff] Server:[cloudflare-nginx] Date:[Sat, 09 Jul 2016 02:28:31 GMT] Connection:[keep-alive] X-Powered-By:[Express] Etag:[W/\"124-yv65LoT2uMHrpn06wNpAcQ\"] Content-Type:[application/json; charset=utf-8] Set-Cookie:[__cfduid=d0c4aacaa5db8dc73c59a530f3d7532af1468031311; expires=Sun, 09-Jul-17 02:28:31 GMT; path=/; domain=.typicode.com; HttpOnly] Pragma:[no-cache] Via:[1.1 vegur] Vary:[Accept-Encoding]] 0xc8200ee100 -1 [chunked] false map[] 0xc8200da000 &lt;nil&gt;}\n</code></pre>\n\n<p>I know the endpoint works. Is this an encoding issue or something else? I'm on Mac OSX 10.11.15. </p>\n\n<p>Thanks</p>\n"}, {"tags": ["javascript", "templates", "go", "reactive-programming", "go-templates"], "comments": [{"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1468050728, "post_id": 38277700, "comment_id": 63977892, "body": "As I know meteor is not one app, it contains of different components. The server side engine is node and the reactive part is vue.js. You can not compare Go and meteor.js, because you also can not compare meteor and node.js, because node.js is just one part of meteor. To achieve a reactive template in Go like meteor you could use vue.js with gorilla/websocket and mongoDB. If you search you will easyly find some boilerplates for different architectures."}], "answers": [{"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 0, "last_activity_date": 1468099341, "creation_date": 1468099341, "answer_id": 38286475, "question_id": 38277700, "link": "https://stackoverflow.com/questions/38277700/implementing-reactive-templates-in-golang/38286475#38286475", "title": "Implementing reactive templates in golang", "body": "<p>No, don't confuse rendering templates on server side with running code in the browser and modifying the DOM. The only way to update the rendered template is to refresh whole page, unless you inject some JS code there.</p>\n"}, {"tags": [], "owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "is_accepted": false, "score": 0, "last_activity_date": 1470648333, "creation_date": 1470648333, "answer_id": 38825540, "question_id": 38277700, "link": "https://stackoverflow.com/questions/38277700/implementing-reactive-templates-in-golang/38825540#38825540", "title": "Implementing reactive templates in golang", "body": "<p>Worth taking a look at <a href=\"http://gohugo.io/\" rel=\"nofollow\">Hugo</a>.</p>\n\n<p>It's a static site generator written in go which which supports <a href=\"https://gohugo.io/extras/livereload/\" rel=\"nofollow\">LiveReload</a>, as you've described. It's lightening fast.</p>\n"}], "owner": {"reputation": 53, "user_id": 2247431, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/08029b24a5dd932228462b4bc74bdd6f?s=128&d=identicon&r=PG", "display_name": "rohan", "link": "https://stackoverflow.com/users/2247431/rohan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 517, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1470648333, "creation_date": 1468031369, "question_id": 38277700, "link": "https://stackoverflow.com/questions/38277700/implementing-reactive-templates-in-golang", "title": "Implementing reactive templates in golang", "body": "<p>I'm coming to Go from Meteor.js, which, while full of awesome features, is a little too black-box-y for my taste. One of the awesome things about Meteor was blaze, which made their templating engine reactive; database changes were propagated to the UI immediately.</p>\n\n<p>In Go, though, no such solution seems to exist, aside from maybe trying to integrate React. Is there a good way of making Go's templates (things like {{range}} and stuff) reactive, so that they respond to database changes instantly?</p>\n\n<p>What we have right now, for context, is something like this (in JS):</p>\n\n<pre><code>$(\".delete-button\").click(function (e) {\n    obj = $(this).closest(\".object\");\n    id = $(obj).data(\"id\");\n    $(\"[data-id=\" + id + \"]\").hide();\n\n    // try to delete the element from the table\n    database.delete(id, function (err) {\n        if (err) {\n            $(\"[data-id=\" + id + \"]\").show();\n            log(err);\n            return;\n        }\n    });\n});\n</code></pre>\n\n<p>This is fine, but it's kind of frustrating for more nuanced things, like editing. Any ideas or help would be really appreciated.</p>\n"}, {"tags": ["c#", "networking", "go", "configuration"], "comments": [{"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 1, "creation_date": 1468097302, "post_id": 38276221, "comment_id": 63990847, "body": "<a href=\"https://github.com/coreos/etcd/blob/master/Documentation/docs.md\" rel=\"nofollow noreferrer\">etcd</a> may be helpful but is more likely overkill"}, {"owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1468257884, "post_id": 38276221, "comment_id": 64042007, "body": "Yeah etcd is awesome but would be an overkill imho. Another idea: I&#39;m exposing an API endpoint and I could then post the configuration to it."}], "owner": {"reputation": 1373, "user_id": 4165479, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/ed71eed5c9cf3f219c4e303d76dd79ff?s=128&d=identicon&r=PG&f=1", "display_name": "LuMa", "link": "https://stackoverflow.com/users/4165479/luma"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 45, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1468016843, "creation_date": 1468016843, "question_id": 38276221, "link": "https://stackoverflow.com/questions/38276221/configuration-of-multiple-iot-devices-in-a-local-network", "title": "Configuration of multiple IoT devices in a local network", "body": "<p>Imagine a room with 10+ Raspberry Pi's. All of them get conencted to the local network by ethernet and are then powered on. They are running an application which needs to be configured properly. Since the users are not technically gifted the configuration file is created by a user friendly program running on a Windows PC in the same network.</p>\n\n<p>The application on the Pi is written in Go, the Windows program in C#.</p>\n\n<p>What would be a good approach to retrieve the configuration from the windows machine? Since the devices don't know about other, I need to implement some kind of <strong>device discovery</strong> first.</p>\n\n<p>Another approach I have seen was just blindly broadcasting the configuration via UDP but that really seems inappropriate.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 3, "creation_date": 1468012283, "post_id": 38275403, "comment_id": 63970217, "body": "Does adding and removing code sound like the function of a <i>formatting</i> command?"}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "reply_to_user": {"reputation": 185743, "user_id": 152948, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/194ef8f807c34a9d7aab0e11a8674768?s=128&d=identicon&r=PG", "display_name": "hobbs", "link": "https://stackoverflow.com/users/152948/hobbs"}, "edited": false, "score": 0, "creation_date": 1468018189, "post_id": 38275403, "comment_id": 63972094, "body": "@hobbs well the tool does remove whitespace and semicolons, its a good question imo"}, {"owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "reply_to_user": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1468020431, "post_id": 38275403, "comment_id": 63972671, "body": "That would have been my response @Plato, I wanted to establish whether these Blocks constituted code at all."}], "answers": [{"tags": [], "owner": {"reputation": 3196, "user_id": 4245174, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/Qhbam.jpg?s=128&g=1", "display_name": "ifma", "link": "https://stackoverflow.com/users/4245174/ifma"}, "is_accepted": false, "score": 2, "last_activity_date": 1468019757, "last_edit_date": 1468019757, "creation_date": 1468012181, "answer_id": 38275436, "question_id": 38275403, "link": "https://stackoverflow.com/questions/38275403/why-does-go-fmt-allow-empty-brackets/38275436#38275436", "title": "Why does go fmt allow empty brackets?", "body": "<p>They basically function like an internal namespace, so any definition(s) you put in between an encapsulating brace will not be visible outside of it.</p>\n\n<pre><code>// ... other code above ...\n\n{\n  a := 5 // declare a\n}\n\na = 5 // compiler error, a is undeclared\n</code></pre>\n\n<p>And plus formatting tools such as <code>gofmt</code> or <code>autopep8</code> (for python) do not modify a given file beyond adding/removing whitespace or newline characters to already existing code. </p>\n"}, {"comments": [{"owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "edited": false, "score": 0, "creation_date": 1468014265, "post_id": 38275449, "comment_id": 63970896, "body": "Thanks Jim, I&#39;m going to read all of that spec before I pose anymore go questions. Thanks for your help."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1468241672, "post_id": 38275449, "comment_id": 64031458, "body": "Imagine you wrote a layout template of code. Something like: <code>if a == b { } else { }</code>  You would be pissed of if editor removes the <code>{}</code> when you hit Ctrl+S (some have auto-formatting enabled)"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1468012249, "creation_date": 1468012249, "answer_id": 38275449, "question_id": 38275403, "link": "https://stackoverflow.com/questions/38275403/why-does-go-fmt-allow-empty-brackets/38275449#38275449", "title": "Why does go fmt allow empty brackets?", "body": "<p>Brackets on their own denote code <a href=\"https://golang.org/ref/spec#Blocks\" rel=\"nofollow\">Blocks</a>. From the spec:</p>\n\n<blockquote>\n  <p>A block is a possibly empty sequence of declarations and statements within matching brace brackets.</p>\n</blockquote>\n\n<p>These are part of the Go syntax, and <code>go fmt</code> formats them according the its formatting rules. </p>\n"}], "owner": {"reputation": 3621, "user_id": 999248, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/G9pId.jpg?s=128&g=1", "display_name": "robstarbuck", "link": "https://stackoverflow.com/users/999248/robstarbuck"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 0, "accepted_answer_id": 38275449, "answer_count": 2, "score": 0, "last_activity_date": 1468019757, "creation_date": 1468012033, "question_id": 38275403, "link": "https://stackoverflow.com/questions/38275403/why-does-go-fmt-allow-empty-brackets", "title": "Why does go fmt allow empty brackets?", "body": "<p>I was just wondering why these brackets haven't been removed after running <strong>go fmt</strong>, does their use have a function?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n\n    fmt.Println(\"Hello, \u4e16\u754c\")\n\n    {\n        {\n            {\n\n            }\n\n        }\n    }\n}\n</code></pre>\n\n<p>Example <a href=\"https://play.golang.org/p/o6urIHGe17\" rel=\"nofollow\">here</a>, thanks.</p>\n"}, {"tags": ["go", "tcp", "rpc", "json-rpc"], "answers": [{"comments": [{"owner": {"reputation": 52, "user_id": 1852369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6d3adf932d0713c3321ab26912ab396?s=128&d=identicon&r=PG&f=1", "display_name": "Wolf", "link": "https://stackoverflow.com/users/1852369/wolf"}, "edited": false, "score": 0, "creation_date": 1468014308, "post_id": 38274050, "comment_id": 63970904, "body": "Ah I see! That solved that. Also many thanks for the extra feedback, I never knew I could check for race conditions!"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1468006461, "last_edit_date": 1468006461, "creation_date": 1468006011, "answer_id": 38274050, "question_id": 38272431, "link": "https://stackoverflow.com/questions/38272431/rpc-servercodec-still-serving/38274050#38274050", "title": "rpc.ServerCodec Still Serving?", "body": "<p>While not the source of your problems, your test configuration has a few race conditions which you should take care of before they cause problems. Always check for issues with the <code>-race</code> option. You should also let the OS allocate the port so you don't run into conflicts. See for example how <a href=\"https://golang.org/pkg/net/http/httptest/#Server\" rel=\"nofollow\"><code>httptest.Server</code></a> works.</p>\n\n<p>Your failure here is that you're not creating a new <code>rpc.Server</code> for each test, you're reusing the <code>rpc.DefaultServer</code>. The first call to <code>CreateRPCServer</code> registers a <code>TestAPI</code> under the name <code>TestMaster</code>. Each subsequent call uses the already registered instance. </p>\n\n<p>If you create a new <code>rpc.Server</code> each time you setup the test and register a new TestAPI, the final test will pass. </p>\n\n<pre><code>srv := rpc.NewServer()\nsrv.RegisterName(\"TestMaster\", testAPI)\n\n...\n// and then use srv to handle the new connection\nsrv.ServeCodec(RpcCodecServer(conn))\n</code></pre>\n"}], "owner": {"reputation": 52, "user_id": 1852369, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6d3adf932d0713c3321ab26912ab396?s=128&d=identicon&r=PG&f=1", "display_name": "Wolf", "link": "https://stackoverflow.com/users/1852369/wolf"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 388, "favorite_count": 0, "accepted_answer_id": 38274050, "answer_count": 1, "score": 0, "last_activity_date": 1468006461, "creation_date": 1467999151, "question_id": 38272431, "link": "https://stackoverflow.com/questions/38272431/rpc-servercodec-still-serving", "title": "rpc.ServerCodec Still Serving?", "body": "<p>I was performing some RPC tests, and stumbled across a problem I can't seem to solve. In my testing I create three separate RPC servers, all of which I try to close and shutdown. However upon performing my last test (TestRpcCodecServerClientComm), it seems my client connection is connecting to the first RPC server I started (I know this because I at some point attached IDs to the RPCHandlers), even though I attempted everything I could to make sure it was shutdown. Though the code is not there I have attempted to inspect every single error I could, but that did not bring about anything.</p>\n\n<h3>rpc.go</h3>\n\n<pre><code>package rbot\n\nimport (\n    \"io\"\n    \"net\"\n    \"net/rpc\"\n    \"net/rpc/jsonrpc\"\n)\n\nfunc RpcCodecClientWithPort(port string) (rpc.ClientCodec, error) {\n    conn, err := net.Dial(\"tcp\", \"localhost:\"+port)\n    if err != nil {\n        return nil, err\n    }\n    return jsonrpc.NewClientCodec(conn), nil\n}\n\nfunc RpcCodecServer(conn io.ReadWriteCloser) rpc.ServerCodec {\n    return jsonrpc.NewServerCodec(conn)\n}\n</code></pre>\n\n<h3>rpc_test.go</h3>\n\n<pre><code>package rbot\n\nimport (\n    \"errors\"\n    \"fmt\"\n    \"net\"\n    \"net/rpc\"\n    \"testing\"\n)\n\ntype RPCHandler struct {\n    RPCServer net.Listener\n    conn      rpc.ServerCodec\n    done      chan bool\n    TestPort  string\n    stop      bool\n    GotRPC    bool\n}\n\nfunc (r *RPCHandler) SetupTest() {\n    r.stop = false\n    r.GotRPC = false\n    r.done = make(chan bool)\n    r.TestPort = \"5556\"\n}\n\n// TODO: Create separate function to handle erroring\nfunc (r *RPCHandler) CreateRPCServer() error {\n    rpc.RegisterName(\"TestMaster\", TestAPI{r})\n\n    var err error\n    r.RPCServer, err = net.Listen(\"tcp\", \":\"+r.TestPort)\n\n    if err != nil {\n        return err\n    }\n\n    go func() {\n        for {\n            conn, err := r.RPCServer.Accept()\n            if err != nil || r.stop {\n                r.done &lt;- true\n                return\n            }\n            r.conn = RpcCodecServer(conn)\n            rpc.ServeCodec(r.conn)\n        }\n    }()\n    return nil\n}\n\nfunc (r *RPCHandler) CloseRPCServer() error {\n    r.stop = true\n    if r.conn != nil {\n        err := r.conn.Close()\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n    err := r.RPCServer.Close()\n    &lt;-r.done\n    return err\n}\n\ntype TestAPI struct {\n    t *RPCHandler\n}\n\nfunc (tapi TestAPI) Send(msg string, result *string) error {\n    if msg == \"Got RPC?\" {\n        tapi.t.GotRPC = true\n        return nil\n    }\n    return errors.New(\"Didn't receive right message\")\n}\n\n// Check if we can create and close an RPC server successfully using the RPC server codec.\nfunc TestRpcCodecServer(t *testing.T) {\n    r := RPCHandler{}\n    r.SetupTest()\n\n    err := r.CreateRPCServer()\n    if err != nil {\n        t.Fatalf(\"Could not create rpc server! %s:\", err.Error())\n    }\n\n    err = r.CloseRPCServer()\n    if err != nil {\n        t.Fatalf(\"Could not close RPC server! %s:\", err.Error())\n    }\n}\n\n// Check if we can create a client without erroring.\nfunc TestRpcCodecClientWithPortt(t *testing.T) {\n    r := RPCHandler{}\n    r.SetupTest()\n    r.CreateRPCServer()\n    defer r.CloseRPCServer()\n\n    RPCClient, err := RpcCodecClientWithPort(r.TestPort)\n    defer RPCClient.Close()\n    if err != nil {\n        t.Fatalf(\"Could not create an RPC client! %s:\", err.Error())\n    }\n}\n\n// Let's double check and make sure our server and client can speak to each other\nfunc TestRpcCodecServerClientComm(t *testing.T) {\n    r := RPCHandler{}\n    r.SetupTest()\n    r.CreateRPCServer()\n    defer r.CloseRPCServer()\n\n    RPCCodec, _ := RpcCodecClientWithPort(r.TestPort)\n    RPCClient := rpc.NewClientWithCodec(RPCCodec)\n    defer RPCClient.Close()\n\n    var result string\n    err := RPCClient.Call(\"TestMaster.Send\", \"Got RPC?\", &amp;result)\n    if err != nil {\n        t.Fatalf(\"Error while trying to send RPC message: %s\", err.Error())\n    }\n\n    if !r.GotRPC {\n        t.Fatalf(\"Could not send correct message over RPC\")\n    }\n}\n</code></pre>\n\n<p>Not sure if I'm just mishandling the connection or something of the like, any help would be much appreciated.</p>\n\n<p><strong>For the Record</strong> The RPC api does receive the correct string message</p>\n"}, {"tags": ["go", "compilation"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 5, "creation_date": 1467996324, "post_id": 38271706, "comment_id": 63962740, "body": "This is what <code>go install</code> does."}, {"owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1470991583, "post_id": 38271706, "comment_id": 65184507, "body": "@JimB I have tried it but it didnt change anything"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1471014955, "post_id": 38271706, "comment_id": 65199358, "body": "Then you need to show exactly what you are doing. Is this during <code>go test</code>? Are you editing the package being built, or a dependency? What packages does <code>go install -v</code> show are being built?"}], "owner": {"reputation": 6600, "user_id": 2210667, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/65e361318ee533712efd7929d6e9977c?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/2210667/thomas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 144, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1467996048, "creation_date": 1467996048, "question_id": 38271706, "link": "https://stackoverflow.com/questions/38271706/how-to-not-recompile-all-files-when-building-go-package-and-changed-just-one-fil", "title": "How to not recompile all files when building Go package and changed just one file?", "body": "<p>In C for instance, files that were not modified since the last build are not rebuilt because their .o file is there already.</p>\n\n<p>Is there something similar in Go ? I waste a lot of time rebuilding everything when I just made modifications to one file.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": true, "score": 14, "last_activity_date": 1467992270, "last_edit_date": 1467992270, "creation_date": 1467991949, "answer_id": 38270460, "question_id": 38270424, "link": "https://stackoverflow.com/questions/38270424/unexpected-type-at-the-end-of-statement/38270460#38270460", "title": "Unexpected &lt;type&gt; at the end of statement", "body": "<p>Change line 9 to either of statements below:</p>\n\n<pre><code>v := math.Pow(x,n) // implicit type declaration and assignment\n</code></pre>\n\n<p>or</p>\n\n<pre><code>var v float64 = math.Pow(x,n) // explicit type declaration and assignment\n</code></pre>\n\n<p>See <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"noreferrer\">short variable declarations</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 21, "user_id": 6803129, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8f9304462aa9a6bdabe8f2a34b4a6d80?s=128&d=identicon&r=PG&f=1", "display_name": "AlexanderAdade", "link": "https://stackoverflow.com/users/6803129/alexanderadade"}, "is_accepted": false, "score": 2, "last_activity_date": 1593855838, "creation_date": 1593855838, "answer_id": 62727588, "question_id": 38270424, "link": "https://stackoverflow.com/questions/38270424/unexpected-type-at-the-end-of-statement/62727588#62727588", "title": "Unexpected &lt;type&gt; at the end of statement", "body": "<p>Variable declaration in Go</p>\n<p><strong>static</strong>\nvar var_name data_type = value</p>\n<p>or</p>\n<p><strong>dynamic:</strong>\nvar_name := value</p>\n<p>In your case at line 9 you have missed both standard</p>\n"}], "owner": {"reputation": 419, "user_id": 6563636, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QjT4I.jpg?s=128&g=1", "display_name": "spritecodej", "link": "https://stackoverflow.com/users/6563636/spritecodej"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 13776, "favorite_count": 2, "accepted_answer_id": 38270460, "answer_count": 2, "score": 11, "last_activity_date": 1593855838, "creation_date": 1467991813, "last_edit_date": 1467992141, "question_id": 38270424, "link": "https://stackoverflow.com/questions/38270424/unexpected-type-at-the-end-of-statement", "title": "Unexpected &lt;type&gt; at the end of statement", "body": "<p>The Go code is below. </p>\n\n<p>Error Message: syntax error: unexpected float64 at end of statement in line 9.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\nfunc pow(x, n, lim float64) float64 {\n    v float64 = math.Pow(x,n) // line 9\n    if v&lt;lim {\n        return v\n    } else {\n        fmt.Printf(\"%g &gt;= %g\\n\", v, lim)\n    }   \n    return lim \n}\n\nfunc main() {\n    fmt.Println(\n        pow(3, 2, 10),\n        pow(3, 2, 20),\n    )   \n}\n</code></pre>\n\n<p>I don't know what is wrong. Who know that?</p>\n"}, {"tags": ["go", "go-gorm"], "answers": [{"comments": [{"owner": {"reputation": 23964, "user_id": 736809, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/en4t4.jpg?s=128&g=1", "display_name": "Jimbo", "link": "https://stackoverflow.com/users/736809/jimbo"}, "edited": false, "score": 2, "creation_date": 1564056898, "post_id": 38275491, "comment_id": 100910987, "body": "So you have to interact with all current associations? Imagine if you&#39;re not working on a little project but one with 10k records..."}], "tags": [], "owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "is_accepted": true, "score": 1, "last_activity_date": 1468012511, "creation_date": 1468012511, "answer_id": 38275491, "question_id": 38270156, "link": "https://stackoverflow.com/questions/38270156/golang-gorm-is-it-possible-to-delete-a-record-via-a-many2many-relationship/38275491#38275491", "title": "Golang Gorm: Is it possible to delete a record via a many2many relationship?", "body": "<p>I found a solution to this question, but not sure it's the best way to do this. I store the current languages, clear all the associations, then add back the languages, then save.</p>\n\n<pre><code>languages := user.Languages \nDB.Model(&amp;user).Association(\"Languages\").Clear()\nuser.Languages = languages\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "edited": false, "score": 0, "creation_date": 1468329750, "post_id": 38320687, "comment_id": 64074751, "body": "Thanks Alex. I had seen this approach in the gorm unit tests. It didn&#39;t satisfy my requirements though. I need to post back the modified user containing the updated languages list from the front end. I don&#39;t know the specific language(s) that need to be removed."}, {"owner": {"reputation": 1630, "user_id": 283896, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/oUu1k.jpg?s=128&g=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/283896/alex"}, "reply_to_user": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "edited": false, "score": 1, "creation_date": 1468343280, "post_id": 38320687, "comment_id": 64084399, "body": "I use this c.DB.Model(&amp;user).Association(&quot;Roles&quot;).Delete(user.Roles) in which user.Roles is an array of roles and it removes all the associations between the role and the user"}], "tags": [], "owner": {"reputation": 1630, "user_id": 283896, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/oUu1k.jpg?s=128&g=1", "display_name": "Alex", "link": "https://stackoverflow.com/users/283896/alex"}, "is_accepted": false, "score": 10, "last_activity_date": 1473193887, "last_edit_date": 1473193887, "creation_date": 1468301397, "answer_id": 38320687, "question_id": 38270156, "link": "https://stackoverflow.com/questions/38270156/golang-gorm-is-it-possible-to-delete-a-record-via-a-many2many-relationship/38320687#38320687", "title": "Golang Gorm: Is it possible to delete a record via a many2many relationship?", "body": "<p>I was having the same problem, If you want to just remove one of the associations this worked for me</p>\n\n<pre><code>    c.DB.Model(&amp;user).Association(\"Roles\").Delete(&amp;role)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 431, "user_id": 3705929, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/625211e431f9a4821e99dd94a148c548?s=128&d=identicon&r=PG&f=1", "display_name": "user3389", "link": "https://stackoverflow.com/users/3705929/user3389"}, "is_accepted": false, "score": 3, "last_activity_date": 1505494145, "creation_date": 1505494145, "answer_id": 46244291, "question_id": 38270156, "link": "https://stackoverflow.com/questions/38270156/golang-gorm-is-it-possible-to-delete-a-record-via-a-many2many-relationship/46244291#46244291", "title": "Golang Gorm: Is it possible to delete a record via a many2many relationship?", "body": "<p>Also, you can do this by using \"replace\"</p>\n\n<pre><code>DB.Model(&amp;user).Association(\"Languages\").Replace(user.Languages)\n</code></pre>\n"}], "owner": {"reputation": 750, "user_id": 1748069, "user_type": "registered", "accept_rate": 43, "profile_image": "https://i.stack.imgur.com/QOMeY.jpg?s=128&g=1", "display_name": "Matthew S", "link": "https://stackoverflow.com/users/1748069/matthew-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7467, "favorite_count": 2, "accepted_answer_id": 38275491, "answer_count": 3, "score": 10, "last_activity_date": 1505494145, "creation_date": 1467991008, "last_edit_date": 1467999215, "question_id": 38270156, "link": "https://stackoverflow.com/questions/38270156/golang-gorm-is-it-possible-to-delete-a-record-via-a-many2many-relationship", "title": "Golang Gorm: Is it possible to delete a record via a many2many relationship?", "body": "<p>I have a many2many structure similar to GORM's example:</p>\n\n<pre><code>// User has and belongs to many languages, use `user_languages` as join table\ntype User struct {\n    gorm.Model\n    Languages         []Language `gorm:\"many2many:user_languages;\"`\n}\n\ntype Language struct {\n    gorm.Model\n    Name string\n}\n\ndb.Model(&amp;user).Related(&amp;languages)\n</code></pre>\n\n<p>Let's say I create a user and it has two associated languages. </p>\n\n<p>I fetch a user record from the database and remove one language from the user's Languages array. I then save the user with gorm:save_associations set to true.</p>\n\n<p>I would expect GORM to delete the record associating the user to this language (in the association table that GORM manages). However, it is not deleted. Is this expected?</p>\n\n<p>Is it possible to delete many2many association records by removing a language from the Languages list on the user record and then saving the user? If not, how should this be done in GORM? </p>\n\n<p><strong>Update</strong></p>\n\n<p>I found a solution to this question, but not sure it's the best way to do this. I store the current languages, clear all the associations, then add back the languages, then save.</p>\n\n<pre><code>languages := user.Languages\nDB.Model(&amp;user).Association(\"Languages\").Clear()\nuser.Languages = languages\n</code></pre>\n"}, {"tags": ["json", "go", "encoding", "marshalling"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1468003652, "post_id": 38268859, "comment_id": 63966266, "body": "Show the line of code that generates the error &quot;cannot use classx literal (type classx) as type []classx in field value&quot;.  The code in the question <a href=\"https://play.golang.org/p/JTz-lNheN9\" rel=\"nofollow noreferrer\">compiles with no error</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1468007480, "post_id": 38268859, "comment_id": 63968083, "body": "That&#39;s a compilation error. You have to show the code that you&#39;re using which generated the error (and the compiler will tell you exactly which line caused the error)"}], "answers": [{"tags": [], "owner": {"reputation": 1356, "user_id": 5688488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/14b0072c03a45630ffe30f8a9e1a3f00?s=128&d=identicon&r=PG&f=1", "display_name": "Benjamin Kadish", "link": "https://stackoverflow.com/users/5688488/benjamin-kadish"}, "is_accepted": true, "score": 2, "last_activity_date": 1468004533, "creation_date": 1468004533, "answer_id": 38273710, "question_id": 38268859, "link": "https://stackoverflow.com/questions/38268859/go-nested-json-marshall-or-encoding/38273710#38273710", "title": "Go Nested Json Marshall or Encoding", "body": "<p>The Class field is a slice. You have given it a struct</p>\n\n<p>Wrong:</p>\n\n<pre><code>Response{Id:[]idx{idx{Class:classx{}}}}\n</code></pre>\n\n<p>Correct:</p>\n\n<pre><code>Response{Id:[]idx{idx{Class:[]classx{}}}}\n</code></pre>\n"}], "owner": {"reputation": 33, "user_id": 6565674, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/034e394f4221e6b84d4f8b7bdd08fa35?s=128&d=identicon&r=PG&f=1", "display_name": "ChrisDave", "link": "https://stackoverflow.com/users/6565674/chrisdave"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 95, "favorite_count": 1, "accepted_answer_id": 38273710, "answer_count": 1, "score": 0, "last_activity_date": 1468004533, "creation_date": 1467987253, "last_edit_date": 1468003513, "question_id": 38268859, "link": "https://stackoverflow.com/questions/38268859/go-nested-json-marshall-or-encoding", "title": "Go Nested Json Marshall or Encoding", "body": "<p>For a project of mine, i need to encode into Json like below. I have all the values as variables. Any help is appreciated.</p>\n\n<p>{\"id\":[{\"name\":\"Test\",\"Class\":[{\"Grade\":\"2\",\"id\":\"34\"}]}],\"age\":\"5\"}</p>\n\n<p>this is the code i have tried</p>\n\n<pre><code>type classx  struct {\n    Grade string `json:\"grade\"`\n    Id string `json:\"id\"`        \n}\ntype idx  struct {\n    Name string `json:\"name\"`\n    Class []classx\n\n\n}\ntype Response struct {\n    Age  string     `json:\"age\"`\n    Id []idx \n} \n</code></pre>\n\n<p>But getting an error  \"cannot use classx literal (type classx) as type []classx in field value\"</p>\n"}, {"tags": ["go", "floating-point", "type-conversion", "nan", "infinity"], "answers": [{"comments": [{"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1467982879, "post_id": 38267299, "comment_id": 63954122, "body": "Well yes, but if I simply call <code>math.Float32frombits</code> on the binary representation of n, and this returns NaN or &#177;\u221e, what do I do?"}], "tags": [], "owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "is_accepted": false, "score": 0, "last_activity_date": 1467982608, "creation_date": 1467982608, "answer_id": 38267299, "question_id": 38266996, "link": "https://stackoverflow.com/questions/38266996/generate-n-different-floats-that-arent-%e2%88%9e-or-nan-in-go/38267299#38267299", "title": "Generate n different floats that aren&#39;t \u221e or NaN (in Go)", "body": "<p>i think you are looking for <code>math.Float32frombits</code> function: <a href=\"https://golang.org/pkg/math/#Float32frombits\" rel=\"nofollow\">https://golang.org/pkg/math/#Float32frombits</a></p>\n"}, {"comments": [{"owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1467984503, "post_id": 38267460, "comment_id": 63955218, "body": "Haa, I didn&#39;t realize that there were more than two binary representations for NaN, but you&#39;re right: <a href=\"https://play.golang.org/p/SIGEOULoFp\" rel=\"nofollow noreferrer\">play.golang.org/p/SIGEOULoFp</a> prints &quot;nans: 16777213, infs: 2&quot;. I tested an adaptation of your solution (to avoid denormal numbers) and it works: <a href=\"https://play.golang.org/p/BPAyA0Ayo0\" rel=\"nofollow noreferrer\">play.golang.org/p/BPAyA0Ayo0</a>. Thanks!"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "reply_to_user": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 0, "creation_date": 1467994818, "post_id": 38267460, "comment_id": 63961945, "body": "@Ted: That&#39;s odd. It should be <code>16777214</code> nans, not <code>16777213</code>. (Even if it&#39;s not obvious how to count them, it&#39;s trivially true that NaN come in pairs, because flipping the &quot;sign bit&quot; of a NaN gives another NaN.)"}, {"owner": {"reputation": 24610, "user_id": 270986, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49652c88a43a35bbf0095abfdae3515?s=128&d=identicon&r=PG", "display_name": "Mark Dickinson", "link": "https://stackoverflow.com/users/270986/mark-dickinson"}, "reply_to_user": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "edited": false, "score": 1, "creation_date": 1467995271, "post_id": 38267460, "comment_id": 63962193, "body": "@Ted: Ah, I see. Your <code>b &lt; math.MaxUint32</code> should be <code>b &lt;= math.MaxUint32</code>, in the first script you linked to."}], "tags": [], "owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "is_accepted": true, "score": 7, "last_activity_date": 1467983765, "last_edit_date": 1467983765, "creation_date": 1467983059, "answer_id": 38267460, "question_id": 38266996, "link": "https://stackoverflow.com/questions/38266996/generate-n-different-floats-that-arent-%e2%88%9e-or-nan-in-go/38267460#38267460", "title": "Generate n different floats that aren&#39;t \u221e or NaN (in Go)", "body": "<p>You can't get 2^32-4 valid floating point numbers in a float32. IEEE 754 binary32 numbers have two infinities (negative and positive) and 2^24-2 possible NaN values.</p>\n\n<p>A 32 bit floating point number has the following bits:</p>\n\n<pre><code>31   30...23  22...0\nsign exponent mantissa\n</code></pre>\n\n<p>All exponents with the value 0xff are either infinity (when mantissa is 0) or NaN (when mantissa isn't 0). So you can't generate those exponents.</p>\n\n<p>Then it's just a simple matter or mapping your allowed integers into this format and then use <code>math.Float32frombits</code> to generate a float32. How you do that is your choice. I'd probably be lazy and just use the lowest bit for the sign and then reject all numbers higher than 2^32 - 2^24 - 1 and then shift the bits around.</p>\n\n<p>So something like this (untested):</p>\n\n<pre><code>func foo(n uint32) float32 {\n    if n &gt;= 0xff000000 {\n        panic(\"xxx\")\n    }\n    return math.Float32frombits((n &amp; 1) &lt;&lt; 31 | (n &gt;&gt; 1))\n}\n</code></pre>\n\n<p>N.B. I'd probably also avoid denormal numbers, that is numbers with the exponent 0 and non-zero mantissa. They can be slow and might not be handled correctly. For example they could all be mapped to zero, there's nothing in the go spec that talks about how denormal numbers are handled, so I'd be careful.</p>\n"}], "owner": {"reputation": 788, "user_id": 5181219, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2202d8101a87cb7221de3fc461b8ef3d?s=128&d=identicon&r=PG&f=1", "display_name": "Ted", "link": "https://stackoverflow.com/users/5181219/ted"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 380, "favorite_count": 0, "accepted_answer_id": 38267460, "answer_count": 2, "score": 3, "last_activity_date": 1468016264, "creation_date": 1467981747, "last_edit_date": 1468016264, "question_id": 38266996, "link": "https://stackoverflow.com/questions/38266996/generate-n-different-floats-that-arent-%e2%88%9e-or-nan-in-go", "title": "Generate n different floats that aren&#39;t \u221e or NaN (in Go)", "body": "<p>I want a function <code>getNthFloat(uint32 n) float32</code> such that for each n,m &lt; 2\u00b3\u00b2-4 with n\u2260m, <code>getNthFloat(n)</code> and <code>getNthFloat(m)</code> return distinct floats that real numbers (neither NaN nor \u00b1\u221e). 2\u00b3\u00b2-4 is chosen because if I understand <a href=\"https://en.wikipedia.org/wiki/IEEE_floating_point\" rel=\"nofollow\">IEEE 754</a> correctly, there are two binary representations of NaN, one for \u221e and one for -\u221e.</p>\n\n<p>I imagine I should convert my uint32 into bits and convert bits into float32, but I can't figure out how to avoid the four values efficiently.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 2, "creation_date": 1467982893, "post_id": 38265318, "comment_id": 63954133, "body": "you can pass <code>i</code> to <code>panic</code>, this is what is returned by <code>recover</code>. however most likely you should be using error values instead. panics in go are used predominantely for unexpected errors that are unrecoverable."}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1468003446, "post_id": 38265318, "comment_id": 63966178, "body": "@kostya: I completely agree with you on using error values. My problem is that some functions are incomplete so panic is being used. We just want to make sure that the server doesn&#39;t crash and is available to process next requests."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1468226014, "post_id": 38265318, "comment_id": 64021312, "body": "Are you sure you have to use panic? From your code seems returning a second error parameter - the godiomatic way - is more suited for this case. FYI panic/recover is not what we call try/catch in other languages. Errors are for error handling in Go. panics are used when the program should panic like when it has not access to database or file-system (so continue to work is pointless) or some other external (C) lib does not work as expected."}], "answers": [{"comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1468003185, "post_id": 38268942, "comment_id": 63966058, "body": "So are you suggesting that in defer recover block I should manually create an error and return it?"}, {"owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1468068790, "post_id": 38268942, "comment_id": 63982729, "body": "correct. And based on that call the function again from the outside. If you try to call the function again in the defer block, you have to change the function with additional parameters to know when to stop retrying for example."}], "tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": true, "score": 2, "last_activity_date": 1467994755, "last_edit_date": 1467994755, "creation_date": 1467987503, "answer_id": 38268942, "question_id": 38265318, "link": "https://stackoverflow.com/questions/38265318/retry-the-method-with-same-parameter-that-caused-it-to-panic/38268942#38268942", "title": "Retry the method with same parameter that caused it to panic", "body": "<p>I am assuming you wanted to test any function that could fail with this construct, best without having to change that function. Here my solution. Hope this is what you were looking for.</p>\n\n<p><a href=\"https://play.golang.org/p/tetjWOEpDS\" rel=\"nofollow\">Go PlayGround</a></p>\n\n<pre><code>package main\n\nimport (\n    \"errors\"\n    \"fmt\"\n)\n\nfunc test(i int) error {\n    if i == 3 {\n        return errors.New(\"Panic\")\n    }\n    return nil\n}\n\nfunc retryWrapper(i, try int) {\n    err := test(i)\n    fmt.Printf(\"i: %d try: %d\\n\", i, try)\n\n    if err != nil &amp;&amp; try &lt; 5 {\n        retryWrapper(i, try+1)\n    }\n}\n\nfunc main() {\n    for i := 1; i &lt; 5; i++ {\n        retryWrapper(i, 1)\n    }\n}\n</code></pre>\n\n<p>This works with functions that return an error. If your function panics, you will need to change the test function with a defer/recover like this:</p>\n\n<p><a href=\"https://play.golang.org/p/Wusm-O7FLT\" rel=\"nofollow\">Recover Sample</a></p>\n\n<pre><code>func test(i int) (err error) {\n    defer func() {\n        if r := recover(); r != nil {\n            err = errors.New(r.(string))\n        }\n    }()\n    if i == 3 {\n        panic(\"Panic\")\n    }\n    return\n}\n</code></pre>\n\n<p>Note: retry is limited to 5 trys to prevent an infinite loop.</p>\n"}], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 880, "favorite_count": 0, "accepted_answer_id": 38268942, "answer_count": 1, "score": 3, "last_activity_date": 1467994755, "creation_date": 1467976544, "question_id": 38265318, "link": "https://stackoverflow.com/questions/38265318/retry-the-method-with-same-parameter-that-caused-it-to-panic", "title": "Retry the method with same parameter that caused it to panic", "body": "<p><a href=\"https://play.golang.org/p/zjMPNRxH7i\" rel=\"nofollow\">Code Play Golang Link</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc test(i int){\n    defer func(){\n        if r := recover(); r != nil {\n            fmt.Println(\"Inside Recover: \", r)\n        }\n\n    }()\n    for try := 1 ; try &lt;= i ; try++{\n        if (i == 3){\n            panic(\"Panic\")\n        }\n        fmt.Printf(\"i: %d try: %d\\n\", i , try)\n    }\n}\n\nfunc main(){\n\n    for i := 1 ; i &lt; 5 ; i++{\n        test(i)\n    }\n}\n</code></pre>\n\n<p>The method panics and skips to next <code>i</code> value without trying <code>i</code> times. Is there a way in which we can recover from the panic and retry for the same value of <code>i</code> that caused panic ?\n<br></p>\n"}, {"tags": ["rest", "go", "net-http", "gorilla"], "comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user5547025"}, "edited": false, "score": 0, "creation_date": 1467978426, "post_id": 38264363, "comment_id": 63951125, "body": "What concrete use cases do you have in mind?"}, {"owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "edited": false, "score": 0, "creation_date": 1467985564, "post_id": 38264363, "comment_id": 63955946, "body": "For now , it is simple Get calls  (my Api pulls data from some backend storage) , it may be Database (Sql or No Sql) or cache or both . Going forward it can be all CRUD operations as well . That being said , there are other things (neat error handling etc) ."}], "answers": [{"comments": [{"owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "edited": false, "score": 0, "creation_date": 1468088869, "post_id": 38277607, "comment_id": 63988527, "body": "Thanks for response Adrian. Yes , I agree and am looking to do some Proof Of Concept to explore more things first hand . But POC can only do little (all I can make is simple rest API which I assume is easy and may not answer what I am looking here) . So I thought of asking it in a broader forum from developers who have spent some time building things with Go .Your reply sheds some light and gives me more clarity ."}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 6, "last_activity_date": 1468030371, "creation_date": 1468030371, "answer_id": 38277607, "question_id": 38264363, "link": "https://stackoverflow.com/questions/38264363/rest-apis-in-go-using-net-http-vs-a-library-like-gorilla/38277607#38277607", "title": "Rest APIs in Go - using net/http vs. a library like Gorilla", "body": "<p>The built-in <code>net/http</code> package is sufficient to build a complete REST API. However, some of the libraries can make building an API slightly easier, particularly if the REST API is complex. Changing from the built-in facilities to any decent framework is relatively straightforward - they generally accept handlers of the <code>http.Handler</code> type.</p>\n\n<p>In the end, though, this is an extremely situational choice. The best thing you can do is examine each available solution, contrast and compare, and build a proof of concept with the top options if you possibly can. First-hand experience will guide you best.</p>\n"}, {"comments": [{"owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "edited": false, "score": 1, "creation_date": 1468088685, "post_id": 38279507, "comment_id": 63988469, "body": "Thanks so much Shmulik , this was exactly kind of answer I was looking here"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1468089717, "post_id": 38279507, "comment_id": 63988769, "body": "Keep in mind that gorilla isn&#39;t the only option - I&#39;ve been using httprouter which is a bit more lightweight and I&#39;ve had good success with it. It doesn&#39;t have as much functionality, it sits somewhere between the built in package and gorilla in terms of features."}], "tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 11, "last_activity_date": 1617131905, "last_edit_date": 1617131905, "creation_date": 1468049821, "answer_id": 38279507, "question_id": 38264363, "link": "https://stackoverflow.com/questions/38264363/rest-apis-in-go-using-net-http-vs-a-library-like-gorilla/38279507#38279507", "title": "Rest APIs in Go - using net/http vs. a library like Gorilla", "body": "<ol>\n<li><p>The <code>net/http</code> package is probably sufficient for most scenarios, but if you want to ease your development, you should use a third-party package, such as Gorilla.\nFor example, <code>net/http</code>'s <code>ServeMux</code> does a great job at routing incoming requests for fixed URL paths but for pretty paths which use variables, you will need to implement a custom multiplexer while using Gorilla, you are getting this for free.</p>\n<p>Another example is if you want to specify RESTful resources with\nproper HTTP methods, it is hard to work with the standard\n<code>http.ServeMux</code>, while with Gorilla's <code>mux</code> package,\nrequests can be matched based on URL host, path, path prefix,\nschemes, header and query values, and HTTP methods.</p>\n</li>\n<li><p>One of the great benefits of Gorilla is that it is fully compatible with the <code>net/http</code> package and can be substituted in the future.</p>\n</li>\n<li><p>See 1.</p>\n</li>\n</ol>\n<p>I totally encourage you to use Gorilla's toolkit to develop REST services.</p>\n"}], "owner": {"reputation": 1963, "user_id": 2156718, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/93c82b05997424df0edd2deb69b676e2?s=128&d=identicon&r=PG", "display_name": "Ankur Garg", "link": "https://stackoverflow.com/users/2156718/ankur-garg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4159, "favorite_count": 1, "accepted_answer_id": 38277607, "answer_count": 2, "score": 15, "last_activity_date": 1617278728, "creation_date": 1467973518, "last_edit_date": 1617278728, "question_id": 38264363, "link": "https://stackoverflow.com/questions/38264363/rest-apis-in-go-using-net-http-vs-a-library-like-gorilla", "title": "Rest APIs in Go - using net/http vs. a library like Gorilla", "body": "<p>I see that Go itself has a package <code>net/http</code>, which is adequate at providing everything you need to get your own REST APIs up and running. However, there are a variety of frameworks; the most popular maybe say <code>gorilla</code>.</p>\n<p>Considering that one of the main things I need to do going forward is to build REST APIs that will access some back-end storage (databases, caches, etc.) to perform <code>CRUD</code> operation, is it good to go with Go's standard library itself, or should I consider using some frameworks?</p>\n<p>Normally, people write a new library or framework which solves the problem present in the existing library. But a lot of the frameworks also tend to make things worse when actual demands are simple.</p>\n<p>So I have few questions:</p>\n<ol>\n<li><p>Is the basic library in go lang good enough to support basic to moderate functionality for REST?</p>\n</li>\n<li><p>If I do end up using the inbuilt library and tomorrow have to change it to use some framework (like a gorilla), how difficult/costly would that be?</p>\n</li>\n<li><p>Are frameworks really addressing the problems or just making simple problems complex?</p>\n</li>\n</ol>\n<p>I would be extremely grateful for someone to share his thoughts here (who has been through making this choice himself) while I research more of my own.</p>\n"}, {"tags": ["pointers", "methods", "go", "slice", "chess"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 1, "creation_date": 1467971796, "post_id": 38263511, "comment_id": 63947244, "body": "Is <code>b.board</code> a pointer type (<code>board</code> is a pointer to some board type)? If so, then a shallow copy <code>possible := *b</code> creates a new struct <code>possible</code> which has the same pointer address in its <code>board</code> field as <code>b.board</code>. Any access/modification now done through referencing <code>possible.board</code> will change the value for <code>b</code> too since both share the same pointer."}, {"owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467971949, "post_id": 38263511, "comment_id": 63947338, "body": "No, <code>b.board</code> is a <code>[]byte</code>"}], "answers": [{"tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 2, "last_activity_date": 1467972638, "last_edit_date": 1467972638, "creation_date": 1467972239, "answer_id": 38263938, "question_id": 38263511, "link": "https://stackoverflow.com/questions/38263511/modify-dereferenced-struct-pointer-changes-most-struct-values-but-not-slices/38263938#38263938", "title": "Modify dereferenced struct pointer changes most struct values, but not slices", "body": "<p>Since <code>b.board</code> is a slice type, it is a reference type (<a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">https://blog.golang.org/go-slices-usage-and-internals</a>) and behaves like a pointer. So any changes made to <code>possible.board</code> will show up in <code>b</code>. You can try making a copy of <code>b.board</code> like so:</p>\n\n<pre><code>func (b *Board) Move(orig, dest int) error {\n    // validation\n    ...\n    // Update \n    possible := *b // A 'shallow copy'?\n    boardCopy := make([]byte, len(b.board))\n    copy(boardCopy, b.board)\n    possible.board = boardCopy\n\n    possible.updateBoard(orig, dest, val, isEmpassant, isCastle)\n\n    // ...\n</code></pre>\n\n<p>Note that you'll have to do something like this for all reference types.</p>\n"}, {"tags": [], "owner": {"reputation": 5467, "user_id": 6220193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5ce5723ea1716955e1f492c59d5cb5cb?s=128&d=identicon&r=PG", "display_name": "TehSphinX", "link": "https://stackoverflow.com/users/6220193/tehsphinx"}, "is_accepted": false, "score": 2, "last_activity_date": 1467984225, "last_edit_date": 1467984225, "creation_date": 1467983452, "answer_id": 38267591, "question_id": 38263511, "link": "https://stackoverflow.com/questions/38263511/modify-dereferenced-struct-pointer-changes-most-struct-values-but-not-slices/38267591#38267591", "title": "Modify dereferenced struct pointer changes most struct values, but not slices", "body": "<p>Dereferencing does NOT make a copy. It returns the original value your pointer points to.</p>\n\n<p>You get a copy because you are assigning that value to a new variable. In go every assignment makes a copy as does every pass to a function. If you assign or pass a reference, that reference is copied.</p>\n\n<p>In your case you copy the value b points to. In that struct there are pointers like the b.board slice (slices have a pointer to an underlying array). So go is creating a copy of the slice. The copy still points to the same array as the slice in the original b variable. If you change that array, it is changed for both your boards.</p>\n\n<p>You will need to implement a copy function to your Board struct that correctly creates a copy of your struct handling each variable depending on its type and returns that new board.</p>\n\n<p>Something like:</p>\n\n<pre><code>func (b *Board) copy() *Board {\n  boardCopy := make([]byte, len(b.board))\n  copy(boardCopy, b.board)\n\n  return &amp;Board{\n    moveTo: b.moveTo,\n    board: boardCopy\n    ...\n  }\n}\n</code></pre>\n\n<p>Hope that helps and my explanation wasn't confusing :)</p>\n"}], "owner": {"reputation": 6434, "user_id": 4443226, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/C3vUB.png?s=128&g=1", "display_name": "Nevermore", "link": "https://stackoverflow.com/users/4443226/nevermore"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 869, "favorite_count": 0, "accepted_answer_id": 38263938, "answer_count": 2, "score": 1, "last_activity_date": 1581766630, "creation_date": 1467970925, "last_edit_date": 1581766630, "question_id": 38263511, "link": "https://stackoverflow.com/questions/38263511/modify-dereferenced-struct-pointer-changes-most-struct-values-but-not-slices", "title": "Modify dereferenced struct pointer changes most struct values, but not slices", "body": "<p>I'm trying to create a shallow copy of a struct Board (a chessboard). Before saving a move to the board, I need to check if that move puts the mover in check.</p>\n\n<p>To do so, within the Move method (method of a pointer), I <strong>dereference</strong> the pointer, update and check this <strong><em>possible</em></strong> board for Check. When I change the value of a single value of the Board type (such as <code>possible.headers = \"Possible Varient\"</code>) the original <code>b</code> Board is not changed. </p>\n\n<p>But here when I call a method updateBoard() it updates both boards. I still receive the error (cannot move into check), but the main thread thinks <code>b.board</code> (the board position) has been changed.</p>\n\n<pre><code>func (b *Board) Move(orig, dest int) error {\n    // validation\n    ...\n    // Update \n    possible := *b // A 'shallow copy'?\n    possible.updateBoard(orig, dest, val, isEmpassant, isCastle)\n\n    king := possible.findKingPositionOfThePlayerWhoMoved()\n    isCheck := possible.isInCheck(king) // bool takes the king to check for\n\n    if isCheck {\n        return errors.New(\"Cannot move into Check\")\n    }\n    b.updateBoard(orig, dest, val, empassant, isCastle)\n    return nil\n</code></pre>\n\n<p>Strangely, not all the the values updated by <code>updateBoard()</code> change. So the <code>b.toMove</code> value doesn't change, but the <code>b.board</code> value does (the position of the pieces). This means if I pass <code>possible := b</code> instead, the game will only ever be white's move (toMove is alternated in the updateBoard() method). With <code>possible := *b</code>, turn alternation works until one moves into check. Then the move is applied to <code>b.board</code>, but the error is thrown back and it remains the checked-players turn (meaning <code>possible.updateBoard()</code> didn't update b.toMove.</p>\n\n<p><strong>Edit</strong></p>\n\n<p>As abhink pointed out, in <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow\">Go Slices usage and internals</a>,</p>\n\n<blockquote>\n  <p>Slicing does not copy the slice's data. It creates a new slice value that points to the original array. </p>\n</blockquote>\n\n<p><code>b.board</code>, a <code>[]byte</code>, always points to its original value (even when the struct which holds it is <strong>dereferenced</strong>. abhink's answer uses the Go <code>func copy(dst, src []Type) int</code>, <a href=\"https://golang.org/pkg/builtin/#copy\" rel=\"nofollow\">https://golang.org/pkg/builtin/#copy</a> , a shortcut for copying the values of the pointers.</p>\n"}, {"tags": ["generics", "go", "slice", "generic-programming"], "comments": [{"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 5, "creation_date": 1467982083, "post_id": 38262310, "comment_id": 63953543, "body": "i think for the code you presented in your question there is little benefit of having a generic function. two separate functions are perfectly fine, readable and type safe. you can save a few lines of code by not creating empty slice for missing ids (just use nil instead)."}, {"owner": {"reputation": 5174, "user_id": 1975086, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/e01df0a60ee2c34233ce48e32c21a3b8?s=128&d=identicon&r=PG", "display_name": "Alexander Trakhimenok", "link": "https://stackoverflow.com/users/1975086/alexander-trakhimenok"}, "edited": false, "score": 0, "creation_date": 1468249923, "post_id": 38262310, "comment_id": 64037492, "body": "I&#39;ve tried to compose a solution but it seems your code is flowed. You are building <code>pds</code> &amp; <code>gds</code> maps that are keyed by PremierDate and Genre <code>Id</code> but then you are looking up by movie ID: <code>gs[value.Id]</code>. Does not make any sense to me.  Also note instead of <code>m[key].Genres = </code> you can do <code>value.Genres = </code>"}], "answers": [{"tags": [], "owner": {"reputation": 901, "user_id": 1241479, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/BRrrO.png?s=128&g=1", "display_name": "Donovan Solms", "link": "https://stackoverflow.com/users/1241479/donovan-solms"}, "is_accepted": false, "score": 3, "last_activity_date": 1467986778, "last_edit_date": 1495542150, "creation_date": 1467986778, "answer_id": 38268693, "question_id": 38262310, "link": "https://stackoverflow.com/questions/38262310/making-two-similar-functions-generic/38268693#38268693", "title": "Making two similar functions generic", "body": "<p>While I agree with <a href=\"https://stackoverflow.com/users/3477832/kostya\">kostya</a> that having it as separate functions is perfectly fine, it might become less maintainable if you want to add 20+ items to a movie - like <code>cast</code> ,<code>revenues_per_country</code>, etc. You'd be left with 20+ functions.</p>\n\n<p>The following function would compress it into one function, but you'll need to add different <code>case</code> sections for each field you want to add.</p>\n\n<p>To use it, simply drop it in place of your current calls:</p>\n\n<p>Usage:\n<code>movies = addStuffToMovies(movies, genres)</code></p>\n\n<pre><code>// addStuffToMovies adds fields to a movie where the ID matches\nfunc addStuffToMovies(movies []Movie, stuff interface{}) []Movie {\n\n    // Go through the movies list\n    for current, movie := range movies {\n\n        // check the type and append based on that\n        switch v := stuff.(type) {\n\n        // This is the section you'll need to duplicate for each type of field\n        case []Genre:\n            for _, item := range v {\n                // if it matches, append it to Genres\n                if item.Id == movie.Id {\n                    movies[current].Genres = append(movies[current].Genres, item)\n                }\n            }\n\n        // This is the section you'll need to duplicate for each type of field\n        case []PremiereDate:\n            for _, item := range v {\n                // if it matches, append it to PremiereDates\n                if item.Id == movie.Id {\n                    movies[current].PremiereDates = append(movies[current].PremiereDates, item)\n                }\n            }\n        }\n    }\n    return movies\n}\n</code></pre>\n\n<p>You could probably take it a step further by adding an <a href=\"https://golang.org/doc/effective_go.html#interfaces_and_types\" rel=\"nofollow noreferrer\">interface</a>, then instead of <code>stuff interface{}</code> you'll have something like <code>[]FieldInterface</code> with calls like <code>GetID()</code>, <code>GetType()</code> instead of the different <code>case</code> sections. I think you'll still need to do type checking somewhere to actually assign it to the movie. This will probably be way to much effort when a <code>switch</code> like above will work fine.</p>\n"}], "owner": {"reputation": 664, "user_id": 1752676, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/e551751342832e23787f28821363ab18?s=128&d=identicon&r=PG", "display_name": "John Magistr", "link": "https://stackoverflow.com/users/1752676/john-magistr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 106, "favorite_count": 1, "answer_count": 1, "score": 4, "last_activity_date": 1467986778, "creation_date": 1467967009, "question_id": 38262310, "link": "https://stackoverflow.com/questions/38262310/making-two-similar-functions-generic", "title": "Making two similar functions generic", "body": "<p>I have two functions in Go that do almost the same. They take a slice of structs which has an 'ID' field, and re-sort it into a map indexed by that field. They then append it to a field of another struct, which is also identified by the ID.</p>\n\n<p>The two functions do the same, but append to two different fields in the struct. I want to make the methods generic, but I am not sure how to do it. I would expect it could be done using a pointer, but I'm not sure how.</p>\n\n<p>Function 1:</p>\n\n<pre><code>func addPremiereDatesToMovies(m []Movie, pd []PremiereDate) ([]Movie, error) {\n    pds := make(map[int64][]PremiereDate)\n\n    // Key-index the premiere-date array for easier lookup\n    for _, value := range pd {\n        pds[value.Id] = append(pds[value.Id], value)\n    }\n\n    // Append premiere dates to movies where such exist\n    for key, value := range m {\n        if _, ok := pds[value.Id]; !ok {  // &lt;-- How to make this generic?\n            m[key].PremiereDates = []PremiereDate{}\n            continue\n        }\n\n        m[key].PremiereDates = pds[value.Id]\n    }\n\n    return m, nil\n}\n</code></pre>\n\n<p>Function 2:</p>\n\n<pre><code>func addGenresToMovies(m []Movie, g []Genre) ([]Movie, error) {\n    gs := make(map[int64][]Genre)\n\n    // Key-index the genre array for easier lookup\n    for _, value := range g {\n        gs[value.Id] = append(gs[value.Id], value)\n    }\n\n    // Append genres to movies where such exist\n    for key, value := range m {\n        if _, ok := gs[value.Id]; !ok { // &lt;-- How to make this generic?\n            m[key].Genres = []Genre{}\n            continue\n        }\n\n        m[key].Genres = gs[value.Id]\n    }\n\n    return m, nil\n}\n</code></pre>\n\n<p>As it seems, they look quite similar. I am able to sort of do it, except I cannot figure out how to generically describe the \"value.Id\" field on line 11.</p>\n\n<p>Thank you.</p>\n"}, {"tags": ["php", "go"], "comments": [{"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467967637, "post_id": 38262155, "comment_id": 63944716, "body": "Could you list out a sample row from keywords and filter csv file? How do you intend to map keywords to filters?"}, {"owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467970784, "post_id": 38262155, "comment_id": 63946605, "body": "I will have two files. List A, will contain 1 column Keyword ------------------------ Keyword 1 Keyword 2 Thrase 1 Thrase 2  List B will contain blacklisted keyword as well with one column. Keywords ----------------------------------- Keyword 2   Each keyword from List A will be checked against each keyword from List B. Which should return array of matching values. The output of this filter should be Thrase 1 from List A. Because we have to rows with word Keyword and two rows with number 2, the only one that does not match is Thrase 1 keyword which should be returned."}, {"owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467970901, "post_id": 38262155, "comment_id": 63946678, "body": "I can use strings.Contain function to determin if any of List A keywords match the keywords from List B but I don&#39;t understand how to store that, in the form of associative array. In order to later populate List C with filtered keywords..."}, {"owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "reply_to_user": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467970970, "post_id": 38262155, "comment_id": 63946711, "body": "Here is my complete code so far <a href=\"https://play.golang.org/p/dmnxoOUrO6\" rel=\"nofollow noreferrer\">play.golang.org/p/dmnxoOUrO6</a>"}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "edited": false, "score": 0, "creation_date": 1467975845, "post_id": 38262155, "comment_id": 63949604, "body": "Do you really need a map as a result? What would be a key and value pair of this map? Shouldn&#39;t the filtered keywords be only a list of keywords (an array or a slice)? Also, could you clarify exactly how <code>Therse 1</code> would be the output above?"}], "answers": [{"tags": [], "owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "is_accepted": false, "score": 0, "last_activity_date": 1468145631, "creation_date": 1468145631, "answer_id": 38290806, "question_id": 38262155, "link": "https://stackoverflow.com/questions/38262155/store-data-generated-within-nested-loop-in-map-or-slice/38290806#38290806", "title": "Store data generated within nested loop in map or slice", "body": "<p>I do not know PHP, but as far as I understand from the PHP code the Go equivalent should be:</p>\n\n<pre><code>func compare(keyword string, filters map[string]struct{}) (string, error) {\n    // value, ok := myMap[key]\n    // this is Go syntax for checking the existance of a key in a map - check the ok variable.\n    _, filterMatched := filters[keyword]\n    if filterMatched {\n        return ``, fmt.Errorf(\"keyword %s got filtered\", keyword)\n    }\n\n    return keyword, nil\n}\n</code></pre>\n\n<p>In other words you could just use the <code>map</code> type, but having a helper function that clears our intention is good.</p>\n"}, {"tags": [], "owner": {"user_type": "does_not_exist", "display_name": "user6169399"}, "is_accepted": false, "score": 0, "last_activity_date": 1475958596, "last_edit_date": 1475958596, "creation_date": 1475957360, "answer_id": 39936881, "question_id": 38262155, "link": "https://stackoverflow.com/questions/38262155/store-data-generated-within-nested-loop-in-map-or-slice/39936881#39936881", "title": "Store data generated within nested loop in map or slice", "body": "<p>Here is the working code with some optimizations, try it on the <a href=\"https://play.golang.org/p/8q1HGgoyQT\" rel=\"nofollow\">The Go Playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    filters := []string{\"aaa\", \"bbb\", \"ccc\"}\n    fmt.Println(compareKeywords(\"a\", filters)) // \"\"\n    fmt.Println(compareKeywords(\"d\", filters)) // \"d\"\n}\nfunc compareKeywords(keyword string, filters []string) string {\n    for _, filter := range filters {\n        if strings.Index(filter, keyword) &gt;= 0 {\n            return \"\"\n        }\n    }\n    return keyword\n}\n</code></pre>\n\n<p>output:</p>\n\n<pre><code>d\n</code></pre>\n\n<hr>\n\n<p>And see <code>strings.Index</code> Docs:</p>\n\n<pre><code>func Index(s, sep string) int\n</code></pre>\n\n<blockquote>\n  <p>Index returns the index of the first instance of sep in s, or -1 if sep is not present in s.</p>\n</blockquote>\n"}], "owner": {"reputation": 666, "user_id": 4061068, "user_type": "registered", "accept_rate": 31, "profile_image": "https://graph.facebook.com/1342754480/picture?type=large", "display_name": "Andrius Solopovas", "link": "https://stackoverflow.com/users/4061068/andrius-solopovas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 121, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1475958596, "creation_date": 1467966449, "last_edit_date": 1475957661, "question_id": 38262155, "link": "https://stackoverflow.com/questions/38262155/store-data-generated-within-nested-loop-in-map-or-slice", "title": "Store data generated within nested loop in map or slice", "body": "<p>I am coming from PHP background and trying to build small tool that would allow me to filter the list of keywords against the black list both supplied via CSV file. I managed to do that in PHP but it has some speed limitation. So I decided to try my powers with Golang. I have succeeded to open CSV file <code>fmt.Println</code> the contents of both keywords and blacklist, and managed to compare each of the keywords to each of the blacklists keyword. But the problem I face is that I can figure out how to build dynamic associative array something like that.</p>\n\n<pre><code>   function compareKeywords($keyword, $filters) {\n        $matches = [];    \n        foreach($filters as $filter) {\n            $matches[] = strpos($keyword, $filter);\n        }    \n        $matches = array_filter($matches);    \n        if(empty($matches)) {\n            return $keyword\n        }\n    }\n</code></pre>\n\n<p>This function simply checks keyword against fully or partially matching the blacklisted keywords if it does not match the blacklisted keywords it returns this keyword and then adds it to CSV file. </p>\n\n<p>I spent decent amount of time trying to create similar function in Golang but I struggle to mimic the associative array from PHP. </p>\n\n<p>I came up with slightly different function which accepts keywords rather than single keyword as well as filters and uses nested loop. </p>\n\n<pre><code>func compare(keywords [][]string, filterKeywords [][]string) (keywordMap //no sure what type it should be) {\n    matchFilters := make(map[string]string)\n    keywordMap :=  make(map[string]string)\n\n    for _, keyword := range keywords {\n        for _, filter := range filterKeywords {\n            if convStr(keyword) == convStr(filter) {\n                // here i want to store matches filters \n            }\n        }\n    }\n\n    //Check if matchFilters empty and return filtered keywordMap\n\n    return\n\n}\n</code></pre>\n\n<p>I know my code may look verbose and look a bit lame. But any advice into direction I should move would be very appreciated. </p>\n"}, {"tags": ["go", "protocol-buffers"], "answers": [{"tags": [], "owner": {"reputation": 750, "user_id": 1045017, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/0n6PZ.jpg?s=128&g=1", "display_name": "Liam Haworth", "link": "https://stackoverflow.com/users/1045017/liam-haworth"}, "is_accepted": true, "score": 2, "last_activity_date": 1467954499, "creation_date": 1467954499, "answer_id": 38259252, "question_id": 38257434, "link": "https://stackoverflow.com/questions/38257434/building-protobuf-messages-in-go-that-use-oneof/38259252#38259252", "title": "Building protobuf messages in Go that use &quot;oneof&quot;", "body": "<p>For once I have been able to answer my own question. With a lot of googling and experimenting I have gotten to the following solution</p>\n\n<pre><code>apiMessage := &amp;kumo.KumoAPIMessage{&amp;kumo.KumoAPIMessage_OsEnvContext{context}}\n</code></pre>\n\n<p>It seems that the GoLang compiler for protobufs generates a struct for the wrapper message AND a struct for the message type it is wrapping</p>\n"}], "owner": {"reputation": 750, "user_id": 1045017, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/0n6PZ.jpg?s=128&g=1", "display_name": "Liam Haworth", "link": "https://stackoverflow.com/users/1045017/liam-haworth"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2972, "favorite_count": 0, "accepted_answer_id": 38259252, "answer_count": 1, "score": 1, "last_activity_date": 1467954499, "creation_date": 1467939134, "question_id": 38257434, "link": "https://stackoverflow.com/questions/38257434/building-protobuf-messages-in-go-that-use-oneof", "title": "Building protobuf messages in Go that use &quot;oneof&quot;", "body": "<p>I've recently started toying with GoLang and Protocol Buffers, I have the following messages I'm trying to use</p>\n\n<pre><code>message KumoAPIMessage {\n  oneof msg {\n    OpenStackEnvironmentContext osEnvContext = 1;\n  }\n}\n\nmessage OpenStackEnvironmentContext {\n  string username = 1;\n  string password = 2;\n  string domain = 3;\n  string project = 4;\n  string authUrl = 6;\n  string region = 7;\n  string contextName = 8;\n}\n</code></pre>\n\n<p>These messages are deisgned so that they can be marshaled and sent via TCP to a server agent (written in Scala). The problem I'm having is actually building the messages in the go application.</p>\n\n<p>I have got a <code>OpenStackEnvironmentContext</code> message made but I can't work out how to wrap it in the <code>KumoAPIMessage</code>, I've tried the following</p>\n\n<pre><code>apiMessage := kumo.KumoAPIMessage{ Msg: context, }\n</code></pre>\n\n<p>But that just sends up throwing the following error on compile</p>\n\n<pre><code>cannot use context (type kumo.OpenStackEnvironmentContext) as type kumo.isKumoAPIMessage_Msg in field value:\nkumo.OpenStackEnvironmentContext does not implement kumo.isKumoAPIMessage_Msg (missing kumo.isKumoAPIMessage_Msg method)\n</code></pre>\n\n<p>If any one has any clue about where I am going wrong, you will be my hero.</p>\n"}, {"tags": ["xml", "go", "encoding", "struct"], "answers": [{"comments": [{"owner": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "edited": false, "score": 0, "creation_date": 1467996418, "post_id": 38261796, "comment_id": 63962792, "body": "I didn&#39;t make this clear in my post, but I was looking to marshal the XML not unmarshal. Apologies."}, {"owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "reply_to_user": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "edited": false, "score": 0, "creation_date": 1467997466, "post_id": 38261796, "comment_id": 63963290, "body": "To Marshal the data into xml, you can simply create a <code>receiver</code> struct, initialize it, and call <code>xml.Marshal(...)</code>: <a href=\"https://play.golang.org/p/JZcUUK9P1f\" rel=\"nofollow noreferrer\">play.golang.org/p/JZcUUK9P1f</a> or am I missing something here?"}, {"owner": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "edited": false, "score": 0, "creation_date": 1468003408, "post_id": 38261796, "comment_id": 63966160, "body": "That does work, you are correct. I&#39;m going to mark your answer correct, but for the sake of keeping the question and answer consistent could you change your answer to show the marshaling rather than the unmarshaling?"}], "tags": [], "owner": {"reputation": 6861, "user_id": 3129778, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/e4fade10019c1735cd345bc335c58732?s=128&d=identicon&r=PG&f=1", "display_name": "abhink", "link": "https://stackoverflow.com/users/3129778/abhink"}, "is_accepted": true, "score": 4, "last_activity_date": 1468004897, "last_edit_date": 1468004897, "creation_date": 1467965135, "answer_id": 38261796, "question_id": 38257362, "link": "https://stackoverflow.com/questions/38257362/go-encode-struct-fields-with-the-same-tag/38261796#38261796", "title": "Go - Encode struct fields with the same tag", "body": "<p>To Marshal the data into xml, you can simply create a simple receiver struct, initialize it, and call <code>xml.Marshal(...)</code>.</p>\n\n<p>(Note that to nest <code>credential</code> into <code>credentials</code>, explicit xml tag needs to be associated with the fields)</p>\n\n<pre><code>type Receiver struct {\n    XMLName      xml.Name     `xml:\"receiver\"`\n    ReceiverType string       `xml:\"receiver_type\"`\n    HostNames    string       `xml:\"hostnames\"`\n    Credentials  []Credential `xml:\"credentials&gt;credential\"` // necessary to allow tag nesting\n}\n\ntype Credential struct {\n    Name  string `xml:\"name\"`\n    Value string `xml:\"value\"`\n    Safe  bool   `xml:\"safe,omitempty\"` // omitempty does not include the tag if if it's empty\n}\n</code></pre>\n\n<p>Now you can simply initialize a <code>Receiver</code> and marshal it into xml:</p>\n\n<pre><code>r := &amp;Receiver{\n        ReceiverType: \"test\",\n        HostNames: \"http://posttestserver.com\",\n        Credentials: []Credential{\n            Credential{\"app-id\", \"1234\", true},\n            Credential{\"app-secret\", \"5678\", false},\n        },\n    }\n    a, _ := xml.MarshalIndent(r, \"\", \"  \") // a is []byte containing xml encoded data\n</code></pre>\n\n<p>(working example: <a href=\"https://play.golang.org/p/JZcUUK9P1f\" rel=\"nofollow\">https://play.golang.org/p/JZcUUK9P1f</a>)</p>\n\n<p><em>Original answer - method to unmarshal the above xml into receiver</em></p>\n\n<p>If you can avoid parsing the xml data directly into <code>Receiver[12]Credentials</code>, you can unmarshal the xml data into a much simpler structure (<code>Receiver</code> and <code>Credential</code> above) using the following method:</p>\n\n<pre><code>receiver := &amp;Receiver{}\nxml.Unmarshal(xmlDataByteSlice, receiver)\n</code></pre>\n\n<p>This would store all the <code>Credential</code> objects in <code>receiver.Credentials</code> above:</p>\n\n<pre><code>fmt.Println(receiver.Credentials)\n// [{app-id 1234 true} {app-secret 5678 false}]\n</code></pre>\n\n<p>You can then perhaps use a <code>switch case</code> on <code>receiver,Credential.Name</code> to initialize <code>Receiver[12]Credentials</code> accordingly.</p>\n\n<p>Working example: <a href=\"https://play.golang.org/p/jq3BrxKVo-\" rel=\"nofollow\">https://play.golang.org/p/jq3BrxKVo-</a></p>\n"}], "owner": {"reputation": 518, "user_id": 5813225, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/4f05e2c4ff75c55a8f233f80050ebf1a?s=128&d=identicon&r=PG&f=1", "display_name": "cfatt10", "link": "https://stackoverflow.com/users/5813225/cfatt10"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "accepted_answer_id": 38261796, "answer_count": 1, "score": 4, "last_activity_date": 1468004897, "creation_date": 1467938567, "last_edit_date": 1467996813, "question_id": 38257362, "link": "https://stackoverflow.com/questions/38257362/go-encode-struct-fields-with-the-same-tag", "title": "Go - Encode struct fields with the same tag", "body": "<p>I am dealing with an API that is expecting XML that is generally formatted like so.</p>\n\n<pre><code>&lt;receiver&gt;\n    &lt;receiver_type&gt;test&lt;/receiver_type&gt;\n    &lt;hostnames&gt;http://posttestserver.com&lt;/hostnames&gt;\n    &lt;credentials&gt;\n      &lt;credential&gt;\n        &lt;name&gt;app-id&lt;/name&gt;\n        &lt;value&gt;1234&lt;/value&gt;\n        &lt;safe&gt;true&lt;/safe&gt;\n      &lt;/credential&gt;\n      &lt;credential&gt;\n        &lt;name&gt;app-secret&lt;/name&gt;\n        &lt;value&gt;5678&lt;/value&gt;\n      &lt;/credential&gt;\n    &lt;/credentials&gt;\n  &lt;/receiver&gt;\n</code></pre>\n\n<p>Therefore, in my Go code, I made these structs to use in my functions and  marshal into the XML structure. Note that different receivers can have different sets of credentials.</p>\n\n<pre><code>type Receiver1 struct {\n    XMLName      xml.Name             `xml:\"receiver\"`\n    ReceiverType string               `xml:\"receiver_type\"`\n    HostNames    string               `xml:\"hostnames\"`\n    Credentials  Receiver1Credentials `xml:\"credentials\"`\n}\n\ntype Receiver2 struct {\n    XMLName      xml.Name             `xml:\"receiver\"`\n    ReceiverType string               `xml:\"receiver_type\"`\n    HostNames    string               `xml:\"hostnames\"`\n    Credentials  Receiver2Credentials `xml:\"credentials\"`\n}\n\ntype Receiver1Credentials struct {\n    AppID     Credential `xml:\"credential\"`\n    AppSecret Credential `xml:\"credential\"`\n}\n\ntype Receiver2Credentials struct {\n    UserName Credential `xml:\"credential\"`\n    Password Credential `xml:\"credential\"`\n    AppID    Credential `xml:\"credential\"`\n}\n\ntype Credential struct {\n    Name  string `xml:\"name\"`\n    Value string `xml:\"value\"`\n    Safe  bool   `xml:\"safe\"`\n}\n</code></pre>\n\n<p>However this produces runtime errors along the lines of <code>Receiver1Credentials field \"AppID\" with tag \"credential\" conflicts with field \"AppSecret\" with tag \"credential\"</code> meaning that I can't directly tag the Credentials fields the same thing. I've tried using a field <code>XMLName xml.Name xml:\"credential\"</code> (like on the Receiver structs) on the Credential struct, but it gets overwritten by the tag on the Credentials structs. Does anyone know how I could work around this?</p>\n"}, {"tags": ["android", "go", "google-cloud-messaging"], "answers": [{"tags": [], "owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "is_accepted": false, "score": 0, "last_activity_date": 1467934868, "creation_date": 1467934868, "answer_id": 38256916, "question_id": 38255469, "link": "https://stackoverflow.com/questions/38255469/proper-error-handling-when-sending-an-xmpp-push-notification-using-go-gcm/38256916#38256916", "title": "Proper error handling when sending an XMPP push notification using go-gcm?", "body": "<p>I would recommend using or implementing a (exponential) backoff. There are a number of options on GitHub here; <a href=\"https://github.com/search?utf8=%E2%9C%93&amp;q=go+backoff\" rel=\"nofollow\">https://github.com/search?utf8=%E2%9C%93&amp;q=go+backoff</a> though that's surely not a comprehensive list and it's not terribly difficult to implement.</p>\n\n<p>The basic idea is you pass the function you'd like to call in to the back off function which calls it until it hits a max failures limit or it succeeds. Between each failure the amount of time waited is increased. If you're hammering a server, causing it to return errors, a method like this will typically solve your problems and make your application more reliable. </p>\n\n<p>Additionally, I'd recommending looking for one that has an abort feature. This can be implemented fairly easily in Go by passing a channel into the backoff function (with the function you want to call). Then if your app needs to stop you can signal on the abort channel so that the back off isn't sitting there with like a 300 second wait.</p>\n\n<p>Even if this doesn't resolve your specific problem it will generally have a positive effect on your apps reliability and 3rd party API's you interact with (don't want to DOS your partners).</p>\n"}], "owner": {"reputation": 326, "user_id": 580712, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07ecbf317b132b08d29afd76e650eb09?s=128&d=identicon&r=PG", "display_name": "Jed Lau", "link": "https://stackoverflow.com/users/580712/jed-lau"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 57, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1467934868, "creation_date": 1467926424, "question_id": 38255469, "link": "https://stackoverflow.com/questions/38255469/proper-error-handling-when-sending-an-xmpp-push-notification-using-go-gcm", "title": "Proper error handling when sending an XMPP push notification using go-gcm?", "body": "<p>I'm using <a href=\"https://github.com/google/go-gcm\" rel=\"nofollow\">https://github.com/google/go-gcm</a> to send push notifications from our Go backend to Android devices. Recently, these push notifications started failing because the call to <code>SendXmpp()</code> was returning with the following error:</p>\n\n<pre><code>write tcp &lt;IP&gt;:&lt;port&gt;-&gt;&lt;IP&gt;:&lt;port&gt;: write: connection timed out\n</code></pre>\n\n<p>Restarting the Go process that called <code>SendXmpp()</code> makes this error go away, and push notifications start working again. But of course, restarting the Go process isn't ideal. Is there something I can do explicitly to handle this kind of error? For instance, should I close the current XmppClient and retry sending the message, so that the retry instantiates a new XmppClient and opens a new connection?</p>\n"}, {"tags": ["go", "fonts", "vips"], "answers": [{"comments": [{"owner": {"reputation": 1022, "user_id": 1241108, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/R81Jx.jpg?s=128&g=1", "display_name": "Junji Zhi", "link": "https://stackoverflow.com/users/1241108/junji-zhi"}, "edited": false, "score": 0, "creation_date": 1468072419, "post_id": 38265938, "comment_id": 63983709, "body": "Thanks for pointing out the env variable. I found this link: <a href=\"http://superuser.com/questions/365847/where-should-the-xdg-config-home-variable-be-defined\" title=\"where should the xdg config home variable be defined\">superuser.com/questions/365847/&hellip;</a>. So the default <code>XDG_CONFIG_HOME</code> value is <code>$HOME&#47;.config</code>, and that&#39;s where I should put the ttf file."}], "tags": [], "owner": {"reputation": 7702, "user_id": 894763, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d013c9681666f0a68a6c1c00ff4d603?s=128&d=identicon&r=PG", "display_name": "jcupitt", "link": "https://stackoverflow.com/users/894763/jcupitt"}, "is_accepted": true, "score": 1, "last_activity_date": 1467978783, "creation_date": 1467978783, "answer_id": 38265938, "question_id": 38254364, "link": "https://stackoverflow.com/questions/38254364/golang-vips-how-to-render-text-with-custom-truetype-font/38265938#38265938", "title": "Golang vips: How to render text with custom truetype font?", "body": "<p>vips uses standard fontconfig font names, so you need to set up fontconfig to add your custom font to its search path.</p>\n\n<p><a href=\"https://www.freedesktop.org/software/fontconfig/fontconfig-user.html\" rel=\"nofollow\">From the manual</a> it looks like you can set the environment variable <code>XDG_CONFIG_HOME</code> to point to your new font, then from go refer to that font as <code>Roboto 48pt</code> (for example).</p>\n\n<p>It's easy to test from the command-line. Try:</p>\n\n<pre><code>$ fc-match \"Roboto\"\nRoboto-Regular.ttf: \"Roboto\" \"Regular\"\n$ vips text x2.png \"hello\" --font \"Roboto 48px\"\n$ vips text x.png \"hello\" --font \"Arial 48px\"\n$ eog x.png x2.png\n</code></pre>\n\n<p>And make sure you see two different images. </p>\n"}], "owner": {"reputation": 1022, "user_id": 1241108, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/R81Jx.jpg?s=128&g=1", "display_name": "Junji Zhi", "link": "https://stackoverflow.com/users/1241108/junji-zhi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 922, "favorite_count": 0, "accepted_answer_id": 38265938, "answer_count": 1, "score": 0, "last_activity_date": 1467978783, "creation_date": 1467921963, "question_id": 38254364, "link": "https://stackoverflow.com/questions/38254364/golang-vips-how-to-render-text-with-custom-truetype-font", "title": "Golang vips: How to render text with custom truetype font?", "body": "<p>When we want to render text an vips image, you do something like this with <a href=\"http://www.vips.ecs.soton.ac.uk/supported/7.42/doc/html/libvips/libvips-create.html#vips-text\" rel=\"nofollow\">vips_text</a>:</p>\n\n<pre><code>    import \"C\"\n    var textImage *C.VipsImage\n    cText := C.CString(\"Some text\")\n    cFont := C.CString(\"Arial 12px\")\n    C.cgo_vips_text(&amp;textImage, cText, cFont)\n</code></pre>\n\n<p>But here, <code>Arial 12px</code> is a fontconfig string name and assumes that the system has this font installed. </p>\n\n<p>How do I let the program use a custom truetype font file, e.g., <code>Roboto.ttf</code>? </p>\n\n<p>Trying </p>\n\n<pre><code>cFont := C.CString(\"Roboto.ttf\")\n</code></pre>\n\n<p>probably won't work.</p>\n\n<p>We could put the <code>Roboto.ttf</code> file in the system directory, for example, in Ubuntu you put the file in <code>/usr/share/fonts/truetype</code>, but the code makes the assumption that this font exists, which is not a solution to write machine-independent program. So I wonder if there is a better way to do this so that we can ship the executables with the font file together.</p>\n"}, {"tags": ["angularjs", "ajax", "go", "websocket"], "comments": [{"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 2, "creation_date": 1467913911, "post_id": 38252015, "comment_id": 63925286, "body": "You have to continue making requests. A webserver cannot just send data to a client unless you have something like a websocket which is constantly open. I would say, what you want to implement is pagenation. In the request, add query parameters for an offset and limit. Have the client iteratively make requests until there is no data left, increasing the offset by the limit for each request. The backend should always return an array, when there is no data at the given offset, the array should be empty which informs the client that it&#39;s done paging over the data."}, {"owner": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1467914019, "post_id": 38252015, "comment_id": 63925337, "body": "You can also use the length of the returned array to know when you&#39;re done. If length &lt; limit then you know you got the remaining results and you can stop making requests."}, {"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 2, "creation_date": 1467914056, "post_id": 38252015, "comment_id": 63925362, "body": "Yeah pagination would be the way to go, else use websockets and broadcast to a room when data is ready. If you want to work with sockets, then have a look at socket.io . Pagination on sockets also seems like an option as you simple use virtual get and post request instead of the actual thing."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "reply_to_user": {"reputation": 38332, "user_id": 763585, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/34f929fab16e27f59c5193f0db678125?s=128&d=identicon&r=PG", "display_name": "evanmcdonnal", "link": "https://stackoverflow.com/users/763585/evanmcdonnal"}, "edited": false, "score": 0, "creation_date": 1467914135, "post_id": 38252015, "comment_id": 63925407, "body": "@evanmcdonnal: downside of using the length is that, in the special case where remaining = limit, you get an array back where length = limit, but the next query (and next page you display) will have zero elements in it.  In this case, your page will think there&#39;s another page worth of results, and thus have a &quot;next&quot; button, but that button will either fail or display a page with no results (depending on how you code it)."}, {"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1467914310, "post_id": 38252015, "comment_id": 63925503, "body": "The way we did it in my last position was return a JSON object with a field that has the list of items, and then fields echoing the limit and offset provided, and lastly a field indicating total results for the query.  This allows a single JSON response to hold all of the data necessary to determine if there&#39;s any results left, and how many pages of them there are if so (and how many pages have been viewed thus far, as well)."}, {"owner": {"reputation": 4593, "user_id": 2821224, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/eaKnm.png?s=128&g=1", "display_name": "9blue", "link": "https://stackoverflow.com/users/2821224/9blue"}, "reply_to_user": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1467914371, "post_id": 38252015, "comment_id": 63925531, "body": "@ishaan The goal of this is to reduce the amount of waiting time for user. Therefore, I need to send partial result before the entire array is available."}, {"owner": {"reputation": 4593, "user_id": 2821224, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/eaKnm.png?s=128&g=1", "display_name": "9blue", "link": "https://stackoverflow.com/users/2821224/9blue"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 0, "creation_date": 1467914538, "post_id": 38252015, "comment_id": 63925644, "body": "@Kaedys when I send out the json, I have no idea what the entire data looks like as the query is still going on."}, {"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1467915189, "post_id": 38252015, "comment_id": 63926050, "body": "When you send the partial json, add an extra object that tells the client it&#39;s still incomplete, so the client waits for the object to complete. Keep pushing to the open websocket till there is no more data and send the complete flag, trigger an event on JS side of things to show the user data, or complete a promise or whatever you&#39;re doing. Socket.io has methods like <code>sockets.io.on(&#39;activity&#39;, callback)</code>, so they may come in handy."}, {"owner": {"reputation": 9768, "user_id": 1380669, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/p3JDz.jpg?s=128&g=1", "display_name": "Plato", "link": "https://stackoverflow.com/users/1380669/plato"}, "edited": false, "score": 0, "creation_date": 1467917327, "post_id": 38252015, "comment_id": 63927314, "body": "you know that &quot;Chunked Transfer Encoding&quot; lets you send the first bit of the response, start processing it at the user agent, and keep sending more pieces later?"}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1467922995, "post_id": 38252015, "comment_id": 63930309, "body": "I routinely upload and download multi-gigabyte requests.  Don&#39;t split it up into multiple http requests if it makes the code significantly more complicated.  You should be streaming data.  This means that you don&#39;t realize huge arrays into memory either for send or receive.  You iterate objects to write the huge list, and parse the huge list (out to disk one by one if necessary).  You can use multipart/form-data to cut it up as well.  If you spread across multiple http requests, then you create a mess that you will need to fix later."}, {"owner": {"reputation": 4593, "user_id": 2821224, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/eaKnm.png?s=128&g=1", "display_name": "9blue", "link": "https://stackoverflow.com/users/2821224/9blue"}, "reply_to_user": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1467957842, "post_id": 38252015, "comment_id": 63939975, "body": "@Rob I need support parse only part of the JSON. Otherwise, the client would still have to wait for the entire response before parsing it."}, {"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1467970914, "post_id": 38252015, "comment_id": 63946685, "body": "that&#39;s a valid strategy.  but it&#39;s one imposed by how you parse it.  if you had a state machine that wrote &#39;[&#39; then a then &#39;,&#39; then b, etc... and finally ends with &#39;]&#39;, you use a small constant amount of memory that is independent of array size.  You can parse this way as well.  This is the difference between a stream parser (ie: event based parse) vs a DOM parse; a common distinction with xml parsing libraries."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6158875, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-QJZBr3MIWzw/AAAAAAAAAAI/AAAAAAAAADI/6lbdrjS3KSc/photo.jpg?sz=128", "display_name": "Patrick Mark Mazo", "link": "https://stackoverflow.com/users/6158875/patrick-mark-mazo"}, "is_accepted": false, "score": 0, "last_activity_date": 1468229166, "creation_date": 1468229166, "answer_id": 38303429, "question_id": 38252015, "link": "https://stackoverflow.com/questions/38252015/golang-one-request-multiple-responses/38303429#38303429", "title": "Golang one request multiple responses", "body": "<p>I am using beego and in the backend part I use []map[string]interface{} data type to handle large data. it response multiple object that can be handle in angular.</p>\n"}], "owner": {"reputation": 4593, "user_id": 2821224, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/eaKnm.png?s=128&g=1", "display_name": "9blue", "link": "https://stackoverflow.com/users/2821224/9blue"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 358, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1468229166, "creation_date": 1467913509, "question_id": 38252015, "link": "https://stackoverflow.com/questions/38252015/golang-one-request-multiple-responses", "title": "Golang one request multiple responses", "body": "<p>I am trying to implement a web server handles a large query. The response of a single request is huge. SO instead of sending the large response all at once, I would like to chop it into many pieces, and sending them individually. For instance, I have an array of elements, instead of sending a response contains the entire array, I would like to send responses contain only single element.</p>\n\n<p>What are my options here? Ajax seems cannot handle this kind of work. Do I have to work with socket, websocket? What about streaming response? </p>\n\n<p>I am using golang + angular, any library or resources recommended?  </p>\n"}, {"tags": ["go", "artifactory"], "answers": [{"comments": [{"owner": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 3, "creation_date": 1467914936, "post_id": 38252350, "comment_id": 63925887, "body": "Alternatively, just use govendor (<a href=\"https://github.com/kardianos/govendor\" rel=\"nofollow noreferrer\">github.com/kardianos/govendor</a>) which does all of that for you without needing to set a custom <code>$GOPATH</code> in your makefile (which breaks casual usages of <code>go build</code> and similar, and frankly, <code>make</code> is slow as hell for things like that).  Govendor will store your deps in <code>&lt;project root&gt;&#47;vendor</code>, which checks them in with your code, allowing reliable builds.  As long as you&#39;re using Go 1.6 (or 1.5 and set the vendoring envvar), you don&#39;t need a custom <code>$GOPATH</code> at all, since the <code>go</code> tool automatically <code>prefers</code> the <code>&#47;vendor</code> folder."}, {"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "reply_to_user": {"reputation": 7358, "user_id": 4551301, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/d1kFH.jpg?s=128&g=1", "display_name": "Kaedys", "link": "https://stackoverflow.com/users/4551301/kaedys"}, "edited": false, "score": 1, "creation_date": 1467915312, "post_id": 38252350, "comment_id": 63926116, "body": "Ahh stackoverflow.. You teach me something new everyday! Thanks, I&#39;ll give that a look."}, {"owner": {"reputation": 21384, "user_id": 402053, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/3d73332968c0bf62e1ece7299deb8b37?s=128&d=identicon&r=PG", "display_name": "JBaruch", "link": "https://stackoverflow.com/users/402053/jbaruch"}, "edited": false, "score": 0, "creation_date": 1467995156, "post_id": 38252350, "comment_id": 63962125, "body": "Don&#39;t don&#39;t don&#39;t check in binary files with your source code into your <b>source</b> control. Don&#39;t."}, {"owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "edited": false, "score": 0, "creation_date": 1468010151, "post_id": 38252350, "comment_id": 63969307, "body": "Never asked to check in binary. Only the source code for dependencies. The build handles binary creation on first run. We add <code>bin&#47;</code> to <code>.gitignore</code>."}], "tags": [], "owner": {"reputation": 1696, "user_id": 2475746, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/aa8e7f7e72a207de4277bf40013eafb6?s=128&d=identicon&r=PG", "display_name": "ishaan", "link": "https://stackoverflow.com/users/2475746/ishaan"}, "is_accepted": false, "score": 1, "last_activity_date": 1467914619, "creation_date": 1467914619, "answer_id": 38252350, "question_id": 38251905, "link": "https://stackoverflow.com/questions/38251905/how-to-store-go-dependencies/38252350#38252350", "title": "How to store go dependencies?", "body": "<p>Okay so GoDeps may be the standard way of doing this, but I usually found it a bit complicated. In my opinion, use a Makefile which sets a custom GoPath and just include dependencies with your code (remove their .git folder). This way the version freezes and no one needs to do a <code>godep restore</code> or something similar. </p>\n\n<p>You can make recipes like <code>make deploy</code> that builds your code, runs GoFmt, cleans the pkg files, installs it to your custom GoPath <code>bin/</code> and then you just go and run the binary.</p>\n\n<p>You can have another one like <code>make install</code> that will install any missing dependencies.</p>\n\n<p>I've managed to create a watch using this on my Makefile to keep on looking for changes on a linux based system using <code>inotify-tools</code> and call rebuild.</p>\n\n<p>Internally all commands will be using standard <code>go</code> commands but you'll get rid of the GoDeps and maintaining JSON. To upgrade a dependency, it may be a bit of a problem as you'd have to manually copy the whole directory into your custom path and remove the .git/ folder.</p>\n\n<p>Our company uses this method and seems to work quite nice for us.</p>\n\n<p>Plus this method basically gets you away the <code>$GOPATH/src/github.com/repoName/</code> kind of paths.</p>\n\n<p>If i seem unclear, let me know, I'll add a gist on github.</p>\n"}], "owner": {"reputation": 4173, "user_id": 3479860, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/07d70ea6b00797e7e17daaa30b1dc363?s=128&d=identicon&r=PG&f=1", "display_name": "Valeriy Solovyov", "link": "https://stackoverflow.com/users/3479860/valeriy-solovyov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1118, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1467914619, "creation_date": 1467913142, "question_id": 38251905, "link": "https://stackoverflow.com/questions/38251905/how-to-store-go-dependencies", "title": "How to store go dependencies?", "body": "<p>I am using <a href=\"https://github.com/tools/godep\" rel=\"nofollow\">GoDep</a> to resolve a project dependencies.\nMy problem is that repositories for dependencies maight be removed and my project wouldn't build.</p>\n\n<p>I am trying to find any solution to store dependencies at Artifactory or another solution.</p>\n\n<p>Please advice.</p>\n\n<p>Regards.</p>\n"}, {"tags": ["go", "types", "casting"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 5, "last_activity_date": 1467912946, "creation_date": 1467912946, "answer_id": 38251854, "question_id": 38251559, "link": "https://stackoverflow.com/questions/38251559/direct-comparison-of-go-interface-to-built-in-types-why-does-this-work/38251854#38251854", "title": "Direct comparison of Go interface{} to built-in types: Why does this work?", "body": "<p>As with most Go language questions, the answer is in the <a href=\"https://golang.org/ref/spec\">Go Programming Language Specification</a>, specifically the section on <a href=\"https://golang.org/ref/spec#Comparison_operators\">Comparison Operators</a>.</p>\n\n<blockquote>\n  <p>A value x of non-interface type X and a value t of interface type T are comparable when values of type X are comparable and X implements T. They are equal if t's dynamic type is identical to X and t's dynamic value is equal to x.</p>\n</blockquote>\n"}], "owner": {"reputation": 1732, "user_id": 1337498, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/FvEma.jpg?s=128&g=1", "display_name": "Hephaestus", "link": "https://stackoverflow.com/users/1337498/hephaestus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 113, "favorite_count": 0, "accepted_answer_id": 38251854, "answer_count": 1, "score": 3, "last_activity_date": 1467912946, "creation_date": 1467911882, "question_id": 38251559, "link": "https://stackoverflow.com/questions/38251559/direct-comparison-of-go-interface-to-built-in-types-why-does-this-work", "title": "Direct comparison of Go interface{} to built-in types: Why does this work?", "body": "<p>Why does the following Go code work? </p>\n\n<p>That is, since the types of <code>f</code> and <code>b</code> are <code>interface{}</code> (and not any of <code>bool</code>, <code>int</code> or <code>string</code>), how is it possible for me to get away with <em>not</em> casting or type-asserting <code>f</code> and <code>b</code> in each of the three <code>if</code> statements?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc foop(p map[string]interface{}) {\n    p[\"foo\"] = true\n}\n\nfunc barp(p map[string]interface{}) {\n    p[\"bar\"] = 17\n}\n\nfunc foop2(p map[string]interface{}) {\n    p[\"foo\"] = \"blah\"\n}\n\nfunc main() {\n    p := make(map[string]interface{})\n    fmt.Printf(\"%v\\n\", p)\n\n    foop(p)\n    barp(p)\n    f := p[\"foo\"]\n    b := p[\"bar\"]\n    fmt.Printf(\"f: %T\\n\", f)\n    if f == true {\n        fmt.Println(\"ok\")\n    }\n    fmt.Printf(\"b: %T\\n\", b)\n    if b == 17 {\n        fmt.Println(\"ok\")\n    }\n\n    foop2(p)\n    f = p[\"foo\"]\n    if f == \"blah\" {\n        fmt.Println(\"ok\")\n    }\n    fmt.Printf(\"f: %T\\n\", f)\n    fmt.Printf(\"f: %s\\n\", reflect.TypeOf(f))\n}\n</code></pre>\n\n<p>(Go Playground: <a href=\"https://play.golang.org/p/kPi25yW6tF\" rel=\"nofollow\">https://play.golang.org/p/kPi25yW6tF</a>)</p>\n"}, {"tags": ["javascript", "go"], "comments": [{"owner": {"reputation": 369690, "user_id": 182668, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b19917aa04a6839aef577f1117c71d48?s=128&d=identicon&r=PG", "display_name": "Pointy", "link": "https://stackoverflow.com/users/182668/pointy"}, "edited": false, "score": 1, "creation_date": 1467910954, "post_id": 38251300, "comment_id": 63923659, "body": "You need commas between the properties."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 369690, "user_id": 182668, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/b19917aa04a6839aef577f1117c71d48?s=128&d=identicon&r=PG", "display_name": "Pointy", "link": "https://stackoverflow.com/users/182668/pointy"}, "edited": false, "score": 1, "creation_date": 1467911969, "post_id": 38251300, "comment_id": 63924238, "body": "I&#39;m with @Pointy on this: the line which constructs your &quot;label: &quot; entries is missing the delimiting comma at its end.  Few more points in no particular oder: 1) some older IE versions might fail on the comma after the final array element; 2) since the object you pass to the Chart ctor is JSON, you might reconsider your approach: serialize this stuff to a JSON string outside your template and then embed that string; 3) next time please take your time and provide an MCVE on <a href=\"http://play.golang.org\" rel=\"nofollow noreferrer\">play.golang.org</a> -- it&#39;s your problem so please help us to help you."}, {"owner": {"reputation": 6770, "user_id": 1170977, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/e4HtP.jpg?s=128&g=1", "display_name": "Arun Ghosh", "link": "https://stackoverflow.com/users/1170977/arun-ghosh"}, "edited": false, "score": 0, "creation_date": 1467912568, "post_id": 38251300, "comment_id": 63924571, "body": "You need to use something like <a href=\"https://github.com/jtblin/angular-chart.js\" rel=\"nofollow noreferrer\">github.com/jtblin/angular-chart.js</a> or <a href=\"https://github.com/carlcraig/tc-angular-chartjs\" rel=\"nofollow noreferrer\">github.com/carlcraig/tc-angular-chartjs</a>"}], "owner": {"reputation": 1, "user_id": 4558341, "user_type": "registered", "profile_image": "https://graph.facebook.com/804195903008806/picture?type=large", "display_name": "Armando Leon", "link": "https://stackoverflow.com/users/4558341/armando-leon"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 96, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1467915446, "creation_date": 1467910842, "last_edit_date": 1467915446, "question_id": 38251300, "link": "https://stackoverflow.com/questions/38251300/templates-and-javascript", "title": "Templates and Javascript", "body": "<p>So, I'm trying to implement CanvasJS into my project. I'm having a hard time trying to get the values from my structs to work in the  tags. It works fine for the HTML code, but I'm not sure how to get it work for the javascript. Is it a different syntax? </p>\n\n<pre><code>&lt;html&gt;\n&lt;head&gt;\n    &lt;title&gt;results&lt;/title&gt;\n            &lt;script src=\"http://canvasjs.com/assets/script/canvasjs.min.js\"&gt;&lt;/script&gt;\n    &lt;script type=\"text/javascript\"&gt;\n\n    window.onload = function () {\n        var chart = new CanvasJS.Chart(\"chartContainer\", {\n            title:{\n                text: \"My First Chart in CanvasJS\"              \n            },\n            data: [              \n            {\n                // Change type to \"doughnut\", \"line\", \"splineArea\", etc.\n                type: \"column\",\n                /*dataPoints: [\n                    { label: \"Time\",  y: 10  },\n                    { label: \"orange\", y: 15  },\n                    { label: \"banana\", y: 25  },\n                    { label: \"mango\",  y: 30  },\n                    { label: \"grape\",  y: 28  }\n                ]*/\n                dataPoints: [\n                    {{range .Pair}}\n                        {label: {{.Time}}, y: {{.Value}}}\n                    {{end}}\n                ]\n            }\n            ]\n        });\n        chart.render();\n    }\n    &lt;/script&gt;\n\n&lt;/head&gt;\n&lt;body&gt;\n    &lt;h1&gt;{{.Id}}&lt;/h1&gt;\n    &lt;ol&gt;\n    {{range .Pair}}\n        &lt;ul&gt;\n            &lt;li&gt;Time: {{.Time}}&lt;/li&gt;\n            &lt;li&gt;Value: {{.Value}}&lt;/li&gt;\n        &lt;/ul&gt;\n        {{end}}\n    &lt;/ol&gt;\n\n    &lt;div id=\"chartContainer\" style=\"height: 300px; width: 100%;\"&gt;&lt;/div&gt;\n\n&lt;/body&gt;\n</code></pre>\n\n<p></p>\n"}, {"tags": ["database", "go", "sqlite"], "comments": [{"owner": {"reputation": 157205, "user_id": 11654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/586424ca0847070dc1868aa58077003e?s=128&d=identicon&r=PG", "display_name": "CL.", "link": "https://stackoverflow.com/users/11654/cl"}, "edited": false, "score": 0, "creation_date": 1467907244, "post_id": 38249969, "comment_id": 63921405, "body": "Are you <i>really</i> sure you&#39;re using the same connection? Try creating a temporary table and see if that one vanishes too."}, {"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "reply_to_user": {"reputation": 157205, "user_id": 11654, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/586424ca0847070dc1868aa58077003e?s=128&d=identicon&r=PG", "display_name": "CL.", "link": "https://stackoverflow.com/users/11654/cl"}, "edited": false, "score": 0, "creation_date": 1467908409, "post_id": 38249969, "comment_id": 63922107, "body": "100% sure, i&#39;ve tried that and it works fine, the problem is only with attached databases, maybe concurrency have something to do with it?"}, {"owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "edited": false, "score": 0, "creation_date": 1467948276, "post_id": 38249969, "comment_id": 63937597, "body": "Can you share the code?"}], "owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 51, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1467906639, "creation_date": 1467906639, "question_id": 38249969, "link": "https://stackoverflow.com/questions/38249969/any-reason-for-database-to-detach-by-it-self-after-attach-in-sqlite3", "title": "Any reason for database to detach by it self after attach in sqlite3?", "body": "<p>I'm using sqlite3 driver for go - <a href=\"http://mattn.github.io/go-sqlite3\" rel=\"nofollow\">http://mattn.github.io/go-sqlite3</a>.</p>\n\n<p>After attaching 3 databases to my original db and making sure i never close one of them,\nI loss the connection for the attached databases in the middle of my go program.\nis there any special reason that can cause that?\nwould appreciate some help.</p>\n"}, {"tags": ["recursion", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1559938259, "last_edit_date": 1559938259, "creation_date": 1467904165, "answer_id": 38249080, "question_id": 38248857, "link": "https://stackoverflow.com/questions/38248857/recursion-function-on-a-struct-in-golang/38249080#38249080", "title": "Recursion function on a struct in Golang", "body": "<p>You just need to step higher and higher in the hierarchy until you reach the root. Assuming <code>Widget.Parent()</code> returns <code>nil</code> if the <code>Widget</code> is the \"root\" (meaning it has no parent):</p>\n\n<h3>Iterative solution</h3>\n\n<p>Here is the solution with a simple <code>for</code> loop:</p>\n\n<pre><code>func (w *Widget) AllParents() []*Widget {\n    var ws []*Widget\n    for parent := w.Parent(); parent != nil; parent = parent.Parent() {\n        ws = append(ws, parent)\n    }\n    return ws\n}\n</code></pre>\n\n<p>This method will return <code>nil</code> if called on the \"root\" (<a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">zero value</a> for all slice types). In other cases, it will return the \"path\" <em>from the direct parent leading to the \"root\"</em>.</p>\n\n<p>Here's a little test program. It creates a root widget with <code>ID = 0</code>, a child with <code>ID = 1</code> and a \"grandchild\" with <code>ID = 2</code>, and prints <code>AllParents()</code> called on each. To implement <code>Widget.Parent()</code>, I used a simple \"widget registry\" map.</p>\n\n<p>Result as expected:</p>\n\n<pre><code>Parents of 0:\nParents of 1: 0\nParents of 2: 1 0\n</code></pre>\n\n<p>Try it on the <a href=\"https://play.golang.org/p/xsFsL3wpDz\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n\n<pre><code>var wreg = map[int64]*Widget{}\n\nfunc (w *Widget) Parent() *Widget {\n    // Returns the widget with an ID of w.ParentID\n    return wreg[w.ParentID]\n}\n\nfunc main() {\n    w := &amp;Widget{0, -1}\n    wreg[w.ID] = w\n    w2 := &amp;Widget{1, 0}\n    wreg[w2.ID] = w2\n    w3 := &amp;Widget{2, 1}\n    wreg[w3.ID] = w3\n\n    printParents(w)\n    printParents(w2)\n    printParents(w3)\n}\n\nfunc printParents(w *Widget) {\n    fmt.Printf(\"Parents of %d:\", w.ID)\n    for _, w := range w.AllParents() {\n        fmt.Print(\" \", w.ID)\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<h3>Recursive solution</h3>\n\n<p>Of course it can be solved using recursion too:</p>\n\n<pre><code>func (w *Widget) AllParents() []*Widget {\n    if parent := w.Parent(); parent == nil {\n        return nil\n    } else {\n        return append(parent.AllParents(), parent)\n    }\n}\n</code></pre>\n\n<p>This solution returns the \"path\" <em>from the root leading to the direct parent</em>.</p>\n\n<p>Running the above test program with this implementation, output is:</p>\n\n<pre><code>Parents of 0:\nParents of 1: 0\nParents of 2: 0 1\n</code></pre>\n\n<p>Try this on the <a href=\"https://play.golang.org/p/1HvPP-ZTLd\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 269, "user_id": 3956916, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/d8cf7cb0fe1b4286665943c2e00f940e?s=128&d=identicon&r=PG&f=1", "display_name": "Bebbs", "link": "https://stackoverflow.com/users/3956916/bebbs"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1597, "favorite_count": 0, "accepted_answer_id": 38249080, "answer_count": 1, "score": 3, "last_activity_date": 1559938259, "creation_date": 1467903617, "question_id": 38248857, "link": "https://stackoverflow.com/questions/38248857/recursion-function-on-a-struct-in-golang", "title": "Recursion function on a struct in Golang", "body": "<p>I have the following code to organise <code>*Widget</code> structs into a hierarchy. <code>Parent()</code> returns the widget with an ID of the caller's parentID. The hierarchy can be up to 4 or 5 levels deep.</p>\n\n<pre><code>type Widget struct {\n  ID int64\n  ParentID int64\n}\n\nfunc (w *Widget) Parent() *Widget {\n  // Returns the widget with an ID of w.ParentID\n}\n</code></pre>\n\n<p>What I want to achieve is a function which aggregates the parent, as well as the parent's parent etc. to the top of the hierarchy, and returns a slice of all of the parent IDs. As I don't know the depth of the hierarchy, I think I need some sort of programmatic recursion to get the parent of each parent, which would do something like the following:</p>\n\n<pre><code>func (w *Widget) AllParents() []*Widget {\n  var parentWidgets []*Widget\n  x := w.Parent()\n  parentWidgets = append(parentWidgets, x)\n  y := x.Parent()\n  parentWidgets = append(parentWidgets, y)\n  ...\n  return parentWidgets\n}\n</code></pre>\n\n<p>Is there a more idiomatic way of achieving this?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1467914237, "post_id": 38248332, "comment_id": 63925472, "body": "You&#39;re using <code>fmt.Scan</code> which scans space separated values. Don&#39;t use that if you don&#39;t want to read each value separately. You can use Scanln to read a line,  or just read directly from stdin."}, {"owner": {"reputation": 137, "user_id": 2976055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/644cb36ab971be9be687b2f79a89eefa?s=128&d=identicon&r=PG", "display_name": "Arthmost", "link": "https://stackoverflow.com/users/2976055/arthmost"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1467918101, "post_id": 38248332, "comment_id": 63927799, "body": "@JimB yeah, realized that. However, Scanln doesn&#39;t work when I try to input a couple of values separated by space. The function then returns a nil error - the same way it behaves if I try to feed cyrillic letters to it."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1467919748, "post_id": 38248332, "comment_id": 63928662, "body": "Scanln still needs the same number of arguments as input on the command line. You&#39;re not seeing any error because you&#39;re checking <code>errs</code> but printing <code>err</code> (always use the same error variable name to avoid this type of bug). You probably don&#39;t want the fmt scanning functionality. Just read from stdin."}, {"owner": {"reputation": 137, "user_id": 2976055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/644cb36ab971be9be687b2f79a89eefa?s=128&d=identicon&r=PG", "display_name": "Arthmost", "link": "https://stackoverflow.com/users/2976055/arthmost"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1468053122, "post_id": 38248332, "comment_id": 63978478, "body": "@JimB Yeah, figured that out about <code>err</code> and <code>errs</code> too. The problem with passing cyrillic symbols still remains though."}], "answers": [{"tags": [], "owner": {"reputation": 137, "user_id": 2976055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/644cb36ab971be9be687b2f79a89eefa?s=128&d=identicon&r=PG", "display_name": "Arthmost", "link": "https://stackoverflow.com/users/2976055/arthmost"}, "is_accepted": true, "score": 0, "last_activity_date": 1468078874, "creation_date": 1468078874, "answer_id": 38283481, "question_id": 38248332, "link": "https://stackoverflow.com/questions/38248332/trouble-programming-a-client-that-allows-sending-text-messages-to-server/38283481#38283481", "title": "Trouble programming a client that allows sending text messages to server", "body": "<p>Question answered by @JimB:</p>\n\n<blockquote>\n  <p>You're using fmt.Scan which scans space separated values. Don't use\n  that if you don't want to read each value separately. You can use\n  Scanln to read a line, or just read directly from stdin.</p>\n</blockquote>\n"}], "owner": {"reputation": 137, "user_id": 2976055, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/644cb36ab971be9be687b2f79a89eefa?s=128&d=identicon&r=PG", "display_name": "Arthmost", "link": "https://stackoverflow.com/users/2976055/arthmost"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 63, "favorite_count": 0, "accepted_answer_id": 38283481, "answer_count": 1, "score": 0, "last_activity_date": 1468078874, "creation_date": 1467902278, "last_edit_date": 1468053180, "question_id": 38248332, "link": "https://stackoverflow.com/questions/38248332/trouble-programming-a-client-that-allows-sending-text-messages-to-server", "title": "Trouble programming a client that allows sending text messages to server", "body": "<p>So I've programmed a server that receives text messages from a connecting client, reverses and capses them and sends them back.</p>\n\n<p>Now I'm trying to program a client so that when I launch it it will keep running until I shut it down (ctrl + c) and allow me to input text lines and send them to the server.</p>\n\n<p>I have a problem though - if I pass a, say, cyrillic symbol to the input, it will return a <code>&lt;nil&gt; &lt;nil&gt;</code> (type, value) error and will remain bugged unless I flush the memory somehow.</p>\n\n<p>I also can't figure how to read the whole message (whole meaning the size of the slice (1024 bytes)) instead of each word separately.</p>\n\n<p>Also, how do I figure out how to delay my 'enter your message' text? Depending on the length of the message I pass on to the server, it should wait longer or shorter. I don't want it popping all over the place if the message is split into a few messages, just once after the answer is received.</p>\n\n<p>Here's the relevant code:</p>\n\n<pre><code>func client() {\n    // connect to the server\n    c, err := net.Dial(\"tcp\", \"127.0.0.1\"+\":\"+port)\n    if err != nil {\n        log.Printf(\"Dial error: %T %+v\", err, err)\n        return\n    }\n\n    // send the message\n    msg := \"\"\n    for {\n    fmt.Print(\"Enter your message:\\n\")\n    _, errs := fmt.Scan(&amp;msg)\n    if errs != nil {\n        log.Printf(\"Scan error: %T %+v\", errs, errs)\n        return\n    }\n    fmt.Println(\"Client sending:\\n\", msg)\n    _, errw := c.Write([]byte(msg))\n    if errw != nil {\n        log.Printf(\"Write error: %T %+v\", errw, errw)\n        return\n    }\n    // handle the response\n    go handleServerResponse(c)\n    time.Sleep(1 * time.Second)\n}\n\nfunc main() {\n    port = \"9999\"\n\n    // launch client\n    done := make(chan bool)\n    go client()\n    &lt;-done // Block forever\n}\n</code></pre>\n\n<p>I've used the empty channel to block the main() from ending.</p>\n\n<p>How should I approach the 2 problems explained above?</p>\n"}, {"tags": ["json", "go"], "answers": [{"tags": [], "owner": {"reputation": 645, "user_id": 983841, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bbe0049baa059b9f3e5be8db1abbeb9?s=128&d=identicon&r=PG", "display_name": "AlexT", "link": "https://stackoverflow.com/users/983841/alext"}, "is_accepted": true, "score": 9, "last_activity_date": 1468495466, "last_edit_date": 1468495466, "creation_date": 1467889716, "answer_id": 38243948, "question_id": 38243731, "link": "https://stackoverflow.com/questions/38243731/complex-json-marshaling-to-golang-objects/38243948#38243948", "title": "Complex JSON marshaling to GoLang objects", "body": "<p>That error happens because some of the values in the JSON aren't strings, but are integers (<code>IPPrefixLen</code> for example), and therefore can't be assigned to a string variable.</p>\n\n<p>There are 2 ways to address this. You could use the <code>interface{}</code> type, so your type definition would become:</p>\n\n<pre><code>NetworkSettings struct {\n    IpAddress string\n    SandboxID string\n    Gateway   string\n    Ports     map[string][]Binding\n    Networks  map[string]map[string]interface{}\n}\n</code></pre>\n\n<p>A better solution would probably be to define a type for the Network block:</p>\n\n<pre><code>type Network struct {\n    NetworkID   string \n    EndpointID  string\n    Gateway     string\n    IPAddress   string\n    IPPrefixLen int\n    //etc...\n}\ntype NetworkSettings struct {\n    IpAddress string\n    SandboxID string\n    Gateway   string\n    Ports     map[string][]Binding\n    Networks  map[string]Network\n}\n</code></pre>\n"}], "owner": {"reputation": 808, "user_id": 2460610, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/c3e8b037262cd812f7f97973a98d1f6f?s=128&d=identicon&r=PG", "display_name": "Luman75", "link": "https://stackoverflow.com/users/2460610/luman75"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 367, "favorite_count": 0, "accepted_answer_id": 38243948, "answer_count": 1, "score": 1, "last_activity_date": 1468495466, "creation_date": 1467889024, "question_id": 38243731, "link": "https://stackoverflow.com/questions/38243731/complex-json-marshaling-to-golang-objects", "title": "Complex JSON marshaling to GoLang objects", "body": "<p>I need to marshal complex JSON object to GO structure. </p>\n\n<p>So I have source:</p>\n\n<pre><code>\"NetworkSettings\": {\n        \"Bridge\": \"\",\n        \"SandboxID\": \"e9736755bc41db307019fde3be0feed51086e6d3e23b0213c59bb5e43f7af214\",\n        \"HairpinMode\": false,\n        \"SecondaryIPAddresses\": null,\n        \"SecondaryIPv6Addresses\": null,\n        \"EndpointID\": \"2ee283787f45894c3383229d29ada1ccbb7f34b1c1e143e417e7ba75b7f5ebce\",\n        \"Gateway\": \"172.17.0.1\",\n        \"IPAddress\": \"172.17.0.2\",\n        \"IPPrefixLen\": 16,\n        \"IPv6Gateway\": \"\",\n        \"MacAddress\": \"02:42:ac:11:00:02\",\n        \"Networks\": {\n            \"bridge\": {\n                \"IPAMConfig\": null,\n                \"Links\": null,\n                \"Aliases\": null,\n                \"NetworkID\": \"1c4788fac19973ddc73975613a2aef5a4cc2be446af458c06fa5fa162e8126ff\",\n                \"EndpointID\": \"2ee283787f45894c3383229d29ada1ccbb7f34b1c1e143e417e7ba75b7f5ebce\",\n                \"Gateway\": \"172.17.0.1\",\n                \"IPAddress\": \"172.17.0.2\",\n                \"IPPrefixLen\": 16,\n                \"IPv6Gateway\": \"\",\n                \"GlobalIPv6Address\": \"\",\n                \"GlobalIPv6PrefixLen\": 0,\n                \"MacAddress\": \"02:42:ac:11:00:02\"\n            }\n        }\n</code></pre>\n\n<p>and I need to map it into object like this:</p>\n\n<pre><code>NetworkSettings struct {\n    IpAddress string\n    SandboxID string\n    Gateway string\n    Ports     map[string][]Binding\n    Networks map[string]map[string]string\n}\n</code></pre>\n\n<p>However because of <code>Networks map[string]map[string]string</code> I'm getting error </p>\n\n<pre><code>json: cannot unmarshal object into Go value of type string\nerror restoring containers: json: cannot unmarshal object into Go value of type string\n</code></pre>\n\n<p>But this is what I need to have a complex map of map structure. </p>\n\n<p>Any idea how to do that?</p>\n"}]