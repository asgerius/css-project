[{"tags": ["go", "tar"], "comments": [{"owner": {"reputation": 3365, "user_id": 1736884, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c85628cff13ad6178dee34c769fa727?s=128&d=identicon&r=PG", "display_name": "Verran", "link": "https://stackoverflow.com/users/1736884/verran"}, "edited": false, "score": 0, "creation_date": 1489017907, "post_id": 42682882, "comment_id": 72492585, "body": "The os.Create function will truncate an existing file, is that not good enough for your use case? Or are you trying to write 2 separate streams to the same file concurrently? If that&#39;s the case you&#39;ll need to split it into 2 separate files and then concat them together at the end."}], "answers": [{"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "edited": false, "score": 0, "creation_date": 1489024544, "post_id": 42684313, "comment_id": 72494361, "body": "Cool yeah that&#39;s what i ended up going with, I didn&#39;t know if I could write the code in a way that it would gracefully overwrite"}], "tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": true, "score": 0, "last_activity_date": 1489017892, "creation_date": 1489017892, "answer_id": 42684313, "question_id": 42682882, "link": "https://stackoverflow.com/questions/42682882/how-to-overwrite-a-file-in-a-tarball/42684313#42684313", "title": "How to overwrite a file in a tarball", "body": "<p>No way as the first file have already been written when you ask to write the second one and the stream has advanced the position. Remember tar files are sequentially accessed.</p>\n\n<p>You should do deduplication before starting to write.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "accepted_answer_id": 42684313, "answer_count": 1, "score": 0, "last_activity_date": 1489017892, "creation_date": 1489011126, "question_id": 42682882, "link": "https://stackoverflow.com/questions/42682882/how-to-overwrite-a-file-in-a-tarball", "title": "How to overwrite a file in a tarball", "body": "<p>I've got an edge case where two files have the same name but different contents and are written to the same tarball. This causes there to be two entries in the tarball. I'm wondering if there's anything I can do to make the tar overwrite the file if it already exists in the tarball as opposed to creating another file with the same name. </p>\n"}, {"tags": ["javascript", "go"], "answers": [{"tags": [], "owner": {"reputation": 6501, "user_id": 859353, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0ee0ed1d5c1b450c2c76651dd62f38c4?s=128&d=identicon&r=PG", "display_name": "jcbwlkr", "link": "https://stackoverflow.com/users/859353/jcbwlkr"}, "is_accepted": true, "score": 2, "last_activity_date": 1489009769, "creation_date": 1489009769, "answer_id": 42682551, "question_id": 42682436, "link": "https://stackoverflow.com/questions/42682436/websocket-connection-failed-error-in-connection-establishment-neterr-ssl-pro/42682551#42682551", "title": "WebSocket connection failed: Error in connection establishment: net::ERR_SSL_PROTOCOL_ERROR", "body": "<p>Your server is only listening for HTTP connections so you should use <code>ws</code> when making a connection. <code>wss</code> is \"WebSocket Secure\" which really just means a WebSocket connection that is served over HTTPS (TLS)</p>\n\n<p>From the <a href=\"https://tools.ietf.org/html/rfc6455#page-55\" rel=\"nofollow noreferrer\">RFC 6455</a></p>\n\n<pre><code>A |wss| URI identifies a WebSocket server and resource name and\nindicates that traffic over that connection is to be protected via\nTLS (including standard benefits of TLS such as data confidentiality\nand integrity and endpoint authentication).\n</code></pre>\n"}], "owner": {"reputation": 24613, "user_id": 555222, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/dcd4c7151c0b298d4fb46001df735f6b?s=128&d=identicon&r=PG", "display_name": "clarkk", "link": "https://stackoverflow.com/users/555222/clarkk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8433, "favorite_count": 1, "accepted_answer_id": 42682551, "answer_count": 1, "score": 3, "last_activity_date": 1489009769, "creation_date": 1489009298, "question_id": 42682436, "link": "https://stackoverflow.com/questions/42682436/websocket-connection-failed-error-in-connection-establishment-neterr-ssl-pro", "title": "WebSocket connection failed: Error in connection establishment: net::ERR_SSL_PROTOCOL_ERROR", "body": "<p>Why do I get this error when trying to connect to a websocket via <code>wss://</code> but seems to work fine with <code>ws://</code>?</p>\n\n<h1>error</h1>\n\n<pre><code>WebSocket connection failed: Error in connection establishment: net::ERR_SSL_PROTOCOL_ERROR\n</code></pre>\n\n<h1>code</h1>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    //\"encoding/json\"\n    \"github.com/gorilla/websocket\"\n)\n\nvar clients map[*websocket.Conn]*Client\n\nvar upgrader = websocket.Upgrader{\n    CheckOrigin : func(r *http.Request) bool{\n        return true\n    },\n}\n\ntype Client struct{\n    session_id  string\n    block_id    uint\n    module      string\n}\n\nfunc main(){\n    var port uint = 8000\n\n    http.HandleFunc(\"/\", handleConnections)\n\n    log.Printf(\"Websocket server started on: %d\", port)\n    err := http.ListenAndServe(fmt.Sprintf(\":%d\", port), nil)\n    if err != nil {\n        log.Fatal(\"ListenAndServe: \", err)\n    }\n}\n\nfunc handleConnections(w http.ResponseWriter, r *http.Request){\n    //  Upgrade initial GET request to a websocket\n    ws, err := upgrader.Upgrade(w, r, nil)\n    if err != nil {\n        log.Print(err)\n\n        return\n    }\n\n    defer ws.Close()\n\n    log.Print(\"Connection established to IP: \", r.RemoteAddr)\n\n    ...\n}\n</code></pre>\n"}, {"tags": ["go", "amazon-s3"], "comments": [{"owner": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 2, "creation_date": 1489024462, "post_id": 42681181, "comment_id": 72494337, "body": "S3 does not support append.  Even the S3Manager that gets around the 5GB per chunk limit by putting up a bunch of chunk and appending them (behind the scenes) into one big file doesn&#39;t give the capability.  It may be the case that the file basically does not really exist at all until the last byte has been sent and the file handle is closed."}, {"owner": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1489033822, "post_id": 42681181, "comment_id": 72496890, "body": "Have you checked the official aws documentation? <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api</a> and more specifically the S3 documentation  <a href=\"https://docs.aws.amazon.com/sdk-for-go/api/service/s3/\" rel=\"nofollow noreferrer\">docs.aws.amazon.com/sdk-for-go/api/service/s3</a>"}, {"owner": {"reputation": 1202, "user_id": 4934991, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/vgQkb.jpg?s=128&g=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4934991/morgan"}, "reply_to_user": {"reputation": 1227, "user_id": 418772, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/812e307892de3240c2b50a3e66295f84?s=128&d=identicon&r=PG", "display_name": "Rob", "link": "https://stackoverflow.com/users/418772/rob"}, "edited": false, "score": 0, "creation_date": 1489034237, "post_id": 42681181, "comment_id": 72497013, "body": "@Rob somehow it&#39;s doing the streaming thing in PHP though, so I&#39;m confused..."}, {"owner": {"reputation": 1202, "user_id": 4934991, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/vgQkb.jpg?s=128&g=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4934991/morgan"}, "reply_to_user": {"reputation": 3174, "user_id": 4639336, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/GvbJg.png?s=128&g=1", "display_name": "reticentroot", "link": "https://stackoverflow.com/users/4639336/reticentroot"}, "edited": false, "score": 0, "creation_date": 1489034267, "post_id": 42681181, "comment_id": 72497021, "body": "@reticentroot yeah, I&#39;ve combed through the docs but I can&#39;t find any streamer wrapper or anything that would return a file pointer"}], "answers": [{"comments": [{"owner": {"reputation": 1202, "user_id": 4934991, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/vgQkb.jpg?s=128&g=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4934991/morgan"}, "edited": false, "score": 0, "creation_date": 1489456904, "post_id": 42699144, "comment_id": 72668124, "body": "I still haven&#39;t found an equivilent to PHP so, yeah, I just basically did what @BayRinat suggested and downloaded the file with GetObjectInput, parsed the contents and appended a new log message, converted it to bytes, then used PutObject to replace it on S3."}, {"owner": {"reputation": 331, "user_id": 1168026, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/998224c50a66e0b4de44feeb0aceb4eb?s=128&d=identicon&r=PG", "display_name": "ChristoKiwi", "link": "https://stackoverflow.com/users/1168026/christokiwi"}, "edited": false, "score": 0, "creation_date": 1566524686, "post_id": 42699144, "comment_id": 101692323, "body": "Is this limitation still in place? Append is important, especially if the file is very large."}], "tags": [], "owner": {"reputation": 1124, "user_id": 3805062, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nIUyW.jpg?s=128&g=1", "display_name": "bayrinat", "link": "https://stackoverflow.com/users/3805062/bayrinat"}, "is_accepted": false, "score": 2, "last_activity_date": 1567566708, "last_edit_date": 1567566708, "creation_date": 1489073069, "answer_id": 42699144, "question_id": 42681181, "link": "https://stackoverflow.com/questions/42681181/write-append-to-s3-bucket-in-golang/42699144#42699144", "title": "Write/Append to S3 bucket in Golang", "body": "<p>As @Rob mentioned, S3 doesn't support append operation <a href=\"https://forums.aws.amazon.com/message.jspa?messageID=540395\" rel=\"nofollow noreferrer\">https://forums.aws.amazon.com/message.jspa?messageID=540395</a>.</p>\n\n<p>The only way is download object and upload the new one using aws-sdk or minio (<a href=\"https://github.com/minio/minio\" rel=\"nofollow noreferrer\">https://github.com/minio/minio</a>). I suppose, PHP wrapper make the same under the hood. </p>\n\n<p>The sample with minio:</p>\n\n<pre><code>s3Client, err := minio.New(\"s3.amazonaws.com\", \"YOUR-ACCESS-KEY-HERE\", \"YOUR-SECRET-KEY-HERE\", true)\nif err != nil {\n    log.Fatalln(err)\n}\n\nreader, err := s3Client.GetObject(\"my-bucketname\", \"my-objectname\")\nif err != nil {\n    log.Fatalln(err)\n}\ndefer reader.Close()\n\n// Change your data\n\nn, err := s3Client.PutObject(\"my-bucketname\", \"my-objectname\", reader, \"application/octet-stream\")\nif err != nil {\n    log.Fatalln(err)\n}\n</code></pre>\n"}], "owner": {"reputation": 1202, "user_id": 4934991, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/vgQkb.jpg?s=128&g=1", "display_name": "Morgan", "link": "https://stackoverflow.com/users/4934991/morgan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2944, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1567566708, "creation_date": 1489004431, "question_id": 42681181, "link": "https://stackoverflow.com/questions/42681181/write-append-to-s3-bucket-in-golang", "title": "Write/Append to S3 bucket in Golang", "body": "<p>The application I'm working on currently uses the Amazon S3 Stream Wrapper for PHP in order to write log messages to an S3 bucket and I need to port it over to Golang. Is there an equivilent to this in Go? The <code>PutObject</code> method overwrites all the contents and I want to just append. In PHP we are using <code>fopen()</code> and <code>fwrite()</code> to append a string to an existing bucket. I was hoping I could just do </p>\n\n<pre><code>os.OpenFile(filename, os.O_APPEND|os.O_WRONLY, 0600) \n</code></pre>\n\n<p>but I get an error saying the file doesn't exist. I tried using both <code>s3://</code> and the <code>https://</code> link to the log file.</p>\n\n<p>Here's the Amazon example for PHP:</p>\n\n<pre><code>$stream = fopen('s3://bucket/key', 'w');\nfwrite($stream, 'Hello!');\nfclose($stream);\n</code></pre>\n"}, {"tags": ["object", "go"], "comments": [{"owner": {"reputation": 484, "user_id": 6421681, "user_type": "registered", "accept_rate": 100, "profile_image": "https://lh3.googleusercontent.com/-gZN1tFHAS_0/AAAAAAAAAAI/AAAAAAAAAGo/c8XZSrjQuEM/photo.jpg?sz=128", "display_name": "Yolo Voe", "link": "https://stackoverflow.com/users/6421681/yolo-voe"}, "edited": false, "score": 0, "creation_date": 1531014700, "post_id": 42680916, "comment_id": 89436398, "body": "I don&#39;t know why this question was downvoted so going to vote it up"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1489004529, "last_edit_date": 1489004529, "creation_date": 1489004201, "answer_id": 42681110, "question_id": 42680916, "link": "https://stackoverflow.com/questions/42680916/declaring-generic-type-object-in-go/42681110#42681110", "title": "declaring generic type object in go", "body": "<p>All Go types implement the empty interface <code>interface{}</code>.</p>\n\n<pre><code>type Foo struct {\n   data interface{}\n}\n</code></pre>\n\n<p>The empty interface is covered in  <a href=\"https://tour.golang.org/methods/14\" rel=\"noreferrer\">A Tour of Go</a>, <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"noreferrer\">The Laws of Reflection</a> and the <a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"noreferrer\">specification</a>.</p>\n"}], "owner": {"reputation": 5814, "user_id": 2727195, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/5f7f938a39627be91557a2844664dd3e?s=128&d=identicon&r=PG&f=1", "display_name": "user2727195", "link": "https://stackoverflow.com/users/2727195/user2727195"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 7209, "favorite_count": 1, "accepted_answer_id": 42681110, "answer_count": 1, "score": 8, "last_activity_date": 1489004529, "creation_date": 1489003524, "question_id": 42680916, "link": "https://stackoverflow.com/questions/42680916/declaring-generic-type-object-in-go", "title": "declaring generic type object in go", "body": "<p>Is there a generic type <code>Object</code> in golang similar to other languages that can be assigned any kind of payload?</p>\n\n<pre><code>type Foo struct {\n    data object\n}\n</code></pre>\n"}, {"tags": ["csv", "go"], "answers": [{"tags": [], "owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "is_accepted": true, "score": 1, "last_activity_date": 1489017936, "creation_date": 1489017936, "answer_id": 42684321, "question_id": 42680728, "link": "https://stackoverflow.com/questions/42680728/csv-empty-when-trying-to-read-it/42684321#42684321", "title": "Csv empty when trying to read it", "body": "<p>Your main problem is you're not checking errors, at least in the example you're not. If you check the error returned from reader.Read() you would know that it is <a href=\"https://golang.org/pkg/encoding/csv/#pkg-variables\" rel=\"nofollow noreferrer\">ErrBareQuote</a>, to avoid that error you have to set the <a href=\"https://golang.org/pkg/encoding/csv/#Reader\" rel=\"nofollow noreferrer\">csv.Reader</a>'s LazyQuotes field to true. Here's a working version of your code <a href=\"https://play.golang.org/p/3y-T1DCsp6\" rel=\"nofollow noreferrer\">https://play.golang.org/p/3y-T1DCsp6</a></p>\n"}], "owner": {"reputation": 502, "user_id": 462794, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/590ab8e31e515d6d8666c8b81f3a1317?s=128&d=identicon&r=PG", "display_name": "Bussiere", "link": "https://stackoverflow.com/users/462794/bussiere"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 199, "favorite_count": 0, "accepted_answer_id": 42684321, "answer_count": 1, "score": -5, "last_activity_date": 1489017936, "creation_date": 1489002791, "last_edit_date": 1489014078, "question_id": 42680728, "link": "https://stackoverflow.com/questions/42680728/csv-empty-when-trying-to-read-it", "title": "Csv empty when trying to read it", "body": "<p>Here is my code : </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n    \"encoding/csv\"\n)\n\n\n\n\nfunc main() {\n\n    if len(os.Args) &lt; 2 {\n        fmt.Printf(\"Error: Source file name is required\\n\")\n        fmt.Println(\"Usage:\", os.Args[0], \"&lt;filename&gt; \\n\")\n        return\n    }\n\n    file, err := os.Open(os.Args[1])\n    if err != nil {\n        fmt.Println(\"Error:\", err)\n        return\n    }\n    // deferred call to Close() at the end of current method\n    defer file.Close()\n    //get a new cvsReader for reading file\n    reader := csv.NewReader(file)\n    //Configure reader options Ref http://golang.org/src/pkg/encoding/csv/reader.go?s=#L81\n    reader.Comma = '|'\n    reader.Comment = '#'        //Comment character\n    reader.FieldsPerRecord = -1 //Number of records per record. Set to Negative value for variable\n    reader.TrimLeadingSpace = true\n\n    record, err := reader.Read()\n    fmt.Println(record)\n    result, _ := reader.ReadAll()\n    fmt.Println(result)\n    for i := range result {\n        // Element count.\n        fmt.Printf(\"Elements: %v\", len(result[i]))\n        fmt.Println()\n        // Elements.\n        fmt.Println(result[i])\n    }\n\n}\n</code></pre>\n\n<p>And the csv is like this :</p>\n\n<pre><code>&lt;iframe src=\"http://www.testdata.com/embed/ph5721952ef0c4e\" frameborder=\"0\" height=\"481\" width=\"608\" scrolling=\"no\"&gt;&lt;/iframe&gt;|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)1.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)2.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)3.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)4.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)5.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)6.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)7.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)8.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)9.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)10.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)11.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)12.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)13.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)15.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)16.jpg| it's done|allhomedata;hardware;wf;couple;ITwjob;dsshot;small-tera;forceager;wf;tamed-cat;bg-wf-chicken;cowanimal;tracy-rod;tamed;ds-on-table|wf;dsshots;Hardware;force||976|51703|122|40\n&lt;iframe src=\"http://www.testdata.com/embed/ph5721952ef0c4e\" frameborder=\"0\" height=\"481\" width=\"608\" scrolling=\"no\"&gt;&lt;/iframe&gt;|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)1.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)2.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)3.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)4.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)5.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)6.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)7.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)8.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)9.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)10.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)11.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)12.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)13.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)15.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)16.jpg| it's done|allhomedata;hardware;wf;couple;ITwjob;dsshot;small-tera;forceager;wf;tamed-cat;bg-wf-chicken;cowanimal;tracy-rod;tamed;ds-on-table|wf;dsshots;Hardware;force||976|51703|122|40\n&lt;iframe src=\"http://www.testdata.com/embed/ph5721952ef0c4e\" frameborder=\"0\" height=\"481\" width=\"608\" scrolling=\"no\"&gt;&lt;/iframe&gt;|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)1.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)2.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)3.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)4.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)5.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)6.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)7.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)8.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)9.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)10.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)11.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)12.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)13.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)15.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)16.jpg| it's done|allhomedata;hardware;wf;couple;ITwjob;dsshot;small-tera;forceager;wf;tamed-cat;bg-wf-chicken;cowanimal;tracy-rod;tamed;ds-on-table|wf;dsshots;Hardware;force||976|51703|122|40\n&lt;iframe src=\"http://www.testdata.com/embed/ph5721952ef0c4e\" frameborder=\"0\" height=\"481\" width=\"608\" scrolling=\"no\"&gt;&lt;/iframe&gt;|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg|http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)1.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)2.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)3.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)4.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)5.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)6.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)7.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)8.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)9.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)10.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)11.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)12.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)13.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)14.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)15.jpg;http://i0.cdn2b.image.testdata.zhncdn.com/videos/201604/28/75158391/original/(m=eaf88daaaa)16.jpg| it's done|allhomedata;hardware;wf;couple;ITwjob;dsshot;small-tera;forceager;wf;tamed-cat;bg-wf-chicken;cowanimal;tracy-rod;tamed;ds-on-table|wf;dsshots;Hardware;force||976|51703|122|40\n</code></pre>\n\n<p>but the output is like :\n    []\n    []</p>\n\n<p>i don't understand why the [] appear ....\nIf anyone have any idea why the file reading appears to be empty.</p>\n\n<p>Seems that the reading process seems to be broken.</p>\n\n<p>thanks and regards</p>\n"}, {"tags": ["http", "go", "server"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488999461, "post_id": 42679436, "comment_id": 72483562, "body": "&quot;I [...] can&#39;t contact the server&quot; is not a helpful description of what actual problem you are facing. BTW: capturing and handling the error from http.Get would be informative here."}], "answers": [{"comments": [{"owner": {"reputation": 171, "user_id": 5174549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/264a9afde845d5130e4470b0241bd57d?s=128&d=identicon&r=PG&f=1", "display_name": "agent47", "link": "https://stackoverflow.com/users/5174549/agent47"}, "edited": false, "score": 0, "creation_date": 1538771328, "post_id": 42679656, "comment_id": 92275479, "body": "hey, say if i dont want to use <code>err</code> in my code how can i replace <code>resp, err := http.Get(&quot;http:&#47;&#47;127.0.0.1:8080&#47;join&quot;)</code> with something like <code>response_struct := http.Get(&quot;http:&#47;&#47;127.0.0.1:8080&#47;join&quot;)</code> ?"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1488999442, "creation_date": 1488999442, "answer_id": 42679656, "question_id": 42679436, "link": "https://stackoverflow.com/questions/42679436/golang-http-get/42679656#42679656", "title": "Golang http.Get()", "body": "<p>Try <code>http.Get(\"http://127.0.0.1:8080/join\")</code>. Note the \"http:\".  Also, check the error. It will tell you what the problem is.</p>\n\n<pre><code>resp, err := http.Get(\"http://127.0.0.1:8080/join\")\nif err != nil {\n  log.Fatal(err)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 593, "user_id": 8960344, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d6a4695a4739b1539ab219c4d10459c7?s=128&d=identicon&r=PG", "display_name": "Nima Ghotbi", "link": "https://stackoverflow.com/users/8960344/nima-ghotbi"}, "is_accepted": false, "score": 1, "last_activity_date": 1488999650, "creation_date": 1488999650, "answer_id": 42679730, "question_id": 42679436, "link": "https://stackoverflow.com/questions/42679436/golang-http-get/42679730#42679730", "title": "Golang http.Get()", "body": "<p>You have't specified the scheme, try <code>http.Get(\"http://127.0.0.1:8080/join\")</code></p>\n\n<p><code>http.Get</code> like many other go functions return the error so if you have written your code you like:</p>\n\n<pre><code>_, err := http.Get(\"127.0.0.1:8080/join\")\nif err != nil{\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>you would have seen:</p>\n\n<pre><code>Get 127.0.0.1:8080/join: unsupported protocol scheme \"\"\n</code></pre>\n"}], "owner": {"reputation": 1917, "user_id": 3158028, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea4a357ca24f6f6b54ee9bc5061aef40?s=128&d=identicon&r=PG&f=1", "display_name": "Soubriquet", "link": "https://stackoverflow.com/users/3158028/soubriquet"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3811, "favorite_count": 0, "accepted_answer_id": 42679656, "answer_count": 2, "score": -1, "last_activity_date": 1488999650, "creation_date": 1488998648, "question_id": 42679436, "link": "https://stackoverflow.com/questions/42679436/golang-http-get", "title": "Golang http.Get()", "body": "<p>I'm trying to write a basic http server example. I can curl <code>localhost:8080</code>, but can't contact the server with <code>http.Get(\"127.0.0.1:8080\")</code> from the client script. What am I doing wrong?</p>\n\n<p>server.go:</p>\n\n<pre><code>import \"fmt\"\nimport \"net/http\"\n\nfunc join(w http.ResponseWriter, req *http.Request) {\n    fmt.Println(\"Someone joined\")\n}\n\nfunc main() {\n    fmt.Println(\"Listening on port 8080...\")\n    http.HandleFunc(\"/join\", join)\n    http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p>client.go:</p>\n\n<pre><code>import \"net/http\"\nhttp.Get(\"127.0.0.1:8080/join\")\n</code></pre>\n"}, {"tags": ["go", "flatbuffers"], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 7679374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8433a8a1e0016fe81314630947f6146?s=128&d=identicon&r=PG&f=1", "display_name": "tommy", "link": "https://stackoverflow.com/users/7679374/tommy"}, "edited": false, "score": 0, "creation_date": 1489091948, "post_id": 42682559, "comment_id": 72531846, "body": "if the annlist is large, say 20, I am not sure how can I build all announcements before creating a vector, so I tried creating builder1 to see if that works. Could you please suggest me on how I can build all announcements and create a vector?"}, {"owner": {"reputation": 4578, "user_id": 17419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JU9iE.jpg?s=128&g=1", "display_name": "Aardappel", "link": "https://stackoverflow.com/users/17419/aardappel"}, "reply_to_user": {"reputation": 1, "user_id": 7679374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8433a8a1e0016fe81314630947f6146?s=128&d=identicon&r=PG&f=1", "display_name": "tommy", "link": "https://stackoverflow.com/users/7679374/tommy"}, "edited": false, "score": 0, "creation_date": 1489103640, "post_id": 42682559, "comment_id": 72537240, "body": "The size of the vector should not matter. Build any number of announcements into the builder, and collect their offsets in a temporary vector of the same size. Then create a FlatBuffers vector from that in the same builder, followed by the root table (that refers to the vector)."}, {"owner": {"reputation": 1, "user_id": 7679374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8433a8a1e0016fe81314630947f6146?s=128&d=identicon&r=PG&f=1", "display_name": "tommy", "link": "https://stackoverflow.com/users/7679374/tommy"}, "edited": false, "score": 0, "creation_date": 1489156205, "post_id": 42682559, "comment_id": 72561379, "body": "I updated the code as you suggested and schema file in my question. Definitely I am getting a larger flatbuffer with this code after the changes based on your suggestion, however I am still not getting my data back from the buffer. Thanks for answering my questions."}], "tags": [], "owner": {"reputation": 4578, "user_id": 17419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/JU9iE.jpg?s=128&g=1", "display_name": "Aardappel", "link": "https://stackoverflow.com/users/17419/aardappel"}, "is_accepted": false, "score": 0, "last_activity_date": 1489009800, "creation_date": 1489009800, "answer_id": 42682559, "question_id": 42677690, "link": "https://stackoverflow.com/questions/42677690/flatbuffers-golang-unable-to-understand-my-mistake-while-serializing-and-deseri/42682559#42682559", "title": "Flatbuffers GoLang- Unable to understand my mistake while serializing and deserializing data resulting in not able to retrieve the data", "body": "<p>Not sure why you're using two builders. Each builder is creating one FlatBuffer, so things you store in one won't be available in the other.</p>\n\n<p>A smaller problem is that you are nesting things (the Go implementation should guard against that, I believe?), i.e. you should finish building all announcements before you create a vector of them.. in your case this will all be mixed up.</p>\n\n<p>You also appear to make your root an <code>AnnouncementList</code>, but then you try to access it as an <code>Announcement</code>.. this won't work. It be easier to see if we could see your schema.</p>\n"}], "owner": {"reputation": 1, "user_id": 7679374, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e8433a8a1e0016fe81314630947f6146?s=128&d=identicon&r=PG&f=1", "display_name": "tommy", "link": "https://stackoverflow.com/users/7679374/tommy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 372, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1489158516, "creation_date": 1488993316, "last_edit_date": 1489158516, "question_id": 42677690, "link": "https://stackoverflow.com/questions/42677690/flatbuffers-golang-unable-to-understand-my-mistake-while-serializing-and-deseri", "title": "Flatbuffers GoLang- Unable to understand my mistake while serializing and deserializing data resulting in not able to retrieve the data", "body": "<p>I am new to Flatbuffers and GoLang. I am trying to implement a function that take converts an object to flatbuffer and retrieves the same object. Here is my code.\n<strong>Updated Code</strong></p>\n\n<pre><code>func getannouncements(){\n    annList := SR.GetFromDB().GetAllAnnouncementList()\n    fmt.Println(annList)\n    builder := flatbuffers.NewBuilder(1024)\n    var thisobjlist [12] flatbuffers.UOffsetT\n    for i,j := range annList{\n        annTitle := builder.CreateString(j.AnnTitle)\n        annText := builder.CreateString(j.AnnText)\n        annDate := builder.CreateString(j.AnnDate)\n        fb.AnnouncementStart(builder)\n        fb.AnnouncementAddAnnId(builder,int32(j.AnnID))\n        fb.AnnouncementAddAnnTitle(builder,annTitle)\n        fb.AnnouncementAddAnnText(builder, annText)\n        fb.AnnouncementAddAnnActive(builder,CR.BoolToByte(j.AnnActive))\n        fb.AnnouncementAddAnnDate(builder,annDate)\n        thisobj:= fb.AnnouncementEnd(builder)\n        thisobjlist[i] = thisobj\n    }\n    fb.AnnouncementListStartAnnListVector(builder,len(annList))\n    for _,j:=range thisobjlist{\n        builder.PlaceUOffsetT(j)\n    }\n    finalObj := fb.AnnouncementListEnd(builder)\n    builder.Finish(finalObj)\n    buf:= builder.FinishedBytes()\n    fmt.Println(buf)\n    /*bufItem := new(bytes.Buffer)\n    binary.Write(bufItem, binary.LittleEndian, buf)\n    buf1 := bufItem.Bytes()\n    buffyRead := bytes.NewReader(buf1)\n    var buffy []byte\n    binary.Read(buffyRead, binary.LittleEndian, &amp;buffy)*/\n    Anncmt:=  fb.GetRootAsAnnouncementList(buf,0)\n    anns := new(fb.Announcement)\n    if Anncmt.AnnList(anns,1){\n        thisLists := anns.AnnTitle()\n        fmt.Println(thisLists)\n    }\n    fmt.Println(Anncmt)\n  }\n</code></pre>\n\n<p><strong>Schema File</strong></p>\n\n<pre><code>namespace FlatBufs;\ntable Announcement{\n    AnnId:int;\n    AnnTitle:string;\n    AnnText:string;\n    AnnDate:string;\n    AnnActive:bool= false;\n}\n\ntable AnnouncementList{\n   AnnName:string;\n   AnnList:[Announcement];\n}\nroot_type AnnouncementList\n</code></pre>\n\n<p>The buf object is a byte array. However when I am generating the AnnGot obj I am still getting the almost same byte array as buf. So, When I read various posts on internet on this topic, I tried to convert that buf to binary type and then retrieve buf and tried to retrieve the data (as in the commented part of code). This time the object buffy doesn't have any data in it. I am still not clear what mistake I am making in this entire code. </p>\n\n<p>Please point me in the right direction. Any help on this is much appreciated.</p>\n\n<p>Thanks,\nTom</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 230, "user_id": 4912384, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/227f1ec3e97095379d734632cce62d92?s=128&d=identicon&r=PG&f=1", "display_name": "MrBouh", "link": "https://stackoverflow.com/users/4912384/mrbouh"}, "edited": false, "score": 0, "creation_date": 1489056080, "post_id": 42677463, "comment_id": 72508564, "body": "thanks a lot, seems like I should go take a better look at reflect and json contents!"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 1, "last_activity_date": 1488992624, "creation_date": 1488992624, "answer_id": 42677463, "question_id": 42677310, "link": "https://stackoverflow.com/questions/42677310/golang-unmarshall-struct-in-function-that-do-not-know-the-type-and-rely-on-inter/42677463#42677463", "title": "golang Unmarshall Struct In Function that do not know the type and rely on interface", "body": "<p>Use <a href=\"http://godoc.org/reflect#New\" rel=\"nofollow noreferrer\">reflect.New</a> to create a pointer to a value with the same type as the reference type.</p>\n\n<pre><code>func createHandlerToTestDelete(route string, ref interface{}) {\n  t := reflect.TypeOf(ref)\n  ServeMux.HandleFunc(route,\n    func(w http.ResponseWriter, r *http.Request) {\n        v := reflect.New(t)\n        if err := json.NewDecoder(r.Body).Decode(v.Interface()); err != nil {\n            // handle error\n        }\n        // v is pointer to value. Get element for correct comparison.\n        if reflect.DeepEqual(v.Elem().Interface(), ref) {\n            w.WriteHeader(http.StatusOK)\n        } else {\n            w.WriteHeader(http.StatusInternalServerError)\n        }\n    },\n  )\n}\n</code></pre>\n"}], "owner": {"reputation": 230, "user_id": 4912384, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/227f1ec3e97095379d734632cce62d92?s=128&d=identicon&r=PG&f=1", "display_name": "MrBouh", "link": "https://stackoverflow.com/users/4912384/mrbouh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 42677463, "answer_count": 1, "score": 0, "last_activity_date": 1488992624, "creation_date": 1488992188, "question_id": 42677310, "link": "https://stackoverflow.com/questions/42677310/golang-unmarshall-struct-in-function-that-do-not-know-the-type-and-rely-on-inter", "title": "golang Unmarshall Struct In Function that do not know the type and rely on interface", "body": "<p>here is what I need to do and can't find the resource I need in order to do it:</p>\n\n<p>I need to write a generic function that will setup a handler for a MOCK server. This handler will receive a JSON object and have to unMarshall it and compare it to a reference structure and set its status accordingly depending on the correspondence between both object.\nHere is the trick: we do not know inside the function what is the type of the reference.</p>\n\n<p>&lt;===== Where am I at this point ====>\nI wrote this function, which doesn't work.</p>\n\n<pre><code>func createHandlerToTestDelete(route string, ref interface{}, received interface{}){\n    Servmux.HandleFunc(route,\n        func(w http.ResponseWriter, r *http.Request) {\n            // recreate a structure from body content\n            body, _ := ioutil.ReadAll(r.Body)\n            json.Unmarshal(body, &amp;received)\n\n            // comparison between ref and received\n            if reflect.DeepEqual(received, ref) {\n                w.WriteHeader(http.StatusOK)\n            } else {\n                w.WriteHeader(http.StatusInternalServerError)\n            }\n        },\n    )\n}\n</code></pre>\n\n<p>here is how I am using it:</p>\n\n<pre><code>ref := MyStruct{...NotEmpty...}\nreceived := MyStruct{}\ncreateHandlerToTestDelete(\"aRoute\", ref, received)\n</code></pre>\n\n<p>The result is that the server when doing Unmarshal will not care of the original type of the received variable.</p>\n\n<p>Does someone has an idea?</p>\n"}, {"tags": ["image-processing", "go", "convolution"], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1488994105, "last_edit_date": 1488994105, "creation_date": 1488993319, "answer_id": 42677692, "question_id": 42677196, "link": "https://stackoverflow.com/questions/42677196/convolution-in-golang/42677692#42677692", "title": "Convolution in Golang", "body": "<p><code>r</code>, <code>g</code>, and <code>b</code> are <code>uint32</code> values, and they contain 16bits of color information which is always greater than 255 if started as a non-zero 8 bit value. </p>\n\n<p>You then can't operate on the RGBA values and truncate them to a <code>uint8</code>; that gives you a useless result because the least significant bits are just fractional parts of the 8bit values. </p>\n\n<p>Compare the candidate integer value with the max 16bit value 65535, and shift it 8 bits before truncating it to get the 8 most significant bits. </p>\n\n<pre><code>uint8(min(sumR/9, 0xffff) &gt;&gt; 8),\nuint8(min(sumG/9, 0xffff) &gt;&gt; 8),\nuint8(min(sumB/9, 0xffff) &gt;&gt; 8),\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 6461660, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/9gYUE.jpg?s=128&g=1", "display_name": "Oneill", "link": "https://stackoverflow.com/users/6461660/oneill"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 926, "favorite_count": 0, "accepted_answer_id": 42677692, "answer_count": 1, "score": 0, "last_activity_date": 1488994105, "creation_date": 1488991852, "question_id": 42677196, "link": "https://stackoverflow.com/questions/42677196/convolution-in-golang", "title": "Convolution in Golang", "body": "<p>I want execute a convolution product on an image. </p>\n\n<p>The original image is: </p>\n\n<p><a href=\"https://i.stack.imgur.com/4GhJ3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/4GhJ3.png\" alt=\"enter image description here\"></a></p>\n\n<p>So I test the convolution with gimp. With this matrix:</p>\n\n<p>1 1 1</p>\n\n<p>1 1 1</p>\n\n<p>1 1 1</p>\n\n<p>and the divider 9</p>\n\n<p>I obtain </p>\n\n<p><a href=\"https://i.stack.imgur.com/4GhJ3.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/Dg2Dg.png\" alt=\"enter image description here\"></a></p>\n\n<p>When I execute my algorithm I obtain: </p>\n\n<p><a href=\"https://i.stack.imgur.com/KGdX0.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/KGdX0.png\" alt=\"enter image description here\"></a></p>\n\n<p>My algorithm is: </p>\n\n<pre><code>func Convolution(img *image.Image, matrice [][]int) *image.NRGBA {\n    imageRGBA := image.NewNRGBA((*img).Bounds())\n    w := (*img).Bounds().Dx()\n    h := (*img).Bounds().Dy()\n    sumR := 0\n    sumB := 0\n    sumG := 0\n    var r uint32\n    var g uint32\n    var b uint32\n    for y := 0; y &lt; h; y++ {\n        for x := 0; x &lt; w; x++ {\n\n            for i := -1; i &lt;= 1; i++ {\n                for j := -1; j &lt;= 1; j++ {\n\n                    var imageX int\n                    var imageY int\n\n                    imageX = x + i\n                    imageY = y + j\n\n                    r, g, b, _ = (*img).At(imageX, imageY).RGBA()\n                    sumG = (sumG + (int(g) * matrice[i+1][j+1]))\n                    sumR = (sumR + (int(r) * matrice[i+1][j+1]))\n                    sumB = (sumB + (int(b) * matrice[i+1][j+1]))\n                }\n            }\n\n            imageRGBA.Set(x, y, color.NRGBA{\n                uint8(min(sumR/9, 255)),\n                uint8(min(sumG/9, 255)),\n                uint8(min(sumB/9, 255)),\n                255,\n            })\n\n            sumR = 0\n            sumB = 0\n            sumG = 0\n\n        }\n    }\n\n    return imageRGBA\n\n}\n</code></pre>\n\n<p>Where are the error ? \nThank you for your help. </p>\n"}, {"tags": ["go", "docker", "kubernetes"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1489048324, "post_id": 42676157, "comment_id": 72503294, "body": "what go version did you use to build the binaries"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1489067413, "post_id": 42676157, "comment_id": 72515988, "body": "You haven&#39;t provided any code, any memory stats, any system specifications, any gctrace output, any pprof data, or any system profiling information. There really is nothing here to help solve the problem. If you want to know what the garbage collector is doing, start by looking at the GODEBUG gctrace output."}, {"owner": {"reputation": 141, "user_id": 1535214, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2d02132b9f29fef6ba8116f898386587?s=128&d=identicon&r=PG", "display_name": "Tiago Queiroz", "link": "https://stackoverflow.com/users/1535214/tiago-queiroz"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1489088922, "post_id": 42676157, "comment_id": 72530484, "body": "@RickyA I&#39;m using Go 1.8 on both environments."}, {"owner": {"reputation": 141, "user_id": 1535214, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2d02132b9f29fef6ba8116f898386587?s=128&d=identicon&r=PG", "display_name": "Tiago Queiroz", "link": "https://stackoverflow.com/users/1535214/tiago-queiroz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1489088926, "post_id": 42676157, "comment_id": 72530485, "body": "@JimB I will collect some of this information you asked for.  However I cannot really provide any code because of my NDA :/"}, {"owner": {"reputation": 141, "user_id": 1535214, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2d02132b9f29fef6ba8116f898386587?s=128&d=identicon&r=PG", "display_name": "Tiago Queiroz", "link": "https://stackoverflow.com/users/1535214/tiago-queiroz"}, "edited": false, "score": 0, "creation_date": 1489760157, "post_id": 42676157, "comment_id": 72825748, "body": "The logs I got from gctrace on beanstalk were corrupted :/  I will update the question with a 27h comparison of both environments and some settings helped to get faster gcpauses"}], "owner": {"reputation": 141, "user_id": 1535214, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/2d02132b9f29fef6ba8116f898386587?s=128&d=identicon&r=PG", "display_name": "Tiago Queiroz", "link": "https://stackoverflow.com/users/1535214/tiago-queiroz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 601, "favorite_count": 1, "answer_count": 0, "score": 0, "last_activity_date": 1516128212, "creation_date": 1488988944, "last_edit_date": 1516128212, "question_id": 42676157, "link": "https://stackoverflow.com/questions/42676157/golang-high-gc-pause-times-on-docker-kubernetes", "title": "Golang High GC pause times on docker/kubernetes", "body": "<p>I am migrationg a web application written in Go from <em>AWS Elastic Beanstalk</em> to <em>Kubernets</em> and I noticed that the garbage collector pause times (I am using Newrelic to monitor the application) increased about a 100 when running the application.</p>\n\n<p>I believe it is related with the CPU limiting that the Kubernet does.</p>\n\n<p>Does anyone have any idea about what is really causing it?  Is it possible to overcome it?</p>\n\n<p>Below there is a small example of this difference.</p>\n\n<p><strong>Elastc Beanstalk:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/jZMDn.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/jZMDn.png\" alt=\"GC Pause time - Elastic Beanstalk\"></a></p>\n\n<p><strong>Kubernets:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/uVd7W.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/uVd7W.png\" alt=\"GC Pause time - Kubernets\"></a></p>\n\n<p>After some tests and more research I discovered some interesting things.\nThe CPU limit on Docker seems to have a great influence on GC time/pauses. After some tests I got the CPU limit to <code>500m</code> which means about 1/2 CPU of a 8-core machine.</p>\n\n<p>I set <code>GOMAXPROCS = 1</code> and <code>GOGC = 1000</code> and this lead to less and faster GC pauses, however the average memory usage increased.</p>\n\n<p>Here are a 27h overview of Kubernets and Elastic Beanstalk</p>\n\n<p><strong>Kubernetes:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/b4OWd.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/b4OWd.png\" alt=\"GC overview - Kubernetes\"></a></p>\n\n<p><strong>Elastic Beanstalk:</strong></p>\n\n<p><a href=\"https://i.stack.imgur.com/wniOS.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/wniOS.png\" alt=\"GC overview - Elastic Beanstalk\"></a></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 78861, "user_id": 561309, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/6d833d9f0ffa2265a01359ccecd26d54?s=128&d=identicon&r=PG&f=1", "display_name": "laurent", "link": "https://stackoverflow.com/users/561309/laurent"}, "is_accepted": true, "score": 1, "last_activity_date": 1488986539, "creation_date": 1488986539, "answer_id": 42675210, "question_id": 42675108, "link": "https://stackoverflow.com/questions/42675108/how-to-guard-from-variables-declared-and-found-error/42675210#42675210", "title": "How to guard from variables declared and found error", "body": "<p>You have already declared the two variables on top of your file and, when you use <code>:=</code>, you are re-declaring them. The solution is to use <code>=</code> instead:</p>\n\n<pre><code>if res, err = http.Get(\"url\" + url.QueryEscape(query)); err != nil {\n</code></pre>\n"}], "owner": {"reputation": 263, "user_id": 3462064, "user_type": "registered", "accept_rate": 39, "profile_image": "https://www.gravatar.com/avatar/31e3c8e0db60fcce7e136db6e40f15bb?s=128&d=identicon&r=PG&f=1", "display_name": "user3462064", "link": "https://stackoverflow.com/users/3462064/user3462064"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "accepted_answer_id": 42675210, "answer_count": 1, "score": -1, "last_activity_date": 1488987215, "creation_date": 1488986265, "last_edit_date": 1488987215, "question_id": 42675108, "link": "https://stackoverflow.com/questions/42675108/how-to-guard-from-variables-declared-and-found-error", "title": "How to guard from variables declared and found error", "body": "<p>I have a small issue which I know why it's there but can't find the solution to it.</p>\n\n<p>What happens is I have a variable that won't be used if error occurred and this causes a compiler error.</p>\n\n<p>Code:</p>\n\n<pre><code>func findAll(query string) ([]Result, error) {\n    var res *http.Response\n    var err error\n\n    if res, err := http.Get(\"url\" + url.QueryEscape(query)); err != nil {\n        return []Result{}, err\n    }\n\n    defer res.Body.Close()\n    var body []byte\n    if body, err := ioutil.ReadAll(res.Body); err != nil {\n        return [] Result{}, err\n    }\n\n    var f FilteredSearch\n    err = xml.Unmarshal(body, &amp;f)\n    return f.Results, err\n}\n</code></pre>\n\n<p>First issue is in this line : </p>\n\n<pre><code>if res, err := http.Get(\"url\" + url.QueryEscape(query)); err != nil\n</code></pre>\n\n<blockquote>\n  <p>res declared and not used</p>\n</blockquote>\n\n<p>Same issue here:</p>\n\n<pre><code>if body, err := ioutil.ReadAll(res.Body); err != nil \n</code></pre>\n\n<blockquote>\n  <p>body declared and not used </p>\n</blockquote>\n"}, {"tags": ["go", "encoding", "gob"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488987250, "post_id": 42675054, "comment_id": 72475442, "body": "That looks like a bug, but it might be a limitation of the gob format. If you have an invariant that pointers to integers will never be nil, then why is it a pointer?"}, {"owner": {"reputation": 13, "user_id": 7678959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3cc2989c028c5d82250d5142fd01b0?s=128&d=identicon&r=PG&f=1", "display_name": "user7678959", "link": "https://stackoverflow.com/users/7678959/user7678959"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1489001953, "post_id": 42675054, "comment_id": 72485063, "body": "@JimB The structure is result of parsing JSON and I need to know whether a field is present or not. Go&#39;s JSON parsing library uses pointers for this purpose."}], "answers": [{"tags": [], "owner": {"reputation": 542, "user_id": 178442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377cef4245e0fcbf76e021d9cd253e35?s=128&d=identicon&r=PG", "display_name": "Colin Stewart", "link": "https://stackoverflow.com/users/178442/colin-stewart"}, "is_accepted": true, "score": 1, "last_activity_date": 1489017281, "creation_date": 1489017281, "answer_id": 42684208, "question_id": 42675054, "link": "https://stackoverflow.com/questions/42675054/golang-gob-converts-pointer-to-0-into-nil-pointer/42684208#42684208", "title": "golang gob converts pointer to 0 into nil pointer", "body": "<p>This behaviour is a limitation of the gob protocol according the defect raised back in 2013 - see <a href=\"https://github.com/golang/go/issues/4609\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/4609</a></p>\n\n<p>Bear in mind that gob doesn't send pointers, the pointer is dereferenced and the value is passed.  As such when the p.Ptr is set to &amp;p.One, you'll find that q.Ptr != &amp;q.One</p>\n"}], "owner": {"reputation": 13, "user_id": 7678959, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef3cc2989c028c5d82250d5142fd01b0?s=128&d=identicon&r=PG&f=1", "display_name": "user7678959", "link": "https://stackoverflow.com/users/7678959/user7678959"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "accepted_answer_id": 42684208, "answer_count": 1, "score": 1, "last_activity_date": 1489017281, "creation_date": 1488986098, "question_id": 42675054, "link": "https://stackoverflow.com/questions/42675054/golang-gob-converts-pointer-to-0-into-nil-pointer", "title": "golang gob converts pointer to 0 into nil pointer", "body": "<p>I'm trying to use go's net/rpc package to send data structures. The data structure includes a pointer to uint64. The pointer is never nil, but the value may be 0. I'm finding that when the value is 0, the receiver sees a nil pointer. When the value is non-0, the receives sees a non-nil pointer that points to a proper value. This is problematic, because it means that the RPC is breaking an invariant of my data structure: the pointer will never be nil.</p>\n\n<p>I have a go playground that demonstrates this behavior here: <a href=\"https://play.golang.org/p/Un3bTe5F-P\" rel=\"nofollow noreferrer\">https://play.golang.org/p/Un3bTe5F-P</a></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/gob\"\n    \"fmt\"\n    \"log\"\n)\n\ntype P struct {\n    Zero, One int\n    Ptr    *int\n}\n\nfunc main() {\n    // Initialize the encoder and decoder.  Normally enc and dec would be\n    // bound to network connections and the encoder and decoder would\n    // run in different processes.\n    var network bytes.Buffer        // Stand-in for a network connection\n    enc := gob.NewEncoder(&amp;network) // Will write to network.\n    dec := gob.NewDecoder(&amp;network) // Will read from network.\n    // Encode (send) the value.\n    var p P\n    p.Zero = 0\n    p.One = 1\n    p.Ptr = &amp;p.Zero\n    fmt.Printf(\"p0: %s\\n\", p)\n    err := enc.Encode(p)\n    if err != nil {\n        log.Fatal(\"encode error:\", err)\n    }\n    // Decode (receive) the value.\n    var q P\n    err = dec.Decode(&amp;q)\n    if err != nil {\n        log.Fatal(\"decode error:\", err)\n    }\n    fmt.Printf(\"q0: %s\\n\", q)\n\n    p.Ptr = &amp;p.One\n    fmt.Printf(\"p1: %s\\n\", p)\n    err = enc.Encode(p)\n    if err != nil {\n        log.Fatal(\"encode error:\", err)\n    }\n\n    err = dec.Decode(&amp;q)\n    if err != nil {\n        log.Fatal(\"decode error:\", err)\n    }\n    fmt.Printf(\"q1: %s\\n\", q)\n}\n</code></pre>\n\n<p>The output from this code is:</p>\n\n<pre><code>p0: {%!s(int=0) %!s(int=1) %!s(*int=0x1050a780)}\nq0: {%!s(int=0) %!s(int=1) %!s(*int=&lt;nil&gt;)}\np1: {%!s(int=0) %!s(int=1) %!s(*int=0x1050a784)}\nq1: {%!s(int=0) %!s(int=1) %!s(*int=0x1050aba8)}\n</code></pre>\n\n<p>So when Ptr points to a 0, it becomes nil on the receiver side. When Ptr points to 1, it is passed through normally.</p>\n\n<p>Is this a bug? Is there a way around this problem? I want to avoid having to unmarshall my detastructure on the receiver side to fix all the unexpected nil pointers...</p>\n"}, {"tags": ["git", "go", "intellij-idea", "travis-ci", "ubuntu-16.04"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488985651, "post_id": 42673951, "comment_id": 72474281, "body": "Those aren&#39;t commands under your &quot;install:&quot; step, and <code>go_import_path</code> is supposed to be a path. See the docs: <a href=\"https://docs.travis-ci.com/user/customizing-the-build#Customizing-the-Installation-Step\" rel=\"nofollow noreferrer\">docs.travis-ci.com/user/&hellip;</a> and <a href=\"https://docs.travis-ci.com/user/languages/go/#Go-Import-Path\" rel=\"nofollow noreferrer\">docs.travis-ci.com/user/languages/go/#Go-Import-Path</a> You should also probably use an up to date version of Go."}, {"owner": {"reputation": 11, "user_id": 7678751, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210676266696050/picture?type=large", "display_name": "Alvaro Ruiz", "link": "https://stackoverflow.com/users/7678751/alvaro-ruiz"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488988509, "post_id": 42673951, "comment_id": 72476418, "body": "@JimB, you are right, changed the install lines to &quot;go get github.com/gorilla/...&quot; and worked!"}], "owner": {"reputation": 11, "user_id": 7678751, "user_type": "registered", "profile_image": "https://graph.facebook.com/10210676266696050/picture?type=large", "display_name": "Alvaro Ruiz", "link": "https://stackoverflow.com/users/7678751/alvaro-ruiz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 344, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488983174, "creation_date": 1488983174, "question_id": 42673951, "link": "https://stackoverflow.com/questions/42673951/the-command-git-config-remote-origin-url-old-remote-git-failed-and-exit", "title": "The command &quot;git config remote.origin.url &quot;${_old_remote%.git}&quot;&quot; failed and exited with 255 during", "body": "<p>Even though it compiles and runs perfectly in my machine, has no problems uploading it to github, when I try to use travis-CI (for the first time) shows the following error:\n(I only have 2 external dependecies gorilla/mux and gorilla/context, which I obtained from \"go get\")</p>\n\n<pre><code>$ export GOPATH=$HOME/gopath\n$ export PATH=$HOME/gopath/bin:$PATH\n$ mkdir -p $HOME/gopath/src/[\"github.com/gorilla/mux\", \"github.com/gorilla/context\"]\n$ rsync -az ${TRAVIS_BUILD_DIR}/ $HOME/gopath/src/[\"github.com/gorilla/mux\", \"github.com/gorilla/context\"]/\n$ export TRAVIS_BUILD_DIR=$HOME/gopath/src/[\"github.com/gorilla/mux\", \"github.com/gorilla/context\"]\n/home/travis/build.sh: line 62: export: `github.com/gorilla/context]': not a valid identifier\n$ cd $HOME/gopath/src/[\"github.com/gorilla/mux\", \"github.com/gorilla/context\"]\nerror: could not lock config file .git/config: No such file or directory\nThe command \"git config remote.origin.url \"${_old_remote%.git}\"\" failed and exited with 255 during .\nYour build has been stopped.\n</code></pre>\n\n<p>.travis.yml:</p>\n\n<pre><code>language: go\ngo:\n  - 1.6.x\ngo_import_path:\n  - github.com/gorilla/mux\n  - github.com/gorilla/context\ninstall:\n  - github.com/gorilla/mux\n  - github.com/gorilla/context\nscript:\n  - go test -v ./...\n</code></pre>\n\n<p>I modified the .travis.yml file several times and I have no idea what is wrong/missing.</p>\n\n<p>I have the default config file at ProjectName/.git/config</p>\n\n<p>I also have the GO recommended directory set up GOPATH/src/github.com/User/ProjectName/</p>\n\n<p>Any idea what I am doing wrong?</p>\n\n<p>Thank you</p>\n"}, {"tags": ["post", "go", "telegram-bot"], "comments": [{"owner": {"reputation": 2559, "user_id": 5087125, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6R64Z.jpg?s=128&g=1", "display_name": "pvg", "link": "https://stackoverflow.com/users/5087125/pvg"}, "edited": false, "score": 0, "creation_date": 1488982588, "post_id": 42673582, "comment_id": 72471914, "body": "Aren&#39;t you sending form data instead of JSON here? API seems to expect JSON"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488982698, "post_id": 42673582, "comment_id": 72472008, "body": "<code>strings.NewReader(urlData.Encode()</code> contradicts <code>req.Header.Set(&quot;content-type&quot;, &quot;application-json&quot;)</code>"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488982951, "post_id": 42673582, "comment_id": 72472184, "body": "@Volker so it would be of with <b>text/plain</b> right? In order to send a JSON like @pvg said What do I have to change? I&#39;m trying passing <b>var data string = &quot; <code>{text : Hello}</code> &quot;</b> instead but still does not work. I&#39;m sorry if this is trivial but I&#39;m a go beginner."}], "answers": [{"comments": [{"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1488983151, "post_id": 42673831, "comment_id": 72472354, "body": "Still getting Bad Request."}, {"owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "reply_to_user": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1488983346, "post_id": 42673831, "comment_id": 72472511, "body": "@AndreaM16 have you adjusted the header ?"}, {"owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "edited": false, "score": 0, "creation_date": 1488983419, "post_id": 42673831, "comment_id": 72472571, "body": "Now it works. I wasn&#39;t writing it in the proper way."}], "tags": [], "owner": {"reputation": 6770, "user_id": 3658660, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/5b40f4e2bead9eca6951da110a3c84e7?s=128&d=identicon&r=PG&f=1", "display_name": "hlscalon", "link": "https://stackoverflow.com/users/3658660/hlscalon"}, "is_accepted": true, "score": 3, "last_activity_date": 1488983324, "last_edit_date": 1488983324, "creation_date": 1488982877, "answer_id": 42673831, "question_id": 42673582, "link": "https://stackoverflow.com/questions/42673582/400-bad-request-with-golang-and-telegram-api/42673831#42673831", "title": "400 Bad Request with Golang and Telegram API", "body": "<p>You need to send a json string.</p>\n\n<pre><code>var jsonStr = []byte(`{\"text\":\"Hello!\"}`)\nreq, _ := http.NewRequest(\"POST\", request_url, bytes.NewBuffer(jsonStr))\n</code></pre>\n\n<p>Or, if you don't want to directly write it:</p>\n\n<pre><code>values := map[string]string{\"text\": \"Hello!\"}\njsonStr, _ := json.Marshal(values)\nreq, _ := http.NewRequest(\"POST\", request_url, bytes.NewBuffer(jsonStr))\n</code></pre>\n\n<p>Also, adjust the header <code>Content-Type</code> to:</p>\n\n<pre><code>req.Header.Set(\"Content-Type\", \"application/json\")\n</code></pre>\n"}], "owner": {"reputation": 3419, "user_id": 4684539, "user_type": "registered", "accept_rate": 98, "profile_image": "https://graph.facebook.com/802633546458340/picture?type=large", "display_name": "AndreaM16", "link": "https://stackoverflow.com/users/4684539/andream16"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1994, "favorite_count": 0, "accepted_answer_id": 42673831, "answer_count": 1, "score": -2, "last_activity_date": 1549604170, "creation_date": 1488982279, "last_edit_date": 1488992238, "question_id": 42673582, "link": "https://stackoverflow.com/questions/42673582/400-bad-request-with-golang-and-telegram-api", "title": "400 Bad Request with Golang and Telegram API", "body": "<p>I'm building a golang application which performs a <strong>POST</strong> to a Telegram Channel using a given Bot token but when I do it I get</p>\n\n<blockquote>\n  <p>400 Bad Request </p>\n</blockquote>\n\n<p>This is my POST:</p>\n\n<pre><code>import (\n  \"fmt\"\n  \"net/url\"\n  \"net/http\"\n  \"strings\"\n)\n\n. . .\n\n  request_url := \"https://api.telegram.org/bot{token}/sendMessage?chat_id={channelId}\"\n\n  urlData := url.Values{}\n  urlData.Set(\"text\", \"Hello!\")\n\n  client := &amp;http.Client{}\n  req, _ := http.NewRequest(\"POST\", request_url, strings.NewReader(urlData.Encode()))\n  req.Header.Set(\"content-type\", \"application-json\")\n  res, err := client.Do(req)\n  if(err != nil){\n      fmt.Println(err)\n  } else {\n      fmt.Println(res.Status)\n  }\n</code></pre>\n\n<p>I don't get why it's giving me 400 even thought I'm able to perform the very same POST using <strong>Postman</strong></p>\n\n<pre><code>POST https://api.telegram.org/bot{token}/sendMessage?chat_id={channelId}\nbody : {\"text\" : \"Hello\"} Content-Type=application/json\n</code></pre>\n\n<p><strong>Any Hint on how to fix this?</strong></p>\n\n<p>I've been scratching my head for a while but I wasn't able to solve this.</p>\n\n<p><strong>UPDATE</strong></p>\n\n<p>Trying @old_mountain approach leads to the same result</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"net/http\"\n    \"bytes\"\n    \"encoding/json\"\n)\n\n  request_url := \"https://api.telegram.org/bot{token}/sendMessage?chat_id={channelId}\"\n\n  client := &amp;http.Client{}\n  values := map[string]string{\"text\": \"Hello!\"}\n  jsonStr, _ := json.Marshal(values)\n  req, _ := http.NewRequest(\"POST\", request_url, bytes.NewBuffer(jsonStr))\n  req.Header.Set(\"content-type\", \"application-json\")\n\n  res, err := client.Do(req)\n  if(err != nil){\n      fmt.Println(err)\n  } else {\n      fmt.Println(res.Status)\n  }\n</code></pre>\n"}, {"tags": ["go", "tcp", "network-programming"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488981248, "post_id": 42672590, "comment_id": 72470962, "body": "The OS tcp stack sends the RST because the SYN/ACK isn&#39;t really for a valid connection."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488985543, "post_id": 42672590, "comment_id": 72474189, "body": "I&#39;m with @JimB on this: unless you&#39;re using RAW TCP sockets (which allow crafting of packets messing with the data normally added by layers lower than yours -- application&#39;s), you can&#39;t send a packet having the RST flag set: it&#39;s sent by the OS TCP/IP stack in response to a packet which does not belong to a valid (active) TCP session on the receiving host."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488985604, "post_id": 42672590, "comment_id": 72474243, "body": "A typical cause for this to happen is the program which participated in that TCP session suddenly died or otherwise improperly closed its side of the stream -- w/o properly calling the close(2) or shutdown(2) on its socket."}], "owner": {"reputation": 11, "user_id": 7674725, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c26db62a9dde79cc67a9599254a4b3b4?s=128&d=identicon&r=PG&f=1", "display_name": "Moran", "link": "https://stackoverflow.com/users/7674725/moran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 554, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1488979572, "creation_date": 1488979572, "question_id": 42672590, "link": "https://stackoverflow.com/questions/42672590/attempting-to-find-a-piece-of-code-responsible-for-sending-tcp-packet-with-rst", "title": "Attempting to find a piece of code, responsible for sending TCP packet with RST-flag", "body": "<p>I'm trying to realize how works a following code made by <a href=\"https://github.com/kdar/gorawtcpsyn/blob/master/main.go\" rel=\"nofollow noreferrer\">kdar</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/google/gopacket\"\n    \"github.com/google/gopacket/layers\"\n    \"log\"\n    \"net\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n)\n\n// get the local ip and port based on our destination ip\nfunc localIPPort(dstip net.IP) (net.IP, int) {\n    serverAddr, err := net.ResolveUDPAddr(\"udp\", dstip.String()+\":12345\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // We don't actually connect to anything, but we can determine\n    // based on our destination ip what source ip we should use.\n    if con, err := net.DialUDP(\"udp\", nil, serverAddr); err == nil {\n        if udpaddr, ok := con.LocalAddr().(*net.UDPAddr); ok {\n            return udpaddr.IP, udpaddr.Port\n        }\n    }\n    log.Fatal(\"could not get local ip: \" + err.Error())\n    return nil, -1\n}\n\nfunc main() {\n    if len(os.Args) != 3 {\n        log.Printf(\"Usage: %s &lt;host/ip&gt; &lt;port&gt;\\n\", os.Args[0])\n        os.Exit(-1)\n    }\n    log.Println(\"starting\")\n\n    dstaddrs, err := net.LookupIP(os.Args[1])\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    // parse the destination host and port from the command line os.Args\n    dstip := dstaddrs[0].To4()\n    var dstport layers.TCPPort\n    if d, err := strconv.ParseInt(os.Args[2], 10, 16); err != nil {\n        log.Fatal(err)\n    } else {\n        dstport = layers.TCPPort(d)\n    }\n\n    srcip, sport := localIPPort(dstip)\n    srcport := layers.TCPPort(sport)\n    log.Printf(\"using srcip: %v\", srcip.String())\n\n    // Our IP header... not used, but necessary for TCP checksumming.\n    ip := &amp;layers.IPv4{\n        SrcIP:    srcip,\n        DstIP:    dstip,\n        Protocol: layers.IPProtocolTCP,\n    }\n    // Our TCP header\n    tcp := &amp;layers.TCP{\n        SrcPort: srcport,\n        DstPort: dstport,\n        Seq:     1105024978,\n        SYN:     true,\n        Window:  14600,\n    }\n    tcp.SetNetworkLayerForChecksum(ip)\n\n    // Serialize.  Note:  we only serialize the TCP layer, because the\n    // socket we get with net.ListenPacket wraps our data in IPv4 packets\n    // already.  We do still need the IP layer to compute checksums\n    // correctly, though.\n    buf := gopacket.NewSerializeBuffer()\n    opts := gopacket.SerializeOptions{\n        ComputeChecksums: true,\n        FixLengths:       true,\n    }\n    if err := gopacket.SerializeLayers(buf, opts, tcp); err != nil {\n        log.Fatal(err)\n    }\n\n    conn, err := net.ListenPacket(\"ip4:tcp\", \"0.0.0.0\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    log.Println(\"writing request\")\n    if _, err := conn.WriteTo(buf.Bytes(), &amp;net.IPAddr{IP: dstip}); err != nil {\n        log.Fatal(err)\n    }\n\n    // Set deadline so we don't wait forever.\n    if err := conn.SetDeadline(time.Now().Add(10 * time.Second)); err != nil {\n        log.Fatal(err)\n    }\n\n    for {\n        b := make([]byte, 4096)\n        log.Println(\"reading from conn\")\n        n, addr, err := conn.ReadFrom(b)\n        if err != nil {\n            log.Println(\"error reading packet: \", err)\n            return\n        } else if addr.String() == dstip.String() {\n            // Decode a packet\n            packet := gopacket.NewPacket(b[:n], layers.LayerTypeTCP, gopacket.Default)\n            // Get the TCP layer from this packet\n            if tcpLayer := packet.Layer(layers.LayerTypeTCP); tcpLayer != nil {\n                tcp, _ := tcpLayer.(*layers.TCP)\n\n                if tcp.DstPort == srcport {\n                    if tcp.SYN &amp;&amp; tcp.ACK {\n                        log.Printf(\"Port %d is OPEN\\n\", dstport)\n                    } else {\n                        log.Printf(\"Port %d is CLOSED\\n\", dstport)\n                    }\n                    return\n                }\n            }\n        } else {\n            log.Printf(\"Got packet not matching addr\")\n        }\n    }\n}\n</code></pre>\n\n<p>If i understand right, that code sends a raw TCP packet with SYN-flag to a server and waits for response. Using <a href=\"https://i.stack.imgur.com/tLWtv.png\" rel=\"nofollow noreferrer\">wireshark</a>  I found out that after receiving a response (SYN-ACK) from a server, the client sends a packet with RST flag. I can't understand, which piece of code is responsible for sending a TCP packet with RST-flag.</p>\n"}, {"tags": ["go", "memory-management"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488973561, "post_id": 42670404, "comment_id": 72465543, "body": "See related questions: <a href=\"http://stackoverflow.com/questions/37382600/golang-cannot-free-memory-once-occupied-by-bytes-buffer/37383604#37383604\">Golang - Cannot free memory once occupied by bytes.Buffer</a>; and <a href=\"http://stackoverflow.com/questions/42345060/freeosmemory-in-production/42345554#42345554\">FreeOSMemory() in production</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488973754, "post_id": 42670404, "comment_id": 72465668, "body": "How do you know that memory isn&#39;t being used, or if it&#39;s really allocated at all and not just virtual size? What does the gctrace output look like? What are the actual memstats showing what&#39;s allocated?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488973809, "post_id": 42670404, "comment_id": 72465703, "body": "&quot;4.5GB RAM and will fill it with data from disc also processing data while loading&quot; hints at that you are not only allocating a flat <code>[4.5e6]byte</code> but that your data structure is more complicated. It is literally impossible to suggest anything you could do to reduce the memory footprint of your application with the few information you gave."}, {"owner": {"reputation": 32405, "user_id": 553209, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/HCxak.jpg?s=128&g=1", "display_name": "Ankur", "link": "https://stackoverflow.com/users/553209/ankur"}, "edited": false, "score": 0, "creation_date": 1488983587, "post_id": 42670404, "comment_id": 72472688, "body": "@exebook How are you allocating the memory?"}], "answers": [{"tags": [], "owner": {"reputation": 115745, "user_id": 119527, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/lTjBL.png?s=128&g=1", "display_name": "Jonathon Reinhart", "link": "https://stackoverflow.com/users/119527/jonathon-reinhart"}, "is_accepted": false, "score": 0, "last_activity_date": 1539242098, "last_edit_date": 1539242098, "creation_date": 1488973614, "answer_id": 42670512, "question_id": 42670404, "link": "https://stackoverflow.com/questions/42670404/allocate-5-gb-of-ram-in-a-more-compact-way/42670512#42670512", "title": "Allocate 5 GB of RAM in a more compact way", "body": "<p>Most likely that is <strong>virtual memory</strong> that Go is using, not actual <em>committed</em> pages of RAM.</p>\n\n<p>DeferPanic blog post: \"<a href=\"https://web.archive.org/web/20170925041645/https://deferpanic.com/blog/understanding-golang-memory-usage/\" rel=\"nofollow noreferrer\">Understanding Go Lang Memory Usage</a>\" (2014)</p>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 1, "last_activity_date": 1539242045, "creation_date": 1539242045, "answer_id": 52754340, "question_id": 42670404, "link": "https://stackoverflow.com/questions/42670404/allocate-5-gb-of-ram-in-a-more-compact-way/52754340#52754340", "title": "Allocate 5 GB of RAM in a more compact way", "body": "<p>Speaking of virtual memory (See \"<a href=\"https://povilasv.me/go-memory-management/\" rel=\"nofollow noreferrer\"><strong>Go Memory Management</strong></a>\" from <strong><a href=\"https://povilasv.me/about/\" rel=\"nofollow noreferrer\">Povilas Versockas</a></strong>, and <a href=\"https://stackoverflow.com/a/21049737/6309\">RSS vs. VSZ</a>), don't try your program with Go 1.11.</p>\n\n<p>See <a href=\"https://github.com/golang/go/issues/28114\" rel=\"nofollow noreferrer\"><code>golang/go</code> issue 28114</a>: \"runtime: programs compiled by 1.11 allocate an unreasonable amount of virtual memory\".<br>\nAlso <a href=\"https://news.ycombinator.com/item?id=18184541\" rel=\"nofollow noreferrer\">discussed here</a>.</p>\n\n<p>Possibly related to:</p>\n\n<ul>\n<li><a href=\"https://go-review.googlesource.com/c/go/+/85888\" rel=\"nofollow noreferrer\">CL 85888</a>: runtime: remove non-reserved heap logic</li>\n<li><a href=\"https://golang.org/issue/10460\" rel=\"nofollow noreferrer\">issue 10460</a>: runtime: 512GB memory limitation</li>\n</ul>\n\n<p>Possible workaround: <a href=\"https://github.com/golang/go/issues/28081#issuecomment-427996005\" rel=\"nofollow noreferrer\">golang/go issue 28081</a></p>\n"}], "owner": {"reputation": 27031, "user_id": 1968972, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/bfdd4ec8dff5c7635520fe98348524ec?s=128&d=identicon&r=PG", "display_name": "exebook", "link": "https://stackoverflow.com/users/1968972/exebook"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 142, "favorite_count": 1, "answer_count": 2, "score": -1, "last_activity_date": 1539242098, "creation_date": 1488973320, "question_id": 42670404, "link": "https://stackoverflow.com/questions/42670404/allocate-5-gb-of-ram-in-a-more-compact-way", "title": "Allocate 5 GB of RAM in a more compact way", "body": "<p>I just ported some code from C/C++ to Go, it is a microservice. It works well, even faster than in C/C++. But I have a problem with memory.</p>\n\n<p>When my program starts it will allocate about 4.5GB RAM and will fill it with data from disc also processing data while loading, then it will run for days(hopefully months) serving the requests from RAM. Unfortunately after the processing and placement of data in RAM is finished, extra 3.5 GB of RAM remains allocated by Go. I do not do any deallocations, only allocations, I do not think my program really uses 8 GB at any point, so I think Go just acquires extra RAM because it \"feels\" I might need more soon, but I will not.</p>\n\n<p>I read that Go does not allow any functionality to deallocate unused RAM to return it to system. I want to run more services on the same machine, saving as much of RAM as possible, so wasting almost as much as I really use feels wrong.</p>\n\n<p>So how do I keep the memory footprint compact avoiding those empty 3.5 GB being allocated by Go?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1488967372, "post_id": 42667898, "comment_id": 72461228, "body": "Vendoring is a mechanism (introduced in v1.5), and godep is one of multiple implementations to automate it. You can copy-paste vendored dependencies manually. godep, glide and other tools just help to automate managing it."}, {"owner": {"reputation": 473, "user_id": 6286900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/20NnH.jpg?s=128&g=1", "display_name": "Salvatore D&#39;angelo", "link": "https://stackoverflow.com/users/6286900/salvatore-dangelo"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1488968720, "post_id": 42667898, "comment_id": 72462144, "body": "That was clear to me. But why introduce in 1.5 as experiment feature the vendor system when there was already the method with Godeps and Godeps.json. Moreover, they looks like very similar so it&#39;s not clear to me why the new system was introduced. Obviously, everything change if you tell me that the Godeps system simply became the official method to manage dependencies and Google simply renamed it with vendor. Is this true?"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1488971577, "post_id": 42667898, "comment_id": 72464090, "body": "The <code>vendor</code> folder is a method baked into the core Go tooling, especially the <code>go</code> tool. It was an official experiment to see if vendoring works, what works well and what needs to be changed. github.com/tools/godep is a (unofficial) tool which does roughly the same. There is an new upcoming tool github.com/golang/dep which will be some kind of &quot;official&quot; dependency management tool."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1488971864, "post_id": 42667898, "comment_id": 72464279, "body": "I have to admit I do not understand what you are asking. Different people and different groups/communities have been working independently on some problem and the found different solutions. There are more ways and tools to manage Go dependencies than the vendor folder and godep and that is okay. &quot; the Godeps system simply became the official method to manage dependencies and Google simply renamed it with vendor&quot; this is completely wrong. As said: There are probably around 10 ways to do it, vendor and godeps being just two. Hopefully this mess will consolidate and converge to <code>dep</code>."}, {"owner": {"reputation": 473, "user_id": 6286900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/20NnH.jpg?s=128&g=1", "display_name": "Salvatore D&#39;angelo", "link": "https://stackoverflow.com/users/6286900/salvatore-dangelo"}, "edited": false, "score": 0, "creation_date": 1488972279, "post_id": 42667898, "comment_id": 72464581, "body": "Your first answer satisfy me. It is exactly what I am expecting and it fits with what I learned so far. If you copy and past it in the Answer I&#39;ll accept it as an answer."}, {"owner": {"reputation": 473, "user_id": 6286900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/20NnH.jpg?s=128&g=1", "display_name": "Salvatore D&#39;angelo", "link": "https://stackoverflow.com/users/6286900/salvatore-dangelo"}, "edited": false, "score": 0, "creation_date": 1488972417, "post_id": 42667898, "comment_id": 72464692, "body": "Only another question. Was Godeps Godeps.json system introduced by godep utility? If so, How could a developer before the introduction of godep recreate a dev environment with dependencies at a specific commit level if godep didn&#39;t exist? I know these question seems strange but I am creating a doc with some historical info that will be later required to justify some design decision."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488972552, "post_id": 42667898, "comment_id": 72464780, "body": "I&#39;m unfamiliar with the internals of godep so I cannot answer this question."}, {"owner": {"reputation": 473, "user_id": 6286900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/20NnH.jpg?s=128&g=1", "display_name": "Salvatore D&#39;angelo", "link": "https://stackoverflow.com/users/6286900/salvatore-dangelo"}, "edited": false, "score": 0, "creation_date": 1488973164, "post_id": 42667898, "comment_id": 72465227, "body": "Ok. Thanks you."}, {"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1489404295, "post_id": 42667898, "comment_id": 72640015, "body": "One subtlety that is often not clarified is the question of what to put in VCS (git etc). So you have a tool that fetches particular versions of many dependencies so that the source code is local. But then what? To some, just having local copies of known versions is sufficient. To others, these local copies ought to be added to your own VCS too. There are many tools to do the first job. But whether the second step is necessary has been a topic of discussion."}], "owner": {"reputation": 473, "user_id": 6286900, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/20NnH.jpg?s=128&g=1", "display_name": "Salvatore D&#39;angelo", "link": "https://stackoverflow.com/users/6286900/salvatore-dangelo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 199, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1489404068, "creation_date": 1488966405, "last_edit_date": 1489404068, "question_id": 42667898, "link": "https://stackoverflow.com/questions/42667898/godeps-vs-vendor-system-in-go", "title": "Godeps vs Vendor System in Go", "body": "<p>I read lot of docs about Go Dependency Management and I understand there are two systems for Go to manage them:\n* 1.5 System and before\n* 1.6 and later</p>\n\n<p>The problem both try to address is: <strong>how to create a reproducible build with all the dependency at the exact commit level expected?</strong></p>\n\n<p>The first one basically has a <strong>Godeps</strong> folder with <strong>Godeps.json</strong> files where are reported the list of dependencies with their own commit level.\nThen with a command a developer can easily recreate the same dev environment.</p>\n\n<p>The same thing happen with vendor system. This time we have a <strong>vendor</strong> folder with <strong>vendor.json</strong> file.</p>\n\n<p>Now at my eyes these two systems look similar and it's not clear to me why the new system has been introduced. They apparently do the same thing and it's not clear to me which problem the first system had that second system solved.</p>\n\n<p>Can someone explain to me this? Can someone also explain a real example that is problematic with first method and the second resolve?\nThanks</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488969039, "post_id": 42667560, "comment_id": 72462362, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/6807590/how-to-stop-a-goroutine\">how to stop a goroutine</a>"}, {"owner": {"user_type": "does_not_exist", "display_name": "user5646735"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1488977218, "post_id": 42667560, "comment_id": 72468150, "body": "No, not really. My problem is that my goroutine stops, but when i start the gocron job later, the goroutine runs two times per minute."}], "answers": [{"tags": [], "owner": {"reputation": 310, "user_id": 5799860, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e74794c62ffb86fb84242f10574d79bd?s=128&d=identicon&r=PG&f=1", "display_name": "Hendrik Evert", "link": "https://stackoverflow.com/users/5799860/hendrik-evert"}, "is_accepted": false, "score": 0, "last_activity_date": 1498392592, "creation_date": 1498392592, "answer_id": 44746237, "question_id": 42667560, "link": "https://stackoverflow.com/questions/42667560/how-to-clear-gocron-job/44746237#44746237", "title": "How to clear gocron job?", "body": "<p>I just had a simmilar Issue with gocron and I fixed my problem by removing </p>\n\n<pre><code>&lt;-gocron.Start()\n</code></pre>\n\n<p>from my for-loop as it will start gocron jobs that were already started again.</p>\n\n<p>you might try changing your for loop to this:</p>\n\n<pre><code>for {\n    log.Printf(\"waiting for signal...\\n\")\n    shouldContinue := &lt;-statusChannel\n    if !shouldContinue {\n        log.Print(\"received false, breaking...\\n\")\n        gocron.Clear()\n        break\n    }\n    gocron.Every(1).Minute().Do(myFunc)\n    log.Print(\"working...\\n\")\n    }\n    &lt;-gocron.Start()\n}\n</code></pre>\n\n<p>if that doesn't fix your problem you can also have a look at my post, maybe it helps you :)</p>\n\n<p><a href=\"https://stackoverflow.com/questions/44746083/gocron-creates-multiple-instances-of-task/44746197#44746197\">gocron creates multiple instances of task</a></p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user5646735"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 320, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1498392592, "creation_date": 1488965491, "last_edit_date": 1488968993, "question_id": 42667560, "link": "https://stackoverflow.com/questions/42667560/how-to-clear-gocron-job", "title": "How to clear gocron job?", "body": "<pre><code>func main() {\n    statusChannel := make(chan bool)\n    go checkChannel(statusChannel)\n    [...] \n    if x == 1 {\n    statusChannel &lt;- true\n    } else {\n    statusChannel &lt;- false\n}\n\n\nfunc checkChannel(statusChannel chan bool) {\ndefer close(statusChannel)\nfor {\n    log.Printf(\"waiting for signal...\\n\")\n    shouldContinue := &lt;-statusChannel\n    if !shouldContinue {\n        log.Print(\"received false, breaking...\\n\")\n        gocron.Clear()\n        break\n    }\n    gocron.Every(1).Minute().Do(myFunc)\n    &lt;-gocron.Start()\n    log.Print(\"working...\\n\")\n    }\n}\n</code></pre>\n\n<p>The running gocron job will break, but if my gocron job starts a second time later, it runs my function two times per minute. Where is my mistake?</p>\n"}, {"tags": ["go", "blockchain", "hyperledger", "hyperledger-fabric"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 7677029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ra6iZ.jpg?s=128&g=1", "display_name": "Ashar Ali", "link": "https://stackoverflow.com/users/7677029/ashar-ali"}, "edited": false, "score": 0, "creation_date": 1488986974, "post_id": 42671370, "comment_id": 72475241, "body": "Thank you @Ashishkel for such a detailed explanation. I am now working with tables to work it out. I set 2 columns (ReferenceNumber and Status) as key columns, now when I query with 2 arguments, the result from table is returned but when I query with any of the 2 arguments, query fails to return any row.  I am using the same code as described in gerrit/src/github.com/hyperledger/fabric/bddtests/chaincode/&zwnj;&#8203;go/table/table.go"}, {"owner": {"reputation": 825, "user_id": 3824841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hUElY.jpg?s=128&g=1", "display_name": "Ashishkel", "link": "https://stackoverflow.com/users/3824841/ashishkel"}, "reply_to_user": {"reputation": 23, "user_id": 7677029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ra6iZ.jpg?s=128&g=1", "display_name": "Ashar Ali", "link": "https://stackoverflow.com/users/7677029/ashar-ali"}, "edited": false, "score": 0, "creation_date": 1489053029, "post_id": 42671370, "comment_id": 72506362, "body": "May be the current version has a problem as such. What I have noticed is, say you have keys A,B ( specified in the same order) and then GetRows works when I specify neither of the keys and when I specify A. It do not work when I specify B alone. Try it. If what you are encountering is the the same issue, then this is one way to move ahead."}, {"owner": {"reputation": 23, "user_id": 7677029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ra6iZ.jpg?s=128&g=1", "display_name": "Ashar Ali", "link": "https://stackoverflow.com/users/7677029/ashar-ali"}, "edited": false, "score": 0, "creation_date": 1489054087, "post_id": 42671370, "comment_id": 72507088, "body": "Exactly, It works with no arguments at all, all keys or the first key. I am having to reverse the orders of the key to create a work-around situation. Thank you so much for the help though. Cheers."}], "tags": [], "owner": {"reputation": 825, "user_id": 3824841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/hUElY.jpg?s=128&g=1", "display_name": "Ashishkel", "link": "https://stackoverflow.com/users/3824841/ashishkel"}, "is_accepted": true, "score": 2, "last_activity_date": 1488975972, "creation_date": 1488975972, "answer_id": 42671370, "question_id": 42666568, "link": "https://stackoverflow.com/questions/42666568/getting-world-state-by-value/42671370#42671370", "title": "Getting world state by value", "body": "<p>Worldstate level storage works at the {key,value} level. And as obvious its only intended for a single value lookup for a specified key. I think what you are looking for calls for a next level higher level of Abstraction of WorldState - called Table constructs.\n<strong>fabric/examples/chaincode/go/asset_management_interactive/asset_management.go</strong> has an example on how to create a table with the columns you want. <em>While defining the primary keys of your data structure to hold the transaction, you include Status as one of the keys and you would be able to retrieve data on the basis of Status as well</em>.</p>\n\n<p>Some sample code to create the table is as below </p>\n\n<pre><code>func createTableTwo(stub shim.ChaincodeStubInterface) error {\n    var columnDefsTableTwo []*shim.ColumnDefinition\n    columnOneTableTwoDef := shim.ColumnDefinition{Name: \"colOneTableTwo\",\n        Type: shim.ColumnDefinition_STRING, Key: true}\n    columnTwoTableTwoDef := shim.ColumnDefinition{Name: \"colTwoTableTwo\",\n        Type: shim.ColumnDefinition_INT32, Key: false}\n    columnThreeTableTwoDef := shim.ColumnDefinition{Name: \"colThreeTableThree\",\n        Type: shim.ColumnDefinition_INT32, Key: true}\n    columnFourTableTwoDef := shim.ColumnDefinition{Name: \"colFourTableFour\",\n        Type: shim.ColumnDefinition_STRING, Key: true}\n    columnDefsTableTwo = append(columnDefsTableTwo, &amp;columnOneTableTwoDef)\n    columnDefsTableTwo = append(columnDefsTableTwo, &amp;columnTwoTableTwoDef)\n    columnDefsTableTwo = append(columnDefsTableTwo, &amp;columnThreeTableTwoDef)\n    columnDefsTableTwo = append(columnDefsTableTwo, &amp;columnFourTableTwoDef)\n    return stub.CreateTable(\"tableTwo\", columnDefsTableTwo)\n}\n</code></pre>\n\n<p>Now to insert data into this table, as shown</p>\n\n<pre><code>if len(args) &lt; 4 {\n            return nil, errors.New(\"insertRowTableTwo failed. Must include 4 column values\")\n        }\n\n        col1Val := args[0]\n        col2Int, err := strconv.ParseInt(args[1], 10, 32)\n        if err != nil {\n            return nil, errors.New(\"insertRowTableTwo failed. arg[1] must be convertable to int32\")\n        }\n        col2Val := int32(col2Int)\n        col3Int, err := strconv.ParseInt(args[2], 10, 32)\n        if err != nil {\n            return nil, errors.New(\"insertRowTableTwo failed. arg[2] must be convertable to int32\")\n        }\n        col3Val := int32(col3Int)\n        col4Val := args[3]\n\n        var columns []*shim.Column\n        col1 := shim.Column{Value: &amp;shim.Column_String_{String_: col1Val}}\n        col2 := shim.Column{Value: &amp;shim.Column_Int32{Int32: col2Val}}\n        col3 := shim.Column{Value: &amp;shim.Column_Int32{Int32: col3Val}}\n        col4 := shim.Column{Value: &amp;shim.Column_String_{String_: col4Val}}\n        columns = append(columns, &amp;col1)\n        columns = append(columns, &amp;col2)\n        columns = append(columns, &amp;col3)\n        columns = append(columns, &amp;col4)\n\n        row := shim.Row{Columns: columns}\n        ok, err := stub.InsertRow(\"tableTwo\", row)\n        if err != nil {\n            return nil, fmt.Errorf(\"insertRowTableTwo operation failed. %s\", err)\n        }\n        if !ok {\n            return nil, errors.New(\"insertRowTableTwo operation failed. Row with given key already exists\")\n        }\n</code></pre>\n\n<p>Now to query this data by not specifying all the keys, do as below </p>\n\n<pre><code>if len(args) &lt; 1 {\n            return nil, errors.New(\"getRowsTableTwo failed. Must include at least key values\")\n        }\n\n        var columns []shim.Column\n\n        col1Val := args[0]\n        col1 := shim.Column{Value: &amp;shim.Column_String_{String_: col1Val}}\n        columns = append(columns, col1)\n\n        if len(args) &gt; 1 {\n            col2Int, err := strconv.ParseInt(args[1], 10, 32)\n            if err != nil {\n                return nil, errors.New(\"getRowsTableTwo failed. arg[1] must be convertable to int32\")\n            }\n            col2Val := int32(col2Int)\n            col2 := shim.Column{Value: &amp;shim.Column_Int32{Int32: col2Val}}\n            columns = append(columns, col2)\n        }\n\n        rowChannel, err := stub.GetRows(\"tableTwo\", columns)\n        if err != nil {\n            return nil, fmt.Errorf(\"getRowsTableTwo operation failed. %s\", err)\n        }\n\n        var rows []shim.Row\n        for {\n            select {\n            case row, ok := &lt;-rowChannel:\n                if !ok {\n                    rowChannel = nil\n                } else {\n                    rows = append(rows, row)\n                }\n            }\n            if rowChannel == nil {\n                break\n            }\n        }\n\n        jsonRows, err := json.Marshal(rows)\n        if err != nil {\n            return nil, fmt.Errorf(\"getRowsTableTwo operation failed. Error marshaling JSON: %s\", err)\n        }\n\n        return jsonRows, nil\n</code></pre>\n\n<p>Once you have inserted the data, the API <em>stub.GetRows(\"tableTwo\", columns)</em> lets you retrieve it without specifying all the key columns.</p>\n\n<p>Above code is quoted from a file which was present in the Fabric github repo earlier in the following path gerrit/src/github.com/hyperledger/fabric/bddtests/chaincode/go/table/table.go</p>\n\n<p>Hope this helps. </p>\n"}, {"tags": [], "owner": {"reputation": 1938, "user_id": 8205919, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2fa64e238ce0ea70db6f924b050f4faa?s=128&d=identicon&r=PG&f=1", "display_name": "Dave Enyeart", "link": "https://stackoverflow.com/users/8205919/dave-enyeart"}, "is_accepted": false, "score": 0, "last_activity_date": 1501212015, "last_edit_date": 1501212015, "creation_date": 1501210272, "answer_id": 45364073, "question_id": 42666568, "link": "https://stackoverflow.com/questions/42666568/getting-world-state-by-value/45364073#45364073", "title": "Getting world state by value", "body": "<p>In Hyperledger Fabric v1.0 you can model your data as JSON and utilize CouchDB as the state database. In this case you can directly query on any field of the JSON.</p>\n\n<p>There is an example of such data patterns in the <a href=\"https://github.com/hyperledger/fabric/blob/release/examples/chaincode/go/marbles02/marbles_chaincode.go\" rel=\"nofollow noreferrer\">marbles02 chaincode</a>.</p>\n\n<p><a href=\"https://hyperledger-fabric.readthedocs.io/en/latest/ledger.html\" rel=\"nofollow noreferrer\">There are various other ledger and state database options in v1.0</a>.</p>\n"}], "owner": {"reputation": 23, "user_id": 7677029, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/ra6iZ.jpg?s=128&g=1", "display_name": "Ashar Ali", "link": "https://stackoverflow.com/users/7677029/ashar-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1175, "favorite_count": 2, "accepted_answer_id": 42671370, "answer_count": 2, "score": 1, "last_activity_date": 1501212015, "creation_date": 1488962325, "last_edit_date": 1488969066, "question_id": 42666568, "link": "https://stackoverflow.com/questions/42666568/getting-world-state-by-value", "title": "Getting world state by value", "body": "<p>I'm new to blockchain and working with hyperledger fabric (v:0.6 for now) to create an application for learning perspective. </p>\n\n<p>I'm keeping a ledger of financial transactions on blockchain, soon as a transaction takes place (A web based component notifies on transaction occurrence and calls the chaincode).</p>\n\n<p>The structure of transactions looks something like this:</p>\n\n<pre><code>type Transactions struct { \n    ReferenceNumber string `json:\"ReferenceNumber\"`\n    BillNumber string `json:\"BillNumber\"`\n    BillingCompany string `json:\"BillingCompany\"`\n    Amount string `json:\"Amount\"`\n    Status string `json:\"Status\"`\n}\n</code></pre>\n\n<p>I json marshal this and save it to state with ReferenceNumber as the key.</p>\n\n<p>Now I can get the transaction from state on the basis of ReferenceNumber. But what if I want to get the transaction from state on the basis of let's say 'Status' like how many transactions on the ledger have status as 'reconciled'.</p>\n\n<p>Is there any way to query state not on the basis of key but value?</p>\n"}, {"tags": ["mongodb", "go", "slice", "mgo"], "answers": [{"comments": [{"owner": {"reputation": 137, "user_id": 1824783, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7022c7b611fa0b6e48adbcf51ccba7a?s=128&d=identicon&r=PG", "display_name": "Olly B", "link": "https://stackoverflow.com/users/1824783/olly-b"}, "edited": false, "score": 0, "creation_date": 1488962707, "post_id": 42666371, "comment_id": 72458264, "body": "Awesome, thanks so much. I did spot it was removing just one, but thought it was dodgy data being passed to the bson functions."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 5, "last_activity_date": 1488961899, "last_edit_date": 1488961899, "creation_date": 1488961586, "answer_id": 42666371, "question_id": 42665941, "link": "https://stackoverflow.com/questions/42665941/how-to-pass-an-int-slice-to-in-using-mgo/42666371#42666371", "title": "How to pass an int slice to &quot;$in&quot; using mgo", "body": "<p>Your original proposal (passing an <code>[]int</code> value) has no flaws, it's valid to do that.</p>\n\n<p>What the problem is is that you use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.Remove\" rel=\"noreferrer\"><code>Collection.Remove()</code></a> which finds and removes a <strong>single</strong> document matching the provided selector document. So your proposed solution will remove <strong>exactly 1 document</strong>, one whose <code>search_id</code> is contained in the slice you passed. If no such document is found (and the session is in safe mode, see <a href=\"https://godoc.org/gopkg.in/mgo.v2#Session.SetSafe\" rel=\"noreferrer\"><code>Session.SetSafe()</code></a>), <a href=\"https://godoc.org/gopkg.in/mgo.v2#ErrNotFound\" rel=\"noreferrer\"><code>mgo.ErrNotFound</code></a> is returned.</p>\n\n<p>Instead use <a href=\"https://godoc.org/gopkg.in/mgo.v2#Collection.RemoveAll\" rel=\"noreferrer\"><code>Collection.RemoveAll()</code></a> which finds and removes <strong>all</strong> documents matching the selector:</p>\n\n<pre><code>toRemove := []int{1,2,4,7,9}\ninfo, err := c.RemoveAll(bson.M{\"search_id\": bson.M{\"$in\": toRemove}})\n\nif err != nil {\n    log.Printf(\"Failed to remove: %v\", err)\n} else {\n    log.Printf(\"Removed %d documents.\", info.Removed)\n}\n</code></pre>\n"}], "owner": {"reputation": 137, "user_id": 1824783, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/a7022c7b611fa0b6e48adbcf51ccba7a?s=128&d=identicon&r=PG", "display_name": "Olly B", "link": "https://stackoverflow.com/users/1824783/olly-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1560, "favorite_count": 2, "accepted_answer_id": 42666371, "answer_count": 1, "score": 2, "last_activity_date": 1488961899, "creation_date": 1488960065, "last_edit_date": 1488961696, "question_id": 42665941, "link": "https://stackoverflow.com/questions/42665941/how-to-pass-an-int-slice-to-in-using-mgo", "title": "How to pass an int slice to &quot;$in&quot; using mgo", "body": "<p>I'm having a bit of trouble creating a query using the bson functionality of <code>mgo</code>. I'm simply trying to do <code>{'search_id': {'$in': [1,2,4,7,9]}}</code>, but I can't work out how to do it in <code>mgo</code>.</p>\n\n<p>I have a slice of <code>int</code>s, and tried passing that directly:</p>\n\n<pre><code>toRemove := []int{1,2,4,7,9}\nerr = coll.Remove(bson.M{\"search_id\": bson.M{\"$in\": toRemove}})\n</code></pre>\n\n<p>I saw another post which suggested I needed to use <code>[]interface{}</code>, but that doesn't work either:</p>\n\n<pre><code>toRemoveI := make([]interface{}, len(toRemove))\nfor idx, val := range toRemove {\n    toRemoveI[idx] = val\n}\nerr = coll.Remove(bson.M{\"search_id\": bson.M{\"$in\": toRemoveI}})\n</code></pre>\n\n<p>I've looked through he docs and other questions here and on gh, but most questions involving slices seem to be about getting data into a slice as opposed to what I'm trying to achieve.</p>\n\n<p>Any help would be most appreciated.</p>\n"}, {"tags": ["go", "reflection", "unsafe-pointers"], "answers": [{"comments": [{"owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1488983975, "post_id": 42666934, "comment_id": 72473009, "body": "Ok but how can you know what the type is so that you can call the right method?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1488984051, "post_id": 42666934, "comment_id": 72473070, "body": "@UAvalos E.g. by calling <a href=\"https://golang.org/pkg/reflect/#Value.Type\" rel=\"nofollow noreferrer\"><code>Value.Type()</code></a> (on the field&#39;s value)."}, {"owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1489008340, "post_id": 42666934, "comment_id": 72488511, "body": "wouldn&#39;t that result in a really painful switch block? ex: case Uint, case Uint8, Uint16, etc..."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "edited": false, "score": 0, "creation_date": 1489027839, "post_id": 42666934, "comment_id": 72495246, "body": "@UAvalos If you want to handle all types, unfortunately yes. If you just want to print its value, you may simply use <code>Value.String()</code> which does this inside it. Also note that <code>Value.Int()</code> for example handles all signed integer types (e.g. <code>int8</code>, <code>int16</code>, <code>int32</code>, <code>int64</code> and <code>int</code>) so these help you &quot;ease&quot; the pain."}, {"owner": {"reputation": 875, "user_id": 4283659, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/9QGUw.jpg?s=128&g=1", "display_name": "nhooyr", "link": "https://stackoverflow.com/users/4283659/nhooyr"}, "edited": false, "score": 0, "creation_date": 1549262138, "post_id": 42666934, "comment_id": 95825462, "body": "Value.String() only returns the value if its a string. Otherwise it returns the string of the type of the value."}, {"owner": {"reputation": 324088, "user_id": 1256452, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/fa1648baa6108c85886312af93bb32c0?s=128&d=identicon&r=PG", "display_name": "torek", "link": "https://stackoverflow.com/users/1256452/torek"}, "edited": false, "score": 0, "creation_date": 1565395652, "post_id": 42666934, "comment_id": 101353961, "body": "As @icza notes, the pain is not <i>too</i> painful. See <a href=\"https://play.golang.org/p/uB5KJYZzR5v\" rel=\"nofollow noreferrer\">play.golang.org/p/uB5KJYZzR5v</a> for a sample that started with the <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">Laws of Reflection blog post</a>, to which I added some more accessors for private fields."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1488964623, "last_edit_date": 1488964623, "creation_date": 1488963600, "answer_id": 42666934, "question_id": 42664837, "link": "https://stackoverflow.com/questions/42664837/how-to-access-unexported-struct-fields/42666934#42666934", "title": "How to access unexported struct fields", "body": "<p><a href=\"https://golang.org/pkg/reflect/#DeepEqual\" rel=\"nofollow noreferrer\"><code>reflect.DeepEqual()</code></a> can do it because it has access to unexported features of the <a href=\"https://golang.org/pkg/reflect/\" rel=\"nofollow noreferrer\"><code>reflect</code></a> package, in this case namely for the <code>valueInterface()</code> function, which takes a <code>safe</code> argument, which denies access to unexported field values via the <a href=\"https://golang.org/pkg/reflect/#Value.Interface\" rel=\"nofollow noreferrer\"><code>Value.Interface()</code></a> method if <code>safe=true</code>. <code>reflect.DeepEqual()</code> will (might) call that passing <code>safe=false</code>.</p>\n\n<p>You can still do it, but you cannot use <code>Value.Interface()</code> for unexported fields. Instead you have to use type-specific methods, such as <a href=\"https://golang.org/pkg/reflect/#Value.String\" rel=\"nofollow noreferrer\"><code>Value.String()</code></a> for <code>string</code>, <a href=\"https://golang.org/pkg/reflect/#Value.Float\" rel=\"nofollow noreferrer\"><code>Value.Float()</code></a> for floats, <a href=\"https://golang.org/pkg/reflect/#Value.Int\" rel=\"nofollow noreferrer\"><code>Value.Int()</code></a> for ints etc. These will return you a copy of the value (which is enough to inspect it), but will not allow you to modify the field's value (which might be \"partly\" possible if <code>Value.Interface()</code> would work and the field type would be a pointer type).</p>\n\n<p>If a field happens to be an interface type, you may use <a href=\"https://golang.org/pkg/reflect/#Value.Elem\" rel=\"nofollow noreferrer\"><code>Value.Elem()</code></a> to get to the value contained / wrapped by the interface value.</p>\n\n<p>To demonstrate:</p>\n\n<pre><code>type Foo struct {\n    s string\n    i int\n    j interface{}\n}\n\nfunc main() {\n    x := Foo{\"hello\", 2, 3.0}\n    v := reflect.ValueOf(x)\n\n    s := v.FieldByName(\"s\")\n    fmt.Printf(\"%T %v\\n\", s.String(), s.String())\n\n    i := v.FieldByName(\"i\")\n    fmt.Printf(\"%T %v\\n\", i.Int(), i.Int())\n\n    j := v.FieldByName(\"j\").Elem()\n    fmt.Printf(\"%T %v\\n\", j.Float(), j.Float())\n}\n</code></pre>\n\n<p>Output (try it on the <a href=\"https://play.golang.org/p/u9fz2JeDyb\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>string hello\nint64 2\nfloat64 3\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 447, "user_id": 1112789, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2287b19cc7cf919a0850544a98d4d844?s=128&d=identicon&r=PG", "display_name": "user1112789", "link": "https://stackoverflow.com/users/1112789/user1112789"}, "edited": false, "score": 0, "creation_date": 1503494242, "post_id": 43918797, "comment_id": 78639066, "body": "Brilliant trick, thank you. Combined with <code>FieldByName</code>, this is quite powerful, albeit dirty."}, {"owner": {"user_type": "does_not_exist", "display_name": "user12211419"}, "edited": false, "score": 0, "creation_date": 1581150449, "post_id": 43918797, "comment_id": 106340937, "body": "what is meant by the &quot;struct is addressable&quot;?"}, {"owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "edited": false, "score": 2, "creation_date": 1581250038, "post_id": 43918797, "comment_id": 106360742, "body": "@rakim: it means it you can take the address of it\u2014e.g., it&#39;s a local variable or on the heap\u2014rather than a temporary value such as the return value of a function.  You can read more here: <a href=\"https://utcc.utoronto.ca/~cks/space/blog/programming/GoAddressableValues\" rel=\"nofollow noreferrer\">utcc.utoronto.ca/~cks/space/blog/programming/&hellip;</a>"}], "tags": [], "owner": {"reputation": 1192, "user_id": 4969945, "user_type": "registered", "accept_rate": 11, "profile_image": "https://lh3.googleusercontent.com/-V_gW7xpKyDI/AAAAAAAAAAI/AAAAAAAAH7o/Fvn3wFRSbMA/photo.jpg?sz=128", "display_name": "cpcallen", "link": "https://stackoverflow.com/users/4969945/cpcallen"}, "is_accepted": false, "score": 27, "last_activity_date": 1583748642, "last_edit_date": 1583748642, "creation_date": 1494514009, "answer_id": 43918797, "question_id": 42664837, "link": "https://stackoverflow.com/questions/42664837/how-to-access-unexported-struct-fields/43918797#43918797", "title": "How to access unexported struct fields", "body": "<p>If the struct is addressable, you can use <code>unsafe.Pointer</code> to access the field (read <em>or write</em>) it, like this:</p>\n\n<pre><code>rs := reflect.ValueOf(&amp;MyStruct).Elem()\nrf := rs.Field(n)\n// rf can't be read or set.\nrf = reflect.NewAt(rf.Type(), unsafe.Pointer(rf.UnsafeAddr())).Elem()\n// Now rf can be read and set.\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/DXXHuIvRLI\" rel=\"noreferrer\">See full example on the playground.</a></p>\n\n<p>This use of <code>unsafe.Pointer</code> is valid according to the <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"noreferrer\">documentation</a> and running <code>go vet</code> returns no errors.</p>\n\n<p>If the struct is not addressable this trick won't work, but you can create an addressable copy like this:</p>\n\n<pre><code>rs = reflect.ValueOf(MyStruct)\nrs2 := reflect.New(rs.Type()).Elem()\nrs2.Set(rs)\nrf = rs2.Field(0)\nrf = reflect.NewAt(rf.Type(), unsafe.Pointer(rf.UnsafeAddr())).Elem()\n// Now rf can be read.  Setting will succeed but only affects the temporary copy.\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IEMwafEOZm\" rel=\"noreferrer\">See full example on the playground.</a></p>\n"}, {"tags": [], "owner": {"reputation": 7522, "user_id": 2142441, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/1296edcd40a8fb8af4086e1544fcc2a9?s=128&d=identicon&r=PG", "display_name": "mattes", "link": "https://stackoverflow.com/users/2142441/mattes"}, "is_accepted": false, "score": 6, "last_activity_date": 1583750411, "creation_date": 1583750411, "answer_id": 60598827, "question_id": 42664837, "link": "https://stackoverflow.com/questions/42664837/how-to-access-unexported-struct-fields/60598827#60598827", "title": "How to access unexported struct fields", "body": "<p>Based on <a href=\"https://stackoverflow.com/a/43918797/2142441\">cpcallen</a>'s work:</p>\n\n<pre><code>import (\n    \"reflect\"\n    \"unsafe\"\n)\n\nfunc GetUnexportedField(field reflect.Value) interface{} {\n    return reflect.NewAt(field.Type(), unsafe.Pointer(field.UnsafeAddr())).Elem().Interface()\n}\n\nfunc SetUnexportedField(field reflect.Value, value interface{}) {\n    reflect.NewAt(field.Type(), unsafe.Pointer(field.UnsafeAddr())).\n        Elem().\n        Set(reflect.ValueOf(value))\n}\n\n</code></pre>\n\n<hr>\n\n<p><code>reflect.NewAt</code> might be confusing to read at first. It returns a <code>reflect.Value</code> representing a pointer to a value of the specified <code>field.Type()</code>, using <code>unsafe.Pointer(field.UnsafeAddr())</code> as that pointer. In this context <code>reflect.NewAt</code> is different than <code>reflect.New</code>, which would return a pointer to a freshly initialized value.</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>type Foo struct {\n    unexportedField string\n}\n\nGetUnexportedField(reflect.ValueOf(&amp;Foo{}).Elem().FieldByName(\"unexportedField\"))\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/IgjlQPYdKFR\" rel=\"noreferrer\">https://play.golang.org/p/IgjlQPYdKFR</a></p>\n"}], "owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14528, "favorite_count": 7, "answer_count": 3, "score": 16, "last_activity_date": 1607524529, "creation_date": 1488956130, "last_edit_date": 1607524529, "question_id": 42664837, "link": "https://stackoverflow.com/questions/42664837/how-to-access-unexported-struct-fields", "title": "How to access unexported struct fields", "body": "<p>Is there a way to use reflect to access unexported fields in Go 1.8?\nThis no longer seems to work: <a href=\"https://stackoverflow.com/a/17982725/555493\">https://stackoverflow.com/a/17982725/555493</a></p>\n<p>Note that <code>reflect.DeepEqual</code> works just fine (that is, it can access unexported fields) but I can't make heads or tails of that function. Here's a go playarea that shows it in action: <a href=\"https://play.golang.org/p/vyEvay6eVG\" rel=\"nofollow noreferrer\">https://play.golang.org/p/vyEvay6eVG</a>. The src code is below</p>\n<pre><code>import (\n&quot;fmt&quot;\n&quot;reflect&quot;\n)\n\ntype Foo struct {\n  private string\n}\n\nfunc main() {\n    x := Foo{&quot;hello&quot;}\n    y := Foo{&quot;goodbye&quot;}\n    z := Foo{&quot;hello&quot;}\n\n    fmt.Println(reflect.DeepEqual(x,y)) //false\n    fmt.Println(reflect.DeepEqual(x,z)) //true\n}\n</code></pre>\n"}, {"tags": ["ssl", "go", "tls1.2"], "comments": [{"owner": {"reputation": 288867, "user_id": 207421, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/5cfe5f7d64f44be04f147295f5c7b88e?s=128&d=identicon&r=PG", "display_name": "user207421", "link": "https://stackoverflow.com/users/207421/user207421"}, "edited": false, "score": 0, "creation_date": 1493115244, "post_id": 42664156, "comment_id": 74264419, "body": "I don&#39;t know Go but there are three cases to consider, which should inform your &#39;adamant requriement&#39;: (1) the client didn&#39;t have a certificate; (2) the client didn&#39;t have a certificate signed by a signer the server would accept, in which case it won&#39;t send it; (3) the client did have such a certificate, and sent it, but it was invalid/expired/revoked/whatever. You should not be looking to treat these three cases identically."}, {"owner": {"reputation": 3963, "user_id": 313842, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/079eaa8db01799df3abfa6abdc82e764?s=128&d=identicon&r=PG&f=1", "display_name": "awy", "link": "https://stackoverflow.com/users/313842/awy"}, "edited": false, "score": 0, "creation_date": 1588321120, "post_id": 42664156, "comment_id": 108856845, "body": "Did you make any progress with this?"}], "answers": [{"comments": [{"owner": {"reputation": 303, "user_id": 2829757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0231f62bf3e26f7d0585656f563b9a52?s=128&d=identicon&r=PG&f=1", "display_name": "jsc", "link": "https://stackoverflow.com/users/2829757/jsc"}, "edited": false, "score": 0, "creation_date": 1493593661, "post_id": 43606908, "comment_id": 74468490, "body": "Hi George, thanks for your reply. I&#39;ve tried calling <code>tlscon.Handshake()</code> but the server reports <code>remote error: tls: bad certificate</code>. In your example I can&#39;t see where you load the client certificate?"}], "tags": [], "owner": {"reputation": 619, "user_id": 442952, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/adcdd4080503216e19cee81f413e6eb3?s=128&d=identicon&r=PG", "display_name": "George Antoniadis", "link": "https://stackoverflow.com/users/442952/george-antoniadis"}, "is_accepted": false, "score": 0, "last_activity_date": 1493112995, "creation_date": 1493112995, "answer_id": 43606908, "question_id": 42664156, "link": "https://stackoverflow.com/questions/42664156/how-can-client-certificate-be-manually-validated-with-go-tls-without-forcing-dis/43606908#43606908", "title": "How can client-certificate be manually validated with Go TLS without forcing disconnection?", "body": "<p>I spent the best of my afternoon on this one too.</p>\n\n<p>Once the server accepts the connection you will need to explicitely call <code>tlscon.Handshake()</code> to get the client's certificate, otherwise the tls package will do it automatically after the first i/o. <a href=\"https://golang.org/pkg/crypto/tls/#Conn.Handshake\" rel=\"nofollow noreferrer\">https://golang.org/pkg/crypto/tls/#Conn.Handshake</a></p>\n\n<p>You can see a example <a href=\"https://gist.github.com/geoah/31340b8155318a3661b1555c191470b5\" rel=\"nofollow noreferrer\">here</a>.</p>\n"}], "owner": {"reputation": 303, "user_id": 2829757, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/0231f62bf3e26f7d0585656f563b9a52?s=128&d=identicon&r=PG&f=1", "display_name": "jsc", "link": "https://stackoverflow.com/users/2829757/jsc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2573, "favorite_count": 1, "answer_count": 1, "score": 6, "last_activity_date": 1612460684, "creation_date": 1488953329, "last_edit_date": 1612460684, "question_id": 42664156, "link": "https://stackoverflow.com/questions/42664156/how-can-client-certificate-be-manually-validated-with-go-tls-without-forcing-dis", "title": "How can client-certificate be manually validated with Go TLS without forcing disconnection?", "body": "<p>We are building a server in Golang that opens a TCP port over SSL.</p>\n\n<p>We would like to enable mutual-authentication between the client and the server. But also detect when a client attempts to connect to our server without a valid client certificate and return them a error message over SSL - such as \"invalid client certificate detected, please contact company ABC for assistance\".</p>\n\n<p>Just to be clear: we are adamant about our requirement to return data over SSL to clients that fail to mutually authenticate with the server. We do not want to disconnect them.</p>\n\n<p>The approach we have taken is to use the 'VerifyClientCertIfGiven' configuration setting for TLS.</p>\n\n<p>Whereby, we verify the client certificate if it is given, but we still allow an SSL connection to be established if it isn't.</p>\n\n<p>How can we find out:</p>\n\n<ol>\n<li>Was a client certificate provided?</li>\n<li>If so, did it pass the mutual authentication checks performed by TLS?</li>\n</ol>\n\n<p>Below is the code of our server:</p>\n\n<pre><code>package main\n\nimport(\n  \"fmt\"\n  \"io/ioutil\"\n  \"crypto/tls\"\n  \"crypto/x509\"\n)\n\nfunc main(){\n  // Configure SSL\n  cert, err := tls.LoadX509KeyPair(\"server.crt\", \"server.key\")\n  caCert, _ := ioutil.ReadFile(\"client.crt\")\n  caCertPool := x509.NewCertPool()\n  caCertPool.AppendCertsFromPEM(caCert)\n  config := &amp;tls.Config{\n    Certificates: []tls.Certificate{cert},\n    ClientCAs: caCertPool,\n    ClientAuth: tls.VerifyClientCertIfGiven,\n  }\n  config.BuildNameToCertificate()\n  // Listen on port 443\n  listener, _ := tls.Listen(\"tcp\", \":443\", config)\n  defer listener.Close()\n  // Accept incoming connection\n  conn, _ := listener.Accept()\n  defer conn.Close()\n  // Print ConnectionState\n  tlscon, _ := conn.(*tls.Conn)\n  fmt.Println(tlscon.ConnectionState())\n}\n</code></pre>\n\n<p>And below is the code of our client:</p>\n\n<pre><code>package main\nimport (\n  \"io/ioutil\"\n  \"crypto/tls\"\n  \"crypto/x509\"\n)\n\nfunc main(){\n  //Configure SSL\n  cert, _ := tls.LoadX509KeyPair(\"client.crt\", \"client.key\"\n  caCert, _ := io.util.ReadFile(\"server.crt\")\n  caCertPool := x509.NewCertPool()\n  caCertPool.AppendCertsFromPEM(caCert)\n  config := &amp;tls.Config{\n    Certificates: []tls.Certificate{cert},\n    RootCAs:      caCertPool,\n  }\n  config.BuildNameToCertificate()\n  // Connect to server\n  conn, _ := tls.Dial(\"tcp\", \"127.0.0.1:443\", config)\n  defer conn.Close()\n}\n</code></pre>\n\n<p>The output:</p>\n\n<pre><code>{0 false false 0  false  [] [] [] [] []}\n</code></pre>\n\n<p>We've tried implementing conn.ConnectionState().PeerCertificates on the server but in all our attempts, it was an empty byte array.</p>\n\n<p>Thank you in advance. We appreciate your time trying to help us.</p>\n\n<p>Kind Regards,</p>\n\n<p>Julian</p>\n"}, {"tags": ["go", "go-templates"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488949908, "post_id": 42662525, "comment_id": 72452412, "body": "Undoable in templates. You must do this either directly in your Go code or expose a function like TrimTrailingComma to your template."}, {"owner": {"reputation": 141, "user_id": 3676525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9d0526f62c931a5ad19aac367edc1fc9?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/3676525/chris"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488959117, "post_id": 42662525, "comment_id": 72456399, "body": "thank you, I will find other way to solve it"}, {"owner": {"reputation": 372, "user_id": 1214879, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/HTNHK.jpg?s=128&g=1", "display_name": "j boschiero", "link": "https://stackoverflow.com/users/1214879/j-boschiero"}, "edited": false, "score": 0, "creation_date": 1510685073, "post_id": 42662525, "comment_id": 81536883, "body": "I think the most elegant solution can be found via this question/answer: <a href=\"https://stackoverflow.com/questions/10747054/special-case-treatment-for-the-last-element-of-a-range-in-google-gos-text-templ\" title=\"special case treatment for the last element of a range in google gos text templ\">stackoverflow.com/questions/10747054/&hellip;</a>"}, {"owner": {"reputation": 5539, "user_id": 871134, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/BKxlV.jpg?s=128&g=1", "display_name": "Deleplace", "link": "https://stackoverflow.com/users/871134/deleplace"}, "reply_to_user": {"reputation": 372, "user_id": 1214879, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/HTNHK.jpg?s=128&g=1", "display_name": "j boschiero", "link": "https://stackoverflow.com/users/1214879/j-boschiero"}, "edited": false, "score": 0, "creation_date": 1516272851, "post_id": 42662525, "comment_id": 83624440, "body": "@jboschiero The elegant solution works for slices, not for maps."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1552856364, "post_id": 42662525, "comment_id": 97159631, "body": "@Volker It&#39;s possible since Go 1.11. See <a href=\"https://stackoverflow.com/a/55211847/1705598\">answer below</a>."}], "answers": [{"comments": [{"owner": {"reputation": 141, "user_id": 3676525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9d0526f62c931a5ad19aac367edc1fc9?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/3676525/chris"}, "edited": false, "score": 0, "creation_date": 1488959182, "post_id": 42663928, "comment_id": 72456436, "body": "As @Volker says, no way to do this in template, maybe this is the best solution"}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 9, "last_activity_date": 1569590112, "last_edit_date": 1569590112, "creation_date": 1488952276, "answer_id": 42663928, "question_id": 42662525, "link": "https://stackoverflow.com/questions/42662525/go-template-remove-the-last-comma-in-range-loop/42663928#42663928", "title": "Go template remove the last comma in range loop", "body": "<p>Here's how to write comma separated key-value pairs using a template function. </p>\n\n<p>Declare a function that returns a function that increments and returns a counter:</p>\n\n<pre><code>func counter() func() int {\n    i := -1\n    return func() int {\n        i++\n        return i\n    }\n}\n</code></pre>\n\n<p>Add this function to the template:</p>\n\n<pre><code>t := template.Must(template.New(\"example\").Funcs(template.FuncMap{\"counter\": counter}).Parse(temp))\n</code></pre>\n\n<p>Use it in the template like this:</p>\n\n<pre><code>    {{$c := counter}}{{range $key, $value := $}}{{if call $c}}, {{end}}key:{{$key}} value:{{$value}}{{end}}\n</code></pre>\n\n<p>This template writes the separators before the key-value pairs instead after the pairs. </p>\n\n<p>The counter is created before the loop and incremented on each iteration through the loop. The separator is not written the first time through the loop.</p>\n\n<p><a href=\"https://play.golang.org/p/M6QNYYt_0p\" rel=\"nofollow noreferrer\">Run it in the playground.</a></p>\n\n<p>The logic in the template can be simplified by moving the if statement to Go code:</p>\n\n<pre><code>func separator(s string) func() string {\n    i := -1\n    return func() string {\n        i++\n        if i == 0 {\n            return \"\"\n        }\n        return s\n    }\n}\n</code></pre>\n\n<p>Add the function to the template:</p>\n\n<pre><code>t := template.Must(template.New(\"example\").Funcs(template.FuncMap{\"separator\": separator}).Parse(temp))\n</code></pre>\n\n<p>Use it like this:</p>\n\n<pre><code>{{$s := separator \", \"}}{{range $key, $value := $}}{{call $s}}key:{{$key}} value:{{$value}}{{end}}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/HF5nAN37i6q\" rel=\"nofollow noreferrer\">Run it on the playground</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 11332, "user_id": 52499, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/e13c0896a2408caf559934466737f716?s=128&d=identicon&r=PG", "display_name": "x-yuri", "link": "https://stackoverflow.com/users/52499/x-yuri"}, "edited": false, "score": 0, "creation_date": 1562009666, "post_id": 55211847, "comment_id": 100234906, "body": "Do you know by any chance which version of Docker I need for it to work?"}, {"owner": {"reputation": 1350, "user_id": 1503600, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oQY3d.png?s=128&g=1", "display_name": "charli", "link": "https://stackoverflow.com/users/1503600/charli"}, "edited": false, "score": 0, "creation_date": 1590941615, "post_id": 55211847, "comment_id": 109865356, "body": "great, this simplifies a lot when there are nested loops."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 15, "last_activity_date": 1552856257, "creation_date": 1552856257, "answer_id": 55211847, "question_id": 42662525, "link": "https://stackoverflow.com/questions/42662525/go-template-remove-the-last-comma-in-range-loop/55211847#55211847", "title": "Go template remove the last comma in range loop", "body": "<p>Since Go 1.11 <a href=\"https://golang.org/doc/go1.11#text/template\" rel=\"noreferrer\">it is now possible to change values of template variables</a>. This gives us the possibility to do this without the need of a custom function (being outside of the template).</p>\n\n<p>The following template does that:</p>\n\n<pre><code>{{$first := true}}\n{{range $key, $value := $}}\n    {{if $first}}\n        {{$first = false}}\n    {{else}}\n        ,\n    {{end}}\n    key:{{$key}} value:{{$value}}\n{{end}}\n</code></pre>\n\n<p>Here's the altered working example from the question:</p>\n\n<pre><code>type Map map[string]string\nm := Map{\n    \"a\": \"b\",\n    \"c\": \"d\",\n    \"e\": \"f\",\n}\nconst temp = `{{$first := true}}{{range $key, $value := $}}{{if $first}}{{$first = false}}{{else}}, {{end}}key:{{$key}} value:{{$value}}{{end}}`\nt := template.Must(template.New(\"example\").Parse(temp))\nt.Execute(os.Stdout, m)\n</code></pre>\n\n<p>Which outputs (try it on the <a href=\"https://play.golang.org/p/82imTtvHWzb\" rel=\"noreferrer\">Go Playground</a>):</p>\n\n<pre><code>key:a value:b, key:c value:d, key:e value:f\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 3676525, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/9d0526f62c931a5ad19aac367edc1fc9?s=128&d=identicon&r=PG", "display_name": "Chris", "link": "https://stackoverflow.com/users/3676525/chris"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5056, "favorite_count": 2, "accepted_answer_id": 42663928, "answer_count": 2, "score": 11, "last_activity_date": 1569590112, "creation_date": 1488944263, "question_id": 42662525, "link": "https://stackoverflow.com/questions/42662525/go-template-remove-the-last-comma-in-range-loop", "title": "Go template remove the last comma in range loop", "body": "<p>I have code like this:</p>\n\n<pre><code>package main\n\nimport (\n    \"text/template\"\n    \"os\"\n)\n\nfunc main() {\n    type Map map[string]string\n    m := Map {\n        \"a\": \"b\",\n        \"c\": \"d\",\n    }\n    const temp = `{{range $key, $value := $}}key:{{$key}} value:{{$value}},{{end}}`\n    t := template.Must(template.New(\"example\").Parse(temp))\n    t.Execute(os.Stdout, m)\n}\n</code></pre>\n\n<p>it will output :</p>\n\n<blockquote>\n  <p>key:a value:b,key:c value:d,</p>\n</blockquote>\n\n<p>but I want something like this:</p>\n\n<blockquote>\n  <p>key:a value:b,key:c value:d</p>\n</blockquote>\n\n<p>I don't need the last comma, how to remove it. I found a solution for looping an array here: <a href=\"https://groups.google.com/d/msg/golang-nuts/XBScetK-guk/Bh7ZFz6R3wQJ\" rel=\"noreferrer\">https://groups.google.com/d/msg/golang-nuts/XBScetK-guk/Bh7ZFz6R3wQJ</a> , but I can't get index for a map.</p>\n"}, {"tags": ["go", "https", "proxy"], "comments": [{"owner": {"reputation": 2422, "user_id": 202311, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7408fce5260e98922355385680be0179?s=128&d=identicon&r=PG", "display_name": "IanB", "link": "https://stackoverflow.com/users/202311/ianb"}, "edited": false, "score": 0, "creation_date": 1488969462, "post_id": 42662369, "comment_id": 72462620, "body": "I tested your code against my proxy server and it worked fine. It may be a configuration problem with your proxy. Have you tried using an ordinary web browser with this proxy?"}, {"owner": {"reputation": 71, "user_id": 7602230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c039580b1223a7cdee46d7d966bdcd6?s=128&d=identicon&r=PG&f=1", "display_name": "Operations Zhang Jun", "link": "https://stackoverflow.com/users/7602230/operations-zhang-jun"}, "reply_to_user": {"reputation": 2422, "user_id": 202311, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7408fce5260e98922355385680be0179?s=128&d=identicon&r=PG", "display_name": "IanB", "link": "https://stackoverflow.com/users/202311/ianb"}, "edited": false, "score": 0, "creation_date": 1489029910, "post_id": 42662369, "comment_id": 72495829, "body": "hi,IanB  what is your proxy server? I use nginx (Reverse proxy).  Do you use  [TLSNextProto] to stop http2?"}, {"owner": {"reputation": 2422, "user_id": 202311, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/7408fce5260e98922355385680be0179?s=128&d=identicon&r=PG", "display_name": "IanB", "link": "https://stackoverflow.com/users/202311/ianb"}, "edited": false, "score": 0, "creation_date": 1489096055, "post_id": 42662369, "comment_id": 72534064, "body": "I use Squid proxy. No, I do not specify TLSNextProto. A reverse proxy should not require the client to use <i>any</i> special proxy configuration i.e. it should be transparent"}, {"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1567626211, "post_id": 42662369, "comment_id": 102022889, "body": "Dup of the title: <a href=\"https://stackoverflow.com/questions/51845690/how-to-program-go-to-use-a-proxy\">How to program Go to use a proxy?</a>, but not the same problem."}, {"owner": {"reputation": 333, "user_id": 9227137, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d39d284bda17297ff1b3e91665b4aa19?s=128&d=identicon&r=PG&f=1", "display_name": "Svyatoslav Pidgorny", "link": "https://stackoverflow.com/users/9227137/svyatoslav-pidgorny"}, "edited": false, "score": 0, "creation_date": 1605742826, "post_id": 42662369, "comment_id": 114748656, "body": "I am quite certain that the problem is with the proxy URL. Specifically, proxies must be accessed using HTTP protocol, and you specify HTTPS."}], "answers": [{"comments": [{"owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "edited": false, "score": 0, "creation_date": 1568748654, "post_id": 57795428, "comment_id": 102370957, "body": "Forward HTTP proxy: <a href=\"https://superuser.com/a/1262330/114579\">How exactly does a proxy work?</a>"}], "tags": [], "owner": {"reputation": 40328, "user_id": 86967, "user_type": "registered", "accept_rate": 56, "profile_image": "https://www.gravatar.com/avatar/624a9d99ab6293522102feab52c61f36?s=128&d=identicon&r=PG&f=1", "display_name": "Brent Bradburn", "link": "https://stackoverflow.com/users/86967/brent-bradburn"}, "is_accepted": false, "score": 1, "last_activity_date": 1567629978, "creation_date": 1567629978, "answer_id": 57795428, "question_id": 42662369, "link": "https://stackoverflow.com/questions/42662369/how-to-do-a-https-request-with-proxy/57795428#57795428", "title": "How to do a https request with proxy", "body": "<p>There doesn't appear to be anything wrong with your <code>Client.Transport.Proxy</code> configuration.  Both attempted approaches (<a href=\"https://golang.org/pkg/net/http/#ProxyURL\" rel=\"nofollow noreferrer\"><code>ProxyURL</code></a> and <a href=\"https://golang.org/pkg/net/http/#ProxyFromEnvironment\" rel=\"nofollow noreferrer\"><code>ProxyFromEnvironment</code></a>) should work fine to specify a <a href=\"https://en.wikipedia.org/w/index.php?title=Proxy_server&amp;oldid=913996143#Types_of_proxy_servers\" rel=\"nofollow noreferrer\">forward proxy</a>.</p>\n\n<p>Relevant question: <a href=\"https://stackoverflow.com/q/51845690/86967\">How to program Go to use a proxy?</a></p>\n\n<p>Something to look out for, however unlikely, is that subsequent client-side calls to not somehow bypass the use of <a href=\"https://golang.org/pkg/net/http/#Request.WriteProxy\" rel=\"nofollow noreferrer\">WriteProxy</a> and instead call <a href=\"https://golang.org/pkg/net/http/#Request.Write\" rel=\"nofollow noreferrer\">Write</a> directly -- since this would defeat the proxy specification.</p>\n\n<hr>\n\n<p>Given the information provided here, \"Bad Request\" likely indicates that you are reaching the proxy, but that it is not working correctly as a generic HTTP/HTTPS forward proxy, which is what <code>Client.Transport.Proxy</code> would specify.  </p>\n\n<p>Maybe some clarity would be added here: <a href=\"https://serverfault.com/questions/298392/how-to-use-nginx-as-a-http-https-proxy-server\">How to use Nginx as a HTTP/HTTPS proxy server?</a>.  In summary, NGINX is not normally used as a forward proxy, so maybe this isn't what you are trying to do.</p>\n\n<p><em>If you are trying to use NGINX as a reverse proxy, then configuration is a server-side concern and your clients do not need special proxy configuration -- just change your request URL to point to the proxy.</em></p>\n\n<hr>\n\n<p>Side note: If not otherwise specified, <code>&amp;http.Client{}</code> will use <a href=\"https://golang.org/pkg/net/http/#RoundTripper\" rel=\"nofollow noreferrer\"><code>DefaultTransport</code></a> which automatically includes <code>ProxyFromEnvironment</code>, so the extra proxy configuration is only required if you are constructing a non-default Transport (as is done in the question in order to specify <a href=\"https://stackoverflow.com/q/38822764/86967\"><code>InsecureSkipVerify</code></a>) or you want to have an application-specific proxy confuration.  <em>And, to repeat, client-side proxy configuration is only needed when using a forward proxy.</em></p>\n"}], "owner": {"reputation": 71, "user_id": 7602230, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4c039580b1223a7cdee46d7d966bdcd6?s=128&d=identicon&r=PG&f=1", "display_name": "Operations Zhang Jun", "link": "https://stackoverflow.com/users/7602230/operations-zhang-jun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15571, "favorite_count": 4, "answer_count": 1, "score": 7, "last_activity_date": 1611065622, "creation_date": 1488943219, "last_edit_date": 1611065622, "question_id": 42662369, "link": "https://stackoverflow.com/questions/42662369/how-to-do-a-https-request-with-proxy", "title": "How to do a https request with proxy", "body": "<p>I am able to do a http or https client request without setting up a proxy,</p>\n<pre><code>enter code here\ntr := &amp;http.Transport{\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},     \n}\n\nclient := &amp;http.Client{}\nclient.Transport = tr\n\nrequest, err := http.NewRequest(&quot;HEAD&quot;, &quot;http://www.???.com&quot;, nil)\nrequest.Header.Set(&quot;User-Agent&quot;, &quot;Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&quot;)\n\nresp, err := client.Do(request)\n\nif err != nil {\n    log.Fatalln(err)\n    return\n}\ndefer resp.Body.Close()\n\nhttpcode = resp.Status\n</code></pre>\n<p>This script is working ok, I get a 200 ok when I request https url, but if I set up proxy , the script:</p>\n<pre><code>proxyString := &quot;https://47.91.179.xxx:443&quot;\nproxyUrl, _ := url.Parse(proxyString)\n\ntr := &amp;http.Transport{\n    Proxy: http.ProxyURL(proxyUrl),\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true}, \n    \n}\n\nclient := &amp;http.Client{}\nclient.Transport = tr\n\n....................\n</code></pre>\n<p>I always get &quot;Bad request&quot;, I read docs: <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">https://golang.org/pkg/net/http/</a>:</p>\n<p>...........\nStarting with Go 1.6, the http package has transparent support for the HTTP/2 protocol when using HTTPS. Programs that must disable HTTP/2 can do so by setting Transport.TLSNextProto (for clients) or Server.TLSNextProto (for servers) to a non-nil, empty map. Alternatively, the following GODEBUG environment variables are currently supported:\n..............</p>\n<p>So, I tried to stop http2:</p>\n<pre><code>tr := &amp;http.Transport{\n    Proxy: http.ProxyURL(proxyUrl),\n    //Proxy: http.ProxyFromEnvironment,\n    TLSClientConfig: &amp;tls.Config{InsecureSkipVerify: true},\n    TLSNextProto:    make(map[string]func(authority string, c *tls.Conn) http.RoundTripper),\n}\n</code></pre>\n<p>same problem, &quot;Bad request&quot;. I tried os.Setenv(&quot;HTTPS_PROXY&quot;, &quot;47.91.???.???:443&quot;), It is the same result.\nThis is logged in server:</p>\n<pre><code>{S;}220.255.95.68{S;}-{S;}07/Mar/2017:17:01:47 +0800{S;}CONNECT www.panpacific.com:443 HTTP/1.1{S;}400{S;}173{S;}340{S;}-{S;}-{S;}-{S;}-{S;}-{S;}www.panpacific.com\n</code></pre>\n<p>So, Does golang support https client request via proxy? How do I get correct results?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "edited": false, "score": 0, "creation_date": 1488946204, "post_id": 42661426, "comment_id": 72451255, "body": "Thanks! Is there any way to restrict the buffer to not grow ? Since inspite of setting the capacity to 20, when the size increases the buffer size grows till it hits overflow. Would I have to write my own Write method to do this ? Or is there a way to do this without having to write my own custom wrapper such as that in the eLitmus blog. (ref <a href=\"https://www.elitmus.com/blog/technology/custom-capacity-buffers-in-go/\" rel=\"nofollow noreferrer\">elitmus.com/blog/technology/custom-capacity-buffers-in-go</a> )"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "edited": false, "score": 0, "creation_date": 1488947492, "post_id": 42661426, "comment_id": 72451617, "body": "It is not possible to restrict the size of bytes.Buffer.  Can you describe at higher level what you are trying to accomplish?"}, {"owner": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "edited": false, "score": 0, "creation_date": 1488950160, "post_id": 42661426, "comment_id": 72452505, "body": "Im trying to read contents of a file into a buffer and then parse the contents. However, if memory is full due to file size being too large, then my application will crash. Hence I wanted to preemptively restrict the buffer size and set a cap on it. This way when it reaches that cap, I can error out."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "edited": false, "score": 0, "creation_date": 1488951107, "post_id": 42661426, "comment_id": 72452830, "body": "Use <a href=\"https://godoc.org/io#LimitedReader\" rel=\"nofollow noreferrer\">io.LimitedReader</a> as described in updated answer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": true, "score": 7, "last_activity_date": 1488951090, "last_edit_date": 1488951090, "creation_date": 1488936905, "answer_id": 42661426, "question_id": 42661206, "link": "https://stackoverflow.com/questions/42661206/difference-in-json-unmarshal-when-using-bytes-buffer-vs-using-bytes-newbuffer/42661426#42661426", "title": "Difference in json.Unmarshal when using bytes.Buffer vs using *bytes.NewBuffer", "body": "<p>The <a href=\"https://godoc.org/bytes#NewBuffer\" rel=\"nofollow noreferrer\">NewBuffer</a> function uses the argument as the initial contents of the buffer. The call <code>make([]byte, 20)</code> returns a byte slice containing 20 zero bytes. The contents of the buffer after <code>b.Write(jsonBlob)</code> is 20 zero bytes followed by the JSON text.  </p>\n\n<p>Add <code>fmt.Printf(\"%q\\n\", b.String())</code> to the program to view the contents of the buffer.</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/4xnF5Uo4Uc\" rel=\"nofollow noreferrer\">playground example with printf added</a></kbd></p>\n\n<p>The JSON parser complains about the first zero byte. </p>\n\n<p>If your goal is to set the size of the internal buffer, use this code:</p>\n\n<pre><code>b := bytes.NewBuffer(make([]byte, 0, 20))\n</code></pre>\n\n<p>The call <code>make([]byte, 0, 20)</code> returns a zero length slice with capacity 20.</p>\n\n<p><kbd><a href=\"https://play.golang.org/p/f7jz8HDwOc\" rel=\"nofollow noreferrer\">playground example with zero length slice</a></kbd></p>\n\n<p>A variable of type <code>byte.Buffer</code> starts as the empty buffer.</p>\n\n<p>If your goal is to limit the amount of data read, then use <a href=\"https://godoc.org/io#LimitedReader\" rel=\"nofollow noreferrer\">io.LimitedReader</a>. For example:</p>\n\n<pre><code>f, err := os.Open(\"filename\")\nif err != nil {\n   // handle error\n}\ndefer f.Close()\nerr := json.NewDecoder(&amp;io.LimitedReader{N: 20, R: f}).Decode(&amp;dat)\nif err != nil {\n    // handle error. Will get parse error if file is truncated. \n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 1, "creation_date": 1488937557, "post_id": 42661459, "comment_id": 72448849, "body": "&quot;So b.Bytes() is only 20 bytes&quot; --- unless it&#39;s  not.<a href=\"https://play.golang.org/p/plSPmgWDVE\" rel=\"nofollow noreferrer\">play.golang.org/p/plSPmgWDVE</a>"}, {"owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "reply_to_user": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "edited": false, "score": 0, "creation_date": 1488938088, "post_id": 42661459, "comment_id": 72448992, "body": "@zerkms my mistake. Edited."}], "tags": [], "owner": {"reputation": 6849, "user_id": 1046738, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/fad002f88c1fc7c38c3154d3970f1ad2?s=128&d=identicon&r=PG", "display_name": "jfly", "link": "https://stackoverflow.com/users/1046738/jfly"}, "is_accepted": false, "score": 2, "last_activity_date": 1488939362, "last_edit_date": 1488939362, "creation_date": 1488937135, "answer_id": 42661459, "question_id": 42661206, "link": "https://stackoverflow.com/questions/42661206/difference-in-json-unmarshal-when-using-bytes-buffer-vs-using-bytes-newbuffer/42661459#42661459", "title": "Difference in json.Unmarshal when using bytes.Buffer vs using *bytes.NewBuffer", "body": "<p>read <a href=\"https://golang.org/pkg/bytes/#NewBuffer\" rel=\"nofollow noreferrer\">this</a>:</p>\n\n<blockquote>\n  <p>func NewBuffer</p>\n  \n  <p>func NewBuffer(buf []byte) *Buffer NewBuffer creates and initializes a\n  new Buffer using buf as its initial contents. It is intended to\n  prepare a Buffer to read existing data. It can also be used to size\n  the internal buffer for writing. To do that, buf should have the\n  desired capacity but a length of zero.</p>\n  \n  <p>In most cases, new(Buffer) (or just declaring a Buffer variable) is\n  sufficient to initialize a Buffer.</p>\n</blockquote>\n\n<p>After <code>b.Write(jsonBlob)</code>, because your buffer din't have a length of zero(<code>make([]byte, 20)</code> creates a 20-length slice), so that <code>b.Bytes()</code> is 20 bytes you allocated plus the json content. Then when you do <code>Unmarshal</code>, the json parser will see 20 zeros in the beginning, of course it complains.</p>\n"}], "owner": {"reputation": 316, "user_id": 4714525, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24d28783dc3ba3a318ec3ebe1bd372b1?s=128&d=identicon&r=PG&f=1", "display_name": "kbinstance", "link": "https://stackoverflow.com/users/4714525/kbinstance"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4650, "favorite_count": 2, "accepted_answer_id": 42661426, "answer_count": 2, "score": 4, "last_activity_date": 1607763184, "creation_date": 1488935310, "last_edit_date": 1607763184, "question_id": 42661206, "link": "https://stackoverflow.com/questions/42661206/difference-in-json-unmarshal-when-using-bytes-buffer-vs-using-bytes-newbuffer", "title": "Difference in json.Unmarshal when using bytes.Buffer vs using *bytes.NewBuffer", "body": "<p>I was looking at the bytes package. If I define a buffer using bytes.Buffer then the code below works and i get an output. However if I try create a buffer with a certain capacity and then try the same code it fails with the error error: invalid character '\\x00' looking for beginning of value. Not sure how to fix it. </p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/json\"\n    \"fmt\"\n)\n\nfunc main() {\n    var jsonBlob = []byte(`[\n        {\"Name\": \"Platypus\", \"Order\": \"Monotremata\"},\n            {\"Name\": \"Quoll\",    \"Order\": \"Dasyuromorphia\"}\n            ]`)\n\n    //var b bytes.Buffer\n    b := *bytes.NewBuffer(make([]byte, 20))\n    b.Write(jsonBlob)\n\n    fmt.Println(b.String())\n\n    var dat interface{}\n    err := json.Unmarshal(b.Bytes(), &amp;dat)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }   \n    fmt.Printf(\"%+v\", dat)\n}\n</code></pre>\n\n<p>Output for Run with bytes.Buffer </p>\n\n<pre><code>[\n        {\"Name\": \"Platypus\", \"Order\": \"Monotremata\"},\n        {\"Name\": \"Quoll\",    \"Order\": \"Dasyuromorphia\"}\n    ]\n[map[Name:Platypus Order:Monotremata] map[Name:Quoll Order:Dasyuromorphia]]\nProgram exited.\n</code></pre>\n\n<p>Output for Run with bytes.NewBuffer</p>\n\n<pre><code>[\n        {\"Name\": \"Platypus\", \"Order\": \"Monotremata\"},\n        {\"Name\": \"Quoll\",    \"Order\": \"Dasyuromorphia\"}\n    ]\nerror: invalid character '\\x00' looking for beginning of value\n&lt;nil&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1488936562, "post_id": 42660794, "comment_id": 72448584, "body": "No, there is not."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1488971186, "post_id": 42660794, "comment_id": 72463825, "body": "There&#39;s not even a way to do that on most OSes, let alone all."}], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 477035, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/cYpss.jpg?s=128&g=1", "display_name": "RedGrittyBrick", "link": "https://stackoverflow.com/users/477035/redgrittybrick"}, "is_accepted": false, "score": 1, "last_activity_date": 1488973895, "last_edit_date": 1492086987, "creation_date": 1488973895, "answer_id": 42670614, "question_id": 42660794, "link": "https://stackoverflow.com/questions/42660794/is-there-an-os-agnostic-way-to-verify-that-a-file-isnt-being-written-to-or-open/42670614#42670614", "title": "Is there an OS-agnostic way to verify that a file isn&#39;t being written to or opened by another process?", "body": "<p>Not in general.</p>\n\n<p>The most ubiquitous general application-level mechanism for detecting and preventing use or alteration of a file that is being used by another process is <a href=\"https://en.wikipedia.org/wiki/File_locking\" rel=\"nofollow noreferrer\">file locking</a></p>\n\n<p>One reason there isn't a cross-platform solution is that some operating systems provide for cooperative locking where file locks are advisory. For example most Unix variants and Linux. </p>\n\n<p>So, on those platforms, you can only guarantee knowledge of other process using a file where the other process is known in advance to be using a specific type of advisory lock.</p>\n\n<p>Most of those platforms do have mandatory locking available. It is set on a per-file basis as part of the file attributes. There are some problems with this (e.g. race conditions). </p>\n\n<p>So no, the underlying mechanisms that could provide the verification you seek are very different. It would probably be very troublesome to provide a reliable cross-platform mechanism in Go that would be guaranteed to work on a variety of popular platforms where other processes are or can be uncooperative.</p>\n\n<p>References</p>\n\n<ul>\n<li><a href=\"https://www.kernel.org/doc/Documentation/filesystems/mandatory-locking.txt\" rel=\"nofollow noreferrer\">https://www.kernel.org/doc/Documentation/filesystems/mandatory-locking.txt</a></li>\n<li><a href=\"https://unix.stackexchange.com/questions/244543/mandatory-locking-in-unix\">https://unix.stackexchange.com/questions/244543/mandatory-locking-in-unix</a></li>\n</ul>\n"}, {"comments": [{"owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "edited": false, "score": 0, "creation_date": 1489005874, "post_id": 42678040, "comment_id": 72487197, "body": "thanks for the response, that&#39;s certainly good information to know. My real issue was while running a command from a go executable that also recursively tars the current directory as part of its execution path, I noticed that if I was piping the output of the command to a file, it would cause the tar to fail. So I was simply wondering if there was an easy to check if a file was being written to so I could avoid trying to tar those files"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1489048852, "post_id": 42678040, "comment_id": 72503613, "body": "@sreya, So as you can see, it would actually helped if you would have stated your real problem instead ;-) OK, as to this problem, GNU tar seems to employ this sort of &quot;hack&quot;: it apparently <code>stat(2)</code>s the file when it&#39;s about to start reading from it, and then checks for two conditions: EOF was hit before the file&#39;s length obtained via that call, or that many bytes were already read but no EOF was hit yet. In these case, a warning is printed. Looks like you could do the same."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1489049001, "post_id": 42678040, "comment_id": 72503709, "body": "@sreya, you can also look at this problem from this PoV: if <code>tar</code> was told to archive such and such directory, it&#39;s natural, that it sort-of &quot;snapshots&quot; it. Avoiding to archive a random file which was being written to is IMO a behaviour surprising to the user. If the user wants to avoid such cases, they should use real snapshotting (like those of the filesystem (ZFS, btrfs can do this) or of the underlying storage -- like LVM etc)."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1489049101, "post_id": 42678040, "comment_id": 72503771, "body": "@sreya, it might turn out that GNU tar also <code>stat(2)</code>s the file after finishing reading from it -- to verify the file&#39;s <code>mtime</code> wasn&#39;t changed."}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1489049343, "post_id": 42678040, "comment_id": 72503919, "body": "@sreya, oh, I misread your comment, sorry. Maybe you could use the stock <code>archive&#47;tar</code> package to create your archives? That&#39;d give you way more control of how to behave in different circumstances."}], "tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": false, "score": 1, "last_activity_date": 1488994627, "last_edit_date": 1488994627, "creation_date": 1488994247, "answer_id": 42678040, "question_id": 42660794, "link": "https://stackoverflow.com/questions/42660794/is-there-an-os-agnostic-way-to-verify-that-a-file-isnt-being-written-to-or-open/42678040#42678040", "title": "Is there an OS-agnostic way to verify that a file isn&#39;t being written to or opened by another process?", "body": "<p>That won't answer your question but since we might be dealing with an <a href=\"https://meta.stackexchange.com/a/66378\">XY problem</a> here, I'd like to look at the problem from a PoV different to locking and otherwise detecting the file is not being written to: an <em>update-then-rename-over</em> approach which is the only sensible way to do atomic updates to files which is sadly not very well known by (novice) programmers.</p>\n\n<p>Since filesystem is inherently racy, to ensure proper \"database-like\" work with files&mdash;where everyone sees consistent state of the file's contents,&mdash;you have to use either locking or atomic updates or both.</p>\n\n<p>To update the file's contents in an atomic way, you do this:</p>\n\n<ol>\n<li>Read the file's data.</li>\n<li>Open a temporary file (on the same filesystem).</li>\n<li>Write the updated data into it.</li>\n<li>Rename the new file over the old one.</li>\n</ol>\n\n<p>Renaming is guaranteed to be atomic on all contemporary commodity OSes so that when a process tries to open a file, it opens either an old copy or the new one but not something in between.</p>\n\n<p>On POSIX systems, Go's <code>os.Rename()</code> has always been atomic since it would end up calling <code>rename(2)</code>; on Windows <a href=\"https://github.com/golang/go/issues/8914\" rel=\"nofollow noreferrer\">it was fixed</a> since Go 1.5.</p>\n\n<p>Note that this approach merely provides consistency of the file's contents\nin the sense no two processes would ever end up updating it at the same time\nbut it does not ensure \"serialized\" updates which is only possible to ensure\nthrough locking or other \"side-channel\" signaling.\nThat is, with atomic updates, it's still possible to have this situation:</p>\n\n<ol>\n<li>Processes A and B read the file's data.</li>\n<li>They both modify it and do atomic updates.</li>\n</ol>\n\n<p>The file's contents will be consistent, but the state would be of whatever\nprocess ended up calling the OS's renaming API function last.</p>\n\n<p>So if you need serialization, you need locking.</p>\n\n<p>I'm afraid, that no cross-platform file locking solution exists for Go\n(anyway, approaches to locking differ greatly even across Unix-y systems\n&mdash; let alone Windows; see <a href=\"https://www.samba.org/samba/news/articles/low_point/tale_two_stds_os2.html\" rel=\"nofollow noreferrer\">this</a> for an entertaining read) but one way to do it is to use platform-specific\nlocking of that temporary file created on the step (2) above.</p>\n\n<p>The approach to update a file then changes to:</p>\n\n<ol>\n<li><p>Open a temporary file with a well-known name.</p>\n\n<p>Say, if the file to update is named \"foo.state\", call it \"foo.state.lock\".</p></li>\n<li><p>Lock it using any platform-specific locking.</p>\n\n<p>If locking fails, this means another process is updating the file,\nso back out or wait&mdash;this really depends on what you're after.</p></li>\n<li><p>Once the lock is held, read the file's data.</p></li>\n<li><p>Modify it, re-write the temporary file being locked with this data.</p></li>\n<li><p>Rename the temporary file over the original one.</p></li>\n<li><p>Close the temp. file and release the lock.</p></li>\n</ol>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user2494770"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 104, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1488994627, "creation_date": 1488932560, "last_edit_date": 1488971163, "question_id": 42660794, "link": "https://stackoverflow.com/questions/42660794/is-there-an-os-agnostic-way-to-verify-that-a-file-isnt-being-written-to-or-open", "title": "Is there an OS-agnostic way to verify that a file isn&#39;t being written to or opened by another process?", "body": "<p>Wondering if there is a way to validate that a file isn't being written to or has been opened by another process at runtime. Preferably a way that would work on all OS's </p>\n"}, {"tags": ["go", "apache-storm"], "comments": [{"owner": {"reputation": 6342, "user_id": 1138252, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/87ed6c22f78d63a5e5004a0872ca09ef?s=128&d=identicon&r=PG", "display_name": "Ilion", "link": "https://stackoverflow.com/users/1138252/ilion"}, "edited": false, "score": 0, "creation_date": 1488932504, "post_id": 42660769, "comment_id": 72447446, "body": "what is your question?"}, {"owner": {"reputation": 151, "user_id": 965692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1e3435209557c9fb948b1d62f0695c3d?s=128&d=identicon&r=PG", "display_name": "user965692", "link": "https://stackoverflow.com/users/965692/user965692"}, "reply_to_user": {"reputation": 6342, "user_id": 1138252, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/87ed6c22f78d63a5e5004a0872ca09ef?s=128&d=identicon&r=PG", "display_name": "Ilion", "link": "https://stackoverflow.com/users/1138252/ilion"}, "edited": false, "score": 0, "creation_date": 1489020995, "post_id": 42660769, "comment_id": 72493504, "body": "Has anybody used gostorm or any other way to run go code in storm"}], "owner": {"reputation": 151, "user_id": 965692, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/1e3435209557c9fb948b1d62f0695c3d?s=128&d=identicon&r=PG", "display_name": "user965692", "link": "https://stackoverflow.com/users/965692/user965692"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 383, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488932405, "creation_date": 1488932405, "question_id": 42660769, "link": "https://stackoverflow.com/questions/42660769/writing-components-in-storm-using-golang", "title": "Writing components in Storm using golang", "body": "<p>I am interested in implementing a Storm topology with components written in Golang.\nBasically \u201cshelling\u201d - creating topologies and implementing spouts and bolts in golang)</p>\n\n<p>There is a project in git (<a href=\"https://github.com/jsgilmore/gostorm\" rel=\"nofollow noreferrer\">https://github.com/jsgilmore/gostorm</a>) which does something similar but I am not sure about it.</p>\n"}, {"tags": ["go", "google-cloud-datastore"], "comments": [{"owner": {"reputation": 1, "user_id": 7675256, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/ae46e297374330156f85a1a45868b25c?s=128&d=identicon&r=PG", "display_name": "Sarah Adams", "link": "https://stackoverflow.com/users/7675256/sarah-adams"}, "edited": false, "score": 0, "creation_date": 1488929695, "post_id": 42659697, "comment_id": 72455491, "body": "In the future, please use the issue trackers on github :). It&#39;s helpful for us to keep track of all our issues in one place. We also don&#39;t often check stackoverflow, so you&#39;ll get a faster response there. I&#39;ve copied your issue over to github, if you don&#39;t mind continuing the discussion there! <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/issues/546\" rel=\"nofollow noreferrer\">github.com/GoogleCloudPlatform/google-cloud-go/issues/546</a> LMK if this doesn&#39;t work for you. -Sarah"}], "owner": {"reputation": 618, "user_id": 2240627, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/834d4b4d06d7e64e8c2343aa91a0e8b2?s=128&d=identicon&r=PG", "display_name": "Ian Rose", "link": "https://stackoverflow.com/users/2240627/ian-rose"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 235, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488929695, "creation_date": 1488926394, "question_id": 42659697, "link": "https://stackoverflow.com/questions/42659697/google-datastore-breaking-change-re-anonymous-struct-fields", "title": "google datastore: breaking change re: anonymous struct fields?", "body": "<p>We have a struct definition like this:</p>\n\n<pre><code>type TimeMs struct {\n    time.Time\n}\n</code></pre>\n\n<p>And various of our datastore entity definitions include fields of this type, e.g.:</p>\n\n<pre><code>type Whatever struct {\n    Created TimeMs\n}\n</code></pre>\n\n<p>In the past, this always worked fine without any special hackery on our part.  If you examine these entities in the cloud console, the field's name was \"Created.\" (note the trailing dot) which was a little odd but didn't seem to cause any problems.  However, the latest versions of the <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/tree/master/datastore\" rel=\"nofollow noreferrer\">cloud datastore package</a> don't seem to play nicely with this.  When we attempt to do a <code>client.Put</code>, we get an error of:</p>\n\n<blockquote>\n  <p>unexpected error: rpc error: code = 3 desc = The flattened property.name is the empty string.</p>\n</blockquote>\n\n<p>We also saw a <a href=\"https://github.com/GoogleCloudPlatform/google-cloud-go/commit/0a668fab0bfe29558cb4026861e3ad7d9e319fb4\" rel=\"nofollow noreferrer\">recent commit</a> of \"if nested struct implements PLS, use it\" which seemed potentially useful.  So we tried making the <code>TimeMs</code> struct implement PropertyLoadSaver (saving its anonymously-embedded time.Time as a property with Name=\"\"), but this results in the same error.</p>\n\n<p>It sure seems like this is a regression.  Am I missing something?  Is there some kind of workaround that we haven't thought of?</p>\n\n<p>Please note that \"just make it implement PropertyLoadSaver and save the Time with some non-empty Name\" isn't really viable since we already have (literally) millions of entities stored using \"\" so it doesn't seem viable to migrate all of them.</p>\n"}, {"tags": ["ios", "go", "webview", "wkwebview", "gomobile"], "answers": [{"tags": [], "owner": {"reputation": 459, "user_id": 832169, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f4796962174e609c97d50ad2f705b394?s=128&d=identicon&r=PG", "display_name": "Steve101", "link": "https://stackoverflow.com/users/832169/steve101"}, "is_accepted": false, "score": 1, "last_activity_date": 1490655138, "creation_date": 1490655138, "answer_id": 43057759, "question_id": 42659370, "link": "https://stackoverflow.com/questions/42659370/is-it-possible-to-render-view-html-using-gomobile/43057759#43057759", "title": "Is it possible to render/view html using gomobile?", "body": "<p>There is an issue in the works to create a webview component; <a href=\"https://github.com/golang/go/issues/10247\" rel=\"nofollow noreferrer\">https://github.com/golang/go/issues/10247</a> but is not functional yet (although the recent discussion on the desktop webview may help things along).</p>\n\n<p>Just to clarify; ReactNative does not embed a webview, it uses JSX to render native components. </p>\n"}], "owner": {"reputation": 6519, "user_id": 613453, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/0c744d4e2bee639d69f3e78f7daeba6d?s=128&d=identicon&r=PG", "display_name": "themihai", "link": "https://stackoverflow.com/users/613453/themihai"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 510, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1490655138, "creation_date": 1488924809, "last_edit_date": 1488969564, "question_id": 42659370, "link": "https://stackoverflow.com/questions/42659370/is-it-possible-to-render-view-html-using-gomobile", "title": "Is it possible to render/view html using gomobile?", "body": "<p>Is it possible to render html pages using gomobile? I would like to spawn a http server which serves html/css in a separate go runtine and then render it in a webview. There are plenty of options for JavaScript applications(i.e. PhoneGap, ReactNative etc) so I'm wondering why there is close to none for Go.</p>\n"}, {"tags": ["go", "gpio"], "comments": [{"owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "edited": false, "score": 3, "creation_date": 1488923877, "post_id": 42659045, "comment_id": 72444149, "body": "Change <code>n, _ = strconv.ParseFloat(b, 10)</code> to <code>n, _ := strconv.ParseFloat(string(b), 10)</code>. Your compiler errors have the exact information you&#39;d need to fix this."}], "answers": [{"tags": [], "owner": {"reputation": 4946, "user_id": 2656614, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/rJz0Z.png?s=128&g=1", "display_name": "Addison", "link": "https://stackoverflow.com/users/2656614/addison"}, "is_accepted": true, "score": 4, "last_activity_date": 1488944045, "creation_date": 1488944045, "answer_id": 42662495, "question_id": 42659045, "link": "https://stackoverflow.com/questions/42659045/cannot-use-type-byte-as-type-string-in-argument-to-strconv-parsefloat-issue/42662495#42662495", "title": "Cannot use (type []byte) as type string in argument to strconv.ParseFloat issue", "body": "<p>You are working with a <a href=\"https://golang.org/pkg/os/exec/#Command\" rel=\"nofollow noreferrer\">command</a> here, which can of course execute just about anything.</p>\n\n<p>The function is purposely generic, as the true return type varies depending on what you executed. Thus, when you call the <a href=\"https://golang.org/pkg/os/exec/#Cmd.Output\" rel=\"nofollow noreferrer\">output</a> method, you are given a slice of bytes (very generic!). Here is its signature:</p>\n\n<pre><code>func (c *Cmd) Output() ([]byte, error)\n</code></pre>\n\n<p>If you know that the bytes will always be a string, then you simply have to do a type conversion to a string:</p>\n\n<pre><code>n, _ := strconv.ParseFloat(string(b), 10)\n</code></pre>\n"}], "owner": {"reputation": 394, "user_id": 2360072, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh6.googleusercontent.com/-nk2tmJ3mw-E/AAAAAAAAAAI/AAAAAAAAClk/VygMiLtmkJ0/photo.jpg?sz=128", "display_name": "Yevhenii Shashkov", "link": "https://stackoverflow.com/users/2360072/yevhenii-shashkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6277, "favorite_count": 0, "accepted_answer_id": 42662495, "answer_count": 1, "score": 2, "last_activity_date": 1488944045, "creation_date": 1488923582, "question_id": 42659045, "link": "https://stackoverflow.com/questions/42659045/cannot-use-type-byte-as-type-string-in-argument-to-strconv-parsefloat-issue", "title": "Cannot use (type []byte) as type string in argument to strconv.ParseFloat issue", "body": "<pre><code>pi@raspberrypi:~/Desktop/go $ go run shell1.go\n</code></pre>\n\n<p>As result i am getting:</p>\n\n<pre><code>pi@raspberrypi:~/Desktop/go $ go run shell1.go\n# command-line-arguments\n./shell1.go:29: undefined: n\n./shell1.go:29: cannot use b (type []byte) as type string in argument to strconv.ParseFloat\n./shell1.go:32: undefined: n\n</code></pre>\n\n<p>Go file (<code>shell1.go</code>) code  is:</p>\n\n<pre><code>package main\n\nimport (\n    //    \"net/http\"\n    //    \"github.com/julienschmidt/httprouter\"\n    \"fmt\"\n    \"log\"\n    \"os/exec\"\n    \"strconv\"\n    \"time\"\n    //\"bytes\"\n    //\"encoding/binary\"\n)\nimport _ \"github.com/go-sql-driver/mysql\"\nimport _ \"database/sql\"\n\nfunc main() {\n    for {\n        time.Sleep(10 * time.Millisecond)\n        cmd := exec.Command(\"gpio.bash\")\n\n        b, err := cmd.Output()\n        if err != nil {\n            log.Fatal(err)\n        }\n        n, _ = strconv.ParseFloat(b, 10)\n        fmt.Println(string(b))\n        break\n    }\n\n    fmt.Println(\"Button pressed!!! \", n)\n\n}\n</code></pre>\n\n<p>Content of (<code>gpio.bash</code>) file is just one command to read gpio</p>\n\n<pre><code> #!/bin/bash\ngpio read 29\n</code></pre>\n"}, {"tags": ["go", "routes", "http-status-code-404", "gorilla"], "comments": [{"owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "edited": false, "score": 0, "creation_date": 1488925000, "post_id": 42659014, "comment_id": 72444720, "body": "I don&#39;t see where you register your <code>router</code> with the server, ie shouldn&#39;t you have something like <code>http.Handle(&quot;&#47;&quot;, router)</code> in the main (before calling <code>http.ListenAndServe</code>)?"}, {"owner": {"reputation": 2836, "user_id": 1359163, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/063e1984ad8cb19353c311ba3a9290b9?s=128&d=identicon&r=PG", "display_name": "KBN", "link": "https://stackoverflow.com/users/1359163/kbn"}, "edited": false, "score": 1, "creation_date": 1488999700, "post_id": 42659014, "comment_id": 72483693, "body": "You&#39;re supposed to pass the <code>router</code> to <code>ListenAndServe</code>, instead you have given <code>nil</code>"}], "owner": {"reputation": 67, "user_id": 3843318, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/261e9c2795a823dcfdc5b397cf9a99ce?s=128&d=identicon&r=PG&f=1", "display_name": "Blake King", "link": "https://stackoverflow.com/users/3843318/blake-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 684, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488923423, "creation_date": 1488923423, "question_id": 42659014, "link": "https://stackoverflow.com/questions/42659014/why-am-i-getting-a-404-on-this-golang-route-using-gorilla-mux", "title": "Why am I getting a 404 on this golang route using gorilla mux?", "body": "<p>I am getting a 404 when I go to:</p>\n\n<p><a href=\"http://127.0.0.1:12345/list-issues/sortbycategory\" rel=\"nofollow noreferrer\">http://127.0.0.1:12345/list-issues/sortbycategory</a></p>\n\n<p>This is not the case when I got to /list-issues. Am I using gorilla mux correctly? From looking at the examples it seems to me that I am.</p>\n\n<p>main.go:</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"text/template\"\n    \"my_proj/uservoice_app/controllers\"\n    \"github.com/gorilla/mux\"\n\n\n)\n\nfunc init() {\n    controllers.Tpl = template.Must(template.ParseGlob(\"templates/*.html\"))\n\n\n    log.SetFlags(log.LstdFlags | log.Lshortfile)\n}\n\nfunc main() {\n    router := mux.NewRouter()\n    http.HandleFunc(\"/hello\", controllers.Hello_cont)\n    http.HandleFunc(\"/write\", controllers.Write_cont)\n    http.HandleFunc(\"/test\", controllers.Test)\n    http.HandleFunc(\"/signup\", controllers.Signup)\n    http.HandleFunc(\"/create-issue\", controllers.CreateIssue)\n    http.HandleFunc(\"/list-issues\", controllers.ListIssues)\n\n    //ROUTER:\n    router.HandleFunc(\"/list-issues/{sortby}\", controllers.ListIssuesBy).Methods(\"GET\")\n\n\n    fs := http.FileServer(http.Dir(\"static\"))\n    http.Handle(\"/static/\", http.StripPrefix(\"/static/\", fs))\n    log.Fatal(http.ListenAndServe(\":12345\", nil))\n\n\n}\n</code></pre>\n\n<p>list-issues.go</p>\n\n<pre><code>package controllers\n\nimport (\n    \"net/http\"\n    \"database/sql\"\n    \"github.com/dustin/go-humanize\"\n    \"github.com/gorilla/mux\"\n    \"fmt\"\n)\n\nfunc ListIssuesBy(w http.ResponseWriter, r *http.Request) {\n\n    vars := mux.Vars(r)\n    sorter := vars[\"sortby\"]\n    if sorter == \"sortbycategory\" {\n\n        fmt.Print(\"hello\")\n\n    }\n\n    db, _ := sql.Open(\"mysql\", \"user:pass@tcp(127.0.0.1:3306)/mydb?parseTime=true\")\n    rows, _ := db.Query(\"SELECT * from issues\")\n\n    issuelist := []Issue{}\n    for rows.Next() {\n        var r Issue\n\n        err := rows.Scan(&amp;r.ID, &amp;r.Title, &amp;r.Description, &amp;r.Category, &amp;r.Username, &amp;r.Votes_up, &amp;r.Votes_down, &amp;r.StartDate, &amp;r.Status, &amp;r.CommentsThrd)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n        HRDate2 := humanize.Time(r.StartDate.Local())\n        r.HRSinceDate = HRDate2\n\n        /*r.StartDate = HRDate*/\n        issuelist = append(issuelist, r)\n    }\n    renderlistissues(w, issuelist)\n}\n\nfunc ListIssues(w http.ResponseWriter, r *http.Request) {\n    db, _ := sql.Open(\"mysql\", \"user:pass@tcp(127.0.0.1:3306)/mydb?parseTime=true\")\n    rows, _ := db.Query(\"SELECT * from issues\")\n\n    issuelist := []Issue{}\n    for rows.Next() {\n        var r Issue\n\n        err := rows.Scan(&amp;r.ID, &amp;r.Title, &amp;r.Description, &amp;r.Category, &amp;r.Username, &amp;r.Votes_up, &amp;r.Votes_down, &amp;r.StartDate, &amp;r.Status, &amp;r.CommentsThrd)\n        if err != nil {\n            http.Error(w, err.Error(), http.StatusInternalServerError)\n        }\n        HRDate2 := humanize.Time(r.StartDate.Local())\n        r.HRSinceDate = HRDate2\n\n        /*r.StartDate = HRDate*/\n        issuelist = append(issuelist, r)\n    }\n    renderlistissues(w, issuelist)\n\n}\n\nfunc renderlistissues(w http.ResponseWriter, data []Issue) {\n    if err := Tpl.ExecuteTemplate(w, \"list-issues\", data); err != nil {\n        http.Error(w, err.Error(), http.StatusInternalServerError)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["sql", "sqlite", "go", "sqlx"], "answers": [{"tags": [], "owner": {"reputation": 3575, "user_id": 111866, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e742e21c1b64a037eaa90aea1fdf7874?s=128&d=identicon&r=PG", "display_name": "Ross Light", "link": "https://stackoverflow.com/users/111866/ross-light"}, "is_accepted": false, "score": 0, "last_activity_date": 1490461610, "creation_date": 1490461610, "answer_id": 43019329, "question_id": 42657639, "link": "https://stackoverflow.com/questions/42657639/begin-immediate-in-sqlx-or-database-sql-golang/43019329#43019329", "title": "BEGIN IMMEDIATE in sqlx or database/sql (golang)?", "body": "<p>At the moment, there doesn't appear to be a way to do this other than at the connection level (you can specify the <a href=\"https://godoc.org/github.com/mattn/go-sqlite3#SQLiteDriver.Open\" rel=\"nofollow noreferrer\"><code>_txlock</code></a> parameter).</p>\n\n<p>I've opened <a href=\"https://github.com/mattn/go-sqlite3/issues/400\" rel=\"nofollow noreferrer\">#400</a> to track adding this.</p>\n"}], "owner": {"reputation": 5455, "user_id": 555493, "user_type": "registered", "accept_rate": 47, "profile_image": "https://www.gravatar.com/avatar/7f71360d1b97bf28012fffa173ec0eb0?s=128&d=identicon&r=PG", "display_name": "U Avalos", "link": "https://stackoverflow.com/users/555493/u-avalos"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 430, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1490461610, "creation_date": 1488918288, "question_id": 42657639, "link": "https://stackoverflow.com/questions/42657639/begin-immediate-in-sqlx-or-database-sql-golang", "title": "BEGIN IMMEDIATE in sqlx or database/sql (golang)?", "body": "<p>How do you start a sqlite BEGIN IMMEDIATE transaction in jmoiron/sqlx or database/sql (for golang)? As per the docs, the <code>begin</code> methods allow you to control isolation methods (for example, <a href=\"https://golang.org/pkg/database/sql/#DB.Begin\" rel=\"nofollow noreferrer\">https://golang.org/pkg/database/sql/#DB.Begin</a>). However, the isolation method, if I'm not mistaken, is not what I'm looking for. As per the sqlite docs, transactions default to <em>DEFERRED</em> which result in deadlocks and race conditions for my use case, so I really need to ensure that it's BEGIN IMMEDIATE.</p>\n"}, {"tags": ["go", "server", "grpc", "go-server"], "comments": [{"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488920940, "post_id": 42657556, "comment_id": 72442640, "body": "Are you using Docker? A virtual machine? Launching it through a systemd unit with CPUAffinity set? Maybe your server has CPUAffinity set to 1 or 2 CPUs in the user.slice. Maybe your OS kernel is using some kind of setting that drives network traffic to a CPU per connection hash and you&#39;re only testing from one IP. . ."}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921218, "post_id": 42657556, "comment_id": 72442774, "body": "I run many tests with 1 and 2 differents IPs and the result was the same. I&#39;m using a virtual machine. What is this CPUAffinity? I didn&#39;t know about this."}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921349, "post_id": 42657556, "comment_id": 72442853, "body": "Ah, and the server is running in a linux centos"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921421, "post_id": 42657556, "comment_id": 72442896, "body": "If you&#39;re running in a virtual machine, how many CPU&#39;s did you configure the virtual machine to use?"}, {"owner": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921529, "post_id": 42657556, "comment_id": 72442954, "body": "Some information about packet steering which might apply <a href=\"https://www.kernel.org/doc/Documentation/networking/scaling.txt\" rel=\"nofollow noreferrer\">kernel.org/doc/Documentation/networking/scaling.txt</a>"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921615, "post_id": 42657556, "comment_id": 72442994, "body": "I&#39;ve configured 2 CPUs and the result was the same as 1 CPU"}, {"owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "reply_to_user": {"reputation": 49065, "user_id": 13422, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/94b309d78a1253a334e9b82643a8dc97?s=128&d=identicon&r=PG", "display_name": "Zan Lynx", "link": "https://stackoverflow.com/users/13422/zan-lynx"}, "edited": false, "score": 0, "creation_date": 1488921902, "post_id": 42657556, "comment_id": 72443132, "body": "I saw my process affinity and it gives me: &quot;pid 31255&#39;s current affinity list: 0,1&quot; What means it can run in one of my 2 CPUs"}], "answers": [{"tags": [], "owner": {"reputation": 577, "user_id": 7891992, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-CsP00wAm0dU/AAAAAAAAAAI/AAAAAAAAAfQ/oONOiaBIgXI/photo.jpg?sz=128", "display_name": "Doug Fawley", "link": "https://stackoverflow.com/users/7891992/doug-fawley"}, "is_accepted": true, "score": 1, "last_activity_date": 1492720490, "creation_date": 1492720490, "answer_id": 43529428, "question_id": 42657556, "link": "https://stackoverflow.com/questions/42657556/go-server-with-2-cpus/43529428#43529428", "title": "Go server with 2 cpus", "body": "<p>In gRPC, each server handler runs in its own goroutine.  From there it is up to the Go scheduler to determine what CPUs to schedule them on.  Depending on what your server handlers are doing, system load, etc, it's possible they could all end up scheduled on the same CPU.</p>\n"}], "owner": {"reputation": 453, "user_id": 7211112, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/60424642a956f6850ca232c8e24bfb3e?s=128&d=identicon&r=PG&f=1", "display_name": "Vivi", "link": "https://stackoverflow.com/users/7211112/vivi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 219, "favorite_count": 1, "accepted_answer_id": 43529428, "answer_count": 1, "score": 2, "last_activity_date": 1492720490, "creation_date": 1488918019, "question_id": 42657556, "link": "https://stackoverflow.com/questions/42657556/go-server-with-2-cpus", "title": "Go server with 2 cpus", "body": "<p>I'm building a GRPC server in GO and I want increase its performance. I've increased my machine and put 2CPUS in order to make it better but I noticed that my server doesn't use all cpu cores and I couldn't find a way to fix it (I've run some tests to make the server worker harder). It seems like my server uses 1 cpu a lot and the other not. My load average stay above 1 what means that my server is full of requests but when I see the performance in netdata there's only one CPU working.</p>\n\n<p>This is my grpc code:</p>\n\n<pre><code>package main\nimport (\n    \"fmt\"\n    \"runtime\"\n    \"log\"\n    \"net\"\n    \"google.golang.org/grpc\"\n    \"golang.org/x/net/context\"\n    \"google.golang.org/grpc/reflection\"\n    pb \"teste/prototeste\"\n\n)\nfunc (s *server) Test(ctx context.Context, n *pb.TestRequest)      (*pb.TestReply, error){\n    return &amp;pb.TestReply{Message: n.Name}, nil\n}\n\ntype server struct{}\n\nconst (\n    port = \":50051\"\n)\n\nfunc main(){\n\n    numOfCores := runtime.NumCPU()\n    fmt.Println(numOfCores)\n    runtime.GOMAXPROCS(numOfCores)\n    lis, err := net.Listen(\"tcp\", port)\n    if err != nil {\n        log.Fatalf(\"failed to listen: %v\", err)\n    }\n    s := grpc.NewServer()\n    pb.RegisterGreeterServer(s, &amp;server{})\n    // Register reflection service on gRPC server.\n    reflection.Register(s)\n\n    s.Serve(lis)\n\n}\n</code></pre>\n\n<p>Notice that in Serve function there's a goroutine that allow the server accept multiple requests in parallel.</p>\n\n<p><a href=\"https://godoc.org/google.golang.org/grpc\" rel=\"nofollow noreferrer\">API reference grpc in go</a></p>\n\n<p><a href=\"https://i.stack.imgur.com/76OfE.png\" rel=\"nofollow noreferrer\">This is my cpu usage</a></p>\n\n<p>Any tips to how to solve this and make my server use 2 cpus?</p>\n"}, {"tags": ["go", "http-status-code-403"], "comments": [{"owner": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "edited": false, "score": 0, "creation_date": 1488908342, "post_id": 42654548, "comment_id": 72435280, "body": "Try to catch your error first, <code>resp, err := client.Do(req)</code>, on both your request and response."}, {"owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "reply_to_user": {"reputation": 534, "user_id": 4513263, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6c02283d203020618ad7d90e061632d4?s=128&d=identicon&r=PG&f=1", "display_name": "Elad", "link": "https://stackoverflow.com/users/4513263/elad"}, "edited": false, "score": 0, "creation_date": 1488908521, "post_id": 42654548, "comment_id": 72435365, "body": "I actually do catch them that way and then have <code>if err != nil</code> to print it out, but nothing gets caught.  I left that off for brevity because the server clearly is responding, but with a 403."}], "answers": [{"comments": [{"owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "edited": false, "score": 0, "creation_date": 1488912561, "post_id": 42655567, "comment_id": 72437676, "body": "That is a good thought, but it does it whether or not I print the bytes.  I edited my code to show everything."}], "tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 0, "last_activity_date": 1488911043, "creation_date": 1488911043, "answer_id": 42655567, "question_id": 42654548, "link": "https://stackoverflow.com/questions/42654548/403-forbidden-when-making-golang-post/42655567#42655567", "title": "403 Forbidden when making Golang POST", "body": "<p>You did not show what <code>bytes</code> is but that's most probably the problem: both <code>NewRequest</code> and <code>Post</code> take an <code>io.Reader</code> and read the body from that reader. This reading typically can happen only once (think of a stream). When you <code>fmt.Printf(\"%s\")</code> the <code>io.Reader</code> this printing will consume the content (most probably by invoking a String() method) and the actual request is done with an <em>empty</em> body.</p>\n\n<p>Always show whole code. And do not try to read twice from an io.Reader.</p>\n"}, {"comments": [{"owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "edited": false, "score": 0, "creation_date": 1488912663, "post_id": 42655773, "comment_id": 72437732, "body": "The server is actually a Java Spring Boot App.  The strange thing is that I get the same result when it is on my localhost or if I deploy the Spring Boot app to AWS.  In either case the Go app running locally gets a 403 while Curl and Postman can hit the endpoint successfully regardless of where it is running from. Also wouldn&#39;t the CORS issue show up in GET requests as well as POST requests?  I can successfully do a GET with my Go program, just not a POST."}, {"owner": {"reputation": 121, "user_id": 990115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F0Bzk.jpg?s=128&g=1", "display_name": "sigit_prayoga", "link": "https://stackoverflow.com/users/990115/sigit-prayoga"}, "reply_to_user": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "edited": false, "score": 0, "creation_date": 1488913203, "post_id": 42655773, "comment_id": 72438059, "body": "Can you log the request/response header both using Go and Curl?"}, {"owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "edited": false, "score": 0, "creation_date": 1488915228, "post_id": 42655773, "comment_id": 72439342, "body": "It wasn&#39;t a CORS issue, but your answer got me to look more carefully at the server where I discovered the problem.  My Go app was fine all along, but the Java app was a bit wonky."}], "tags": [], "owner": {"reputation": 121, "user_id": 990115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/F0Bzk.jpg?s=128&g=1", "display_name": "sigit_prayoga", "link": "https://stackoverflow.com/users/990115/sigit-prayoga"}, "is_accepted": false, "score": 0, "last_activity_date": 1488911767, "creation_date": 1488911767, "answer_id": 42655773, "question_id": 42654548, "link": "https://stackoverflow.com/questions/42654548/403-forbidden-when-making-golang-post/42655773#42655773", "title": "403 Forbidden when making Golang POST", "body": "<p>I assume there are 2 Go apps and runs on a different host, which results a <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Access_control_CORS\" rel=\"nofollow noreferrer\">CORS</a> problem. Consider adding the <code>Access-Control-Allow-Origin</code> at your service with your client's host.</p>\n\n<p><code>w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")</code></p>\n\n<p>You can change <code>*</code> with specified hostname which your client application runs.</p>\n"}, {"tags": [], "owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "is_accepted": false, "score": 0, "last_activity_date": 1488915183, "creation_date": 1488915183, "answer_id": 42656777, "question_id": 42654548, "link": "https://stackoverflow.com/questions/42654548/403-forbidden-when-making-golang-post/42656777#42656777", "title": "403 Forbidden when making Golang POST", "body": "<p>OMG....I just found the problem.  It turned out that it was failing (as I was expecting), but it was erroneously returning it as a 403 rather than a 400.  Ugh...sometimes when you stare at something for a long time the obvious things completely escape notice.</p>\n"}, {"tags": [], "owner": {"reputation": 26, "user_id": 1064945, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/LkxKy.jpg?s=128&g=1", "display_name": "ddzcoeur", "link": "https://stackoverflow.com/users/1064945/ddzcoeur"}, "is_accepted": false, "score": 0, "last_activity_date": 1550307436, "creation_date": 1550307436, "answer_id": 54721449, "question_id": 42654548, "link": "https://stackoverflow.com/questions/42654548/403-forbidden-when-making-golang-post/54721449#54721449", "title": "403 Forbidden when making Golang POST", "body": "<p>you should set User-Agent in request header</p>\n\n<pre><code>req, _ := http.NewRequest(http.MethodGet, urlString, nil)\nreq.Header.Set(\"User-Agent\", \"Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/66.0.3359.181 Safari/537.36\")\n</code></pre>\n"}], "owner": {"reputation": 143, "user_id": 2308282, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/2e3f1e039f713c513a909ec5550e5a95?s=128&d=identicon&r=PG", "display_name": "Adam Vukich", "link": "https://stackoverflow.com/users/2308282/adam-vukich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1900, "favorite_count": 0, "answer_count": 4, "score": -1, "last_activity_date": 1550307436, "creation_date": 1488907797, "last_edit_date": 1488912314, "question_id": 42654548, "link": "https://stackoverflow.com/questions/42654548/403-forbidden-when-making-golang-post", "title": "403 Forbidden when making Golang POST", "body": "<p>I have a REST endpoint provided by a Java Spring Boot app that I am trying to hit with a simple Go (go1.8 darwin/amd64) program.  I have tried to hit it in 2 separate ways:</p>\n\n<pre><code>const (\n    LOCAL_BASE         = \"http://localhost:11400\"\n    ADD_FUNDS_ENDPOINT = \"/sub-accounts/%d/add-funds\"\n)\n\ntype InputArgumentsJson struct {\n    Amount           float64 `json:\"amount\"`\n    BufferAmount     float64 `json:\"bufferAmount\"`\n    FromSubAccountID int     `json:\"fromSubAccountId\"`\n}\n\n...\n\n// set up json body\ninputArguments := &amp;InputArgumentsJson{Amount: 1100, BufferAmount: 0,\n    FromSubAccountID: spendFundId}\nbytes := new(bytes.Buffer)\njson.NewEncoder(bytes).Encode(inputArguments)\n\n// set up the url to call\nendpoint := fmt.Sprintf(ADD_FUNDS_ENDPOINT, billSetAsideId)\nurl := LOCAL_BASE + endpoint\n\nclient := &amp;http.Client{}\n\nreq, err := http.NewRequest(\"POST\", url, bytes)\nif err != nil {\n    fmt.Println(\"ERROR WHILE BUILDING REQUEST\")\n    fmt.Println(err)\n}\n\nreq.Header.Add(\"Content-Type\", \"application/json\")\nresp, err := client.Do(req)\nif err != nil {\n    fmt.Println(\"ERROR WHILE MAKING REQUEST\")\n    fmt.Println(err)\n}\nfmt.Println(resp)\n</code></pre>\n\n<p>and:</p>\n\n<pre><code>resp, err := http.Post(url, \"application/json; charset=utf-8\", bytes)\nif err != nil {\n    fmt.Println(\"ERROR WHILE MAKING REQUEST\")\n    fmt.Println(err)\n}\nfmt.Println(resp)\n</code></pre>\n\n<p>I added a print out to see if the URL and JSON body were right and they appeared to be: </p>\n\n<pre><code>fmt.Printf(\"\\nMaking request to %s with:\\n %s\\n\", url, bytes)\n</code></pre>\n\n<p>printed out</p>\n\n<pre><code>Making request to http://localhost:11400/sub-accounts/167/add-funds with:\n{\"amount\":1100,\"bufferAmount\":0,\"fromSubAccountId\":166}\n</code></pre>\n\n<p>but I am getting a 403 Forbidden when running it.</p>\n\n<p>I can hit this endpoint without fail using both Postman and the following Curl command:</p>\n\n<p><code>curl -H \"Content-Type: application/json\" -X POST -d '{\"amount\":1100,\"bufferAmount\":0,\"fromSubAccountId\":166}' http://localhost:11400/sub-accounts/167/add-funds</code></p>\n\n<p>Does anyone have any thoughts on what I may be missing here?  To add further to the intrigue I can successfully hit a different GET endpoint from the Go program.</p>\n\n<p>Thanks in advance!</p>\n\n<p><em>Edited to show that I was catching the errors and the surrounding logic for creating the URL and JSON body</em></p>\n"}, {"tags": ["go", "dynamic", "xml-parsing"], "comments": [{"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488906002, "post_id": 42651619, "comment_id": 72433960, "body": "This question is definitely a little broad but you can make it a better fit for SO by adding some code showing how you intend to actually parse the above XML the like.  Even if that code doesn&#39;t quite work yet that should help to narrow the focus of your question and make it something someone can really answer more concretely."}, {"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488920624, "post_id": 42651619, "comment_id": 72442473, "body": "Aren&#39;t you reimplementing <a href=\"https://flexget.com/\" rel=\"nofollow noreferrer\">FlexGet</a>? Combine the <a href=\"https://flexget.com/Plugins/filesystem\" rel=\"nofollow noreferrer\">filesystem plugin</a> for input and use any filter and/or output plugins for actions."}, {"owner": {"reputation": 1922, "user_id": 1632752, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/82ddad6d8d16ffaad78dbb19c14e32cc?s=128&d=identicon&r=PG", "display_name": "gervais.b", "link": "https://stackoverflow.com/users/1632752/gervais-b"}, "reply_to_user": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488954491, "post_id": 42651619, "comment_id": 72454093, "body": "@PabloLalloni I&#39;m sure that this kind of tool already exists. But mine is just a concrete case to learn Go. Anyway, thanks for pointing FlexGet."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 3, "last_activity_date": 1488903324, "creation_date": 1488903324, "answer_id": 42653121, "question_id": 42651619, "link": "https://stackoverflow.com/questions/42651619/go-extensible-system-that-classify-files/42653121#42653121", "title": "Go, extensible system that classify files", "body": "<p>From an XML stream or any other textual medium, you can only obtain text.\nSo your <code>mv ${file} /some/absolute/path/</code> is essentially text.</p>\n\n<p>This means you will inevitably need to <em>parse</em> it before actually call\nyour real action on whatever you have parsed out.</p>\n\n<p>Now you have two facets of this problem:</p>\n\n<ol>\n<li>How to call certain Go code once an action is known.</li>\n<li>How to pass \"action arguments\" data to it.</li>\n</ol>\n\n<p>They are intertwined a bit&mdash;depending on how do you decide to solve (1).</p>\n\n<p>The first approach to call Go function given its textual \"handle\" is to\nsimply have a map of such handles to functions, like this:</p>\n\n<pre><code>type Action func (...interface{}) error\n\nvar actions = map[string]Action {\n    \"mv\": Move,\n    \"flickr\": UploadToFlickr,\n}\n\nfunc Move(args ...interface{}) error {\n    // implement\n}\n\nfunc UploadToFlickr(args ...interface{}) error {\n    // implement\n}\n</code></pre>\n\n<p>And now you dispatch your actions like</p>\n\n<pre><code>act, ok := actions[action_name]\nif !ok {\n  log.Fatalf(\"Config error: Unsupported action: %s\\n', action_name)\n}\n\nerr := act(action_args...)\nif err != nil {\n   // Handle\n}\n</code></pre>\n\n<blockquote>\n  <p>Notice these <code>...</code> bits: they implement variadic functions\n  <em>and</em> allow to pass a slice of values to a variadic function.</p>\n</blockquote>\n\n<p>The second approach is to go more strictly typed:</p>\n\n<ol>\n<li><p>You define an interface:</p>\n\n<pre><code>type Action interface {\n    func Do(fname string) error\n}\n</code></pre></li>\n<li><p>Your configuration parsing code would produce values of concrete types\nlike, say, <code>MoveAction</code>, <code>FlickrUploadAction</code>.</p>\n\n<p>All these types must implement a method <code>Do()</code> of the interface <code>Action</code>.</p>\n\n<p>By doing this, they automagically implment the said interface.\nThis also means your condiguration parser could return values of that\ninterface&mdash;something like this:</p>\n\n<pre><code>func ConfigParser() (map[string]Action, error)\n</code></pre>\n\n<p>&hellip;where <code>map[string]Action</code> would map MIME types of files\nto values of concrete types&mdash;such as <code>FlickrUploadAction</code>\nfor files of type <code>image/png</code> and <code>MoveAction</code> for files of type\n<code>text/plain</code>.</p></li>\n</ol>\n\n<p>To call an action, you lookup a map produced by that imaginary\n<code>ConfigParser()</code> function using the file's MIME type and obtain a value\nwhich implements the <code>Action</code> interface, so what's left is simply\ncalling its <code>Do()</code> method passing it the name of the actual file.</p>\n\n<h3>TL;DR</h3>\n\n<p>Read up on interfaces&mdash;they are super powerful and pervasive\nin the standard library (look at those <code>io.Reader</code>s and <code>io.Writer</code>s).</p>\n"}], "owner": {"reputation": 1922, "user_id": 1632752, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/82ddad6d8d16ffaad78dbb19c14e32cc?s=128&d=identicon&r=PG", "display_name": "gervais.b", "link": "https://stackoverflow.com/users/1632752/gervais-b"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 42653121, "answer_count": 1, "score": -1, "last_activity_date": 1488903324, "creation_date": 1488899072, "question_id": 42651619, "link": "https://stackoverflow.com/questions/42651619/go-extensible-system-that-classify-files", "title": "Go, extensible system that classify files", "body": "<p>I have the idea to create a \"script\" that will walk a directory tree to classify files and take actions (If it is a photo, upload to Flickr. If it is a video, move to a folder, ..).</p>\n\n<p>I have no knwoledge of Go but would like to change that. The file discovery and classification don't seems to be the big part. <em>routines</em> and <em>channels</em> seems to be enough to have a non blocking system. </p>\n\n<p>My main concern is more about the actions to take. I will certainly code some actions like \"FlickrUpload\" or \"Shell\" (for <code>mv</code>, <code>cp</code>, ..). But I would like to have a configurable system where I can attach an action to a mime type. I think an Xml structure could be nice to configure it and seems simple to parse.</p>\n\n<pre><code>&lt;?xml version=\"1.0\" standalone=\"yes\"&gt;\n&lt;configuration&gt;\n  &lt;file type=\"image/jpg\"&gt;\n    &lt;action name=\"FlickrUpload\" /&gt;\n    &lt;action name=\"Shell\"&gt;\n      mv ${file} /some/absolute/path/\n    &lt;/action&gt;\n    &lt;!-- or --&gt;\n    &lt;FlickrUpload /&gt; \n  &lt;/file&gt;\n&lt;/configuration&gt;\n</code></pre>\n\n<p>But I have no idea on how to bind the action and his arguments (from Xml) to an <code>action</code> that will be an <code>interface</code> (unless you say other).</p>\n\n<pre><code>type action interface {\n  execute(path string) error\n}\n</code></pre>\n"}, {"tags": ["authentication", "go", "reverse-proxy", "middleware"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1488903866, "post_id": 42650930, "comment_id": 72432566, "body": "The first thing that comes to mind is: do you read the body and close it?"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 1, "creation_date": 1488904365, "post_id": 42650930, "comment_id": 72432888, "body": "<a href=\"http://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0\" title=\"net http http contentlength 222 with body length 0\">stackoverflow.com/questions/31337891/&hellip;</a>"}, {"owner": {"reputation": 7993, "user_id": 19556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/06466d059d58bbaee6320c8f2e733aa5?s=128&d=identicon&r=PG", "display_name": "stderr", "link": "https://stackoverflow.com/users/19556/stderr"}, "edited": false, "score": 0, "creation_date": 1488906168, "post_id": 42650930, "comment_id": 72434065, "body": "Possible duplicate of <a href=\"http://stackoverflow.com/questions/31337891/net-http-http-contentlength-222-with-body-length-0\">net/http: http: ContentLength=222 with Body length 0</a>"}, {"owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1488939717, "post_id": 42650930, "comment_id": 72449429, "body": "@RickyA thanks. I think the <code>r.FormValue(&quot;username&quot;)</code> read the body and close it. If I do need to get these value, what would you suggest? Make a copy of the body? Thank you"}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1488972678, "post_id": 42650930, "comment_id": 72464877, "body": "Do you use the body for anything else than sending the credentials?"}, {"owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "reply_to_user": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1488973029, "post_id": 42650930, "comment_id": 72465136, "body": "Hi @RickyA , no, I use it only for credentials. I plan to move it to header."}], "answers": [{"comments": [{"owner": {"reputation": 1172, "user_id": 922457, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/56c9ee0dd7713d48f2ad2e50594a6d0c?s=128&d=identicon&r=PG", "display_name": "Edenshaw", "link": "https://stackoverflow.com/users/922457/edenshaw"}, "edited": false, "score": 0, "creation_date": 1561750272, "post_id": 42670414, "comment_id": 100178803, "body": "When using <code>r.ContentLength = 0</code> it means that the body would pass through the proxy without any modification? and what would be the difference with <code>r.ContentLength = -1</code>?"}], "tags": [], "owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "is_accepted": false, "score": 0, "last_activity_date": 1488973353, "creation_date": 1488973353, "answer_id": 42670414, "question_id": 42650930, "link": "https://stackoverflow.com/questions/42650930/golang-reverse-proxy-with-custom-authentication/42670414#42670414", "title": "Golang reverse proxy with custom authentication", "body": "<p>If you do not care for the body anymore you can set the contentlength of the request to 0, reflecting the current state of the body:</p>\n\n<pre><code>func AuthMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        // the api call to external auth server\n        user_id, err := authenticate(r.FormValue(\"username\"), r.FormValue(\"password\"))\n        if err != nil {\n            http.Error(w, err.Error(), 401)\n            return\n        }\n        r.ContentLength = 0\n        next.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n"}], "owner": {"reputation": 1449, "user_id": 2897785, "user_type": "registered", "accept_rate": 39, "profile_image": "https://graph.facebook.com/100001322547162/picture?type=large", "display_name": "Wei Xu", "link": "https://stackoverflow.com/users/2897785/wei-xu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1881, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1488973353, "creation_date": 1488897139, "last_edit_date": 1488900510, "question_id": 42650930, "link": "https://stackoverflow.com/questions/42650930/golang-reverse-proxy-with-custom-authentication", "title": "Golang reverse proxy with custom authentication", "body": "<p>I am trying to authenticate a user by calling a REST api, before I proxy the request to a remote server.\nHowever, I find that if I make the api call before proxy to remote server, the request will fail with the following error:</p>\n\n<pre><code>http: proxy error: http: ContentLength=139 with Body length 0.\n</code></pre>\n\n<p>If I remove the api call before proxy to remote server, the request can get through and return correct response.</p>\n\n<p>My middleware is as following:</p>\n\n<pre><code>func AuthMiddleware(next http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n                // the api call to external auth server\n        user_id, err := authenticate(r.FormValue(\"username\"), r.FormValue(\"password\"))      \n                if err != nil {\n            http.Error(w, err.Error(), 401)\n            return\n        }\n        next.ServeHTTP(w, r)\n    })\n}\n</code></pre>\n\n<p>My reverse proxy is as following:</p>\n\n<pre><code>func NewReverseProxy(target *url.URL) *httputil.ReverseProxy {\n    director := func(req *http.Request) {\n        req.URL.Scheme = target.Scheme\n        req.URL.Host = target.Host\n        req.URL.Path = target.Path\n        targetQuery := target.RawQuery\n        if targetQuery == \"\" || req.URL.RawQuery == \"\" {\n            req.URL.RawQuery = targetQuery + req.URL.RawQuery\n        } else {\n            req.URL.RawQuery = targetQuery + \"&amp;\" + req.URL.RawQuery\n        }\n        if _, ok := req.Header[\"User-Agent\"]; !ok {\n            // explicitly disable User-Agent so it's not set to default value\n            req.Header.Set(\"User-Agent\", \"\")\n        }\n    }\n    return &amp;httputil.ReverseProxy{Director: director}\n}\n</code></pre>\n\n<p>And I am using Chi for routing</p>\n\n<pre><code>r.Use(AuthMiddleware)\nr.Post(\"/\", NewReverseProxy(targets).ServeHTTP)\n</code></pre>\n\n<p>What is the issue with this implementation? </p>\n"}, {"tags": ["go", "go-iris"], "comments": [{"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 4, "creation_date": 1488914121, "post_id": 42648414, "comment_id": 72438635, "body": "Just for consideration: <a href=\"http://www.florinpatan.ro/2016/10/why-you-should-not-use-iris-for-your-go.html\" rel=\"nofollow noreferrer\">this post</a>"}, {"owner": {"reputation": 324, "user_id": 1810160, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/dk8wH.jpg?s=128&g=1", "display_name": "bodyflex", "link": "https://stackoverflow.com/users/1810160/bodyflex"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488959226, "post_id": 42648414, "comment_id": 72456461, "body": "@Havelock oh damn, that&#39;s super sketchy, had no idea! will definitely start looking into alternatives."}, {"owner": {"reputation": 769, "user_id": 2647655, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/qGHOi.png?s=128&g=1", "display_name": "kataras", "link": "https://stackoverflow.com/users/2647655/kataras"}, "edited": false, "score": 0, "creation_date": 1505039320, "post_id": 42648414, "comment_id": 79241143, "body": "Don&#39;&#39;t believe those things, you can just go to the repository, Iris has unique features and  you can use tools which you can verify it by yourself, that post is under investigation by the Go Conduct team, don&#39;t believe dlsniper he wants to be famous by other&#39;s fame."}], "owner": {"reputation": 324, "user_id": 1810160, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/dk8wH.jpg?s=128&g=1", "display_name": "bodyflex", "link": "https://stackoverflow.com/users/1810160/bodyflex"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 99, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488889937, "creation_date": 1488889937, "question_id": 42648414, "link": "https://stackoverflow.com/questions/42648414/how-to-use-virtual-hosts-with-iris", "title": "How to use virtual hosts with Iris?", "body": "<p>I'm wondering why the following won't work with Iris (v6.2.0):</p>\n\n<pre><code>import (\n    \"gopkg.in/kataras/iris.v6\"\n    \"gopkg.in/kataras/iris.v6/adaptors/httprouter\"\n)\n\nfunc main() {\n    app := iris.New()\n    app.Adapt(iris.DevLogger())\n    app.Adapt(httprouter.New())\n\n    exampleCom := app.Party(\"example.com\")\n    {\n        exampleCom.Get(\"/\", func(c *iris.Context) {\n            c.Writef(\"hello from example.com\")\n        })\n    }\n\n    app.Get(\"/\", func(c *iris.Context) {\n        c.Writef(\"hello from everywhere else\")\n    })\n\n    app.Listen(\":3000\")\n}\n</code></pre>\n\n<p>I have pointed example.com to localhost in my hosts configuration. Visiting <code>localhost:3000</code> does give me \"hello from everywhere else\", but visiting <code>example.com:3000</code> gives me Iris' 404 page.</p>\n"}, {"tags": ["c#", "go", "sha1"], "comments": [{"owner": {"reputation": 4886, "user_id": 298609, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/29f6d187e350a70016ba7fbcad189662?s=128&d=identicon&r=PG", "display_name": "Paya", "link": "https://stackoverflow.com/users/298609/paya"}, "edited": false, "score": 2, "creation_date": 1488888481, "post_id": 42647857, "comment_id": 72421988, "body": "I don&#39;t know Golang, but first thing I noticed is that he is using <code>Encoding.Unicode.GetBytes</code>, which means it will produce 2 bytes per character in the <code>bytes</code> and <code>src</code> array, and subsequently <code>dst</code> array. Can you check for your Golang code that it handles this correctly?"}, {"owner": {"reputation": 273, "user_id": 3559801, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7b8996e43ec87f7e1fab8d548c7d2a58?s=128&d=identicon&r=PG&f=1", "display_name": "Mert Serin", "link": "https://stackoverflow.com/users/3559801/mert-serin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488890527, "post_id": 42647857, "comment_id": 72423330, "body": "@icza I don&#39;t understand why salt need to be interpreted as a hex string? In database it saved as a string."}], "answers": [{"comments": [{"owner": {"reputation": 273, "user_id": 3559801, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7b8996e43ec87f7e1fab8d548c7d2a58?s=128&d=identicon&r=PG&f=1", "display_name": "Mert Serin", "link": "https://stackoverflow.com/users/3559801/mert-serin"}, "edited": false, "score": 0, "creation_date": 1488891604, "post_id": 42648911, "comment_id": 72424032, "body": "works like charm! thank you man I&#39;ve been struggling with this for 2 days"}], "tags": [], "owner": {"reputation": 102162, "user_id": 613130, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/40bd5f390cba274159501bb244bc29f4?s=128&d=identicon&r=PG", "display_name": "xanatos", "link": "https://stackoverflow.com/users/613130/xanatos"}, "is_accepted": true, "score": 4, "last_activity_date": 1488891330, "last_edit_date": 1495535459, "creation_date": 1488891330, "answer_id": 42648911, "question_id": 42647857, "link": "https://stackoverflow.com/questions/42647857/converting-c-sha1-code-to-golang/42648911#42648911", "title": "Converting C# SHA1 code to Golang", "body": "<p>The problem is that the C# code is using the <code>Encoding.Unicode</code>. In Go it should be:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/sha1\"\n    \"encoding/base64\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"unicode/utf16\"\n)\n\nfunc main() {\n    s := \"fish123\"\n    salt := \"227EA7ABD26E40608A6EDEB209058D93A632D1D1A52246D0A27F6E447B16AEBF\"\n\n    h1 := sha1.New()\n    h1.Write(convertUTF16ToLittleEndianBytes(salt))\n    h1.Write(convertUTF16ToLittleEndianBytes(s))\n\n    b64 := base64.StdEncoding.EncodeToString(h1.Sum(nil))\n    fmt.Println(b64)\n}\n\nfunc convertUTF16ToLittleEndianBytes(s string) []byte {\n    u := utf16.Encode([]rune(s))\n    b := make([]byte, 2*len(u))\n    for index, value := range u {\n        binary.LittleEndian.PutUint16(b[index*2:], value)\n    }\n    return b\n}\n</code></pre>\n\n<p>The <a href=\"https://stackoverflow.com/a/33711331/613130\"><code>convertUTF16ToLittleEndianBytes</code></a> was taken from another response on SO.</p>\n"}], "owner": {"reputation": 273, "user_id": 3559801, "user_type": "registered", "accept_rate": 46, "profile_image": "https://www.gravatar.com/avatar/7b8996e43ec87f7e1fab8d548c7d2a58?s=128&d=identicon&r=PG&f=1", "display_name": "Mert Serin", "link": "https://stackoverflow.com/users/3559801/mert-serin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1071, "favorite_count": 0, "accepted_answer_id": 42648911, "answer_count": 1, "score": 2, "last_activity_date": 1488891330, "creation_date": 1488888281, "question_id": 42647857, "link": "https://stackoverflow.com/questions/42647857/converting-c-sha1-code-to-golang", "title": "Converting C# SHA1 code to Golang", "body": "<p>I need to convert some old C# code to Golang and I stuck somewhere. C# code looks like this \n`</p>\n\n<pre><code> byte[] bytes = Encoding.Unicode.GetBytes(password);\n byte[] src = Encoding.Unicode.GetBytes(salt);\n byte[] dst = new byte[src.Length + bytes.Length];\n Buffer.BlockCopy(src, 0, dst, 0, src.Length);\n Buffer.BlockCopy(bytes, 0, dst, src.Length, bytes.Length);\n HashAlgorithm algorithm = HashAlgorithm.Create(\"SHA1\");\n byte[] inArray = algorithm.ComputeHash(dst);\n return Convert.ToBase64String(inArray);\n</code></pre>\n\n<p>so I examined the code line by line and as I understand he used convert the salt and password byte array then he copied these arrays to 'dst' array. Then he used SHA1 algorithm and convert this array to base64string. </p>\n\n<p>My Golang code looks like this but It doesn't create the same string which stores on database.</p>\n\n<pre><code>s := \"fish123\"\nsalt := \"227EA7ABD26E40608A6EDEB209058D93A632D1D1A52246D0A27F6E447B16AEBF\"\n\nh1 := sha1.New()\nh1.Write([]byte(salt))\nh1.Write([]byte(s))\n\nhashedPassword := base64.StdEncoding.EncodeToString(h1.Sum(nil))\n</code></pre>\n\n<p>Can anyone find my fault? Thanks</p>\n"}, {"tags": ["function", "go", "parameter-passing"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1488885194, "post_id": 42646717, "comment_id": 72419890, "body": "You are not passing functions in your code,  you just store function values in local variables, which then you call. See this related question: <a href=\"http://stackoverflow.com/questions/4358031/first-class-functions-in-go\">First class functions in Go</a>"}, {"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 1, "creation_date": 1488886449, "post_id": 42646717, "comment_id": 72420681, "body": "It makes no difference."}, {"owner": {"reputation": 11, "user_id": 1975257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88479b18d814dcf5b34304b30e0e2cd5?s=128&d=identicon&r=PG", "display_name": "Eureka.gh", "link": "https://stackoverflow.com/users/1975257/eureka-gh"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488917677, "post_id": 42646717, "comment_id": 72440783, "body": "Thanks @icza. I felt it should be no difference though, one of my colleagues seems to think otherwise. What I am curious about is that I couldn&#39;t found any piece of code online writing in the second style while it&#39;s so common in Javascript(I just switch from Javascript to Golang a couple of weeks ago). Besides, there&#39;s no mentioning the heap &amp; stack in Golang&#39;s spec, it looks that Golang is smart enough to dynamically allocate memory so that users don&#39;t care the memory leaking like c/c++. Am I right?"}], "answers": [{"tags": [], "owner": {"reputation": 41009, "user_id": 450989, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YGjdr.jpg?s=128&g=1", "display_name": "Grzegorz \u017bur", "link": "https://stackoverflow.com/users/450989/grzegorz-%c5%bbur"}, "is_accepted": false, "score": 1, "last_activity_date": 1488885153, "creation_date": 1488885153, "answer_id": 42646791, "question_id": 42646717, "link": "https://stackoverflow.com/questions/42646717/pass-a-function-body-defintion-as-parameter-to-a-function-call-in-golang/42646791#42646791", "title": "Pass a function body/defintion as parameter to a function call in golang", "body": "<p>There is no difference, use the one that better fits your style.</p>\n"}], "owner": {"reputation": 11, "user_id": 1975257, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/88479b18d814dcf5b34304b30e0e2cd5?s=128&d=identicon&r=PG", "display_name": "Eureka.gh", "link": "https://stackoverflow.com/users/1975257/eureka-gh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1074, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1488885153, "creation_date": 1488884978, "question_id": 42646717, "link": "https://stackoverflow.com/questions/42646717/pass-a-function-body-defintion-as-parameter-to-a-function-call-in-golang", "title": "Pass a function body/defintion as parameter to a function call in golang", "body": "<p>I am come across the following question recently in using golang. Is it ok to pass a function body to a function call, like javascript. \ne.g. <code>setTimeout(function(i){console.log(\"input:\", i)}, 1000).</code></p>\n\n<p>It's pretty common to pass an anonymous function to another function in javascript. I was wondering if is the same in go?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype HandlerFunc func(int)\n\nfunc main() {\n    // define a function as object/variable?\n    hnd := func(in int){\n        fmt.Println(\"func handler returns input\", in);\n    }\n    a:=HandlerFunc(hnd) //pass function object/variable to type HandlerFunc\n    a(10)\n\n    // pass function body directly to type HandlerFunc\n    b:=HandlerFunc(func(_in int){\n        fmt.Println(\"another func handler returns input\", _in);\n    })\n    b(100)\n\n    fmt.Println(\"Hello, playground\")\n}\n</code></pre>\n\n<p>They both works, but I was wondering if there is any difference between these two use, And which one is more preferable? </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1488883988, "post_id": 42646131, "comment_id": 72419079, "body": "You should post a working example. E.g. you did not show what <code>Combinations</code> does or how <code>data</code> is declared and used."}, {"owner": {"reputation": 137, "user_id": 7189016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da99ea19dc2c8aef52156fa7f5f3703c?s=128&d=identicon&r=PG&f=1", "display_name": "joao", "link": "https://stackoverflow.com/users/7189016/joao"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488884447, "post_id": 42646131, "comment_id": 72419387, "body": "I have cleaned up the code to not include any non relevancy."}, {"owner": {"reputation": 137, "user_id": 7189016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da99ea19dc2c8aef52156fa7f5f3703c?s=128&d=identicon&r=PG&f=1", "display_name": "joao", "link": "https://stackoverflow.com/users/7189016/joao"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488884838, "post_id": 42646131, "comment_id": 72419663, "body": "With my latest edit, you should be able to just copy/paste."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": true, "score": 2, "last_activity_date": 1488886360, "creation_date": 1488886360, "answer_id": 42647234, "question_id": 42646131, "link": "https://stackoverflow.com/questions/42646131/incorrect-values-inside-goroutines-when-looping/42647234#42647234", "title": "Incorrect values inside goroutines when looping", "body": "<p>The problem is that you goroutines all work on distinc int slices but these share a common backing array: After completing <code>Combinations</code> the slice <code>s</code> will be full of <code>5</code>s. Your <code>c</code> in main shares the underlying backing array with s. </p>\n\n<p>But your goroutines do not start executing until <code>Combinations</code> is done so once they do start, the will see the final value of <code>s</code> which is just 5s.</p>\n\n<p>Here it does not help to pass in the slice like you did as this makes a proper copy of <code>c</code> but not of the backing array.</p>\n\n<p>Try</p>\n\n<pre><code>Combinations(totalHashFields, i, func(c []int) {\n    fmt.Println(\"Outside goroutine:\", c)\n    cpy := make([]int, len(c))\n    copy(cpy, c)\n    go func(c []int) {\n        fmt.Println(\"Inside goroutine:\", c)\n    }(cpy)\n})\n</code></pre>\n\n<p>to make a \"deep copy\" of c.</p>\n"}], "owner": {"reputation": 137, "user_id": 7189016, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/da99ea19dc2c8aef52156fa7f5f3703c?s=128&d=identicon&r=PG&f=1", "display_name": "joao", "link": "https://stackoverflow.com/users/7189016/joao"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 42647234, "answer_count": 1, "score": 4, "last_activity_date": 1488886360, "creation_date": 1488883433, "last_edit_date": 1488884372, "question_id": 42646131, "link": "https://stackoverflow.com/questions/42646131/incorrect-values-inside-goroutines-when-looping", "title": "Incorrect values inside goroutines when looping", "body": "<p>I have read through <a href=\"https://github.com/golang/go/wiki/CommonMistakes#using-goroutines-on-loop-iterator-variables\" rel=\"nofollow noreferrer\">CommonMistakes</a> as well as run my code through the -race flag, but I can't seem to pinpoint what is wrong here:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    i := 1\n    totalHashFields := 6\n    for i &lt;= totalHashFields {\n        Combinations(totalHashFields, i, func(c []int) {\n            fmt.Println(\"Outside goroutine:\", c)\n            go func(c []int) {\n                fmt.Println(\"Inside goroutine:\", c)\n            }(c)\n        })\n        i++\n    }\n}\n\nfunc Combinations(n, m int, emit func([]int)) {\n    s := make([]int, m)\n    last := m - 1\n    var rc func(int, int)\n    rc = func(i, next int) {\n        for j := next; j &lt; n; j++ {\n            s[i] = j\n            if i == last {\n                emit(s)\n            } else {\n                rc(i+1, j+1)\n            }\n        }\n        return\n    }\n    rc(0, 0)\n}\n</code></pre>\n\n<p>(The Combinations function is a combinations <a href=\"https://rosettacode.org/wiki/Combinations\" rel=\"nofollow noreferrer\">algo</a> for those interested)</p>\n\n<p>Here is some of the output from fmt.Println:</p>\n\n<pre><code>Outside goroutine: [0 1 4]\nInside goroutine: [5 5 5]\nOutside goroutine: [0 1 2 3 4 5]\nInside goroutine: [5 5 5 5 5 5]\n</code></pre>\n\n<p>Basically, even though I'm passing c as a parameter to my anonymous go function, the value is consistently different to the value outside of this scope. In the output above, I expected the 2 \"Inside\" values to also be [0 1 4] and [0 1 2 3 4 5], respectfully.</p>\n"}, {"tags": ["performance", "google-app-engine", "go", "google-bigquery", "google-cloud-storage"], "comments": [{"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1488889463, "post_id": 42645499, "comment_id": 72422614, "body": "Try to create a simple runnable example and post that as Issue on the github&#39;s library issue tracker. It might be an implementation bug."}, {"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "reply_to_user": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1488894750, "post_id": 42645499, "comment_id": 72426156, "body": "@Pentium10 How do I do that considering that I export data to GCS?"}, {"owner": {"reputation": 189352, "user_id": 243782, "user_type": "registered", "accept_rate": 94, "profile_image": "https://i.stack.imgur.com/gInNr.png?s=128&g=1", "display_name": "Pentium10", "link": "https://stackoverflow.com/users/243782/pentium10"}, "edited": false, "score": 0, "creation_date": 1488894972, "post_id": 42645499, "comment_id": 72426317, "body": "you can use public data for export, and you can leave GCS path as <i>edited</i>"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1488962750, "post_id": 42645499, "comment_id": 72458293, "body": "Just a guess, but I wonder if the Go library is setting setting the default query priority to <code>batch</code> instead of <code>interactive</code>. Can you try explicitly setting the <code>QueryPriority</code> to Interactive and see if that helps? If you set it to <code>batch</code> in the WebUI, do the times then line up?<a href=\"https://sourcegraph.com/go/cloud.google.com/go/bigquery/-/QueryPriority\" rel=\"nofollow noreferrer\">sourcegraph.com/go/cloud.google.com/go/bigquery/-/QueryPr&zwnj;&#8203;iority</a>"}, {"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "reply_to_user": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1488965883, "post_id": 42645499, "comment_id": 72460202, "body": "@GrahamPolley The API at least specifically says that it sets them to interactive as default  <a href=\"https://godoc.org/google.golang.org/api/bigquery/v2#JobConfigurationQuery\" rel=\"nofollow noreferrer\">godoc.org/google.golang.org/api/bigquery/&hellip;</a>"}, {"owner": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1489011531, "post_id": 42645499, "comment_id": 72490082, "body": "I know. But maybe it&#39;s a bug. Can you test it?"}, {"owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "reply_to_user": {"reputation": 12372, "user_id": 2877278, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/jO6Hj.jpg?s=128&g=1", "display_name": "Graham Polley", "link": "https://stackoverflow.com/users/2877278/graham-polley"}, "edited": false, "score": 0, "creation_date": 1489181717, "post_id": 42645499, "comment_id": 72575814, "body": "@GrahamPolley Tried it today, no difference"}], "owner": {"reputation": 218, "user_id": 5036567, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/M5DvO.jpg?s=128&g=1", "display_name": "Zanndorin", "link": "https://stackoverflow.com/users/5036567/zanndorin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 90, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488881719, "creation_date": 1488881719, "last_edit_date": 1495535404, "question_id": 42645499, "link": "https://stackoverflow.com/questions/42645499/bigquery-go-export-job-slower-than-webgui", "title": "Bigquery.go export job slower than WebGUI", "body": "<p>Follow up to <a href=\"https://stackoverflow.com/questions/42509768/bigquery-go-export-job-much-slower-than-webgui\">this</a></p>\n\n<p>I have now found that my 2 jobs take 2-4 seconds and 8-15 seconds respectively.</p>\n\n<p>When I run my two jobs from the Bigquery.go client library they are done after 50-70 seconds. I use job.Wait() and have tried my own polling function (polling every 5 seconds) but there is not a noticeably change. Is this an issue in the client library, on the link level or my code?</p>\n\n<p>Job 1 (DB Query, ~5s when checking by console)</p>\n\n<pre><code>job, err := database_query.Run(ctx)\nif err != nil {\n    return err\n}\n\njobID := job.ID()\njob, err = client.JobFromID(ctx, jobID)\nif err != nil {\n    return err\n}\n\nstatus, err := job.Wait(ctx)\nif err != nil {\n    return err\n}\n</code></pre>\n\n<p>Job 2 (~12s when checking by console)</p>\n\n<pre><code>job_extract, err := extractor.Run(ctx)\nif err != nil {\n    return err\n}\n\nstatus, err = job_extract.Wait(ctx)\nif err != nil {\n    return err\n}\nif status.Err() != nil {\n    handler.Logger.Criticalf(\"Job failed with error %v\", status.Err())\n    return status.Err()\n}\n</code></pre>\n\n<p>After this there is a simple return with code 200.</p>\n\n<p><em>I know that there is code which does not do anything which will be removed later.</em></p>\n"}, {"tags": ["ssl", "go", "https", "proxy", "request"], "comments": [{"owner": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 2, "creation_date": 1488886590, "post_id": 42645242, "comment_id": 72420777, "body": "Why aren&#39;t you using <code>http.Client</code> + <code>http.Transport</code> (for TLS params) + <code>http.NewRequest</code>?"}, {"owner": {"reputation": 11, "user_id": 6450309, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153754832181242/picture?type=large", "display_name": "Huzeyfe Co\u015fkun", "link": "https://stackoverflow.com/users/6450309/huzeyfe-co%c5%9fkun"}, "reply_to_user": {"reputation": 5779, "user_id": 1357978, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1492420466abb7ec2ed53cac8c7e8d02?s=128&d=identicon&r=PG", "display_name": "Nadh", "link": "https://stackoverflow.com/users/1357978/nadh"}, "edited": false, "score": 0, "creation_date": 1488894521, "post_id": 42645242, "comment_id": 72425998, "body": "i am going to implement my own basic http/https server. i did http implementation without error also its very fast but when it comes to https i stucked."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488905613, "post_id": 42645242, "comment_id": 72433713, "body": "The ServerName field docs say <code>&#47;&#47; server name requested by client, if any (server side only)</code>, You aren&#39;t setting a server name in the request, and you are on the client side. Have you looked at how <a href=\"https://golang.org/src/net/http/transport.go#L1063\" rel=\"nofollow noreferrer\"><code>http.Transport</code> creates the connection</a>?"}], "owner": {"reputation": 11, "user_id": 6450309, "user_type": "registered", "profile_image": "https://graph.facebook.com/10153754832181242/picture?type=large", "display_name": "Huzeyfe Co\u015fkun", "link": "https://stackoverflow.com/users/6450309/huzeyfe-co%c5%9fkun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1305, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488880990, "creation_date": 1488880990, "question_id": 42645242, "link": "https://stackoverflow.com/questions/42645242/golang-https-request-with-tls-dial", "title": "Golang : https request with tls.dial", "body": "<p>i am trying to make https request with golang. </p>\n\n<pre><code>conf := &amp;tls.Config{\n    InsecureSkipVerify: true,\n    MinVersion:tls.VersionTLS10,\n}\n//TLS connection\ntlsCon, err := tls.Dial(\"tcp\", \"youtube.com:443\", conf)\nif err != nil {\n    fmt.Println(\"SSL Error : \" + err.Error())\n    return\n}\n\ndefer tlsCon.Close()\n\nstate := tlsCon.ConnectionState()\nfmt.Println(\"SSL ServerName : \" + state.ServerName)\nfmt.Println(\"SSL Handshake : \", state.HandshakeComplete)\nfmt.Println(\"SSL Mutual : \", state.NegotiatedProtocolIsMutual)\n\nrequest = '\nCONNECT youtube.com:443 HTTP/1.1\nUser-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64; rv:51.0) Gecko/20100101       Firefox/51.0\nProxy-Connection: close\nConnection: close\nHost: youtube.com:443\n\n'\n\nn, err = io.WriteString(tlsCon, request)\nif err != nil {\n    fmt.Println(\"SSL Write error :\", err.Error(), n)\n}\n\nn, err = tlsCon.Read(data)\nif err != nil {\n    fmt.Println(\"SSL Read error : \" + err.Error())\n    return\n}\n</code></pre>\n\n<p>this is my code , state.HandshakeComplete, state.NegotiatedProtocolIsMutual returns true  and state.ServerName returns = ''</p>\n\n<p>when i write data to tls connection no error returns also tls connection never reply my request.</p>\n\n<p>any help appricated. thanks.</p>\n"}, {"tags": ["json", "string", "go", "marshalling"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 2, "creation_date": 1488881912, "post_id": 42645231, "comment_id": 72417753, "body": "Unmarshal to <code>map[string]string</code> and you are done."}, {"owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488883723, "post_id": 42645231, "comment_id": 72418884, "body": "That was easy. Thank you @Volker."}], "answers": [{"tags": [], "owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "is_accepted": true, "score": 2, "last_activity_date": 1488882264, "creation_date": 1488882264, "answer_id": 42645698, "question_id": 42645231, "link": "https://stackoverflow.com/questions/42645231/golang-converting-string-to-individual-json-values-and-not-a-list-similar-to-js/42645698#42645698", "title": "Golang converting string to individual json values and not a list, similar to json.loads in python", "body": "<p>You can use unmarshal the string in a map[string]interface{}.\nFor example <a href=\"https://play.golang.org/p/fjgg0iQgV1\" rel=\"nofollow noreferrer\">https://play.golang.org/p/fjgg0iQgV1</a></p>\n"}], "owner": {"reputation": 1317, "user_id": 5414872, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/07e71c5939c157e8fa39100bb785262d?s=128&d=identicon&r=PG&f=1", "display_name": "scott", "link": "https://stackoverflow.com/users/5414872/scott"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 292, "favorite_count": 0, "accepted_answer_id": 42645698, "answer_count": 1, "score": 0, "last_activity_date": 1488882264, "creation_date": 1488880956, "last_edit_date": 1488881504, "question_id": 42645231, "link": "https://stackoverflow.com/questions/42645231/golang-converting-string-to-individual-json-values-and-not-a-list-similar-to-js", "title": "Golang converting string to individual json values and not a list, similar to json.loads in python", "body": "<p>Apologies for this noob question.</p>\n\n<p>I am trying to convert a string to json. The string is already in json format like</p>\n\n<pre><code>{ \"system1\": \"Service 1\", \"System2\": \"Service2\" } \n</code></pre>\n\n<p>or</p>\n\n<pre><code>{ \"system1\": \"Service 1\", \"device\": \"Service 10\", \"Something\": \"port 22\" }\n</code></pre>\n\n<p>and so on. The number of this key-value pair is not known at compile time, and is known only at the runtime. </p>\n\n<p>I am able to load it to a struct, with predefined fixed keynames, but since the number of keys are varying, I am stuck at generating a json with respect to the structure of the string.</p>\n\n<p>I am not looking for pushing it to a <code>string : []map[string]string</code> and my aim is to generate individually generate the key-value pair similar to python's <code>json.loads</code> on the string (Not prefering <code>string : []map[string]string</code> because to get an element out of it, I have to iterate over it, which takes <code>O(n)</code> time, but since the keys are known in runtime, and not a list, I could directly call it as <code>if value.Key</code>. Please correct me if I am wrong.)</p>\n\n<p>The way I could do it with python was, </p>\n\n<pre><code>&gt;&gt;&gt; a =  { \"system1\": \"Service 1\", \"System2\": \"Service2\" } \n&gt;&gt;&gt; b = json.loads(a)\n&gt;&gt;&gt; b\n{u'system1': u'Service 1', u'System2': u'Service2'}\n</code></pre>\n\n<p>and I could access elements as </p>\n\n<pre><code>b['system1']\n</code></pre>\n\n<p>without iterating over b, because it is not a slice.</p>\n\n<p>Any guidance is appreciated.</p>\n\n<p>Thanks,\nScott.    </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488878937, "post_id": 42643765, "comment_id": 72415931, "body": "&quot;Why this two pieces of code is not equal ?&quot; because the language spec says so. The error message is pretty self explanatory, or?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1488876988, "last_edit_date": 1495539968, "creation_date": 1488876674, "answer_id": 42643854, "question_id": 42643765, "link": "https://stackoverflow.com/questions/42643765/call-struct-method/42643854#42643854", "title": "Call struct method", "body": "<p>Your <code>FeedService.GetAllRssFeeds()</code> method has pointer receiver, so a pointer to <code>FeedService</code> is needed to call this method.</p>\n\n<p>In your first example you use a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a> to store a <code>FeedService</code> struct value in a local variable. Local variables are <a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">addressable</a>, so when you write <code>feedService.GetAllRssFeeds()</code> after that, the compiler will automatically take the address of <code>feedService</code> and use that as the receiver value. It is a shorthand for:</p>\n\n<pre><code>feeds, err := (&amp;feedService).GetAllRssFeeds()\n</code></pre>\n\n<p>It is in <a href=\"https://golang.org/ref/spec#Calls\" rel=\"nofollow noreferrer\">Spec: Calls:</a></p>\n\n<blockquote>\n  <p>If <code>x</code> is addressable and <code>&amp;x</code>'s method set contains <code>m</code>, <code>x.m()</code> is shorthand for <code>(&amp;x).m()</code>.</p>\n</blockquote>\n\n<p>In your second example you don't create a local variable, you just use a struct <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">composite literal</a>, but by itself it is not (automatically) addressable, so the compiler cannot obtain a pointer to <code>FeedService</code> value to be used as the receiver, and hence cannot call the method.</p>\n\n<p>Note that it is allowed to take the address of a composite literal <em>explicitly</em>, so the following also works:</p>\n\n<pre><code>feeds, err := (&amp;postgres.FeedService{}).GetAllRssFeeds()\n</code></pre>\n\n<p>This is in <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow noreferrer\">Spec: Composite literals:</a></p>\n\n<blockquote>\n  <p><a href=\"https://golang.org/ref/spec#Address_operators\" rel=\"nofollow noreferrer\">Taking the address</a> of a composite literal generates a pointer to a unique <a href=\"https://golang.org/ref/spec#Variables\" rel=\"nofollow noreferrer\">variable</a> initialized with the literal's value.</p>\n</blockquote>\n\n<p>See related questions:</p>\n\n<p><a href=\"https://stackoverflow.com/questions/42477951/what-is-the-method-set-of-sync-waitgroup/42480671#42480671\">What is the method set of `sync.WaitGroup`?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/38481420/calling-a-method-with-a-pointer-receiver-by-an-object-instead-of-a-pointer-to-it/38481697#38481697\">Calling a method with a pointer receiver by an object instead of a pointer to it?</a></p>\n"}], "owner": {"reputation": 40088, "user_id": 205270, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/Q5hW8.jpg?s=128&g=1", "display_name": "demas", "link": "https://stackoverflow.com/users/205270/demas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 203, "favorite_count": 0, "accepted_answer_id": 42643854, "answer_count": 1, "score": 0, "last_activity_date": 1488876988, "creation_date": 1488876409, "question_id": 42643765, "link": "https://stackoverflow.com/questions/42643765/call-struct-method", "title": "Call struct method", "body": "<p>This code works fine:</p>\n\n<pre><code>feedService := postgres.FeedService{}\nfeeds, err := feedService.GetAllRssFeeds()\n</code></pre>\n\n<p>But this code gives me error:</p>\n\n<pre><code>feeds, err = postgres.FeedService{}.GetAllRssFeeds()\n</code></pre>\n\n<blockquote>\n  <p>controllers\\feed_controller.go:35: cannot call pointer method on\n  postgres.FeedService literal controllers\\feed_controller.go:35: cannot\n  take the address of postgres.FeedService literal</p>\n</blockquote>\n\n<p>Why this two pieces of code is not equal ?</p>\n\n<p>Here is a struct declaration:</p>\n\n<pre><code>type FeedService struct {\n\n}\n\nfunc (s *FeedService) GetAllRssFeeds() ([]*quzx.RssFeed, error) {\n</code></pre>\n"}, {"tags": ["go", "x509certificate", "tls1.2", "pki", "mutual-authentication"], "answers": [{"tags": [], "owner": {"reputation": 5565, "user_id": 3915, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ccd658bdf42cb1145386e10bf3da116a?s=128&d=identicon&r=PG", "display_name": "Mark", "link": "https://stackoverflow.com/users/3915/mark"}, "is_accepted": true, "score": 3, "last_activity_date": 1488879266, "creation_date": 1488879266, "answer_id": 42644636, "question_id": 42643048, "link": "https://stackoverflow.com/questions/42643048/signing-certificate-request-with-certificate-authority/42644636#42644636", "title": "Signing certificate request with certificate authority", "body": "<p>You may be able to use <a href=\"https://golang.org/pkg/crypto/x509/#CreateCertificate\" rel=\"nofollow noreferrer\">x509.CreateCertificate</a>.</p>\n\n<p>One of the parameters to CreateCertificate is a 'template' certificate.</p>\n\n<p>You can set the fields of the template certificate using the fields from Julia's <a href=\"https://golang.org/pkg/crypto/x509/#CertificateRequest\" rel=\"nofollow noreferrer\">CertificateRequest</a>.</p>\n\n<p>Go's <a href=\"https://golang.org/src/crypto/tls/generate_cert.go\" rel=\"nofollow noreferrer\">generate cert</a> script shows an example usage CreateCertificate.</p>\n\n<p>This assumes the API request from Julia is really from Julia, and sufficiently trusted to sign the request and return a certificate.</p>\n\n<p>Also, <a href=\"http://www.hydrogen18.com/blog/your-own-pki-tls-golang.html\" rel=\"nofollow noreferrer\">Using your own PKI for TLS in Go</a> may be of help.</p>\n"}, {"tags": [], "owner": {"reputation": 265, "user_id": 7665686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9092b0b76a95833d55de34fa63480ec9?s=128&d=identicon&r=PG&f=1", "display_name": "krostar", "link": "https://stackoverflow.com/users/7665686/krostar"}, "is_accepted": false, "score": 15, "last_activity_date": 1488950618, "creation_date": 1488950618, "answer_id": 42663584, "question_id": 42643048, "link": "https://stackoverflow.com/questions/42643048/signing-certificate-request-with-certificate-authority/42663584#42663584", "title": "Signing certificate request with certificate authority", "body": "<p>It work now, here is a basic solution to validate a CSR from a CRT with a CA:</p>\n\n<ul>\n<li>load ca certificate</li>\n<li>load ca private key (with password)</li>\n<li>load bob CSR</li>\n<li>create a certificate template with the CSR and CA informations</li>\n<li>generate the certificate from the template and with the CA private key</li>\n<li>save the bob's certificate</li>\n</ul>\n\n<p>A working example:</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/rand\"\n    \"crypto/x509\"\n    \"encoding/pem\"\n    \"io/ioutil\"\n    \"math/big\"\n    \"os\"\n    \"time\"\n)\n\nfunc crsToCrtExample() {\n    // load CA key pair\n    //      public key\n    caPublicKeyFile, err := ioutil.ReadFile(\"certs/ca-root.crt\")\n    if err != nil {\n        panic(err)\n    }\n    pemBlock, _ := pem.Decode(caPublicKeyFile)\n    if pemBlock == nil {\n        panic(\"pem.Decode failed\")\n    }\n    caCRT, err := x509.ParseCertificate(pemBlock.Bytes)\n    if err != nil {\n        panic(err)\n    }\n\n    //      private key\n    caPrivateKeyFile, err := ioutil.ReadFile(\"certs/ca-mutu.key\")\n    if err != nil {\n        panic(err)\n    }\n    pemBlock, _ = pem.Decode(caPrivateKeyFile)\n    if pemBlock == nil {\n        panic(\"pem.Decode failed\")\n    }\n    der, err := x509.DecryptPEMBlock(pemBlock, []byte(\"ca private key password\"))\n    if err != nil {\n        panic(err)\n    }\n    caPrivateKey, err := x509.ParsePKCS1PrivateKey(der)\n    if err != nil {\n        panic(err)\n    }\n\n    // load client certificate request\n    clientCSRFile, err := ioutil.ReadFile(\"certs/bob.csr\")\n    if err != nil {\n        panic(err)\n    }\n    pemBlock, _ = pem.Decode(clientCSRFile)\n    if pemBlock == nil {\n        panic(\"pem.Decode failed\")\n    }\n    clientCSR, err := x509.ParseCertificateRequest(pemBlock.Bytes)\n    if err != nil {\n        panic(err)\n    }\n    if err = clientCSR.CheckSignature(); err != nil {\n        panic(err)\n    }\n\n    // create client certificate template\n    clientCRTTemplate := x509.Certificate{\n        Signature:          clientCSR.Signature,\n        SignatureAlgorithm: clientCSR.SignatureAlgorithm,\n\n        PublicKeyAlgorithm: clientCSR.PublicKeyAlgorithm,\n        PublicKey:          clientCSR.PublicKey,\n\n        SerialNumber: big.NewInt(2),\n        Issuer:       caCRT.Subject,\n        Subject:      clientCSR.Subject,\n        NotBefore:    time.Now(),\n        NotAfter:     time.Now().Add(24 * time.Hour),\n        KeyUsage:     x509.KeyUsageDigitalSignature,\n        ExtKeyUsage:  []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth},\n    }\n\n    // create client certificate from template and CA public key\n    clientCRTRaw, err := x509.CreateCertificate(rand.Reader, &amp;clientCRTTemplate, caCRT, clientCSR.PublicKey, caPrivateKey)\n    if err != nil {\n        panic(err)\n    }\n\n    // save the certificate\n    clientCRTFile, err := os.Create(\"certs/bob.crt\")\n    if err != nil {\n        panic(err)\n    }\n    pem.Encode(clientCRTFile, &amp;pem.Block{Type: \"CERTIFICATE\", Bytes: clientCRTRaw})\n    clientCRTFile.Close()\n}\n</code></pre>\n\n<p>Thanks Mark!</p>\n"}, {"comments": [{"owner": {"reputation": 265, "user_id": 7665686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9092b0b76a95833d55de34fa63480ec9?s=128&d=identicon&r=PG&f=1", "display_name": "krostar", "link": "https://stackoverflow.com/users/7665686/krostar"}, "edited": false, "score": 2, "creation_date": 1506683958, "post_id": 46464886, "comment_id": 79929783, "body": "I already found a solution to <a href=\"https://github.com/krostar/nebulo-client-desktop/blob/dev/api/register.go#L66\" rel=\"nofollow noreferrer\">generate a CSR from a private key</a>, <a href=\"https://github.com/krostar/nebulo-server/blob/dev/router/handler/user_create.go#L82\" rel=\"nofollow noreferrer\">sign it with a CA and generate a new certificate from it</a> in order to handle TLS mutual authentication (<a href=\"https://github.com/krostar/nebulo-server/blob/dev/router/middleware/auth.go#L20\" rel=\"nofollow noreferrer\">server side</a> and <a href=\"https://github.com/krostar/nebulo-client-desktop/blob/dev/api/api.go#L38\" rel=\"nofollow noreferrer\">client side</a>), but thx for your help anyway !"}], "tags": [], "owner": {"reputation": 21, "user_id": 8596257, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/16IVL.jpg?s=128&g=1", "display_name": "Kirk MacPhee", "link": "https://stackoverflow.com/users/8596257/kirk-macphee"}, "is_accepted": false, "score": 2, "last_activity_date": 1506588557, "creation_date": 1506588557, "answer_id": 46464886, "question_id": 42643048, "link": "https://stackoverflow.com/questions/42643048/signing-certificate-request-with-certificate-authority/46464886#46464886", "title": "Signing certificate request with certificate authority", "body": "<p>Here's a snippet of code from a demo program I wrote for a blog post about PKI. Full post: <a href=\"https://anchorloop.com/2017/09/25/security-iq-ii-public-key-infrastructure/\" rel=\"nofollow noreferrer\">https://anchorloop.com/2017/09/25/security-iq-ii-public-key-infrastructure/</a></p>\n\n<pre><code>// Now read that number of bytes and parse the certificate request\nasn1Data := make([]byte, asn1DataSize)\n_, err = reader.Read(asn1Data)\nif err != nil {\n    return err\n}\nfmt.Println(\"Received Certificate Signing Request.\")\ncertReq, err := x509.ParseCertificateRequest(asn1Data)\nif err != nil {\n    return err\n}\n\n// Create template for certificate creation, uses properties from the request and root certificate.\nserialNumberLimit := new(big.Int).Lsh(big.NewInt(1), 128)\nserialNumber, err := rand.Int(rand.Reader, serialNumberLimit)\nif err != nil {\n    return err\n}\ntemplate := x509.Certificate {\n    Signature: certReq.Signature,\n    SignatureAlgorithm: certReq.SignatureAlgorithm,\n\n    PublicKeyAlgorithm: certReq.PublicKeyAlgorithm,\n    PublicKey: certReq.PublicKey,\n\n    SerialNumber: serialNumber,\n    Issuer: rootCert.Subject,\n    Subject: certReq.Subject,\n    NotBefore: time.Now(),\n    NotAfter: time.Now().Add(time.Hour * 24 * 365),\n    KeyUsage: x509.KeyUsageDigitalSignature,\n    ExtKeyUsage: []x509.ExtKeyUsage{x509.ExtKeyUsageClientAuth},\n}\n\n// Create certificate from template and root certificate, signed by the RootCA's private key.\ncertData, err := x509.CreateCertificate(rand.Reader, &amp;template, rootCert, template.PublicKey, privateKey)\nif err != nil {\n    return err\n}\nfmt.Println(\"Created Certificate from CSR, signed by RootCA's Private Key.\")\n</code></pre>\n\n<p>Basically:</p>\n\n<ul>\n<li>The CSR gets created and sent by the client.</li>\n<li>The owner of the signing certificate parses it and builds a new x509.Certificate from a mixture of properties from the CSR and signing certificate.</li>\n<li>The private key of the signer is passed to x509.CreateCertificate to sign it.</li>\n<li>After that, you can send it back to the client.</li>\n</ul>\n\n<p>I hope that helps.</p>\n"}], "owner": {"reputation": 265, "user_id": 7665686, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9092b0b76a95833d55de34fa63480ec9?s=128&d=identicon&r=PG&f=1", "display_name": "krostar", "link": "https://stackoverflow.com/users/7665686/krostar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8686, "favorite_count": 3, "accepted_answer_id": 42644636, "answer_count": 3, "score": 11, "last_activity_date": 1506588557, "creation_date": 1488873515, "last_edit_date": 1488879368, "question_id": 42643048, "link": "https://stackoverflow.com/questions/42643048/signing-certificate-request-with-certificate-authority", "title": "Signing certificate request with certificate authority", "body": "<p>I want to use TLS mutual authentication to authenticate a client on a API made in go. I've created a certificate authority, and let's say Bob has a key pair he wants to use with the client. Bob created a certificate request and want me to validate his certificate in order to be authorized and \nauthenticated on the API.</p>\n\n<p>I've used this to create my Certificate Authority :</p>\n\n<pre><code>openssl genrsa -aes256 -out ca.key 4096\nopenssl req -new -x509 -sha256 -days 730 -key ca.key -out ca.crt\n</code></pre>\n\n<p>Bob used this to create his certificate and certificate request :</p>\n\n<pre><code>openssl genrsa -out bob.key 4096\nopenssl req -new -key bob.key -out bob.csr\n</code></pre>\n\n<p>I want to achive this, but in go :</p>\n\n<pre><code>openssl x509 -req -days 365 -sha256 -in bob.csr -CA ca.crt -CAkey ca.key -set_serial 3 -out bob.crt\n</code></pre>\n\n<p>For now, with theses commands, Bob can create a TLS connection to my API which use this tls.Config :</p>\n\n<pre><code>func createTLSConfig(certFile string, keyFile string, clientCAFilepath string) (config *tls.Config, err error) {\n    cer, err := tls.LoadX509KeyPair(certFile, keyFile)\n    if err != nil {\n        return nil, err\n    }\n\n    clientCAFile, err := ioutil.ReadFile(clientCAFilepath)\n    if err != nil {\n        return nil, err\n    }\n    clientCAPool := x509.NewCertPool()\n    clientCAPool.AppendCertsFromPEM(clientCAFile)\n\n    config = &amp;tls.Config{\n        Certificates: []tls.Certificate{cer},\n        ClientAuth: tls.RequireAndVerifyClientCert,\n        ClientCAs:  clientCAPool,\n        CipherSuites: []uint16{\n            tls.TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,\n            tls.TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384,\n        },\n        PreferServerCipherSuites: true,\n        SessionTicketsDisabled:   false,\n        MinVersion:               tls.VersionTLS12,\n        CurvePreferences:         []tls.CurveID{tls.CurveP521, tls.CurveP384},\n    }\n\n    return config, nil\n}\n</code></pre>\n\n<p>But what if Julia now want to login ? She will have to create a CSR, send it to me and I would have to manually validate her CSR to a CRT too. To avoid this manual operation, the idea is to have a register endpoint where Julia can submit her CSR and get back a valid CRT. The endpoint will basically look like this :</p>\n\n<pre><code>func Register(c echo.Context) (err error) {\n    // get Julia's csr from POST body\n    csr := certificateFromBody(c.Body)\n\n    // valid csr with ca to generate the crt\n    crt := signCSR(csr, config.ClientCAPath)\n\n    // return the crt to julia\n    return c.JSON(http.StatusCreated, base64.StdEncoding.EncodeToString(crt))\n}\n</code></pre>\n\n<p>I spend some time to understand how openssl use the CA to create the CRT from the CRS, without success.</p>\n\n<p>Golang has a <a href=\"https://golang.org/pkg/crypto/x509/#CertificateRequest\" rel=\"noreferrer\">CertificateRequest object</a> from the crypto/x509 package that I can create with the <a href=\"https://golang.org/pkg/crypto/x509/#ParseCertificateRequest\" rel=\"noreferrer\">ParseCertificateRequest</a> but I can't find the function that take this object and my CA and return a certificate.</p>\n\n<p>Thank you for your help!</p>\n"}, {"tags": ["javascript", "html", "go", "local-storage", "pipeline"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1488873969, "post_id": 42642410, "comment_id": 72413373, "body": "Also asked <a href=\"https://groups.google.com/d/topic/golang-nuts/dNaoKtBEQp0/discussion\" rel=\"nofollow noreferrer\">here</a>. Next time please take care to mention other venues you&#39;ve used to post your question."}], "answers": [{"comments": [{"owner": {"reputation": 97, "user_id": 3809560, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4221ab68448e9413c315147180574ac0?s=128&d=identicon&r=PG&f=1", "display_name": "user3809560", "link": "https://stackoverflow.com/users/3809560/user3809560"}, "edited": false, "score": 0, "creation_date": 1488877278, "post_id": 42642988, "comment_id": 72415033, "body": "Thanks so much!. This is an awesome solution. I was trying to work out a javascript solution. You just saved my day!."}], "tags": [], "owner": {"reputation": 21441, "user_id": 723693, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/18b2fe761a7aa211adfb466500210412?s=128&d=identicon&r=PG", "display_name": "ain", "link": "https://stackoverflow.com/users/723693/ain"}, "is_accepted": true, "score": 1, "last_activity_date": 1488873225, "creation_date": 1488873225, "answer_id": 42642988, "question_id": 42642410, "link": "https://stackoverflow.com/questions/42642410/how-to-create-unique-ids-when-ranging-over-data-in-golang-and-use-in-javascript/42642988#42642988", "title": "How to create unique IDs when ranging over data in Golang and use in Javascript", "body": "<p>In the loop You have</p>\n\n<pre><code>&lt;button class=\"...\" id=\"pid\" name=\"{{.puid}}\" value=\"{{.puid}}\"&gt;Update&lt;/button&gt;\n</code></pre>\n\n<p>which means that all buttons have <code>id</code> attribute whith the same value <code>pid</code>. This is an bug as <code>id</code>-s must be unique in the document. And when you call</p>\n\n<pre><code>document.getElementById(\"pid\");\n</code></pre>\n\n<p>the first element matching the <code>id=\"pid\"</code> is returned. That explains why \"only the ID of the first table row element is getting stored\".</p>\n\n<p>To create unique id for each row you could use something like</p>\n\n<pre><code>{{range $index, $value := .}}\n...&lt;button class=\"...\" id=\"pid{{$index}}\" name=\"{{$value.puid}}\" value=\"{{$value.puid}}\"&gt;Update&lt;/button&gt;...\n{{end}}\n</code></pre>\n\n<p>but then you have a problem how to know which form was submitted when your <code>save_data()</code> event fires. To solve this you could send the current form or row id as a parameter, something like</p>\n\n<pre><code>{{range $index, $value := .}}\n&lt;td&gt;&lt;form onsubmit=\"save_data(this, {{$index}})\" action=\"/\" method=\"get\"&gt;...&lt;/form&gt;&lt;/td&gt;\n{{end}}\n\nfunction save_data(form, rowno) {\n  var input = document.getElementById(\"pid\"+rowno);\n  localStorage.setItem(\"id\", input.value); \n}  \n</code></pre>\n"}], "owner": {"reputation": 97, "user_id": 3809560, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/4221ab68448e9413c315147180574ac0?s=128&d=identicon&r=PG&f=1", "display_name": "user3809560", "link": "https://stackoverflow.com/users/3809560/user3809560"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 148, "favorite_count": 0, "accepted_answer_id": 42642988, "answer_count": 1, "score": 0, "last_activity_date": 1488873225, "creation_date": 1488871066, "question_id": 42642410, "link": "https://stackoverflow.com/questions/42642410/how-to-create-unique-ids-when-ranging-over-data-in-golang-and-use-in-javascript", "title": "How to create unique IDs when ranging over data in Golang and use in Javascript", "body": "<p>I am getting data from the server and iterating over it to create a table and then I am using a form to store an id to local storage using javascript. Here is code snippet</p>\n\n<pre><code>&lt;table&gt;\n    &lt;tr&gt;&lt;th&gt;Product ID&lt;/th&gt;&lt;/tr&gt;\n    {{range .}}\n    &lt;td &gt;&lt;form onsubmit=\"save_data()\" action=\"/\" method=\"get\"&gt;&lt;button class=\"btn btn-info pid\" id=\"pid\" name=\"{{.puid}}\" value=\"{{.puid}}\"&gt;Update&lt;/button&gt;&lt;/form&gt;&lt;/td&gt;\n    {{end}}\n&lt;table&gt;\n\n&lt;script&gt;\n\nfunction save_data() {\n  var input = document.getElementByID(\"pid\");\n  localStorage.setItem(\"id\", input.value); \n\n}   \n\n&lt;/script&gt;\n</code></pre>\n\n<p>However every time, no matter of which table row's \"update\" button I click, everytime only the ID of the first table row element is getting stored. \nIs there a way I can generate unique IDs and reference it in Javascript when ranging over the data.\nThanks</p>\n"}, {"tags": ["go", "kubernetes", "kubernetes-go-client"], "comments": [{"owner": {"reputation": 22623, "user_id": 147175, "user_type": "registered", "accept_rate": 93, "profile_image": "https://i.stack.imgur.com/PyWe3.jpg?s=128&g=1", "display_name": "Scott Stensland", "link": "https://stackoverflow.com/users/147175/scott-stensland"}, "edited": false, "score": 0, "creation_date": 1488864871, "post_id": 42639801, "comment_id": 72409058, "body": "replica set is the modern replacement for replication controller ... assure you are using a current release of kubernetes"}], "answers": [{"tags": [], "owner": {"reputation": 12722, "user_id": 393157, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/PiD4P.png?s=128&g=1", "display_name": "svenwltr", "link": "https://stackoverflow.com/users/393157/svenwltr"}, "is_accepted": true, "score": 0, "last_activity_date": 1488899742, "creation_date": 1488899742, "answer_id": 42651887, "question_id": 42639801, "link": "https://stackoverflow.com/questions/42639801/unable-to-create-a-deployment-without-replication-controller-in-kubernetes-clien/42651887#42651887", "title": "unable to create a deployment without replication controller in kubernetes client-go", "body": "<p>If you don't want the service to be restarted, then you can just use the Pod directly. There is no need to use a Deployment, since these only make sense, if you want to have automatic Pod restarts and roll-outs of updates.</p>\n\n<p>The code would look somehow like this (not tested):</p>\n\n<pre><code>podSpec := v1.PodSpec{\n    Containers: []v1.Container{\n        v1.Container{\n            Name:  \"nginx-container\",\n            Image: \"nginx\",\n            VolumeMounts: []v1.VolumeMount{\n                v1.VolumeMount{\n                    MountPath: \"/usr/share/nginx/html\",\n                    Name:      \"shared-data\",\n                },\n            },\n        },\n        v1.Container{\n            Name:  \"debian-container\",\n            Image: \"debian\",\n            VolumeMounts: []v1.VolumeMount{\n                v1.VolumeMount{\n                    MountPath: \"/pod-data\",\n                    Name:      \"shared-data\",\n                },\n            },\n            Command: []string{\n                \"/bin/sh\",\n            },\n            Args: []string{\n                \"-c\",\n                \"echo Hello from the debian container &gt; /pod-data/index1.html\",\n            },\n        },\n    },\n    RestartPolicy: v1.RestartPolicyAlways,\n    DNSPolicy:     v1.DNSClusterFirst,\n    Volumes: []v1.Volume{\n        v1.Volume{\n            Name: \"shared-data\",\n            VolumeSource: v1.VolumeSource{\n                EmptyDir: &amp;v1.EmptyDirVolumeSource{},\n            },\n        },\n    },\n}\n\n// Implement deployment update-or-create semantics.\ndeploy := c.Core().PodsGetter(namespace)\n_, err := deploy.Update(podSpec)\n</code></pre>\n"}], "owner": {"reputation": 121, "user_id": 7365012, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/4c28c4f95e4ac1b1d2457e5f733527a5?s=128&d=identicon&r=PG&f=1", "display_name": "Junyu", "link": "https://stackoverflow.com/users/7365012/junyu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 183, "favorite_count": 0, "accepted_answer_id": 42651887, "answer_count": 1, "score": 0, "last_activity_date": 1488899742, "creation_date": 1488858285, "question_id": 42639801, "link": "https://stackoverflow.com/questions/42639801/unable-to-create-a-deployment-without-replication-controller-in-kubernetes-clien", "title": "unable to create a deployment without replication controller in kubernetes client-go", "body": "<p>The issue is I cannot create a deployment spec without creating replication controller along with it.I would not like to use replication controller because my app always use only one pod and I would like to set restart policy to never to prevent any terminated container tries to restart.</p>\n\n<pre><code>apiVersion: v1\nkind: Pod\nmetadata:\n  name: two-containers\nspec:\nrestartPolicy: Never\n\n  volumes:\n  - name: shared-data\n    emptyDir: {}\n\n  containers:\n\n  - name: nginx-container\n    image: nginx\n    volumeMounts:\n    - name: shared-data\n      mountPath: /usr/share/nginx/html\n\n  - name: debian-container\n    image: debian\n    volumeMounts:\n    - name: shared-data\n      mountPath: /pod-data\n    command: [\"/bin/sh\"]\n    args: [\"-c\", \"echo Hello from the debian container &gt; /pod-data/index.html\"]\n</code></pre>\n\n<p>Above is the target yaml file, which I would like to implement and deploy with kubernetes client-go, however client-go currently only provides deployment with replication controller.</p>\n\n<pre><code>// Define Deployments spec.\n    deploySpec := &amp;v1beta1.Deployment{\n        TypeMeta: unversioned.TypeMeta{\n            Kind:       \"Deployment\",\n            APIVersion: \"extensions/v1beta1\",\n    },\n    ObjectMeta: v1.ObjectMeta{\n        Name: \"binary-search\",\n    },\n    Spec: v1beta1.DeploymentSpec{\n        Replicas: int32p(1),\n        Template: v1.PodTemplateSpec{\n            ObjectMeta: v1.ObjectMeta{\n                Name:   appName,\n                Labels: map[string]string{\"app\": appName},\n            },\n            Spec: v1.PodSpec{\n                Containers: []v1.Container{\n                    v1.Container{\n                        Name:  \"nginx-container\",\n                        Image: \"nginx\",\n                        VolumeMounts: []v1.VolumeMount{\n                            v1.VolumeMount{\n                                MountPath: \"/usr/share/nginx/html\",\n                                Name:      \"shared-data\",\n                            },\n                        },\n                    },\n                    v1.Container{\n                        Name:  \"debian-container\",\n                        Image: \"debian\",\n                        VolumeMounts: []v1.VolumeMount{\n                            v1.VolumeMount{\n                                MountPath: \"/pod-data\",\n                                Name:      \"shared-data\",\n                            },\n                        },\n                        Command: []string{\n                            \"/bin/sh\",\n                        },\n                        Args: []string{\n                            \"-c\",\n                            \"echo Hello from the debian container &gt; /pod-data/index1.html\",\n                        },\n                    },\n                },\n                RestartPolicy: v1.RestartPolicyAlways,\n                DNSPolicy:     v1.DNSClusterFirst,\n                Volumes: []v1.Volume{\n                    v1.Volume{\n                        Name: \"shared-data\",\n                        VolumeSource: v1.VolumeSource{\n                            EmptyDir: &amp;v1.EmptyDirVolumeSource{},\n                        },\n                    },\n                },\n            },\n        },\n    },\n    }\n\n\n\n// Implement deployment update-or-create semantics.\ndeploy := c.Extensions().Deployments(namespace)\n    _, err := deploy.Update(deploySpec)\n</code></pre>\n\n<p>Any suggestion? Many thanks in advance!</p>\n"}, {"tags": ["pointers", "go", "struct", "slice"], "comments": [{"owner": {"reputation": 4236, "user_id": 2231905, "user_type": "registered", "accept_rate": 53, "profile_image": "https://www.gravatar.com/avatar/0d4a1b6ef81bd93c9dd8896880995b77?s=128&d=identicon&r=PG", "display_name": "Fallen", "link": "https://stackoverflow.com/users/2231905/fallen"}, "edited": false, "score": 0, "creation_date": 1488863953, "post_id": 42639776, "comment_id": 72408762, "body": "<a href=\"http://stackoverflow.com/questions/15945030/change-values-while-iterating-in-golang\" title=\"change values while iterating in golang\">stackoverflow.com/questions/15945030/&hellip;</a>"}], "answers": [{"comments": [{"owner": {"reputation": 11244, "user_id": 2636317, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d665de9176035b991a9c84b82a23337d?s=128&d=identicon&r=PG", "display_name": "mgoldwasser", "link": "https://stackoverflow.com/users/2636317/mgoldwasser"}, "edited": false, "score": 0, "creation_date": 1488900492, "post_id": 42639942, "comment_id": 72430199, "body": "better yet, we can do   <code>for i := range people {         people[i].addFriends(possibleFriends, 2)  }</code>"}], "tags": [], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "is_accepted": true, "score": 2, "last_activity_date": 1488865405, "last_edit_date": 1488865405, "creation_date": 1488859116, "answer_id": 42639942, "question_id": 42639776, "link": "https://stackoverflow.com/questions/42639776/modifying-a-struct-slice-within-a-struct-in-go/42639942#42639942", "title": "Modifying a struct slice within a struct in Go", "body": "<p>use</p>\n\n<pre><code>for i := 0; i &lt; numPeople; i++ {\n        people[i].addFriends(possibleFriends, 2)\n}\n</code></pre>\n\n<p>or</p>\n\n<pre><code> for i, _ := range people {\n        people[i].addFriends(possibleFriends, 2)\n }\n</code></pre>\n\n<p>instead of</p>\n\n<pre><code> for _, p := range people {\n        p.addFriends(possibleFriends, 2)\n }\n</code></pre>\n\n<p>this is because <code>p</code> is a copy of <code>people[i]</code>, <code>addFriends</code> has no effect on slice <code>people</code></p>\n"}], "owner": {"reputation": 11244, "user_id": 2636317, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/d665de9176035b991a9c84b82a23337d?s=128&d=identicon&r=PG", "display_name": "mgoldwasser", "link": "https://stackoverflow.com/users/2636317/mgoldwasser"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 53, "favorite_count": 0, "accepted_answer_id": 42639942, "answer_count": 1, "score": 0, "last_activity_date": 1488900434, "creation_date": 1488858120, "last_edit_date": 1488900434, "question_id": 42639776, "link": "https://stackoverflow.com/questions/42639776/modifying-a-struct-slice-within-a-struct-in-go", "title": "Modifying a struct slice within a struct in Go", "body": "<p>In the following example, a <code>person</code> has a slice of <code>friendship</code>s, and I try to initialize a <code>friendship</code> as a pointer to another <code>person</code> object, but for some reason it fails, and the result is that nobody has any <code>friendship</code>s. Am I not using a pointer somewhere where I should be?</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"math/rand\"\n)\n\ntype friendship struct {\n    friend *person\n}\n\ntype person struct {\n    name       int\n    friendship []friendship\n}\n\nfunc createPerson(id int) person {\n    return person{id, make([]friendship, 0)}\n}\n\nfunc (p *person) addFriends(possibleFriends []*person, numFriends int) {\n    var friend *person\n    for i := 0; i &lt; numFriends; i++ {\n        friend = possibleFriends[rand.Intn(len(possibleFriends))]\n        p.friendship = append(p.friendship, friendship{friend})\n    }\n}\n\nfunc main() {\n    numPeople := 20\n    people := make([]person, numPeople)\n    possibleFriends := make([]*person, numPeople)\n    for i := 0; i &lt; numPeople; i++ {\n        people[i] = createPerson(i)\n        possibleFriends[i] = &amp;(people[i])\n    }\n    for _, p := range people {\n        p.addFriends(possibleFriends, 2)\n    }\n    fmt.Println(people)\n}\n</code></pre>\n"}, {"tags": ["mongodb", "go", "aggregation-framework", "bson"], "answers": [{"comments": [{"owner": {"reputation": 464, "user_id": 6135914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fnNc6.jpg?s=128&g=1", "display_name": "JT.", "link": "https://stackoverflow.com/users/6135914/jt"}, "edited": false, "score": 0, "creation_date": 1488985188, "post_id": 42674543, "comment_id": 72473927, "body": "I&#39;d have to know more about the problems you are facing when handling the dynamic structure of the <code>$match</code> object."}], "tags": [], "owner": {"reputation": 464, "user_id": 6135914, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/fnNc6.jpg?s=128&g=1", "display_name": "JT.", "link": "https://stackoverflow.com/users/6135914/jt"}, "is_accepted": false, "score": 0, "last_activity_date": 1488986955, "last_edit_date": 1488986955, "creation_date": 1488984770, "answer_id": 42674543, "question_id": 42637374, "link": "https://stackoverflow.com/questions/42637374/converting-mapstringinterface-to-valid-mongo-query/42674543#42674543", "title": "Converting map[string]interface{} to valid Mongo query", "body": "<p>It seems like you need to unmarshaling to a <code>[]map[string]interface{}</code> with that array structure in the post. </p>\n\n<p>With that being said you can do something like this (with the currect <code>map[string]interface{}</code> type.</p>\n\n<pre><code>type Payload struct {\n    Message map[string]interface{} `json:\"message\"`\n}\n\n// If you are using it as a http HandleFunc\nfunc (s *Server) ProcessPayload() {\n    PayloadHandler := func(w http.ResponseWriter, r *http.Request) {\n        incoming := r.FormValue(\"message\")\n        if incoming != \"\" {\n            var payload = new(Payload)\n            json.Unmarshal([]byte(incoming), payload)\n\n            go payload.FromPayload()\n        }\n    }\n\n    http.HandleFunc(\"/payload\", PayloadHandler)\n}\n\nfunc (p *Payload) FromPayload() {\n    match, ok := p.Message[\"$match\"]\n    if !ok {\n        return\n    }\n    // Do your work on the $match object\n}\n</code></pre>\n"}], "owner": {"reputation": 406, "user_id": 1346642, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/4e6fbc9aec11b9f7d5ab2158a935c549?s=128&d=identicon&r=PG", "display_name": "M1Reeder", "link": "https://stackoverflow.com/users/1346642/m1reeder"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 263, "favorite_count": 1, "answer_count": 1, "score": 0, "last_activity_date": 1498191047, "creation_date": 1488842150, "last_edit_date": 1498191047, "question_id": 42637374, "link": "https://stackoverflow.com/questions/42637374/converting-mapstringinterface-to-valid-mongo-query", "title": "Converting map[string]interface{} to valid Mongo query", "body": "<p>I am currently receiving a mongo aggregate query from a payload:</p>\n\n<pre><code>[\n  {\n    \"$match\": {\n      \"isComplete\": true\n      \"accountId\": \"foo123\"\n      \"startTime\": \"2017-03-06T23:07:21.262Z\"\n      \"$or\": [ { userId: \"bar123\" }, { userId: \"bar235\" } ]\n    } \n  },\n  {\n    \"$group\": {\n      \"_id\": null,\n      \"count\": {\n        \"$sum\": 1\n      }\n    }\n  }\n]\n</code></pre>\n\n<p>This is being stored as a <code>map[string]interface{}</code>. The issue is the <code>$match</code> clause can be any arbitrary query, which means it can contain ObjectIds and Dates. I have tried manually converting ids to <code>bson.ObejectId</code>s and any Dates to <code>time.Times</code> but the queries can become very complicated.</p>\n\n<p>Does anyone know any good way of taking an arbitrary mongo query from a payload and converting it?</p>\n"}, {"tags": ["go", "beego"], "answers": [{"tags": [], "owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "is_accepted": true, "score": 4, "last_activity_date": 1488852842, "creation_date": 1488852842, "answer_id": 42638956, "question_id": 42637163, "link": "https://stackoverflow.com/questions/42637163/beego-models-registered-but-not-found/42638956#42638956", "title": "beego models registered but not found", "body": "<p>try this:</p>\n\n<ol>\n<li>in models.go, change <code>package main</code> to <code>package models</code></li>\n<li>in main.go,  add <code>import _ \"test_blog/models\"</code></li>\n</ol>\n"}], "owner": {"reputation": 1815, "user_id": 4155956, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0ea0d3923ae412e2e921df82b6108ed9?s=128&d=identicon&r=PG", "display_name": "samix73", "link": "https://stackoverflow.com/users/4155956/samix73"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1439, "favorite_count": 0, "accepted_answer_id": 42638956, "answer_count": 1, "score": 1, "last_activity_date": 1488852842, "creation_date": 1488841086, "last_edit_date": 1488844790, "question_id": 42637163, "link": "https://stackoverflow.com/questions/42637163/beego-models-registered-but-not-found", "title": "beego models registered but not found", "body": "<p>I'm trying to write my first beego web app and I'm trying to register some models, i register them in <code>models/model.go</code>'s <code>init()</code> function, but when I run the command <code>bee run</code>, I get the following error:\n<code>no Model found, need register your model</code></p>\n\n<p><strong>main.go</strong>:</p>\n\n<pre><code>package main\nimport (\n   \"fmt\"\n    _ \"test_blog/routers\"\n   \"time\"\n\n   _ \"github.com/lib/pq\"\n\n   \"github.com/astaxie/beego\"\n   \"github.com/astaxie/beego/orm\"\n)\n\nfunc init() {\n    orm.RegisterDriver(\"postgres\", orm.DRPostgres)\n\n    maxIdle := 30\n    maxConn := 30\n    orm.RegisterDataBase(\n        \"default\",\n        \"postgres\", \n        \"postgres://user:password@localhost/test_db\", maxIdle, maxConn\n    )\n\n    orm.DefaultTimeLoc = time.UTC\n}\n\nfunc main() {\n    // Database alias.\n    name := \"default\"\n\n    // Drop table and re-create.\n    force := false\n\n    // Print log.\n    verbose := false\n\n    // Error.\n    err := orm.RunSyncdb(name, force, verbose)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    beego.Run()\n}\n</code></pre>\n\n<p><strong>Note</strong>: <code>force</code> &amp; <code>verbose</code> both were set to <code>true</code> before running <code>bee run</code> for the first time.</p>\n\n<p><strong>models.go</strong>:</p>\n\n<pre><code>package main\n\nimport \"github.com/astaxie/beego/orm\"\n\ntype User struct {\n    Name  string\n    Posts []*Post `orm:\"reverse(many)\"`\n}\n\ntype Post struct {\n    Title   string    `orm:\"size(50)\"`\n    Text    string    `orm:\"size(4000)\"`\n    Created time.Time `orm:\"auto_now_add;type(datetime)\"`\n    Updated time.Time `orm:\"auto_now;type(datetime)\"`\n    Author  *User     `orm:\"rel(fk)\"`\n}\n\nfunc init() {\n    orm.RegisterModel(new(User), new(Post))\n}\n</code></pre>\n"}, {"tags": ["sockets", "curl", "go", "docker", "docker-swarm"], "comments": [{"owner": {"reputation": 12854, "user_id": 559504, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/87b61c83e24e695ac8528fcb1a3cbed3?s=128&d=identicon&r=PG", "display_name": "johnharris85", "link": "https://stackoverflow.com/users/559504/johnharris85"}, "edited": false, "score": 4, "creation_date": 1488842014, "post_id": 42636989, "comment_id": 72402347, "body": "Use the client API - <a href=\"https://docs.docker.com/engine/api/getting-started/#tab-run-go\" rel=\"nofollow noreferrer\">docs.docker.com/engine/api/getting-started/#tab-run-go</a>"}], "answers": [{"tags": [], "owner": {"reputation": 26372, "user_id": 5867722, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VQ1v.jpg?s=128&g=1", "display_name": "Farhad Farahi", "link": "https://stackoverflow.com/users/5867722/farhad-farahi"}, "is_accepted": true, "score": 1, "last_activity_date": 1488873925, "creation_date": 1488873925, "answer_id": 42643153, "question_id": 42636989, "link": "https://stackoverflow.com/questions/42636989/is-there-a-straight-way-to-get-html-response-from-a-unix-socket-in-go-like-curl/42643153#42643153", "title": "Is there a straight way to get html response from a unix socket in Go (like curl does)?", "body": "<p>Try this:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net\"\n    \"log\"\n    \"bufio\"\n\n)\n\nfunc main() {\n    conn, err := net.Dial(\"unix\", \"/var/run/docker.sock\")\n\n    if err != nil {\n        panic(err)\n    }\n    fmt.Fprintf(conn, \"GET /images/json HTTP/1.0\\r\\n\\r\\n\")\n    status, err := bufio.NewReader(conn).ReadString('\\t')\n    if err != nil {\n        log.Println(err)\n    }\n\n    fmt.Print(\"Message from server: \"+status)\n}\n</code></pre>\n\n<p>Another approach:</p>\n\n<p>Use <a href=\"https://docs.docker.com/engine/api/getting-started/\" rel=\"nofollow noreferrer\">docker SDK</a>, available for python, go and some other languages.</p>\n"}], "owner": {"reputation": 163, "user_id": 5070053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f2bffaa84694f09b1db989f49ee3f29a?s=128&d=identicon&r=PG", "display_name": "Olivier Dauby", "link": "https://stackoverflow.com/users/5070053/olivier-dauby"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 362, "favorite_count": 0, "accepted_answer_id": 42643153, "answer_count": 1, "score": 1, "last_activity_date": 1488873925, "creation_date": 1488840158, "question_id": 42636989, "link": "https://stackoverflow.com/questions/42636989/is-there-a-straight-way-to-get-html-response-from-a-unix-socket-in-go-like-curl", "title": "Is there a straight way to get html response from a unix socket in Go (like curl does)?", "body": "<p>I need to create a docker (1.13) container that will be running as a service in a docker swarm to schedule jobs (like a swarm-wide crontab that performs 'docker exec' where needed).\nI'm a rather sysadmin guy and not really a coder, so I started doing it with with bash, curl and jq.\nIt works, but there is definitely room for improvement.</p>\n\n<p>To give you an idea of the mumbo-jumpo I'm dealing with, here are a few snippets of the calls I pass to the docker socket to find out where the services are running:</p>\n\n<pre><code># Get local docker node ID:\ncurl -s --unix-socket /var/run/docker.sock http:/v1.26/info | jq -r '.Name + \" \" + .Swarm.NodeID'\n\n# List swarm node ID's:\ncurl -s --unix-socket /var/run/docker.sock http:/v1.26/nodes | jq -r '.[] | .Description.Hostname + \" \" + .ID'\n\n# List swarm services:\ncurl -s --unix-socket /var/run/docker.sock http:/v1.26/nodes | jq -r '.[] | .Description.Hostname + \" \" + .ID'\n\n# List running tasks:\ncurl -s --unix-socket /var/run/docker.sock http:/v1.26/tasks | jq -r '.[] | select( .Status.State | contains(\"running\")) | .NodeID + \" \" + .ServiceID + \" \" + .ID + \" \" + .Status.State'\n</code></pre>\n\n<p>I'd like to do it nicer with <strong>golang</strong>.</p>\n\n<p>I understand how http.Get works when talking to a tcp socket:</p>\n\n<pre><code>res, err := http.Get(url)\nbody, err := ioutil.ReadAll(res.Body)\nerr = json.Unmarshal(body, &amp;p)\n// p is then populated with the content of my request\n</code></pre>\n\n<p>But how can I deal with a unix filesocket (/var/run/docker.sock)? I assume I have to use <strong>net.DialUnix</strong> but could not get it to work so far.</p>\n\n<p>Any idea or suggestion are welcome.</p>\n"}, {"tags": ["go", "concurrency", "parallel-processing"], "comments": [{"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488840066, "post_id": 42636833, "comment_id": 72401533, "body": "Which magnitude/s are you interested in for measuring the work rate? Pixels processed over time maybe? Raw image data processed over time?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488840163, "post_id": 42636833, "comment_id": 72401573, "body": "If you&#39;re already calculating metrics, don&#39;t you have a method for determining rates already? What system are you using to collect metrics?"}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488840483, "post_id": 42636833, "comment_id": 72401726, "body": "Currently I am running my image manipulation through 10 times sequentially timing each run and calculating an average. I am then running my parallel version 10 times using GOMAXPROCS 1, then 10 times with it set to 2 and so on. I&#39;m calculating an average time of this each time also. I&#39;m working out Total Parallel time,the teoretical minimum, speedup and overhead time from the data I am collecting. However I&#39;m unsure on how to calculate the work rate. I have found a formula rate= work/time but now sure how to interpret this."}, {"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488840797, "post_id": 42636833, "comment_id": 72401867, "body": "Oh and I think pixels over time would be the most relevant"}], "answers": [{"comments": [{"owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "edited": false, "score": 0, "creation_date": 1488922958, "post_id": 42637857, "comment_id": 72443702, "body": "Hi Peter, thanks for the answer! Working through it all now and learning a lot. Kind Regards"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 2, "last_activity_date": 1488916585, "last_edit_date": 1488916585, "creation_date": 1488845048, "answer_id": 42637857, "question_id": 42636833, "link": "https://stackoverflow.com/questions/42636833/calculating-the-work-rate-in-parallel-computing-golang/42637857#42637857", "title": "Calculating the Work Rate in parallel computing Golang", "body": "<p>First, I would try to explain what was going on here (NumCPU=4):</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/jpeg\"\n    \"os\"\n    \"testing\"\n)\n\nfunc changeImage(img image.Image) {\n    b := img.Bounds()\n    imgSet := image.NewRGBA(b)\n    for y := 0; y &lt; b.Max.Y; y++ {\n        for x := 0; x &lt; b.Max.X; x++ {\n            oldPixel := img.At(x, y)\n            r, g, b, _ := oldPixel.RGBA()\n            lum := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\n            pixel := color.Gray{uint8(lum / 256)}\n            imgSet.Set(x, y, pixel)\n        }\n    }\n}\n\nfunc BenchmarkParallel(b *testing.B) {\n    file, err := os.Open(\"space.jpg\")\n    if err != nil {\n        b.Fatal(err)\n    }\n    defer file.Close()\n    img, err := jpeg.Decode(file)\n    if err != nil {\n        b.Fatal(err)\n    }\n\n    b.ReportAllocs()\n    b.RunParallel(func(pb *testing.PB) {\n        for pb.Next() {\n            changeImage(img)\n        }\n    })\n}\n\nfunc BenchmarkSingle(b *testing.B) {\n    file, err := os.Open(\"space.jpg\")\n    if err != nil {\n        b.Fatal(err)\n    }\n    defer file.Close()\n    img, err := jpeg.Decode(file)\n    if err != nil {\n        b.Fatal(err)\n    }\n\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        changeImage(img)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=. -cpu=1,2,4,6\ngoos: linux\ngoarch: amd64\npkg: so/space\nBenchmarkParallel        50   22901501 ns/op     2296662 B/op     571021 allocs/op\nBenchmarkParallel-2     100   11599582 ns/op     2290637 B/op     571021 allocs/op\nBenchmarkParallel-4     200   10631362 ns/op     2287631 B/op     571021 allocs/op\nBenchmarkParallel-6     200   10916331 ns/op     2287629 B/op     571021 allocs/op\nBenchmarkSingle          50   23645522 ns/op     2284582 B/op     571021 allocs/op\nBenchmarkSingle-2        50   23158899 ns/op     2284584 B/op     571021 allocs/op\nBenchmarkSingle-4        50   31069104 ns/op     2284589 B/op     571021 allocs/op\nBenchmarkSingle-6        50   28026326 ns/op     2284586 B/op     571021 allocs/op\nPASS\nok      so/space    14.047s\n</code></pre>\n\n<hr>\n\n<p>ADDENDUM:</p>\n\n<p>Next, read the relevant documentation.</p>\n\n<p><a href=\"https://blog.golang.org/go-image-package\" rel=\"nofollow noreferrer\">The Go image package</a></p>\n\n<p><a href=\"https://golang.org/pkg/image/\" rel=\"nofollow noreferrer\">Package image</a></p>\n\n<p><a href=\"https://golang.org/pkg/image/color/\" rel=\"nofollow noreferrer\">Package color</a></p>\n\n<p>Fix the bugs and make improvements for an optimized version. Compare the optimized version to the baseline that we established earlier.</p>\n\n<pre><code>package main\n\nimport (\n    \"image\"\n    \"image/color\"\n    \"image/jpeg\"\n    \"os\"\n    \"testing\"\n)\n\nfunc changeImageOpt(img image.Image) *image.RGBA {\n    b := img.Bounds()\n    imgSet := image.NewRGBA(b)\n    for y := b.Min.Y; y &lt; b.Max.Y; y++ {\n        for x := b.Min.X; x &lt; b.Max.X; x++ {\n            r, g, b, _ := img.At(x, y).RGBA()\n            lum := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\n            r, g, b, a := color.Gray{uint8(lum / 256)}.RGBA()\n            rgba := color.RGBA{R: uint8(r), G: uint8(g), B: uint8(b), A: uint8(a)}\n            imgSet.SetRGBA(x, y, rgba)\n        }\n    }\n    return imgSet\n}\n\nfunc BenchmarkSingleOpt(b *testing.B) {\n    file, err := os.Open(\"space.jpg\")\n    if err != nil {\n        b.Fatal(err)\n    }\n    defer file.Close()\n    img, err := jpeg.Decode(file)\n    if err != nil {\n        b.Fatal(err)\n    }\n\n    b.ReportAllocs()\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        changeImageOpt(img)\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go test -bench=Single -cpu=2\ngoos: linux\ngoarch: amd64\npkg: so/space\nBenchmarkSingle-2        20   84970866 ns/op     2284584 B/op     571021 allocs/op\nBenchmarkSingleOpt-2     30   48353165 ns/op     1371010 B/op     190342 allocs/op\nPASS\nok      so/space    4.648s\n</code></pre>\n\n<p>Following the instructions in the documentation, we have a significant reduction in CPU time and memory allocations.</p>\n\n<p>There are corresponding improvements for parallel benchmarks (NumCPU=4).</p>\n\n<pre><code>$ go test -bench=Parallel -cpu=1,2,3,4,6\ngoos: linux\ngoarch: amd64\npkg: so/space\nBenchmarkParallel        20   87135554 ns/op     2314774 B/op     571021 allocs/op\nBenchmarkParallel-2      30   46567417 ns/op     2304732 B/op     571021 allocs/op\nBenchmarkParallel-3      30   43262344 ns/op     2304736 B/op     571021 allocs/op\nBenchmarkParallel-4      30   42593397 ns/op     2304763 B/op     571021 allocs/op\nBenchmarkParallel-6      30   40803415 ns/op     2304804 B/op     571021 allocs/op\nBenchmarkParallelOpt     30   47932887 ns/op     1391139 B/op     190342 allocs/op\nBenchmarkParallelOpt-2   50   25216902 ns/op     1383094 B/op     190342 allocs/op\nBenchmarkParallelOpt-3   50   23723356 ns/op     1383099 B/op     190342 allocs/op\nBenchmarkParallelOpt-4   50   22400713 ns/op     1383101 B/op     190342 allocs/op\nBenchmarkParallelOpt-6   50   22250405 ns/op     1383100 B/op     190342 allocs/op\nPASS\nok      so/space    19.662s\n</code></pre>\n"}], "owner": {"reputation": 309, "user_id": 7227903, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/cf4ba9ae8e465802dc5162e9ce386aa0?s=128&d=identicon&r=PG&f=1", "display_name": "benjano", "link": "https://stackoverflow.com/users/7227903/benjano"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 138, "favorite_count": 1, "accepted_answer_id": 42637857, "answer_count": 1, "score": 1, "last_activity_date": 1488916585, "creation_date": 1488839489, "last_edit_date": 1488840607, "question_id": 42636833, "link": "https://stackoverflow.com/questions/42636833/calculating-the-work-rate-in-parallel-computing-golang", "title": "Calculating the Work Rate in parallel computing Golang", "body": "<p>I'm currently working on piece of work that runs image manipulation both sequentially and in parallel. I'm trying to work out the work rate as part of my Metrics however I can't find a formula online or much information about it,</p>\n\n<p>Does anyone have the equation required to calculate work rate?</p>\n\n<p>Edit:</p>\n\n<p>This is my main function which has the metric calculations in if this helps? I know there are probably better ways for me to obtain certain data etc, but a bit of trial and error has got me to this point.</p>\n\n<pre><code>runtime.GOMAXPROCS(4)\n\nfile, err := os.Open(\"space.jpg\")\nif err != nil {\n    log.Fatal(err)\n}\ndefer file.Close()\n\nimg, err := jpeg.Decode(file)\nif err != nil {\n    log.Fatal(os.Stderr, \"%s: %v\\n\", \"space.jpg\", err)\n}\nfor i:= 0; i&lt;10; i++{\nTSeqStart := time.Now()\nb := img.Bounds()\nimgSet := image.NewRGBA(b)\nfor y := 0; y &lt; b.Max.Y; y++ {\n    for x := 0; x &lt; b.Max.X; x++ {\n      oldPixel := img.At(x, y)\n  r, g, b, _ := oldPixel.RGBA()\n  lum := 0.299*float64(r) + 0.587*float64(g) + 0.114*float64(b)\n  pixel := color.Gray{uint8(lum / 256)}\n  imgSet.Set(x, y, pixel)\n     }\n    }\n  TSeq := time.Since(TSeqStart)\n  //ns := TSeq.Nanoseconds()\n\n  avgSeq = avgSeq +TSeq\n  fmt.Printf(\"\\nTime in ns (Sequential): \" , TSeq)\n  outFile, err := os.Create(\"changed.jpg\")\n  if err != nil {\n    log.Fatal(err)\n  }\n  defer outFile.Close()\n  jpeg.Encode(outFile, imgSet, nil)\n\n}\navgSeq = avgSeq/10\n\nfmt.Print(\"\\n\\nAverage sequential time for 10 runs: \", avgSeq)\n  //parallel version\n    file2, err := os.Open(\"space.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer file.Close()\n\n    img2, err := jpeg.Decode(file2)\n    if err != nil {\n        log.Fatal(os.Stderr, \"%s: %v\\n\", \"space.jpg\", err)\n    }\n\n    for j:=1;j&lt;=4;j++{\n      runtime.GOMAXPROCS(j)\n\n\n    for i:= 0; i&lt;10; i++{\n\n    TParStart:= time.Now()\n    imgSet2 := imgprocess(img2, runtime.NumCPU(), splitVert(1024), rgbtogrey)\n    TPar := time.Since(TParStart)\n    //ns2 :=  TPar.Nanoseconds()\n\n    avgPar = avgPar +TPar\n    fmt.Print(\"\\nTime in Nanoseconds (Parallel) with GOMAXPROCS set at \",j ,\": \" , TPar)\n\n    outFile2, err := os.Create(\"changed2.jpg\")\n    if err != nil {\n      log.Fatal(err)\n    }\n    defer outFile2.Close()\n    jpeg.Encode(outFile2, imgSet2, nil)\n\n      if err != nil {\n          log.Fatalf(\"encoding image: %v\", err)\n      }\n    }\n    avgPar = avgPar/10\n    fmt.Print(\"\\n\\nAverage time for 10 runs in parallel (GOMAXPROCS:\",j,\"): \", avgPar)\n    var j64 time.Duration\n    j64 = time.Duration(j)\n    totalPar := j64*avgPar\n    fmt.Print(\"\\n\\nTotal Parallel time: \", totalPar)\n\n      speedup := avgSeq.Seconds()/avgPar.Seconds()\n\n      fmt.Printf(\"\\n\\nSpeed up: %f\", speedup)\n\n      var jfloat float64\n      jfloat = float64(j)\n      theoreticalMin := avgSeq.Seconds()/jfloat\n      fmt.Print(\"\\n\\nTheoretical Minimum: \", theoreticalMin,\"ms\")\n\n     var tPFloat float64\n     tPFloat = float64(totalPar)\n      efficiency := avgSeq.Seconds()/tPFloat\n      fmt.Print(\"\\n\\n Efficiency: \", efficiency,\"%\")\n\n       overhead := totalPar - avgSeq\n       fmt.Print(\"\\n\\nOverhead time: \", overhead ,\"\\n\")\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488839566, "post_id": 42636702, "comment_id": 72401290, "body": "How do you pass the IP string to the program? Can you paste your main() func?"}, {"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "reply_to_user": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488842098, "post_id": 42636702, "comment_id": 72402378, "body": "The main function have only a call to the <code>createConfigFile()</code>. I&#39;m reading if from the standard input."}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 1, "last_activity_date": 1488839787, "creation_date": 1488839787, "answer_id": 42636897, "question_id": 42636702, "link": "https://stackoverflow.com/questions/42636702/golang-types-in-net-package/42636897#42636897", "title": "Golang types in net package", "body": "<p>The documentation of <code>net.ParseIP(s string)</code> states that if the string s provided is not a valid textual representation of an IP address the function will return a <code>nil</code> value, so that must be the case.</p>\n\n<p>Please log the string s before calling <code>net.ParseIP</code> so you can check if you are passing and reading it properly in the program.</p>\n"}, {"comments": [{"owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 0, "creation_date": 1488841998, "post_id": 42637020, "comment_id": 72402337, "body": "It seems to be that the TrimRight is not deleting the <code>&#47;n</code> of the string. <i>But</i> I&#39;ve tried resizing the readGateway like <code>readGateway = readGateway[0:11]</code> and it&#39;s working now, so it&#39;s a big step. Thank you very much. I&#39;m going to take a look at the docs of TrimRight to see what&#39;s happening."}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 0, "creation_date": 1488842469, "post_id": 42637020, "comment_id": 72402519, "body": "so long as your gateway isn&#39;t 192.168.1.10 and its length should instead 13! ;). Best guess is that you&#39;ve got <code>\\r\\n</code> ending the string, not <code>\\n</code> (unix-style endings, not windows) but without you having done any sort of troubleshooting it&#39;s not really worth the effort to debug that for you. Good luck!"}, {"owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "reply_to_user": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "edited": false, "score": 0, "creation_date": 1488842529, "post_id": 42637020, "comment_id": 72402546, "body": "@DavidBarranco I rolled back your edit, since it doesn&#39;t clarify the question."}], "tags": [], "owner": {"reputation": 44495, "user_id": 3058609, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/2c0357556707713572abbf637a907ef9?s=128&d=identicon&r=PG&f=1", "display_name": "Adam Smith", "link": "https://stackoverflow.com/users/3058609/adam-smith"}, "is_accepted": true, "score": 1, "last_activity_date": 1488840356, "creation_date": 1488840356, "answer_id": 42637020, "question_id": 42636702, "link": "https://stackoverflow.com/questions/42636702/golang-types-in-net-package/42637020#42637020", "title": "Golang types in net package", "body": "<p><a href=\"https://golang.org/pkg/bufio/#Reader.ReadString\" rel=\"nofollow noreferrer\"><code>bufio.Reader.ReadString</code></a>'s docs explain (emphasis mine)</p>\n\n<blockquote>\n  <p>ReadString reads until the first occurrence of delim in the input,\n  returning a string containing the data <strong>up to and including the\n  delimiter</strong></p>\n</blockquote>\n\n<p>So <code>readGateway</code> ends up looking like <code>\"192.168.1.1\\n\"</code>. Your newline delimiter would not exist in a properly formatted IP address, which means when you parse it with <code>net.ParseIP</code> it's kicking it out as <code>nil</code>.</p>\n\n<p>You can use <a href=\"https://golang.org/pkg/strings/#TrimRight\" rel=\"nofollow noreferrer\"><code>strings.TrimRight</code></a> to trim out the newline:</p>\n\n<pre><code>readGateway, err := reader.ReadString('\\n')\nif err != nil {\n    log.Fatal(err)\n}\nreadGateway = strings.TrimRight(readGateway, \"\\n\")\n</code></pre>\n"}], "owner": {"reputation": 442, "user_id": 7074136, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/RDvnf.jpg?s=128&g=1", "display_name": "David Barranco", "link": "https://stackoverflow.com/users/7074136/david-barranco"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 172, "favorite_count": 0, "accepted_answer_id": 42637020, "answer_count": 2, "score": 0, "last_activity_date": 1488842494, "creation_date": 1488838923, "last_edit_date": 1488842494, "question_id": 42636702, "link": "https://stackoverflow.com/questions/42636702/golang-types-in-net-package", "title": "Golang types in net package", "body": "<p>I'm coding in golang some tools to make my life easier and I'm not understanding at all how the types in the net package works. This is part of my code:</p>\n\n<pre><code>import (\n    \"bufio\"\n    \"fmt\"\n    \"log\"\n    \"net\"\n    \"os\"\n)\n\n\ntype configFile struct {\n    gateway, net             net.IP\n    mask, port               int\n    telnetUser, telnetPasswd string\n}\n\nvar dataConfig configFile\n\nfunc createConfigFile() {\n    reader := bufio.NewReader(os.Stdin)    \n    fmt.Println(\"Let's fill te config file for the application.\")\n    fmt.Println(\"Which is your gateway IP?\")\n    readGateway, err := reader.ReadString('\\n')\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    dataConfig.gateway = net.ParseIP(readGateway)\n\n    if dataConfig.gateway == nil {\n        log.Fatal(\"Problem here\")\n    } else {\n        fmt.Println(\"Your gateway is: \", dataConfig.gateway.String())\n    }\n\n}\n</code></pre>\n\n<p>My problem is the next:</p>\n\n<p>I want to read an IP address from the command line and storage it in the configFile object, which I will user later to create a <code>.json</code> file with all the configuration of my program.</p>\n\n<p>When I read from the command line the IP address the <code>readGateway</code> variable storages it ok, that's expected, but when I try to make\n<code>dataConfig.gateway = net.ParseIP(readGateway)</code>\nand I try to cast the string object to a <code>net.IP</code> object I'm always getting a <code>nill</code> in the <code>dataConfig.gateway</code> field, so I'm not able to work with that parameter neither convert it to a string.</p>\n\n<p>Could somebody help me?\nThanks in advance.</p>\n"}, {"tags": ["go", "cgo"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 7668515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86371542b10618cb47f6e75a4a80da69?s=128&d=identicon&r=PG&f=1", "display_name": "orls", "link": "https://stackoverflow.com/users/7668515/orls"}, "edited": false, "score": 0, "creation_date": 1488832023, "post_id": 42634888, "comment_id": 72397460, "body": "Hah, I discovered this just after posting, and was about to answer myself, but you got here first! No: adding a newline makes no difference (<code>puts</code> adds one anyway). However: <b>yes</b>: flushing stdout makes a difference: <code>C.fflush(C.stdout)</code> at the relevant point worked"}], "tags": [], "owner": {"reputation": 1025, "user_id": 1542527, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a5659eecf2e6b77399b5e0bb50b172f1?s=128&d=identicon&r=PG", "display_name": "Giuseppe Scrivano", "link": "https://stackoverflow.com/users/1542527/giuseppe-scrivano"}, "is_accepted": false, "score": 0, "last_activity_date": 1488831898, "creation_date": 1488831898, "answer_id": 42634888, "question_id": 42634640, "link": "https://stackoverflow.com/questions/42634640/using-cgo-why-does-c-output-not-survive-piping-when-golangs-does/42634888#42634888", "title": "Using cgo, why does C output not &#39;survive&#39; piping when golang&#39;s does?", "body": "<p>The C library buffering is per line, so the first line can be left in the buffer before it is properly flushed (done at exit time in C programs). You can either try to flush stdout, or try adding a trailing \\n in the first string. Does it work if you add the \\n? </p>\n"}, {"comments": [{"owner": {"reputation": 33, "user_id": 7668515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86371542b10618cb47f6e75a4a80da69?s=128&d=identicon&r=PG&f=1", "display_name": "orls", "link": "https://stackoverflow.com/users/7668515/orls"}, "edited": false, "score": 0, "creation_date": 1488832394, "post_id": 42634916, "comment_id": 72397646, "body": "Thanks -- I stumbled across the need to flush right after posting :-) . I don&#39;t fully understand <i>why</i> c is buffering in this case, compared to &#39;normal&#39; c: If I write the equivalent hello-world C program directly, using <code>puts</code>, and redirect it, I see output as expected. In that case, is my C compiler adding a flush for me or something?"}, {"owner": {"reputation": 33, "user_id": 7668515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86371542b10618cb47f6e75a4a80da69?s=128&d=identicon&r=PG&f=1", "display_name": "orls", "link": "https://stackoverflow.com/users/7668515/orls"}, "edited": false, "score": 1, "creation_date": 1488841265, "post_id": 42634916, "comment_id": 72402057, "body": "Did a bit of research; C will typically flush upon termination but cgo doesn&#39;t call C&#39;s <code>atexit</code> callbacks \u2013 issue <a href=\"https://github.com/golang/go/issues/4221\" rel=\"nofollow noreferrer\">#4221</a> suggests that was deliberate, but <a href=\"https://github.com/golang/go/issues/5948\" rel=\"nofollow noreferrer\">other</a> <a href=\"https://github.com/golang/go/issues/8808\" rel=\"nofollow noreferrer\">issues</a> leave it ambiguous. Apparently it&#39;s <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/00xWO1lmzEc\" rel=\"nofollow noreferrer\">been discussed</a> but I can&#39;t find that discussion. <code>fflush</code> it is, then!"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 33, "user_id": 7668515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86371542b10618cb47f6e75a4a80da69?s=128&d=identicon&r=PG&f=1", "display_name": "orls", "link": "https://stackoverflow.com/users/7668515/orls"}, "edited": false, "score": 0, "creation_date": 1488841514, "post_id": 42634916, "comment_id": 72402153, "body": "@orls: yeah, that makes sense. I always figure that if you need to be sure the data was written, call fflush regardless."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 2, "last_activity_date": 1488832417, "last_edit_date": 1488832417, "creation_date": 1488832024, "answer_id": 42634916, "question_id": 42634640, "link": "https://stackoverflow.com/questions/42634640/using-cgo-why-does-c-output-not-survive-piping-when-golangs-does/42634916#42634916", "title": "Using cgo, why does C output not &#39;survive&#39; piping when golang&#39;s does?", "body": "<p>This is C behavior you're seeing.</p>\n\n<p>Go does not buffer <code>stdout</code>, while in C it is usually buffered. When the C library detects <code>stdout</code> is a tty, it may use line buffering, so the additional <code>\\n</code> inserted by <code>puts</code> will cause the output to be displayed. </p>\n\n<p>You need to flush <code>stdout</code> to ensure you get all the output:</p>\n\n<pre><code>go2c := \"Printed from C.puts\"\nvar cstr *C.char = C.CString(go2c)\ndefer C.free(unsafe.Pointer(cstr))\nC.puts(cstr)\nC.fflush(C.stdout)\nfmt.Printf(\"Printed from golang fmt\\n\")\n</code></pre>\n\n<p>See also</p>\n\n<p><a href=\"https://stackoverflow.com/questions/1716296/why-does-printf-not-flush-after-the-call-unless-a-newline-is-in-the-format-strin\">Why does printf not flush after the call unless a newline is in the format string?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/3723795/is-stdout-line-buffered-unbuffered-or-indeterminate-by-default\">Is stdout line buffered, unbuffered or indeterminate by default?</a></p>\n"}], "owner": {"reputation": 33, "user_id": 7668515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/86371542b10618cb47f6e75a4a80da69?s=128&d=identicon&r=PG&f=1", "display_name": "orls", "link": "https://stackoverflow.com/users/7668515/orls"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1261, "favorite_count": 1, "accepted_answer_id": 42634916, "answer_count": 2, "score": 3, "last_activity_date": 1488837084, "creation_date": 1488830926, "last_edit_date": 1488837084, "question_id": 42634640, "link": "https://stackoverflow.com/questions/42634640/using-cgo-why-does-c-output-not-survive-piping-when-golangs-does", "title": "Using cgo, why does C output not &#39;survive&#39; piping when golang&#39;s does?", "body": "<p>I'm experimenting with cgo to use C code from golang, but in my little hello-world test, I've ran into something I can't understand or find more information about.</p>\n\n<p>I'm starting with a simple test similar to <a href=\"https://github.com/draffensperger/go-interlang/blob/master/go_to_c/c_in_comment/main.go\" rel=\"nofollow noreferrer\">examples I've found</a></p>\n\n<pre><code>    package main\n\n    import (\n        \"fmt\"\n        \"unsafe\"\n    )\n\n    /*\n    #import &lt;stdio.h&gt;\n    #import &lt;stdlib.h&gt;\n    */\n    import \"C\"\n\n    func main() {\n        go2c := \"Printed from C.puts\"\n        var cstr *C.char = C.CString(go2c)\n        defer C.free(unsafe.Pointer(cstr))\n        C.puts(cstr)\n        fmt.Printf(\"Printed from golang fmt\\n\")\n    }\n</code></pre>\n\n<p>This simple example just echoes strings to stdout from both golang (using <code>fmt.Printf</code>) and raw C (using <code>C.puts</code>) via the basic <code>cgo</code> binding.</p>\n\n<p>When I run this directly in my terminal, I see both lines:</p>\n\n<pre><code>    $ ./main\n    Printed from C.puts\n    Printed from golang fmt\n</code></pre>\n\n<p>When I run this but <em>redirect</em> output in any way \u2013 pipe to <code>less</code>, shell redirection to a file, etc \u2013 I only see golang's output:</p>\n\n<pre><code>    ./main | cat\n    Printed from golang fmt\n</code></pre>\n\n<p>What happens to the <code>C.puts</code> content when piping / redirecting?</p>\n\n<p>Secondary questions: Is this a cgo quirk, or a c standard library quirk I'm not aware of? Is this behaviour documented? How would I go about debugging this on my own (e.g. is there a good/plausible way for me to 'inspect' what FD1 really is in each block?)</p>\n\n<p>Update: If it's relevant, I'm using <code>go version go1.6.2 darwin/amd64</code>.</p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 1, "creation_date": 1488833772, "post_id": 42633651, "comment_id": 72398305, "body": "You have to create the <code>fileCount</code> map before you use it, so that doesn&#39;t seem messy to me. By the way, you can make this a little simpler by declaring <code>counts</code> as <code>map[string]*dupCount</code>. That way you wouldn&#39;t have to read the value out of the map and then put it back in at the end. You would be dealing with a pointer, so you could modify the fields directly."}, {"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "reply_to_user": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "edited": false, "score": 0, "creation_date": 1496676119, "post_id": 42633651, "comment_id": 75745531, "body": "@AndySchweig I&#39;m not sure that does make it simpler. You then have to check if the pointer is nil and explicitly create a <code>dupCount</code> in that case."}], "answers": [{"tags": [], "owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "is_accepted": false, "score": 0, "last_activity_date": 1497010669, "last_edit_date": 1497010669, "creation_date": 1496677860, "answer_id": 44372739, "question_id": 42633651, "link": "https://stackoverflow.com/questions/42633651/better-way-to-use-a-map-within-a-struct-go-programming-language-exercise-1-4/44372739#44372739", "title": "Better way to use a map within a struct? Go Programming Language Exercise 1.4", "body": "<p>I don't think it is particularly messy but I might be tempted to make some sort of <code>addDupe</code> helper function that takes a <code>dupCount</code> by value, makes whatever changes are required to add the line and returns the <code>dupCount</code> by value</p>\n\n<pre><code>func addDupe(dupes dupCount, filename string) dupCount {\n    if dupes.count == 0 {\n        dupes.fileCount = make(map[string]int)\n    }\n    dupes.fileCount[filename]++\n    dupes.count++\n    return dupes\n}\n</code></pre>\n\n<p>This is similar to the way the standard <code>append</code> function for slices works. Then <code>countLines</code> can be written as:</p>\n\n<pre><code>func countLines(r io.Reader, counts map[string]dupCount, filename string) {\n    input := bufio.NewScanner(r)\n    for input.Scan() {\n        line := input.Text()\n        counts[line] = addDupe(counts[line], filename)\n    }\n}\n</code></pre>\n\n<p>But all I have done is replace your <code>tmp</code> with a function parameter.</p>\n"}], "owner": {"reputation": 21, "user_id": 7487399, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/zOEDZ.jpg?s=128&g=1", "display_name": "Justin Marsh", "link": "https://stackoverflow.com/users/7487399/justin-marsh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 133, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1497010669, "creation_date": 1488827319, "question_id": 42633651, "link": "https://stackoverflow.com/questions/42633651/better-way-to-use-a-map-within-a-struct-go-programming-language-exercise-1-4", "title": "Better way to use a map within a struct? Go Programming Language Exercise 1.4", "body": "<p>I'm working on Exercise 1.4 from The Go Programming Language. The program reads stdin or files given as arguments and outputs lines that have duplicates.</p>\n\n<p>I have working code, I'm just wondering if there is a better way to use maps within structs?  Right now I have a new map being made in the struct when a unique line is found. But it seems clumsy, and I want to know if I should approach this another way.</p>\n\n<pre><code>type dupCount struct {\n        count int\n        fileCount map[string]int\n}\n\nfunc main() {\n        counts := make(map[string]dupCount)\n        files := os.Args[1:]\n        if len(files) == 0 {\n                countLines(os.Stdin, counts, \"stdin\")\n        } else {\n                for _, arg := range files {\n                        f, err := os.Open(arg)\n                        if err != nil {\n                                fmt.Fprintf(os.Stderr, \"dup2: %v\\n\", err)\n                                continue\n                        }\n                        countLines(f, counts, arg)\n                        f.Close()\n                }\n        }\nfunc countLines(f *os.File, counts map[string]dupCount, filename string) {\n        input := bufio.NewScanner(f)\n        for input.Scan() {\n                var tmp = counts[input.Text()]\n                if tmp.count == 0 {\n                        tmp.fileCount = make(map[string]int)\n                }\n                tmp.count++\n                tmp.fileCount[filename]++\n                counts[input.Text()] = tmp\n        }\n}\n</code></pre>\n\n<p>I am using the tmp variable in countLines to get around the inability to assign directly to values in maps <a href=\"https://github.com/golang/go/issues/3117\" rel=\"noreferrer\">as outlined in the Go Github repo</a>.</p>\n"}, {"tags": ["go", "swagger"], "answers": [{"tags": [], "owner": {"reputation": 1159, "user_id": 23418, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1e39a948a58f4569c53d971c2e120920?s=128&d=identicon&r=PG", "display_name": "Casual Jim", "link": "https://stackoverflow.com/users/23418/casual-jim"}, "is_accepted": false, "score": 0, "last_activity_date": 1490847603, "creation_date": 1490847603, "answer_id": 43108506, "question_id": 42632267, "link": "https://stackoverflow.com/questions/42632267/example-code-for-a-working-post-in-swagger-go/43108506#43108506", "title": "Example code for a working POST in swagger go", "body": "<p>if you move the consumes and produces up to the top level it will start to work</p>\n\n<p>The other way to make it work it to set up the json consumer. This is a bug in go-swagger.</p>\n\n<p>You can watch this issue: <a href=\"https://github.com/go-swagger/go-swagger/issues/987\" rel=\"nofollow noreferrer\">https://github.com/go-swagger/go-swagger/issues/987</a> for a proper resolution</p>\n"}], "owner": {"reputation": 2372, "user_id": 5039582, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2753151bbe8511e6705d432533cef910?s=128&d=identicon&r=PG&f=1", "display_name": "Mandragor", "link": "https://stackoverflow.com/users/5039582/mandragor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1239, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1490847603, "creation_date": 1488822436, "last_edit_date": 1488966202, "question_id": 42632267, "link": "https://stackoverflow.com/questions/42632267/example-code-for-a-working-post-in-swagger-go", "title": "Example code for a working POST in swagger go", "body": "<p>What am I doing wrong in this approach?</p>\n\n<p>I try to reimplent an old API, however the go implementation. Basically i try to POST a list of strings to the server. but all i get is an error 500 from the server, whenn i try:</p>\n\n<pre><code>go run gen/cmd/greeter-server/main.go --port=3000  &amp;\necho '[\"a\",\"b\"]' |  http -v post  :34307/api/greeting/2.0/revisit\n</code></pre>\n\n<p>RESULT</p>\n\n<pre><code>HTTP/1.1 500 Internal Server Error\nContent-Length: 68\nContent-Type: application/json\nDate: Mon, 06 Mar 2017 17:41:16 GMT\n\n{\n    \"code\": 500,\n    \"message\": \"no consumer registered for application/json\"\n}\n</code></pre>\n\n<p>This is the code i try to implement.</p>\n\n<pre><code>  api.TrackingRevisitHandler = operations.TrackingRevisitHandlerFunc(\n                func(params operations.TrackingRevisitParams) middleware.Responder {\n\n                        list := params.IdList\n                        log.Printf(\"%v\\n\",list)\n                        return operations.NewTrackingRevisitOK().WithPayload(\"RESULT\")\n        })\n</code></pre>\n\n<p>I use </p>\n\n<pre><code>swagger generate server -A greeter -t gen -f ./swagger/swagger.yml\n</code></pre>\n\n<p>to generate the server from this yaml:</p>\n\n<pre><code>---\nswagger: '2.0'\ninfo:\n  version: 1.0.0\n  title: Greeting Server\n\nbasePath: \"/api/greeting/2.0\"\n\npaths:\n  /revisit:\n    post:\n      produces:\n      - application/json\n      consumes:\n      - application/json\n      parameters:\n        - name: site\n          required: true\n          type: string\n          in: query\n          description: site name\n\n        - name: userlist\n          in: body\n          description: list of users\n          required: true\n          schema:\n            \"$ref\": \"#/definitions/Userlist\"\n\n\n      operationId: trackingRevisit\n\n      responses:\n        200:\n          description:  return list of users which need revisit\n          schema:\n            type: string\n</code></pre>\n"}, {"tags": ["go", "display", "presentation"], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 1, "last_activity_date": 1488826367, "creation_date": 1488826367, "answer_id": 42633344, "question_id": 42631255, "link": "https://stackoverflow.com/questions/42631255/present-content-like-power-point-or-impress/42633344#42633344", "title": "Present content like power point or impress", "body": "<p>Have a look at the present tool, it does a similar thing using flat files and might even be useful for you.</p>\n\n<p><a href=\"https://godoc.org/golang.org/x/tools/present\" rel=\"nofollow noreferrer\">https://godoc.org/golang.org/x/tools/present</a></p>\n"}], "owner": {"reputation": 828, "user_id": 662017, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0b1bad601ac2781fc1a5dd2160121a44?s=128&d=identicon&r=PG", "display_name": "Alwin Doss", "link": "https://stackoverflow.com/users/662017/alwin-doss"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 35, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488826367, "creation_date": 1488819368, "last_edit_date": 1488820069, "question_id": 42631255, "link": "https://stackoverflow.com/questions/42631255/present-content-like-power-point-or-impress", "title": "Present content like power point or impress", "body": "<p>I want to build an application that displays the content that user types on the command prompt to the display like a presentation.\nI am writing this application in golang. If there are existing libraries that I can use to do this great and if not would need direction how to approach solving this.\nI did search on the internet for pointers but found none.</p>\n"}, {"tags": ["c++", "go", "endianness", "ruby-c-extension"], "comments": [{"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816174, "post_id": 42630141, "comment_id": 72388209, "body": "Is <code>e.offsets</code> a file or buffer?"}, {"owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816424, "post_id": 42630141, "comment_id": 72388373, "body": "@kennytm, I&#39;m not go expert but it looks like from the docs it is: <code>binary.Write(destination, endian, data_to_write)</code>"}, {"owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "edited": false, "score": 0, "creation_date": 1488816476, "post_id": 42630141, "comment_id": 72388410, "body": "@ArafatK, is the endian aspect something you care about?"}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816503, "post_id": 42630141, "comment_id": 72388423, "body": "@kennytm I have edited the question."}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "edited": false, "score": 0, "creation_date": 1488816506, "post_id": 42630141, "comment_id": 72388426, "body": "@EvanTeran I have read the documentation, I am looking for C++ equivalent."}, {"owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "edited": false, "score": 0, "creation_date": 1488816552, "post_id": 42630141, "comment_id": 72388452, "body": "that doesn&#39;t answer my question. Do <b>you</b> care about ensuring a specific endian?"}, {"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "reply_to_user": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "edited": false, "score": 0, "creation_date": 1488816575, "post_id": 42630141, "comment_id": 72388478, "body": "@EvanTeran OP&#39;s code clearly said &quot;nativeEndian&quot;."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1488816615, "post_id": 42630141, "comment_id": 72388507, "body": "I doubt there is a direct equivalent, since IIRC <code>binary.Write</code> uses reflection which isn&#39;t available in C++."}, {"owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816657, "post_id": 42630141, "comment_id": 72388530, "body": "@kennytm, right, but that may be incidental, or may be a requirement for correctness. I am trying to find out which it is."}, {"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816697, "post_id": 42630141, "comment_id": 72388561, "body": "@ArafatK OK. What is the type of the corresponding <code>e.offset</code> in C++? <code>std::stringstream</code> or <code>std::vector&lt;uint8_t&gt;</code> or something else?"}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816929, "post_id": 42630141, "comment_id": 72388708, "body": "@kennytm Basically STRINGs are encoded as an array of 8-byte offsets so offset is number I am not sure of the exact type.(Sorry!!)"}, {"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488816996, "post_id": 42630141, "comment_id": 72388732, "body": "@ArafatK I don&#39;t get it. Perhaps you should post what you have currently translated on the C++ side."}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817053, "post_id": 42630141, "comment_id": 72388774, "body": "@kennytm The code is golang is open source. This is the link  <a href=\"https://github.com/tensorflow/tensorflow/blob/master/tensorflow/go/tensor.go#L381\" rel=\"nofollow noreferrer\">github.com/tensorflow/tensorflow/blob/master/tensorflow/go/&hellip;</a>"}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817140, "post_id": 42630141, "comment_id": 72388859, "body": "@kennytm This is the link to my code. <a href=\"https://github.com/Arafatk/tensorflow.rb/blob/master/ext/sciruby/tensorflow_c/files/tf_tensor_helper.cc#L261\" rel=\"nofollow noreferrer\">github.com/Arafatk/tensorflow.rb/blob/master/ext/sciruby/&hellip;</a>"}, {"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817145, "post_id": 42630141, "comment_id": 72388864, "body": "@ArafatK Yes but we want to know what you have done in the C++ part. BTW why are you translating TensorFlow to C++? <a href=\"https://www.tensorflow.org/api_docs/cc/\" rel=\"nofollow noreferrer\">It already has a C++ interface</a>."}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817220, "post_id": 42630141, "comment_id": 72388919, "body": "@kennytm Its for tensorflow ruby. I didn&#39;t want to create a whole story so I just asked about this subpart."}, {"owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817297, "post_id": 42630141, "comment_id": 72388983, "body": "@kennytm Also that function crashes and because I have probably done something wrong and I am sure it has something to do with the question I have asked."}], "answers": [{"comments": [{"owner": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 0, "creation_date": 1488817557, "post_id": 42630389, "comment_id": 72389157, "body": "Please check OP&#39;s comments on the question. Welp, I don&#39;t know, the question&#39;s scope seems very non-C++."}, {"owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "reply_to_user": {"reputation": 466742, "user_id": 224671, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/c90de868a7e95d75bdfd6a906dfedac7?s=128&d=identicon&r=PG", "display_name": "kennytm", "link": "https://stackoverflow.com/users/224671/kennytm"}, "edited": false, "score": 1, "creation_date": 1488817914, "post_id": 42630389, "comment_id": 72389396, "body": "@kennytm, I agree, the quesiton is very vague. It <b>seems</b> (not being a Go expert) that <code>binary.Write</code> does something like writing the fields of a &quot;structure&quot; to a stream as a basic binary serialization format.   I do think that my answer (given the lack of better context) is as close as we can get for now."}], "tags": [], "owner": {"reputation": 80284, "user_id": 13430, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/QUCnD.png?s=128&g=1", "display_name": "Evan Teran", "link": "https://stackoverflow.com/users/13430/evan-teran"}, "is_accepted": false, "score": 1, "last_activity_date": 1488816846, "creation_date": 1488816846, "answer_id": 42630389, "question_id": 42630141, "link": "https://stackoverflow.com/questions/42630141/what-is-the-c-equivalent-of-binary-write-in-golang/42630389#42630389", "title": "What is the C++ equivalent of binary.write in Golang?", "body": "<p>In C++ standard libs, it is generally up to you to deal with endian concerns. So let's skip that for the time being. If you just want to write binary data to a stream such as a file, you can do something like this:</p>\n\n<pre><code>uint64_t value = 0xfeedfacedeadbeef;\nstd::ofstream file(\"output.bin\", ios::binary);\nfile.write(reinterpret_cast&lt;char*&gt;(&amp;value), sizeof(value));\n</code></pre>\n\n<p>The cast is necessary because the file stream deals with <code>char*</code>, but you can write whatever byte streams to it you like.</p>\n\n<p>You can write entire structures this way as well so long as they are \"Plain Old Data\" (POD). For example:</p>\n\n<pre><code>struct T {\n    uint32_t a;\n    uint16_t b;\n};\n\nT value2 = { 123, 45 };\nstd::ofstream file(\"output.bin\", ios::binary);\nfile.write(reinterpret_cast&lt;char*&gt;(&amp;value2), sizeof(value2));\n</code></pre>\n\n<p>Reading these things back is similar using <code>file.read</code>, but as mentioned, if you REALLY do care about endian, then you need to take care of that yourself.</p>\n\n<p>If you are dealing with non-POD types (such as <code>std::string</code>), then you will need to deal with a more involved data serialization system. There are numerous options to deal with this if needed.</p>\n"}], "owner": {"reputation": 700, "user_id": 5668464, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/caaa9a33119f603eebf2ace9844c61c2?s=128&d=identicon&r=PG&f=1", "display_name": "ArafatK", "link": "https://stackoverflow.com/users/5668464/arafatk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 270, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1488825039, "creation_date": 1488816080, "last_edit_date": 1488825039, "question_id": 42630141, "link": "https://stackoverflow.com/questions/42630141/what-is-the-c-equivalent-of-binary-write-in-golang", "title": "What is the C++ equivalent of binary.write in Golang?", "body": "<p>I am working on project in C++ that adopts many ideas from a golang project.<br>\n I don't properly understand how this binary.write works from the <a href=\"https://golang.org/pkg/encoding/binary/#Write\" rel=\"nofollow noreferrer\">documentation</a> and how I can replicate it in C++. I am stuck at this line in my project.</p>\n\n<pre><code>binary.Write(e.offsets, nativeEndian, e.offset)\n</code></pre>\n\n<p>The type of e.offsets is <code>*bytes.Buffer</code> and e.offset is <code>uint64</code></p>\n"}, {"tags": ["arrays", "go"], "comments": [{"owner": {"reputation": 15349, "user_id": 2282538, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/0a4fff09f1f0e3360daeabb30c2c06bb?s=128&d=identicon&r=PG", "display_name": "Tyler", "link": "https://stackoverflow.com/users/2282538/tyler"}, "edited": false, "score": 3, "creation_date": 1488814770, "post_id": 42629541, "comment_id": 72387200, "body": "What are you expecting the output to be?"}], "answers": [{"tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 4, "last_activity_date": 1488817645, "last_edit_date": 1488817645, "creation_date": 1488815499, "answer_id": 42629936, "question_id": 42629541, "link": "https://stackoverflow.com/questions/42629541/go-lang-sort-a-2d-array/42629936#42629936", "title": "Go lang sort a 2D Array", "body": "<p>You have to define how to sort this type yourself. You can either create the necessary methods to use the <code>sort.Sort</code> interface, using a pointer as necessary to mutate the array values: <a href=\"https://play.golang.org/p/thdf-k2k3o\" rel=\"nofollow noreferrer\">https://play.golang.org/p/thdf-k2k3o</a></p>\n\n<pre><code>type Matrix [3][3]int\n\nfunc (m Matrix) Len() int { return len(m) }\nfunc (m Matrix) Less(i, j int) bool {\n    for x := range m[i] {\n        if m[i][x] == m[j][x] {\n            continue\n        }\n        return m[i][x] &lt; m[j][x]\n    }\n    return false\n}\n\nfunc (m *Matrix) Swap(i, j int) { m[i], m[j] = m[j], m[i] }\nfunc main() {\n    m := Matrix(matrix)\n    sort.Sort(&amp;m)\n}\n</code></pre>\n\n<p>Or use the <code>sort.Slice</code> function, converting <code>matrix</code> to a slice and providing an appropriate less function: <a href=\"https://play.golang.org/p/4hrghm9gib\" rel=\"nofollow noreferrer\">https://play.golang.org/p/4hrghm9gib</a></p>\n\n<pre><code>sort.Slice(matrix[:], func(i, j int) bool {\n    for x := range matrix[i] {\n        if matrix[i][x] == matrix[j][x] {\n            continue\n        }\n        return matrix[i][x] &lt; matrix[j][x]\n    }\n    return false\n})\n\nfmt.Println(matrix)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 151, "user_id": 7522482, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4162a2e5bcba0ff6a7558a6a54abc252?s=128&d=identicon&r=PG&f=1", "display_name": "mourya venkat", "link": "https://stackoverflow.com/users/7522482/mourya-venkat"}, "is_accepted": false, "score": 2, "last_activity_date": 1579894515, "last_edit_date": 1579894515, "creation_date": 1579872350, "answer_id": 59897376, "question_id": 42629541, "link": "https://stackoverflow.com/questions/42629541/go-lang-sort-a-2d-array/59897376#59897376", "title": "Go lang sort a 2D Array", "body": "<p><strong>Consider You have a m*n matrix and you want to sort based on kth column</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>sort.SliceStable(rangearray, func(i, j int) bool {\n        return rangearray[i][k] &lt; rangearray[j][k]\n})\n</code></pre>\n\n<p><strong>In the same way you want to sort the m*n matrix and you want to sort based on kth row</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>sort.SliceStable(rangearray, func(i, j int) bool {\n        return rangearray[k][i] &lt; rangearray[k][j]\n})\n</code></pre>\n"}], "owner": {"reputation": 452, "user_id": 3189114, "user_type": "registered", "accept_rate": 33, "profile_image": "https://graph.facebook.com/100000769112478/picture?type=large", "display_name": "Shinchan", "link": "https://stackoverflow.com/users/3189114/shinchan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3775, "favorite_count": 1, "accepted_answer_id": 42629936, "answer_count": 2, "score": 1, "last_activity_date": 1579894515, "creation_date": 1488814374, "question_id": 42629541, "link": "https://stackoverflow.com/questions/42629541/go-lang-sort-a-2d-array", "title": "Go lang sort a 2D Array", "body": "<p>I want to sort a two dimensional array in Go. Can anyone please suggest how I can go about this?</p>\n\n<p>For example If I have,</p>\n\n<pre><code>var matrix [3][3]int{\n  {2,3,1},\n  {6,3,5},\n  {1,4,9}\n}\n</code></pre>\n\n<p>Then is there something like,</p>\n\n<pre><code>sort.Sort(matrix)\n</code></pre>\n"}, {"tags": ["http", "go", "browser", "protocols", "session-cookies"], "answers": [{"tags": [], "owner": {"reputation": 793711, "user_id": 19068, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1d2d3229ed1961d2bd81853242493247?s=128&d=identicon&r=PG", "display_name": "Quentin", "link": "https://stackoverflow.com/users/19068/quentin"}, "is_accepted": true, "score": 2, "last_activity_date": 1488810715, "creation_date": 1488810715, "answer_id": 42628211, "question_id": 42628118, "link": "https://stackoverflow.com/questions/42628118/what-happened-when-you-dont-write-back-http-cookie-to-client/42628211#42628211", "title": "What happened when you don&#39;t write back HTTP cookie to client?", "body": "<blockquote>\n  <p>What happened when you don't write back cookie? </p>\n</blockquote>\n\n<p>Then the cookie doesn't change. The name stays the same. The value stays the same. The rules for when it expires stay the same.</p>\n\n<blockquote>\n  <p>would the previously sent cookie from the server deleted on the browser if you don't write back a cookie?</p>\n</blockquote>\n\n<p>No.</p>\n"}], "owner": {"reputation": 20389, "user_id": 1620210, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/8f130b2fa9903fca10a10b31ed3f7b94?s=128&d=identicon&r=PG", "display_name": "Kokizzu", "link": "https://stackoverflow.com/users/1620210/kokizzu"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "accepted_answer_id": 42628211, "answer_count": 1, "score": -2, "last_activity_date": 1488810955, "creation_date": 1488810460, "last_edit_date": 1488810955, "question_id": 42628118, "link": "https://stackoverflow.com/questions/42628118/what-happened-when-you-dont-write-back-http-cookie-to-client", "title": "What happened when you don&#39;t write back HTTP cookie to client?", "body": "<p>What happened when you don't write back cookie?\nI'm using <a href=\"https://github.com/valyala/fasthttp\" rel=\"nofollow noreferrer\">fasthttp</a>, would the previously sent cookie from the server deleted on the browser if you don't write back a cookie?</p>\n"}, {"tags": ["go", "rabbitmq"], "answers": [{"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1488816607, "post_id": 42629543, "comment_id": 72388500, "body": "so like insert it into the for loop above with break ?"}, {"owner": {"reputation": 3055, "user_id": 3528562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356446110eb2675dfd9190c0e8e69ace?s=128&d=identicon&r=PG&f=1", "display_name": "Zoyd", "link": "https://stackoverflow.com/users/3528562/zoyd"}, "reply_to_user": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 1, "creation_date": 1488817016, "post_id": 42629543, "comment_id": 72388741, "body": "Yes, and also reset the timer every time you read from the channel."}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1488821403, "post_id": 42629543, "comment_id": 72391660, "body": "I&#39;ve used go timeout pattern with case &lt;-timeout: os.Exit(1) but it doesnt exit in the that rabbitmq loop"}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1488893774, "post_id": 42629543, "comment_id": 72425493, "body": "This is really interesting. I tried and looks like it does not timeout in that for &#39;msg := range msgs {}&#39;  loop. It does if setup outside rabbitmq  loop"}, {"owner": {"reputation": 3055, "user_id": 3528562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356446110eb2675dfd9190c0e8e69ace?s=128&d=identicon&r=PG&f=1", "display_name": "Zoyd", "link": "https://stackoverflow.com/users/3528562/zoyd"}, "reply_to_user": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 1, "creation_date": 1488895676, "post_id": 42629543, "comment_id": 72426814, "body": "A for\u2026 range loop on a channel is like a for\u2026 select on only one channel; in this case, the RabbitMQ channel. To timeout in this fashion, you need a select on two channels, the RabbitMQ channel and the timeout channel."}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 0, "creation_date": 1488986045, "post_id": 42629543, "comment_id": 72474552, "body": "It works like a charm , great , really appreciate ! I can see some more examples here <a href=\"https://mmcgrana.github.io/2012/09/go-by-example-timers-and-tickers.html\" rel=\"nofollow noreferrer\">mmcgrana.github.io/2012/09/&hellip;</a>"}], "tags": [], "owner": {"reputation": 3055, "user_id": 3528562, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/356446110eb2675dfd9190c0e8e69ace?s=128&d=identicon&r=PG&f=1", "display_name": "Zoyd", "link": "https://stackoverflow.com/users/3528562/zoyd"}, "is_accepted": true, "score": 2, "last_activity_date": 1506535472, "last_edit_date": 1506535472, "creation_date": 1488814378, "answer_id": 42629543, "question_id": 42626817, "link": "https://stackoverflow.com/questions/42626817/how-to-timeout-rabbitmq-consumer/42629543#42629543", "title": "How to timeout rabbitmq consumer ?", "body": "<p>You can use <a href=\"https://blog.golang.org/go-concurrency-patterns-timing-out-and\" rel=\"nofollow noreferrer\">the standard Go pattern for timing out</a>.</p>\n\n<p>Here is a working example.</p>\n\n<pre><code>const duration = 3 * time.Second\ntimer := time.NewTimer(duration)\nfor {\n    select {\n    case d := &lt;-msgs:\n        timer.Reset(duration)\n        fmt.Printf(\"Received a message: %s\\n\", d.Body)\n    case &lt;- timer.C:\n        fmt.Println(\"Timeout !\")\n        os.Exit(1)\n    }\n}\n</code></pre>\n\n<p>It probably needs some polishing, e.g. I suppose it would be better to stop the timer when you receive the message and enable it again when you are done processing it, but this should get you started.</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2373, "favorite_count": 0, "accepted_answer_id": 42629543, "answer_count": 1, "score": 0, "last_activity_date": 1506535472, "creation_date": 1488806634, "question_id": 42626817, "link": "https://stackoverflow.com/questions/42626817/how-to-timeout-rabbitmq-consumer", "title": "How to timeout rabbitmq consumer ?", "body": "<p>I have rabbitmq consuming the queue but once client is subscribed it stays consuming queue forever. Is there a timeout to declare and exit i.e. after queue is empty ?</p>\n\n<pre><code> msgs, err := ch.Consume(\n                q.Name, // queue\n                \"\",     // consumer\n                true,   // auto-ack\n                false,  // exclusive\n                false,  // no-local\n                false,  // no-wait\n                nil,    // args\n        )\nfor msg := range msgs { \n                log.Printf(\"Received message with message: %s\", msg.Body)\n}\n</code></pre>\n"}, {"tags": ["html", "templates", "go", "go-templates"], "answers": [{"comments": [{"owner": {"reputation": 357, "user_id": 7666366, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-XPr9g6wcSFc/AAAAAAAAAAI/AAAAAAAAAFg/7LmXqEwiI7M/photo.jpg?sz=128", "display_name": "Matias gra&#241;a", "link": "https://stackoverflow.com/users/7666366/matias-gra%c3%b1a"}, "edited": false, "score": 0, "creation_date": 1488815694, "post_id": 42626458, "comment_id": 72387866, "body": "Thanks for answer. I didnt put the dot pipeline to pass the Data"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1488815984, "last_edit_date": 1495540433, "creation_date": 1488805653, "answer_id": 42626458, "question_id": 42625988, "link": "https://stackoverflow.com/questions/42625988/cant-access-data-from-html-template-golang/42626458#42626458", "title": "Can&#39;t access data from html/template Golang", "body": "<p>First, you should check errors returned by the <a href=\"https://golang.org/pkg/html/template/#Template.ParseFiles\" rel=\"nofollow noreferrer\"><code>Template.ParseFiles()</code></a> method. You store the returned error, but you only check it at the end (and by then it is overwritten like 3 times).</p>\n\n<p>Next, never parse templates in the request handler, it's too time consuming and resource wasting. Do it once at startup (or on first demand). For details see <a href=\"https://stackoverflow.com/questions/28451675/it-takes-too-much-time-when-using-template-package-to-generate-a-dynamic-web-p/28453523#28453523\">It takes too much time when using &quot;template&quot; package to generate a dynamic web page to client in golang</a>.</p>\n\n<p>Next, you can parse multiple files at once, just enumerate all when passing to the <a href=\"https://golang.org/pkg/html/template/#Template.ParseFiles\" rel=\"nofollow noreferrer\"><code>Template.ParseFiles()</code></a> <em>function</em> (there is a method and a function).</p>\n\n<p>Know that <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a> only executes a single (named) template. You have 3 <em>associated</em> templates, but only the <code>\"base.html\"</code> template is executed by your code. To execute a specific, <em>named</em> template, use <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\"><code>Template.ExecuteTemplate()</code></a>. For details, see <a href=\"https://stackoverflow.com/questions/42605373/telling-golang-which-template-to-execute-first/42606082#42606082\">Telling Golang which template to execute first</a>.</p>\n\n<p>First you should define a <em>structure</em> of your templates, decide which templates include others, and execute the \"wrapper\" template (using <code>Template.ExecuteTemplate()</code>). When you execute a template that invokes / includes another template, you have the possibility to tell what value (data) you what to pass to its execution. When you write <code>{{template \"something\" .}}</code>, that means you want to pass the value currently pointed by dot to the execution of the template named <code>\"something\"</code>. Read more about this: <a href=\"https://stackoverflow.com/questions/42507958/golang-template-engine-pipelines/42508255#42508255\">golang template engine pipelines</a>.</p>\n\n<p>To learn more about template association and internals, read this answer: <a href=\"https://stackoverflow.com/questions/41176355/go-template-name/41187671#41187671\">Go template name</a>.</p>\n\n<p>So in your case I would imagine that <code>\"base.html\"</code> is the wrapper, outer template, which includes <code>\"menu.html\"</code> and <code>\"users.html\"</code>. So <code>\"base.html\"</code> should contain lines similar to this:</p>\n\n<pre><code>{{template \"menu.html\" .}}\n\n{{template \"users.html\" .}}\n</code></pre>\n\n<p>The above lines will invoke and include the results of the mentioned templates, passing the data to their execution that was passed to <code>\"base.html\"</code> (if dot was not changed).</p>\n\n<p>Parse the files using the <a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\"><code>template.ParseFiles()</code></a> <em>function</em> (not method) like this:</p>\n\n<pre><code>var t *template.Template\n\nfunc init() {\n    var err error\n    t, err = template.ParseFiles(\n        \"public/base.html\", \"public/menu.html\", \"public/users.html\")\n    if err != nil {\n        panic(err) // handle error\n    }\n}\n</code></pre>\n\n<p>And execute it like this in your handler:</p>\n\n<pre><code>err := t.ExecuteTemplate(w, \"base.html\", context)\n</code></pre>\n"}], "owner": {"reputation": 357, "user_id": 7666366, "user_type": "registered", "accept_rate": 57, "profile_image": "https://lh6.googleusercontent.com/-XPr9g6wcSFc/AAAAAAAAAAI/AAAAAAAAAFg/7LmXqEwiI7M/photo.jpg?sz=128", "display_name": "Matias gra&#241;a", "link": "https://stackoverflow.com/users/7666366/matias-gra%c3%b1a"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1093, "favorite_count": 0, "accepted_answer_id": 42626458, "answer_count": 1, "score": 2, "last_activity_date": 1488815984, "creation_date": 1488804203, "last_edit_date": 1488806696, "question_id": 42625988, "link": "https://stackoverflow.com/questions/42625988/cant-access-data-from-html-template-golang", "title": "Can&#39;t access data from html/template Golang", "body": "<p>I have three concatenated templates. <code>base.html</code>, <code>menu.html</code>, <code>users.html</code>. But when I execute these templates I can access data of context only from <code>base.html</code>.</p>\n\n<p>Here is my Handler:</p>\n\n<pre><code>func HandlerUser(res http.ResponseWriter, req *http.Request){\nif req.Method == \"GET\" {\n    context := Context{Title: \"Users\"}\n    users,err:= GetUser(0)\n    context.Data=map[string]interface{}{\n        \"users\": users,\n    }\n    fmt.Println(context.Data)\n    t,err := template.ParseFiles(\"public/base.html\")\n    t,err = t.ParseFiles(\"public/menu.html\")\n    t,err = t.ParseFiles(\"public/users.html\")\n    err = t.Execute(res,context)\n    fmt.Println(err)\n }\n}\n</code></pre>\n\n<p>This is what I want to show in users template</p>\n\n<pre><code>{{ range $user := index .Data \"users\" }}\n&lt;tr id=\"user-{{ .Id }}\"&gt;\n    &lt;td id=\"cellId\" &gt;{{ $user.Id }}&lt;/td&gt;\n    &lt;td id=\"cellUserName\" &gt;{{ $user.UserName }}&lt;/td&gt;\n&lt;/tr&gt;\n{{ end }}\n</code></pre>\n\n<p>Note: I can access <code>\"{{.Title}}\"</code> that is used in <code>base.html</code> template.</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 69, "user_id": 7266193, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-JbFmUJ4S6To/AAAAAAAAAAI/AAAAAAAAAFQ/agbpHHq_FSE/photo.jpg?sz=128", "display_name": "Stephan", "link": "https://stackoverflow.com/users/7266193/stephan"}, "is_accepted": false, "score": 2, "last_activity_date": 1488807062, "creation_date": 1488807062, "answer_id": 42626940, "question_id": 42625210, "link": "https://stackoverflow.com/questions/42625210/how-can-i-parse-text-and-format-it-to-send-it-as-json-data/42626940#42626940", "title": "How can I parse text and format it to send it as json data", "body": "<p>In general I would recommend using a regex to do this type of parsing. Create a regex to identify your keys and then patch your data structure as needed.</p>\n\n<pre><code>nameValueParseRegex := regexp.MustCompile(`^(.*) = (.*)$?\\z`)\n\nlines := []string{\n    `Name = Red Nose`,\n    `SpawnWindowBegins = Mon, 06:45 EST - Mon, 15:15 EST`,\n    `Wrong format line`,\n    `TimeTilWindow = Spawnable || in X hours`,\n}\n\nboss := Boss{}\nfor _, value := range lines {\n    lineResult := nameValueParseRegex.FindAllStringSubmatch(value, -1)\n\n    if lineResult != nil &amp;&amp; len(lineResult) &gt; 0 {\n\n        if lineResult[0][1] == \"Name\" {\n            boss.Name = lineResult[0][2]\n        }\n\n        if lineResult[0][1] == \"SpawnWindowBegins\" {\n            boss.SpawnWindowBegins = lineResult[0][2]\n        }\n\n        if lineResult[0][1] == \"TimeTilWindow\" {\n            boss.TimeTilWindow = lineResult[0][2]\n        }\n\n    }\n\n}\n\ns, _ := json.Marshal(boss)\nfmt.Printf(\"%s\", s)\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{\"name\":\"Red Nose\",\"spawnWindowBegins\":\"Mon, 06:45 EST - Mon, 15:15 EST\",\"timeTilWindow\":\"Spawnable || in X hours\"}\n</code></pre>\n"}], "owner": {"reputation": 12897, "user_id": 2128168, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/tOuCx.png?s=128&g=1", "display_name": "Datsik", "link": "https://stackoverflow.com/users/2128168/datsik"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 56, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488807062, "creation_date": 1488801903, "question_id": 42625210, "link": "https://stackoverflow.com/questions/42625210/how-can-i-parse-text-and-format-it-to-send-it-as-json-data", "title": "How can I parse text and format it to send it as json data", "body": "<p>I'm creating a Discord bot that listens on a channel in a very popular video games server, they have a bot in there that is manually commanded by majority commands to announce certain things like boss spawns. Here is an example of the text:</p>\n\n<pre><code># Red Nose\nMon, 06:45 EST - Mon, 15:15 EST &lt;Spawnable&gt;\n\n# Kutum\nMon, 09:25 EST - Mon, 17:55 EST [Window begins](in 2 hours)\n\n# Karanda\nMon, 09:50 EST - Mon, 14:20 EST [Window begins](in 3 hours)\n\n# Dastard Bheg\nMon, 11:15 EST - Mon, 19:45 EST [Window begins](in 4 hours)\n\n# Nouver\nMon, 12:30 EST - Mon, 18:00 EST [Window begins](in 6 hours)\n\n# Kzarka\nMon, 14:10 EST - Mon, 18:40 EST [Window begins](in 7 hours)\n\n# Dim Tree Spirit\nMon, 15:50 EST - Tue, 00:20 EST [Window begins](in 9 hours)\n\n# Giant Mudster\nMon, 16:55 EST - Tue, 01:25 EST [Window begins](in 10 hours)\n</code></pre>\n\n<p>I have my bot connected to the server and reading chat messages just fine, but I'm wondering what the cleanest way to parse this data would be. I'm going to have the data formatted like so:</p>\n\n<pre><code>type Boss struct {\n    Name              string `json:\"name\"`\n    SpawnWindowBegins string `json:\"spawnWindowBegins\"`\n    TimeTilWindow     string `json:\"timeTilWindow\"`\n}\n</code></pre>\n\n<p>So for example I need to parse</p>\n\n<pre><code>Name = Red Nose\nSpawnWindowBegins = Mon, 06:45 EST - Mon, 15:15 EST\nTimeTilWindow = Spawnable || in X hours\n</code></pre>\n\n<p>So that I can send the data through a websocket to my site and process that which I can do just fine I'm just not sure the best way to parse that text into a struct, reliably. Thanks.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 1, "creation_date": 1488801560, "post_id": 42624859, "comment_id": 72377932, "body": "MaxheaderBytes refers to the max HTTP header length not to the request URL. I think you need to use another HTTP verb, like POST or PUT, the most popular browsers don&#39;t support URL greater than 2000 chars, see <a href=\"http://stackoverflow.com/questions/417142/what-is-the-maximum-length-of-a-url-in-different-browsers\" title=\"what is the maximum length of a url in different browsers\">stackoverflow.com/questions/417142/&hellip;</a>"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 5, "creation_date": 1488802081, "post_id": 42624859, "comment_id": 72378283, "body": "&quot;very huge data in the url&quot;: That&#39;s the problem. Don&#39;t do that. POST you should use."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488802592, "post_id": 42624859, "comment_id": 72378653, "body": "@Volker Currently it is a long process to move to post for the clients."}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "reply_to_user": {"reputation": 2917, "user_id": 940939, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f04fbc97c3735bb1e24b90e1aa336aae?s=128&d=identicon&r=PG", "display_name": "Massimo Zerbini", "link": "https://stackoverflow.com/users/940939/massimo-zerbini"}, "edited": false, "score": 0, "creation_date": 1488802743, "post_id": 42624859, "comment_id": 72378744, "body": "@MaxZerbini Thanks, the question you shared is about browsers. RFC 7231 doesn&#39;t provide any max limit. I expect golang to provide some way to increase this limit, as it is my custom server."}, {"owner": {"reputation": 4763, "user_id": 2285935, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d22f61c3ceec6d3add64d5eaa161d52a?s=128&d=identicon&r=PG", "display_name": "John S Perayil", "link": "https://stackoverflow.com/users/2285935/john-s-perayil"}, "edited": false, "score": 0, "creation_date": 1488864503, "post_id": 42624859, "comment_id": 72408938, "body": "@MangatRaiModi What router are you using ? I don&#39;t see Status 414 being set anywhere in the standard library. <a href=\"https://github.com/golang/go/search?utf8=%E2%9C%93&amp;q=StatusRequestURITooLong\" rel=\"nofollow noreferrer\">Reference</a>"}, {"owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "edited": false, "score": 0, "creation_date": 1488865073, "post_id": 42624859, "comment_id": 72409132, "body": "Ah good point, Just recently I tried without and I was able to parse 32K of url. I am using Gorilla/Mux library - <a href=\"https://github.com/gorilla/mux\" rel=\"nofollow noreferrer\">github.com/gorilla/mux</a>. btw, standard library also has 414. Search it here - <a href=\"https://golang.org/pkg/net/http/\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http</a>"}, {"owner": {"reputation": 36339, "user_id": 30946, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/350f30695a2ab75b99d3fce947e856b9?s=128&d=identicon&r=PG", "display_name": "jcollum", "link": "https://stackoverflow.com/users/30946/jcollum"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1586291375, "post_id": 42624859, "comment_id": 108074662, "body": "@Volker a POST might not be appropriate here -- I found this question because a client needs to do a GET for data for a group of users. Rather than ask them to do 20+ GETs we allow them to put the IDs in the URL, with comma delimiter. A POST wouldn&#39;t be valid here since they are &quot;getting&quot; data, not giving us data."}], "owner": {"reputation": 4609, "user_id": 1699956, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/oBr6e.jpg?s=128&g=1", "display_name": "Mangat Rai Modi", "link": "https://stackoverflow.com/users/1699956/mangat-rai-modi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1404, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488875688, "creation_date": 1488800816, "last_edit_date": 1488875688, "question_id": 42624859, "link": "https://stackoverflow.com/questions/42624859/golang-solve-http414-request-uri-too-long", "title": "Golang: Solve HTTP414, Request URI too long", "body": "<p><strong>Found that the issue is at the load balancer. Basically the api is behind a load balancer proxy. I need to configure the nginx there. I will ask a fresh question for that</strong></p>\n\n<p>I have created an http Server in Golang using stock <code>net/http</code> package. Once in a while I do get some http call with very huge data in the url(It is an API serevr and is expected). For such requests server is responding with <code>HTTP 414</code> code.</p>\n\n<p>Now I need to know the current length supported by Golang standard http package. From the truncated requests my guess is <code>10,000 bytes</code>. Is there a way to raise it to something bigger, like <code>20,000 bytes</code>. I understand that this might affect the server performance, but I need this as a hotfix until we move all the API's to POST.</p>\n\n<p><em>Post is the way to go, but I need a hotfix. Our clients need huge time to move to POST, I need to support GET for now. I am owner of server, I guess there should be a way to raise the url length limit</em></p>\n\n<p><strong>Edit:-</strong>\nIn the doc:- <a href=\"https://golang.org/src/net/http/server.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/server.go</a>, there is <code>MaxHeaderBytes</code> field. The default value is 1MB which is way more than the maximum data I will ever receive(20KB), other header data should not be that big I guess. Then why is it failing with over 8KB of request data?</p>\n"}, {"tags": ["arrays", "go"], "answers": [{"tags": [], "owner": {"reputation": 1998, "user_id": 733397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/56abfaccffe3ecd97c1d6ec47bb923b3?s=128&d=identicon&r=PG", "display_name": "Vsplit", "link": "https://stackoverflow.com/users/733397/vsplit"}, "is_accepted": false, "score": -1, "last_activity_date": 1488802830, "last_edit_date": 1488802830, "creation_date": 1488797255, "answer_id": 42623592, "question_id": 42623535, "link": "https://stackoverflow.com/questions/42623535/golang-array-pointer/42623592#42623592", "title": "Golang Array Pointer", "body": "<p>Okay found it, the operator \":=\" allocates a new memory address.</p>\n"}, {"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": false, "score": 2, "last_activity_date": 1488799176, "creation_date": 1488799176, "answer_id": 42624277, "question_id": 42623535, "link": "https://stackoverflow.com/questions/42623535/golang-array-pointer/42624277#42624277", "title": "Golang Array Pointer", "body": "<blockquote>\n  <p>Okay found it, the operator \":=\" allocate an new memory address.</p>\n</blockquote>\n\n<p>No, it doesn't allocate anything.</p>\n\n<p><code>var t [5]int</code> is a value. Note that according to spec <code>[5]int</code> if full type name in this case. You can think of it as of a struct with 5 <code>int</code> fields. Line <code>x := *p</code> makes dereferencing pointer to the <code>t</code> (a value). Assigning value creates a copy of it. If you want to pass a \"reference\" to <code>t</code> make slice of it: <code>t[:]</code>.</p>\n"}], "owner": {"reputation": 1998, "user_id": 733397, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/56abfaccffe3ecd97c1d6ec47bb923b3?s=128&d=identicon&r=PG", "display_name": "Vsplit", "link": "https://stackoverflow.com/users/733397/vsplit"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 179, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1488802830, "creation_date": 1488797088, "question_id": 42623535, "link": "https://stackoverflow.com/questions/42623535/golang-array-pointer", "title": "Golang Array Pointer", "body": "<p>I want to elucidate this behavior in Golang,\nWhy when you take the memory reference on array and you change values from this reference nothing change in the referencing array.</p>\n\n<p>One example :</p>\n\n<pre><code>var t [5]int\nprintType(t,\"t\")\np := &amp;t\nprintType(p,\"p\")\nx := *p\nx[0] = 4\nprintType(x,\"x\")\nprintType(p,\"p\")\nprintType(t,\"t\")\n</code></pre>\n\n<p>This code return </p>\n\n<pre><code>[t] Type:[5]int Kind:array Adr:%!p([5]int=[0 0 0 0 0]) Value:([0 0 0 0 0])\n[p] Type:*[5]int Kind:ptr Adr:0xc4200142d0 Value:(&amp;[0 0 0 0 0])\n[x] Type:[5]int Kind:array Adr:%!p([5]int=[4 0 0 0 0]) Value:([4 0 0 0 0])\n[p] Type:*[5]int Kind:ptr Adr:0xc4200142d0 Value:(&amp;[0 0 0 0 0])\n[t] Type:[5]int Kind:array Adr:%!p([5]int=[0 0 0 0 0]) Value:([0 0 0 0 0])\n</code></pre>\n\n<p>you can see the memory address is the same but the value \"4\" is not present.</p>\n\n<p>Method printType</p>\n\n<pre><code>func printType(i interface {},message string) {\n   k := reflect.TypeOf(i).Kind().String()\n   fmt.Printf(\"[%s] Type:%T Kind:%s Adr:%[2]p Value:(%[2]v)\\n\",message,i,k)\n}\n</code></pre>\n"}, {"tags": ["pointers", "go", "interface", "casting"], "comments": [{"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1488799950, "post_id": 42621848, "comment_id": 72376906, "body": "Anything can fulfil the interface, even <code>int</code> or <code>string</code> or a pointer to a struct which isn&#39;t struct."}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "reply_to_user": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1488808529, "post_id": 42621848, "comment_id": 72382512, "body": "@kopiczko What are you trying to say?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488813028, "post_id": 42621848, "comment_id": 72385902, "body": "@wvxvw: are you just asking how to check if the <code>reflect.Kind</code> of v is a pointer? Note that you cannot correctly store a pointer value in a <code>uintptr</code>"}, {"owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1488819291, "post_id": 42621848, "comment_id": 72390396, "body": "@wvxvw I said that regarding your statement: &quot;I have no idea what it is in case it is not a struct.&quot;"}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "reply_to_user": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "edited": false, "score": 0, "creation_date": 1488863649, "post_id": 42621848, "comment_id": 72408637, "body": "@kopiczko OK, I see where the confusion is coming from now. I was referring to the second value returned by <code>InterfaceData()</code>. I think you are talking about whether different basic types can implement interfaces."}, {"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488863783, "post_id": 42621848, "comment_id": 72408681, "body": "@JimB but <code>InterfaceData()</code> uses <code>uintptr</code> for storage. Can you elaborate on why isn&#39;t it possible to store the pointer as <code>uintptr</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488887630, "post_id": 42621848, "comment_id": 72421480, "body": "@wvxvw: because those are the rules of the language. A <code>uintptr</code> is an integer value, not a pointer, and won&#39;t be seen by the GC. if you need a generic pointer use <a href=\"https://golang.org/pkg/unsafe/#Pointer\" rel=\"nofollow noreferrer\"><code>unsafe.Pointer</code></a>. The unsafe docs have more details."}], "answers": [{"comments": [{"owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1488863946, "post_id": 42630496, "comment_id": 72408758, "body": "Let me check this first, but on the surface of it, in your second listing, <code>v = v.Elem()</code> will panic if the actual value behind an interface is not a pointer (say, an integer)."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1488865935, "post_id": 42630496, "comment_id": 72409472, "body": "The <code>v  = v.Elem()</code> statement is only executed when <code>v</code> is an interface.  The statement will not panic."}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "reply_to_user": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "edited": false, "score": 0, "creation_date": 1488866791, "post_id": 42630496, "comment_id": 72409795, "body": "Note that  <code>v.Elem()</code> on an interface returns the value that <code>v</code> contains.  If the interface contains an integer, then <code>v.Elem()</code> returns the integer value. I updated second example to include an interface containing an integer."}], "tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 0, "last_activity_date": 1488867024, "last_edit_date": 1488867024, "creation_date": 1488817171, "answer_id": 42630496, "question_id": 42621848, "link": "https://stackoverflow.com/questions/42621848/extract-uintptr-from-reflect-value/42630496#42630496", "title": "Extract uintptr from reflect.Value", "body": "<p>Use the <a href=\"https://godoc.org/reflect#Value.Pointer\" rel=\"nofollow noreferrer\">Pointer</a> method to get the address of a struct as a uintpr:</p>\n\n<pre><code>var p uintptr\nif v.Kind() == reflect.Ptr &amp;&amp; v.Elem().Kind() == reflect.Struct {\n    p = v.Pointer()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/7j1ipklD3l\" rel=\"nofollow noreferrer\">playground example</a></p>\n\n<p>This code assumes that <code>v</code> is the result of calling <code>reflect.ValueOf(i)</code> as shown in the question.  In this scenario, <code>v</code> represents <code>i</code>'s element, not <code>i</code>.  For example, if interface <code>i</code> contains an <code>int</code>, then <code>v.Kind()</code> is  <code>reflect.Int</code>, not <code>reflect.Interface</code>.</p>\n\n<p>If <code>v</code> has an interface value, then drill down through the interface to get the uintptr:</p>\n\n<pre><code>if v.Kind() == reflect.Interface {\n    v = v.Elem()\n}\nvar p uintptr\nif v.Kind() == reflect.Ptr &amp;&amp; v.Elem().Kind() == reflect.Struct {\n    p = v.Pointer()\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/TLwwQVb5fI\" rel=\"nofollow noreferrer\">playground example</a></p>\n"}], "owner": {"reputation": 4742, "user_id": 5691066, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/e5ab5db401198485d4569199f9994a7d?s=128&d=identicon&r=PG", "display_name": "wvxvw", "link": "https://stackoverflow.com/users/5691066/wvxvw"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 324, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1488867024, "creation_date": 1488792328, "last_edit_date": 1488793129, "question_id": 42621848, "link": "https://stackoverflow.com/questions/42621848/extract-uintptr-from-reflect-value", "title": "Extract uintptr from reflect.Value", "body": "<h1>Given</h1>\n\n<pre><code>// I know that behind SomeInterface can hide either int or a pointer to struct\n// In the real code I only have v, not i\ni := something.(SomeInterface)\nv := reflect.ValueOf(i)\nvar p uintptr\nif \"i is a pointer to struct\" {\n    p = ???\n}\n</code></pre>\n\n<ol>\n<li>I need some way to distinguish between pointers and values in this situation.</li>\n<li>If <code>i</code> was a pointer to struct, I need to cast it to <code>uintptr</code>.</li>\n</ol>\n\n<hr>\n\n<p>Something I discovered so far: the second member of the <code>(*reflect.Value).InterfaceData()</code> will be the pointer to the struct, in case it is a struct. I have no idea what it is in case it is not a struct.</p>\n"}, {"tags": ["go", "https", "beego", "networkcredentials"], "comments": [{"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488786723, "post_id": 42619977, "comment_id": 72368792, "body": "So what is the problem you&#39;re having? As long as the <code>sdfsfscefewfewfew</code> corresponds to <code>user:password</code> in base64, this should work fine."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488786787, "post_id": 42619977, "comment_id": 72368833, "body": "need to add  request.Credentials = new NetworkCredential(utility.commonkey, utility.commonsecrerkey); also but not sure how to do it in go"}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488786953, "post_id": 42619977, "comment_id": 72368940, "body": "@Havelock, in which parameter of request i should be adding this network credentials....please refer above c# code..."}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488787183, "post_id": 42619977, "comment_id": 72369060, "body": "What is represented with <code>utility.commonkey</code> and <code>utility.commonsecrerkey</code>? Is it username and password?"}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488787359, "post_id": 42619977, "comment_id": 72369147, "body": "these keys are basically...keys by which server decides which api to serve"}, {"owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488787537, "post_id": 42619977, "comment_id": 72369238, "body": "When I looked at <a href=\"https://msdn.microsoft.com/en-us/library/system.net.networkcredential(v=vs.110).aspx\" rel=\"nofollow noreferrer\">the docs</a> I see only username and password..."}, {"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "reply_to_user": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "edited": false, "score": 0, "creation_date": 1488787572, "post_id": 42619977, "comment_id": 72369262, "body": "a kind of username and password then we can treat??"}], "answers": [{"comments": [{"owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "edited": false, "score": 0, "creation_date": 1488789293, "post_id": 42620525, "comment_id": 72370150, "body": "yes it is true...its actually username and password kind of"}], "tags": [], "owner": {"reputation": 6480, "user_id": 1267140, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UOHte.jpg?s=128&g=1", "display_name": "Havelock", "link": "https://stackoverflow.com/users/1267140/havelock"}, "is_accepted": true, "score": 0, "last_activity_date": 1488787841, "creation_date": 1488787841, "answer_id": 42620525, "question_id": 42619977, "link": "https://stackoverflow.com/questions/42619977/how-to-send-https-http-request-with-network-credentials-in-go/42620525#42620525", "title": "how to send https/http request with network credentials in go", "body": "<p>From what I see in <a href=\"https://msdn.microsoft.com/en-us/library/system.net.networkcredential(v=vs.110).aspx\" rel=\"nofollow noreferrer\">the C# docs</a> what you're referring at as keys, could only be username and password. You could use the analogue <code>http.Request</code>'s <a href=\"https://golang.org/pkg/net/http/#Request.SetBasicAuth\" rel=\"nofollow noreferrer\">method</a> to set username and password for basic auth.  </p>\n\n<pre><code>// username has the same value as utility.commonkey\n// password is the corresponding password in plain text\nreq.SetBasicAuth(username, password);\n</code></pre>\n\n<p>Don't forget to remove the following line from your Go code as well  </p>\n\n<pre><code>req.Header.Set(\"Authorization\", \"Basic sdfsfscefewfewfew\")\n</code></pre>\n"}], "owner": {"reputation": 577, "user_id": 4869236, "user_type": "registered", "accept_rate": 68, "profile_image": "https://graph.facebook.com/100002451204060/picture?type=large", "display_name": "Vijay Kumar", "link": "https://stackoverflow.com/users/4869236/vijay-kumar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1031, "favorite_count": 0, "accepted_answer_id": 42620525, "answer_count": 1, "score": 1, "last_activity_date": 1488787841, "creation_date": 1488785804, "question_id": 42619977, "link": "https://stackoverflow.com/questions/42619977/how-to-send-https-http-request-with-network-credentials-in-go", "title": "how to send https/http request with network credentials in go", "body": "<p>in c# </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>var uri = new Uri(\"https://demo.com/\");\r\n                var encoding = new UTF8Encoding();\r\n                var request = (HttpWebRequest)WebRequest.Create(uri);\r\n                request.Method = \"POST\";\r\n\r\n                request.Credentials = new NetworkCredential(utility.commonkey, utility.commonsecrerkey);\r\n                request.ContentType = \"application/json\";\r\n                request.Accept = \"application/vnd.demo+json;version=3;\";\r\n                request.ContentLength = encoding.GetByteCount(json);\r\n                request.Headers.Add(\"data\", json);\r\n                HttpWebResponse response = null;</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>and in go i can add only add these </p>\n\n<p><div class=\"snippet\" data-lang=\"js\" data-hide=\"false\" data-console=\"true\" data-babel=\"false\">\r\n<div class=\"snippet-code\">\r\n<pre class=\"snippet-code-html lang-html prettyprint-override\"><code>req.Header.Set(\"Content-Type\", \"application/json\")\r\n\treq.Header.Set(\"Authorization\", \"Basic sdfsfscefewfewfew\")\r\n\treq.Header.Set(\"Accept\", \"application/vnd.demo+json; version=3;\")</code></pre>\r\n</div>\r\n</div>\r\n</p>\n\n<p>here in go the challenge is how to add network credentials in go</p>\n"}, {"tags": ["mongodb", "go", "mgo"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488788222, "post_id": 42619702, "comment_id": 72369591, "body": "Can you show more of your code, because your first version works for me?"}, {"owner": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1488792063, "post_id": 42619702, "comment_id": 72371833, "body": "I added my work as you asked. I am having a problem in converting the code from MongoDB query to Golang."}], "answers": [{"comments": [{"owner": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "edited": false, "score": 0, "creation_date": 1488801214, "post_id": 42624044, "comment_id": 72377730, "body": "Thanks a lot, It is working fine. Thanks for clarifying about &quot;Point&quot; which refers to centre sphere. I can see that you changed  &quot;location&quot;  to  &quot;location.coordinates&quot; where I used as $coordinates which is entirely wrong."}, {"owner": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "edited": false, "score": 0, "creation_date": 1488801758, "post_id": 42624044, "comment_id": 72378062, "body": "&quot;location&quot; or &quot;location.coordinates&quot; work fine. I didn&#39;t find any diffrence in them but the problem is &quot;$coordinates&quot; which i should use lat and long. Thanks."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "edited": false, "score": 0, "creation_date": 1488802176, "post_id": 42624044, "comment_id": 72378342, "body": "@hariprasad Yes, I&#39;ve tested and both works fine, but I felt it&#39;s more appropriate to specify <code>&quot;location.coordinates&quot;</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1488798515, "creation_date": 1488798515, "answer_id": 42624044, "question_id": 42619702, "link": "https://stackoverflow.com/questions/42619702/literal-usage-in-golang-mgo/42624044#42624044", "title": "$literal usage in Golang-mgo", "body": "<p>To be complete, this is what you actually try to do:</p>\n\n<pre><code>pipe := DB.C(\"store\").Pipe([]bson.M{\n    {\"$project\": bson.M{\"location\": bson.M{\"type\": bson.M{\"$literal\": \"Point\"}, \"coordinates\": []interface{}{\"$longitude\", \"$latitude\"}}}},\n    {\"$match\": bson.M{\"location\": bson.M{\"$geoWithin\": bson.M{\"$centerSphere\": []interface{}{\"$coordinates\", 10 / 6378.11}}}}},\n})\n</code></pre>\n\n<p>The problem is not with your <code>\"Point\"</code> literal, it's just a mere coincidence. If you change it to <code>\"Pt\"</code> for example, you will still see the exact same error message.</p>\n\n<p>The <code>Point</code> in the error message refers to <a href=\"https://docs.mongodb.com/manual/reference/operator/query/centerSphere/#op._S_centerSphere\" rel=\"nofollow noreferrer\"><code>$centerSphere</code></a>, which expects a center <em>point</em> and a radius. And the way you try to \"pass\" it does not work.</p>\n\n<p>This works for example:</p>\n\n<pre><code>\"$centerSphere\": []interface{}{[]interface{}{1.0, 2.0}, 10 / 6378.11}\n</code></pre>\n\n<p>Your original query does not make sense, as you try to find documents where the location is within 10 kilometers from <em>itself</em>, which would match all documents.</p>\n\n<p>Instead you want to / should query documents which are within 10 kilometers of a <em>specific</em> location, and you may pass the coordinates of this specific location to <code>$centerSphere</code>:</p>\n\n<pre><code>myLong, myLat := 10.0, 20.0\n\n// ...\n\n\"$centerSphere\": []interface{}{[]interface{}{myLong, myLat}, 10 / 6378.11}\n</code></pre>\n\n<p>The complete query:</p>\n\n<pre><code>myLong, myLat := 10.0, 20.0\npipe := DB.C(\"store\").Pipe([]bson.M{\n    {\"$project\": bson.M{\"location\": bson.M{\"type\": bson.M{\"$literal\": \"Point\"}, \"coordinates\": []interface{}{\"$longitude\", \"$latitude\"}}}},\n    {\"$match\": bson.M{\"location.coordinates\": bson.M{\"$geoWithin\": bson.M{\"$centerSphere\": []interface{}{[]interface{}{myLong, myLat}, 10 / 6378.11}}}}},\n})\n</code></pre>\n"}], "owner": {"reputation": 75, "user_id": 7064515, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/280d817298bfb424e7ed6aaadbbd7f8f?s=128&d=identicon&r=PG&f=1", "display_name": "hari prasad", "link": "https://stackoverflow.com/users/7064515/hari-prasad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 286, "favorite_count": 1, "accepted_answer_id": 42624044, "answer_count": 1, "score": 1, "last_activity_date": 1488798515, "creation_date": 1488784800, "last_edit_date": 1488791874, "question_id": 42619702, "link": "https://stackoverflow.com/questions/42619702/literal-usage-in-golang-mgo", "title": "$literal usage in Golang-mgo", "body": "<p>I can't understand how to properly use $literal. I am using mgo.v2 and mgo.v2/bson package.</p>\n\n<pre><code>db.store.aggregate([\n{\"$project\":{\n    \"location\":{\n        \"type\":{\"$literal\":\"Point\"},\n        \"coordinates\":[\"$longitude\",\"$latitude\"]\n    }}\n},])\n</code></pre>\n\n<p>I used the above code to fetch data in mongodb and working fine.It gives me the result </p>\n\n<pre><code> { \"location\":{\n            \"type\":\"Point\",\n            \"coordinates\":[77.587073,12.958794] \n        }}\n</code></pre>\n\n<p>I tried to use the same in golang and it is shown below</p>\n\n<pre><code>pipe :=DB.C(\"store\").Pipe([]bson.M{\n        {\"$project\":bson.M{\"location\":\n        bson.M{\"type\":\n         bson.M{\"$literal\":\"Point\"},\"coordinates\":[]interface{}{\"$longitude\",\"$latitude\"}}}}}\n</code></pre>\n\n<p>Above code, throws me an error </p>\n\n<blockquote>\n  <p>panic: bad query: BadValue: Point must be an array or object </p>\n</blockquote>\n\n<p>so I replaced it  like this </p>\n\n<pre><code>pipe :=DB.C(\"store\").Pipe([]bson.M{\n        {\"$project\":bson.M{\"location\":\n        bson.M{\"$literal\":\n         bson.M{\"type\":\"Point\"},\"coordinates\":[]interface{}{\"$longitude\",\"$latitude\"}}}}})\n</code></pre>\n\n<p>but this also throws me an error</p>\n\n<blockquote>\n  <p>panic: this object is already an operator expression, and can't be\n  used as a document expression (at 'coordinates')</p>\n</blockquote>\n\n<p>my complete work is shown in the below link\n<a href=\"https://play.golang.org/p/2DcDUJhm6k\" rel=\"nofollow noreferrer\">my work is here</a>\nplease help me to solve this. \nThank you</p>\n"}, {"tags": ["go", "docker", "import", "get"], "comments": [{"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1488785112, "post_id": 42619325, "comment_id": 72367949, "body": "I fixed it by using: import &quot;./testPackage&quot;, rather than: import &quot;main/testPackage&quot;"}, {"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "edited": false, "score": 0, "creation_date": 1488785580, "post_id": 42619325, "comment_id": 72368236, "body": "maybe not though, the relative path is not ideal"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488825625, "post_id": 42619325, "comment_id": 72394033, "body": "no, don&#39;t use relative imports, figure out why your directory structure is broken. Your run command seems to put the code in <code>&#47;usr&#47;src&#47;main</code>, and build from there, but that&#39;s not in your GOPATH."}, {"owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488827564, "post_id": 42619325, "comment_id": 72395078, "body": "yeah, I figured it out by making changing the volume to   &quot;-v  /path/to/my/file:/go/src/main&quot;   which is the gopath of the directory.. i was confused because most of that structure came from the main golang docker image, so i didnt understand why they would have a setup that didnt use the gopath.. anyway, all is well and working now. thanks"}], "owner": {"reputation": 4545, "user_id": 3901400, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/gvB8O.jpg?s=128&g=1", "display_name": "Marcus Ruddick", "link": "https://stackoverflow.com/users/3901400/marcus-ruddick"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 639, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1488799949, "creation_date": 1488783394, "last_edit_date": 1488799949, "question_id": 42619325, "link": "https://stackoverflow.com/questions/42619325/unrecognized-import-path-main-testpackage-when-running-go-image", "title": "Unrecognized import path &quot;main/testPackage&quot; when running Go image", "body": "<p>I am attempting to compile a golang project using docker, I am having trouble getting \"go get\" to compile the packages for me. the entire setup of the container can be seen below in my dockerfile:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>FROM buildpack-deps:jessie-scm\n\n# gcc for cgo\nRUN apt-get update &amp;&amp; apt-get install -y --no-install-recommends \\\n        g++ \\\n        gcc \\\n        libc6-dev \\\n        make \\\n        pkg-config \\\n    &amp;&amp; rm -rf /var/lib/apt/lists/*\n\nENV GOLANG_VERSION 1.8\nENV GOLANG_DOWNLOAD_URL https://golang.org/dl/go$GOLANG_VERSION.linux-amd64.tar.gz\nENV GOLANG_DOWNLOAD_SHA256 53ab94104ee3923e228a2cb2116e5e462ad3ebaeea06ff04463479d7f12d27ca\n\nRUN curl -fsSL \"$GOLANG_DOWNLOAD_URL\" -o golang.tar.gz \\\n    &amp;&amp; echo \"$GOLANG_DOWNLOAD_SHA256  golang.tar.gz\" | sha256sum -c - \\\n    &amp;&amp; tar -C /usr/local -xzf golang.tar.gz \\\n    &amp;&amp; rm golang.tar.gz\n\nENV GOPATH /go\nENV PATH $GOPATH/bin:/usr/local/go/bin:$PATH\nENV CGO_ENABLED 0\nENV GOOS linux\n\nRUN mkdir -p \"$GOPATH/src\" \"$GOPATH/bin\" &amp;&amp; chmod -R 777 \"$GOPATH\"\n\nWORKDIR $GOPATH\n\nRUN go get github.com/lib/pq\n\nENTRYPOINT [\"go\", \"get\", \".\"]\n</code></pre>\n\n<p>I build this container then use it to compile my go code using this command:</p>\n\n<pre><code>sudo docker run --rm -v /path/to/my/project:/usr/src/main -w /usr/src/main go:compiler\n</code></pre>\n\n<p>this finds the main.go in my project folder, reads through it.. but gives me this error when it encounters my import statements:</p>\n\n<blockquote>\n  <p>unrecognized import path \"main/testPackage\" (import path does not\n  begin with hostname)</p>\n</blockquote>\n\n<p>from what I have found in documentation, my understanding is the import path should be the folder in src, i.e. \"main\" in my case, followed by the directory structure.. what am I doing wrong? am I using go get incorrectly?</p>\n"}, {"tags": ["go", "cassandra", "datastax", "gocql"], "answers": [{"tags": [], "owner": {"reputation": 2878, "user_id": 3087441, "user_type": "registered", "accept_rate": 89, "profile_image": "https://i.stack.imgur.com/zIs67.jpg?s=128&g=1", "display_name": "kopiczko", "link": "https://stackoverflow.com/users/3087441/kopiczko"}, "is_accepted": true, "score": 5, "last_activity_date": 1488800217, "creation_date": 1488800217, "answer_id": 42624636, "question_id": 42618342, "link": "https://stackoverflow.com/questions/42618342/golang-cassandra-client-with-connection-pool-support/42624636#42624636", "title": "Golang cassandra client with connection pool support", "body": "<p>You don't need a pool. Create a global <code>Session</code>. From <a href=\"https://godoc.org/github.com/gocql/gocql#Session\" rel=\"noreferrer\">https://godoc.org/github.com/gocql/gocql#Session</a>:</p>\n\n<blockquote>\n  <p>It's safe for concurrent use by multiple goroutines and a typical usage scenario is to have one global session object to interact with the whole Cassandra cluster.</p>\n</blockquote>\n"}], "owner": {"reputation": 5814, "user_id": 1449101, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/v4w0y.png?s=128&g=1", "display_name": "kannanrbk", "link": "https://stackoverflow.com/users/1449101/kannanrbk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2381, "favorite_count": 1, "accepted_answer_id": 42624636, "answer_count": 1, "score": 2, "last_activity_date": 1488800217, "creation_date": 1488778996, "question_id": 42618342, "link": "https://stackoverflow.com/questions/42618342/golang-cassandra-client-with-connection-pool-support", "title": "Golang cassandra client with connection pool support", "body": "<p>We are using <code>gocql</code> (<a href=\"https://github.com/gocql/gocql\" rel=\"nofollow noreferrer\">https://github.com/gocql/gocql</a>) driver to connect to Cassandra from our golang server. For every http request, we are creating a new session and inserting rows into cassandra. We feel it is very much resource intensive to create a session for every request. </p>\n\n<p><strong>Typical Code</strong></p>\n\n<pre><code>func NewSession() (*gocql.Session, error) {\n    config := NewClusterConfig()\n    if config == nil {\n        return nil, &amp;CassandraError{\"Oops! Cluster initialization failed.\"}\n    }\n    return config.CreateSession()\n}\n</code></pre>\n\n<p>Is there any way to pool the connections in <code>gocql</code> or any other cassandra drivers for golang?</p>\n"}, {"tags": ["go", "concurrency"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 1, "creation_date": 1488776406, "post_id": 42617476, "comment_id": 72364469, "body": "why not  <code>ch := make(chan interface{},1)</code>?  not really need the <code>Receive</code> goroutine for the test case."}], "owner": {"reputation": 1702, "user_id": 183458, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/66f3c0ddb7987a870f84bce66b1d8cb5?s=128&d=identicon&r=PG", "display_name": "guhou", "link": "https://stackoverflow.com/users/183458/guhou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 127, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1488773877, "creation_date": 1488773877, "question_id": 42617476, "link": "https://stackoverflow.com/questions/42617476/how-to-force-goroutine-ordering-for-testing", "title": "How to force goroutine ordering for testing", "body": "<p>I have a concurrency utility which is essentially a wrapper around unbuffered\nchannels- providing <code>Send</code> and <code>Receive</code> functions with optional timeouts via\n<code>context.Context</code>. Hence, the inside of the function has a <code>select</code> that looks\nroughly like so (simplified for exposition):</p>\n\n<pre><code>func Send(ctx context.Context, ch chan interface{}, item interface{}) error {\n    select {\n    case &lt;-ctx.Done():\n        return ctx.Err()\n    case ch &lt;- item:\n        return nil\n    }\n}\n</code></pre>\n\n<p>This code is tested and working, but there is an undesirable behaviour where if\nthe context has been cancelled <em>and</em> the channel can be written to, the send\nwill succeed or fail non-deterministically. This is intended behaviour of\n<code>select</code>, so I added a non-blocking send before the main <code>select</code>, with the\nexpected behaviour that this first <code>select</code> should always succeed if the chan\nis available.</p>\n\n<pre><code>func Send(ctx context.Context, ch chan interface{}, item interface{}) error {\n    select {\n    case ch &lt;- item:\n        return nil\n    default:\n    }\n    select {\n    case &lt;-ctx.Done():\n        return ctx.Err()\n    case ch &lt;- item:\n        return nil\n    }\n}\n</code></pre>\n\n<p>I am <em>reasonably</em> confident that this is a correct implementation, but I would\nlike to write a test case that attempts to exercise the event ordering.\nHowever, due to the non-determinism inherent in dealing with multiple\ngoroutines, I cannot work out how to sequence events properly.</p>\n\n<p>Here is what I would like to test:</p>\n\n<pre><code>func TestReceiveThenSend(t *testing.T) {\n    ch := make(chan interface{})\n    go Receive(context.Background(), ch)\n\n    // Somehow, wait until the above `Receive` is blocked reading from `ch`.\n\n    // Immediately expired context.\n    ctx, cancel := context.WithTimeout(context.Background(), 0)\n    defer cancel()\n\n    if err := Send(ctx, ch, \"foo\"); err != nil {\n        t.Fatal(\"expected Send to succeed because Receive is already called.\")\n    }\n}\n</code></pre>\n\n<p>Obviously, I can't expect the above test to work since there is no ordering\nbetween the <code>go Receive</code> and <code>Send</code>. I've tried various hacks such as forcing\n<code>runtime.Gosched</code>, <code>time.Sleep</code>, or implementing a custom <code>Context</code> that knows\nwhen its <code>Done</code> member is used. None of these can force the ordering that I\nwould like.</p>\n\n<p>I'm stuck, I'm looking for any way, pretty or ugly, to force this behaviour.\nDoes anyone have any tricks to solve this?</p>\n"}, {"tags": ["shell", "go"], "answers": [{"comments": [{"owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "edited": false, "score": 0, "creation_date": 1488775424, "post_id": 42617487, "comment_id": 72364157, "body": "Yes indeed. And why only a translator perceives correctly in double quotes? Hmm, where on this specification may be more to read? Code <code>flag</code> and` os.Args` is silent about it."}], "tags": [], "owner": {"reputation": 25546, "user_id": 658718, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/661bb4dee881617e676c4d954ce97a70?s=128&d=identicon&r=PG", "display_name": "Konrad Reiche", "link": "https://stackoverflow.com/users/658718/konrad-reiche"}, "is_accepted": false, "score": 4, "last_activity_date": 1488773951, "creation_date": 1488773951, "answer_id": 42617487, "question_id": 42617008, "link": "https://stackoverflow.com/questions/42617008/go-obtain-a-directory-name-as-an-argument/42617487#42617487", "title": "Go obtain a directory name as an argument", "body": "<p>This is not a matter of the Go code but how you pass it into your program, try passing the path in double quotes <code>\"\u2026\"</code></p>\n\n<pre><code>./main -path=\"/home/spouk/spouk.download/torrent/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"\n&gt; Flag: -path=`/home/spouk/spouk.download/torrent/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/`\n&gt; flag.Args: []\n&gt; Rune: [47 104 111 109 101 47 115 112 111 117 107 47 115 112 111 117 107 46 100 111 119 110 108 111 97 100 47 116 111 114 114 101 110 116 47 1057 1077 1088 1075 1077 1081 32 1051 1091 1082 1100 1103 1085 1077 1085 1082 1086 44 32 1057 1086 1073 1088 1072 1085 1080 1077 32 1089 1086 1095 1080 1085 1077 1085 1080 1081 47]\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": false, "score": 3, "last_activity_date": 1488782474, "last_edit_date": 1488782474, "creation_date": 1488778721, "answer_id": 42618285, "question_id": 42617008, "link": "https://stackoverflow.com/questions/42617008/go-obtain-a-directory-name-as-an-argument/42618285#42618285", "title": "Go obtain a directory name as an argument", "body": "<p>This has nothing to do with Go. This has nothing to do with cyrillic. It is how the shell parses the command line. It is using spaces to separate arguments. Enclose the argument in double quotes (\") to override. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fmt.Printf(\"os.Args:   %q\\n\", os.Args[1:])\n    wordPtr := flag.String(\"path\", \"foo\", \"a string\")\n    flag.Parse()\n    fmt.Printf(\"flag.path: %q\\n\", *wordPtr)\n    fmt.Printf(\"flag.Args: %q\\n\", flag.Args())\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>$ go run path.go -path=/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\nos.Args:   [\"-path=/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439\" \"\u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e,\" \"\u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435\" \"\u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"]\nflag.path: \"/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439\"\nflag.Args: [\"\u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e,\" \"\u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435\" \"\u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"]\n\n$ go run path.go -path=\"/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"\nos.Args:   [\"-path=/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"]\nflag.path: \"/home/spouk/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/\"\nflag.Args: []\n</code></pre>\n\n<blockquote>\n  <p><a href=\"https://www.gnu.org/software/bash/manual/bashref.html\" rel=\"nofollow noreferrer\">Bash Reference Manual</a></p>\n  \n  <p><a href=\"https://www.gnu.org/software/bash/manual/bashref.html#Double-Quotes\" rel=\"nofollow noreferrer\">3.1.2.3 Double Quotes</a></p>\n  \n  <p>Enclosing characters in double quotes (\u2018\"\u2019) preserves the literal\n  value of all characters within the quotes [with some exceptions].</p>\n</blockquote>\n"}], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 1, "answer_count": 2, "score": 0, "last_activity_date": 1488783124, "creation_date": 1488770421, "last_edit_date": 1488783124, "question_id": 42617008, "link": "https://stackoverflow.com/questions/42617008/go-obtain-a-directory-name-as-an-argument", "title": "Go obtain a directory name as an argument", "body": "<p>Go obtain a directory name from the \u0441yrillic as an argument</p>\n\n<p>How to get the full path, not cut garbage.\nExample: The path as a program argument <code>/home/spouk/spouk.download/torrent/\u0421\u0435\u0440\u0433\u0435\u0439 \u041b\u0443\u043a\u044c\u044f\u043d\u0435\u043d\u043a\u043e, \u0421\u043e\u0431\u0440\u0430\u043d\u0438\u0435 \u0441\u043e\u0447\u0438\u043d\u0435\u043d\u0438\u0439/</code></p>\n\n<p>I get in the trimmed version of the program, how to fix?\n<code>/Home/spouk/spouk.download/torrent/\u0421\u0435\u0440\u0433\u0435\u0439</code></p>\n\n<p>example simple code </p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    wordPtr := flag.String(\"path\", \"foo\", \"a string\")\n    flag.Parse()\n    fmt.Printf(\"Flag: -path=`%v`\\nflag.Args: %v\\n\", *wordPtr, flag.Args())\n    fmt.Printf(\"Rune: %v\\n\", []rune(*wordPtr))\n}\n</code></pre>\n"}, {"tags": ["go", "struct"], "answers": [{"tags": [], "owner": {"reputation": 18829, "user_id": 24998, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/2c14a4f2931fa9336fdccdfe11318fef?s=128&d=identicon&r=PG", "display_name": "Jack", "link": "https://stackoverflow.com/users/24998/jack"}, "is_accepted": true, "score": 1, "last_activity_date": 1488763904, "last_edit_date": 1488763904, "creation_date": 1488763619, "answer_id": 42616175, "question_id": 42616119, "link": "https://stackoverflow.com/questions/42616119/pass-variable-to-struct-function/42616175#42616175", "title": "Pass variable to struct function", "body": "<p>I <em>think</em> this is what you want:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\ntype MultiplyStruct struct {\n    Number1 int\n}\n\nfunc (m MultiplyStruct) Multiply(number2 int) int {\n    return m.Number1 * number2\n}\n\nfunc main() {\n    multipler := MultiplyStruct{Number1: 10}\n    val := multipler.Multiply(20)\n    fmt.Println(val)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/In3lrtOmEL\" rel=\"nofollow noreferrer\">On Go Playground</a></p>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": false, "score": 1, "last_activity_date": 1488781106, "creation_date": 1488781106, "answer_id": 42618770, "question_id": 42616119, "link": "https://stackoverflow.com/questions/42616119/pass-variable-to-struct-function/42618770#42618770", "title": "Pass variable to struct function", "body": "<p>Just an interesting addition to the correct answer. You can create a curried function without using a struct to store only an integer:</p>\n\n<pre><code>func Multiply(number1 int) (func(int) int) {\n    return func(number2 int) int {\n        return number1 * number2\n    }\n}\n\nfunc main() {\n    timesTen := Multiply(10)\n    fmt.Println(timesTen(20))    // =&gt; 200\n    timesTwo := Multiply(2)   \n    fmt.Println(timesTwo(10))    // =&gt; 20\n\n    fmt.Println(Multiply(2)(3))  // =&gt; 6\n}\n</code></pre>\n"}], "owner": {"reputation": 363, "user_id": 7363849, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/ddee75a837013b5745c0acb6fc947fbd?s=128&d=identicon&r=PG&f=1", "display_name": "lol", "link": "https://stackoverflow.com/users/7363849/lol"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 42616175, "answer_count": 2, "score": -1, "last_activity_date": 1488781106, "creation_date": 1488763134, "question_id": 42616119, "link": "https://stackoverflow.com/questions/42616119/pass-variable-to-struct-function", "title": "Pass variable to struct function", "body": "<pre><code>type MultiplyStruct struct {\n    Number1 int\n}\n\nfunc (m MultiplyStruct) Multiply() int {\n    return m.Number1 * number2\n}\n</code></pre>\n\n<p>how can I pass <code>number2</code> to the Multiply function? Would it be like this?</p>\n\n<pre><code>   var multiplier = MultiplyStruct(10)\n   multiplier.Multiply(20)\n</code></pre>\n"}, {"tags": ["go", "interface"], "answers": [{"comments": [{"owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488765129, "post_id": 42616146, "comment_id": 72361685, "body": "Should Children&#39;s receiver also be of type GraphNode? Otherwise when I have a method that is called on a node and returns the modified node I would need to cast it to the GraphNode interface, which doesn&#39;t really make sense."}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488765712, "post_id": 42616146, "comment_id": 72361819, "body": "No, the receiver should be your actual type as you have it written. That and the other interface method definitions are what make your type an implementation of the interface. For the interface methods that return a value of type <code>GraphNode</code>, you can return a value of type <code>*Node</code>, since that type implements the interface."}, {"owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488766013, "post_id": 42616146, "comment_id": 72361892, "body": "So to confirm, the issue only occurs when returning slices of Nodes/GraphNodes?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488766551, "post_id": 42616146, "comment_id": 72362002, "body": "Your method definitions must match the interface definition exactly (name, argument types, return types). <code>GetParent</code> must return <code>GraphNode</code>, but within the function, you can return a value of type <code>*Node</code>. Sorry if that wasn&#39;t clear."}, {"owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488766958, "post_id": 42616146, "comment_id": 72362083, "body": "Okay. So in my implementation of the interface, the only place that my type name (Node) should appear in the prototype is in the receiver? Everything else should be of the interface type?"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488767007, "post_id": 42616146, "comment_id": 72362091, "body": "Yes, that&#39;s right. More specifically, everything else (method name, argument types, and return types) must be the same as those in the interface definition."}, {"owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488767278, "post_id": 42616146, "comment_id": 72362154, "body": "Okay. So I think I understand that. Now once I get a GraphNode out of one of these methods, how can I convert it back to a Node? I get an error stating that the type assertion is impossible:  Error: <code>Node does not implement astar.GraphNode (Children method has pointer receiver)</code>   Assetion: <code>testNode.Children()[0].(Node).GetParent().contents</code>"}, {"owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "reply_to_user": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "edited": false, "score": 0, "creation_date": 1488767396, "post_id": 42616146, "comment_id": 72362170, "body": "Let us <a href=\"http://chat.stackoverflow.com/rooms/137303/discussion-between-andy-schweig-and-adrian-smith\">continue this discussion in chat</a>."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1488767197, "last_edit_date": 1488767197, "creation_date": 1488763294, "answer_id": 42616146, "question_id": 42615210, "link": "https://stackoverflow.com/questions/42615210/interface-method-return-value-of-own-type/42616146#42616146", "title": "Interface method return value of own type", "body": "<p><code>*Node</code> doesn't implement the <code>GraphNode</code> interface because the return type of <code>Children()</code> isn't the same as that defined in the interface. Even if <code>*Node</code> implements <code>GraphNode</code>, you can't use <code>[]*Node</code> where <code>[]GraphNode</code> is expected. You need to declare <code>Children()</code> to return <code>[]GraphNode</code>. The elements of a slice of type <code>[]GraphNode</code> can be of type <code>*Node</code>.</p>\n\n<p>For <code>GetParent()</code>, just change it to this:</p>\n\n<pre><code>func (node *Node) GetParent() GraphNode {\n    return node.parent\n}\n</code></pre>\n"}], "owner": {"reputation": 743, "user_id": 4951118, "user_type": "registered", "accept_rate": 61, "profile_image": "https://www.gravatar.com/avatar/a159086740c239ee2bdfdfeb057a6992?s=128&d=identicon&r=PG", "display_name": "Adrian Smith", "link": "https://stackoverflow.com/users/4951118/adrian-smith"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1057, "favorite_count": 1, "accepted_answer_id": 42616146, "answer_count": 1, "score": 0, "last_activity_date": 1488767197, "creation_date": 1488755751, "last_edit_date": 1488766669, "question_id": 42615210, "link": "https://stackoverflow.com/questions/42615210/interface-method-return-value-of-own-type", "title": "Interface method return value of own type", "body": "<p>I am trying to make a method which will take structs of a certain type and do operations on them. However, I need to have a method one can call on an instance of the stuct, and it will return objects of that struct's type. I am getting a compile time error because the return type of the type which implements the interface isn't the same as the interface's method return type, but that's because the interface needs to return values of it's own type.</p>\n\n<p>Interface declaration:</p>\n\n<pre><code>type GraphNode interface {\n    Children() []GraphNode\n    IsGoal() bool\n    GetParent() GraphNode\n    SetParent(GraphNode) GraphNode\n    GetDepth() float64\n    Key() interface{}\n}\n</code></pre>\n\n<p>Type which implements that interface:</p>\n\n<pre><code>type Node struct {\n    contents []int\n    parent   *Node\n    lock     *sync.Mutex\n}\n\nfunc (rootNode *Node) Children() []*Node {\n...\n}\n</code></pre>\n\n<p>Error Message:</p>\n\n<pre><code>.\\astar_test.go:11: cannot use testNode (type *permutation.Node) as type GraphNode in argument to testGraph.GetGoal:\n*permutation.Node does not implement GraphNode (wrong type for Children method)\nhave Children() []*permutation.Node\nwant Children() []GraphNode\n</code></pre>\n\n<p>Method to get parent:</p>\n\n<pre><code>func (node *Node) GetParent() *Node {\n    return node.parent\n}\n</code></pre>\n\n<p>The above method fails because it returns a pointer to a node, and the interface returns type GraphNode.</p>\n"}, {"tags": ["go", "websocket", "timeout"], "comments": [{"owner": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1488771212, "post_id": 42614798, "comment_id": 72363062, "body": "which websocket , <code>golang.org&#47;x&#47;net&#47;websocket</code>  or  <code>github.com&#47;gorilla&#47;websocket</code>?"}, {"owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "reply_to_user": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 1, "creation_date": 1488771482, "post_id": 42614798, "comment_id": 72363130, "body": "@zzn ofc <code>golang.org&#47;x&#47;net&#47;websocket</code>,  github.com/gorilla/websocket = garbage."}, {"owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "reply_to_user": {"reputation": 2028, "user_id": 3435777, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f1f1a766d687b55f0f8a9bd80ce02491?s=128&d=identicon&r=PG&f=1", "display_name": "zzn", "link": "https://stackoverflow.com/users/3435777/zzn"}, "edited": false, "score": 0, "creation_date": 1488786726, "post_id": 42614798, "comment_id": 72368795, "body": "@zzn, yes, golang.org&#39;s library. Gorilla&#39;s is useful, but slow"}], "answers": [{"comments": [{"owner": {"reputation": 22657, "user_id": 3372061, "user_type": "registered", "accept_rate": 87, "profile_image": "https://i.stack.imgur.com/2jSi6.png?s=128&g=1", "display_name": "Dev-iL", "link": "https://stackoverflow.com/users/3372061/dev-il"}, "edited": false, "score": 0, "creation_date": 1488816134, "post_id": 42617121, "comment_id": 72388177, "body": "Please provide some more details."}], "tags": [], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "is_accepted": false, "score": -1, "last_activity_date": 1488816226, "last_edit_date": 1488816226, "creation_date": 1488771309, "answer_id": 42617121, "question_id": 42614798, "link": "https://stackoverflow.com/questions/42614798/golang-websockets-setwritedeadline-function/42617121#42617121", "title": "Golang websocket&#39;s SetWriteDeadline function", "body": "<p>Set it <strong>once</strong>.</p>\n\n<p>PS I checked it myself, it's a simple code.</p>\n"}, {"tags": [], "owner": {"reputation": 29526, "user_id": 2778484, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tzgZz.png?s=128&g=1", "display_name": "chappjc", "link": "https://stackoverflow.com/users/2778484/chappjc"}, "is_accepted": false, "score": 1, "last_activity_date": 1548352950, "creation_date": 1548352950, "answer_id": 54352850, "question_id": 42614798, "link": "https://stackoverflow.com/questions/42614798/golang-websockets-setwritedeadline-function/54352850#54352850", "title": "Golang websocket&#39;s SetWriteDeadline function", "body": "<p>For it to be useful at all, set it every time.  Note that it takes a <code>time.Time</code>, not a <code>time.Duration</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>SetWriteDeadline(t time.Time) error\n</code></pre>\n"}], "owner": {"reputation": 1756, "user_id": 7388600, "user_type": "registered", "accept_rate": 54, "profile_image": "https://www.gravatar.com/avatar/f045c36d726f88326e0719a2efa39973?s=128&d=identicon&r=PG&f=1", "display_name": "Alexey", "link": "https://stackoverflow.com/users/7388600/alexey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 695, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1548352950, "creation_date": 1488752591, "last_edit_date": 1515372579, "question_id": 42614798, "link": "https://stackoverflow.com/questions/42614798/golang-websockets-setwritedeadline-function", "title": "Golang websocket&#39;s SetWriteDeadline function", "body": "<p>Go's websockets have a <strong>SetWriteDeadline()</strong> function to set the connection's network write deadline. Do I need to set it before every data sending or it can be done just once when the connection is created?</p>\n"}, {"tags": ["go", "docker", "docker-compose"], "comments": [{"owner": {"reputation": 953, "user_id": 3017509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VqyE.jpg?s=128&g=1", "display_name": "barat", "link": "https://stackoverflow.com/users/3017509/barat"}, "edited": false, "score": 0, "creation_date": 1488752411, "post_id": 42614704, "comment_id": 72358422, "body": "But in docker-compose you can bind-mount your host volume/directories ... <a href=\"https://docs.docker.com/compose/compose-file/#volumes-volumedriver\" rel=\"nofollow noreferrer\">docs.docker.com/compose/compose-file/#volumes-volumedriver</a>"}, {"owner": {"reputation": 235, "user_id": 4048059, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/3b1030659723f2c0b58923653024fa77?s=128&d=identicon&r=PG&f=1", "display_name": "rawa", "link": "https://stackoverflow.com/users/4048059/rawa"}, "reply_to_user": {"reputation": 953, "user_id": 3017509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VqyE.jpg?s=128&g=1", "display_name": "barat", "link": "https://stackoverflow.com/users/3017509/barat"}, "edited": false, "score": 0, "creation_date": 1488752695, "post_id": 42614704, "comment_id": 72358509, "body": "Ok yea I read that but I wasn&#39;t entirely sure how that worked. Would I just add a line like <code>.&#47;commons1:&#47;go&#47;src&#47;commons1</code> as a volume under <code>volumes</code> in the compose file?"}, {"owner": {"reputation": 953, "user_id": 3017509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VqyE.jpg?s=128&g=1", "display_name": "barat", "link": "https://stackoverflow.com/users/3017509/barat"}, "edited": false, "score": 0, "creation_date": 1488752809, "post_id": 42614704, "comment_id": 72358545, "body": "yes - left part (before :) is Your host path, and right part (after :) defines mount point inside container. You can use multiple of those :)"}, {"owner": {"reputation": 235, "user_id": 4048059, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/3b1030659723f2c0b58923653024fa77?s=128&d=identicon&r=PG&f=1", "display_name": "rawa", "link": "https://stackoverflow.com/users/4048059/rawa"}, "reply_to_user": {"reputation": 953, "user_id": 3017509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VqyE.jpg?s=128&g=1", "display_name": "barat", "link": "https://stackoverflow.com/users/3017509/barat"}, "edited": false, "score": 0, "creation_date": 1488753755, "post_id": 42614704, "comment_id": 72358858, "body": "Hmm, well now I can&#39;t tell if that&#39;s exactly working, but this might be more go related. I will update the post to reflect the new issue I&#39;m facing."}, {"owner": {"reputation": 235, "user_id": 4048059, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/3b1030659723f2c0b58923653024fa77?s=128&d=identicon&r=PG&f=1", "display_name": "rawa", "link": "https://stackoverflow.com/users/4048059/rawa"}, "reply_to_user": {"reputation": 953, "user_id": 3017509, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/9VqyE.jpg?s=128&g=1", "display_name": "barat", "link": "https://stackoverflow.com/users/3017509/barat"}, "edited": false, "score": 0, "creation_date": 1488755618, "post_id": 42614704, "comment_id": 72359367, "body": "@barat it looks like I didn&#39;t do the <code>volumes</code> thing correctly in the <code>docker-compose.yml</code> because my build seems to be indicating to me that the directory doesn&#39;t exist."}], "answers": [{"tags": [], "owner": {"reputation": 235, "user_id": 4048059, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/3b1030659723f2c0b58923653024fa77?s=128&d=identicon&r=PG&f=1", "display_name": "rawa", "link": "https://stackoverflow.com/users/4048059/rawa"}, "is_accepted": false, "score": 0, "last_activity_date": 1488758129, "creation_date": 1488758129, "answer_id": 42615526, "question_id": 42614704, "link": "https://stackoverflow.com/questions/42614704/docker-compose-composing-with-dockerfiles-that-need-relative-imports/42615526#42615526", "title": "Docker-Compose: Composing with Dockerfiles that need relative imports", "body": "<p>So problem was the <code>go get -d -v</code> command since it was complaining <code>myproj/commons1</code> wasn't installed in <code>$GOPATH/src</code> basically. This I of course suspect was because Docker Compose wasn't mounting the volumes I mentioned before it ran the <code>go get</code> on <code>docker-compose build</code> so I made a work around in my <code>docker-compose.yml</code> but it is far from elegant:</p>\n\n<pre><code>version: '2'\n\nservices:\n    module1:\n        volumes:\n            - ./commons1:/go/src/myproj/commons1\n        build: module1/\n        ports:\n            - \"8080:8080\"\n        command: bash -c \"go get -d -v &amp;&amp; go install -v &amp;&amp; /go/bin/app\n</code></pre>\n\n<p>This is obviously far from ideal because my Go binary is rebuilt every time I do a <code>docker-compose up</code> regardless of whether or not I ran <code>docker-compose build</code>. </p>\n\n<p>This is also problematic because I wanted to use <code>dockerize</code> for certain containers to wait until another container has started up completely and it becomes quite messy now I think.</p>\n"}, {"tags": [], "owner": {"reputation": 50397, "user_id": 1318694, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/JPEVC.png?s=128&g=1", "display_name": "Matt", "link": "https://stackoverflow.com/users/1318694/matt"}, "is_accepted": false, "score": 2, "last_activity_date": 1488783712, "creation_date": 1488783712, "answer_id": 42619392, "question_id": 42614704, "link": "https://stackoverflow.com/questions/42614704/docker-compose-composing-with-dockerfiles-that-need-relative-imports/42619392#42619392", "title": "Docker-Compose: Composing with Dockerfiles that need relative imports", "body": "<p>You could build an image including <code>commons1</code> and <code>commons2</code> that your other images are based on.</p>\n\n<pre><code>FROM golang:1.8.0\nRUN mkdir -p /go/src/myproj/commons1 &amp;&amp; mkdir -p /go/src/myproj/commons2\nCOPY commons1/ /go/src/myproj/commons1/\nCOPY commons2/ /go/src/myproj/commons2/\n</code></pre>\n\n<p>The downside is this requires an external build step whenever you update one of the common projects:</p>\n\n<pre><code>docker build -t me/myproj:commons .\n</code></pre>\n\n<p>Then your compose apps can rely on the commons image instead of <code>golang</code> and build as normal without the volumes. </p>\n\n<pre><code>FROM me/myproj:commons\n...\n</code></pre>\n"}], "owner": {"reputation": 235, "user_id": 4048059, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/3b1030659723f2c0b58923653024fa77?s=128&d=identicon&r=PG&f=1", "display_name": "rawa", "link": "https://stackoverflow.com/users/4048059/rawa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 346, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1488783712, "creation_date": 1488751941, "last_edit_date": 1488755563, "question_id": 42614704, "link": "https://stackoverflow.com/questions/42614704/docker-compose-composing-with-dockerfiles-that-need-relative-imports", "title": "Docker-Compose: Composing with Dockerfiles that need relative imports", "body": "<p>To begin, this is my project hierarchy:</p>\n\n<pre><code>myproj/\n    - commons1/\n        - com1_file1.go\n        - ...\n    - commons2/\n        - com2_file1.go\n        - ...\n    - module1/\n        - mod1_file1.go\n        - Dockerfile\n        - ...\n    - module2/\n        - mod2_file1.go\n        - Dockerfile\n        - ...\n    - docker-compose.yml\n</code></pre>\n\n<p>What I'd like to do is that when <code>module1</code> and <code>module2</code> containers start up, they each have a copy of all the <code>commonsN</code> directories in their <code>GOPATH</code>'s so that each can access the common libraries exposed by each of the <code>commonsN</code> directories. </p>\n\n<p>For example, I would like to see something like this in the container for <code>module1</code>:</p>\n\n<pre><code>/go/\n    - src/\n        - commons1/\n            - com1_file1.go\n            - ...\n        - commons2/\n            - com2_file1.go\n            - ...\n        - module1/\n            - mod1_file1.go\n            - ...\n</code></pre>\n\n<p>Reason being is that this is basically how my local <code>GOPATH</code> looks (with the addition of the other modules of course) so that I can do something like this in my source files:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"myproj/commons1\"\n)\n\nfunc main() {\n    fmt.Println(\"Some thing from common library :\", commons1.SomethingFromCommons)\n}\n</code></pre>\n\n<p>From my naive understanding of Docker, it appears I'm not allowed to modify my Dockerfiles to do something along the lines of <code>COPY ../commons1 /go/src/commons1</code>, so I'm wondering how I would go about accomplishing this? </p>\n\n<p>I would strongly prefer to not go the Github route since the source code is all behind company proxies and whatnot and I'm imagining configuring all that is going to take way longer than simply copying some directories. </p>\n\n<p><strong>Edit</strong>\nI have updated my <code>docker-compose.yml</code> file to look something like this per suggestion from barat:</p>\n\n<pre><code>version: '2'\n\nservices:\n    module1:\n        volumes:\n            - ./commons1:/go/src/myproj/commons1\n        build: module1/\n</code></pre>\n\n<p>Dockerfile for <code>module1</code> looks like this: </p>\n\n<pre><code>FROM golang:1.8.0\n\nRUN mkdir -p /go/src/app\nWORKDIR /go/src/app\n\nCOPY . /go/src/app\nRUN go get -d -v\nRUN go install -v\n\nENTRYPOINT /go/bin/app\n\nEXPOSE 8080\n</code></pre>\n\n<p><code>docker-compose build</code> fails on the <code>go get -d -v</code> with error:</p>\n\n<blockquote>\n  <p>package myproj/commons1: unrecognized import path \"myproj/commons1\" (import path does not begin with hostname)</p>\n</blockquote>\n\n<p>If <code>myproj/commons1</code> was copied into <code>/go/src/</code>, then this shouldn't be an issue right? I'm guessing then it hasn't been copied over then?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "edited": false, "score": 1, "creation_date": 1488752533, "post_id": 42614715, "comment_id": 72358452, "body": "so in fact go install ./src/MyGoProgram/client , thnx it worked"}, {"owner": {"reputation": 62, "user_id": 3155364, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/bIHK1.jpg?s=128&g=1", "display_name": "SimonS", "link": "https://stackoverflow.com/users/3155364/simons"}, "edited": false, "score": 0, "creation_date": 1613496522, "post_id": 42614715, "comment_id": 117090405, "body": "I think this advice is out of date with the new go modules structure.  The referenced path <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">golang.org/doc/code.html</a> still works, but there&#39;s nothing there about pkg and src directories."}], "tags": [], "owner": {"reputation": 8269, "user_id": 588734, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/o3CVI.jpg?s=128&g=1", "display_name": "Eamonn McEvoy", "link": "https://stackoverflow.com/users/588734/eamonn-mcevoy"}, "is_accepted": true, "score": 4, "last_activity_date": 1488752090, "creation_date": 1488752090, "answer_id": 42614715, "question_id": 42614455, "link": "https://stackoverflow.com/questions/42614455/how-to-build-program-in-go-subdirectory/42614715#42614715", "title": "How to build program in Go subdirectory?", "body": "<p>It's important to match your go directory to the structure described here: <a href=\"https://golang.org/doc/code.html\" rel=\"nofollow noreferrer\">https://golang.org/doc/code.html</a></p>\n\n<p>so you should have:</p>\n\n<pre><code>{$GOPATH}/bin\n         /pkg\n         /src/MyGoProgram/server.go\n                         /client/client.go\n</code></pre>\n\n<p>cd to <code>{$GOPATH}</code> and run the command <code>go install ./src/MyGoProgram</code>\nthe executable will be created at <code>/bin/MyGoProgram.exe</code></p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4073, "favorite_count": 0, "accepted_answer_id": 42614715, "answer_count": 1, "score": 1, "last_activity_date": 1488752090, "creation_date": 1488750279, "question_id": 42614455, "link": "https://stackoverflow.com/questions/42614455/how-to-build-program-in-go-subdirectory", "title": "How to build program in Go subdirectory?", "body": "<p>I have directory structure below. So server.go is in the main dir , and client.go in client sub directory (both are in package main). When I do ' go get -u ...' I have only server.go compiled under the name of MyGoProgram which is fine (executable in $GOPATH/bin)</p>\n\n<pre><code>MyGoProgram\nclient/client.go\nserver.go\n</code></pre>\n\n<p>How do I compile client.go ?</p>\n"}, {"tags": ["macos", "unix", "go", "terminal", "zsh"], "comments": [{"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488814698, "post_id": 42614380, "comment_id": 72387145, "body": "Have you sourced your <code>~&#47;.zshrc</code> (or launched a new zsh instance) before running <code>go env</code>?"}, {"owner": {"reputation": 244, "user_id": 6678740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/OmpyY.jpg?s=128&g=1", "display_name": "pascalallen", "link": "https://stackoverflow.com/users/6678740/pascalallen"}, "reply_to_user": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488815752, "post_id": 42614380, "comment_id": 72387910, "body": "Yes, I forgot to add that."}, {"owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "edited": false, "score": 0, "creation_date": 1488819626, "post_id": 42614380, "comment_id": 72390637, "body": "What happens if you run <code>&#47;usr&#47;local&#47;go&#47;bin&#47;go env</code>?"}, {"owner": {"reputation": 12785, "user_id": 2992551, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5dc782179e9110bc7dc82b666c87f48b?s=128&d=identicon&r=PG", "display_name": "Adaephon", "link": "https://stackoverflow.com/users/2992551/adaephon"}, "edited": false, "score": 0, "creation_date": 1488876829, "post_id": 42614380, "comment_id": 72414750, "body": "When you run <code>echo $PATH</code>, does it actually contain <code>&#47;usr&#47;local&#47;go&#47;bin</code>?"}, {"owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "edited": false, "score": 0, "creation_date": 1572874839, "post_id": 42614380, "comment_id": 103685927, "body": "is this question still unanswered/unresolved?"}], "answers": [{"comments": [{"owner": {"reputation": 465, "user_id": 5304486, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YiJ2H.jpg?s=128&g=1", "display_name": "Oleg Korol", "link": "https://stackoverflow.com/users/5304486/oleg-korol"}, "edited": false, "score": 0, "creation_date": 1535548164, "post_id": 42616068, "comment_id": 91106411, "body": "I wasn&#39;t able to execute binaries installed by Go. After adding $GOBIN as well to the path it worked."}], "tags": [], "owner": {"reputation": 2883, "user_id": 1735223, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0f9cbf40bed746f8248593ec435e3cd8?s=128&d=identicon&r=PG", "display_name": "anoop", "link": "https://stackoverflow.com/users/1735223/anoop"}, "is_accepted": false, "score": 11, "last_activity_date": 1488762696, "creation_date": 1488762696, "answer_id": 42616068, "question_id": 42614380, "link": "https://stackoverflow.com/questions/42614380/go-install-not-working-with-zsh/42616068#42616068", "title": "Go install not working with zsh", "body": "<p>Below config is working for me,</p>\n\n<p>in <code>~/.zshrc</code></p>\n\n<pre><code>export GOPATH=$HOME/golang\nexport GOROOT=/usr/local/opt/go/libexec\nexport GOBIN=$GOPATH/bin\nexport PATH=$PATH:$GOPATH\nexport PATH=$PATH:$GOROOT/bin\n</code></pre>\n\n<p>You can see the configured details as below then</p>\n\n<blockquote>\n  <p><code>go env</code></p>\n</blockquote>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"/Users/my-name/golang/bin\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"darwin\"\nGOOS=\"darwin\"\nGOPATH=\"/Users/my-name/golang\"\nGORACE=\"\"\nGOROOT=\"/usr/local/opt/go/libexec\"\nGOTOOLDIR=\"/usr/local/opt/go/libexec/pkg/tool/darwin_amd64\"\nGCCGO=\"gccgo\"\nCC=\"clang\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/6q/h6nchrdj49zgjfcp8wstj94r0000gn/T/go-build874871088=/tmp/go-build -gno-record-gcc-switches -fno-common\"\nCXX=\"clang++\"\nCGO_ENABLED=\"1\"\nPKG_CONFIG=\"pkg-config\"\nCGO_CFLAGS=\"-g -O2\"\nCGO_CPPFLAGS=\"\"\nCGO_CXXFLAGS=\"-g -O2\"\nCGO_FFLAGS=\"-g -O2\"\nCGO_LDFLAGS=\"-g -O2\"\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 547, "user_id": 493335, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/25ec70d2f1e80f82f5b82492d4a6a023?s=128&d=identicon&r=PG", "display_name": "Liang", "link": "https://stackoverflow.com/users/493335/liang"}, "edited": false, "score": 0, "creation_date": 1604202519, "post_id": 57217841, "comment_id": 114273087, "body": "And do not use &#39;~&#39; to replace home path :("}], "tags": [], "owner": {"reputation": 2886, "user_id": 2219213, "user_type": "registered", "accept_rate": 69, "profile_image": "https://i.stack.imgur.com/BW004.jpg?s=128&g=1", "display_name": "Sergii Getman", "link": "https://stackoverflow.com/users/2219213/sergii-getman"}, "is_accepted": false, "score": 8, "last_activity_date": 1564135812, "creation_date": 1564135812, "answer_id": 57217841, "question_id": 42614380, "link": "https://stackoverflow.com/questions/42614380/go-install-not-working-with-zsh/57217841#57217841", "title": "Go install not working with zsh", "body": "<p>If you installed on Mac OS not with home-brew but with the macOS package installer, your <em>GOBIN</em> be in <a href=\"https://golang.org/doc/install\" rel=\"noreferrer\">/usr/local/go</a> and <em>GOPATH</em> in <a href=\"https://github.com/golang/go/wiki/SettingGOPATH\" rel=\"noreferrer\">$HOME/go</a>, finally in <code>~/.zshrc</code>:</p>\n\n<pre><code>  export GOPATH=$HOME/go\n  export GOROOT=/usr/local/go\n  export GOBIN=$GOPATH/bin\n  export PATH=$PATH:$GOPATH\n  export PATH=$PATH:$GOROOT/bin\n</code></pre>\n"}], "owner": {"reputation": 244, "user_id": 6678740, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/OmpyY.jpg?s=128&g=1", "display_name": "pascalallen", "link": "https://stackoverflow.com/users/6678740/pascalallen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14741, "favorite_count": 5, "answer_count": 2, "score": 9, "last_activity_date": 1564135812, "creation_date": 1488749874, "question_id": 42614380, "link": "https://stackoverflow.com/questions/42614380/go-install-not-working-with-zsh", "title": "Go install not working with zsh", "body": "<p>I feel like an idiot because I've installed this before on macOS and OSX but for some reason I can't see what I'm doing wrong. Please help!!! I've created a directory, <code>~/go</code>, which will be my workspace. When I run <code>go env</code> from my home directory I get <code>zsh: command not found: go</code> and I know it's because of the following files. What is wrong in my configuration? </p>\n\n<p><strong>~/.bash_profile:</strong></p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\n</code></pre>\n\n<p><strong>~/.zshrc:</strong></p>\n\n<pre><code>export PATH=$PATH:/usr/local/go/bin\n</code></pre>\n"}, {"tags": ["go", "memory-management", "garbage-collection", "stack", "heap"], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 3, "last_activity_date": 1488753513, "last_edit_date": 1488753513, "creation_date": 1488752989, "answer_id": 42614858, "question_id": 42613846, "link": "https://stackoverflow.com/questions/42613846/in-golang-what-happens-to-a-variable-after-it-goes-out-of-scope-of-a-loop-or-a/42614858#42614858", "title": "In golang, what happens to a variable after it goes out of scope of a loop or a condition or a case?", "body": "<p>If the channel value type is a slice, the value of the variable <code>msg</code> is just the slice descriptor, which is small (see <a href=\"https://blog.golang.org/go-slices-usage-and-internals\" rel=\"nofollow noreferrer\">https://blog.golang.org/go-slices-usage-and-internals</a>). The array that contains the data the slice refers to will have been allocated elsewhere before the slice was placed on the channel. Assuming the value must survive after the function that allocated it returns, it will be on the heap. Note that the contents of the slice are not actually being moved or copied by the channel receive operation.</p>\n\n<p>Once the value of <code>msg</code> becomes unreachable (by the variable going out of scope or being assigned a different value), assuming there are no other references to the array underlying the slice, it will be subject to garbage collection.</p>\n\n<p>It's hard to say whether some amount of optimization would be helpful without knowing more about how the program works.</p>\n"}, {"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 3, "last_activity_date": 1488784536, "creation_date": 1488784536, "answer_id": 42619636, "question_id": 42613846, "link": "https://stackoverflow.com/questions/42613846/in-golang-what-happens-to-a-variable-after-it-goes-out-of-scope-of-a-loop-or-a/42619636#42619636", "title": "In golang, what happens to a variable after it goes out of scope of a loop or a condition or a case?", "body": "<blockquote>\n  <p>Shouldn't I be bothered about it at all?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>(And once it bothers you: profile.)</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 559, "favorite_count": 3, "accepted_answer_id": 42614858, "answer_count": 2, "score": 3, "last_activity_date": 1488784536, "creation_date": 1488747214, "last_edit_date": 1495542722, "question_id": 42613846, "link": "https://stackoverflow.com/questions/42613846/in-golang-what-happens-to-a-variable-after-it-goes-out-of-scope-of-a-loop-or-a", "title": "In golang, what happens to a variable after it goes out of scope of a loop or a condition or a case?", "body": "<p>Please don't mark this as duplicate question, as this is more specific to golang and requesting advise on some best practice when declaring variables to store large byte arrays when reading from a channel.</p>\n\n<p>Forgive me for this dumb question, but the reason for this question is just my curiosity to determine what could be the best practice on writing a high-performance stream consumer reading large size byte array from multiple channels. (although premature optimization is the root of all evil, this is more of a curiosity). I have read answers about similar senario specific to <code>C</code> <a href=\"https://stackoverflow.com/questions/13888268/what-happens-when-a-variable-goes-out-of-scope\">here</a>, but I am requesting answer specific to go, as it is a garbage collected language, and their documentation <a href=\"https://golang.org/doc/faq#stack_or_heap\" rel=\"nofollow noreferrer\">here</a> says \"From a correctness standpoint, you don't need to know where the variable is allocated\".</p>\n\n<p>If I have the following code to read from a channel,</p>\n\n<pre><code>    for {\n    select {\n    case msg := &lt;-stream.Messages():\n    ...snip...\n</code></pre>\n\n<p>Variable <code>msg</code> is within the scope of the case statement. </p>\n\n<ul>\n<li>What happens once it goes out of scope of <code>case</code> statement? Since this is declared in the same native function, and the size of <code>stream</code> could be a large byte slice, is the variable going to be stored in heap or stack, and if heap, will it be garbage collected, or does stack pointer comes into picture?</li>\n<li>Since this is inside an infinite for loop, and the size of <code>stream</code> is a large byte slice, is creating the variable and allocating memory every time an overhead,or should I declare the variable ahead, and keeps on over-writing it in every iteration, so that if there is a garbage collection involved, which I am not sure, I could possibly reduce the garbage?</li>\n<li>Shouldn't I be bothered about it at all?</li>\n</ul>\n\n<p>Thank you.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "edited": false, "score": 0, "creation_date": 1488771895, "post_id": 42612662, "comment_id": 72363241, "body": "rofl, &quot;http.ServeFile(w, r, r.URL.Path[1:])&quot;  - Memories in, as an example of idiotic code. Small you mess in head, definitely. Example my code: <a href=\"https://github.com/spouk/spoukfw/blob/master/spoukrender.go\" rel=\"nofollow noreferrer\">github.com/spouk/spoukfw/blob/master/spoukrender.go</a>"}], "answers": [{"comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1488748825, "post_id": 42613460, "comment_id": 72357219, "body": "+1 to this and never use r.URL.Path[1:] as the question did - you&#39;re allowing user input to directly choose a path on the filesystem."}, {"owner": {"reputation": 45, "user_id": 4994721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02c35499a0ff4d0685c6d2e9bfc13734?s=128&d=identicon&r=PG&f=1", "display_name": "Illia", "link": "https://stackoverflow.com/users/4994721/illia"}, "edited": false, "score": 0, "creation_date": 1488789120, "post_id": 42613460, "comment_id": 72370051, "body": "Did I understand correctly that StaticFiles should be replaced with ScriptsDirectory ?  So I can either use Templates and show html pages with javascript inside like:   <code>&lt;script&gt; alert(&#39;hello&#39;); &lt;&#47;script&gt;</code>  OR I can use FileServer to provide files but not a templates ?  Can I somehow use both ? Like templates for html and fileserver for only one directory &quot;scripts&quot; ?"}, {"owner": {"reputation": 44, "user_id": 7589402, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DILCW.jpg?s=128&g=1", "display_name": "weqlix", "link": "https://stackoverflow.com/users/7589402/weqlix"}, "reply_to_user": {"reputation": 45, "user_id": 4994721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02c35499a0ff4d0685c6d2e9bfc13734?s=128&d=identicon&r=PG&f=1", "display_name": "Illia", "link": "https://stackoverflow.com/users/4994721/illia"}, "edited": false, "score": 0, "creation_date": 1488826002, "post_id": 42613460, "comment_id": 72394226, "body": "@Illia thanks for the catch. Edited. Golang provides its own tempting engine which you can read about <a href=\"https://golang.org/pkg/text/template/\" rel=\"nofollow noreferrer\">here</a>"}], "tags": [], "owner": {"reputation": 44, "user_id": 7589402, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DILCW.jpg?s=128&g=1", "display_name": "weqlix", "link": "https://stackoverflow.com/users/7589402/weqlix"}, "is_accepted": true, "score": 2, "last_activity_date": 1488825977, "last_edit_date": 1488825977, "creation_date": 1488745013, "answer_id": 42613460, "question_id": 42612662, "link": "https://stackoverflow.com/questions/42612662/go-how-can-i-use-javascript-code-on-my-html-page/42613460#42613460", "title": "Go How can I use JavaScript code on my html page", "body": "<p>You should be able to serve static files from a specific directory using the <a href=\"https://golang.org/pkg/net/http/#FileServer\" rel=\"nofollow noreferrer\"><code>http</code></a> package.</p>\n\n<p>For example:</p>\n\n<pre><code>func main() {\n  ScriptsDirectory := http.FileServer(http.Dir(\"scripts\"))\n  http.Handle(\"/scripts\", ScriptsDirectory)\n\n  log.Println(\"Listening at port 3000\")\n  http.ListenAndServe(\":3000\", nil)\n}\n</code></pre>\n\n<p>Will let you server the file directly from that directory. </p>\n\n<p>From there you can reference the <code>/scripts</code> directory in your <strong>index.html</strong> page as is.</p>\n\n<p><a href=\"http://www.alexedwards.net/blog/serving-static-sites-with-go\" rel=\"nofollow noreferrer\">Here</a> is also a tutorial where this technique is used.</p>\n"}], "owner": {"reputation": 45, "user_id": 4994721, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/02c35499a0ff4d0685c6d2e9bfc13734?s=128&d=identicon&r=PG&f=1", "display_name": "Illia", "link": "https://stackoverflow.com/users/4994721/illia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 72, "favorite_count": 0, "accepted_answer_id": 42613460, "answer_count": 1, "score": 1, "last_activity_date": 1488825977, "creation_date": 1488740507, "question_id": 42612662, "link": "https://stackoverflow.com/questions/42612662/go-how-can-i-use-javascript-code-on-my-html-page", "title": "Go How can I use JavaScript code on my html page", "body": "<p>Problem: I have <strong>script src</strong> tag in my index.html page but on browser this script doesn't load ( actually it loads but looks like index.html file 0_0 see pictures below ). The question is: How can I use JavaScript code which is in different file ( myscripts.js ) on my html page ? </p>\n\n<p><a href=\"https://i.stack.imgur.com/Ol9kU.jpg\" rel=\"nofollow noreferrer\">js file looks like html ( index.html ) file</a></p>\n\n<p>During googling I found \"solution\" but I does not work completely like it should. I just added this line to viewHandler method :  </p>\n\n<pre><code>http.ServeFile(w, r, r.URL.Path[1:])\n</code></pre>\n\n<p>After this, project started look like this:</p>\n\n<p><a href=\"https://i.stack.imgur.com/oRRmi.jpg\" rel=\"nofollow noreferrer\">index.html after adding line above</a></p>\n\n<p><strong>To sum up:</strong></p>\n\n<p>My goal is to show html page and use javascript function which are in scripts/ folder.  </p>\n\n<p><strong>Project Structure :</strong></p>\n\n<pre><code>-scripts \n --myscripts.js\n-templates\n --index.html\nserver.go\n</code></pre>\n\n<p><strong>Server.go :</strong></p>\n\n<pre><code>func viewHandler(w http.ResponseWriter, r *http.Request) {\n    fmt.Println(\"listening . . .\")\n            tpl.ExecuteTemplate(w, \"index.html\", nil)\n        }\n\nfunc main() {\n\n    http.HandleFunc(\"/\", viewHandler)\n        http.ListenAndServe(\":8080\", nil)\n}\n</code></pre>\n\n<p><strong>myscripts.js:</strong></p>\n\n<pre><code>function clickFunc(){\nconsole.log(\"clicked\")\n}\n</code></pre>\n\n<p><strong>index.html:</strong>\n    </p>\n\n<pre><code>&lt;head&gt;\n&lt;script type=\"text/javascript\" src=\"scripts/myscripts.js\"&gt;&lt;/script&gt;\n&lt;/head&gt;\n&lt;body&gt;\n\n&lt;button onclick=\"clickFunc()\"&gt;Click me&lt;/button&gt;\n\n&lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 1, "creation_date": 1488737381, "post_id": 42611974, "comment_id": 72353067, "body": "Characters <i>are</i> numbers. You should use a slice of <code>rune</code>s though."}, {"owner": {"reputation": 3441, "user_id": 5291427, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh4.googleusercontent.com/-lu_crIBX8Ow/AAAAAAAAAAI/AAAAAAAAAAA/G_Vb3EEC_3Q/photo.jpg?sz=128", "display_name": "apxp", "link": "https://stackoverflow.com/users/5291427/apxp"}, "edited": false, "score": 0, "creation_date": 1488739421, "post_id": 42611974, "comment_id": 72353794, "body": "Just use the <code>string()</code> function. <code>string(s[i])</code> returns the character."}, {"owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "reply_to_user": {"reputation": 12097, "user_id": 1080064, "user_type": "registered", "accept_rate": 43, "profile_image": "https://graph.facebook.com/100000753306178/picture?type=large", "display_name": "tkausl", "link": "https://stackoverflow.com/users/1080064/tkausl"}, "edited": false, "score": 0, "creation_date": 1488739811, "post_id": 42611974, "comment_id": 72353933, "body": "can any of you write an answer? @tkausl"}], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": false, "score": 0, "last_activity_date": 1488739879, "creation_date": 1488739879, "answer_id": 42612530, "question_id": 42611974, "link": "https://stackoverflow.com/questions/42611974/convert-string-to-slice-of-string-type/42612530#42612530", "title": "Convert string to slice of string type", "body": "<p>As mentioned above this in the comments, you can use <code>string(s[i])</code> to convert it to a character or you can use <code>fmt.Printf(\"%c\", s[i])</code> to print the character represented by the corresponding Unicode code point.</p>\n"}, {"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 4, "last_activity_date": 1488740212, "creation_date": 1488740212, "answer_id": 42612599, "question_id": 42611974, "link": "https://stackoverflow.com/questions/42611974/convert-string-to-slice-of-string-type/42612599#42612599", "title": "Convert string to slice of string type", "body": "<p>If you want to convert string to a []string you can also just use strings.Split(s,\"\")</p>\n"}, {"tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 1, "last_activity_date": 1488745001, "last_edit_date": 1488745001, "creation_date": 1488741554, "answer_id": 42612832, "question_id": 42611974, "link": "https://stackoverflow.com/questions/42611974/convert-string-to-slice-of-string-type/42612832#42612832", "title": "Convert string to slice of string type", "body": "<p>For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc isPalindrome(s string) bool {\n    s = strings.ToLower(s)\n    r := []rune(s)\n    mid := len(r) / 2\n    last := len(r) - 1\n    for i := 0; i &lt; mid; i++ {\n        if r[i] != r[last-i] {\n            return false\n        }\n    }\n    return true\n}\n\nfunc main() {\n    var s string\n    fmt.Println(\"Enter string:\")\n    fmt.Scanf(\"%s\\n\", &amp;s)\n    fmt.Println(s, isPalindrome(s))\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Enter string:\n123\n123 false\nEnter string:\n121\n121 true\nEnter string:\nabba\nabba true\nEnter string:\n\u4e16\u754c\u4e16\n\u4e16\u754c\u4e16 true\n</code></pre>\n\n<p>A Go character <code>string</code> is a UTF-8 encoded sequence of characters. UTF-8 is variable length character encoding. <code>s[i]</code> is a byte not a character. A <code>rune</code> (code point) is a character. Use <code>string(r)</code> to convert a <code>rune</code> to a printable <code>string</code>. For example,</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n)\n\nfunc main() {\n    s := \"Hello, \u4e16\u754c\"\n    for _, r := range s {\n        fmt.Print(string(r))\n    }\n    fmt.Println()\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Hello, \u4e16\u754c\n</code></pre>\n\n<p>References:</p>\n\n<p><a href=\"https://en.wikipedia.org/wiki/Unicode\" rel=\"nofollow noreferrer\">Unicode - Wikipedia</a></p>\n\n<p><a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">Strings, bytes, runes and characters in Go</a></p>\n"}, {"tags": [], "owner": {"reputation": 179, "user_id": 12698841, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mnLhX.png?s=128&g=1", "display_name": "0example.com", "link": "https://stackoverflow.com/users/12698841/0example-com"}, "is_accepted": false, "score": 0, "last_activity_date": 1612930615, "creation_date": 1612930615, "answer_id": 66130836, "question_id": 42611974, "link": "https://stackoverflow.com/questions/42611974/convert-string-to-slice-of-string-type/66130836#66130836", "title": "Convert string to slice of string type", "body": "<p>you can use string() to return the character.</p>\n<p>example : <code>fmt.Println(string(s[i]))</code></p>\n"}], "owner": {"reputation": 2623, "user_id": 5241780, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/8542490e5ecda0cf556cb0e7403f0812?s=128&d=identicon&r=PG&f=1", "display_name": "chefcurry7", "link": "https://stackoverflow.com/users/5241780/chefcurry7"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6553, "favorite_count": 1, "accepted_answer_id": 42612832, "answer_count": 4, "score": 0, "last_activity_date": 1612930615, "creation_date": 1488736975, "question_id": 42611974, "link": "https://stackoverflow.com/questions/42611974/convert-string-to-slice-of-string-type", "title": "Convert string to slice of string type", "body": "<p>In the code below when I inspect <code>s[i]</code> it gives me binary numbers instead of characters. Code still works but how can I get <code>s[i]</code> to return a character, while still using s type string as parameter?        </p>\n\n<pre><code>func main() {\n\n        var ip string\n        fmt.Println(\"Enter string:\")\n        fmt.Scanf(\"%s\\n\", &amp;ip)\n        ip = strings.ToLower(ip)\n        fmt.Println(isP(ip))\n    }\n    //Function to test if the string entered is a Palindrome\n\n    func isP(s string) string {\n        mid := len(s) / 2\n        last := len(s) - 1\n        for i := 0; i &lt; mid; i++ {\n            if s[i] != s[last-i] {\n                return \"NO. It's not a Palimdrome.\"\n            }\n        }\n        return \"YES! You've entered a Palindrome\"\n    }\n</code></pre>\n"}, {"tags": ["go", "tree"], "answers": [{"comments": [{"owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "edited": false, "score": 0, "creation_date": 1488737785, "post_id": 42612005, "comment_id": 72353214, "body": "Make sense. I assume *map[*Node]*Node is an error,  right? (map[*Node]*Node would work just fine)"}], "tags": [], "owner": {"reputation": 103812, "user_id": 320726, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/02041b18199678d1f02e6d5040dbb907?s=128&d=identicon&r=PG", "display_name": "6502", "link": "https://stackoverflow.com/users/320726/6502"}, "is_accepted": true, "score": 0, "last_activity_date": 1488737945, "last_edit_date": 1488737945, "creation_date": 1488737160, "answer_id": 42612005, "question_id": 42611806, "link": "https://stackoverflow.com/questions/42611806/clone-node-golang-org-x-net-html-stack-overflow/42612005#42612005", "title": "Clone Node [golang.org/x/net/html] : Stack overflow", "body": "<p>When deep-cloning a data structure containing pointers <i>that is not a tree</i> you need a more sophisticated approach; if you call</p>\n\n<pre><code> n := Node{...\n           next:clone(src.next),\n           prev:clone(src.prev),\n           ...}\n</code></pre>\n\n<p>and your structure has even just two siblings nodes <code>n1</code> and <code>n2</code> where <code>n1.next</code> is <code>&amp;n2</code> and <code>n2.prev</code> is <code>&amp;n1</code> the code will stack overflow (cloning <code>n1</code> will call <code>clone(n2)</code> for the <code>next</code> pointer that in turn will call <code>clone(n1)</code> for the <code>prev</code> pointer, looping back and forth forever until the call stack explodes).</p>\n\n<p>A solution is to keep a \"cache\" where when cloning a node you will store the <code>src\u2192cloned</code> association, so the clone procedure will be able to return the node in case of recursive structures.</p>\n\n<p>What follows is a full minimal example:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype Node struct {\n    value      int\n    prev, next *Node\n}\n\nfunc clone(n *Node, cache map[*Node]*Node) *Node {\n    if n == nil {\n        return nil\n    }\n\n    if val, ok := cache[n]; ok {\n        return val\n    }\n\n    val := &amp;Node{}\n    cache[n] = val\n    val.value = n.value\n    val.prev = clone(n.prev, cache)\n    val.next = clone(n.next, cache)\n\n    return val\n}\n\nfunc printlist(n *Node) {\n    for n != nil {\n        println(fmt.Sprintf(\"address=%p, value=%v, prev=%p, next=%p\",\n            n, n.value, n.prev, n.next))\n        n = n.next\n    }\n}\n\nfunc main() {\n    n1 := &amp;Node{}\n    n2 := &amp;Node{}\n    n3 := &amp;Node{}\n    n1.value = 100\n    n2.value = 200\n    n3.value = 300\n    n1.next = n2\n    n2.prev = n1\n    n2.next = n3\n    n3.prev = n2\n\n    printlist(n1)\n\n    println(\"Cloning list\")\n    c1 := clone(n1, make(map[*Node]*Node))\n    printlist(c1)\n}\n</code></pre>\n\n<p>Running this program on my machine i get</p>\n\n<pre><code>~/x$ go run recstruct.go\naddress=0xc42000e540, value=100, prev=0x0, next=0xc42000e560\naddress=0xc42000e560, value=200, prev=0xc42000e540, next=0xc42000e580\naddress=0xc42000e580, value=300, prev=0xc42000e560, next=0x0\nCloning list\naddress=0xc42000e5c0, value=100, prev=0x0, next=0xc42000e5e0\naddress=0xc42000e5e0, value=200, prev=0xc42000e5c0, next=0xc42000e600\naddress=0xc42000e600, value=300, prev=0xc42000e5e0, next=0x0\n~/x$ \n</code></pre>\n\n<p>where you can see that the three nodes have been cloned correctly and prev/next are pointing each other in the cloned structure list.</p>\n"}], "owner": {"reputation": 449, "user_id": 7623709, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3b869731c724b20a6dd447a3f87121e6?s=128&d=identicon&r=PG&f=1", "display_name": "mike", "link": "https://stackoverflow.com/users/7623709/mike"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 204, "favorite_count": 1, "accepted_answer_id": 42612005, "answer_count": 1, "score": 1, "last_activity_date": 1488737945, "creation_date": 1488735922, "last_edit_date": 1488737181, "question_id": 42611806, "link": "https://stackoverflow.com/questions/42611806/clone-node-golang-org-x-net-html-stack-overflow", "title": "Clone Node [golang.org/x/net/html] : Stack overflow", "body": "<p>I'm trying to clone/copy a html <a href=\"https://godoc.org/golang.org/x/net/html#Node\" rel=\"nofollow noreferrer\">Node</a> so that I can modify/duplicate it and then inject it back in the main document. The issue is that I'm getting a stack overflow[2]. I assume there is a race condition. It looks like it's due <code>Parent</code> and <code>PrevSibling</code> fields(based on my blind tests). Any idea why is that and how can I clone it completely(so that it can test positive on reflect.DeepEqual) ? </p>\n\n<pre><code>func clone(src *html.Node) *html.Node {\n    if src == nil {\n        return nil\n    }\n    n := html.Node{\n        Parent:      clone(src.Parent),\n        FirstChild:  clone(src.FirstChild),\n        LastChild:   clone(src.LastChild),\n        PrevSibling: clone(src.PrevSibling),\n        NextSibling: clone(src.NextSibling),\n\n        Type:      src.Type,\n        DataAtom:  src.DataAtom,\n        Data:      src.Data,\n        Namespace: src.Namespace,\n    }\n    for _, v := range n.Attr {\n        n.Attr = append(n.Attr, v)\n    }\n    return &amp;n\n}\n</code></pre>\n\n<p>[2] </p>\n\n<pre><code>runtime: goroutine stack exceeds 1000000000-byte limit\nfatal error: stack overflow\n\nruntime stack:\nruntime.throw(0x3495b9, 0xe)\n    /Users/x/gosrc/src/runtime/panic.go:566 +0x95\nruntime.newstack()\n    /Users/x/gosrc/src/runtime/stack.go:1061 +0x416\nruntime.morestack()\n    /Users/x/gosrc/src/runtime/asm_amd64.s:366 +0x7f\n\ngoroutine 7 [running]:\nruntime.heapBitsSetType(0xc42a0ae5b0, 0x70, 0x68, 0x32e420)\n    /Users/x/gosrc/src/runtime/mbitmap.go:867 fp=0xc4402002a8 sp=0xc4402002a0\nruntime.mallocgc(0x70, 0x32e420, 0x1, 0x0)\n    /Users/x/gosrc/src/runtime/malloc.go:690 +0x5ba fp=0xc440200348 sp=0xc4402002a8\nruntime.newobject(0x32e420, 0x0)\n    /Users/x/gosrc/src/runtime/malloc.go:785 +0x38 fp=0xc440200378 sp=0xc440200348\nbitbucket.org/x/y/client.clone(0xc420138d20, 0x0)\n</code></pre>\n"}, {"tags": ["go", "gofmt"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488730299, "post_id": 42609375, "comment_id": 72350521, "body": "Print out the quoted strings or the raw byte data and see exactly what&#39;s happening at each step"}], "answers": [{"comments": [{"owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "edited": false, "score": 0, "creation_date": 1488737002, "post_id": 42610225, "comment_id": 72352945, "body": "Thanks a lot, I can sadly only upvote since I accepted PieOhPah answer (seems both answers correctly fixed my problem)"}], "tags": [], "owner": {"reputation": 542, "user_id": 178442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377cef4245e0fcbf76e021d9cd253e35?s=128&d=identicon&r=PG", "display_name": "Colin Stewart", "link": "https://stackoverflow.com/users/178442/colin-stewart"}, "is_accepted": false, "score": 3, "last_activity_date": 1488727896, "creation_date": 1488727896, "answer_id": 42610225, "question_id": 42609375, "link": "https://stackoverflow.com/questions/42609375/why-does-fmt-sprintfv-linesi-put-the-comma-on-new-line/42610225#42610225", "title": "Why does &quot;fmt.Sprintf(&quot;%v,&quot;, lines[i])&quot; put the comma on new line?", "body": "<p>Is it possible that your JSON data is coming from Windows and actually contains /r/n rather than just /n?</p>\n\n<p>You can see this behaviour using /r/n in <a href=\"https://play.golang.org/p/a0FyIyrHQV\" rel=\"nofollow noreferrer\">this playground example</a>: </p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\n    a := \"test\\r\\nnewtest\\r\\ntest2\"\n    b := strings.Split(a, \"\\n\")\n    c := strings.Join(b, \",\\n\")\n    fmt.Printf(\"%v\", c)\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 5586, "user_id": 1965774, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/e7KDB.gif?s=128&g=1", "display_name": "Pie &#39;Oh&#39; Pah", "link": "https://stackoverflow.com/users/1965774/pie-oh-pah"}, "is_accepted": true, "score": 3, "last_activity_date": 1488730794, "creation_date": 1488730794, "answer_id": 42610782, "question_id": 42609375, "link": "https://stackoverflow.com/questions/42609375/why-does-fmt-sprintfv-linesi-put-the-comma-on-new-line/42610782#42610782", "title": "Why does &quot;fmt.Sprintf(&quot;%v,&quot;, lines[i])&quot; put the comma on new line?", "body": "<p>Try trimming the line to clean up whatever trailing unicode code points it has:</p>\n\n<pre><code>import \"strings\"\n\n// ...\n\nfor _, line := range lines {\n        line = fmt.Sprintf(\"%v,\", strings.Trim(line, \" \\r\\n\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 699, "user_id": 7530061, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/67d9f10184bc61745882732a1cc6b570?s=128&d=identicon&r=PG&f=1", "display_name": "fisker", "link": "https://stackoverflow.com/users/7530061/fisker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1793, "favorite_count": 0, "accepted_answer_id": 42610782, "answer_count": 2, "score": 0, "last_activity_date": 1599548242, "creation_date": 1488723038, "last_edit_date": 1599548242, "question_id": 42609375, "link": "https://stackoverflow.com/questions/42609375/why-does-fmt-sprintfv-linesi-put-the-comma-on-new-line", "title": "Why does &quot;fmt.Sprintf(&quot;%v,&quot;, lines[i])&quot; put the comma on new line?", "body": "<p>This is the full code:</p>\n\n<pre><code>files, _ := ioutil.ReadDir(\"files\")\nfor _, f := range files {\n    input, err := ioutil.ReadFile(\"files/\" + f.Name())\n    lines := strings.Split(string(input), \"\\n\")\n\n    for i, _ := range lines {\n        lines[i] = fmt.Sprintf(\"%v,\", lines[i])\n    }\n\n    output := strings.Join(lines, \"\\n\")\n    err = ioutil.WriteFile(\"files/\"+f.Name()+\"fix\", []byte(output), 0644)\n    if err != nil {\n        log.Fatalln(err)\n    }\n}\n</code></pre>\n\n<p>I assume it is because lines[i] must contain a newline byte at the end of the string.. I have tried to remove it but failed..</p>\n\n<p>The files I load are just json files e.g.</p>\n\n<p>line 1: <code>{ \"foo\":\"bar\",\"baz\":null }</code></p>\n\n<p>line 2: <code>{ \"foo\":\"bar\",\"baz\":\"quz\" }</code></p>\n\n<p>Where I am trying to add a comma to the end of all lines.. any help would be much appreciated</p>\n\n<p>Just to make myself a little more clear, what I get now is:</p>\n\n<pre><code>{ \"foo\":\"bar\",\"baz\":null }\n,\n{ \"foo\":\"bar\",\"baz\":\"quz\" }\n,\n</code></pre>\n\n<p>whereas what I want to get is:</p>\n\n<pre><code>{ \"foo\":\"bar\",\"baz\":null },\n{ \"foo\":\"bar\",\"baz\":\"quz\" },\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1488720243, "post_id": 42608810, "comment_id": 72347183, "body": "There&#39;s something wrong with your go installation. Make sure your source tree is clean and show the environment variables you&#39;ve set."}, {"owner": {"reputation": 1242, "user_id": 1819549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ae42e926dea320c7e66ae30096adf56?s=128&d=identicon&r=PG", "display_name": "windyzboy", "link": "https://stackoverflow.com/users/1819549/windyzboy"}, "edited": false, "score": 0, "creation_date": 1488729189, "post_id": 42608810, "comment_id": 72350114, "body": "Show your go environment with <code>go env</code>"}, {"owner": {"reputation": 21, "user_id": 3354877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/227d8f0e9d9e3c2022a02fcb15f3d034?s=128&d=identicon&r=PG&f=1", "display_name": "yuvalweis", "link": "https://stackoverflow.com/users/3354877/yuvalweis"}, "edited": false, "score": 0, "creation_date": 1488790898, "post_id": 42608810, "comment_id": 72371076, "body": "Never mind guys, I completely removed my GO environment, and re-installed it. Now it works fine. Thanks!"}], "owner": {"reputation": 21, "user_id": 3354877, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/227d8f0e9d9e3c2022a02fcb15f3d034?s=128&d=identicon&r=PG&f=1", "display_name": "yuvalweis", "link": "https://stackoverflow.com/users/3354877/yuvalweis"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1189, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1488719906, "creation_date": 1488719906, "question_id": 42608810, "link": "https://stackoverflow.com/questions/42608810/go-language-import-cycle-not-allowed", "title": "Go language - import cycle not allowed", "body": "<p>I'm struggling with a go environment I was working on, that stopped working.</p>\n\n<p>No matter what I do I get this error:</p>\n\n<pre><code>import cycle not allowed\npackage main\n    imports fmt\n    imports errors\n    imports runtime\n    imports runtime/internal/atomic\n    imports runtime\n</code></pre>\n\n<p>I tried just running simple code, and still not working:</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"aaa\")\n}\n</code></pre>\n\n<p>Any suggestions? I'm clueless</p>\n"}, {"tags": ["json", "go", "encoding", "utf-8"], "comments": [{"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1488719426, "post_id": 42608567, "comment_id": 72346933, "body": "Can you please share <code>Request</code>&#39;s definition ?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488719622, "post_id": 42608567, "comment_id": 72346994, "body": "how are you viewing the decoded values? What does it look like if you just print it out?"}, {"owner": {"reputation": 5524, "user_id": 1898494, "user_type": "registered", "accept_rate": 80, "profile_image": "https://i.stack.imgur.com/lvyaa.jpg?s=128&g=1", "display_name": "Sarath Sadasivan Pillai", "link": "https://stackoverflow.com/users/1898494/sarath-sadasivan-pillai"}, "edited": false, "score": 0, "creation_date": 1488719900, "post_id": 42608567, "comment_id": 72347074, "body": "Can you please add the code with a sample input and your struct <code>Request</code> ? Or playground link"}, {"owner": {"reputation": 5, "user_id": 3333415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeddab81b4db6115b71fcfa6957aa26?s=128&d=identicon&r=PG&f=1", "display_name": "user3333415", "link": "https://stackoverflow.com/users/3333415/user3333415"}, "edited": false, "score": 0, "creation_date": 1488720254, "post_id": 42608567, "comment_id": 72347188, "body": "request looks like: <code>type Request struct { \tFunction string \tArgs     []string \tUserID   string }</code>  and all of values comes from visual studio code"}, {"owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "edited": false, "score": 0, "creation_date": 1488720499, "post_id": 42608567, "comment_id": 72347259, "body": "Does it include field tags ? <code>`json:...`</code>"}, {"owner": {"reputation": 5, "user_id": 3333415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeddab81b4db6115b71fcfa6957aa26?s=128&d=identicon&r=PG&f=1", "display_name": "user3333415", "link": "https://stackoverflow.com/users/3333415/user3333415"}, "edited": false, "score": 0, "creation_date": 1488720911, "post_id": 42608567, "comment_id": 72347411, "body": "no, it is without <code>`json:...`</code> tags. If I add it I get the same result"}, {"owner": {"reputation": 4669, "user_id": 63814, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/607eab54ab44ecd7ebefa443e1925596?s=128&d=identicon&r=PG", "display_name": "MahlerFive", "link": "https://stackoverflow.com/users/63814/mahlerfive"}, "edited": false, "score": 0, "creation_date": 1488735623, "post_id": 42608567, "comment_id": 72352447, "body": "<code>s</code> isn&#39;t valid json since it doesn&#39;t have ending braces"}], "answers": [{"tags": [], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "is_accepted": true, "score": 0, "last_activity_date": 1488773114, "creation_date": 1488773114, "answer_id": 42617351, "question_id": 42608567, "link": "https://stackoverflow.com/questions/42608567/json-decoder-in-go-wrong-decoding-string-in-utf-8/42617351#42617351", "title": "JSON decoder in Go wrong decoding string in UTF-8", "body": "<pre><code>main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"strings\"\n)\n\ntype Request struct {\n    Arg     string\n}\n\nfunc main() {\n    s := \"{\\\"Arg\\\": \\\"z\u00e1\u0159it\\\"}\"\n    r := strings.NewReader(s)\n    d := json.NewDecoder(r)\n\n\n    request := Request{}\n    d.Decode(&amp;request)\n\n    for i := 0; i &lt; len(request.Arg); i++ {\n        char := request.Arg[i]\n        fmt.Print(string(char))\n    }\n\n    //example correct show\n    var tmp []rune\n    for _, x := range request.Arg {\n        fmt.Printf(\"%x : %v : %c\\n\", x,x,x)\n        tmp = append(tmp, rune(x))\n    }\n    fmt.Printf(\"Result output: %v : `%s`\\n\", tmp, string(tmp))\n\n\n    fmt.Println()\n    fmt.Println(request.Arg)\n\n}\n</code></pre>\n\n<p>output</p>\n\n<pre><code>/usr/local/go/bin/go run /home/spouk/go/src/simple/translator\n\n/error_json_code.go\nz\u00c3\u00a1\u00c5it7a : 122 : z\ne1 : 225 : \u00e1\n159 : 345 : \u0159\n69 : 105 : i\n74 : 116 : t\nResult output: [122 225 345 105 116] : `z\u00e1\u0159it`\n\nz\u00e1\u0159it\n\nProcess finished with exit code 0\n</code></pre>\n"}], "owner": {"reputation": 5, "user_id": 3333415, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/feeddab81b4db6115b71fcfa6957aa26?s=128&d=identicon&r=PG&f=1", "display_name": "user3333415", "link": "https://stackoverflow.com/users/3333415/user3333415"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 432, "favorite_count": 0, "accepted_answer_id": 42617351, "answer_count": 1, "score": 0, "last_activity_date": 1488773114, "creation_date": 1488718344, "last_edit_date": 1488744421, "question_id": 42608567, "link": "https://stackoverflow.com/questions/42608567/json-decoder-in-go-wrong-decoding-string-in-utf-8", "title": "JSON decoder in Go wrong decoding string in UTF-8", "body": "<p>I have a problem with json decoder in Go. I have client (dotnet core) and server (go) which are communicate via sockets. Encoding is setted to utf-8. After decoding on server side is not one of string in correct format.</p>\n\n<p>Go decoding code:</p>\n\n<pre><code>buf := make([]byte, bufferSize)\n_, err := conn.Read(buf)\nif err != nil {\n    fmt.Println(\"Error reading:\", err.Error())\n}\n\ns := string(buf[:])\nr := strings.NewReader(s)\nd := json.NewDecoder(r)\n\nrequest := Request{}\nd.Decode(&amp;request)\n</code></pre>\n\n<p>Variable <em>s</em> contains correct string before decoding: <a href=\"https://i.stack.imgur.com/EUYF3.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/EUYF3.png</a> and <em>args</em> contains correct word \"z\u00e1\u0159it\".</p>\n\n<p>After decoding is string broken and contains this:  <a href=\"https://i.stack.imgur.com/Zqan8.png\" rel=\"nofollow noreferrer\">https://i.stack.imgur.com/Zqan8.png</a></p>\n\n<p>I don't understand representation <em>...+2 more</em> from second image and I don't know how to decode this string correct way.</p>\n\n<p><strong>EDIT:</strong></p>\n\n<p>The core of the problem can be reproduced by this code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"encoding/json\"\n    \"strings\"\n)\n\ntype Request struct {\n    Arg     string\n}\n\nfunc main() {\n    s := \"{\\\"Arg\\\": \\\"z\u00e1\u0159it\\\"}\"\n    r := strings.NewReader(s)\n    d := json.NewDecoder(r)\n\n    request := Request{}\n    d.Decode(&amp;request)\n\n    for i := 0; i &lt; len(request.Arg); i++ {\n        char := request.Arg[i]\n        fmt.Print(string(char))\n    }\n    fmt.Println()\n    fmt.Println(request.Arg)\n}\n</code></pre>\n\n<p>Why output is not the same? How I should get the same result?</p>\n"}, {"tags": ["go", "reflection"], "comments": [{"owner": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 0, "creation_date": 1488709290, "post_id": 42607069, "comment_id": 72343901, "body": "Why do you taking pointer of <code>interface{}</code>? <code>arrValue := reflect.ValueOf(arrI)</code> gives me <code>Type: int[]</code>: <a href=\"https://play.golang.org/p/5L1NqItNh1\" rel=\"nofollow noreferrer\">play.golang.org/p/5L1NqItNh1</a>"}, {"owner": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "reply_to_user": {"reputation": 10078, "user_id": 2709018, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/p98Vl.png?s=128&g=1", "display_name": "myaut", "link": "https://stackoverflow.com/users/2709018/myaut"}, "edited": false, "score": 0, "creation_date": 1488710559, "post_id": 42607069, "comment_id": 72344298, "body": "Lets start with this example first: <a href=\"https://play.golang.org/p/Nhabg31Sju\" rel=\"nofollow noreferrer\">play.golang.org/p/Nhabg31Sju</a>. In this example if I don&#39;t pass arr as pointer I get &quot;reflect.Value.Set using unaddressable value&quot; inside appendToSlice method. Now I wanted to generalize this solution. I wanted to pass any slice to this method(ignore the fact that only int is appended). Updated example:  <a href=\"https://play.golang.org/p/WGtfjpW0EN\" rel=\"nofollow noreferrer\">play.golang.org/p/WGtfjpW0EN</a>"}], "answers": [{"comments": [{"owner": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "edited": false, "score": 0, "creation_date": 1488714465, "post_id": 42607968, "comment_id": 72345517, "body": "Original slice is still unaffected.  fmt.Println(arr) //[] <a href=\"https://play.golang.org/p/f6mjuXl0V3\" rel=\"nofollow noreferrer\">play.golang.org/p/f6mjuXl0V3</a>"}, {"owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "reply_to_user": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "edited": false, "score": 0, "creation_date": 1488715385, "post_id": 42607968, "comment_id": 72345811, "body": "It cannot be modified. <code>arrI</code> is a <i>copy</i> of the original slice&#39;s address. Remember that, when you append to a slice, the original slice is not modified, hence the need for an affectation. The only thing you could do is, say, initialize <code>arr := []int{1}</code>, modify that value from <code>arr2</code> and see the modification in <code>arr</code>."}, {"owner": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "edited": false, "score": 0, "creation_date": 1488716307, "post_id": 42607968, "comment_id": 72346034, "body": "Ok. I see now. Thanks."}], "tags": [], "owner": {"reputation": 9718, "user_id": 87584, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/9f6dfb6c18bce2c8487312b77c32dbc3?s=128&d=identicon&r=PG", "display_name": "Fabien", "link": "https://stackoverflow.com/users/87584/fabien"}, "is_accepted": true, "score": 2, "last_activity_date": 1488714190, "creation_date": 1488714190, "answer_id": 42607968, "question_id": 42607069, "link": "https://stackoverflow.com/questions/42607069/go-lang-reflection-how-to-recognize-interface-underlying-type/42607968#42607968", "title": "Go lang reflection how to recognize interface underlying type", "body": "<p>As you have seen, you cannot directly append to the interface. So, you want to get the value associated with the interface and then use it with <code>Value.Append</code>.</p>\n\n<pre><code>arr := []int{}\n\nvar arrI interface{} = arr\n\narrValuePtr := reflect.ValueOf(&amp;arrI)\narrValue := arrValuePtr.Elem()\n\nfmt.Println(\"Type: \", arrValue.Type()) // prints: \"Type: interface{}\nfmt.Println(\"Interface value: \", arrValue.Interface()) // prints: \"Interface value: []\"\nfmt.Println(reflect.ValueOf(arrValue.Interface()))\narr2 := reflect.ValueOf(arrValue.Interface())\narr2 = reflect.Append(arr2, reflect.ValueOf(55))\nfmt.Println(arr2) // [55]\n</code></pre>\n"}], "owner": {"reputation": 249, "user_id": 1635591, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/4ca5dc8daf22479c2b34d786c5d52f64?s=128&d=identicon&r=PG", "display_name": "agnor", "link": "https://stackoverflow.com/users/1635591/agnor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 640, "favorite_count": 0, "accepted_answer_id": 42607968, "answer_count": 1, "score": 1, "last_activity_date": 1488715725, "creation_date": 1488708773, "last_edit_date": 1488715725, "question_id": 42607069, "link": "https://stackoverflow.com/questions/42607069/go-lang-reflection-how-to-recognize-interface-underlying-type", "title": "Go lang reflection how to recognize interface underlying type", "body": "<p>For instance :</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n\n    arr := []int{}\n\n    var arrI interface{} = arr\n\n    arrValuePtr := reflect.ValueOf(&amp;arrI)\n    arrValue := arrValuePtr.Elem()\n\n    fmt.Println(\"Type: \", arrValue.Type()) // prints: \"Type: interface{}\n    fmt.Println(\"Interface value: \", arrValue.Interface()) // prints: \"Interface value: []\"\n\n\n    arrValue.Set(reflect.Append(arrValue, reflect.ValueOf(55))) \n    // error: panic: reflect: call of reflect.Append on interface Value\n}\n</code></pre>\n\n<p>So is there a way to recognize that arrValue is a slice value rather than interface{} value?\n<a href=\"https://play.golang.org/p/R_sPR2JbQx\" rel=\"nofollow noreferrer\">https://play.golang.org/p/R_sPR2JbQx</a></p>\n"}, {"tags": ["go", "swagger"], "comments": [{"owner": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1488716692, "post_id": 42606535, "comment_id": 72346139, "body": "In your swagger spec file, presumably <code>swagger.json</code>, set <code>basePath</code> field to <code>&#47;api&#47;2.0</code>"}, {"owner": {"reputation": 2372, "user_id": 5039582, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2753151bbe8511e6705d432533cef910?s=128&d=identicon&r=PG&f=1", "display_name": "Mandragor", "link": "https://stackoverflow.com/users/5039582/mandragor"}, "reply_to_user": {"reputation": 83665, "user_id": 2998271, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/B7vUA.png?s=128&g=1", "display_name": "har07", "link": "https://stackoverflow.com/users/2998271/har07"}, "edited": false, "score": 0, "creation_date": 1488807334, "post_id": 42606535, "comment_id": 72381702, "body": "@har07  sorry, was to tired, did not see your comment. of course basePath is the static solution. just was searching for doing this by code, in order to avoid to regenerate (tested) code all the time. But if you add it as solution, it is at least 80%"}], "answers": [{"comments": [{"owner": {"reputation": 2372, "user_id": 5039582, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2753151bbe8511e6705d432533cef910?s=128&d=identicon&r=PG&f=1", "display_name": "Mandragor", "link": "https://stackoverflow.com/users/5039582/mandragor"}, "edited": false, "score": 0, "creation_date": 1488792959, "post_id": 42617764, "comment_id": 72372452, "body": "HI Spouk, that gave me inspiration, where to look into. Thanks. But basically what swagger requires, that is what is understand now, is to build a Middleware which does something like http.Handle(&quot;/&quot;, middlewareOne(middlewareTwo(finalHandler)))      .    Found this, but still not a clue <a href=\"https://github.com/go-swagger/go-swagger/blob/master/docs/use/middleware.md\" rel=\"nofollow noreferrer\">github.com/go-swagger/go-swagger/blob/master/docs/use/&hellip;</a>"}], "tags": [], "owner": {"reputation": 590, "user_id": 2128025, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/LXH24.jpg?s=128&g=1", "display_name": "Spouk", "link": "https://stackoverflow.com/users/2128025/spouk"}, "is_accepted": false, "score": 0, "last_activity_date": 1488775906, "creation_date": 1488775906, "answer_id": 42617764, "question_id": 42606535, "link": "https://stackoverflow.com/questions/42606535/how-to-create-a-prefix-route-in-swagger/42617764#42617764", "title": "how to create a prefix route in swagger", "body": "<p>Simple example code. Enjoy. </p>\n\n<pre><code>package main\n\nimport (\n    \"github.com/julienschmidt/httprouter\"\n    \"net/http\"\n    \"log\"\n)\ntype (\n    API interface {\n        Hello(w http.ResponseWriter, r *http.Request)\n        Goodbye(w http.ResponseWriter, r *http.Request)\n    }\n    API2 struct {}\n    API3 struct {}\n)\n\nfunc main() {\n    mux := httprouter.New()\n    mux.GET(\"/api/:version/:command\",API_HANDLER)\n    log.Fatal(http.ListenAndServe(\":8091\", mux))\n}\n//---------------------------------------------------------------------------\n//  HANDLERS\n//---------------------------------------------------------------------------\nfunc API_HANDLER(w http.ResponseWriter, r *http.Request, p httprouter.Params){\n    var hand API\n    switch p.ByName(\"version\") {\n    case \"2.0\": hand = API2{}\n    case \"3.0\": hand = API3{}\n    default: hand = nil\n    }\n    switch p.ByName(\"command\") {\n        case \"hello\": hand.Hello(w,r)\n        case \"goodbye\": hand.Goodbye(w,r)\n    }\n}\n//---------------------------------------------------------------------------\n//  API2 version\n//---------------------------------------------------------------------------\nfunc (a API2) Hello(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"[API2] Hello\"))\n}\nfunc (a API2) Goodbye (w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"[API2] Goodbye\"))\n}\n\n//---------------------------------------------------------------------------\n//  API3 version\n//---------------------------------------------------------------------------\nfunc (a API3) Hello(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"[API3] Hello\"))\n}\nfunc (a API3) Goodbye (w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"[API3] Goodbye\"))\n}\n</code></pre>\n"}], "owner": {"reputation": 2372, "user_id": 5039582, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/2753151bbe8511e6705d432533cef910?s=128&d=identicon&r=PG&f=1", "display_name": "Mandragor", "link": "https://stackoverflow.com/users/5039582/mandragor"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1203, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488801996, "creation_date": 1488705389, "last_edit_date": 1488801996, "question_id": 42606535, "link": "https://stackoverflow.com/questions/42606535/how-to-create-a-prefix-route-in-swagger", "title": "how to create a prefix route in swagger", "body": "<p>Usually the examples provided by swagger setup simple servers, where all the api calls for json functions are on the document root.\ne.g. the famous \"hello world\" sits at \"/hello\"  .</p>\n\n<p>I want to find a way to define a given prefix, so that can put the a specific api under this prefix. if the prefix would be \"/api/2.0\", the example api would become</p>\n\n<pre><code>/hello   --&gt; /api/2.0/hello   # The prefix would be \"/api/2.0\"\n/goodbye --&gt; /api/2.0/goodbye # \n</code></pre>\n\n<p>in the end i want to keep this dynamic and really provide a commandline switch with some</p>\n\n<pre><code>server -prefix '/api/2.0'\n</code></pre>\n\n<p>and the server would use this for the api. Note that i can then also specify no prefix, and the system should fall back to \"/hello\" and \"/goodbye\".</p>\n\n<p>Is this possible with the go-lang implementation of swagger (<a href=\"https://github.com/go-swagger/go-swagger\" rel=\"nofollow noreferrer\">https://github.com/go-swagger/go-swagger</a>) </p>\n\n<p>Can somebody point me to an example / or give a short example?</p>\n\n<p><strong>Addendum</strong>:\nI want to do this basically with a swagger 2.0 interface.\nI learned now that it needs something like this:</p>\n\n<pre><code>http.Handle(\"/\", middlewareOne(middlewareTwo(finalHandler)))\n</code></pre>\n\n<p>Basically the task is to leave the swagger generated \"finalHandler\" untouched (so it thinks still handles \"only\" /hello, or /goodbye). But the middleware would catch all traffic before the finalHandler. The \"/api/2.0\"  would be removed/transformed  (this what i am searching, how???) and the middleware would pass this to the finalhandler, which still believes that it serves /hello. I am not sure if the information that it runs \"/api/2.0\" is ever neeeded, but mabybe it should be added as context.</p>\n\n<p>See\n<a href=\"https://github.com/go-swagger/go-swagger/blob/master/docs/use/middleware.md\" rel=\"nofollow noreferrer\">https://github.com/go-swagger/go-swagger/blob/master/docs/use/middleware.md</a></p>\n\n<p>Quirky solution, which seems to work.</p>\n\n<pre><code>func setupGlobalMiddleware(handler http.Handler) http.Handler {\n  prefix:=\"/api/2.0\"\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    if strings.HasPrefix(r.URL.Path, prefix) {\n       r.URL.Path = r.URL.Path[len(prefix):]\n    }\n    handler.ServeHTTP(w, r)\n  })\n}\n</code></pre>\n\n<p>I would rather prefer if would have access to the \"handlers\" map in the generated code, but it is not accessible. This way i could just \"re-register\" everything with a prefix. Maybe ther is a better solution?</p>\n"}, {"tags": ["go", "goroutine"], "comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488709238, "post_id": 42606049, "comment_id": 72343885, "body": "In Go we have context.Context to create hierarchy of dependent goroutines; see <a href=\"http://stackoverflow.com/questions/42516717/how-to-stop-goroutine/42518866#42518866\" title=\"how to stop goroutine\">stackoverflow.com/questions/42516717/how-to-stop-goroutine/&hellip;</a>"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1488710078, "post_id": 42606049, "comment_id": 72344156, "body": "Why don&#39;t you want to close the channel? It is the simplest way to what you describe, so it would be good to know what other restrictions you have."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488710423, "post_id": 42606049, "comment_id": 72344256, "body": "If you use a single channel, the you are stopping all goroutines in your app. Or if you want use channels for this specific purpose, you have to manage them all manually. And if you just need to stop a portion of active goroutines in your app, how would you do that? Besides, using <code>context.Context</code> is an idiomatic pattern for managing goroutines in Go."}, {"owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "reply_to_user": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1488710572, "post_id": 42606049, "comment_id": 72344306, "body": "@djd: Imagine the caller side is in a loop, after each iteration I need to reuse the channel, how can I reopen the channel?"}, {"owner": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1488761497, "post_id": 42606049, "comment_id": 72360916, "body": "@deepmax: just make a fresh channel for each loop. It&#39;s an inexpensive operation, and you need to do something similar. Basically, with this approach, each unique channel represents a set of goroutines/function calls that will be cancelled at once."}, {"owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "reply_to_user": {"reputation": 4040, "user_id": 457278, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/53932837788d45d6947b7a8e4da90b09?s=128&d=identicon&r=PG", "display_name": "djd", "link": "https://stackoverflow.com/users/457278/djd"}, "edited": false, "score": 0, "creation_date": 1488793170, "post_id": 42606049, "comment_id": 72372616, "body": "@djd: It would be nice if you write an answer using your approach and show me how it works."}], "answers": [{"comments": [{"owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "edited": false, "score": 0, "creation_date": 1488703392, "post_id": 42606195, "comment_id": 72342260, "body": "i think it is ok for variable to be global and not exported for this particular module."}], "tags": [], "owner": {"reputation": 5356, "user_id": 1885921, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/02ba513b62ef9f2f7798b9bac1ccf822?s=128&d=identicon&r=PG", "display_name": "vodolaz095", "link": "https://stackoverflow.com/users/1885921/vodolaz095"}, "is_accepted": false, "score": -1, "last_activity_date": 1488702880, "creation_date": 1488702880, "answer_id": 42606195, "question_id": 42606049, "link": "https://stackoverflow.com/questions/42606049/stop-all-recursive-functions-in-a-goroutine/42606195#42606195", "title": "Stop all recursive functions in a goroutine", "body": "<p>Try to add flag to continue execution, but it can be not thread safe.</p>\n\n<pre><code>var finishIt bool\n\nfunc RecursiveFunc(x int, depth int, quit chan bool) int {\n   if finishIt {\n    return 0\n   }\n//other code here\n}\n\n\n//some code here, but than we decide to stop it\nfinishIt = true\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488710026, "post_id": 42607138, "comment_id": 72344140, "body": "First you have to check for <code>&lt;-ctx.Done()</code> not only at the beginning of <code>RecursiveFunc</code> function, but also inside the <code>for</code> loop. And second, in your <code>main</code> function you have to call <code>wg.Add(1)</code> before lunching the goroutine so there will be no need for the crafted delay (<code>time.Sleep(10 * time.Millisecond)</code>) and also if <code>RecursiveFunc</code> takes less than 10ms, your goroutine will never get lunched and <code>wg.Wait()</code> will return immediately."}, {"owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488710415, "post_id": 42607138, "comment_id": 72344254, "body": "@KavehShahbazian: I agree with your second point, but what&#39;s wrong to let <code>RecursiveFunc</code> inside the <code>for</code> be executed and exits after <code>ctx.Done</code>?"}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488710534, "post_id": 42607138, "comment_id": 72344290, "body": "It just keeps lunching new goroutines even if the context got cancelled at that point, and it shouldn&#39;t."}, {"owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "edited": false, "score": 0, "creation_date": 1488710718, "post_id": 42607138, "comment_id": 72344350, "body": "and after launching, new goroutines will be exited immediately, are you pointing to an optimization or my approach will cause problems?"}, {"owner": {"reputation": 178, "user_id": 5396095, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IDb1FSLNLzk/AAAAAAAAAAI/AAAAAAAAAC0/yy90p8_VuMM/photo.jpg?sz=128", "display_name": "Mohammad Nasirifar", "link": "https://stackoverflow.com/users/5396095/mohammad-nasirifar"}, "reply_to_user": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "edited": false, "score": 0, "creation_date": 1488710902, "post_id": 42607138, "comment_id": 72344416, "body": "@KavehShahbazian I agree but I guess that&#39;s not the question here and I&#39;ll just let the poster figure out and implement the functionality that he&#39;s looking for."}, {"owner": {"reputation": 11590, "user_id": 54467, "user_type": "registered", "accept_rate": 82, "profile_image": "https://i.stack.imgur.com/RnwJd.jpg?s=128&g=1", "display_name": "Kaveh Shahbazian", "link": "https://stackoverflow.com/users/54467/kaveh-shahbazian"}, "reply_to_user": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "edited": false, "score": 0, "creation_date": 1488710961, "post_id": 42607138, "comment_id": 72344441, "body": "@deepmax It depends! :) In your case, cancelling things, would make <code>total</code> an invalid, meaningless, value (because it got interrupted and it&#39;s meaning is not actually &quot;total&quot; anymore). So, yes you are right, they will exit immediately and it&#39;s an optimization. But as I&#39;ve just described, it&#39;s also conceptually correct."}], "tags": [], "owner": {"reputation": 178, "user_id": 5396095, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-IDb1FSLNLzk/AAAAAAAAAAI/AAAAAAAAAC0/yy90p8_VuMM/photo.jpg?sz=128", "display_name": "Mohammad Nasirifar", "link": "https://stackoverflow.com/users/5396095/mohammad-nasirifar"}, "is_accepted": true, "score": 6, "last_activity_date": 1488709324, "creation_date": 1488709324, "answer_id": 42607138, "question_id": 42606049, "link": "https://stackoverflow.com/questions/42606049/stop-all-recursive-functions-in-a-goroutine/42607138#42607138", "title": "Stop all recursive functions in a goroutine", "body": "<p>You can do the what you are going to do using <a href=\"https://golang.org/pkg/context/\" rel=\"noreferrer\">context</a>.</p>\n\n<p>You can pass a <code>context.Context</code> object as the first parameter to the function which you need to stop from outside, and call the corresponding <code>cancel</code> function to send a \"cancellation signal\" to the function, which will cause the <code>Done()</code> channel of the <code>context.Context</code> to be closed, and the called function will thus be notified of the cancellation signal in a <code>select</code> statement.</p>\n\n<p>Here is how the function handles the cancellation signal using <code>context.Context</code>:</p>\n\n<pre><code>func RecursiveFunc(ctx context.Context, x int, depth int) int {\n\n    if depth == 0 {\n        return 1\n    }\n\n    select {\n    case &lt;-ctx.Done():\n        return 0\n    default:\n    }\n\n    total := 0\n\n    for i := 0; i &lt; x; i++ {\n\n        y := RecursiveFunc(ctx, x, depth-1)\n\n        if y &gt; 0 {\n            total += y\n        }\n\n    }\n\n    return total\n}\n</code></pre>\n\n<p>And here is how you can call the function with the new signature:</p>\n\n<pre><code>func main() {\n\n    wg := &amp;sync.WaitGroup{}\n    result := -1\n\n    ctx, cancel := context.WithCancel(context.Background())\n\n    go func() {\n        defer wg.Done()\n        wg.Add(1)\n        result = RecursiveFunc(ctx, 5, 20)\n    }()\n\n    time.Sleep(10 * time.Millisecond)\n\n    cancel()\n\n    wg.Wait()\n\n    fmt.Println(result)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 269, "user_id": 2105489, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2f2de1fca3cddc2162f295dcf528f431?s=128&d=identicon&r=PG", "display_name": "nullgraph", "link": "https://stackoverflow.com/users/2105489/nullgraph"}, "is_accepted": false, "score": 0, "last_activity_date": 1614704540, "creation_date": 1614704540, "answer_id": 66443829, "question_id": 42606049, "link": "https://stackoverflow.com/questions/42606049/stop-all-recursive-functions-in-a-goroutine/66443829#66443829", "title": "Stop all recursive functions in a goroutine", "body": "<p>I was in a similar situation recently and like your case, the quit signal was consumed by one of the recursion branch leaving the other branches without a signal. I solved this by forwarding the stop signal to the channel before returning from the function.</p>\n<p>For example, you can modify the select inside the recursive function to be:</p>\n<pre><code>if quit != nil {\n    select {\n    case &lt;-quit:\n        quit &lt;- true // forward the signal\n        return 0\n    default:\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 51244, "user_id": 952747, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/86ebf3cf751f63acb38e763f7104a318?s=128&d=identicon&r=PG&f=1", "display_name": "masoud", "link": "https://stackoverflow.com/users/952747/masoud"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 906, "favorite_count": 1, "accepted_answer_id": 42607138, "answer_count": 3, "score": 4, "last_activity_date": 1614704540, "creation_date": 1488701688, "last_edit_date": 1488724765, "question_id": 42606049, "link": "https://stackoverflow.com/questions/42606049/stop-all-recursive-functions-in-a-goroutine", "title": "Stop all recursive functions in a goroutine", "body": "<p>Staring a goroutine which runs a recursive function, I want to send a signal to stop those recursive functions. This is the function (the functionality is not important):</p>\n\n<pre><code>func RecursiveFunc(x int, depth int, quit chan bool) int {\n\n    if depth == 0 {\n        return 1\n    }\n\n    if quit != nil {\n        select {\n        case &lt;-quit:\n            return 0\n        default:\n        }\n    }\n\n    total := 0\n\n    for i := 0; i &lt; x; i++ {\n\n        y := RecursiveFunc(x, depth - 1, quit)\n\n        if y &gt; 0 {\n            total += y\n        }\n\n    }\n\n    return total\n}\n</code></pre>\n\n<p>This function may take a long time to be done and I want stop it after sending a quit signal and use the result (whatever it is). To run it:</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"time\"\n    \"sync\"\n)\n\nfunc main() {\n\n    quit := make(chan bool)\n    wg := &amp;sync.WaitGroup{}\n    result := -1\n\n    go func() {\n        defer wg.Done()\n        wg.Add(1)\n        result = RecursiveFunc(5, 20, quit)\n    }()\n\n    time.Sleep(10 * time.Millisecond)\n\n    close(quit) // Using `quit &lt;- true` doesn't work\n\n    wg.Wait()\n\n    fmt.Println(result)\n}\n</code></pre>\n\n<p>To stop the goroutine, I'm using a channel say <code>quit</code> and after closing it, the program works well, however I don't want really close the channel and I want just send a signal <code>quit &lt;- true</code>. However, <code>quit &lt;- true</code> doesn't work and I probably quits only one instance of recursion.</p>\n\n<p>How can I stop all instances of recursive function by sending a quit signal?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 3, "last_activity_date": 1488739467, "creation_date": 1488739467, "answer_id": 42612448, "question_id": 42605649, "link": "https://stackoverflow.com/questions/42605649/golang-gorilla-mux-and-testing-where-to-store-routes/42612448#42612448", "title": "golang gorilla/mux and testing, where to store routes", "body": "<p>You could use a factory function to create a new <code>http.Handler</code> for you application. This would allow you to programmatically define the handlers and reuse them in the tests. </p>\n\n<pre><code>// NewApplicationHandler provides a configured handler for the\n// application.\nfunc NewApplicationHandler() http.Handler {\n    mux := mux.NewRouter()\n    mux.HandleFunc(\"/\", handler)\n\n    return mux\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello World!\"))\n}\n</code></pre>\n\n<p>This example would be utilized in a test like so:</p>\n\n<pre><code>func TestApplicationServeMux(t *testing.T) {\n    // The handlers are being obtained via a call to the factory function.\n    applicationHandler := NewApplicationHandler()\n\n    ts := httptest.NewServer(applicationHandler)\n    defer ts.Close()\n\n    res, err := http.Get(ts.URL)\n\n    if err != nil {\n        t.Fatalf(\"%s\", err)\n    }\n\n    defer res.Body.Close()\n    greeting, err := ioutil.ReadAll(res.Body)\n\n    if err != nil {\n        log.Fatalf(\"%s\", err)\n    }\n\n    want := []byte(\"Hello World!\")\n\n    if !bytes.Equal(want, greeting) {\n        t.Errorf(\"Expected greeting %s; got %s\", want, greeting)\n    }\n\n}\n</code></pre>\n"}], "owner": {"reputation": 7540, "user_id": 4400804, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/ae6154c51ff5832ca23eb2ca5fb18aef?s=128&d=identicon&r=PG&f=1", "display_name": "deltaskelta", "link": "https://stackoverflow.com/users/4400804/deltaskelta"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 666, "favorite_count": 1, "accepted_answer_id": 42612448, "answer_count": 1, "score": 0, "last_activity_date": 1488739467, "creation_date": 1488698513, "question_id": 42605649, "link": "https://stackoverflow.com/questions/42605649/golang-gorilla-mux-and-testing-where-to-store-routes", "title": "golang gorilla/mux and testing, where to store routes", "body": "<p>In most of the docs I have seen, gorilla mux is suggested to be used like so...</p>\n\n<pre><code>func main() {\n    m := mux.Router()\n    m.HandleFunc(\"/\", FuncNameOrDef)\n    http.ListenAndServe(\":8080\", m)\n}\n</code></pre>\n\n<p>which is great, but it leaves me with a problem, because then in order to test, as far as I can see, I need to redeclare mux and routes unless I declare mux and routes outside of a function like this...</p>\n\n<pre><code>var (\n    m = mux.Router()\n    _ = m.HandleFunc(\"/\", FuncNameOrDef)\n)\n</code></pre>\n\n<p>and then in my tests do this...</p>\n\n<pre><code>func TestSomeView(t *testing.T) {\n    ts := httptest.NewServer(m)\n    ....testing blah\n}\n</code></pre>\n\n<p>which solves the problem, but then it makes the package pretty ugly (with all the <code>_ = m.HandleFunc</code>'s) Is there a more idiomatic way to do this? </p>\n"}, {"tags": ["go", "concurrency", "goroutine"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 6, "creation_date": 1488706394, "post_id": 42605558, "comment_id": 72343112, "body": "Your code is neither self-contained (e.g. sizedwaitgroup is missing) nor a minimal example. And you could provide the actual error."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1488779800, "post_id": 42605558, "comment_id": 72365604, "body": "Races <i>are</i> errors-"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1488918067, "post_id": 42605558, "comment_id": 72441006, "body": "Offering a bounty is nice, but if you want answers, you should first comply with the comments posted here. First, provide a <a href=\"http://stackoverflow.com/help/mcve\">Minimal, Complete, and Verifiable example</a>. And make that example your most recent, up-to-date code, as you claim you&#39;ve made several changes to your code, yet I don&#39;t see them reflected in the code you&#39;ve posted in the question."}], "answers": [{"comments": [{"owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "edited": false, "score": 0, "creation_date": 1488725967, "post_id": 42607238, "comment_id": 72349049, "body": "ok, so I added a buffer of 5000 to the channel and looped through the channel in my main() method and it&#39;s still hanging"}, {"owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "edited": false, "score": 0, "creation_date": 1488726452, "post_id": 42607238, "comment_id": 72349207, "body": "so I fixed it by passing sizedwaitgroup as a reference but when I remove the buffer it doesn&#39;t work does that mean that I need to know how many elements will be sent to the channel in advance?"}], "tags": [], "owner": {"reputation": 542, "user_id": 178442, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/377cef4245e0fcbf76e021d9cd253e35?s=128&d=identicon&r=PG", "display_name": "Colin Stewart", "link": "https://stackoverflow.com/users/178442/colin-stewart"}, "is_accepted": false, "score": 1, "last_activity_date": 1488709947, "creation_date": 1488709947, "answer_id": 42607238, "question_id": 42605558, "link": "https://stackoverflow.com/questions/42605558/why-is-my-code-causing-a-stall-or-race-condition/42607238#42607238", "title": "Why is my code causing a stall or race condition?", "body": "<p>Your channel has no buffer, so writes will block until the value can be read, and at least in the code you have posted, there are no readers.</p>\n"}, {"tags": [], "owner": {"reputation": 4649, "user_id": 681679, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ba1bdfa6ba08225903a74383be42b06?s=128&d=identicon&r=PG", "display_name": "photoionized", "link": "https://stackoverflow.com/users/681679/photoionized"}, "is_accepted": true, "score": 5, "last_activity_date": 1488922067, "creation_date": 1488922067, "answer_id": 42658675, "question_id": 42605558, "link": "https://stackoverflow.com/questions/42605558/why-is-my-code-causing-a-stall-or-race-condition/42658675#42658675", "title": "Why is my code causing a stall or race condition?", "body": "<h1>Issue</h1>\n\n<p>Building off of Colin Stewart's answer, from the code you have posted, as far as I can tell, your issue is actually with reading your <code>arrChan</code>. You write into it, but there's no place where you read from it in your code.</p>\n\n<p>From <a href=\"http://golang.org/doc/effective_go.html#channels\" rel=\"noreferrer\">the documentation</a> :</p>\n\n<blockquote>\n  <p>If the channel is unbuffered, the sender blocks until the receiver has received the value. If the channel has a buffer, the sender blocks only until the value\n  has been copied to the buffer; if the buffer is full, this means\n  waiting until some receiver has retrieved a value.</p>\n</blockquote>\n\n<p>By making the channel buffered, what's happening is your code is no longer blocking on the channel write operations, the line that looks like:</p>\n\n<pre><code>c &lt;- fmt.Sprint(\"%s%s%s%s\",name,address,phoneNumber,website)\n</code></pre>\n\n<p>My guess is that if you're still hanging at when the channel has a size of 5000, it's because you have more than 5000 values returned across all of your loops over <code>node.Nodes</code>. Once your buffered channel is full, the operations block until the channel has space, just like if you were writing to an unbuffered channel.</p>\n\n<h1>Fix</h1>\n\n<p>Here's a minimal example showing you how you would fix something like this (basically just add a reader)</p>\n\n<pre><code>package main\n\nimport \"sync\"\n\nfunc getPage(item string, c chan&lt;- string) {\n    c &lt;- item\n}\n\nfunc readChannel(c &lt;-chan string) {\n    for {\n        &lt;-c\n    }\n}\n\nfunc main() {\n    arrChan := make(chan string)\n    wg := sync.WaitGroup{}\n    zips := []string{\"78705\", \"78710\", \"78715\"}\n\n    for _, item := range zips {\n        wg.Add(1)\n        go func() {\n            defer wg.Done()\n            getPage(item, arrChan)\n        }()\n    }\n    go readChannel(arrChan) // comment this out and you'll deadlock\n    wg.Wait()\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1980, "user_id": 6375498, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/51ade4f86c3426c9f67f1a54b270b398?s=128&d=identicon&r=PG&f=1", "display_name": "Seva", "link": "https://stackoverflow.com/users/6375498/seva"}, "is_accepted": false, "score": 1, "last_activity_date": 1489183802, "creation_date": 1489183802, "answer_id": 42728538, "question_id": 42605558, "link": "https://stackoverflow.com/questions/42605558/why-is-my-code-causing-a-stall-or-race-condition/42728538#42728538", "title": "Why is my code causing a stall or race condition?", "body": "<p>You don't need to know size to make it work. But you might in order to exit cleanly. Which can be a bit tricky to observe at time because your program will exit once your main function exits and all goroutines still running are killed immediately finished or not.</p>\n\n<p>As a warm up example, change readChannel in photoionized's response to this:</p>\n\n<pre><code>func readChannel(c &lt;-chan string) {\n  for {\n      url := &lt;-c\n      fmt.Println (url)\n  }\n}\n</code></pre>\n\n<p>It only adds printing to the original code. But now you'll see better what is actually happening. Notice how it usually only prints two strings when code actually writes 3. This is because code exits once all writing goroutines finish, but reading goroutine is aborted mid way as result. You can \"fix\" it by removing \"go\" before readChannel (which would be same as reading the channel in main function). And then you'll see 3 strings printed, but program crashes with a dead lock as readChannel is still reading from the channel, but nobody writes into it anymore. You can fix that too by reading exactly 3 strings in readChannel(), but that requires knowing how many strings you expect to receive.</p>\n\n<p>Here is my minimal working example (I'll use it to illustrate the rest):</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync\"\n) \n\nfunc getPage(url string, c chan&lt;- string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    c &lt;- fmt.Sprintf(\"Got page for %s\\n\",url)\n}\n\n\nfunc readChannel(c chan string, wg *sync.WaitGroup) {\n    defer wg.Done()\n    var url string\n    ok := true\n    for ok {\n        url, ok = &lt;- c\n        if ok {\n            fmt.Printf(\"Received: %s\\n\", url)\n        } else {\n            fmt.Println(\"Exiting readChannel\")\n        }\n    }\n}\n\nfunc main() {\n    arrChan := make(chan string)\n    var swg sync.WaitGroup\n    base_url := \"http://test/%s/%d\"\n    zips := []string{\"78705\",\"78710\",\"78715\"}\n\n    for _, item := range zips{\n        swg.Add(1)\n        go getPage(fmt.Sprintf(base_url,item,1),arrChan,&amp;swg)\n    }\n\n    var wg2 sync.WaitGroup\n    wg2.Add(1)\n    go readChannel(arrChan, &amp;wg2)\n\n    swg.Wait()\n\n    // All written, signal end to readChannel by closing the channel \n    close(arrChan)\n    wg2.Wait()\n}\n</code></pre>\n\n<p>Here I close the channel to signal to readChannel that there is nothing left to read, so it can exit cleanly at proper time. But sometimes you might want instead to tell readChannel to read exactly 3 strings and finish. Or may be you would want to start one reader for each writer and each reader will read exactly one string... Well, there are many ways to skin a cat and choice is all yours.</p>\n\n<p>Note, if you remove wg2.Wait() line your code becomes equivalent to photoionized's response and will only print two strings whilst writing 3. This is because code exits once all writers finish (ensured by swg.Wait()), but it does not wait for readChannel to finish.</p>\n\n<p>If you remove close(arrChan) line instead, your code will crash with a deadlock after printing 3 lines as code waits for readChannel to finish, but readChannel waits to read from a channel which nobody is writing to anymore.</p>\n\n<p>If you just remove \"go\" before the readChannel call, it becomes equivalent of reading from channel inside main function. It will again crash with a dead lock after printing 3 strings because readChannel is still reading when all writers have already finished (and readChannel has already read all they written). A tricky point here is that swg.Wait() line will never be reached by this code as readChannel never exits.</p>\n\n<p>If you move readChannel call <em>after</em> the swg.Wait() then code will crash before even printing a single string. But this is a different dead lock. This time code reaches swg.Wait() and stops there waiting for writers. First writer succeeds, but channel is not buffered, so next writer blocks until someone reads from the channel the data already written. Trouble is - nobody reads from the channel yet as readChannel has not been called yet. So, it stalls and crashes with a dead lock. This particular issue can be \"fixed\", but making channel buffered as in <code>make(chan string, 3)</code> as that will allow writers to keep writing even though nobody is reading from that channel yet. And sometimes this is what you want. But here again you have to know the maximum of messages to ever be in the channel buffer. And most of the time it's only deferring a problem - just add one more writer and you are where you started - code stalls and crashes as channel buffer is full and that one extra writer is waiting for someone to read from the buffer.</p>\n\n<p>Well, this should covers all bases. So, check your code and see which case is yours.</p>\n"}], "owner": {"reputation": 1044, "user_id": 2640586, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/3cd3f696c7c9e654d9f9d4d357d432ed?s=128&d=identicon&r=PG", "display_name": "Evan Mosseri", "link": "https://stackoverflow.com/users/2640586/evan-mosseri"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 395, "favorite_count": 0, "accepted_answer_id": 42658675, "answer_count": 3, "score": 0, "last_activity_date": 1489183802, "creation_date": 1488697761, "last_edit_date": 1488908294, "question_id": 42605558, "link": "https://stackoverflow.com/questions/42605558/why-is-my-code-causing-a-stall-or-race-condition", "title": "Why is my code causing a stall or race condition?", "body": "<p>For some reason, once I started adding strings through a channel in my goroutine, the code stalls when I run it. I thought that it was a scope/closure issue so I moved all code directly into the function to no avail. I have looked through Golang's documentation and all examples look similar to mine so I am kind of clueless as to what is going wrong.</p>\n\n<pre><code>func getPage(url string, c chan&lt;- string, swg sizedwaitgroup.SizedWaitGroup) {\n    defer swg.Done()\n    doc, err := goquery.NewDocument(url)\n\n    if err != nil{\n        fmt.Println(err)\n    }\n\n    nodes := doc.Find(\".v-card .info\")\n    for i := range nodes.Nodes {\n        el := nodes.Eq(i)\n        var name string\n        if el.Find(\"h3.n span\").Size() != 0{\n            name = el.Find(\"h3.n span\").Text()\n        }else if el.Find(\"h3.n\").Size() != 0{\n            name = el.Find(\"h3.n\").Text()\n        }\n\n        address := el.Find(\".adr\").Text()\n        phoneNumber := el.Find(\".phone.primary\").Text()\n        website, _ := el.Find(\".track-visit-website\").Attr(\"href\")\n        //c &lt;- map[string] string{\"name\":name,\"address\":address,\"Phone Number\": phoneNumber,\"website\": website,};\n        c &lt;- fmt.Sprint(\"%s%s%s%s\",name,address,phoneNumber,website)\n        fmt.Println([]string{name,address,phoneNumber,website,})\n\n    }\n}\n\nfunc getNumPages(url string) int{\n    doc, err := goquery.NewDocument(url)\n    if err != nil{\n        fmt.Println(err);\n    }\n    pagination := strings.Split(doc.Find(\".pagination p\").Contents().Eq(1).Text(),\" \")\n    numItems, _ := strconv.Atoi(pagination[len(pagination)-1])\n    return int(math.Ceil(float64(numItems)/30))\n}\n\n\nfunc main() {\n    arrChan := make(chan string)\n    swg := sizedwaitgroup.New(8)\n    zips := []string{\"78705\",\"78710\",\"78715\"}\n\n    for _, item := range zips{\n        swg.Add()\n        go getPage(fmt.Sprintf(base_url,item,1),arrChan,swg)\n    }\n    swg.Wait()\n\n}\n</code></pre>\n\n<p>Edit:\nso I fixed it by passing sizedwaitgroup as a reference but when I remove the buffer it doesn't work does that mean that I need to know how many elements will be sent to the channel in advance?</p>\n"}, {"tags": ["go", "time", "types", "type-conversion", "constants"], "answers": [{"comments": [{"owner": {"reputation": 1172, "user_id": 4621508, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/7edbd50ad77354c926f108838b77b938?s=128&d=identicon&r=PG&f=1", "display_name": "rumdrums", "link": "https://stackoverflow.com/users/4621508/rumdrums"}, "edited": false, "score": 0, "creation_date": 1488750121, "post_id": 42606191, "comment_id": 72357686, "body": "Thanks very much for the the detailed answer and links to further reading. I learned a lot from this!"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1488704472, "last_edit_date": 1495540462, "creation_date": 1488702856, "answer_id": 42606191, "question_id": 42605412, "link": "https://stackoverflow.com/questions/42605412/sleeping-by-fractions-of-a-time-duration/42606191#42606191", "title": "Sleeping by Fractions of a Time Duration", "body": "<p>This line:</p>\n\n<pre><code>s := time.Hour/73.0\n</code></pre>\n\n<p>Is a <a href=\"https://golang.org/ref/spec#Short_variable_declarations\" rel=\"nofollow noreferrer\">short variable declaration</a>, where the right hand side expression is: <code>time.Hour / 73.0</code>. <code>time.Hour</code> is a typed constant from the <a href=\"https://golang.org/pkg/time/\" rel=\"nofollow noreferrer\"><code>time</code></a> package, its type is <a href=\"https://golang.org/pkg/time/#Duration\" rel=\"nofollow noreferrer\"><code>time.Duration</code></a>; and <code>73.0</code> is an <em>untyped numeric constant</em> which when used in an expression, will take the appropriate type if possible. Since <code>time.Duration</code> has <code>int64</code> as its underlying type, the constant <code>73.0</code> can be converted to <code>time.Duration</code> without loss of precision, so that will happen, and the constant expression <code>time.Hour / time.Duration(73.0)</code> will be executed.</p>\n\n<p>The other line:</p>\n\n<pre><code>d := 73.0\ns := time.Hour/d\n</code></pre>\n\n<p>The first line is a short variable declaration, where the type of <code>d</code> will be inferred from the right hand side expression, which is an untyped numeric constant (given with a <a href=\"https://golang.org/ref/spec#Floating-point_literals\" rel=\"nofollow noreferrer\">floating point literal</a> to be exact). Since a type is needed, its default type will be used, which is <code>float64</code>. So <code>d</code> will be a variable of type <code>float64</code>.</p>\n\n<p>The short variable declaration in the next line: <code>time.Hour / d</code>, here <code>time.Hour</code> is again a value of type <code>time.Duration</code>, but you attempt to divide it by a value of type <code>float64</code>, that is not allowed in Go.</p>\n\n<p>To make it work, you have to explicitly convert <code>d</code> to <code>time.Duration</code>:</p>\n\n<pre><code>s := time.Hour / time.Duration(d)\n</code></pre>\n\n<p>Or <code>d</code> must be of type <code>time.Duration</code>:</p>\n\n<pre><code>d := time.Duration(73.0)\ns := time.Hour / d\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>var d time.Duration = 73.0\ns := time.Hour / d\n</code></pre>\n\n<p>These wouldn't work if the value cannot be represented with <code>time.Duration</code>, for example <code>73.5</code> (because <code>time.Duration</code> has <code>int64</code> underlying type). In this case you have to convert <code>time.Hour</code> to <code>float64</code>, perform the division and convert the result to <code>time.Duration</code>, e.g.:</p>\n\n<pre><code>d := 73.5\ns := time.Duration(float64(time.Hour) / d)\n</code></pre>\n\n<p>Read more details on the topic:</p>\n\n<p><a href=\"https://golang.org/ref/spec#Constants\" rel=\"nofollow noreferrer\">Spec: Constants</a></p>\n\n<p><a href=\"https://blog.golang.org/constants\" rel=\"nofollow noreferrer\">The Go Blog: Constants</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/42153747/why-does-0-1-0-2-get-0-3-in-google-go/42154298#42154298\">Why does 0.1 + 0.2 get 0.3 in Google Go?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/38982278/how-does-go-perform-arithmetic-on-constants/38982889#38982889\">How does Go perform arithmetic on constants?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/36052922/golang-converting-float64-to-int-error/36055172#36055172\">Golang converting float64 to int error</a></p>\n"}], "owner": {"reputation": 1172, "user_id": 4621508, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/7edbd50ad77354c926f108838b77b938?s=128&d=identicon&r=PG&f=1", "display_name": "rumdrums", "link": "https://stackoverflow.com/users/4621508/rumdrums"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 913, "favorite_count": 0, "accepted_answer_id": 42606191, "answer_count": 1, "score": 2, "last_activity_date": 1490087669, "creation_date": 1488696713, "last_edit_date": 1490087669, "question_id": 42605412, "link": "https://stackoverflow.com/questions/42605412/sleeping-by-fractions-of-a-time-duration", "title": "Sleeping by Fractions of a Time Duration", "body": "<p>Can someone tell me why this works:</p>\n\n<pre><code>s := time.Hour/73.0\nfmt.Println(\"sleeping: \", s)\ntime.Sleep(s)\n</code></pre>\n\n<p>But this fails:</p>\n\n<pre><code>d := 73.0\ns := time.Hour/d\nfmt.Println(\"sleeping: \", s)\ntime.Sleep(s)\n</code></pre>\n\n<p>This is the error:</p>\n\n<pre><code>invalid operation: time.Hour / d (mismatched types time.Duration and float64)\n</code></pre>\n"}, {"tags": ["templates", "go", "go-templates"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1488704231, "last_edit_date": 1495539967, "creation_date": 1488701986, "answer_id": 42606082, "question_id": 42605373, "link": "https://stackoverflow.com/questions/42605373/telling-golang-which-template-to-execute-first/42606082#42606082", "title": "Telling Golang which template to execute first", "body": "<p>Know that a <a href=\"https://golang.org/pkg/html/template/#Template\" rel=\"nofollow noreferrer\"><code>template.Template</code></a> may be (usually is) a collection of multiple templates. The template contains a map of the associated templates. When using <a href=\"https://golang.org/pkg/html/template/#ParseFiles\" rel=\"nofollow noreferrer\"><code>template.ParseFiles()</code></a> or <a href=\"https://golang.org/pkg/html/template/#ParseGlob\" rel=\"nofollow noreferrer\"><code>template.ParseGlob()</code></a>, the returned <code>template.Template</code> will designate the first template that was parsed (from the multiple files). You can read more about this here: <a href=\"https://stackoverflow.com/questions/41176355/go-template-name/41187671#41187671\">Go template name</a></p>\n\n<p>Instead of using <a href=\"https://golang.org/pkg/html/template/#Template.Execute\" rel=\"nofollow noreferrer\"><code>Template.Execute()</code></a> (which \u2013based on the above\u2013 will execute the first parsed template) use the <a href=\"https://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow noreferrer\"><code>Template.ExecuteTemplate()</code></a> method where you can specify which template you want to execute, specified by its name:</p>\n\n<pre><code>err := templates.ExecuteTemplate(w, \"main.html\", data)\n</code></pre>\n\n<p>This will execute the template named <code>\"main.html\"</code> no matter in what order the template files were parsed (or later added to the template collection).</p>\n"}], "owner": {"reputation": 261, "user_id": 5962051, "user_type": "registered", "accept_rate": 0, "profile_image": "https://www.gravatar.com/avatar/d50182a3391b7a36822a1a6c81beca57?s=128&d=identicon&r=PG&f=1", "display_name": "KaffeeKaethe", "link": "https://stackoverflow.com/users/5962051/kaffeekaethe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 500, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488704231, "creation_date": 1488696396, "question_id": 42605373, "link": "https://stackoverflow.com/questions/42605373/telling-golang-which-template-to-execute-first", "title": "Telling Golang which template to execute first", "body": "<p>I have a folder with different templates in golang. The main template is <em>main.html</em> and there is also a <em>footer.html</em> and <em>header.html</em>. Footer and Header are loaded with </p>\n\n<pre><code>{{template \"footer.html\" .}} \n</code></pre>\n\n<p>in <em>main.html</em>.</p>\n\n<p>I am using this to parse the files</p>\n\n<pre><code>templates, _ := template.ParseGlob(\"Templates/\" + template_name + \"/*.html\")\n</code></pre>\n\n<p>because there are other directories with different file names used aswell. So I don't want to use <em>parseFiles</em>.</p>\n\n<p>However, the template that is displayed is always the first one in alphabetical order, e.g. <em>footer.html</em>. If I rename <em>main.html</em> to <em>a.html</em> the template gets displayed the way I want it to (so loading the main template and executing footer and header inside of it).</p>\n\n<p>I couldn't find any documentation how to tell golang which template to use first. Is there a way to do that?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 2821, "user_id": 19547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc32d27026065e5855c1d5196d29f3f?s=128&d=identicon&r=PG", "display_name": "keno", "link": "https://stackoverflow.com/users/19547/keno"}, "edited": false, "score": 0, "creation_date": 1488699198, "post_id": 42605337, "comment_id": 72341246, "body": "Refer to <a href=\"http://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i\" title=\"why do i get a cannot assign error when setting value to a struct as a value i\">stackoverflow.com/questions/32751537/&hellip;</a>"}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 2821, "user_id": 19547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/acc32d27026065e5855c1d5196d29f3f?s=128&d=identicon&r=PG", "display_name": "keno", "link": "https://stackoverflow.com/users/19547/keno"}, "edited": false, "score": 0, "creation_date": 1488701165, "post_id": 42605337, "comment_id": 72341726, "body": "@keno, thanks for ur response, finally I figured out the reason why after I already use pointer it still cannot work, it is because I did <code>snapshots := make(map[string] Snapshot, 1)</code>, then i think the <code>len(snapshots)</code> will be 1, later I initialized the map with one for loop, which used the value <code>len(snapshots)</code>,.... so that mean the initialization process never get run....  then after i used pointer, i get this error: <code>panic: runtime error: invalid memory address or nil pointer dereference [signal SIGSEGV: segmentation violation code=0x1 addr=0x78 pc=0x427bb9d]</code>"}], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 3, "creation_date": 1488716359, "post_id": 42606051, "comment_id": 72346049, "body": "The second <code>make</code> argument for a map is capacity, not length, and is very rarely used."}, {"owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488769951, "post_id": 42606051, "comment_id": 72362776, "body": "I just simply thought it is like slice <code>make(type, len, cap)</code>"}], "tags": [], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "is_accepted": true, "score": 12, "last_activity_date": 1584239529, "last_edit_date": 1584239529, "creation_date": 1488701722, "answer_id": 42606051, "question_id": 42605337, "link": "https://stackoverflow.com/questions/42605337/cannot-assign-to-struct-field-in-a-map/42606051#42606051", "title": "Cannot assign to struct field in a map", "body": "<p>First, for this question, the solution in this post <a href=\"https://stackoverflow.com/questions/32751537/why-do-i-get-a-cannot-assign-error-when-setting-value-to-a-struct-as-a-value-i\">Why do I get a &quot;cannot assign&quot; error when setting value to a struct as a value in a map?</a> works perfectly fine.</p>\n\n<p>Then, finally figured out why after I already changed to use pointer my case still doesn't work, refer to the below very simple code:</p>\n\n<pre><code>a := make([]int, 3)\nfmt.Println(len(a))\n\nb := make(map[string]string, 3)\nfmt.Println(len(b))\n</code></pre>\n\n<p>What do think the output will be? I simply thought it is all would be: <code>3</code>, but actually for the map, the output will be <code>0</code></p>\n\n<p>Then later in the map initialization process, i used a for loop and with this value <code>len(snapshots)</code>, that means the initialization process will never get run...</p>\n\n<p>Yea, that is the reason.</p>\n"}, {"tags": [], "owner": {"reputation": 173, "user_id": 5377850, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jv1yt.jpg?s=128&g=1", "display_name": "Devyzr", "link": "https://stackoverflow.com/users/5377850/devyzr"}, "is_accepted": false, "score": 1, "last_activity_date": 1544925493, "creation_date": 1544925493, "answer_id": 53798828, "question_id": 42605337, "link": "https://stackoverflow.com/questions/42605337/cannot-assign-to-struct-field-in-a-map/53798828#53798828", "title": "Cannot assign to struct field in a map", "body": "<p>What I ended up doing to use my struct map in a loop was the following:</p>\n\n<pre><code>type testStruct struct {\n  a string\n  b int\n}\n\nfunc main() {\n  mapTest := make(map[string]testStruct)\n  abc := [3]string{\"a\", \"b\", \"c\"}\n\n  for i := 0; i &lt; len(abc); i++ {\n    var temp testStruct\n    temp.a = abc[i]\n    temp.b = i\n    mapTest[abc[i]] = temp\n  }\n\n  fmt.Println(mapTest)\n}\n</code></pre>\n\n<p>Output should be:</p>\n\n<pre><code>map[b:{b 1} c:{c 2} a:{a 0}]\n</code></pre>\n\n<p>It's not appending, but should work to assign multiple values to a struct map, alternatively you could do the following and allow the map to reference its own values:</p>\n\n<pre><code>func main() {\n  mapTest := make(map[string]testStruct)\n\n  abc := [3]string{\"a\", \"b\", \"c\"}\n  for i := 0; i &lt; len(abc)*2; i++ {\n    temp := mapTest[abc[i%3]]\n    temp.a = abc[i%3]\n    temp.b = temp.b + i\n    mapTest[abc[i%3]] = temp\n  }\n\n  fmt.Println(mapTest)\n}\n</code></pre>\n\n<p>Which should output:</p>\n\n<pre><code>map[a:{a 3} b:{b 5} c:{c 7}]\n</code></pre>\n\n<p>Note that no errors are raised when we reference an empty struct value, this is because when we initialize our struct, its values start out as empty values but not nil (<code>0</code> for int, <code>\"\"</code> for string, etc.)</p>\n"}], "owner": {"reputation": 1408, "user_id": 7658313, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d71486222cefe1935ac81e02fc0f2f51?s=128&d=identicon&r=PG", "display_name": "lnshi", "link": "https://stackoverflow.com/users/7658313/lnshi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 51113, "favorite_count": 9, "accepted_answer_id": 42606051, "answer_count": 2, "score": 42, "last_activity_date": 1584239529, "creation_date": 1488696139, "last_edit_date": 1553820812, "question_id": 42605337, "link": "https://stackoverflow.com/questions/42605337/cannot-assign-to-struct-field-in-a-map", "title": "Cannot assign to struct field in a map", "body": "<p>I have the data structure like this:</p>\n\n<pre><code>type Snapshot struct {\n  Key   string\n  Users []Users\n}\n\nsnapshots := make(map[string] Snapshot, 1)\n\n// then did the initialization\nsnapshots[\"test\"] = Snapshot {\n  Key: \"testVal\",\n  Users: make([]Users, 0),\n}\n</code></pre>\n\n<p><code>Users</code> is another struct.</p>\n\n<p>Then when I tried to append some new <code>Users</code> values in the Users slice like this:</p>\n\n<pre><code>snapshots[\"test\"].Users = append(snapshots[\"test\"].Users, user)\n</code></pre>\n\n<p>I kept getting this error:</p>\n\n<pre class=\"lang-none prettyprint-override\"><code>cannot assign to struct field snapshots[\"test\"].Users in map\n</code></pre>\n\n<p>Also tried the workaround here <a href=\"https://github.com/golang/go/issues/3117\" rel=\"noreferrer\">https://github.com/golang/go/issues/3117</a> so like this:</p>\n\n<pre><code>tmp := snapshots[\"test\"].Users\ntmp = append(tmp, user)\nsnapshots[\"test\"].Users = tmp\n</code></pre>\n\n<p>But no luck, still exactly same error.</p>\n\n<p>And also tried to declare the map with pointer, so: <code>snapshots := make(map[string] *Snapshot, 1)</code>, still no luck.</p>\n"}, {"tags": ["go", "terminal", "pipe", "stdin"], "answers": [{"comments": [{"owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "edited": false, "score": 0, "creation_date": 1488698618, "post_id": 42602844, "comment_id": 72341118, "body": "Is this a glitch or dependable behavior?"}], "tags": [], "owner": {"reputation": 1304, "user_id": 5125201, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bff70a4545b368f2aca2a97de7b234b2?s=128&d=identicon&r=PG", "display_name": "Ammar Bandukwala", "link": "https://stackoverflow.com/users/5125201/ammar-bandukwala"}, "is_accepted": false, "score": 1, "last_activity_date": 1488672212, "creation_date": 1488672212, "answer_id": 42602844, "question_id": 42602606, "link": "https://stackoverflow.com/questions/42602606/detecting-whether-something-is-on-stdin/42602844#42602844", "title": "Detecting whether something is on STDIN", "body": "<p><code>os.Stdin</code> is treated like a file and has permissions. When <code>os.Stdin</code> is open, the perms are <code>0600</code>, when closed it's <code>0620</code>.</p>\n\n<p>This code works:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    stat, _ := os.Stdin.Stat()\n    fmt.Printf(\"stdin mode: %v\\n\", stat.Mode().Perm())\n    if stat.Mode().Perm() == 0600 {\n        fmt.Printf(\"stdin open\\n\")\n        return\n    }\n    fmt.Printf(\"stdin close\\n\")\n\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "edited": false, "score": 0, "creation_date": 1488698646, "post_id": 42602962, "comment_id": 72341124, "body": "theres no larger problem, just for the sake of it."}], "tags": [], "owner": {"reputation": 2229, "user_id": 484529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rp6uy.png?s=128&g=1", "display_name": "ijt", "link": "https://stackoverflow.com/users/484529/ijt"}, "is_accepted": false, "score": 0, "last_activity_date": 1488673233, "creation_date": 1488673233, "answer_id": 42602962, "question_id": 42602606, "link": "https://stackoverflow.com/questions/42602606/detecting-whether-something-is-on-stdin/42602962#42602962", "title": "Detecting whether something is on STDIN", "body": "<p>It would be possible if you put the read in a goroutine and use select to do a non-blocking read from the channel in main, but you would then have a race condition where you could get different results depending on whether the data comes in quickly enough. What is the larger problem you're trying to solve?</p>\n"}], "owner": {"reputation": 636, "user_id": 3333488, "user_type": "registered", "accept_rate": 48, "profile_image": "https://i.stack.imgur.com/49Fx1.jpg?s=128&g=1", "display_name": "lash", "link": "https://stackoverflow.com/users/3333488/lash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1488673233, "creation_date": 1488670306, "question_id": 42602606, "link": "https://stackoverflow.com/questions/42602606/detecting-whether-something-is-on-stdin", "title": "Detecting whether something is on STDIN", "body": "<p><strong>Program</strong> should be able to get input from <code>stdin</code> on terminal, as follows:</p>\n\n<p><code>echo foobar | program</code></p>\n\n<p>However, in the source below for <strong>Program</strong>, the <code>stdin</code> read blocks if the pipe is omitted:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    b := make([]byte, 1024)\n    r := os.Stdin\n    n, e := r.Read(b)\n    if e != nil {\n        fmt.Printf(\"Err: %s\\n\", e)\n    }\n    fmt.Printf(\"Res: %s (%d)\\n\", b, n)\n\n}\n</code></pre>\n\n<p>So how can <strong>Program</strong> detect <em>whether</em> something is being piped to it in this manner, and continue execution instead of blocking if not?</p>\n\n<p>... and is it a good idea to do so?</p>\n"}, {"tags": ["arrays", "json", "object", "go"], "comments": [{"owner": {"reputation": 1445, "user_id": 5972487, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/024fcbdd0ee00e2dccefce0ef67bc434?s=128&d=identicon&r=PG", "display_name": "elmiomar", "link": "https://stackoverflow.com/users/5972487/elmiomar"}, "edited": false, "score": 0, "creation_date": 1488670954, "post_id": 42602362, "comment_id": 72335855, "body": "from where are you expecting this response? what is <code>1702487</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 2229, "user_id": 484529, "user_type": "registered", "accept_rate": 86, "profile_image": "https://i.stack.imgur.com/rp6uy.png?s=128&g=1", "display_name": "ijt", "link": "https://stackoverflow.com/users/484529/ijt"}, "is_accepted": false, "score": 0, "last_activity_date": 1488672797, "creation_date": 1488672797, "answer_id": 42602909, "question_id": 42602362, "link": "https://stackoverflow.com/questions/42602362/correct-structure-for-json-unmarshal/42602909#42602909", "title": "Correct structure for json unmarshal", "body": "<p>In this situation you'll have to punt and use interface{} somewhere, for example:</p>\n\n<pre><code>    package main\n\n    import (\n            \"fmt\"\n            \"encoding/json\"\n    )\n\n    type JsObject struct {\n            Response []interface{}\n    }\n\n    func main() {\n            bs := []byte(`{\"response\":[1702487,{\"uid\":150261846,\"first_name\":\"\u041e\u043b\u0435\u0433\",\"last_name\":\"\u0411\u0440\u0435\u0439\u043d\"},{\"uid\":53260546,\"first_name\":\"\u041e\u043b\u0435\u0433\",\"last_name\":\"\u041b\u043e\u0431\u0430\u0446\u0435\u0432\u0438\u0447\"}]}`)\n            var jso JsObject\n            json.Unmarshal(bs, &amp;jso)\n            fmt.Printf(\"%+v\\n\", jso)\n    }\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1, "user_id": 7659764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd1735ce5d66012831a4db91aeea5b9?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Tarenkov", "link": "https://stackoverflow.com/users/7659764/roman-tarenkov"}, "edited": false, "score": 0, "creation_date": 1488676324, "post_id": 42603017, "comment_id": 72336945, "body": "1702487 is the total count of people whose first name is the same as you in that object"}, {"owner": {"reputation": 1, "user_id": 7659764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd1735ce5d66012831a4db91aeea5b9?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Tarenkov", "link": "https://stackoverflow.com/users/7659764/roman-tarenkov"}, "edited": false, "score": 0, "creation_date": 1488676768, "post_id": 42603017, "comment_id": 72337042, "body": "Your structure is perfectly fine, but the response still have the key named &quot;response&quot;, so the structure is gonna look different. Is there any way to remove or skip keys? Like jump right into the person object, ignoring &quot;response&quot; and that count number"}, {"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "reply_to_user": {"reputation": 1, "user_id": 7659764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd1735ce5d66012831a4db91aeea5b9?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Tarenkov", "link": "https://stackoverflow.com/users/7659764/roman-tarenkov"}, "edited": false, "score": 0, "creation_date": 1488704132, "post_id": 42603017, "comment_id": 72342447, "body": "I would clean the data of the int key in the array (you can leave the resonse key) then use this. The alternative is to parse manually with map[string]interface{} as far as I can see. If you control data I&#39;d change it to make parsing not you&#39;re stuck cleaning it up."}], "tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": false, "score": 0, "last_activity_date": 1488673698, "creation_date": 1488673698, "answer_id": 42603017, "question_id": 42602362, "link": "https://stackoverflow.com/questions/42602362/correct-structure-for-json-unmarshal/42603017#42603017", "title": "Correct structure for json unmarshal", "body": "<p>Json to go is quite handy for this sort of thing:</p>\n\n<p><a href=\"https://mholt.github.io/json-to-go/\" rel=\"nofollow noreferrer\">https://mholt.github.io/json-to-go/</a> </p>\n\n<p>If you can remove the spurious 1702487 which makes this a heterogenous list, you should be able to parse it easily into a proper structure, otherwise you might be stuck using interface:</p>\n\n<p><a href=\"https://play.golang.org/p/w7ebLTuOj9\" rel=\"nofollow noreferrer\">https://play.golang.org/p/w7ebLTuOj9</a></p>\n\n<p>Presumably you want an array of structs like this:</p>\n\n<pre><code>type Person struct {\n  UID       int `json:\"uid\"`\n  FirstName string `json:\"first_name\"`\n  LastName  string `json:\"last_name\"`\n}\n</code></pre>\n\n<p>not sure what 1702487 is but if uid of request, it doesn't really belong in the array. </p>\n"}, {"comments": [{"owner": {"reputation": 3116, "user_id": 2011513, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1a4df402fad3727cb24d533a1492ffb2?s=128&d=identicon&r=PG", "display_name": "Ashwin Balamohan", "link": "https://stackoverflow.com/users/2011513/ashwin-balamohan"}, "edited": false, "score": 0, "creation_date": 1488833848, "post_id": 42627244, "comment_id": 72398357, "body": "Please explain how this fixes the problem."}], "tags": [], "owner": {"reputation": 526, "user_id": 5397795, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/898232106936756/picture?type=large", "display_name": "Dharani Dharan", "link": "https://stackoverflow.com/users/5397795/dharani-dharan"}, "is_accepted": false, "score": 0, "last_activity_date": 1488807912, "creation_date": 1488807912, "answer_id": 42627244, "question_id": 42602362, "link": "https://stackoverflow.com/questions/42602362/correct-structure-for-json-unmarshal/42627244#42627244", "title": "Correct structure for json unmarshal", "body": "<pre><code>type AutoGenerated struct {\n    Response []interface{} `json:\"response\"`\n}\n</code></pre>\n"}], "owner": {"reputation": 1, "user_id": 7659764, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1bd1735ce5d66012831a4db91aeea5b9?s=128&d=identicon&r=PG&f=1", "display_name": "Roman Tarenkov", "link": "https://stackoverflow.com/users/7659764/roman-tarenkov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 85, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1488807912, "creation_date": 1488668317, "last_edit_date": 1488677127, "question_id": 42602362, "link": "https://stackoverflow.com/questions/42602362/correct-structure-for-json-unmarshal", "title": "Correct structure for json unmarshal", "body": "<p>I can't figure out how to build a structure for this json object in golang:</p>\n\n<pre><code>{\n    \"response\": [1702487, {\n            \"uid\": 150261846,\n            \"first_name\": \"\u041e\u043b\u0435\u0433\",\n            \"last_name\": \"\u0411\u0440\u0435\u0439\u043d\"\n        }, {\n            \"uid\": 53260546,\n            \"first_name\": \"\u041e\u043b\u0435\u0433\",\n            \"last_name\": \"\u041b\u043e\u0431\u0430\u0446\u0435\u0432\u0438\u0447\"\n        }\n    ]\n}\n</code></pre>\n\n<p>As you can see there is no keys names for array and for count too.</p>\n\n<p>Would be glad if you can help</p>\n"}, {"tags": ["go", "struct", "stack", "stack-overflow", "panic"], "answers": [{"comments": [{"owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "edited": false, "score": 0, "creation_date": 1488662002, "post_id": 42601208, "comment_id": 72333487, "body": "Thank you @andy-schweig."}], "tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 13, "last_activity_date": 1488660728, "last_edit_date": 1488660728, "creation_date": 1488660341, "answer_id": 42601208, "question_id": 42600920, "link": "https://stackoverflow.com/questions/42600920/runtime-goroutine-stack-exceeds-1000000000-byte-limit-fatal-error-stack-overf/42601208#42601208", "title": "runtime: goroutine stack exceeds 1000000000-byte limit, fatal error: stack overflow on printing a nested struct", "body": "<p>The <code>%v</code> and <code>%+v</code> formats use the value of <code>String()</code> if the type implements it. Therefore, using <code>%+v</code> on a type within the <code>String()</code> function for that type causes infinite recursion. Instead of using <code>%+v</code> in the <code>String()</code> function, you'll have to construct your own string, showing the contents of the structure in whatever way you see fit.</p>\n"}], "owner": {"reputation": 2755, "user_id": 3244776, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/a3E89.jpg?s=128&g=1", "display_name": "nohup", "link": "https://stackoverflow.com/users/3244776/nohup"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8687, "favorite_count": 1, "accepted_answer_id": 42601208, "answer_count": 1, "score": 7, "last_activity_date": 1554606190, "creation_date": 1488658736, "last_edit_date": 1554606190, "question_id": 42600920, "link": "https://stackoverflow.com/questions/42600920/runtime-goroutine-stack-exceeds-1000000000-byte-limit-fatal-error-stack-overf", "title": "runtime: goroutine stack exceeds 1000000000-byte limit, fatal error: stack overflow on printing a nested struct", "body": "<p>I have a nested struct.</p>\n\n<pre><code>type ConfigOne struct {\n    // Daemon section from config file.\n    Daemon daemon\n}\ntype daemon struct {\n    Loglevel int\n    Logfile string\n}\n</code></pre>\n\n<p>And I have a <code>String() string</code> method on that type, which I am trying to return the nested struct elements as </p>\n\n<pre><code>func (c ConfigOne)String()  string{\n    return fmt.Sprintf(\"%+v\\n\", c)\n}\n</code></pre>\n\n<p>When I am trying to print it as </p>\n\n<pre><code>c := &amp;modules.ConfigOne{}\nc.Daemon.Loglevel = 1\nc.Daemon.Logfile = \"/tmp/test.log\"\nmodules.Logger.Infoln(c.String())\n</code></pre>\n\n<p>I am getting the error</p>\n\n<blockquote>\n  <p>runtime: goroutine stack exceeds 1000000000-byte limit\n  fatal error: stack overflow</p>\n  \n  <p>runtime stack:\n  runtime.throw(0x6ea3b7, 0xe)\n  ...</p>\n</blockquote>\n\n<p>After going through the error, I could see repeated lines similar to the below one </p>\n\n<blockquote>\n  <p>modules/structs.go:31 +0x77 fp=0xc440100398 sp=0xc440100328\n  go-consume/modules.(*ConfigOne).String(0xc42abcb4e0, 0x70bc08, 0xc42abd6300)\n  :1 +0x64 fp=0xc4401003d8 sp=0xc440100398\n  fmt.(*pp).handleMethods(0xc42abd6300, 0xc400000076, 0x410301)</p>\n</blockquote>\n\n<p>and finally, before dying, </p>\n\n<blockquote>\n  <p>modules/structs.go:31 +0xc0 fp=0xc440103d18 sp=0xc440103ca8\n  ...additional frames elided...</p>\n  \n  <p>goroutine 17 [syscall, locked to thread]:\n  runtime.goexit()</p>\n</blockquote>\n\n<p>which I believe is caused by going into some infinite recursion. </p>\n\n<p>I tried my luck to find the cause and reached <a href=\"https://github.com/davecgh/go-spew/issues/45\" rel=\"nofollow noreferrer\">here</a>, which I believe is the same issue. However I couldn't understand the explanation in that thread.</p>\n\n<p>If I try to print the individual nested struct as</p>\n\n<pre><code>func (c ConfigOne)String() string{\n    //return fmt.Sprintf(\"%+v\\n\", c.Daemon.Loglevel)\n    return fmt.Sprintf(\"%+v\\n\", c.Daemon)\n}\n</code></pre>\n\n<p>it is working fine, and log shows the fields as</p>\n\n<pre><code>2017/03/05 01:28:25 go-consume.go:38: INFO: {Loglevel:1 Logfile:/tmp/test.log}\n</code></pre>\n\n<p>Can someone kindly explain how the former <code>String()</code> method is resulting in an infinite recursion and a stackoverflow, and what is the best way to overcome this?</p>\n"}, {"tags": ["go", "encoding", "gob"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1488656224, "post_id": 42600441, "comment_id": 72331653, "body": "It encodes into <code>buf</code>, that&#39;s why you created the encoder with <code>buf</code> as the <code>io.Writer</code>"}], "answers": [{"tags": [], "owner": {"reputation": 3058, "user_id": 2776473, "user_type": "registered", "accept_rate": 25, "profile_image": "https://i.stack.imgur.com/JvVL6.jpg?s=128&g=1", "display_name": "Shmulik Klein", "link": "https://stackoverflow.com/users/2776473/shmulik-klein"}, "is_accepted": true, "score": 3, "last_activity_date": 1488662129, "last_edit_date": 1488662129, "creation_date": 1488658761, "answer_id": 42600926, "question_id": 42600441, "link": "https://stackoverflow.com/questions/42600441/what-does-gob-encoding-do/42600926#42600926", "title": "What does gob encoding do?", "body": "<p>Your comparison is wrong - comparing the data being encoded (<code>data</code>) to the result after being decoded (<code>d.Decode(data)</code>), will obviously lead you to the same result (if everything is working as expected). </p>\n\n<p>The encoding itself will be presented in the underline bytes buffer (try to print the buffer itself - <code>fmt.Println(buf.Bytes())</code>).</p>\n\n<p>Read more on <a href=\"https://blog.golang.org/gobs-of-data\" rel=\"nofollow noreferrer\">the gob package </a></p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2160, "favorite_count": 0, "accepted_answer_id": 42600926, "answer_count": 1, "score": -1, "last_activity_date": 1488662129, "creation_date": 1488656025, "question_id": 42600441, "link": "https://stackoverflow.com/questions/42600441/what-does-gob-encoding-do", "title": "What does gob encoding do?", "body": "<p>Does gob encoding/decoding do anything ? In the example below , data looks the same before and after decoding. I am confused, please advise</p>\n\n<pre><code>data = \"ABC\"\n    buf := new(bytes.Buffer)\n\n    //glob encoding\n    enc := gob.NewEncoder(buf)\n    enc.Encode(data)\n    fmt.Println(\"Encoded:\", data)  //Encoded: ABC\n\n    //glob decoding\n    d := gob.NewDecoder(buf)\n    d.Decode(data)\n    fmt.Println(\"Decoded: \", data) //Decoded:  ABC\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 3, "creation_date": 1488656000, "post_id": 42600399, "comment_id": 72331576, "body": "<i>I can&#39;t fully understand logic of this behavior</i>: You&#39;re shadowing the variable <code>a</code>; what&#39;s confusing about that?"}, {"owner": {"reputation": 2041, "user_id": 2071800, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e1f877eccccc9e714b4d4fe03917f2a7?s=128&d=identicon&r=PG", "display_name": "Joe Half Face", "link": "https://stackoverflow.com/users/2071800/joe-half-face"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1488661663, "post_id": 42600399, "comment_id": 72333393, "body": "@TimCooper: <code>Go&#39;s return values may be named. If so, they are treated as variables defined at the top of the function.</code> This clarifies issue. It is not ideomatic closure behavior."}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6482282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iEdvO.jpg?s=128&g=1", "display_name": "Felipe Siqueira", "link": "https://stackoverflow.com/users/6482282/felipe-siqueira"}, "is_accepted": false, "score": 0, "last_activity_date": 1488820641, "creation_date": 1488820641, "answer_id": 42631677, "question_id": 42600399, "link": "https://stackoverflow.com/questions/42600399/closures-in-go-different-output-on-named-return-value/42631677#42631677", "title": "Closures in go: different output on named return value", "body": "<p>Like @TimCooper commented, you are shadowing \"a\".</p>\n\n<p>If you run the code below, you will see two different memory addresses.</p>\n\n<p>It means that are \"2 variables a\".</p>\n\n<p>The \"a\" inside sum() represents it's own return, and it's declared without a value, so the compiler assigns the \"zero value\" to the \"other a\", that is 0 to numeric types.</p>\n\n<p>So, a = a * 2 is equals 0 = 0 * 2. </p>\n\n<p>When the sum() ends, it returns the \"other a\" (remember the different memory address?), keeping the \"first a\" unchanged.</p>\n\n<p>This link might be helpful:\n<a href=\"https://golang.org/ref/spec#The_zero_value\" rel=\"nofollow noreferrer\">Go zero values</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    var a int = 3\n    sum := func() (a int) {\n        fmt.Println(&amp;a) // func sum() scope (a's copy memory address)\n        a = a * 2\n        return\n    }\n    b := sum()      // initializing b with the sum() return\n    fmt.Println(&amp;a) // func main() scope (a's memory address)\n    fmt.Println(b)  // func sum() return\n    fmt.Println(a)  // old value, stills 3\n}\n</code></pre>\n"}], "owner": {"reputation": 2041, "user_id": 2071800, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/e1f877eccccc9e714b4d4fe03917f2a7?s=128&d=identicon&r=PG", "display_name": "Joe Half Face", "link": "https://stackoverflow.com/users/2071800/joe-half-face"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 87, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1488820641, "creation_date": 1488655851, "question_id": 42600399, "link": "https://stackoverflow.com/questions/42600399/closures-in-go-different-output-on-named-return-value", "title": "Closures in go: different output on named return value", "body": "<p>Consider the following function:</p>\n\n<pre><code>func main() {\n  var a int = 3\n  sum := func() {a = a*2}\n  sum()\n  sum()\n  fmt.Println(a) // returns 12\n}\n</code></pre>\n\n<p>However:</p>\n\n<pre><code>func main() {\n  var a int = 3\n  sum := func() (a int) {a = a*2; return}\n  sum()\n  sum()\n  fmt.Println(a) // returns 3\n}\n</code></pre>\n\n<p>I can't fully understand logic of this behavior: why it would return old value of <code>a</code> after <code>a = a*2</code></p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 18509, "user_id": 939410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bb161e6bf2e1dded07d3fd921f487334?s=128&d=identicon&r=PG", "display_name": "Art", "link": "https://stackoverflow.com/users/939410/art"}, "edited": false, "score": 1, "creation_date": 1488656441, "post_id": 42599382, "comment_id": 72331729, "body": "IMO test frameworks that have &quot;assume failure&quot; modes are dumb. What does failure mean? That one of the conditions you test failed? That all of them failed? That you got a random nil pointer dereference? That your initialization code crashed? If you expect any of those things to happen then you can test for them. It&#39;s trivial to reverse your conditionals. It&#39;s impossible to make a framework guess correctly what you actually mean."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1488663921, "post_id": 42599382, "comment_id": 72334022, "body": "That seems like a really strange implementation. You&#39;re in control of the assert.True calls; you&#39;re telling the framework what is &quot;correct&quot; and &quot;incorrect&quot;, and then you want to invert the meaning of correct and incorrect? Just assert what you actually expect."}, {"owner": {"reputation": 6590, "user_id": 228514, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/066da34008adb924c115df7a39779d8d?s=128&d=identicon&r=PG", "display_name": "Ryan Parman", "link": "https://stackoverflow.com/users/228514/ryan-parman"}, "edited": false, "score": 0, "creation_date": 1616775719, "post_id": 42599382, "comment_id": 118117549, "body": "&quot;Negative&quot; testing is important. The goal is to test that known bad input (from the user, whatever) fails as expected. &quot;The test case failed successfully, as expected.&quot;"}], "answers": [{"tags": [], "owner": {"reputation": 2316, "user_id": 301051, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/a0e6e06df1c2f81554cdc6f6e5444367?s=128&d=identicon&r=PG", "display_name": "Pablo Lalloni", "link": "https://stackoverflow.com/users/301051/pablo-lalloni"}, "is_accepted": false, "score": 0, "last_activity_date": 1488656346, "creation_date": 1488656346, "answer_id": 42600502, "question_id": 42599382, "link": "https://stackoverflow.com/questions/42599382/can-i-expect-require-failure-for-a-go-test/42600502#42600502", "title": "Can I expect (require) failure for a go test?", "body": "<p>You could do something like the following:</p>\n\n<pre><code>func IsRedirect(t *testing.T, code int, b bool) {\n    assert.Equal(t, b, code &gt;= 300)\n    assert.Equal(t, b, code &lt; 400)\n}\n\nfunc TestNotRedirect(t *testing.T) {\n    IsRedirect(t, http.StatusOK, false)\n}\n</code></pre>\n"}], "owner": {"reputation": 451, "user_id": 2782193, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/566d53dfa7e555999bc7df48f53285f6?s=128&d=identicon&r=PG", "display_name": "Alun", "link": "https://stackoverflow.com/users/2782193/alun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 764, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1488656346, "creation_date": 1488650484, "question_id": 42599382, "link": "https://stackoverflow.com/questions/42599382/can-i-expect-require-failure-for-a-go-test", "title": "Can I expect (require) failure for a go test?", "body": "<p>In other test frameworks that I have used, when writing test helpers, it's nice to be able to automatically test them, i.e. test that they fail as well as pass.</p>\n\n<p>Let me use the following for the helper (in reality it's a lot more complex):</p>\n\n<pre><code>func IsRedirect(t *testing.T, code int) {\n    assert.True(t, code &gt;= 300)\n    assert.True(t, code &lt; 400)\n}\n</code></pre>\n\n<p>Then sure, I can write:</p>\n\n<pre><code>func TestIsRedirect(t *testing.T) {\n    IsRedirect(t, http.StatusSeeOther)\n}\n</code></pre>\n\n<p>But I'd also like to write something like:</p>\n\n<pre><code>func TestNotRedirect(t *testing.T) {\n    t.RequireFailure()\n    IsRedirect(t, http.StatusOK)\n}\n</code></pre>\n\n<p>Note, I don't really want to write:</p>\n\n<pre><code>func IsRedirect(code int) bool\n</code></pre>\n\n<p>because the function has more than just one or two conditions that can fail, and I want to be able to <code>assert</code> on the specific failure case.</p>\n"}, {"tags": ["go", "gob"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1488649671, "post_id": 42598913, "comment_id": 72329290, "body": "It says <code>data</code> isn&#39;t a pointer. Have you tried using a pointer?"}, {"owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1488654537, "post_id": 42598913, "comment_id": 72331120, "body": "I think this is just a typo, should be data instead d in log print..;("}], "answers": [{"tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 2, "last_activity_date": 1488672431, "creation_date": 1488672431, "answer_id": 42602862, "question_id": 42598913, "link": "https://stackoverflow.com/questions/42598913/gob-decoder-attempting-to-decode-into-a-non-pointer/42602862#42602862", "title": "gob decoder attempting to decode into a non-pointer", "body": "<p>Gob requires you to pass a pointer to decode.</p>\n\n<p>In your case, you would do:</p>\n\n<pre><code>    d.Decode(&amp;data)\n</code></pre>\n\n<p>reason being, it may have to modify the slice (ie: to make it bigger, to fit the decoded array)</p>\n"}], "owner": {"reputation": 2468, "user_id": 4615576, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/e78eebf8d65e460bf5f39b2edfddf69e?s=128&d=identicon&r=PG", "display_name": "irom", "link": "https://stackoverflow.com/users/4615576/irom"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 864, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1488672431, "creation_date": 1488647967, "question_id": 42598913, "link": "https://stackoverflow.com/questions/42598913/gob-decoder-attempting-to-decode-into-a-non-pointer", "title": "gob decoder attempting to decode into a non-pointer", "body": "<p>In my Go program I am encoding []byte data with gob </p>\n\n<pre><code>buf := new(bytes.Buffer)\n    enc := gob.NewEncoder(buf)\n        //data is []byte\n        buf.Reset()\n        enc.Encode(data)\n</code></pre>\n\n<p>but getting '<em>gob decoder attempting to decode into a non-pointer</em>' when I am trying to decoded</p>\n\n<pre><code>buf := new(bytes.Buffer)\n    d := gob.NewDecoder(buf)\n        d.Decode(data)\n        log.Printf(\"%s\", d)\n</code></pre>\n"}]