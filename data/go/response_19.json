[{"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432162295, "post_id": 30361671, "comment_id": 48814925, "body": "does not say that it does not belong here, but have you tried to ask this question at a github of this gorm?"}], "answers": [{"comments": [{"owner": {"reputation": 3895, "user_id": 3169754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sP8Pj.png?s=128&g=1", "display_name": "gavv", "link": "https://stackoverflow.com/users/3169754/gavv"}, "edited": false, "score": 3, "creation_date": 1472450313, "post_id": 30365717, "comment_id": 65738719, "body": "This error checking doesn&#39;t work at least with current gorm. See answer by @windyzboy and my comment there."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3895, "user_id": 3169754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sP8Pj.png?s=128&g=1", "display_name": "gavv", "link": "https://stackoverflow.com/users/3169754/gavv"}, "edited": false, "score": 1, "creation_date": 1472456605, "post_id": 30365717, "comment_id": 65741576, "body": "@gavv You&#39;re right, this doesn&#39;t work anymore. I tried to delete the answer, but cannot (because it&#39;s accepted), so I just edit it."}, {"owner": {"reputation": 6177, "user_id": 633864, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/N2ha7.jpg?s=128&g=1", "display_name": "COil", "link": "https://stackoverflow.com/users/633864/coil"}, "edited": false, "score": 0, "creation_date": 1568218193, "post_id": 30365717, "comment_id": 102207526, "body": "Works with v1.9.10."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 26, "last_activity_date": 1472457687, "last_edit_date": 1472457687, "creation_date": 1432188224, "answer_id": 30365717, "question_id": 30361671, "link": "https://stackoverflow.com/questions/30361671/how-can-i-check-for-errors-in-crud-operations-using-gorm/30365717#30365717", "title": "How can I check for errors in CRUD operations using GORM?", "body": "<p><a href=\"https://godoc.org/github.com/jinzhu/gorm#DB.Create\" rel=\"noreferrer\"><code>DB.Create()</code></a> returns a new (cloned) <a href=\"http://godoc.org/github.com/jinzhu/gorm#DB\" rel=\"noreferrer\"><code>gorm.DB</code></a> which is a <code>struct</code> and has a field <code>Error</code>:</p>\n\n<pre><code>type DB struct {\n    Value        interface{}\n    Error        error\n    RowsAffected int64\n    // contains filtered or unexported fields\n}\n</code></pre>\n\n<p>You can store the returned <code>*gorm.DB</code> value and check its <code>DB.Error</code> field like this:</p>\n\n<pre><code>if dbc := db.Create(&amp;user); dbc.Error != nil {\n    // Create failed, do something e.g. return, panic etc.\n    return\n}\n</code></pre>\n\n<p>If you don't need anything else from the returned <code>gorm.DB</code>, you can directly check its <code>Error</code> field:</p>\n\n<pre><code>if db.Create(&amp;user).Error != nil {\n    // Create failed, do something e.g. return, panic etc.\n    return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3895, "user_id": 3169754, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/sP8Pj.png?s=128&g=1", "display_name": "gavv", "link": "https://stackoverflow.com/users/3169754/gavv"}, "edited": false, "score": 5, "creation_date": 1472450223, "post_id": 31760113, "comment_id": 65738692, "body": "Correct. The accepted answer doesn&#39;t work because <code>Create</code> returns a clone of <code>DB</code> and <code>Error</code> field is set in that clone instead of original object."}], "tags": [], "owner": {"reputation": 1242, "user_id": 1819549, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ae42e926dea320c7e66ae30096adf56?s=128&d=identicon&r=PG", "display_name": "windyzboy", "link": "https://stackoverflow.com/users/1819549/windyzboy"}, "is_accepted": false, "score": 15, "last_activity_date": 1552723638, "last_edit_date": 1552723638, "creation_date": 1438419567, "answer_id": 31760113, "question_id": 30361671, "link": "https://stackoverflow.com/questions/30361671/how-can-i-check-for-errors-in-crud-operations-using-gorm/31760113#31760113", "title": "How can I check for errors in CRUD operations using GORM?", "body": "<p>I have tried the accepted answer, but it doesn't work, <code>db.Error</code> always return <code>nil</code>.</p>\n\n<p>Just change something and it works, hope it helps somebody:</p>\n\n<pre><code>if err := db.Create(&amp;Animal{Name: \"Giraffe\"}).Error; err != nil {\n   // Create failed, do something e.g. return, panic etc.\n   return \n}\n</code></pre>\n"}], "owner": {"reputation": 15832, "user_id": 1156707, "user_type": "registered", "accept_rate": 91, "profile_image": "https://www.gravatar.com/avatar/99055b620fb3a9d30a8f6ac480c25227?s=128&d=identicon&r=PG", "display_name": "Louis Thibault", "link": "https://stackoverflow.com/users/1156707/louis-thibault"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10367, "favorite_count": 1, "accepted_answer_id": 30365717, "answer_count": 2, "score": 21, "last_activity_date": 1552723638, "creation_date": 1432162063, "question_id": 30361671, "link": "https://stackoverflow.com/questions/30361671/how-can-i-check-for-errors-in-crud-operations-using-gorm", "title": "How can I check for errors in CRUD operations using GORM?", "body": "<p>The <a href=\"https://github.com/jinzhu/gorm/wiki/Basic-CRUD\" rel=\"noreferrer\">official documentation</a> for GORM demonstrates a way in which one can test for the existence of a record, i.e.:</p>\n\n<pre><code>user := User{Name: \"Jinzhu\", Age: 18, Birthday: time.Now()}\n\n// returns true if record hasn\u2019t been saved (primary key `Id` is blank)\ndb.NewRecord(user) // =&gt; true\n\ndb.Create(&amp;user)\n\n// will return false after `user` created\ndb.NewRecord(user) // =&gt; false\n</code></pre>\n\n<p>This can be used to test indirectly for errors in record creation but reports no useful information in the event of a failure.</p>\n\n<p>Having checked the <a href=\"https://github.com/jinzhu/gorm/blob/master/callback_create.go#L21\" rel=\"noreferrer\">source code for <code>db.Create</code></a>, there seems to be some sort of stack-frame inspection that checks for errors before proceeding, meaning that transactional errors will fail silently:</p>\n\n<pre><code>func Create(scope *Scope) {\n    defer scope.Trace(NowFunc())\n\n    if !scope.HasError() {\n        // actually perform the transaction\n    }\n}\n</code></pre>\n\n<ul>\n<li>Is this a bug, or am I missing something?</li>\n<li><strong>How can/should I be informed of a failed transaction?</strong></li>\n<li>Where can I get useful debugging information?</li>\n</ul>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432149114, "post_id": 30358371, "comment_id": 48808587, "body": "I was too focussed on the parameters that I didn&#39;t saw the missing curly braces."}], "tags": [], "owner": {"reputation": 164108, "user_id": 714501, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a2090a0ffd27b055c8fa22a8e59476d0?s=128&d=identicon&r=PG", "display_name": "cnicutar", "link": "https://stackoverflow.com/users/714501/cnicutar"}, "is_accepted": true, "score": 25, "last_activity_date": 1432148899, "creation_date": 1432148899, "answer_id": 30358371, "question_id": 30358313, "link": "https://stackoverflow.com/questions/30358313/compiler-too-many-arguments-given-despite-that-all-are-given/30358371#30358371", "title": "Compiler: too many arguments given despite that all are given", "body": "<blockquote>\n<pre><code>resp := DataResponse(200, user)\n</code></pre>\n</blockquote>\n\n<p>The syntax is wrong. Try curly braces for struct initialization:</p>\n\n<pre><code>resp := DataResponse{200, user}\n                    ^         ^\n</code></pre>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6705, "favorite_count": 1, "accepted_answer_id": 30358371, "answer_count": 1, "score": 7, "last_activity_date": 1484089619, "creation_date": 1432148699, "last_edit_date": 1484089619, "question_id": 30358313, "link": "https://stackoverflow.com/questions/30358313/compiler-too-many-arguments-given-despite-that-all-are-given", "title": "Compiler: too many arguments given despite that all are given", "body": "<p>I want to use the struct <code>DataResponse</code> as parameter for <code>JSON()</code> to respond with the user. By initializing an instance of <code>DataResponse</code> I get the error message, that too many arguments are given, but gave all that are necessary. </p>\n\n<pre><code>type DataResponse struct {\n    Status int         `json:\"status\"`\n    Data   interface{} `json:\"data\"`\n}\n\nfunc GetUser(rw http.ResponseWriter, req *http.Request, ps httprouter.Params) {\n    user := models.User{}\n    // Fetching user from db\n\n    resp := DataResponse(200, user)\n    JSON(rw, resp) // rw is the ResponseWriter of net/http\n}\n</code></pre>\n\n<p>The following error message is thrown by the compiler:</p>\n\n<pre><code>too many arguments to conversion to DataResponse: DataResponse(200, user)\n</code></pre>\n\n<p><code>DataResponse</code> requires two parameters that are given and <code>Data</code> is an interface so it should accept <code>models.User</code> as datatype.</p>\n"}, {"tags": ["go", "swig"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1432144397, "post_id": 30356657, "comment_id": 48805849, "body": "What OS? also this belongs on <a href=\"https://github.com/golang/go/issues\" rel=\"nofollow noreferrer\">github.com/golang/go/issues</a>"}, {"owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "reply_to_user": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1432144858, "post_id": 30356657, "comment_id": 48806109, "body": "I&#39;m testing on OS X Yosemite. I&#39;ll add there as well, thanks."}, {"owner": {"reputation": 3157, "user_id": 73007, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4b736113aa1557b9a110b5123d81d5f6?s=128&d=identicon&r=PG", "display_name": "Daniel Lemire", "link": "https://stackoverflow.com/users/73007/daniel-lemire"}, "edited": false, "score": 0, "creation_date": 1489507025, "post_id": 30356657, "comment_id": 72695858, "body": "There is a pure Go implementation <a href=\"https://github.com/zhenjl/bitmap/tree/master/ewah\" rel=\"nofollow noreferrer\">github.com/zhenjl/bitmap/tree/master/ewah</a>"}], "answers": [{"tags": [], "owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "is_accepted": false, "score": 0, "last_activity_date": 1432152080, "creation_date": 1432152080, "answer_id": 30359301, "question_id": 30356657, "link": "https://stackoverflow.com/questions/30356657/swig-go-unsupported-relocation-for-dynamic-symbol/30359301#30359301", "title": "SWIG + Go: unsupported relocation for dynamic symbol", "body": "<p>Figured it out. I had to link against the C library as well. Fixed code below.</p>\n\n<pre><code>package main\n\n//#cgo LDFLAGS: -L/usr/local/lib -lewah\nimport \"C\"\n\nimport (\n    \"fmt\"\n    \"bitbucket.org/evanh/goewah\"\n)\n\nfunc main() {\n    x := goewah.NewEWAHBoolArray()\n    x.Set(1)\n    x.Set(2)\n    fmt.Println(x.Get(1))\n}\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 100, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432152080, "creation_date": 1432143427, "question_id": 30356657, "link": "https://stackoverflow.com/questions/30356657/swig-go-unsupported-relocation-for-dynamic-symbol", "title": "SWIG + Go: unsupported relocation for dynamic symbol", "body": "<p>I'm trying to wrap a C++ library in Go using SWIG, but I'm getting build errors when I try to use the package since I upgraded to Go 1.4.2.</p>\n\n<p>The package can be found here:\n<a href=\"https://bitbucket.org/evanh/goewah\" rel=\"nofollow\">https://bitbucket.org/evanh/goewah</a></p>\n\n<p>It contains the .swigcxx file as well as the C++ headers. For reference, I'm trying to interface with this library: <a href=\"https://github.com/lemire/EWAHBoolArray\" rel=\"nofollow\">https://github.com/lemire/EWAHBoolArray</a></p>\n\n<p>Following the instructions on the SWIG website, I'm able to build my package and have it install on my machine. I couldn't figure out how to get Go to automatically read my .swigcxx file and build the package, so I had to add a Makefile that called all the commands manually.</p>\n\n<p>However, the library builds and installs without errors. On Go 1.3.3, I could also use the package with no problems. However, running the same program in Go 1.4.2 causes a number of build errors.</p>\n\n<p>My test program:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bitbucket.org/evanh/goewah\"\n)\n\nfunc main() {\n    x := goewah.NewEWAHBoolArray()\n    x.Set(1)\n    x.Set(2)\n    fmt.Println(x.Get(1))\n}\n</code></pre>\n\n<p>The errors I see when I try to go build it:</p>\n\n<pre><code># command-line-arguments\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_sizeInBits: unsupported  relocation for dynamic symbol _wrap_EWAHBoolArray_sizeInBits (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_isEmpty: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_isEmpty (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_toIntArray: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_toIntArray (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_numberOfOnes: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_numberOfOnes (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_readStr: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_readStr (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_writeStr: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_writeStr (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_read__SWIG_1: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_read__SWIG_1 (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_read__SWIG_0: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_read__SWIG_0 (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_write__SWIG_1: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_write__SWIG_1 (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_write__SWIG_0: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_write__SWIG_0 (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_reset: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_reset (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_logicalandnot: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_logicalandnot (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_logicalxor: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_logicalxor (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_logicalor: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_logicalor (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_logicaland: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_logicaland (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_inplace_logicalnot: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_inplace_logicalnot (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_logicalnot: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_logicalnot (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_set: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_set (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_get: unsupported relocation for dynamic symbol _wrap_EWAHBoolArray_get (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_new_EWAHBoolArray: unsupported relocation for dynamic symbol _wrap_new_EWAHBoolArray (type=1 stype=32)\nbitbucket.org/evanh/goewah._wrap_EWAHBoolArray_get: unhandled relocation for _wrap_EWAHBoolArray_get (type 32 rtype 1)\ntoo many errors\n</code></pre>\n"}, {"tags": ["interface", "go"], "answers": [{"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432143515, "post_id": 30356637, "comment_id": 48805296, "body": "Why are you only use <code>response.(ErrorResponse)</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432143551, "post_id": 30356637, "comment_id": 48805320, "body": "@user3147268: I don&#39;t understand the question"}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432143616, "post_id": 30356637, "comment_id": 48805358, "body": "Is there any difference of using either <code>response.(ErrorResponse)</code> or <code>response.(Response)</code>?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432143861, "post_id": 30356637, "comment_id": 48805512, "body": "The difference is you get an <code>ErrorResponse</code> or you get a <code>Response</code>. If you want them to be interchangeable, make an new interface that gets the desired attributes."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432144030, "post_id": 30356637, "comment_id": 48805612, "body": "That would be the approach of <a href=\"https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh\">Soheil Hassas Yeganeh</a>"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 1, "last_activity_date": 1432143343, "creation_date": 1432143343, "answer_id": 30356637, "question_id": 30356592, "link": "https://stackoverflow.com/questions/30356592/how-to-access-attribute-of-interface/30356637#30356637", "title": "How to access attribute of interface", "body": "<p>Interfaces don't have attributes, so you need to extract the struct from the interface. To do this you use a <a href=\"http://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">type assertion</a></p>\n\n<pre><code>if response, ok := response.(ErrorResponse); ok {\n    rw.WriteHeader(response.Status)\n    ...\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432143922, "post_id": 30356759, "comment_id": 48805542, "body": "Thanks for the solution. Is it now better so set the status code twice as new paramter and inside the structs or to write two new functions and an interface to achieve the same?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432143933, "post_id": 30356759, "comment_id": 48805551, "body": "nit: <code>DataResponse</code> is probably better than <code>OKResponse</code>. Another name for the <code>Status() int</code> interface would be <code>Statuser</code> or just <code>Status</code> (the former doesn&#39;t sound right but there is a precedence for such <code>\u2026er</code> non-word interfaces)."}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432144369, "post_id": 30356759, "comment_id": 48805835, "body": "Thanks @Dave-C. Changed the answer a bit."}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "reply_to_user": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 1, "creation_date": 1432144505, "post_id": 30356759, "comment_id": 48805906, "body": "@user3147268 IMO it&#39;s better to use the interface. You can also create a base common structure that implements <code>Status()</code> but that&#39;s just an overdo. It&#39;s always ok to repeat a little in Go."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432144623, "post_id": 30356759, "comment_id": 48805985, "body": "Then I&#39;ll use the interface approach."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432144867, "post_id": 30356759, "comment_id": 48806111, "body": "By the way: would be <code>Responder</code> acceptable as interface name by following the -er convention?"}, {"owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "edited": false, "score": 1, "creation_date": 1432144977, "post_id": 30356759, "comment_id": 48806174, "body": "Naming is your preference. Go for anything you prefer. As a side note, in Go if an interface wraps a method <code>M</code> they call the interface &#39;M&#39;er. Look at <code>io.Reader</code>, <code>io.Writer</code>, and <code>io.ReadWriteCloser</code> to get an idea."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "edited": false, "score": 0, "creation_date": 1432145209, "post_id": 30356759, "comment_id": 48806321, "body": "Thanks for the detailed help."}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": true, "score": 4, "last_activity_date": 1432144348, "last_edit_date": 1432144348, "creation_date": 1432143717, "answer_id": 30356759, "question_id": 30356592, "link": "https://stackoverflow.com/questions/30356592/how-to-access-attribute-of-interface/30356759#30356759", "title": "How to access attribute of interface", "body": "<p>The type <code>response</code> in <code>rw.WriteHeader(response.Status)</code> is <code>interface{}</code>. In Go, you need to explicitly assert the type of the underlying struct and then access the field:</p>\n\n<pre><code>func JSON(rw http.ResponseWriter, response interface{}) {\n    payload, _ := json.MarshalIndent(response, \"\", \"    \")\n    switch r := response.(type) {\n    case ErrorResponse:\n        rw.WriteHeader(r.Status)\n    case Response:\n        rw.WriteHeader(r.Status) \n    }\n    ...\n}\n</code></pre>\n\n<p>A better and the preferred way to do this however is to define a common interface for your responses, that has a method for getting the status of the response:</p>\n\n<pre><code>type Statuser interface {\n    Status() int\n}\n\n// You need to rename the fields to avoid name collision.\nfunc (r Response) Status() int { return r.ResStatus }\nfunc (r ErrorResponse) Status() int { return r.ResStatus }\n\nfunc JSON(rw http.ResponseWriter, response Statuser) {\n    payload, _ := json.MarshalIndent(response, \"\", \"    \")\n    rw.WriteHeader(response.Status())\n    ...\n}\n</code></pre>\n\n<p>And it's better to rename <code>Response</code> to <code>DataResponse</code> and <code>ResponseInterface</code> to <code>Response</code>, IMO.</p>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1542, "favorite_count": 0, "accepted_answer_id": 30356759, "answer_count": 2, "score": 0, "last_activity_date": 1432144348, "creation_date": 1432143165, "last_edit_date": 1432143381, "question_id": 30356592, "link": "https://stackoverflow.com/questions/30356592/how-to-access-attribute-of-interface", "title": "How to access attribute of interface", "body": "<p>It was my intention to use the HTTP status codes both in the header and the body of the two response structs. Bu that without setting the status code twice as function parameter and again for the struct to avoid redundancy. </p>\n\n<p>The parameter <code>response</code> of <code>JSON()</code> is an interface to allow both structs to be accepted. The compiler throws the following exception:</p>\n\n<pre><code>response.Status undefined (type interface {} has no field or method Status)\n</code></pre>\n\n<p>because the response field must not have a status attribute. Is there an alternative way to avoid setting the status code twice? </p>\n\n<pre><code>type Response struct {\n    Status int         `json:\"status\"`\n    Data   interface{} `json:\"data\"`\n}\n\ntype ErrorResponse struct {\n    Status int      `json:\"status\"`\n    Errors []string `json:\"errors\"`\n}\n\nfunc JSON(rw http.ResponseWriter, response interface{}) {\n    payload, _ := json.MarshalIndent(response, \"\", \"    \")\n    rw.WriteHeader(response.Status)\n    ...\n}\n</code></pre>\n"}, {"tags": ["http", "go", "proxy", "goroutine"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432142753, "post_id": 30356395, "comment_id": 48804891, "body": "You can&#39;t re-use a listener, you need to &quot;Listen&quot; again."}], "answers": [{"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 1, "last_activity_date": 1432143181, "creation_date": 1432143181, "answer_id": 30356598, "question_id": 30356395, "link": "https://stackoverflow.com/questions/30356395/go-net-listener-closing-and-routine-handling/30356598#30356598", "title": "Go net listener closing and routine handling", "body": "<ol>\n<li>Flags should only be parsed once and probably in an <code>init</code> func.</li>\n<li>You can't reuse a listener, you will have to call <code>Listen</code> again.</li>\n<li>Don't call <code>log.Fatal</code>, that will terminate your program.</li>\n</ol>\n\n<p>Example:</p>\n\n<pre><code>var verbose = flag.Bool(\"v\", false, \"should every proxy request be logged to stdout\")\n\nfunc runProxy(typ, host, port string) (listener tcp.Listener) {\n    listener, _ = net.Listen(typ, host+\":\"+port)\n    proxy := goproxy.NewProxyHttpServer()\n    proxy.Verbose = *verbose\n\n    go http.Serve(listener, proxy) // you can probably ignore this error\n    return\n}\n\nfunc main() {\n    flag.Parse()\n    l := runProxy(....)\n    //do something\n    l.Close()\n    l = runProxy(....)\n    //....\n}\n</code></pre>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 534, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1432143181, "creation_date": 1432142576, "question_id": 30356395, "link": "https://stackoverflow.com/questions/30356395/go-net-listener-closing-and-routine-handling", "title": "Go net listener closing and routine handling", "body": "<p>I am starting a routine and listening on a net listener (HTTP). I want to close the listener, close the routine and start a new routine, and restart the listener. When I close the listener all hell breaks loose.</p>\n\n<p>(<code>listener</code> is global)</p>\n\n<pre><code>listener, _ = net.Listen(CONN_TYPE, CONN_HOST+\":\"+CONN_PORT)\ngo PassThrough()\n</code></pre>\n\n<p>where</p>\n\n<pre><code>func PassThrough() {\n    verbose := flag.Bool(\"v\", false, \"should every proxy request be logged to stdout\")\n    flag.Parse()\n    proxy := goproxy.NewProxyHttpServer()\n    proxy.Verbose = *verbose\n    log.Fatal(http.Serve(listener, proxy))\n}\n</code></pre>\n\n<p>So this works but if I want to stop passThrough() and re apply the listener to a different task (for instance a different proxy \"job\") closing the listener with <code>listener.Close()</code> causes it to break when I then try to re Listen and call a new go routine.</p>\n\n<p>I get the error:</p>\n\n<pre><code>ProxyControllers.go:146: accept tcp 127.0.0.1:8080: use of closed network connection\nreverseproxy.go:141: http: proxy error: EOF\n</code></pre>\n\n<p>When I then try to reuse the Listener.</p>\n\n<p>I think I need to tell the routine to close itself down somehow when i Close() the listener?</p>\n\n<p>Im using the <a href=\"https://github.com/elazarl/goproxy\" rel=\"nofollow\">goproxy</a> library</p>\n"}, {"tags": ["http", "go", "osx-yosemite"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432132714, "post_id": 30352725, "comment_id": 48798092, "body": "<code>ab</code> isn&#39;t very good, and the Go http server far out performs it. <code>ab</code> also work very poorly on osx. You&#39;re exhausting some local resource, like available sockets."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1432132871, "post_id": 30352725, "comment_id": 48798222, "body": "How do you launch your server? I don&#39;t see you setting GOMAXPROCS anywhere."}, {"owner": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 4, "creation_date": 1432132956, "post_id": 30352725, "comment_id": 48798277, "body": "I think that by default, the connection of the Go server is not closed so it can be reused, but it seems that <code>ab</code> is not reusing nor closing them fast enough so the maximum open connection is reached. You may try setting <code>r.Close</code> to <code>true</code> in your handler (I haven&#39;t actually tested it)."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1432132993, "post_id": 30352725, "comment_id": 48798309, "body": "Using <code>wrk</code> on my laptop, your hello server reaches 46000req/sec (@Ainar-G: that&#39;s only using GOMAXPROCS=1 too. When you&#39;re network bound, a low GOMAXPROCS is often more efficient)."}, {"owner": {"reputation": 46273, "user_id": 574479, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/79f682361ccbe900f8846a1098d13921?s=128&d=identicon&r=PG", "display_name": "biziclop", "link": "https://stackoverflow.com/users/574479/biziclop"}, "edited": false, "score": 0, "creation_date": 1432135701, "post_id": 30352725, "comment_id": 48800435, "body": "My money is on sockets left in TIME_WAIT state..<code>netstat</code> should reveal if that is the case."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 3551, "user_id": 2137314, "user_type": "registered", "accept_rate": 76, "profile_image": "https://i.stack.imgur.com/LjaqW.jpg?s=128&g=1", "display_name": "siritinga", "link": "https://stackoverflow.com/users/2137314/siritinga"}, "edited": false, "score": 1, "creation_date": 1432136488, "post_id": 30352725, "comment_id": 48800980, "body": "@siritinga: That won&#39;t help, since <code>ab</code> only uses http/1.0 and wasn&#39;t invoked with keepalive. The connection <i>must</i> be closed every time."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432138388, "post_id": 30352725, "comment_id": 48802309, "body": "My <code>netstat</code>-fu is not great. How would I check for <code>TIME_WAIT</code> state? I <code>grep</code>ed for <code>TIME_WAIT</code> and got nothing."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432138633, "post_id": 30352725, "comment_id": 48802474, "body": "@JimB I also tried it w/ <code>-k</code> and that reduces the frequency of failures, but doesn&#39;t eliminate them."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432139253, "post_id": 30352725, "comment_id": 48802825, "body": "Gave things a go w/ <code>httperf</code> and that seems not to be dropping errors, but if it goes much past 20,000 requests or so, the connection rate drops off a cliff until it&#39;s only a few connections per second instead of 10k+. Run the test w/ 10k requests or 20k, it&#39;s done in 2 seconds or less. But 30k and it never finishes."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1432140245, "post_id": 30352725, "comment_id": 48803484, "body": "@BobAman: tried <code>httperf</code>, and it seems to be even slower than <code>ab -k</code> on my system, but still has no problem going to 100k requests. This benchmark really is of no use, since the benchmarking tool (and the local network stack) is being tested even more than the Go server."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432141630, "post_id": 30352725, "comment_id": 48804299, "body": "So I tried out <code>wrk</code> and that definitely did much better.  More interestingly, I added <code>req.Body.Close()</code> and got a measurable speed-up as well as much more stability out of both <code>ab</code> and <code>httperf</code>."}, {"owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1432147332, "post_id": 30352725, "comment_id": 48807537, "body": "This problem doesn&#39;t come up on my Linux system (ubuntu 15.04). What OS and distro (if applicable) are you using? Perhaps @JimB&#39;s answer may be relevant to you."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432215997, "post_id": 30352725, "comment_id": 48840849, "body": "This is on OS X. I&#39;ve got a Vagrant-launched Kubernetes mini-cluster I&#39;m fiddling with and I&#39;m testing the above Hello World app both inside the cluster and running directly on the host OS. Trying to ascertain performance overhead from Kubernetes service load balancers. Obviously, the Vagrant aspect means that results will not reflect what things will look like in EC2, but I&#39;d like to optimize what I can from my development machine first before I start tweaking things on a cluster deploy that actually costs $."}], "answers": [{"comments": [{"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432215136, "post_id": 30357879, "comment_id": 48840197, "body": "In this case, my primary objective is not to benchmark the app server, I&#39;m really trying to get a feel for the performance overhead of an entire Kubernetes stack relative to the app server itself, but saw some confusing results I didn&#39;t understand on the way to that objective."}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432215306, "post_id": 30357879, "comment_id": 48840332, "body": "How would I find out how many ephemeral ports are currently left available?"}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432215641, "post_id": 30357879, "comment_id": 48840576, "body": "Also, out of curiosity, with a virtual machine, would ephemeral ports used within a guest OS affect the host in any way? i.e., Could I spin up a bunch of VMs running <code>wrk</code>/<code>ab</code>/<code>httperf</code> to bypass the OS X ephemeral port limitation?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432217535, "post_id": 30357879, "comment_id": 48842097, "body": "@BobAman: The forced delay is mostly just a limitation on osx, and the network stack and loopback device on osx is not as finely tuned as e.g. Linux. Local VMs may help provide a base for comparison, but you have to keep the same base os. Comparing an app running in a vagrant VM vs the local host is pointless. Throwing thousands of connections at a toy server doesn&#39;t prove anything. Are you trying to compare bandwidth, latency, CPU load or liveness under high concurrency? These tools are conflating all these."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432217649, "post_id": 30357879, "comment_id": 48842182, "body": "Keep your control variables constant throughout your tests, and narrow down what you&#39;re looking for. Ask questions like &quot;does running in docker cause unacceptable latency for <i>my</i> application?&quot;, or &quot;does this load balancer affect the bandwidth of <i>my</i> application?&quot;"}, {"owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "edited": false, "score": 0, "creation_date": 1432230079, "post_id": 30357879, "comment_id": 48850769, "body": "I&#39;m only looking for order-of-magnitude bottlenecks right now. i.e. What happens if I put haproxy in front of something vs. the Kubernetes load balancer in front of the same thing? And more with the purpose of finding things that are misconfigured rather than making larger architectural decisions."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 44, "last_activity_date": 1432148623, "last_edit_date": 1432148623, "creation_date": 1432147188, "answer_id": 30357879, "question_id": 30352725, "link": "https://stackoverflow.com/questions/30352725/why-is-my-hello-world-go-server-getting-crushed-by-apachebench/30357879#30357879", "title": "Why is my Hello World go server getting crushed by ApacheBench?", "body": "<p>In short, you're running out of ports.</p>\n\n<p>The default ephemeral port range on osx is 49152-65535, which is only 16,383 ports. Since each <code>ab</code> request is <code>http/1.0</code> (without keepalive in your first examples), each new request takes another port. </p>\n\n<p>As each port is used, it get's put into a queue where it waits for the tcp \"Maximum Segment Lifetime\", which is configured to be 15 seconds on osx. So if you use more than 16,383 ports in 15 seconds, you're effectively going to get throttled by the OS on further connections. Depending on which process runs out of ports first, you will get connection errors from the server, or hangs from <code>ab</code>.</p>\n\n<p>You can mitigate this by using an <code>http/1.1</code> capable load generator like <code>wrk</code>, or using the keepalive (<code>-k</code>) option for <code>ab</code>, so that connections are reused based on the tool's concurrency settings.</p>\n\n<p>Now, the server code you're benchmarking does so little, that the load generator is being taxed just as much as the sever itself, with the local os and network stack likely making a good contribution. If you want to benchmark an http server, it's better to do some meaningful work from multiple clients not running on the same machine.</p>\n"}], "owner": {"reputation": 31635, "user_id": 90723, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/56ee28134dd0776825445e3551979b14?s=128&d=identicon&r=PG", "display_name": "Bob Aman", "link": "https://stackoverflow.com/users/90723/bob-aman"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4027, "favorite_count": 12, "accepted_answer_id": 30357879, "answer_count": 1, "score": 25, "last_activity_date": 1432148623, "creation_date": 1432132325, "question_id": 30352725, "link": "https://stackoverflow.com/questions/30352725/why-is-my-hello-world-go-server-getting-crushed-by-apachebench", "title": "Why is my Hello World go server getting crushed by ApacheBench?", "body": "<pre><code>package main\n\nimport (\n    \"io\"\n    \"net/http\"\n)\n\nfunc hello(w http.ResponseWriter, r *http.Request) {\n    io.WriteString(w, \"Hello world!\\n\")\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", hello)\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n\n<p>I've got a couple of incredibly basic HTTP servers, and all of them are exhibiting this problem.</p>\n\n<pre><code>$ ab -c 1000 -n 10000 http://127.0.0.1:8000/\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1604373 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 1000 requests\nCompleted 2000 requests\nCompleted 3000 requests\nCompleted 4000 requests\nCompleted 5000 requests\napr_socket_recv: Connection refused (61)\nTotal of 5112 requests completed\n</code></pre>\n\n<p>With a smaller concurrency value, things still fall over. For me, the issue seems to show up around the 5k-6k mark usually:</p>\n\n<pre><code>$ ab -c 10 -n 10000 http://127.0.0.1:8000/\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1604373 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 1000 requests\nCompleted 2000 requests\nCompleted 3000 requests\nCompleted 4000 requests\nCompleted 5000 requests\nCompleted 6000 requests\napr_socket_recv: Operation timed out (60)\nTotal of 6277 requests completed\n</code></pre>\n\n<p>And in fact, you can drop concurrency entirely and the problem still (sometimes) happens:</p>\n\n<pre><code>$ ab -c 1 -n 10000 http://127.0.0.1:8000/\nThis is ApacheBench, Version 2.3 &lt;$Revision: 1604373 $&gt;\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\nLicensed to The Apache Software Foundation, http://www.apache.org/\n\nBenchmarking 127.0.0.1 (be patient)\nCompleted 1000 requests\nCompleted 2000 requests\nCompleted 3000 requests\nCompleted 4000 requests\nCompleted 5000 requests\nCompleted 6000 requests\napr_socket_recv: Operation timed out (60)\nTotal of 6278 requests completed\n</code></pre>\n\n<p>I can't help but wonder if I'm hitting some kind of operating system limit somewhere? How would I tell? And how would I mitigate?</p>\n"}, {"tags": ["go", "negroni"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1432127655, "post_id": 30350317, "comment_id": 48793938, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/28418168/route-specific-middlewares-with-negroni\">Route-specific Middlewares with Negroni</a>"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1432127724, "post_id": 30350317, "comment_id": 48793991, "body": "that answer covers it pretty well, basically you add a negroni middleware chain as a router handler. The down side is that you lose direct access to the <code>httprouter.Params</code>"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1432127743, "post_id": 30350317, "comment_id": 48794006, "body": "I did see this one but as it was the same person answering his own question I wasn&#39;t convinced it was &quot;the way to do it&quot;"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1432127812, "post_id": 30350317, "comment_id": 48794062, "body": "I couldn&#39;t find a better way to do it myself. It seems legit, although with that caveat I mentioned."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1432127870, "post_id": 30350317, "comment_id": 48794103, "body": "BTW I ended up manually copying data from the request params to the post params so that the handlers can still access it."}, {"owner": {"reputation": 1247, "user_id": 2442403, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1f615cb1e409558cc935422ca6e844d5?s=128&d=identicon&r=PG", "display_name": "cat-t", "link": "https://stackoverflow.com/users/2442403/cat-t"}, "edited": false, "score": 0, "creation_date": 1475454097, "post_id": 30350317, "comment_id": 66936381, "body": "How did you manage to copy the request params over so the middleware handlers had access? Do you happen to have a gist somewhere I could look at?"}], "answers": [{"tags": [], "owner": {"reputation": 1, "user_id": 6611033, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3c21fe05143b7c736fbdf409a114f462?s=128&d=identicon&r=PG&f=1", "display_name": "Unni", "link": "https://stackoverflow.com/users/6611033/unni"}, "is_accepted": false, "score": 0, "last_activity_date": 1468973619, "last_edit_date": 1468973619, "creation_date": 1468973045, "answer_id": 38470384, "question_id": 30350317, "link": "https://stackoverflow.com/questions/30350317/negroni-route-specific-middleware/38470384#38470384", "title": "Negroni Route Specific Middleware", "body": "<p>Not sure if anyone is still looking for an answer. I think params can be retrieved by calling the router.Lookup function. Here is what I did:</p>\n\n<pre><code>_, params, _ :=  router.Lookup(\"GET\", req.URL.Path)\n</code></pre>\n\n<p>where router is an instance of httprouter.Router</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 949, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1468973619, "creation_date": 1432126551, "last_edit_date": 1432127318, "question_id": 30350317, "link": "https://stackoverflow.com/questions/30350317/negroni-route-specific-middleware", "title": "Negroni Route Specific Middleware", "body": "<p>I'm struggling to get my route specific middleware working with httprouter and Negroni. The login route requires <code>Middleware2</code> and all the other routes require <code>Middleware1</code>.</p>\n\n<p>So far I have:</p>\n\n<pre><code>func Main() {\n    router := httprouter.New()\n    protectedRoutes := httprouter.New()\n\n    DefineRoutes(router)\n    DefineProtectedRoutes(protectedRoutes)\n\n    //This is the block that I'm unsure about\n    //How can I introduce Middleware2 for a specific route?\n    n := negroni.New()\n    n.Use(negroni.HandlerFunc(Middleware1))\n    n.UseHandler(router)\n\n\n    n.Run(\":5000\")\n}\n\nfunc DefineRoutes(router *httprouter.Router) {\n    router.POST(\"/v1/users/authenticate\", UserLogin)\n    router.POST(\"/v1/users/authorize\", UserLogin)\n    router.POST(\"/v1/users/logout\", UserLogout)\n}\n\nfunc DefineProtectedRoutes(router *httprouter.Router) {\n    router.POST(\"/v1/users/login\", UserLogin)\n}\n</code></pre>\n\n<p>but now I'm a bit stuck as the examples on the site (<a href=\"https://github.com/codegangsta/negroni\" rel=\"nofollow\">https://github.com/codegangsta/negroni</a>) use the standard handlers.</p>\n"}, {"tags": ["string", "algorithm", "go"], "comments": [{"owner": {"reputation": 4938, "user_id": 2538473, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/uQJ0p.png?s=128&g=1", "display_name": "Hacketo", "link": "https://stackoverflow.com/users/2538473/hacketo"}, "edited": false, "score": 1, "creation_date": 1432121955, "post_id": 30348420, "comment_id": 48789584, "body": "&quot;Aa AA aAaAA&quot; may work"}], "answers": [{"comments": [{"owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "edited": false, "score": 1, "creation_date": 1432122174, "post_id": 30348579, "comment_id": 48789751, "body": "Thanks, exactly what i was looking for"}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1432125595, "last_edit_date": 1432125595, "creation_date": 1432121927, "answer_id": 30348579, "question_id": 30348420, "link": "https://stackoverflow.com/questions/30348420/finding-string-that-matches-specific-requirements/30348579#30348579", "title": "Finding string that matches specific requirements", "body": "<p><code>agent</code> must be 3 \"words\", 3 parts separated by spaces:</p>\n\n<pre><code>a := strings.Split(agent, \" \")\nif len(a) != 3 { return false }\n</code></pre>\n\n<p>1st and 2nd words must match case insensitive:</p>\n\n<pre><code>x := strings.EqualFold(b, c)\n</code></pre>\n\n<p>But not case sensitive:</p>\n\n<pre><code>y := b != strings.ToLower(c)\n</code></pre>\n\n<p>And 3rd word must contain the first 2 concatenated:</p>\n\n<pre><code>z := strings.Index(d, b+c) == 1 &amp;&amp; len(d) == 5\n</code></pre>\n\n<p>Starting at index <code>1</code> (prepend with any character) and must contain 5 chars (5 bytes) (postpend to have 5 chars/bytes).</p>\n\n<p><strong>Example:</strong></p>\n\n<pre><code>fmt.Println(accessible(\"A a _Aa__\"))\n</code></pre>\n\n<p><strong>Prints:</strong></p>\n\n<pre><code>true\n</code></pre>\n"}], "owner": {"reputation": 2119, "user_id": 1411047, "user_type": "registered", "accept_rate": 81, "profile_image": "https://www.gravatar.com/avatar/673ade5df575380a2e2cd5a0c1503784?s=128&d=identicon&r=PG", "display_name": "Avdept", "link": "https://stackoverflow.com/users/1411047/avdept"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 57, "favorite_count": 0, "accepted_answer_id": 30348579, "answer_count": 1, "score": 0, "last_activity_date": 1432125595, "creation_date": 1432121494, "last_edit_date": 1432122256, "question_id": 30348420, "link": "https://stackoverflow.com/questions/30348420/finding-string-that-matches-specific-requirements", "title": "Finding string that matches specific requirements", "body": "<p>There is a function that should return <code>true</code>:</p>\n\n<pre><code>func accessible(agent string) bool {\n  a := strings.Split(agent, \" \")\n  if len(a) != 3 { return false }\n  b := a[0]\n  c := a[1]\n  d := a[2]\n  x := strings.EqualFold(b, c)\n  y := b != strings.ToLower(c)\n  z := strings.Index(d, b+c) == 1 &amp;&amp; len(d) == 5\n  return x &amp;&amp; y &amp;&amp; z\n}\n</code></pre>\n\n<p>However I can't figure out which <code>string</code> input will match these requirements. Am I missing something?</p>\n\n<p>PS: This is task #3 from gocode.io</p>\n"}, {"tags": ["go", "smtp"], "answers": [{"comments": [{"owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "edited": false, "score": 0, "creation_date": 1432143235, "post_id": 30344625, "comment_id": 48805127, "body": "Ugh. It works on my other computer fine. Both running windows 10 preview so Im going to reinstall golang. Already tried reinstalling the packages before. THank you!"}], "tags": [], "owner": {"reputation": 3023, "user_id": 789774, "user_type": "registered", "accept_rate": 40, "profile_image": "https://i.stack.imgur.com/GrpmL.png?s=128&g=1", "display_name": "aamir", "link": "https://stackoverflow.com/users/789774/aamir"}, "is_accepted": true, "score": 1, "last_activity_date": 1432111617, "creation_date": 1432111617, "answer_id": 30344625, "question_id": 30342881, "link": "https://stackoverflow.com/questions/30342881/smtp-dialaspmx-l-google-com25-connection-error-but-putty-connections-work/30344625#30344625", "title": "smtp.Dial(&quot;ASPMX.L.GOOGLE.COM:25&quot;) connection error; but putty connections work", "body": "<p>I don't see any error on my machine.</p>\n\n<pre><code>package main\n\nimport (\n        \"fmt\"\n        \"net/smtp\"\n)\n\nfunc main() {\n        mxClient, err := smtp.Dial(\"ASPMX.L.GOOGLE.COM:25\")\n        if err != nil {\n                fmt.Println(err)\n        }\n        fmt.Printf(\"%#v\", mxClient)\n}\n</code></pre>\n\n<p>gives</p>\n\n<pre><code>&amp;smtp.Client{Text:(*textproto.Conn)(0xc208074000), conn:(*net.TCPConn)(0xc20802c018), tls:false, serverName:\"ASPMX.L.GOOGLE.COM\", ext:map[string]string(nil), auth:[]string(nil), localName:\"localhost\", didHello:false, helloError:error(nil)}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432143126, "post_id": 30356185, "comment_id": 48805074, "body": "If that was the case then it would be expected that anything making port 25 connections would be blocked but the OP says putty works fine."}, {"owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432150066, "post_id": 30356185, "comment_id": 48809144, "body": "Yes, sorry you are correct. I&#39;m experiencing a weird error myself now. When I use the code in aamir&#39;s answer I can&#39;t connect to &quot;ASPMX.L.GOOGLE.COM&quot; even when I change the port to 587. When I change the code to smtp.Dial(&quot;smtp.gmail.com:587&quot;) it works fine. But the thing is I telnet to ASPMX.L.GOOGLE.COM on 587 and it works fine. Its strange I can connect to &quot;aspmx....com&quot; using telnet but not Go?"}], "tags": [], "owner": {"reputation": 206, "user_id": 4824870, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/713f8db8763a5352eca7d85e67859e6f?s=128&d=identicon&r=PG&f=1", "display_name": "alex mullins", "link": "https://stackoverflow.com/users/4824870/alex-mullins"}, "is_accepted": false, "score": 0, "last_activity_date": 1432141874, "creation_date": 1432141874, "answer_id": 30356185, "question_id": 30342881, "link": "https://stackoverflow.com/questions/30342881/smtp-dialaspmx-l-google-com25-connection-error-but-putty-connections-work/30356185#30356185", "title": "smtp.Dial(&quot;ASPMX.L.GOOGLE.COM:25&quot;) connection error; but putty connections work", "body": "<p>Your ISP might be blocking port 25. I have to use port 587 to googles smtp server to connect.</p>\n"}], "owner": {"reputation": 597, "user_id": 3731722, "user_type": "registered", "accept_rate": 50, "profile_image": "https://graph.facebook.com/100000181698389/picture?type=large", "display_name": "vinniyo", "link": "https://stackoverflow.com/users/3731722/vinniyo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 623, "favorite_count": 0, "accepted_answer_id": 30344625, "answer_count": 2, "score": 0, "last_activity_date": 1432141874, "creation_date": 1432106447, "last_edit_date": 1432139697, "question_id": 30342881, "link": "https://stackoverflow.com/questions/30342881/smtp-dialaspmx-l-google-com25-connection-error-but-putty-connections-work", "title": "smtp.Dial(&quot;ASPMX.L.GOOGLE.COM:25&quot;) connection error; but putty connections work", "body": "<p>When using Go and <a href=\"https://golang.org/pkg/net/smtp/#Dial\" rel=\"nofollow\"><code>smtp.Dial</code></a>,\nor even <code>net.Dial</code>,\nI get the error:</p>\n\n<blockquote>\n  <p>dial tcp 64.233.169.27:25: ConnectEx tcp: A connection attempt failed\n  because the connected party did not properly respond after a period of\n  time, or established connection failed because connected host has\n  failed to respond.</p>\n</blockquote>\n\n<p>From this code:</p>\n\n<pre><code>mxClient, err := smtp.Dial(\"ASPMX.L.GOOGLE.COM:25\")\nif err != nil {\n    fmt.Println(err)\n}\n</code></pre>\n\n<p>What I don't understand is that I can connect and send commands (<code>HELO</code>, etc) using putty on port\u00a025 without TLS.\nIf it's a limitation of the package not able to make the connection,\nis there a recommended way to make a raw socket connection like putty in Go?</p>\n"}, {"tags": ["go", "apache-kafka"], "comments": [{"owner": {"reputation": 103, "user_id": 1723911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9449a5fac4e415ad9ead4984365ccfa?s=128&d=identicon&r=PG", "display_name": "snwight", "link": "https://stackoverflow.com/users/1723911/snwight"}, "edited": false, "score": 1, "creation_date": 1432138609, "post_id": 30342295, "comment_id": 48802459, "body": "owner &quot;none&quot; seems incorrect - can you tell us more about your OS and how you created the topic? i suspect this problem is more about the setup of the system environment than it is about your use of Sarama."}, {"owner": {"reputation": 175, "user_id": 1066556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f0ce4fd143ae885b7caa970b724012?s=128&d=identicon&r=PG", "display_name": "onfire", "link": "https://stackoverflow.com/users/1066556/onfire"}, "reply_to_user": {"reputation": 103, "user_id": 1723911, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d9449a5fac4e415ad9ead4984365ccfa?s=128&d=identicon&r=PG", "display_name": "snwight", "link": "https://stackoverflow.com/users/1723911/snwight"}, "edited": false, "score": 0, "creation_date": 1432172687, "post_id": 30342295, "comment_id": 48817769, "body": "@snwight   I create the topic with the line in <a href=\"http://kafka.apache.org/documentation.html#introduction\" rel=\"nofollow noreferrer\">link</a>  <code>bin&#47;kafka-topics.sh --describe --zookeeper localhost:2181 --topic my-replicated-topic</code>     My os is ubuntu 12.04.  It bothers me that I find no api to  create the consumer group explicitly, instead I create it implicitly by  putting it in the commitoffset api call."}, {"owner": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1432188647, "post_id": 30342295, "comment_id": 48822581, "body": "How do you start zookeeper?  How do you check that node exists?  Can you run bin/zkCli.sh and execute ls /consumers/ib/offsets/my-replicated-topic/0  What is the output?"}, {"owner": {"reputation": 175, "user_id": 1066556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f0ce4fd143ae885b7caa970b724012?s=128&d=identicon&r=PG", "display_name": "onfire", "link": "https://stackoverflow.com/users/1066556/onfire"}, "reply_to_user": {"reputation": 8146, "user_id": 3477832, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/44M2u.png?s=128&g=1", "display_name": "kostya", "link": "https://stackoverflow.com/users/3477832/kostya"}, "edited": false, "score": 0, "creation_date": 1432208249, "post_id": 30342295, "comment_id": 48835071, "body": "@kostya   I start zookeeper via <code>zookeeper-3.4.6&#47;bin&#47;zkServer.sh start</code> node  /consumers/ib  never exists on both circumstances. How can I create it?"}], "answers": [{"tags": [], "owner": {"reputation": 175, "user_id": 1066556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f0ce4fd143ae885b7caa970b724012?s=128&d=identicon&r=PG", "display_name": "onfire", "link": "https://stackoverflow.com/users/1066556/onfire"}, "is_accepted": false, "score": 0, "last_activity_date": 1432301003, "creation_date": 1432301003, "answer_id": 30397871, "question_id": 30342295, "link": "https://stackoverflow.com/questions/30342295/kafka-consumer-group-expired/30397871#30397871", "title": "kafka consumer group expired?", "body": "<p>Sarama does not talk to zookeeper, I should use high level consumer group library \ninstead. </p>\n\n<p><a href=\"https://github.com/Shopify/sarama/issues/452\" rel=\"nofollow\">https://github.com/Shopify/sarama/issues/452</a></p>\n"}], "owner": {"reputation": 175, "user_id": 1066556, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/17f0ce4fd143ae885b7caa970b724012?s=128&d=identicon&r=PG", "display_name": "onfire", "link": "https://stackoverflow.com/users/1066556/onfire"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2088, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1432301003, "creation_date": 1432104702, "last_edit_date": 1432208293, "question_id": 30342295, "link": "https://stackoverflow.com/questions/30342295/kafka-consumer-group-expired", "title": "kafka consumer group expired?", "body": "<p>Immediately after I commitoffset using the golang client.  <a href=\"https://github.com/Shopify/sarama\" rel=\"nofollow\">https://github.com/Shopify/sarama</a> </p>\n\n<pre><code>./kafka-consumer-offset-checker.sh --zookeeper=localhost:2181 --topic=my-replicated-topic --group=ib --broker-info \n\nGroup           Topic                          Pid Offset          logSize         Lag             Owner\n\nib              my-replicated-topic            0   12              12              0               none\n\nBROKER INFO\n\n1 -&gt; localhost:9093\n</code></pre>\n\n<p>However, after several minute, I run the same checker command.  </p>\n\n<pre><code>./kafka-consumer-offset-checker.sh --zookeeper=localhost:2181 --topic=my-replicated-topic --group=ib --broker-info \n\n\nExiting due to: org.apache.zookeeper.KeeperException$NoNodeException: KeeperErrorCode = NoNode for /consumers/ib/offsets/my-replicated-topic/0.\n</code></pre>\n\n<p>And I check the zookeeper, the node never exists at any time, even when checker list the offset correctly. </p>\n\n<p>sarama commit: 23d523386ce0c886e56c9faf1b9c78b07e5b8c90\nkafka 0.8.2.1\ngolang 1.3</p>\n\n<p>kafka server config:</p>\n\n<pre><code>broker.id=1\nport=9093\nnum.network.threads=3\n num.io.threads=8\nsocket.send.buffer.bytes=102400\nsocket.receive.buffer.bytes=102400\nsocket.request.max.bytes=104857600\nlog.dirs=/tmp/kafka-logs-1\nnum.partitions=1\nnum.recovery.threads.per.data.dir=1\nlog.retention.hours=168\nlog.segment.bytes=1073741824\nlog.retention.check.interval.ms=300000\nlog.cleaner.enable=false\nzookeeper.connect=localhost:2181\nzookeeper.connection.timeout.ms=6000\n</code></pre>\n\n<p>It seems to me that the consumer group get expired. How can I make the consumer group persist?</p>\n"}, {"tags": ["json", "parsing", "go"], "answers": [{"comments": [{"owner": {"reputation": 711, "user_id": 1232726, "user_type": "registered", "accept_rate": 55, "profile_image": "https://i.stack.imgur.com/Bg5nq.jpg?s=128&g=1", "display_name": "filthy_wizard", "link": "https://stackoverflow.com/users/1232726/filthy-wizard"}, "edited": false, "score": 1, "creation_date": 1476451007, "post_id": 30341941, "comment_id": 67364094, "body": "var holder interface{} \tjson.Unmarshal(message, &amp;holder) \treturn determineTypeHelper(holder.(map[string]interface{})) . iam doing this and getting the following error??? interface conversion: interface {} is nil, not map[string]interface {}"}, {"owner": {"reputation": 4888, "user_id": 947478, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1c5cd23c47d911ce446c57c658f22f10?s=128&d=identicon&r=PG&f=1", "display_name": "HellaMad", "link": "https://stackoverflow.com/users/947478/hellamad"}, "edited": false, "score": 0, "creation_date": 1485145583, "post_id": 30341941, "comment_id": 70786747, "body": "Just wanted to mention, <code>var f interface{}; err := yaml.Unmarshal(b, &amp;f)</code> also works with <code>github.com&#47;go-yaml&#47;yaml</code>."}, {"owner": {"reputation": 735, "user_id": 2536700, "user_type": "registered", "accept_rate": 72, "profile_image": "https://www.gravatar.com/avatar/2ac04fd32567ed44ddeaca257bcd6806?s=128&d=identicon&r=PG", "display_name": "Chris W", "link": "https://stackoverflow.com/users/2536700/chris-w"}, "edited": false, "score": 0, "creation_date": 1487716081, "post_id": 30341941, "comment_id": 71907656, "body": "I also get the error &quot;interface conversion: interface {} is nil, not map[string]interface {}&quot;. Any ideas?"}, {"owner": {"reputation": 2782, "user_id": 1822711, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/be72f7002ddb309d9b01bb6aea680b0d?s=128&d=identicon&r=PG", "display_name": "Joe Bergevin", "link": "https://stackoverflow.com/users/1822711/joe-bergevin"}, "edited": false, "score": 0, "creation_date": 1502309699, "post_id": 30341941, "comment_id": 78159137, "body": "interface{} is nil because the json string is not valid. results should be &quot;results&quot;. Here is a playground with the above code example (using the json correction): <a href=\"https://play.golang.org/p/RLodJLwy19\" rel=\"nofollow noreferrer\">play.golang.org/p/RLodJLwy19</a>"}], "tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": true, "score": 36, "last_activity_date": 1432126293, "last_edit_date": 1432126293, "creation_date": 1432103558, "answer_id": 30341941, "question_id": 30341588, "link": "https://stackoverflow.com/questions/30341588/how-to-parse-a-complicated-json-with-go-unmarshal/30341941#30341941", "title": "How to parse a complicated JSON with Go unmarshal?", "body": "<p>Citing from <a href=\"http://blog.golang.org/json-and-go\">JSON and Go</a>:</p>\n\n<blockquote>\n  <p>Without knowing this data's structure, we can decode it into an interface{} value with Unmarshal:</p>\n</blockquote>\n\n<pre><code>b := []byte(`{\n   \"k1\" : \"v1\", \n   \"k3\" : 10,\n   result:[\"v4\",12.3,{\"k11\" : \"v11\", \"k22\" : \"v22\"}]\n}`)\nvar f interface{}\nerr := json.Unmarshal(b, &amp;f)\n</code></pre>\n\n<blockquote>\n  <p>At this point the Go value in f would be a map whose keys are strings and whose values are themselves stored as empty interface values:</p>\n</blockquote>\n\n<pre><code>f = map[string]interface{}{\n    \"k1\": \"v1\",\n    \"k3\":  10,\n    \"result\": []interface{}{\n       \"v4\",\n       12.3,\n       map[string]interface{}{\n           \"k11\":\"v11\",\n           \"k22\":\"v22\",\n       },\n    },\n}\n</code></pre>\n\n<blockquote>\n  <p>To access this data we can use a type assertion to access <code>f</code>'s underlying map[string]interface{}:</p>\n</blockquote>\n\n<pre><code>m := f.(map[string]interface{})\n</code></pre>\n\n<blockquote>\n  <p>We can then iterate through the map with a range statement and use a type switch to access its values as their concrete types:</p>\n</blockquote>\n\n<pre><code>for k, v := range m {\n    switch vv := v.(type) {\n    case string:\n        fmt.Println(k, \"is string\", vv)\n    case int:\n        fmt.Println(k, \"is int\", vv)\n    case []interface{}:\n        fmt.Println(k, \"is an array:\")\n        for i, u := range vv {\n            fmt.Println(i, u)\n        }\n    default:\n        fmt.Println(k, \"is of a type I don't know how to handle\")\n    }\n}\n</code></pre>\n\n<blockquote>\n  <p>In this way you can work with unknown JSON data while still enjoying the benefits of type safety.</p>\n</blockquote>\n\n<p>More information about Go and JSON can be found in the original article. I  changed the code snippets slightly to be more similar to the JSON in the question.</p>\n"}, {"comments": [{"owner": {"reputation": 6004, "user_id": 717998, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/121dcfb4f05ed316247772545e2cd590?s=128&d=identicon&r=PG", "display_name": "errordeveloper", "link": "https://stackoverflow.com/users/717998/errordeveloper"}, "edited": false, "score": 0, "creation_date": 1509620594, "post_id": 40828598, "comment_id": 81095513, "body": "Didn&#39;t know about this one, thanks! I&#39;ve updated my post, as I happen to learn more about this stuff recently, hope that may be useful to you too."}], "tags": [], "owner": {"reputation": 2053, "user_id": 2044126, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/d3c4699963dc19f7ae7ff6833afd61c4?s=128&d=identicon&r=PG", "display_name": "changingrainbows", "link": "https://stackoverflow.com/users/2044126/changingrainbows"}, "is_accepted": false, "score": 5, "last_activity_date": 1480247353, "creation_date": 1480247353, "answer_id": 40828598, "question_id": 30341588, "link": "https://stackoverflow.com/questions/30341588/how-to-parse-a-complicated-json-with-go-unmarshal/40828598#40828598", "title": "How to parse a complicated JSON with Go unmarshal?", "body": "<p>More recently, <a href=\"https://github.com/tidwall/gjson\" rel=\"noreferrer\">gjson</a> offers selection of properties in JSON</p>\n\n<pre><code>k1 := gjson.Get(json, \"k1\")\nk33 : = gjson.Get(json, \"result.#.#.k33\")\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 6004, "user_id": 717998, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/121dcfb4f05ed316247772545e2cd590?s=128&d=identicon&r=PG", "display_name": "errordeveloper", "link": "https://stackoverflow.com/users/717998/errordeveloper"}, "is_accepted": false, "score": 4, "last_activity_date": 1509620527, "last_edit_date": 1509620527, "creation_date": 1482331405, "answer_id": 41265443, "question_id": 30341588, "link": "https://stackoverflow.com/questions/30341588/how-to-parse-a-complicated-json-with-go-unmarshal/41265443#41265443", "title": "How to parse a complicated JSON with Go unmarshal?", "body": "<h2>Using standard library <code>encoding/json</code> package</h2>\n\n<p>I've worked of <a href=\"https://blog.golang.org/json-and-go\" rel=\"nofollow noreferrer\">JSON and Go</a> article, and it turned out that <code>case int</code> doesn't work and it need to be <code>case float64</code> now, and there is plenty of nesting in real-world JSON.</p>\n\n<pre><code>&gt; go version\ngo version go1.7.1 darwin/amd64\n</code></pre>\n\n<p>I've also looked at <a href=\"http://attilaolah.eu/2013/11/29/json-decoding-in-go/\" rel=\"nofollow noreferrer\">JSON decoding in Go</a>, but it didn't help me very much as I needed to do proceduralrly traform it into a series of calls to mruby binding, and the author of that article is happy with Go structs for most part.</p>\n\n<p>I've spent a little while fiddling with this and final iterating dumper function looked like this:</p>\n\n<pre><code>func dumpJSON(v interface{}, kn string) {\n    iterMap := func(x map[string]interface{}, root string) {\n        var knf string\n        if root == \"root\" {\n            knf = \"%q:%q\"\n        } else {\n            knf = \"%s:%q\"\n        }\n        for k, v := range x {\n            dumpJSON(v, fmt.Sprintf(knf, root, k))\n        }\n    }\n\n    iterSlice := func(x []interface{}, root string) {\n        var knf string\n        if root == \"root\" {\n            knf = \"%q:[%d]\"\n        } else {\n            knf = \"%s:[%d]\"\n        }\n        for k, v := range x {\n            dumpJSON(v, fmt.Sprintf(knf, root, k))\n        }\n    }\n\n    switch vv := v.(type) {\n    case string:\n        fmt.Printf(\"%s =&gt; (string) %q\\n\", kn, vv)\n    case bool:\n        fmt.Printf(\"%s =&gt; (bool) %v\\n\", kn, vv)\n    case float64:\n        fmt.Printf(\"%s =&gt; (float64) %f\\n\", kn, vv)\n    case map[string]interface{}:\n        fmt.Printf(\"%s =&gt; (map[string]interface{}) ...\\n\", kn)\n        iterMap(vv, kn)\n    case []interface{}:\n        fmt.Printf(\"%s =&gt; ([]interface{}) ...\\n\", kn)\n        iterSlice(vv, kn)\n    default:\n        fmt.Printf(\"%s =&gt; (unknown?) ...\\n\", kn)\n    }\n}\n</code></pre>\n\n<p>With <code>b</code> being a byte slice with a JSON representing either an array or an object at the top-level, you can call it like this:</p>\n\n<pre><code>var f interface{}\nif err := json.Unmarshal(b, &amp;f); err != nil {\n    panic(err)\n}\ndumpJSON(f, \"root\")\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/WOMMJvUXUA\" rel=\"nofollow noreferrer\"><em>Hope this helps, you try the comple program here</em></a>.</p>\n\n<h2>Using other packages</h2>\n\n<p>I would recommend not doing it yourself, unless you feel you have to learn how Go types work and using <code>reflect</code> makes you feel like a master of the universe (personally, <code>reflect</code> drives me mad).</p>\n\n<p>As <a href=\"https://stackoverflow.com/users/2044126/changingrainbows\">@changingrainbows</a> <a href=\"https://stackoverflow.com/a/40828598/717998\">pointed out below</a>, there is <a href=\"https://github.com/tidwall/gjson\" rel=\"nofollow noreferrer\"><code>github.com/tidwall/gjson</code></a> package, which appears to wrap <code>encoding/json</code> and uses <code>reflect</code>. I may be not dissimilar from <code>github.com/mitchellh/reflectwalk</code>, which is pretty hard to use and inner workings are rather very complicated.</p>\n\n<p>I have used <a href=\"https://github.com/buger/jsonparser\" rel=\"nofollow noreferrer\"><code>github.com/buger/jsonparser</code></a> rather extensively in one of my projects, and there is also <a href=\"https://github.com/json-iterator/go\" rel=\"nofollow noreferrer\"><code>github.com/json-iterator/go</code></a>, which I've not tried yet, but it appears to be based on <code>github.com/buger/jsonparser</code> and appears to expose <code>enconding/json</code>-compatible interface and has <a href=\"https://godoc.org/github.com/json-iterator/go#Get\" rel=\"nofollow noreferrer\"><code>func Get(data []byte, path ...interface{}) Any</code></a> as well. For the record, Kubernetes project has recently switched to <code>github.com/json-iterator/go</code>.\nIn my project, I use <code>encoding/json</code> as well as <code>github.com/buger/jsonparser</code>, I'll probably switch to <code>github.com/json-iterator/go</code> when I have time. I will try to update this post with more findings.</p>\n"}], "owner": {"reputation": 192, "user_id": 494282, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/iUwPr.jpg?s=128&g=1", "display_name": "wells", "link": "https://stackoverflow.com/users/494282/wells"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15579, "favorite_count": 6, "accepted_answer_id": 30341941, "answer_count": 3, "score": 11, "last_activity_date": 1509620527, "creation_date": 1432102281, "last_edit_date": 1497955394, "question_id": 30341588, "link": "https://stackoverflow.com/questions/30341588/how-to-parse-a-complicated-json-with-go-unmarshal", "title": "How to parse a complicated JSON with Go unmarshal?", "body": "<p>In <code>go</code> the standard package <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"noreferrer\">encoding/json</a> exposes <code>json.Unmarshal</code> function to parse JSON.</p>\n\n<p>It's possible to either unmarshal the JSON string in a predefined <code>struct</code>, or use the <code>interface{}</code> and iterate the result for unexpected JSON data structure.</p>\n\n<p>That said, I can't parse complex JSON properly. Can someone tell me how to achieve this?</p>\n\n<pre><code> {\n     \"k1\" : \"v1\", \n     \"k2\" : \"v2\", \n     \"k3\" : 10, \n     \"result\" : [\n                 [\n                 [\"v4\", v5, {\"k11\" : \"v11\", \"k22\" : \"v22\"}]\n                 , ... , \n                 [\"v4\", v5, {\"k33\" : \"v33\", \"k44\" : \"v44\"}\n                 ]\n                 ], \n                 \"v3\"\n                ] \n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "edited": false, "score": 0, "creation_date": 1432093729, "post_id": 30339877, "comment_id": 48773519, "body": "What&#39;s the output of ioutil.ReadAll(resp.Body) ?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user849425"}, "edited": false, "score": 0, "creation_date": 1432094346, "post_id": 30339877, "comment_id": 48773677, "body": "Does this work if you comment out the <code>fmt.Printf(fmt.Sprintf(&quot;%s\\n&quot;, nutils.ReaderToString(req.Body)))</code> line? <code>r.Body</code> should be of type <code>io.ReadCloser</code> so it&#39;s possible the stream is being closed after <code>r.Body</code> gets read by the <code>fmt.Printf</code> statement."}, {"owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "edited": false, "score": 0, "creation_date": 1432094933, "post_id": 30339877, "comment_id": 48773856, "body": "@Mike, tried it, didnt work."}, {"owner": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "edited": false, "score": 0, "creation_date": 1432095118, "post_id": 30339877, "comment_id": 48773887, "body": "I wonder ReverseProxy is going to help you? <a href=\"http://golang.org/pkg/net/http/httputil/#ReverseProxy\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/httputil/#ReverseProxy</a>"}, {"owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "reply_to_user": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "edited": false, "score": 0, "creation_date": 1432095544, "post_id": 30339877, "comment_id": 48774004, "body": "@baijum on top of trying to get it to work, but also trying to understand how net/http requests work."}], "answers": [{"comments": [{"owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "edited": false, "score": 0, "creation_date": 1432094888, "post_id": 30340045, "comment_id": 48773844, "body": "tried it, doesn&#39;t work. can i copy the a Request Body and Header into the new Request? if so, how?"}, {"owner": {"reputation": 1432, "user_id": 1125040, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac3cf828ce88bb392fb51ede1306b897?s=128&d=identicon&r=PG", "display_name": "hsluo", "link": "https://stackoverflow.com/users/1125040/hsluo"}, "reply_to_user": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "edited": false, "score": 0, "creation_date": 1432095536, "post_id": 30340045, "comment_id": 48774000, "body": "Did you really mean to copy the body? Because from your command, the <code>email</code> is in url param. Have you tried copy url params?"}, {"owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "edited": false, "score": 0, "creation_date": 1432095977, "post_id": 30340045, "comment_id": 48774119, "body": "Yes, I mean to copy the body. it&#39;s not in the URL param. It&#39;s a POST form data."}], "tags": [], "owner": {"reputation": 1432, "user_id": 1125040, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/ac3cf828ce88bb392fb51ede1306b897?s=128&d=identicon&r=PG", "display_name": "hsluo", "link": "https://stackoverflow.com/users/1125040/hsluo"}, "is_accepted": false, "score": 0, "last_activity_date": 1432094465, "creation_date": 1432094465, "answer_id": 30340045, "question_id": 30339877, "link": "https://stackoverflow.com/questions/30339877/why-isnt-my-golang-post-request-being-populated-with-data/30340045#30340045", "title": "Why isn&#39;t my GoLang POST request being populated with data?", "body": "<p>You may want to set the request content type</p>\n\n<pre><code>req.Header.Set(\"Content-Type\", \"application/x-www-form-urlencoded\")\n</code></pre>\n\n<p>reference <a href=\"http://golang.org/src/net/http/client.go?s=14234:14316#L450\" rel=\"nofollow\">http://golang.org/src/net/http/client.go?s=14234:14316#L450</a></p>\n"}, {"comments": [{"owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "edited": false, "score": 0, "creation_date": 1432094882, "post_id": 30340071, "comment_id": 48773841, "body": "thanks, got it. but removing the printlns, nothing works still."}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 0, "last_activity_date": 1432094639, "creation_date": 1432094639, "answer_id": 30340071, "question_id": 30339877, "link": "https://stackoverflow.com/questions/30339877/why-isnt-my-golang-post-request-being-populated-with-data/30340071#30340071", "title": "Why isn&#39;t my GoLang POST request being populated with data?", "body": "<ol>\n<li><p>To fix your print output you need to change this:</p>\n\n<pre><code>fmt.Printf(fmt.Sprintf(\"%s\\n\", nutils.ReaderToString(req.Body)))\n</code></pre>\n\n<p>Into this:</p>\n\n<pre><code>fmt.Printf(\"%s\", fmt.Sprintf(\"%s\\n\", nutils.ReaderToString(req.Body)))\n</code></pre>\n\n<p>Or this:</p>\n\n<pre><code>fmt.Println(fmt.Sprintf(\"%s\\n\", nutils.ReaderToString(req.Body)))\n</code></pre></li>\n<li><p>By printing out the request body you are consuming it. Use a <code>TeeReader</code>:</p>\n\n<pre><code>req, _ := http.NewRequest(r.Method, fmt.Sprintf(\"%s%s\", apiUrl, u.Path), io.TeeReader(r.Body, os.Stdout))\n</code></pre>\n\n<p>And get rid of the <code>nutils.ReaderToString</code> call. You can only read once from a <code>Reader</code> (unless it's also a <code>Seeker</code> but then you still need to  <code>Seek</code> it before reusing it)</p></li>\n</ol>\n"}, {"tags": [], "owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "is_accepted": true, "score": 3, "last_activity_date": 1432096591, "creation_date": 1432096591, "answer_id": 30340366, "question_id": 30339877, "link": "https://stackoverflow.com/questions/30339877/why-isnt-my-golang-post-request-being-populated-with-data/30340366#30340366", "title": "Why isn&#39;t my GoLang POST request being populated with data?", "body": "<p>Got it. The problem was my endpoint in Python's Flask server does not support chunked encoding, which Go's Request insists on.</p>\n\n<p>When I manually specified the ContentLength like <code>req.ContentLength = 25</code>, it worked.</p>\n\n<p>Lesson learnt: It might not always be your Go code be the problem.</p>\n"}], "owner": {"reputation": 14470, "user_id": 118644, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/773932622381f87d558a0a28d478fc59?s=128&d=identicon&r=PG", "display_name": "nubela", "link": "https://stackoverflow.com/users/118644/nubela"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1334, "favorite_count": 1, "accepted_answer_id": 30340366, "answer_count": 3, "score": 3, "last_activity_date": 1432096591, "creation_date": 1432093277, "last_edit_date": 1432094264, "question_id": 30339877, "link": "https://stackoverflow.com/questions/30339877/why-isnt-my-golang-post-request-being-populated-with-data", "title": "Why isn&#39;t my GoLang POST request being populated with data?", "body": "<pre><code>func forwarderHandlerFunc(w http.ResponseWriter, r *http.Request) {\n    client := &amp;http.Client{}\n    u, _ := url.Parse(r.RequestURI)\n    req, _ := http.NewRequest(r.Method, fmt.Sprintf(\"%s%s\", apiUrl, u.Path), r.Body)\n    fmt.Printf(fmt.Sprintf(\"%s\\n\", nutils.ReaderToString(req.Body)))\n    resp, _ := client.Do(req)\n    resp.Write(w)\n}\n</code></pre>\n\n<p>I am trying to forward an incoming HTTP request to another endpoint, while copying the body, including POST/PUT form data into the new request.</p>\n\n<p>However, it doesn't seem to work, even if the Body seems to print out correct with data.</p>\n\n<p>Print output is:</p>\n\n<blockquote>\n  <p>email=meh%!g(MISSING)mail.com</p>\n</blockquote>\n\n<p>How can I fix it?</p>\n\n<hr>\n\n<p>Edit: Added more debug info, this time, printing out the output of resp</p>\n\n<pre><code>func forwarderHandlerFunc(w http.ResponseWriter, r *http.Request) {\n    client := &amp;http.Client{}\n    u, _ := url.Parse(r.RequestURI)\n\n    req, _ := http.NewRequest(r.Method, fmt.Sprintf(\"%s%s\", apiUrl, u.Path), r.Body)\n    fmt.Printf(fmt.Sprintf(\"%s\\n\", nutils.ReaderToString(req.Body)))\n\n    resp, _ := client.Do(req)\n    b,_ := ioutil.ReadAll(resp.Body)\n    fmt.Printf(fmt.Sprintf(\"%s\\n\", nutils.BytesToString(b)))\n\n    resp.Write(w)\n}\n</code></pre>\n\n<blockquote>\n<pre><code>$ go install &amp;&amp; gom-proxy-forwarder run --listen localhost:5002 --api-url http://localhost:5001\nemail=meh2%!g(MISSING)mail.com\n{\n  \"email\": null\n}\n</code></pre>\n</blockquote>\n\n<p>It should not be null. It should be <code>meh@gmail.com</code></p>\n"}, {"tags": ["dictionary", "concurrency", "go"], "comments": [{"owner": {"reputation": 257, "user_id": 20142, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/84c3d03cfaf0335b3e3a416133432853?s=128&d=identicon&r=PG", "display_name": "sdhjl2000", "link": "https://stackoverflow.com/users/20142/sdhjl2000"}, "edited": false, "score": 0, "creation_date": 1432087483, "post_id": 30339066, "comment_id": 48771984, "body": "<a href=\"http://play.golang.org/p/RqxEjTei2e\" rel=\"nofollow noreferrer\">play.golang.org/p/RqxEjTei2e</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432220389, "post_id": 30339066, "comment_id": 48844426, "body": "Given the defeciencies in the &quot;concurent-map&quot; package you&#39;re using (some mentioned in <a href=\"http://stackoverflow.com/a/30339509/55504\">David Budworth&#39;s answer</a>, there are more), and the ease of which you can add <code>sync.Mutex</code> yourself which locks what you actually need (which is often a little more than individual map accesses) I see no reason to use the package."}], "answers": [{"comments": [{"owner": {"reputation": 257, "user_id": 20142, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/84c3d03cfaf0335b3e3a416133432853?s=128&d=identicon&r=PG", "display_name": "sdhjl2000", "link": "https://stackoverflow.com/users/20142/sdhjl2000"}, "edited": false, "score": 0, "creation_date": 1432091716, "post_id": 30339509, "comment_id": 48773018, "body": "hi,i know the situation you describe so i try to find and write a thread safe map,i test with this <a href=\"https://gist.github.com/craigmj/5770480\" rel=\"nofollow noreferrer\">gist.github.com/craigmj/5770480</a> ,but all three structs  are  slow"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1432130367, "post_id": 30339509, "comment_id": 48796170, "body": "Do you mean to keep reusing the same keys over and over again? You&#39;re running 10k iterations over just 500 keys (so they&#39;re going to collide a lot). What actual use case are you trying to optimize? Your &quot;set and immediately read&quot; makes certain kinds of optimizations impossible (you can&#39;t batch writes). Is that your expected use? What kinds of keys do you really expect to use? How many? How much memory are you willing to spend for performance (with enough memory, you can use an array rather than map)? Are keys really random (there are benefits we could exploit there)? Use cases matter."}, {"owner": {"reputation": 257, "user_id": 20142, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/84c3d03cfaf0335b3e3a416133432853?s=128&d=identicon&r=PG", "display_name": "sdhjl2000", "link": "https://stackoverflow.com/users/20142/sdhjl2000"}, "reply_to_user": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1432170616, "post_id": 30339509, "comment_id": 48817208, "body": "@RobNapier,the key and value need be reused in real condition,the post code is just to test the channel work as a FIFO queue,finally i realize i miss understand the business logic"}], "tags": [], "owner": {"reputation": 9777, "user_id": 121631, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/85801ee3b7b70969f6713aaa5768ca20?s=128&d=identicon&r=PG", "display_name": "David Budworth", "link": "https://stackoverflow.com/users/121631/david-budworth"}, "is_accepted": false, "score": 0, "last_activity_date": 1432090541, "creation_date": 1432090541, "answer_id": 30339509, "question_id": 30339066, "link": "https://stackoverflow.com/questions/30339066/golang-thread-safe-map-with-channel-as-values-for-thread-safe/30339509#30339509", "title": "golang thread safe map with channel as values for thread safe", "body": "<p>You are using random keys, so more than one goroutine may get the same random number.</p>\n\n<p>if two routines get the same number at the same(ish) time, then</p>\n\n<p>This is a race condition:</p>\n\n<pre><code>if g.Has(key) == false {\n    g.Set(key, make(chan time.Time, 100))\n}\n</code></pre>\n\n<p>It is possible that h.Has is false for two goroutines at the SAME time and then they both set, so goroutine1 sets chan A, and goroutine2 sets chan B and then both end up using chan B</p>\n\n<p>In order to solve this, you need something like</p>\n\n<pre><code>SetIfAbsent\n</code></pre>\n\n<p>Which locks, checks if it exists, and if not, sets it, then unlocks.</p>\n\n<p>The library you linked map isn't super useful as a cache in that it provides no atomic SetIfAbsent type function.</p>\n\n<hr>\n\n<p>In the event there isn't a g.Has / g.Set race, then if two routines just happen to get the same key, and thus, same channel, you aren't guaranteed which value is first in queue and which is read first.</p>\n\n<p>so goroutine1 might read the value goroutine2 put in, or the other way around.</p>\n\n<p>When thinking about using shared state in a concurrently executing system, you have to assume that any other operation may happen between any statements / lines of code.</p>\n\n<p>I often like to think of it as, you should assume that each line of your code is run on each core one at a time.</p>\n\n<p>so, in Has/Set example it would be:</p>\n\n<pre><code>if g.Has(key) == false { // goroutine1\nif g.Has(key) == false { // goroutine2\n    g.Set(key, make(chan time.Time, 100)) //goroutine1\n    g.Set(key, make(chan time.Time, 100)) //goroutine2 \n} //goroutine1\n} //goroutine2\ntchan, _ := g.Get(key) //goroutine1\ntchan, _ := g.Get(key) //goroutine2\n</code></pre>\n\n<p>see where the bug is?  the second routine put it's channel in the map, but both retrieved that same channel on the tchan line.</p>\n\n<p>make sense?</p>\n"}], "owner": {"reputation": 257, "user_id": 20142, "user_type": "registered", "accept_rate": 20, "profile_image": "https://www.gravatar.com/avatar/84c3d03cfaf0335b3e3a416133432853?s=128&d=identicon&r=PG", "display_name": "sdhjl2000", "link": "https://stackoverflow.com/users/20142/sdhjl2000"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1357, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1432170791, "creation_date": 1432087285, "last_edit_date": 1432170791, "question_id": 30339066, "link": "https://stackoverflow.com/questions/30339066/golang-thread-safe-map-with-channel-as-values-for-thread-safe", "title": "golang thread safe map with channel as values for thread safe", "body": "<p>i use <a href=\"https://github.com/streamrail/concurrent-map\" rel=\"nofollow\">this</a> as concurrentmap,and  buffer channels as map value for thread safe(worked as queue),when test use 10 goroutines the value got from channel was not same with the one send in,any suggestion?</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"github.com/streamrail/concurrent-map\"\n\nfunc main() {\n    testmap := cmap.New()\n    fmt.Println(\"SyncMapNew:    \", TestInParallel(&amp;testmap, 10))\n}\n\nfunc TestInParallel(g *cmap.ConcurrentMap, n int) time.Duration {\n    start := time.Now()\n    var wait sync.WaitGroup\n\n    for i := 0; i &lt; n; i++ {\n        wait.Add(1)\n        go func() {\n            TheTest(g, rand.New(rand.NewSource(int64(i*500))))\n            wait.Done()\n        }()\n    }\n    wait.Wait()\n    return time.Now().Sub(start)\n}\n\nfunc TheTest(g *cmap.ConcurrentMap, rnd *rand.Rand) time.Duration {\n    start := time.Now()\n    var key string\n    var value time.Time\n    for i := 0; i &lt; 10000; i++ {\n        key = strconv.Itoa(int(rnd.Int31n(50000)))\n        if g.Has(key) == false {\n            g.Set(key, make(chan time.Time, 100))\n        }\n        tchan, _ := g.Get(key)\n        castchan := tchan.(chan time.Time)\n        value = time.Now()\n        castchan &lt;- value\n        got := &lt;-castchan\n        g.Set(key, castchan)\n        if value != got {\n            panic(fmt.Sprintf(\"ERROR: expected %v, got %v\", value, got))\n        }\n    }\n    return time.Now().Sub(start)\n}\n</code></pre>\n\n<p><strong>update</strong>i misunderstand the business logic,the code should like this</p>\n\n<pre><code>key = strconv.Itoa(int(rnd.Int31n(500)))\ntchan, _ := g.GetSet(key, make(chan time.Time, 100))\ncastchan := tchan.(chan time.Time)\nvalue = time.Now()\nif len(castchan) &gt;= 99 {\n   &lt;-castchan//do somthing here\n}\ncastchan &lt;- value\ng.Set(key, castchan)\n</code></pre>\n"}, {"tags": ["go", "download", "io"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 2, "creation_date": 1432093418, "post_id": 30338913, "comment_id": 48773447, "body": "<code>res.Body</code> is a stream, so once you&#39;ve read bytes from it once, you can&#39;t read them again. You&#39;d have to reconnect to redownload. Debug code should probably print the error. And if you&#39;re going to you really want to change that <code>goto</code> to something else, maybe <code>for tries := 5; tries &gt; 0; tries-- { ... }</code> and <code>break</code> out of the loop on success. (Finally, <a href=\"http://blogs.msdn.com/b/oldnewthing/archive/2005/11/07/489807.aspx\" rel=\"nofollow noreferrer\">auto-retries can cause problems</a>, so be careful.)"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 0, "last_activity_date": 1432093789, "creation_date": 1432093789, "answer_id": 30339943, "question_id": 30338913, "link": "https://stackoverflow.com/questions/30338913/io-copyn-cannot-work-when-it-is-not-called-the-first-time/30339943#30339943", "title": "io.copyN cannot work when it is not called the first time", "body": "<p>You need to retry the http request. (not just the <code>io.CopyN</code>) </p>\n\n<p>Here is a (mostly untested) implementation of a resumable download:</p>\n\n<pre><code>func downloadFile(dst *os.File, url string, offset int64) (int64, error) {\n    req, err := http.NewRequest(\"GET\", url, nil)\n    if err != nil {\n        return 0, err\n    }\n    // try to use a range header\n    if offset &gt; 0 {\n        req.Header.Set(\"Range\", fmt.Sprintf(\"bytes=%d-\", offset))\n    }\n    res, err := http.DefaultClient.Do(req)\n    if err != nil {\n        return 0, err\n    }\n    defer res.Body.Close()\n\n    // some http servers don't support range, so in that case we discard the first\n    // offset bytes\n    if offset &gt; 0 &amp;&amp; res.StatusCode != http.StatusPartialContent {\n        _, err = io.CopyN(ioutil.Discard, res.Body, offset)\n        if err != nil {\n            return offset, err\n        }\n    }\n\n    n, err := io.CopyN(dst, res.Body, res.ContentLength)\n    return offset + n, err\n}\n</code></pre>\n\n<p>You can pass that function an offset and it will try to pick up from that point (either by telling the HTTP server, or by discarding the bytes). It also returns the progress you've made, so you can then wrap this function in a retry loop:</p>\n\n<pre><code>func example() error {\n    f, err := os.Create(\"/tmp/pkg.png\")\n    if err != nil {\n        return err\n    }\n    defer f.Close()\n\n    offset := int64(0)\n    delay := time.Second\n    // try 5 times\n    for i := 0; i &lt; 5; i++ {\n        offset, err = downloadFile(f, \"http://golang.org/doc/gopher/pkg.png\", offset)\n        if err == nil {\n            return nil\n        }\n        // wait a little while before trying again\n        time.Sleep(delay)\n        delay *= 2\n    }\n    return fmt.Errorf(\"failed to download file after 5 tries\")\n}\n</code></pre>\n\n<p>Incidentally, you should really avoid using <code>goto</code> for loops.</p>\n"}], "owner": {"reputation": 1834, "user_id": 2791115, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/chocR.gif?s=128&g=1", "display_name": "simon_xia", "link": "https://stackoverflow.com/users/2791115/simon-xia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "accepted_answer_id": 30339943, "answer_count": 1, "score": -1, "last_activity_date": 1432093789, "creation_date": 1432086149, "question_id": 30338913, "link": "https://stackoverflow.com/questions/30338913/io-copyn-cannot-work-when-it-is-not-called-the-first-time", "title": "io.copyN cannot work when it is not called the first time", "body": "<p>I'm trying to download a image from a site, and the steps are as follow:</p>\n\n<ul>\n<li>use <code>http.Get</code> to fetch the image</li>\n<li>use <code>os.Create</code> to create a new file in current folder</li>\n<li>use <code>io.copyN</code> to copy the image into the file</li>\n</ul>\n\n<p>But it is weird if the <code>io.CopyN</code> is failed at the first time, it seems never success later </p>\n\n<p>code fragment\uff1a</p>\n\n<pre><code>    download_again:\n        copy_byte, copy_err := io.CopyN(file, res.Body, res.ContentLength)\n        fmt.Fprintf(os.Stderr, \"img(%s) size: %d\\n\", name, res.ContentLength)\n        if copy_err == nil &amp;&amp; res.ContentLength == copy_byte {\n            fmt.Fprintf(os.Stderr, \"Success to download img(%s)[%f KB(%d B)]: %s\\n\", img_url, float64(copy_byte)/1024, copy_byte, name)\n        } else {\n            if try_i &gt; download_times {\n                fmt.Fprintf(os.Stderr, \"[fatal] fail to download img(%s) %s\\n\", img_url, name)\n                fout.WriteString(name + \"\\n\")\n                return\n            }\n            fmt.Fprintf(os.Stderr, \"error in download img(%s)[%f KB(%d B)]: %s, try %d times\\n\", img_url, float64(copy_byte)/1024, copy_byte, name, try_i)\n            try_i++\n            goto download_again\n        }\n</code></pre>\n\n<p>and the output message:</p>\n\n<pre><code>img(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[171.447266 KB(175562 B)]: 11085\u00a0, try 1 times\nimg(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[0.000000 KB(0 B)]: 11085\u00a0, try 2 times\nimg(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[0.000000 KB(0 B)]: 11085, try 3 times\nimg(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[0.000000 KB(0 B)]: 11085, try 4 times\nimg(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[0.000000 KB(0 B)]: 11085, try 5 times\nimg(11085) size: 273047\nerror in download img(./style/images/dszp/11085.jpg)[0.000000 KB(0 B)]: 11085, try 6 times\n</code></pre>\n\n<p>Any help will be appreciated :)</p>\n"}, {"tags": ["go", "interface", "coding-style", "slice"], "comments": [{"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 6, "creation_date": 1432071863, "post_id": 30336616, "comment_id": 48767692, "body": "I would advise reimplementing it since it&#39;s three lines."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 1, "creation_date": 1432076414, "post_id": 30336616, "comment_id": 48769278, "body": "Since there are no generics -&gt; Reimplement"}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1432091834, "post_id": 30336616, "comment_id": 48773059, "body": "(The one other thing is if they&#39;re <i>really</i> similar maybe you really want <code>type Animal { Species, Name string; Age int }</code>. Not all distinct real-world categories have to map to distinct types in your programs.)"}, {"owner": {"reputation": 401, "user_id": 150136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91d8e5476a2a3fa2884c00f5ff996cb8?s=128&d=identicon&r=PG", "display_name": "Lich", "link": "https://stackoverflow.com/users/150136/lich"}, "reply_to_user": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 0, "creation_date": 1432221287, "post_id": 30336616, "comment_id": 48845106, "body": "Thanks @twotwotwo !   I think my examples are bad, in real project, these two structs are different in many ways, I just wish to make them both sortable by a numerical field, The first thing I thought of was interface, but found out that it is not supported. so just checking with stackoverflow in case i have missed anything"}], "answers": [{"comments": [{"owner": {"reputation": 401, "user_id": 150136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91d8e5476a2a3fa2884c00f5ff996cb8?s=128&d=identicon&r=PG", "display_name": "Lich", "link": "https://stackoverflow.com/users/150136/lich"}, "edited": false, "score": 0, "creation_date": 1444159004, "post_id": 30342591, "comment_id": 53780917, "body": "Thanks @johan, I am interested in go generate, too! Could you elaborate a little bit more about how we can use go generate in this case please?"}], "tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": false, "score": 0, "last_activity_date": 1432105582, "creation_date": 1432105582, "answer_id": 30342591, "question_id": 30336616, "link": "https://stackoverflow.com/questions/30336616/how-to-avoid-re-implementing-sort-interface-for-similar-golang-structs/30342591#30342591", "title": "How to avoid re-implementing sort.Interface for similar golang structs", "body": "<p>The best practice for this case would be to define</p>\n\n<pre><code>type Animal struct{\n    Species,Name string\n    Age int\n}\n</code></pre>\n\n<p>as suggested by twotwotwo. If cat and dog are similar enough to be sorted in the same way, they are also similar enough to be the same struct. If they are different in some way, then you should reimplement the interface for each type.</p>\n\n<p>An alternative could be to copy all pointers from your <code>[]*Cat</code> slice into a <code>[]SortableByAge</code> slice of the same size. If you are going to sort the slice, that will take O(n*log(n)) so an extra O(n) shouldn't be a performance issue.</p>\n\n<p>A third alternative, in the rare event that you have many types that for some reason have to be distinct but still have very simple sorting functions, you can look at autogenerating them with <a href=\"https://blog.golang.org/generate\" rel=\"nofollow\">go generate</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 12, "last_activity_date": 1471955330, "last_edit_date": 1471955330, "creation_date": 1432111575, "answer_id": 30344613, "question_id": 30336616, "link": "https://stackoverflow.com/questions/30336616/how-to-avoid-re-implementing-sort-interface-for-similar-golang-structs/30344613#30344613", "title": "How to avoid re-implementing sort.Interface for similar golang structs", "body": "<h2>This Specific Case</h2>\n\n<p>In this specific case you shouldn't use 2 different types as they are identical, just use a common <code>Animal</code> type:</p>\n\n<pre><code>type Animal struct {\n    Name string\n    Age  int\n}\n\nfunc (a Animal) String() string { return fmt.Sprintf(\"%s(%d)\", a.Name, a.Age) }\n\ntype SortAnim []*Animal\n\nfunc (c SortAnim) Len() int           { return len(c) }\nfunc (c SortAnim) Swap(i, j int)      { c[i], c[j] = c[j], c[i] }\nfunc (c SortAnim) Less(i, j int) bool { return c[i].Age &lt; c[j].Age }\n\nfunc main() {\n    dogs := []*Animal{&amp;Animal{\"Max\", 4}, &amp;Animal{\"Buddy\", 3}}\n    cats := []*Animal{&amp;Animal{\"Bella\", 4}, &amp;Animal{\"Kitty\", 3}}\n\n    fmt.Println(dogs)\n    sort.Sort(SortAnim(dogs))\n    fmt.Println(dogs)\n\n    fmt.Println(cats)\n    sort.Sort(SortAnim(cats))\n    fmt.Println(cats)\n}\n</code></pre>\n\n<p><strong>Output (<a href=\"http://play.golang.org/p/ME56Lo-3fQ\" rel=\"noreferrer\">Go Playground</a>):</strong></p>\n\n<pre><code>[Max(4) Buddy(3)]\n[Buddy(3) Max(4)]\n[Bella(4) Kitty(3)]\n[Kitty(3) Bella(4)]\n</code></pre>\n\n<h2>General Case</h2>\n\n<p>In general you can only use a common sorting implementation if you're willing to give up concrete types and use interface types instead.</p>\n\n<p>Create the interface type you want your slice to hold:</p>\n\n<pre><code>type Animal interface {\n    Name() string\n    Age() int\n}\n</code></pre>\n\n<p>You can have a common implementation of this:</p>\n\n<pre><code>type animal struct {\n    name string\n    age  int\n}\n\nfunc (a *animal) Name() string  { return a.name }\nfunc (a *animal) Age() int      { return a.age }\nfunc (a animal) String() string { return fmt.Sprintf(\"%s(%d)\", a.name, a.age) }\n</code></pre>\n\n<p>Your specific animal types:</p>\n\n<pre><code>type Dog struct {\n    animal  // Embed animal (its methods and fields)\n}\n\ntype Cat struct {\n    animal // Embed animal (its methods and fields)\n}\n</code></pre>\n\n<p>You implement <code>sort.Interface</code> on <code>SortAnim</code>:</p>\n\n<pre><code>type SortAnim []Animal\n\nfunc (c SortAnim) Len() int           { return len(c) }\nfunc (c SortAnim) Swap(i, j int)      { c[i], c[j] = c[j], c[i] }\nfunc (c SortAnim) Less(i, j int) bool { return c[i].Age() &lt; c[j].Age() }\n</code></pre>\n\n<p><strong>Using it:</strong></p>\n\n<pre><code>dogs := SortAnim{&amp;Dog{animal{\"Max\", 4}}, &amp;Dog{animal{\"Buddy\", 3}}}\ncats := SortAnim{&amp;Cat{animal{\"Bella\", 4}}, &amp;Cat{animal{\"Kitty\", 3}}}\n\nfmt.Println(dogs)\nsort.Sort(SortAnim(dogs))\nfmt.Println(dogs)\n\nfmt.Println(cats)\nsort.Sort(SortAnim(cats))\nfmt.Println(cats)\n</code></pre>\n\n<p><strong>Output (<a href=\"http://play.golang.org/p/Z5g_WVq5ho\" rel=\"noreferrer\">Go Playground</a>):</strong></p>\n\n<pre><code>[Max(4) Buddy(3)]\n[Buddy(3) Max(4)]\n[Bella(4) Kitty(3)]\n[Kitty(3) Bella(4)]\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 1, "creation_date": 1480683743, "post_id": 40667316, "comment_id": 69076615, "body": "Also, you simply create a Less (anonymous) lambda.    <code>sort.Slice(a, func(i, j int) bool { return a[i] &lt; a[j] })</code> This will sort in ascending order, if you want the opposite, simply write <code>a[i] &gt; a[j]</code> in the lambda."}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 9, "last_activity_date": 1479428419, "last_edit_date": 1479428419, "creation_date": 1479427928, "answer_id": 40667316, "question_id": 30336616, "link": "https://stackoverflow.com/questions/30336616/how-to-avoid-re-implementing-sort-interface-for-similar-golang-structs/40667316#40667316", "title": "How to avoid re-implementing sort.Interface for similar golang structs", "body": "<p>Note: as illustrated in <a href=\"https://github.com/golang/go/commit/ad26bb5e3098cbfd7c0ad9a1dc9d38c92e50f06e\" rel=\"noreferrer\">commit ad26bb5</a>, in Go 1.8 (Q1 2017), you won't have to implement <code>Len()</code> and <code>Swap()</code> and <code>Less()</code> since <a href=\"https://github.com/golang/go/issues/16721\" rel=\"noreferrer\">issue 16721</a> was resolved. Only <code>Less()</code> is needed, the rest is done by reflection.</p>\n\n<p>The problem was:</p>\n\n<blockquote>\n  <ol>\n  <li>Vast majority of sort.Interface uses a slice</li>\n  <li>Have to define a new top level type</li>\n  <li><code>Len</code> and <code>Swap</code> methods are always the same</li>\n  <li>Want to make common case simpler with least hit to performance</li>\n  </ol>\n</blockquote>\n\n<p>See the <a href=\"https://go-review.googlesource.com/#/c/27321/14/src/sort/sort.go\" rel=\"noreferrer\">new <code>sort.go</code></a>:</p>\n\n<pre><code>// Slice sorts the provided slice given the provided less function.\n//\n// The sort is not guaranteed to be stable. For a stable sort, use\n// SliceStable.\n//\n// The function panics if the provided interface is not a slice.\nfunc Slice(slice interface{}, less func(i, j int) bool) {\n    rv := reflect.ValueOf(slice)\n    swap := reflect.Swapper(slice)\n    length := rv.Len()\n    quickSort_func(lessSwap{less, swap}, 0, length, maxDepth(length))\n}\n</code></pre>\n\n<p>So as long as you have a <code>Less()</code> function comparing two instances respecting an interface, you can sort any number of struct respecting said common interface.</p>\n"}], "owner": {"reputation": 401, "user_id": 150136, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/91d8e5476a2a3fa2884c00f5ff996cb8?s=128&d=identicon&r=PG", "display_name": "Lich", "link": "https://stackoverflow.com/users/150136/lich"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5539, "favorite_count": 5, "accepted_answer_id": 40667316, "answer_count": 3, "score": 10, "last_activity_date": 1530598218, "creation_date": 1432071543, "last_edit_date": 1530598218, "question_id": 30336616, "link": "https://stackoverflow.com/questions/30336616/how-to-avoid-re-implementing-sort-interface-for-similar-golang-structs", "title": "How to avoid re-implementing sort.Interface for similar golang structs", "body": "<p>There is one problem bothering me in Golang.\nSay I have 2 structs:</p>\n\n<pre><code>type Dog struct {\n   Name string\n   Breed string\n   Age int\n}\n\ntype Cat struct {\n    Name string\n    FavoriteFood string\n    Age int\n}\n</code></pre>\n\n<p>And when I try to sort <code>[]*Dog</code> and <code>[]*Cat</code> by <code>Age</code>, I have to define 2 different sort struct like:</p>\n\n<pre><code>type SortCat []*Cat\nfunc (c SortCat) Len() int {//..}\nfunc (c SortCat) Swap(i, j int) {//..}\nfunc (c SortCat) Less(i, j int) bool {//..}\n\ntype SortDog []*Dog\nfunc (c SortDog) Len() int {//..}\nfunc (c SortDog) Swap(i, j int) {//..}\nfunc (c SortDog) Less(i, j int) bool {//..}\n</code></pre>\n\n<p>A natural thought is to implement some <code>SortableByAge</code> interface and create a <code>Less</code> function using the interface function. Like:</p>\n\n<pre><code>type SortableByAge interface {\n    AgeValue() int\n}\n</code></pre>\n\n<p>And then:</p>\n\n<pre><code>type SortAnimal []SortableByAge\nfunc (c SortDog) Less(i, j int) bool {\n    return c[i].AgeValue() &lt; c[j].AgeValue() \n}\n</code></pre>\n\n<p>However, according to:\n<a href=\"http://golang.org/doc/faq#convert_slice_of_interface\" rel=\"noreferrer\">http://golang.org/doc/faq#convert_slice_of_interface</a></p>\n\n<pre><code>dogs := make([]*Dogs, 0 , 1)\n//add dogs here\nsort.Sort(SortAnimal(dogs))\n</code></pre>\n\n<p>Above is not possible.</p>\n\n<p>So I wonder what is the best practice for this case and</p>\n\n<p>Is there any other technique that can reduce the need for implementing the <code>sort.Interface</code> for similar structs again and again that I have missed?</p>\n\n<p>EDIT: \nI realized that my examples are terrible :( </p>\n\n<p>In real life case, these 2 structs are very different, the only thing in common between them is that I wish to sort them by a common numeric value.</p>\n\n<p>A better example would be:</p>\n\n<pre><code>type Laptop {//...}\ntype Pizza {//...}\n</code></pre>\n\n<p>And the only thing these 2 structs share in common is that I wish to sort a slice(agh... should not have used <code>Pizza</code> in example) of them by price.</p>\n\n<p>So, combining them to a common struct is not really working for a lot of cases.\nBut will look into go generate.</p>\n"}, {"tags": ["mysql", "web-applications", "go"], "comments": [{"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "edited": false, "score": 0, "creation_date": 1432073596, "post_id": 30335865, "comment_id": 48768377, "body": "This question seems really opinion-based. Are you asking if code you haven&#39;t written will work? For guidelines, just search the web for examples. The best questions provide a specific code example and have a clear problem to solve."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1432076363, "post_id": 30335865, "comment_id": 48769262, "body": "Most frameworks and samples just use a global variable, yes."}], "answers": [{"tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": false, "score": 2, "last_activity_date": 1432129014, "creation_date": 1432129014, "answer_id": 30351337, "question_id": 30335865, "link": "https://stackoverflow.com/questions/30335865/best-way-to-integrate-database-into-go-web-application/30351337#30351337", "title": "Best way to integrate database into Go Web application", "body": "<p>I typically do something like this:</p>\n\n<pre><code>package main\n\nfunc main(){\n    db,err := sql.Open(...)\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer db.Close()\n    http.HandleFunc(\"/feed\", server.FeedHandler(db))\n    http.HandleFunc(\"/gui\", server.GuiHandler(db))\n    ...\n    log.Fatal(http.ListenAndServe(\":8000\", nil))\n}\n</code></pre>\n\n<p>Where <code>server</code> is a separate package where I define, implement and test all my http handlers.</p>\n\n<p>This is basically what you were thinking of but skipping the step of wrapping the db in a struct which isn't necessary. I would <strong>not</strong> recommend making the db a global variable. Having global dependencies will completely destroy any possibility of testing your http handlers in a reliable fashion.</p>\n\n<p>Dependency injecting the db, as in the example above, costs you two extra characters to type every time you call the function but it allows you to test your http handlers easily using the <a href=\"http://github.com/DATA-DOG/go-sqlmock\" rel=\"nofollow\">go-sqlmock package</a> which you definitely want to do as your web app grows.</p>\n\n<pre><code>package server\n\nfunc TestFeedHandler(t *testing.T){\n    mockdb, err := sqlmock.New()\n    if err != nil {\n        t.Errorf(\"An error '%s' was not expected when opening a stub database connection\", err)\n    }\n\n    columns := []string{\"id\", \"name\"}\n    sqlmock.ExpectQuery(\"SELECT id,name from persons;\").\n        WillReturnRows(sqlmock.NewRows(columns).\n        AddRow(1234, \"bob\")\n\n   handler := FeedHandler(mockdb)\n\n   // test that handler returns expected result\n\n}\n</code></pre>\n"}], "owner": {"reputation": 607, "user_id": 2704875, "user_type": "registered", "accept_rate": 41, "profile_image": "https://www.gravatar.com/avatar/d01a9368d31ce231b4de371504c2f878?s=128&d=identicon&r=PG&f=1", "display_name": "freetoplay", "link": "https://stackoverflow.com/users/2704875/freetoplay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 711, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1432142591, "creation_date": 1432068600, "last_edit_date": 1432142591, "question_id": 30335865, "link": "https://stackoverflow.com/questions/30335865/best-way-to-integrate-database-into-go-web-application", "title": "Best way to integrate database into Go Web application", "body": "<p>I'm new to developing web applications in Go.\nI'm looking for the best way to integrate a MySQL database into my web application.</p>\n\n<p>I was thinking of doing something like this:</p>\n\n<pre><code>type Context struct {\n     Database *sql.DB \n}\n// Some database methods like Close() and Query() for Context struct here\n</code></pre>\n\n<p>In the main function for my web application I would have something like this: </p>\n\n<pre><code>db := sql.Open(...)\nctx := Context{db}\n</code></pre>\n\n<p>I would then pass then pass my <code>Context</code> structure into various handlers that require a database connection. Would this be a good design decision or is there a better way to integrate a SQL database into my web application? </p>\n"}, {"tags": ["git", "go", "libgit2"], "answers": [{"comments": [{"owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "edited": false, "score": 0, "creation_date": 1432658221, "post_id": 30359304, "comment_id": 49008828, "body": "I dont want to keep local changes. I want the application to always replicate the git repository master branch. However there are times when on the server things can change, so when a new PULL is done, it cleans any changes to make sure that the pull will be successful. I.e the equivelent of clean -fd and reset --hard, then pull again. I.e I want no local changes to be saved."}], "tags": [], "owner": {"reputation": 5037, "user_id": 1370215, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/023e1295851b018af03706f391b76931?s=128&d=identicon&r=PG", "display_name": "Carlos Mart&#237;n Nieto", "link": "https://stackoverflow.com/users/1370215/carlos-mart%c3%adn-nieto"}, "is_accepted": false, "score": 3, "last_activity_date": 1432152083, "creation_date": 1432152083, "answer_id": 30359304, "question_id": 30334749, "link": "https://stackoverflow.com/questions/30334749/git2go-fetch-or-hard-pull/30359304#30359304", "title": "Git2Go Fetch or Hard Pull", "body": "<p>The git commands you want to replace and the code you're writing in go server very different purposes. A hard reset cannot be simulated in any way by a merge.</p>\n\n<p>If you do want to merge, you should check the resulting index for conflicts and resolve them if necessary. You then need to create the merge commit and update the current branch.</p>\n\n<p>If what you want is to do the steps of a hard reset, then you need to write those out, perform a checkout of your target tree, read the target tree into the index and write that out, and then update the current branch to the target commit.</p>\n\n<p>These are <em>very</em> different approaches to updates, one of them preserves local commits, the other one doesn't. One creates history, the other one doesn't. I would recomment first figuring out which form of update you wish to perform.</p>\n"}], "owner": {"reputation": 2849, "user_id": 1414721, "user_type": "registered", "accept_rate": 21, "profile_image": "https://www.gravatar.com/avatar/1fa39b39445863fdb74031c89f5e0e3e?s=128&d=identicon&r=PG", "display_name": "amlwwalker", "link": "https://stackoverflow.com/users/1414721/amlwwalker"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 512, "favorite_count": 3, "answer_count": 1, "score": 1, "last_activity_date": 1432152083, "creation_date": 1432064569, "question_id": 30334749, "link": "https://stackoverflow.com/questions/30334749/git2go-fetch-or-hard-pull", "title": "Git2Go Fetch or Hard Pull", "body": "<p>I have a repository, however in some situations the files locally may get changed. I want to do a git pull and over write the changes with git2go. In normal git - i.e on the terminal I could do</p>\n\n<pre><code>git fetch --all\ngit reset --hard origin/master\n</code></pre>\n\n<p>I am therefore trying to do the same using git2go</p>\n\n<pre><code>func Pull(source string, dest string) error {\n    repo, err:= git.OpenRepository(dest)\n    remote, err:= repo.LookupRemote(\"origin\")\n    log.Println(repo) //print repo address\n\n    cbs := &amp;git.RemoteCallbacks{\n        CredentialsCallback:      credentialsCallback,\n        CertificateCheckCallback: certificateCheckCallback,\n    }\n\n    err = remote.SetCallbacks(cbs)\n    err = remote.Fetch([]string{}, \"\")\n    log.Println(\"fetch error: \", err) //print fetch error\n    remote_master, err := repo.LookupReference(\"refs/remotes/origin/master\")\n    mergeRemoteHead, err := repo.AnnotatedCommitFromRef(remote_master)\n    mergeHeads := make([]*git.AnnotatedCommit, 1)\n    mergeHeads[0] = mergeRemoteHead\n    err = repo.Merge(mergeHeads, nil, nil)\n    log.Println(\"err: \", err)\n    repo.StateCleanup() //print merge error\n    return err\n}\n</code></pre>\n\n<p>It compiles fine, and seems to run - it logs the error to be  however the overwritten files don't change to what they are remotely. I feel I am missing one key element...../</p>\n\n<p>The output I get is:</p>\n\n<pre><code>2015/05/19 20:40:15 GitHandler.go:44: &amp;{0x7f46cc000a40}\n2015/05/19 20:40:22 GitHandler.go:53: fetch error:  &lt;nil&gt;\n2015/05/19 20:40:22 GitHandler.go:59: err:  &lt;nil&gt;\n</code></pre>\n"}, {"tags": ["testing", "go", "integration-testing"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432058762, "post_id": 30332873, "comment_id": 48760595, "body": "Your two questions in your text don&#39;t really match the title of the question."}, {"owner": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "reply_to_user": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1432059381, "post_id": 30332873, "comment_id": 48760947, "body": "@inf I am looking forward to write integration tests in Go with <code>net&#47;http</code>. The above given code is what I am planning to take as the base. With the last two questions I was trying to explain the key integration that I need to test. Do you have any suggestion to improve title or the last two questions?"}, {"owner": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 1, "creation_date": 1432066889, "post_id": 30332873, "comment_id": 48765321, "body": "Your example test is not making an actual http request. <code>httptest.NewRecorder()</code> is just creating an implementation of <code>http.ResponseWriter</code> that lets you record what your http handler wrote. This is a fine approach to test http routes. The alternative is actually building and running your code while making actual http requests from your tests."}, {"owner": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "reply_to_user": {"reputation": 8805, "user_id": 1817176, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/479f89f122c20918e9fe81f856f0a8c6?s=128&d=identicon&r=PG", "display_name": "jmaloney", "link": "https://stackoverflow.com/users/1817176/jmaloney"}, "edited": false, "score": 0, "creation_date": 1432091955, "post_id": 30332873, "comment_id": 48773099, "body": "@jmaloney Thanks for your suggestion. I will continue this approach as it looks easier to write."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432138602, "post_id": 30332873, "comment_id": 48802455, "body": "And don&#39;t forget to check errors!"}], "answers": [{"tags": [], "owner": {"reputation": 400, "user_id": 1766885, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ef2477ca6031f47576951750c13766c8?s=128&d=identicon&r=PG", "display_name": "Frederick F. Kautz IV", "link": "https://stackoverflow.com/users/1766885/frederick-f-kautz-iv"}, "is_accepted": true, "score": 1, "last_activity_date": 1432067480, "creation_date": 1432067480, "answer_id": 30335581, "question_id": 30332873, "link": "https://stackoverflow.com/questions/30332873/how-to-write-integration-tests-for-net-http-based-code/30335581#30335581", "title": "How to write integration tests for net/http based code?", "body": "<p>If you want to instantiate a test server accessible over a random tcp port on 127.0.0.1, use the following:</p>\n\n<pre><code>httpHandler := getHttpHandler() // of type http.Handler\ntestServer := httptest.NewServer(httpHandler)\ndefer testServer.Close()\nrequest, err := http.NewRequest(\"GET\", testServer.URL+\"/my/url\", nil)\nclient := http.Client{}\nresponse, err := client.Do(request)\n</code></pre>\n\n<p>For more info, see <a href=\"https://golang.org/pkg/net/http/httptest/#NewServer\" rel=\"nofollow\">https://golang.org/pkg/net/http/httptest/#NewServer</a></p>\n"}], "owner": {"reputation": 1389, "user_id": 547840, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/d031826c72b27db3f6653b8f616dd7b5?s=128&d=identicon&r=PG", "display_name": "baijum", "link": "https://stackoverflow.com/users/547840/baijum"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 252, "favorite_count": 1, "accepted_answer_id": 30335581, "answer_count": 1, "score": 3, "last_activity_date": 1432091818, "creation_date": 1432058401, "last_edit_date": 1432091818, "question_id": 30332873, "link": "https://stackoverflow.com/questions/30332873/how-to-write-integration-tests-for-net-http-based-code", "title": "How to write integration tests for net/http based code?", "body": "<p>Here is an example code:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n)\n\nfunc Home(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"Hello, world!\"))\n}\n\nfunc Router() *http.ServeMux {\n    mux := http.NewServeMux()\n    mux.HandleFunc(\"/\", Home)\n    return mux\n}\n\nfunc main() {\n    mux := Router()\n    http.ListenAndServe(\":8080\", mux)\n}\n</code></pre>\n\n<p>This is the test case I wrote:</p>\n\n<pre><code>package main\n\nimport (\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc TestMain(t *testing.T) {\n    w := httptest.NewRecorder()\n    r, _ := http.NewRequest(\"GET\", \"/\", nil)\n    Router().ServeHTTP(w, r)\n    if w.Body.String() != \"Hello, world!\" {\n        t.Error(\"Wrong content:\", w.Body.String())\n    }\n}\n</code></pre>\n\n<p>Is this test really sending an HTTP request through a TCP socket and reaching the end point <code>/</code>? Or this is just calling the function without making an HTTP connection?</p>\n\n<p><strong>Update</strong></p>\n\n<p>Based on the answer given by @ffk I wrote the test like this:</p>\n\n<pre><code>func TestMain(t *testing.T) {\n    ts := httptest.NewServer(Router())\n    defer ts.Close()\n    req, _ := http.NewRequest(\"GET\", ts.URL+\"/\", nil)\n    client := http.Client{}\n    resp, _ := client.Do(req)\n    defer resp.Body.Close()\n    body, _ := ioutil.ReadAll(resp.Body)\n    if string(body) != \"Hello, world!\" {\n        t.Error(\"Wrong content:\", string(body))\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "middleware", "go-alice"], "answers": [{"comments": [{"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432055447, "post_id": 30331889, "comment_id": 48758557, "body": "Yeah I tried that but then I get: <code>cannot use c.basicAuthHandler (type func(http.ResponseWriter, *http.Request)) as type alice.Constructor in argument to alice.New</code>"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432055836, "post_id": 30331889, "comment_id": 48758800, "body": "@tommyd456: sorry, I didn&#39;t look at what <code>alice</code> was, and thought your function signature was correct. <code>alice.New</code> takes an <code>alice.Contructor</code> as arguments"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432056009, "post_id": 30331889, "comment_id": 48758894, "body": "So is it not possible to do what I want to do?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432056299, "post_id": 30331889, "comment_id": 48759062, "body": "Sure, you just need to create a function matching the signature of <code>type Constructor func(http.Handler) http.Handler</code>. You can use <code>http.HandlerFunc</code> to convert functions to handlers if you need (or you can use <code>http.Handlers</code> instead). You want your middleware to be wrapper of a handler, no a final handler itself. I&#39;ll come back and try to explain in an answer if I have time."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432060407, "post_id": 30331889, "comment_id": 48761567, "body": "Appreciate your help but do the handlers on the first line need to be <code>http.Handler</code>?"}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432060866, "post_id": 30331889, "comment_id": 48761815, "body": "The first line of the second code sample in your response that is."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "edited": false, "score": 0, "creation_date": 1432062353, "post_id": 30331889, "comment_id": 48762724, "body": "Really grateful for the help."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": true, "score": 1, "last_activity_date": 1432062245, "last_edit_date": 1432062245, "creation_date": 1432055190, "answer_id": 30331889, "question_id": 30331759, "link": "https://stackoverflow.com/questions/30331759/middleware-using-alice-and-httprouter/30331889#30331889", "title": "Middleware using Alice and HttpRouter", "body": "<p>Your middleware needs to have the signature</p>\n\n<pre><code>func(http.Handler) http.Handler\n</code></pre>\n\n<p>This way your middleware is wrapping handlers, not just providing a final handler. You need to accept an <code>http.Handler</code>, do whatever processing needs to be done, and call <code>ServeHTTP</code> on the next handler in the chain. Your basicAuthHandler example could look like this:</p>\n\n<pre><code>func (c *appContext) basicAuthHandler(h http.Handler) http.Handler {\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n        var app App\n        err := c.db.C(\"apps\").Find(bson.M{\"id\": \"abcde\"}).One(&amp;app)\n        if err != nil {\n            panic(err)\n        }\n        h.ServeHTTP(w, r)\n\n    })\n}\n</code></pre>\n\n<p>(though you don't want to <code>panic</code> in your app, and should provide a better error response)</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1027, "favorite_count": 0, "accepted_answer_id": 30331889, "answer_count": 1, "score": 0, "last_activity_date": 1489976629, "creation_date": 1432054798, "last_edit_date": 1489976629, "question_id": 30331759, "link": "https://stackoverflow.com/questions/30331759/middleware-using-alice-and-httprouter", "title": "Middleware using Alice and HttpRouter", "body": "<p>I can't seem to work out how to use middleware and Http Router properly together.</p>\n\n<p>My code is:</p>\n\n<pre><code>type appContext struct {\n  db *mgo.Database\n}\n\nfunc main(){\n  c := appContext{session.DB(\"db-name\")}\n  commonHandlers := alice.New(context.ClearHandler, basicAuthHandler)\n\n  router := NewRouter()\n  router.Post(\"/\", commonHandlers.ThenFunc(c.final))\n\n  http.ListenAndServe(\":5000\", router)\n}\n</code></pre>\n\n<p>The <strong>final</strong> middleware is:</p>\n\n<pre><code>func (c *appContext) final(w http.ResponseWriter, r *http.Request) {\n  log.Println(\"Executing finalHandler\")\n  w.Write([]byte(\"TESTING\"))\n}\n</code></pre>\n\n<p>but I want my <code>basicAuthHandler</code> to be part of the <strong>commonHandlers</strong>. It also needs the <code>context</code> so that I can query the db.</p>\n\n<p>I have tried this:</p>\n\n<pre><code>func (c *appContext) basicAuthHandler(w http.ResponseWriter, r *http.Request) {\n  var app App\n  err := c.db.C(\"apps\").Find(bson.M{\"id\":\"abcde\"}).One(&amp;app)\n  if err != nil {\n    panic(err)\n  }\n\n  //do something with the app\n}\n</code></pre>\n\n<p>but I get the error <strong>undefined: basicAuthHandler</strong>. I understand why I'm getting the error but I don't know how to avoid it. How can I provide the <code>context</code> to the <code>basicAuthHandler</code> and still use it in the <code>commonHandlers</code> list for Alice?</p>\n"}, {"tags": ["sql", "postgresql", "templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432055634, "post_id": 30331766, "comment_id": 48758669, "body": "In the application, I will use totally different query for the second query. The second query will be quite long <code>SELECT SIMILARITY</code> query. In above question, I gave simple query to make it easier to understand"}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432059212, "post_id": 30331766, "comment_id": 48760845, "body": "I&#39;m now trying to understand, and still unable to make it work"}], "tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 1, "last_activity_date": 1432054805, "creation_date": 1432054805, "answer_id": 30331766, "question_id": 30329793, "link": "https://stackoverflow.com/questions/30329793/golang-multiple-sql-query-generate-extra-empty-range/30331766#30331766", "title": "Golang: Multiple SQL query generate extra empty {{range.}}", "body": "<p>It looks right to me. You are running two separate queries:</p>\n\n<pre><code>rows, err := db.Query(\"SELECT title, content FROM gallery WHERE uri=$1\", c.Param(\"uritext\"))\nanotherquery, err := db.Query(\"SELECT id AS idnumber FROM gallery WHERE uri=$1\", c.Param(\"uritext\"))\n</code></pre>\n\n<p>And then creating a slice from both:</p>\n\n<pre><code>gallery = append(gallery, g)\ngallery = append(gallery, g)\n</code></pre>\n\n<p>So you have two rows:</p>\n\n<pre><code>{ \"Nation\", \"Nation...\", 0 }\n{ \"\", \"\", 5 }\n</code></pre>\n\n<p>Is that what you wanted? If you want them merged you can just change your query to:</p>\n\n<pre><code>SELECT title, content, id as idnumber FROM gallery WHERE uri=$1\n</code></pre>\n\n<p>If you wanted two separate lists then maybe you should have two separate types:</p>\n\n<pre><code>type Gallery struct {\n    Title, Content string\n}\ntype IDNumber string\n</code></pre>\n\n<p>Build two separate lists and use a combined object for your render:</p>\n\n<pre><code>type Model struct {\n    Galleries []Gallery\n    IDNumbers []IDNumber\n}\nreturn c.Render(http.StatusOK, \"onlytestingtpl\", Model{\n    Galleries: galleries,\n    IDNumbers: idnumbers,\n})\n</code></pre>\n\n<p>And your template ends up with:</p>\n\n<pre><code>{{range .Galleries}}\n&lt;tr&gt;\n    &lt;td&gt;{{.Title}}&lt;/td&gt;\n    &lt;td&gt;{{.Content}}&lt;/td&gt;\n&lt;/tr&gt;\n{{end}}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432056108, "post_id": 30331777, "comment_id": 48758951, "body": "Did you mean like this?: <code>err := anotherquery.Scan(&amp;g.Title, &amp;g.Content, &amp;g.Idnumber)</code>. Sorry, I hard to understand"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432061131, "post_id": 30331777, "comment_id": 48761968, "body": "@apasajja Yes. Otherwise, you&#39;re only scanning the <code>Idnumber</code>."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432062220, "post_id": 30331777, "comment_id": 48762643, "body": "Error <code>sql: expected 1 destination arguments in Scan, not 3</code> showing up when running the code you&#39;re suggested. I thing it because of the second query select one column. I cannot merge the queries because this is placeholder query. The real query is quite long."}, {"owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "edited": false, "score": 0, "creation_date": 1432084300, "post_id": 30331777, "comment_id": 48771210, "body": "I realized what Caleb said is right. Go confuse about the <code>range</code>, so that it inherit each other. I need to make both range different."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 1, "last_activity_date": 1432054829, "creation_date": 1432054829, "answer_id": 30331777, "question_id": 30329793, "link": "https://stackoverflow.com/questions/30329793/golang-multiple-sql-query-generate-extra-empty-range/30331777#30331777", "title": "Golang: Multiple SQL query generate extra empty {{range.}}", "body": "<p>You are not scanning title and content in your <code>anotherquery</code>:</p>\n\n<pre><code>err := anotherquery.Scan(&amp;g.Idnumber)\n</code></pre>\n\n<p>So the <code>g</code>'s title and content are set to empty string.</p>\n"}], "owner": {"reputation": 516, "user_id": 615477, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/a4e64855bb65ad093754ae4e91ddca7f?s=128&d=identicon&r=PG", "display_name": "apasajja", "link": "https://stackoverflow.com/users/615477/apasajja"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 605, "favorite_count": 0, "accepted_answer_id": 30331766, "answer_count": 2, "score": 0, "last_activity_date": 1432060560, "creation_date": 1432049028, "last_edit_date": 1432060560, "question_id": 30329793, "link": "https://stackoverflow.com/questions/30329793/golang-multiple-sql-query-generate-extra-empty-range", "title": "Golang: Multiple SQL query generate extra empty {{range.}}", "body": "<blockquote>\n  <p>In the application, I will use totally different query for the second\n  query. The second query will be quite long <code>SELECT SIMILARITY</code> query.\n  In this question, I give simple query to make it easier to understand</p>\n</blockquote>\n\n<p>I need to print data from PostgreSQL in template. Everything works fine but output HTML has extra <code>range</code>.</p>\n\n<p>Below is the HTML output. You can see the extra <code>range</code> that have no value:</p>\n\n<pre><code>&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;Title&lt;/th&gt;\n        &lt;th&gt;Content&lt;/th&gt;\n    &lt;/tr&gt;\n\n    &lt;tr&gt;\n        &lt;td&gt;Nation&lt;/td&gt;\n        &lt;td&gt;Nation has various meanings, and the meaning has changed over time&lt;/td&gt;\n    &lt;/tr&gt;\n\n    &lt;tr&gt;\n        &lt;td&gt;&lt;/td&gt;\n        &lt;td&gt;&lt;/td&gt;\n    &lt;/tr&gt;\n\n&lt;/table&gt;\n\n&lt;h1&gt;ID number:&lt;/h1&gt;\n\n&lt;h3&gt;&lt;/h3&gt;\n\n&lt;h3&gt;5&lt;/h3&gt;\n</code></pre>\n\n<p>Below is <code>server.go</code></p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"github.com/labstack/echo\"\n    _ \"github.com/lib/pq\"\n    \"html/template\"\n    \"io\"\n    \"log\"\n    \"net/http\"\n)\n\ntype Gallery struct {\n    Title, Content, Idnumber string\n}\n\ntype (\n    Template struct {\n        templates *template.Template\n    }\n)\n\nfunc (t *Template) Render(w io.Writer, name string, data interface{}) *echo.HTTPError {\n    if err := t.templates.ExecuteTemplate(w, name, data); err != nil {\n        return &amp;echo.HTTPError{Error: err}\n    }\n    return nil\n}\n\nfunc main() {\n    e := echo.New()\n\n    db, err := sql.Open(\"postgres\", \"user=postgres password=apassword dbname=lesson4 sslmode=disable\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    t := &amp;Template{\n        templates: template.Must(template.ParseFiles(\"public/views/testhere.html\")),\n    }\n    e.Renderer(t)\n\n    e.Get(\"/post/:uritext\", func(c *echo.Context) *echo.HTTPError {\n\n        rows, err := db.Query(\"SELECT title, content FROM gallery WHERE uri=$1\", c.Param(\"uritext\"))\n        anotherquery, err := db.Query(\"SELECT id AS idnumber FROM gallery WHERE uri=$1\", c.Param(\"uritext\"))\n        if err != nil {\n            log.Fatal(err)\n        }\n\n        gallery := []Gallery{}\n\n        for rows.Next() {\n            g := Gallery{}\n            err := rows.Scan(&amp;g.Title, &amp;g.Content)\n\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            gallery = append(gallery, g)\n        }\n\n        for anotherquery.Next() {\n            g := Gallery{}\n            err := anotherquery.Scan(&amp;g.Idnumber)\n\n            if err != nil {\n                log.Fatal(err)\n            }\n\n            gallery = append(gallery, g)\n        }\n\n        return c.Render(http.StatusOK, \"onlytestingtpl\", gallery)\n    })\n\n    e.Run(\":4444\")\n}\n</code></pre>\n\n<p>Below is template <code>public/views/testhere.html</code></p>\n\n<pre><code>{{define \"onlytestingtpl\"}}\n&lt;table&gt;\n    &lt;tr&gt;\n        &lt;th&gt;Title&lt;/th&gt;\n        &lt;th&gt;Content&lt;/th&gt;\n    &lt;/tr&gt;\n    {{range.}}\n    &lt;tr&gt;\n        &lt;td&gt;{{.Title}}&lt;/td&gt;\n        &lt;td&gt;{{.Content}}&lt;/td&gt;\n    &lt;/tr&gt;\n    {{end}}\n&lt;/table&gt;\n\n&lt;h1&gt;ID number:&lt;/h1&gt;\n{{range.}}\n&lt;h3&gt;{{.Idnumber}}&lt;/h3&gt;\n{{end}}\n\n{{end}}\n</code></pre>\n\n<p>I have feeling about the <code>range</code> in template but I have no idea since no error. </p>\n"}, {"tags": ["multithreading", "go", "queue"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1432048447, "post_id": 30329178, "comment_id": 48753910, "body": "If you want to process each task with a unique ID only once, then why not check uniqueness on the sending side? I.e. <code>if _, sent := alreadySentIDs[ID]; !sent { queue &lt;- task }</code>. With a mutex around it, of course."}, {"owner": {"reputation": 1511, "user_id": 808125, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/577b4a8c39937776ed66a7146578c2b0?s=128&d=identicon&r=PG", "display_name": "Gregory Kalabin", "link": "https://stackoverflow.com/users/808125/gregory-kalabin"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1432049178, "post_id": 30329178, "comment_id": 48754471, "body": "@Ainar-G I want to get the processing result as well, so your code should have else branch"}], "answers": [{"comments": [{"owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "reply_to_user": {"reputation": 1511, "user_id": 808125, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/577b4a8c39937776ed66a7146578c2b0?s=128&d=identicon&r=PG", "display_name": "Gregory Kalabin", "link": "https://stackoverflow.com/users/808125/gregory-kalabin"}, "edited": false, "score": 0, "creation_date": 1432123153, "post_id": 30329970, "comment_id": 48790435, "body": "Happy to help. I don&#39;t know how exactly your flow looks like, but have realised you can easily hit a deadlock with such a naive example. I&#39;ve edited my answer to discuss the issue a little bit further."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 5, "last_activity_date": 1432123007, "last_edit_date": 1432123007, "creation_date": 1432049475, "answer_id": 30329970, "question_id": 30329178, "link": "https://stackoverflow.com/questions/30329178/coalescing-items-in-channel/30329970#30329970", "title": "Coalescing items in channel", "body": "<p>If I understand the problem correctly, the simplest solution that comes into my mind is adding a middle layer between task senders (putting into <code>queue</code>) and workers (taking from <code>queue</code>). This, probably routine, would be responsible for storing current tasks (by ID) and broadcasting the results to every matching tasks.</p>\n\n<p>Pseugo code:</p>\n\n<pre><code>go func() {\n    active := make(map[TaskID][]Task)\n\n    for {\n        select {\n        case task := &lt;-queue:\n            tasks := active[task.ID]\n            // No tasks with such ID, start heavy work\n            if len(tasks) == 0 {\n                worker &lt;- task\n            }\n            // Save task for the result\n            active[task.ID] = append(active[task.ID], task)\n        case r := &lt;-response:\n            // Broadcast to all tasks\n            for _, task := range active[r.ID] {\n                task.Result &lt;- r.Result\n            }\n        }\n    }\n}()\n</code></pre>\n\n<p>No mutexes needed and probably no need to carry anything around either, workers will simply need to put all the results into this middle layer, which is then routing responses correctly. You could even easily add caching here if there's a chance clashing IDs can arrive some time apart.</p>\n\n<p><strong>Edit:</strong> I had this dream where the above code caused a deadlock. If you send a lot of requests at once and choke <code>worker</code> channel there's a serious problem \u2013 this middle layer routine is stuck on <code>worker &lt;- task</code> waiting for a worker to finish, but all the workers will be probably blocked on send to response channel (because our routine can't collect it). <a href=\"http://play.golang.org/p/dHerA7n0ro\" rel=\"nofollow\">Playable proof.</a></p>\n\n<p>One could think of adding some buffers into the channels but this is not a proper solution (unless you can design the system in such way the buffer will never fill up). There're a few ways of solving this problem; for example, you can run a separate routine for collecting responses, but then you would need to protect <code>active</code> map with a mutex. Doable. You could also put <code>worker &lt;- task</code> into a select, which would try to send task to a worker, receive new task (if nothing to send) or collect a response. One could take advantage of the fact that nil channel is never ready for communication (ignored by select), so you can alternate between receiving and sending tasks within a single select. Example:</p>\n\n<pre><code>go func() {\n    var next Task // received task which needs to be passed to a worker\n    in := queue // incoming channel (new tasks) -- active\n    var out chan Task // outgoing channel (to workers) -- inactive\n    for {\n        select {\n        case t := &lt;-in:\n            next = t // store task, so we can pass to worker\n            in, out = nil, worker // deactivate incoming channel, activate outgoing\n        case out &lt;- next:\n            in, out = queue, nil // deactivate outgoing channel, activate incoming\n        case r := &lt;-response:\n            collect &lt;- r\n        }\n    }\n}()\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/-atGSv3Dlf\" rel=\"nofollow\">play</a></p>\n"}], "owner": {"reputation": 1511, "user_id": 808125, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/577b4a8c39937776ed66a7146578c2b0?s=128&d=identicon&r=PG", "display_name": "Gregory Kalabin", "link": "https://stackoverflow.com/users/808125/gregory-kalabin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 377, "favorite_count": 0, "accepted_answer_id": 30329970, "answer_count": 1, "score": 2, "last_activity_date": 1432123007, "creation_date": 1432047414, "question_id": 30329178, "link": "https://stackoverflow.com/questions/30329178/coalescing-items-in-channel", "title": "Coalescing items in channel", "body": "<p>I have a function which receives tasks and puts them into a channel. Every task has ID, some properties and a channel where result will be placed. It looks like this</p>\n\n<pre><code>task.Result = make(chan *TaskResult)\nqueue &lt;- task\nresult := &lt;-task.Result\nsendReponse(result)\n</code></pre>\n\n<p>Another goroutine takes a task from the channel, processes it and puts the result into task's channel</p>\n\n<pre><code>task := &lt;-queue\ntask.Result &lt;- doExpensiveComputation(task)\n</code></pre>\n\n<p>This code works fine. But now I want to coalesce tasks in the <code>queue</code>. Task processing is a very expensive operation, so I want process all the tasks in the queue with the same IDs once. I see two ways of doing it. </p>\n\n<p>First one is not to put tasks with the same IDs to the queue, so when existing task arrives it will wait for it's copy to complete. Here is pseudo-code</p>\n\n<pre><code>if newTask in queue {\n  existing := queue.getById(newTask.ID)\n  existing.waitForComplete()\n  sendResponse(existing.ProcessingResult)\n} else {\n  queue.enqueue(newTask)\n}\n</code></pre>\n\n<p>So, I can implement it using go channel and map for random access + some synchronization means like mutex. What I don't like about this way is that I have to carry both map and channel around the code and keep their contents synchronized.</p>\n\n<p>The second way is to put all the tasks into queue, but to extract task and all the tasks with the same IDs from the queue when result arrives, then send result to all the tasks. Here is pseudo-code</p>\n\n<pre><code>someTask := queue.dequeue()\nresult := doExpensiveComputation(someTask)\nsomeTask.Result &lt;- result\nmoreTasks := queue.getAllWithID(someTask.ID)\nfor _,theSameTask := range moreTasks {\n  theSameTask.Result &lt;- result\n}\n</code></pre>\n\n<p>And I have an idea how to implement this using chan + map + mutex in the same way as above.</p>\n\n<p>And here is the question: is there some builtin/existing data structures which I can use for such a problem? Are there another (better) ways of doing this?</p>\n"}, {"tags": ["go", "middleware", "go-alice"], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 7, "last_activity_date": 1432047287, "creation_date": 1432047287, "answer_id": 30329118, "question_id": 30329012, "link": "https://stackoverflow.com/questions/30329012/http-router-and-middleware/30329118#30329118", "title": "HTTP Router and Middleware", "body": "<p>httprouter's <code>router.GET</code> works only with <a href=\"http://godoc.org/github.com/julienschmidt/httprouter#Handle\" rel=\"noreferrer\"><code>httprouter.Handle</code></a> type. Use the <a href=\"http://godoc.org/github.com/julienschmidt/httprouter#Router.Handler\" rel=\"noreferrer\"><code>Handler</code></a> method with <code>http.Handler</code>:</p>\n\n<pre><code>router.Handler(\"GET\", \"/\", commonHandlers.ThenFunc(final))\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2528, "favorite_count": 1, "accepted_answer_id": 30329118, "answer_count": 1, "score": 3, "last_activity_date": 1489925094, "creation_date": 1432047028, "last_edit_date": 1489925094, "question_id": 30329012, "link": "https://stackoverflow.com/questions/30329012/http-router-and-middleware", "title": "HTTP Router and Middleware", "body": "<p>I'm using Julien Schmidt's router for GoLang and trying to get it working with Alice to chain middleware. I'm getting this error:</p>\n\n<p><strong>cannot use commonHandlers.ThenFunc(final) (type http.Handler) as type httprouter.Handle in argument to router.GET</strong></p>\n\n<p>and I'm not quite sure why.</p>\n\n<p>My code is:</p>\n\n<pre><code>package main\n\nimport (\n  \"log\"\n    \"net/http\"\n\n    \"github.com/julienschmidt/httprouter\"\n  \"github.com/justinas/alice\"\n    \"gopkg.in/mgo.v2\"\n    //\"gopkg.in/mgo.v2/bson\"\n)\n\n\nfunc middlewareOne(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"Executing middlewareOne\")\n    next.ServeHTTP(w, r)\n    log.Println(\"Executing middlewareOne again\")\n  })\n}\n\nfunc middlewareTwo(next http.Handler) http.Handler {\n  return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n    log.Println(\"Executing middlewareTwo\")\n    if r.URL.Path != \"/\" {\n      return\n    }\n    next.ServeHTTP(w, r)\n    log.Println(\"Executing middlewareTwo again\")\n  })\n}\n\nfunc final(w http.ResponseWriter, r *http.Request) {\n  log.Println(\"Executing finalHandler\")\n  w.Write([]byte(\"OK\"))\n}\n\nfunc main() {\n    session, err := mgo.Dial(\"conn-string\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    commonHandlers := alice.New(middlewareOne, middlewareTwo)\n\n    router := httprouter.New()\n    router.GET(\"/\", commonHandlers.ThenFunc(final))\n\n    http.ListenAndServe(\":5000\", router)\n}\n</code></pre>\n"}, {"tags": ["go", "basic-authentication", "go-alice"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1432043627, "post_id": 30327588, "comment_id": 48749760, "body": "It&#39;s best not to misuse terms like <a href=\"https://en.wikipedia.org/wiki/Public_key\" rel=\"nofollow noreferrer\">public/private key</a> that have very specific meanings."}, {"owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432043725, "post_id": 30327588, "comment_id": 48749849, "body": "Ok, <code>app_id</code> and <code>secret</code>"}], "answers": [{"tags": [], "owner": {"reputation": 13739, "user_id": 38333, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/e2ea7c27233a9019a1f91a821726a4d4?s=128&d=identicon&r=PG", "display_name": "cd1", "link": "https://stackoverflow.com/users/38333/cd1"}, "is_accepted": true, "score": 3, "last_activity_date": 1432043761, "creation_date": 1432043761, "answer_id": 30327758, "question_id": 30327588, "link": "https://stackoverflow.com/questions/30327588/accessing-basic-auth-credentials/30327758#30327758", "title": "Accessing Basic Auth credentials", "body": "<p>Try running the function <a href=\"http://golang.org/pkg/net/http/#Request.BasicAuth\" rel=\"nofollow\"><code>BasicAuth</code></a> on the request:</p>\n\n<pre><code>user, password, ok := r.BasicAuth()\nif !ok {\n  // could not get basic authentication credentials\n}\n</code></pre>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 714, "favorite_count": 0, "accepted_answer_id": 30327758, "answer_count": 1, "score": 3, "last_activity_date": 1490023562, "creation_date": 1432043308, "last_edit_date": 1490023562, "question_id": 30327588, "link": "https://stackoverflow.com/questions/30327588/accessing-basic-auth-credentials", "title": "Accessing Basic Auth credentials", "body": "<p>I'm working on an API using GoLang. All calls to this API will contain a <code>public_key</code> (username) and some will also contain a <code>private_key</code> (password) in the Authorization header.</p>\n\n<p>I'm trying to figure out how to access the Auth header details so that I can check the credentials against a database.</p>\n\n<p>I'm using Julien Schmidt's router and Alice to chain middleware. My setup so far is:</p>\n\n<pre><code>func main() {\n    session, err := mgo.Dial(\"conn-string\")\n    if err != nil {\n        panic(err)\n    }\n    defer session.Close()\n    session.SetMode(mgo.Monotonic, true)\n\n    c := appContext{session.DB(\"db-name\")}\n    commonHandlers := alice.New(context.ClearHandler)\n    router := NewRouter()\n    router.Get(\"/\", commonHandlers.Append(basicAuthHandler).ThenFunc(c.mainHandler))\n\n    http.ListenAndServe(\":5000\", router)\n}\n</code></pre>\n\n<p>but I'm not sure how to continue with the <code>basicAuthHandler</code> function below. If the <code>public_key</code> is present I need to check that it's valid. The same for the <code>private_key</code> if that's included.</p>\n\n<pre><code>func basicAuthHandler(next http.Handler) http.Handler {\n    fn := func(w http.ResponseWriter, r *http.Request) {\n\n    }\n\n    return http.HandlerFunc(fn)\n}\n</code></pre>\n"}, {"tags": ["encryption", "go", "tripledes"], "answers": [{"comments": [{"owner": {"reputation": 23, "user_id": 1986987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4db5a78fb63eb6952b5f9d19a77f1ad?s=128&d=identicon&r=PG", "display_name": "Yury", "link": "https://stackoverflow.com/users/1986987/yury"}, "edited": false, "score": 0, "creation_date": 1432043039, "post_id": 30326520, "comment_id": 48749221, "body": "Frederick, thanks a lot! I just rewrite my code for creating new decrypter for each iteration and now it works fine."}, {"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1591318473, "post_id": 30326520, "comment_id": 110017980, "body": "Do you have an example of that, Yury?"}], "tags": [], "owner": {"reputation": 79161, "user_id": 1064226, "user_type": "registered", "profile_image": "https://graph.facebook.com/36912842/picture?type=large", "display_name": "Frederick Cheung", "link": "https://stackoverflow.com/users/1064226/frederick-cheung"}, "is_accepted": true, "score": 6, "last_activity_date": 1432040748, "creation_date": 1432040748, "answer_id": 30326520, "question_id": 30326141, "link": "https://stackoverflow.com/questions/30326141/triple-des-decryption-returns-wrong-first-16-bytes-of-when-decrypted-again/30326520#30326520", "title": "Triple DES decryption returns wrong first 16 bytes of when decrypted again", "body": "<p>Short version: don't reuse the decrypter object.</p>\n\n<p>Longer version: You're using a cipher in CBC mode: when encrypting the data, the plaintext for block N is XOR-ed with the ciphertext for block N-1 (or the IV, on the first block). On decryption this is done in reverse.</p>\n\n<p>This means that when you try and reuse your decrypter object you don't get the correct results because the state isn't correct - it is decrypting the blocks as if they were subsequent blocks in your message. A peculiarity of CBC is that an incorrect IV will only affect the first decrypted block.</p>\n"}], "owner": {"reputation": 23, "user_id": 1986987, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b4db5a78fb63eb6952b5f9d19a77f1ad?s=128&d=identicon&r=PG", "display_name": "Yury", "link": "https://stackoverflow.com/users/1986987/yury"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 586, "favorite_count": 0, "accepted_answer_id": 30326520, "answer_count": 1, "score": 2, "last_activity_date": 1432043314, "creation_date": 1432039794, "last_edit_date": 1432043314, "question_id": 30326141, "link": "https://stackoverflow.com/questions/30326141/triple-des-decryption-returns-wrong-first-16-bytes-of-when-decrypted-again", "title": "Triple DES decryption returns wrong first 16 bytes of when decrypted again", "body": "<p>I have a problem with decryption when I try to decrypt the same byte slice again.</p>\n\n<p>Example of code for clarification:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"crypto/cipher\"\n    \"crypto/des\"\n)\n\nconst (\n    // tripleKey is TripleDES key string (3x8 bytes)\n    tripleKey = \"12345678asdfghjkzxcvbnmq\"\n)\n\nvar (\n    encrypter cipher.BlockMode\n    decrypter cipher.BlockMode\n)\n\nfunc init() {\n    // tripleDESChiper is chiper block based on tripleKey used for encryption/decryption\n    tripleDESChiper, err := des.NewTripleDESCipher([]byte(tripleKey))\n    if err != nil {\n        panic(err)\n    }\n\n    // iv is Initialization Vector used for encrypter/decrypter creation\n    ciphertext := []byte(\"0123456789qwerty\")\n    iv := ciphertext[:des.BlockSize]\n\n    // create encrypter and decrypter\n    encrypter = cipher.NewCBCEncrypter(tripleDESChiper, iv)\n    decrypter = cipher.NewCBCDecrypter(tripleDESChiper, iv)\n}\n\nfunc main() {\n    message := \"12345678qwertyuia12345678zxcvbnm,12345678poiuytr\"\n    data := []byte(message)\n    hash := encrypt(data)\n\n    decoded1 := decrypt(hash)\n    decoded2 := decrypt(hash)\n    decoded3 := decrypt(hash)\n    decoded4 := decrypt(hash)\n\n\n    fmt.Printf(\"encrypted data :             %x\\n\", data)\n    fmt.Printf(\"1 try of decryption result : %x\\n\", decoded1)\n    fmt.Printf(\"2 try of decryption result : %x\\n\", decoded2)\n    fmt.Printf(\"3 try of decryption result : %x\\n\", decoded3)\n    fmt.Printf(\"4 try of decryption result : %x\\n\", decoded4)\n}\n\nfunc encrypt(msg []byte) []byte {\n    encrypted := make([]byte, len(msg))\n    encrypter.CryptBlocks(encrypted, msg)\n\n    return encrypted\n}\n\nfunc decrypt(hash []byte) []byte {\n    decrypted := make([]byte, len(hash))\n    decrypter.CryptBlocks(decrypted, hash)\n\n    return decrypted\n}\n</code></pre>\n\n<p>This code is also available and runnable\non <a href=\"http://play.golang.org/p/o0uWrm3MMV\" rel=\"nofollow\">the playground</a>.</p>\n\n<p>It gives the following result:</p>\n\n<pre><code>encrypted data :             313233343536373871776572747975696131323334353637387a786376626e6d2c3132333435363738706f6975797472\n1 try of decryption result : 313233343536373871776572747975696131323334353637387a786376626e6d2c3132333435363738706f6975797472\n2 try of decryption result : 5e66fa74456402c271776572747975696131323334353637387a786376626e6d2c3132333435363738706f6975797472\n3 try of decryption result : 5e66fa74456402c271776572747975696131323334353637387a786376626e6d2c3132333435363738706f6975797472\n4 try of decryption result : 5e66fa74456402c271776572747975696131323334353637387a786376626e6d2c3132333435363738706f6975797472\n</code></pre>\n\n<p>As you can see the first decryption works well and returns valid result,\nbut all other tries returns the wrong result.\nThe first 16 bytes of result is not as in source byte slice.</p>\n\n<p>Can somebody describe what I am doing wrong?</p>\n"}, {"tags": ["go", "cors"], "answers": [{"comments": [{"owner": {"reputation": 103, "user_id": 834628, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/111c6731d5f3e78db3cb3682c6906894?s=128&d=identicon&r=PG", "display_name": "jonobattle", "link": "https://stackoverflow.com/users/834628/jonobattle"}, "edited": false, "score": 0, "creation_date": 1432074064, "post_id": 30325711, "comment_id": 48768541, "body": "Thanks @Ainair-G, exactly what I needed."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1432038730, "creation_date": 1432038730, "answer_id": 30325711, "question_id": 30325483, "link": "https://stackoverflow.com/questions/30325483/golang-cors-global-setting-somehow/30325711#30325711", "title": "Golang + CORS. Global setting somehow?", "body": "<p>You can make a simple middleware for that:</p>\n\n<pre><code>type CORSMiddleware struct {\n    http.Handler\n}\n\nfunc (cm CORSMiddleware) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    cm.Handler.ServeHTTP(w, r)\n}\n</code></pre>\n\n<p>Then, you can use it like that:</p>\n\n<pre><code>var h http.Handler = CORSMiddleware{cont}\nr.Handle(\"/accounts\", h)\nr.Handle(\"/accounts/{id}\", h)\n</code></pre>\n"}], "owner": {"reputation": 103, "user_id": 834628, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/111c6731d5f3e78db3cb3682c6906894?s=128&d=identicon&r=PG", "display_name": "jonobattle", "link": "https://stackoverflow.com/users/834628/jonobattle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 890, "favorite_count": 0, "accepted_answer_id": 30325711, "answer_count": 1, "score": 3, "last_activity_date": 1432038730, "creation_date": 1432038077, "question_id": 30325483, "link": "https://stackoverflow.com/questions/30325483/golang-cors-global-setting-somehow", "title": "Golang + CORS. Global setting somehow?", "body": "<p>I'm trying out this small Go example <a href=\"https://github.com/jakecoffman/golang-rest-bootstrap\" rel=\"nofollow\">https://github.com/jakecoffman/golang-rest-bootstrap</a>, and so far so good.</p>\n\n<p>I'm trying to add CORS to allow my front-end app access.</p>\n\n<p>Here is my Main.go</p>\n\n<pre><code>func main() {\n\n    var err error\n\n    session, err = r.Connect(r.ConnectOpts{\n        Address:  \"localhost:28015\",\n        Database: \"demo\",\n        MaxOpen:  40,\n    })\n    if err != nil {\n        log.Fatalln(err.Error())\n    }\n\n    r := mux.NewRouter()\n    users.Init(r, session)\n    accounts.Init(r, session)\n\n    r.HandleFunc(\"/\", func(w http.ResponseWriter, r *http.Request) {\n        w.Header().Set(\"Access-Control-Allow-Origin\", \"*\")\n    })\n\n    port := \"9999\" // os.Getenv(\"PORT\")\n    log.Println(\"Serving on\", \":\"+port)\n    http.ListenAndServe(\":\"+port, context.ClearHandler(r))\n}\n</code></pre>\n\n<p>It allows CORS at the root url, but since the other routes are handled in the controllers I just can't seem to get CORS to work there as well.</p>\n\n<p>Here is part of the AccountController</p>\n\n<pre><code>func NewAccountController(r *mux.Router, s AccountService) *AccountController {\n    cont := AccountController{s}\n    r.Handle(\"/accounts\", cont)\n    r.Handle(\"/accounts/{id}\", cont)\n\n    return &amp;cont\n}\n</code></pre>\n\n<p>And</p>\n\n<pre><code>func (a AccountController) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n    code := http.StatusMethodNotAllowed\n    var data interface{}\n\n    defer func(c int) {\n        log.Println(r.URL, \"-\", r.Method, \"-\", code, r.RemoteAddr)\n    }(code)\n\n    if r.URL.Path == \"/accounts\" {\n        switch r.Method {\n        case \"GET\":\n            code, data = a.List(w, r)\n        case \"POST\":\n            code, data = a.Add(w, r)\n        default:\n            return\n        }\n    } else {\n        switch r.Method {\n        case \"GET\":\n            code, data = a.Get(w, r)\n        case \"PUT\":\n            code, data = a.Update(w, r)\n        case \"DELETE\":\n            code, data = a.Delete(w, r)\n        default:\n            return\n        }\n    }\n\n    w.WriteHeader(code)\n    w.Header().Set(\"Content-Type\", \"application/json\")\n\n    err := json.NewEncoder(w).Encode(data)\n    if err != nil {\n        log.Println(\"Failed to write data: \", err)\n        code = http.StatusInternalServerError\n    }\n}\n</code></pre>\n\n<p>Any ideas or pointers would be great.</p>\n\n<p>Thanks,</p>\n\n<p>JB</p>\n"}, {"tags": ["go", "precision"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1432009460, "post_id": 30316639, "comment_id": 48728488, "body": "Is the question too bad? I do not bite and take critique properly."}, {"owner": {"user_type": "does_not_exist", "display_name": "user4651282"}, "edited": false, "score": 0, "creation_date": 1432009967, "post_id": 30316639, "comment_id": 48728661, "body": "you can use this:<a href=\"https://golang.org/pkg/math/big/#Rat.FloatString\" rel=\"nofollow noreferrer\">golang.org/pkg/math/big/#Rat.FloatString</a>"}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432010322, "post_id": 30316639, "comment_id": 48728783, "body": "@Atomic_alarm the problem is that in this case I would already need to know the answer (as your method just converts a rational to string)"}], "answers": [{"comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432010245, "post_id": 30316778, "comment_id": 48728758, "body": "Wow, this is actually a really nice way to double the precision +1. A couple of my tests shows that it kind of work (will try to prove this)."}, {"owner": {"reputation": 6779, "user_id": 1524913, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/de3d107ed1ccad362b44763106a78178?s=128&d=identicon&r=PG", "display_name": "jeromej", "link": "https://stackoverflow.com/users/1524913/jeromej"}, "reply_to_user": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1432010437, "post_id": 30316778, "comment_id": 48728816, "body": "@SalvadorDali I added some explanation on how it works and how to proceed to find out how to add precision by yourself for some given set of operations."}], "tags": [], "owner": {"reputation": 6779, "user_id": 1524913, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/de3d107ed1ccad362b44763106a78178?s=128&d=identicon&r=PG", "display_name": "jeromej", "link": "https://stackoverflow.com/users/1524913/jeromej"}, "is_accepted": false, "score": 3, "last_activity_date": 1432011015, "last_edit_date": 1432011015, "creation_date": 1432009746, "answer_id": 30316778, "question_id": 30316639, "link": "https://stackoverflow.com/questions/30316639/arbitrary-precision-for-decimals-square-roots-in-golang/30316778#30316778", "title": "Arbitrary precision for decimals square roots in golang", "body": "<h2>Adding precision</h2>\n\n<p>There is probably a solution in go but as I don't code in go, here is a general solution.</p>\n\n<p>For instance if your selected language doesn't provide a solution to handle the precision of floats (already happened to me):</p>\n\n<p>If your language provides you N digits after the dot, you can, in the case of the square root, multiply the input, here <code>2</code>, by <code>10^(2*number_of_extra_digits)</code>.</p>\n\n<p>For instance if go would give you only <code>1.41</code> as an answer but you would want <code>1.4142</code>, then you ask it the square root of <code>2*10^(2*2) = 2*10000</code> instead and you get <code>141.42</code> as an answer. Now I leave it up to you to rectify the placement of the dot.</p>\n\n<p><strong>Explanation:</strong> There is some math magic behind it.</p>\n\n<p>If you were to want to add some precision to a simple division, you would just need to multiply the input by <code>10^number_of_extra_digits</code>.</p>\n\n<p>The trick is to multiply the input to get more precision as we can't multiply the output (the lost of precision already happened). It does work because most languages cut more decimals after the dot, than before it.</p>\n\n<p>So we just need to change the <em>output equation</em> to the <em>input equation</em> (when possible):</p>\n\n<p>For simple division: <code>(a/b) * 10 = (a*10)/b</code></p>\n\n<p>For square root: <code>sqrt(a) * 10 = sqrt(a) * sqrt(100) = sqrt(a*100)</code></p>\n\n<h2>Reducing precision</h2>\n\n<p>Some similar tinkering can also help to reduce the precision if needed.</p>\n\n<p>For instance if you were trying to calculate the progression of a download in percent, two digits after the dot.</p>\n\n<p>Let's say we downloaded 1 file on 3, then <code>1/3 * 100</code> would give us <code>33.33333333</code>.</p>\n\n<p>If there is no way to control the precision of this float, then you could do  <code>cast_to_an_int(1/3 * 100 * 100) / 100</code> to return <code>33.33</code>.</p>\n"}, {"comments": [{"owner": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "edited": false, "score": 2, "creation_date": 1432022534, "post_id": 30317680, "comment_id": 48734781, "body": "Here are some things which will make using <code>math&#47;big</code> a bit more natural. Instead of <code>b.Cmp(limit) == -1</code> write <code>b.Cmp(limit) &lt; 0</code> which gives you the idea of what you are testing, ie <code>b &lt; limit</code>.  Instead of <code>a = new(big.Int).Mul(a, hundred)</code> you can just write <code>a.Mul(a, hundred)</code> which saves making some new big ints."}, {"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "reply_to_user": {"reputation": 47884, "user_id": 164234, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/6b34a2a81515583dc95e5c0809db06bb?s=128&d=identicon&r=PG", "display_name": "Nick Craig-Wood", "link": "https://stackoverflow.com/users/164234/nick-craig-wood"}, "edited": false, "score": 0, "creation_date": 1432022646, "post_id": 30317680, "comment_id": 48734843, "body": "@NickCraig-Wood thank you for your suggestions. I will test them and update my answer."}, {"owner": {"reputation": 22907, "user_id": 2714852, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a6e4d0e8ce0d468dd3b93a97893b67b3?s=128&d=identicon&r=PG&f=1", "display_name": "twotwotwo", "link": "https://stackoverflow.com/users/2714852/twotwotwo"}, "edited": false, "score": 1, "creation_date": 1432047651, "post_id": 30317680, "comment_id": 48753252, "body": "That&#39;s awesome. <a href=\"http://tip.golang.org/pkg/math/big/\" rel=\"nofollow noreferrer\"><code>math&#47;big.Float</code></a> in 1.5 will get rid of the extra steps to use  ints like floats, but looks like you&#39;ll still have to write your own <code>sqrt</code> in terms of the arithmetic functions."}], "tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 5, "last_activity_date": 1432023055, "last_edit_date": 1432023055, "creation_date": 1432014526, "answer_id": 30317680, "question_id": 30316639, "link": "https://stackoverflow.com/questions/30316639/arbitrary-precision-for-decimals-square-roots-in-golang/30317680#30317680", "title": "Arbitrary precision for decimals square roots in golang", "body": "<p>This is my own implementation of square root calculation. While waiting for answers, I decided to give <a href=\"http://en.wikipedia.org/wiki/Methods_of_computing_square_roots\" rel=\"noreferrer\">methods of computing square roots</a> a try. It has a whole bunch of methods but at the very end I found a link to a  <a href=\"http://www.afjarvis.staff.shef.ac.uk/maths/jarvisspec02.pdf\" rel=\"noreferrer\">Square roots by subtraction</a> pdf, which I really liked because the description of the algorithm is only a couple of lines (and I have not seen it before in comparison to Newton's method).</p>\n\n<p>So here is my implementation (bigint is not really nice to work with in go):</p>\n\n<pre><code>func square(n int64, precision int64) string{\n    ans_int := strconv.Itoa(int(math.Sqrt(float64(n))))\n\n    limit   := new(big.Int).Exp(big.NewInt(10), big.NewInt(precision + 1), nil)\n    a       := big.NewInt(5 * n)\n    b       := big.NewInt(5)\n    five    := big.NewInt(5)\n    ten     := big.NewInt(10)\n    hundred := big.NewInt(100)\n\n    for b.Cmp(limit) &lt; 0{\n        if a.Cmp(b) &lt; 0{\n                a.Mul(a, hundred)\n            tmp := new(big.Int).Div(b, ten)\n            tmp.Mul(tmp, hundred)\n            b.Add(tmp, five)\n        } else {\n            a.Sub(a, b)\n            b.Add(b, ten)\n        }\n    }\n    b.Div(b, hundred)\n\n    ans_dec := b.String()\n\n    return ans_dec[:len(ans_int)] + \".\" + ans_dec[len(ans_int):]\n}\n</code></pre>\n\n<p><strong>P.S.</strong> thank you Nick Craig-Wood for making the code better with your amazing comment.</p>\n\n<p>And using it, one can find that <code>square(8537341, 50)</code> is:</p>\n\n<blockquote>\n  <p>2921.8728582879851242173838229735693053765773170487</p>\n</blockquote>\n\n<p>which is only by one last digit of from python's</p>\n\n<pre><code>getcontext().prec = 50\nprint str(Decimal(8537341).sqrt())\n</code></pre>\n\n<blockquote>\n  <p>2921.8728582879851242173838229735693053765773170488</p>\n</blockquote>\n\n<p>This one digit is off because the last digit is not really precise.</p>\n\n<p>As always <kbd><a href=\"http://play.golang.org/p/u1CoB4cwXy\" rel=\"noreferrer\">Go Playground</a></kbd>.</p>\n\n<p><strong>P.S.</strong> if someone would find a native way to do this, I would gladly give my accept and upvote.</p>\n"}], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1400, "favorite_count": 0, "accepted_answer_id": 30317680, "answer_count": 2, "score": 3, "last_activity_date": 1432023055, "creation_date": 1432008747, "last_edit_date": 1432014564, "question_id": 30316639, "link": "https://stackoverflow.com/questions/30316639/arbitrary-precision-for-decimals-square-roots-in-golang", "title": "Arbitrary precision for decimals square roots in golang", "body": "<p>I am looking for a way to calculate a square root with an arbitrary precision (something like 50 digits after the dot).</p>\n\n<p>In python, it is easily accessible with <a href=\"https://docs.python.org/2/library/decimal.html\" rel=\"nofollow\">Decimal</a>:</p>\n\n<pre><code>from decimal import *\ngetcontext().prec = 50\nDecimal(2).sqrt() # and here you go my 50 digits\n</code></pre>\n\n<p>After seeing the power of <code>math/big</code> I skimmed through the <a href=\"https://golang.org/pkg/math/big/#Rat\" rel=\"nofollow\">documentation</a> but have not found anything similar. </p>\n\n<p>So is my only option is to write some sort of <a href=\"http://en.wikipedia.org/wiki/Methods_of_computing_square_roots\" rel=\"nofollow\">numerical computing method</a> which will iteratively try to compute the answer?</p>\n"}, {"tags": ["sql", "database", "go", "go-gin"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432037463, "post_id": 30315951, "comment_id": 48744871, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/28284138/go-global-variable-and-short-variable-definition\">Go global variable and short variable definition</a>"}], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432037614, "post_id": 30316608, "comment_id": 48744986, "body": "and completely ignores the underlying cause\u2026"}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1432047417, "post_id": 30316608, "comment_id": 48753081, "body": "@DaveC can you clarify? I personally find it favorable to use a struct to pass the data I need, rather than declaring globals. It is also very acceptable to create a custom handler func for http stuff. What is wrong with my answer?"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432048598, "post_id": 30316608, "comment_id": 48754034, "body": "It ignores the fact that the OP&#39;s problem is due entirely to variable shadowing. Saying &quot;it&#39;s better to avoid globals and pass values instead&quot; is fine per-se but without even mentioning the shadowing problem it&#39;s more of a coment or workaround than an answer. At best it just defers the underlying issue until later when the OP really does want/need to use a global (or other case where shadowing often happens)."}, {"owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1432050749, "post_id": 30316608, "comment_id": 48755537, "body": "@DaveC This is a valid point. I&#39;ll edit my answer for posterity."}], "tags": [], "owner": {"reputation": 1447, "user_id": 3570747, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/RKIuH.png?s=128&g=1", "display_name": "vastlysuperiorman", "link": "https://stackoverflow.com/users/3570747/vastlysuperiorman"}, "is_accepted": true, "score": 2, "last_activity_date": 1432051406, "last_edit_date": 1495535278, "creation_date": 1432008564, "answer_id": 30316608, "question_id": 30315951, "link": "https://stackoverflow.com/questions/30315951/db-sql-db-declared-in-a-go-not-available-in-b-go/30316608#30316608", "title": "db *sql.DB declared in a.go not available in b.go", "body": "<p><strong>EDIT</strong>: \nAs pointed out by DaveC, the problem is that using <code>:=</code> initiates a variable in the local scope only. Declaring err beforehand will cause the sql.Open to save the connection in the global instead of creating a new local, as follows: </p>\n\n<pre><code>func main() {\n    var err error // &lt;- Declare err\n\n    // Use = instead of :=\n    db, err = sql.Open(\"mysql\", \"root:password@unix(/var/run/mysqld/mysqld.sock)/test.com?collation=utf8_general_ci\")\n    ...\n</code></pre>\n\n<p>This edit influenced by DaveC, tomasz, and Ben Darnell (Ben Darnell's answer: <a href=\"https://stackoverflow.com/questions/28284138/go-global-variable-and-short-variable-definition\">Go global variable and short variable definition</a>)</p>\n\n<p><strong>/EDIT</strong></p>\n\n<p>Personally, I prefer to avoid globals where possible. To do this, change GetUsers to take an argument *sql.DB. Then change your a.go to have a custom <code>gin.HandlerFunc</code> that is a database receiver. In the example I've created a tools struct that you could use to pass in many \"global\" things.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n\n    \"github.com/gin-gonic/gin\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar (\n    prefix = \"/api/v1\" // API prefix\n)\n\ntype tools struct {\n    db *sql.DB\n}\n\nfunc (t tools) dispatch() gin.HandlerFunc {\n    return func(c *gin.Context) {\n        GetUsers(t.db)\n    }\n}\n\n// Boots up this whole thing\nfunc main() {\n    // Setting up DB\n    db, err := sql.Open(\"mysql\", \"root:password@unix(/var/run/mysqld/mysqld.sock)/test.com?collation=utf8_general_ci\")\n\n    if err != nil {\n        panic(\"DB connection failed\")\n    }\n    defer db.Close()\n\n    t := tools{db}\n\n    r := gin.New()\n\n    r.Use(gin.Logger())\n\n    r.GET(prefix+\"/users\", t.dispatch())\n\n    r.Run(\":3000\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 3, "last_activity_date": 1432030264, "last_edit_date": 1432030264, "creation_date": 1432029319, "answer_id": 30322325, "question_id": 30315951, "link": "https://stackoverflow.com/questions/30315951/db-sql-db-declared-in-a-go-not-available-in-b-go/30322325#30322325", "title": "db *sql.DB declared in a.go not available in b.go", "body": "<p>I think this is a classic Go bug and it has nothing to do with using multiple files.</p>\n\n<p>This statement:</p>\n\n<pre><code>db, err := sql.Open(\"mysql\", ...)\n</code></pre>\n\n<p>declares new variable <code>db</code> in a main scope (note <code>:=</code>) and your global variable is untouched (nil).</p>\n\n<p>You can easily fix it:</p>\n\n<pre><code>var err error\ndb, err = sql.Open(\"mysql\", ...)\n</code></pre>\n"}], "owner": {"reputation": 335, "user_id": 4308307, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/d366c2e05b13f7656ac01985c23ed7a7?s=128&d=identicon&r=PG&f=1", "display_name": "Andrey", "link": "https://stackoverflow.com/users/4308307/andrey"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3513, "favorite_count": 1, "accepted_answer_id": 30316608, "answer_count": 2, "score": 0, "last_activity_date": 1575364607, "creation_date": 1432004069, "last_edit_date": 1575364607, "question_id": 30315951, "link": "https://stackoverflow.com/questions/30315951/db-sql-db-declared-in-a-go-not-available-in-b-go", "title": "db *sql.DB declared in a.go not available in b.go", "body": "<p>I have two .go files: a.go and b.go</p>\n\n<p>I'm declaring a global db *sql.DB for my mysql database connection.</p>\n\n<p>My goal is to declare db once and use it in all my package files, in this case b.go.</p>\n\n<p>Everything builds fine, but I get an error when hitting my API endpoint /users</p>\n\n<pre><code>22:48:52 app         | 2015/05/18 22:48:52 http: panic serving 127.0.0.1:55742: runtime error: invalid memory address or nil pointer dereference\ngoroutine 6 [running]:\nnet/http.func\u00b7011()\n    /usr/local/go/src/net/http/server.go:1130 +0xbb\ndatabase/sql.(*DB).conn(0x0, 0x4da104, 0x0, 0x0)\n    /usr/local/go/src/database/sql/sql.go:634 +0x7ae\ndatabase/sql.(*DB).query(0x0, 0x809e70, 0x16, 0x0, 0x0, 0x0, 0x7, 0x0, 0x0)\n    /usr/local/go/src/database/sql/sql.go:933 +0x43\ndatabase/sql.(*DB).Query(0x0, 0x809e70, 0x16, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\n    /usr/local/go/src/database/sql/sql.go:924 +0xa6\nmain.GetUsers(0x0, 0x0, 0x0)\n    /var/www/zazok.com/api/src/app/user.go:15 +0xc0\nmain.func\u00b7001(0xc2080424d0)\n    /var/www/zazok.com/api/src/app/app.go:35 +0x1f\ngithub.com/gin-gonic/gin.(*Context).Next(0xc2080424d0)\n    /var/www/zazok.com/api/src/github.com/gin-gonic/gin/context.go:114 +0x95\ngithub.com/gin-gonic/gin.func\u00b7006(0xc2080424d0)\n    /var/www/zazok.com/api/src/github.com/gin-gonic/gin/logger.go:49 +0x68\ngithub.com/gin-gonic/gin.(*Context).Next(0xc2080424d0)\n    /var/www/zazok.com/api/src/github.com/gin-gonic/gin/context.go:114 +0x95\ngithub.com/gin-gonic/gin.func\u00b7009(0x7f1123351408, 0xc208036280, 0xc2080328f0, 0x0, 0x0, 0x0)\n    /var/www/zazok.com/api/src/github.com/gin-gonic/gin/routergroup.go:57 +0xa3\ngithub.com/julienschmidt/httprouter.(*Router).ServeHTTP(0xc20803af60, 0x7f1123351408, 0xc208036280, 0xc2080328f0)\n    /var/www/zazok.com/api/src/github.com/julienschmidt/httprouter/router.go:299 +0x18e\ngithub.com/gin-gonic/gin.(*Engine).ServeHTTP(0xc208042000, 0x7f1123351408, 0xc208036280, 0xc2080328f0)\n    /var/www/zazok.com/api/src/github.com/gin-gonic/gin/gin.go:156 +0x4d\nnet/http.serverHandler.ServeHTTP(0xc208030120, 0x7f1123351408, 0xc208036280, 0xc2080328f0)\n    /usr/local/go/src/net/http/server.go:1703 +0x19a\nnet/http.(*conn).serve(0xc2080361e0)\n    /usr/local/go/src/net/http/server.go:1204 +0xb57\ncreated by net/http.(*Server).Serve\n    /usr/local/go/src/net/http/server.go:1751 +0x35e\n</code></pre>\n\n<p>a.go</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"github.com/gin-gonic/gin\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nvar (\n    prefix string = \"/api/v1\" // API prefix\n    db     *sql.DB\n)\n\n// Boots up this whole thing\nfunc main() {\n    // Setting up DB\n    db, err := sql.Open(\"mysql\", \"root:password@unix(/var/run/mysqld/mysqld.sock)/test.com?collation=utf8_general_ci\")\n    if err != nil {\n        panic(err)\n    }\n\n    defer db.Close()\n\n    err = db.Ping()\n    if err != nil {\n        panic(err)\n    }\n\n    r := gin.New()\n\n    r.Use(gin.Logger())\n\n    r.GET(prefix+\"/users\", func(c *gin.Context) {\n\n        t := GetUsers()\n\n        c.JSON(200, t)\n    })\n\n    r.Run(\":3000\")\n}\n</code></pre>\n\n<p>b.go</p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n)\n\ntype User struct {\n    Id          int    `json:\"id\"`\n    Name        string `json:\"name\"`\n}\n\nfunc GetUsers() []User {\n    a := []User{}\n\n    _, err := db.Query(\"SELECT name FROM users\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return a\n}\n</code></pre>\n"}, {"tags": ["testing", "go", "goconvey"], "answers": [{"tags": [], "owner": {"reputation": 4513, "user_id": 605022, "user_type": "registered", "accept_rate": 79, "profile_image": "https://i.stack.imgur.com/CRrSr.jpg?s=128&g=1", "display_name": "mdwhatcott", "link": "https://stackoverflow.com/users/605022/mdwhatcott"}, "is_accepted": true, "score": 1, "last_activity_date": 1432079236, "creation_date": 1432079236, "answer_id": 30338012, "question_id": 30315395, "link": "https://stackoverflow.com/questions/30315395/explicitly-specifying-the-main-package-to-run-tests-for-in-golang-with-goconvey/30338012#30338012", "title": "Explicitly specifying the main package to run tests for in golang with goconvey", "body": "<p>Profiles is one to accomplish this, but you can also specify a 'depth' for the runner:</p>\n\n<pre><code>$ goconvey -depth=0\n</code></pre>\n\n<p>A value of <code>0</code> limits the runner to the working directory.</p>\n\n<p>Run <code>goconvey -help</code> for details.</p>\n"}], "owner": {"reputation": 462, "user_id": 1365520, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/aa5f0c4003145813dec46fddbf8c470a?s=128&d=identicon&r=PG", "display_name": "mcbain83", "link": "https://stackoverflow.com/users/1365520/mcbain83"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 276, "favorite_count": 0, "accepted_answer_id": 30338012, "answer_count": 1, "score": 1, "last_activity_date": 1436559394, "creation_date": 1431999457, "last_edit_date": 1436559394, "question_id": 30315395, "link": "https://stackoverflow.com/questions/30315395/explicitly-specifying-the-main-package-to-run-tests-for-in-golang-with-goconvey", "title": "Explicitly specifying the main package to run tests for in golang with goconvey", "body": "<p>How do I explicitly say with my go test command to run only tests for the main package and not others in my source directory.</p>\n\n<p>At the moment it's working with <code>$go test -v</code>. But... I am using goconvey as well and it seems to be running recursively. According to this page <a href=\"https://github.com/smartystreets/goconvey/wiki/Profiles\" rel=\"nofollow\">https://github.com/smartystreets/goconvey/wiki/Profiles</a> I have a file where I can pass arguments into the go test command. I know you can <code>go test -v ./...</code> for recursive or <code>go test -c packagename/...</code> but how do I just do it for the main?</p>\n"}, {"tags": ["types", "go", "stack"], "comments": [{"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1431999604, "post_id": 30315334, "comment_id": 48726158, "body": "By not using the empty interface{}, but the actual struct. So in your sample: value HuffmanTree."}, {"owner": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1431999623, "post_id": 30315334, "comment_id": 48726164, "body": "A generic version in go is not possible."}, {"owner": {"reputation": 272, "user_id": 4234313, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0fe081e9b9eacdf4166046161afbfde3?s=128&d=identicon&r=PG&f=1", "display_name": "Inondle", "link": "https://stackoverflow.com/users/4234313/inondle"}, "reply_to_user": {"reputation": 1288, "user_id": 437276, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1b17c2d117a867b6d755ffa4d601ca42?s=128&d=identicon&r=PG", "display_name": "0x434D53", "link": "https://stackoverflow.com/users/437276/0x434d53"}, "edited": false, "score": 0, "creation_date": 1432001254, "post_id": 30315334, "comment_id": 48726534, "body": "@0x434D53 I tried replacing the interface{} with my huffmantree struct but it caused an error which said <code>can&#39;t load package: import cycle not allowed</code>."}], "answers": [{"comments": [{"owner": {"reputation": 272, "user_id": 4234313, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0fe081e9b9eacdf4166046161afbfde3?s=128&d=identicon&r=PG&f=1", "display_name": "Inondle", "link": "https://stackoverflow.com/users/4234313/inondle"}, "edited": false, "score": 0, "creation_date": 1432003753, "post_id": 30315625, "comment_id": 48727080, "body": "I re-implemented the stack encapsulated in its own type but its in the HuffmanTree file along with all the other Tree methods. I did this because If I try to build two packages that import eachother, (huffmantree uses util and util uses huffmantree) then it will give me an import cycle error. It looks pretty odd to go from un-exported stack methods to exported Huffman Tree methods though. Am I doing something wrong or do I have to include my stack code with the huffmantree code?"}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 272, "user_id": 4234313, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0fe081e9b9eacdf4166046161afbfde3?s=128&d=identicon&r=PG&f=1", "display_name": "Inondle", "link": "https://stackoverflow.com/users/4234313/inondle"}, "edited": false, "score": 1, "creation_date": 1432007913, "post_id": 30315625, "comment_id": 48728091, "body": "@lnondle A package named &quot;util&quot; is a sign that your code organisation can be improved (read: <a href=\"https://blog.golang.org/package-names\" rel=\"nofollow noreferrer\">blog.golang.org/package-names</a>). I&#39;d expect the stack to live in the same package as your HuffmanTree, possibly with better names (maybe: huffman.Tree, huffman.TreeStack), but not providing a stack and letting callers write their own (since it&#39;s trivial) is also tempting. But it&#39;s hard to give general advice without knowing your code and use-cases."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1432015228, "post_id": 30315625, "comment_id": 48730695, "body": "Please note that popping an element from a slice-stack should also fill the space of the popped element with a zero value, because the underlying array will still hold the value and prevent its memory to be reclaimed by the garbage collector. Not zeroing is ok with primitive value types (e.g. <code>int</code>) but not ok with pointers , maps, slices or structs which also have pointer fields etc."}, {"owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1432019978, "post_id": 30315625, "comment_id": 48733207, "body": "@icza true. I added a comment."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": true, "score": 7, "last_activity_date": 1615552189, "last_edit_date": 1615552189, "creation_date": 1432001380, "answer_id": 30315625, "question_id": 30315334, "link": "https://stackoverflow.com/questions/30315334/what-is-the-correct-way-to-implement-a-stack-in-go-so-that-it-will-store-structs/30315625#30315625", "title": "What is the correct way to implement a stack in Go so that it will store structs?", "body": "<p>The right way in go to implement a stack is simply to use a slice.</p>\n<pre><code>stack := []*HuffmanTree{}\n</code></pre>\n<p>You can push to the stack using <code>append</code>, and pop by writing:</p>\n<pre><code>v, stack := stack[len(stack)-1], stack[:len(stack)-1]\n</code></pre>\n<p>You could encapsulate it into its own type if you prefer, but a slice is easier to understand.</p>\n<pre><code>type Stack []*HuffmanTree{}\n\nfunc NewStack() *Stack {\n    var s []*HuffmanTree\n    return (*Stack)(&amp;s)\n}\n\nfunc (s *Stack) Pop() *HuffmanTree {\n   if len(*s) == 0 {\n      return nil\n    }\n    v = (*s)[len(*s)-1]\n    *s = (*s)[:len(*s)-1]\n    return v\n}\n\nfunc (s *Stack) Push(h *HuffmanTree) {\n    *s = append(*s, h)\n}\n</code></pre>\n<p>As icza observes, if the stacks live longer than the HuffmanTree objects, you may wish to zero the just-popped entry in your stack to allow the garbage collector to collect unreferenced objects.</p>\n"}], "owner": {"reputation": 272, "user_id": 4234313, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/0fe081e9b9eacdf4166046161afbfde3?s=128&d=identicon&r=PG&f=1", "display_name": "Inondle", "link": "https://stackoverflow.com/users/4234313/inondle"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1240, "favorite_count": 1, "accepted_answer_id": 30315625, "answer_count": 1, "score": 2, "last_activity_date": 1615552189, "creation_date": 1431998992, "last_edit_date": 1432000241, "question_id": 30315334, "link": "https://stackoverflow.com/questions/30315334/what-is-the-correct-way-to-implement-a-stack-in-go-so-that-it-will-store-structs", "title": "What is the correct way to implement a stack in Go so that it will store structs?", "body": "<p>I'm trying to make a stack that will store a series of Huffman Tree structs. Currently I'm using an implementation that I found on github. </p>\n\n<pre><code>package util\n\ntype item struct {\n    value interface{}\n    next  *item\n}\n\n//Stack the implementation of stack\n//this stack is not thread safe!\ntype Stack struct {\n    top  *item\n    size int\n}\n// Basic stack methods...\n</code></pre>\n\n<p>The problem is that when I store my Huffman tree structs in the stack I can't use any of the fields of the Huffman tree such as left/right child. </p>\n\n<pre><code>package huffmantree\n\ntype HuffmanTree struct {\n    freq   int\n    value  byte\n    isLeaf bool\n    left   *HuffmanTree\n    right  *HuffmanTree\n    code   []bool\n    depth  int\n}\n</code></pre>\n\n<p>How am I supposed to implement a stack in Go which will correctly store structs and allow access to their fields? </p>\n\n<p>Edit:\nI tried replacing the <code>interface {}</code> part with <code>huffmantree.HuffmanTree</code> (huffmantree struct) and got this error message: </p>\n\n<pre><code>can't load package: import cycle not allowed\npackage github.com/inondle/huffman/util\n    imports github.com/inondle/huffman/huffmantree\n    imports github.com/inondle/huffman/util\nimport cycle not allowed\n</code></pre>\n\n<p>My guess would be that the huffmantree class imports the util package and the stack has to import the huffmantree package so there is some sort of conflict? Anyone know what went wrong? </p>\n"}, {"tags": ["string", "replace", "go"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 5, "last_activity_date": 1471955349, "last_edit_date": 1471955349, "creation_date": 1431989582, "answer_id": 30314033, "question_id": 30313912, "link": "https://stackoverflow.com/questions/30313912/replace-specific-characters-with-appropriate-characters-in-given-word/30314033#30314033", "title": "Replace specific characters with appropriate characters in given word", "body": "<p>Basically this is what the <a href=\"http://golang.org/pkg/strings/#Map\" rel=\"nofollow\"><code>strings.Map()</code></a> function is for.</p>\n\n<blockquote>\n  <p>Map returns a copy of the string s with all its characters modified according to the mapping function. If mapping returns a negative value, the character is dropped from the string with no replacement.</p>\n</blockquote>\n\n<p><strong>Example</strong> (try it on the <a href=\"http://play.golang.org/p/Pl7qHBHbMC\" rel=\"nofollow\">Go Playground</a>):</p>\n\n<pre><code>func main() {\n    fmt.Println(strings.Map(rules, \"Try not to replace me\"))\n}\n\nfunc rules(r rune) rune {\n    switch r {\n    case 'n':\n        return 'm'\n    case 'a':\n        return 'e'\n    default:\n        return r\n    }\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>Try mot to replece me\n</code></pre>\n\n<h3>With a map</h3>\n\n<p>If you have many rules, you can shorten this code:</p>\n\n<pre><code>var repMap = map[rune]rune{\n    'a': 'e', 'n': 'm',\n}\n\nfunc rules2(r rune) rune {\n    if r2, ok := repMap[r]; ok {\n        return r2\n    }\n    return r\n}\n</code></pre>\n\n<p>Output is the same (<a href=\"http://play.golang.org/p/Pl7qHBHbMC\" rel=\"nofollow\">Go Playground</a>).</p>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": false, "score": 0, "last_activity_date": 1431989635, "creation_date": 1431989635, "answer_id": 30314043, "question_id": 30313912, "link": "https://stackoverflow.com/questions/30313912/replace-specific-characters-with-appropriate-characters-in-given-word/30314043#30314043", "title": "Replace specific characters with appropriate characters in given word", "body": "<p>How about creating a map with <code>string_from</code>, <code>string_to</code> and then applying it in a loop:</p>\n\n<pre><code>replacements := map[string]string{\n    \"n\": \"m\",\n    \"a\": \"e\",\n}\nfor s_from, s_to := range(replacements){\n    str = strings.Replace(str, s_from, s_to, -1)\n}\n</code></pre>\n\n<p>this way all your rules are easily and compactly defined. And you will get something like <kbd><a href=\"http://play.golang.org/p/w9JTqg1A8k\" rel=\"nofollow\">Go Playground</a></kbd></p>\n"}, {"tags": [], "owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "is_accepted": false, "score": 3, "last_activity_date": 1431998426, "creation_date": 1431998426, "answer_id": 30315259, "question_id": 30313912, "link": "https://stackoverflow.com/questions/30313912/replace-specific-characters-with-appropriate-characters-in-given-word/30315259#30315259", "title": "Replace specific characters with appropriate characters in given word", "body": "<p>If you're trying to replace more than one letter, then <a href=\"https://golang.org/pkg/strings/#Replacer\" rel=\"nofollow\"><code>strings.Replacer</code></a> is a very efficient way to go.</p>\n\n<pre><code>var r = strings.NewReplacer(\n    \"n\", \"m\",\n    \"a\", \"e\",\n    \"x\", \"ngma\",\n) // you can set it as a global variable and use it multiple times instead of creating a new one everytime. \n\nfunc main() {\n    fmt.Println(r.Replace(\"ax is a nurderer\"))\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/xXLmFptmtN\" rel=\"nofollow\"><kbd>playground</kbd></a></p>\n"}, {"tags": [], "owner": {"reputation": 387, "user_id": 4213589, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea736bdcd85cb6ebe9c7d13663781b7f?s=128&d=identicon&r=PG&f=1", "display_name": "\u8d75\u6d69\u7fd4", "link": "https://stackoverflow.com/users/4213589/%e8%b5%b5%e6%b5%a9%e7%bf%94"}, "is_accepted": false, "score": 0, "last_activity_date": 1431999295, "creation_date": 1431999295, "answer_id": 30315367, "question_id": 30313912, "link": "https://stackoverflow.com/questions/30313912/replace-specific-characters-with-appropriate-characters-in-given-word/30315367#30315367", "title": "Replace specific characters with appropriate characters in given word", "body": "<pre><code>package main\nimport (\n    \"fmt\"\n    \"strings\"\n)\n\nfunc main() {\nr := strings.NewReplacer(\"n\", \"m\", \"a\", \"e\")\nfmt.Println(r.Replace(\"Try not to replace me\"))\n}\n</code></pre>\n\n<p>the result : <a href=\"http://play.golang.org/p/kW6J0GFSML\" rel=\"nofollow\">http://play.golang.org/p/kW6J0GFSML</a><br>\nthe document : <a href=\"http://golang.org/pkg/strings/#NewReplacer\" rel=\"nofollow\">http://golang.org/pkg/strings/#NewReplacer</a></p>\n"}], "owner": {"reputation": 9004, "user_id": 1800871, "user_type": "registered", "accept_rate": 42, "profile_image": "https://i.stack.imgur.com/J3ezH.png?s=128&g=1", "display_name": "PaolaJ.", "link": "https://stackoverflow.com/users/1800871/paolaj"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 93, "favorite_count": 0, "answer_count": 4, "score": 2, "last_activity_date": 1471955349, "creation_date": 1431988787, "last_edit_date": 1431989991, "question_id": 30313912, "link": "https://stackoverflow.com/questions/30313912/replace-specific-characters-with-appropriate-characters-in-given-word", "title": "Replace specific characters with appropriate characters in given word", "body": "<p>I want to in words in sentence change every occurrence of <code>'n' with 'm'</code>, <code>'a' with 'e'</code> and  10 more rules. At the moment I am working calling sequental way for every rule like:</p>\n\n<pre><code>word = strings.Replace(word, \"n\", \"m\", -1)\nword = strings.Replace(word, \"a\", \"e\", -1)\n.... and 10 more times \n</code></pre>\n\n<p>Is there better way to replace in Go characters with another, given in map?</p>\n"}, {"tags": ["javascript", "json", "google-app-engine", "go", "polymer"], "answers": [{"tags": [], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "is_accepted": false, "score": 0, "last_activity_date": 1432022672, "creation_date": 1432022672, "answer_id": 30319961, "question_id": 30311770, "link": "https://stackoverflow.com/questions/30311770/pass-user-id-to-core-ajax-method-get-to-retrieve-data-in-google-cloud-storage/30319961#30319961", "title": "Pass user ID to core-ajax method GET to retrieve data in Google Cloud storage", "body": "<p>I partially solved in this way</p>\n\n<p>Javascript:</p>\n\n<pre><code>loadTrials : function loadTrials() {\n            var _this = this,\n                load = this.shadowRoot.querySelector('#load-trial');\n            //pass userID to core-ajax\n            _this.userID = _this.app.userSession.user;\n            load.url=\"http://url/loadTrials\";\n            load.go();\n            load.addEventListener('core-response', function(ev) {\n                var json = ev.detail.response;\n                _this.trialData = JSON.parse(json)['trial-data'];\n                console.log(JSON.parse(json)['trial-data'])\n            }, false);\n        }\n</code></pre>\n\n<p>HTML:</p>\n\n<pre><code>&lt;core-ajax id=\"load-trial\" params=\"{{userID}}\" method=\"GET\"&gt;&lt;/core-ajax&gt;\n</code></pre>\n\n<p>Go:</p>\n\n<pre><code>type trialStruct []struct {\n    Trial struct {\n        Index           int    `json:\"index\"`\n        Word            string `json:\"word\"`\n        WordDisplayTime int    `json:\"wordDisplayTime\"`\n        AnswerMaxTime   int    `json:\"answerMaxTime\"`\n        FixationTime    int    `json:\"fixationTime\"`\n        Train           bool   `json:\"train\"`\n        Test            bool   `json:\"test\"`\n        Grammatical     bool   `json:\"grammatical\"`\n        Grammar         string `json:\"grammar\"`\n        keyboard        bool   `json:\"keyboard\"`\n    }\n    Metadata struct {\n    }\n}\n\nfunc (d *saveData) readFile(fileName string) trialStruct {\n    trialName := fileName + \"/trials\"\n    rc, err := storage.NewReader(d.ctx, bucket, trialName)\n    if err != nil {\n        d.errorf(\"readFile: unable to open file from bucket %q, file %q: %v\", bucket, trialName, err)\n\n    }\n    defer rc.Close()\n    slurp, err := ioutil.ReadAll(rc)\n    if err != nil {\n        d.errorf(\"readFile: unable to read data from bucket %q, file %q: %v\", bucket, fileName, err)\n    }\n    var trialJson trialStruct\n    err1 := json.Unmarshal(slurp, &amp;trialJson)\n    if err != nil {\n        log.Printf(\"error:\", err1)\n    }\n    return trialJson\n}\n</code></pre>\n\n<p>But now I have the Encoded Json file which I'm not sure how to send back to the javascript, any help? Thanks</p>\n"}, {"tags": [], "owner": {"reputation": 3714, "user_id": 4915561, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-C2BXm3WwACU/AAAAAAAAAAI/AAAAAAAACXQ/QNDiwYgPBvk/photo.jpg?sz=128", "display_name": "Neil John Ramal", "link": "https://stackoverflow.com/users/4915561/neil-john-ramal"}, "is_accepted": false, "score": 1, "last_activity_date": 1432029195, "creation_date": 1432029195, "answer_id": 30322275, "question_id": 30311770, "link": "https://stackoverflow.com/questions/30311770/pass-user-id-to-core-ajax-method-get-to-retrieve-data-in-google-cloud-storage/30322275#30322275", "title": "Pass user ID to core-ajax method GET to retrieve data in Google Cloud storage", "body": "<pre><code>&lt;core-ajax url=\"{{url}}\" handleAs=\"json\" params='{\"userID\": \"{{userID}}\"}'&gt;&lt;/core-ajax&gt;\n</code></pre>\n\n<p>The parameter should be on JSON format.</p>\n"}], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1432029195, "creation_date": 1431979016, "question_id": 30311770, "link": "https://stackoverflow.com/questions/30311770/pass-user-id-to-core-ajax-method-get-to-retrieve-data-in-google-cloud-storage", "title": "Pass user ID to core-ajax method GET to retrieve data in Google Cloud storage", "body": "<p>I have an app in google engine with a go backend. I'm trying to retrieve a json file that I previously saved in google cloud storage. The backend is based on polymer and javascript. The problem is that the data need to be retrieved using the user-id through a core-ajax call.</p>\n\n<p>Here is the javascript code I'm using at the moment:</p>\n\n<pre><code>loadTrials : function loadTrials() {\n            var _this = this,\n                load = this.shadowRoot.querySelector('#load-trial');\n\n            load.url=\"http://url/loadTrials\";\n            load.go();\n            load.addEventListener('core-response', function(ev) {\n                var json = ev.detail.response;\n                _this.trialData = JSON.parse(json)['trial-data'];\n                console.log(JSON.parse(json)['trial-data'])\n            }, false);\n        }\n</code></pre>\n\n<p>The HTML</p>\n\n<pre><code>&lt;core-ajax id=\"load-trial\"  method=\"GET\"&gt;&lt;/core-ajax&gt;\n</code></pre>\n\n<p>And the backend in go(just the relevant part):</p>\n\n<pre><code>func handleloadTrials(w http.ResponseWriter, r *http.Request) {\n\n    defer r.Body.Close()\n\n    //retrieve trials\n    http.ServeFile(w, r, JSON file related to user id)\n\n}\n</code></pre>\n\n<p>I know this code is wrong, but I'm completely stuck and I don't know how to pass the user ID to the GET method, and then use the ID to retrieve the specific file on cloud storage (it's a json file) and then pass this Json file to the http.ServeFile method in Go.</p>\n\n<p>Any help?\nThanks a lot.</p>\n"}, {"tags": ["matlab", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 3, "creation_date": 1431977298, "post_id": 30310868, "comment_id": 48717959, "body": "An example of the file&#39;s content would be useful."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1431978031, "post_id": 30310868, "comment_id": 48718361, "body": "You can read a line with bufio.ReadString and then break that into indexable columns with strings.Fields or strings.Split. Or you can use the regexp package for unlimited power."}, {"owner": {"reputation": 559, "user_id": 2248009, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/8c3eb2c85081857e8d3bc2a40614790c?s=128&d=identicon&r=PG", "display_name": "Shrey", "link": "https://stackoverflow.com/users/2248009/shrey"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1469791424, "post_id": 30310868, "comment_id": 64696170, "body": "Adding on to @Aedolon , <a href=\"http://stackoverflow.com/questions/13737745/split-a-string-on-whitespace-in-go#\" title=\"split a string on whitespace in go%23\">stackoverflow.com/questions/13737745/&hellip;</a>"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 5, "last_activity_date": 1431979267, "creation_date": 1431979267, "answer_id": 30311842, "question_id": 30310868, "link": "https://stackoverflow.com/questions/30310868/golang-how-to-read-only-specified-columns-from-a-tab-delimited-file/30311842#30311842", "title": "Golang: how to read only specified columns from a tab delimited file?", "body": "<p>If your file is basically a TSV file (that is, a CSV file with tabs instead of commas), you can make a very simple wrapper around stdlib's <a href=\"http://golang.org/pkg/encoding/csv/#Reader\" rel=\"noreferrer\"><code>csv.Reader</code></a>:</p>\n\n<pre><code>type FieldsReader struct {\n    *csv.Reader\n    fields []int\n}\n\nfunc (r *FieldsReader) Read() (record []string, err error) {\n    rec, err := r.Reader.Read()\n    if err != nil {\n        return nil, err\n    }\n\n    record = make([]string, len(r.fields))\n    for i, f := range r.fields {\n        record[i] = rec[f]\n    }\n\n    return record, nil\n}\n</code></pre>\n\n<p>Full code and usage example: <a href=\"http://play.golang.org/p/YcwOmsMX2B\" rel=\"noreferrer\">http://play.golang.org/p/YcwOmsMX2B</a>.</p>\n"}], "owner": {"reputation": 419, "user_id": 3040335, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/43b74dafd9ea0333ba178676bac0eb07?s=128&d=identicon&r=PG&f=1", "display_name": "vvofdcx", "link": "https://stackoverflow.com/users/3040335/vvofdcx"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2774, "favorite_count": 0, "accepted_answer_id": 30311842, "answer_count": 1, "score": 1, "last_activity_date": 1431979267, "creation_date": 1431975324, "question_id": 30310868, "link": "https://stackoverflow.com/questions/30310868/golang-how-to-read-only-specified-columns-from-a-tab-delimited-file", "title": "Golang: how to read only specified columns from a tab delimited file?", "body": "<p>In Golang do we have a way to read only certain columns like textscan in matlab, e.g.: </p>\n\n<pre><code>txt = textscan(op,'%s%*s%s%*s');\n</code></pre>\n\n<p>Thanks!</p>\n"}, {"tags": ["email", "go", "sendmail"], "comments": [{"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1431982510, "post_id": 30310646, "comment_id": 48720576, "body": "<a href=\"http://stackoverflow.com/questions/26706258/extra-info-being-injected-into-an-email-over-smtp\">this</a> answer may be of use."}], "answers": [{"comments": [{"owner": {"reputation": 47, "user_id": 4356869, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh3.googleusercontent.com/-7hAGznMWdNc/AAAAAAAAAAI/AAAAAAAABts/0efjqMk-YIs/photo.jpg?sz=128", "display_name": "insomniac669", "link": "https://stackoverflow.com/users/4356869/insomniac669"}, "edited": false, "score": 0, "creation_date": 1432040889, "post_id": 30313127, "comment_id": 48747465, "body": "This helped. :) Thank you. I will try your package. :)"}], "tags": [], "owner": {"reputation": 1664, "user_id": 1306228, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/1e732e5ac9820eeb35a70276cf6c05f7?s=128&d=identicon&r=PG", "display_name": "Ale", "link": "https://stackoverflow.com/users/1306228/ale"}, "is_accepted": true, "score": 2, "last_activity_date": 1441196032, "last_edit_date": 1441196032, "creation_date": 1431984624, "answer_id": 30313127, "question_id": 30310646, "link": "https://stackoverflow.com/questions/30310646/smtp-sendmail-cannot-send-mail-to-multiple-recipent-golang/30313127#30313127", "title": "smtp.SendMail cannot send mail to multiple recipent golang", "body": "<p>Your code snippet is incomplete and does not match your email. Could you send more code?</p>\n\n<p>Anyway you can try replacing:</p>\n\n<pre><code>[]string{\"testmail1@yahoo.com, testmail2@yahoo.com\"},\n</code></pre>\n\n<p>By:</p>\n\n<pre><code>[]string{\"testmail1@yahoo.com\", \"testmail2@yahoo.com\"},\n</code></pre>\n\n<p>Also you can try my package <a href=\"https://github.com/go-gomail/gomail\" rel=\"nofollow\">Gomail</a> to easily send emails:</p>\n\n<pre><code>package main\n\nimport (\n    \"gopkg.in/gomail.v2\"\n)\n\nfunc main() {\n    m := gomail.NewMessage()\n    m.SetAddressHeader(\"From\", \"testmail1@yahoo.com\", \"testMail1\")\n    m.SetHeader(\"To\",\n        m.FormatAddress(\"testmail1@yahoo.com\", \"testMail1\"),\n        m.FormatAddress(\"testmail2@yahoo.com\", \"testMail2\"),\n    )\n    m.SetHeader(\"Subject\", \"mail\")\n    m.SetBody(\"text/plain\", \"Hello!\")\n\n    d := gomail.NewPlainDialer(\"smtp.mail.yahoo.com\", 25, \"login\", \"password\")\n    if err := d.DialAndSend(m); err != nil {\n        panic(err)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 47, "user_id": 4356869, "user_type": "registered", "accept_rate": 25, "profile_image": "https://lh3.googleusercontent.com/-7hAGznMWdNc/AAAAAAAAAAI/AAAAAAAABts/0efjqMk-YIs/photo.jpg?sz=128", "display_name": "insomniac669", "link": "https://stackoverflow.com/users/4356869/insomniac669"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2081, "favorite_count": 0, "accepted_answer_id": 30313127, "answer_count": 1, "score": 2, "last_activity_date": 1441196032, "creation_date": 1431974517, "question_id": 30310646, "link": "https://stackoverflow.com/questions/30310646/smtp-sendmail-cannot-send-mail-to-multiple-recipent-golang", "title": "smtp.SendMail cannot send mail to multiple recipent golang", "body": "<p>I want to send mail to multiple recipients in Go, with my yahoo mail, but I from all recipients only I get mail.</p>\n\n<p>Code:</p>\n\n<pre><code>err := smtp.SendMail(\n    \"smtp.mail.yahoo.com:25\",\n    auth,\n    \"testmail1@yahoo.com\",\n    []string{\"testmail1@yahoo.com, testmail2@yahoo.com\"},\n    []byte(\"test\")\n</code></pre>\n\n<p>message:</p>\n\n<pre><code>From: \"testMail1\" &lt;testmail1@yahoo.com&gt;\nTo: testMail1 &lt;testmail1@yahoo.com&gt;, testMail2 &lt;testmail2@yahoo.com&gt;,\nSubject: \"mail\"\nMIME-Version: 1.0\nContent-Type: text/html; charset=\"utf-8\"\nContent-Transfer-Encoding: base64\n</code></pre>\n\n<p>This is output:</p>\n\n<pre><code>2015/05/18 20:22:26 501 Syntax error in arguments\n</code></pre>\n\n<p>What have I done wrong?</p>\n"}, {"tags": ["api", "rest", "curl", "go", "mime-types"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431975097, "post_id": 30310046, "comment_id": 48716776, "body": "You stated the answer yourself, <code>DetectContentType</code> returns <code>text&#47;plain</code>. Normally you just use the content-type that the client supplied."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431975699, "post_id": 30310046, "comment_id": 48717111, "body": "Yes, I want the fype of content that the client send to me. The docs says: DetectContentType implements the algorithm described at <a href=\"http://mimesniff.spec.whatwg.org/\" rel=\"nofollow noreferrer\">mimesniff.spec.whatwg.org</a> to determine the Content-Type of the given data. It considers at most the first 512 bytes of data. DetectContentType always returns a valid MIME type: if it cannot determine a more specific one, it returns &quot;application/octet-stream&quot;.  Why should the function determine the wrong content type?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431977249, "post_id": 30310046, "comment_id": 48717932, "body": "DetectContentType  is only guaranteed to return a <i>valid</i> type, which it does -- json data is *text/plain`. Some types are ambiguous, and sniffing couldn&#39;t reliably detect valid json limited to only 512 bytes of input."}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431977481, "post_id": 30310046, "comment_id": 48718067, "body": "But isn&#39;t it usual to request a restful API with &quot;application/json&quot;?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 4, "creation_date": 1431977542, "post_id": 30310046, "comment_id": 48718103, "body": "Yes, so why don&#39;t you read the <code>Content-Type</code> header instead of trying to guess it from the request body?"}, {"owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431977776, "post_id": 30310046, "comment_id": 48718227, "body": "This function should solve my problem: <a href=\"http://golang.org/pkg/net/http/#Header.Get\" rel=\"nofollow noreferrer\">golang.org/pkg/net/http/#Header.Get</a>"}], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 3310858, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/879dcac6ef5151cb075096173573836f?s=128&d=identicon&r=PG", "display_name": "ferfabricio", "link": "https://stackoverflow.com/users/3310858/ferfabricio"}, "is_accepted": false, "score": 1, "last_activity_date": 1547032207, "creation_date": 1547032207, "answer_id": 54108783, "question_id": 30310046, "link": "https://stackoverflow.com/questions/30310046/go-middleware-blocks-mime-type-of-each-requests/54108783#54108783", "title": "Go - middleware blocks MIME type of each requests", "body": "<p>Looking at the implementation of DetectContentType function they follow the rules described on \"MIME Sniffing\" guide (<a href=\"https://mimesniff.spec.whatwg.org/\" rel=\"nofollow noreferrer\">https://mimesniff.spec.whatwg.org/</a>).</p>\n\n<p>To determine the MIME Type by the content this specific function use the item <em>\"7. Determining the computed MIME type of a resource\"</em>. That item doesn't have a determination for <em>'application/json'</em> type and following these rules will result in a <em>'text/plain'</em> MIME type.</p>\n\n<p>This is visible on the function <em>match</em> on the <em>DetectContentType</em> implementation (<a href=\"https://golang.org/src/net/http/sniff.go\" rel=\"nofollow noreferrer\">https://golang.org/src/net/http/sniff.go</a>) line 252.</p>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 363, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1547032207, "creation_date": 1431972274, "last_edit_date": 1431974057, "question_id": 30310046, "link": "https://stackoverflow.com/questions/30310046/go-middleware-blocks-mime-type-of-each-requests", "title": "Go - middleware blocks MIME type of each requests", "body": "<p>I modiefied the middleware of <a href=\"http://www.alexedwards.net/blog/making-and-using-middleware\" rel=\"nofollow\">this tutorial</a> to check for all PUT and POST request the JSON MIME type.</p>\n\n<p>But the middleware seems to respond everytime with \"Mediatype Not Supported\". I tried the curl command below where I set explicitly the right MIME type. I print which each request the client's Content-Type header field which is allways \"text/plain; charset=utf-8\".</p>\n\n<p>The Middleware:</p>\n\n<pre><code>func EnforceJSON(h httprouter.Handle) httprouter.Handle {\n    return func(rw http.ResponseWriter, req *http.Request, ps httprouter.Params) {\n        // Check the existence of a request body\n        if req.ContentLength == 0 {\n            http.Error(rw, http.StatusText(400), http.StatusBadRequest)\n            return\n        }\n\n        // Check the MIME type\n        buf := new(bytes.Buffer)\n        buf.ReadFrom(req.Body)\n        // Prints \"text/plain; charset=utf-8\"\n        fmt.Println(http.DetectContentType(buf.Bytes()))\n        if http.DetectContentType(buf.Bytes()) != \"application/json; charset=utf-8\" {\n            http.Error(rw, http.StatusText(415), http.StatusUnsupportedMediaType)\n            return\n        }\n\n        h(rw, req, ps)\n    }\n}  \n...\nrouter.POST(\"/api/v1/users\", EnforceJSON(CreateUser))\n</code></pre>\n\n<p>My curl command:</p>\n\n<pre><code>curl -H \"Content-Type: application/json; charset=utf-8\" \\\n-X POST \\\n-d '{\"JSON\": \"Will be checked after the middleware accepted the MIME type.\"}' \\\nhttp://localhost:8080/api/v1/users\n</code></pre>\n\n<p>Alternativly I tried <a href=\"https://www.getpostman.com/\" rel=\"nofollow\">Postman</a> but the result was the same.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 2, "creation_date": 1431971290, "post_id": 30309724, "comment_id": 48714720, "body": "You just copy the binary."}], "answers": [{"comments": [{"owner": {"reputation": 8230, "user_id": 204313, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/5d561f2de0f27818ee920dbc9e4a8a4d?s=128&d=identicon&r=PG", "display_name": "Rick-777", "link": "https://stackoverflow.com/users/204313/rick-777"}, "edited": false, "score": 0, "creation_date": 1432121670, "post_id": 30309850, "comment_id": 48789365, "body": "Yep - it&#39;s that simple. If your app needs to be deployed with additional asset files, config files etc etc, you might simply put them all into a tarball with the binary. Alternatively, some assets might be embedded into the binary with a tool such as <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">github.com/jteeuwen/go-bindata</a>."}, {"owner": {"reputation": 1183, "user_id": 2644513, "user_type": "registered", "accept_rate": 41, "profile_image": "https://i.stack.imgur.com/yNtHc.jpg?s=128&g=1", "display_name": "Itachi", "link": "https://stackoverflow.com/users/2644513/itachi"}, "edited": false, "score": 0, "creation_date": 1447153860, "post_id": 30309850, "comment_id": 55030778, "body": "@RobNapier What if the machine to be deployed has different configuration (OS)"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 1, "creation_date": 1447161041, "post_id": 30309850, "comment_id": 55034789, "body": "You would need to cross-compile in that case. <a href=\"http://dave.cheney.net/2015/03/03/cross-compilation-just-got-a-whole-lot-better-in-go-1-5\" rel=\"nofollow noreferrer\">dave.cheney.net/2015/03/03/&hellip;</a>"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 8, "last_activity_date": 1431971541, "creation_date": 1431971541, "answer_id": 30309850, "question_id": 30309724, "link": "https://stackoverflow.com/questions/30309724/how-are-golang-projects-packaged-for-deployment/30309850#30309850", "title": "How are golang projects packaged for deployment?", "body": "<p>I you run <code>go install &lt;pkg&gt;</code>, the binary will be placed in <code>$GOPATH/bin</code>. You can copy that binary to another machine that has the same OS and architecture.</p>\n\n<p>You can also change into the directory that includes the <code>main</code> package and just run <code>go build</code>. The binary will be placed in the current directory.</p>\n\n<p>There are no dependencies in a Go binary for you to track. It is statically linked. (Some system libraries may be dynamically linked, but if you are running on the same OS, this shouldn't be a problem.)</p>\n"}], "owner": {"reputation": 8814, "user_id": 3231690, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/06dce770d18a0e4537fcef0ef86a63e2?s=128&d=identicon&r=PG&f=1", "display_name": "Zuriar", "link": "https://stackoverflow.com/users/3231690/zuriar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4677, "favorite_count": 0, "accepted_answer_id": 30309850, "answer_count": 1, "score": 6, "last_activity_date": 1431971541, "creation_date": 1431971094, "question_id": 30309724, "link": "https://stackoverflow.com/questions/30309724/how-are-golang-projects-packaged-for-deployment", "title": "How are golang projects packaged for deployment?", "body": "<p>Coming from a JVM background I would like to know how to deploy a golang project to production. Is there an equivalent of a JAR file? </p>\n\n<p>Is there a standalone package manager that can be installed on server and a dependency manifest file which can be run to bring down all dependencies on the server. I specifically do not want to have to build the project on the server as we can't have any compilers etc on production boxes.</p>\n\n<p>thanks.</p>\n"}, {"tags": ["struct", "go"], "comments": [{"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1431964889, "post_id": 30307595, "comment_id": 48711125, "body": "Why not just make <code>api1</code> and <code>api2</code> separate packages? Also, do methods on APIs use the <code>Service</code> in any way?"}, {"owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1431965162, "post_id": 30307595, "comment_id": 48711324, "body": "Yes some methods would call a method on <code>Service</code>. If I was to separate <code>api1</code> and <code>api2</code> into their own packages could I refer to <code>Service</code> which would be in the parent package? Or I guess the question is can imports use relative path e.g. <code>import &quot;..&#47;xyz&quot;</code>?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 1, "creation_date": 1431965528, "post_id": 30307595, "comment_id": 48711580, "body": "It&#39;s recommended to never use relative paths for various reasons, but yeah, you can use it. Another possibility is to create two new exported types, <code>API1Service</code> and <code>API2Service</code>, define methods on them, and let users instantiate those and use however they want."}, {"owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1431965869, "post_id": 30307595, "comment_id": 48711813, "body": "ahh I kind of like that. <code>Service</code> shouldn&#39;t even be public, expose functions that create whichever api and then have users instantiate it. Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1431965773, "creation_date": 1431965773, "answer_id": 30308193, "question_id": 30307595, "link": "https://stackoverflow.com/questions/30307595/go-struct-type-on-an-already-typed-struct/30308193#30308193", "title": "Go struct type on an already typed struct", "body": "<p>Instead of using global variables you can just create two new types and let users decide how to use them:</p>\n\n<pre><code>type API1Service struct {\n    *Service\n    api1Param1 int\n    // etc.\n}\n\nfunc NewAPI1Service(api1Param1 int) *API1Service { /* ... */ }\n\n// methods on API1Service\n\ntype API2Service struct {\n    *Service\n    api2Param1 int\n    // etc.\n}\n\nfunc NewAPI2Service(api2Param1 int) *API2Service { /* ... */ }\n\n// methods on API2Service\n</code></pre>\n\n<p>Then, your users can do</p>\n\n<pre><code>api := xyz.NewAPI1Service(42)\napi.MethodA()\n// etc.\n</code></pre>\n"}], "owner": {"reputation": 455, "user_id": 906999, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/bf074f4848623dd263bae1c2c0011dd3?s=128&d=identicon&r=PG", "display_name": "Pete Jodo", "link": "https://stackoverflow.com/users/906999/pete-jodo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 50, "favorite_count": 0, "accepted_answer_id": 30308193, "answer_count": 1, "score": 2, "last_activity_date": 1431965773, "creation_date": 1431964005, "question_id": 30307595, "link": "https://stackoverflow.com/questions/30307595/go-struct-type-on-an-already-typed-struct", "title": "Go struct type on an already typed struct", "body": "<p>I have a struct called <code>Service</code> in <code>package xyz</code> which multiple api wrappers (<code>Api1</code>, <code>Api2</code>) will use as a base. I want someone who is using the package to call the methods for each API like: <code>xyz.Api1.MethodA(..)</code> and <code>xyz.Api2.MethodB(..)</code></p>\n\n<p>Right now I'm doing something like this</p>\n\n<pre><code>type struct api1 {\n    *Service\n}\n\nvar Api1 *api1\n\nfunc init() {\n    Api1 = &amp;api1{\n        &amp;Service{\n            ...\n        }\n    }\n}\n\nfunc (a *api1) MethodA {\n    ...\n}\n</code></pre>\n\n<p>I'm not a fan of this because it seems like a lot of boilerplate. I would rather have Api1 be a Service struct but each service will have different methods so I don't think that's possible unless I could do <code>type Service api1 {...}</code>? </p>\n\n<p>Is there another way to get the desired call by a user to be something like <code>xyz.Api1.MethodA(..)</code> without having to create a new struct type for each api and without having so much boilerplate?</p>\n"}, {"tags": ["regex", "go", "re2"], "comments": [{"owner": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "edited": false, "score": 6, "creation_date": 1431958766, "post_id": 30305542, "comment_id": 48706655, "body": "Looking at <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"nofollow noreferrer\">github.com/google/re2/wiki/Syntax</a> - there is a line saying &quot;<code>(?=re)</code> before text matching <code>re</code> (NOT SUPPORTED)&quot;. This doesn&#39;t look good. Also, it says &quot;alternative to backtracking regular expression engines&quot; - suggesting they&#39;d drop some features."}, {"owner": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "edited": false, "score": 0, "creation_date": 1431959541, "post_id": 30305542, "comment_id": 48707263, "body": "I guess that&#39;s a sort of an answer, so I&#39;ve added one."}, {"owner": {"reputation": 16115, "user_id": 114770, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6af6c4c44575775210dca60bcc8eec47?s=128&d=identicon&r=PG", "display_name": "Andy", "link": "https://stackoverflow.com/users/114770/andy"}, "reply_to_user": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "edited": false, "score": 1, "creation_date": 1500938489, "post_id": 30305542, "comment_id": 77545362, "body": "@Kobi there is now <a href=\"https://github.com/dlclark/regexp2\" rel=\"nofollow noreferrer\">dlclark/regexp2</a>  available"}, {"owner": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "reply_to_user": {"reputation": 16115, "user_id": 114770, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/6af6c4c44575775210dca60bcc8eec47?s=128&d=identicon&r=PG", "display_name": "Andy", "link": "https://stackoverflow.com/users/114770/andy"}, "edited": false, "score": 3, "creation_date": 1500949014, "post_id": 30305542, "comment_id": 77547632, "body": "@Andy - Thanks! So Go has <code>regexp</code> (which is re2), and <code>regexp2</code> (which isn&#39;t re2). That is a poor choice of library names - I think this is even more confusing than Python&#39;s <code>re</code> and <code>regex</code> libraries <code>:P</code>. Looks like it was ported from .Net with <a href=\"https://github.com/dlclark/regexp2/blob/487489b64fb796de2e55f4e8a4ad1e145f80e957/regexp_mono_test.go#L998,L1002\" rel=\"nofollow noreferrer\">balancing groups</a>, which are <a href=\"https://kobikobi.wordpress.com/tag/regex/\" rel=\"nofollow noreferrer\">my favorite regex feature</a> - I&#39;ll have a look."}], "answers": [{"comments": [{"owner": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 1, "creation_date": 1431959577, "post_id": 30305904, "comment_id": 48707293, "body": "Yes, capturing group is the only means to achieve that... at least, until look-aheads are implemented in Go,"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 481647, "user_id": 3832970, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/64323e6cf08401474da3bf770ea13b58?s=128&d=identicon&r=PG&f=1", "display_name": "Wiktor Stribi\u017cew", "link": "https://stackoverflow.com/users/3832970/wiktor-stribi%c5%bcew"}, "edited": false, "score": 5, "creation_date": 1431968645, "post_id": 30305904, "comment_id": 48713431, "body": "@stribizhev (wrt your &quot;until look-aheads are implemented in Go&quot; comment), I doubt such features will ever be added to Go or that Go will switch from using RE2. (Although you could probably use a third party PCRE package, I wouldn&#39;t recommend that). Most/all of these &quot;features&quot; are not supported due to the basic design which is a deliberate choice made between &quot;advanced&quot; (but slow/dangerous) features and speed and safety (in terms of run-time/memory). See <a href=\"https://swtch.com/~rsc/regexp/regexp1.html\" rel=\"nofollow noreferrer\">swtch.com/~rsc/regexp/regexp1.html</a> for details (or just look at the graphs)."}, {"owner": {"reputation": 568, "user_id": 2591870, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MM73n.jpg?s=128&g=1", "display_name": "James Davis", "link": "https://stackoverflow.com/users/2591870/james-davis"}, "edited": false, "score": 3, "creation_date": 1600700382, "post_id": 30305904, "comment_id": 113162804, "body": "FWIW, recent research on handling lookaheads in linear time for PCRE-like engines: <a href=\"https://medium.com/@davisjam/using-selective-memoization-to-defeat-regular-expression-denial-of-service-f7acbbd34792\" rel=\"nofollow noreferrer\">medium.com/@davisjam/&hellip;</a>"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 6, "last_activity_date": 1431959305, "creation_date": 1431959305, "answer_id": 30305904, "question_id": 30305542, "link": "https://stackoverflow.com/questions/30305542/using-positive-lookahead-regex-with-re2/30305904#30305904", "title": "Using positive-lookahead (?=regex) with re2", "body": "<p>You can achieve this with a simpler regexp:</p>\n\n<pre><code>re := regexp.MustCompile(`^(.+?)(?:baz)?$`)\nsm := re.FindStringSubmatch(\"foo bar baz\")\nfmt.Printf(\"%q\\n\", sm)\n</code></pre>\n\n<p><code>sm[1]</code> will be your match. Playground: <a href=\"http://play.golang.org/p/Vyah7cfBlH\" rel=\"noreferrer\">http://play.golang.org/p/Vyah7cfBlH</a></p>\n"}, {"tags": [], "owner": {"reputation": 124629, "user_id": 7586, "user_type": "registered", "accept_rate": 83, "profile_image": "https://i.stack.imgur.com/Ryqtb.jpg?s=128&g=1", "display_name": "Kobi", "link": "https://stackoverflow.com/users/7586/kobi"}, "is_accepted": true, "score": 15, "last_activity_date": 1483625886, "last_edit_date": 1483625886, "creation_date": 1431959418, "answer_id": 30305934, "question_id": 30305542, "link": "https://stackoverflow.com/questions/30305542/using-positive-lookahead-regex-with-re2/30305934#30305934", "title": "Using positive-lookahead (?=regex) with re2", "body": "<p>According to the <a href=\"https://github.com/google/re2/wiki/Syntax\" rel=\"noreferrer\">Syntax Documentation</a>, this feature isn't supported:</p>\n\n<blockquote>\n  <p><code>(?=re)</code>  before text matching <code>re</code> (NOT SUPPORTED)</p>\n</blockquote>\n\n<p>Also, from <a href=\"https://github.com/google/re2/wiki/WhyRE2\" rel=\"noreferrer\">WhyRE2</a>:</p>\n\n<blockquote>\n  <p>As a matter of principle, RE2 does not support constructs for which only backtracking solutions are known to exist. Thus, backreferences and look-around assertions are not supported.</p>\n</blockquote>\n"}], "owner": {"reputation": 8582, "user_id": 2503796, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3J7Wd.jpg?s=128&g=1", "display_name": "a8m", "link": "https://stackoverflow.com/users/2503796/a8m"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12051, "favorite_count": 2, "accepted_answer_id": 30305934, "answer_count": 2, "score": 11, "last_activity_date": 1483625886, "creation_date": 1431958375, "question_id": 30305542, "link": "https://stackoverflow.com/questions/30305542/using-positive-lookahead-regex-with-re2", "title": "Using positive-lookahead (?=regex) with re2", "body": "<p>Since I'm a bit new with <a href=\"https://github.com/google/re2\">re2</a>, I'm trying to figure out how to use positive-lookahead <code>(?=regex)</code> like JS, C++ or any PCRE style in <a href=\"http://golang.org/\"><strong>Go</strong></a>.</p>\n\n<p>Here's some examples of what I'm looking for.  </p>\n\n<p><strong>JS:</strong></p>\n\n<pre><code>'foo bar baz'.match(/^[\\s\\S]+?(?=baz|$)/);\n</code></pre>\n\n<p><strong>Python:</strong></p>\n\n<pre><code>re.match('^[\\s\\S]+?(?=baz|$)', 'foo bar baz')\n</code></pre>\n\n<ul>\n<li>Note: both examples match <code>'foo bar '</code></li>\n</ul>\n\n<p>Thanks a lot.</p>\n"}, {"tags": ["html", "go"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1431955496, "post_id": 30304320, "comment_id": 48704303, "body": "Using <code>printf</code> still does not make it work: <a href=\"https://play.golang.org/p/dlSsp2y3Bj\" rel=\"nofollow noreferrer\">play.golang.org/p/dlSsp2y3Bj</a>. Don&#39;t ignore errors!"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431967367, "post_id": 30304320, "comment_id": 48712733, "body": "Further to Tim&#39;s comment to <b>never ignore errors</b>, I&#39;ll point out that if you look at the error in <i>either</i> case it would tell you the exact issue: &quot;active is an unexported field of struct type main.page&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 21, "user_id": 4495034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f81784e64ef261e2cc4a0d6e5c599f7?s=128&d=identicon&r=PG&f=1", "display_name": "That Haun Guy", "link": "https://stackoverflow.com/users/4495034/that-haun-guy"}, "edited": false, "score": 0, "creation_date": 1431955845, "post_id": 30304374, "comment_id": 48704561, "body": "Wow! Somehow, I missed that in the documentation. That solved my issue! Thank you so much!"}], "tags": [], "owner": {"reputation": 2211, "user_id": 2866570, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7328ed4169cb39f8d33bb430c4d12391?s=128&d=identicon&r=PG", "display_name": "zaynetro", "link": "https://stackoverflow.com/users/2866570/zaynetro"}, "is_accepted": true, "score": 1, "last_activity_date": 1431955335, "creation_date": 1431955335, "answer_id": 30304374, "question_id": 30304320, "link": "https://stackoverflow.com/questions/30304320/go-template-parsefiles-doesnt-work-with-active-but-does-for-printf/30304374#30304374", "title": "Go: template.ParseFiles() doesn&#39;t work with {{.active}} but does for {{printf &quot;%s&quot; .active}}", "body": "<p>Make <code>active</code> property capitalized. Like so:</p>\n\n<pre><code>type page struct{\n    Active string\n}\nt, _ template.ParseFiles(\"page.html\")\nt.Execute(w,page{Active: \"No Players are Online\"})\n</code></pre>\n\n<p>and template</p>\n\n<pre><code>&lt;body&gt;\n    &lt;h2&gt;Current number of players: {{.Active}}&lt;/h2&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>Go exports only capitalized struct properties to other modules.</p>\n"}], "owner": {"reputation": 21, "user_id": 4495034, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4f81784e64ef261e2cc4a0d6e5c599f7?s=128&d=identicon&r=PG&f=1", "display_name": "That Haun Guy", "link": "https://stackoverflow.com/users/4495034/that-haun-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 161, "favorite_count": 0, "accepted_answer_id": 30304374, "answer_count": 1, "score": 0, "last_activity_date": 1431955335, "creation_date": 1431955180, "question_id": 30304320, "link": "https://stackoverflow.com/questions/30304320/go-template-parsefiles-doesnt-work-with-active-but-does-for-printf", "title": "Go: template.ParseFiles() doesn&#39;t work with {{.active}} but does for {{printf &quot;%s&quot; .active}}", "body": "<p>Lets say the body of my html file like so</p>\n\n<pre><code>&lt;body&gt;\n    &lt;h2&gt;Current number of players: {{.active}}&lt;/h2&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p>And my go code looks like</p>\n\n<pre><code>type page struct{\n    active string\n}\nt, _ template.ParseFiles(\"page.html\")\nt.Execute(w,page{active: \"No Players are Online\"})\n</code></pre>\n\n<p>When I run the code, I get a blank screen. When I change {{.active}} to {{printf \"%s\" .active}} it works. </p>\n\n<p>Do I always need to include printf? I guess I'm confused by the documentation. </p>\n\n<p>Thanks!</p>\n"}, {"tags": ["go", "command-line-arguments"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 20, "last_activity_date": 1431949180, "last_edit_date": 1431949180, "creation_date": 1431948783, "answer_id": 30302099, "question_id": 30302017, "link": "https://stackoverflow.com/questions/30302017/golang-command-arguments-empty-causing-error/30302099#30302099", "title": "Golang command arguments empty causing error", "body": "<p>First check the length of the <code>os.Args</code> slice and only index up to its length - 1:</p>\n\n<pre><code>if len(os.Args) &gt; 1 {\n    command := os.Args[1]\n    // do something with command\n} else {\n    // No arguments were specified!\n}\n</code></pre>\n\n<blockquote>\n  <p><code>os.Args</code> hold the command-line arguments, starting with the program name.</p>\n</blockquote>\n\n<p><code>os.Args[0]</code> is the program name. <em>If</em> there are arguments, they go to <code>Args[1]</code>, <code>Args[2]</code>...</p>\n\n<p>If no arguments were specified, the length of <code>os.Args</code> will be 1 and will hold only the program name.</p>\n\n<p>Also for easier and more sophisticated arguments handling check out the <a href=\"https://golang.org/pkg/flag/\" rel=\"noreferrer\"><code>flag</code></a> package.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1431949117, "post_id": 30302166, "comment_id": 48700015, "body": "<code>os.Args</code> starts with the program name, so you should check <code>len() &gt; 1</code>. Also no need to test if it&#39;s <code>nil</code> (redundant), the builtin <code>len()</code> function works on <code>nil</code> slices as well."}, {"owner": {"reputation": 2469, "user_id": 2581783, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gHG3B.png?s=128&g=1", "display_name": "Rene M.", "link": "https://stackoverflow.com/users/2581783/rene-m"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431949205, "post_id": 30302166, "comment_id": 48700070, "body": "I&#39;m not developing go ;) As I said, my solution is best practice for every array with unkown origin. So when you wanna be clean and correct, do it like I did and ignore that go handle this for you ;)"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 5, "creation_date": 1431949508, "post_id": 30302166, "comment_id": 48700244, "body": "I don&#39;t think that&#39;s a very good advice, basically you&#39;re saying <i>&quot;forget in which language you&#39;re coding, and only use the common subset of all languages&quot;</i>. Doing so you will end up unnecessarily complicated, ugly and non-idiomatic code. Also the <code>len() &gt; 1</code> check is mandatory, checking only <code>len() &gt; 0</code> you may end up with the same error if no arguments is specified because <code>len() &gt; 1</code> is always true as <code>Args</code> contains the program name, but if no arguments were specified, <code>Args[1]</code> will result in a : <code>runtime error: index out of range</code>"}, {"owner": {"reputation": 2469, "user_id": 2581783, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gHG3B.png?s=128&g=1", "display_name": "Rene M.", "link": "https://stackoverflow.com/users/2581783/rene-m"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431949847, "post_id": 30302166, "comment_id": 48700459, "body": "As you say ;) Keep on go, I keep on applied computer science :D"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1431961648, "post_id": 30302166, "comment_id": 48708862, "body": "This will still panic the same way as in the question. <code>len(os.Args) &gt; 0</code> is always true, and doesn&#39;t check for any command line arguments."}, {"owner": {"reputation": 3067, "user_id": 1255551, "user_type": "registered", "accept_rate": 60, "profile_image": "https://i.stack.imgur.com/W8aYa.jpg?s=128&g=1", "display_name": "craig65535", "link": "https://stackoverflow.com/users/1255551/craig65535"}, "edited": false, "score": 0, "creation_date": 1609967655, "post_id": 30302166, "comment_id": 115989201, "body": "<code>len(os.Args) &gt; 1</code> is not always true, at least in Linux and macOS. If you compile a go program and then write a C program to exec it with <code>execl(&quot;&#47;path&#47;to&#47;exec&quot;, NULL)</code>, it will have no arguments at all, not even the executable name."}], "tags": [], "owner": {"reputation": 2469, "user_id": 2581783, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gHG3B.png?s=128&g=1", "display_name": "Rene M.", "link": "https://stackoverflow.com/users/2581783/rene-m"}, "is_accepted": false, "score": -1, "last_activity_date": 1431975939, "last_edit_date": 1431975939, "creation_date": 1431948970, "answer_id": 30302166, "question_id": 30302017, "link": "https://stackoverflow.com/questions/30302017/golang-command-arguments-empty-causing-error/30302166#30302166", "title": "Golang command arguments empty causing error", "body": "<p>You have to check first if os.Args exist and how big it is , before you should access it. This is best practive in ervery programming language using arrays.</p>\n\n<p>This should work:</p>\n\n<pre><code>func main() {\n\n    if (os.Args != nil &amp;&amp; len(os.Args) &gt; 1) {\n        command := os.Args[1]\n        if command != \"\" {\n            fmt.Println(command)\n        } else {\n            command = \"\"\n            fmt.Println(\"No command given\")\n        }\n    }\n    createDir(\"public\")\n    createDir(\"themes\")\n}\n</code></pre>\n\n<p>Depending on all that fault-finder's here that only can go, and had readen the handbook here the correct only go specific version for handling the input arguments. (A Note as I sad before, I don't develop go, I answered by best practice for handling arrays, to prefend out of range error):</p>\n\n<pre><code>func main() {\n\n    if (len(os.Args) &gt; 1) {\n        command := os.Args[1]\n        if command != \"\" {\n            fmt.Println(command)\n        } else {\n            command = \"\"\n            fmt.Println(\"No command given\")\n        }\n    }\n    createDir(\"public\")\n    createDir(\"themes\")\n}\n</code></pre>\n\n<ol>\n<li>It is not checking on nil anymore, because os.Args always are initialized and holds the app name on index 0</li>\n<li>It checks the len greater then 1 to make sure that index 1 exist. Or in other words the user has entered arguments and os.Args has more entries then only the app name.</li>\n</ol>\n"}], "owner": {"reputation": 569, "user_id": 756053, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/bd3f34b25260849a0765f3dbc519a6f1?s=128&d=identicon&r=PG", "display_name": "zachdyer", "link": "https://stackoverflow.com/users/756053/zachdyer"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 10031, "favorite_count": 3, "accepted_answer_id": 30302099, "answer_count": 2, "score": 4, "last_activity_date": 1431975939, "creation_date": 1431948534, "question_id": 30302017, "link": "https://stackoverflow.com/questions/30302017/golang-command-arguments-empty-causing-error", "title": "Golang command arguments empty causing error", "body": "<p>I'm writing a go program and I need to use command arguments. However if I don't pass arguments when I run the executable or <code>go run gosite.go</code> the code it does the following runtime error.</p>\n\n<pre><code>panic: runtime error: index out of range\n\ngoroutine 1 [running]:\nruntime.panic(0x80c8540, 0x816d4b7)\n/usr/lib/go/src/pkg/runtime/panic.c:266 +0xac\nmain.main()\n/home/jacob/github/gosite/src/github.com/zachdyer/gosite/gosite.go:11 +0x168\n</code></pre>\n\n<p>The error is found on line 11. So my question is am I using the <code>os.Args</code> in the wrong way? Does this need to be initialized in a different way? Also why does it seem to be going in an infinite loop there? If I pass in an argument the program runs without any errors and prints the argument.</p>\n\n<pre><code>import (\n    \"fmt\"\n    \"os\"\n)\n\nvar root string\n\nfunc main() {\n    command := os.Args[1]\n    if command != \"\" {\n        fmt.Println(command)\n    } else {\n        command = \"\"\n        fmt.Println(\"No command given\")\n    }\n\n    createDir(\"public\")\n    createDir(\"themes\")\n}\n\nfunc createDir(dir string) {\n    root = \"../../../../\"\n    err := os.Mkdir(root + dir, 0777)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n}\n</code></pre>\n"}, {"tags": ["linux", "eclipse", "go", "goclipse"], "comments": [{"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431947712, "post_id": 30301633, "comment_id": 48699172, "body": "I know it&#39;s not what you asked but you may want to use another IDE and not GoClipse. try Sublime, IntelliJ, LiteIDE, Atom."}, {"owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431947991, "post_id": 30301633, "comment_id": 48699366, "body": "Yup, I&#39;m going to evaluate IntelliJ and see if I can use an unsanctioned editor (everyone else thinks vi is the way to go and I just don&#39;t get on with it).  Thanks for responding"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431948095, "post_id": 30301633, "comment_id": 48699426, "body": "Latest GoClipse version is 0.10. First try to update to the latest and see what happens."}, {"owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "edited": false, "score": 0, "creation_date": 1431949742, "post_id": 30301633, "comment_id": 48700394, "body": "Is there a different software site to get this from other than &quot;GoClipse - <a href=\"http://github.com/GoClipse/releases/raw/master/\" rel=\"nofollow noreferrer\">github.com/GoClipse/releases/raw/master</a>&quot; which lists the version above only?  NB: This is from the eclipse install software window.  Is it necessary to assemble a full eclipse plugin development environment to be able to get anything newer?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431953643, "post_id": 30301633, "comment_id": 48702999, "body": "If you already have GoClipse installed, in Eclipse Help -&gt; Check for Updates. It should find that there is a newer version which you can install from the Update window."}, {"owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "edited": false, "score": 0, "creation_date": 1431958300, "post_id": 30301633, "comment_id": 48706316, "body": "All that happens for me is that after checking some URLs is that a window with &quot;No updates were found&quot; is displayed.  Should I be using a different GoClipse repository URL?  Thanks for taking the time to help me."}, {"owner": {"reputation": 13257, "user_id": 248922, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/b55c30cff18b13e2176c1359654ebf1c?s=128&d=identicon&r=PG&f=1", "display_name": "RickyA", "link": "https://stackoverflow.com/users/248922/rickya"}, "edited": false, "score": 0, "creation_date": 1431982748, "post_id": 30301633, "comment_id": 48720697, "body": "this should be the update site: <a href=\"http://goclipse.github.io/releases/\" rel=\"nofollow noreferrer\">goclipse.github.io/releases</a>"}, {"owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "edited": false, "score": 0, "creation_date": 1432033286, "post_id": 30301633, "comment_id": 48741962, "body": "Thank you for your help; 10.1 all works using your URL.  Do you want to create an answer so it can be accepted?"}], "answers": [{"tags": [], "owner": {"reputation": 1357, "user_id": 393898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/89b55a355cb66fff949fe85c45ea4897?s=128&d=identicon&r=PG", "display_name": "BrunoMedeiros", "link": "https://stackoverflow.com/users/393898/brunomedeiros"}, "is_accepted": true, "score": 2, "last_activity_date": 1432039741, "creation_date": 1432039741, "answer_id": 30326113, "question_id": 30301633, "link": "https://stackoverflow.com/questions/30301633/getting-goclipse-to-work-normally-with-a-normal-go-workspace/30326113#30326113", "title": "Getting GoClipse to work normally with a normal GO workspace", "body": "<p>Indeed, <a href=\"http://goclipse.github.io/releases\" rel=\"nofollow\">goclipse.github.io/releases</a> is the latest update site URL, so you should use the latest version (the URL did change several times since in the span of the previous year). The way Goclipse handles the Go enviroment has changed significantly since 0.8.0, particularly with 0.9.0, which allows creating an Eclipse project on a folder inside a GOPATH 'src' entry. (and other cases are handled better, especially with the builder).</p>\n\n<p>Note: you will need to recreate your Eclipse Go projects after updating (0.10.0 had some internal, non backward-compatible changes).</p>\n\n<p>You might want to consult the changelog for more details: <a href=\"https://github.com/GoClipse/goclipse/releases\" rel=\"nofollow\">https://github.com/GoClipse/goclipse/releases</a></p>\n"}], "owner": {"reputation": 106, "user_id": 4900487, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e6a84e616d3340cf7a0900a7d5dc949e?s=128&d=identicon&r=PG&f=1", "display_name": "Richard", "link": "https://stackoverflow.com/users/4900487/richard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 314, "favorite_count": 0, "accepted_answer_id": 30326113, "answer_count": 1, "score": 1, "last_activity_date": 1432039741, "creation_date": 1431947391, "last_edit_date": 1495535235, "question_id": 30301633, "link": "https://stackoverflow.com/questions/30301633/getting-goclipse-to-work-normally-with-a-normal-go-workspace", "title": "Getting GoClipse to work normally with a normal GO workspace", "body": "<p>I have been trying to use GoClipse (0.8.1v2001409161333 - latest available from the goclipse_feature.feature.group) with Eclipse (4.4.2) on Linux (CentOS6.6) with GO (1.4.2-2.el6) installed via yum from EPEL and have only achieved partial functionality.  </p>\n\n<p>Intellisense appears to work fine for the built in packages but GoClipse appears to do something weird with it's directory structure that is different from the normal GO workspace layout.  The existing structure under source control looks like: <code>\n    $GOPATH/bin/...\n    $GOPATH/pkg/...\n    $GOPATH/src/externalsite/module/version/*.go\n    $GOPATH/src/externalsite/module/version/subdir/*.go\n    $GOPATH/src/me/module/*.go\n    $GOPATH/src/me/module/feature/*.go</code></p>\n\n<p>When I try and use GoClipse it always appears to insist that the *.go files must be a peer of the bin|pkg|src directories.  This means that I either have my *.go files at $GOPATH or tell GoClipse where main.go is ($GOPATH/src/me/module/main.go) and GoClipse creates the bin|pkg|src directories again:<code>\n    $GOPATH/src/me/module/bin/\n    $GOPATH/src/me/module/pkg/\n    $GOPATH/src/me/module/src/</code></p>\n\n<p>My GoClipse configuration has $GOPATH set appropriately (I have tried with $GOROOT undefined or set to the yum install location to no effect) and when creating the Go project from existing code specifying the location as $GOPATH/src/me/module/ (manually expanding $GOPATH)</p>\n\n<p>Some resources that I have located do not appear to offer any advice on getting GoClipse to respect the proper go workspace structure and I am hoping someone can tell me how to do this.<br>\nThe following resources might be of interest but they do not solve this difficulty:<br>\n<a href=\"https://stackoverflow.com/questions/27477855/how-to-run-a-go-project-in-eclipse-with-goclipse-installed\">How to run a GO project in eclipse with goclipse installed</a><br>\n<a href=\"https://github.com/GoClipse/goclipse\" rel=\"nofollow noreferrer\">https://github.com/GoClipse/goclipse</a>   </p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "edited": false, "score": 0, "creation_date": 1519243785, "post_id": 30300279, "comment_id": 84835527, "body": "Your v1/v2 approach might end up being the one to follow after all. See vgo presented in <a href=\"https://stackoverflow.com/a/48914523/6309\">my new answer</a>"}], "answers": [{"comments": [{"owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "edited": false, "score": 0, "creation_date": 1431945787, "post_id": 30300779, "comment_id": 48697802, "body": "Thank you. This seems like a good approach :) Thank for the link to the mailing list as well. It&#39;s very useful information so see what is planned for 1.5 and 1.6 eventually."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 15, "last_activity_date": 1519243725, "last_edit_date": 1592644375, "creation_date": 1431944866, "answer_id": 30300779, "question_id": 30300279, "link": "https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice/30300779#30300779", "title": "Golang Dependency Management Best Practice", "body": "<p>Feb. 2018: the vendoring approach presented below (in 2015/2016) might end up disappearing if vgo is integrated to the toolchain.<br />\nSee <a href=\"https://stackoverflow.com/a/48914523/6309\">my answer below</a>.</p>\n<hr />\n<p><strong>August 2015 edition:</strong> Go 1.5 comes with a built-in (but still experimental) vendoring support. Setting the environment variable <code>GO15VENDOREXPERIMENT</code> will make <code>go build</code> and friends look for packages in <code>./vendor</code> directory as well as <code>GOPATH</code>. See <a href=\"https://stackoverflow.com/a/30950192/1892060\">VonC's answer</a> and the <a href=\"https://golang.org/s/go15vendor\" rel=\"noreferrer\">design document</a> for more details.</p>\n<hr />\n<h1>III. Vendoring</h1>\n<p>AFAIK, this is the most widely used way of ensuring that your builds are reproducible and predictable. The Go team itself <a href=\"https://github.com/golang/go/tree/master/src/cmd/internal/rsc.io\" rel=\"noreferrer\">uses vendoring</a> in their repo. The Go team is now discussing the unified dependency manifest file format. From the <a href=\"https://groups.google.com/d/msg/golang-dev/nMWoEAG55v8/iJGgur7W_SEJ\" rel=\"noreferrer\">Go toolchain developers mailing list</a>:</p>\n<blockquote>\n<p>In Google\u2019s internal source tree, we vendor (copy) all our dependencies into our source tree and have at most one copy of any given external library. We have the equivalent of only one GOPATH and rewrite our imports to refer to our vendored copy. For example, Go code inside Google wanting to use \u201cgolang.org/x/crypto/openpgp\u201d would instead import it as something like \u201cgoogle/third_party/golang.org/x/crypto/openpgp\u201d.</p>\n<p>(...)</p>\n<p>Our proposal is that the Go project,</p>\n<ul>\n<li><p>officially recommends vendoring into an \u201cinternal\u201d directory with import rewriting (not GOPATH modifications) as the canonical way to pin dependencies.</p>\n</li>\n<li><p>defines a common config file format for dependencies &amp; vendoring</p>\n</li>\n<li><p>makes no code changes to cmd/go in Go 1.5. External tools such as \u201c<a href=\"https://github.com/tools/godep\" rel=\"noreferrer\">godep</a>\u201d or \u201c<a href=\"https://github.com/jingweno/nut\" rel=\"noreferrer\">nut</a>\u201d will implement 1) and 2). We can reevaluate including such a tool in Go 1.6+.</p>\n</li>\n</ul>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": true, "score": 11, "last_activity_date": 1481659038, "last_edit_date": 1481659038, "creation_date": 1434773722, "answer_id": 30950192, "question_id": 30300279, "link": "https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice/30950192#30950192", "title": "Golang Dependency Management Best Practice", "body": "<p>Note: June 2015, the first support for vendoring appears in Go 1.5!</p>\n\n<p>See <a href=\"https://go-review.googlesource.com/#/c/10923/\" rel=\"nofollow noreferrer\">c/10923/</a>:</p>\n\n<blockquote>\n  <p>When <code>GO15VENDOREXPERIMENT=1</code> is in the environment, this CL changes the resolution of import paths according to the Go 1.5 vendor proposal: </p>\n  \n  <ul>\n  <li>If there is a source directory <code>d/vendor</code>, then, when compiling a source file within the subtree rooted at <code>d</code>, <code>import \"p\"</code> is interpreted as <code>import \"d/vendor/p\"</code> if that exists. </li>\n  <li>When there are multiple possible resolutions, the most specific (longest) path wins. </li>\n  <li>The short form must always be used: no import path can contain \u201c<code>/vendor/</code>\u201d explicitly. </li>\n  <li>Import comments are ignored in vendored packages.</li>\n  </ul>\n</blockquote>\n\n<hr>\n\n<p>Update January 2016: Go 1.6 will make vendoring the default.<br>\nAnd as detailed in <a href=\"https://blog.filippo.io/most-go-tools-now-work-with-go15vendorexperiment/\" rel=\"nofollow noreferrer\">the article \"MOST GO TOOLS NOW WORK WITH GO15VENDOREXPERIMENT\"</a>:</p>\n\n<blockquote>\n  <p>1.6 brings support for <code>/vendor/</code> to most tools (like the oracle) out of the box; use the Beta to rebuild them.</p>\n</blockquote>\n\n<ul>\n<li><a href=\"https://github.com/golang/go/issues/12278\" rel=\"nofollow noreferrer\">issue 12278</a> has been resolved.</li>\n<li><strike>there still is an <a href=\"https://github.com/golang/go/issues/13644\" rel=\"nofollow noreferrer\">issue with <code>goimports</code></a>, and there is a <a href=\"https://go-review.googlesource.com/#/c/17728/\" rel=\"nofollow noreferrer\">CL</a> that <a href=\"https://go.googlesource.com/tools/+/d25ec44442101bba6b45bc06f43b63a77ad85b76\" rel=\"nofollow noreferrer\">can be cherry-picked</a></strike>.</li>\n</ul>\n"}, {"tags": [], "owner": {"reputation": 693, "user_id": 1802697, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eH3MJ.jpg?s=128&g=1", "display_name": "Igor Maznitsa", "link": "https://stackoverflow.com/users/1802697/igor-maznitsa"}, "is_accepted": false, "score": 0, "last_activity_date": 1460442930, "creation_date": 1460442930, "answer_id": 36565284, "question_id": 30300279, "link": "https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice/36565284#36565284", "title": "Golang Dependency Management Best Practice", "body": "<p>also it is possible just describe dependencies in maven, if to use <a href=\"https://github.com/raydac/mvn-golang\" rel=\"nofollow\">mvn-golang-wrapper</a>, in the case it looks like in maven as below text</p>\n\n<pre><code>&lt;plugin&gt;\n &lt;groupId&gt;com.igormaznitsa&lt;/groupId&gt;\n &lt;artifactId&gt;mvn-golang-wrapper&lt;/artifactId&gt;\n &lt;version&gt;1.1.0&lt;/version&gt;\n &lt;executions&gt;\n  &lt;execution&gt;\n    &lt;id&gt;golang-get&lt;/id&gt;\n     &lt;goals&gt;\n       &lt;goal&gt;get&lt;/goal&gt;\n     &lt;/goals&gt;\n     &lt;configuration&gt;\n       &lt;packages&gt;\n         &lt;package&gt;github.com/gizak/termui&lt;/package&gt;\n       &lt;/packages&gt;\n       &lt;buildFlags&gt;\n         &lt;flag&gt;-u&lt;/flag&gt;\n       &lt;/buildFlags&gt;\n       &lt;goVersion&gt;1.6&lt;/goVersion&gt;\n     &lt;/configuration&gt;\n   &lt;/execution&gt;\n&lt;/plugin&gt;\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "edited": false, "score": 0, "creation_date": 1525615540, "post_id": 48914523, "comment_id": 87417671, "body": "Really looking forward to being able to develop Go using a project-based workflow (I assume you mean the projects can live outside of a gopath without issue). Is there more information on that in particular?"}, {"owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "reply_to_user": {"reputation": 3895, "user_id": 4040931, "user_type": "registered", "accept_rate": 25, "profile_image": "https://graph.facebook.com/705151302/picture?type=large", "display_name": "David Alsh", "link": "https://stackoverflow.com/users/4040931/david-alsh"}, "edited": false, "score": 0, "creation_date": 1525615805, "post_id": 48914523, "comment_id": 87417747, "body": "@DavidAlsh Not much except ofr the section &quot;Go Builds and the Isolation Rule&quot; of <a href=\"https://research.swtch.com/vgo-cmd\" rel=\"nofollow noreferrer\">research.swtch.com/vgo-cmd</a>. In the meantime, Artifactory proposes a proxy compatible with vgo(!): <a href=\"https://jfrog.com/blog/goproxy-artifactory-go-registries/\" rel=\"nofollow noreferrer\">jfrog.com/blog/goproxy-artifactory-go-registries</a>"}], "tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 9, "last_activity_date": 1535611950, "last_edit_date": 1535611950, "creation_date": 1519243488, "answer_id": 48914523, "question_id": 30300279, "link": "https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice/48914523#48914523", "title": "Golang Dependency Management Best Practice", "body": "<p>Update August 2018: this (vgo presented below) is now implemented with <strong><a href=\"https://golang.org/doc/go1.11#modules\" rel=\"nofollow noreferrer\">Go 1.11 and modules</a></strong>.</p>\n\n<p>Update Feb. 2018, 3 years later.</p>\n\n<p>There is a new approach developed by <a href=\"https://twitter.com/_rsc\" rel=\"nofollow noreferrer\"><strong>Russ Cox</strong></a>, from the core Golang development team.</p>\n\n<p>The <strong>vgo</strong> project.</p>\n\n<pre><code>go get -u golang.org/x/vgo\n</code></pre>\n\n<blockquote>\n  <p>This proposal:</p>\n  \n  <ul>\n  <li>keeps the best parts of <code>go get</code>, </li>\n  <li>adds <strong>reproducible builds</strong>, </li>\n  <li>adopts semantic versioning, </li>\n  <li><strong>eliminates vendoring</strong>, </li>\n  <li>deprecates <code>GOPATH</code> in favor of a project-based workflow, and </li>\n  <li>provides a smooth migration path from <code>dep</code> and its predecessors.</li>\n  </ul>\n</blockquote>\n\n<p><a href=\"https://i.stack.imgur.com/dF2yx.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/dF2yx.png\" alt=\"vgo semver\"></a></p>\n\n<p>It is based on a new <a href=\"https://research.swtch.com/vgo-mvs\" rel=\"nofollow noreferrer\">MVS (\"Minimal Version Selection\") algorithm</a>:</p>\n\n<p><a href=\"https://i.stack.imgur.com/qO0Ry.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/qO0Ry.png\" alt=\"https://research.swtch.com/version-select-2.png\"></a></p>\n\n<p>You can see:</p>\n\n<ul>\n<li>the first articles in <strong><a href=\"https://research.swtch.com/vgo\" rel=\"nofollow noreferrer\">Go &amp; Versioning</a></strong></li>\n<li>the <a href=\"https://groups.google.com/forum/#!topic/golang-nuts/jFPz5yZCPcQ\" rel=\"nofollow noreferrer\">discussion in this thread</a></li>\n<li>the <a href=\"https://www.calhoun.io/exploring-vgo/\" rel=\"nofollow noreferrer\">analysis of that thread</a> by <strong><a href=\"https://twitter.com/joncalhoun\" rel=\"nofollow noreferrer\">Jon Calhoun</a></strong></li>\n<li>the counter-point by <strong><a href=\"https://twitter.com/sdboyer\" rel=\"nofollow noreferrer\">Sam Boyer</a></strong> in \"<strong><a href=\"https://sdboyer.io/blog/vgo-and-dep/\" rel=\"nofollow noreferrer\">Thoughts on vgo and dep</a></strong>\":<br>\nHe was leading the private initiative of <strong><a href=\"https://github.com/golang/dep\" rel=\"nofollow noreferrer\"><code>go dep</code></a></strong></li>\n<li>the <strong><a href=\"https://www.youtube.com/watch?v=sbrZfPgNmfw\" rel=\"nofollow noreferrer\">first debate (YouTube)</a></strong> between Russ, Sam and <strong><a href=\"https://twitter.com/jessfraz\" rel=\"nofollow noreferrer\">Jesse Frazelle</a></strong>!</li>\n</ul>\n\n<hr>\n\n<p>May 2018: Artifactory <a href=\"https://jfrog.com/blog/goproxy-artifactory-go-registries/\" rel=\"nofollow noreferrer\">proposes a vgo proxy</a></p>\n\n<blockquote>\n  <p>The recent release of <strong>Artifactory 5.11</strong> added support for vgo-compatible Go registries (and go proxy)  giving the community a variety of capabilities when developing with Go.<br>\n  Here are just a few of them:</p>\n  \n  <ul>\n  <li><strong>Local repositories</strong> in Artifactory let you set up secure, private Go registries with fine-grained access control to packages according to projects or development teams.</li>\n  <li>A <strong>remote repository</strong> in Artifactory is a caching proxy for remote Go resources such as a GitHub project. Accessing a go proxy through Artifactory removes your dependency on the network, or on GitHub since all dependencies needed for your Go builds are cached in Artifactory and are therefore locally available. This also removes the risk of someone mutating or removing a dependency from version control, or worse, force-pushing changes to a remote Git tag thus changing what should be an immutable version which can create a lot of confusion and instability for dependent projects.</li>\n  <li>A <strong>virtual repository</strong> aggregates both local and remote Go registries giving you access to all Go resources needed for your builds from a single URL, hiding the complexity of using a combination of both local and remote resources.</li>\n  </ul>\n</blockquote>\n"}], "owner": {"reputation": 72977, "user_id": 95944, "user_type": "registered", "accept_rate": 91, "profile_image": "https://i.stack.imgur.com/SprKq.jpg?s=128&g=1", "display_name": "Richard Knop", "link": "https://stackoverflow.com/users/95944/richard-knop"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 14858, "favorite_count": 7, "accepted_answer_id": 30950192, "answer_count": 4, "score": 39, "last_activity_date": 1535611950, "creation_date": 1431943409, "last_edit_date": 1453814326, "question_id": 30300279, "link": "https://stackoverflow.com/questions/30300279/golang-dependency-management-best-practice", "title": "Golang Dependency Management Best Practice", "body": "<p>In Golang, we can specify open source libraries on GitHub as dependencies. For example:</p>\n\n<pre><code>import \"github.com/RichardKnop/somelibrary\"\n</code></pre>\n\n<p>This will try to look for a branch based on your Go version and default to master if I understand correctly.</p>\n\n<p>So there is no way to import a specific release of a dependency, e.g.:</p>\n\n<pre><code>import \"github.com/RichardKnop/somelibrary#v1.4.8\"\n</code></pre>\n\n<p>What is the best practise to manage dependencies in Go then?</p>\n\n<p>I can see two approaches.</p>\n\n<h2>I. Version Modules</h2>\n\n<p>Is it to create new modules for major versions with breaking changes?</p>\n\n<p>For example, my Go library could define modules v1 and v2 so then you could do:</p>\n\n<pre><code>import \"github.com/RichardKnop/somelibrary/v1\"\n</code></pre>\n\n<p>Or:</p>\n\n<pre><code>import \"github.com/RichardKnop/somelibrary/v2\"\n</code></pre>\n\n<p>Based on what you need. Any changes made to v1 or v2 would be required not to break any APIs or working functionality.</p>\n\n<h2>II. Forking</h2>\n\n<p>This would give you a complete control over a version of external dependency your Go code requires.</p>\n\n<p>For example, you could fork github.com/RichardKnop/somelibrary into your own GitHub account and then in your code do:</p>\n\n<pre><code>import \"github.com/ForkingUser/somelibrary\"\n</code></pre>\n\n<p>Then you would have to fork all external dependencies which seems a bit overkill. However it would give you total control over versions. You could keep your forks at a version you know is working with your code and only update forks once you have checked that new releases of dependencies do not break anything.</p>\n\n<p>Thoughts?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 23, "last_activity_date": 1431942143, "creation_date": 1431942143, "answer_id": 30299818, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64/30299818#30299818", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p><code>ParseInt</code> always returns an <code>int64</code>, and you need to convert the result to your desired type. When you pass <code>32</code> as the third argument, then you'll get a parse error if the parsed value won't fit into an <code>int32</code>, but the returned type is always <code>int64</code>.</p>\n\n<p>For example:</p>\n\n<pre><code>i, err := strconv.ParseInt(\"9207\", 10, 32)\nif err != nil {\n    panic(err)\n}\nresult := int32(i)\nfmt.Printf(\"Parsed int is %d\\n\", result)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 35, "last_activity_date": 1431942779, "last_edit_date": 1431942779, "creation_date": 1431942466, "answer_id": 30299937, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64/30299937#30299937", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p>As per <a href=\"http://golang.org/pkg/strconv/#ParseInt\">documentation</a></p>\n\n<blockquote>\n  <p>func ParseInt(s string, base int, bitSize int) (i int64, err error)</p>\n</blockquote>\n\n<p>ParseInt always return <code>int64</code> no matter what. Moreover</p>\n\n<blockquote>\n  <p>The bitSize argument specifies the integer type that the result must\n  fit into</p>\n</blockquote>\n\n<p>So basically the your <code>bitSize</code> parameter only tells that the string value that you are going to parse should fit the bitSize after parsing. If not, out of range will happen.</p>\n\n<p>Like in this <kbd><a href=\"https://play.golang.org/p/4St_EVhgNq\">PlayGround</a></kbd>:  <code>strconv.ParseInt(\"192\", 10, 8)</code> (as you see the value after the parsing would be bigger than maximum value of <code>int8</code>).</p>\n\n<p>If you want to parse it to whatever value you need, just use <code>int8(i)</code> afterwards (<code>int8</code>, <code>int16</code>, <code>int32</code>).</p>\n\n<p><strong>P.S.</strong> because you touched the topic how to convert to specific intX, I would outline that it is also possible to convert to <a href=\"http://golang.org/pkg/strconv/#ParseUint\">unsigned int</a>.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1565437704, "post_id": 57308676, "comment_id": 101360040, "body": "<code>strconv.ParseInt(s)</code> is documented as being exactly equivalent to <code>strconv.ParseInt(s, 10, 0)</code> so the you&#39;re attempting to benchmark the difference <i>on your platform</i> between <code>bitSize==32</code> and <code>bitSize==0</code>. But your benchmark doesn&#39;t directly compare these because in one case it adds error checking and in the other it ignores errors\u2026 you end up comparing very different things. Also the first will give an error if the value cannot fit in an <code>int32</code> where-as the later will only do the same on a 32bit platform, on your amd64 it will silently truncate the value."}], "tags": [], "owner": {"reputation": 1, "user_id": 3901276, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qa5hk.jpg?s=128&g=1", "display_name": "dingdayu", "link": "https://stackoverflow.com/users/3901276/dingdayu"}, "is_accepted": false, "score": -2, "last_activity_date": 1564661186, "creation_date": 1564661186, "answer_id": 57308676, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64/57308676#57308676", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p>About <code>string</code> conversion to <code>int</code>,I did a test,\nI recommend the way 2(<code>strconv.Atoi(\"1339882\")</code>):</p>\n\n<pre><code>func BenchmarkGetN(b *testing.B)  {\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        i, err := strconv.ParseInt(\"1339882\", 10, 32)\n        if err != nil {\n            panic(err)\n        }\n        a := int32(i)\n        _ = a\n    }\n}\n\nfunc BenchmarkGetN2(b *testing.B) {\n    b.ResetTimer()\n    for i := 0; i &lt; b.N; i++ {\n        a, _ := strconv.Atoi(\"1339882\")\n        bc := int32(a)\n        _ = bc\n    }\n}\n</code></pre>\n\n<pre><code>goos: darwin\ngoarch: amd64\npkg: phonedata\nBenchmarkGetN-4         100000000               20.0 ns/op\nBenchmarkGetN2-4        200000000                9.25 ns/op\nPASS\nok      phonedata       10.913s\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 125, "user_id": 9739569, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-lrDT8XckbVU/AAAAAAAAAAI/AAAAAAAAAWQ/NcIQJAkkG2M/photo.jpg?sz=128", "display_name": "Tomari", "link": "https://stackoverflow.com/users/9739569/tomari"}, "is_accepted": false, "score": -2, "last_activity_date": 1575192507, "last_edit_date": 1575192507, "creation_date": 1575191757, "answer_id": 59124152, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64/59124152#59124152", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p>The source code of the function you mentioned goes like:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func ParseInt(s string, base int, bitSize int) (i int64, err error)\n</code></pre>\n\n<p>So it will always return <code>int64</code></p>\n\n<p>Note that if you want to convert <code>int32</code> to <code>int64</code>, just use <code>int64()</code> and there will not be any problems.  </p>\n\n<p>But converting <code>int64</code> to <code>int32</code> is not safe. If the number you are converting is larger than the maximum of <code>int32</code>, the result value will be wrong. So it is not recommended to use <code>int32()</code> to convert a <code>int64</code> to <code>int32</code>.</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": -1, "last_activity_date": 1617750682, "creation_date": 1617750682, "answer_id": 66977615, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64/66977615#66977615", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p>You can use <code>Sscan</code>:</p>\n<pre><code>package main\nimport &quot;fmt&quot;\n\nfunc main() {\n   {\n      var n int8\n      fmt.Sscan(&quot;100&quot;, &amp;n)\n      fmt.Println(n == 100)\n   }\n   {\n      var n int16\n      fmt.Sscan(&quot;100&quot;, &amp;n)\n      fmt.Println(n == 100)\n   }\n   {\n      var n int32\n      fmt.Sscan(&quot;100&quot;, &amp;n)\n      fmt.Println(n == 100)\n   }\n   {\n      var n int64\n      fmt.Sscan(&quot;100&quot;, &amp;n)\n      fmt.Println(n == 100)\n   }\n}\n</code></pre>\n<p><a href=\"https://golang.org/pkg/fmt#Sscan\" rel=\"nofollow noreferrer\">https://golang.org/pkg/fmt#Sscan</a></p>\n"}], "owner": {"reputation": 18920, "user_id": 1933917, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/7abf55dbb13da076d7a75637f22a74db?s=128&d=identicon&r=PG", "display_name": "Amol M Kulkarni", "link": "https://stackoverflow.com/users/1933917/amol-m-kulkarni"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32528, "favorite_count": 2, "accepted_answer_id": 30299937, "answer_count": 5, "score": 30, "last_activity_date": 1617750682, "creation_date": 1431941719, "last_edit_date": 1565437476, "question_id": 30299649, "link": "https://stackoverflow.com/questions/30299649/parse-string-to-specific-type-of-int-int8-int16-int32-int64", "title": "Parse string to specific type of int (int8, int16, int32, int64)", "body": "<p>I am trying to parse a string into an integer in Go. The Problem I found with it is in the documentation its mentioned syntax is as follows:</p>\n\n<pre><code>ParseInt(s string, base int, bitSize int)\n</code></pre>\n\n<p>where, <code>s</code> is the string to be parsed, <code>base</code> is implied by the string's prefix: base 16 for \"0x\", base 8 for \"0\", and base 10 otherwise. </p>\n\n<p>The <code>bitSize</code> parameter is where I am facing problem. As per documentation of <a href=\"http://golang.org/pkg/strconv/#ParseInt\" rel=\"noreferrer\">ParseInt</a>, it specifies the integer type that the result must fit into. Bit sizes 0, 8, 16, 32, and 64 correspond to int, int8, int16, int32, and int64.</p>\n\n<p>But for all the values like 0, 8, 16, 32, and 64. I am getting same type return value. I.e\u00a0of int64 type. </p>\n\n<p>Could anyone point me out what am I missing.</p>\n\n<p>Code:  <a href=\"https://play.golang.org/p/F3LbUh_maY\" rel=\"noreferrer\">https://play.golang.org/p/F3LbUh_maY</a></p>\n"}, {"tags": ["pointers", "struct", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431925195, "post_id": 30295276, "comment_id": 48686969, "body": "Yes, using pointers is the required and most efficient way."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1431960367, "post_id": 30295276, "comment_id": 48707884, "body": "@icza: Actually, that <code>User</code> struct is only 4 words, and on amd64 that&#39;s 32bytes, less than a single cache line. It will <i>usually</i> be far faster to copy that by value than to dereference a pointer. Smyrnian, in general though don&#39;t worry about it until it poses a problem."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1431966470, "post_id": 30295276, "comment_id": 48712179, "body": "@JimB But the asker wrote he needs to modify it, so if you pass by value, you also have to return it and assign it to the variable. Do you think it will still be faster?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1431968143, "post_id": 30295276, "comment_id": 48713149, "body": "@icza: yeah, I was only thinking about the overhead of the initial call. The pointer is probably faster in the simple case, but as with everything it depends. If there&#39;s a lot of <code>User</code>s, and you&#39;re causing a lot of cache misses with the pointer dereferences, the copying could be faster. I probably shouldn&#39;t have mentioned anything, as this is probably not the level of detail expected by this question ;)"}], "answers": [{"tags": [], "owner": {"reputation": 2911, "user_id": 702065, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/ae529fa78546d54e42c26bd3713946a2?s=128&d=identicon&r=PG", "display_name": "Johan Wikstr&#246;m", "link": "https://stackoverflow.com/users/702065/johan-wikstr%c3%b6m"}, "is_accepted": true, "score": 0, "last_activity_date": 1431926012, "creation_date": 1431926012, "answer_id": 30295534, "question_id": 30295276, "link": "https://stackoverflow.com/questions/30295276/whats-the-most-memory-processor-efficient-way-to-pass-structs-as-parameters-to/30295534#30295534", "title": "What&#39;s the most memory/processor efficient way to pass structs as parameters to functions for modification?", "body": "<p>In Go, using pointers to pass structs for modification is the idiomatic way to do it. There are no reference variables as there are in other languages. So passing a pointer is the most efficient way to do it now and since it is idiomatic, will most likely be so in future versions of Go as well.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 1, "last_activity_date": 1431929334, "last_edit_date": 1431929334, "creation_date": 1431926035, "answer_id": 30295539, "question_id": 30295276, "link": "https://stackoverflow.com/questions/30295276/whats-the-most-memory-processor-efficient-way-to-pass-structs-as-parameters-to/30295539#30295539", "title": "What&#39;s the most memory/processor efficient way to pass structs as parameters to functions for modification?", "body": "<p>Basically there are 2 ways to pass parameters to a function or method: by <em>value</em> and by <em>address</em> (pointer).</p>\n\n<p>Passing a parameter by value makes a copy of the passed value and so if you would modify it, it would modify the copy and not the original value. So if you want to modify the original value, that leaves you only the passing by address option.</p>\n\n<p><strong>Notes:</strong></p>\n\n<p>Note that you could also pass by value and return the modified copy and assign the returned modified value to the variable, but obviously this is less efficient - especially if the struct is large (contains many fields).</p>\n\n<p>In rare cases there might be more efficient ways to pass a value for modification, but I would rather name these cases <em>\"denote\"</em> rather than pass. Let's assume you have a global variable, being a slice of structs. In this case you could just pass the index of the value in the slice you want to modify. And your function could just do the modification of the field of the element denoted by the passed index value. If you just want to modify 1 field, this may be faster and on 32-bit architecture the size of the index value may be smaller than the pointer, and this way you could spare the address taking and dereferencing operations (needs benchmark). But the usability of the function would drop drastically, so I don't recommend this.</p>\n\n<p>That leaves passing by pointer the optimal way in case you need to modify it.</p>\n"}], "owner": {"reputation": 672, "user_id": 1781902, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/dad8c02863eeed2fe87cc9cb358b7a91?s=128&d=identicon&r=PG", "display_name": "Smyrnian", "link": "https://stackoverflow.com/users/1781902/smyrnian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 88, "favorite_count": 0, "accepted_answer_id": 30295534, "answer_count": 2, "score": 1, "last_activity_date": 1431968409, "creation_date": 1431924422, "last_edit_date": 1431968409, "question_id": 30295276, "link": "https://stackoverflow.com/questions/30295276/whats-the-most-memory-processor-efficient-way-to-pass-structs-as-parameters-to", "title": "What&#39;s the most memory/processor efficient way to pass structs as parameters to functions for modification?", "body": "<p>Are using pointers the most memory/processor efficient way to pass structs for modification like <a href=\"http://play.golang.org/p/_1Dci0etXf\" rel=\"nofollow\">below</a> or is there a better way?</p>\n"}, {"tags": ["github", "go"], "comments": [{"owner": {"reputation": 15076, "user_id": 3702377, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/Ac4wz.jpg?s=128&g=1", "display_name": "Benyamin Jafari", "link": "https://stackoverflow.com/users/3702377/benyamin-jafari"}, "edited": false, "score": 5, "creation_date": 1530436862, "post_id": 30295146, "comment_id": 89229185, "body": "If you have an error with this command, remove <code>.git</code> in end of line: <code>go get github.com:capotej&#47;groupcache-db-experiment</code>"}, {"owner": {"reputation": 2287, "user_id": 5267751, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd62e8fd8fbb37abc7e2a39d23828047?s=128&d=identicon&r=PG&f=1", "display_name": "user202729", "link": "https://stackoverflow.com/users/5267751/user202729"}, "edited": false, "score": 0, "creation_date": 1535948576, "post_id": 30295146, "comment_id": 91236038, "body": "See also <a href=\"https://stackoverflow.com/questions/50633092/where-does-go-get-install-packages\">Where does go get install packages?</a>"}, {"owner": {"reputation": 6383, "user_id": 218294, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6ecbae898b5088d092feea0f82ae5ffb?s=128&d=identicon&r=PG", "display_name": "Sam Watkins", "link": "https://stackoverflow.com/users/218294/sam-watkins"}, "edited": false, "score": 1, "creation_date": 1615892668, "post_id": 30295146, "comment_id": 117826804, "body": "Also change the &quot;:&quot; to a &quot;/&quot;."}], "answers": [{"comments": [{"owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 1, "creation_date": 1431926045, "post_id": 30295306, "comment_id": 48687253, "body": "my go environment has been already okay, but I am not familiar with the rules of <code>go get</code>, so <code>github.com:capotej&#47;groupcache-db-experiment.git</code> is not illegal, what is the legal path?"}, {"owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "reply_to_user": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "edited": false, "score": 2, "creation_date": 1431930809, "post_id": 30295306, "comment_id": 48689258, "body": "Try go get -v github.com/capotej/groupcache-db-experiment/... as @peterSO said"}, {"owner": {"reputation": 3263, "user_id": 3998252, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/e12ce9e892926492f5436f0466e5e573?s=128&d=identicon&r=PG&f=1", "display_name": "Manavalan Gajapathy", "link": "https://stackoverflow.com/users/3998252/manavalan-gajapathy"}, "edited": false, "score": 5, "creation_date": 1583188173, "post_id": 30295306, "comment_id": 107024997, "body": "Starting with Go v1.8, <code>GOPATH</code> defaults to <code>$HOME&#47;go</code> if not set.  Source <a href=\"https://golang.org/doc/go1.8#gopath\" rel=\"nofollow noreferrer\">1</a>, <a href=\"https://stackoverflow.com/a/36083961/3998252\">2</a>."}], "tags": [], "owner": {"reputation": 7514, "user_id": 1008837, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/0f67dc852a25a639e13fafbec62eec69?s=128&d=identicon&r=PG&f=1", "display_name": "Pravin Mishra", "link": "https://stackoverflow.com/users/1008837/pravin-mishra"}, "is_accepted": false, "score": 95, "last_activity_date": 1557420142, "last_edit_date": 1557420142, "creation_date": 1431924602, "answer_id": 30295306, "question_id": 30295146, "link": "https://stackoverflow.com/questions/30295146/how-can-i-install-a-package-with-go-get/30295306#30295306", "title": "How can I install a package with go get?", "body": "<p><strong>First, we need GOPATH</strong></p>\n\n<p>The <code>$GOPATH</code> is a folder (or set of folders) specified by its environment variable. We must notice that this is not the <code>$GOROOT</code> directory where Go is installed.</p>\n\n<pre><code>export GOPATH=$HOME/gocode\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>We used <code>~/gocode</code> path in our computer to store the source of our application and its dependencies. The <code>GOPATH</code> directory will also store the binaries of their packages.</p>\n\n<p><strong>Then check Go env</strong></p>\n\n<p>You system must have <code>$GOPATH</code> and <code>$GOROOT</code>, below is my Env:</p>\n\n<pre><code>GOARCH=\"amd64\"\nGOBIN=\"\"\nGOCHAR=\"6\"\nGOEXE=\"\"\nGOHOSTARCH=\"amd64\"\nGOHOSTOS=\"linux\"\nGOOS=\"linux\"\nGOPATH=\"/home/elpsstu/gocode\"\nGORACE=\"\"\nGOROOT=\"/home/pravin/go\"\nGOTOOLDIR=\"/home/pravin/go/pkg/tool/linux_amd64\"\nCC=\"gcc\"\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\nCXX=\"g++\"\nCGO_ENABLED=\"1\"\n</code></pre>\n\n<p><strong>Now, you run download go package:</strong></p>\n\n<pre><code>go get [-d] [-f] [-fix] [-t] [-u] [build flags] [packages]\n</code></pre>\n\n<p>Get downloads and installs the packages named by the import paths, along with their dependencies. For more details you can look <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"noreferrer\">here</a>. </p>\n"}, {"comments": [{"owner": {"reputation": 2989, "user_id": 513739, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d13dff31735876d38f7e7a6e2ea10202?s=128&d=identicon&r=PG", "display_name": "Excalibur", "link": "https://stackoverflow.com/users/513739/excalibur"}, "edited": false, "score": 24, "creation_date": 1494260368, "post_id": 30296041, "comment_id": 74740798, "body": "If this helps anyone, the solution to my problem (<code>package github.com&#47;coreos&#47;go-iptables.git: invalid version control suffix in github.com&#47; path</code>) was to remove the <code>.git</code> suffix from the Github URL."}, {"owner": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "edited": false, "score": 6, "creation_date": 1519367802, "post_id": 30296041, "comment_id": 84891502, "body": "what does <code>-v</code> do?"}, {"owner": {"reputation": 548, "user_id": 1533771, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e15de48c8270d4132ecc1d70abdf7106?s=128&d=identicon&r=PG", "display_name": "omrsin", "link": "https://stackoverflow.com/users/1533771/omrsin"}, "reply_to_user": {"reputation": 4897, "user_id": 4573839, "user_type": "registered", "accept_rate": 89, "profile_image": "https://lh4.googleusercontent.com/-wLBU0P4GoTk/AAAAAAAAAAI/AAAAAAAAAPM/8Xy7C9d-XoU/photo.jpg?sz=128", "display_name": "yu yang Jian", "link": "https://stackoverflow.com/users/4573839/yu-yang-jian"}, "edited": false, "score": 3, "creation_date": 1520841371, "post_id": 30296041, "comment_id": 85464114, "body": "@yuyangJian it means verbose output."}, {"owner": {"reputation": 28330, "user_id": 807674, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/3ccce8c8f0e12321bed1f910921c1f73?s=128&d=identicon&r=PG", "display_name": "acjay", "link": "https://stackoverflow.com/users/807674/acjay"}, "edited": false, "score": 5, "creation_date": 1538797927, "post_id": 30296041, "comment_id": 92280456, "body": "How do you run it once you&#39;ve used <code>go get</code>?"}, {"owner": {"reputation": 18585, "user_id": 430062, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/018c3bfcc249e1e2ac8618429599d5c9?s=128&d=identicon&r=PG", "display_name": "Theodore R. Smith", "link": "https://stackoverflow.com/users/430062/theodore-r-smith"}, "edited": false, "score": 1, "creation_date": 1602661590, "post_id": 30296041, "comment_id": 113787832, "body": "That\u2019s my question. I can\u2019t find it anywhere."}, {"owner": {"reputation": 159, "user_id": 13383986, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/3wXK1.png?s=128&g=1", "display_name": "GoForth", "link": "https://stackoverflow.com/users/13383986/goforth"}, "reply_to_user": {"reputation": 18585, "user_id": 430062, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/018c3bfcc249e1e2ac8618429599d5c9?s=128&d=identicon&r=PG", "display_name": "Theodore R. Smith", "link": "https://stackoverflow.com/users/430062/theodore-r-smith"}, "edited": false, "score": 0, "creation_date": 1616627685, "post_id": 30296041, "comment_id": 118065985, "body": "@TheodoreR.Smith If you have <code>$GOPATH&#47;bin</code> in your system path then you can run the program by binary name right away.  The <code>go get</code> command will generally build the code and (if it&#39;s a program) put the binary in the bin, so you can access right away in the terminal"}], "tags": [], "owner": {"reputation": 133115, "user_id": 221700, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad32856042eea9fd2db5210ac033787d?s=128&d=identicon&r=PG", "display_name": "peterSO", "link": "https://stackoverflow.com/users/221700/peterso"}, "is_accepted": true, "score": 135, "last_activity_date": 1542520524, "last_edit_date": 1542520524, "creation_date": 1431928781, "answer_id": 30296041, "question_id": 30295146, "link": "https://stackoverflow.com/questions/30295146/how-can-i-install-a-package-with-go-get/30296041#30296041", "title": "How can I install a package with go get?", "body": "<blockquote>\n  <p><a href=\"http://golang.org/cmd/go/\" rel=\"noreferrer\">Command go</a></p>\n  \n  <p><a href=\"http://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"noreferrer\">Download and install packages and dependencies</a></p>\n  \n  <p>Usage:</p>\n\n<pre><code>go get [-d] [-f] [-t] [-u] [-v] [-fix] [-insecure] [build flags] [packages]\n</code></pre>\n  \n  <p>Get downloads the packages named by the import paths, along with their\n  dependencies. It then installs the named packages, like 'go install'.</p>\n  \n  <p>The -d flag instructs get to stop after downloading the packages; that\n  is, it instructs get not to install the packages.</p>\n  \n  <p>The -f flag, valid only when -u is set, forces get -u not to verify\n  that each package has been checked out from the source control\n  repository implied by its import path. This can be useful if the\n  source is a local fork of the original.</p>\n  \n  <p>The -fix flag instructs get to run the fix tool on the downloaded\n  packages before resolving dependencies or building the code.</p>\n  \n  <p>The -insecure flag permits fetching from repositories and resolving\n  custom domains using insecure schemes such as HTTP. Use with caution.</p>\n  \n  <p>The -t flag instructs get to also download the packages required to\n  build the tests for the specified packages.</p>\n  \n  <p>The -u flag instructs get to use the network to update the named\n  packages and their dependencies. By default, get uses the network to\n  check out missing packages but does not use it to look for updates to\n  existing packages.</p>\n  \n  <p>The -v flag enables verbose progress and debug output.</p>\n  \n  <p>Get also accepts build flags to control the installation. See 'go help\n  build'.</p>\n  \n  <p>When checking out a new package, get creates the target directory\n  GOPATH/src/. If the GOPATH contains multiple entries, get\n  uses the first one. For more details see: 'go help gopath'.</p>\n  \n  <p>When checking out or updating a package, get looks for a branch or tag\n  that matches the locally installed version of Go. The most important\n  rule is that if the local installation is running version \"go1\", get\n  searches for a branch or tag named \"go1\". If no such version exists it\n  retrieves the default branch of the package.</p>\n  \n  <p>When go get checks out or updates a Git repository, it also updates\n  any git submodules referenced by the repository.</p>\n  \n  <p>Get never checks out or updates code stored in vendor directories.</p>\n  \n  <p>For more about specifying packages, see 'go help packages'.</p>\n  \n  <p>For more about how 'go get' finds source code to download, see 'go\n  help importpath'.</p>\n  \n  <p>This text describes the behavior of get when using GOPATH to manage\n  source code and dependencies. If instead the go command is running in\n  module-aware mode, the details of get's flags and effects change, as\n  does 'go help get'. See 'go help modules' and 'go help module-get'.</p>\n  \n  <p>See also: go build, go install, go clean.</p>\n</blockquote>\n\n<hr>\n\n<p>For example, showing verbose output,</p>\n\n<pre><code>$ go get -v github.com/capotej/groupcache-db-experiment/...\ngithub.com/capotej/groupcache-db-experiment (download)\ngithub.com/golang/groupcache (download)\ngithub.com/golang/protobuf (download)\ngithub.com/capotej/groupcache-db-experiment/api\ngithub.com/capotej/groupcache-db-experiment/client\ngithub.com/capotej/groupcache-db-experiment/slowdb\ngithub.com/golang/groupcache/consistenthash\ngithub.com/golang/protobuf/proto\ngithub.com/golang/groupcache/lru\ngithub.com/capotej/groupcache-db-experiment/dbserver\ngithub.com/capotej/groupcache-db-experiment/cli\ngithub.com/golang/groupcache/singleflight\ngithub.com/golang/groupcache/groupcachepb\ngithub.com/golang/groupcache\ngithub.com/capotej/groupcache-db-experiment/frontend\n$ \n</code></pre>\n"}], "owner": {"reputation": 6317, "user_id": 2849157, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/81de56159f8a6f58c78e3e7d88d7fbe5?s=128&d=identicon&r=PG&f=1", "display_name": "roger", "link": "https://stackoverflow.com/users/2849157/roger"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 324267, "favorite_count": 38, "accepted_answer_id": 30296041, "answer_count": 2, "score": 154, "last_activity_date": 1557420142, "creation_date": 1431923543, "last_edit_date": 1496318554, "question_id": 30295146, "link": "https://stackoverflow.com/questions/30295146/how-can-i-install-a-package-with-go-get", "title": "How can I install a package with go get?", "body": "<p>I want to install packages from github to my gopath, I have tried this:</p>\n\n<pre><code>go get github.com:capotej/groupcache-db-experiment.git\n</code></pre>\n\n<p>the repository is <a href=\"https://github.com/capotej/groupcache-db-experiment\" rel=\"noreferrer\">here</a>.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 961, "user_id": 2353196, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/65de4e83806a99f3948073a0711c7a9c?s=128&d=identicon&r=PG", "display_name": "wickstopher", "link": "https://stackoverflow.com/users/2353196/wickstopher"}, "edited": false, "score": 2, "creation_date": 1431914726, "post_id": 30294089, "comment_id": 48684600, "body": "I&#39;m no Go expert but a quick look at the API shows that the function is Marshal (one &#39;l&#39;, not two)."}], "answers": [{"tags": [], "owner": {"reputation": 8195, "user_id": 1330470, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e058db5117c8cda19c932ab08805aabc?s=128&d=identicon&r=PG", "display_name": "bredikhin", "link": "https://stackoverflow.com/users/1330470/bredikhin"}, "is_accepted": false, "score": 1, "last_activity_date": 1431920091, "last_edit_date": 1431920091, "creation_date": 1431914794, "answer_id": 30294115, "question_id": 30294089, "link": "https://stackoverflow.com/questions/30294089/go-language-program-error/30294115#30294115", "title": "Go Language Program error", "body": "<p>Update your program </p>\n\n<pre><code>output, err := json.Marshal(message)\n</code></pre>\n\n<p>(<code>Marshal</code> with one <code>l</code>, <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">http://golang.org/pkg/encoding/json/#Marshal</a>).</p>\n"}, {"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 4, "last_activity_date": 1431915351, "creation_date": 1431915351, "answer_id": 30294180, "question_id": 30294089, "link": "https://stackoverflow.com/questions/30294089/go-language-program-error/30294180#30294180", "title": "Go Language Program error", "body": "<p>The output clearly tells you what is your problem. </p>\n\n<blockquote>\n  <p>undefined: json.Marshall</p>\n</blockquote>\n\n<p>means that there is no method with this name. On the other side looking at the <a href=\"http://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow\">documentation</a> the method is called </p>\n\n<blockquote>\n  <p>func Marshal(v interface{}) ([]byte, error)</p>\n</blockquote>\n\n<p>So just use a correct name and learn how to debug because debugging is really important in software engineering.</p>\n"}], "owner": {"reputation": 5661, "user_id": 2541276, "user_type": "registered", "accept_rate": 55, "profile_image": "https://graph.facebook.com/100001587714573/picture?type=large", "display_name": "Rajkumar Natarajan", "link": "https://stackoverflow.com/users/2541276/rajkumar-natarajan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 406, "favorite_count": 0, "closed_date": 1431941223, "accepted_answer_id": 30294180, "answer_count": 2, "score": -2, "last_activity_date": 1450121343, "creation_date": 1431914470, "last_edit_date": 1450121343, "question_id": 30294089, "link": "https://stackoverflow.com/questions/30294089/go-language-program-error", "closed_reason": "Not suitable for this site", "title": "Go Language Program error", "body": "<p>I am a new Go Language programmer. Below is my program but I am getting this error:</p>\n\n<pre><code>#command-line-arguments\n    .\\helloworld.go:20: undefined: json.Marshall\n</code></pre>\n\n<p>Can anyone tell why I get the error?</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"net/http\"\n)\n\ntype API struct {\n    Message string \"json:message\"\n}\n\nfunc main() {\n\n    http.HandleFunc(\"/api\", func(w http.ResponseWriter, r *http.Request) {\n\n        message := API{\"Hello, World!!!\"}\n\n        output, err := json.Marshall(message)\n\n        if err != nil {\n            fmt.Println(\"Something went wrong\")\n        }\n\n        fmt.Fprintf(w, string(output))\n\n    })\n\n    http.ListenAndServe(\":8080\", nil)\n\n}\n</code></pre>\n"}, {"tags": ["go", "sms", "pdu", "smspdu"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 1, "creation_date": 1431902090, "post_id": 30291987, "comment_id": 48682168, "body": "what exactly do you want?"}, {"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1431916837, "post_id": 30291987, "comment_id": 48685052, "body": "Could you provide your current implementation or some other go specific detail?"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": true, "score": 4, "last_activity_date": 1431910331, "creation_date": 1431910331, "answer_id": 30293674, "question_id": 30291987, "link": "https://stackoverflow.com/questions/30291987/parse-sms-pdu-on-go/30293674#30293674", "title": "Parse SMS PDU on go", "body": "<p>Yep. A quick <a href=\"http://go-search.org/search?q=pdu\" rel=\"nofollow\">search</a> turned up: <a href=\"https://godoc.org/github.com/xlab/at/sms\" rel=\"nofollow\">github.com/xlab/at/sms</a>. Here's an example program:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/hex\"\n    \"fmt\"\n\n    \"github.com/xlab/at/sms\"\n)\n\nfunc main() {\n    bs, err := hex.DecodeString(\"0791361907002039040C9136198748701300005150713220052308C8303A8C0EA3C3\")\n    if err != nil {\n        panic(err)\n    }\n    msg := new(sms.Message)\n    msg.ReadFrom(bs)\n    fmt.Println(msg)\n}\n</code></pre>\n\n<p>Running that gives me:</p>\n\n<pre><code>&amp;{0 0 0 0 {63567471770 0 0x57bac0} +639170000293 +639178840731 Hahahaha 0 false false false false false false false}\n</code></pre>\n\n<p>Also the parent package seems like it has a bunch of functions you may find useful.</p>\n"}], "owner": {"reputation": 521, "user_id": 3416153, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d57673c14a704d4e06dcac38fd65fd66?s=128&d=identicon&r=PG&f=1", "display_name": "javinc", "link": "https://stackoverflow.com/users/3416153/javinc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1067, "favorite_count": 0, "accepted_answer_id": 30293674, "answer_count": 1, "score": 0, "last_activity_date": 1562421836, "creation_date": 1431895738, "last_edit_date": 1562421836, "question_id": 30291987, "link": "https://stackoverflow.com/questions/30291987/parse-sms-pdu-on-go", "title": "Parse SMS PDU on go", "body": "<p>Is it possible to parse SMS PDU using just golang</p>\n\n<p>executing AT command</p>\n\n<pre><code>AT+CMGF=0\nOK\n\nAT+CMGL=4\n+CMGL: 0,1,,26\n0791361907002039040C9136198748701300005150713220052308C8303A8C0EA3C3\n</code></pre>\n\n<p>is there way to decode this in go?</p>\n\n<pre><code>0791361907002039040C9136198748701300005150713220052308C8303A8C0EA3C3\n</code></pre>\n\n<p>if there's not, can you suggest a work around.</p>\n"}, {"tags": ["c", "go"], "answers": [{"comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "edited": false, "score": 0, "creation_date": 1431957887, "post_id": 30290367, "comment_id": 48706004, "body": "@Varun: though the first example may compile, you cannot keep a pointer value in a <code>uintptr</code>. They are not followed by the GC, and the referenced object will be collected. You could use <code>uintptr</code> if you have the real pointer stored somewhere, but then you should just be using the correct type, an interface, or an <code>unsafe.Pointer</code>."}], "tags": [], "owner": {"reputation": 1299, "user_id": 1733239, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/59e2e0ce638ca008172efc846ebd17e0?s=128&d=identicon&r=PG", "display_name": "Soheil Hassas Yeganeh", "link": "https://stackoverflow.com/users/1733239/soheil-hassas-yeganeh"}, "is_accepted": true, "score": 4, "last_activity_date": 1431886437, "creation_date": 1431886437, "answer_id": 30290367, "question_id": 30287218, "link": "https://stackoverflow.com/questions/30287218/casting-to-struct-type-in-go-lang/30290367#30290367", "title": "casting to struct type in go lang", "body": "<p>You cannot cast pointers to arbitrary types in Go. If you really want to do that, you should use unsafe.Pointer:</p>\n\n<pre><code>type varAttrib1b struct {\n    vaHeader uint8\n    vaData   []string\n}\n\nfunc varAttIs1B(ptr uintptr) bool {\n    return ((*varAttrib1b)(unsafe.Pointer(ptr)).vaHeader &amp; 0x01) == 0x01\n}\n</code></pre>\n\n<p>It compiles and works, but are you sure there is no safe way of doing that in go? Can't you just define an interface:</p>\n\n<pre><code>type Attr interface {\n    AttrIs1B() bool\n}\n\nfunc (b varAttrib1b) AttrIs1B() bool {\n    return b.vaHeader &amp; 0x01 == 0x01\n}\n\nfunc varAttIs1B(attr Attr) bool {\n    return attr.AttrIs1B()\n}\n</code></pre>\n\n<p>Or implement it with type casts?</p>\n\n<pre><code>func varAttIs1B(ptr interface{}) bool {\n    switch a := ptr.(type) {\n    case varAttrib1b:\n        return a.vaHeader &amp; 0x01 == 0x01\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 951, "user_id": 631593, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/6f0ab0bf648041c211675b2bd06313c6?s=128&d=identicon&r=PG", "display_name": "Varun", "link": "https://stackoverflow.com/users/631593/varun"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1981, "favorite_count": 0, "accepted_answer_id": 30290367, "answer_count": 1, "score": 1, "last_activity_date": 1431886437, "creation_date": 1431868355, "question_id": 30287218, "link": "https://stackoverflow.com/questions/30287218/casting-to-struct-type-in-go-lang", "title": "casting to struct type in go lang", "body": "<p>I have some c macros in the form of </p>\n\n<pre><code>#define VARATT_IS_4B(PTR) \\\n    ((((varattrib_1b *) (PTR))-&gt;va_header &amp; 0x80) == 0x00)\n</code></pre>\n\n<p>and want to convert it to Go lang. I am doing something like </p>\n\n<pre><code>func varAttIs1B(ptr uintptr) bool {\n    return (*varAttrib1b(ptr).vaHeader &amp; 0x01) == 0x01\n}\n</code></pre>\n\n<p>but yeah, it is not working and I am getting compiler error <strong>\"cannot convert ptr (type int) to type varAttrib1b\"</strong>.</p>\n\n<p>varAttrib1b is a struct with two fields and ptr is a uintptr(could be some other type also). </p>\n\n<pre><code>type varAttrib1b struct {\n    vaHeader uint8\n    vaData   []string\n}\n</code></pre>\n\n<p>How can I do this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 2294053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/103414b6c6b4ddd9244a7b2f5c0be97f?s=128&d=identicon&r=PG", "display_name": "Hugh", "link": "https://stackoverflow.com/users/2294053/hugh"}, "edited": false, "score": 0, "creation_date": 1431861079, "post_id": 30285967, "comment_id": 48669990, "body": "Thanks for your help. Except the attributes, I also want the innerxml.  Just like the example."}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "reply_to_user": {"reputation": 43, "user_id": 2294053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/103414b6c6b4ddd9244a7b2f5c0be97f?s=128&d=identicon&r=PG", "display_name": "Hugh", "link": "https://stackoverflow.com/users/2294053/hugh"}, "edited": false, "score": 0, "creation_date": 1431942731, "post_id": 30285967, "comment_id": 48695848, "body": "@Hugh if this is answering your question, you should <a href=\"http://stackoverflow.com/help/someone-answers\">mark the answer as accepted</a> by clicking on the check mark beside the answer."}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 2, "last_activity_date": 1431873739, "last_edit_date": 1495541659, "creation_date": 1431859145, "answer_id": 30285967, "question_id": 30285759, "link": "https://stackoverflow.com/questions/30285759/xml-unmarshal-innerxml-and-its-attributes/30285967#30285967", "title": "xml Unmarshal innerXml and its attributes", "body": "<p>In your <code>UnmarshalXML</code> method you call <code>xml.(*Decoder).DecodeElement</code>, which in turn calls <code>UnmarshalXML</code>, etc. This creates the infinite loop. Either create a wrapper struct, or unmarshal only a part of your struct in your <code>UnmarshalXML</code>.</p>\n\n<p><strong>EDIT:</strong> if you want to unmarshal all attributes of a node, see the example in <a href=\"https://stackoverflow.com/a/25534187/1892060\">this answer</a>.</p>\n\n<p>Working example:</p>\n\n<pre><code>func (in *innerXml) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    in.XMLName = start.Name\n    in.Attrs = make(map[string]string)\n    for _, attr := range start.Attr {\n        in.Attrs[attr.Name.Local] = attr.Value\n    }\n\n    err := d.DecodeElement(&amp;in.Value, &amp;start)\n    if err != nil {\n        return err\n    }\n\n    return nil\n}\n</code></pre>\n\n<p>Playground: <a href=\"http://play.golang.org/p/TLcqFSyn94\" rel=\"nofollow noreferrer\">http://play.golang.org/p/TLcqFSyn94</a></p>\n"}], "owner": {"reputation": 43, "user_id": 2294053, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/103414b6c6b4ddd9244a7b2f5c0be97f?s=128&d=identicon&r=PG", "display_name": "Hugh", "link": "https://stackoverflow.com/users/2294053/hugh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 611, "favorite_count": 0, "accepted_answer_id": 30285967, "answer_count": 1, "score": 2, "last_activity_date": 1431993028, "creation_date": 1431857652, "last_edit_date": 1592644375, "question_id": 30285759, "link": "https://stackoverflow.com/questions/30285759/xml-unmarshal-innerxml-and-its-attributes", "title": "xml Unmarshal innerXml and its attributes", "body": "<p>I want to Unmarshal the innerXml and its attributes. I write a Unmarshal function to implement this, but it looks like the function is in an infinite loop. The error information is</p>\n<pre><code>runtime: goroutine stack exceeds 1000000000-byte limit \nfatal error: stack overflow\n</code></pre>\n<p>The example is <a href=\"http://play.golang.org/p/8uAG7plKDy\" rel=\"nofollow noreferrer\">here</a>.</p>\n<p>I don't know why this happens. Could someone help me, thanks.</p>\n<p>Update1: Thanks Ainar-G. I tried his example. It works as get the innerXml as chardata which I did't find. If I change the example as <a href=\"http://play.golang.org/p/25qsRtfU0U\" rel=\"nofollow noreferrer\">this</a>, the result is empty, it should include all the raw xml in .</p>\n<p>Update2: I find a solution, but may be a little wordy. <a href=\"http://play.golang.org/p/ONKlk9B07a\" rel=\"nofollow noreferrer\">code</a>.</p>\n"}, {"tags": ["arrays", "go", "slice"], "answers": [{"comments": [{"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 11, "creation_date": 1431876300, "post_id": 30285971, "comment_id": 48674061, "body": "This is correct, but a small addition: you don&#39;t need <code>copy(arr[:], slice[:4])</code>, <code>copy(arr[:], slice)</code> is enough. <code>copy</code> automatically limits itself to the smaller of the given slices."}, {"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "reply_to_user": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 0, "creation_date": 1431878881, "post_id": 30285971, "comment_id": 48674953, "body": "@Aedolon Thanks for the hint, added it to the answer."}, {"owner": {"reputation": 3451, "user_id": 7016115, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/e53D0.jpg?s=128&g=1", "display_name": "Shudipta Sharma", "link": "https://stackoverflow.com/users/7016115/shudipta-sharma"}, "edited": false, "score": 0, "creation_date": 1577038519, "post_id": 30285971, "comment_id": 105076453, "body": "nice answer, really."}], "tags": [], "owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "is_accepted": true, "score": 88, "last_activity_date": 1431878871, "last_edit_date": 1431878871, "creation_date": 1431859160, "answer_id": 30285971, "question_id": 30285680, "link": "https://stackoverflow.com/questions/30285680/how-to-convert-slice-to-fixed-size-array/30285971#30285971", "title": "How to convert slice to fixed size array?", "body": "<p>You need to use <code>copy</code>:</p>\n\n<pre><code>slice := []byte(\"abcdefgh\")\n\nvar arr [4]byte\n\ncopy(arr[:], slice[:4])\n\nfmt.Println(arr)\n</code></pre>\n\n<p>As Aedolon notes you can also just use</p>\n\n<pre><code>copy(arr[:], slice)\n</code></pre>\n\n<p>as copy will always only copy the minimum of <code>len(src)</code> and <code>len(dst)</code> bytes. </p>\n"}, {"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1607082343, "post_id": 65142796, "comment_id": 115166601, "body": "This example is very easy to break. See here: <a href=\"https://play.golang.org/p/iSq4Q9XrRQv\" rel=\"nofollow noreferrer\">play.golang.org/p/iSq4Q9XrRQv</a>"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1607082415, "post_id": 65142796, "comment_id": 115166641, "body": "Also, <a href=\"https://meta.stackoverflow.com/questions/303812/discourage-screenshots-of-code-and-or-errors\">don&#39;t paste images of text</a>."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1607088287, "post_id": 65142796, "comment_id": 115169239, "body": "If you really need to do this, don&#39;t use your own slice header, just convert the data directly: <a href=\"https://play.golang.org/p/3oNob6k5ynx\" rel=\"nofollow noreferrer\">play.golang.org/p/3oNob6k5ynx</a>"}, {"owner": {"reputation": 21, "user_id": 14762064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3139585d2cb6dd4425d08e22c9861c70?s=128&d=identicon&r=PG&f=1", "display_name": "Yiheng", "link": "https://stackoverflow.com/users/14762064/yiheng"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1607088991, "post_id": 65142796, "comment_id": 115169567, "body": "@JimB thanks for that. But if you change any element of i, x&#39;s value will not change. It seems like a deep copy."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1607089931, "post_id": 65142796, "comment_id": 115170044, "body": "@Yiheng: yes, because arrays are values in the first place, so assignment itself is a copy. If you don&#39;t want a copy, you need to use a pointer, but in that case, why not just use a slice in the first place? <a href=\"https://play.golang.org/p/kF3_46UDbJN\" rel=\"nofollow noreferrer\">play.golang.org/p/kF3_46UDbJN</a>"}, {"owner": {"reputation": 21, "user_id": 14762064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3139585d2cb6dd4425d08e22c9861c70?s=128&d=identicon&r=PG&f=1", "display_name": "Yiheng", "link": "https://stackoverflow.com/users/14762064/yiheng"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1607090493, "post_id": 65142796, "comment_id": 115170340, "body": "@JimB Since I need to use a slice as the key of a map, it is the easiest way to do so in my understand. However, your code is better than mine. Thanks for that, and I learned a lot."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1607090613, "post_id": 65142796, "comment_id": 115170412, "body": "Can you just use byte arrays from the beginning, so no conversion is necessary?"}, {"owner": {"reputation": 21, "user_id": 14762064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3139585d2cb6dd4425d08e22c9861c70?s=128&d=identicon&r=PG&f=1", "display_name": "Yiheng", "link": "https://stackoverflow.com/users/14762064/yiheng"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1607091262, "post_id": 65142796, "comment_id": 115170729, "body": "@Flimzy I really can&#39;t, since all data are from protobuf."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1607092015, "post_id": 65142796, "comment_id": 115171108, "body": "I&#39;m not intimately familiar with that level of detail, but AFAIK, you can unmarshal a pb message into an arbitrary type, so should be able to unmarshal into byte arrays instead of byte slices. If nothing else, you can probably set the target array to be backed by an explicit array."}], "tags": [], "owner": {"reputation": 21, "user_id": 14762064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3139585d2cb6dd4425d08e22c9861c70?s=128&d=identicon&r=PG&f=1", "display_name": "Yiheng", "link": "https://stackoverflow.com/users/14762064/yiheng"}, "is_accepted": false, "score": 1, "last_activity_date": 1607085595, "last_edit_date": 1607085595, "creation_date": 1607081449, "answer_id": 65142796, "question_id": 30285680, "link": "https://stackoverflow.com/questions/30285680/how-to-convert-slice-to-fixed-size-array/65142796#65142796", "title": "How to convert slice to fixed size array?", "body": "<p>I found a way to solve the problem without allocating any more space - to define a new struct with the same construction as slice and receive the unsafe.Pointer.</p>\n<pre><code>type MySlice struct {\n    Array unsafe.Pointer\n    cap   int\n    len   int\n}\nfunc main(){\n    a := []byte{1, 2, 3, 4}\n    fmt.Printf(&quot;a before %v, %p\\n&quot;, a, &amp;a)\n    b := (*MySlice)(unsafe.Pointer(&amp;a))\n    c := (*[4]byte)(b.Array)\n    fmt.Printf(&quot;c before %v, %T, %p\\n&quot;, *c, *c, c)\n    a[1] = 5\n    fmt.Printf(&quot;c after %v, %p\\n&quot;, *c, c)\n    fmt.Printf(&quot;a after %v, %p\\n&quot;, a, &amp;a)\n}\n</code></pre>\n<p>the result shows as follows:\n<img src=\"https://i.stack.imgur.com/2UMXV.png\" alt=\"result\" /></p>\n"}], "owner": {"reputation": 1569, "user_id": 3782904, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/737f20f5eea963b28aafe5563480ca4d?s=128&d=identicon&r=PG&f=1", "display_name": "thi gg", "link": "https://stackoverflow.com/users/3782904/thi-gg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32181, "favorite_count": 14, "closed_date": 1607090289, "accepted_answer_id": 30285971, "answer_count": 2, "score": 39, "last_activity_date": 1607085595, "creation_date": 1431857040, "last_edit_date": 1558685866, "question_id": 30285680, "link": "https://stackoverflow.com/questions/30285680/how-to-convert-slice-to-fixed-size-array", "closed_reason": "Duplicate", "title": "How to convert slice to fixed size array?", "body": "<p>I want to convert a fixed size array from a slice:</p>\n\n<pre><code>func gen(bricks []Brick) {\n    if len(bricks) == 16 {\n        if check(Sculpture{bricks}) {\n            var b [16]Brick = bricks[0:16];\n        }\n     }\n}\n</code></pre>\n\n<p>But this results in:</p>\n\n<pre><code> cannot use bricks[0:16] (type []Brick) as type [16]Brick in assignment\n</code></pre>\n\n<p>How to convert a slice into a fixed size array?</p>\n"}, {"tags": ["templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1431866166, "post_id": 30285384, "comment_id": 48671206, "body": "Ah, that funcmap is genius!! Though ideally I would want the h1 to not be in the list item and the list items to be in a unordered list tag by year. e.g. <code>&lt;h1&gt;YYYY&lt;&#47;h1&gt;&lt;ul&gt;&lt;li&gt;post 1&lt;&#47;li&gt;&lt;li&gt;post etc&lt;&#47;li&gt;&lt;&#47;ul&gt;</code>."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1431875622, "post_id": 30285384, "comment_id": 48673795, "body": "That&#39;s pretty simple to accomplish at this point. Few small changes and here is a <a href=\"https://play.golang.org/p/k4574UTyV2\" rel=\"nofollow noreferrer\">new playground</a> sample. Biggest change is that you have to test for the first item so you don&#39;t stick a &lt;/ul&gt; at the beginning. The sample produces exactly what you want."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": true, "score": 2, "last_activity_date": 1431854723, "creation_date": 1431854723, "answer_id": 30285384, "question_id": 30284533, "link": "https://stackoverflow.com/questions/30284533/range-through-times-to-pretty-print-by-year/30285384#30285384", "title": "Range through times to pretty print by year", "body": "<p>Implement the <a href=\"https://golang.org/pkg/sort/#Interface\" rel=\"nofollow\">sort.Interface</a> on your <code>Posts</code> struct, then sort it in reverse order.</p>\n\n<pre><code>type Posts struct {\n    Posts []Post\n}\n\nfunc (p Posts) Len() int {\n    return len(p.Posts)\n}\n\nfunc (p Posts) Less(i, j int) bool {\n    return p.Posts[i].PostDate.Before(p.Posts[j].PostDate)\n}\n\nfunc (p Posts) Swap(i, j int) {\n    p.Posts[i], p.Posts[j] = p.Posts[j], p.Posts[i]\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>posts := Posts{p}\nsort.Sort(sort.Reverse(posts))\n</code></pre>\n\n<p>That will give you the posts in the sequence you want them.</p>\n\n<p>Next you'll have to implement a func using a closure so you can check if the current year is the same as the one for the last post to get the grouping by year. If yes output just the post, otherwise output a header with the year followed by the post.</p>\n\n<pre><code>currentYear := \"1900\"\nfuncMap := template.FuncMap{\n    \"newYear\": func(t string) bool {\n        if t == currentYear {\n            return false\n        } else {\n            currentYear = t\n            return true\n        }\n    },\n}\n</code></pre>\n\n<p>and to use it:</p>\n\n<pre><code>{{ range . }}{{ if newYear (.PostDate.Format \"2006\") }}&lt;li&gt;&lt;h1&gt;{{ .PostDate.Format \"2006\" }}&lt;/h1&gt;&lt;/li&gt;{{ end }}\n</code></pre>\n\n<p>See a working example <a href=\"https://play.golang.org/p/vSfgOHUVTl\" rel=\"nofollow\">on the Playground</a>.</p>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 1, "accepted_answer_id": 30285384, "answer_count": 1, "score": 0, "last_activity_date": 1431854723, "creation_date": 1431848597, "question_id": 30284533, "link": "https://stackoverflow.com/questions/30284533/range-through-times-to-pretty-print-by-year", "title": "Range through times to pretty print by year", "body": "<p>Currently I'm printing post archive dates like so with <a href=\"https://play.golang.org/p/P1-sAo5Qy8\" rel=\"nofollow\">https://play.golang.org/p/P1-sAo5Qy8</a>:</p>\n\n<ul>\n<li>2009 Nov 10&raquo;<a href=\"/foo/bar\">Something happened in 2009</a></li>\n<li>2005 Nov 10&raquo;<a href=\"/foo/old\">Something happened 10 years ago</a></li>\n<li>2009 Jun 10&raquo;<a href=\"/foo/june\">Summer of 2009</a></li>\n</ul>\n\n<p>Though I think it's nicer to print by year:</p>\n\n<h1>2009</h1>\n\n<ul>\n<li>2009 Nov 10&raquo;<a href=\"/foo/bar\">Something happened in 2009</a></li>\n<li>2009 Jun 10&raquo;<a href=\"/foo/june\">Summer of 2009</a></li>\n</ul>\n\n<h1>2005</h1>\n\n<ul>\n<li>2005 Nov 10&raquo;<a href=\"/foo/old\">Something happened 10 years ago</a></li>\n</ul>\n\n<p>How would I range reverse chronically over the Posts PostDate, to print the grouping that I want? Can it be done all in the template?</p>\n"}, {"tags": ["google-app-engine", "go"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 4544438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2sw4KhcIpJs/AAAAAAAAAAI/AAAAAAAAAGo/lzs9GRTwY1s/photo.jpg?sz=128", "display_name": "quantum123", "link": "https://stackoverflow.com/users/4544438/quantum123"}, "edited": false, "score": 0, "creation_date": 1431881669, "post_id": 30284089, "comment_id": 48675875, "body": "Okay, yeah, it&#39;s definitely cloudsql rather than the driver or anything else."}], "tags": [], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "is_accepted": false, "score": 1, "last_activity_date": 1431844672, "creation_date": 1431844672, "answer_id": 30284089, "question_id": 30282570, "link": "https://stackoverflow.com/questions/30282570/golang-accessing-google-app-engine-cloudsql/30284089#30284089", "title": "Golang: Accessing Google App Engine CloudSQL", "body": "<p>I don't think cloudsql does anything? The source just looks like it returns that error no matter what lol</p>\n\n<p><a href=\"https://code.google.com/p/appengine-go/source/browse/appengine/cloudsql/cloudsql.go\" rel=\"nofollow\">https://code.google.com/p/appengine-go/source/browse/appengine/cloudsql/cloudsql.go</a></p>\n\n<pre><code>// Dial connects to the named Cloud SQL instance.\n    func Dial(instance string) (net.Conn, error) {\n            return connect(instance)\n    }\n</code></pre>\n\n<p><a href=\"https://code.google.com/p/appengine-go/source/browse/appengine/cloudsql/cloudsql_dev.go\" rel=\"nofollow\">https://code.google.com/p/appengine-go/source/browse/appengine/cloudsql/cloudsql_dev.go</a></p>\n\n<pre><code>func connect(instance string) (net.Conn, error) {\n        return nil, errors.New(\"cloudsql: not supported in dev yet\")\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 6, "last_activity_date": 1431956029, "creation_date": 1431956029, "answer_id": 30304620, "question_id": 30282570, "link": "https://stackoverflow.com/questions/30282570/golang-accessing-google-app-engine-cloudsql/30304620#30304620", "title": "Golang: Accessing Google App Engine CloudSQL", "body": "<p>The updated library is here: <a href=\"https://godoc.org/google.golang.org/appengine\" rel=\"noreferrer\">https://godoc.org/google.golang.org/appengine</a>. It doesn't have CloudSQL though. Perhaps you should just use a regular mysql connection locally:</p>\n\n<pre><code>func dialSQL() (*sql.DB, error) {\n    if appengine.IsDevAppServer() {\n        // or sql.Open(\"mysql\", \"user-name:password@ip-address-of-google-cloud-sql-instance/dbname\")\n        return sql.Open(\"mysql\", \"user:password@/dbname\")\n    }\n    return sql.Open(\"mysql\", \"cloudsql:my-instance*dbname/user/passwd\")\n}\n</code></pre>\n\n<p>Using a local database is usually the best option because connecting to a live database can be super dangerous. For example it's all too easy to accidentally run your tests against your production database and drop everything.</p>\n\n<p>Nevertheless, Google has instructions for connecting to CloudSQL here: <a href=\"https://cloud.google.com/sql/docs/introduction\" rel=\"noreferrer\">https://cloud.google.com/sql/docs/introduction</a>. The instructions for 3rd party tools will work for Go too.</p>\n"}], "owner": {"reputation": 31, "user_id": 4544438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-2sw4KhcIpJs/AAAAAAAAAAI/AAAAAAAAAGo/lzs9GRTwY1s/photo.jpg?sz=128", "display_name": "quantum123", "link": "https://stackoverflow.com/users/4544438/quantum123"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1056, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1431956029, "creation_date": 1431827683, "last_edit_date": 1431902065, "question_id": 30282570, "link": "https://stackoverflow.com/questions/30282570/golang-accessing-google-app-engine-cloudsql", "title": "Golang: Accessing Google App Engine CloudSQL", "body": "<p>New question: Everything I can find on Google suggests that the CloudSQL connector should be working, with the exception of the source code itself (and importing the SDK's cloudsql doesn't work).  Is there some place I can find this updated library, if it exists?</p>\n\n<p>---EDIT: I have my answer: it seems the problem is with CloudSQL itself rather than with the driver or something similar.---</p>\n\n<p>I'm trying to access CloudSQL from a Google App Engine Go program.\nI've tried both go-sql-driver/mysql and ziutek/mymysql, using Go 1.2.1 and Go 1.4.2.  I've tried both the go get version of go-sql-driver and cloned it directly from Github.  I've tried both the App Engine installer and the archive.</p>\n\n<p>Every time I try to access a database with my application, the resulting webpage states:\ncloudsql: not supported in dev yet</p>\n\n<p>I've seen the other similar question here, tried everything noted there, none of it worked.</p>\n\n<p>The code in question:</p>\n\n<pre><code>    import (\n    _ \"github.com/go-sql-driver/mysql\"\n    _ \"appengine/cloudsql\"\n    \"database/sql\"\n    \"net/http\"\n)\n\nfunc adminLogin(w http.ResponseWriter, r *http.Request) {\n    username := formatter(r.FormValue(\"username\"))\n    password := formatter(r.FormValue(\"password\"))\n    db, err := sql.Open(\"mysql\",\n        \"root:password@cloudsql(ws-virtual-classroom:database)/logins\") // And all the variations on that string I could think of...\n    defer db.Close()\n    if err != nil {\n        log.Print(err)\n    } else {\n        rows, err := db.Query(\"SELECT username FROM admin_logins WHERE username=? AND password=? LIMIT 1\", username, password)\n        defer rows.Close()\n        if err != nil {\n            log.Print(err)\n        } else {\n            var user string\n            for rows.Next() {\n                err = rows.Scan(&amp;user)\n                if err != nil {\n                    log.Print(err)\n                } else {\n                    makeCookie(w, r, user, true, true)\n                }\n            }\n        }\n    }\n    teachersHome(w, r)\n}\n</code></pre>\n\n<p>The result (this is displayed in my browser after I submit the login form):</p>\n\n<pre><code>the runtime process gave a bad HTTP response: ''\n\n2015/05/17 01:53:06 cloudsql: not supported in dev yet\n2015/05/17 01:53:06 http: panic serving 127.0.0.1:56970: runtime error: invalid memory address or nil pointer dereference\ngoroutine 12 [running]:\nnet/http.func\u00c2\u00b7011()\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1130 +0xbb\ndatabase/sql.(*Rows).Close(0x0, 0x0, 0x0)\n    /tmp/appengine/go_appengine/goroot/src/database/sql/sql.go:1659 +0x31\nmain57750.adminLogin(0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    main.go:208 +0x25a\nnet/http.HandlerFunc.ServeHTTP(0x927c78, 0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1265 +0x41\ngithub.com/gorilla/mux.(*Router).ServeHTTP(0xc20800c730, 0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /home/daniel/go/src/github.com/gorilla/mux/mux.go:98 +0x297\nnet/http.(*ServeMux).ServeHTTP(0xc20803a6f0, 0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1541 +0x17d\nappengine_internal.handleFilteredHTTP(0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /tmp/appengine/go_appengine/goroot/src/appengine_internal/api_dev.go:98 +0x413\nnet/http.HandlerFunc.ServeHTTP(0x927248, 0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1265 +0x41\nnet/http.serverHandler.ServeHTTP(0xc208042540, 0x7f76a72ef5d8, 0xc208045860, 0xc2080c4820)\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1703 +0x19a\nnet/http.(*conn).serve(0xc2080457c0)\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1204 +0xb57\ncreated by net/http.(*Server).Serve\n    /tmp/appengine/go_appengine/goroot/src/net/http/server.go:1751 +0x35e\n</code></pre>\n\n<p>This is when running it with goapp serve.  If I deploy it I seem to have the same problem--the resulting page is blank rather than showing that text, but the log error messages are the same.</p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431829654, "post_id": 30281747, "comment_id": 48663670, "body": "It <i>looks</i> like you may be assuming the <code>template</code> action can take a filename; it can&#39;t. It refers to a named template already parsed (via <code>template.Parse\u2026</code>, <code>someOtherTemplate.Parse\u2026</code> or via a <code>define</code> action of a parsed template). See the <a href=\"https://golang.org/pkg/text/template/#hdr-Associated_templates\" rel=\"nofollow noreferrer\">&quot;Associated Templates&quot;</a> section of the <code>text&#47;template</code> package documentation."}, {"owner": {"reputation": 27811, "user_id": 58743, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/625eebf4ceb1285d7c2fa63976946627?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/58743/shawn"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431834001, "post_id": 30281747, "comment_id": 48664386, "body": "@DaveC This link <a href=\"http://gohugo.io/templates/go-templates/\" rel=\"nofollow noreferrer\">gohugo.io/templates/go-templates</a> seems to suggest it can; however it was from a google search, I wonder if that was some syntactic suger added by hugo."}, {"owner": {"reputation": 27811, "user_id": 58743, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/625eebf4ceb1285d7c2fa63976946627?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/58743/shawn"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431834738, "post_id": 30281747, "comment_id": 48664507, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/19546896/golang-template-how-to-render-templates\">golang template - how to render templates?</a>"}], "answers": [{"comments": [{"owner": {"reputation": 2138, "user_id": 208928, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/750d9308974f986f174f94947adaeec2?s=128&d=identicon&r=PG", "display_name": "Sairam", "link": "https://stackoverflow.com/users/208928/sairam"}, "edited": false, "score": 1, "creation_date": 1478787331, "post_id": 30284276, "comment_id": 68299447, "body": "t := template.Must(template.ParseFiles(&quot;login.tmpl&quot;, &quot;header.tmpl&quot;)); t.ExecuteTemplate(os.Stdout, &quot;login&quot;, data)"}], "tags": [], "owner": {"reputation": 632, "user_id": 1879976, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/o8Fh4.png?s=128&g=1", "display_name": "pram", "link": "https://stackoverflow.com/users/1879976/pram"}, "is_accepted": true, "score": 16, "last_activity_date": 1599252573, "last_edit_date": 1599252573, "creation_date": 1431846309, "answer_id": 30284276, "question_id": 30281747, "link": "https://stackoverflow.com/questions/30281747/golang-whats-the-pre-requisite-to-use-template-partial-html/30284276#30284276", "title": "Golang: What&#39;s the pre-requisite to use {{ template &quot;partial.html&quot; . }}", "body": "<p>You need to define a name for the file that will contain the other templates and then execute that.</p>\n<p>login.tmpl</p>\n<pre><code>{{define &quot;login&quot;}}\n&lt;!doctype html&gt;\n&lt;html lang=&quot;en&quot;&gt;\n..\n{{template &quot;header&quot; .}}\n&lt;/body&gt;\n&lt;/html&gt;\n{{end}}\n</code></pre>\n<p>header.tmpl</p>\n<pre><code>{{define &quot;header&quot;}}\nwhatever\n{{end}}\n</code></pre>\n<p>Then you parse both those files</p>\n<pre><code>t := template.Must(template.ParseFiles(&quot;login.tmpl&quot;, &quot;header.tmpl&quot;))\n// and then execute the template with the defined name\nt.ExecuteTemplate(os.Stdout, &quot;login&quot;, data)\n</code></pre>\n"}], "owner": {"reputation": 27811, "user_id": 58743, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/625eebf4ceb1285d7c2fa63976946627?s=128&d=identicon&r=PG", "display_name": "Shawn", "link": "https://stackoverflow.com/users/58743/shawn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 6057, "favorite_count": 2, "accepted_answer_id": 30284276, "answer_count": 1, "score": 6, "last_activity_date": 1599252573, "creation_date": 1431818733, "last_edit_date": 1431819571, "question_id": 30281747, "link": "https://stackoverflow.com/questions/30281747/golang-whats-the-pre-requisite-to-use-template-partial-html", "title": "Golang: What&#39;s the pre-requisite to use {{ template &quot;partial.html&quot; . }}", "body": "<pre><code>import \"os\"    \nimport \"html/template\"\n...    \nt, _ := template.ParseFiles(\"login.html\")\nt.Execute(os.Stdout, data)\n...\nlogin.html:\n\n{{ template \"header.html\" . }}\n&lt;form ....&gt;...&lt;/form&gt;\n{{ template \"footer.html\" . }}\n</code></pre>\n\n<p>no output, no error.</p>\n\n<p>If I remove those two lines of {{ template \"...\" . }}, I could see the  part being outputed. </p>\n\n<p>What's required to make {{ template \"...\" . }} work or am I misunderstanding html/template completely?</p>\n"}, {"tags": ["error-handling", "go", "resources", "idioms"], "answers": [{"tags": [], "owner": {"reputation": 12763, "user_id": 1097065, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e26becbd681062e6da684a000c6b03ea?s=128&d=identicon&r=PG", "display_name": "andybalholm", "link": "https://stackoverflow.com/users/1097065/andybalholm"}, "is_accepted": true, "score": 6, "last_activity_date": 1431794226, "creation_date": 1431794226, "answer_id": 30278185, "question_id": 30277927, "link": "https://stackoverflow.com/questions/30277927/idiomatic-go-for-abstracting-resource-allocation-deallocation/30278185#30278185", "title": "Idiomatic Go for abstracting resource allocation/deallocation", "body": "<p>I think that the idiomatic way would be to create a Daemon type, and to just use defer in the caller:</p>\n\n<pre><code>d := NewDaemon(...)\ndefer d.Stop()\ndoWhatever()\n</code></pre>\n"}], "owner": {"reputation": 1782, "user_id": 497142, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/62bc5ef616d250ee3dceeb7a24943ed3?s=128&d=identicon&r=PG", "display_name": "Sean Kelleher", "link": "https://stackoverflow.com/users/497142/sean-kelleher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 89, "favorite_count": 0, "accepted_answer_id": 30278185, "answer_count": 1, "score": 2, "last_activity_date": 1431796844, "creation_date": 1431792838, "last_edit_date": 1431796844, "question_id": 30277927, "link": "https://stackoverflow.com/questions/30277927/idiomatic-go-for-abstracting-resource-allocation-deallocation", "title": "Idiomatic Go for abstracting resource allocation/deallocation", "body": "<p>Is there an idiomatic Go way for abstracting resource allocation/deallocation? My initial guess is to abstract the allocation/deallocation in a higher-order function:</p>\n\n<pre><code>func withResource(f func(Resource)error) error {\n    // allocate resource\n    // defer free resource\n    return f(resource)\n}\n</code></pre>\n\n<p>However, this line of thinking is borrowed directly from the functional paradigm and doesn't seem to align well with Go's largely imperative nature.</p>\n\n<p>As a concrete example, running a daemon for the duration of a block of code is a recurring theme in my current project, so I've created a <code>withDaemon</code> function to abstract the commonality:</p>\n\n<pre><code>func withDaemon(\n    cmd *exec.Cmd,\n    f func(io.ReadCloser, io.ReadCloser, io.WriteCloser) error,\n) error {\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        return fmt.Errorf(\"couldn't get stdout: %v\", err)\n    }\n\n    stderr, err := cmd.StdoutPipe()\n    if err != nil {\n        return fmt.Errorf(\"couldn't get stderr: %v\", err)\n    }\n\n    stdin, err := cmd.StdinPipe()\n    if err != nil {\n        return fmt.Errorf(\"couldn't get stdin: %v\", err)\n    }\n\n    if err := cmd.Start(); err != nil {\n        return fmt.Errorf(\"failed to start: %v\", err)\n    }\n\n    defer func() {\n        cmd.Process.Kill()\n        cmd.Wait()\n    }\n\n    return f(stdout, stderr, stdin)\n}\n</code></pre>\n"}, {"tags": ["mysql", "sql", "types", "go", "custom-type"], "answers": [{"comments": [{"owner": {"reputation": 1274, "user_id": 418310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14fffd38a6d3f3bca7fd8a4125aad61?s=128&d=identicon&r=PG", "display_name": "Mar&#231;al Juan", "link": "https://stackoverflow.com/users/418310/mar%c3%a7al-juan"}, "edited": false, "score": 0, "creation_date": 1431945185, "post_id": 30278074, "comment_id": 48697439, "body": "Sorry, I fixed the code replacing <code>EmailList</code> with <code>StatusEnum</code>. This is more confusing though because this code just works perfectly: <code>v, err := eqi.Status.Value() \tv, err = (&amp;eqi.Status).Value()</code>"}, {"owner": {"reputation": 585, "user_id": 514863, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c147458a09b0b4c8fe7d6eebff94ec7f?s=128&d=identicon&r=PG", "display_name": "Mal Curtis", "link": "https://stackoverflow.com/users/514863/mal-curtis"}, "edited": false, "score": 0, "creation_date": 1476395694, "post_id": 30278074, "comment_id": 67340519, "body": "For anyone coming in and reading, this is because you can call a pointer method on a non pointer value and it will automatically take the address, but only if it is a non interface method, i.e. the variable is an interface. <a href=\"https://golang.org/ref/spec#Method_values\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Method_values</a>"}], "tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": true, "score": 5, "last_activity_date": 1431793693, "creation_date": 1431793693, "answer_id": 30278074, "question_id": 30277296, "link": "https://stackoverflow.com/questions/30277296/confused-about-custom-types-in-sql-when-sql-db-exec/30278074#30278074", "title": "Confused about custom types in SQL when sql.DB.Exec", "body": "<p>You implement the <a href=\"http://golang.org/pkg/database/sql/driver/#Valuer\" rel=\"noreferrer\">Valuer interface</a> for your <code>StatusEnum</code> type as operating on a <code>*StatusEnum</code>. Therefore when you pass one as a parameter to Exec it only makes sense as a pointer as only pointers to <code>StatusEnum</code> implement <code>Value()</code>, requiring a deference inline.</p>\n\n<p>You don't have a definition for the <code>EmailList</code> type so I can suggest an alteration to your given <code>Valuer</code> interface.</p>\n\n<pre><code>func (s StatusEnum) Value() (driver.Value, error) {\n    return []byte(s), nil\n}\n</code></pre>\n\n<p>This is the standard library <a href=\"http://golang.org/pkg/database/sql/#NullInt64\" rel=\"noreferrer\">implements</a> custom nullable types.</p>\n"}], "owner": {"reputation": 1274, "user_id": 418310, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b14fffd38a6d3f3bca7fd8a4125aad61?s=128&d=identicon&r=PG", "display_name": "Mar&#231;al Juan", "link": "https://stackoverflow.com/users/418310/mar%c3%a7al-juan"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4131, "favorite_count": 1, "accepted_answer_id": 30278074, "answer_count": 1, "score": 6, "last_activity_date": 1492691625, "creation_date": 1431789163, "last_edit_date": 1492691625, "question_id": 30277296, "link": "https://stackoverflow.com/questions/30277296/confused-about-custom-types-in-sql-when-sql-db-exec", "title": "Confused about custom types in SQL when sql.DB.Exec", "body": "<p>Having this table structure:</p>\n\n<pre><code>CREATE TABLE `tableName` (\n    `Id` int unsigned NOT NULL AUTO_INCREMENT PRIMARY KEY,\n    `Status` enum('pending','rejected','sent','invalid') NOT NULL,\n    `Body` varchar(255) NULL\n) ENGINE='MyISAM' COLLATE 'utf8_general_ci';\n</code></pre>\n\n<p>I have this (not complete) code <strong>working fine</strong>:</p>\n\n<pre><code>type StatusEnum string\n\nconst (\n    STATUS_PENDING  StatusEnum = \"pending\"\n    STATUS_REJECTED StatusEnum = \"rejected\"\n    STATUS_SENT     StatusEnum = \"sent\"\n    STATUS_INVALID  StatusEnum = \"invalid\"\n)\n\nfunc (s *StatusEnum) Scan(src interface{}) error {\n    if src == nil {\n        return errors.New(\"This field cannot be NULL\")\n    }\n\n    if stringStatus, ok := src.([]byte); ok {\n        *s = StatusEnum(string(stringStatus[:]))\n\n        return nil\n    }\n\n    return errors.New(\"Cannot convert enum to string\")\n}\n\nfunc (s *StatusEnum) Value() (driver.Value, error) {\n    return []byte(*s), nil\n}\n\ntype EmailQueue struct {\n    Id        uint64\n    Status    StatusEnum\n    Body      sql.NullString\n}\n\nfunc Save (db *sql.DB) error {\n    _, err = db.Exec(\n        \"UPDATE `tableName` SET `Status` = ?, `Body` = ? WHERE `id` = ?\",\n        &amp;eqi.Status,\n        eqi.Body,\n        eqi.Id,\n    )\n\n    return err\n}\n</code></pre>\n\n<p>So my question is: <strong>Why do I need to use pointer reference (<code>&amp;eqi.Status</code>) on <code>db.Exec</code>?</strong></p>\n\n<p>Both <code>sql.NullString</code> and my custom <code>StatusEnum</code> are not implemented in <code>github.com/go-sql-driver/mysql</code>, so why the difference?</p>\n\n<p>If I don't use the pointer reference (<code>eqi.Status</code>), I'm getting this error (throwing in <a href=\"https://golang.org/src/database/sql/convert.go#L37\" rel=\"nofollow\" title=\"database/sql/convert.go\">database/sql/convert.go</a>):</p>\n\n<pre><code>sql: converting Exec argument #0's type: unsupported type emailqueue.StatusEnum, a string\n</code></pre>\n\n<p>I was trying to implement some other interfaces I've found with no luck.</p>\n\n<p>I have other custom types implemented with <code>sql.Scanner</code> and <code>sql.driver.Valuer</code> interfaces, but the problem is the same.</p>\n\n<p>I was guessing about <code>struct</code> and type inheritance differentiation, but I couldn't get any hint on that... :(</p>\n\n<p>Please help to understand what's going on. Thanks!!! :)</p>\n"}, {"tags": ["json", "struct", "go", "marshalling"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431794341, "post_id": 30274486, "comment_id": 48654759, "body": "If you were to make such a function it should return <code>([]byte, error)</code>. You&#39;re also modifying the original type definition (you don&#39;t show that here but your link); which may be undesirable for many reasons."}], "tags": [], "owner": {"reputation": 2175, "user_id": 817571, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/3eb3aee0450c2c335756206fe6ab70ed?s=128&d=identicon&r=PG", "display_name": "MIkCode", "link": "https://stackoverflow.com/users/817571/mikcode"}, "is_accepted": false, "score": 0, "last_activity_date": 1431771970, "creation_date": 1431771970, "answer_id": 30274486, "question_id": 30273286, "link": "https://stackoverflow.com/questions/30273286/how-to-embed-a-method-result-into-json-output-when-marshalling-a-type/30274486#30274486", "title": "How to embed a method result into JSON output when marshalling a type?", "body": "<p>Im not sure if  its the \"nicest\" way to do it but it`s very simple one.</p>\n\n<pre><code>func (u User) FullNameMarshal() []byte {\n    u.FullName = u.FirstName + \" \" + u.LastName\n    uj, err := json.Marshal(&amp;u)\n    if err != nil {\n        fmt.Println(err)\n    }\n    return uj\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/N8GF-VmE97\" rel=\"nofollow\">GO PLAYGROUND</a></p>\n"}, {"comments": [{"owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "edited": false, "score": 0, "creation_date": 1431796810, "post_id": 30275003, "comment_id": 48655616, "body": "Thanks, compared to other answers, creating new type for new purpose is more like a standard Go approach."}], "tags": [], "owner": {"reputation": 149903, "user_id": 14637, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/1904e7096278a10f1dfb3fdc0ceb53cc?s=128&d=identicon&r=PG", "display_name": "Thomas", "link": "https://stackoverflow.com/users/14637/thomas"}, "is_accepted": false, "score": 3, "last_activity_date": 1431775263, "creation_date": 1431775263, "answer_id": 30275003, "question_id": 30273286, "link": "https://stackoverflow.com/questions/30273286/how-to-embed-a-method-result-into-json-output-when-marshalling-a-type/30275003#30275003", "title": "How to embed a method result into JSON output when marshalling a type?", "body": "<p>You can create a new type and encode that to JSON. If you include an anonymous field of type <code>*User</code>, the two get merged:</p>\n\n<pre><code>type UserForJSON struct {\n    *User\n    FullName string `json:\"full_name\"`\n}\n\nfunc NewUserForJSON(u *User) *UserForJSON {\n    return &amp;UserForJSON{u, u.FullName()}\n}\n\nfunc main() {\n    u := &amp;User{\"John\", \"Smith\"}\n    j, _ := json.Marshal(NewUserForJSON(u))\n    fmt.Print(string(j))\n\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/840VbN8cva\" rel=\"nofollow\">Playground link</a>.</p>\n\n<p>It would be nice if we could let User implement <code>json.Marshaller</code> instead, and let <code>User.MarshalJSON()</code> create a <code>UserForJSON</code> object under the hood, but that leads to infinite recursion.</p>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431794656, "post_id": 30275506, "comment_id": 48654868, "body": "Also, wrt not using the regular marshalling (that is, implementing <code>json.Marshaler</code>) rather than a non-standard way; it allows for <code>User</code> (or <code>[]User</code>, or <code>map[string]User</code>, etc) fields to be used in other types and those other types to be marshal-able without any extra effort."}, {"owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "edited": false, "score": 0, "creation_date": 1431795660, "post_id": 30275506, "comment_id": 48655246, "body": "Great stuff, I especially like the idea to encapsulate JSON marshaling logic inside <code>MarshalJSON</code>."}], "tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": true, "score": 5, "last_activity_date": 1431778299, "creation_date": 1431778299, "answer_id": 30275506, "question_id": 30273286, "link": "https://stackoverflow.com/questions/30273286/how-to-embed-a-method-result-into-json-output-when-marshalling-a-type/30275506#30275506", "title": "How to embed a method result into JSON output when marshalling a type?", "body": "<p>This cannot be easily handled without providing <em>some</em> marshaller. I understand you don't want to write a <code>MarshalJSON</code> and do everything manually, but you can try to extend your structure in the custom marshaller and than rely on the default one. Proof of concept:</p>\n\n<pre><code>type User struct {\n    FirstName string `json:\"first_name\"`\n    LastName  string `json:\"last_name\"`\n}\n\nfunc (u *User) FullName() string {\n    return fmt.Sprintf(\"%s %s\", u.FirstName, u.LastName)\n}\n\nfunc (u User) MarshalJSON() ([]byte, error) {\n    type rawUser User // raw struct, without methods (and marshaller)       \n    // Marshal rawUser with an extension\n    return json.Marshal(struct {\n        rawUser\n        FullName string `json:\"full_name\"`\n    }{rawUser(u), u.FullName()})\n}\n</code></pre>\n\n<p>[<a href=\"http://play.golang.org/p/L1P95y0ArY\" rel=\"noreferrer\">play</a>]</p>\n\n<p>You need to cast <code>User</code> to <code>rawUser</code> to strip all methods \u2013 otherwise you would have infinite loop of <code>MarshalJSON</code>. Also I've chosen <code>MarshalJSON</code> to operate on copy rather than pointer to make sure <code>json.Marshal(user)</code> will yield the same result as <code>json.Marshal(&amp;user)</code>.</p>\n\n<p>This is not a one liner, but hides the complexity behind a standard interface, so you don't need to remember there's a special, non-standard way of converting your structure to JSON.</p>\n"}], "owner": {"reputation": 5138, "user_id": 515244, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/57549020123eef742723dfcfbe9e2039?s=128&d=identicon&r=PG", "display_name": "tomodian", "link": "https://stackoverflow.com/users/515244/tomodian"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 165, "favorite_count": 0, "accepted_answer_id": 30275506, "answer_count": 3, "score": 3, "last_activity_date": 1431794184, "creation_date": 1431763548, "last_edit_date": 1431794184, "question_id": 30273286, "link": "https://stackoverflow.com/questions/30273286/how-to-embed-a-method-result-into-json-output-when-marshalling-a-type", "title": "How to embed a method result into JSON output when marshalling a type?", "body": "<p>I'm seeking a clean approach to embed the return value of a method into the JSON marshalling of a type/value.\nIt would be great if I don't need to write custom JSON marshaller.</p>\n\n<p>For example, if the User type has <code>FirstName</code> and <code>LastName</code> fields and a <code>FullName()</code> method, how can I easily embed a <code>full_name</code> field into JSON output?</p>\n\n<pre><code> type User struct {\n     FirstName string `json:\"first_name\"`\n     LastName  string `json:\"last_name\"`\n }\n\n func (u User) FullName() string {\n     return fmt.Sprintf(\"%s %s\", u.FirstName, u.LastName)\n }\n</code></pre>\n\n<p>Expected JSON:</p>\n\n<pre><code> {\n     \"first_name\": \"John\",\n     \"last_name\":  \"Smith\",\n     \"full_name\":  \"John Smith\"\n }\n</code></pre>\n"}, {"tags": ["go", "redis", "bit-manipulation", "bit"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1431775389, "post_id": 30272881, "comment_id": 48648858, "body": "Does the following work for you: <a href=\"https://play.golang.org/p/64GjaXNar2\" rel=\"nofollow noreferrer\">play.golang.org/p/64GjaXNar2</a> ?"}, {"owner": {"reputation": 16945, "user_id": 236655, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37f51e0d0c7a647a45c89fdf96cb4b37?s=128&d=identicon&r=PG", "display_name": "sent-hil", "link": "https://stackoverflow.com/users/236655/sent-hil"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 0, "creation_date": 1431806810, "post_id": 30272881, "comment_id": 48658651, "body": "Yep, it works. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "is_accepted": true, "score": 5, "last_activity_date": 1431798793, "last_edit_date": 1431798793, "creation_date": 1431780729, "answer_id": 30275902, "question_id": 30272881, "link": "https://stackoverflow.com/questions/30272881/unpack-redis-set-bit-string-in-go/30275902#30275902", "title": "Unpack redis set bit string in Go", "body": "<p>There is no such helper in <code>redigo</code>. Here is my implementation:</p>\n\n<pre><code>func hasBit(n byte, pos uint) bool {\n    val := n &amp; (1 &lt;&lt; pos)\n    return (val &gt; 0)\n}\n\n\nfunc getBitSet(redisResponse []byte) []bool {\n    bitset := make([]bool, len(redisResponse)*8)\n\n    for i := range redisResponse {\n        for j:=7; j&gt;=0; j-- {\n            bit_n := uint(i*8+(7-j))\n            bitset[bit_n] = hasBit(redisResponse[i], uint(j))\n        }\n    }\n\n    return bitset\n}\n</code></pre>\n\n<p>Usage:</p>\n\n<pre><code>    response, _ := redis.Bytes(r.Do(\"GET\", \"testbit2\"))\n\n    for key, value := range getBitSet(response) {\n        fmt.Printf(\"Bit %v = %v \\n\", key, value)\n    }\n</code></pre>\n"}], "owner": {"reputation": 16945, "user_id": 236655, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/37f51e0d0c7a647a45c89fdf96cb4b37?s=128&d=identicon&r=PG", "display_name": "sent-hil", "link": "https://stackoverflow.com/users/236655/sent-hil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 477, "favorite_count": 0, "accepted_answer_id": 30275902, "answer_count": 1, "score": 4, "last_activity_date": 1431798793, "creation_date": 1431760376, "question_id": 30272881, "link": "https://stackoverflow.com/questions/30272881/unpack-redis-set-bit-string-in-go", "title": "Unpack redis set bit string in Go", "body": "<p>Using <code>redis#Setbit</code> to set bit in a key like: <code>redis.Do(\"SETBIT\", \"mykey\", 1, 1)</code>.</p>\n\n<p>When I read it using <code>redis#Get</code> like <code>redis.Do(\"GET\", \"mykey\")</code>, I get a bit string.</p>\n\n<p>How do I unpack the string so I can get a slice of bools in Go? In Ruby, you use <a href=\"http://ruby-doc.org/core-1.9.3/String.html#method-i-unpack\" rel=\"nofollow\">String#unpack</a> like <code>\"@\".unpack</code> which returns <code>[\"00000010\"]</code></p>\n"}, {"tags": ["templates", "go"], "comments": [{"owner": {"reputation": 1779, "user_id": 776966, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/81a14af94b33c11d4022161c21c55a49?s=128&d=identicon&r=PG", "display_name": "ozdrgnaDiies", "link": "https://stackoverflow.com/users/776966/ozdrgnadiies"}, "edited": false, "score": 0, "creation_date": 1431734598, "post_id": 30270296, "comment_id": 48640411, "body": "What do you mean by multiple comparison arguments? Do you mean something like <code>x == 1 || x == 2</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": 2, "last_activity_date": 1431783912, "last_edit_date": 1431783912, "creation_date": 1431748297, "answer_id": 30271644, "question_id": 30270296, "link": "https://stackoverflow.com/questions/30270296/how-to-use-or-with-pipelines-in-go-templates/30271644#30271644", "title": "How to use &quot;or&quot; with pipelines in go templates?", "body": "<p>The official docs <a href=\"http://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow\"><strong>do</strong></a> have explanations for for <code>or</code>, <code>and</code>, <code>eq</code>, and <code>neq</code> for use in templates. You can read about template functions <a href=\"http://golang.org/pkg/text/template/#hdr-Functions\" rel=\"nofollow\">here.</a> </p>\n\n<p>The thing to remember is that the functions provided in templates are prefix notation (<a href=\"http://en.wikipedia.org/wiki/Polish_notation\" rel=\"nofollow\">Polish Notation</a>). For example the not equal operator  <code>ne 1 2</code> would evaluate to true given that its two arguments 1 and 2 are not equal. Here is an <a href=\"http://play.golang.org/p/F6fErzRMHH\" rel=\"nofollow\">example</a> of a template that uses your given expression rewritten in prefix with template functions.</p>\n\n<pre><code>package main\n\nimport (\n    \"os\"\n    \"text/template\"\n)\n\ntype Values struct {\n    Title, X, Y string\n}\n\nfunc main() {\n        // Parenthesis are used to illustrate order of operation but could be omitted\n    const given_template = `\n    {{ if or (and (eq .X \"value\") (eq .Y \"other\")) (and (ne .X \"a\") (eq .Y \"b\")) }}\n    print(\"hello, {{.Title}}\")\n    {{end}}`\n\n    values := []Values{\n        Values{Title: \"first\", X: \"value\", Y: \"other\"},\n        Values{Title: \"second\", X: \"not a\", Y: \"b\"},\n        Values{Title: \"neither\", X: \"Hello\", Y: \"Gopher\"},\n    }\n\n    t := template.Must(template.New(\"example\").Parse(given_template))\n\n    for _, value := range values {\n        err := t.Execute(os.Stdout, &amp;value)\n\n        if err != nil {\n            panic(err)\n        }\n    }\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/F6fErzRMHH\" rel=\"nofollow\">Go Playground</a></p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2941, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1431783912, "creation_date": 1431733588, "question_id": 30270296, "link": "https://stackoverflow.com/questions/30270296/how-to-use-or-with-pipelines-in-go-templates", "title": "How to use &quot;or&quot; with pipelines in go templates?", "body": "<p>How can I use the \"or\" operator with multiple comparison arguments or any idea where I can find some examples? There seem to be none on the <a href=\"http://golang.org/pkg/text/template\" rel=\"nofollow\">official doc</a>.</p>\n\n<pre><code>if (x == \"value\" &amp;&amp; y == \"other\") || (x != \"a\") &amp;&amp; (y == \"b\"){\n  print(\"hello\")\n}\n</code></pre>\n"}, {"tags": ["templates", "go"], "answers": [{"comments": [{"owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 1, "creation_date": 1431788844, "post_id": 30273906, "comment_id": 48652933, "body": "The link to the working example in the playground is invalid."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "reply_to_user": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "edited": false, "score": 0, "creation_date": 1431793597, "post_id": 30273906, "comment_id": 48654508, "body": "@benjic Tks! Fixed it."}, {"owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "edited": false, "score": 0, "creation_date": 1432011228, "post_id": 30273906, "comment_id": 48729092, "body": "Is this specific to 2 conditions? What if you have 3 or 4.  <code>{if eq $total 1 | not boo| and (not has)}} </code> doesn&#39;t seem to work."}, {"owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "edited": false, "score": 0, "creation_date": 1432016275, "post_id": 30273906, "comment_id": 48731117, "body": "That does the same thing again -  the first | sends the result of <code>eq $total 1</code> to the second expression as it&#39;s last argument. Thus you are now giving 2 arguments to <code>not</code> which is why you&#39;d get an error. It&#39;ll work if you omit <code>boo</code> - <code>{if eq $total 1 | not | and (not has)}}</code>. Now the 2nd expression negates the result of the first and then passes it as the last argument to the 3rd expression."}], "tags": [], "owner": {"reputation": 5488, "user_id": 1078890, "user_type": "registered", "accept_rate": 46, "profile_image": "https://i.stack.imgur.com/Dqula.jpg?s=128&g=1", "display_name": "IamNaN", "link": "https://stackoverflow.com/users/1078890/iamnan"}, "is_accepted": false, "score": 1, "last_activity_date": 1431793550, "last_edit_date": 1431793550, "creation_date": 1431767859, "answer_id": 30273906, "question_id": 30269881, "link": "https://stackoverflow.com/questions/30269881/how-to-use-multiple-arguments-in-a-single-statement-with-go-templates/30273906#30273906", "title": "How to use multiple arguments in a single statement with Go templates", "body": "<p>I'm not sure about why the funny error message, but you are actually passing 3 arguments to <code>ne</code> which triggers the error :</p>\n\n<p>(<a href=\"http://golang.org/pkg/text/template/\" rel=\"nofollow\">from the text/template package</a>)</p>\n\n<blockquote>\n  <p>A pipeline may be \"chained\" by separating a sequence of commands with pipeline characters '|'. In a chained pipeline, the result of the each command is passed as the last argument of the following command. The output of the final command in the pipeline is the value of the pipeline.</p>\n</blockquote>\n\n<p>So you are giving <code>ne</code> the result of function <code>has</code>, the value <code>true</code> and the result of the first expression.</p>\n\n<p>To get what you want do:</p>\n\n<pre><code>{{if eq $total 1 | and (not has)}}\n    Works\n{{end}}\n</code></pre>\n\n<p>This will compare the result of <code>eq $total 1</code> (or <code>$total == 1</code>) which is passed as the second argument to the <code>and</code> and the negated result of <code>has</code> and thus only print <code>Works</code> when <code>$total == 1 AND has returns false</code>.</p>\n\n<p>See a working example <a href=\"http://play.golang.org/p/ZC6sT2p7dH\" rel=\"nofollow\">on the Playground</a>. Note that I replaced $total (since I can't tell where you get it from) with a simple struct.</p>\n"}], "owner": {"reputation": 7410, "user_id": 3257971, "user_type": "registered", "accept_rate": 48, "profile_image": "https://www.gravatar.com/avatar/726800b78cc5fe1f7dd61906ffd0eb1e?s=128&d=identicon&r=PG&f=1", "display_name": "The user with no hat", "link": "https://stackoverflow.com/users/3257971/the-user-with-no-hat"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1329, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1431793550, "creation_date": 1431730282, "last_edit_date": 1431733162, "question_id": 30269881, "link": "https://stackoverflow.com/questions/30269881/how-to-use-multiple-arguments-in-a-single-statement-with-go-templates", "title": "How to use multiple arguments in a single statement with Go templates", "body": "<p>I'm trying to pipe multiple conditions in a single if statement(using <a href=\"http://golang.org/pkg/text/template\" rel=\"nofollow\">text/template</a> package) which should translate into \"<strong>If <code>$total</code> == 1 and <code>has</code> function returns <code>false</code> display <code>works</code></strong>\". I don't understand how exactly the pipelines work or why I'm getting this non-sense error. As far as I understand when chaining is used (<code>|</code>) it sends the result as argument to the last command (<code>and</code> in this case) </p>\n\n<pre><code>{{if  eq $total 1 | ne has true | and}}\n    Works\n{{end}}\n</code></pre>\n\n<p><code>err template: :29:26: executing \"\" at &lt;ne&gt;: wrong number of args for ne: want 2 got 2</code></p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 29817, "user_id": 462604, "user_type": "registered", "accept_rate": 68, "profile_image": "https://www.gravatar.com/avatar/7176c041527db5489a2181a0f87f57d9?s=128&d=identicon&r=PG", "display_name": "Jakob Bowyer", "link": "https://stackoverflow.com/users/462604/jakob-bowyer"}, "is_accepted": true, "score": 4, "last_activity_date": 1431724359, "creation_date": 1431724359, "answer_id": 30268803, "question_id": 30268749, "link": "https://stackoverflow.com/questions/30268749/not-enough-arguments-in-call/30268803#30268803", "title": "Not enough arguments in call", "body": "<p>Your function</p>\n\n<p><code>func getJsonRes(r *http.Request)([]byte, error )</code></p>\n\n<p>Takes a request pointer and returns a byte array and or an error.</p>\n\n<p>On this line</p>\n\n<p><code>response, err := getJsonRes()\n</code></p>\n\n<p>You call it with with no arguments. You probably meant to do the following</p>\n\n<p><code>response, err := getJsonRes(r)\n</code></p>\n"}], "owner": {"reputation": 27, "user_id": 4839394, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5c1656b56e4e6b141b61f693bf012a51?s=128&d=identicon&r=PG&f=1", "display_name": "TechBar", "link": "https://stackoverflow.com/users/4839394/techbar"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 8894, "favorite_count": 1, "accepted_answer_id": 30268803, "answer_count": 1, "score": 0, "last_activity_date": 1497607842, "creation_date": 1431724175, "last_edit_date": 1497607842, "question_id": 30268749, "link": "https://stackoverflow.com/questions/30268749/not-enough-arguments-in-call", "title": "Not enough arguments in call", "body": "<p>I'm trying to create a go app that will display the users IP.</p>\n\n<p>I can't figure out my Log Console error:</p>\n\n<blockquote>\n  <p>go:14: not enough arguments in call to getJsonRes</p>\n</blockquote>\n\n<p>Go app code:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"net/http\"\n    \"fmt\"\n)\n\ntype Addrs struct {\n    ip string\n}\n\nfunc handler(w http.ResponseWriter, r *http.Request) {\n    response, err := getJsonRes()\n    if err != nil {\n    http.Error(w, err.Error(), http.StatusInternalServerError)\n    return\n    }\n    w.Header().Set(\"Content-Type\", \"application/json\")\n    fmt.Fprintf(w, string(response))\n}\n\nfunc main() {\n    http.HandleFunc(\"/\", handler)\n}\n\nfunc getJsonRes(r *http.Request)([]byte, error ) {\n    ip := Addrs{ r.RemoteAddr }\n\n    return json.MarshalIndent(ip, \"\", \" \")\n}\n</code></pre>\n"}, {"tags": ["reflection", "types", "go"], "comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1431722174, "post_id": 30268300, "comment_id": 48636365, "body": "If it helps, the value was an <code>int64</code> passed through an <code>interface{}</code> function parameter into the function that this code is in. (It&#39;s a long function, and simple attempts to reproduce this elsewhere have failed...)"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431722854, "post_id": 30268300, "comment_id": 48636679, "body": "I ran your code and it runs perfectly well. the problem is outside this snippet. see <a href=\"http://play.golang.org/p/NCHCVqz13C\" rel=\"nofollow noreferrer\">play.golang.org/p/NCHCVqz13C</a>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431722963, "post_id": 30268300, "comment_id": 48636730, "body": "As I said, I cannot create a MCVE - it&#39;s just failing /in situ/, and of course works by itself (or we&#39;d be in real trouble!).   If you prefer, &quot;what possible problems outside of this snippet could cause this?&quot;   - I don&#39;t see any way at all that the behavior I&#39;m describing can happen legally, regardless of what I&#39;ve &quot;messed up&quot; elsewhere... but my understanding of &quot;legally&quot; may be incorrect."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431723266, "post_id": 30268300, "comment_id": 48636863, "body": "oh, I can easily recreate it by doing something like <code>type T int64</code> and making <code>value</code> reference a <code>T</code>.  what does just printing <code>reflect.TypeOf(value)</code> give you?"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 0, "creation_date": 1431723341, "post_id": 30268300, "comment_id": 48636898, "body": "Ah.   I think you hit it.   So, I can have types with typekind Int64 that are not int64?   That is actually exactly what I&#39;m doing, I think.   Do I need the reflect Convert() to convert them (via the &quot;unknown&quot; type) back to &quot;proper&quot; int64?  Or what?"}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "edited": false, "score": 1, "creation_date": 1431723401, "post_id": 30268300, "comment_id": 48636929, "body": "well then, that settles it. I&#39;ll post it as an answer."}], "answers": [{"comments": [{"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1431723720, "post_id": 30268649, "comment_id": 48637097, "body": "Fantastic, TYVM.    But, how can I convert that back to an int64 without &quot;knowing&quot; the (compile-time symbol) type in question?   Hm, that should be a followup question probably...  will post."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1431723939, "post_id": 30268649, "comment_id": 48637199, "body": "@BadZen You can do that with reflect: <code>var i int64 = reflect.ValueOf(value).Int()</code>"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1431724113, "post_id": 30268649, "comment_id": 48637274, "body": "I have a giant switch with int64, int32, int16... and so forth.   <code>&lt;intType&gt;(reflect.Value.Int())</code> with a static conversion works great as does using reflect.Type.Convert(targetType).   Thanks again!"}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1431724220, "post_id": 30268649, "comment_id": 48637315, "body": "Well, ok, careful, me.  &quot;works&quot; up to int/uint funniness.   There&#39;s a reflect.Value.Uint(), too, though.  Convert() does the right thing without thinking about it.   Either way tho."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1431724385, "post_id": 30268649, "comment_id": 48637376, "body": "so is your switch on the kind? then you can have multiple values per case. e.g. <code>case int, int16, int32, int64</code> - Value.Int() will work on all of them the same."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 1, "creation_date": 1431724491, "post_id": 30268649, "comment_id": 48637416, "body": "Yup.   Was just noting that I need to split out the <code>uint</code> and friends cases  and use <code>Value.Uint()</code> there or else potentially probably chop a bit."}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431725145, "post_id": 30268649, "comment_id": 48637670, "body": "@Not_a_Golfer &quot;type aliasing&quot;: the only aliased types in Go are the built in <code>byte</code> and <code>rune</code> types (aliases of <code>int8</code> and <code>int32</code>). Anything done via a <a href=\"https://golang.org/ref/spec#Type_declarations\" rel=\"nofollow noreferrer\">type declaration</a> creates a new type with it&#39;s own <a href=\"https://golang.org/ref/spec#Type_identity\" rel=\"nofollow noreferrer\">identity</a>, not an alias of anything."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431725498, "post_id": 30268649, "comment_id": 48637794, "body": "@DaveC I was too lazy looking in the docs for the right term, but I hoped you might correct me, so thanks :) I&#39;ll edit accordingly."}, {"owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431743594, "post_id": 30268649, "comment_id": 48641902, "body": "@DaveC - Nitpick on that for posterity:  it seeems it&#39;s <code>uint8</code> and <code>int32</code> respectively.  (Any insight into why signed unicode codepoints?)   <a href=\"http://play.golang.org/p/46dCU9duck\" rel=\"nofollow noreferrer\">play.golang.org/p/46dCU9duck</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "reply_to_user": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "edited": false, "score": 0, "creation_date": 1431792643, "post_id": 30268649, "comment_id": 48654184, "body": "@BadZen, you&#39;re right I made a mistake/typo and a byte is uint8. I don&#39;t know why <code>rune</code> is signed since the negative values are invalid code points. It may be because either signed or unsigned, having any of the top ~dozen bits set is an invalid code point and signed is somehow easier/safer (whereas for a byte there isn&#39;t any choice)."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 4, "last_activity_date": 1431725529, "last_edit_date": 1431725529, "creation_date": 1431723637, "answer_id": 30268649, "question_id": 30268300, "link": "https://stackoverflow.com/questions/30268300/mysterious-type-assertion-failure/30268649#30268649", "title": "Mysterious type assertion failure?", "body": "<p>This can happen if you're using type declaration on numeric types. If you do something like this:</p>\n\n<pre><code>type T int64 \n\n...\n\nvar value interface{} = T(1)\n</code></pre>\n\n<p>and put it into your code, you'll get the exact same error. But if you don't check the kind, but the type, you'll see what's happening here:</p>\n\n<pre><code>v, ok := value.(int64)\nif !ok {\n    panic(\"NOPE \" + reflect.TypeOf(value).String())\n} else {\n    fmt.Printf(\"VAL: %d\\n\", v)\n}\n</code></pre>\n\n<p>produces the message:</p>\n\n<pre><code>panic: NOPE main.T\n</code></pre>\n\n<p>The <code>kind</code> of T is  int64, but <code>value</code> is <em>not</em> int64.</p>\n"}], "owner": {"reputation": 3420, "user_id": 675723, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/8f525203adb5093c5954b43a5b6420c2?s=128&d=identicon&r=PG", "display_name": "BadZen", "link": "https://stackoverflow.com/users/675723/badzen"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 46, "favorite_count": 0, "accepted_answer_id": 30268649, "answer_count": 1, "score": 2, "last_activity_date": 1431725529, "creation_date": 1431722105, "last_edit_date": 1431722456, "question_id": 30268300, "link": "https://stackoverflow.com/questions/30268300/mysterious-type-assertion-failure", "title": "Mysterious type assertion failure?", "body": "<p>Under what circumstances could this code:</p>\n\n<pre><code>        v, ok := value.(int64)\n        if !ok  {\n            panic(\"NOPE \"+reflect.TypeOf(value).Kind().String())\n        } else {\n            fmt.Printf(\"VAL: %d\\n\",v)\n        }\n</code></pre>\n\n<p>produce the panic with message <code>panic: NOPE int64</code>?</p>\n\n<p>Is this a bug or is there something basic about the numeric types that I'm missing?</p>\n"}, {"tags": ["string", "unicode", "go"], "answers": [{"comments": [{"owner": {"reputation": 387, "user_id": 4213589, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea736bdcd85cb6ebe9c7d13663781b7f?s=128&d=identicon&r=PG&f=1", "display_name": "\u8d75\u6d69\u7fd4", "link": "https://stackoverflow.com/users/4213589/%e8%b5%b5%e6%b5%a9%e7%bf%94"}, "edited": false, "score": 0, "creation_date": 1431706706, "post_id": 30263910, "comment_id": 48628452, "body": "Thanks for you help.The second way only can get the first unicode character,it seems imperfect.I understood the first way,and I think I can modify it to solve my problem.And I still wonder whether there is a easie rway to get unicode charcter by index from a string."}, {"owner": {"reputation": 3070, "user_id": 3566064, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/494d9fad1c8b66110f8dbadaf9607212?s=128&d=identicon&r=PG&f=1", "display_name": "LemurFromTheId", "link": "https://stackoverflow.com/users/3566064/lemurfromtheid"}, "edited": false, "score": 1, "creation_date": 1431710898, "post_id": 30263910, "comment_id": 48630856, "body": "Correct, but I suspect that in most cases it really isn&#39;t any kind of performance bottleneck, and it&#39;d be easy to optimize afterwards when you&#39;ve actually profiled your code and deemed it necessary. Of course, there are situations where&#39;s it&#39;s <i>obviously</i> the wrong way to do things."}, {"owner": {"reputation": 460, "user_id": 404271, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c49bf7b03ef6d9ba7d685ec8685f7be5?s=128&d=identicon&r=PG", "display_name": "ibic", "link": "https://stackoverflow.com/users/404271/ibic"}, "edited": false, "score": 0, "creation_date": 1526181014, "post_id": 30263910, "comment_id": 87641013, "body": "So it seems to me that for a given go-lang string, there is not way to retrieve a rune directly by index (by which I mean taking O(1) time), but we have to either use <code>for range</code> or convert it to <code>[]rune</code> first, both of which take O(n) time. Is that correct?"}, {"owner": {"reputation": 358, "user_id": 6267238, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b53d46b675ae20a5956ccc01ec32faa6?s=128&d=identicon&r=PG&f=1", "display_name": "Jason Carlson", "link": "https://stackoverflow.com/users/6267238/jason-carlson"}, "edited": false, "score": 2, "creation_date": 1538829041, "post_id": 30263910, "comment_id": 92286814, "body": "I would suggest if you need index into the runes of a string many times in your program, convert once to []rune in O(n) and then you can index as many times as you want in O(1) time. It&#39;s likely that the string in question will have at least one O(n) operation performed on it anyway at some point (even if it&#39;s just initial assignment), so adding another will probably not impact the overall asymptotic run-time of your program."}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 27, "last_activity_date": 1431707382, "last_edit_date": 1431707382, "creation_date": 1431705600, "answer_id": 30263910, "question_id": 30263607, "link": "https://stackoverflow.com/questions/30263607/how-to-get-a-single-unicode-character-from-string/30263910#30263910", "title": "How to get a single Unicode character from string", "body": "<p>First, you may want to read <a href=\"https://blog.golang.org/strings\">https://blog.golang.org/strings</a>\nIt will answer part of your questions.</p>\n\n<p>A string in Go can contains arbitrary bytes. When you write str[i], the result is a byte, and the index is always a number of bytes.</p>\n\n<p>Most of the time, strings are encoded in UTF-8 though. You have multiple ways to deal with UTF-8 encoding in a string.</p>\n\n<p>For instance, you can use the for...range statement to iterate on a string rune by rune. </p>\n\n<pre><code>var first rune\nfor _,c := range str {\n    first = c\n    break\n}\n// first now contains the first rune of the string\n</code></pre>\n\n<p>You can also leverage the unicode/utf8 package. For instance:</p>\n\n<pre><code>r, size := utf8.DecodeRuneInString(str)\n// r contains the first rune of the string\n// size is the size of the rune in bytes\n</code></pre>\n\n<p>If the string is encoded in UTF-8, there is no direct way to access the nth rune of the string, because the size of the runes (in bytes) is not constant. If you need this feature, you can easily write your own helper function to do it (with for...range, or with the unicode/utf8 package).</p>\n"}, {"tags": [], "owner": {"reputation": 2916, "user_id": 1745432, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/de8eed2933662cd85e6a5eee3eb9f2fa?s=128&d=identicon&r=PG", "display_name": "Kpym", "link": "https://stackoverflow.com/users/1745432/kpym"}, "is_accepted": false, "score": 0, "last_activity_date": 1601746499, "creation_date": 1601746499, "answer_id": 64187091, "question_id": 30263607, "link": "https://stackoverflow.com/questions/30263607/how-to-get-a-single-unicode-character-from-string/64187091#64187091", "title": "How to get a single Unicode character from string", "body": "<p>If you want the first rune as <code>string</code> you can do</p>\n<pre><code>func firstChar(str string) string {\n    return strings.Split(str, &quot;&quot;)[0]\n}\n</code></pre>\n<p>But if you want it as <code>rune</code> the @DidierSpezia solution is the best</p>\n<pre><code>func firstRune(str string) (r rune) {\n  for _, r = range str {\n      return\n  }\n  return\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 9973, "user_id": 99046, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/f989b0bf8bfe9eb0bb03c7f6ad722a91?s=128&d=identicon&r=PG", "display_name": "John Gibb", "link": "https://stackoverflow.com/users/99046/john-gibb"}, "edited": false, "score": 0, "creation_date": 1607017956, "post_id": 64198668, "comment_id": 115147215, "body": "think you&#39;re off by 1, wouldn&#39;t <code>i == 1</code> get you &quot;a&quot; since it&#39;s zero-based?"}], "tags": [], "owner": {"reputation": 1, "user_id": 14390497, "user_type": "unregistered", "profile_image": "https://www.gravatar.com/avatar/f0bd3716ffbac06d758a4c12249e94f2?s=128&d=identicon&r=PG", "display_name": "devin", "link": "https://stackoverflow.com/users/14390497/devin"}, "is_accepted": false, "score": -1, "last_activity_date": 1601837757, "creation_date": 1601837757, "answer_id": 64198668, "question_id": 30263607, "link": "https://stackoverflow.com/questions/30263607/how-to-get-a-single-unicode-character-from-string/64198668#64198668", "title": "How to get a single Unicode character from string", "body": "<p>you can do this:</p>\n<pre><code>func main() {\n  str := &quot;cat&quot;\n  var s rune\n  for i, c := range str {\n    if i == 2 {\n      s = c\n    }\n  }\n}\n</code></pre>\n<p>s is now equal to a</p>\n"}, {"tags": [], "owner": {"reputation": 80955, "user_id": 1002260, "user_type": "registered", "accept_rate": 96, "profile_image": "https://www.gravatar.com/avatar/5ec9c21c8d54825b04def7a41998d18d?s=128&d=identicon&r=PG", "display_name": "Steven Penny", "link": "https://stackoverflow.com/users/1002260/steven-penny"}, "is_accepted": false, "score": -1, "last_activity_date": 1618078249, "creation_date": 1618078249, "answer_id": 67037727, "question_id": 30263607, "link": "https://stackoverflow.com/questions/30263607/how-to-get-a-single-unicode-character-from-string/67037727#67037727", "title": "How to get a single Unicode character from string", "body": "<p>You can use the <code>utf8string</code> package:</p>\n<pre><code>package main\nimport &quot;golang.org/x/exp/utf8string&quot;\n\nfunc main() {\n   s := utf8string.NewString(&quot;\u00c4\u00c5\u00e0\u00e2\u00e4\u00e5\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ee\u00ef\u00fc&quot;)\n   // example 1\n   r := s.At(1)\n   println(r == '\u00c5')\n   // example 2\n   t := s.Slice(1, 3)\n   println(t == &quot;\u00c5\u00e0&quot;)\n}\n</code></pre>\n<p><a href=\"https://pkg.go.dev/golang.org/x/exp/utf8string\" rel=\"nofollow noreferrer\">https://pkg.go.dev/golang.org/x/exp/utf8string</a></p>\n"}], "owner": {"reputation": 387, "user_id": 4213589, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/ea736bdcd85cb6ebe9c7d13663781b7f?s=128&d=identicon&r=PG&f=1", "display_name": "\u8d75\u6d69\u7fd4", "link": "https://stackoverflow.com/users/4213589/%e8%b5%b5%e6%b5%a9%e7%bf%94"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 15436, "favorite_count": 4, "accepted_answer_id": 30263910, "answer_count": 4, "score": 26, "last_activity_date": 1618078249, "creation_date": 1431704647, "last_edit_date": 1566078280, "question_id": 30263607, "link": "https://stackoverflow.com/questions/30263607/how-to-get-a-single-unicode-character-from-string", "title": "How to get a single Unicode character from string", "body": "<p>I wonder how I can I get a Unicode character from a string. For example, if the string is \"\u4f60\u597d\", how can I get the first character \"\u4f60\"?</p>\n\n<p>From another place I get one way:</p>\n\n<pre><code>var str = \"\u4f60\u597d\"\nrunes := []rune(str)\nfmt.Println(string(runes[0]))\n</code></pre>\n\n<p>It does work.\nBut I still have some questions:</p>\n\n<ol>\n<li><p>Is there another way to do it?</p></li>\n<li><p>Why in Go does <code>str[0]</code> not get a Unicode character from a string, but it gets byte data?</p></li>\n</ol>\n"}, {"tags": ["go", "function-pointers", "shellcode"], "comments": [{"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1431705419, "post_id": 30263520, "comment_id": 48627584, "body": "If you&#39;re writing it to a file you might as well call syscall.Exec on it"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1431706808, "post_id": 30263520, "comment_id": 48628521, "body": "@ReyCharles, that would imply writing a properly formatted file (like ELF on Linux, PE on Windows etc). Not sure if Windows still allows running MS-DOS COM-formatted files (which were dead-simple)."}, {"owner": {"reputation": 1701, "user_id": 788887, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f68a54ea809de360f7049f5c970df1d7?s=128&d=identicon&r=PG", "display_name": "ReyCharles", "link": "https://stackoverflow.com/users/788887/reycharles"}, "edited": false, "score": 0, "creation_date": 1431710991, "post_id": 30263520, "comment_id": 48630907, "body": "Yea, sorry, I wasn&#39;t thinking :)"}], "answers": [{"comments": [{"owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "edited": false, "score": 0, "creation_date": 1431735457, "post_id": 30264310, "comment_id": 48640590, "body": "Thank you - that&#39;s an awesome library which worked perfectly."}, {"owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "reply_to_user": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "edited": false, "score": 0, "creation_date": 1486931055, "post_id": 30264310, "comment_id": 71547554, "body": "@Peleus : and if cgo is disabled\u202f?"}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 4, "last_activity_date": 1431706888, "creation_date": 1431706888, "answer_id": 30264310, "question_id": 30263520, "link": "https://stackoverflow.com/questions/30263520/executing-byte-array-in-go/30264310#30264310", "title": "Executing Byte Array in Go", "body": "<p>There are multiple ways to do it, though I have not tested them myself.</p>\n\n<p>You may want to have a look at <a href=\"https://github.com/nelhage/gojit/blob/master/jit.go\" rel=\"nofollow\">https://github.com/nelhage/gojit/blob/master/jit.go</a>\nIt implements a solution based on cgo (which is safer, but slower), and a solution based on a direct call. Look at all the build related functions.</p>\n"}, {"comments": [{"owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "edited": false, "score": 0, "creation_date": 1431735555, "post_id": 30267519, "comment_id": 48640610, "body": "Thank you for your answer. I marked the above as correct since it allowed a slightly simpler solution - however I appreciate that what you wrote also taught me some other techniques for which I&#39;m appreciative of. Upvoted."}, {"owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "edited": false, "score": 0, "creation_date": 1486931294, "post_id": 30267519, "comment_id": 71547645, "body": "@JimB : thank you for you short answer. But how to do that kind of thing without the<code>C</code>package\u202f? I mean with cgo disabled\u202f?"}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "edited": false, "score": 0, "creation_date": 1486994931, "post_id": 30267519, "comment_id": 71573229, "body": "@user2284570: I&#39;m not sure if that&#39;s possible. All Go programs are multi-threaded, and it may require the runtime hooks used by cgo to safely enter non-go code."}, {"owner": {"reputation": 2409, "user_id": 2284570, "user_type": "registered", "accept_rate": 44, "profile_image": "https://www.gravatar.com/avatar/9bd1d26aad2cfb7ece066d94c128d529?s=128&d=identicon&r=PG", "display_name": "user2284570", "link": "https://stackoverflow.com/users/2284570/user2284570"}, "edited": false, "score": 0, "creation_date": 1487209923, "post_id": 30267519, "comment_id": 71684151, "body": "@JimB : and what if the<code>unsafe</code>package isn\u2019t installed\u202f?"}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 6, "last_activity_date": 1431719219, "last_edit_date": 1431719219, "creation_date": 1431718861, "answer_id": 30267519, "question_id": 30263520, "link": "https://stackoverflow.com/questions/30263520/executing-byte-array-in-go/30267519#30267519", "title": "Executing Byte Array in Go", "body": "<p>First, you don't need to (currently) use <code>mmap</code> at all, since go memory is executable. If you do need <code>mmap</code>, you can use anonymous memory and forgo the temp file:</p>\n\n<pre><code>b, e := syscall.Mmap(0, 0, len(shellcode), syscall.PROT_READ|syscall.PROT_WRITE|syscall.PROT_EXEC, syscall.MAP_ANON)\ncopy(b, shellcode)\n</code></pre>\n\n<p>Otherwise, you can try to use <code>shellcode</code> directly, since it's already backed by a contiguous array.</p>\n\n<p>As for converting the bytes in <code>shellcode</code> to a function, the analog from C would look like:</p>\n\n<pre><code>f := *(*func() int)(unsafe.Pointer(&amp;d[0]))\n</code></pre>\n\n<p>which creates a function value named <code>f</code> which can then be called like a normal function. </p>\n\n<p>If the shellcode isn't specifically crafted fro Go, and you need to call it from a C stack, it would be easier to do it directly in C using cgo.</p>\n\n<pre><code>/*\ncall(char *code) {\n    int (*ret)() = (int(*)())code;\n    ret();\n}\n*/\nimport \"C\"\n\nfunc main() {\n    ...\n    // at your call site, you can send the shellcode directly to the C \n    // function by converting it to a pointer of the correct type.\n    C.call((*C.char)(unsafe.Pointer(&amp;shellcode[0])))\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2526, "user_id": 822023, "user_type": "registered", "accept_rate": 88, "profile_image": "https://i.stack.imgur.com/8QyS6.jpg?s=128&g=1", "display_name": "Bruno Calza", "link": "https://stackoverflow.com/users/822023/bruno-calza"}, "is_accepted": false, "score": 0, "last_activity_date": 1610294993, "creation_date": 1610294993, "answer_id": 65655381, "question_id": 30263520, "link": "https://stackoverflow.com/questions/30263520/executing-byte-array-in-go/65655381#65655381", "title": "Executing Byte Array in Go", "body": "<p>I was trying to learn how <code>mmap</code> <code>PROT_EXEC</code> would work in <code>Go</code>, and came up with the same problem.</p>\n<p>I had a hard time to get the <code>[]byte</code> to be casted to a function correctly. It is not so obvious as some of the answers here state.</p>\n<p>I've came up with an working example of how to do it using a higher level <code>mmap</code> library called <a href=\"https://github.com/edsrzf/mmap-go\" rel=\"nofollow noreferrer\">mmap-go</a>. In this example we have an executable code of a function that increments one to the passed argument.</p>\n<pre><code>code := []byte{\n    0x48, 0xc7, 0x44, 0x24, 0x10, 0x00, 0x00, 0x00, 0x00,\n    0x48, 0x8b, 0x44, 0x24, 0x08,\n    0x48, 0xff, 0xc0,\n    0x48, 0x89, 0x44, 0x24, 0x10,\n    0xc3,\n}\n\nmemory, err := mmap.MapRegion(nil, len(code), mmap.EXEC|mmap.RDWR, mmap.ANON, 0)\nif err != nil {\n    panic(err)\n}\n\ncopy(memory, code)\n\nmemory_ptr := &amp;memory\nptr := unsafe.Pointer(&amp;memory_ptr)\nf := *(*func(int) int)(ptr)\n\nfmt.Println(f(10)) // Prints 11\n</code></pre>\n<p>I thought <code>unsafe.Pointer(&amp;memory[0])</code> would solve my problem like one of the answers suggests. But by doing that you cannot cast the address to a callable function in the correct address. The trick was to go one step further and do this</p>\n<pre><code>memory_ptr := &amp;memory\nptr := unsafe.Pointer(&amp;memory_ptr)\n</code></pre>\n<p>instead of</p>\n<pre><code>f := *(*func(int) int)(&amp;memory[0])\n</code></pre>\n"}], "owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2121, "favorite_count": 1, "accepted_answer_id": 30264310, "answer_count": 3, "score": 6, "last_activity_date": 1610294993, "creation_date": 1431704313, "last_edit_date": 1495540397, "question_id": 30263520, "link": "https://stackoverflow.com/questions/30263520/executing-byte-array-in-go", "title": "Executing Byte Array in Go", "body": "<p>I'm trying to execute shellcode within a Go program, similar to how you can do it with other languages. </p>\n\n<p>Example 1 - <a href=\"https://stackoverflow.com/questions/16626857/shellcode-in-c-program\">Shellcode in C program</a></p>\n\n<p>Example 2 - <a href=\"http://www.debasish.in/2012/04/execute-shellcode-using-python.html\" rel=\"nofollow noreferrer\">http://www.debasish.in/2012/04/execute-shellcode-using-python.html</a></p>\n\n<p>All methods have broadly similar techniques - assign the shellcode to executable memory via the OS specific allocation (mmap, virtualalloc, etc) and then execute the code by creating a function pointer pointing to that location before executing. </p>\n\n<p>Here is my horrible hacky example at performing the same thing in Go. The shellcode has manipulations performed on it before being passed to the function, so it's format as a []byte is fixed. Saying that mmap expects a file descriptor passed in which is why the horrible \"writing to a tmp file\" section exists. </p>\n\n<pre><code>func osxExec(shellcode []byte) {\n    f, err := os.Create(\"data/shellcode.tmp\")\n    if err != nil {\n        fmt.Println(err)\n    }\n    defer f.Close()\n    _,_ = f.Write(shellcode)\n    f.Sync()\n\n    b, err := syscall.Mmap(int(f.Fd()), 0, len(shellcode), syscall.PROT_READ|syscall.PROT_WRITE|syscall.PROT_EXEC, syscall.MAP_SHARED)\n    if err != nil {\n        fmt.Println(err)\n    }\n\n    fmt.Printf(\"%p\", b)\n}\n</code></pre>\n\n<p>At the end of the code I've got a pointer (slice?) to the code in what I presume is executable memory - but I've got no idea how to cast this address into a function pointer for execution. I asked on some IRC channels but it was suggested that it may not be possible. </p>\n\n<p>Any help is greatly appreciated. </p>\n\n<p>Cheers. </p>\n"}, {"tags": ["json", "mongodb", "go"], "answers": [{"comments": [{"owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 1, "creation_date": 1432123936, "post_id": 30264689, "comment_id": 48790981, "body": "I&#39;m a bit confused about syntax here (only a few months of Go programming). Where you&#39;ve put the string in backticks after the ID field, does that literally just tell the marshaller to rename the field?"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "reply_to_user": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "edited": false, "score": 0, "creation_date": 1432152726, "post_id": 30264689, "comment_id": 48810638, "body": "It is a tag associated to the field, which is decoded by the marshaller engine. The marshaller will just use the name following &quot;json:&quot; as the JSON key."}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 5, "last_activity_date": 1431708246, "creation_date": 1431708246, "answer_id": 30264689, "question_id": 30263446, "link": "https://stackoverflow.com/questions/30263446/how-to-marshal-field-starting-with-underscore-to-json-golang/30264689#30264689", "title": "How to marshal field starting with underscore to JSON [Golang]", "body": "<p>You can easily rename the fields. The Go name should start with an uppercase to be exported, but the json name can be anything compliant with json.</p>\n\n<p>Here is an example borrowed to the encoding/json package documentation:</p>\n\n<pre><code> package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    type ColorGroup struct {\n        ID     int       `json:\"_id\"`\n        Name   string\n        Colors []string\n    }\n    group := ColorGroup{\n        ID:     1,\n        Name:   \"Reds\",\n        Colors: []string{\"Crimson\", \"Red\", \"Ruby\", \"Maroon\"},\n    }\n    b, err := json.Marshal(group)\n    if err != nil {\n        fmt.Println(\"error:\", err)\n    }\n    os.Stdout.Write(b)\n}\n</code></pre>\n"}], "owner": {"reputation": 448, "user_id": 4742941, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/03597e35f96065ea034b3baaeb27f908?s=128&d=identicon&r=PG&f=1", "display_name": "leylandski", "link": "https://stackoverflow.com/users/4742941/leylandski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1617, "favorite_count": 0, "accepted_answer_id": 30264689, "answer_count": 1, "score": 2, "last_activity_date": 1431708246, "creation_date": 1431704085, "question_id": 30263446, "link": "https://stackoverflow.com/questions/30263446/how-to-marshal-field-starting-with-underscore-to-json-golang", "title": "How to marshal field starting with underscore to JSON [Golang]", "body": "<p>Go's <code>encoding/json</code> package has some brilliant JSON marshalling functionality, and for all intents and purposes it's exactly what I need. But the problem arises when I want to try and marshal something I want to insert into a MongoDB instance.</p>\n\n<p>MongoDB understands <code>_id</code> as an indexed identifier, but Go's JSON package only marshals exported fields so MongoDB creates its own ID for the document when I save, which I do not want, and I haven't even begun to test the implications it will have unmarshalling to a struct. </p>\n\n<p>Is there a way to make the JSON marshaller include fields beginning with an underscore without writing a whole new one?</p>\n"}, {"tags": ["oop", "interface", "go"], "answers": [{"comments": [{"owner": {"reputation": 7284, "user_id": 4374109, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/sHeIb.png?s=128&g=1", "display_name": "Uvelichitel", "link": "https://stackoverflow.com/users/4374109/uvelichitel"}, "edited": false, "score": 3, "creation_date": 1431707810, "post_id": 30261033, "comment_id": 48629130, "body": "It&#39;s not just easy, it&#39;s the idea and purpose of interfaces. I&#39;d suggest to make your answer even stronger."}, {"owner": {"reputation": 39041, "user_id": 27358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fed1635f89478c88eda07e87de452bcf?s=128&d=identicon&r=PG", "display_name": "David Moles", "link": "https://stackoverflow.com/users/27358/david-moles"}, "edited": false, "score": 1, "creation_date": 1604728214, "post_id": 30261033, "comment_id": 114441581, "body": "This is not very much like other languages&#39; notion of an abstract class, but it is probably the most idiomatic Go solution (it&#39;s the way a lot of the core IO APIs work, for example)."}], "tags": [], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "is_accepted": true, "score": 6, "last_activity_date": 1431697342, "creation_date": 1431697342, "answer_id": 30261033, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/30261033#30261033", "title": "How to implement an abstract class in Go?", "body": "<p>An easy solution is to move <code>daemon *Daemon</code> to the argument list (thus removing <code>start(...)</code> from the interface):</p>\n\n<pre><code>type Daemon interface {\n    // start(time.Duration)\n    doWork()\n}\n\nfunc start(daemon Daemon, duration time.Duration) { ... }\n\nfunc main() {\n    ...\n    start(dA, 1 * time.Second)\n    start(dB, 5 * time.Second)\n    ...\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 39041, "user_id": 27358, "user_type": "registered", "accept_rate": 76, "profile_image": "https://www.gravatar.com/avatar/fed1635f89478c88eda07e87de452bcf?s=128&d=identicon&r=PG", "display_name": "David Moles", "link": "https://stackoverflow.com/users/27358/david-moles"}, "edited": false, "score": 0, "creation_date": 1604728122, "post_id": 30261572, "comment_id": 114441568, "body": "The function value solution is by far semantically closest to the Java or C# notion of an abstract class. This should be the accepted answer."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 12, "last_activity_date": 1471955366, "last_edit_date": 1471955366, "creation_date": 1431698829, "answer_id": 30261572, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/30261572#30261572", "title": "How to implement an abstract class in Go?", "body": "<p>If you want to provide a \"default\" implementation (for <code>Daemon.start()</code>), that is not the characteristic of an <em>interface</em> (at least not in Go). That is a characteristic of a <em>concrete</em> (non-interface) type.</p>\n\n<p>So <code>Daemon</code> in your case should be a concrete type, conveniently a <code>struct</code> since you want it to have fields. And the task to be done can be either a value of an interface type, or in a simple case just a function value (a simple case means it would only have one method).</p>\n\n<h3>With interface type</h3>\n\n<p>Try the complete app on the <a href=\"http://play.golang.org/p/WDB8BqVyJS\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<pre><code>type Task interface {\n    doWork()\n}\n\ntype Daemon struct {\n    task Task\n}\n\nfunc (d *Daemon) start(t time.Duration) {\n    ticker := time.NewTicker(t)\n    // this will call task.doWork() periodically\n    go func() {\n        for {\n            &lt;-ticker.C\n            d.task.doWork()\n        }\n    }()\n}\n\ntype MyTask struct{}\n\nfunc (m MyTask) doWork() {\n    fmt.Println(\"Doing my work\")\n}\n\nfunc main() {\n    d := Daemon{task: MyTask{}}\n    d.start(time.Millisecond*300)\n\n    time.Sleep(time.Second * 2)\n}\n</code></pre>\n\n<h3>With a function value</h3>\n\n<p>In this simple case this one is shorter. Try it on the <a href=\"http://play.golang.org/p/ju7vg9VLx2\" rel=\"noreferrer\">Go Playground</a>.</p>\n\n<pre><code>type Daemon struct {\n    task func()\n}\n\nfunc (d *Daemon) start(t time.Duration) {\n    ticker := time.NewTicker(t)\n    // this will call task() periodically\n    go func() {\n        for {\n            &lt;-ticker.C\n            d.task()\n        }\n    }()\n}\n\nfunc main() {\n    d := Daemon{task: func() {\n        fmt.Println(\"Doing my work\")\n    }}\n    d.start(time.Millisecond * 300)\n\n    time.Sleep(time.Second * 2)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "is_accepted": false, "score": 10, "last_activity_date": 1529986204, "last_edit_date": 1529986204, "creation_date": 1472764650, "answer_id": 39280987, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/39280987#39280987", "title": "How to implement an abstract class in Go?", "body": "<p>The other answers provide an alternative to your problem, however they proposed solution without using abstract classes/struct, and I guess if you were interested in using abstract class like solution, here is very precise solution to your problem:</p>\n\n<p><a href=\"https://play.golang.org/p/ZbOeYTMTML\" rel=\"noreferrer\">Go plaground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\ntype Daemon interface {\n    start(time.Duration)\n    doWork()\n}\n\ntype AbstractDaemon struct {\n    Daemon\n}\n\nfunc (a *AbstractDaemon) start(duration time.Duration) {\n    ticker := time.NewTicker(duration)\n\n    // this will call daemon.doWork() periodically  \n    go func() {\n        for {\n            &lt;- ticker.C\n            a.doWork()\n        }\n    }()\n}\n\n\n\ntype ConcreteDaemonA struct { \n*AbstractDaemon\nfoo int\n}\n\nfunc newConcreteDaemonA() *ConcreteDaemonA {\n  a:=&amp;AbstractDaemon{}\n  r:=&amp;ConcreteDaemonA{a, 0}\n  a.Daemon = r\n  return r\n}\n\n\ntype ConcreteDaemonB struct { \n*AbstractDaemon\nbar int\n}\n\nfunc newConcreteDaemonB() *ConcreteDaemonB {\n  a:=&amp;AbstractDaemon{}\n  r:=&amp;ConcreteDaemonB{a, 0}\n  a.Daemon = r\n  return r\n}\n\n\n\nfunc (a *ConcreteDaemonA) doWork() {\n    a.foo++\n    fmt.Println(\"A: \", a.foo)\n}\n\nfunc (b *ConcreteDaemonB) doWork() {\n    b.bar--\n    fmt.Println(\"B: \", b.bar)\n}\n\n\nfunc main() {\n    var dA  Daemon = newConcreteDaemonA()\n    var dB  Daemon = newConcreteDaemonB()\n\n    dA.start(1 * time.Second)\n    dB.start(5 * time.Second)\n\n    time.Sleep(100 * time.Second)\n}\n</code></pre>\n\n<p>If this is still not obvious how to use abstract classes/multi-inheritance in go-lang here is the post with comprehensive details. <a href=\"https://medium.com/@adrianwit/abstract-class-reinvented-with-go-4a7326525034\" rel=\"noreferrer\">Abstract Classes In Go</a></p>\n"}, {"comments": [{"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1527799310, "post_id": 50082192, "comment_id": 88275140, "body": "@&quot;Juan Carlos Diaz&quot; please elaborate on recursion, have you meant package cyclic references (they are different things), I have assumed that package organization was out of scope for this question, the presented abstract class with interface makes the trick, so   I do not see your proposed solution much  different from what I have proposed, besides you have broken it down  per different packages, and added factory struct"}, {"owner": {"reputation": 1696, "user_id": 2584597, "user_type": "registered", "profile_image": "https://graph.facebook.com/501424819/picture?type=large", "display_name": "jucardi", "link": "https://stackoverflow.com/users/2584597/jucardi"}, "reply_to_user": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1527888803, "post_id": 50082192, "comment_id": 88313380, "body": "@AdrianWitas You&#39;re right, I meant cyclic references, edited. However with your solution you will in fact run into cyclic issues if you use a factory pattern, try it"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1527892286, "post_id": 50082192, "comment_id": 88314328, "body": "@&quot;Juan Carlos Diaz&quot;, I do not see any package cyclic reference issue: see factory extension within one package <a href=\"https://play.golang.org/p/Tu0RNmRWHsa\" rel=\"nofollow noreferrer\">play.golang.org/p/Tu0RNmRWHsa</a> , so as stated the only difference between presented solutions is delegating into packages (it has its own value) and adding factory. Appreciate correction."}, {"owner": {"reputation": 1696, "user_id": 2584597, "user_type": "registered", "profile_image": "https://graph.facebook.com/501424819/picture?type=large", "display_name": "jucardi", "link": "https://stackoverflow.com/users/2584597/jucardi"}, "reply_to_user": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1527990812, "post_id": 50082192, "comment_id": 88335395, "body": "@AdrianWitas of course you won&#39;t see any cyclic problems with that playground link, you are doing everything in a single file, single package, that is not a real factory scenario at all."}, {"owner": {"reputation": 1696, "user_id": 2584597, "user_type": "registered", "profile_image": "https://graph.facebook.com/501424819/picture?type=large", "display_name": "jucardi", "link": "https://stackoverflow.com/users/2584597/jucardi"}, "reply_to_user": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1527993061, "post_id": 50082192, "comment_id": 88335753, "body": "@AdrianWitas. I wanted to reply explaining but the comments are limited with a max about of characters, so I added my comments here <a href=\"https://play.golang.org/p/Qi6sKbOF7Ob\" rel=\"nofollow noreferrer\">play.golang.org/p/Qi6sKbOF7Ob</a> And please, if you have a suggestion, let me know. The way I did it was with your suggestions but with a minor change of wrapping the abstract members in its own interface"}, {"owner": {"reputation": 1510, "user_id": 6476791, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55d5de71330e6307063fdb6dde80d7ca?s=128&d=identicon&r=PG&f=1", "display_name": "Adrian", "link": "https://stackoverflow.com/users/6476791/adrian"}, "edited": false, "score": 0, "creation_date": 1528004390, "post_id": 50082192, "comment_id": 88337314, "body": "@&quot;Juan Carlos Diaz&quot;,  I guess you can easily end up with package cyclic references no matter what problem is being addressed, but this has nothing to do with the abstract class solution, see I have used the presented pattern here  <a href=\"https://github.com/viant/dsc/blob/master/manager.go\" rel=\"nofollow noreferrer\">github.com/viant/dsc/blob/master/manager.go</a> and <a href=\"https://github.com/viant/bgc/blob/master/manager.go\" rel=\"nofollow noreferrer\">github.com/viant/bgc/blob/master/manager.go</a> and in many other places without hitting cyclic references problem, hope it helps to clarify."}], "tags": [], "owner": {"reputation": 1696, "user_id": 2584597, "user_type": "registered", "profile_image": "https://graph.facebook.com/501424819/picture?type=large", "display_name": "jucardi", "link": "https://stackoverflow.com/users/2584597/jucardi"}, "is_accepted": false, "score": 1, "last_activity_date": 1527888766, "last_edit_date": 1527888766, "creation_date": 1524960671, "answer_id": 50082192, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/50082192#50082192", "title": "How to implement an abstract class in Go?", "body": "<p>The solution by <strong>Max Malysh</strong> would work in some cases if you don't need a factory. However the solution given by <strong>Adrian Witas</strong> could cause cyclic dependencies issues.</p>\n\n<p>This is the way I achieved implementing an abstract class the easy way respecting cyclic dependencies and good factory patterns.</p>\n\n<p>Let us assume we have the following package structure for our component</p>\n\n<pre><code>component\n  base\n    types.go\n    abstract.go\n  impl1\n    impl.go\n  impl2\n    impl.go\n  types.go\n  factory.go\n</code></pre>\n\n<p>Define the definition of the component, in this example it will be defined here:</p>\n\n<p><strong>component/types.go</strong></p>\n\n<pre><code>package component\n\ntype IComponent interface{\n    B() int\n    A() int\n    Sum() int\n    Average() int\n}\n</code></pre>\n\n<p>Now let's assume we want to create an abstract class that implements <strong>Sum</strong> and <strong>Average</strong> only, but in this abstract implementation we would like to have access to use the values returned by the implemented <strong>A</strong> and <strong>B</strong></p>\n\n<p>To achieve this, we should define another interface for the abstract members of the abstract implementation</p>\n\n<p><strong>component/base/types.go</strong></p>\n\n<pre><code>package base\n\ntype IAbstractComponentMembers {\n    A() int\n    B() int\n}\n</code></pre>\n\n<p>And then we can proceed to implement the abstract \"class\"</p>\n\n<p><strong>component/base/abstract.go</strong></p>\n\n<pre><code>package base\n\ntype AbstractComponent struct {\n    IAbstractComponentsMember\n}\n\nfunc (a *AbstractComponent) Sum() int {\n    return a.A() + a.B()\n}\n\nfunc (a *AbstractComponent) Average() int {\n    return a.Sum() / 2\n}\n</code></pre>\n\n<p>And now we proceed to the implementations</p>\n\n<p><strong>component/impl1/impl.go</strong>  // Asume something similar for <strong>impl2</strong></p>\n\n<pre><code>package impl1\n\ntype ComponentImpl1 struct {\n    base.AbstractComponent\n}\n\nfunc (c *ComponentImpl1) A() int {\n    return 2\n}\n\nfunc (c *ComponentImpl1) A() int {\n    return 4\n}\n\n// Here is how we would build this component\nfunc New() *ComponentImpl1 {\n    impl1 := &amp;ComponentImpl1{}\n    abs:=&amp;base.AbstractComponent{\n        IAbstractComponentsMember: impl1,\n    }\n    impl1.AbstractComponent = abs\n    return impl1\n}\n</code></pre>\n\n<p>The reason we use a separate interface for this instead of using <strong>Adrian Witas</strong> example, is because if we use the same interface in this case, if we import the <strong>base</strong> package in <strong>impl*</strong> to use the abstract \"class\" and also we import the <strong>impl*</strong> packages in the <strong>components</strong> package, so the factory can register them, we'll find a circular reference.</p>\n\n<p>So we could have a factory implementation like this</p>\n\n<p><strong>component/factory.go</strong></p>\n\n<pre><code>package component\n\n// Default component implementation to use\nconst defaultName = \"impl1\"\nvar instance *Factory\n\ntype Factory struct {\n    // Map of constructors for the components\n    ctors map[string]func() IComponent\n}\n\nfunc (f *factory) New() IComponent {\n    ret, _ := f.Create(defaultName)\n    return ret\n}\n\nfunc (f *factory) Create(name string) (IComponent, error) {\n    ctor, ok := f.ctors[name]\n    if !ok {\n        return nil, errors.New(\"component not found\")\n    }\n    return ctor(), nil\n}\n\nfunc (f *factory) Register(name string, constructor func() IComponent) {\n    f.ctors[name] = constructor\n}\n\nfunc Factory() *Factory {\n    if instance == nil {\n        instance = &amp;factory{ctors: map[string]func() IComponent{}}\n    }\n    return instance\n}\n\n// Here we register the implementations in the factory\nfunc init() {\n    Factory().Register(\"impl1\", func() IComponent { return impl1.New() })\n    Factory().Register(\"impl2\", func() IComponent { return impl2.New() })\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 835, "user_id": 4008473, "user_type": "registered", "accept_rate": 12, "profile_image": "https://www.gravatar.com/avatar/bab2d01a5c2ce91bed8964aabf65527c?s=128&d=identicon&r=PG&f=1", "display_name": "user27111987", "link": "https://stackoverflow.com/users/4008473/user27111987"}, "is_accepted": false, "score": 1, "last_activity_date": 1566140998, "creation_date": 1566140998, "answer_id": 57545814, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go/57545814#57545814", "title": "How to implement an abstract class in Go?", "body": "<p>The functionality of abstract class has below requirements \n  1. It should not be possible to create direct instance of abstract class\n  2. It should provide default fields and methods.</p>\n\n<p>A combination of interface and struct can be used to fulfill above two requirements. For example we can see below</p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\n//Abstract Interface\ntype iAlpha interface {\n    work()\n    common(iAlpha)\n}\n\n//Abstract Concrete Type\ntype alpha struct {\n    name string\n}\n\nfunc (a *alpha) common(i iAlpha) {\n    fmt.Println(\"common called\")\n    i.work()\n}\n\n//Implementing Type\ntype beta struct {\n    alpha\n}\n\nfunc (b *beta) work() {\n    fmt.Println(\"work called\")\n    fmt.Printf(\"Name is %s\\n\", b.name)\n}\n\nfunc main() {\n    a := alpha{name: \"test\"}\n    b := &amp;beta{alpha: a}\n    b.common(b)\n}\n\n\n  Output:\n    common called\n    work called\n    Name is test\n</code></pre>\n\n<p>One important point to mention here is that all default method should have iAlpha as first argument, and if default method needs to call any unimplemented method they they will call on this interface. This is same as we did in common method above -   i.work().</p>\n\n<p>Source: <a href=\"https://golangbyexample.com/go-abstract-class/\" rel=\"nofollow noreferrer\">https://golangbyexample.com/go-abstract-class/</a></p>\n"}], "owner": {"reputation": 21358, "user_id": 1977620, "user_type": "registered", "accept_rate": 54, "profile_image": "https://i.stack.imgur.com/lvWfj.jpg?s=128&g=1", "display_name": "Max Malysh", "link": "https://stackoverflow.com/users/1977620/max-malysh"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 18257, "favorite_count": 2, "accepted_answer_id": 30261033, "answer_count": 5, "score": 11, "last_activity_date": 1566140998, "creation_date": 1431697342, "last_edit_date": 1444743947, "question_id": 30261032, "link": "https://stackoverflow.com/questions/30261032/how-to-implement-an-abstract-class-in-go", "title": "How to implement an abstract class in Go?", "body": "<p>How to implement an abstract class in Go? As Go doesn't allow us to have fields in interfaces, that would be a stateless object. So, in other words, is it possible to have some kind of default implementation for a method in Go?</p>\n\n<p>Consider an example:</p>\n\n<pre><code>type Daemon interface {\n    start(time.Duration)\n    doWork()\n}\n\nfunc (daemon *Daemon) start(duration time.Duration) {\n    ticker := time.NewTicker(duration)\n\n    // this will call daemon.doWork() periodically  \n    go func() {\n        for {\n            &lt;- ticker.C\n            daemon.doWork()\n        }\n    }()\n}\n\ntype ConcreteDaemonA struct { foo int }\ntype ConcreteDaemonB struct { bar int }\n\nfunc (daemon *ConcreteDaemonA) doWork() {\n    daemon.foo++\n    fmt.Println(\"A: \", daemon.foo)\n}\n\nfunc (daemon *ConcreteDaemonB) doWork() {\n    daemon.bar--\n    fmt.Println(\"B: \", daemon.bar)\n}\n\nfunc main() {\n    dA := new(ConcreteDaemonA)\n    dB := new(ConcreteDaemonB)\n\n    start(dA, 1 * time.Second)\n    start(dB, 5 * time.Second)\n\n    time.Sleep(100 * time.Second)\n}\n</code></pre>\n\n<p>This won't compile as it's not possible to use interface as a receiver. </p>\n\n<p>In fact, I have already answered my question (see the answer below). However, is it an idiomatic way to implement such logic? Are there any reasons not to have a default implementation besides language's simplicity?</p>\n"}, {"tags": ["dynamic", "go", "compilation", "dynamically-generated"], "comments": [{"owner": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 2, "creation_date": 1431691656, "post_id": 30258900, "comment_id": 48617761, "body": "Is this something that using <a href=\"https://github.com/jteeuwen/go-bindata\" rel=\"nofollow noreferrer\">go-bindata</a> will solve?"}], "answers": [{"comments": [{"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "edited": false, "score": 0, "creation_date": 1431698429, "post_id": 30259491, "comment_id": 48622690, "body": "A nice implementation of the compile step is available in Gomega: <a href=\"https://github.com/onsi/gomega/blob/master/gexec/build.go\" rel=\"nofollow noreferrer\">github.com/onsi/gomega/blob/master/gexec/build.go</a> It&#39;s not complicated to write yourself, but it&#39;s helpful to see a good cross-platform example."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1431693476, "last_edit_date": 1431693476, "creation_date": 1431692662, "answer_id": 30259491, "question_id": 30258900, "link": "https://stackoverflow.com/questions/30258900/dynamically-create-compiled-binary-with-go/30259491#30259491", "title": "Dynamically create compiled binary with go", "body": "<p>So you have 2 sub-tasks which together do what you want:</p>\n\n<ol>\n<li>Perform a text substitution to acquire the final source code.</li>\n<li>Compile the final source code into executable binary.</li>\n</ol>\n\n<h2>1. Text substitution</h2>\n\n<p>The first can be easily done using the <a href=\"https://golang.org/pkg/text/template/\"><code>text/template</code></a> package. You can either have the source templates as separate, individual files, or embedded in the main Go source (e.g. as <code>const</code>s).</p>\n\n<p>You can build / parse the source code templates and get a <a href=\"https://golang.org/pkg/text/template/#Template\"><code>Template</code></a> with e.g. <a href=\"https://golang.org/pkg/text/template/#ParseFiles\"><code>template.ParseFiles()</code></a> or using <code>template.New().Parse()</code>. Once you have your template, assemble (e.g. load from file) the values you want to include in the source template and execute it e.g. with <a href=\"https://golang.org/pkg/text/template/#Template.Execute\"><code>Template.Execute()</code></a>. You have the final source now.</p>\n\n<p>The <code>text/template</code> package gives you a powerful template engine which is capable to a lot more than just text substitution.</p>\n\n<p><strong>Note:</strong> There is also a Go parser implemented and available in the standard library at your disposal in the subpackages of <a href=\"https://golang.org/pkg/go/\"><code>go</code></a>, but using the <code>text/template</code> package is much simpler and looks it's enough and perfectly fine for your case.</p>\n\n<h2>2. Compile</h2>\n\n<p>To compile the final source into an executable binary, you need the help of the compiler. You can use the <a href=\"https://golang.org/pkg/os/exec/\"><code>os/exec</code></a> package to invoke the compiler which will produce the binary. See the <a href=\"https://golang.org/pkg/os/exec/#Command\"><code>exec.Command()</code></a> function to acquire a <a href=\"https://golang.org/pkg/os/exec/#Cmd\"><code>Cmd</code></a>, and <a href=\"https://golang.org/pkg/os/exec/#Cmd.Run\"><code>Cmd.Run()</code></a> and <a href=\"https://golang.org/pkg/os/exec/#Cmd.Start\"><code>Cmd.Start()</code></a> to execute it.</p>\n"}], "owner": {"reputation": 326, "user_id": 1995677, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/25271152b0a44b52df593ed99ac839f9?s=128&d=identicon&r=PG", "display_name": "Peleus", "link": "https://stackoverflow.com/users/1995677/peleus"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 609, "favorite_count": 1, "accepted_answer_id": 30259491, "answer_count": 1, "score": 4, "last_activity_date": 1431694369, "creation_date": 1431690866, "last_edit_date": 1431694369, "question_id": 30258900, "link": "https://stackoverflow.com/questions/30258900/dynamically-create-compiled-binary-with-go", "title": "Dynamically create compiled binary with go", "body": "<p>First sorry for perhaps a bad title - I imagine a lot of the difficulty I'm experiencing relates to not knowing the correct terminology for what I'm trying to achieve. </p>\n\n<p>In Go, I wish to have a program which when run can dynamically create a secondary binary. To illustrate with a basic hello world example - in pseudo code since I don't know how to achieve it. </p>\n\n<pre><code>generator.go\n-&gt; Read in statement from statement.txt (i.e. \"Hello World\")\n-&gt; Insert this statement into the following program...\n\npackage main\n\nimport (\n    \"fmt\"\n)\n\nfunc main(){\n    fmt.Println([dynamic statement inserted here])\n}\n\n-&gt; compile this code into subprogram\n</code></pre>\n\n<p>Whenever <code>go run generator.go</code> is executed a <code>subprogram</code> binary is created. Running this would output <code>Hello World</code>. Changing statement.txt to something else and executing <code>go run generator.go</code> again would once more create <code>subprogram</code> which when run would execute the new statement. </p>\n\n<p>In summary</p>\n\n<p><em>With Go, how can I create a program which can dynamically create a compiled child program as output.</em></p>\n\n<p>Thanks. </p>\n"}, {"tags": ["json", "string", "struct", "go"], "comments": [{"owner": {"reputation": 27317, "user_id": 893693, "user_type": "registered", "accept_rate": 95, "profile_image": "https://i.stack.imgur.com/yHFyJ.jpg?s=128&g=1", "display_name": "Stephan Dollberg", "link": "https://stackoverflow.com/users/893693/stephan-dollberg"}, "edited": false, "score": 0, "creation_date": 1431689045, "post_id": 30257817, "comment_id": 48616103, "body": "You can store objects in redis using <a href=\"http://redis.io/topics/data-types-intro#hashes\" rel=\"nofollow noreferrer\">Hashes</a>."}], "answers": [{"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431689869, "post_id": 30257901, "comment_id": 48616552, "body": "@tommyd456 It is a byte slice (<code>[]byte</code>), basically the UTF-8 encoded data of the <code>string</code> representation."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 0, "last_activity_date": 1471955088, "last_edit_date": 1495535327, "creation_date": 1431687845, "answer_id": 30257901, "question_id": 30257817, "link": "https://stackoverflow.com/questions/30257817/store-struct-as-string-in-redis/30257901#30257901", "title": "Store struct as string in redis", "body": "<p>The <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\"><code>encoding/json</code></a> package can be used to easily convert a <code>struct</code> to JSON string and vice versa (parse a JSON string into a <code>struct</code>).</p>\n\n<p>Simple example (try it on the <a href=\"http://play.golang.org/p/fZzKA5Yveh\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>type Person struct {\n    Name string\n    Age  int\n}\n\nfunc main() {\n    p := Person{\"Bob\", 23}\n\n    // Struct -&gt; JSON\n    data, err := json.Marshal(&amp;p)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Println(string(data))\n\n    // JSON -&gt; JSON\n    var p2 Person\n    err = json.Unmarshal(data, &amp;p2)\n    if err != nil {\n        panic(err)\n    }\n    fmt.Printf(\"%+v\", p2)\n}\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>{\"Name\":\"Bob\",\"Age\":23}\n{Name:Bob Age:23}\n</code></pre>\n\n<h3>Notes:</h3>\n\n<p>The fields of the <code>struct</code> must be exported (start them with capital letter), else the <code>json</code> package (which uses reflection) will not be able to read/write them.</p>\n\n<p>You can also specify tags for the struct fields to control/fine tune the json marshaling/unmarshaling process, for example to change the names in the JSON text:</p>\n\n<pre><code>type Person struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"years\"`\n}\n</code></pre>\n\n<p>With this change the output of the above application is the following:</p>\n\n<pre><code>{\"name\":\"Bob\",\"years\":23}\n{Name:Bob Age:23}\n</code></pre>\n\n<p>The documentation of the <a href=\"https://golang.org/pkg/encoding/json/#Marshal\" rel=\"nofollow noreferrer\"><code>json.Marshal()</code></a> function details the possibilities provided by the tags.</p>\n\n<p>And by implementing the <a href=\"https://golang.org/pkg/encoding/json/#Marshaler\" rel=\"nofollow noreferrer\"><code>json.Marshaler</code></a> and <a href=\"https://golang.org/pkg/encoding/json/#Unmarshaler\" rel=\"nofollow noreferrer\"><code>json.Unmarshaler</code></a> interfaces you can fully customize the marshaling / unmarshaling process.</p>\n\n<p>Also if your struct is not pre-defined (e.g. you don't know the fields in advance), you can use a <code>map[string]interface{}</code>. <a href=\"https://stackoverflow.com/a/28860080/1705598\">See this answer for details and examples</a>.</p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1240, "favorite_count": 0, "accepted_answer_id": 30257901, "answer_count": 1, "score": 0, "last_activity_date": 1471955088, "creation_date": 1431687533, "last_edit_date": 1431691891, "question_id": 30257817, "link": "https://stackoverflow.com/questions/30257817/store-struct-as-string-in-redis", "title": "Store struct as string in redis", "body": "<p>As Redis only stores strings I would like to know how I can do the equivalent of Javascript's JSON.stringify using Go to convert a Struct into a string.</p>\n\n<p>I have tried typecasting:</p>\n\n<pre><code>string(the_struct)\n</code></pre>\n\n<p>but this results in an error.</p>\n"}, {"tags": ["go", "logging", "goland", "logrus"], "answers": [{"comments": [{"owner": {"reputation": 2752, "user_id": 140164, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c44c58fe1ee2a3189f1fd99a3d73d0d2?s=128&d=identicon&r=PG&f=1", "display_name": "Dipen Bhikadya", "link": "https://stackoverflow.com/users/140164/dipen-bhikadya"}, "edited": false, "score": 1, "creation_date": 1431708011, "post_id": 30261304, "comment_id": 48629223, "body": "Thanks for a well detailed explanation! Previously I have also used my own log wrappers with other languages but a lot of times found them unnecessary and an overhead. I think it would make log provider replacement easier though."}, {"owner": {"reputation": 14996, "user_id": 190823, "user_type": "registered", "accept_rate": 81, "profile_image": "https://i.stack.imgur.com/521yb.jpg?s=128&g=1", "display_name": "Jens", "link": "https://stackoverflow.com/users/190823/jens"}, "edited": false, "score": 0, "creation_date": 1562504765, "post_id": 30261304, "comment_id": 100387167, "body": "As Golang beginner I really appreciate the introduction including information about the &quot;globalness&quot; of the logging. Did not know this."}, {"owner": {"reputation": 6126, "user_id": 88066, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/158927041afe9aeb0acd7fba80b75f03?s=128&d=identicon&r=PG", "display_name": "Tim Coker", "link": "https://stackoverflow.com/users/88066/tim-coker"}, "edited": false, "score": 0, "creation_date": 1588023516, "post_id": 30261304, "comment_id": 108736092, "body": "This is kind a necro post, but I just implemented something similar and the <code>file</code> and <code>func</code> fields are the file/func locations of my override where i call <code>logger.Info()</code> etc...  It makes sense since the actual callsite for the log statement is now inside my &quot;wrapper&quot; package, but wanted to ask if that happened to you and if you&#39;d found a way around it."}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": true, "score": 34, "last_activity_date": 1431698102, "creation_date": 1431698102, "answer_id": 30261304, "question_id": 30257622, "link": "https://stackoverflow.com/questions/30257622/golang-logrus-how-to-do-a-centralized-configuration/30261304#30261304", "title": "Golang logrus - how to do a centralized configuration?", "body": "<p>You don't need to set these options in each file with Logrus.</p>\n\n<p>You can import Logrus as <code>log</code>:</p>\n\n<pre><code>import log \"github.com/Sirupsen/logrus\"\n</code></pre>\n\n<p>Then functions like <code>log.SetOutput()</code> are just functions and modify the global logger and apply to any file that includes this import.</p>\n\n<p>You can create a package global <code>log</code> variable:</p>\n\n<pre><code>var log = logrus.New()\n</code></pre>\n\n<p>Then functions like <code>log.SetOutput()</code> are methods and modify your package global. This is awkward IMO if you have multiple packages in your program, because each of them has a different logger with different settings (but maybe that's good for some use cases). I also don't like this approach because it confuses <code>goimports</code> (which will want to insert <code>log</code> into your imports list).</p>\n\n<p>Or you can create your own wrapper (which is what I do). I have my own <code>log</code> package with its own <code>logger</code> var:</p>\n\n<pre><code>var logger = logrus.New()\n</code></pre>\n\n<p>Then I make top-level functions to wrap Logrus:</p>\n\n<pre><code>func Info(args ...interface{}) {\n    logger.Info(args...)\n}\n\nfunc Debug(args ...interface{}) {\n    logger.Debug(args...)\n}\n</code></pre>\n\n<p>This is slightly tedious, but allows me to add functions specific to my program:</p>\n\n<pre><code>func WithConn(conn net.Conn) *logrus.Entry {\n    var addr string = \"unknown\"\n    if conn != nil {\n        addr = conn.RemoteAddr().String()\n    }\n    return logger.WithField(\"addr\", addr)\n}\n\nfunc WithRequest(req *http.Request) *logrus.Entry {\n    return logger.WithFields(RequestFields(req))\n}\n</code></pre>\n\n<p>So I can then do things like:</p>\n\n<pre><code>log.WithConn(c).Info(\"Connected\")\n</code></pre>\n\n<p>(I plan in the future to wrap <code>logrus.Entry</code> into my own type so that I can chain these better; currently I can't call <code>log.WithConn(c).WithRequest(r).Error(...)</code> because I can't add <code>WithRequest()</code> to <code>logrus.Entry</code>.)</p>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 8828381, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c55e911f1f4170e9d64767ebbfe9721e?s=128&d=identicon&r=PG", "display_name": "hurdlea", "link": "https://stackoverflow.com/users/8828381/hurdlea"}, "is_accepted": false, "score": 1, "last_activity_date": 1508887422, "creation_date": 1508887422, "answer_id": 46921486, "question_id": 30257622, "link": "https://stackoverflow.com/questions/30257622/golang-logrus-how-to-do-a-centralized-configuration/46921486#46921486", "title": "Golang logrus - how to do a centralized configuration?", "body": "<p>This is the solution that I arrived at for my application that allows adding of fields to the logging context. It does have a small performance impact due to the copying of context base fields. </p>\n\n<pre><code>package logging\n\nimport (\n    log \"github.com/Sirupsen/logrus\"\n)\n\nfunc NewContextLogger(c log.Fields) func(f log.Fields) *log.Entry {\n    return func(f log.Fields) *log.Entry {\n        for k, v := range c {\n            f[k] = v\n        }\n        return log.WithFields(f)\n    }\n}\n\npackage main\n\nimport (\n    \"logging\"\n)\n\nfunc main {\n    app.Logger = logging.NewContextLogger(log.Fields{\n        \"module\":    \"app\",\n        \"id\":   event.Id,\n    })\n    app.Logger(log.Fields{\n        \"startTime\": event.StartTime,\n        \"endTime\":   event.EndTime,\n        \"title\":     event.Name,\n    }).Info(\"Starting process\")\n}\n</code></pre>\n"}], "owner": {"reputation": 2752, "user_id": 140164, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/c44c58fe1ee2a3189f1fd99a3d73d0d2?s=128&d=identicon&r=PG&f=1", "display_name": "Dipen Bhikadya", "link": "https://stackoverflow.com/users/140164/dipen-bhikadya"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 16856, "favorite_count": 14, "accepted_answer_id": 30261304, "answer_count": 2, "score": 28, "last_activity_date": 1586116027, "creation_date": 1431686938, "last_edit_date": 1586116027, "question_id": 30257622, "link": "https://stackoverflow.com/questions/30257622/golang-logrus-how-to-do-a-centralized-configuration", "title": "Golang logrus - how to do a centralized configuration?", "body": "<p>I am using logrus in a Go app. I believe this question is applicable to any other logging package (which doesn't offer external file based configuration) as well.</p>\n\n<p>logrus provides functions to setup various configuration, e.g. SetOutput, SetLevel etc.</p>\n\n<p>Like any other application I need to do logging from multiple source files/packages, it seems you need to setup these options in each file with logrus. </p>\n\n<p>Is there any way to setup these options once somewhere in a central place to be shared all over the application. That way if I have to make logging level change I can do it in one place and applies to all the components of the app.</p>\n"}, {"tags": ["xml", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1431696481, "post_id": 30256729, "comment_id": 48621283, "body": "Since a solution using only standard lib is presented, in order to not get closed remove the part where you ask for an external library - which is off-topic for StackOverflow."}, {"owner": {"reputation": 1, "user_id": 7325802, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/29c70faf2e0ca8e8ebc0b65aea95871c?s=128&d=identicon&r=PG&f=1", "display_name": "Alski", "link": "https://stackoverflow.com/users/7325802/alski"}, "edited": false, "score": 1, "creation_date": 1482325038, "post_id": 30256729, "comment_id": 69736093, "body": "The &quot;vanilla encoding&quot; answer is wrong. If you take that struct and pump it back through the encoder (inverse operation), it does not produce the same XML output: <a href=\"https://play.golang.org/p/ynm2WBwTZE\" rel=\"nofollow noreferrer\">play.golang.org/p/ynm2WBwTZE</a>"}], "answers": [{"comments": [{"owner": {"reputation": 728, "user_id": 1540840, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/76b8ace6bc6887ef493e0a0b226cd116?s=128&d=identicon&r=PG", "display_name": "Luca Marzi", "link": "https://stackoverflow.com/users/1540840/luca-marzi"}, "edited": false, "score": 0, "creation_date": 1611839514, "post_id": 30257106, "comment_id": 116582792, "body": "I get &quot;repository has been deleted&quot; for the link you provided"}], "tags": [], "owner": {"reputation": 16171, "user_id": 1155984, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/22074349884978092d46beac83608767?s=128&d=identicon&r=PG", "display_name": "Umberto Raimondi", "link": "https://stackoverflow.com/users/1155984/umberto-raimondi"}, "is_accepted": false, "score": 0, "last_activity_date": 1431685418, "creation_date": 1431685418, "answer_id": 30257106, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang/30257106#30257106", "title": "How to traverse through XML data in Golang?", "body": "<p>Since you are asking for a library and since it seems you would like to traverse the XML tree, i can recommend <a href=\"https://bitbucket.org/rj/xmldom-go\" rel=\"nofollow\">XMLDom-Go</a>, i've used it on some past projects.</p>\n"}, {"comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1431696362, "post_id": 30257684, "comment_id": 48621173, "body": "Clever with the recursive struct, also +1 for doing it only with the standard lib."}, {"owner": {"reputation": 17158, "user_id": 177591, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0f96caf21e8d14e1062fde39db81ed66?s=128&d=identicon&r=PG", "display_name": "Kugel", "link": "https://stackoverflow.com/users/177591/kugel"}, "edited": false, "score": 1, "creation_date": 1479642167, "post_id": 30257684, "comment_id": 68635255, "body": "Great, what about attributes?"}], "tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": false, "score": 32, "last_activity_date": 1588948284, "last_edit_date": 1588948284, "creation_date": 1431687125, "answer_id": 30257684, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang/30257684#30257684", "title": "How to traverse through XML data in Golang?", "body": "<p>You can do it with a vanilla <code>encoding/xml</code> by using a recursive struct and a simple walk function:</p>\n\n<pre><code>type Node struct {\n    XMLName xml.Name\n    Content []byte `xml:\",innerxml\"`\n    Nodes   []Node `xml:\",any\"`\n}\n\nfunc walk(nodes []Node, f func(Node) bool) {\n    for _, n := range nodes {\n        if f(n) {\n            walk(n.Nodes, f)\n        }\n    }\n}\n</code></pre>\n\n<p>Playground example: <a href=\"http://play.golang.org/p/rv1LlxaHvK\" rel=\"noreferrer\">http://play.golang.org/p/rv1LlxaHvK</a>.</p>\n\n<hr>\n\n<p><strong>EDIT:</strong> Here's a version with attrs:</p>\n\n<pre><code>type Node struct {\n    XMLName xml.Name\n    Attrs   []xml.Attr `xml:\",any,attr\"`\n    Content []byte     `xml:\",innerxml\"`\n    Nodes   []Node     `xml:\",any\"`\n}\n\nfunc (n *Node) UnmarshalXML(d *xml.Decoder, start xml.StartElement) error {\n    n.Attrs = start.Attr\n    type node Node\n\n    return d.DecodeElement((*node)(n), &amp;start)\n}\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/d9BkGclp-1\" rel=\"noreferrer\">https://play.golang.org/p/d9BkGclp-1</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 17158, "user_id": 177591, "user_type": "registered", "accept_rate": 94, "profile_image": "https://www.gravatar.com/avatar/0f96caf21e8d14e1062fde39db81ed66?s=128&d=identicon&r=PG", "display_name": "Kugel", "link": "https://stackoverflow.com/users/177591/kugel"}, "is_accepted": false, "score": 3, "last_activity_date": 1479695864, "creation_date": 1479695864, "answer_id": 40711963, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang/40711963#40711963", "title": "How to traverse through XML data in Golang?", "body": "<p>I did a bit of search on how to deal with generic XML DOM and the closest you can do is use <code>decoder.Token()</code> or <code>decoder.RawToken()</code>.</p>\n\n<p>However if you're willing to consider a library I found this one to be very easy to pick up: <a href=\"https://github.com/beevik/etree\" rel=\"nofollow noreferrer\">https://github.com/beevik/etree</a></p>\n\n<pre><code>doc := etree.NewDocument()\nif err := doc.ReadFromFile(\"bookstore.xml\"); err != nil {\n    panic(err)\n}\n\nroot := doc.SelectElement(\"bookstore\")\nfmt.Println(\"ROOT element:\", root.Tag)\n\nfor _, book := range root.SelectElements(\"book\") {\n    fmt.Println(\"CHILD element:\", book.Tag)\n    if title := book.SelectElement(\"title\"); title != nil {\n        lang := title.SelectAttrValue(\"lang\", \"unknown\")\n        fmt.Printf(\"  TITLE: %s (%s)\\n\", title.Text(), lang)\n    }\n    for _, attr := range book.Attr {\n        fmt.Printf(\"  ATTR: %s=%s\\n\", attr.Key, attr.Value)\n    }\n}\n</code></pre>\n\n<p>It uses the built-in xml parser with in the manner described above.</p>\n"}, {"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 1, "last_activity_date": 1510642455, "last_edit_date": 1510642455, "creation_date": 1510641298, "answer_id": 47279117, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang/47279117#47279117", "title": "How to traverse through XML data in Golang?", "body": "<p><a href=\"https://github.com/antchfx/xquery/\" rel=\"nofollow noreferrer\">xmlquery</a> supports parse an XML document as DOM tree to traverse all nodes, like Go's html package.</p>\n"}, {"tags": [], "owner": {"reputation": 1383, "user_id": 4457831, "user_type": "registered", "accept_rate": 64, "profile_image": "https://lh5.googleusercontent.com/-yRdAUOMzpcU/AAAAAAAAAAI/AAAAAAAAAHQ/1fFS--Cdp-k/photo.jpg?sz=128", "display_name": "Rahul Satal", "link": "https://stackoverflow.com/users/4457831/rahul-satal"}, "is_accepted": false, "score": 0, "last_activity_date": 1587319943, "creation_date": 1587319943, "answer_id": 61309335, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang/61309335#61309335", "title": "How to traverse through XML data in Golang?", "body": "<p>I would create a struct from the given XML using an online tool - <a href=\"https://www.onlinetool.io/xmltogo/\" rel=\"nofollow noreferrer\">https://www.onlinetool.io/xmltogo/</a></p>\n\n<p>For the given XML, the struct will be as below:-</p>\n\n<pre><code>type Content struct {\nXMLName xml.Name `xml:\"content\"`\nText    string   `xml:\",chardata\"`\nP       string   `xml:\"p\"`\nAnimal  []struct {\n    Text string `xml:\",chardata\"`\n    P    string `xml:\"p\"`\n    Dog  struct {\n        Text string `xml:\",chardata\"`\n        P    string `xml:\"p\"`\n    } `xml:\"dog\"`\n} `xml:\"animal\"`\nBirds struct {\n    Text string   `xml:\",chardata\"`\n    P    []string `xml:\"p\"`\n    } `xml:\"birds\"`\n} \n</code></pre>\n\n<p>Now unmarshal the XML and loop over any slice.</p>\n\n<pre><code>var content Content \n\nerr := xml.Unmarshal([]byte(data), &amp;content)\nif err != nil {\n    fmt.Printf(\"error: %v\", err)\n    return\n}\nfmt.Printf(\"Root: %#v\\n\", content )\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/0UBIdxIUvK3\" rel=\"nofollow noreferrer\">The Go Playground</a></p>\n"}], "owner": {"reputation": 2803, "user_id": 3186914, "user_type": "registered", "accept_rate": 68, "profile_image": "https://i.stack.imgur.com/kkIb4.jpg?s=128&g=1", "display_name": "Prashant", "link": "https://stackoverflow.com/users/3186914/prashant"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 12095, "favorite_count": 11, "answer_count": 5, "score": 18, "last_activity_date": 1588948284, "creation_date": 1431684393, "last_edit_date": 1431802476, "question_id": 30256729, "link": "https://stackoverflow.com/questions/30256729/how-to-traverse-through-xml-data-in-golang", "title": "How to traverse through XML data in Golang?", "body": "<p>I have used xml.UnMarshal method to get a struct object but it has it's own limitations. I need a way where I can get all the descendants of a particular type inside a node without specifying the exact xpath.</p>\n\n<p>For example, I have an xml data of the following format:</p>\n\n<pre><code>&lt;content&gt;\n    &lt;p&gt;this is content area&lt;/p&gt;\n    &lt;animal&gt;\n        &lt;p&gt;This id dog&lt;/p&gt;\n        &lt;dog&gt;\n           &lt;p&gt;tommy&lt;/p&gt;\n        &lt;/dog&gt;\n    &lt;/animal&gt;\n    &lt;birds&gt;\n        &lt;p&gt;this is birds&lt;/p&gt;\n        &lt;p&gt;this is birds&lt;/p&gt;\n    &lt;/birds&gt;\n    &lt;animal&gt;\n        &lt;p&gt;this is animals&lt;/p&gt;\n    &lt;/animal&gt;\n&lt;/content&gt;\n</code></pre>\n\n<p>Now I want to traverse through the above xml and process each node and it's children in that order. The problem is that this structure is not fixed and order of elements may change. So I need a way so that I can traverse like</p>\n\n<pre><code>While(Content.nextnode())\n{\n   switch(type of node)\n   {\n      //Process the node or traverse the child node deeper\n   }\n}\n</code></pre>\n"}, {"tags": ["struct", "interface", "go", "composition"], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1431674318, "creation_date": 1431674318, "answer_id": 30253737, "question_id": 30253621, "link": "https://stackoverflow.com/questions/30253621/dont-understand-composition-in-go/30253737#30253737", "title": "Don&#39;t understand composition in Go", "body": "<p><code>w</code> is a variable of type <code>http.ResponseWriter</code>. <code>ResponseWriter</code> does not have a field or method <code>Status</code>, only your <code>Response</code> type.</p>\n\n<p><code>http.ResponseWriter</code> is an interface type, and since your <code>Response</code> type implements it (because it embeds <code>ResponseWriter</code>), the <code>w</code> variable may hold a value of dynamic type <code>Response</code> (and in your case it does).</p>\n\n<p>But to access the <code>Response.Status</code> field, you have to convert it to a value of type <code>Response</code>. For that use <a href=\"https://golang.org/ref/spec#Type_assertions\" rel=\"nofollow\">Type assertion</a>:</p>\n\n<pre><code>if resp, ok := w.(Response); ok {\n    // resp is of type Response, you can access its Status field\n    fmt.Println(resp.Status) // &lt;--- properly prints status\n}\n</code></pre>\n"}], "owner": {"reputation": 7466, "user_id": 288424, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cf91d37f026ddaccc28c9907b567ab13?s=128&d=identicon&r=PG&f=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/288424/neil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 97, "favorite_count": 0, "accepted_answer_id": 30253737, "answer_count": 1, "score": 1, "last_activity_date": 1431691833, "creation_date": 1431673928, "last_edit_date": 1431691833, "question_id": 30253621, "link": "https://stackoverflow.com/questions/30253621/dont-understand-composition-in-go", "title": "Don&#39;t understand composition in Go", "body": "<p>In the example below I've embedded <code>http.ResponseWriter</code> into my own struct called <code>Response</code>. I've also added an extra field called <code>Status</code>. Why can't I access that field from inside my <code>root</code> handler function? </p>\n\n<p>When I print out the type of <code>w</code> in my root handler function it says it's of type <code>main.Response</code> which seems correct and when I print out the values of the struct I can see that <code>Status</code> is there. Why can't I access by going <code>w.Status</code>?</p>\n\n<p>This is the contents of stdout:</p>\n\n<pre><code>main.Response\n{ResponseWriter:0xc2080440a0 Status:0}\n</code></pre>\n\n<p>Code:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n\n    \"net/http\"\n)\n\ntype Response struct {\n    http.ResponseWriter\n    Status int\n}\n\nfunc (r Response) WriteHeader(n int) {\n    r.Status = n\n    r.ResponseWriter.WriteHeader(n)\n}\n\nfunc middleware(h http.Handler) http.Handler {\n\n    return http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {\n\n        resp := Response{ResponseWriter: w}\n\n        h.ServeHTTP(resp, r)\n    })\n}\n\nfunc root(w http.ResponseWriter, r *http.Request) {\n    w.Write([]byte(\"root\"))\n    fmt.Println(reflect.TypeOf(w))\n    fmt.Printf(\"%+v\\n\", w)\n    fmt.Println(w.Status) // &lt;--- This causes an error.\n}\n\nfunc main() {\n    http.Handle(\"/\", middleware(http.HandlerFunc(root)))\n    http.ListenAndServe(\":8000\", nil)\n}\n</code></pre>\n"}, {"tags": ["java", "go", "base64", "hmacsha1"], "comments": [{"owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "edited": false, "score": 0, "creation_date": 1431673392, "post_id": 30253057, "comment_id": 48606986, "body": "Can you please provide the output for both <code>java</code> and <code>go</code> for both key and string are empty: <code>&quot;&quot;</code> and <code>&quot;&quot;</code>?"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 9, "last_activity_date": 1471848451, "last_edit_date": 1471848451, "creation_date": 1431673344, "answer_id": 30253449, "question_id": 30253057, "link": "https://stackoverflow.com/questions/30253057/go-hmac-sha1-generates-hash-different-from-hmac-sha1-in-java/30253449#30253449", "title": "Go Hmac SHA1 generates hash different from Hmac SHA1 in Java", "body": "<p>The Go code you provided gives exactly the same output as the Java code.</p>\n\n<p>Try it on the <a href=\"http://play.golang.org/p/iVOr2nOdO2\" rel=\"nofollow\">Go Playground</a>.</p>\n\n<p>Output:</p>\n\n<pre><code>RiD1vimxoaouU3VB1sVmchwhfhg=\n</code></pre>\n\n<p>You made the mistake when you called your <code>GetSignature()</code> function. Call it like the linked example code:</p>\n\n<pre><code>fmt.Println(GetSignature(\"qwerty\", \"key\"))\n</code></pre>\n\n<p>Your mistake was that you passed an empty input to your <code>GetSignature()</code> function. Calling it with empty <code>\"\"</code> input and <code>\"key\"</code> key produces the non-expected output you provided:</p>\n\n<pre><code>fmt.Println(GetSignature(\"\", \"key\"))\n</code></pre>\n\n<p>Output:</p>\n\n<pre><code>9Cuw7rAY671Fl65yE3EexgdghD8=\n</code></pre>\n"}], "owner": {"reputation": 760, "user_id": 4816308, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-lDkUFTTPIwE/AAAAAAAAAAI/AAAAAAAAAGE/OZsIpsn7ebU/photo.jpg?sz=128", "display_name": "Artem Nikitin", "link": "https://stackoverflow.com/users/4816308/artem-nikitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 4081, "favorite_count": 0, "accepted_answer_id": 30253449, "answer_count": 1, "score": 3, "last_activity_date": 1471848451, "creation_date": 1431671865, "last_edit_date": 1431691932, "question_id": 30253057, "link": "https://stackoverflow.com/questions/30253057/go-hmac-sha1-generates-hash-different-from-hmac-sha1-in-java", "title": "Go Hmac SHA1 generates hash different from Hmac SHA1 in Java", "body": "<p>I'm just starting to learn Go and I'm trying to rewrite my existing small application from Java to Go. </p>\n\n<p>I need to create Base64 hash of input string with key using Hmac SHA1 algorithm.</p>\n\n<p><strong>My Java code:</strong></p>\n\n<pre><code>private String getSignedBody(String input, String key) {\n    String result = \"\";\n    try {\n        SecretKeySpec signingKey = new SecretKeySpec(key.getBytes(\"UTF-8\"), \"HmacSHA1\");\n        Mac mac = Mac.getInstance(\"HmacSHA1\");\n        mac.init(signingKey);\n        byte[] rawHmac = mac.doFinal(input.getBytes(\"UTF-8\"));\n        result = Base64.encodeToString(rawHmac, false);\n    } catch (Exception e) {\n        Logger.error(\"Failed to generate signature: \" + e.getMessage());\n    }\n    return result;\n}\n</code></pre>\n\n<p><strong>My Go code:</strong></p>\n\n<pre><code>func GetSignature(input, key string) string {\n    key_for_sign := []byte(key)\n    h := hmac.New(sha1.New, key_for_sign)\n    h.Write([]byte(input))\n    return base64.StdEncoding.EncodeToString(h.Sum(nil))\n}\n</code></pre>\n\n<p>The problem is that Go code generates output that is not expected. For example, for input string <code>\"qwerty\"</code> and key <code>\"key\"</code> Java output will be <code>RiD1vimxoaouU3VB1sVmchwhfhg=</code> and Go output will be <code>9Cuw7rAY671Fl65yE3EexgdghD8=</code>. </p>\n\n<p>Where did I make mistakes in the Go code?</p>\n"}, {"tags": ["go", "gif"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1431654658, "post_id": 30249257, "comment_id": 48601063, "body": "Note this can be done either by using your own <code>*image.Paletted</code> as the image to encode (as shown), or by setting <a href=\"https://golang.org/pkg/image/gif/#Options\" rel=\"nofollow noreferrer\"><code>gif.Options</code>&#39;s</a> <code>Quantizer</code> field to a <a href=\"https://golang.org/pkg/image/draw/#Quantizer\" rel=\"nofollow noreferrer\"><code>draw.Quantizer</code></a> that puts a transparent color into the palette (perhaps when detecting any transparency in the image). The default when the <code>Quantizer</code> field is nil is to use a static palette with no transparency."}], "tags": [], "owner": {"reputation": 16513, "user_id": 95642, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/36cf75fa7751ef674df65ab65cecd255?s=128&d=identicon&r=PG", "display_name": "Drew LeSueur", "link": "https://stackoverflow.com/users/95642/drew-lesueur"}, "is_accepted": true, "score": 8, "last_activity_date": 1431646976, "creation_date": 1431646976, "answer_id": 30249257, "question_id": 30248493, "link": "https://stackoverflow.com/questions/30248493/how-do-i-create-a-transparent-gif-in-go/30249257#30249257", "title": "How do I create a transparent gif in Go?", "body": "<p>I read the source of image/gif and found that there just has to be a transparent color on your palette.</p>\n\n<pre><code>var palette color.Palette = color.Palette{\n    image.Transparent,\n    image.Black,\n    image.White,\n    color.RGBA{0, 255, 0, 255},\n    color.RGBA{0, 100, 0, 255},\n}\n\nm := image.NewPaletted(image.Rect(0, 0, pixelWidth, pixelHeight), palette)\ngif.Encode(w, m, &amp;gif.Options{}) \n</code></pre>\n"}], "owner": {"reputation": 16513, "user_id": 95642, "user_type": "registered", "accept_rate": 79, "profile_image": "https://www.gravatar.com/avatar/36cf75fa7751ef674df65ab65cecd255?s=128&d=identicon&r=PG", "display_name": "Drew LeSueur", "link": "https://stackoverflow.com/users/95642/drew-lesueur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 659, "favorite_count": 0, "accepted_answer_id": 30249257, "answer_count": 1, "score": 5, "last_activity_date": 1431646976, "creation_date": 1431642431, "question_id": 30248493, "link": "https://stackoverflow.com/questions/30248493/how-do-i-create-a-transparent-gif-in-go", "title": "How do I create a transparent gif in Go?", "body": "<p>when I encode a gif in Go, the background is all black. How do I make the background transparent?</p>\n\n<p>Here is some code in my http handler. (w is the responseWriter)</p>\n\n<pre><code>m := image.NewRGBA(image.Rect(0, 0, pixelWidth, pixelHeight))\ngif.Encode(w, m, &amp;gif.Options{NumColors: 16}) \n</code></pre>\n"}, {"tags": ["go", "build", "swig"], "comments": [{"owner": {"reputation": 80332, "user_id": 145587, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/2ce699e2ec2d8ddb26b6a866191da86d?s=128&d=identicon&r=PG", "display_name": "OneOfOne", "link": "https://stackoverflow.com/users/145587/oneofone"}, "edited": false, "score": 0, "creation_date": 1431649606, "post_id": 30248259, "comment_id": 48599692, "body": "It doesn&#39;t seem like you&#39;re using swig if you&#39;re getting this error and I can&#39;t see the code since it&#39;s a private repo."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 0, "creation_date": 1431655570, "post_id": 30248259, "comment_id": 48601315, "body": "Presumably the way you&#39;re building your program has disabled Go.  Without seeing what command you ran, it is difficult to say exactly why.  Assuming you didn&#39;t set <code>CGO_ENABLED=0</code>, the other possibility is if you tried to cross compile the program, which disables it by default."}, {"owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "edited": false, "score": 0, "creation_date": 1432050855, "post_id": 30248259, "comment_id": 48755619, "body": "I&#39;ve moved the code to a public repo. The Makefile is terrible, I know. The current one works with Mac OS X, and I have another one that works with Linux. The Makefile currently uses a hardcoded GOPATH and GOROOT."}], "answers": [{"comments": [{"owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "edited": false, "score": 1, "creation_date": 1432050623, "post_id": 30270409, "comment_id": 48755462, "body": "I added a new package exactly as you said, but it didn&#39;t fix anything. I still get the same error."}, {"owner": {"reputation": 1051, "user_id": 809410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ffc49c668c0066df3196ecf48aa39f?s=128&d=identicon&r=PG", "display_name": "iant", "link": "https://stackoverflow.com/users/809410/iant"}, "reply_to_user": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "edited": false, "score": 1, "creation_date": 1432139540, "post_id": 30270409, "comment_id": 48803008, "body": "Not a new package, a new .go file in the same package."}, {"owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "edited": false, "score": 0, "creation_date": 1432142442, "post_id": 30270409, "comment_id": 48804727, "body": "Ah I see. That fixed the error. Now I get a bunch of SWIG errors. Still, forward progress! Thanks."}], "tags": [], "owner": {"reputation": 1051, "user_id": 809410, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a1ffc49c668c0066df3196ecf48aa39f?s=128&d=identicon&r=PG", "display_name": "iant", "link": "https://stackoverflow.com/users/809410/iant"}, "is_accepted": true, "score": 13, "last_activity_date": 1471692354, "last_edit_date": 1471692354, "creation_date": 1431734537, "answer_id": 30270409, "question_id": 30248259, "link": "https://stackoverflow.com/questions/30248259/swig-go-c-source-files-not-allowed-when-not-using-cgo/30270409#30270409", "title": "SWIG + Go: C source files not allowed when not using cgo", "body": "<p>It's a bug.  Sorry.  Add a file that just says</p>\n\n<pre><code>package p\nimport \"C\"\n</code></pre>\n\n<p>and you should get around it.</p>\n"}], "owner": {"reputation": 125, "user_id": 4901681, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/24c1f8af750393a25ea5e550db9a822d?s=128&d=identicon&r=PG&f=1", "display_name": "Evan Hicks", "link": "https://stackoverflow.com/users/4901681/evan-hicks"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5429, "favorite_count": 0, "accepted_answer_id": 30270409, "answer_count": 1, "score": 5, "last_activity_date": 1471692354, "creation_date": 1431641162, "last_edit_date": 1432049761, "question_id": 30248259, "link": "https://stackoverflow.com/questions/30248259/swig-go-c-source-files-not-allowed-when-not-using-cgo", "title": "SWIG + Go: C source files not allowed when not using cgo", "body": "<p>I am trying to wrap this library (<a href=\"https://github.com/lemire/EWAHBoolArray\" rel=\"nofollow\">https://github.com/lemire/EWAHBoolArray</a>) in Go using SWIG, but I'm having a lot of problems since I upgraded to 1.4</p>\n\n<p>I had successfully gotten everything to work using Go 1.3.3 and following the instructions on the SWIG site for SWIG + Go. I had to compile and install the package manually instead of using go build, but everything was working fine.</p>\n\n<p>Now, when I try to run the same program with Go 1.4.2, I get this error:</p>\n\n<pre><code>ewah_usage.go:5:2: C source files not allowed when not using cgo: goewah_gc.c\n</code></pre>\n\n<p>I rebuilt the package using the latest SWIG and the latest Go, and it seems to have installed correctly. But whenever I run a program using the library, I get the above error.</p>\n\n<p>My test program (goewah is the library I built with SWIG)</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"bitbucket.org/evanh/goewah\"\n)\n\nfunc main() {\n    x := goewah.NewEWAHBoolArray()\n    x.Set(1)\n    x.Set(2)\n    fmt.Println(x.Get(1))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 79558, "user_id": 310574, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/270f64e82d870933748c4dbfd01a7c96?s=128&d=identicon&r=PG", "display_name": "Gabe", "link": "https://stackoverflow.com/users/310574/gabe"}, "edited": false, "score": 3, "creation_date": 1431651547, "post_id": 30248237, "comment_id": 48600159, "body": "What&#39;s the problem? 168 seems like a pretty random number to me."}], "answers": [{"tags": [], "owner": {"reputation": 180675, "user_id": 1090562, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/d675b3e6225683ba6432496ec23ed806?s=128&d=identicon&r=PG", "display_name": "Salvador Dali", "link": "https://stackoverflow.com/users/1090562/salvador-dali"}, "is_accepted": true, "score": 10, "last_activity_date": 1431641748, "last_edit_date": 1431641748, "creation_date": 1431641255, "answer_id": 30248271, "question_id": 30248237, "link": "https://stackoverflow.com/questions/30248237/go-random-number-always-return-168/30248271#30248271", "title": "Go Random number always return 168", "body": "<p>You have to specify seed to get different numbers. It is outlined in <a href=\"https://golang.org/pkg/math/rand/\">documentation</a>:</p>\n\n<blockquote>\n  <p>Top-level functions, such as Float64 and Int, use a default shared\n  Source that produces a deterministic sequence of values each time a\n  program is run. Use the Seed function to initialize the default Source\n  if different behavior is required for each run.</p>\n</blockquote>\n\n<p>And some reference about <a href=\"https://golang.org/pkg/math/rand/#Seed\">Seed</a></p>\n\n<blockquote>\n  <p>Seed uses the provided seed value to initialize the default Source to\n  a deterministic state. If Seed is not called, the generator behaves as\n  if seeded by Seed(1).</p>\n</blockquote>\n\n<p>And you can see an example in the go <a href=\"http://golangcookbook.blogspot.com/2012/11/generate-random-number-in-given-range.html\">cookbook</a>:</p>\n\n<p><code>rand.Seed(time.Now().Unix())</code></p>\n\n<p>So wrapping up, you will have something like this:</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"math/rand\"\n    \"time\"\n)\n\nfunc add(x int, y int) int{\n    return x + y\n}\n\n\nfunc main() {\n    rand.Seed(time.Now().Unix())\n    var a int = rand.Intn(100)\n    var b int = rand.Intn(100)\n    fmt.Println(add(a, b))\n}\n</code></pre>\n"}], "owner": {"reputation": 141, "user_id": 4901715, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-2CBZAGEUCGs/AAAAAAAAAAI/AAAAAAAAABE/SLGF5Af6jnU/photo.jpg?sz=128", "display_name": "Brian Douglas", "link": "https://stackoverflow.com/users/4901715/brian-douglas"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 30248271, "answer_count": 1, "score": 5, "last_activity_date": 1431641748, "creation_date": 1431641072, "question_id": 30248237, "link": "https://stackoverflow.com/questions/30248237/go-random-number-always-return-168", "title": "Go Random number always return 168", "body": "<p>I am a complete noob in regards to Go.</p>\n\n<p>I am trying to make a an arbitrary function that returns two random numbers added together.</p>\n\n<p>I have pasted my code below, and cannot figure out why it always returns 168!</p>\n\n<pre><code>package main\n\nimport(\n    \"fmt\"\n    \"math/rand\"\n)\n\nfunc add(x int, y int) int{\n    return x + y\n}\n\nvar a int = rand.Intn(100)\nvar b int = rand.Intn(100)\n\nfunc main() {\n    fmt.Println(add(a, b))\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 51399, "user_id": 1553888, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/01ac05cf8db6f338aef3c2f65e348f5d?s=128&d=identicon&r=PG", "display_name": "u_mulder", "link": "https://stackoverflow.com/users/1553888/u-mulder"}, "edited": false, "score": 0, "creation_date": 1431634892, "post_id": 30246565, "comment_id": 48594224, "body": "And what happens? Or we should imagine?"}, {"owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 2, "creation_date": 1431634980, "post_id": 30246565, "comment_id": 48594270, "body": "possible duplicate of <a href=\"http://stackoverflow.com/questions/13404985/having-trouble-unmarshaling-this-xml\">Having trouble unmarshaling this xml</a>"}, {"owner": {"reputation": 331, "user_id": 1930848, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/4f8a077ba2acd41810c5b3f2368cfaa9?s=128&d=identicon&r=PG&f=1", "display_name": "user1930848", "link": "https://stackoverflow.com/users/1930848/user1930848"}, "edited": false, "score": 0, "creation_date": 1431634980, "post_id": 30246565, "comment_id": 48594271, "body": "I added it as you wrote your comment :)"}, {"owner": {"reputation": 331, "user_id": 1930848, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/4f8a077ba2acd41810c5b3f2368cfaa9?s=128&d=identicon&r=PG&f=1", "display_name": "user1930848", "link": "https://stackoverflow.com/users/1930848/user1930848"}, "reply_to_user": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "edited": false, "score": 0, "creation_date": 1431635241, "post_id": 30246565, "comment_id": 48594410, "body": "@Ainar-G I changed title and desc to Title and Desc but did not help :("}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 2, "creation_date": 1431635314, "post_id": 30246565, "comment_id": 48594456, "body": "There is no &quot;&lt;Query&gt;&quot; in your xml, change to <code>err := xml.Unmarshal(b, &amp;q.Chan)</code> (and check the error). <a href=\"https://play.golang.org/p/v5ZnTyKL5Q\" rel=\"nofollow noreferrer\">play.golang.org/p/v5ZnTyKL5Q</a>"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 3, "creation_date": 1431635460, "post_id": 30246565, "comment_id": 48594535, "body": "BTW: In general, avoid <code>ioutil.ReadAll</code> (and never ignore it&#39;s error!) and instead use things <code>xml.NewDecoder</code> that can decode from any <code>io.Reader</code> while reading the data."}, {"owner": {"reputation": 331, "user_id": 1930848, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/4f8a077ba2acd41810c5b3f2368cfaa9?s=128&d=identicon&r=PG&f=1", "display_name": "user1930848", "link": "https://stackoverflow.com/users/1930848/user1930848"}, "edited": false, "score": 0, "creation_date": 1431635559, "post_id": 30246565, "comment_id": 48594583, "body": "Thant was it :) No Query, thanks :D"}], "answers": [{"tags": [], "owner": {"reputation": 27854, "user_id": 1892060, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e50f7bd50bf166113e2fbcf94eb9ab76?s=128&d=identicon&r=PG", "display_name": "Ainar-G", "link": "https://stackoverflow.com/users/1892060/ainar-g"}, "is_accepted": true, "score": 4, "last_activity_date": 1431635625, "creation_date": 1431635625, "answer_id": 30246830, "question_id": 30246565, "link": "https://stackoverflow.com/questions/30246565/reading-xml-with-golang/30246830#30246830", "title": "Reading XML with golang", "body": "<p>Other packages, including <code>encoding/json</code> and <code>encoding/xml</code> can only see exported data. So firstly your <code>title</code> and <code>desc</code> should be <code>Title</code> and <code>Desc</code> correspondingly.</p>\n\n<p>Secondly, you're using <code>%d</code> (integer) format in <code>Sprintf</code> when printing a string. That's why you're getting <code>%!d(string=)</code>, which means \"it's not an integer, it's a string!\".</p>\n\n<p>Thirdly, there is no query in your XML, so unmarshal directly into <code>q.Chan</code>.</p>\n\n<p>This is the working example. <a href=\"http://play.golang.org/p/l0ImL2ID-j\" rel=\"nofollow\">http://play.golang.org/p/l0ImL2ID-j</a></p>\n"}], "owner": {"reputation": 331, "user_id": 1930848, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/4f8a077ba2acd41810c5b3f2368cfaa9?s=128&d=identicon&r=PG&f=1", "display_name": "user1930848", "link": "https://stackoverflow.com/users/1930848/user1930848"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5718, "favorite_count": 0, "accepted_answer_id": 30246830, "answer_count": 1, "score": 4, "last_activity_date": 1431635644, "creation_date": 1431634642, "last_edit_date": 1431634937, "question_id": 30246565, "link": "https://stackoverflow.com/questions/30246565/reading-xml-with-golang", "title": "Reading XML with golang", "body": "<p>I'm trying to read som XML with golang. I'm basing it on this example which works. <a href=\"https://gist.github.com/kwmt/6135123#file-parsetvdb-go\" rel=\"noreferrer\">https://gist.github.com/kwmt/6135123#file-parsetvdb-go</a></p>\n\n<p>This is my files:</p>\n\n<p>Castle0.xml</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\" ?&gt;\n&lt;Channel&gt;\n&lt;Title&gt;test&lt;/Title&gt;\n&lt;Description&gt;this is a test&lt;/Description&gt;\n&lt;/Channel&gt;\n</code></pre>\n\n<p>test.go</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/xml\"\n    \"fmt\"\n    \"io/ioutil\"\n    \"os\"\n)\n\ntype Query struct {\n    Chan Channel `xml:\"Channel\"`\n}\n\ntype Channel struct {\n    title    string `xml:\"Title\"`\n    desc string `xml:\"Description\"`\n}\n\n\nfunc (s Channel) String() string {\n    return fmt.Sprintf(\"%s - %d\", s.title, s.desc)\n}\n\nfunc main() {\n    xmlFile, err := os.Open(\"Castle0.xml\")\n    if err != nil {\n        fmt.Println(\"Error opening file:\", err)\n        return\n    }\n    defer xmlFile.Close()\n\n    b, _ := ioutil.ReadAll(xmlFile)\n\n    var q Query\n    xml.Unmarshal(b, &amp;q)\n\n    fmt.Println(q.Chan)\n\n}\n</code></pre>\n\n<p>Output:\n - %!d(string=)</p>\n\n<p>Any one know what I'm doing wrong? (I'm doing this to learn go, so go easy on me :P)</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431628645, "post_id": 30244721, "comment_id": 48590590, "body": "<a href=\"https://godoc.org/github.com/garyburd/redigo/redis#Pool\" rel=\"nofollow noreferrer\">The API documentation</a> also has an example where the <code>Dial</code> function does the AUTH call as well."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "reply_to_user": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431628958, "post_id": 30244721, "comment_id": 48590767, "body": "@DaveC: forgot about that, I&#39;ll put it in."}], "tags": [], "owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "is_accepted": false, "score": 4, "last_activity_date": 1431629557, "last_edit_date": 1431629557, "creation_date": 1431628365, "answer_id": 30244721, "question_id": 30244080, "link": "https://stackoverflow.com/questions/30244080/sharing-redis-settings-across-routes/30244721#30244721", "title": "Sharing Redis settings across routes", "body": "<p>First, only use var for declaring variables. You can't run code outside of functions, so there's no use in trying to create connections inside a var statement. Use <code>init()</code> if you need something run at startup.</p>\n\n<p>The redis connections can't be used with concurrent requests. If you want to share a redis connection across multiple routes, you need to have a safe method for concurrent use. In the case of <code>github.com/garyburd/redigo/redis</code> you want to use a <code>Pool</code>. You can do the <code>AUTH</code> call inside the Dial function, returning a ready connection each time.</p>\n\n<pre><code>var redisPool *redis.Pool\n\nfunc init() {\n    redisPool = &amp;redis.Pool{\n        MaxIdle:     3,\n        IdleTimeout: 240 * time.Second,\n        Dial: func() (redis.Conn, error) {\n            c, err := redis.Dial(\"tcp\", server)\n            if err != nil {\n                return nil, err\n            }\n            if _, err := c.Do(\"AUTH\", password); err != nil {\n                c.Close()\n                return nil, err\n            }\n            return c, err\n        },\n    }\n}\n</code></pre>\n\n<p>Then each time you need a connection, you get one from the pool, and return it when you're done.</p>\n\n<pre><code>conn := redisPool.Get()\n// conn.Close() just returns the connection to the pool\ndefer conn.Close()\n\nif err := conn.Err(); err != nil {\n    // conn.Err() will have connection or Dial related errors\n    return nil, err\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 929, "user_id": 8109026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Jomoj.jpg?s=128&g=1", "display_name": "Raed Shomali", "link": "https://stackoverflow.com/users/8109026/raed-shomali"}, "is_accepted": false, "score": 0, "last_activity_date": 1498184173, "creation_date": 1498184173, "answer_id": 44712037, "question_id": 30244080, "link": "https://stackoverflow.com/questions/30244080/sharing-redis-settings-across-routes/44712037#44712037", "title": "Sharing Redis settings across routes", "body": "<p>What I would do is instantiate a connection pool in <code>main.go</code> and pass the reference to the pool to your routes. This way you are setting up your redis client once, and your routes can leverage it.</p>\n\n<p>I created a decorator around <code>redigo</code> that makes creating a Redis Client with a Connection pool very straightforward. Plus it is type-safe.\nYou can check it out here: <a href=\"https://github.com/shomali11/xredis\" rel=\"nofollow noreferrer\">https://github.com/shomali11/xredis</a></p>\n"}], "owner": {"reputation": 9071, "user_id": 1003632, "user_type": "registered", "accept_rate": 60, "profile_image": "https://www.gravatar.com/avatar/80a7f76fb4682911dc2f56d7cf491454?s=128&d=identicon&r=PG", "display_name": "tommyd456", "link": "https://stackoverflow.com/users/1003632/tommyd456"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 265, "favorite_count": 0, "answer_count": 2, "score": 2, "last_activity_date": 1498184173, "creation_date": 1431626093, "question_id": 30244080, "link": "https://stackoverflow.com/questions/30244080/sharing-redis-settings-across-routes", "title": "Sharing Redis settings across routes", "body": "<p>I have a number of routes in my <code>routes.go</code> file and they all call my redis database. I'm wondering how I can avoid calling the <code>dial</code> and <code>AUTH</code> calls in every route.</p>\n\n<p>I've tried setting variables outside the functions like this:</p>\n\n<pre><code>var (\n  c, err = redis.Dial(\"tcp\", ADDRESS)\n  _, err = c.Do(\"AUTH\", \"testing\")\n)\n</code></pre>\n\n<p>but then the compiler doesn't like <code>err</code> being used twice.</p>\n"}, {"tags": ["go", "hashmap"], "comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431627911, "post_id": 30243581, "comment_id": 48590138, "body": "The code you quote in the question is not like the code you linked to. In particular, here you <code>make</code> the <code>map[string]map[string][]Struct</code> but in the linked code you do not (as the other <a href=\"https://stackoverflow.com/users/2082673/dave\">dave</a> points out in <a href=\"http://stackoverflow.com/a/30243706/55504\">his answer</a>). Such differences make questions confusing and difficult to answer."}], "answers": [{"tags": [], "owner": {"reputation": 49343, "user_id": 2082673, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/gmyMb.jpg?s=128&g=1", "display_name": "dave", "link": "https://stackoverflow.com/users/2082673/dave"}, "is_accepted": true, "score": 2, "last_activity_date": 1431624845, "creation_date": 1431624845, "answer_id": 30243706, "question_id": 30243581, "link": "https://stackoverflow.com/questions/30243581/map-of-map-of-structs-and-assignment-to-entry-in-nil-map/30243706#30243706", "title": "map of map of structs and &quot;assignment to entry in nil map&quot;", "body": "<p>You never did <code>make</code> on your <code>allEntries</code> map:</p>\n\n<pre><code>allEntries = make(map[string]map[string][]Thing)\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/ecdUU30FQT\" rel=\"nofollow\">https://play.golang.org/p/ecdUU30FQT</a></p>\n"}], "owner": {"reputation": 6027, "user_id": 205832, "user_type": "registered", "accept_rate": 55, "profile_image": "https://www.gravatar.com/avatar/23c6d359b6f7af3d3f91ca9e17b804b3?s=128&d=identicon&r=PG", "display_name": "Peter Bengtsson", "link": "https://stackoverflow.com/users/205832/peter-bengtsson"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2366, "favorite_count": 0, "accepted_answer_id": 30243706, "answer_count": 1, "score": 2, "last_activity_date": 1431624845, "creation_date": 1431624466, "question_id": 30243581, "link": "https://stackoverflow.com/questions/30243581/map-of-map-of-structs-and-assignment-to-entry-in-nil-map", "title": "map of map of structs and &quot;assignment to entry in nil map&quot;", "body": "<p>Here's an example where I get <code>assignment to entry in nil map</code> every time:\n<a href=\"https://play.golang.org/p/LudJs0rVbs\" rel=\"nofollow\">https://play.golang.org/p/LudJs0rVbs</a></p>\n\n<p>To demonstrate what I'm trying to do, here's a naive version that causes 2 lookups to the database (you'll have to use your imagination on line 11):\n<a href=\"https://play.golang.org/p/YZNFeMHyMs\" rel=\"nofollow\">https://play.golang.org/p/YZNFeMHyMs</a></p>\n\n<p>Basically, I'm trying to do this:</p>\n\n<pre><code>things := make(map[string]map[string][]Struct)\n...\nstuff, there := things[\"first key\"]\nif !there {\n    things[\"first key\"] = getAMapOfStringToStructs()\n}\ndoSomethingWith(things[\"first key\"])\n</code></pre>\n\n<p>I've looked at the more <a href=\"https://blog.golang.org/go-maps-in-action\" rel=\"nofollow\">trivial examples of maps-of-maps here</a> but I can't seem to map that to my problem.  </p>\n"}, {"tags": ["c", "import", "go", "cgo"], "comments": [{"owner": {"reputation": 13903, "user_id": 86388, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/cPl84.jpg?s=128&g=1", "display_name": "Tarion", "link": "https://stackoverflow.com/users/86388/tarion"}, "edited": false, "score": 0, "creation_date": 1477491117, "post_id": 30242905, "comment_id": 67789609, "body": "How to build this code with go build instead of go install?"}], "answers": [{"tags": [], "owner": {"reputation": 24556, "user_id": 110358, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/13c7ad63eb27047a7ff869d27e40c1ad?s=128&d=identicon&r=PG", "display_name": "Jacob Marble", "link": "https://stackoverflow.com/users/110358/jacob-marble"}, "is_accepted": true, "score": 6, "last_activity_date": 1431622361, "creation_date": 1431622361, "answer_id": 30242906, "question_id": 30242905, "link": "https://stackoverflow.com/questions/30242905/how-to-use-external-c-files-with-cgo/30242906#30242906", "title": "How to use external .c files with CGO?", "body": "<p>The C header file foo.h is missing:</p>\n\n<pre><code>// foo.h\nint fortythree();\n</code></pre>\n\n<p>Reference the header file from Go like this:</p>\n\n<pre><code>// foo.go\npackage main\n\n/*\n#include \"foo.h\"\n\nint fortytwo() {\n    return 42;\n}\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"forty-two == %d\\n\", C.fortytwo())\n    fmt.Printf(\"forty-three == %d\\n\", C.fortythree())\n}\n</code></pre>\n\n<p>Behold, the power of foo.h:</p>\n\n<pre><code>$ go install\n$ foo\nforty-two == 42\nforty-three == 43\n</code></pre>\n"}], "owner": {"reputation": 24556, "user_id": 110358, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/13c7ad63eb27047a7ff869d27e40c1ad?s=128&d=identicon&r=PG", "display_name": "Jacob Marble", "link": "https://stackoverflow.com/users/110358/jacob-marble"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1953, "favorite_count": 0, "accepted_answer_id": 30242906, "answer_count": 1, "score": 3, "last_activity_date": 1431622662, "creation_date": 1431622361, "last_edit_date": 1431622662, "question_id": 30242905, "link": "https://stackoverflow.com/questions/30242905/how-to-use-external-c-files-with-cgo", "title": "How to use external .c files with CGO?", "body": "<p>To write some C code in a comment above <code>import \"C\"</code> is straightforward:</p>\n\n<pre><code>// foo.go\npackage main\n\n/*\nint fortytwo() {\n    return 42;\n}\n*/\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    fmt.Printf(\"forty-two == %d\\n\", C.fortytwo())\n    fmt.Printf(\"forty-three == %d\\n\", C.fortythree())\n}\n</code></pre>\n\n<p>And it works fine:</p>\n\n<pre><code>$ go install\n$ foo\nforty-two == 42\n</code></pre>\n\n<p>However, C code in it's own .c file:</p>\n\n<pre><code>// foo.c\nint fortythree() {\n  return 43;\n}\n</code></pre>\n\n<p>...referenced from Go:</p>\n\n<pre><code>// foo.go\nfunc main() {\n    fmt.Printf(\"forty-two == %d\\n\", C.fortytwo())\n    fmt.Printf(\"forty-three == %d\\n\", C.fortythree())\n}\n</code></pre>\n\n<p>...does not work:</p>\n\n<pre><code>$ go install\n# foo\ncould not determine kind of name for C.fortythree\n</code></pre>\n"}, {"tags": ["go", "docker"], "answers": [{"tags": [], "owner": {"reputation": 17136, "user_id": 1169435, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/wsvfb.jpg?s=128&g=1", "display_name": "ISanych", "link": "https://stackoverflow.com/users/1169435/isanych"}, "is_accepted": true, "score": 1, "last_activity_date": 1431622576, "creation_date": 1431622576, "answer_id": 30242989, "question_id": 30242719, "link": "https://stackoverflow.com/questions/30242719/building-docker-within-docker-for-go-program/30242989#30242989", "title": "Building Docker within Docker for Go program", "body": "<p>You've produced docker image, but as you haven't specified tag for it is accessible only by hash (d91a908ee663). It is better to specify tag: <code>docker build -t mygoprog .</code> And if you will try to run your image without additional setting it will fail because there is no docker inside of it. Easiest solution here to give access to your docker daemon from container:</p>\n\n<pre><code>docker run -v /var/run/docker.sock:/var/run/docker.sock -v /usr/bin/docker:/usr/bin/docker mygoprog\n</code></pre>\n\n<p>Docker location could be different in your distro, you also may need <code>--privileged</code> flag.</p>\n"}], "owner": {"reputation": 8438, "user_id": 675066, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/46d4ff5b7ae7894733f30d34e865de4e?s=128&d=identicon&r=PG", "display_name": "Greg", "link": "https://stackoverflow.com/users/675066/greg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 120, "favorite_count": 0, "accepted_answer_id": 30242989, "answer_count": 1, "score": 1, "last_activity_date": 1431622576, "creation_date": 1431621756, "question_id": 30242719, "link": "https://stackoverflow.com/questions/30242719/building-docker-within-docker-for-go-program", "title": "Building Docker within Docker for Go program", "body": "<p>I'm trying to build a very small Docker container for a Go program.  To do that I'm hoping to use a Docker container to build the Go program then (within the container) build another Docker container to run the program.</p>\n\n<p>Here's my build Dockerfile:</p>\n\n<pre><code>FROM google/golang\nWORKDIR /gopath/src/mycompany/mygoprog\n\n# Build the Contributors application\nRUN mkdir -p /gopath/src/mycompany/mygoprog\nADD ./src/* /gopath/src/mycompany/mygoprog/\nRUN CGO_ENABLED=0 GOOS=linux go build -a -tags rs -ldflags '-w' /gopath/src/mycompany/mygoprog/*.go\nRUN cp mygoprog /mygoprog\nCMD docker build -t foobar /gopath/src/mycompany/mygoprog\n</code></pre>\n\n<p>My source directory has my Go program (trivial--compiles/runs) and this Dockerfile for the final product:</p>\n\n<pre><code>FROM scratch\nADD /mygoprog mygoprog\nENTRYPOINT [\"/mygoprog\"]\nEXPOSE 9100\n</code></pre>\n\n<p>These files are organized thusly:</p>\n\n<pre><code>/myproject\n   Dockerfile\n   /src\n      Dockerfile\n      mygoprog.go\n</code></pre>\n\n<p>To launch the build I go to the top directory and run:</p>\n\n<pre><code>docker build .\n</code></pre>\n\n<p>This runs without errors....and no final image! Output looks like this:</p>\n\n<pre><code>bash-3.2$ docker build .\nSending build context to Docker daemon 6.656 kB\nSending build context to Docker daemon \nStep 0 : FROM google/golang\n ---&gt; 3cc1d7ae0e9c\nStep 1 : WORKDIR /gopath/src/mycompany/mygoprog\n ---&gt; Using cache\n ---&gt; 49b9686dcbed\nStep 2 : RUN mkdir -p /gopath/src/mycompany/mygoprog\n ---&gt; Using cache\n ---&gt; 0d0139bb8cae\nStep 3 : ADD ./src/* /gopath/src/mycompany/mygoprog/\n ---&gt; 964ea5ca6afb\nRemoving intermediate container e57719a417d5\nStep 4 : RUN CGO_ENABLED=0 GOOS=linux go build -a -tags rs -ldflags '-w' /gopath/src/mycompany/mygoprog/*.go\n ---&gt; Running in 608ad65db52c\n ---&gt; 6e91f06b7654\nRemoving intermediate container 608ad65db52c\nStep 5 : RUN cp mygoprog /mygoprog\n ---&gt; Running in 196af3db881b\n ---&gt; 5e90e11ffc7d\nRemoving intermediate container 196af3db881b\nStep 6 : CMD docker build -t foobar /gopath/src/mycompany/mygoprog\n ---&gt; Running in 4794354abf2b\n ---&gt; d91a908ee663\nRemoving intermediate container 4794354abf2b\nSuccessfully built d91a908ee663\n</code></pre>\n\n<p>What am I missing so I get a final, runnable Docker with my compiled program inside?</p>\n"}, {"tags": ["arrays", "go", "slice", "partitioning", "generic-programming"], "answers": [{"tags": [], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "is_accepted": true, "score": 6, "last_activity_date": 1431622641, "last_edit_date": 1431622641, "creation_date": 1431621429, "answer_id": 30242620, "question_id": 30242567, "link": "https://stackoverflow.com/questions/30242567/in-go-how-can-i-partition-a-slice-array-string-of-any-type/30242620#30242620", "title": "In Go, how can I partition a slice/array/string of any type?", "body": "<p>The <a href=\"https://github.com/meirf/gopart/\" rel=\"nofollow\">gopart</a> library addresses this. It allows partitioning of anything indexable in Go that has any type.</p>\n\n<pre><code>for idxRange := range gopart.Partition(len(bigList), partitionSize) {\n        bulkOperation(bigList[idxRange.Low:idxRange.High])\n}\n</code></pre>\n\n<p><a href=\"http://play.golang.org/p/WlVPpejxFV\" rel=\"nofollow\">Full Executable Example</a></p>\n"}, {"comments": [{"owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "edited": false, "score": 0, "creation_date": 1551893331, "post_id": 55028726, "comment_id": 96810554, "body": "Please describe in what way this solution has better performance so I can select it as the preferred answer."}, {"owner": {"reputation": 2301, "user_id": 1168212, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oayHK.jpg?s=128&g=1", "display_name": "Alex Yu", "link": "https://stackoverflow.com/users/1168212/alex-yu"}, "edited": false, "score": 0, "creation_date": 1551893395, "post_id": 55028726, "comment_id": 96810599, "body": "Welcome to StackOverflow! Can you explain in few words what exactly you did? It would be better with excerpts of your code"}], "tags": [], "owner": {"reputation": 31, "user_id": 9105629, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-56tR8LKT45A/AAAAAAAAAAI/AAAAAAAAAA0/Rr10yiHLES4/photo.jpg?sz=128", "display_name": "Patrick Vollebregt", "link": "https://stackoverflow.com/users/9105629/patrick-vollebregt"}, "is_accepted": false, "score": 0, "last_activity_date": 1551908682, "last_edit_date": 1551908682, "creation_date": 1551892571, "answer_id": 55028726, "question_id": 30242567, "link": "https://stackoverflow.com/questions/30242567/in-go-how-can-i-partition-a-slice-array-string-of-any-type/55028726#55028726", "title": "In Go, how can I partition a slice/array/string of any type?", "body": "<p>I found this question and answer because I needed the same solution, before I created something that already exists. </p>\n\n<p>I did, however, not like the performance of the solution, so I created a package with a faster and more flexible implementation. </p>\n\n<p>To improve the speed, instead of using channels I used a function that is passed to the function as a callback for the results. I also added implementations using slices and an interface, as well as a channel one to compare the performance of all those methods and give users the flexibility to use the method they require. </p>\n\n<p>To prevent others also need to create their own implementation I made it publicly available at the following url: <a href=\"https://github.com/crosscode-nl/partition\" rel=\"nofollow noreferrer\">https://github.com/crosscode-nl/partition</a></p>\n\n<p>According a benchmark of the code shows that the channel based solution is slower than the func version. </p>\n\n<pre><code>BenchmarkToChan100-4           50000         25862 ns/op\nBenchmarkToChan10-4           300000          4939 ns/op\nBenchmarkToChan0-4            500000          2727 ns/op\nBenchmarkToFunc100-4         5000000           230 ns/op\nBenchmarkToFunc10-4         30000000            46.5 ns/op\nBenchmarkToFunc0-4          100000000           14.6 ns/op\n</code></pre>\n\n<p>Example usage: </p>\n\n<pre><code>a := []int{1, 2, 3, 4, 5, 6, 7, 8, 9}\npartition.ToFunc(len(a), 5, func(l int, h int) {\n    fmt.Printf(\"Part: %v\\n\", a[l:h])\n})\n// Output:\n// Part: [1 2 3 4 5]\n// Part: [6 7 8 9]\n</code></pre>\n\n<p>See benchmarks in repo for details.</p>\n"}], "owner": {"reputation": 1769, "user_id": 1168364, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/9194e00c831d0004fe49a84879ecea95?s=128&d=identicon&r=PG&f=1", "display_name": "lf215", "link": "https://stackoverflow.com/users/1168364/lf215"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3145, "favorite_count": 0, "accepted_answer_id": 30242620, "answer_count": 2, "score": 3, "last_activity_date": 1551908682, "creation_date": 1431621264, "last_edit_date": 1431622114, "question_id": 30242567, "link": "https://stackoverflow.com/questions/30242567/in-go-how-can-i-partition-a-slice-array-string-of-any-type", "title": "In Go, how can I partition a slice/array/string of any type?", "body": "<p>Guava has a <a href=\"http://docs.guava-libraries.googlecode.com/git/javadoc/com/google/common/collect/Lists.html#partition(java.util.List,%20int)\" rel=\"nofollow\">generic partition method</a> which can not directly be implemented in Go due to Go's lack of generics. Is there a workaround for this?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 4848307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7e7231eedbb435d1e9ffe8939722ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Timoteo", "link": "https://stackoverflow.com/users/4848307/timoteo"}, "edited": false, "score": 0, "creation_date": 1431616280, "post_id": 30240675, "comment_id": 48583101, "body": "wow! works great! I&#39;m going to try the other option also. There is no way to reset range? Because this is more academic exercise! Thank you some much it works great! Where i can find more documentation about Loop? thanks again!"}, {"owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "reply_to_user": {"reputation": 59, "user_id": 4848307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7e7231eedbb435d1e9ffe8939722ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Timoteo", "link": "https://stackoverflow.com/users/4848307/timoteo"}, "edited": false, "score": 0, "creation_date": 1431618610, "post_id": 30240675, "comment_id": 48584626, "body": "&quot;Loop&quot; here is just a label. It could be anything. The key is <code>continue</code>. See the section &quot;Switch&quot; in Effective Go (<a href=\"http://golang.org/doc/effective_go.html\" rel=\"nofollow noreferrer\">golang.org/doc/effective_go.html</a>). Also the <code>continue</code> documentation in the Go spec (<a href=\"http://golang.org/ref/spec#Continue_statements\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Continue_statements</a>). No, <code>range</code> can&#39;t be reset. You can <code>range</code> over a channel, and it&#39;s not possible to reset that."}, {"owner": {"reputation": 59, "user_id": 4848307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7e7231eedbb435d1e9ffe8939722ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Timoteo", "link": "https://stackoverflow.com/users/4848307/timoteo"}, "edited": false, "score": 0, "creation_date": 1431619193, "post_id": 30240675, "comment_id": 48585018, "body": "&quot;range can&#39;t be reset. You can range over a channel, and it&#39;s not possible to reset that.&quot; Great that makes sense and now I understand why! thank you some much for your time!"}], "tags": [], "owner": {"reputation": 249309, "user_id": 97337, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/ed9a0d8cd44b62539b141f6c10405db1?s=128&d=identicon&r=PG", "display_name": "Rob Napier", "link": "https://stackoverflow.com/users/97337/rob-napier"}, "is_accepted": false, "score": 3, "last_activity_date": 1431615790, "creation_date": 1431615790, "answer_id": 30240675, "question_id": 30240439, "link": "https://stackoverflow.com/questions/30240439/golang-for-loop-with-range-condition-to-restart/30240675#30240675", "title": "Golang: for loop with range condition to restart", "body": "<p>Wrap it in another <code>for</code>:</p>\n\n<pre><code>Loop:\n    for {\n        for _, client := range list.clients {\n            if client.name == name {\n                connection.Write([]byte(\"Name already exists please try another one:\\n\"))\n                bytesRead, _ := connection.Read(reply)\n                name = string(reply[0:bytesRead])\n                name = strings.TrimSuffix(name, \"\\n\")\n                continue Loop // Start over\n            }\n        }\n        break // Got through it; we're done\n    }\n</code></pre>\n\n<p>You can also just reset your index. <code>range</code> may be the wrong tool here:</p>\n\n<pre><code>for i := 0; i &lt; len(list.clients); i++ {\n    client := list.clients[i]\n    if client.name == name {\n        connection.Write([]byte(\"Name already exists please try another one:\\n\"))\n        bytesRead, _ := connection.Read(reply)\n        name = string(reply[0:bytesRead])\n        name = strings.TrimSuffix(name, \"\\n\")\n        i = -1 // Start again\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 59, "user_id": 4848307, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b7e7231eedbb435d1e9ffe8939722ebe?s=128&d=identicon&r=PG&f=1", "display_name": "Timoteo", "link": "https://stackoverflow.com/users/4848307/timoteo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 5712, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1431615790, "creation_date": 1431615109, "question_id": 30240439, "link": "https://stackoverflow.com/questions/30240439/golang-for-loop-with-range-condition-to-restart", "title": "Golang: for loop with range condition to restart", "body": "<p>I'm trying to make this loop restart every time a name is already in the list, this code is obviously only going to check this once. Is there any way to make the loop restart from beginning? Thanks!  </p>\n\n<pre><code>for _, client := range list.clients {\n//for i := 0; i &lt; len(list.clients); i++ {\n    if(client.name==name){\n        connection.Write([]byte(\"Name already exists please try another one:\\n\"))\n        bytesRead, _ := connection.Read(reply)\n            name = string(reply[0:bytesRead])\n        name = strings.TrimSuffix(name, \"\\n\")\n\n    }\n}\n</code></pre>\n"}, {"tags": ["go", "godoc"], "owner": {"reputation": 186, "user_id": 4846435, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-AQQye2-d0e4/AAAAAAAAAAI/AAAAAAAABig/uprMuwHLDjA/photo.jpg?sz=128", "display_name": "Alan Conway", "link": "https://stackoverflow.com/users/4846435/alan-conway"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 178, "favorite_count": 1, "answer_count": 0, "score": 1, "last_activity_date": 1431611185, "creation_date": 1431611185, "question_id": 30239030, "link": "https://stackoverflow.com/questions/30239030/controlling-what-godoc-documents-in-a-repo-that-is-not-just-go-packages", "title": "Controlling what godoc documents in a repo that is not just Go packages", "body": "<p>I have a Go sub-project in a multi-language project repo. I want to be able to use 'go get' and 'go doc'.</p>\n\n<p>My layout looks like:</p>\n\n<pre><code>proton-c/bindings/go/&lt;my packages&gt;\nexamples/go/&lt;some go examples&gt;\n</code></pre>\n\n<p>I set up go-import  tags on the website and created a \"go\" symlink in the repo root so I can <code>go get qpid.apache.org/proton/go/&lt;package&gt;</code>. It works!! It clones the entire project repo into my GOPATH but that's ok.</p>\n\n<p>The problem is if I run godoc -http it does the following bad things:</p>\n\n<ul>\n<li>ignores the root \"go\" symlink entirely</li>\n<li>documents my packages as \"qpid.apache.org/proton/proton-c/bindings/go/\"</li>\n<li>shows the package path to the directory with nothing in it.</li>\n</ul>\n\n<p>The command line \"godoc qpid.apache.org/proton/go/package\" DOES do the right thing so godoc can extract the doc correctly but the \"directory browsing\" feature of godoc -http is picking up too much and not following the symlink.\nSo can I restrict/control what godoc picks as documentation?</p>\n\n<p>I read <a href=\"https://github.com/golang/gddo/wiki/Source-Code-Links\" rel=\"nofollow\">https://github.com/golang/gddo/wiki/Source-Code-Links</a>, but I don't think it helps my problem, could be wrong.</p>\n"}, {"tags": ["mysql", "go"], "answers": [{"comments": [{"owner": {"reputation": 1027, "user_id": 587208, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/49e98c4a13a5203ecff5d2d0774f8991?s=128&d=identicon&r=PG", "display_name": "mlangenberg", "link": "https://stackoverflow.com/users/587208/mlangenberg"}, "edited": false, "score": 2, "creation_date": 1470513073, "post_id": 30236596, "comment_id": 64984570, "body": "<code>database&#47;sql</code> maintains a connection pool. I&#39;ve seen &quot;Error 1046: No database selected&quot; pop up when the a new connection is made. Is there a way to run <code>db.Exec(&quot;USE &quot;+name)</code> automatically after <code>database&#47;sql</code> opens a new connection?"}, {"owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "reply_to_user": {"reputation": 1027, "user_id": 587208, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/49e98c4a13a5203ecff5d2d0774f8991?s=128&d=identicon&r=PG", "display_name": "mlangenberg", "link": "https://stackoverflow.com/users/587208/mlangenberg"}, "edited": false, "score": 0, "creation_date": 1470553323, "post_id": 30236596, "comment_id": 64991155, "body": "Yes sure ... just put the database name in the connection string: &quot;user:password@tcp(hostname:port)/dbname&quot;"}, {"owner": {"reputation": 1027, "user_id": 587208, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/49e98c4a13a5203ecff5d2d0774f8991?s=128&d=identicon&r=PG", "display_name": "mlangenberg", "link": "https://stackoverflow.com/users/587208/mlangenberg"}, "edited": false, "score": 1, "creation_date": 1470755605, "post_id": 30236596, "comment_id": 65073195, "body": "Ah, so first <code>sql.Open(...)</code> without database name and run <code>db.Exec(&quot;CREATE DATABASE IF NOT EXISTS &quot; + name)</code>. Then close the connection, <code>sql.Open(...&#47;name)</code> <i>with</i> the database name to create a database and use it safely with the pool."}, {"owner": {"reputation": 1183, "user_id": 1816631, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/29ced07f3e8c91fca396d867bda0b7da?s=128&d=identicon&r=PG", "display_name": "Gorm Casper", "link": "https://stackoverflow.com/users/1816631/gorm-casper"}, "edited": false, "score": 3, "creation_date": 1504118830, "post_id": 30236596, "comment_id": 78894476, "body": "Honest quention: Isn&#39;t this a textbook example on how to open yourself up for sql injection? Is there no way to make this work using the placeholder parameters?"}], "tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 33, "last_activity_date": 1431604471, "last_edit_date": 1431604471, "creation_date": 1431604087, "answer_id": 30236596, "question_id": 30235031, "link": "https://stackoverflow.com/questions/30235031/how-to-create-a-new-mysql-database-with-go-sql-driver/30236596#30236596", "title": "How to create a new MySQL database with go-sql-driver", "body": "<p>You can perfectly use the go-sql-driver. However, you need to use a mysql user which has the proper access rights to create new databases.</p>\n\n<p>Here is an example:</p>\n\n<pre><code>func create(name string) {\n\n   db, err := sql.Open(\"mysql\", \"admin:admin@tcp(127.0.0.1:3306)/\")\n   if err != nil {\n       panic(err)\n   }\n   defer db.Close()\n\n   _,err = db.Exec(\"CREATE DATABASE \"+name)\n   if err != nil {\n       panic(err)\n   }\n\n   _,err = db.Exec(\"USE \"+name)\n   if err != nil {\n       panic(err)\n   }\n\n   _,err = db.Exec(\"CREATE TABLE example ( id integer, data varchar(32) )\")\n   if err != nil {\n       panic(err)\n   }\n}\n</code></pre>\n\n<p>Note that the database name is not provided in the connection string. We just create the database after the connection (CREATE DATABASE command), and switch the connection to use it (USE command).</p>\n\n<p>Note: the VividCortex guys maintain a nice database/sql tutorial and documentation at <a href=\"http://go-database-sql.org/index.html\" rel=\"noreferrer\">http://go-database-sql.org/index.html</a></p>\n"}, {"comments": [{"owner": {"reputation": 50646, "user_id": 99923, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/211755e2897f699737d63f5e2ecf5b07?s=128&d=identicon&r=PG", "display_name": "Xeoncross", "link": "https://stackoverflow.com/users/99923/xeoncross"}, "edited": false, "score": 6, "creation_date": 1477586229, "post_id": 38854717, "comment_id": 67838104, "body": "The <code>return db</code> will be closed since you called <code>defer db.Close()</code>."}], "tags": [], "owner": {"reputation": 1027, "user_id": 587208, "user_type": "registered", "accept_rate": 14, "profile_image": "https://www.gravatar.com/avatar/49e98c4a13a5203ecff5d2d0774f8991?s=128&d=identicon&r=PG", "display_name": "mlangenberg", "link": "https://stackoverflow.com/users/587208/mlangenberg"}, "is_accepted": false, "score": 7, "last_activity_date": 1470756197, "creation_date": 1470756197, "answer_id": 38854717, "question_id": 30235031, "link": "https://stackoverflow.com/questions/30235031/how-to-create-a-new-mysql-database-with-go-sql-driver/38854717#38854717", "title": "How to create a new MySQL database with go-sql-driver", "body": "<p>If you want to create a new database if it does not exist, and use it directly in your program, be aware that <code>database/sql</code> maintains a connection pool.</p>\n\n<p>Therefore the opened database connection, should preferably contain the database name. I've seen <code>\"Error 1046: No database selected\"</code> when <code>database/sql</code> opens a new connection after using <code>db.Exec(\"USE \"+name)</code> manually.</p>\n\n<pre><code>func createAndOpen(name string) *sql.DB {\n\n   db, err := sql.Open(\"mysql\", \"admin:admin@tcp(127.0.0.1:3306)/\")\n   if err != nil {\n       panic(err)\n   }\n   defer db.Close()\n\n   _,err = db.Exec(\"CREATE DATABASE IF NOT EXISTS \"+name)\n   if err != nil {\n       panic(err)\n   }\n   db.Close()\n\n   db, err = sql.Open(\"mysql\", \"admin:admin@tcp(127.0.0.1:3306)/\" + name)\n   if err != nil {\n       panic(err)\n   }\n   defer db.Close()\n   return db\n}\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 1232, "user_id": 2148252, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/cskx2.png?s=128&g=1", "display_name": "Roshan", "link": "https://stackoverflow.com/users/2148252/roshan"}, "edited": false, "score": 0, "creation_date": 1616684609, "post_id": 63774620, "comment_id": 118085473, "body": "not sure if this will work, because gorm won&#39;t be able establish any connection in the first place."}], "tags": [], "owner": {"reputation": 199, "user_id": 10143018, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-YV7bColRMX0/AAAAAAAAAAI/AAAAAAAAALc/DOT43nCSGVg/photo.jpg?sz=128", "display_name": "Suz&#39;l Shrestha", "link": "https://stackoverflow.com/users/10143018/suzl-shrestha"}, "is_accepted": false, "score": 1, "last_activity_date": 1607937099, "last_edit_date": 1607937099, "creation_date": 1599469970, "answer_id": 63774620, "question_id": 30235031, "link": "https://stackoverflow.com/questions/30235031/how-to-create-a-new-mysql-database-with-go-sql-driver/63774620#63774620", "title": "How to create a new MySQL database with go-sql-driver", "body": "<p>My db_config.go file looks like for GO ORM 2.0:</p>\n<pre><code>package infrastructure\n\nimport (\n    &quot;fmt&quot;\n\n    &quot;gorm.io/driver/mysql&quot;\n    &quot;gorm.io/gorm&quot;\n    &quot;gorm2.0/utils&quot;\n)\n\n//Setup Models: initializaing the mysql database\nfunc GetDatabaseInstance() *gorm.DB {\n    get := utils.GetEnvWithKey\n    USER := get(&quot;DB_USER&quot;)\n    PASS := get(&quot;DB_PASS&quot;)\n    HOST := get(&quot;DB_HOST&quot;)\n    PORT := get(&quot;DB_PORT&quot;)\n    DBNAME := get(&quot;DB_NAME&quot;)\n\n    dsn := fmt.Sprintf(&quot;%s:%s@tcp(%s:%s)/%s?charset=utf8&amp;parseTime=True&amp;loc=Local&quot;, USER, PASS, HOST, PORT, DBNAME)\n    db, err := gorm.Open(mysql.Open(dsn), &amp;gorm.Config{})    \n    \n    _ = db.Exec(&quot;CREATE DATABASE IF NOT EXISTS &quot; + DBNAME + &quot;;&quot;)\n\n\n    if err != nil {\n        panic(err.Error())\n    }\n\n    return db\n}\n</code></pre>\n"}], "owner": {"reputation": 517, "user_id": 4571524, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4263217cfc557061c3cbb5d506983022?s=128&d=identicon&r=PG&f=1", "display_name": "gdg", "link": "https://stackoverflow.com/users/4571524/gdg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 20949, "favorite_count": 11, "accepted_answer_id": 30236596, "answer_count": 3, "score": 16, "last_activity_date": 1607937099, "creation_date": 1431599348, "last_edit_date": 1470222662, "question_id": 30235031, "link": "https://stackoverflow.com/questions/30235031/how-to-create-a-new-mysql-database-with-go-sql-driver", "title": "How to create a new MySQL database with go-sql-driver", "body": "<p>I'm working on Golang script that automatically clone a database.\nI'm using go-sql-driver but i can't find in the documentation a way to create a new database.\nConnection to MySQL require an URL scheme like:</p>\n\n<pre><code>user:password@tcp(localhost:3306)/database_name\n</code></pre>\n\n<p>But the database not exists yet, I just want to connect to the server and then create a new one.</p>\n\n<p>How can I do that? I have to use another driver?</p>\n"}, {"tags": ["json", "struct", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 1, "creation_date": 1431599871, "post_id": 30234736, "comment_id": 48572307, "body": "You want to create a value of <code>ErrorMessage</code> in Go, or you want to parse a JSON text into a variable of type <code>ErrorMessage</code>?"}, {"owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431600328, "post_id": 30234736, "comment_id": 48572631, "body": "I want to create a value of ErrorMessage in Go which will basically then be rendered. <code>return c.RenderJson(e)</code>"}], "answers": [{"tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": false, "score": 0, "last_activity_date": 1431600926, "creation_date": 1431600926, "answer_id": 30235547, "question_id": 30234736, "link": "https://stackoverflow.com/questions/30234736/golang-json-for-struct-error-message/30235547#30235547", "title": "Golang JSON for Struct - Error Message", "body": "<p>If you separate the <code>Error</code> and <code>Meta</code> from inline structs into pre-defined struct types, it becomes pretty straightforward:</p>\n\n<pre><code>type Error struct {\n     Code    string `json:\"code\"`\n     Message string `json:\"message\"`\n     Field   string `json:\"field,omitempty\"`\n}\n\ntype Meta struct {\n    Status string `json:\"status\"`\n}\n\ntype ErrorMessage struct {\n    Errors []Error `json:\"errors\"`\n    Meta Meta `json:\"meta\"`\n}\n\nmsg := ErrorMessage {\n    Errors: []Error{\n        {Code: \"f00\", Message: \"bar\", Field: \"wat\"},\n    },\n    Meta: Meta{\"WAT\"},\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 0, "last_activity_date": 1471955097, "last_edit_date": 1495535630, "creation_date": 1431600950, "answer_id": 30235555, "question_id": 30234736, "link": "https://stackoverflow.com/questions/30234736/golang-json-for-struct-error-message/30235555#30235555", "title": "Golang JSON for Struct - Error Message", "body": "<p>The problem here is that you use anonymous structs as types of the fields of <code>ErrorMessage</code>. E.g. the element type of <code>ErrorMessage.Errors</code> is an anonymous struct. The type of <code>ErrorMessage.Meta</code> is also an anonymous struct.</p>\n\n<p>Unfortunately initializing variables with anonymous struct types requires you to duplicate the anonymous struct declaration, see <a href=\"https://stackoverflow.com/a/30104985/1705598\">this answer for examples and more details</a>.</p>\n\n<p>What I would suggest is to name your anonymous struct types like this:</p>\n\n<pre><code>type MyErr struct {\n    Code    string `json:\"code\"`\n    Message string `json:\"message\"`\n    Field   string `json:\"field,omitempty\"`\n}\n\ntype MyMeta struct {\n    Status string `json:\"status\"`\n}\n\ntype ErrorMessage struct {\n    Errors []MyErr `json:\"errors\"`\n    Meta   MyMeta  `json:\"meta\"`\n}\n</code></pre>\n\n<p>And then your tasks becomes dead simple:</p>\n\n<pre><code>res := ErrorMessage{\n    Errors: []MyErr{\n        MyErr{\n            Code:    \"short-code\",\n            Message: \"Wow, such bad!\",\n        },\n        MyErr{\n            Code:    \"other-code\",\n            Message: \"OMG, very error!\",\n            Field:   \"This is the field\",\n        },\n    },\n    Meta: MyMeta{\"error\"},\n}\ndata, err := json.MarshalIndent(&amp;res, \"\", \"  \")\nif err != nil {\n    panic(err)\n}\nfmt.Println(string(data))\n</code></pre>\n\n<p>This will produce exactly your desired output. Try it on the <a href=\"http://play.golang.org/p/o4PT-fYoOZ\" rel=\"nofollow noreferrer\">Go Playground</a>.</p>\n"}], "owner": {"reputation": 627, "user_id": 1029949, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/78b3ab7db53dea6f07f963d1ee70c6b7?s=128&d=identicon&r=PG", "display_name": "Elliot Reeve", "link": "https://stackoverflow.com/users/1029949/elliot-reeve"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 920, "favorite_count": 1, "answer_count": 2, "score": 1, "last_activity_date": 1471955097, "creation_date": 1431598517, "last_edit_date": 1431601118, "question_id": 30234736, "link": "https://stackoverflow.com/questions/30234736/golang-json-for-struct-error-message", "title": "Golang JSON for Struct - Error Message", "body": "<p>I am really new to Golang and I am trying to parse values to my ErrorMessage struct when an error occurs.</p>\n\n<p>I have this struct:</p>\n\n<pre><code>type ErrorMessage struct {\n    Errors []struct {\n        Code    string `json:\"code\"`\n        Message string `json:\"message\"`\n        Field   string `json:\"field,omitempty\"`\n    } `json:\"errors\"`\n    Meta struct {\n        Status string `json:\"status\"`\n    } `json:\"meta\"`\n}\n</code></pre>\n\n<p>Which is mapped to display JSON like this:</p>\n\n<pre><code>{\n    \"errors\": [\n        {\n            \"code\": \"short-code\", \n            \"message\": \"Wow, such bad!\"\n        },\n        {\n            \"code\": \"other-code\",\n            \"message\": \"OMG, very error!\",\n            \"field\": \"This is the field\"\n        }\n    ],\n    \"meta\": {\n        \"status\": \"error\"\n    }\n}\n</code></pre>\n\n<p>However I cannot work out how to parse the values from my controller into this Struct. For a basic Struct I understand and had something like this:\n<code>e := models.ErrorMessage{\"Error\", \"404\", \"Field Missing\"}</code></p>\n\n<p>How would use a line similar to the above but for the more complicated Struct?</p>\n"}, {"tags": ["database", "orm", "go", "go-gorm"], "answers": [{"tags": [], "owner": {"reputation": 62894, "user_id": 1114486, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3b0513d720af96f4496f4b869fe9579a?s=128&d=identicon&r=PG", "display_name": "Didier Spezia", "link": "https://stackoverflow.com/users/1114486/didier-spezia"}, "is_accepted": true, "score": 3, "last_activity_date": 1431606689, "creation_date": 1431606689, "answer_id": 30237486, "question_id": 30234610, "link": "https://stackoverflow.com/questions/30234610/filtering-by-date-in-gorm/30237486#30237486", "title": "Filtering by date in GORM", "body": "<p>With all RDBMS, the SQL standard mandates that a condition involving a comparison with a NULL value is always false. The following query therefore always returns an empty result:</p>\n\n<pre><code>select * from XXX where deleted_at = NULL\n</code></pre>\n\n<p>If you want to search for NULL values, you are supposed to write:</p>\n\n<pre><code>select * from XXX where deleted_at is null\n</code></pre>\n\n<p>I think you can fix the issue by making sure GORM generates the correct query. For instance, this should work (untested):</p>\n\n<pre><code>db.Where(\"deleted_at is null\").Find(&amp;users)\n</code></pre>\n"}], "owner": {"reputation": 1424, "user_id": 3147268, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/1f90d4a9d7382ddd2447f782a65ba008?s=128&d=identicon&r=PG&f=1", "display_name": "user3147268", "link": "https://stackoverflow.com/users/3147268/user3147268"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2308, "favorite_count": 0, "accepted_answer_id": 30237486, "answer_count": 1, "score": 2, "last_activity_date": 1431606689, "creation_date": 1431598168, "question_id": 30234610, "link": "https://stackoverflow.com/questions/30234610/filtering-by-date-in-gorm", "title": "Filtering by date in GORM", "body": "<p>I'm using <a href=\"https://github.com/jinzhu/gorm\" rel=\"nofollow\">GORM</a> to access the records in my database. Now I want to retrieve all records that are not deleted which means, that the attribute DeletedAt must be NULL.</p>\n\n<p>I tried the following command chains with <a href=\"https://github.com/jinzhu/gorm#query-with-where-plain-sql\" rel=\"nofollow\"><code>WHERE()</code></a>, but they returned no results.</p>\n\n<pre><code>users := []*models.User{}\ndb.Where(\"deleted_at\", nil).Find(&amp;users)\n</code></pre>\n\n<p>and</p>\n\n<pre><code>db.Where(\"deleted_at\", \"NULL\").Find(&amp;users)\n</code></pre>\n\n<p>My database model is defined by the following structs:</p>\n\n<pre><code>type Model struct {\n    ID        uint `gorm:\"primary_key\"`\n    CreatedAt time.Time\n    UpdatedAt time.Time\n    DeletedAt *time.Time\n}\n\ntype User struct {\n    gorm.Model\n    Username string `sql:\"size:32; not null; unique\"`\n    Password string `sql:\"not null\"`\n    Locale   string `sql:\"not null\"`\n}\n</code></pre>\n"}, {"tags": ["go", "revel"], "answers": [{"tags": [], "owner": {"reputation": 23, "user_id": 3686026, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/myy5v.jpg?s=128&g=1", "display_name": "ggerman", "link": "https://stackoverflow.com/users/3686026/ggerman"}, "is_accepted": false, "score": 0, "last_activity_date": 1436809227, "creation_date": 1436809227, "answer_id": 31389942, "question_id": 30233310, "link": "https://stackoverflow.com/questions/30233310/template-layouts-in-revel/31389942#31389942", "title": "Template layouts in revel", "body": "<p>You can define the do you want into conf/routes file.\nThen you can call you action with the name you want:</p>\n\n<pre><code>package controllers\nimport (\n  \"github.com/revel/revel\"\n)\nfunc (c Name) root() revel.Result {\nc.Render()\n}\n</code></pre>\n\n<p>views/Name/root.html</p>\n\n<p>Other way can be this:</p>\n\n<p>views/Controler/NameAction.html</p>\n\n<pre><code>{{template \"root.html\" .}}\n</code></pre>\n\n<p>views/root.html</p>\n\n<pre><code>&lt;p&gt;bla, bla&lt;/p&gt;\n</code></pre>\n"}], "owner": {"reputation": 7466, "user_id": 288424, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/cf91d37f026ddaccc28c9907b567ab13?s=128&d=identicon&r=PG&f=1", "display_name": "Neil", "link": "https://stackoverflow.com/users/288424/neil"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 223, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1436809227, "creation_date": 1431594245, "question_id": 30233310, "link": "https://stackoverflow.com/questions/30233310/template-layouts-in-revel", "title": "Template layouts in revel", "body": "<p>Is it possible to use template layouts in Revel. For example have a root.html which contains a <code>{{define \"main\"}}{{end}}</code> tag. Then call <code>ExecuteTemplate(out, \"main\", nil)</code> <a href=\"http://golang.org/pkg/html/template/#Template.ExecuteTemplate\" rel=\"nofollow\">http://golang.org/pkg/html/template/#Template.ExecuteTemplate</a></p>\n\n<p>Something like c.RenderLayout()</p>\n"}, {"tags": ["javascript", "arrays", "json", "google-app-engine", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 4, "creation_date": 1431594136, "post_id": 30233217, "comment_id": 48568977, "body": "Please define <i>&quot;this doesn&#39;t work&quot;</i> . What happens? You get JavaScript error? If so, what is it you get?"}, {"owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1431594854, "post_id": 30233217, "comment_id": 48569390, "body": "if i do <code>console.log(ev.detail.response)</code> I get json as string, but if I try to do <code>console.log(ev.detail.response[&#39;trial-data&#39;])</code> I got undefined, so it means that <code>ev.detail.response</code> does not return an array"}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1431595570, "creation_date": 1431595570, "answer_id": 30233728, "question_id": 30233217, "link": "https://stackoverflow.com/questions/30233217/serve-json-file-from-go-server-to-javascript-client/30233728#30233728", "title": "Serve json file from GO server to javascript client", "body": "<p><code>ev.detail.response</code> is just a string response, it is not a parsed json object.</p>\n\n<p>First you need to parse it using <a href=\"https://msdn.microsoft.com/en-us/library/cc836466(v=vs.85).aspx\" rel=\"nofollow\"><code>JSON.parse()</code></a> and then you can access its content.</p>\n\n<p>See this Javascript example:</p>\n\n<pre><code>var json = '{\"trial-data\":[{\"trial\":{\"index\": 0}},{\"trial\":{\"index\":1}}]}'\n\nalert(JSON.parse(json)['trial-data'])\n</code></pre>\n\n<p>To access the value of the first <code>\"index\"</code> field, for example:</p>\n\n<pre><code>var idx0 = JSON.parse(json)['trial-data'][0]['trial']['index']\n</code></pre>\n"}], "owner": {"reputation": 127, "user_id": 2284019, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/5da76f7ed150b38a3db00413d3976f67?s=128&d=identicon&r=PG", "display_name": "Dede", "link": "https://stackoverflow.com/users/2284019/dede"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 908, "favorite_count": 0, "accepted_answer_id": 30233728, "answer_count": 1, "score": 4, "last_activity_date": 1431595570, "creation_date": 1431594004, "last_edit_date": 1431594387, "question_id": 30233217, "link": "https://stackoverflow.com/questions/30233217/serve-json-file-from-go-server-to-javascript-client", "title": "Serve json file from GO server to javascript client", "body": "<p>I have a go server which has to respond to a javascript request by serving a json file. The json file is an array of objects. </p>\n\n<p>My code :</p>\n\n<p><strong>Server side</strong></p>\n\n<pre><code>package expt\n\nimport (\n    \"net/http\"\n)\n\n\nfunc init() {\n    http.HandleFunc(\"/\", handleStatic)\n    http.HandleFunc(\"/loadTrials\", handleloadJson)\n}\n\nfunc handleStatic(w http.ResponseWriter, r *http.Request) {\n    w.Header().Set(\"Cache-Control\", \"no-cache\")\n    http.ServeFile(w, r, \"static/\"+r.URL.Path)\n}\n\n\nfunc handleloadJson(w http.ResponseWriter, r *http.Request) {\n    http.ServeFile(w, r, \"static/trial.json\")\n}\n</code></pre>\n\n<p><strong>Client side</strong></p>\n\n<pre><code>loadTrials : function loadTrials() {\n\n            var _this = this,\n                load = this.shadowRoot.querySelector('#load-trial');\n\n            load.url=\"http://url:8080/loadTrials\";\n            load.go()\n            load.addEventListener('core-response', function(ev) {\n                console.log(ev.detail.response)\n            }, false);\n        }\n</code></pre>\n\n<p><strong>Json</strong></p>\n\n<pre><code>{\n  \"trial-data\" : [\n    {\n      \"trial\" : {\n        \"index\": 0,\n      }\n    },\n    {\n      \"trial\" : {\n        \"index\": 1,\n      }\n    }\n  ]\n}\n</code></pre>\n\n<p>If I do that I get the JSON object in JavaScript, but if I try to look into the JSON to get the array- i.e. console.log(ev.detail.response['trial-data']) then this doesn't work. </p>\n"}, {"tags": ["go", "methods", "struct"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1431593082, "post_id": 30232935, "comment_id": 48568354, "body": "Try <code>blah := gotime.Now{}</code>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1431593266, "last_edit_date": 1431593266, "creation_date": 1431593181, "answer_id": 30232989, "question_id": 30232935, "link": "https://stackoverflow.com/questions/30232935/undefined-error-in-golang/30232989#30232989", "title": "Undefined Error in Golang", "body": "<p>Since <code>Now</code> is a struct, you need a struct <a href=\"https://golang.org/ref/spec#Composite_literals\" rel=\"nofollow\">Composite literal</a> to create a value of that type.</p>\n\n<p>Also since it is from another package, you need the <a href=\"https://golang.org/ref/spec#Qualified_identifiers\" rel=\"nofollow\">Qualified name</a>:</p>\n\n<pre><code>blan := gotime.Now{}\n</code></pre>\n\n<p>Also since you are modifying it, you should / need to use a pointer receiver:</p>\n\n<pre><code>func (n *Now) DayNow() int {\n    n.dnow = time.Now().Day()\n    return n.dnow\n}\n</code></pre>\n"}], "owner": {"reputation": 1203, "user_id": 3821823, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/a760c201a9690d3c4786a76f8c07649e?s=128&d=identicon&r=PG", "display_name": "Ali", "link": "https://stackoverflow.com/users/3821823/ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 9741, "favorite_count": 2, "accepted_answer_id": 30232989, "answer_count": 1, "score": 2, "last_activity_date": 1519293604, "creation_date": 1431592999, "last_edit_date": 1519293604, "question_id": 30232935, "link": "https://stackoverflow.com/questions/30232935/undefined-error-in-golang", "title": "Undefined Error in Golang", "body": "<p>I have the following structure:</p>\n\n<pre><code>/*gotime.go*/\npackage gotime\n\ntype Now struct {\n    dnow int\n    ynow int\n    mnow time.Month\n}\n</code></pre>\n\n<p>And is there a function like:</p>\n\n<pre><code>/*gotime.go*/\nfunc (n Now) DayNow() int {\n    n.dnow = time.Now().Day()\n    return n.dnow\n\n}\n</code></pre>\n\n<p>I'm getting the following error when I want to call this package:</p>\n\n<pre><code>/*main.go*/\npackage main\n\nimport (\n    \"fmt\"\n    \"./gotime\"\n)\n\nblah := Now\nfmt.Println(blah.DayNow())\n</code></pre>\n\n<p>I get errors:</p>\n\n<pre><code># command-line-arguments\n.\\main.go:5: imported and not used: \"_/C_/Users/ali/Desktop/test/gotime\"\n.\\main.go:10: undefined: Now\n</code></pre>\n\n<p>You can look at all of the package on GitHub:</p>\n\n<p><a href=\"https://github.com/aligoren/gotime/blob/master/gotime.go\" rel=\"nofollow\">Link</a> for this package</p>\n\n<p>How can I solve this problem?</p>\n"}, {"tags": ["postgresql", "go"], "comments": [{"owner": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1431592007, "post_id": 30231978, "comment_id": 48567800, "body": "Are you sure you don&#39;t have duplicate hashes ?"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "reply_to_user": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1431592287, "post_id": 30231978, "comment_id": 48567949, "body": "I am sure that when i call <code>go processDebugBody.Run()</code> table <code>bodies</code> is empty."}, {"owner": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1431592400, "post_id": 30231978, "comment_id": 48568001, "body": "The table may be empty, but the records you insert may have repeating hashes. Have you checked that ?"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "reply_to_user": {"reputation": 2277, "user_id": 3037915, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4957d2ff2e049c7163f2aa0e97c3a434?s=128&d=identicon&r=PG&f=1", "display_name": "Tasos Vogiatzoglou", "link": "https://stackoverflow.com/users/3037915/tasos-vogiatzoglou"}, "edited": false, "score": 0, "creation_date": 1431592550, "post_id": 30231978, "comment_id": 48568068, "body": "If different records have a same hash, it meant nothing, becase i check hash before call insert <code>if _, ok := pr.BodiesHash[bodyHash]; !ok</code>. So, if bodyHash already exist, i don&#39;t call insert function."}, {"owner": {"reputation": 48635, "user_id": 6742, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/xPawo.png?s=128&g=1", "display_name": "David Aldridge", "link": "https://stackoverflow.com/users/6742/david-aldridge"}, "edited": false, "score": 0, "creation_date": 1431593466, "post_id": 30231978, "comment_id": 48568578, "body": "Have you looked at the actual values being inserted by the process, and the value of the hash that is being tested for its presence in the table?"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 0, "creation_date": 1431594189, "post_id": 30231978, "comment_id": 48569009, "body": "I check postgres log and app log - hash is equal. But in postgres log i notice strange message before dublicate error occured: <code>2015-05-13 20:12:42 CEST LOG:  SSL renegotiation failure 2015-05-13 20:12:42 CEST ERROR:  duplicate key value violates unique constraint &quot;bd_hash_index&quot; 2015-05-13 20:12:42 CEST DETAIL:  Key (hash)=(ec5d075f7ccbecdadb06e8bedc884089) already exists. 2015-05-13 20:12:42 CEST STATEMENT:  INSERT INTO bodies (hash, type, source, body, created_timestamp) VALUES ($1, $2, $3, $4, $5)</code>"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 1, "creation_date": 1431594268, "post_id": 30231978, "comment_id": 48569059, "body": "Can it be a reason? <code>2015-05-13 20:12:42 CEST LOG: SSL renegotiation failure</code>. All time, when i found dublicate error, this row stand before it."}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 1, "creation_date": 1431594406, "post_id": 30231978, "comment_id": 48569144, "body": "If you run in autocommit client you can send insertion and not receive state. so actual insert happens, but client does not have result, so it retries after reconnect"}, {"owner": {"reputation": 37141, "user_id": 5315974, "user_type": "registered", "accept_rate": 47, "profile_image": "https://i.stack.imgur.com/MNGHV.png?s=128&g=1", "display_name": "Vao Tsun", "link": "https://stackoverflow.com/users/5315974/vao-tsun"}, "edited": false, "score": 1, "creation_date": 1431594477, "post_id": 30231978, "comment_id": 48569190, "body": "<a href=\"http://www.postgresql.org/docs/9.1/static/ecpg-sql-set-autocommit.html\" rel=\"nofollow noreferrer\">postgresql.org/docs/9.1/static/ecpg-sql-set-autocommit.html</a> try setting it OFF and use begin; insert;commit; instead"}, {"owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "edited": false, "score": 0, "creation_date": 1431595101, "post_id": 30231978, "comment_id": 48569533, "body": "ok, i try it, thanks"}, {"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 1, "creation_date": 1431625423, "post_id": 30231978, "comment_id": 48588695, "body": "BTW2, one of the reasons to use a <code>bool</code> map (rather than the smaller map of <code>struct{}</code>) as a set is to make the existence check a simple <code>if pr.BodiesHash[bodyHash]</code> without needing the longer comma ok form."}], "answers": [{"tags": [], "owner": {"reputation": 10650, "user_id": 847869, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Uk4Ey.jpg?s=128&g=1", "display_name": "tomasz", "link": "https://stackoverflow.com/users/847869/tomasz"}, "is_accepted": false, "score": 1, "last_activity_date": 1431639886, "last_edit_date": 1592644375, "creation_date": 1431639886, "answer_id": 30247909, "question_id": 30231978, "link": "https://stackoverflow.com/questions/30231978/occasional-postgresql-duplicate-key-value-violates-unique-constraint-error-fro/30247909#30247909", "title": "Occasional PostgreSQL &quot;Duplicate key value violates unique constraint&quot; error from Go insert", "body": "<p>When you execute a query outside of transaction with <code>sql.DB</code>, it automatically retries when there's a problem with connection. In the current implementation, up to 10 times. For example, notice <code>maxBadConnRetries</code> in <a href=\"http://golang.org/src/database/sql/sql.go?s=23335:23404#L861\" rel=\"nofollow noreferrer\"><code>sql.Exec</code></a>.</p>\n<p>Now, it really happens only when underlying driver returns <code>driver.ErrBadConn</code> and specification states the following:</p>\n<blockquote>\n<p>ErrBadConn should be returned by a driver to signal to the sql package that a driver.Conn is in a bad state (such as the server having earlier closed the connection) and the <strong>sql package should retry</strong> on a new connection.</p>\n<p><strong>To prevent duplicate operations</strong>, ErrBadConn should NOT be returned if there's a possibility that the database server might have performed the operation.</p>\n</blockquote>\n<p>I think driver implementations are a little bit careless in implementing this rule, but maybe there is some logic behind it. I've been studying implementation of <code>lib/pq</code> the other day and noticed this scenario would be possible.</p>\n<p>As you pointed out in the comments you have some SSL errors issued just before seeing duplicates, so this seems like a reasonable guess.</p>\n<p>One thing to consider is to use transactions. If you lose the connection\u00a0before committing the transaction, you can be sure it will be rolled back. Also the statements of the transactions are not retransmitted automatically on bad connections, so this problem might be solved \u2013 you will most probably will se SSL errors being propagated directly to you application though, so you'll need to retry on your own.</p>\n<p>I must tell you I've been also seeing SSL renegotiation errors on postgres using Go 1.3 and that's why I've disabled SSL for my internal DB for time being (<code>sslmode=disable</code> in the connection string). I was wondering whether version 1.4 has solved the issue, as one thing on changelog was <em>The crypto/tls package now supports ALPN as defined in RFC 7301</em> (ALPN states for Application-Layer Protocol Negotiation Extension).</p>\n"}], "owner": {"reputation": 159, "user_id": 2024300, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/a32035c8beebceb79123f02dbf39c5a8?s=128&d=identicon&r=PG", "display_name": "user2024300", "link": "https://stackoverflow.com/users/2024300/user2024300"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1884, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1431639886, "creation_date": 1431589443, "last_edit_date": 1431625944, "question_id": 30231978, "link": "https://stackoverflow.com/questions/30231978/occasional-postgresql-duplicate-key-value-violates-unique-constraint-error-fro", "title": "Occasional PostgreSQL &quot;Duplicate key value violates unique constraint&quot; error from Go insert", "body": "<p>I have a table with the unique constraint</p>\n\n<pre><code>CREATE UNIQUE INDEX \"bd_hash_index\" ON \"public\".\"bodies\" USING btree (\"hash\");\n</code></pre>\n\n<p>I also have a Go program that takes \"body\" values on a channel, filters out the duplicates by hashing, and inserts only the non-duplicates into the database.\nLike this:</p>\n\n<pre><code>import (\n    \"crypto/md5\"\n    \"database/sql\"\n    \"encoding/hex\"\n    \"log\"\n    \"strings\"\n    \"time\"\n)\n\ntype Process struct {\n    DB                  *sql.DB\n    BodiesHash          map[string]bool\n    Channel             chan BodyIterface\n    Logger              *log.Logger\n}\n\nfunc (pr *Process) Run() {\n    bodyInsert, err := pr.DB.Prepare(\"INSERT INTO bodies (hash, type, source, body, created_timestamp) VALUES ($1, $2, $3, $4, $5)\")\n    if err != nil {\n        pr.Logger.Println(err)\n        return\n    }\n    defer bodyInsert.Close()\n\n    hash := md5.New()\n\n    for p := range pr.Channel {\n        nowUnix := time.Now().Unix()\n\n        bodyString := strings.Join([]string{\n            p.GetType(),\n            p.GetSource(),\n            p.GetBodyString(),\n        }, \":\")\n        hash.Write([]byte(bodyString))\n        bodyHash := hex.EncodeToString(hash.Sum(nil))\n        hash.Reset()\n\n        if _, ok := pr.BodiesHash[bodyHash]; !ok {\n            pr.BodiesHash[bodyHash] = true\n\n            _, err = bodyInsert.Exec(\n                bodyHash,\n                p.GetType(),\n                p.GetSource(),\n                p.GetBodyString(),\n                nowUnix,\n            )\n            if err != nil {\n                pr.Logger.Println(err, bodyString, bodyHash)\n            }\n        }\n    }   \n}\n</code></pre>\n\n<p>But periodically I get the error</p>\n\n<blockquote>\n  <p>\"pq: duplicate key value violates unique constraint \"bd_hash_index\"\"</p>\n</blockquote>\n\n<p>in my log file. I can't image how it can be, because I check the hash for uniqueness before I do an insert.\nI am sure that when I call <code>go processDebugBody.Run()</code> the bodies table is empty.</p>\n\n<p>The channel was created as a buffered channel with:</p>\n\n<pre><code>    processDebugBody.Channel = make(chan BodyIterface, 1000)\n</code></pre>\n"}, {"tags": ["sockets", "unix", "go"], "comments": [{"owner": {"reputation": 25103, "user_id": 1340389, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/5d0e5b16679b92b24c8262e1e6aa2aa7?s=128&d=identicon&r=PG", "display_name": "Kevin", "link": "https://stackoverflow.com/users/1340389/kevin"}, "edited": false, "score": 2, "creation_date": 1431572748, "post_id": 30228482, "comment_id": 48560686, "body": "Presumably that <code>Dial</code> function is calling <a href=\"http://linux.die.net/man/2/connect\" rel=\"nofollow noreferrer\"><code>connect(2)</code></a>, which can return <code>EAGAIN</code> if the routing cache is full.  You&#39;re probably overloading the socket stack.  Try switching to exponential backoff (i.e. double the <code>retry_duration</code> each time you retry)."}, {"owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "edited": false, "score": 2, "creation_date": 1431578475, "post_id": 30228482, "comment_id": 48562151, "body": "Might the server process&#39;s <code>listen</code> queue be full?"}], "answers": [{"tags": [], "owner": {"reputation": 8296, "user_id": 216488, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/c510f6396aac23ff75e25f50cf3014d6?s=128&d=identicon&r=PG", "display_name": "Caleb", "link": "https://stackoverflow.com/users/216488/caleb"}, "is_accepted": false, "score": 0, "last_activity_date": 1431608991, "creation_date": 1431608991, "answer_id": 30238264, "question_id": 30228482, "link": "https://stackoverflow.com/questions/30228482/golang-unix-socket-error-dial-resource-temporarily-unavailable/30238264#30238264", "title": "golang unix socket error. dial: resource temporarily unavailable", "body": "<p>For the exponential backoff you can use this library: <a href=\"https://github.com/cenkalti/backoff\" rel=\"nofollow\">github.com/cenkalti/backoff</a>. I think the way you have it now it always sleeps for the same amount of time. </p>\n\n<p>For the network error you need to check if it's a temporary error or not. If it is then retry:</p>\n\n<pre><code>type TemporaryError interface {\n    Temporary() bool\n}\n\nfunc dial() (conn net.Conn, err error) {\n    backoff.Retry(func() error {\n        conn, err = net.Dial(\"unix\", \"/tmp/ex.socket\")\n        if err != nil {\n            // if this is a temporary error, then retry\n            if terr, ok := err.(TemporaryError); ok &amp;&amp; terr.Temporary() {\n                return err\n            }\n        }\n        // if we were successful, or there was a non-temporary error, fail\n        return nil\n    }, backoff.NewExponentialBackOff())\n    return\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 36091, "user_id": 721283, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/9d9b7698c26959f57c0e3814005b8b52?s=128&d=identicon&r=PG", "display_name": "James Henstridge", "link": "https://stackoverflow.com/users/721283/james-henstridge"}, "is_accepted": true, "score": 2, "last_activity_date": 1431609048, "creation_date": 1431609048, "answer_id": 30238278, "question_id": 30228482, "link": "https://stackoverflow.com/questions/30228482/golang-unix-socket-error-dial-resource-temporarily-unavailable/30238278#30238278", "title": "golang unix socket error. dial: resource temporarily unavailable", "body": "<p>Go creates its sockets in non-blocking mode, which means that certain system calls that would usually block instead.  In most cases it transparently handles the <code>EAGAIN</code> error (what is indicated by the \"resource temporarily unavailable\" message) by waiting until the socket is ready to read/write.  It doesn't seem to have this logic for the <code>connect</code> call in <code>Dial</code> though.</p>\n\n<p>It is possible for <code>connect</code> to return <code>EAGAIN</code> when connecting to a UNIX domain socket if its listen queue has filled up.  This will happen if clients are connecting to it faster than it is accepting them.  Go should probably wait on the socket until it becomes connectable in this case and retry similar to what it does for <code>Read</code>/<code>Write</code>, but it doesn't seem to have that logic.</p>\n\n<p>So your best bet would be to handle the error by waiting and retrying the <code>Dial</code> call.  That, or work out why your server isn't accepting connections in a timely manner.</p>\n"}], "owner": {"reputation": 13, "user_id": 4898135, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/b8e6ab3fa625fc67eb99f718ba0781c2?s=128&d=identicon&r=PG&f=1", "display_name": "Saif Abid", "link": "https://stackoverflow.com/users/4898135/saif-abid"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3006, "favorite_count": 0, "accepted_answer_id": 30238278, "answer_count": 2, "score": 1, "last_activity_date": 1431609048, "creation_date": 1431571992, "last_edit_date": 1431573705, "question_id": 30228482, "link": "https://stackoverflow.com/questions/30228482/golang-unix-socket-error-dial-resource-temporarily-unavailable", "title": "golang unix socket error. dial: resource temporarily unavailable", "body": "<p>So I'm trying to use unix sockets with fluentd for a logging task and find that randomly, once in a while the error</p>\n\n<blockquote>\n  <p>dial: {socket_name} resource temporarily unavailable </p>\n</blockquote>\n\n<p>Any ideas as to why this might be occurring?</p>\n\n<p>I tried adding \"retry\" logic, to reduce the error, but it still occurs at times. </p>\n\n<p>Also, for fluntd we are using the default config for unix sockets communication</p>\n\n<pre><code>func connect() {\n\nvar connection net.Conn\nvar err error\nfor i := 0; i &lt; retry_count; i++ {\n    connection, err = net.Dial(\"unix\", path_to_socket)\n    if err == nil {\n        break\n\n    }\n    time.Sleep(time.Duration(math.Exp2(float64(retry_count))) * time.Millisecond)\n}\nif err != nil {\n    fmt.Println(err)\n\n} else {\n        connection.Write(data_to_send_socket)\n\n    }\n     defer connection.Close()\n}\n</code></pre>\n"}, {"tags": ["image", "go", "set", "undefined"], "answers": [{"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1431623571, "post_id": 30228156, "comment_id": 48587601, "body": "A slightly better version of that interface already exists as <code>draw.Image</code>. See <a href=\"http://stackoverflow.com/a/30243259/55504\">my answer</a> for one way to use it."}], "tags": [], "owner": {"reputation": 44047, "user_id": 1400793, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/7VxVK.png?s=128&g=1", "display_name": "Paul Hankin", "link": "https://stackoverflow.com/users/1400793/paul-hankin"}, "is_accepted": false, "score": 2, "last_activity_date": 1431661015, "last_edit_date": 1431661015, "creation_date": 1431569213, "answer_id": 30228156, "question_id": 30227947, "link": "https://stackoverflow.com/questions/30227947/using-the-set-method-of-an-image-image-or-image-rgba/30228156#30228156", "title": "Using the Set() method of an image.Image or *image.RGBA", "body": "<p><code>reflect.TypeOf(img)</code> gives you the reflection type of the value in the interface <code>img</code>, if its an interface. In this case, <code>img</code> <em>is</em> an interface, an <code>image.Image</code> which contains an <code>*image.RGBA</code>.</p>\n\n<p>You can fix your code by converting <code>img</code> to an <code>*image.RGBA</code>, or more robustly, define an interface type with the right <code>Set</code> method, and convert <code>img</code> to that (the <code>draw.Image</code> interface in <code>\"image/draw\"</code> works perfectly for this, as noted by @DaveC). The interface type is preferable if you aren't sure that <code>png.Decode</code> will always give you an <code>*image.RGBA</code> for the .png files you have.</p>\n\n<pre><code>img.(*image.RGBA).Set(0, 0, color.RGBA{136, 0, 21, 255})\n</code></pre>\n\n<p>or</p>\n\n<pre><code>type Setter interface {\n    Set(x, y int, c color.Color)\n}\n\nimg.(Setter).Set(0, 0, color.RGBA{136, 0, 21, 255})\n</code></pre>\n\n<p>or (probably best):</p>\n\n<pre><code>import \"image/draw\"\n\n...\n\nimg.(draw.Image).Set(0, 0, color.RGBA{136, 0, 21, 255})\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 3488, "user_id": 328504, "user_type": "registered", "accept_rate": 89, "profile_image": "https://www.gravatar.com/avatar/c066fa1944f2b8cd2bf31c5ac1b54abd?s=128&d=identicon&r=PG", "display_name": "Ben Campbell", "link": "https://stackoverflow.com/users/328504/ben-campbell"}, "is_accepted": false, "score": -1, "last_activity_date": 1431569665, "creation_date": 1431569665, "answer_id": 30228222, "question_id": 30227947, "link": "https://stackoverflow.com/questions/30227947/using-the-set-method-of-an-image-image-or-image-rgba/30228222#30228222", "title": "Using the Set() method of an image.Image or *image.RGBA", "body": "<p>The <strong>compiler is correct</strong>, the <a href=\"http://golang.org/pkg/image/#Image\" rel=\"nofollow\">image.Image</a> type is an interface that does not include the Set() function.</p>\n\n<p>I am not an expert at the image library but my cursory look at the types seems to suggest you can take an Image type and use the <code>Bounds()</code> method to get a <a href=\"http://golang.org/pkg/image/#Rectangle\" rel=\"nofollow\">image.Rectangle</a> to create a new RGBA type as done previously in your example code.</p>\n\n<pre><code>// Your current image manipulation\nm := image.NewRGBA(image.Rect(0, 0, 640, 480))\nfmt.Println(\"type:\", reflect.TypeOf(m))\nm.Set(5, 5, color.RGBA{255, 0, 0, 255})\n\n// You can create a image.RGBA type by passing the image.Rectangle\n// returned from image.Image.Bounds()\nm = image.NewRGBA(img.Bounds())\nm.Set(0, 0, color.RGBA{136, 0, 21, 255})\n</code></pre>\n\n<p>This is a strict answer to your type issue but I don't have any gurantee it accomplishes your end goals.</p>\n"}, {"tags": [], "owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "is_accepted": false, "score": 7, "last_activity_date": 1532964612, "last_edit_date": 1532964612, "creation_date": 1431623387, "answer_id": 30243259, "question_id": 30227947, "link": "https://stackoverflow.com/questions/30227947/using-the-set-method-of-an-image-image-or-image-rgba/30243259#30243259", "title": "Using the Set() method of an image.Image or *image.RGBA", "body": "<p>To expand on\n<a href=\"https://stackoverflow.com/users/1400793/anonymous\">a previous answer</a>\n<a href=\"https://stackoverflow.com/a/30228156/55504\">answer</a>:</p>\n\n<p><a href=\"https://golang.org/pkg/image/png/#Decode\" rel=\"nofollow noreferrer\"><code>png.Decode</code></a> may create one of several different underlying image types (<code>*image.Gray</code>, <code>*image.RGBA</code>, <code>*image.Paletted</code>, <code>*image.NRGBA</code>, etc).\nIt returns whatever image it created as an <code>image.Image</code> interface which <strong>provides read only access</strong> to the data.</p>\n\n<p>However, all (most?) of the actual image types it returns do implement the <code>Set</code> method for simple write access.\nThe way you can safely test for and use this method is via the existing <a href=\"https://golang.org/pkg/image/draw/#Image\" rel=\"nofollow noreferrer\"><code>draw.Image</code></a> interface from the <code>image/draw</code> package. It's just this:</p>\n\n<pre><code>// From image/draw:\n// Image is an image.Image with a Set method to change a single pixel.\ntype Image interface {\n        image.Image\n        Set(x, y int, c color.Color)\n}\n</code></pre>\n\n<p>So you could do something like:</p>\n\n<pre><code>func drawablePNGImage(r io.Reader) (draw.Image, error) {\n    img, err := png.Decode(r)\n    if err != nil {\n        return nil, err\n    }\n    dimg, ok := img.(draw.Image)\n    if !ok {\n        return nil, fmt.Errorf(\"%T is not a drawable image type\", img)\n    }\n    return dimg, nil\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iikV4i0FdI\" rel=\"nofollow noreferrer\"><kbd>Playground</kbd></a> (shows an example calling all the <code>image.Image</code> methods as well as <code>Set</code>).</p>\n"}], "owner": {"reputation": 241, "user_id": 1550188, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5fc48bac07a01f7773894386398a61d0?s=128&d=identicon&r=PG", "display_name": "Bradley Nowacki", "link": "https://stackoverflow.com/users/1550188/bradley-nowacki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2558, "favorite_count": 1, "answer_count": 3, "score": 4, "last_activity_date": 1532964612, "creation_date": 1431567763, "last_edit_date": 1431627615, "question_id": 30227947, "link": "https://stackoverflow.com/questions/30227947/using-the-set-method-of-an-image-image-or-image-rgba", "title": "Using the Set() method of an image.Image or *image.RGBA", "body": "<p>I am doing some practice with the Go image package with my free time this summer.</p>\n\n<pre><code>package main\n\nimport (\n\n    \"os\"\n    \"image\"\n    \"image/png\"\n    \"image/color\"\n    \"log\"\n    \"fmt\"\n    \"reflect\"\n\n)\n\nfunc main(){\n\n    file , err := os.OpenFile(\"C:/Sources/go3x3.png\", os.O_RDWR, os.FileMode(0777))\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    img , err := png.Decode(file)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n\n    img.At(0,0).RGBA()\n    fmt.Println(\"type:\", reflect.TypeOf(img))\n\n    m := image.NewRGBA(image.Rect(0, 0, 640, 480))\n    fmt.Println(\"type:\", reflect.TypeOf(m))\n    m.Set(5, 5, color.RGBA{255, 0, 0, 255})\n    img.Set(0, 0, color.RGBA{136, 0, 21, 255})\n}\n</code></pre>\n\n<p>The problem here is when I run it with the <code>img.Set</code> commented out I get this result </p>\n\n<pre><code>type: *image.RGBA\ntype: *image.RGBA\n</code></pre>\n\n<p>but when it's uncommented I get an error saying </p>\n\n<pre><code>img.Set undefined (type image.Image has no field or method Set)\n</code></pre>\n\n<p>I'm assuming I'm using reflect wrong, I'm still fully grasping the whole interface and type definitions in Go.</p>\n"}]