[{"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1559778181, "post_id": 56469322, "comment_id": 99529990, "body": "You&#39;re not giving <code>json.Unamrshal</code> a concrete type to unmarshal into. It has no way to know what type you want, so it returns an error."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559803185, "post_id": 56469322, "comment_id": 99534880, "body": "Aside: you can simplify by writing <code>var y struct {Status string};</code>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559808857, "post_id": 56469322, "comment_id": 99537464, "body": "Your terminology is confusing. 1) Go doesn&#39;t allow overriding at all. 2) UnmarshalJSON isn&#39;t used for marshaling JSON. As the name suggests, it&#39;s used for unmarshaling."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1559782847, "last_edit_date": 1559782847, "creation_date": 1559778747, "answer_id": 56469419, "question_id": 56469322, "link": "https://stackoverflow.com/questions/56469322/how-do-i-override-unmarshaljson-correctly/56469419#56469419", "title": "How do I Override UnmarshalJSON Correctly?", "body": "<p>You cannot unmarshal into an abstract interface type.\nAn interface value is just a pointer to a type (associating that types methods) - it has no storage behind it - because an abstract type cannot know the exact size of any concrete value it may have in the future.</p>\n\n<p>Using a concrete value type (that also implements that interface) will work:</p>\n\n<pre><code>y2 := emotion{}\nerr = json.Unmarshal(jsonX, &amp;y2)\n</code></pre>\n\n<p>Playground: <a href=\"https://play.golang.org/p/8aCEjLgfKVQ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/8aCEjLgfKVQ</a></p>\n\n<pre><code>MarshalJSON is overriden: I am called fine\nEXPECTED ERROR, Can't unmarshal into a non-concrete value: json: cannot unmarshal object into Go value of type main.Emotion\n\nMarshalJSON is overriden: I am (fixed) and now called\nSHOULD NOT ERROR: &lt;nil&gt;\nVALUE: happy\n</code></pre>\n"}], "owner": {"reputation": 9259, "user_id": 1815412, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/13eb7cacf20e7789e9ebd5e814c42cb5?s=128&d=identicon&r=PG", "display_name": "Maximus S", "link": "https://stackoverflow.com/users/1815412/maximus-s"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2068, "favorite_count": 0, "accepted_answer_id": 56469419, "answer_count": 1, "score": 0, "last_activity_date": 1559782847, "creation_date": 1559777845, "question_id": 56469322, "link": "https://stackoverflow.com/questions/56469322/how-do-i-override-unmarshaljson-correctly", "title": "How do I Override UnmarshalJSON Correctly?", "body": "<p>I am trying to write a simple custom marshaler and failing. Notice I have an interface that has three functions. Both <code>Happy</code> and <code>Sad</code> structs implement this interface by embedding the <code>emotion</code> struct which implements all the three required functions.</p>\n\n<p>The problem is <code>UnmarshalJSON</code> does not get invoked when I call <code>json.Unmarshal()</code> on the pointer to either <code>Happy</code> or <code>Sad</code> and I can't understand why. You can reproduce the exact codebase in <a href=\"https://play.golang.org/p/GB2RI4pMLSz\" rel=\"nofollow noreferrer\">Go Playground</a> or just look below. You will notice that while <code>MarshalJSON</code> is correctly called, <code>UnmarshalJSON</code> isn't.</p>\n\n<pre><code>type Emotion interface {\n    String() string\n    MarshalJSON() ([]byte, error)\n    UnmarshalJSON(data []byte) error \n}\n\ntype emotion struct {\n    status string\n}\n\nfunc (s emotion) String() string {\n    return s.status\n}\n\nfunc (s emotion) MarshalJSON() ([]byte, error) {\n        fmt.Println(\"MarshalJSON is overriden: I am called fine\")\n    x := struct {\n        Status string\n    }{\n        Status: s.String(),\n    }\n\n    return json.Marshal(x)\n}\n\nfunc (s *emotion) UnmarshalJSON(data []byte) error {\n        fmt.Println(\"MarshalJSON is overriden: I am never called\")\n    y := struct {\n        Status string\n    }{\n        Status: \"\",\n    }\n\n    err := json.Unmarshal(data, &amp;y)\n    if err != nil {\n        return err\n    }\n\n    s.status = y.Status\n    return nil\n}\n\ntype Happy struct {\n    *emotion\n}\n\n// Job is not in any detention\ntype Sad struct {\n    *emotion\n}\n\n\nfunc main() {\n    x := Happy{&amp;emotion{status: \"happy\"}}\n    jsonX, _ := json.Marshal(x)\n    var y Emotion\n    err := json.Unmarshal(jsonX, &amp;y)\n    fmt.Printf(\"%v\", err)\n}\n</code></pre>\n"}, {"tags": ["go", "websocket", "gorilla"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559774754, "post_id": 56468690, "comment_id": 99529354, "body": "The Go program looks correct, but you don&#39;t show the strings substituted into payload.  Is it possible that the result is invalid JSON?   The Javascript version will correctly escape values."}, {"owner": {"reputation": 79, "user_id": 9297650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oVxfr.jpg?s=128&g=1", "display_name": "julian mentasti", "link": "https://stackoverflow.com/users/9297650/julian-mentasti"}, "reply_to_user": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 0, "creation_date": 1559777956, "post_id": 56468690, "comment_id": 99529943, "body": "@CeriseLim&#243;n You&#39;re right. Welp.... Thanks"}], "owner": {"reputation": 79, "user_id": 9297650, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/oVxfr.jpg?s=128&g=1", "display_name": "julian mentasti", "link": "https://stackoverflow.com/users/9297650/julian-mentasti"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 516, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559777973, "creation_date": 1559772574, "last_edit_date": 1559777973, "question_id": 56468690, "link": "https://stackoverflow.com/questions/56468690/on-message-recieve-from-websocket-without-causing-websocket-close-1011", "title": "On message recieve from websocket without causing &#39;Websocket: Close 1011&#39;", "body": "<p>I'm trying to subscribe to an event from a client to a server. I can subscribe to the event using JavaScript but when I use <code>Golang</code> and the <code>Gorilla Websocket library</code> I get a</p>\n\n<blockquote>\n  <p>'websocket: close 1011 (internal server error)'</p>\n</blockquote>\n\n<p>every time I start a read from the socket.</p>\n\n<p>I tried using the <code>/x/websocket</code> library as well but when I tried to read from the socket I end up hanging and I dont get the '1011' error.</p>\n\n<p>If I use this JavaScript code on my browser it works:</p>\n\n<pre><code>&lt;html&gt;\n  &lt;head&gt;\n  &lt;/head&gt;\n  &lt;body&gt;\n    &lt;script&gt;\n        var socket = new WebSocket(\"ws://blehip:blehpport\");\n\n        function send(data) {\n            socket.send(JSON.stringify(data));\n        }\n\n        socket.onopen = function() {\n            send({\n                action: 'subscribe',\n                auth_token: 'Bleh',\n                request_id: 'Bleh',\n                data: {\n                    account_id: 'bleh',\n                    binding: \"bleh\"\n                }\n            });\n        }\n\n        socket.onmessage = function(raw_message) {\n            var json_data = JSON.parse(raw_message.data);\n\n            console.log(json_data);\n        };\n\n    &lt;/script&gt;\n  &lt;/body&gt;\n&lt;/html&gt;\n</code></pre>\n\n<p>I get a stream of JSON objects in real time.</p>\n\n<p>This is my small Golang, Gorilla/Websockets script</p>\n\n<pre><code>func main() {\n    var server = flag.String(\"server\", \"blehIP:BlehPort\", \"server address\")\n\n    var wg sync.WaitGroup\n    flag.Parse()\n\n    url := url.URL {\n        Scheme: \"ws\",\n        Host: *server,\n        Path: \"\",\n    }\n\n    conn, _, err := websocket.DefaultDialer.Dial(url.String(), nil)\n    if err != nil {\n        log.Fatal(\"Dial Error: \", err)\n    }\n    defer conn.Close()\n\n    payload := []byte(`{\"action\":\"subscribe\",`+\n                       `\"auth_token\":\"` + bleh + `\",`+\n                       `\"request_id\":\"` + bleh + `\",`+\n                       `\"data\": {`+\n                                `\"account_id\":\"` + bleh + `\",`+\n                                `\"binding\":\"` + bleh + `\"}`+\n                      `}`)\n\n    wg.Add(1)\n    go func() {\n        defer conn.Close()\n        defer wg.Done()\n\n        err = conn.WriteMessage(websocket.TextMessage, payload)\n        if err != nil {\n            log.Println(\"Write Error: \", err)\n            return\n        }\n\n        m := frame{}\n        err := conn.ReadJSON(&amp;m)\n        if err != nil {\n            log.Println(\"WebScoket closed.\", err)\n            return\n        }\n\n\n        // msg := string(bytes[:])\n        fmt.Printf(\"%v\", m)\n    }()\n    wg.Wait()\n\n    return\n}\n</code></pre>\n\n<blockquote>\n  <p>The error returned is: WebSocket closed. websocket: close 1011\n  (internal server error)</p>\n</blockquote>\n"}, {"tags": ["database", "postgresql", "go", "cloud"], "answers": [{"tags": [], "owner": {"reputation": 11, "user_id": 6909111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ead9cdcc60b6f4e62a4af5024a1be4?s=128&d=identicon&r=PG&f=1", "display_name": "anandsahil", "link": "https://stackoverflow.com/users/6909111/anandsahil"}, "is_accepted": false, "score": 1, "last_activity_date": 1559774208, "creation_date": 1559774208, "answer_id": 56468921, "question_id": 56468686, "link": "https://stackoverflow.com/questions/56468686/ensuring-unique-generated-keys-across-tables-in-more-than-one-machine/56468921#56468921", "title": "Ensuring unique generated keys across tables in more than one machine", "body": "<p>So snowflake provides 63 bit integer stored in an int64. According to the documentation you can generate 4096 unique IDs  every millisecond, per Node ID. Let's take the default implementation.That is 4096 * 1023 = 40961023 id's per millisecond and if you calculate in one second you can generate billions of unique id across multiple  nodes and will be very rare to get conflict. </p>\n\n<p>So i think if you pass a node id in env variable of the server and generate id's based upon that you should be safe.</p>\n\n<p>It also helps to add some prefix to the id based upon the entity or domain so that you get more entropy which will reduce the conflicts even less. </p>\n"}], "owner": {"reputation": 2067, "user_id": 5050577, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/6fad29dabd7e9a97a22e9ea535307165?s=128&d=identicon&r=PG&f=1", "display_name": "DanT29", "link": "https://stackoverflow.com/users/5050577/dant29"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 28, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559774208, "creation_date": 1559772529, "question_id": 56468686, "link": "https://stackoverflow.com/questions/56468686/ensuring-unique-generated-keys-across-tables-in-more-than-one-machine", "title": "Ensuring unique generated keys across tables in more than one machine", "body": "<p>I want to use this Go package <a href=\"https://github.com/bwmarrin/snowflake\" rel=\"nofollow noreferrer\">https://github.com/bwmarrin/snowflake</a> to generate primary int64 keys for my tables in Postgresql. If my application server is running on at least two machines how could I prevent duplicate keys from being generated?</p>\n"}, {"tags": ["go", "package-managers"], "comments": [{"owner": {"reputation": 4338, "user_id": 2080089, "user_type": "registered", "accept_rate": 85, "profile_image": "https://i.stack.imgur.com/GXxam.jpg?s=128&g=1", "display_name": "IcyFlame", "link": "https://stackoverflow.com/users/2080089/icyflame"}, "edited": false, "score": 2, "creation_date": 1559778683, "post_id": 56467943, "comment_id": 99530064, "body": "Are you using <code>dep</code> or <code>gomods</code> for dependency management?"}], "answers": [{"tags": [], "owner": {"reputation": 108, "user_id": 3226398, "user_type": "registered", "profile_image": "https://graph.facebook.com/825608468/picture?type=large", "display_name": "Nihanth Dara", "link": "https://stackoverflow.com/users/3226398/nihanth-dara"}, "is_accepted": true, "score": 1, "last_activity_date": 1559812050, "creation_date": 1559812050, "answer_id": 56474309, "question_id": 56467943, "link": "https://stackoverflow.com/questions/56467943/golang-update-vendor-dependencies-every-deploy/56474309#56474309", "title": "Golang update vendor dependencies every deploy", "body": "<p>If you are using go 1.11 and above <a href=\"https://blog.golang.org/using-go-modules\" rel=\"nofollow noreferrer\">go mod</a> for prior versions\nyou can use <a href=\"https://golang.github.io/dep/docs/introduction.html\" rel=\"nofollow noreferrer\">go dep</a></p>\n"}], "owner": {"reputation": 773, "user_id": 5407287, "user_type": "registered", "accept_rate": 66, "profile_image": "https://www.gravatar.com/avatar/49bdb5440d34f0cb4b0ad6c117e8a04e?s=128&d=identicon&r=PG&f=1", "display_name": "LivingRobot", "link": "https://stackoverflow.com/users/5407287/livingrobot"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1258, "favorite_count": 0, "accepted_answer_id": 56474309, "answer_count": 1, "score": 1, "last_activity_date": 1559812050, "creation_date": 1559768455, "question_id": 56467943, "link": "https://stackoverflow.com/questions/56467943/golang-update-vendor-dependencies-every-deploy", "title": "Golang update vendor dependencies every deploy", "body": "<p>I'm fairly new to Go coming from a Java background and am trying to figure out best practices for Go dependency management. </p>\n\n<p>If I have Project A that has a dependency on Project B and I put a reference to Project B in my vendor package then running <code>go install</code> downloads everything I need. However, let's say I find a bug in Project B that I fix, how do I ensure that Project A stays up to date? As in, is there some way to do an install on every deploy to make sure that I'm not missing anything? </p>\n\n<p>In Java, on every deploy I would do my own <code>mvn package</code> to best ensure that each deploy was self-sufficient. Is there some way to do the same in Go?  </p>\n\n<p>Apologies if this is a really basic question - but I couldn't find a good answer. </p>\n"}, {"tags": ["go", "struct"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 4, "creation_date": 1559767368, "post_id": 56467625, "comment_id": 99526958, "body": "&quot;in fact it returns address of newData&quot; - they&#39;re the same, addresses of a struct and its first field."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 3, "last_activity_date": 1559767108, "creation_date": 1559767108, "answer_id": 56467682, "question_id": 56467625, "link": "https://stackoverflow.com/questions/56467625/how-to-get-memory-address-of-an-embedded-slice-in-a-struct/56467682#56467682", "title": "How to get memory address of an embedded slice in a struct?", "body": "<p><code>listData</code> is the first field in the struct, its memory offset relative to the struct's address is zero, so they have the same address.</p>\n\n<pre><code>type t2 struct {\nlistData []string\nmoreData []int\n}\n\nfunc main() {\n    var foo t2\n    fmt.Printf(\"%p %p %p\", &amp;foo, &amp;foo.listData, &amp;foo.moreData)\n}\n</code></pre>\n\n<blockquote>\n  <p>0x43e260 0x43e260 0x43e26c</p>\n</blockquote>\n\n<p><a href=\"https://play.golang.org/p/FVMujcUHHYq\" rel=\"nofollow noreferrer\">https://play.golang.org/p/FVMujcUHHYq</a></p>\n"}], "owner": {"reputation": 5001, "user_id": 205463, "user_type": "registered", "accept_rate": 71, "profile_image": "https://i.stack.imgur.com/gK32M.jpg?s=128&g=1", "display_name": "Seyed Vahid Hashemi", "link": "https://stackoverflow.com/users/205463/seyed-vahid-hashemi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 36, "favorite_count": 0, "accepted_answer_id": 56467682, "answer_count": 1, "score": 1, "last_activity_date": 1559767473, "creation_date": 1559766879, "last_edit_date": 1559767473, "question_id": 56467625, "link": "https://stackoverflow.com/questions/56467625/how-to-get-memory-address-of-an-embedded-slice-in-a-struct", "title": "How to get memory address of an embedded slice in a struct?", "body": "<p>How can I get the memory address of an embedded slice in a struct?</p>\n\n<p>Example:</p>\n\n<pre><code>type t1 struct {\n    data string\n}\n\ntype t2 struct {\n    listData []t1\n}\n</code></pre>\n\n<p>Now I want to know the memory address of <code>listData</code>. I couldn't figure out how to get the memory address out of it using the following:</p>\n\n<pre><code>newData := t2{}\nnewData.listData = append(newData.listData, t1{data:\"mydata\"})\nprintf(\"%p\", &amp;newData.listData) // this doesn't work, in fact it returns address of newData\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": true, "score": 1, "last_activity_date": 1559766769, "creation_date": 1559766769, "answer_id": 56467602, "question_id": 56467534, "link": "https://stackoverflow.com/questions/56467534/golang-wire-is-throwing-wire-type-x-does-not-implement-interface-error/56467602#56467602", "title": "Golang wire is throwing wire: type x does not implement interface error", "body": "<p>The type is wrong. Your receiver is <code>*MyFooer</code>; your value is (as the error says) <code>**MyFooer</code>. This is because you're calling <code>new(*MyFooer)</code>; <code>new</code> already returns a pointer to the type passed, so since you're passing a pointer type to it, you're getting a pointer to a pointer.</p>\n\n<p>Change the line as follows to fix this error:</p>\n\n<pre><code>wire.Bind(new(Fooer), new(MyFooer))\n</code></pre>\n"}], "owner": {"reputation": 632, "user_id": 3931709, "user_type": "registered", "accept_rate": 67, "profile_image": "https://i.stack.imgur.com/q2GUv.jpg?s=128&g=1", "display_name": "yesIcan", "link": "https://stackoverflow.com/users/3931709/yesican"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 529, "favorite_count": 0, "accepted_answer_id": 56467602, "answer_count": 1, "score": 1, "last_activity_date": 1559766769, "creation_date": 1559766431, "question_id": 56467534, "link": "https://stackoverflow.com/questions/56467534/golang-wire-is-throwing-wire-type-x-does-not-implement-interface-error", "title": "Golang wire is throwing wire: type x does not implement interface error", "body": "<p>Here is a sample code most of it is copied from official golang doc    <a href=\"https://github.com/google/wire/blob/master/docs/guide.md#binding-interfaces\" rel=\"nofollow noreferrer\">here</a>\nI only added the last piece of code which generates an instance for a type that consumes Fooer interface. </p>\n\n<pre><code> type Fooer interface {\n        Foo() string\n}\n\ntype MyFooer string\n\nfunc (b *MyFooer) Foo() string {\n    return string(*b)\n}\n\nfunc provideMyFooer() *MyFooer {\n    b := new(MyFooer)\n    *b = \"Hello, World!\"\n    return b\n}\n\ntype Bar string\n\nfunc provideBar(f Fooer) string {\n    // f will be a *MyFooer.\n    return f.Foo()\n}\n\ntype test struct {\n    f Fooer \n}\nvar Set = wire.NewSet(\n    provideMyFooer,\n    wire.Bind(new(Fooer), new(*MyFooer)),\n    provideBar)\n// InitializeMasterRepo init repo\nfunc testbuild() test  {\n    wire.Build(\n        Set)\n    return test{}\n}\n</code></pre>\n\n<p>However, I am getting the following error</p>\n\n<pre><code>wire: D:\\git\\go\\vendor.manager\\src\\lib\\di\\appbuild.go:50:5: **vendor.manager/lib/di.MyFooer does not implement vendor.manager/lib/di.Fooer\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 777, "user_id": 4809932, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/83a7z.png?s=128&g=1", "display_name": "bajro", "link": "https://stackoverflow.com/users/4809932/bajro"}, "edited": false, "score": 0, "creation_date": 1559763843, "post_id": 56466899, "comment_id": 99525461, "body": "Is <code>retval</code> a boolean? If so, do you want to return the <code>retval</code> as bool or another value? And do you want to return the <code>err</code> from <code>myOtherFunc()</code> or a custom error?"}, {"owner": {"reputation": 387, "user_id": 7447711, "user_type": "registered", "accept_rate": 36, "profile_image": "https://www.gravatar.com/avatar/06fc8aa94e57d803061286afdcd0f309?s=128&d=identicon&r=PG&f=1", "display_name": "Mikael", "link": "https://stackoverflow.com/users/7447711/mikael"}, "edited": false, "score": 1, "creation_date": 1559766854, "post_id": 56466899, "comment_id": 99526724, "body": "You can either write an ordering function from scratch or make it so <code>myOtherFunc</code> never returns an error. <code>sort.Sort()</code> is for simple things."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559767554, "post_id": 56466899, "comment_id": 99527038, "body": "Before sorting call myOtherFunc for every slice element, store the results, and only if all calls succeed sort the slice."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1559797503, "post_id": 56466899, "comment_id": 99533140, "body": "If Less can error it means your input is only partial orderable and sorting it is not possible by definition."}], "answers": [{"tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 3, "last_activity_date": 1559766616, "creation_date": 1559766616, "answer_id": 56467568, "question_id": 56466899, "link": "https://stackoverflow.com/questions/56466899/correct-way-of-handling-an-error-when-implementing-less/56467568#56467568", "title": "Correct way of handling an error when implementing Less()", "body": "<p>You can't; the closest solution would be to use <a href=\"https://golang.org/pkg/sort/#Slice\" rel=\"nofollow noreferrer\"><code>sort.Slice</code></a> instead, with a closure you can use to trap the error(s) in the outer scope:</p>\n\n<pre><code>errs := make([]error)\nsort.Slice(mySlice, func(i, j int) bool {\n     retval, err := myOtherFunc(mySlice[i])\n     if err != nil {\n        errs = append(errs, err)\n     }\n     return retval\n})\nif len(errs) &gt; 0 {\n    // do something about errors\n}\n</code></pre>\n\n<p>This won't stop sorting at the first error (you can't), but it at least lets you collect them. The <code>sort</code> package is meant for typical sorting heuristics like alphabetical, numeric, or alpha/numeric on a struct field or the like; not for more complex processes with the possibility of failure.</p>\n"}], "owner": {"reputation": 591, "user_id": 9100341, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ae65adeb72d7795eb2d12ed270c4cff2?s=128&d=identicon&r=PG&f=1", "display_name": "learnlearnlearn", "link": "https://stackoverflow.com/users/9100341/learnlearnlearn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 45, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1559766616, "creation_date": 1559763261, "question_id": 56466899, "link": "https://stackoverflow.com/questions/56466899/correct-way-of-handling-an-error-when-implementing-less", "title": "Correct way of handling an error when implementing Less()", "body": "<p>I'm writing a sort function for a specific type. When writing the receiver \"Less()\" I call another function that might return an error. As Less() itself returns a bool what is the right way to handle this scenario? I don't want to panic, but I'd like to indicate that the attempt at sorting has failed, such that the function calling sort.Sort() can decide what to do with the error. However, sort.Sort() does not seem to return an error either so I'm guessing there is another way to go about this.</p>\n\n<pre><code>func (t MyType) Less(i, j int) bool {\n     retval, err := myOtherFunc(t[i])\n     // How do I handle err?\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1559762971, "post_id": 56466806, "comment_id": 99525132, "body": "Without knowing specifically what &quot;the ones I saw online&quot; are it&#39;s impossible to say if this is more or less <i>efficient</i>, but given that it operates on bytes instead of runes, it&#39;s not UTF-compatible (it will break any multibyte characters)."}, {"owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559763465, "post_id": 56466806, "comment_id": 99525316, "body": "I don&#39;t care about multibyte characters."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559764788, "post_id": 56466806, "comment_id": 99525855, "body": "Both methods use a <code>for</code> loop. :shrug:"}, {"owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "edited": false, "score": 0, "creation_date": 1559764817, "post_id": 56466806, "comment_id": 99525873, "body": "Yeah, that&#39;s why I asked."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1559765034, "post_id": 56466806, "comment_id": 99525968, "body": "In this case, it&#39;s not clear what is the question (the title, at least). Code with a <code>for</code> loop can be very efficient. Or not. Depending on what you put <i>in</i> the loop."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 7, "creation_date": 1559766234, "post_id": 56466806, "comment_id": 99526457, "body": "Any time you&#39;re curious which of two approaches is more efficient, <a href=\"https://golang.org/pkg/testing/#hdr-Benchmarks\" rel=\"nofollow noreferrer\">benchmark them</a>."}], "answers": [{"comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559766287, "post_id": 56467263, "comment_id": 99526473, "body": "The method with swap runes seems to scale <i>sublinearly</i>. Interesting."}], "tags": [], "owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "is_accepted": true, "score": 4, "last_activity_date": 1559766317, "last_edit_date": 1559766317, "creation_date": 1559765125, "answer_id": 56467263, "question_id": 56466806, "link": "https://stackoverflow.com/questions/56466806/is-it-inefficient-to-reverse-a-string-by-using-a-for-loop-in-golang/56467263#56467263", "title": "Is it inefficient to reverse a string by using a for loop in golang?", "body": "<blockquote>\n  <p>I'd like to know is my method less efficient than the ones I saw online that use runes</p>\n</blockquote>\n\n<p>Nothing to do with runes or <code>for</code> loop. Your method builds and rebuilds and rebuilds a string, over and over. Whereas the other one reverses the string in-place, by simply swapping characters. And the difference is only getting worse with larger strings.</p>\n\n<pre><code>package main\n\nimport \"testing\"\n\nfunc reverseConcat(str string) string {\n    var reversed string\n\n    for i := len(str) - 1; i &gt;= 0; i-- {\n        reversed += string(str[i])\n    }\n\n    return reversed\n}\n\nfunc reverseSwapRunes(s string) string {\n    chars := []rune(s)\n    for i, j := 0, len(chars)-1; i &lt; j; i, j = i+1, j-1 {\n        chars[i], chars[j] = chars[j], chars[i]\n    }\n    return string(chars)\n}\n\nfunc BenchmarkConcatSmall(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        reverseConcat(\"hello world\")\n    }\n}\n\nfunc BenchmarkSwapRunesSmall(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        reverseSwapRunes(\"hello world\")\n    }\n}\n\nfunc BenchmarkConcatLarger(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        reverseConcat(\"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.\")\n    }\n}\n\nfunc BenchmarkSwapRunesLarger(b *testing.B) {\n    for i := 0; i &lt; b.N; i++ {\n        reverseSwapRunes(\"Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since the 1500s, when an unknown printer took a galley of type and scrambled it to make a type specimen book. It has survived not only five centuries, but also the leap into electronic typesetting, remaining essentially unchanged. It was popularised in the 1960s with the release of Letraset sheets containing Lorem Ipsum passages, and more recently with desktop publishing software like Aldus PageMaker including versions of Lorem Ipsum.\")\n    }\n}\n</code></pre>\n\n<p>Results</p>\n\n<pre><code>$ go test -bench . -benchmem\ngoos: linux\ngoarch: amd64\nBenchmarkConcatSmall-8           5000000           329 ns/op          80 B/op         10 allocs/op\nBenchmarkSwapRunesSmall-8       20000000           117 ns/op          16 B/op          1 allocs/op\nBenchmarkConcatLarger-8            30000         44877 ns/op      172833 B/op        573 allocs/op\nBenchmarkSwapRunesLarger-8        300000          5353 ns/op        2944 B/op          2 allocs/op\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 6783, "user_id": 55504, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/69443d894baa7969afa69ca6b34b725b?s=128&d=identicon&r=PG", "display_name": "Dave C", "link": "https://stackoverflow.com/users/55504/dave-c"}, "edited": false, "score": 0, "creation_date": 1566733216, "post_id": 57645332, "comment_id": 101742451, "body": "If you know (or have an estimate for) the final size you should pre-allocate the builder: <code>sb.Grow(len(in))</code>."}], "tags": [], "owner": {"reputation": 58368, "user_id": 30038, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/mPvRH.jpg?s=128&g=1", "display_name": "Vlad Bezden", "link": "https://stackoverflow.com/users/30038/vlad-bezden"}, "is_accepted": false, "score": 0, "last_activity_date": 1566730059, "creation_date": 1566730059, "answer_id": 57645332, "question_id": 56466806, "link": "https://stackoverflow.com/questions/56466806/is-it-inefficient-to-reverse-a-string-by-using-a-for-loop-in-golang/57645332#57645332", "title": "Is it inefficient to reverse a string by using a for loop in golang?", "body": "<p>Your first solution will only work with ASCII characters, because len(str) gives you len in bytes, and str[i] also return byte. As soon as you get to deal with Unicode it will fail, because one Unicode (rune) can have more than one byte.</p>\n\n<pre><code>type byte = uint8\ntype rune = int32\n</code></pre>\n\n<p>So your second solution will work with any type of string characters.</p>\n\n<p>Another example is to use strings.Builder</p>\n\n<pre><code>func Reverse(in string) string {\n    var sb strings.Builder\n    runes := []rune(in)\n    for i := len(runes) - 1; 0 &lt;= i; i-- {\n        sb.WriteRune(runes[i])\n    }\n    return sb.String()\n}\n</code></pre>\n\n<p>which is in my tests performs almost the same as in array replacement (your second example) - 3 times faster than string concatenation.</p>\n\n<pre><code>BenchmarkReverseStrConcat-8    1000000  1571 ns/op  176 B/op    29 allocs/op     \nBenchmarkReverseStrBuilder-8   3000000  499 ns/op   56 B/op 6 allocs/op\n</code></pre>\n"}], "owner": {"reputation": 1568, "user_id": 4239355, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1062734612/picture?type=large", "display_name": "Zoltan King", "link": "https://stackoverflow.com/users/4239355/zoltan-king"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 98, "favorite_count": 0, "accepted_answer_id": 56467263, "answer_count": 2, "score": -1, "last_activity_date": 1566730059, "creation_date": 1559762755, "last_edit_date": 1559763642, "question_id": 56466806, "link": "https://stackoverflow.com/questions/56466806/is-it-inefficient-to-reverse-a-string-by-using-a-for-loop-in-golang", "title": "Is it inefficient to reverse a string by using a for loop in golang?", "body": "<p>I did it like this Golang:</p>\n\n<pre><code>func reverseStr(str string) string {\n    var reversed string\n\n    for i := len(str) - 1; i &gt;= 0; i-- {\n        reversed += string(str[i])\n    }\n\n    return reversed\n}\n</code></pre>\n\n<p>I'm a beginner and can't do better for now, but I'm still learning. I'd like to know is my method less efficient than the ones I saw online that use runes:</p>\n\n<pre><code>func reverse(s string) string {\n    chars := []rune(s)\n    for i, j := 0, len(chars)-1; i &lt; j; i, j = i+1, j-1 {\n        chars[i], chars[j] = chars[j], chars[i]\n    }\n    return string(chars)\n}\n</code></pre>\n"}, {"tags": ["go", "grpc"], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 1, "last_activity_date": 1559793316, "creation_date": 1559793316, "answer_id": 56470701, "question_id": 56466315, "link": "https://stackoverflow.com/questions/56466315/grpc-when-get-a-new-client/56470701#56470701", "title": "GRPC: when get a new client?", "body": "<p>Create a gRPC client just once.</p>\n\n<p>Lots of networking concepts in go are designed for reuse: http clients, http transports, sql.DB connection pools etc. They are all go-routine safe &amp; should only be created once but reused many times.</p>\n"}], "owner": {"reputation": 1, "user_id": 6113216, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xL_zgZGUIxU/AAAAAAAAAAI/AAAAAAAAJTE/hF5qSiGXUA0/photo.jpg?sz=128", "display_name": "cloverzrg", "link": "https://stackoverflow.com/users/6113216/cloverzrg"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559793316, "creation_date": 1559760253, "question_id": 56466315, "link": "https://stackoverflow.com/questions/56466315/grpc-when-get-a-new-client", "title": "GRPC: when get a new client?", "body": "<p>I am using grpc in my project, if i have a grpc service call helloService, should i use GetNewHelloServiceClient to get a new client in every function? Or just get once in start program?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// for example:\n\nc.GET(\"/hello\", SayHello)\n\nfunc SayHello() {\n    c := pb.GetNewHelloServiceClient()\n    res, err := c.SayHello(context.Background(), &amp;request)\n\n    if err != nil {\n     return\n    }\n    fmt.print(res.Hello)\n}\n</code></pre>\n"}, {"tags": ["windows", "go", "cmd", "ascii", "command-prompt"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559738996, "post_id": 56460651, "comment_id": 99513087, "body": "fmt.Print(&quot;\\033c&quot;) properly clears the screen on a &quot;normal&quot; terminal. Probably this is a Windows only problem."}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1559750138, "post_id": 56460651, "comment_id": 99519676, "body": "There&#39;s a project on github, which seems to send <code>&quot;\\033[2J&quot;</code> to the output to clear the screen. It&#39;s not explicitly mentioned, but might be worth a shot (see if it supports windows): <a href=\"https://github.com/buger/goterm\" rel=\"nofollow noreferrer\">goterm</a>. There&#39;s a duplicate question about this, BTW: <a href=\"https://stackoverflow.com/questions/22891644/how-can-i-clear-the-terminal-screen-in-go\" title=\"how can i clear the terminal screen in go\">stackoverflow.com/questions/22891644/&hellip;</a>"}, {"owner": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1559750145, "post_id": 56460651, "comment_id": 99519680, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/22891644/how-can-i-clear-the-terminal-screen-in-go\">How can I clear the terminal screen in Go?</a>"}, {"owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "reply_to_user": {"reputation": 67504, "user_id": 1230836, "user_type": "registered", "accept_rate": 96, "profile_image": "https://i.stack.imgur.com/38PFC.jpg?s=128&g=1", "display_name": "Elias Van Ootegem", "link": "https://stackoverflow.com/users/1230836/elias-van-ootegem"}, "edited": false, "score": 0, "creation_date": 1559830081, "post_id": 56460651, "comment_id": 99549144, "body": "@EliasVanOotegem Thank you for your response, I have edited my question, I hope this clarifys that the ANSI escape code not working was the problem, I also answered my own question with the fix I found."}], "answers": [{"comments": [{"owner": {"reputation": 3570, "user_id": 1050382, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fd59c025c68ece3e784402a0853ec49c?s=128&d=identicon&r=PG&f=1", "display_name": "Matmarbon", "link": "https://stackoverflow.com/users/1050382/matmarbon"}, "edited": false, "score": 1, "creation_date": 1567289963, "post_id": 56460928, "comment_id": 101922908, "body": "You have no idea how long it took me, to find this solution! Thank you! It is also worth mentioning for the beginners (like me) that the <code>&#47;&#47; #include &quot;Windows.h&quot;</code> line is actually <i>necessary</i> even though it looks like a comment. Also <code>gcc</code> should be installed - which I just did via MinGW and change of the <code>%PATH%</code> variable."}, {"owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "reply_to_user": {"reputation": 3570, "user_id": 1050382, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/fd59c025c68ece3e784402a0853ec49c?s=128&d=identicon&r=PG&f=1", "display_name": "Matmarbon", "link": "https://stackoverflow.com/users/1050382/matmarbon"}, "edited": false, "score": 0, "creation_date": 1567511588, "post_id": 56460928, "comment_id": 101977346, "body": "@Matmarbon glad I could help and thank you for the tip I added it to the answer"}], "tags": [], "owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "is_accepted": true, "score": 3, "last_activity_date": 1567511556, "last_edit_date": 1567511556, "creation_date": 1559739309, "answer_id": 56460928, "question_id": 56460651, "link": "https://stackoverflow.com/questions/56460651/golang-fmt-print-033c-and-fmt-print-x1bc-are-not-clearing-screenansi-es/56460928#56460928", "title": "Golang fmt.Print(&quot;\\033c&quot;) and fmt.Print(&quot;\\x1bc&quot;) are not clearing screen(ANSI Escape code not working) how to fix?", "body": "<p>The problem was that windows needs the ENABLE_VIRTUAL_TERMINAL_PROCESSING(0x0004) console flag I fixed it by using the following code to add the flag to the console:</p>\n\n<pre><code>package main\n\n// #include \"Windows.h\"\nimport \"C\"\nimport \"fmt\"\n\nfunc main() {\n    // Needed for getting handle and getting current console mode\n    var mode C.DWORD\n    handle := C.GetStdHandle(C.STD_OUTPUT_HANDLE)\n    C.GetConsoleMode(handle, &amp;mode)\n\n    // Enable Virtual Terminal Processing by adding the flag to the current mode\n    C.SetConsoleMode(handle, mode|0x0004)\n    fmt.Print(\"\\033c\")\n}\n</code></pre>\n\n<p><a href=\"https://docs.microsoft.com/en-us/windows/console/setconsolemode\" rel=\"nofollow noreferrer\">SetConsoleMode</a></p>\n\n<p>===EDIT===</p>\n\n<p>Like Matmarbon mentioned in the comments <code>// #include \"Windows.h\"</code> line is nessecary and you need to have an <code>gcc</code> installed</p>\n"}], "owner": {"reputation": 313, "user_id": 7219283, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ef2fa27a5429cf4bbb4736e20a8c6299?s=128&d=identicon&r=PG&f=1", "display_name": "Ian.V", "link": "https://stackoverflow.com/users/7219283/ian-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 604, "favorite_count": 1, "accepted_answer_id": 56460928, "answer_count": 1, "score": 1, "last_activity_date": 1573376564, "creation_date": 1559738302, "last_edit_date": 1573376564, "question_id": 56460651, "link": "https://stackoverflow.com/questions/56460651/golang-fmt-print-033c-and-fmt-print-x1bc-are-not-clearing-screenansi-es", "title": "Golang fmt.Print(&quot;\\033c&quot;) and fmt.Print(&quot;\\x1bc&quot;) are not clearing screen(ANSI Escape code not working) how to fix?", "body": "<p>Whenever I run <code>fmt.Print(\"\\033c\")</code> in Go on Windows cmd it does not clear screen but prints <code>c</code> whenever I do <code>console.log(\"\\033c\")</code> in javascript it works fine.</p>\n\n<p>According to the following links this should have worked:\n<a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code#Windows\" rel=\"nofollow noreferrer\">https://en.wikipedia.org/wiki/ANSI_escape_code#Windows</a></p>\n\n<p><a href=\"https://docs.microsoft.com/en-us/windows/console/console-virtual-terminal-sequences#samples\" rel=\"nofollow noreferrer\">https://docs.microsoft.com/en-us/windows/console/console-virtual-terminal-sequences#samples</a></p>\n\n<p>I have tried logging it in javascript and it works fine I also tried adding a \\n character to the end which printed <code>c</code> and changing it to \\x1bc which also just printed: <code>c</code></p>\n\n<p>the following all prints: <code>c</code> on windows cmd</p>\n\n<pre><code>\nfunc main() {\n  fmt.Print(\"\\033c\")\n  fmt.Print(\"\\033c\\n\")\n  fmt.Print(\"\\x1bc\")\n  fmt.Print(\"\\x1bc\\n\")\n  fmt.Println(\"\\033c\")\n  fmt.Println(\"\\x1bc\")\n}\n</code></pre>\n\n<p>I expected that it would just clear the screen as in javascript but for some reason it doesn't</p>\n\n<p>To clarify I am talking about that the <a href=\"https://en.wikipedia.org/wiki/ANSI_escape_code\" rel=\"nofollow noreferrer\">ANSI escape code</a> is not working.</p>\n"}, {"tags": ["api", "go", "download"], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1559737559, "creation_date": 1559737559, "answer_id": 56460475, "question_id": 56460217, "link": "https://stackoverflow.com/questions/56460217/what-the-404-error-when-im-trying-download-file-with-post-to-my-api/56460475#56460475", "title": "What the 404 error when im trying download file with POST to my api?", "body": "<p>HTTP status 404 means the server couldn't find the requested URL. This appears to make perfect sense given your curl command.  You appear to be requesting the URL <code>http://localhost:8000/submit</code>, but your application only has a single route:</p>\n\n<pre><code>router.POST(\"/submit/:url\", submit)\n</code></pre>\n\n<p>This route requires a second URL segment after <code>/submit</code>, such as <code>/submit/foo</code>.</p>\n"}], "owner": {"reputation": 11, "user_id": 11603462, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d46ea3f5f01a3d887ff795f344d5f340?s=128&d=identicon&r=PG&f=1", "display_name": "mikhail_affog", "link": "https://stackoverflow.com/users/11603462/mikhail-affog"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 178, "favorite_count": 0, "answer_count": 1, "score": -3, "last_activity_date": 1559737559, "creation_date": 1559736569, "last_edit_date": 1559737491, "question_id": 56460217, "link": "https://stackoverflow.com/questions/56460217/what-the-404-error-when-im-trying-download-file-with-post-to-my-api", "title": "What the 404 error when im trying download file with POST to my api?", "body": "<p>Here api to go which should load the file when posting a request of the form </p>\n\n<pre><code>curl -X POST -d \"url = http: //site.com/file.txt\" http: // localhost: 8000 / submit\n</code></pre>\n\n<p>But 404 gets out, what's the reason?\nOr how to download files via POST in API?</p>\n\n<pre><code>func downloadFile(url string) Task {\n    var task Task\n    resp, err := http.Get(url)\n    if err != nil {\n        fmt.Println(\"Error while downloading\")\n    }\n    defer resp.Body.Close()\n    filename := strings.Split(url, \"/\")[len(strings.Split(url, \"/\"))-1]\n    fmt.Println(filename)\n    out, err := os.Create(filename)\n    if err != nil {\n        fmt.Println(\"Error while downloading\")\n    }\n    defer out.Close()\n    _, err = io.Copy(out, resp.Body)\n    fmt.Println(\"Error while downloading\")\n}\n\nfunc submit(c *gin.Context) {\n    c.Header(\"Content-Description\", \"File Transfer\")\n    c.Header(\"Content-Transfer-Encoding\", \"binary\")\n    url := c.Param(\"url\")\n    fmt.Println(\"url \" + url)\n    task := downloadFile(url)\n    hashFile(task.ID)\n    c.JSON(200, task.ID)\n}\n\nfunc main() {\n    router := gin.Default()\n    router.POST(\"/submit/:url\", submit)\n}\n</code></pre>\n"}, {"tags": ["go", "kubernetes", "grpc", "alpine", "google-cloud-bigtable"], "comments": [{"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1559736550, "post_id": 56460172, "comment_id": 99511767, "body": "{dns:///bigtable.googleapis.com:443 0  1} shouldn&#39;t it be {dns://bigtable.googleapis.com:443 0  1}"}, {"owner": {"reputation": 1281, "user_id": 7614909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-GrKHRMcYN5c/AAAAAAAAAAI/AAAAAAAAAEQ/p_8nqTU7_FY/photo.jpg?sz=128", "display_name": "Akshay Apte", "link": "https://stackoverflow.com/users/7614909/akshay-apte"}, "reply_to_user": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 0, "creation_date": 1559737004, "post_id": 56460172, "comment_id": 99511966, "body": "I am not configuring the dns. The google bigtable client internally makes the gRPC connection"}, {"owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "edited": false, "score": 1, "creation_date": 1559740434, "post_id": 56460172, "comment_id": 99513965, "body": "have you installed CA certificates on your alpine pod ?"}, {"owner": {"reputation": 12299, "user_id": 609290, "user_type": "registered", "accept_rate": 62, "profile_image": "https://i.stack.imgur.com/WUBht.jpg?s=128&g=1", "display_name": "DazWilkin", "link": "https://stackoverflow.com/users/609290/dazwilkin"}, "edited": false, "score": 0, "creation_date": 1559962042, "post_id": 56460172, "comment_id": 99594671, "body": "It&#39;s a curious error but there is no parameterless <code>NewClient</code> function in the library. You need to provide <code>context.Context</code>, the <code>project</code> and <code>instance</code> as well as optional <code>opts</code>. See <a href=\"https://godoc.org/cloud.google.com/go/bigtable#NewClient\" rel=\"nofollow noreferrer\">godoc.org/cloud.google.com/go/bigtable#NewClient</a>. I assume you&#39;re correctly passing Application Default Credentials too and are mounting these as a secret in order that the credentials are accessible to your container(s)."}], "answers": [{"tags": [], "owner": {"reputation": 1281, "user_id": 7614909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-GrKHRMcYN5c/AAAAAAAAAAI/AAAAAAAAAEQ/p_8nqTU7_FY/photo.jpg?sz=128", "display_name": "Akshay Apte", "link": "https://stackoverflow.com/users/7614909/akshay-apte"}, "is_accepted": false, "score": 2, "last_activity_date": 1562761655, "creation_date": 1562761655, "answer_id": 56970705, "question_id": 56460172, "link": "https://stackoverflow.com/questions/56460172/bigtable-client-initialization-stuck-in-kubernetes-container/56970705#56970705", "title": "Bigtable Client initialization stuck in Kubernetes container", "body": "<p>Upon debugging, the issue was with one of the dependencies used while building the container. Using Go modules <a href=\"https://github.com/golang/go/wiki/Modules\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules</a> to manage package versions solved the problem.</p>\n"}], "owner": {"reputation": 1281, "user_id": 7614909, "user_type": "registered", "accept_rate": 80, "profile_image": "https://lh4.googleusercontent.com/-GrKHRMcYN5c/AAAAAAAAAAI/AAAAAAAAAEQ/p_8nqTU7_FY/photo.jpg?sz=128", "display_name": "Akshay Apte", "link": "https://stackoverflow.com/users/7614909/akshay-apte"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 171, "favorite_count": 0, "answer_count": 1, "score": 3, "last_activity_date": 1562761655, "creation_date": 1559736374, "last_edit_date": 1560200191, "question_id": 56460172, "link": "https://stackoverflow.com/questions/56460172/bigtable-client-initialization-stuck-in-kubernetes-container", "title": "Bigtable Client initialization stuck in Kubernetes container", "body": "<p>We are trying to run a Golang app on Kubernetes which talks to Bigtable. The application seems to be stuck at creating the client:</p>\n\n<pre><code>bigtableClient := bigtable.NewClient()\n</code></pre>\n\n<p>upon setting the log level to info using:</p>\n\n<pre><code>export GRPC_GO_LOG_SEVERITY_LEVEL=\"INFO\"\n</code></pre>\n\n<p>the error message is like this:</p>\n\n<pre><code>WARNING: 2019/06/05 08:14:13 grpc: addrConn.createTransport failed to connect to {dns:///bigtable.googleapis.com:443 0  1}. Err :connection error: desc = \"transport: Error while dialing dial tcp: address dns:///bigtable.googleapis.com:443: too many colons in address\". Reconnecting...\nWA\n</code></pre>\n\n<p>We tried using the Alpine docker image but doesn't seem to work.\nHas anybody faced this before?</p>\n"}, {"tags": ["go", "cgo"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559733489, "post_id": 56459197, "comment_id": 99510367, "body": "I doubt you can: You probably have to do the bitfiddeling yourself."}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559733557, "post_id": 56459197, "comment_id": 99510397, "body": "But how (without writing more C code)?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1559733666, "post_id": 56459197, "comment_id": 99510452, "body": "@abergmeier: golang has bitwise operators too: <a href=\"https://yourbasic.org/golang/bitwise-operator-cheat-sheet/\" rel=\"nofollow noreferrer\">yourbasic.org/golang/bitwise-operator-cheat-sheet</a>"}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "edited": false, "score": 0, "creation_date": 1559733790, "post_id": 56459197, "comment_id": 99510507, "body": "Bitwise operators only help me once I have a field to access."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559734473, "post_id": 56459197, "comment_id": 99510791, "body": "What is wrong with <code>ms &amp; 0x80 != 0</code> and <code>ms &amp; 0x7f</code> ?"}, {"owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "edited": false, "score": 0, "creation_date": 1559734837, "post_id": 56459197, "comment_id": 99510943, "body": "To clarify - <code>ms</code> is an instance of <code>MASK_SETTINGS</code>. If I try to access it directly it is of type <code>_Ctype_struct_MASK_SETTINGS</code> and thus e.g. shifting not possible. I can of course write a C function, which combines <code>foo</code> and <code>bar</code> into a <code>uint32_t</code> and consume that value in Go. I was wondering whether there is any chance to consume bitfields withouth having to write C code. If that is not what you meant could you clarify please."}], "answers": [{"tags": [], "owner": {"reputation": 2652, "user_id": 1395620, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bd851cb368a0747715f41fda62a49ca8?s=128&d=identicon&r=PG", "display_name": "Daniel Santos", "link": "https://stackoverflow.com/users/1395620/daniel-santos"}, "is_accepted": false, "score": 1, "last_activity_date": 1597394776, "last_edit_date": 1597394776, "creation_date": 1597394344, "answer_id": 63409372, "question_id": 56459197, "link": "https://stackoverflow.com/questions/56459197/how-to-access-c-bitfield-in-go/63409372#63409372", "title": "How to access C bitfield in Go", "body": "<p>Well you won't like this answer, but</p>\n<ol>\n<li>there is no portable way to do this because bitfield packing is &quot;implementation-defined&quot; in both C and C++, and</li>\n<li>bitfield support in Go seems fairly crappy (perhaps due to #1).</li>\n</ol>\n<p>First of all, the layout of bitfields is implementation-defined in every existing C and C++ standard.  This means that none of the standards specify how bits in a bitfield definition should be packed (i.e., where they should go) -- it's totally up to the compiler.  You may find how they are laid out to be a certain way <em>in practice</em> given a few compiler samples, but you will be deep into undefined behavior territory.</p>\n<p>We are working on this issue in gcc under <a href=\"https://gcc.gnu.org/bugzilla/show_bug.cgi?id=83784\" rel=\"nofollow noreferrer\">bug #83784</a> (and by &quot;we&quot; I mean Andrew Pinski), and I'm hoping that in gcc 10 or 11 we'll have an optimal solution.  To be clear, there is a solution now -- it is use a union and define pack and unpack functions to read each bitfield and manually put the data where it belongs in memory.  The issue is that when you have properly guessed the bit layout gcc uses then the function should become no-ops and &quot;compile-away&quot;.  This is currently not happening.</p>\n<p>Example:</p>\n<pre><code>union a {\n    struct {\n        int field1:12;\n        int field2:20;\n    };\n    int packed;\n};\n\nstatic union a a_pack(union a a)\n{\n    union a ret = {0};\n\n    ret.packed = (a.field1 &amp; ((1 &lt;&lt; 12) - 1) &lt;&lt; 20;\n    ret.packed |= a.field2 &amp; ((1 &lt;&lt; 20) - 1)\n\n    return ret;\n}\n\nstatic union a a_unpack(union a a)\n{\n    union a ret = {0};\n\n    ret.field1 = a.packed &gt;&gt; 20;\n    ret.field2 = a.packed &amp; ((1 &lt;&lt; 20) - 1);\n\n    return ret;\n}\n</code></pre>\n<p>Once you do this, you can &quot;pack&quot; your bitfield, read a.packed from Go and then either bit fiddle it or use <a href=\"https://godoc.org/golang.org/x/text/internal/gen/bitfield\" rel=\"nofollow noreferrer\">one of the bitfield implementations</a>.</p>\n<p>I told you you wouldn't like the answer. :)</p>\n"}], "owner": {"reputation": 11210, "user_id": 725937, "user_type": "registered", "accept_rate": 51, "profile_image": "https://www.gravatar.com/avatar/32cba7500e49d4c491289f9e101c693b?s=128&d=identicon&r=PG", "display_name": "abergmeier", "link": "https://stackoverflow.com/users/725937/abergmeier"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1597394776, "creation_date": 1559732554, "question_id": 56459197, "link": "https://stackoverflow.com/questions/56459197/how-to-access-c-bitfield-in-go", "title": "How to access C bitfield in Go", "body": "<p>I have a struct like so:</p>\n\n<pre><code>typedef struct st_MASK_SETTINGS\n{\n  uint32_t foo  : 1;\n  uint32_t bar  : 7;\n} MASK_SETTINGS\n</code></pre>\n\n<p>Now through cgo I would like to access <code>foo</code> - but cannot find any documentation how to do so.</p>\n\n<p>Naive <code>v := ms.foo</code> complains <code>has no field or method</code>.</p>\n"}, {"tags": ["mysql", "performance", "go", "web", "query-optimization"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1559727069, "post_id": 56457741, "comment_id": 99507451, "body": "This question is <i>far</i> too broad. Start by learning how to use EXPLAIN to see how your queries are evaluated, play around with indices to optimize your queries. Learn how to combine nested queries into one. Learn how to tune performance of Go programs."}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559727488, "post_id": 56457741, "comment_id": 99507662, "body": "@Volker Thank you for comment. This is point, since it&#39;s I&#39;m new to database optimisation and Go, this is where I&#39;m asking the direction. EXPLAIN I have already started looking."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559731311, "post_id": 56457741, "comment_id": 99509382, "body": "Another thing that will help: Use a join, rather than multiple queries in a loop."}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559733411, "post_id": 56457741, "comment_id": 99510323, "body": "@Flimzy, right, let me try it."}], "answers": [{"comments": [{"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559733131, "post_id": 56457831, "comment_id": 99510185, "body": "Thank you for reply. I was thinking about database opening also and found also on this <a href=\"http://go-database-sql.org/accessing.html\" rel=\"nofollow noreferrer\">go-database-sql.org/accessing.html</a> page, Don\u2019t Open() and Close() databases frequently. Instead, create one sql.DB object for each distinct datastore you need to access, and keep it until the program is done accessing that datastore. Pass it around as needed.  I made changes in code and in the question by adding global variable and init method, unfortunately it&#39;s the same result."}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559733331, "post_id": 56457831, "comment_id": 99510288, "body": "when I say the same I mean, around 5 second on first request and if you want to have 10 in the same time then around 50+ seconds. Moreover it&#39;s returning different length of results, sometimes 20 records, sometimes 7 and sometimes 1 record in response."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 1, "creation_date": 1559734602, "post_id": 56457831, "comment_id": 99510839, "body": "@yart Do you have database indices in place for your queries?"}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559763658, "post_id": 56457831, "comment_id": 99525385, "body": "Are you speaking about non-clustered indexes? Could you provide sample?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559811050, "post_id": 56457831, "comment_id": 99538519, "body": "@yart See <a href=\"https://www.tutorialspoint.com/mysql/mysql-indexes.htm\" rel=\"nofollow noreferrer\">MySQL - INDEXES</a> and <a href=\"https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html\" rel=\"nofollow noreferrer\">How MySQL Uses Indexes</a>."}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1560162415, "post_id": 56457831, "comment_id": 99633143, "body": "Combination of fixing keys and the way of opening database connection returned around 20ms-70ms timing. Thank you. Do you know why still sometimes it&#39;s 20ms and sometimes 70ms?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1560173079, "post_id": 56457831, "comment_id": 99638113, "body": "@yart That fluctuation might be the result of many things, e.g. if a new DB connection is made in the background, that obviously takes more time than if an existing one is just reused. Also the database server might respond to queries made in the past faster if they are cached. You should not worry about that if even the slowest is just 70 ms."}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1560173951, "post_id": 56457831, "comment_id": 99638547, "body": "thank again. One more clarification. Despite that I have globally defined connection to the database I still could have &quot;too much open connections&quot; if I will make let&#39;s 1000 requests in the same time or global definition of the db variables somehow also controls it?"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1560175030, "post_id": 56457831, "comment_id": 99639100, "body": "@yart The <code>sql.DB</code> manages an internal connection pool which by default does not limit open connections. Use <a href=\"https://golang.org/pkg/database/sql/#DB.SetMaxOpenConns\" rel=\"nofollow noreferrer\"><code>DB.SetMaxOpenConns()</code></a> to limit the max open connections."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 3, "last_activity_date": 1559810942, "last_edit_date": 1559810942, "creation_date": 1559727083, "answer_id": 56457831, "question_id": 56457741, "link": "https://stackoverflow.com/questions/56457741/how-to-optimize-response-time-for-simple-web-and-database-application/56457831#56457831", "title": "How to optimize response time for simple web and database application", "body": "<p>You connect to your database in your handler, every time a request is made to your server. This operation alone could take multiple seconds. Once the handler returns, you just throw away that connection (you don't even close that, so that may be idling for some time before getting closed, hogging db server resources as connections are most likely limited on the server). Don't do that.</p>\n\n<p>Connect to your database once, on app startup, and use this connection in your handler. The database will keep idle connections open, ready to be reused immediately should you need it in another request.</p>\n\n<p>Move your <code>db</code> variable outside, e.g. to a package-level variable, connect to your database and initialzie this <code>db</code> variable once, e.g. in your <code>main()</code> or in a package <code>init()</code> function, and just use it in your handler.</p>\n\n<p><a href=\"https://golang.org/pkg/database/sql/#Open\" rel=\"nofollow noreferrer\"><code>sql.Open()</code></a> documents that:</p>\n\n<blockquote>\n  <p>The returned DB is safe for concurrent use by multiple goroutines and maintains its own pool of idle connections. Thus, the Open function should be called just once. It is rarely necessary to close a DB.</p>\n</blockquote>\n\n<p>See similar question: <a href=\"https://stackoverflow.com/questions/40999637/mgo-query-performance-seems-consistently-slow-500-650ms/41000876#41000876\">mgo - query performance seems consistently slow (500-650ms)</a></p>\n"}, {"comments": [{"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559773017, "post_id": 56468223, "comment_id": 99528938, "body": "thank you for comment. This is where I&#39;m learning. Since after opening your link it&#39;s still not fully clear for me, are you referring to particular case which you are advising? Would you please write sample based on your recommendations?"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559774792, "post_id": 56468223, "comment_id": 99529358, "body": "@yart - First, which case applies?  And please provide <code>SHOW CREATE TABLE sportsmen</code>"}, {"owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559783103, "post_id": 56468223, "comment_id": 99530724, "body": "Table     | Create Table  sportsmen | CREATE TABLE <code>sportsmen</code> (   <code>sp_no</code> int(11) NOT NULL,   <code>birth_date</code> date NOT NULL,   <code>first_name</code> varchar(14) NOT NULL,   <code>last_name</code> varchar(16) NOT NULL,   <code>gender</code> enum(&#39;M&#39;,&#39;F&#39;) NOT NULL,   <code>start_date</code> date NOT NULL,   PRIMARY KEY (<code>sp_no</code>) ) ENGINE=InnoDB DEFAULT CHARSET=latin1 |"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559784737, "post_id": 56468223, "comment_id": 99531006, "body": "@yart - <code>sp_no</code> -- not <code>AUTO_INCREMENT</code>?  What are the min and max values?  <code>SELECT MIN(sp_no), MAX(sp_no) FROM sportsmen</code>"}, {"owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "reply_to_user": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "edited": false, "score": 0, "creation_date": 1559785140, "post_id": 56468223, "comment_id": 99531080, "body": "@yart - I lean toward &quot;Case: AUTO_INCREMENT with gaps, 1 or more rows returned&quot;, replacing:  <code>id</code>-&gt;<code>sp_no</code>, <code>RandTest</code>-&gt;<code>sportsmen</code>, <code>10</code>-&gt;<code>20</code>, <code>50</code>-&gt;<code>100</code>."}], "tags": [], "owner": {"reputation": 105038, "user_id": 1766831, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/1ee974306d2def46eb69534fbcf95cc5?s=128&d=identicon&r=PG", "display_name": "Rick James", "link": "https://stackoverflow.com/users/1766831/rick-james"}, "is_accepted": false, "score": 0, "last_activity_date": 1559769907, "creation_date": 1559769907, "answer_id": 56468223, "question_id": 56457741, "link": "https://stackoverflow.com/questions/56457741/how-to-optimize-response-time-for-simple-web-and-database-application/56468223#56468223", "title": "How to optimize response time for simple web and database application", "body": "<pre><code>SELECT sp_no, first_name FROM sportsmen LIMIT ?,20\", rand.Intn(100000)\n</code></pre>\n\n<p>Terrible performance.  And poor results.</p>\n\n<ul>\n<li><p>It will only pick from the first 1/3 of the table (cf 100000 vs 300000).</p></li>\n<li><p>It will pick the same 20 or overlapping 20 occasionally.</p></li>\n<li><p>It must skip over up to 100000 rows before finding the 20.  (This is the performance problem.)</p></li>\n</ul>\n\n<p>I have multiple ways to improve on all three of those issues:  <a href=\"http://mysql.rjweb.org/doc.php/random\" rel=\"nofollow noreferrer\">http://mysql.rjweb.org/doc.php/random</a></p>\n\n<p>And by speeding up the query, the \"too many connections\" is likely to go away.</p>\n"}], "owner": {"reputation": 6635, "user_id": 232666, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/09a4538ef213f916a6c874cf6d7d7045?s=128&d=identicon&r=PG", "display_name": "yart", "link": "https://stackoverflow.com/users/232666/yart"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 262, "favorite_count": 0, "accepted_answer_id": 56457831, "answer_count": 2, "score": 0, "last_activity_date": 1559810942, "creation_date": 1559726823, "last_edit_date": 1559784236, "question_id": 56457741, "link": "https://stackoverflow.com/questions/56457741/how-to-optimize-response-time-for-simple-web-and-database-application", "title": "How to optimize response time for simple web and database application", "body": "<p>I'm new to golang and also to database optimizations. </p>\n\n<p>I have simple app written on go and mysql database where send queries initialised through the web.</p>\n\n<p>For receiving requests it take around 5s or little bit more? Is it possible somehow to optimize it?</p>\n\n<p>Also if refreshing several times, then response could be already 50s and even more,\nexceptions with \"invalid memory address or nil pointer dereference\" or \"Error 1040: Too many connections could appear\".</p>\n\n<p>How to avoid this and have all requests to be managiable in a efficient time frame?</p>\n\n<p>This is table structure</p>\n\n<pre><code> CREATE TABLE sportsmen (\n    sp_no int(11) NOT NULL, \n    birth_date date NOT NULL, \n    first_name varchar(14) NOT NULL, \n    last_name varchar(16) NOT NULL, \n    gender enum('M','F') NOT NULL, \n    start_date date NOT NULL, \n    PRIMARY KEY (sp_no)\n) ENGINE=InnoDB DEFAULT CHARSET=latin1\n\nCREATE TABLE points (\nsp_no INT NOT NULL,\npoint INT NOT NULL,\ndate DATE NOT NULL\n);\n</code></pre>\n\n<p>Number of records is around 300000 for sportsmen and 1 000 000 for their points.</p>\n\n<p>this is function which is called on every request</p>\n\n<pre><code>var db *sql.DB\n\nfunc init() {\n    db, _ = sql.Open(\"mysql\", \"&lt;connection&gt;?charset=utf8\")\n    //checkErr(errcon)\n    err := db.Ping()\n    checkErr(err)\n    yt := reflect.TypeOf(db).Kind()\n    fmt.Printf(\"%T: %s\\n\", yt, yt)\n}\n\nfunc sportsmanPoints(w http.ResponseWriter, r *http.Request) {\n\n    start := time.Now()\n\n    sportsmen, err := db.Query(\"SELECT sp_no, first_name FROM sportsmen LIMIT ?,20\", rand.Intn(100000))\n    checkErr(err)\n\n    for sportsmen.Next() {\n        var spNo string\n        var firstName string\n        err = sportsmen.Scan(&amp;spNo, &amp;firstName)\n        checkErr(err)\n        spPoints, err := db.Query(\"SELECT max(point) FROM points WHERE sp_no =\" + spNo)\n        for spPoints.Next() {\n            var spPoint int\n            err = spPoints.Scan(&amp;spPoint)\n            checkErr(err)\n            points.Data = \u200bappend\u200b(points.Data, Point{Name: firstName, Point: spPoint})\n        }\n    }\n\n    data, err := json.Marshal(points.Data)\n    if\u200b err != \u200bnil\u200b {\n           log.Fatal(err)\n     }\n\n    fmt.Fprintln(w, \u200bstring\u200b(data))\n    elapsed := time.Since(start)\n    fmt.Println(\u200b\"Date:\"\u200b, time.Now(), \u200b\"Response time:\"\u200b, elapsed)\n    points.Data = \u200bnil\n    data = \u200bnil\n}\n\nfunc\u200b \u200bcheckErr\u200b(err error) {\n    if\u200b err != \u200bnil\u200b {\n        panic\u200b(err)\n    }\n}\n\nfunc\u200b \u200bmain\u200b() {\n    http.HandleFunc(\u200b\"/\"\u200b, sportsmanPoints)\n    err := http.ListenAndServe(\u200b\":9090\"\u200b, \u200bnil\u200b)\n    if\u200b err != \u200bnil\u200b {\n        log.Fatal(\u200b\"ListenAndServe: \"\u200b, err)\n    }\n}\n</code></pre>\n\n<p>Thank you.</p>\n"}, {"tags": ["python", "go", "machine-learning", "scikit-learn", "joblib"], "owner": {"reputation": 177, "user_id": 9022359, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-6R4yW8qwpC4/AAAAAAAAAAI/AAAAAAAAAAc/FN8-Wu-zaXY/photo.jpg?sz=128", "display_name": "being of habits", "link": "https://stackoverflow.com/users/9022359/being-of-habits"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 114, "favorite_count": 0, "answer_count": 0, "score": 2, "last_activity_date": 1559722351, "creation_date": 1559722351, "question_id": 56456550, "link": "https://stackoverflow.com/questions/56456550/predict-via-go-with-use-of-model-saves-as-joblib-file", "title": "Predict via Go with use of model saves as .joblib file", "body": "<p><em>A bit of preamble. I'm never an ML-engineer, so I could use incorrect terminology, etc. If so, I'm really sorry.</em></p>\n\n<p>We currently have an already trained model in .joblib, and python file to be used for predictions. And what I'm trying to do, is to understand, is it possible to use Go instead of Python, as there is no native Scikit-learn neither Joblib support.</p>\n\n<p>So, figural, the python file looks like the following</p>\n\n<pre class=\"lang-py prettyprint-override\"><code>file = open(\"/path/to/model\", \"rb\")\nmodel = joblib.load(file)\ninputs = #some array of data to be predicted\nmodel.predict(inputs)\n</code></pre>\n\n<p>Thank you in advance!</p>\n"}, {"tags": ["go", "time"], "answers": [{"comments": [{"owner": {"reputation": 31, "user_id": 3137525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6d6f03d2f5e5a75f156ec3ea517de8?s=128&d=identicon&r=PG&f=1", "display_name": "serggp", "link": "https://stackoverflow.com/users/3137525/serggp"}, "edited": false, "score": 0, "creation_date": 1559721411, "post_id": 56456240, "comment_id": 99504697, "body": "Thanks for the explanation. I didn&#39;t expect two dates with the same underlying unix timestamp output different results."}, {"owner": {"reputation": 229185, "user_id": 251311, "user_type": "registered", "accept_rate": 97, "profile_image": "https://www.gravatar.com/avatar/b6b0ca5d4ef200ec8e3cd1fa2aefd836?s=128&d=identicon&r=PG", "display_name": "zerkms", "link": "https://stackoverflow.com/users/251311/zerkms"}, "reply_to_user": {"reputation": 31, "user_id": 3137525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6d6f03d2f5e5a75f156ec3ea517de8?s=128&d=identicon&r=PG&f=1", "display_name": "serggp", "link": "https://stackoverflow.com/users/3137525/serggp"}, "edited": false, "score": 2, "creation_date": 1559721772, "post_id": 56456240, "comment_id": 99504844, "body": "@serggp those are not two dates, it&#39;s the same instant in time, which is then formatted differently. It&#39;s frequent when the same knowledge/data is represented differently: eg <code>two</code> (the number) can be represented as <code>2</code> (decimal), <code>10</code> (binary), <code>two</code> (English), etc. But even though the representation is different, it carries the same payload."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 3, "last_activity_date": 1559721859, "last_edit_date": 1559721859, "creation_date": 1559721021, "answer_id": 56456240, "question_id": 56456111, "link": "https://stackoverflow.com/questions/56456111/golang-time-format-gives-different-results-for-the-same-unix-timestamp/56456240#56456240", "title": "golang time.Format() gives different results for the same unix timestamp", "body": "<p>The printed dates are different because they have different timezones.</p>\n\n<p><a href=\"https://golang.org/pkg/time/#Unix\" rel=\"nofollow noreferrer\"><code>time.Unix()</code></a> returns the <strong>local Time</strong>, while <a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\"><code>time.Parse()</code></a>:</p>\n\n<blockquote>\n  <p>Elements omitted from the value are assumed to be zero or, when zero is impossible, one, so parsing \"3:04pm\" returns the time corresponding to Jan 1, year 0, 15:04:00 <strong>UTC</strong> (note that because the year is 0, this time is before the zero Time).</p>\n</blockquote>\n\n<p><code>time.Parse()</code> returns a <code>time.Time</code> having <code>UTC</code> zone by default (if zone info is not part of the input and layout).</p>\n\n<p>This also explains why you can't see it on the Go Playground: the local time there is UTC.</p>\n\n<p>Printing the zone info in my local computer (CET timezone):</p>\n\n<pre><code>fmt.Println(\"control:\", control1.Unix(), control1.Format(\"2006-01-02 -0700\"))\nfmt.Println(\"test   :\", test.Unix(), test.Format(\"2006-01-02 -0700\"))\n\nfmt.Println(control1.Zone())\nfmt.Println(test.Zone())\n</code></pre>\n\n<p>Outputs:</p>\n\n<pre><code>control: 1546300800 2019-01-01 +0100\ntest   : 1546300800 2019-01-01 +0000\nCET 3600\nUTC 0\n</code></pre>\n\n<p>If you switch both times to the same zone (e.g. <code>UTC</code> or local), the printed dates will be the same:</p>\n\n<pre><code>control1 = control1.UTC()\ntest = test.UTC()\n</code></pre>\n\n<p>After this, the output:</p>\n\n<pre><code>control: 1546300800 2019-01-01 +0000\ntest   : 1546300800 2019-01-01 +0000\nUTC 0\nUTC 0\n</code></pre>\n"}], "owner": {"reputation": 31, "user_id": 3137525, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ba6d6f03d2f5e5a75f156ec3ea517de8?s=128&d=identicon&r=PG&f=1", "display_name": "serggp", "link": "https://stackoverflow.com/users/3137525/serggp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 591, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1559721859, "creation_date": 1559720410, "question_id": 56456111, "link": "https://stackoverflow.com/questions/56456111/golang-time-format-gives-different-results-for-the-same-unix-timestamp", "title": "golang time.Format() gives different results for the same unix timestamp", "body": "<p>time.Time initialized with time.Unix() and time.Parse() with exactly the same unix timestamp gives different results being printed with time.Format(\"2006-01-02\")</p>\n\n<p>The problem is not reproducible in playground, but I get it if I compile it myself.</p>\n\n<p>My default time zone is Los Angeles, probably in different timezone result would be different.</p>\n\n<blockquote>\n  <p>go version\n  go version go1.12.1 darwin/amd64</p>\n  \n  <p>go build</p>\n  \n  <p>./test</p>\n</blockquote>\n\n<p>test.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    control1 := time.Unix(1546300800, 0)\n    test, _ := time.Parse(\"2006-01-02\", \"2019-01-01\")\n\n    fmt.Println(\"control:\", control1.Unix(), control1.Format(\"2006-01-02\"))\n    fmt.Println(\"test:\", test.Unix(), test.Format(\"2006-01-02\"))\n}\n</code></pre>\n\n<blockquote>\n  <p>./test\n  control: 1546300800 2018-12-31\n  test: 1546300800 2019-01-01</p>\n</blockquote>\n\n<p>So unix ts is the same (1546300800), but dates are different. Why?</p>\n"}, {"tags": ["go", "gif"], "answers": [{"comments": [{"owner": {"reputation": 43, "user_id": 11602767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZol7pKBnrI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcLxEtldTTs56eVs2GF22yzrwNznA/mo/photo.jpg?sz=128", "display_name": "Antoni Sawicki", "link": "https://stackoverflow.com/users/11602767/antoni-sawicki"}, "edited": false, "score": 0, "creation_date": 1559724778, "post_id": 56456743, "comment_id": 99506323, "body": "I was trying to avoid creating a new image but looks like the easiest solution. Thank you!"}, {"owner": {"reputation": 1299, "user_id": 7240806, "user_type": "registered", "profile_image": "https://graph.facebook.com/10155499770477892/picture?type=large", "display_name": "Stephan Hogenboom", "link": "https://stackoverflow.com/users/7240806/stephan-hogenboom"}, "reply_to_user": {"reputation": 43, "user_id": 11602767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZol7pKBnrI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcLxEtldTTs56eVs2GF22yzrwNznA/mo/photo.jpg?sz=128", "display_name": "Antoni Sawicki", "link": "https://stackoverflow.com/users/11602767/antoni-sawicki"}, "edited": false, "score": 1, "creation_date": 1559726592, "post_id": 56456743, "comment_id": 99507203, "body": "@AntoniSawicki don&#39;t forget to upvote and / or accept his answer if it helped you"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 43, "user_id": 11602767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZol7pKBnrI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcLxEtldTTs56eVs2GF22yzrwNznA/mo/photo.jpg?sz=128", "display_name": "Antoni Sawicki", "link": "https://stackoverflow.com/users/11602767/antoni-sawicki"}, "edited": false, "score": 0, "creation_date": 1559726657, "post_id": 56456743, "comment_id": 99507240, "body": "@AntoniSawicki Note: you can&#39;t avoid having to create a new image. If you pass a <code>Quantizer</code> implementation to <code>gif.Encode()</code>, it will inside create a new paletted image where the palette is calculated using the given quantizer. All-in-all, this might even be faster than using a quantizer."}, {"owner": {"reputation": 43, "user_id": 11602767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZol7pKBnrI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcLxEtldTTs56eVs2GF22yzrwNznA/mo/photo.jpg?sz=128", "display_name": "Antoni Sawicki", "link": "https://stackoverflow.com/users/11602767/antoni-sawicki"}, "edited": false, "score": 0, "creation_date": 1560244925, "post_id": 56456743, "comment_id": 99662609, "body": "Makes sense thank you. In the end I ended up using this <code>github.com&#47;ericpauley&#47;go-quantize&#47;quantize</code> as Quantizer. It&#39;s much faster than anything else and it truly produces a reduced color palette."}, {"owner": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1619193104, "post_id": 56456743, "comment_id": 118839677, "body": "image.ZP is deprecated, you should use image.Point{} instead."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3843, "user_id": 2843030, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/e6c54e4c03b5028d13921bcbad5111bf?s=128&d=identicon&r=PG", "display_name": "Franck Jeannin", "link": "https://stackoverflow.com/users/2843030/franck-jeannin"}, "edited": false, "score": 0, "creation_date": 1619202128, "post_id": 56456743, "comment_id": 118843304, "body": "@FranckJeannin Thanks for the note, changed it."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 2, "last_activity_date": 1619202100, "last_edit_date": 1619202100, "creation_date": 1559723108, "answer_id": 56456743, "question_id": 56455965, "link": "https://stackoverflow.com/questions/56455965/how-to-use-golang-palette-websafe-in-gif-encode/56456743#56456743", "title": "How to use golang palette.WebSafe in gif.Encode()?", "body": "<p><a href=\"https://golang.org/doc/go1.2#minor_library_changes\" rel=\"nofollow noreferrer\">Go 1.12 release notes</a> states that there are no implementations of the <a href=\"https://golang.org/pkg/image/draw/#Quantizer\" rel=\"nofollow noreferrer\"><code>draw.Quantizer</code></a> interface in the standard library.</p>\n<p>You can either implement one, use a 3rd party ready solution (such as <a href=\"https://github.com/esimov/colorquant\" rel=\"nofollow noreferrer\">this</a> or <a href=\"https://github.com/joshdk/quantize\" rel=\"nofollow noreferrer\">this</a>), or a much simpler solution would be to create a paletted image using the WebSafe palette, draw your original image onto this one, and finally save the paletted image.</p>\n<p>This is how it could be done:</p>\n<pre><code>// img is your decoded image\n\npm := image.NewPaletted(img.Bounds(), palette.WebSafe)\ndraw.Draw(pm, img.Bounds(), img, image.Point{}, draw.Over)\nerr = gif.Encode(&amp;gifbuf, pm, nil)\n</code></pre>\n<p>Note: if you use and pass a <code>draw.Quantizer</code> to <code>gif.Encode()</code>, that inside will too create a new paletted image and use the quantizer to calculate the palette, and then draw the old image onto this paletted image.</p>\n"}], "owner": {"reputation": 43, "user_id": 11602767, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-nZol7pKBnrI/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rcLxEtldTTs56eVs2GF22yzrwNznA/mo/photo.jpg?sz=128", "display_name": "Antoni Sawicki", "link": "https://stackoverflow.com/users/11602767/antoni-sawicki"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 430, "favorite_count": 0, "accepted_answer_id": 56456743, "answer_count": 1, "score": 4, "last_activity_date": 1619202100, "creation_date": 1559719803, "last_edit_date": 1559726090, "question_id": 56455965, "link": "https://stackoverflow.com/questions/56455965/how-to-use-golang-palette-websafe-in-gif-encode", "title": "How to use golang palette.WebSafe in gif.Encode()?", "body": "<p>I'm using <code>gif.Encode()</code> to encode a gif image. By description it uses <strong>palette.Plan9</strong>. I would like to use <strong>palette.WebSafe</strong> instead.</p>\n\n<p>Tried passing in gif.Options but looks like Quantizer is an interface. Do I need to write my own Quantizer or can I somehow specify WebSafe to the built in one?</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"encoding/base64\"\n    \"image/gif\"\n    \"image/png\"\n    \"io\"\n    \"log\"\n    \"strings\"\n)\n\nconst gopher = `iVBORw0KGgoAAAANSUhEUgAAAEsAAAA8CAAAAAALAhhPAAAFfUlEQVRYw62XeWwUVRzHf2+OPbo9d7tsWyiyaZti6eWGAhISoIGKECEKCAiJJkYTiUgTMYSIosYYBBIUIxoSPIINEBDi2VhwkQrVsj1ESgu9doHWdrul7ba73WNm3vOPtsseM9MdwvvrzTs+8/t95ze/33sI5BqiabU6m9En8oNjduLnAEDLUsQXFF8tQ5oxK3vmnNmDSMtrncks9Hhtt/qeWZapHb1ha3UqYSWVl2ZmpWgaXMXGohQAvmeop3bjTRtv6SgaK/Pb9/bFzUrYslbFAmHPp+3WhAYdr+7GN/YnpN46Opv55VDsJkoEpMrY/vO2BIYQ6LLvm0ThY3MzDzzeSJeeWNyTkgnIE5ePKsvKlcg/0T9QMzXalwXMlj54z4c0rh/mzEfr+FgWEz2w6uk8dkzFAgcARAgNp1ZYef8bH2AgvuStbc2/i6CiWGj98y2tw2l4FAXKkQBIf+exyRnteY83LfEwDQAYCoK+P6bxkZm/0966LxcAAILHB56kgD95PPxltuYcMtFTWw/FKkY/6Opf3GGd9ZF+Qp6mzJxzuRSractOmJrH1u8XTvWFHINNkLQLMR+XHXvfPPHw967raE1xxwtA36IMRfkAAG29/7mLuQcb2WOnsJReZGfpiHsSBX81cvMKywYZHhX5hFPtOqPGWZCXnhWGAu6lX91ElKXSalcLXu3UaOXVay57ZSe5f6Gpx7J2MXAsi7EqSp09b/MirKSyJfnfEEgeDjl8FgDAfvewP03zZ+AJ0m9aFRM8eEHBDRKjfcreDXnZdQuAxXpT2NRJ7xl3UkLBhuVGU16gZiGOgZmrSbRdqkILuL/yYoSXHHkl9KXgqNu3PB8oRg0geC5vFmLjad6mUyTKLmF3OtraWDIfACyXqmephaDABawfpi6tqqBZytfQMqOz6S09iWXhktrRaB8Xz4Yi/8gyABDm5NVe6qq/3VzPrcjELWrebVuyY2T7ar4zQyybUCtsQ5Es1FGaZVrRVQwAgHGW2ZCRZshI5bGQi7HesyE972pOSeMM0dSktlzxRdrlqb3Osa6CCS8IJoQQQgBAbTAa5l5epO34rJszibJI8rxLfGzcp1dRosutGeb2VDNgqYrwTiPNsLxXiPi3dz7LiS1WBRBDBOnqEjyy3aQb+/bLiJzz9dIkscVBBLxMfSEac7kO4Fpkngi0ruNBeSOal+u8jgOuqPz12nryMLCniEjtOOOmpt+KEIqsEdocJjYXwrh9OZqWJQyPCTo67LNS/TdxLAv6R5ZNK9npEjbYdT33gRo4o5oTqR34R+OmaSzDBWsAIPhuRcgyoteNi9gF0KzNYWVItPf2TLoXEg+7isNC7uJkgo1iQWOfRSP9NR11RtbZZ3OMG/VhL6jvx+J1m87+RCfJChAtEBQkSBX2PnSiihc/Twh3j0h7qdYQAoRVsRGmq7HU2QRbaxVGa1D6nIOqaIWRjyRZpHMQKWKpZM5feA+lzC4ZFultV8S6T0mzQGhQohi5I8iw+CsqBSxhFMuwyLgSwbghGb0AiIKkSDmGZVmJSiKihsiyOAUs70UkywooYP0bii9GdH4sfr1UNysd3fUyLLMQN+rsmo3grHl9VNJHbbwxoa47Vw5gupIqrZcjPh9R4Nye3nRDk199V+aetmvVtDRE8/+cbgAAgMIWGb3UA0MGLE9SCbWX670TDy1y98c3D27eppUjsZ6fql3jcd5rUe7+ZIlLNQny3Rd+E5Tct3WVhTM5RBCEdiEK0b6B+/ca2gYU393nFj/n1AygRQxPIUA043M42u85+z2SnssKrPl8Mx76NL3E6eXc3be7OD+H4WHbJkKI8AU8irbITQjZ+0hQcPEgId/Fn/pl9crKH02+5o2b9T/eMx7pKoskYgAAAABJRU5ErkJggg==`\n\nfunc gopherPNG() io.Reader { return base64.NewDecoder(base64.StdEncoding, strings.NewReader(gopher)) }\n\nfunc main() {\n    img, err := png.Decode(gopherPNG())\n    if err != nil {\n        log.Fatal(err)\n    }\n    var gifbuf bytes.Buffer\n    // Want top use WebSafe palete from https://golang.org/pkg/image/color/palette/\n    // Do I need to write my own Quantizer?\n    // gif.Options: https://golang.org/pkg/image/gif/#Options\n    // Encode Source: https://golang.org/src/image/gif/writer.go?s=10643:10700#L408\n    err = gif.Encode(&amp;gifbuf, img, &amp;gif.Options{NumColors: 256})\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/wFUS-4Exuvu\" rel=\"nofollow noreferrer\">Playground link</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 26908, "user_id": 1192728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/481baa815383ed3970e726842195f73f?s=128&d=identicon&r=PG", "display_name": "hqt", "link": "https://stackoverflow.com/users/1192728/hqt"}, "edited": false, "score": 1, "creation_date": 1559721237, "post_id": 56454015, "comment_id": 99504622, "body": "@hqt: Downvotes do not require comments, and requesting them is boring and inappropriate."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559721303, "post_id": 56454015, "comment_id": 99504652, "body": "This looks like an XY problem. The exact thing you&#39;re asking cannot be done in Go. But can you explain the larger problem you&#39;re trying to solve? If so, there&#39;s surely an alternate solution."}], "answers": [{"tags": [], "owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "is_accepted": false, "score": 2, "last_activity_date": 1559706812, "creation_date": 1559706812, "answer_id": 56454037, "question_id": 56454015, "link": "https://stackoverflow.com/questions/56454015/how-to-make-a-function-received-different-type-as-a-string/56454037#56454037", "title": "How to make a function received different type as a string", "body": "<blockquote>\n  <p>Is this possible in golang?</p>\n</blockquote>\n\n<p>No.</p>\n\n<p>The whole purpose of a new type is that it is a <em>different</em> type.</p>\n"}, {"comments": [{"owner": {"reputation": 4076, "user_id": 1806763, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/GXLjI.png?s=128&g=1", "display_name": "JD D", "link": "https://stackoverflow.com/users/1806763/jd-d"}, "edited": false, "score": 1, "creation_date": 1559707321, "post_id": 56454079, "comment_id": 99500789, "body": "i think this is the right answer, would be better if you provided some code examples"}], "tags": [], "owner": {"reputation": 116, "user_id": 11602002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_BLKOWOcEqY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDGNlFnHFbC4wHanoxkM1Xr2Dybg/mo/photo.jpg?sz=128", "display_name": "Chris Berger", "link": "https://stackoverflow.com/users/11602002/chris-berger"}, "is_accepted": false, "score": 1, "last_activity_date": 1559707161, "creation_date": 1559707161, "answer_id": 56454079, "question_id": 56454015, "link": "https://stackoverflow.com/questions/56454015/how-to-make-a-function-received-different-type-as-a-string/56454079#56454079", "title": "How to make a function received different type as a string", "body": "<p>If you really needed this functionality, you could create a new interface type that you then implement for each of your StringTypes, and your function would take an instance of that interface type as it's param.</p>\n"}, {"comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559711675, "post_id": 56454094, "comment_id": 99501589, "body": "This does not meet the constraint &quot;any type with a string filed&quot; in &quot;where s can be StringTypeOne or StringTypeTwo or any other type with string field.&quot; (or the likely intention of any type with underlying type string)."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559714990, "post_id": 56454094, "comment_id": 99502378, "body": "@Volker Hm... How about a <code>Stringer</code> interface... <code>func String()string</code>?"}, {"owner": {"reputation": 26908, "user_id": 1192728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/481baa815383ed3970e726842195f73f?s=128&d=identicon&r=PG", "display_name": "hqt", "link": "https://stackoverflow.com/users/1192728/hqt"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559717977, "post_id": 56454094, "comment_id": 99503362, "body": "@Volker In your case, you basically treat all type that underling as string is string. So you can write a function accepted parameter as string. for example: <code>func handleString(s String) {}</code> then you can string value from your custom type. For example: <code>a := StringTypeTwo(&quot;example&quot;) ; handleString(a.String())</code>"}], "tags": [], "owner": {"reputation": 26908, "user_id": 1192728, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/481baa815383ed3970e726842195f73f?s=128&d=identicon&r=PG", "display_name": "hqt", "link": "https://stackoverflow.com/users/1192728/hqt"}, "is_accepted": false, "score": 4, "last_activity_date": 1559707324, "creation_date": 1559707324, "answer_id": 56454094, "question_id": 56454015, "link": "https://stackoverflow.com/questions/56454015/how-to-make-a-function-received-different-type-as-a-string/56454094#56454094", "title": "How to make a function received different type as a string", "body": "<p>No, you cannot. But for your purpose, you should implement a custom interface.</p>\n\n<pre><code>// define an interface that do something you need\ntype Doer interface {\n   DoSomething();\n}\n</code></pre>\n\n<p>Then you define custom type and implement all necessary functions of defined interface:</p>\n\n<pre><code>type StringTypeOne string\ntype StringTypeTwo string\n\n\nfunc (s StringTypeOne) DoSomething() {\n}\n\nfunc (s StringTypeTwo) DoSomething() {\n}\n</code></pre>\n\n<p>Then you can create function that received interface as parameter:</p>\n\n<pre><code>func handleString(s Doer) {\n}\n</code></pre>\n\n<p>This method can receive both <code>StringTypeOne</code> or <code>StringTypeTwo</code> as parameter.</p>\n"}], "owner": {"reputation": 711, "user_id": 218497, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/0c651d788d01254b0b9e11479a2302fa?s=128&d=identicon&r=PG", "display_name": "wyz", "link": "https://stackoverflow.com/users/218497/wyz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 74, "favorite_count": 0, "answer_count": 3, "score": 0, "last_activity_date": 1559721203, "creation_date": 1559706612, "last_edit_date": 1559721203, "question_id": 56454015, "link": "https://stackoverflow.com/questions/56454015/how-to-make-a-function-received-different-type-as-a-string", "title": "How to make a function received different type as a string", "body": "<p>In my code, I have some string types like:</p>\n\n<pre><code>type StringTypeOne string\ntype StringTYpeOwn string\n</code></pre>\n\n<p>I know I can convert them to string after reading:\n<a href=\"https://stackoverflow.com/questions/45891600/converting-a-custom-type-to-string-in-go\">Converting a custom type to string in Go</a></p>\n\n<p>However I want to write a function which takes all these kind of struct, e.g.</p>\n\n<pre><code>func handleString(s StringType)\n</code></pre>\n\n<p>where s can be <code>StringTypeOne</code> or <code>StringTypeTwo</code> or any other type with string field.</p>\n\n<p>Is this possible in golang?</p>\n"}, {"tags": ["go", "grpc", "server-sent-events", "goroutine"], "comments": [{"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1559708367, "post_id": 56453730, "comment_id": 99500974, "body": "please if you have any idea help please"}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559711797, "post_id": 56453730, "comment_id": 99501614, "body": "You simply <i>cannot</i> get a &quot;response from a goroutine&quot;: This simply is not possible. If you want to communicate any result from a goroutine to an other goroutine you normally use a channel. (You should come up with a simplified example as I have no idea what your code does or is intended to do)."}, {"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559712339, "post_id": 56453730, "comment_id": 99501742, "body": "currently yes am calling another go routines to pass the value <code>func F(n int, wg *sync.WaitGroup) { \t&#47;&#47; defer wg.Done() \tdefer wg.Done() \t&#47;&#47; do a job here \tResults &lt;- n } </code> and a variable like a channel var Results = make(chan int) ```"}, {"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559714922, "post_id": 56453730, "comment_id": 99502362, "body": "this is the code <a href=\"https://play.golang.org/p/NioLLk1NVds\" rel=\"nofollow noreferrer\">play.golang.org/p/NioLLk1NVds</a>"}], "answers": [{"tags": [], "owner": {"reputation": 105, "user_id": 9368823, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "Sam White", "link": "https://stackoverflow.com/users/9368823/sam-white"}, "is_accepted": false, "score": 0, "last_activity_date": 1559713982, "creation_date": 1559713982, "answer_id": 56454893, "question_id": 56453730, "link": "https://stackoverflow.com/questions/56453730/how-to-handle-and-get-response-from-goroutines-in-golang/56454893#56454893", "title": "How to Handle and get response from goroutines in golang", "body": "<p>I would suggest setting up a channel to receive events from the go routine. In the calling function you can listen for these events (which can contain any information you want) in a loop until the go routine closes itself, signigying failure.</p>\n"}, {"comments": [{"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1559748572, "post_id": 56459466, "comment_id": 99518751, "body": "Thank you very much for your reply. i will check and let you know it seems good."}, {"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1559748640, "post_id": 56459466, "comment_id": 99518798, "body": "but eventhough the result is return is there any possible that this will continue running except removing close(errC)? this is the stream from grpc so i dont want to stop the streaming"}, {"owner": {"reputation": 119, "user_id": 10345898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ede012816e62beec856ee7f329347ef?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan Surfus", "link": "https://stackoverflow.com/users/10345898/nathan-surfus"}, "reply_to_user": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1559786366, "post_id": 56459466, "comment_id": 99531271, "body": "The for loop in go func() will continue looping until it hits a return. At any point you want to end the loop (return), be sure to send an error into the channel or close the channel."}, {"owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "edited": false, "score": 0, "creation_date": 1559786886, "post_id": 56459466, "comment_id": 99531361, "body": "ah ok thats fine as well, but my goal currently is when the streaming is working fine it should return something like 200 or else 500 if err != nil then thats the time i send the error. I am modifying it now but cannot get a good result."}], "tags": [], "owner": {"reputation": 119, "user_id": 10345898, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2ede012816e62beec856ee7f329347ef?s=128&d=identicon&r=PG&f=1", "display_name": "Nathan Surfus", "link": "https://stackoverflow.com/users/10345898/nathan-surfus"}, "is_accepted": false, "score": 1, "last_activity_date": 1559733611, "creation_date": 1559733611, "answer_id": 56459466, "question_id": 56453730, "link": "https://stackoverflow.com/questions/56453730/how-to-handle-and-get-response-from-goroutines-in-golang/56459466#56459466", "title": "How to Handle and get response from goroutines in golang", "body": "<p>If you want to know if there was an error when processing the go func() inside GetPositionContext then you could do something like below. I modified all errors to bubble up rather than call log.Fatal. On a side note it might be wise to defer <code>stream.CloseSend()</code>, but i'm missing context and it's outside the scope of the question.</p>\n\n<p>I did my best to understand the question, but if I missed something, let me know!</p>\n\n<p>The code has been modified to bubble up errors within GetPositionContext directly rather than call log.Fatal. Additionally, if there is an error within the go func() it will get sent back to GetPositionContext through a channel and then returned to the caller.</p>\n\n<pre><code>func GetPositionContext(ctx context.Context, uav pb.UAVControllerClient, uavID *pb.UAVID, projectID string) error {\n    log.Printf(\"getPosition start\")\n\n    stream, err := uav.GetPosition(ctx)\n\n    if err != nil {\n        return fmt.Errorf(\"ERROR getPosition: %v\", err.Error())\n    }\n\n    streamID, eventName := EventsSubscribe(projectID, uavID.Aircraft, \"get_position\")\n\n    errC := make(chan error)\n\n    // \u53d7\u4fe1\u30eb\u30fc\u30d7\u958b\u59cb\n    go func() {\n        fmt.Print(\"start getPosition loop\")\n        for {\n            msg, err := stream.Recv() // msg UAVPosition\n            if err == io.EOF {\n                // read done.\n                fmt.Print(\"start getPosition loop closed\")\n                close(errC)\n                return\n            }\n            if err != nil {\n                errC &lt;- fmt.Errorf(\"Failed to receive getPosition : %v\", err)\n                return\n            }\n            // log.Printf(\"Position point[%s](%f, %f, %f) H:%f\", uavID.Aircraft, msg.Latitude, msg.Longitude, msg.Altitude, msg.Heading)\n\n            wayPoint := models.WaypointItem{\n                Latitude:  msg.Latitude,\n                Longitude: msg.Longitude,\n                Altitude:  msg.Altitude,\n                Heading:   msg.Heading,\n            }\n\n            dronePosition := models.DronePosition{\n                Name:          uavID.Aircraft,\n                ItemParameter: wayPoint,\n            }\n\n            // publish to eventgo\n            publishNotif(dronePosition, streamID, eventName)\n\n            // Did you mean to return here? The for loop will only ever execute one time.\n            // If you didn't mean to return, then remove this close\n            close(errC)\n            return\n        }\n    }()\n\n    startMsg := pb.UAVControllerPositionRequest{\n        UavID:       uavID,\n        Instruction: true,\n        Interval:    2,\n    }\n\n    fmt.Print(\"send getPosition start\")\n\n    if err := stream.Send(&amp;startMsg); err != nil {\n        return fmt.Errorf(\"Failed to send getPosition: %v\", err)\n    }\n\n    err = &lt;- errC\n\n    stream.CloseSend()\n    fmt.Print(\"end of getPosition\")\n    return err\n}\n</code></pre>\n\n<p>If you want to call this function asynchronously, but still want to know if there was an error then you could do the following.</p>\n\n<pre><code>errC := make(chan error)\ngo func() {\n  errC &lt;- GetPositionContext(..........)\n}()\n// Do some other stuff here\n// Until you need the result\nerr := &lt;- errC\n\n\n// ... and Eventually when you want to return the success or failure as JSON\nif err != nil {\n  return c.JSON(500, failed)\n}\nreturn c.JSON(500, pass)\n</code></pre>\n"}], "owner": {"reputation": 125, "user_id": 10230139, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ac213abfb2729d97f0c3fa6f76d9ccd2?s=128&d=identicon&r=PG&f=1", "display_name": "Yabetsu2018", "link": "https://stackoverflow.com/users/10230139/yabetsu2018"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 784, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1559733611, "creation_date": 1559703415, "last_edit_date": 1559714170, "question_id": 56453730, "link": "https://stackoverflow.com/questions/56453730/how-to-handle-and-get-response-from-goroutines-in-golang", "title": "How to Handle and get response from goroutines in golang", "body": "<p>I have go routines called in getPosition, getStatus and rerouting for my drone currently I am invoking go GetStatus in my main function which this function has go func() which handles the event for streaming grpc and sse.</p>\n\n<p>currently this is my code and i tried</p>\n\n<pre><code>func GetPositionContext(ctx context.Context, uav pb.UAVControllerClient, uavID *pb.UAVID, projectID string) {\n    log.Printf(\"getPosition start\")\n\n    stream, err := uav.GetPosition(ctx)\n\n    if err != nil {\n        fmt.Printf(\"ERROR getPosition:%s\", err.Error())\n    }\n\n    streamID, eventName := EventsSubscribe(projectID, uavID.Aircraft, \"get_position\")\n\n    position := make(chan models.DronePosition)\n\n    // \u53d7\u4fe1\u30eb\u30fc\u30d7\u958b\u59cb\n    go func() {\n        fmt.Print(\"start getPosition loop\")\n        for {\n            msg, err := stream.Recv() // msg UAVPosition\n            if err == io.EOF {\n                // read done.\n                fmt.Print(\"start getPosition loop closed\")\n                close(position)\n                return\n            }\n            if err != nil {\n                log.Fatalf(\"Failed to receive getPosition : %v\", err)\n                close(position)\n                return\n            }\n            // log.Printf(\"Position point[%s](%f, %f, %f) H:%f\", uavID.Aircraft, msg.Latitude, msg.Longitude, msg.Altitude, msg.Heading)\n\n            wayPoint := models.WaypointItem{\n                Latitude:  msg.Latitude,\n                Longitude: msg.Longitude,\n                Altitude:  msg.Altitude,\n                Heading:   msg.Heading,\n            }\n\n            dronePosition := models.DronePosition{\n                Name:          uavID.Aircraft,\n                ItemParameter: wayPoint,\n            }\n\n            // publish to eventgo\n            publishNotif(dronePosition, streamID, eventName)\n            return\n        }\n    }()\n\n    startMsg := pb.UAVControllerPositionRequest{\n        UavID:       uavID,\n        Instruction: true,\n        Interval:    2,\n    }\n\n    fmt.Print(\"send getPosition start\")\n\n    if err := stream.Send(&amp;startMsg); err != nil {\n        log.Fatalf(\"Failed to send getPosition: %v\", err)\n    }\n\n    &lt;-position\n\n    stream.CloseSend()\n    fmt.Print(\"end of getPosition\")\n}\n</code></pre>\n\n<p>this is the part where i call this function</p>\n\n<pre><code>go utils.GetPosition(ctx, uavService, &amp;uavID, projectID)\n</code></pre>\n\n<p>I want to get the return values from go func like if everything works fine in the grpc server and no problem i should return 200 success and 500 if something failed. </p>\n\n<pre><code>for {\n        time.Sleep(time.Duration(60) * time.Second)\n    }\n</code></pre>\n\n<p>after the call i have this code which it should return every 10s a success </p>\n\n<pre><code>return c.JSON(500, failed or pass)\n</code></pre>\n\n<p>I expect something to return to the ui if go routines is success or failed when streaming part is working for the response not to be pending or else other api call will not work.</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "edited": false, "score": 0, "creation_date": 1559763484, "post_id": 56454317, "comment_id": 99525323, "body": "I want to match on application/json for sure, but also allow charset=UTF-8. This may work. If you can add that to your answer above, I can mark it as accepted... unless there is a someone else with a better idea. &lt;code&gt; apiRouter := router.PathPrefix(&quot;/api&quot;).HeadersRegexp(&quot;Content-Type&quot;, fmt.Sprintf(&quot;%s.*&quot;, MIMEApplicationJSON)).Subrouter() &lt;/code&gt;"}], "tags": [], "owner": {"reputation": 116, "user_id": 11602002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_BLKOWOcEqY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDGNlFnHFbC4wHanoxkM1Xr2Dybg/mo/photo.jpg?sz=128", "display_name": "Chris Berger", "link": "https://stackoverflow.com/users/11602002/chris-berger"}, "is_accepted": false, "score": 0, "last_activity_date": 1559709413, "creation_date": 1559709413, "answer_id": 56454317, "question_id": 56453684, "link": "https://stackoverflow.com/questions/56453684/allow-more-than-content-type-application-json-in-gorilla/56454317#56454317", "title": "Allow more than content-type: application/json in gorilla", "body": "<p>I think this is a good use case for HeadersRegexp. </p>\n\n<p>From <a href=\"https://godoc.org/github.com/gorilla/mux\" rel=\"nofollow noreferrer\">the Go Doc</a>:</p>\n\n<p>Regex support also exists for matching Headers within a route. For example, we could do:</p>\n\n<p><code>r.HeadersRegexp(\"Content-Type\", \"application/(text|json)\")</code></p>\n\n<p>...and the route will match both requests with a Content-Type of <code>application/json</code> as well as <code>application/text</code> </p>\n"}, {"tags": [], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "is_accepted": true, "score": 1, "last_activity_date": 1560798115, "creation_date": 1560798115, "answer_id": 56637394, "question_id": 56453684, "link": "https://stackoverflow.com/questions/56453684/allow-more-than-content-type-application-json-in-gorilla/56637394#56637394", "title": "Allow more than content-type: application/json in gorilla", "body": "<p>Here's how I did it:</p>\n\n<pre><code>apiRouter := router.PathPrefix(\"/api\").HeadersRegexp(\"Content-Type\", fmt.Sprintf(\"%s.*\", MIMEApplicationJSON)).Subrouter()\n</code></pre>\n\n<p>Remember, you may apply routing at the actual end point rather than at the root level. For GET requests there would be no need to specify Content-Type, but for POST, you should check for one.</p>\n"}, {"tags": [], "owner": {"reputation": 3141, "user_id": 1314028, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/9cf4384f0fadd683392d26db17d8f8ba?s=128&d=identicon&r=PG", "display_name": "spinlok", "link": "https://stackoverflow.com/users/1314028/spinlok"}, "is_accepted": false, "score": 1, "last_activity_date": 1619240555, "last_edit_date": 1619240555, "creation_date": 1619240216, "answer_id": 67239453, "question_id": 56453684, "link": "https://stackoverflow.com/questions/56453684/allow-more-than-content-type-application-json-in-gorilla/67239453#67239453", "title": "Allow more than content-type: application/json in gorilla", "body": "<p>The other answers that use regex match any charset or worse even something like <code>application/jsonfooo</code>. If you want be more strict, you can use a matcher function:</p>\n<pre><code>func matchJSON(r *http.Request, rm *mux.RouteMatch) bool {\n    ctHdr := r.Header.Get(&quot;Content-Type&quot;)\n    contentType, params, err := mime.ParseMediaType(ctHdr)\n    if err != nil {\n        return false\n    }\n    charset := params[&quot;charset&quot;]\n    return contentType == &quot;application/json&quot; &amp;&amp; (charset == &quot;&quot; || strings.EqualFold(charset, &quot;UTF-8&quot;))\n}\n</code></pre>\n<p>Then, use it like:</p>\n<pre><code>router.PathPrefix(&quot;/api&quot;).MatcherFunc(matchJSON)\n</code></pre>\n"}], "owner": {"reputation": 793, "user_id": 90506, "user_type": "registered", "accept_rate": 92, "profile_image": "https://www.gravatar.com/avatar/a4bffdc2e88202aa1c2b74e165355199?s=128&d=identicon&r=PG", "display_name": "farhany", "link": "https://stackoverflow.com/users/90506/farhany"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 1, "accepted_answer_id": 56637394, "answer_count": 3, "score": 0, "last_activity_date": 1619240555, "creation_date": 1559702925, "question_id": 56453684, "link": "https://stackoverflow.com/questions/56453684/allow-more-than-content-type-application-json-in-gorilla", "title": "Allow more than content-type: application/json in gorilla", "body": "<p>Using the excellent Gorilla mux I have special handler for API requests using application/json as content-type:</p>\n\n<pre><code>apiRouter := router.PathPrefix(\"/api\").Headers(\"Content-Type\", \"application/json\").Subrouter()\n</code></pre>\n\n<p>However, some users like to provide more than just that string, i.e.  application/json; charset=UTF-8. When this header value is set, the handler returns a 404.</p>\n\n<p>What's the best way to handle this by allowing json and any charset specs?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1559732508, "post_id": 56453651, "comment_id": 99509896, "body": "The <code>go</code> tool is how you compile Go code."}, {"owner": {"reputation": 838, "user_id": 9134487, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VPebZ.jpg?s=128&g=1", "display_name": "Tushar", "link": "https://stackoverflow.com/users/9134487/tushar"}, "edited": false, "score": 0, "creation_date": 1563134699, "post_id": 56453651, "comment_id": 100590399, "body": "Whatever you are trying to do, it will mostly be faster, reliable, secure and maintainable if you just write the code in your application itself, or may be import it as a library/dependency. Compiling code on the go isn&#39;t a good idea, unless you are trying to make something like &quot;Go playground&quot;."}, {"owner": {"reputation": 671, "user_id": 1191379, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/cad89c755cb24c17927ff4a3b3d4e9c2?s=128&d=identicon&r=PG", "display_name": "Kevin Frost", "link": "https://stackoverflow.com/users/1191379/kevin-frost"}, "edited": false, "score": 1, "creation_date": 1571684030, "post_id": 56453651, "comment_id": 103314987, "body": "While it may be effectively impossible, I too would like to do this, so I don&#39;t really get the hostility to the question (and this was my first Google hit looking into the possibility).  My use-case is to embed a &quot;go playground&quot; in a standalone application that would run places where the <code>go</code> tool might not be installed."}], "answers": [{"tags": [], "owner": {"reputation": 116, "user_id": 11602002, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-_BLKOWOcEqY/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3reDGNlFnHFbC4wHanoxkM1Xr2Dybg/mo/photo.jpg?sz=128", "display_name": "Chris Berger", "link": "https://stackoverflow.com/users/11602002/chris-berger"}, "is_accepted": false, "score": 2, "last_activity_date": 1559704240, "creation_date": 1559704240, "answer_id": 56453814, "question_id": 56453651, "link": "https://stackoverflow.com/questions/56453651/how-to-compile-a-golang-program-within-the-golang-code/56453814#56453814", "title": "How to compile a golang program within the golang code?", "body": "<p>Unfortunately I think using exec.Command is your best bet to harness the tools written by the Go community in order to compile your go programs within a go program.</p>\n"}, {"tags": [], "owner": {"reputation": 1199, "user_id": 11152032, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Ge37s.png?s=128&g=1", "display_name": "Anshu", "link": "https://stackoverflow.com/users/11152032/anshu"}, "is_accepted": false, "score": 1, "last_activity_date": 1559787954, "creation_date": 1559787954, "answer_id": 56470197, "question_id": 56453651, "link": "https://stackoverflow.com/questions/56453651/how-to-compile-a-golang-program-within-the-golang-code/56470197#56470197", "title": "How to compile a golang program within the golang code?", "body": "<p>You can try this</p>\n\n<p>First set the $GOPATH</p>\n\n<p>then set the $GOBIN</p>\n\n<p>after that you can run  <strong>go build</strong> or  <strong>go get</strong>..</p>\n"}], "owner": {"reputation": 83, "user_id": 4381721, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000541486980/picture?type=large", "display_name": "Oscar Florez", "link": "https://stackoverflow.com/users/4381721/oscar-florez"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 330, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1562065953, "creation_date": 1559702624, "question_id": 56453651, "link": "https://stackoverflow.com/questions/56453651/how-to-compile-a-golang-program-within-the-golang-code", "title": "How to compile a golang program within the golang code?", "body": "<p>I need to compile programs within golang in golang. Is there any native form without using exec.Command(\"go\",\"build\") ?</p>\n"}, {"tags": ["go", "google-api"], "comments": [{"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559720226, "post_id": 56453626, "comment_id": 99504243, "body": "Are you sure that you are using a different account to test the &#39;writer role can share&#39; feature? AFAIK, the account that creates a file has all the permissions on it."}, {"owner": {"reputation": 37, "user_id": 7210656, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QgDjE-57wmc/AAAAAAAAAAI/AAAAAAAAACk/Hp10yXKh87Y/photo.jpg?sz=128", "display_name": "Bejan Muhidinov", "link": "https://stackoverflow.com/users/7210656/bejan-muhidinov"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559733866, "post_id": 56453626, "comment_id": 99510543, "body": "@giulio-micheloni Yes, I have 2 test google accounts. First I create a file, give owner role to my main account, then writer role to my test account."}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559758247, "post_id": 56453626, "comment_id": 99523129, "body": "Is the file inserted in a shared folder? Moreover, have you tried with the CLI for Google Drive? Just to see if it is a bug of Go SDK."}, {"owner": {"reputation": 37, "user_id": 7210656, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QgDjE-57wmc/AAAAAAAAAAI/AAAAAAAAACk/Hp10yXKh87Y/photo.jpg?sz=128", "display_name": "Bejan Muhidinov", "link": "https://stackoverflow.com/users/7210656/bejan-muhidinov"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559764303, "post_id": 56453626, "comment_id": 99525657, "body": "@GiulioMicheloni file is inserted in root folder of service account (so not shared), I just give owner role to main account and writer role to test account. Didn&#39;t try CLI yet, btw you mean that one -&gt; (<a href=\"https://github.com/gdrive-org/gdrive\" rel=\"nofollow noreferrer\">github.com/gdrive-org/gdrive</a>) ?"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559768116, "post_id": 56453626, "comment_id": 99527243, "body": "Correct. But you should be able to create the HTTP request manually and see if it works as expected. In case it does not, I would open an issue in Go SDK Github repo."}, {"owner": {"reputation": 37, "user_id": 7210656, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QgDjE-57wmc/AAAAAAAAAAI/AAAAAAAAACk/Hp10yXKh87Y/photo.jpg?sz=128", "display_name": "Bejan Muhidinov", "link": "https://stackoverflow.com/users/7210656/bejan-muhidinov"}, "reply_to_user": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 0, "creation_date": 1559776643, "post_id": 56453626, "comment_id": 99529694, "body": "@GiulioMicheloni I tried to see response from server when I create a file and I saw that even though I set WritersCanShare field to false, in response it&#39;s set to true."}], "owner": {"reputation": 37, "user_id": 7210656, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-QgDjE-57wmc/AAAAAAAAAAI/AAAAAAAAACk/Hp10yXKh87Y/photo.jpg?sz=128", "display_name": "Bejan Muhidinov", "link": "https://stackoverflow.com/users/7210656/bejan-muhidinov"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 105, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559733783, "creation_date": 1559702413, "last_edit_date": 1559733783, "question_id": 56453626, "link": "https://stackoverflow.com/questions/56453626/writerscanshare-google-drive-api", "title": "WritersCanShare - google drive API", "body": "<p>Im developing a software that will use google drive and google docs. Recently I discovered that there is an option in google drive sharing menu: prevent others from sharing a document. I wanted to implement this in my application using Go language, but with no lack.</p>\n\n<p>The problem is, I do an Insert file call (using google drive api) with WritersCanShare field set to false, but still users with writer role can share a file. Here is the code block:</p>\n\n<pre><code>file, err = srv.Files.Insert(&amp;drive.File{                    \n            CreatedDate: time.Now().Format(time.RFC3339),        \n            MimeType:    \"application/vnd.google-apps.document\", \n            Title:       \"sometitle\",\n            WritersCanShare: false,                   \n}).Do()\n</code></pre>\n\n<p>So, what can I do to solve the issue ?</p>\n\n<p>I use service account to create files and give owner role to my main google account.</p>\n"}, {"tags": ["go", "google-kubernetes-engine", "grpc", "istio", "envoyproxy"], "answers": [{"comments": [{"owner": {"reputation": 1175, "user_id": 7431823, "user_type": "registered", "accept_rate": 82, "profile_image": "https://www.gravatar.com/avatar/c2bc4ebc0f6c8d63fbe39f0b7c50d6e8?s=128&d=identicon&r=PG&f=1", "display_name": "TechEnthusiast", "link": "https://stackoverflow.com/users/7431823/techenthusiast"}, "edited": false, "score": 0, "creation_date": 1612711182, "post_id": 56492241, "comment_id": 116846305, "body": "Is the article not specific to GCP? How can we make it work in vanilla k8s platform?"}], "tags": [], "owner": {"reputation": 2863, "user_id": 11101419, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8c5QW.png?s=128&g=1", "display_name": "A_Suh", "link": "https://stackoverflow.com/users/11101419/a-suh"}, "is_accepted": false, "score": 0, "last_activity_date": 1559901910, "creation_date": 1559901910, "answer_id": 56492241, "question_id": 56452432, "link": "https://stackoverflow.com/questions/56452432/grpc-load-balancing-with-envoy/56492241#56492241", "title": "GRPC Load Balancing with Envoy", "body": "<p>Here is a decent <a href=\"https://medium.com/google-cloud/istio-grpc-loadbalancing-with-gcp-internal-loadbalancer-ilb-1b058b517640\" rel=\"nofollow noreferrer\">article</a> describing how to setup Istio gRPC Loadbalancing.  </p>\n\n<p>There a two cases:</p>\n\n<pre><code>client_grpc_app (on GCEVM) --&gt; (GCP ILB) --&gt; Istio --&gt; Service\nclient_grpc_app (external) --&gt; (GCP ExternalLB) --&gt; Istio --&gt; Service\n</code></pre>\n\n<p>Hope you find it helpful </p>\n"}], "owner": {"reputation": 1359, "user_id": 1815241, "user_type": "registered", "accept_rate": 71, "profile_image": "https://www.gravatar.com/avatar/4af5ac233bc59102243f2b2266e766b1?s=128&d=identicon&r=PG", "display_name": "mornindew", "link": "https://stackoverflow.com/users/1815241/mornindew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1095, "favorite_count": 0, "answer_count": 1, "score": 2, "last_activity_date": 1559901910, "creation_date": 1559689849, "question_id": 56452432, "link": "https://stackoverflow.com/questions/56452432/grpc-load-balancing-with-envoy", "title": "GRPC Load Balancing with Envoy", "body": "<p>Might be a dumb question (apologies)....</p>\n\n<p>I currently have a microservice application written in GO and using GRPC for all service to service communication.   I am currently using client side load balancing written in GRPC and would like to switch over to a proxy method (istio with envoy).</p>\n\n<p>I can easily enable istio and sidecar injection.   What I am confused on is how I get envoy to RoundRobin across all the services.   Do I need to do anything client side?  Will envoy automatically see the services as they scale?  Seems almost too good to be true that I just need to enable sidecar injection and everything should work like magic.</p>\n\n<p>Thank you very much.</p>\n"}, {"tags": ["file", "go", "text", "printing", "network-printers"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559711507, "post_id": 56451739, "comment_id": 99501556, "body": "Showing your working code isn&#39;t helpful. Replace it with the code that <i>doesn&#39;t</i> work."}, {"owner": {"reputation": 486, "user_id": 2362206, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/mXG3b.jpg?s=128&g=1", "display_name": "Noman ali abbasi", "link": "https://stackoverflow.com/users/2362206/noman-ali-abbasi"}, "edited": false, "score": 0, "creation_date": 1576067504, "post_id": 56451739, "comment_id": 104777010, "body": "Have you found any workaround? I am facing the same issue."}], "answers": [{"tags": [], "owner": {"reputation": 86, "user_id": 10221464, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7080166be5c5eb62f5134ca9d5ef0699?s=128&d=identicon&r=PG&f=1", "display_name": "idanoo", "link": "https://stackoverflow.com/users/10221464/idanoo"}, "is_accepted": false, "score": 0, "last_activity_date": 1594175125, "creation_date": 1594175125, "answer_id": 62786609, "question_id": 56451739, "link": "https://stackoverflow.com/questions/56451739/how-to-print-a-file-or-formatet-text-on-a-network-printer-with-golang/62786609#62786609", "title": "How to print a file or formatet text on a network printer with golang", "body": "<p>The printing library you are using doesn't appear to support PDFs.\n<a href=\"https://github.com/alexbrainman/printer/issues/6\" rel=\"nofollow noreferrer\">https://github.com/alexbrainman/printer/issues/6</a></p>\n<p>I'm in the same bucket trying to find a way to print PDFs in Go. I am currently experimenting with <a href=\"https://github.com/jadefox10200/goprint\" rel=\"nofollow noreferrer\">https://github.com/jadefox10200/goprint</a></p>\n"}], "owner": {"reputation": 1, "user_id": 852122, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/064a490226ff7da7e23e9609cc59468f?s=128&d=identicon&r=PG", "display_name": "Dino", "link": "https://stackoverflow.com/users/852122/dino"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 1562, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1594175125, "creation_date": 1559684658, "last_edit_date": 1559769056, "question_id": 56451739, "link": "https://stackoverflow.com/questions/56451739/how-to-print-a-file-or-formatet-text-on-a-network-printer-with-golang", "title": "How to print a file or formatet text on a network printer with golang", "body": "<p>The below code should print some formatted text on a labeled printer in the network.</p>\n\n<p>I have created a PDF which I would send to the printer but I get only errors- <strong>\"wrong medium...\"</strong></p>\n\n<p><strong>Note:</strong> The printer printed fine with standard font/standard size text, but I should be able to print formatted text as well.</p>\n\n<p>Simple text is working on a Brother QL-500. But I get only errors on the printer and not in the code if i send the pdf content. Raw settings don't work either.</p>\n\n<p>Does someone have a solution and example code?</p>\n\n<p><em>Libraries:</em></p>\n\n<ul>\n<li>PDF - <code>github.com/jung-kurt/gofpdf</code></li>\n<li>Printer - <code>github.com/alexbrainman/printer</code></li>\n</ul>\n\n<p><em>Sample Code:</em></p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"flag\"\n    \"fmt\"\n    \"log\"\n    \"runtime\"\n    \"time\"\n\n    prt \"github.com/alexbrainman/printer\"\n\n    \"github.com/jung-kurt/gofpdf\"\n)\n\nfunc main() {\n    log.SetFlags(log.LstdFlags | log.Llongfile)\n    printFormat := flag.String(\"format\", \"pdf\", \"print the pdf content\")\n    savePDF := flag.Bool(\"s\", false, \"save pdf only\")\n    flag.Parse()\n\n    // pdf output\n    if *savePDF {\n        // create pdf\n        pdf := newReport()\n\n        // Save pdf to disc\n        pdf.OutputFileAndClose(\"report.pdf\")\n    } else {\n        var buf []byte\n        var datatype string\n\n        // switch between formats\n        switch *printFormat {\n        case \"text\":\n            buf = []byte(\"Text report\")\n            datatype = \"text\"\n        case \"pdf\":\n            // create pdf\n            pdf := newReport()\n            var b bytes.Buffer\n            err := pdf.Output(&amp;b)\n            if err != nil {\n                fmt.Println(err)\n            }\n            buf = b.Bytes()\n            datatype = \"raw\"\n        }\n\n        // send content to printer\n        fmt.Println(string(buf))\n        printContent(datatype, buf)\n    }\n}\n\nfunc newReport() *gofpdf.Fpdf {\n    pdf := gofpdf.NewCustom(&amp;gofpdf.InitType{\n        UnitStr:        \"mm\",\n        Size:           gofpdf.SizeType{Wd: 62, Ht: 90},\n        OrientationStr: \"P\",\n    })\n\n    // Pagebreak\n    pdf.SetAutoPageBreak(false, 0)\n\n    // Fileinformations\n    pdf.SetTitle(\"Test PDF\", true)\n\n    // Page Margin\n    pdf.SetMargins(1, 1, 1)\n\n    // We start by adding a new page to the document.\n    pdf.AddPage()\n\n    // UTF8 from File\n    trans := pdf.UnicodeTranslatorFromDescriptor(\"\")\n\n    // Title\n    pdf.SetFont(\"Arial\", \"B\", 6)\n    pdf.CellFormat(0, 2, trans(\"Test PDF\"), \"\", 0, \"C\", false, 0, \"\")\n\n    // The `Ln()` function moves the current position to a new line, with\n    // an optional line height parameter.\n    pdf.Ln(-1)\n\n    pdf.SetFont(\"Arial\", \"\", 5)\n    pdf.CellFormat(0, 2, time.Now().Format(\"02.01.2006   15:04\"), \"\", 0, \"C\", false, 0, \"\")\n    pdf.Ln(-1)\n    pdf.SetFont(\"Arial\", \"B\", 5)\n    pdf.CellFormat(0, 2, trans(\"new text in pdf\"), \"\", 0, \"C\", false, 0, \"\")\n    pdf.Ln(3)\n\n    return pdf\n}\n\nfunc printContent(datatype string, content []byte) {\n    if runtime.GOOS == \"windows\" {\n        name, err := prt.Default() // returns name of Default Printer as string\n        if err != nil {\n            fmt.Println(err)\n        }\n        fmt.Println(name)\n        p, err := prt.Open(name) // Opens the named printer and returns a *Printer\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        err = p.StartDocument(\"test\", datatype)\n        if err != nil {\n            fmt.Println(err)\n        }\n        err = p.StartPage() // begin a new page\n        if err != nil {\n            fmt.Println(err)\n        }\n\n        n, err := p.Write(content) // Send some text to the printer\n        if err != nil {\n            fmt.Println(err)\n        }\n        fmt.Println(\"Num of bytes written to printer:\", n)\n\n        err = p.EndPage() // end of page\n        if err != nil {\n            fmt.Println(err)\n        }\n        err = p.EndDocument() // end of document\n        if err != nil {\n            fmt.Println(err)\n        }\n        err = p.Close() // close the resource\n        if err != nil {\n            fmt.Println(err)\n        }\n    }\n}\n\n</code></pre>\n\n<p><em>Usage:</em></p>\n\n<ul>\n<li>Save pdf only</li>\n</ul>\n\n<pre><code>go run main.go -s\n</code></pre>\n\n<ul>\n<li>Send text to printer</li>\n</ul>\n\n<pre><code>go run main.go -format=text\n</code></pre>\n\n<ul>\n<li>Send pdf content to printer</li>\n</ul>\n\n<pre><code>go run main.go -format=pdf\n</code></pre>\n"}, {"tags": ["go", "vercel"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1559679937, "post_id": 56450592, "comment_id": 99495006, "body": "&quot;I get an error&quot; - what is the error?"}, {"owner": {"reputation": 139, "user_id": 10823323, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xGXmOtSm0mo/AAAAAAAAAAI/AAAAAAAACL8/tApDcsTBpwA/photo.jpg?sz=128", "display_name": "Thomas Teixeira", "link": "https://stackoverflow.com/users/10823323/thomas-teixeira"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559724841, "post_id": 56450592, "comment_id": 99506356, "body": "@Adrian Sorry for that... I get a 502: NO_STATUS_CODE_FROM_LAMBDA because in the function that generate the password I use rand.Intn and when I get an error in createWordsSlice I return zero so my program panics..."}], "owner": {"reputation": 139, "user_id": 10823323, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-xGXmOtSm0mo/AAAAAAAAAAI/AAAAAAAACL8/tApDcsTBpwA/photo.jpg?sz=128", "display_name": "Thomas Teixeira", "link": "https://stackoverflow.com/users/10823323/thomas-teixeira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 192, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559678580, "creation_date": 1559678580, "question_id": 56450592, "link": "https://stackoverflow.com/questions/56450592/how-to-use-a-local-file-with-golang-using-now-zeit-co", "title": "How to use a local file with golang using Now (zeit.co)?", "body": "<p>I'm creating an api with golang and <a href=\"https://zeit.co/\" rel=\"nofollow noreferrer\">zeit-now</a>. I want the API to return a password generated from a list of words (30k). Everything works if I use a local server (<em>http.ListenAndServe</em>), but when I try to access the concerned endpoint with the <a href=\"http://api-git-dev.komfy.now.sh/randDict\" rel=\"nofollow noreferrer\">now link</a>, an error occurs.</p>\n\n<p>I tried to use the <a href=\"https://zeit.co/docs/v2/deployments/builders/overview/?query=includeFiles#including-additional-files\" rel=\"nofollow noreferrer\">config.includeFiles</a> option, but it doesn't work. I also tried to use local path, absolute path but nothing is working.</p>\n\n<p>Here is the now.json and randDict.go files:</p>\n\n<p><strong>now.json</strong></p>\n\n<pre><code>\"builds\": [\n            {\n                \"src\": \"/lambdas/randDict/randDict.go\",\n                \"use\": \"@now/go\",\n                \"config\": {\n                    \"includeFiles\": [\n                        \"template/wordsGist\"\n                    ]\n                }\n            }\n]\n</code></pre>\n\n<p><strong>randDict.go</strong></p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>// Create a slice with the words from the words' file\nfunc createWordsSlice() ([]string, int, error) {\n    // Read all the words inside the file \"wordsGist\"\n    file, err := ioutil.ReadFile(\"template/wordsGist\")\n    if err != nil {\n        fmt.Println(err)\n        return nil, 0, err\n    }\n    // Split the words into a slice\n    words := strings.Split(string(file), \"\\n\")\n    return words, len(words), nil\n\n}\n</code></pre>\n\n<p>Here I expect a slice with all the words, which I'll be using later for password generation, but I get an error and a empty slice (nil).</p>\n\n<p>Here is the <a href=\"https://www.github.com/komfy/api/tree/dev\" rel=\"nofollow noreferrer\">github</a> if you want to read all the code.</p>\n"}, {"tags": ["css", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559674608, "post_id": 56449329, "comment_id": 99492870, "body": "Is <code>static&#47;stylesheets&#47;main.css</code> the correct path to your CSS from your current working directory when you execute the program? Have you checked the network tab in your browser to see what happens with those requests?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1559674628, "post_id": 56449329, "comment_id": 99492874, "body": "Your <code>fs</code> is serving files from the <code>static</code> directory, is there where your css lives? <i>No it&#39;s not</i>."}, {"owner": {"reputation": 71, "user_id": 4577807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wcXB1.jpg?s=128&g=1", "display_name": "Justin White", "link": "https://stackoverflow.com/users/4577807/justin-white"}, "edited": false, "score": 0, "creation_date": 1559704767, "post_id": 56449329, "comment_id": 99500352, "body": "That was it, thank you."}], "owner": {"reputation": 71, "user_id": 4577807, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/wcXB1.jpg?s=128&g=1", "display_name": "Justin White", "link": "https://stackoverflow.com/users/4577807/justin-white"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559672272, "creation_date": 1559672272, "question_id": 56449329, "link": "https://stackoverflow.com/questions/56449329/cant-get-external-style-sheets-to-work-with-golang-templates", "title": "Can&#39;t get external style sheets to work with golang templates", "body": "<p>Internal CSS works fine but external style sheet isn't working.  I end up with the standard page with no styling showing up.  The templates served just fine except no CSS.</p>\n\n<p>Created a simple app to eliminate some of the variables but the same issue persists.</p>\n\n<p>root of app\nC:\\workspace\\goworkspace\\src\\practice3\\</p>\n\n<p>GOPATH C:\\workspace\\goworkspace</p>\n\n<pre><code>//practice3/main.go\npackage main\nimport (\n    \"log\"\n    \"net/http\"\n)\n\nfunc main() {\n    fs := http.FileServer(http.Dir(\"static\"))\n    http.Handle(\"/\", fs)\n\n    log.Println(\"Listening...\")\n    http.ListenAndServe(\":8080\", nil)\n}\n\n//practice3/static/example.html\n&lt;!doctype html&gt;\n&lt;html&gt;\n&lt;head&gt;\n  &lt;meta charset=\"utf-8\"&gt;\n  &lt;title&gt;A static page&lt;/title&gt;\n  &lt;link rel=\"stylesheet\" href=\"/stylesheets/main.css\"&gt;\n&lt;/head&gt;\n&lt;body&gt;\n  &lt;h1&gt;Hello from a static page&lt;/h1&gt;\n&lt;/body&gt;\n&lt;/html&gt;\n\n//practice3/stylesheets/main.css\nbody {\n    background-color: lightblue;\n  }\n\n  h1 {\n    color: navy;`enter code here`\n    margin-left: 20px;\n  }\n</code></pre>\n\n<p>No errors, everything seems to work fine (including internal css) except for the external css.</p>\n"}, {"tags": ["mongodb", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1559671655, "post_id": 56449203, "comment_id": 99491735, "body": "You must export the struct&#39;s fields: <code>Data</code>, <code>Number</code>!"}, {"owner": {"reputation": 23, "user_id": 9605432, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "TraN", "link": "https://stackoverflow.com/users/9605432/tran"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559672324, "post_id": 56449203, "comment_id": 99491962, "body": "Oh it worked. Thank you so much for your help!"}], "owner": {"reputation": 23, "user_id": 9605432, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "TraN", "link": "https://stackoverflow.com/users/9605432/tran"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 2703, "favorite_count": 0, "closed_date": 1559673345, "answer_count": 0, "score": 0, "last_activity_date": 1559673428, "creation_date": 1559671543, "question_id": 56449203, "link": "https://stackoverflow.com/questions/56449203/missing-data-when-call-findone-mongodb-using-golang", "closed_reason": "Duplicate", "title": "Missing data when call findOne mongodb using Golang", "body": "<p>I'm trying to get data from mongodb to golang program. But I don't know why the received data is not full.</p>\n\n<pre><code>package main\n\nimport (\n    \"context\"\n    \"fmt\"\n    \"log\"\n    \"go.mongodb.org/mongo-driver/bson\"\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\nfunc main() {\n    ctx := context.Background()\n    clientOptions := options.Client().ApplyURI(\"mongodb://localhost:27017\")\n    client, err := mongo.Connect(ctx, clientOptions)\n    if err != nil {\n        log.Fatal(err)\n    }\n    err = client.Ping(ctx, nil)\n    if err != nil {\n        log.Fatal(err)\n    }\n    fmt.Println(\"Connected to MongoDB!\")\n    db := client.Database(\"testDB\")\n    col := db.Collection(\"testcs\")\n\n    type Dataa struct {\n        ID        bson.RawValue `bson:\"_id\"`\n        data      string        `bson:\"data\"`\n        number    int           `bson:\"number\"`\n    }\n    filter := bson.M{\"number\": 2}\n    var p Dataa\n    if err := col.FindOne(ctx, filter).Decode(&amp;p); err != nil {\n        log.Fatal(err)\n    } \n    fmt.Printf(\"post: %+v\\n\", p)\n}\n</code></pre>\n\n<p>Receiced data is:\npost: {ID:{\"$oid\":\"5cf64ca8d95df708be0ed503\"} data: number:0}</p>\n\n<p>But the \"data\" value should be \"ABCEX\" and \"number\" value should be 2 \nlike what I have addded into mongodb.</p>\n\n<p>Could you guys please help me to find out the problem. Thank you!</p>\n"}, {"tags": ["go", "clickhouse", "fasthttp"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559712283, "post_id": 56446787, "comment_id": 99501723, "body": "db.Query does not generally retrieve all rows. That&#39;s what the Next method is for. There may be some buffering on the network connection, and the driver implementation determines the details, but the sql package definitely doesn&#39;t load the whole result set into memory explicitly."}, {"owner": {"reputation": 11, "user_id": 11599641, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DLbtXqEIXWg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmZ2R_TXtnmWv4lgoXfEuGDQVoBQ/mo/photo.jpg?sz=128", "display_name": "Vasilij Zhvachkin", "link": "https://stackoverflow.com/users/11599641/vasilij-zhvachkin"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559715361, "post_id": 56446787, "comment_id": 99502499, "body": "Thank you very much for your answer. I thought so before try to comment call to next() method. But response time still was the similar. Nevertheless is there a way to get all the rows in one request without connection buffering? There are just 4-5 rows with 3 columns each"}], "owner": {"reputation": 11, "user_id": 11599641, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-DLbtXqEIXWg/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rdmZ2R_TXtnmWv4lgoXfEuGDQVoBQ/mo/photo.jpg?sz=128", "display_name": "Vasilij Zhvachkin", "link": "https://stackoverflow.com/users/11599641/vasilij-zhvachkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 135, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559732755, "creation_date": 1559661406, "last_edit_date": 1559732755, "question_id": 56446787, "link": "https://stackoverflow.com/questions/56446787/understanding-response-time-costs", "title": "Understanding response time costs", "body": "<p>I'm new in Golang and trying to write simple web-server with json response. One of endpoints is for database access. With static-like response (such as any static string or simple data conversion) average response time is about 0s (&lt;1ms). If I add some database request, average time increases up to 250ms and not depending on function content. So I'm trying to understand the timing of this function.</p>\n\n<p>What I've already know:</p>\n\n<ol>\n<li>Query to db costs about 40-50ms</li>\n<li>Datetime transformation costs >1ms</li>\n<li><code>json.Marshal</code> costs &lt;1ms</li>\n<li><code>string(json.Marshal)</code> &lt;1ms</li>\n</ol>\n\n<p>All my problem is in <code>rows.Next()</code>:</p>\n\n<ol start=\"5\">\n<li>all inside <code>rows.Next()</code> costs &lt;1ms separately</li>\n<li>Each <code>row.Next()</code> procedure cost depends on row length and it is about 10-50ms. </li>\n</ol>\n\n<p>If I understand <code>db.Query()</code> gets all rows in one request and keeps it in memory providing virtual cursor as iterator ( <code>.Next()</code>). Why does it cost so much?</p>\n\n<ol start=\"7\">\n<li>All <code>row.Next()</code> data processing costs about 180ms. With 40ms <code>db.Query</code> together it approx equals to total response time (~240ms)</li>\n<li>If I comment all <code>row.Next()</code> cycle and just make <code>db.Query</code> total response still costs 200-240ms</li>\n</ol>\n\n<p>Packages I use:</p>\n\n<pre><code>import (\n    \"database/sql\"\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"os\"\n    \"strconv\"\n    \"time\"\n    \"github.com/kshvakov/clickhouse\"\n    routing \"github.com/qiangxue/fasthttp-routing\"\n    \"github.com/valyala/fasthttp\"\n)\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getRecs(client string, dt string) string {\n    dtT := transformDate(&amp;dt)\n    rows, err := db.Query(getRecsRequest(&amp;client, &amp;dtT))\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    start := time.Now()\n\n    got := []databaseRows{}\n    elapsed := time.Since(start)\n    for rows.Next() {\n        elapsed = time.Since(start)\n        log.Printf(\"Next took %s\", elapsed)\n        var r databaseRows\n        err := rows.Scan(&amp;r.ItemIds, &amp;r.DtRecommendation, &amp;r.Number)\n        if err != nil {\n            log.Fatal(err)\n        }\n        got = append(got, r)\n        start = time.Now()\n    }\n\n    jsonData, err := json.Marshal(&amp;got)\n    return string(jsonData)\n}\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func getRecs(client string, dt string) string {\n    dtT := transformDate(&amp;dt)\n    rows, err := db.Query(getRecsRequest(&amp;client, &amp;dtT))\n\n    if err != nil {\n        log.Fatal(err)\n    }\n    defer rows.Close()\n\n    // start := time.Now()\n\n    got := \"[]databaseRows{}\"\n    // elapsed := time.Since(start)\n    // for rows.Next() {\n    //  elapsed = time.Since(start)\n    //  log.Printf(\"Next took %s\", elapsed)\n    //  var r databaseRows\n    //  err := rows.Scan(&amp;r.ItemIds, &amp;r.DtRecommendation, &amp;r.Number)\n    //  if err != nil {\n    //      log.Fatal(err)\n    //  }\n    //  got = append(got, r)\n    //  start = time.Now()\n    // }\n\n    jsonData, err := json.Marshal(&amp;got)\n    return string(jsonData)\n}\n</code></pre>\n\n<p>Can I expect web-server response time is about database request time?</p>\n\n<p>UPDATE. </p>\n\n<p>I've tried \"github.com/jmoiron/sqlx\" with \"github.com/kshvakov/clickhouse\" and result was the same; only syntax changed.</p>\n\n<p>I also tried \"github.com/mailru/go-clickhouse\" with \"database/sql\". It provides access to HTTP interface to clickhouse. I got all rows in one requets as expected, but it tooks about 240ms for the http request and about 0ms for data processing.. So I am looking for opportunity to keep tcp connection opened to be able get all nessasery rows in one request and work with my program side memory buffer (with some buffer limit in combnation with tcp/socket buffer). </p>\n\n<p>UPDATE 2.</p>\n\n<p>Ok, I've tried native clickhouse client (and other such DBeaver) and approx 250ms is the limit for this request. But it may be only clickhouse native tcp interface limitation.\nBut what is the 40-50ms db.Query() operation, which returns no rows. Is the time for query on server side? Or just query string check?</p>\n"}, {"tags": ["json", "function", "go", "interface"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 2, "creation_date": 1559661923, "post_id": 56446673, "comment_id": 99487342, "body": "<code>json.Unmarshal</code> already is a function to do that, and it works the only reasonable way - by taking a pointer to the value to deserialize into. What are you trying to change about that behavior with your wrapper function?"}, {"owner": {"reputation": 39, "user_id": 5674632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec20c8ac52740297c7cc4ec1b872ecc8?s=128&d=identicon&r=PG&f=1", "display_name": "Eliad", "link": "https://stackoverflow.com/users/5674632/eliad"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559663008, "post_id": 56446673, "comment_id": 99487943, "body": "Because I want to save repeating those lines of code including casting jsonString into byte arrayy"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 1, "creation_date": 1559663325, "post_id": 56446673, "comment_id": 99488103, "body": "So remove the return value and return statement and use it the same way you&#39;d use <code>json.Unmarshal</code>."}], "answers": [{"comments": [{"owner": {"reputation": 39, "user_id": 5674632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec20c8ac52740297c7cc4ec1b872ecc8?s=128&d=identicon&r=PG&f=1", "display_name": "Eliad", "link": "https://stackoverflow.com/users/5674632/eliad"}, "edited": false, "score": 0, "creation_date": 1559677695, "post_id": 56447598, "comment_id": 99494084, "body": "Thank you very mcuh! I changed the function to return error instead of interface because it&#39;s already create the object inside emptyJsonAble pointer"}], "tags": [], "owner": {"reputation": 102, "user_id": 3886935, "user_type": "registered", "profile_image": "https://graph.facebook.com/734980351/picture?type=large", "display_name": "Raymond Jones", "link": "https://stackoverflow.com/users/3886935/raymond-jones"}, "is_accepted": false, "score": 1, "last_activity_date": 1559664497, "creation_date": 1559664497, "answer_id": 56447598, "question_id": 56446673, "link": "https://stackoverflow.com/questions/56446673/how-do-i-create-a-generic-function-which-converts-json-string-into-a-struct-in-g/56447598#56447598", "title": "How do I create a generic function which converts json string into a struct in golang?", "body": "<p>When you pass the User struct through, you are effectively passing it a copy of the value, in your scenario what you want to do is pass a pointer reference to the type. Then, because you already have a pointer, you do not need to pass by reference inside of your function:</p>\n\n<p><code>user := FromJson(&amp;User{}, str)</code></p>\n\n<p><code>err := json.Unmarshal([]byte(jsonString), emptyJsonAble)</code></p>\n\n<p><a href=\"https://play.golang.org/p/uXMcFCl138y\" rel=\"nofollow noreferrer\">https://play.golang.org/p/uXMcFCl138y</a></p>\n\n<p>UPDATE:</p>\n\n<p>equally, because you are now passing by reference, you do not need to return a copy of the unmarshalled data struct:</p>\n\n<p><a href=\"https://play.golang.org/p/GJKqVJLbRCZ\" rel=\"nofollow noreferrer\">https://play.golang.org/p/GJKqVJLbRCZ</a></p>\n\n<p>In both cases, we can see the results are the same, so your return of the data is unnecessary</p>\n"}], "owner": {"reputation": 39, "user_id": 5674632, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ec20c8ac52740297c7cc4ec1b872ecc8?s=128&d=identicon&r=PG&f=1", "display_name": "Eliad", "link": "https://stackoverflow.com/users/5674632/eliad"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 128, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559664497, "creation_date": 1559661061, "last_edit_date": 1559661676, "question_id": 56446673, "link": "https://stackoverflow.com/questions/56446673/how-do-i-create-a-generic-function-which-converts-json-string-into-a-struct-in-g", "title": "How do I create a generic function which converts json string into a struct in golang?", "body": "<p>First of all, I have the folowing struct:</p>\n\n<pre><code>type User struct {\n    Username string\n    Password string\n    FullName string\n    Mail string\n}\n</code></pre>\n\n<p>And I have tried to create the folowing function:</p>\n\n<pre><code>func FromJson(emptyJsonAble interface{},jsonString string) interface{} {\n    err := json.Unmarshal([]byte(jsonString), &amp;emptyJsonAble)\n    if err != nil {\n        panic(err)\n    }\n    return emptyJsonAble\n}\n</code></pre>\n\n<p>I have called to the function in the folowing way:</p>\n\n<pre><code>user := FromJson(User{}, str)\n</code></pre>\n\n<p>But the function returns the folowing map instead of User struct:</p>\n\n<p><strong>map[FullName:a Mail:a Password:b Username:a]</strong></p>\n\n<p>How do I return the struct itself <strong>(witout converting the returned object every time)</strong>?</p>\n\n<p>In other words, how to make the function to consider emptyJsonAble as User type when give.\nI have tryed to work with reflect.Type, but I'm stuck</p>\n"}, {"tags": ["go", "pipe"], "answers": [{"comments": [{"owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "edited": false, "score": 0, "creation_date": 1559664478, "post_id": 56447115, "comment_id": 99488637, "body": "This worked - loading my file into a <code>var myBytes []byte</code> and then assigning <code>mySession.Stdin = bytes.NewReader(myBytes)</code> made it so that the input was finally accepted (at least when I send the command <code>echo $(cat &#47;dev&#47;stdin)</code>. Piping <code>cat &#47;dev&#47;stdin | echo</code> didn&#39;t work, for whatever reason, but that&#39;s a separate issue)"}], "tags": [], "owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "is_accepted": true, "score": 2, "last_activity_date": 1559662610, "creation_date": 1559662610, "answer_id": 56447115, "question_id": 56445585, "link": "https://stackoverflow.com/questions/56445585/writing-to-ssh-session-stdinpipe-is-hanging/56447115#56447115", "title": "Writing to ssh.Session.StdinPipe() is hanging", "body": "<p><code>StdinPipe</code> is the standard input for the <strong>remote command</strong>, as mentioned in <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.StdinPipe\" rel=\"nofollow noreferrer\">the docs</a>.</p>\n\n<p>Your second example attempts to write to stdin on the remote host without running a command. Since there is no remote command, there is no consumer for stdin, hanging forever.</p>\n\n<p>Instead, you should do something similar to the <a href=\"https://godoc.org/golang.org/x/crypto/ssh#Session.Output\" rel=\"nofollow noreferrer\">Output</a> method:</p>\n\n<pre><code>func (s *Session) Output(cmd string) ([]byte, error) {\n    if s.Stdout != nil {\n        return nil, errors.New(\"ssh: Stdout already set\")\n    }\n    var b bytes.Buffer\n    s.Stdout = &amp;b\n    err := s.Run(cmd)  &lt;---- you need to run a command on the remote host.\n    return b.Bytes(), err\n}\n</code></pre>\n"}], "owner": {"reputation": 18299, "user_id": 2648811, "user_type": "registered", "accept_rate": 33, "profile_image": "https://www.gravatar.com/avatar/ee5af60b10a2d5fd8c864437a2062f0a?s=128&d=identicon&r=PG", "display_name": "Green Cloak Guy", "link": "https://stackoverflow.com/users/2648811/green-cloak-guy"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 703, "favorite_count": 0, "accepted_answer_id": 56447115, "answer_count": 1, "score": 0, "last_activity_date": 1559735362, "creation_date": 1559657137, "last_edit_date": 1559735362, "question_id": 56445585, "link": "https://stackoverflow.com/questions/56445585/writing-to-ssh-session-stdinpipe-is-hanging", "title": "Writing to ssh.Session.StdinPipe() is hanging", "body": "<p>I'm using go's ssh module, and I'm trying to pipe input from my program to the remote shell over stdin. This works as expected, printing <code>Hello World</code>:</p>\n\n<pre><code>mySession := PrepareSession()  // helper method to prepare a Connection and Session object\noutput, _ := mySession.Output(\"echo Hello World\")\nfmt.Println(output)\n</code></pre>\n\n<p>When I try to provide stdin input, however, it hangs on the line <code>myStdin.Write(\"Hello World\")</code> (I've confirmed this with a debugger):</p>\n\n<pre><code>mySession := PrepareSession()\nmyStdin, _ := mySession.StdinPipe()\nmyStdin.Write(\"Hello World\")\noutput, _ := mySession.Output(\"cat /dev/stdin | echo\")\nfmt.Println(output)\n</code></pre>\n\n<p>Replacing <code>myStdin.Write(\"Hello World\")</code> with <code>fmt.Fprint(myStdin, \"Hello World\")</code> yields the same problem.</p>\n\n<p>Overall I just don't understand how pipes work in Go - how do I get the pipe to stop hanging when I feed input to it?</p>\n"}, {"tags": ["go", "timezone"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 2, "creation_date": 1559641207, "post_id": 56441264, "comment_id": 99475903, "body": "See <a href=\"https://stackoverflow.com/questions/54552101/how-to-construct-time-time-with-timezone-offset-in-go/54552153#54552153\">How to construct time.Time with timezone offset in Go</a>, also <a href=\"https://stackoverflow.com/questions/50287664/why-is-time-parse-not-using-the-timezone/50287766#50287766\">Why is time.Parse not using the timezone?</a>"}, {"owner": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559642612, "post_id": 56441264, "comment_id": 99476629, "body": "I see how to do it:    location, _ := time.LoadLocation(s)     name, offset := time.Now().In(location).Zone()     fmt.Printf(&quot;name:%#v, offset:%#v\\n&quot;, name, offset)"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559642667, "post_id": 56441264, "comment_id": 99476658, "body": "The UTC offset is only defined at a particular date and time (it often changes twice a year due to daylight savings time, for instance). Use <a href=\"https://golang.org/pkg/time/#Time.Format\" rel=\"nofollow noreferrer\">Time.Format</a> to print the offset for a time.Time value."}], "answers": [{"tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 1, "last_activity_date": 1559641193, "creation_date": 1559641193, "answer_id": 56441301, "question_id": 56441264, "link": "https://stackoverflow.com/questions/56441264/how-could-i-get-exact-timezone-info-from-string-like-0800-from-asia-shanghai/56441301#56441301", "title": "How could I get exact timezone info from string, like +08:00 from &quot;Asia/Shanghai&quot; using golang?", "body": "<p>Use the <a href=\"https://golang.org/pkg/time/#LoadLocation\" rel=\"nofollow noreferrer\">LoadLocation</a> function.</p>\n"}, {"comments": [{"owner": {"reputation": 2121, "user_id": 2759097, "user_type": "registered", "accept_rate": 73, "profile_image": "https://graph.facebook.com/1010688230/picture?type=large", "display_name": "DaFois", "link": "https://stackoverflow.com/users/2759097/dafois"}, "edited": false, "score": 1, "creation_date": 1559644540, "post_id": 56441699, "comment_id": 99477630, "body": "Please take some minute to add some explanation to your answer. It will improve your answer for future users."}], "tags": [], "owner": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "is_accepted": false, "score": -2, "last_activity_date": 1559642727, "creation_date": 1559642727, "answer_id": 56441699, "question_id": 56441264, "link": "https://stackoverflow.com/questions/56441264/how-could-i-get-exact-timezone-info-from-string-like-0800-from-asia-shanghai/56441699#56441699", "title": "How could I get exact timezone info from string, like +08:00 from &quot;Asia/Shanghai&quot; using golang?", "body": "<pre><code>location, _ := time.LoadLocation(s)\nname, offset := time.Now().In(location).Zone()\n// offset is what I want\nfmt.Printf(\"name:%#v, offset:%#v\\n\", name, offset)\n</code></pre>\n"}], "owner": {"reputation": 17, "user_id": 11598078, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-nSR0qCTUWr0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3refuVmH9W3KEMqhj4VHpHFjHnFxmg/mo/photo.jpg?sz=128", "display_name": "\u5f20todd", "link": "https://stackoverflow.com/users/11598078/%e5%bc%a0todd"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 102, "favorite_count": 0, "answer_count": 2, "score": -1, "last_activity_date": 1559657261, "creation_date": 1559641068, "last_edit_date": 1559657261, "question_id": 56441264, "link": "https://stackoverflow.com/questions/56441264/how-could-i-get-exact-timezone-info-from-string-like-0800-from-asia-shanghai", "title": "How could I get exact timezone info from string, like +08:00 from &quot;Asia/Shanghai&quot; using golang?", "body": "<p>I want to get exact timezone from string, like +08:00 from \"Asia/Shanghai\"</p>\n"}, {"tags": ["go", "go-gorm"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559649559, "post_id": 56440791, "comment_id": 99480266, "body": "Is your question how to make it faster? If so, why do you think it&#39;s performing poorly? Or do you want to know how to make it &quot;less clunky&quot; (whatever that means)?"}, {"owner": {"reputation": 1225, "user_id": 3104045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/mcv32.jpg?s=128&g=1", "display_name": "Donnie Ashok", "link": "https://stackoverflow.com/users/3104045/donnie-ashok"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559656124, "post_id": 56440791, "comment_id": 99484071, "body": "1. I do think it can perform better because normally without Gorm I would use the JOIN statement to get the User data and not make a separate second call on Users table. 2. I want to know how would you put the db methods together? Does this look alright to you?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559658924, "post_id": 56440791, "comment_id": 99485611, "body": "If you find yourself working around your ORM, it&#39;s time to stop using an ORM."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559658949, "post_id": 56440791, "comment_id": 99485625, "body": "(It&#39;s always time to stop using an ORM)"}], "owner": {"reputation": 1225, "user_id": 3104045, "user_type": "registered", "accept_rate": 90, "profile_image": "https://i.stack.imgur.com/mcv32.jpg?s=128&g=1", "display_name": "Donnie Ashok", "link": "https://stackoverflow.com/users/3104045/donnie-ashok"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 40, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559639296, "creation_date": 1559639296, "question_id": 56440791, "link": "https://stackoverflow.com/questions/56440791/most-idiomatic-way-of-searching-by-relations-in-gorm", "title": "Most idiomatic way of searching by relations in Gorm", "body": "<p>I have a Room search, which requires the Room struct to contain the entire User struct.</p>\n\n<pre><code>type Room struct {\n    ID        *int64     `json:\"id\"`\n    CreatedAt *time.Time `json:\"created_at,omitempty\" gorm:\"not null\"`\n    UpdatedAt *time.Time `json:\"updated_at,omitempty\"`\n    DeletedAt *time.Time `json:\"deleted_at,omitempty\"`\n\n    User   *User  `json:\"user,omitempty\"`\n    UserID *int64 `json:\"user_id,omitempty\"`\n}\n</code></pre>\n\n<p>and</p>\n\n<pre><code>type User struct {\n    ID        *int64     `json:\"id\"`\n    CreatedAt *time.Time `json:\"created_at,omitempty\" gorm:\"not null\"`\n    UpdatedAt *time.Time `json:\"updated_at,omitempty\"`\n    DeletedAt *time.Time `json:\"deleted_at,omitempty\"`\n\n    FirstName *string `json:\"first_name,omitempty\"`\n    LastName  *string `json:\"last_name,omitempty\"`\n}\n</code></pre>\n\n<p>while the search function looks like this</p>\n\n<pre><code>func searchRoom(db *gorm.DB, q string) ([]Room, error) {\n    q = \"%\" + q + \"%\"\n\n    rooms := []Room{}\n\n    db.Preload(\"User\").\n        Joins(\"LEFT JOIN users on rooms.user_id = users.id\").\n        Where(\n            \"CONCAT(users.first_name, ' ', users.last_name) LIKE ?\",\n            q,\n        ).\n        Find(&amp;rooms)\n\n    return rooms, nil\n}\n</code></pre>\n\n<p>This works pretty well the way it is expected, however, to me this looks a bit clunky, I went through Gorm docs, but didn't find anything else which could help me.</p>\n\n<p>I could use the <code>db.Raw</code> method, but that does not fill the user struct automatically.</p>\n\n<p>Is there a better way to use Gorm and make it more performant?</p>\n"}, {"tags": ["go", "visual-studio-code"], "answers": [{"tags": [], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "is_accepted": true, "score": 1, "last_activity_date": 1559645753, "creation_date": 1559645753, "answer_id": 56442473, "question_id": 56440524, "link": "https://stackoverflow.com/questions/56440524/realtime-errors-warnings-without-file-save-in-vscode/56442473#56442473", "title": "Realtime errors/warnings without file save in VSCode", "body": "<p>I found the solution. </p>\n\n<p>Basically adding the following to user settings (settings.json):</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>\"go.liveErrors\": {\n  \"enabled\": true,\n  \"delay\": 500\n}\n</code></pre>\n\n<p>VSCode will then ask you to install the gotype-live tool. You can also install manually if you want with the following command:</p>\n\n<pre><code>go get -v github.com/tylerb/gotype-live\n</code></pre>\n"}], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 140, "favorite_count": 0, "accepted_answer_id": 56442473, "answer_count": 1, "score": 0, "last_activity_date": 1559654458, "creation_date": 1559638497, "last_edit_date": 1559654458, "question_id": 56440524, "link": "https://stackoverflow.com/questions/56440524/realtime-errors-warnings-without-file-save-in-vscode", "title": "Realtime errors/warnings without file save in VSCode", "body": "<p>VSCode can only report syntax errors/warnings after I save the file for Go. This behavior is different from other languages such as <a href=\"https://dartcode.org/\" rel=\"nofollow noreferrer\">dart</a>. Can I have real time errors/warnings in Go?</p>\n"}, {"tags": ["python", "go", "pickle", "golang-migrate"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559638322, "post_id": 56439726, "comment_id": 99474286, "body": "You&#39;re ignoring errors. Don&#39;t do that. You may well have a problem opening the file, but you&#39;ll never know unless you check <i>all</i> your errors."}, {"owner": {"reputation": 456, "user_id": 8305774, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E9HQP.png?s=128&g=1", "display_name": "skysoft999", "link": "https://stackoverflow.com/users/8305774/skysoft999"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559647471, "post_id": 56439726, "comment_id": 99479133, "body": "I have checked the errors. Can u find any issues here ? i&#39;m a newbie in go @Flimzy"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559647721, "post_id": 56439726, "comment_id": 99479270, "body": "Update your code. What do the errors say?"}, {"owner": {"reputation": 456, "user_id": 8305774, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E9HQP.png?s=128&g=1", "display_name": "skysoft999", "link": "https://stackoverflow.com/users/8305774/skysoft999"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559649230, "post_id": 56439726, "comment_id": 99480070, "body": "I have hardcoded pickled data instead of os.Open, still ts giving error. <a href=\"https://play.golang.org/p/kApqin8mY5g\" rel=\"nofollow noreferrer\">play.golang.org/p/kApqin8mY5g</a>"}, {"owner": {"reputation": 456, "user_id": 8305774, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E9HQP.png?s=128&g=1", "display_name": "skysoft999", "link": "https://stackoverflow.com/users/8305774/skysoft999"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559649243, "post_id": 56439726, "comment_id": 99480075, "body": "Erro MsG: Pickle Machine failed on opcode:0x62. Stack size:0. Memo size:0. Cause:Stack is too small to perform requested operation"}, {"owner": {"reputation": 12516, "user_id": 302268, "user_type": "registered", "accept_rate": 77, "profile_image": "https://www.gravatar.com/avatar/c3985dffcdc646b67ed0699a364639e2?s=128&d=identicon&r=PG", "display_name": "Mad Wombat", "link": "https://stackoverflow.com/users/302268/mad-wombat"}, "edited": false, "score": 2, "creation_date": 1559661356, "post_id": 56439726, "comment_id": 99487012, "body": "The pickle protocol changed between python 2 and 3. The library you are using can only read up to protocol 2 and python 3 defaults to protocol 3. Either take care to pickle using older protocol or better yet use something that is not pickle, like MsgPack or whatever."}], "owner": {"reputation": 456, "user_id": 8305774, "user_type": "registered", "accept_rate": 50, "profile_image": "https://i.stack.imgur.com/E9HQP.png?s=128&g=1", "display_name": "skysoft999", "link": "https://stackoverflow.com/users/8305774/skysoft999"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 134, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559638251, "creation_date": 1559635404, "last_edit_date": 1559638251, "question_id": 56439726, "link": "https://stackoverflow.com/questions/56439726/unpickling-python-dict-object", "title": "Unpickling python dict object", "body": "<p>I have some data stored in Redis which is saved by python app by pickling the data. So basically this is a pickled python dict object. I want to get this stored data in golang. \nI found a library : <a href=\"https://godoc.org/github.com/hydrogen18/stalecucumber\" rel=\"nofollow noreferrer\">https://godoc.org/github.com/hydrogen18/stalecucumber</a></p>\n\n<p>But when I try some basic example to do unpickling its giving errors like:</p>\n\n<pre><code>string:Pickle Machine failed on opcode:0x62. Stack size:0. Memo size:0. Cause:Stack is too small to perform requested operation\nstring:Pickle Machine failed on opcode:0x5c. Stack size:0. Memo size:0. Cause:Opcode is invalid\n</code></pre>\n\n<p>For more clarification refer example given below.</p>\n\n<ul>\n<li><code>Data = pickle.dumps({\"apple\":1,\"banana\":2,\"cat\":\"hello\",\"Dog\":42.0})</code> #python pickling</li>\n<li>Pickled data = <code>b'\\x80\\x03}q\\x00(X\\x05\\x00\\x00\\x00appleq\\x01K\\x01X\\x06\\x00\\x00\\x00bananaq\\x02K\\x02X\\x03\\x00\\x00\\x00catq\\x03X\\x05\\x00\\x00\\x00helloq\\x04X\\x03\\x00\\x00\\x00Dogq\\x05G@E\\x00\\x00\\x00\\x00\\x00\\x00u.'</code></li>\n</ul>\n\n<p>My try to unpickle in Go:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"stalecucumber\"\n    \"io\"\n    \"os\"\n)    \n\nfunc main() {\n    var pickledDict io.Reader\n    var err error\n    pickledDict, err = os.Open(\"file.txt\")\n    fmt.Println(pickledDict)\n    mystruct := struct{\n        Apple  int\n        Banana uint\n        Cat    string\n        Dog    float32\n    }{}\n\n    err = stalecucumber.UnpackInto(&amp;mystruct).From(stalecucumber.Unpickle(pickledDict))\n    if err != nil {\n        fmt.Println(err)\n    }\n    fmt.Println(mystruct)\n}\n</code></pre>\n\n<p>Getting Error: </p>\n\n<pre><code>Pickle Machine failed on opcode:0x62. Stack size:0. Memo size:0. Cause:Stack is too small to perform requested operation\n{0 0  0}\n</code></pre>\n"}, {"tags": ["string", "go", "utf-8", "character-encoding", "slice"], "answers": [{"tags": [], "owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "is_accepted": false, "score": 1, "last_activity_date": 1559625764, "creation_date": 1559625764, "answer_id": 56437769, "question_id": 56437255, "link": "https://stackoverflow.com/questions/56437255/can-i-corrupt-data-converting-between-byte-and-string/56437769#56437769", "title": "Can I corrupt data converting between []byte and string?", "body": "<p>You can convert a <code>string</code> to <code>[]byte</code> or vice versa, <strong>SAFELY</strong>.</p>\n\n<p>From the <a href=\"https://golang.org/ref/spec#String_types\" rel=\"nofollow noreferrer\">golang spec</a>:</p>\n\n<blockquote>\n  <p>A string value is a (possibly empty) sequence of bytes.</p>\n</blockquote>\n\n<p>Also from the <a href=\"https://blog.golang.org/strings\" rel=\"nofollow noreferrer\">official blog</a>:</p>\n\n<blockquote>\n  <p>In Go, a string is in effect a read-only slice of bytes.</p>\n</blockquote>\n"}, {"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1559625772, "creation_date": 1559625772, "answer_id": 56437773, "question_id": 56437255, "link": "https://stackoverflow.com/questions/56437255/can-i-corrupt-data-converting-between-byte-and-string/56437773#56437773", "title": "Can I corrupt data converting between []byte and string?", "body": "<p>No, the data will not be corrupted.  The conversions copy the bytes with no interpretation of what those bytes are. Here are the relevant sentences from the <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">specification</a>:</p>\n\n<blockquote>\n  <p>Converting a slice of bytes to a string type yields a string whose successive bytes are the elements of the slice.</p>\n</blockquote>\n\n<p>and</p>\n\n<blockquote>\n  <p>Converting a value of a string type to a slice of bytes type yields a slice whose successive elements are the bytes of the string.</p>\n</blockquote>\n\n<p>Go strings can contain arbitrary byte sequences.</p>\n"}, {"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 6, "last_activity_date": 1559654739, "last_edit_date": 1559654739, "creation_date": 1559635182, "answer_id": 56439673, "question_id": 56437255, "link": "https://stackoverflow.com/questions/56437255/can-i-corrupt-data-converting-between-byte-and-string/56439673#56439673", "title": "Can I corrupt data converting between []byte and string?", "body": "<p>As Cerise Lim\u00f3n wrote, it won't be corrupted. Converting between <code>string</code> and <code>[]byte</code> does not interpret the bytes, it just copies them as-are.</p>\n\n<p>Do note however that if you would convert between <code>string</code> and <code>[]rune</code>, that might change the content becase as written in <a href=\"https://golang.org/ref/spec#Conversions_to_and_from_a_string_type\" rel=\"nofollow noreferrer\">Spec: Conversions to and from a string type</a>:</p>\n\n<blockquote>\n  <p>Converting a value of a string type to a slice of runes type yields a slice containing the individual Unicode code points of the string.</p>\n</blockquote>\n\n<p>So this conversion decodes the runes (Unicode codepoints), and if the input <code>string</code> is not a valid UTF-8 encoded text, the Unicode replacement character <code>0xFFFD</code> will be used in such cases.</p>\n\n<p>For example a <code>string</code> containing a single <code>0xff</code> byte is not a valid UTF-8 encoded text:</p>\n\n<pre><code>fooString := \"\\xff\"\nbarString := string([]rune(fooString))\nfmt.Println(fooString == barString)\nfmt.Printf(\"%x %x\", fooString, barString)\n</code></pre>\n\n<p>Outputs (try it on the <a href=\"https://play.golang.org/p/cvjRfx4c1Xn\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>false\nff efbfbd\n</code></pre>\n\n<p>(Note: the hex <code>efbfdb</code> is the 3-byte UTF-8 encoded value of the Unicode replacement character <code>0xFFFD</code>.)</p>\n"}], "owner": {"reputation": 2282, "user_id": 1483903, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/6c37dd8068c794e8268a332d944cd7e8?s=128&d=identicon&r=PG", "display_name": "thebiggestlebowski", "link": "https://stackoverflow.com/users/1483903/thebiggestlebowski"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 213, "favorite_count": 0, "accepted_answer_id": 56439673, "answer_count": 3, "score": 0, "last_activity_date": 1559654739, "creation_date": 1559621682, "last_edit_date": 1559635238, "question_id": 56437255, "link": "https://stackoverflow.com/questions/56437255/can-i-corrupt-data-converting-between-byte-and-string", "title": "Can I corrupt data converting between []byte and string?", "body": "<p>In Go, if I convert from a string -> []byte or conversely, from []byte -> string, could the data ever get corrupted.  For example, let's say I've defined:</p>\n\n<pre><code>fooBytes := []byte(fooString)\nfooConvertedBack := string(fooBytes\nfooBytesConvertedBack := []byte(fooConvertedBack)\n</code></pre>\n\n<p>Then could we get a case where data gets corrupted such that:</p>\n\n<pre><code>fooString != fooConvertedBack\nfooBytes != fooBytesConvertedBack\n</code></pre>\n\n<p>I'm guessing the answer here is no.  I'm working with random arrays of bytes and I want to make sure that I won't corrupt data because, say for example, a golang string has a default character set which doesn't allow for completely random bytes.</p>\n\n<p>Is it better to base64 encode the bytes?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1559630615, "post_id": 56436860, "comment_id": 99470818, "body": "<code>&#47;home</code> should be served by a separate handler from the login one. LoginHandler should log in the user, create and set a cookie session, redirect and return (no rendering necessary). The HomeHandler should retrieve the session, retrieve the user info associated with the session, and then render the home page."}, {"owner": {"reputation": 17024, "user_id": 1296707, "user_type": "registered", "accept_rate": 50, "profile_image": "https://www.gravatar.com/avatar/cc4319dbdd4adbb6d25f1eb2309eec20?s=128&d=identicon&r=PG", "display_name": "Markus W Mahlberg", "link": "https://stackoverflow.com/users/1296707/markus-w-mahlberg"}, "edited": false, "score": 0, "creation_date": 1559691853, "post_id": 56436860, "comment_id": 99498231, "body": "The <code>PageVars</code>just happened to be named by you that way. It is the <a href=\"https://stackoverflow.com/questions/23260821/what-is-apache-velocity/23261610#23261610\">context for the template engine</a>, and will cease to exist after the handler finished. What you want are <a href=\"https://stackoverflow.com/a/35292106/1296707\">session variables</a>."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559721079, "post_id": 56436860, "comment_id": 99504561, "body": "Thanks for the clarity. I updated your title, too."}], "owner": {"reputation": 41, "user_id": 10405483, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-Z4PahWppaMI/AAAAAAAAAAI/AAAAAAAAAAA/AAN31DUwz0-5sYxEHOdMMMWz7Sc2WVa7wg/mo/photo.jpg?sz=128", "display_name": "Ar_11", "link": "https://stackoverflow.com/users/10405483/ar-11"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 148, "favorite_count": 0, "answer_count": 0, "score": 0, "last_activity_date": 1559721070, "creation_date": 1559617662, "last_edit_date": 1559721070, "question_id": 56436860, "link": "https://stackoverflow.com/questions/56436860/using-http-redirect-to-redirect-to-a-webpage-that-is-generated-using-html-templa", "title": "Using http.Redirect to redirect to a webpage that is generated using html template", "body": "<p>I want to redirect to homepage after successful logging in and I'm generating the HTML for the homepage using go HTML-template. When I login the url does change to <code>/home</code> and the HTML page loads too. But it doesn't load the page variables passed from server-side.</p>\n\n<pre><code>func LoginHandler(w http.ResponseWriter, r *http.Request) {\n....\n\nPageVars := Login{\n    Username: username,\n}\nhttp.Redirect(w,r,\"/home\",302) \nt, err := template.ParseFiles(\"static/home.html\")\nif err != nil {  \n    log.Printf(\"template parsing error: \", err)\n}\n\nerr = t.Execute(w, PageVars)\n\nif err != nil { \n    log.Printf(\"template executing error: \", err)\n}\n\n\n}\n</code></pre>\n\n<p>my html page is as follows:</p>\n\n<pre><code>&lt;!DOCTYPE html&gt; \n&lt;html&gt;\n&lt;body&gt;\n    &lt;div id=\"mainContainer\" class=\"alignCenter\"&gt;\n            &lt;header class = \"nav\"&gt;\n                &lt;div class = \"nav-links\"&gt;\n                    &lt;span class=\"headerTitle\" id=\"headerTitle\"&gt;{{.Username}}&lt;/span&gt;\n                    &lt;form action=\"http://localhost:8080/api/logout\" method=\"POST\"&gt;\n                         &lt;span id=\"logout\" onclick=\"document.forms[0].submit()\"&gt;Logout&lt;/span&gt;\n                    &lt;/form&gt;\n                &lt;/div&gt;\n            &lt;/header&gt;\n\n    &lt;/div&gt;\n&lt;/body&gt;\n</code></pre>\n\n<p></p>\n\n<p>After logging-in, the page displays <code>{{.Username}}</code> in the header and not the logged-in username from server-side.</p>\n\n<p>If I place the <code>http.Redirect(w,r,\"/home\",302)</code> after template execution, the username loads but the url directs to the api call, like this <code>http://localhost:8080/api/login</code> instead of <code>http://localhost:8080/home</code>.  I've been coding go only since two days now. What am I doing the wrong way here, please help.</p>\n"}, {"tags": ["go", "multipart"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1559631504, "post_id": 56436254, "comment_id": 99471181, "body": "<a href=\"https://golang.org/ref/spec#Interface_types\" rel=\"nofollow noreferrer\">golang.org/ref/spec#Interface_types</a> <i>An interface T may use a (possibly qualified) interface type name E in place of a method specification. This is called embedding interface E in T; it adds all (exported and non-exported) methods of E to the interface T.</i> That is, you do not access the reader because there is no io.Reader in multipart.File, instead <a href=\"https://golang.org/pkg/mime/multipart/#File\" rel=\"nofollow noreferrer\"><code>multipart.File</code></a> has all of the methods that the 4 embedded interfaces have and you can access those methods directly."}], "answers": [{"tags": [], "owner": {"reputation": 5916, "user_id": 3068258, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d7ecfa82e529a576cbc6ef661b9c9815?s=128&d=identicon&r=PG", "display_name": "Andy Schweig", "link": "https://stackoverflow.com/users/3068258/andy-schweig"}, "is_accepted": true, "score": 2, "last_activity_date": 1559619162, "creation_date": 1559619162, "answer_id": 56437001, "question_id": 56436254, "link": "https://stackoverflow.com/questions/56436254/how-to-convert-multipart-file-to-io-reader/56437001#56437001", "title": "How to convert multipart.File to io.Reader", "body": "<p>That means that the <code>multipart.File</code> interface includes the <code>io.Reader</code> interface, so any object that is a valid <code>multipart.File</code> is also a valid <code>io.Reader</code>. Therefore, you can call the <code>Read</code> method (as defined by <code>io.Reader</code>) on an object of type <code>multipart.File</code>.</p>\n"}], "owner": {"reputation": 4915, "user_id": 4564432, "user_type": "registered", "accept_rate": 71, "profile_image": "https://graph.facebook.com/1012918142059352/picture?type=large", "display_name": "Carl", "link": "https://stackoverflow.com/users/4564432/carl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 921, "favorite_count": 0, "accepted_answer_id": 56437001, "answer_count": 1, "score": 0, "last_activity_date": 1559619162, "creation_date": 1559611163, "question_id": 56436254, "link": "https://stackoverflow.com/questions/56436254/how-to-convert-multipart-file-to-io-reader", "title": "How to convert multipart.File to io.Reader", "body": "<p>Maybe I'm just not understanding how to use the <code>Read</code> method for the <code>File</code> object, but I see in docs that <code>io.Reader</code> is within the <code>multipart.File</code> interface, but I don't understand how to access it. Any guidance would be greatly appreciated.</p>\n"}, {"tags": ["oracle", "go", "oracle-call-interface"], "comments": [{"owner": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1559609986, "post_id": 56436128, "comment_id": 99466369, "body": "If you have a Data Access Layer, you can possibly  write it in such a way that its calls are &quot;do nothing.&quot;  But the right way to do this is to make your application smart enough to not &quot;panic&quot; when the Oracle database drivers are not present, and the easiest way to do <i>that</i> might be conditional builds."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "reply_to_user": {"reputation": 168120, "user_id": 102937, "user_type": "registered", "accept_rate": 90, "profile_image": "https://www.gravatar.com/avatar/1233ec65168f4aae4d939ae8fe6cde1e?s=128&d=identicon&r=PG", "display_name": "Robert Harvey", "link": "https://stackoverflow.com/users/102937/robert-harvey"}, "edited": false, "score": 0, "creation_date": 1559614820, "post_id": 56436128, "comment_id": 99467160, "body": "Thanks.  BTW I just worked out that if I copy all these DLLs in to the same location it runs OK: <code>oci.dll ocijdbc12.dll ociw32.dll Oracle.DataAccess.dll oramysql12.dll orannzsbb12.dll oraocci12.dll oraocci12d.dll oraociei12.dll oraons.dll OraOps12.dll orasql12.dll </code>"}], "answers": [{"tags": [], "owner": {"reputation": 148, "user_id": 8871465, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-ZyGOCWSOy8M/AAAAAAAAAAI/AAAAAAAAAOA/sgTy0t0uq_A/photo.jpg?sz=128", "display_name": "Beckett O&#39;Brien", "link": "https://stackoverflow.com/users/8871465/beckett-obrien"}, "is_accepted": false, "score": 0, "last_activity_date": 1559615655, "creation_date": 1559615655, "answer_id": 56436678, "question_id": 56436128, "link": "https://stackoverflow.com/questions/56436128/avoiding-go-panic-when-oracle-database-client-libraries-not-found/56436678#56436678", "title": "Avoiding Go panic when Oracle Database client libraries not found", "body": "<p>As you said, adding the DLLs to the same directory as the exe solves your problem, so if you wanted a single file to still work you can have the exe copy all of the DLLs over when it starts, and even delete then when it is done if you want. This way, you can transfer the file to multiple locations, but there is most likely no way to keep it one file while running.</p>\n"}, {"tags": [], "owner": {"reputation": 6003, "user_id": 4799035, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/tuyZM.jpg?s=128&g=1", "display_name": "Christopher Jones", "link": "https://stackoverflow.com/users/4799035/christopher-jones"}, "is_accepted": true, "score": 2, "last_activity_date": 1559786020, "last_edit_date": 1559786020, "creation_date": 1559775720, "answer_id": 56469093, "question_id": 56436128, "link": "https://stackoverflow.com/questions/56436128/avoiding-go-panic-when-oracle-database-client-libraries-not-found/56469093#56469093", "title": "Avoiding Go panic when Oracle Database client libraries not found", "body": "<p>Swap to the Go <a href=\"https://gopkg.in/goracle.v2\" rel=\"nofollow noreferrer\">goracle driver</a> which <a href=\"https://github.com/go-goracle/goracle/issues/132\" rel=\"nofollow noreferrer\">delays Oracle client library initialization</a> until connections are opened precisely to handle your situation, where not all app users connect to Oracle DB.</p>\n"}], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 273, "favorite_count": 0, "accepted_answer_id": 56469093, "answer_count": 2, "score": 1, "last_activity_date": 1562492154, "creation_date": 1559609681, "last_edit_date": 1562492154, "question_id": 56436128, "link": "https://stackoverflow.com/questions/56436128/avoiding-go-panic-when-oracle-database-client-libraries-not-found", "title": "Avoiding Go panic when Oracle Database client libraries not found", "body": "<p>I have a server written in Go that accesses an Oracle database. It works fine. However, there will be multiple instances running at different (currently 2) locations some of which do not need to access the database.  (They get the same info passed on to them from their peer servers.)</p>\n\n<p>I want the same executable running in all places but some will be configured to not use the database since they don't need it.  The problem is that once I import the OCI package, its init() function is called which panics when it can't talk to the database.</p>\n\n<p>Running GO 1.12.5 on Windows Server 2019.</p>\n\n<p>I tried adding OCI.DLL to the same directory as the .EXE but it still panics.</p>\n\n<pre><code>import _ \"github.com/mattn/go-oci8\"\n</code></pre>\n\n<p>When I run on the server (without DB drivers) I get the error:</p>\n\n<pre><code>panic: OCIEnvCreate error\n\ngoroutine 1 [running]:\ngithub.com/mattn/go-oci8.init.0()\n        D:/Golang/src/github.com/mattn/go-oci8/globals.go:160 +0x130\n</code></pre>\n\n<p>I want to avoid this panic when I don't need database access. I would prefer one .EXE without the mess of conditional builds.</p>\n"}, {"tags": ["go", "mapping"], "comments": [{"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "reply_to_user": {"reputation": 143292, "user_id": 142162, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/F5xn2.png?s=128&g=1", "display_name": "Tim Cooper", "link": "https://stackoverflow.com/users/142162/tim-cooper"}, "edited": false, "score": 1, "creation_date": 1559674811, "post_id": 56436067, "comment_id": 99492966, "body": "@TimCooper, I think the question is actually distinct from <a href=\"https://stackoverflow.com/questions/42716852\">that one</a>\u2014as it&#39;s about &quot;the why&quot;, not &quot;the how&quot;."}], "answers": [{"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 1, "last_activity_date": 1559675841, "creation_date": 1559675841, "answer_id": 56450048, "question_id": 56436067, "link": "https://stackoverflow.com/questions/56436067/convention-for-modifying-maps-in-go/56450048#56450048", "title": "Convention for modifying maps in go", "body": "<p>You may be (inadvertently) conflating the matters here.</p>\n\n<p>The reason to store pointers in a map is not to make \"dot-field\" modifications work\u2014it is rather to preserve the exact placements of the values \"kept\" by a map.</p>\n\n<p>One of the crucial properties of Go maps is that the values bound to their keys are not addressable. In other words, you cannot legally do something like</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>m := {\"foo\": 42}\np := &amp;m[\"foo\"] // this won't compile\n</code></pre>\n\n<p>The reason is that particular implementations of the Go language\u00b9 are free to implement maps in a way which allow them to move around the values they hold. This is needed because maps are typically implemented as balanced trees, and these trees may require rebalancing after removing and/or adding new entries.\nHence if <a href=\"https://golang.org/ref/spec\" rel=\"nofollow noreferrer\">the language specification</a> were to allow taking an address of a value kept in a map, that would forbid the map to move its values around.</p>\n\n<p>This is precisely the reason why you cannot do \"in place\" modification of map values if they have <code>struct</code> types, and you have to replace them \"wholesale\".</p>\n\n<p>By extension, when you add an element to a map, the value is <em>copied</em> into a map, and it is also copied (moved) when the map shuffles its entries around.</p>\n\n<p>Hence, the chief reason to store pointers into a map is to preserve \"identities\" of the values to be \"indexed\" by a map\u2014having them exist in only a single place in memory\u2014and/or to prevent excessive memory operations.\nSome types cannot even be sensibly copied without introducing a bug\u2014<code>sync.Mutex</code> or a <code>struct</code> type containing one is a good example.</p>\n\n<p>Getting back to your question, using pointers with the map for the purpose you propose might be a nice hack, but be aware that this is a code smell: when deciding on values vs pointers regarding a map, you should be rather concerned with the considerations outlined above.</p>\n\n<hr>\n\n<p>\u00b9 There are at least two of them which are actively maintained: the \"stock\" one, dubbed \"gc\", and a part of GCC.</p>\n"}], "owner": {"reputation": 1035, "user_id": 8685016, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-W693VKuEKv0/AAAAAAAAAAI/AAAAAAAAABM/v4pY2Z8NYB4/photo.jpg?sz=128", "display_name": "robbieperry22", "link": "https://stackoverflow.com/users/8685016/robbieperry22"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 69, "favorite_count": 0, "accepted_answer_id": 56450048, "answer_count": 1, "score": -2, "last_activity_date": 1559675841, "creation_date": 1559608988, "question_id": 56436067, "link": "https://stackoverflow.com/questions/56436067/convention-for-modifying-maps-in-go", "title": "Convention for modifying maps in go", "body": "<p>In go, is it more of a convention to modify maps by reassigning values, or using pointer values?</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>type Foo struct {\n    Bar int\n}\n</code></pre>\n\n<p>Reassignment:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>foos := map[string]Foo{\"a\": Foo{1}}\nv := foos[\"a\"]\nv.Bar = 2\nfoos[\"a\"] = v\n</code></pre>\n\n<p>vs Pointers</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>foos := map[string]*Foo{\"a\": &amp;Foo{1}}\nfoos[\"a\"].Bar = 2\n</code></pre>\n"}, {"tags": ["json", "go"], "answers": [{"comments": [{"owner": {"reputation": 35, "user_id": 11397643, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeed321d7a2953beb8f392b500a3747?s=128&d=identicon&r=PG&f=1", "display_name": "Narsarius", "link": "https://stackoverflow.com/users/11397643/narsarius"}, "edited": false, "score": 0, "creation_date": 1559599968, "post_id": 56434824, "comment_id": 99464515, "body": "Works perfect and explained well"}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559623740, "post_id": 56434824, "comment_id": 99468726, "body": "I removed the type conversion to string. Since the underlying type of RawMessage is []byte it can (and should) be converted directly."}], "tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 3, "last_activity_date": 1559623646, "last_edit_date": 1559623646, "creation_date": 1559597782, "answer_id": 56434824, "question_id": 56434674, "link": "https://stackoverflow.com/questions/56434674/convert-struct-to-json-rawmessage/56434824#56434824", "title": "Convert struct to []json.RawMessage", "body": "<p>There are a few things here:</p>\n\n<ol>\n<li>You need to create a new slice of <code>json.RawMessage</code> in order to pass that expected type into your function <code>myFunction</code> as an argument</li>\n<li>Store the result of marshaling your custom struct <code>myJsonStruct</code> in a variable <code>myIn</code> (type <code>[]byte</code>)</li>\n<li>Create a new variable of <code>myInRaw</code> (type <code>json.RawMessage</code>) and append that to the previously created slice of <code>json.RawMessage</code>.</li>\n</ol>\n\n<p>The above steps will then allow you to pass in the slice of <code>json.RawMessage</code> to your function for further work to be done.</p>\n\n<p>See example below or working example in the <a href=\"https://goplay.space/#60VFEe55p1t\" rel=\"nofollow noreferrer\">playground</a>:</p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n)\n\ntype myJsonStruct struct {\n    myString       string `json:\"myString\"`\n    mySecongString string `json:\"mySecondString\"`\n}\n\nfunc myFunction(receivedIn []json.RawMessage) {\n    //do work\n    return\n}\n\nfunc main() {\n\n    var rawJSONSlice []json.RawMessage\n\n    myIn, err := json.Marshal(\n        &amp;myJsonStruct{\n            myString:       \"string1\",\n            mySecongString: \"string2\",\n        },\n    )\n    if err != nil {\n        // catch err\n    }\n\n    myInRaw := json.RawMessage(myIn)\n\n    rawJSONSlice = append(rawJSONSlice, myInRaw)\n\n    myFunction(rawJSONSlice)\n}\n</code></pre>\n"}], "owner": {"reputation": 35, "user_id": 11397643, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ffeed321d7a2953beb8f392b500a3747?s=128&d=identicon&r=PG&f=1", "display_name": "Narsarius", "link": "https://stackoverflow.com/users/11397643/narsarius"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2178, "favorite_count": 0, "accepted_answer_id": 56434824, "answer_count": 1, "score": 0, "last_activity_date": 1559623646, "creation_date": 1559596792, "question_id": 56434674, "link": "https://stackoverflow.com/questions/56434674/convert-struct-to-json-rawmessage", "title": "Convert struct to []json.RawMessage", "body": "<p>Trying to convert a struct to []json.RawMessage. My understanding is that json.Marshal() converts it to byte[] as is []json.RawMessage. I cannot however seem to convert between the two. My function expects to receive input as <code>[]json.RawMessage</code>.</p>\n\n<p>Have tried several different methods including <code>myIn := json.RawMessage(&amp;myJsonStruct{\"string1\", \"string2\"})</code> and <code>myIn := (*json.RawMessage)(json.Marshal(&amp;myJsonStruct{\"string1\", \"string2\"}))</code></p>\n\n<pre><code>type myJsonStruct struct {\n    myString       string  `json:\"myString\"`\n    mySecongString string  `json:\"mySecondString\"`\n}\n\nmyIn := json.Marshal(&amp;myJsonStruct{\"string1\", \"string2\"})\n\nmyFunction(myIn)\n\nmyFunction(receivedIn []json.RawMessage) {\n    //do work\n    return\n}\n</code></pre>\n"}, {"tags": ["go", "tls1.2", "mutual-authentication"], "answers": [{"comments": [{"owner": {"reputation": 33, "user_id": 10852354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TfYe8.jpg?s=128&g=1", "display_name": "Ash", "link": "https://stackoverflow.com/users/10852354/ash"}, "edited": false, "score": 0, "creation_date": 1559599543, "post_id": 56434711, "comment_id": 99464404, "body": "Thanks @paul-griffiths, it worked. Unfortunately I can&#39;t change the status for your answer because of my low stackoverflow reputation points."}, {"owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "reply_to_user": {"reputation": 33, "user_id": 10852354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TfYe8.jpg?s=128&g=1", "display_name": "Ash", "link": "https://stackoverflow.com/users/10852354/ash"}, "edited": false, "score": 1, "creation_date": 1559599760, "post_id": 56434711, "comment_id": 99464456, "body": "@Ash: Glad to hear it. If the answer helped you, you can accept it by clicking the checkmark regardless of your reputation."}], "tags": [], "owner": {"reputation": 22751, "user_id": 2399879, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/UxMS5.jpg?s=128&g=1", "display_name": "Crowman", "link": "https://stackoverflow.com/users/2399879/crowman"}, "is_accepted": true, "score": 3, "last_activity_date": 1559596996, "creation_date": 1559596996, "answer_id": 56434711, "question_id": 56434602, "link": "https://stackoverflow.com/questions/56434602/extract-common-name-from-incoming-https-request-in-golang/56434711#56434711", "title": "Extract Common Name from incoming https request in golang", "body": "<p>You can retrieve it from the <code>VerifiedChains</code> member of the request's <code>TLS</code> field:</p>\n\n<pre><code>func helloHandler(w http.ResponseWriter, r *http.Request) {\n    if r.TLS != nil &amp;&amp; len(r.TLS.VerifiedChains) &gt; 0 &amp;&amp; len(r.TLS.VerifiedChains[0]) &gt; 0 {\n        var commonName = r.TLS.VerifiedChains[0][0].Subject.CommonName\n\n        // Do what you want with the common name.\n        io.WriteString(w, fmt.Sprintf(\"Hello, %s!\\n\", commonName))\n    }\n\n    // Write \"Hello, world!\" to the response body\n    io.WriteString(w, \"Hello, world!\\n\")\n}\n</code></pre>\n\n<p>The leaf certificate is always the first one in the chain.</p>\n"}], "owner": {"reputation": 33, "user_id": 10852354, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TfYe8.jpg?s=128&g=1", "display_name": "Ash", "link": "https://stackoverflow.com/users/10852354/ash"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 715, "favorite_count": 0, "accepted_answer_id": 56434711, "answer_count": 1, "score": 1, "last_activity_date": 1559596996, "creation_date": 1559596392, "question_id": 56434602, "link": "https://stackoverflow.com/questions/56434602/extract-common-name-from-incoming-https-request-in-golang", "title": "Extract Common Name from incoming https request in golang", "body": "<p>My api is behind a gateway and the gateway terminates the ssl handshake from client and initiate a separate handshake with my api. No client should call my api directly. My requirement is that I have to extract the Common Name from incoming https request and validate it against a list.</p>\n\n<p>I am new to go and used this example <code>https://venilnoronha.io/a-step-by-step-guide-to-mtls-in-go</code> as my starting point to build a go server using https.</p>\n\n<p>But not sure how can I move further to to extract <code>COMMON NAME from the leaf certificate</code> of the certificate chain.</p>\n\n<pre><code>package main\n\nimport (\n    \"crypto/tls\"\n    \"crypto/x509\"\n    \"io\"\n    \"io/ioutil\"\n    \"log\"\n    \"net/http\"\n)\n\nfunc helloHandler(w http.ResponseWriter, r *http.Request) {\n    // Write \"Hello, world!\" to the response body\n    io.WriteString(w, \"Hello, world!\\n\")\n}\n\nfunc main() {\n    // Set up a /hello resource handler\n    http.HandleFunc(\"/hello\", helloHandler)\n\n    // Create a CA certificate pool and add cert.pem to it\n    caCert, err := ioutil.ReadFile(\"cert.pem\")\n    if err != nil {\n        log.Fatal(err)\n    }\n    caCertPool := x509.NewCertPool()\n    caCertPool.AppendCertsFromPEM(caCert)\n\n    // Create the TLS Config with the CA pool and enable Client certificate validation\n    tlsConfig := &amp;tls.Config{\n        ClientCAs:  caCertPool,\n        ClientAuth: tls.RequireAndVerifyClientCert,\n    }\n    tlsConfig.BuildNameToCertificate()\n\n    // Create a Server instance to listen on port 8443 with the TLS config\n    server := &amp;http.Server{\n        Addr:      \":8443\",\n        TLSConfig: tlsConfig,\n    }\n\n    // Listen to HTTPS connections with the server certificate and wait\n    log.Fatal(server.ListenAndServeTLS(\"cert.pem\", \"key.pem\"))\n\n}\n</code></pre>\n\n<p>I should be able to <code>print the Common Name of the leaf certificate</code> coming in the certificate chain.</p>\n"}, {"tags": ["string", "go"], "answers": [{"tags": [], "owner": {"reputation": 1025, "user_id": 7253829, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Qe9lZ.jpg?s=128&g=1", "display_name": "waymobetta", "link": "https://stackoverflow.com/users/7253829/waymobetta"}, "is_accepted": true, "score": 1, "last_activity_date": 1559596216, "last_edit_date": 1559596216, "creation_date": 1559595826, "answer_id": 56434506, "question_id": 56434432, "link": "https://stackoverflow.com/questions/56434432/golang-convert-os-modeperm-into-string/56434506#56434506", "title": "golang convert os.ModePerm into string", "body": "<p>You can pass either one of your variables, type (<code>os.FileMode</code>), as an argument to the <code>Sprintf</code> method from the <a href=\"https://golang.org/pkg/fmt/#Sprintf\" rel=\"nofollow noreferrer\">fmt</a> package. </p>\n\n<p>Leveraging this method will convert your type into a string, which can then be used as a string throughout the remainder of your program. </p>\n\n<p>Example usage below:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n)\n\nfunc main() {\n    fileInfo, err := os.Lstat(path)\n    if err != nil {\n        // catch err\n    }\n    fileMode := fileInfo.Mode()\n    // fileMode.String() gives dturwxrwxrwx or -rwxrwxrwx\n    // which i do not want because the size is not always the same\n    unixPerms := fileMode &amp; os.ModePerm\n\n    permString := fmt.Sprintf(\"%v\", unixPerms)\n    fmt.Println(permString)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 768, "user_id": 1038386, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOhSk.jpg?s=128&g=1", "display_name": "Meehow", "link": "https://stackoverflow.com/users/1038386/meehow"}, "is_accepted": false, "score": 2, "last_activity_date": 1559601943, "creation_date": 1559601943, "answer_id": 56435397, "question_id": 56434432, "link": "https://stackoverflow.com/questions/56434432/golang-convert-os-modeperm-into-string/56435397#56435397", "title": "golang convert os.ModePerm into string", "body": "<p>fileInfo.Mode().Perm().String()</p>\n\n<p><a href=\"https://golang.org/pkg/os/#FileMode.Perm\" rel=\"nofollow noreferrer\">https://golang.org/pkg/os/#FileMode.Perm</a></p>\n"}], "owner": {"reputation": 2201, "user_id": 677163, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/a1d8465997bf40a21eca3975f984fc72?s=128&d=identicon&r=PG", "display_name": "philippe", "link": "https://stackoverflow.com/users/677163/philippe"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 960, "favorite_count": 1, "accepted_answer_id": 56434506, "answer_count": 2, "score": 0, "last_activity_date": 1559601943, "creation_date": 1559595326, "question_id": 56434432, "link": "https://stackoverflow.com/questions/56434432/golang-convert-os-modeperm-into-string", "title": "golang convert os.ModePerm into string", "body": "<p>I would like to have as a <code>string</code> the permissions representation of a file.\nHere is what I want to do :</p>\n\n<pre><code>fileInfo, err := os.Lstat(path)\nfileMode := fileInfo.Mode()\n// fileMode.String() gives dturwxrwxrwx or -rwxrwxrwx\n// which i do not want because the size is not always the same\nunixPerms := fileMode &amp; os.ModePerm\n</code></pre>\n\n<p>I get <code>-rwxrwxrwx</code> for both cases, which is close to what i am looking for.</p>\n\n<p>However, the returned object is of type <code>os.FileMode</code>. How can I then convert it into a <code>string</code>?</p>\n"}, {"tags": ["go", "interface", "append", "slice"], "answers": [{"tags": [], "owner": {"reputation": 1050, "user_id": 6655315, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/d8b47748610927bb2cff430afcbb048d?s=128&d=identicon&r=PG&f=1", "display_name": "teyzer", "link": "https://stackoverflow.com/users/6655315/teyzer"}, "is_accepted": true, "score": 0, "last_activity_date": 1559595209, "last_edit_date": 1559595209, "creation_date": 1559594774, "answer_id": 56434347, "question_id": 56434319, "link": "https://stackoverflow.com/questions/56434319/append-to-the-slice-of-base-interface-slice-of-the-implementations/56434347#56434347", "title": "Append to the slice of base interface slice of the implementations", "body": "<p>The slice type must match the type of the variadic arguments in the <code>append</code> function exactly. <code>locations</code> is of type <code>[]*LocationEvent</code>, and thus not compatible with <code>[]Event</code>. There is no automatic \"downcasting\" in Go when working with slices.</p>\n\n<p>You have to copy the locations to a new slice of <code>Event</code>, or add the items of <code>locations</code> one-by-one to the <code>data</code> slice.</p>\n\n<p>For more explanation look here: <a href=\"https://stackoverflow.com/a/12754757/6655315\">https://stackoverflow.com/a/12754757/6655315</a></p>\n"}], "owner": {"reputation": 2901, "user_id": 729784, "user_type": "registered", "accept_rate": 65, "profile_image": "https://www.gravatar.com/avatar/d76fae8519fd3b58c86d830b90301599?s=128&d=identicon&r=PG", "display_name": "Aliaksandr Kazlou", "link": "https://stackoverflow.com/users/729784/aliaksandr-kazlou"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 29, "favorite_count": 0, "accepted_answer_id": 56434347, "answer_count": 1, "score": -1, "last_activity_date": 1559595209, "creation_date": 1559594561, "question_id": 56434319, "link": "https://stackoverflow.com/questions/56434319/append-to-the-slice-of-base-interface-slice-of-the-implementations", "title": "Append to the slice of base interface slice of the implementations", "body": "<p>Why the below doesn't work?</p>\n\n<pre><code>locations := make([]*LocationEvent, 0)\ndata := make([]Event, 0)\ndata = append(data, locations...)\n</code></pre>\n\n<p>where <code>*LocationEvent</code> (struct) implements <code>Event</code> (interface).</p>\n\n<p>While the below works fine:</p>\n\n<pre><code>data = append(data, &amp;LocationEvent{}, &amp;LocationEvent{})\n</code></pre>\n\n<p>So how it is different when expanding the actual <code>[]*LocationEvent</code> slice using <code>...</code>?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559652890, "post_id": 56434273, "comment_id": 99482163, "body": "Just don&#39;t hard-code paths in your application. Take paths, along with other configuration, by CLI parameter, environment variable, or config file."}, {"owner": {"reputation": 1569, "user_id": 8784015, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2733173f5b643bbf93278b76f39747f5?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/8784015/james"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559726992, "post_id": 56434273, "comment_id": 99507413, "body": "I&#39;m not hard coding the paths. Can you provide examples of the CLI parameters etc.? Thanks"}], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 2, "last_activity_date": 1559601903, "creation_date": 1559601903, "answer_id": 56435390, "question_id": 56434273, "link": "https://stackoverflow.com/questions/56434273/find-location-of-golang-application/56435390#56435390", "title": "Find location of Golang application", "body": "<p>Use <a href=\"https://godoc.org/os#Executable\" rel=\"nofollow noreferrer\">os.Executable</a> to find the path to the executable.</p>\n\n<pre><code>b, err := os.Executable()\nif err != nil {\n    log.Fatal(err)\n}\nbasepath := filepath.Dir(b)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 768, "user_id": 1038386, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/SOhSk.jpg?s=128&g=1", "display_name": "Meehow", "link": "https://stackoverflow.com/users/1038386/meehow"}, "is_accepted": false, "score": 0, "last_activity_date": 1559602232, "creation_date": 1559602232, "answer_id": 56435432, "question_id": 56434273, "link": "https://stackoverflow.com/questions/56434273/find-location-of-golang-application/56435432#56435432", "title": "Find location of Golang application", "body": "<p>Can't you just <code>cd</code> before executing the application? Then you can use relative paths.</p>\n"}], "owner": {"reputation": 1569, "user_id": 8784015, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/2733173f5b643bbf93278b76f39747f5?s=128&d=identicon&r=PG&f=1", "display_name": "James", "link": "https://stackoverflow.com/users/8784015/james"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 200, "favorite_count": 0, "answer_count": 2, "score": 0, "last_activity_date": 1559602232, "creation_date": 1559594340, "question_id": 56434273, "link": "https://stackoverflow.com/questions/56434273/find-location-of-golang-application", "title": "Find location of Golang application", "body": "<p>I have a Golang application which is being deployed into a container via Kubernetes. Within the service I would like to read a file which is nested within the application. </p>\n\n<p>I'm struggling to find out how to set the current working directory to the location of the application. </p>\n\n<p>Currently the application panics with an error due to the relative paths not being aligned:</p>\n\n<pre><code>open /workspace/source/package/file.csv: no such file or directory\n</code></pre>\n\n<p>I've tried using the following code and appending the file name:</p>\n\n<pre><code>var (\n_, b, _, _ = runtime.Caller(0)\nbasepath   = filepath.Dir(b)\n)\n</code></pre>\n\n<p>However this still doesn't work. Is there a way to find the applications current location and then append the filename?</p>\n\n<p>Thanks for help!</p>\n"}, {"tags": ["go", "hex", "bit-manipulation"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 2, "creation_date": 1559591349, "post_id": 56433477, "comment_id": 99461667, "body": "What does it mean to &quot;bit shift&quot; a hex value? That is just a base 16 textual representation of a number. You can of course hex encode the final value. <a href=\"https://play.golang.org/p/O-nrvJl4J2j\" rel=\"nofollow noreferrer\">play.golang.org/p/O-nrvJl4J2j</a>"}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559591896, "post_id": 56433477, "comment_id": 99461883, "body": "<code>hex.Encode</code> turns bytes into the hex string representing those bytes, which sounds like the opposite of what you&#39;re trying to do; you can&#39;t bit shift a string. There is no &quot;type <code>hex</code>&quot; in Go. Hex is just a way of representing bytes as alphanumeric characters."}, {"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559592057, "post_id": 56433477, "comment_id": 99461946, "body": "Based on the description, it <i>seems like</i> what you want to do is turn your hex string into bytes (using <code>hex.Decode</code>), turn the bytes into an <code>int64</code> (using <code>encoding&#47;binary</code>), and then do your math (the bit shift and addition)."}], "answers": [{"comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559624284, "post_id": 56437407, "comment_id": 99468861, "body": "According to the question 1008000400 is a decimal number, not hexadecimal. Also, <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#indent-error-flow\" rel=\"nofollow noreferrer\">indent error handling</a>, not the &quot;normal&quot; flow."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559632249, "post_id": 56437407, "comment_id": 99471522, "body": "Thanks @Peter you are probably right. I thought that it was very likely that it was hex myself judging by the fact that the question is about bit fiddling and the number has just 3 bits set if it&#39;s hex but has 14 bits set if it&#39;s decimal. His expression implies that it is decimal but he does <i>not</i> state that. My gut instinct is that he made a mistake and it&#39;s hex. However, I added a sentence of explanation in case I was wrong."}, {"owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559632502, "post_id": 56437407, "comment_id": 99471631, "body": "Thanks @Peter for the info about the indenting of error-handling code. I actually do that.  Sorry the above code was just an example not a complete well-designed sample.  I even considered not adding the error-handling for simplicity but though it better to add just as a reminder not to skip it."}], "tags": [], "owner": {"reputation": 1128, "user_id": 11246894, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f55f8e8c47996c0510c64dbacab90104?s=128&d=identicon&r=PG&f=1", "display_name": "AJR", "link": "https://stackoverflow.com/users/11246894/ajr"}, "is_accepted": false, "score": 0, "last_activity_date": 1559632328, "last_edit_date": 1559632328, "creation_date": 1559622915, "answer_id": 56437407, "question_id": 56433477, "link": "https://stackoverflow.com/questions/56433477/how-to-bit-shift-hex-value-using-golang/56437407#56437407", "title": "How to bit shift hex value using Golang?", "body": "<p>Assuming your input string varies but has a maximum of 16 hex digits, you just convert to a 64 bit (unsigned) integer and do the math. I also prefixed your constant with <em>0x</em> assuming it is hex (judging by the digits).</p>\n\n<pre><code>  s := \"4ADDF6C259EBAFF8\"\n  if i, err := strconv.ParseUint(s, 16, 64); err == nil {\n    fmt.Printf(\"%x\\n\", i &gt;&gt; 25 + 0x1008000400)\n  }\n</code></pre>\n\n<p>BTW <em>hex</em> is not a type but a way of displaying integers.</p>\n"}], "owner": {"reputation": 2181, "user_id": 7058735, "user_type": "registered", "accept_rate": 77, "profile_image": "https://i.stack.imgur.com/GxhO2.png?s=128&g=1", "display_name": "K Split X", "link": "https://stackoverflow.com/users/7058735/k-split-x"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 315, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559632328, "creation_date": 1559590232, "question_id": 56433477, "link": "https://stackoverflow.com/questions/56433477/how-to-bit-shift-hex-value-using-golang", "title": "How to bit shift hex value using Golang?", "body": "<p>Let's say I have a string with the value of <code>4ADDF6C259EBAFF8</code>.</p>\n\n<p>Using this I want to get a timestamp, using the formula <code>(hex(val) &gt;&gt; 25) + 1008000400</code>.</p>\n\n<p>Using t he <code>encoding/hex</code> package, I have come up with the following:</p>\n\n<pre><code>srcBytes := []byte(src)\ndst := make([]byte, hex.EncodedLen(len(srcBytes)))\nhex.Encode(dst, srcBytes)\n</code></pre>\n\n<p>After this, I need a way to bit shift <code>dst</code> 25 times, and then add a constant to it.</p>\n\n<p>However <code>dst</code> is of type <code>[]byte</code>. </p>\n\n<p>I need it to be of type <code>hex</code> so I can bit shift after. How do I convert <code>[]byte</code> so that it can be shifted?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1559704219, "post_id": 56449620, "comment_id": 99500263, "body": "Thanks a lot for the reply. I checked <code>go help get</code>, it states that <code>The -u flag instructs get to use the network to update the named packages and their dependencies.</code>. This should be the same as what it does for module-get -u. No? Btw, I know module-get will update go.mod. But the current behavior is <code>go get -u</code> can be completed really fast outside module directory and will take an infinite long time inside the module."}, {"owner": {"reputation": 36797, "user_id": 59058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d83a054d0634446a11857a59ac6ba67?s=128&d=identicon&r=PG", "display_name": "Yoni Samlan", "link": "https://stackoverflow.com/users/59058/yoni-samlan"}, "reply_to_user": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1559838416, "post_id": 56449620, "comment_id": 99553605, "body": "that&#39;s because <code>go get</code> in a module context operates completely differently than <code>go get</code> in a module context. <code>-u</code> without a version number on it in a module context will also update all that module&#39;s dependency&#39;s versions, which is not what it does in a non-module &quot;classic&quot; global context."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1559847642, "post_id": 56449620, "comment_id": 99557415, "body": "Thanks a lot for your reply. But I am very sorry that I don&#39;t understand what you mean. Let&#39;s say <code>go get -u foo</code>. from <code>go help get</code>, it will update (1) the package foo and (2) all foo&#39;s dependencies to the latest in global context. Then what do you mean that is different from module context? I knew it did something different. But I don&#39;t understand what the difference is from your explanation.You are always saying the foo package and foo&#39;s dependencies. That&#39;s right and that is what it dose in global context too. Unless <code>go help get</code> is wrong."}, {"owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "edited": false, "score": 0, "creation_date": 1559847772, "post_id": 56449620, "comment_id": 99557460, "body": "Are you saying that <code>go get -u foo</code> in global context will only update foo&#39;s package? and <code>go get -u foo</code> in module context will update foo&#39;s package and foo&#39;s dependencies? Is this what you mean? I am confused what you mean."}], "tags": [], "owner": {"reputation": 36797, "user_id": 59058, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d83a054d0634446a11857a59ac6ba67?s=128&d=identicon&r=PG", "display_name": "Yoni Samlan", "link": "https://stackoverflow.com/users/59058/yoni-samlan"}, "is_accepted": false, "score": 0, "last_activity_date": 1559673865, "creation_date": 1559673865, "answer_id": 56449620, "question_id": 56431721, "link": "https://stackoverflow.com/questions/56431721/why-go-get-u-takes-a-very-long-time-inside-a-module-directory-but-complete-qui/56449620#56449620", "title": "Why go get -u takes a very long time inside a module directory, but complete quickly outside in golang?", "body": "<blockquote>\n  <p>Should I run go get -u inside module directory or can I simply run it outside module directory?</p>\n</blockquote>\n\n<p>If you're using modules, you need to run it inside your module directory if you want it to actually update your <code>go.mod</code> / <code>go.sum</code> files.</p>\n\n<blockquote>\n  <p>Why go get -u outside the module directory can complete easily? Dose it do the same download/upgrade compared to running inside the module directory?</p>\n</blockquote>\n\n<p>They're pretty different in behavior. <code>go help get</code>, <code>go help module-get</code> and <code>go help modules</code> should explain some of the differences and in your case check <a href=\"https://github.com/golang/go/wiki/Modules#how-to-upgrade-and-downgrade-dependencies\" rel=\"nofollow noreferrer\">the module doc</a>:</p>\n\n<blockquote>\n  <p>A common mistake is thinking go get -u foo solely gets the latest version of foo. In actuality, the -u in go get -u foo or go get -u foo@latest means to also get the latest versions for all of the direct and indirect dependencies of foo.</p>\n</blockquote>\n\n<p>The go.mod for gorm includes a lot of stuff (<a href=\"https://github.com/jinzhu/gorm/blob/master/go.mod\" rel=\"nofollow noreferrer\">https://github.com/jinzhu/gorm/blob/master/go.mod</a>) including drivers for every possible database it supports, which seems pretty intense. Since you're just doing a blanket <code>-u</code> and not specifying <code>@v1.9.3</code> or whatever, it's trying to update all of Gorm's dependencies (and the dependencies' dependencies!) in module-aware mode.</p>\n"}], "owner": {"reputation": 2895, "user_id": 348719, "user_type": "registered", "accept_rate": 40, "profile_image": "https://www.gravatar.com/avatar/eb180bc6dd7e72a35a27319fcd7e6fda?s=128&d=identicon&r=PG&f=1", "display_name": "sgon00", "link": "https://stackoverflow.com/users/348719/sgon00"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 990, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1580851623, "creation_date": 1559581588, "last_edit_date": 1580851623, "question_id": 56431721, "link": "https://stackoverflow.com/questions/56431721/why-go-get-u-takes-a-very-long-time-inside-a-module-directory-but-complete-qui", "title": "Why go get -u takes a very long time inside a module directory, but complete quickly outside in golang?", "body": "<p>I have a very slow unstable network. </p>\n\n<h2>First Observation Running Locally</h2>\n\n<p>For example, When I run <code>go get -u github.com/jinzhu/gorm</code> in a fresh module directory (which has main.go). It prints out many lines and will never be able to complete successfully in my local environment due to a slow unstable network. </p>\n\n<p>But if I run the same command outside the module directory, it can be completed in a reasonable time without any stdout.</p>\n\n<h2>Second Observation Running Remotely</h2>\n\n<p>I have a remote VPS server which is located in USA. I create the same module directory there and run the same command inside the module on remote: <code>go get -u github.com/jinzhu/gorm</code>, and the <code>go.mod</code> will have the following content:</p>\n\n<pre><code>require (\n    cloud.google.com/go v0.39.0 // indirect\n    github.com/denisenkom/go-mssqldb v0.0.0-20190515213511-eb9f6a1743f3 // indirect\n    github.com/golang/mock v1.3.1 // indirect\n    github.com/google/btree v1.0.0 // indirect\n    github.com/google/pprof v0.0.0-20190515194954-54271f7e092f // indirect\n    github.com/jinzhu/gorm v1.9.8 // indirect\n    github.com/jinzhu/inflection v0.0.0-20190603042836-f5c5f50e6090 // indirect\n    github.com/kr/pty v1.1.4 // indirect\n    github.com/lib/pq v1.1.1 // indirect\n    go.opencensus.io v0.22.0 // indirect\n    golang.org/x/crypto v0.0.0-20190530122614-20be4c3c3ed5 // indirect\n    golang.org/x/exp v0.0.0-20190510132918-efd6b22b2522 // indirect\n    golang.org/x/image v0.0.0-20190523035834-f03afa92d3ff // indirect\n    golang.org/x/lint v0.0.0-20190409202823-959b441ac422 // indirect\n    golang.org/x/mobile v0.0.0-20190509164839-32b2708ab171 // indirect\n    golang.org/x/mod v0.1.0 // indirect\n    golang.org/x/net v0.0.0-20190603091049-60506f45cf65 // indirect\n    golang.org/x/oauth2 v0.0.0-20190523182746-aaccbc9213b0 // indirect\n    golang.org/x/sys v0.0.0-20190602015325-4c4f7f33c9ed // indirect\n    golang.org/x/time v0.0.0-20190308202827-9d24e82272b4 // indirect\n    golang.org/x/tools v0.0.0-20190603152906-08e0b306e832 // indirect\n    google.golang.org/appengine v1.6.0 // indirect\n    google.golang.org/genproto v0.0.0-20190530194941-fb225487d101 // indirect\n    google.golang.org/grpc v1.21.0 // indirect\n    honnef.co/go/tools v0.0.0-20190602125119-5a4a2f4a438d // indirect\n)\n</code></pre>\n\n<p>and then I run <code>go mod tidy</code>, the <code>go.mod</code> becomes:</p>\n\n<pre><code>require (\n    cloud.google.com/go v0.39.0 // indirect\n    github.com/denisenkom/go-mssqldb v0.0.0-20190515213511-eb9f6a1743f3 // indirect\n    github.com/google/go-cmp v0.3.0 // indirect\n    github.com/jinzhu/gorm v1.9.8\n    github.com/jinzhu/inflection v0.0.0-20190603042836-f5c5f50e6090 // indirect\n    github.com/lib/pq v1.1.1 // indirect\n    golang.org/x/crypto v0.0.0-20190530122614-20be4c3c3ed5 // indirect\n    google.golang.org/appengine v1.6.0 // indirect\n)\n</code></pre>\n\n<p>But if I remove the <code>require(...)</code> section completely from <code>go.mod</code> and then execute <code>go mod tidy</code>, I get the following content in <code>go.mod</code>:</p>\n\n<pre><code>require github.com/jinzhu/gorm v1.9.8\n</code></pre>\n\n<p>Just one require. And with this one line, I run <code>go build</code>, the module can be built and ran successfully without any problems. </p>\n\n<p>So I am very confused what <code>go get -u</code> really does in my module directory. </p>\n\n<p>My two questions:</p>\n\n<ul>\n<li><p>Should I run <code>go get -u</code> inside module directory or can I simply run it outside module directory? </p></li>\n<li><p>Why <code>go get -u</code> outside the module directory can complete easily? Dose it do the same download/upgrade compared to running inside the module directory?</p></li>\n</ul>\n\n<p>I am using the latest stable golang go1.12.5. Because <code>go get -u</code> calls <code>git</code> and <code>git</code> calls <code>curl</code>, but <code>curl</code> is very bad on unstable network (compared to <code>wget</code>). I am unable to complete <code>go get -u</code> inside the module directory. I will get many <code>error: RPC failed; The remote end hung up unexpectedly; fatal: early EOF; fatal: index-pack failed;</code>. I don't know if there is a workaround for this problem or not. But I can use <code>go get -u</code> outside the module directory though. </p>\n\n<p>(Incidentally, if <code>go get</code> can use wget, it will work in my local environment. I never have any problems with wget and wget will finally complete the download after waiting for a long time. But unfortunately, wget is not a preferred tool by the current dev world).</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559581922, "post_id": 56431539, "comment_id": 99458105, "body": "Consider <a href=\"https://github.com/golang/go/wiki/Modules#how-do-i-use-vendoring-with-modules-is-vendoring-going-away\" rel=\"nofollow noreferrer\">vendoring your dependencies</a>. See also <a href=\"https://arslan.io/2018/08/26/using-go-modules-with-vendor-support-on-travis-ci/\" rel=\"nofollow noreferrer\">the referenced blog post specifically for Travis</a>"}], "answers": [{"comments": [{"owner": {"reputation": 355, "user_id": 8177720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MaB7WPKxe98/AAAAAAAAAAI/AAAAAAAAAbM/sqkLZT9ecng/photo.jpg?sz=128", "display_name": "Adib Rastegarnia", "link": "https://stackoverflow.com/users/8177720/adib-rastegarnia"}, "edited": false, "score": 0, "creation_date": 1559585092, "post_id": 56431686, "comment_id": 99459394, "body": "Which approach is the correct approach to go for it? Caching or vendoring?"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559634735, "post_id": 56431686, "comment_id": 99472655, "body": "There is no &quot;correct&quot; approach. The two options do different things. Which do you want?"}, {"owner": {"reputation": 355, "user_id": 8177720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MaB7WPKxe98/AAAAAAAAAAI/AAAAAAAAAbM/sqkLZT9ecng/photo.jpg?sz=128", "display_name": "Adib Rastegarnia", "link": "https://stackoverflow.com/users/8177720/adib-rastegarnia"}, "edited": false, "score": 0, "creation_date": 1559686855, "post_id": 56431686, "comment_id": 99497287, "body": "I am trying to avoid vendoring if it is possible and make build faster in Travis."}], "tags": [], "owner": {"reputation": 1968, "user_id": 9263083, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d74d9629591720e7e7bc8ddd3f35c92?s=128&d=identicon&r=PG&f=1", "display_name": "sanoJ", "link": "https://stackoverflow.com/users/9263083/sanoj"}, "is_accepted": true, "score": 2, "last_activity_date": 1559581394, "creation_date": 1559581394, "answer_id": 56431686, "question_id": 56431539, "link": "https://stackoverflow.com/questions/56431539/how-to-make-travis-go-build-faster-when-using-modules/56431686#56431686", "title": "How to make Travis go build faster when using modules", "body": "<p>Yes, you can cache the Go modules to speed up the build process.</p>\n\n<pre><code>- language: go\n\n  script:\n    - your script\n\n  cache:\n    directories:\n      - $HOME/.cache/go-build        # Cache the binaries\n      - $HOME/gopath/pkg/mod         # Cache the Go modules\n</code></pre>\n\n<p>Reference : <a href=\"https://restic.net/blog/2018-09-02/travis-build-cache\" rel=\"nofollow noreferrer\">https://restic.net/blog/2018-09-02/travis-build-cache</a></p>\n"}], "owner": {"reputation": 355, "user_id": 8177720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MaB7WPKxe98/AAAAAAAAAAI/AAAAAAAAAbM/sqkLZT9ecng/photo.jpg?sz=128", "display_name": "Adib Rastegarnia", "link": "https://stackoverflow.com/users/8177720/adib-rastegarnia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 193, "favorite_count": 0, "accepted_answer_id": 56431686, "answer_count": 1, "score": 1, "last_activity_date": 1559634713, "creation_date": 1559580664, "last_edit_date": 1559634713, "question_id": 56431539, "link": "https://stackoverflow.com/questions/56431539/how-to-make-travis-go-build-faster-when-using-modules", "title": "How to make Travis go build faster when using modules", "body": "<p>We use go modules and travis for a project. Every time Travis builds the project,  go modules fetch all of the dependencies which increases the build time. Is there any way to reduce that time or avoid fetching the deps every time?</p>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "edited": false, "score": 0, "creation_date": 1559573630, "post_id": 56429736, "comment_id": 99454101, "body": "Yes, I decided that I will mostly use big.Int and convert into this BigInt type only when strictly necessary, taking advantage of the fact that converting is very straightforward.  I think you answered my previous question on the same subject as well, thanks! After a few months living with an embedded struct solution (which you also recommended back then), I feel that this is simply more elegant."}, {"owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "edited": false, "score": 0, "creation_date": 1559573816, "post_id": 56429736, "comment_id": 99454190, "body": "Actually, I think back then you also recommended that I rethink my design. But it didn&#39;t sink in until today"}], "tags": [], "owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "is_accepted": false, "score": 2, "last_activity_date": 1559573172, "creation_date": 1559573172, "answer_id": 56429736, "question_id": 56429670, "link": "https://stackoverflow.com/questions/56429670/created-a-type-alias-for-big-int-but-i-cant-set-it-using-its-pointer-receiver/56429736#56429736", "title": "Created a type alias for big.Int - but I can&#39;t Set it using its pointer receiver?", "body": "<p>That isn't a type alias, it's a new type, and therefor has <em>none</em> of the methods of the underlying <code>big.Int</code> type. A type alias would be <code>type BigInt = big.Int</code>, but then you couldn't define new methods on it. A type's methods are locked to its package: there is no way to define methods on an imported type <em>in addition to</em> the methods it already has defined. Embedding is the closest you're likely to get to that. More likely you want to reconsider your design, most likely by creating functions that take a <code>big.Int</code> instead of trying to define new methods.</p>\n"}, {"tags": [], "owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "is_accepted": false, "score": -1, "last_activity_date": 1559573557, "creation_date": 1559573557, "answer_id": 56429841, "question_id": 56429670, "link": "https://stackoverflow.com/questions/56429670/created-a-type-alias-for-big-int-but-i-cant-set-it-using-its-pointer-receiver/56429841#56429841", "title": "Created a type alias for big.Int - but I can&#39;t Set it using its pointer receiver?", "body": "<p>I forgot that I can dereference the pointer receiver /left hand side of the <code>=</code> sign as well. This does exactly what I wanted...</p>\n\n<pre><code>// Set makes a BigInt equal to a given big.Int.\nfunc (b *BigInt) Set(i *big.Int) *BigInt {\n    iB := BigInt(*i)\n    *b = iB\n    return b\n}\n</code></pre>\n"}], "owner": {"reputation": 382, "user_id": 3328311, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/437d1a24f69a7108e6abd9fa71c98b70?s=128&d=identicon&r=PG&f=1", "display_name": "randomshinichi", "link": "https://stackoverflow.com/users/3328311/randomshinichi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 42, "favorite_count": 0, "answer_count": 2, "score": -3, "last_activity_date": 1559573557, "creation_date": 1559572954, "question_id": 56429670, "link": "https://stackoverflow.com/questions/56429670/created-a-type-alias-for-big-int-but-i-cant-set-it-using-its-pointer-receiver", "title": "Created a type alias for big.Int - but I can&#39;t Set it using its pointer receiver?", "body": "<p>I thought a type alias would be more elegant than embedding a struct.\nYou see, if I create a new type <code>BigInt</code> that embeds <code>big.Int</code>, I'd have to take care that the embedded big.Int is initialized at all times, and unless I reimplement big.Int's like Cmp, Add, Sub, all the code that depends on this new type needs to know that <code>BigInt</code>'s methods actually receive a <code>big.Int</code> for their arguments. Which is stupid.</p>\n\n<p>So I tried aliasing a type.</p>\n\n<pre><code>type BigInt big.Int\n\n// String casts BigInt into big.Int and uses its String method.\nfunc (b *BigInt) String() string {\n    bc := big.Int(*b)\n    return bc.String()\n}\n</code></pre>\n\n<p>But Setting the pointer receiver is now very tricky because I don't have access to the internals of big.Int. This following code doesn't work at all:</p>\n\n<pre><code>// UnmarshalJSON casts BigInt into big.Int and uses its UnmarshalJSON method.\nfunc (b *BigInt) UnmarshalJSON(text []byte) error {\n    bc := new(big.Int)\n    err := bc.UnmarshalJSON(text)\n    if err != nil {\n        return err\n    }\n    b = b.Set(bc)\n    return nil\n}\n\n// Set is different from big.Int.Set() in that you must use the value it returns\nfunc (b *BigInt) Set(i *big.Int) *BigInt {\n    iB := BigInt(*i)\n    b = &amp;iB\n    return b\n}\n</code></pre>\n\n<p>What can I do?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559571370, "post_id": 56429072, "comment_id": 99452780, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/q/17912893/13860\">stackoverflow.com/q/17912893/13860</a>"}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559571813, "post_id": 56429220, "comment_id": 99453028, "body": "The question (and thus answer) really has nothing to do with JSON, so suggesting the OP search for other JSON questions, and linking to JSON-related docs, isn&#39;t really the best advice."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559571966, "post_id": 56429220, "comment_id": 99453096, "body": "Your answer isn&#39;t per se wrong, but it&#39;s incomplete. Please show the full definition you&#39;re referring to. And best practice would also be to use a named field in <code>DataRequestBody</code>."}, {"owner": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "edited": false, "score": 0, "creation_date": 1559641414, "post_id": 56429220, "comment_id": 99476034, "body": "This is how I have progressed, but am still not getting it what&#39;s wrong...  <a href=\"https://play.golang.org/p/g3WS4BnGquY\" rel=\"nofollow noreferrer\">play.golang.org/p/g3WS4BnGquY</a>"}, {"owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "reply_to_user": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "edited": false, "score": 0, "creation_date": 1559643752, "post_id": 56429220, "comment_id": 99477212, "body": "@Artur Dont define a stuct in another struct, its not idiomatic."}, {"owner": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "edited": false, "score": 0, "creation_date": 1559645436, "post_id": 56429220, "comment_id": 99478117, "body": "@sHartmann this was just to illustrate, won&#39;t do that in final code"}, {"owner": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "edited": false, "score": 0, "creation_date": 1559887715, "post_id": 56429220, "comment_id": 99566709, "body": "@hartmann I am still stuck with this issue. All I want to do is make with json.Marshal to look like this:  {    account: &quot;foo&quot;,    team: &quot;bar&quot;,    player: &quot;John&quot;,    data: {       family: &quot;Doe&quot;    }  }  I am just not understanding on how to create the nested json structure with Structs."}, {"owner": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "edited": false, "score": 0, "creation_date": 1560150956, "post_id": 56429220, "comment_id": 99628336, "body": "@hartmann I gave acceptance to your answer. Thank you for your help. I managed to get it working when I read your answer little bit more."}], "tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": true, "score": 0, "last_activity_date": 1559574046, "last_edit_date": 1559574046, "creation_date": 1559571517, "answer_id": 56429220, "question_id": 56429072, "link": "https://stackoverflow.com/questions/56429072/generating-nested-json-with-golang/56429220#56429220", "title": "Generating nested JSON with golang", "body": "<p>Its pretty straight forward, you definded it like this:</p>\n\n<pre><code>type PlayerRequestBody struct {\n    Account string          `json:\"account\"`\n    Team    string          `json:\"team\"`\n    Player  string          `json:\"player\"`\n    Data    DataRequestBody `json:\"data\"`\n\n l := PlayerRequestBody{\n        Account: \"my-account\",\n        Team:    \"12345\",\n        Player:  \"23424234\",\n        Data:    DataRequestBody{FamilyRequestBody{Family:\"hello\"}},\n    }\n</code></pre>\n\n<p>but wanted it to use it like that:</p>\n\n<pre><code>type PlayerRequestBody struct {\n    Account string           `json:\"account\"`\n    Team    string           `json:\"team\"`\n    Player  string           `json:\"player\"`\n    Data    FamilyRequestBody`json:\"family\"`\n\n l := PlayerRequestBody{\n        Account: \"my-account\",\n        Team:    \"12345\",\n        Player:  \"23424234\",\n        Data:    {Family:\"hello\"}},\n    }\n</code></pre>\n\n<p>Your field <code>Data</code> is from type <code>DataRequestBody</code> like defined in your struct, you cant put another struct there. In golang there is no such thing as inheritance, and that is probably not what you wanted either.</p>\n\n<p>I agree that OP\u00b4s question is not JSON related, like Flimzy mentioned in the comments, but i leave the links for good measures.</p>\n\n<p>If that is not what you wanted, check out the many other questions explaining how json with go works, or use <a href=\"https://gobyexample.com/json\" rel=\"nofollow noreferrer\">gobyexample</a>, or the <a href=\"https://golang.org/pkg/encoding/json/\" rel=\"nofollow noreferrer\">docs</a>.</p>\n"}], "owner": {"reputation": 1379, "user_id": 6676298, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a135bfda7fda8aa2c552d065a83d7ed6?s=128&d=identicon&r=PG&f=1", "display_name": "Artur", "link": "https://stackoverflow.com/users/6676298/artur"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 141, "favorite_count": 0, "accepted_answer_id": 56429220, "answer_count": 1, "score": -2, "last_activity_date": 1559574046, "creation_date": 1559570928, "last_edit_date": 1559573132, "question_id": 56429072, "link": "https://stackoverflow.com/questions/56429072/generating-nested-json-with-golang", "title": "Generating nested JSON with golang", "body": "<p>So what am I doing wrong here, am not really understanding how to generate a nested JSON structure:</p>\n\n<p>I am getting \"missing type in composite literal\" exception.\n<a href=\"https://play.golang.org/p/pA1fpbQHbb0\" rel=\"nofollow noreferrer\">https://play.golang.org/p/pA1fpbQHbb0</a></p>\n\n<pre><code>package main\n\nimport \"fmt\"\n\ntype FamilyRequestBody struct {\n    Family string `json:\"family\"`\n}\n\ntype DataRequestBody struct {\n    Family FamilyRequestBody `json:\"family\"`\n}\n\ntype EventRequestBody struct {\n    Account string `json:\"account\"`\n    Player  string `json:\"player\"`\n    Count   int    `json:\"count\"`\n}\n\ntype TeamRequestBody struct {\n    Account string `json:\"account\"`\n    Team    string `json:\"team\"`\n}\n\ntype PlayerRequestBody struct {\n    Account string          `json:\"account\"`\n    Team    string          `json:\"team\"`\n    Player  string          `json:\"player\"`\n    Data    DataRequestBody `json:\"data\"`\n}\n\nfunc main() {\n    l := PlayerRequestBody{\n        Account: \"my-account\",\n        Team:    \"12345\",\n        Player:  \"23424234\",\n        Data:    {Family: \"12345\"},\n    }\n\n    fmt.Printf(\"%#v\\n\", l)\n}\n\n</code></pre>\n"}, {"tags": ["mongodb", "go", "heroku"], "comments": [{"owner": {"reputation": 15461, "user_id": 2934579, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/eT1BM.png?s=128&g=1", "display_name": "Wan Bachtiar", "link": "https://stackoverflow.com/users/2934579/wan-bachtiar"}, "edited": false, "score": 1, "creation_date": 1559625827, "post_id": 56428790, "comment_id": 99469239, "body": "Did you install the dependency ? <a href=\"https://devcenter.heroku.com/articles/go-dependencies-via-godep\" rel=\"nofollow noreferrer\">devcenter.heroku.com/articles/go-dependencies-via-godep</a>"}], "answers": [{"tags": [], "owner": {"reputation": 51, "user_id": 5334013, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-idr1d_tojhI/AAAAAAAAAAI/AAAAAAAAABQ/wGdS0lU5U30/photo.jpg?sz=128", "display_name": "Curious", "link": "https://stackoverflow.com/users/5334013/curious"}, "is_accepted": false, "score": 0, "last_activity_date": 1560341014, "creation_date": 1560341014, "answer_id": 56561804, "question_id": 56428790, "link": "https://stackoverflow.com/questions/56428790/how-to-deploy-app-on-heroku-with-go-and-mongodb-without-an-error/56561804#56561804", "title": "How to deploy app on heroku with go and mongodb without an error?", "body": "<p>I was needed to move my app from <code>$GOPATH/src</code> directory and install mongodb driver using <code>go get go.mongodb.org/mongo-driver</code> like in <a href=\"https://www.mongodb.com/blog/post/mongodb-go-driver-tutorial\" rel=\"nofollow noreferrer\">this</a> tutorial.</p>\n"}], "owner": {"reputation": 51, "user_id": 5334013, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-idr1d_tojhI/AAAAAAAAAAI/AAAAAAAAABQ/wGdS0lU5U30/photo.jpg?sz=128", "display_name": "Curious", "link": "https://stackoverflow.com/users/5334013/curious"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 314, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1595282612, "creation_date": 1559569895, "question_id": 56428790, "link": "https://stackoverflow.com/questions/56428790/how-to-deploy-app-on-heroku-with-go-and-mongodb-without-an-error", "title": "How to deploy app on heroku with go and mongodb without an error?", "body": "<p>Can't deploy. Getting an error:</p>\n\n<pre><code>cannot load go.mongodb.org/mongo-driver/mongo: open /tmp/build_aa982e7b99ad67f15e2c45be4077d6e9/vendor/go.mongodb.org/mongo-driver/mongo: no such file or directory\n</code></pre>\n\n<p>I've tried to ways of import:</p>\n\n<p>1) \"go.mongodb.org/mongo-driver/mongo\"</p>\n\n<p>Works fine locally but crashing during deploy</p>\n\n<p>2) \"github.com/mongodb/mongo-go-driver/mongo\"</p>\n\n<p>Doesn't work</p>\n\n<p>main.go:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"net/http\"\n    \"os\"\n    \"context\"\n\n    \"github.com/gin-gonic/gin\"\n    _ \"github.com/heroku/x/hmetrics/onload\"\n    \"go.mongodb.org/mongo-driver/mongo\"\n    \"go.mongodb.org/mongo-driver/mongo/options\"\n)\n\nconst (\n    usernameKey = \"xxx\"\n    passwordKey = \"xxx\"\n    hostKey     = \"ds131905.mlab.com:31905\"\n    databaseKey = \"heroku_zj4jbgpn\"\n)\n\nfunc main() {\n    port := os.Getenv(\"PORT\")\n\n    if port == \"\" {\n        log.Fatal(\"$PORT must be set\")\n    }\n\n    router := gin.New()\n    router.Use(gin.Logger())\n    router.LoadHTMLGlob(\"templates/*.tmpl.html\")\n    router.Static(\"/static\", \"static\")\n\n    router.GET(\"/\", func(c *gin.Context) {\n        c.HTML(http.StatusOK, \"index.tmpl.html\", nil)\n    })\n\n    connectToMongoDb()\n\n    router.Run(\":\" + port)\n}\n\n\nfunc connectToMongoDb() {\n    ctx := context.TODO()\n\n    db, err := configDB(ctx)\n    if err != nil {\n        log.Fatalf(\"Database configuration failed: %v\", err)\n    }\n\n    fmt.Printf(\"Found a single document: %+v\\n\", db)\n\n}\n\nfunc configDB(ctx context.Context) (*mongo.Database, error) {\n    uri := fmt.Sprintf(`mongodb://%s:%s@%s/%s`,\n        usernameKey,\n        passwordKey,\n        hostKey,\n        databaseKey,\n    )\n    client, err := mongo.NewClient(options.Client().ApplyURI(uri))\n    if err != nil {\n        return nil, fmt.Errorf(\"couldn't connect to mongo: %v\", err)\n    }\n\n    err = client.Connect(ctx)\n    if err != nil {\n        return nil, fmt.Errorf(\"todo: mongo client couldn't connect with background context: %v\", err)\n    }\n    fmt.Println(\"-----&gt;&gt;&gt;&gt;&gt; Mongo client CONNECTED!!!\")\n    todoDB := client.Database(databaseKey)\n    return todoDB, nil\n}\n</code></pre>\n\n<p>Deploy logs:</p>\n\n<pre><code>-----&gt; Go app detected\n-----&gt; Fetching stdlib.sh.v8... done\n-----&gt; \n       Detected go modules via go.mod\n-----&gt; \n       Detected Module Name: github.com/heroku/go-getting-started\n-----&gt; \n !!    The go.mod file for this project does not specify a Go version\n !!    \n !!    Defaulting to go1.12.5\n !!    \n !!    For more details see: https://devcenter.heroku.com/articles/go-apps-with-modules#build-configuration\n !!    \n-----&gt; Using go1.12.5\n-----&gt; Determining packages to install\n\n       Detected the following main packages to install:\n            github.com/heroku/go-getting-started\n\n-----&gt; Running: go install -v -tags heroku -mod=vendor github.com/heroku/go-getting-started \nbuild github.com/heroku/go-getting-started: cannot load go.mongodb.org/mongo-driver/mongo: open /tmp/build_aa982e7b99ad67f15e2c45be4077d6e9/vendor/go.mongodb.org/mongo-driver/mongo: no such file or directory\n !     Push rejected, failed to compile Go app.\n !     Push failed\n</code></pre>\n\n<p>.bash_progile</p>\n\n<pre><code>export GOPATH=$HOME/go\nexport PATH=$PATH:$GOPATH/bin\n</code></pre>\n\n<p>Project location:</p>\n\n<pre><code>/Users/denis/go/src/github.com/heroku/aqueous-ridge-14148/\n</code></pre>\n\n<p>Mongo driver location:</p>\n\n<pre><code>/Users/denis/go/src/go.mongodb.org/mongo-driver/\n</code></pre>\n"}, {"tags": ["windows", "powershell", "go", "cmd"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559565396, "post_id": 56427488, "comment_id": 99449507, "body": "Write directly to a file, as can be seen in the marked duplicate. PowerShell converts certain control characters."}, {"owner": {"reputation": 23468, "user_id": 4137916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bab91fda70af7e9beb8934d323540e8?s=128&d=identicon&r=PG", "display_name": "Jeroen Mostert", "link": "https://stackoverflow.com/users/4137916/jeroen-mostert"}, "edited": false, "score": 0, "creation_date": 1559565543, "post_id": 56427488, "comment_id": 99449589, "body": "A potentially better duplicate is <a href=\"https://stackoverflow.com/q/28166845/4137916\">this</a>. The general issue really has nothing to do with <code>go</code> or image files; it&#39;s about PowerShell and binary output. It is, of course, possible to write a file in <code>go</code> instead, but if you can&#39;t or don&#39;t want to modify the <code>go</code> program you&#39;ll have to solve it on the PowerShell end."}, {"owner": {"reputation": 61, "user_id": 10043764, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JTFAHIIlEVU/AAAAAAAAAAI/AAAAAAAAAAA/5CuDTR1wEyc/photo.jpg?sz=128", "display_name": "csk", "link": "https://stackoverflow.com/users/10043764/csk"}, "edited": false, "score": 0, "creation_date": 1559565785, "post_id": 56427488, "comment_id": 99449715, "body": "Interesting, thanks! Perhaps I&#39;ll just stick to doing it in CMD or in a Linux operating system. Very bizarre."}, {"owner": {"reputation": 61, "user_id": 10043764, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JTFAHIIlEVU/AAAAAAAAAAI/AAAAAAAAAAA/5CuDTR1wEyc/photo.jpg?sz=128", "display_name": "csk", "link": "https://stackoverflow.com/users/10043764/csk"}, "edited": false, "score": 1, "creation_date": 1559566082, "post_id": 56427488, "comment_id": 99449857, "body": "Lol should I delete the question? None of those results came up when I was looking for my question. And generally when I search for something it points to StackOverflow marking something as duplicate anyway, which has helped me and I&#39;m assuming has helped others.  If I don&#39;t get -10 I&#39;ll be disappointed in everything I&#39;ve heard about this community."}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559566448, "post_id": 56427488, "comment_id": 99450058, "body": "Up to you. If you couldn&#39;t find the other ansers, maybe others won&#39;t be able too, and this question might still help them."}, {"owner": {"reputation": 23468, "user_id": 4137916, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6bab91fda70af7e9beb8934d323540e8?s=128&d=identicon&r=PG", "display_name": "Jeroen Mostert", "link": "https://stackoverflow.com/users/4137916/jeroen-mostert"}, "edited": false, "score": 0, "creation_date": 1559566563, "post_id": 56427488, "comment_id": 99450124, "body": "SO&#39;s own search is legendarily useless when it comes to finding actual duplicate questions; you&#39;re better off using a general search engine with a restriction like <code>site:stackoverflow.com</code>."}, {"owner": {"reputation": 15822, "user_id": 1156452, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/okUnm.jpg?s=128&g=1", "display_name": "thatjeffsmith", "link": "https://stackoverflow.com/users/1156452/thatjeffsmith"}, "edited": false, "score": 2, "creation_date": 1559567304, "post_id": 56427488, "comment_id": 99450518, "body": "Don&#39;t delete the question, it will help others find the answer, I&#39;m sure you won&#39;t be the only one who doesn&#39;t find it in a search"}], "owner": {"reputation": 61, "user_id": 10043764, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-JTFAHIIlEVU/AAAAAAAAAAI/AAAAAAAAAAA/5CuDTR1wEyc/photo.jpg?sz=128", "display_name": "csk", "link": "https://stackoverflow.com/users/10043764/csk"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 101, "favorite_count": 0, "closed_date": 1559565370, "answer_count": 0, "score": 5, "last_activity_date": 1559565712, "creation_date": 1559565250, "question_id": 56427488, "link": "https://stackoverflow.com/questions/56427488/how-does-powershell-handle-redirection-compared-to-command-prompt", "closed_reason": "Duplicate", "title": "How does PowerShell handle redirection compared to Command Prompt?", "body": "<p>I am running a Go program that generates a file in gif format. When using Bash or Command Prompt, the file is generated successfully. However, when using PowerShell or PowerShell-Core, I receive an error: \"The image \u2018file:///C:\\Users\\blah\\blah\\blah\u2019 cannot be displayed because it contains errors\". </p>\n\n<p>How can I generate this file correctly using PowerShell? </p>\n\n<p>I have attempted to run the exact same commands that worked on Bash and Command Prompt. I have also tried using PowerShell cmdlets like Out-File and Tee-Object. </p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>go build main.go\n.\\main.exe &gt; out.gif\nfirefox out.gif\n</code></pre>\n\n<p>Performing the above actions in Bash or Command Prompt generate the file and the expected gif. Performing the action in PowerShell yields the error message described above (image cannot be displayed because it contains errors). </p>\n\n<p>I have also tried:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>.\\main.exe | Out-File out.gif\nand\n.\\main.exe | Tee-Object out.gif\n</code></pre>\n\n<p>Both generate the broken file.</p>\n"}, {"tags": ["loops", "go"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559562677, "post_id": 56426698, "comment_id": 99448109, "body": "This condition: <code>if (point.pattern != &quot;Decreasing Trend&quot; || point.pattern != &quot;Increasing Trend&quot;) &amp;&amp; ...</code> \u2013 the first part is always <code>true</code>, <code>a != X || a != Y</code> is always <code>true</code> if <code>X != Y</code>. You most likely want to use <code>&amp;&amp;</code> instead of <code>||</code>."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559562931, "post_id": 56426698, "comment_id": 99448246, "body": "I did not think that... I assumed that since I was setting the future values like this:             pointsToUse[i+1].pattern = &quot;Decreasing Trend&quot;... But I see your point now"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559562984, "post_id": 56426698, "comment_id": 99448276, "body": "<code>point.pattern != &quot;Decreasing Trend&quot; || point.pattern != &quot;Increasing Trend&quot;</code> \u2013 this condition makes no sense, this is always <code>true</code>."}, {"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559563045, "post_id": 56426698, "comment_id": 99448309, "body": "Would you recommend removing that condition entirely, then adding this statement below the trend statements: &quot;\t\tif point.pattern == &quot;Decreasing Trend&quot; || point.pattern == &quot;Increasing Trend&quot; { \t\t\tcontinue \t\t}&quot;"}], "answers": [{"comments": [{"owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "edited": false, "score": 0, "creation_date": 1559563987, "post_id": 56426956, "comment_id": 99448777, "body": "Thanks, I assumed because I was setting teh future values in the &quot;Increasing Trend&quot; and &quot;Decreasing Trend&quot; if statement that it would evaluate correctly"}], "tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1559564582, "last_edit_date": 1559564582, "creation_date": 1559563287, "answer_id": 56426956, "question_id": 56426698, "link": "https://stackoverflow.com/questions/56426698/for-loop-logic-to-mark-the-trend-type-for-a-series-of-datapoints-by-looking-at-f/56426956#56426956", "title": "For loop logic to mark the trend type for a series of datapoints by looking at future point values", "body": "<p>this line:\n<code>if (point.pattern != \"Decreasing Trend\" || point.pattern != \"Increasing Trend\") &amp;&amp; len(pointsToUse)-(i+1) &gt;= 6 {</code> </p>\n\n<p>equals to:\n<code>if true &amp;&amp; len(pointsToUse)-(i+1) &gt;= 6 {</code> </p>\n\n<p>additionaly, you need to use <code>pointsToUse[i].pattern = \"Decreasing Trend\"</code> instead of <code>point.pattern = \"Decreasing Trend\"</code> because <code>point</code> is your loop value and does not get assigned in your slice.</p>\n\n<p>Why  <code>for _,a := range b</code> references a copy, check out <a href=\"https://stackoverflow.com/questions/15945030/change-values-while-iterating-in-golang\">Change values while iterating in Golang</a> (stackoverflow question)</p>\n"}, {"tags": [], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "is_accepted": false, "score": 1, "last_activity_date": 1559568936, "creation_date": 1559568936, "answer_id": 56428517, "question_id": 56426698, "link": "https://stackoverflow.com/questions/56426698/for-loop-logic-to-mark-the-trend-type-for-a-series-of-datapoints-by-looking-at-f/56428517#56428517", "title": "For loop logic to mark the trend type for a series of datapoints by looking at future point values", "body": "<p>Thanks to icza and sHartmann for pointing me in the right direction:</p>\n\n<p>The full loop is here:</p>\n\n<pre><code>    for i, point := range pointsToUse {\n\n        if len(pointsToUse)-(i+1) &gt;= 5 {\n            if point.quantity &gt; pointsToUse[i+1].quantity &amp;&amp; pointsToUse[i+1].quantity &gt; pointsToUse[i+2].quantity &amp;&amp; pointsToUse[i+2].quantity &gt; pointsToUse[i+3].quantity &amp;&amp; pointsToUse[i+3].quantity &gt; pointsToUse[i+4].quantity &amp;&amp; pointsToUse[i+4].quantity &gt; pointsToUse[i+5].quantity {\n                pointsToUse[i].pattern = \"Decreasing Trend\"\n                pointsToUse[i+1].pattern = \"Decreasing Trend\"\n                pointsToUse[i+2].pattern = \"Decreasing Trend\"\n                pointsToUse[i+3].pattern = \"Decreasing Trend\"\n                pointsToUse[i+4].pattern = \"Decreasing Trend\"\n                pointsToUse[i+5].pattern = \"Decreasing Trend\"\n                continue\n            } else if point.quantity &lt; pointsToUse[i+1].quantity &amp;&amp; pointsToUse[i+1].quantity &lt; pointsToUse[i+2].quantity &amp;&amp; pointsToUse[i+2].quantity &lt; pointsToUse[i+3].quantity &amp;&amp; pointsToUse[i+3].quantity &lt; pointsToUse[i+4].quantity &amp;&amp; pointsToUse[i+4].quantity &lt; pointsToUse[i+5].quantity {\n                pointsToUse[i].pattern = \"Increasing Trend\"\n                pointsToUse[i+1].pattern = \"Increasing Trend\"\n                pointsToUse[i+2].pattern = \"Increasing Trend\"\n                pointsToUse[i+3].pattern = \"Increasing Trend\"\n                pointsToUse[i+4].pattern = \"Increasing Trend\"\n                pointsToUse[i+5].pattern = \"Increasing Trend\"\n                continue\n            }\n        }\n\n        if pointsToUse[i].pattern == \"Decreasing Trend\" || pointsToUse[i].pattern == \"Increasing Trend\" {\n            continue\n        } else if len(pointsToUse)-(i+1) &gt;= 6 {\n            if point.quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+1].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+3].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+4].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+5].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+6].quantity &lt; pointsToUse[i].mean {\n                pointsToUse[i].pattern = \"Below Mean\"\n                pointsToUse[i+1].pattern = \"Below Mean\"\n                pointsToUse[i+2].pattern = \"Below Mean\"\n                pointsToUse[i+3].pattern = \"Below Mean\"\n                pointsToUse[i+4].pattern = \"Below Mean\"\n                pointsToUse[i+5].pattern = \"Below Mean\"\n                pointsToUse[i+6].pattern = \"Below Mean\"\n            } else if point.quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+1].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+3].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+4].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+5].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+6].quantity &lt; pointsToUse[i].mean {\n                pointsToUse[i].pattern = \"Above Mean\"\n                pointsToUse[i+1].pattern = \"Above Mean\"\n                pointsToUse[i+2].pattern = \"Above Mean\"\n                pointsToUse[i+3].pattern = \"Above Mean\"\n                pointsToUse[i+4].pattern = \"Above Mean\"\n                pointsToUse[i+5].pattern = \"Above Mean\"\n                pointsToUse[i+6].pattern = \"Above Mean\"\n            }\n        }\n}\n</code></pre>\n\n<p>One of the key changes that I had to make was making an else statement for the Below/Above mean categorisation that follows from this statement that stops this increment in the loop:</p>\n\n<pre><code>        if pointsToUse[i].pattern == \"Decreasing Trend\" || pointsToUse[i].pattern == \"Increasing Trend\" {\n        continue\n    } \n</code></pre>\n"}], "owner": {"reputation": 894, "user_id": 6129842, "user_type": "registered", "accept_rate": 58, "profile_image": "https://www.gravatar.com/avatar/cbe4e0267ebd8487991053966942c1b9?s=128&d=identicon&r=PG&f=1", "display_name": "SuperSecretAndHiddenFromWork", "link": "https://stackoverflow.com/users/6129842/supersecretandhiddenfromwork"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 32, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1559568936, "creation_date": 1559562415, "question_id": 56426698, "link": "https://stackoverflow.com/questions/56426698/for-loop-logic-to-mark-the-trend-type-for-a-series-of-datapoints-by-looking-at-f", "title": "For loop logic to mark the trend type for a series of datapoints by looking at future point values", "body": "<p>I'm using a for loop that goes through a series of datapoints and works out how to class the trend that the data is showing</p>\n\n<p>Here's the logic to flag the points:</p>\n\n<ul>\n<li>If 6 points in a row have a decreasing/increasing trend, flag as \"Decreasing Trend\"/\"Increasing Trend\"</li>\n<li>else if 7 points in a row are below/above the mean, flag as \"Below Mean\"/\"Above Mean\"</li>\n</ul>\n\n<p>We prioritising the increasing/decreasing trend over below or above the mean</p>\n\n<p>I think the logic i'm using is incorrect, but i'm unsure why. This is some of the logic in a sentence for the series:</p>\n\n<p>\"For each point, if the next 5 points are below this and then their previous partner, mark all those points as 'Decreasing Trend'. Else if a point isn't trend marked, see if the following 6 points from this point are all above or below the mean\"</p>\n\n<p>You can copy and paste this in in totality:</p>\n\n<pre><code>package main\n\nimport (\n\"bufio\"\n\"fmt\"\n\"os\"\n\"strings\"\n)\n\ntype points struct {\n    quantity   float64\n    lowerBound float64\n    upperBound float64\n    mean       float64\n    pattern    string\n}\n\nfunc main() {\n\nvar pointsToUse = []points{\n    points{quantity: 3.5, lowerBound: 1, upperBound: 4.8,, mean: 4, pattern: \"Common Variation\"},\n\n    points{\n        quantity:   3.4,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.2,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.19,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.17,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.14,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.12,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.09,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   4.1,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3.16,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n\n    points{\n        quantity:   3,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3.11,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3.12,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3.14,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3.13,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Common Variation\",\n    },\n    points{\n        quantity:   3.17,\n        lowerBound: 3,\n        upperBound: 4.8,\n        mean:       4,\n        pattern:    \"Commons Variation\",\n    },\n}\n\nfor i, point := range pointsToUse {\n\n    if len(pointsToUse) &gt;= 6 &amp;&amp; len(pointsToUse)-(i+1) &gt;= 5 {\n        if point.quantity &gt; pointsToUse[i+1].quantity &amp;&amp; pointsToUse[i+1].quantity &gt; pointsToUse[i+2].quantity &amp;&amp; pointsToUse[i+2].quantity &gt; pointsToUse[i+3].quantity &amp;&amp; pointsToUse[i+3].quantity &gt; pointsToUse[i+4].quantity &amp;&amp; pointsToUse[i+4].quantity &gt; pointsToUse[i+5].quantity {\n            point.pattern = \"Decreasing Trend\"\n            pointsToUse[i+1].pattern = \"Decreasing Trend\"\n            pointsToUse[i+2].pattern = \"Decreasing Trend\"\n            pointsToUse[i+3].pattern = \"Decreasing Trend\"\n            pointsToUse[i+4].pattern = \"Decreasing Trend\"\n            pointsToUse[i+5].pattern = \"Decreasing Trend\"\n            continue\n        } else if point.quantity &lt; pointsToUse[i+1].quantity &amp;&amp; pointsToUse[i+1].quantity &lt; pointsToUse[i+2].quantity &amp;&amp; pointsToUse[i+2].quantity &lt; pointsToUse[i+3].quantity &amp;&amp; pointsToUse[i+3].quantity &lt; pointsToUse[i+4].quantity &amp;&amp; pointsToUse[i+4].quantity &lt; pointsToUse[i+5].quantity {\n            point.pattern = \"Increasing Trend\"\n            pointsToUse[i+1].pattern = \"Increasing Trend\"\n            pointsToUse[i+2].pattern = \"Increasing Trend\"\n            pointsToUse[i+3].pattern = \"Increasing Trend\"\n            pointsToUse[i+4].pattern = \"Increasing Trend\"\n            pointsToUse[i+5].pattern = \"Increasing Trend\"\n            continue\n        }\n    }\n    if (point.pattern != \"Decreasing Trend\" || point.pattern != \"Increasing Trend\") &amp;&amp; len(pointsToUse)-(i+1) &gt;= 6 {\n        if point.quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+1].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+3].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+4].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+5].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+6].quantity &lt; pointsToUse[i].mean {\n            pointsToUse[i].pattern = \"Below Mean\"\n            pointsToUse[i+1].pattern = \"Below Mean\"\n            pointsToUse[i+2].pattern = \"Below Mean\"\n            pointsToUse[i+3].pattern = \"Below Mean\"\n            pointsToUse[i+4].pattern = \"Below Mean\"\n            pointsToUse[i+5].pattern = \"Below Mean\"\n            pointsToUse[i+6].pattern = \"Below Mean\"\n        } else if point.quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+1].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+3].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+4].quantity &gt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+5].quantity &lt; pointsToUse[i].mean &amp;&amp; pointsToUse[i+6].quantity &lt; pointsToUse[i].mean {\n            pointsToUse[i].pattern = \"Above Mean\"\n            pointsToUse[i+1].pattern = \"Above Mean\"\n            pointsToUse[i+2].pattern = \"Above Mean\"\n            pointsToUse[i+3].pattern = \"Above Mean\"\n            pointsToUse[i+4].pattern = \"Above Mean\"\n            pointsToUse[i+5].pattern = \"Above Mean\"\n            pointsToUse[i+6].pattern = \"Above Mean\"\n        }\n    }\n}\n\nfmt.Println(pointsToUse)\n}\n</code></pre>\n\n<p>The output that I need to show is this:</p>\n\n<pre><code>3.50 | Decreasing Trend\n3.40 | Decreasing Trend\n3.20 | Decreasing Trend\n3.19 | Decreasing Trend\n3.17 | Decreasing Trend\n3.14 | Decreasing Trend\n3.12 | Decreasing Trend\n3.09 | Decreasing Trend\n4.1 | Common Variation\n3.16 | Below Mean\n3.00 | Below Mean\n3.00 | Below Mean\n3.11 | Below Mean\n3.12 | Below Mean\n3.14 | Below Mean\n3.13 | Below Mean\n3.17 | Below Mean\n</code></pre>\n\n<p>Can someone identify where i'm going wrong? </p>\n"}, {"tags": ["docker", "go", "docker-compose", "digital-ocean", "docker-network"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559562489, "post_id": 56426152, "comment_id": 99448010, "body": "You should be able to run this on a Docker Desktop setup without worrying about firewall configuration at all.  (Except IIRC the Mac setup doesn&#39;t let you bind to &quot;low&quot; ports and you&#39;ll need to pick different port numbers.)  Can you show the bit of the application that binds to the network socket?"}, {"owner": {"reputation": 13, "user_id": 11593193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9de67b4d467efb9ca15e4589754c3b3?s=128&d=identicon&r=PG&f=1", "display_name": "d.kowalsky92", "link": "https://stackoverflow.com/users/11593193/d-kowalsky92"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559563788, "post_id": 56426152, "comment_id": 99448680, "body": "Updated the original question."}, {"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559570367, "post_id": 56426152, "comment_id": 99452255, "body": "If you set <code>server.ip</code> to 0.0.0.0, does it work better?  (In general in Docker, if you **bind**(2) to 127.0.0.1, a service will be unreachable from outside its own container.)"}, {"owner": {"reputation": 13, "user_id": 11593193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9de67b4d467efb9ca15e4589754c3b3?s=128&d=identicon&r=PG&f=1", "display_name": "d.kowalsky92", "link": "https://stackoverflow.com/users/11593193/d-kowalsky92"}, "reply_to_user": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559571554, "post_id": 56426152, "comment_id": 99452890, "body": "Omg, it works, thank you so much man!"}], "answers": [{"tags": [], "owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "is_accepted": true, "score": 0, "last_activity_date": 1559571870, "creation_date": 1559571870, "answer_id": 56429322, "question_id": 56426152, "link": "https://stackoverflow.com/questions/56426152/accessing-containerised-api-hosted-on-digital-ocean-droplet-from-a-remote-machin/56429322#56429322", "title": "Accessing containerised API hosted on digital ocean droplet from a remote machine", "body": "<p>In Docker generally the localhost 127.0.0.1 address means \"this container\".  If you start a server process and tell it to listen on 127.0.0.1, it will only accept connections originating from within the same container.  You almost always want to set servers to listen on the magic 0.0.0.0 \"all interfaces\" address, at which point they will be able to accept connections from other containers and the host.</p>\n\n<p>In your setup, this just involves changing the configuration value <code>\"server\": {\"ip\": \"0.0.0.0\"}</code>.</p>\n"}], "owner": {"reputation": 13, "user_id": 11593193, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f9de67b4d467efb9ca15e4589754c3b3?s=128&d=identicon&r=PG&f=1", "display_name": "d.kowalsky92", "link": "https://stackoverflow.com/users/11593193/d-kowalsky92"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 48, "favorite_count": 0, "accepted_answer_id": 56429322, "answer_count": 1, "score": 0, "last_activity_date": 1559571870, "creation_date": 1559560314, "last_edit_date": 1559564148, "question_id": 56426152, "link": "https://stackoverflow.com/questions/56426152/accessing-containerised-api-hosted-on-digital-ocean-droplet-from-a-remote-machin", "title": "Accessing containerised API hosted on digital ocean droplet from a remote machine", "body": "<p>I am trying to connect to a docker-compose deployed service stack on a DigitalOcean Docker droplet. It contains a MySQL container with a database and a go/alpine container with the API. I am using a custom bridge network which the 2 containers connect to. The issue also occurred when trying to deploy the stack locally on my mac and accessing the API container via localhost:port. I am not using docker-machine as I assume it only is needed for multi-host deployments. The stack is deployed successfully. The server container seems to be able to connect to the DB container. I am wondering if the issue might be within the host's firewall rules?</p>\n\n<p>I did try to run the app locally with mysql server running on my machine and it does work, so I don't think the reason is malfunctioning code. I couldn't get it to work either with basic HTTP server nor with https with self-signed certificates (both work on my local machine).</p>\n\n<p>docker-compose.yml</p>\n\n<pre><code>version: \"3.7\"\n\nnetworks:\n  net:\n    attachable: true\n\nservices:\n  db:\n    build: ./db\n    ports:\n      - \"3306:3306\"\n    environment:\n      - MYSQL_ENV=local\n    networks:\n      - net\n  server:\n    build: ./server\n    ports:\n      - \"80:5000\"\n      - \"443:5001\"\n    networks:\n      - net\n    tty: true\n    links:\n      - db:db\n</code></pre>\n\n<p>iptables -L with the stack deployed:</p>\n\n<pre><code>Chain INPUT (policy DROP)\ntarget     prot opt source               destination         \nufw-before-logging-input  all  --  anywhere             anywhere            \nufw-before-input  all  --  anywhere             anywhere            \nufw-after-input  all  --  anywhere             anywhere            \nufw-after-logging-input  all  --  anywhere             anywhere            \nufw-reject-input  all  --  anywhere             anywhere            \nufw-track-input  all  --  anywhere             anywhere            \n\nChain FORWARD (policy ACCEPT)\ntarget     prot opt source               destination         \nDOCKER-USER  all  --  anywhere             anywhere            \nDOCKER-ISOLATION-STAGE-1  all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\nDOCKER     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\nDOCKER     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere            \nufw-before-logging-forward  all  --  anywhere             anywhere            \nufw-before-forward  all  --  anywhere             anywhere            \nufw-after-forward  all  --  anywhere             anywhere            \nufw-after-logging-forward  all  --  anywhere             anywhere            \nufw-reject-forward  all  --  anywhere             anywhere            \nufw-track-forward  all  --  anywhere             anywhere            \n\nChain OUTPUT (policy ACCEPT)\ntarget     prot opt source               destination         \nufw-before-logging-output  all  --  anywhere             anywhere            \nufw-before-output  all  --  anywhere             anywhere            \nufw-after-output  all  --  anywhere             anywhere            \nufw-after-logging-output  all  --  anywhere             anywhere            \nufw-reject-output  all  --  anywhere             anywhere            \nufw-track-output  all  --  anywhere             anywhere            \n\nChain DOCKER (2 references)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             172.24.0.2           tcp dpt:mysql\nACCEPT     tcp  --  anywhere             172.24.0.3           tcp dpt:5001\nACCEPT     tcp  --  anywhere             172.24.0.3           tcp dpt:5000\n\nChain DOCKER-ISOLATION-STAGE-1 (1 references)\ntarget     prot opt source               destination         \nDOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            \nDOCKER-ISOLATION-STAGE-2  all  --  anywhere             anywhere            \nRETURN     all  --  anywhere             anywhere            \n\nChain DOCKER-ISOLATION-STAGE-2 (2 references)\ntarget     prot opt source               destination         \nDROP       all  --  anywhere             anywhere            \nDROP       all  --  anywhere             anywhere            \nRETURN     all  --  anywhere             anywhere            \n\nChain DOCKER-USER (1 references)\ntarget     prot opt source               destination         \nRETURN     all  --  anywhere             anywhere            \n\nChain ufw-after-forward (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-after-input (1 references)\ntarget     prot opt source               destination         \nufw-skip-to-policy-input  udp  --  anywhere             anywhere             udp dpt:netbios-ns\nufw-skip-to-policy-input  udp  --  anywhere             anywhere             udp dpt:netbios-dgm\nufw-skip-to-policy-input  tcp  --  anywhere             anywhere             tcp dpt:netbios-ssn\nufw-skip-to-policy-input  tcp  --  anywhere             anywhere             tcp dpt:microsoft-ds\nufw-skip-to-policy-input  udp  --  anywhere             anywhere             udp dpt:bootps\nufw-skip-to-policy-input  udp  --  anywhere             anywhere             udp dpt:bootpc\nufw-skip-to-policy-input  all  --  anywhere             anywhere             ADDRTYPE match dst-type BROADCAST\n\nChain ufw-after-logging-forward (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-after-logging-input (1 references)\ntarget     prot opt source               destination         \nLOG        all  --  anywhere             anywhere             limit: avg 3/min burst 10 LOG level warning prefix \"[UFW BLOCK] \"\n\nChain ufw-after-logging-output (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-after-output (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-before-forward (1 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\nACCEPT     icmp --  anywhere             anywhere             icmp destination-unreachable\nACCEPT     icmp --  anywhere             anywhere             icmp time-exceeded\nACCEPT     icmp --  anywhere             anywhere             icmp parameter-problem\nACCEPT     icmp --  anywhere             anywhere             icmp echo-request\nufw-user-forward  all  --  anywhere             anywhere            \n\nChain ufw-before-input (1 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\nufw-logging-deny  all  --  anywhere             anywhere             ctstate INVALID\nDROP       all  --  anywhere             anywhere             ctstate INVALID\nACCEPT     icmp --  anywhere             anywhere             icmp destination-unreachable\nACCEPT     icmp --  anywhere             anywhere             icmp time-exceeded\nACCEPT     icmp --  anywhere             anywhere             icmp parameter-problem\nACCEPT     icmp --  anywhere             anywhere             icmp echo-request\nACCEPT     udp  --  anywhere             anywhere             udp spt:bootps dpt:bootpc\nufw-not-local  all  --  anywhere             anywhere            \nACCEPT     udp  --  anywhere             224.0.0.251          udp dpt:mdns\nACCEPT     udp  --  anywhere             239.255.255.250      udp dpt:1900\nufw-user-input  all  --  anywhere             anywhere            \n\nChain ufw-before-logging-forward (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-before-logging-input (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-before-logging-output (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-before-output (1 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \nACCEPT     all  --  anywhere             anywhere             ctstate RELATED,ESTABLISHED\nufw-user-output  all  --  anywhere             anywhere            \n\nChain ufw-logging-allow (0 references)\ntarget     prot opt source               destination         \nLOG        all  --  anywhere             anywhere             limit: avg 3/min burst 10 LOG level warning prefix \"[UFW ALLOW] \"\n\nChain ufw-logging-deny (2 references)\ntarget     prot opt source               destination         \nRETURN     all  --  anywhere             anywhere             ctstate INVALID limit: avg 3/min burst 10\nLOG        all  --  anywhere             anywhere             limit: avg 3/min burst 10 LOG level warning prefix \"[UFW BLOCK] \"\n\nChain ufw-not-local (1 references)\ntarget     prot opt source               destination         \nRETURN     all  --  anywhere             anywhere             ADDRTYPE match dst-type LOCAL\nRETURN     all  --  anywhere             anywhere             ADDRTYPE match dst-type MULTICAST\nRETURN     all  --  anywhere             anywhere             ADDRTYPE match dst-type BROADCAST\nufw-logging-deny  all  --  anywhere             anywhere             limit: avg 3/min burst 10\nDROP       all  --  anywhere             anywhere            \n\nChain ufw-reject-forward (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-reject-input (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-reject-output (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-skip-to-policy-forward (0 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \n\nChain ufw-skip-to-policy-input (7 references)\ntarget     prot opt source               destination         \nDROP       all  --  anywhere             anywhere            \n\nChain ufw-skip-to-policy-output (0 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \n\nChain ufw-track-forward (1 references)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             anywhere             ctstate NEW\nACCEPT     udp  --  anywhere             anywhere             ctstate NEW\n\nChain ufw-track-input (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-track-output (1 references)\ntarget     prot opt source               destination         \nACCEPT     tcp  --  anywhere             anywhere             ctstate NEW\nACCEPT     udp  --  anywhere             anywhere             ctstate NEW\n\nChain ufw-user-forward (1 references)\ntarget     prot opt source               destination         \n\nChain ufw-user-input (1 references)\ntarget     prot opt source               destination         \n           tcp  --  anywhere             anywhere             tcp dpt:ssh ctstate NEW recent: SET name: DEFAULT side: source mask: 255.255.255.255\nufw-user-limit  tcp  --  anywhere             anywhere             tcp dpt:ssh ctstate NEW recent: UPDATE seconds: 30 hit_count: 6 name: DEFAULT side: source mask: 255.255.255.255\nufw-user-limit-accept  tcp  --  anywhere             anywhere             tcp dpt:ssh\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:2375\nACCEPT     tcp  --  anywhere             anywhere             tcp dpt:2376\n\nChain ufw-user-limit (1 references)\ntarget     prot opt source               destination         \nLOG        all  --  anywhere             anywhere             limit: avg 3/min burst 5 LOG level warning prefix \"[UFW LIMIT BLOCK] \"\nREJECT     all  --  anywhere             anywhere             reject-with icmp-port-unreachable\n\nChain ufw-user-limit-accept (1 references)\ntarget     prot opt source               destination         \nACCEPT     all  --  anywhere             anywhere            \n\nChain ufw-user-logging-forward (0 references)\ntarget     prot opt source               destination         \n\nChain ufw-user-logging-input (0 references)\ntarget     prot opt source               destination         \n\nChain ufw-user-logging-output (0 references)\ntarget     prot opt source               destination         \n\nChain ufw-user-output (1 references)\ntarget     prot opt source               destination \n</code></pre>\n\n<p><strong>UPDATE:</strong></p>\n\n<p>I have 3 json files with configs &amp; credentials for different environments that are parsed into a config object with the following format (credentials substituted for obvious reasons):</p>\n\n<pre><code>{\n  \"server\": {\n    \"certificate\": \"&lt;HTTPS_CERT&gt;.pem\",\n    \"key\": \"&lt;HTTPS_KEY.pem\",\n    \"ip\": \"127.0.0.1\",\n    \"port\": \"5000\",\n    \"protocol\": \"http://\",\n    \"file_protocol\": \"bfile://\"\n  },\n  \"database\": {\n    \"address\": \"db\",\n    \"port\": \"3306\",\n    \"name\": \"brieefly\",\n    \"user\": \"&lt;USERNAME&gt;\",\n    \"password\": \"&lt;PASSWORD&gt;\"\n  },\n  \"auth\": {\n    \"public\": \"&lt;JWT_AUTH_KEY&gt;.rsa.pub\",\n    \"private\": \"&lt;JWT_AUTH_PRIV_KEY&gt;.rsa\"\n  }\n}\n</code></pre>\n\n<p>The config is then passed to a db object and a router object:</p>\n\n<p>db:</p>\n\n<pre><code>// connect to db - this succeeds\n\nfunc Connect(config *config.Config) (*DB, *err.Error) {\n    connectionString := fmt.Sprintf(\"%s:%s@(%s:%s)/%s?parseTime=true\",\n        config.Database.User,\n        config.Database.Password,\n        config.Database.Address,\n        config.Database.Port,\n        config.Database.Name)\n    log.Debug(connectionString)\n    db, sqlErr := sql.Open(\"mysql\", connectionString)\n    if sqlErr != nil {\n        return nil, err.New(sqlErr, err.ErrConnectionFailure, nil)\n    }\n    sqlErr = db.Ping()\n    if sqlErr != nil {\n        return nil, err.New(sqlErr, err.ErrConnectionFailure, nil)\n    }\n    return &amp;DB{db}, nil\n}\n\n.\n.\n.\n\n</code></pre>\n\n<p>router:</p>\n\n<pre><code>.\n.\n.\n\n// Run - starts the server\nfunc (r *Router) Run() *err.Error {\n    path := config.MyPath(r.config)\n    var httpErr error\n\n    if r.config.Environment == config.Local {\n        httpErr = http.ListenAndServe(path, r.mux)\n    } else {\n        httpErr = http.ListenAndServeTLS(path, r.config.TLSCert(), r.config.TLSKey(), r.mux)\n    }\n\n    return err.New(httpErr, err.ErrInternal, nil)\n}\n\n.\n.\n.\n\n</code></pre>\n\n<p>main function:</p>\n\n<pre><code>// since the db container needs time to start mysql server daemon, the app is retrying the connection infinitely until it succeds, *router.Run()* is a blocking operation.\n\nfunc main() {\n    retry.PerformInfinite(retry.DefaultOptions(), func() *err.Error {\n        log.Info(\"Configuring...\")\n        c, cErr := config.NewConfig(config.Local)\n        if cErr != nil {\n            log.Error(cErr)\n            return cErr\n        }\n        log.Info(\"Configuration successful.\")\n\n        log.Info(\"Connecting to database...\")\n        db, dbErr := db.Connect(c)\n        if dbErr != nil {\n            log.Error(dbErr)\n            return dbErr\n        }\n        log.Info(\"Connected.\")\n\n        router := net.NewRouter(db, c)\n\n\n        log.Info(\"Server is running.\")\n        log.Info(\"Accepting standard input -&gt; \")\n        rtErr := router.Run()\n        if rtErr != nil {\n            log.Error(dbErr)\n            return rtErr\n        }\n\n        return nil\n    })\n}\n\n</code></pre>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559558394, "post_id": 56425039, "comment_id": 99445945, "body": "Use <code>go get -u=patch</code> if you only want to update to patch releases, but not minor."}, {"owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "reply_to_user": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "edited": false, "score": 0, "creation_date": 1559570822, "post_id": 56425039, "comment_id": 99452488, "body": "During the development process, I want a way to update all packages to the latest versions, but locked packages to the latest within the locked branch."}], "answers": [{"tags": [], "owner": {"reputation": 748, "user_id": 1645024, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/4835a765a5fb1547008d916a5165a702?s=128&d=identicon&r=PG", "display_name": "bcmills", "link": "https://stackoverflow.com/users/1645024/bcmills"}, "is_accepted": false, "score": 0, "last_activity_date": 1564515555, "creation_date": 1564515555, "answer_id": 57278940, "question_id": 56425039, "link": "https://stackoverflow.com/questions/56425039/lock-go-module-for-specific-branch-while-update/57278940#57278940", "title": "lock go module for specific branch while update", "body": "<p>A request for this feature is tracked at <a href=\"https://golang.org/issue/26964\" rel=\"nofollow noreferrer\">https://golang.org/issue/26964</a>.</p>\n"}], "owner": {"reputation": 1041, "user_id": 365557, "user_type": "registered", "accept_rate": 29, "profile_image": "https://www.gravatar.com/avatar/be74c8f8958cafb02ea319768e98daa4?s=128&d=identicon&r=PG", "display_name": "abonec", "link": "https://stackoverflow.com/users/365557/abonec"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 283, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1564515555, "creation_date": 1559556115, "question_id": 56425039, "link": "https://stackoverflow.com/questions/56425039/lock-go-module-for-specific-branch-while-update", "title": "lock go module for specific branch while update", "body": "<p>Dep has a very useful option - lock given a package for branch via constraints. You just specify a branch for a package and <code>dep ensure -update</code> update this package only within a selected branch.</p>\n\n<p>In go modules I have to manually type go get -u package@branch and if I want to update all my modules by <code>go get -u</code> it will change <code>branch</code> in <code>package</code> to branch with most recent commit if any.</p>\n\n<p>Is it possible to have dep-like behavior or automate this workflow? </p>\n"}, {"tags": ["go", "synchronization"], "comments": [{"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 1, "creation_date": 1559549604, "post_id": 56423412, "comment_id": 99441663, "body": "The code actually <i>does</i> <i>use</i> a uint32 and it <i>does</i> <i>not</i> deadlock. So what is your question?"}, {"owner": {"reputation": 195, "user_id": 6931629, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DVH5n.png?s=128&g=1", "display_name": "G.yang", "link": "https://stackoverflow.com/users/6931629/g-yang"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559550600, "post_id": 56423412, "comment_id": 99442083, "body": "we can use only a uint32\uff0cdrop the Mutex\uff0clike the code snippet I gave above.And it will not lead to deadlock,if f calls Do again @Volker"}, {"owner": {"reputation": 1083, "user_id": 8153816, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-K29_Y98AFzU/AAAAAAAAAAI/AAAAAAAAA6E/Ra5_Wf7a6ZU/photo.jpg?sz=128", "display_name": "Giulio Micheloni", "link": "https://stackoverflow.com/users/8153816/giulio-micheloni"}, "edited": false, "score": 1, "creation_date": 1559550713, "post_id": 56423412, "comment_id": 99442122, "body": "Probably something to ask to golang-dev@googlegroups.com. The mailing list of golang contributors."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1559551456, "post_id": 56423412, "comment_id": 99442438, "body": "The potential deadlock is a feature, not a bug."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 12, "last_activity_date": 1607584171, "last_edit_date": 1607584171, "creation_date": 1559550953, "answer_id": 56423729, "question_id": 56423412, "link": "https://stackoverflow.com/questions/56423412/sync-once-implementation/56423729#56423729", "title": "sync.Once implementation", "body": "<p><a href=\"https://golang.org/pkg/sync/#Once.Do\" rel=\"nofollow noreferrer\"><code>Once.Do()</code></a> does not return until <code>f()</code> has been executed once. Which means if multiple goroutines call <code>Once.Do()</code> concurrently, <code>f()</code> will be executed once of course, but all calls will wait until <code>f()</code> completes (they will be blocked).</p>\n<p>Your proposed solution does not have this very important property! Yours only guarantees that <code>f()</code> will be executed only once, but if called from multiple goroutines concurrently, subsequent calls will return immediately, even if <code>f()</code> is still running.</p>\n<p>When we use <code>sync.Once</code>, we rely on this behavior, we rely on <code>f()</code> being completed after <code>Once.Do()</code> returns, so we can use all variables that <code>f()</code> initialized safely, without having a race condition.</p>\n"}], "owner": {"reputation": 195, "user_id": 6931629, "user_type": "registered", "accept_rate": 100, "profile_image": "https://i.stack.imgur.com/DVH5n.png?s=128&g=1", "display_name": "G.yang", "link": "https://stackoverflow.com/users/6931629/g-yang"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 1, "accepted_answer_id": 56423729, "answer_count": 1, "score": -5, "last_activity_date": 1607584171, "creation_date": 1559549481, "last_edit_date": 1559555167, "question_id": 56423412, "link": "https://stackoverflow.com/questions/56423412/sync-once-implementation", "title": "sync.Once implementation", "body": "<p>I have a question about <strong><em>sync.Once()</em></strong> in Go 1.12. The source code is below:</p>\n\n<pre><code>// Because no call to Do returns until the one call to f returns, if f causes\n// Do to be called, it will deadlock.\n\nfunc (o *Once) Do(f func()) {\n    if atomic.LoadUint32(&amp;o.done) == 1 {\n        return\n    }\n    // Slow-path.\n    o.m.Lock()\n    defer o.m.Unlock()\n    if o.done == 0 {\n        defer atomic.StoreUint32(&amp;o.done, 1)\n        f()\n    }\n}\n</code></pre>\n\n<p>Why not just use an <code>uint32</code> variable, then do CAS on this variable. It seems to be more effective, and will not lead to deadlock.</p>\n\n<p>The code like:</p>\n\n<pre><code>type Once uint32\nfunc (o *Once) Do(f func()) {\n    if atomic.CompareAndSwapUint32((*uint32)(o), 0, 1) {\n        f()\n    }\n}\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 14194, "user_id": 4966953, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/dl696.png?s=128&g=1", "display_name": "Marc", "link": "https://stackoverflow.com/users/4966953/marc"}, "edited": false, "score": 2, "creation_date": 1559540130, "post_id": 56421464, "comment_id": 99438217, "body": "Please clarify your question. Compression of a single int will not yield any benefit, compression algorithms take advantage of repeated or sparse data to save bytes but need extra information to decompress. Furthermore, the interface to compression algorithms is usually sets of bytes (in Go: io.Reader and io.Writer interfaces)."}, {"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 2, "creation_date": 1559542309, "post_id": 56421464, "comment_id": 99438771, "body": "How about you store the int as an int, not as a string? You\u2019ll hardly get any more compact than that."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1559542591, "post_id": 56421464, "comment_id": 99438847, "body": "That is not how numbers work in computers. 4251658154 fits into uint32, which is only 4 bytes to begin with, not 10. That being said, there are some encodings that <i>can</i> save space, such as <a href=\"https://developers.google.com/protocol-buffers/docs/encoding#varints\" rel=\"nofollow noreferrer\">varint</a> (see <a href=\"https://golang.org/pkg/encoding/binary/#pkg-index\" rel=\"nofollow noreferrer\">the encoding/binary package</a>)."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "reply_to_user": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1559543537, "post_id": 56421464, "comment_id": 99439166, "body": "@Peter: To be clear, such encodings can save space <i>sometimes</i>. In other cases, they actually <a href=\"https://golang.org/pkg/encoding/binary/#pkg-constants\" rel=\"nofollow noreferrer\">increase</a> the size requirements."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559545312, "post_id": 56421464, "comment_id": 99439821, "body": "Is there a reason you&#39;re talking about the text representation of a number, rather than it&#39;s in-memory binary representation? If you must convey your number via a text channel (such as email), then you can use hexidecimal, or base64, or even possibly base96, for more compact representations."}, {"owner": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559546483, "post_id": 56421464, "comment_id": 99440297, "body": "&quot;[I]s there any way to compress int and decompress it use Go?&quot; Yes, especially if you do not insist of the a compress-decompress-cycle to be lossless: Just encode any number to 0x00 and decode 0x00 to 0x00 always. You <i>really</i> <i>must</i> clarify your question."}, {"owner": {"reputation": 13, "user_id": 11592012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b034871ea9eddcf513d330b2f89e160?s=128&d=identicon&r=PG&f=1", "display_name": "Benson", "link": "https://stackoverflow.com/users/11592012/benson"}, "reply_to_user": {"reputation": 30951, "user_id": 1266756, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/52eb9d81540fd9e91b82435b194ec9df?s=128&d=identicon&r=PG", "display_name": "Volker", "link": "https://stackoverflow.com/users/1266756/volker"}, "edited": false, "score": 0, "creation_date": 1559546804, "post_id": 56421464, "comment_id": 99440415, "body": "@Volker my mean from encode is decrees size of characters. For example 10 length int to 5 length bytes"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1559548269, "post_id": 56421464, "comment_id": 99441073, "body": "As now observed in comments below, you&#39;re apparently dealing with IP addresses. IP addresses (for IPv4) are <i>always</i> exactly 4 bytes. Just use the natural representation, and you&#39;ll save space. No compression necessary."}], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 2, "creation_date": 1559545205, "post_id": 56422408, "comment_id": 99439784, "body": "The OP&#39;s example, <code>4251658154</code>, isn&#39;t very small. It&#39;s varint encoding is <code>d49ed9d61f</code> using your above code, and  requiring 5 bytes."}, {"owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "reply_to_user": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559545476, "post_id": 56422408, "comment_id": 99439895, "body": "OP Actually says &quot;for example my 10 char int to 5 char bytes&quot;. It beats representing the number as int64 or string."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 3, "creation_date": 1559546066, "post_id": 56422408, "comment_id": 99440126, "body": "Pretty much anything practical will beat base 10, of course. The point Flimzy wanted to make is that the varint in this particular case is bigger than the natural representation of uint32, which is well worth pointing out."}, {"owner": {"reputation": 469137, "user_id": 476, "user_type": "moderator", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a235706e3d81b614acaec3368edfea4b?s=128&d=identicon&r=PG", "display_name": "deceze", "link": "https://stackoverflow.com/users/476/deceze"}, "edited": false, "score": 0, "creation_date": 1559554477, "post_id": 56422408, "comment_id": 99443984, "body": "Comments are not for extended discussion; this conversation has been <a href=\"https://chat.stackoverflow.com/rooms/194363/discussion-on-answer-by-not-a-golfer-how-compress-int-number-in-go\">moved to chat</a>."}], "tags": [], "owner": {"reputation": 39512, "user_id": 1239701, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/95ca4e887354416993fd91e2e16c4380?s=128&d=identicon&r=PG", "display_name": "Not_a_Golfer", "link": "https://stackoverflow.com/users/1239701/not-a-golfer"}, "is_accepted": true, "score": 0, "last_activity_date": 1559549945, "last_edit_date": 1559549945, "creation_date": 1559545001, "answer_id": 56422408, "question_id": 56421464, "link": "https://stackoverflow.com/questions/56421464/how-compress-int-number-in-go/56422408#56422408", "title": "How compress int (number) in Go", "body": "<p>If you just want to compress arbitrary number at different magniturdes, What you're looking for is varint encoding. If the number is small (&lt;127) it can be encoded in one byte, and so forth. Example <a href=\"https://golang.org/pkg/encoding/binary/#PutVarint\" rel=\"nofollow noreferrer\">from the docs:</a></p>\n\n<p>package main</p>\n\n<pre><code>import (\n    \"encoding/binary\"\n    \"fmt\"\n)\n\nfunc main() {\n    buf := make([]byte, binary.MaxVarintLen64)\n\n    for _, x := range []int64{-65, -64, -2, -1, 0, 1, 2, 63, 64} {\n        n := binary.PutVarint(buf, x)\n        fmt.Printf(\"%x\\n\", buf[:n])\n    }\n}\n\n// Prints:\n// 8101\n// 7f\n// 03\n// 01\n// 00\n// 02\n// 04\n// 7e\n// 8001\n</code></pre>\n\n<p>If however you want to represent IPV4 addresses in an efficient manner, just encode them as unsigned int32 numbers. </p>\n\n<pre><code>import (\n    \"bytes\"\n    \"encoding/binary\"\n    \"fmt\"\n    \"net\"\n)\n\nfunc IPToNumber(addr string) (uint32, error) {\n    var n uint32\n    err := binary.Read(bytes.NewBuffer(net.ParseIP(addr).To4()), binary.BigEndian, &amp;n)\n    return n, err\n}\n\nfunc main() {\n    if n, err := IPToNumber(\"255.255.255.255\"); err == nil {\n        fmt.Printf(\"%x\", n)\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 13, "user_id": 11592012, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b034871ea9eddcf513d330b2f89e160?s=128&d=identicon&r=PG&f=1", "display_name": "Benson", "link": "https://stackoverflow.com/users/11592012/benson"}, "delete_vote_count": 1, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 259, "favorite_count": 1, "closed_date": 1559555897, "accepted_answer_id": 56422408, "answer_count": 1, "score": -5, "last_activity_date": 1559549945, "creation_date": 1559538724, "last_edit_date": 1559541929, "question_id": 56421464, "link": "https://stackoverflow.com/questions/56421464/how-compress-int-number-in-go", "closed_reason": "Needs details or clarity", "title": "How compress int (number) in Go", "body": "<p>is there any way to compress int and decompress it use Go?</p>\n\n<p>For example this number 10 char <code>4251658154</code></p>\n\n<p>I want to compress (make size small, for example my 10 char int to 5 char bytes) int or any kind of data type accept number than decompress it</p>\n"}, {"tags": ["go", "generics"], "answers": [{"tags": [], "owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "is_accepted": true, "score": 4, "last_activity_date": 1559532001, "creation_date": 1559532001, "answer_id": 56420756, "question_id": 56420634, "link": "https://stackoverflow.com/questions/56420634/how-can-i-declare-a-map-parameter-which-accept-any-type-of-value-in-golang/56420756#56420756", "title": "How can I declare a map parameter which accept any type of value in golang?", "body": "<p>You CANNOT do that. <code>map[string]interface{}</code> and <code>map[string]Bar</code> are two different types. You have to build a <code>map[string]interface{}</code> with the <code>map[string]Bar</code> manually.</p>\n\n<pre><code>mapAny := make(map[string]interface{})\nfor key, val := range myMap {\n    mapAny[key] = val\n}\nfoo(mapAny)\n</code></pre>\n\n<p>What you need is template in C++, however, Golang doesn't have template support.</p>\n"}], "owner": {"reputation": 1409, "user_id": 4505964, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/qDyMt.jpg?s=128&g=1", "display_name": "Xiaochen Cui", "link": "https://stackoverflow.com/users/4505964/xiaochen-cui"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 192, "favorite_count": 0, "closed_date": 1559543900, "accepted_answer_id": 56420756, "answer_count": 1, "score": 1, "last_activity_date": 1559532001, "creation_date": 1559530484, "question_id": 56420634, "link": "https://stackoverflow.com/questions/56420634/how-can-i-declare-a-map-parameter-which-accept-any-type-of-value-in-golang", "closed_reason": "Duplicate", "title": "How can I declare a map parameter which accept any type of value in golang?", "body": "<p>For your convenience: <a href=\"https://play.golang.org/p/C3zWbjlgxy5\" rel=\"nofollow noreferrer\">go playground</a></p>\n\n<p>I has a function which does not care the value type of a map parameter, so\nI declare it as this:</p>\n\n<p><code>func foo(generalMap map[string]interface{}) {}</code></p>\n\n<p>But when I call it with a specified map like this:</p>\n\n<pre><code>myMap := make(map[string]Bar)\nfoo(myMap)\n</code></pre>\n\n<p>Then the compiler error comes out:\n<code>cannot use myMap (type map[string]Bar) as type map[string]interface {} in argument to foo</code></p>\n"}, {"tags": ["go", "concurrency"], "answers": [{"comments": [{"owner": {"reputation": 532, "user_id": 3506300, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/74303643814c70273d978f9a8b3ef309?s=128&d=identicon&r=PG&f=1", "display_name": "kumarD", "link": "https://stackoverflow.com/users/3506300/kumard"}, "edited": false, "score": 0, "creation_date": 1559534594, "post_id": 56420829, "comment_id": 99437091, "body": "But i already am creating max 20 go routines in the main function right ? why doesn&#39;t that work @for_stack?"}, {"owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "reply_to_user": {"reputation": 532, "user_id": 3506300, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/74303643814c70273d978f9a8b3ef309?s=128&d=identicon&r=PG&f=1", "display_name": "kumarD", "link": "https://stackoverflow.com/users/3506300/kumard"}, "edited": false, "score": 0, "creation_date": 1559536503, "post_id": 56420829, "comment_id": 99437458, "body": "NO. There&#39;re more than 20 Goroutines. Since each of your 20 goroutine will create more Goroutines to call <code>makeRequest</code>."}, {"owner": {"reputation": 532, "user_id": 3506300, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/74303643814c70273d978f9a8b3ef309?s=128&d=identicon&r=PG&f=1", "display_name": "kumarD", "link": "https://stackoverflow.com/users/3506300/kumard"}, "edited": false, "score": 0, "creation_date": 1559544413, "post_id": 56420829, "comment_id": 99439476, "body": "Thanks for the help @for_stack i understood the exact problem with the code, the issue was I&#39;m creating more go routines inside the for loop which creates the 20 go routines"}], "tags": [], "owner": {"reputation": 14359, "user_id": 5384363, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/975cbfcd1c4997cb9e85887a5271d48f?s=128&d=identicon&r=PG&f=1", "display_name": "for_stack", "link": "https://stackoverflow.com/users/5384363/for-stack"}, "is_accepted": false, "score": 1, "last_activity_date": 1559533203, "last_edit_date": 1559533203, "creation_date": 1559532795, "answer_id": 56420829, "question_id": 56420454, "link": "https://stackoverflow.com/questions/56420454/too-many-open-files-no-such-host-error-while-running-a-go-program-which-makes-c/56420829#56420829", "title": "Too Many open files/ No such host error while running a go program which makes concurrent requests", "body": "<p>You can use a buffered channel, A.K.A. <strong>counting semaphore</strong>, to limit the parallelism.</p>\n\n<pre><code>// The capacity of the buffered channel is 10,\n// which means you can have 10 goroutines to \n// run the makeRequest function in parallel.\nvar tokens = make(chan struct{}, 10)\n\nfunc makeRequest(payload string) {\n    tokens &lt;- struct{}{}            // acquire the token or block here\n    defer func() { &lt;-tokens }()     // release the token to awake another goroutine\n    // other code...\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 56, "user_id": 4393220, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/638c3557d64485cf416c8a7147aa4865?s=128&d=identicon&r=PG&f=1", "display_name": "lyh", "link": "https://stackoverflow.com/users/4393220/lyh"}, "is_accepted": true, "score": 2, "last_activity_date": 1559542784, "creation_date": 1559542784, "answer_id": 56422018, "question_id": 56420454, "link": "https://stackoverflow.com/questions/56420454/too-many-open-files-no-such-host-error-while-running-a-go-program-which-makes-c/56422018#56422018", "title": "Too Many open files/ No such host error while running a go program which makes concurrent requests", "body": "<p>inside your 20 goroutines started in main(), \"go makeRequest(...)\" again created one goroutine for each event. you don't need start extra goroutine there.\nBesides, I think you don't need start goroutine in your scan loop, either. buffered channel is enough\uff0cbecause bottleneck should be at doing http requests.</p>\n"}], "owner": {"reputation": 532, "user_id": 3506300, "user_type": "registered", "accept_rate": 52, "profile_image": "https://www.gravatar.com/avatar/74303643814c70273d978f9a8b3ef309?s=128&d=identicon&r=PG&f=1", "display_name": "kumarD", "link": "https://stackoverflow.com/users/3506300/kumard"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 90, "favorite_count": 0, "accepted_answer_id": 56422018, "answer_count": 2, "score": 0, "last_activity_date": 1559542784, "creation_date": 1559528553, "question_id": 56420454, "link": "https://stackoverflow.com/questions/56420454/too-many-open-files-no-such-host-error-while-running-a-go-program-which-makes-c", "title": "Too Many open files/ No such host error while running a go program which makes concurrent requests", "body": "<p>I have a golang program which is supposed to call an API with different payloads, the web application is a drop wizard application which is running on localhost, and the go program is below</p>\n\n<pre><code>package main\n\nimport (\n\"bufio\"\n\"encoding/json\"\n\"log\"\n\"net\"\n\"net/http\"\n\"os\"\n\"strings\"\n\"time\"\n)\n\ntype Data struct {\nPersonnelId  string `json:\"personnel_id\"`\nDepartmentId string `json:\"department_id\"`\n}\n\ntype PersonnelEvent struct {\nEventType string `json:\"event_type\"`\nData      `json:\"data\"`\n}\n\nconst (\nmaxIdleConnections        = 20\nmaxIdleConnectionsPerHost = 20\ntimeout                   = time.Duration(5 * time.Second)\n)\n\nvar transport = http.Transport{\nDial:                dialTimeout,\nMaxIdleConns:        maxIdleConnections,\nMaxIdleConnsPerHost: 20,\n}\n\nvar client = &amp;http.Client{\nTransport: &amp;transport,\n}\n\nfunc dialTimeout(network, addr string) (net.Conn, error) {\nreturn net.DialTimeout(network, addr, timeout)\n}\n\nfunc makeRequest(payload string) {\nreq, _ := http.NewRequest(\"POST\", \"http://localhost:9350/v1/provider- \nlocation-personnel/index\", strings.NewReader(payload))\nreq.Header.Set(\"X-App-Token\", \"TESTTOKEN1\")\nreq.Header.Set(\"Content-Type\", \"application/json\")\nresp, err := client.Do(req)\nif err != nil {\n    log.Println(\"Api invocation returned an error \", err)\n} else {\n    defer resp.Body.Close()\n    log.Println(resp.Body)\n}\n}\n\nfunc indexPersonnels(personnelPayloads []PersonnelEvent) {\nfor _, personnelEvent := range personnelPayloads {\n    payload, err := json.Marshal(personnelEvent)\n    if err != nil {\n        log.Println(\"Error while marshalling payload \", err)\n    }\n    log.Println(string(payload))\n    // go makeRequest(string(payload))\n  }\n}\n\nfunc main() {\nch := make(chan PersonnelEvent)\nfor i := 0; i &lt; 20; i++ {\n    go func() {\n        for personnelEvent := range ch {\n            payload, err := json.Marshal(personnelEvent)\n            if err != nil {\n                log.Println(\"Error while marshalling payload\", err)\n            }\n            go makeRequest(string(payload))\n            //log.Println(\"Payload \", string(payload))\n        }\n    }()\n}\n\nfile, err := os.Open(\"/Users/tmp/Desktop/personnels.txt\")\ndefer file.Close()\nif err != nil {\n    log.Fatalf(\"Error opening personnel id file %v\", err)\n}\nscanner := bufio.NewScanner(file)\nfor scanner.Scan() {\n    go func() {\n        ch &lt;- PersonnelEvent{EventType: \"provider_location_department_personnel_linked\", Data: Data{DepartmentId: \"2a8d9687-aea8-4a2c-bc08-c64d7716d973\", PersonnelId: scanner.Text()}}\n    }()\n}\n\n}\n</code></pre>\n\n<p>Its reading some ids from a file and then creating a payload out of it and invoking a post request on the web server, but when i run the program it gives too many open file errors/no such host errors, i feel that the program is too much concurrent how to make it run gracefully?    </p>\n"}, {"tags": ["go", "routes", "jwt-auth", "jwt-go"], "answers": [{"tags": [], "owner": {"reputation": 6470, "user_id": 25814, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nDa7n.jpg?s=128&g=1", "display_name": "themue", "link": "https://stackoverflow.com/users/25814/themue"}, "is_accepted": false, "score": 0, "last_activity_date": 1559493363, "creation_date": 1559493363, "answer_id": 56416924, "question_id": 56415581, "link": "https://stackoverflow.com/questions/56415581/how-to-test-authenticate-jwt-routes-in-go/56416924#56416924", "title": "How to test authenticate JWT routes in go", "body": "<p>Surely it depends on your used packages, but I don't see any test of the token inside a handler. It's inside the header, but that's all.</p>\n\n<p>Maybe you take a look on how I test my JWT wrapper for my JWT packages. You find it at</p>\n\n<p><a href=\"https://github.com/tideland/go/blob/170f9d31dde003d7fdab1f643119acb8f4e24879/net/webbox/wrapper_test.go#L197\" rel=\"nofollow noreferrer\">https://github.com/tideland/go/blob/170f9d31dde003d7fdab1f643119acb8f4e24879/net/webbox/wrapper_test.go#L197</a></p>\n"}, {"tags": [], "owner": {"reputation": 2862, "user_id": 10115847, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/Okv0j.jpg?s=128&g=1", "display_name": "Or Yaacov", "link": "https://stackoverflow.com/users/10115847/or-yaacov"}, "is_accepted": false, "score": 1, "last_activity_date": 1559569189, "last_edit_date": 1559569189, "creation_date": 1559510531, "answer_id": 56419030, "question_id": 56415581, "link": "https://stackoverflow.com/questions/56415581/how-to-test-authenticate-jwt-routes-in-go/56419030#56419030", "title": "How to test authenticate JWT routes in go", "body": "<p>just use a function that's validates your token, here is an example with <a href=\"https://github.com/dgrijalva/jwt-go\" rel=\"nofollow noreferrer\">jwt-go</a></p>\n\n<pre><code>func isValidToken(tokenString, yourSecret string) bool {\n    token, err := jwt.Parse(tokenString, func(token *jwt.Token) (interface{}, error) {\n        if _, ok := token.Method.(*jwt.SigningMethodHMAC); !ok {\n            return nil, fmt.Errorf(\"Unexpected signing method: %v\", token.Header[\"alg\"])\n        }\n        return []byte(yourSecret), nil\n    })\n\n    if claims, ok := token.Claims.(jwt.MapClaims); ok &amp;&amp; token.Valid {\n        return true\n    }\n    return false\n}\n</code></pre>\n"}], "owner": {"reputation": 11, "user_id": 8156855, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a3bd40a4dd1f4c958e8d1a96a478e71f?s=128&d=identicon&r=PG&f=1", "display_name": "clayton pereira", "link": "https://stackoverflow.com/users/8156855/clayton-pereira"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1129, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1588107552, "creation_date": 1559482895, "last_edit_date": 1588107552, "question_id": 56415581, "link": "https://stackoverflow.com/questions/56415581/how-to-test-authenticate-jwt-routes-in-go", "title": "How to test authenticate JWT routes in go", "body": "<p>I want to test protected routes in go with JWT authentication.</p>\n\n<p>Already try to receive a response and try to pass a token, but its only returns 401 as code response.</p>\n\n<pre><code>package routes\n\nimport (\n    \"fmt\"\n    \"github.com/stretchr/testify/assert\"\n\n    \"net/http\"\n    \"net/http/httptest\"\n    \"testing\"\n)\n\nfunc performRequest(r http.Handler, method, path string, t *testing.T) *httptest.ResponseRecorder {\n    token := \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJlbWFpbCI6InJ1aWJsYWVzZUBnbWFpbC5jb20iLCJleHAiOjE1NTk0MjQxMjIsIm9yaWdfaWF0IjoxNTU5NDIwNTIyfQ.kdIRkLjRc63VQvDcHECId45_8rlCr8QlAmVBcEG2tlE\"\n    w := httptest.NewRecorder()\n    req, _ := http.NewRequest(method, path, nil)\n    req.Header.Set(\"Authorization\", fmt.Sprintf(\"Bearer %v\", token))\n    r.ServeHTTP(w, req)\n\n    assert.Equal(t, w.Code, http.StatusOK)\n    return w\n}\n\nfunc TestStartRouter(t *testing.T) {\n    // Assert we encoded correctly,\n    // the request gives a 200\n    // Perform a GET request with that handler.\n    router := StartRouter()\n\n    w := performRequest(router, \"GET\", \"/\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"POST\", \"/api/v1/signin\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"POST\", \"/api/v1/signup\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"GET\", \"/user\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"GET\", \"/user/id\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"GET\", \"/customer\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n    w = performRequest(router, \"GET\", \"/customer/id\",t)\n    assert.Equal(t, http.StatusOK, w.Code)\n\n}\n</code></pre>\n\n<p>for now when I run go test, I only get code 401, but want to get HTTP response code 200.</p>\n"}, {"tags": ["go", "code-generation"], "comments": [{"owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "edited": false, "score": 0, "creation_date": 1559483171, "post_id": 56415527, "comment_id": 99427201, "body": "Can you specify which generator you are using? A code example would also be nice."}, {"owner": {"reputation": 50452, "user_id": 33258, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/c4b21ea020b4d95c4abacaffc9daaf4e?s=128&d=identicon&r=PG", "display_name": "Hugh Bothwell", "link": "https://stackoverflow.com/users/33258/hugh-bothwell"}, "edited": false, "score": 0, "creation_date": 1559484923, "post_id": 56415527, "comment_id": 99427595, "body": "If the specification ever changes, would you manually modify this file or re-generate it?"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 3, "creation_date": 1559487583, "post_id": 56415527, "comment_id": 99428220, "body": "If you want <code>go get</code> to work on your package and the generated files are required to build the Go code, then commit the generated Go files to your source code control system."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "edited": false, "score": 0, "creation_date": 1559499394, "post_id": 56415527, "comment_id": 99431155, "body": "For generated code from <code>protoc</code> etc. which is OS neutral, it&#39;s common practice to get checkin this code. A makefile is nice to easily allow someone to refresh the code, if they need to add/modify any message types."}], "answers": [{"comments": [{"owner": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "edited": false, "score": 1, "creation_date": 1559517102, "post_id": 56416079, "comment_id": 99434736, "body": "Then your package will not be compatible with <code>go get</code>."}, {"owner": {"reputation": 16221, "user_id": 340128, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0d73eeb11b1cd6de0c09746aacb41be?s=128&d=identicon&r=PG", "display_name": "Variant", "link": "https://stackoverflow.com/users/340128/variant"}, "reply_to_user": {"reputation": 620, "user_id": 1078027, "user_type": "registered", "accept_rate": 78, "profile_image": "https://www.gravatar.com/avatar/32ca0886c7e7f19b1edfcf90cb13c700?s=128&d=identicon&r=PG", "display_name": "boreq", "link": "https://stackoverflow.com/users/1078027/boreq"}, "edited": false, "score": 0, "creation_date": 1559548068, "post_id": 56416079, "comment_id": 99440987, "body": "@boreq this is indeed a context in which you should commit"}], "tags": [], "owner": {"reputation": 16221, "user_id": 340128, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b0d73eeb11b1cd6de0c09746aacb41be?s=128&d=identicon&r=PG", "display_name": "Variant", "link": "https://stackoverflow.com/users/340128/variant"}, "is_accepted": false, "score": 0, "last_activity_date": 1559486762, "creation_date": 1559486762, "answer_id": 56416079, "question_id": 56415527, "link": "https://stackoverflow.com/questions/56415527/should-a-developer-commit-go-generated-code/56416079#56416079", "title": "Should a developer commit Go generated code?", "body": "<p>That would depend on the context of the code generation.\nideally you'd want to add a <code>go generate</code> step to your CI pipeline before the test and build steps.\nIn your repo readme file you should add instructions explaining how to generate the files while developing.</p>\n\n<p>However, if the generation is something that can only be run on your development machine than you can add this to your source control.</p>\n"}, {"tags": [], "owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "is_accepted": true, "score": 5, "last_activity_date": 1559500658, "creation_date": 1559500658, "answer_id": 56417892, "question_id": 56415527, "link": "https://stackoverflow.com/questions/56415527/should-a-developer-commit-go-generated-code/56417892#56417892", "title": "Should a developer commit Go generated code?", "body": "<p>In general, yes.</p>\n\n<p>The reasoning is simple: if I'm a downstream user of your code\u2014that is, I want to merely include your library as a dependency or build your application,\u2014there is no point in creating additional burden on me for building your code; I should be able to merely <code>go build</code>/<code>go install</code> your code and call it a day.</p>\n\n<p>If, instead, I intend to actually develop <em>your</em> code\u2014either with the intent to have my changes included upstream or for maintaining these changes unpublished\u2014it's perfectly OK to require me to regenerate certain files where it is required.</p>\n"}], "owner": {"reputation": 97, "user_id": 9510521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/3d442cccf3b6689beefaef2bc0c555a3?s=128&d=identicon&r=PG&f=1", "display_name": "David", "link": "https://stackoverflow.com/users/9510521/david"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 484, "favorite_count": 0, "accepted_answer_id": 56417892, "answer_count": 2, "score": 4, "last_activity_date": 1607941747, "creation_date": 1559482420, "last_edit_date": 1607941747, "question_id": 56415527, "link": "https://stackoverflow.com/questions/56415527/should-a-developer-commit-go-generated-code", "title": "Should a developer commit Go generated code?", "body": "<p>I use a code generator plugin to generate the server stub from the OpenAPI specifications.</p>\n<p>I want to know if I should commit the generated code to version control.</p>\n"}, {"tags": ["go", "atomic"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 4, "last_activity_date": 1559492258, "last_edit_date": 1559492258, "creation_date": 1559481528, "answer_id": 56415426, "question_id": 56415324, "link": "https://stackoverflow.com/questions/56415324/go-atomic-store-followed-by-atomic-load-is-behaving-erratically-across-routines/56415426#56415426", "title": "Go atomic store followed by atomic load is behaving erratically across routines", "body": "<p>Because the <code>Set</code> method has a value receiver,  the receiver value and any changes to the value are discarded when the method returns. Fix the problem by using pointer receivers.</p>\n\n<pre><code>func (m *MapHolder) Set(myMap map[string]int64) { ... }\nfunc (m *MapHolder) Get() map[string]int64 { ... }\n</code></pre>\n\n<p>The <code>Get</code> method must also use a pointer receiver to prevent a data race on the copy of the receiver argument.</p>\n\n<p>The <code>Set</code> method stores the address of argument <code>myMap</code>, not the address of <code>m</code> in <code>main</code>.  This may or may not be a problem depending on how the application uses <code>MapHolder</code>.</p>\n"}], "owner": {"reputation": 195, "user_id": 4783551, "user_type": "registered", "accept_rate": 83, "profile_image": "https://www.gravatar.com/avatar/1d255732d9e9fe0bfa7076fd7970be1c?s=128&d=identicon&r=PG&f=1", "display_name": "Varun V", "link": "https://stackoverflow.com/users/4783551/varun-v"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 86, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1580748238, "creation_date": 1559480643, "last_edit_date": 1580748238, "question_id": 56415324, "link": "https://stackoverflow.com/questions/56415324/go-atomic-store-followed-by-atomic-load-is-behaving-erratically-across-routines", "title": "Go atomic store followed by atomic load is behaving erratically across routines", "body": "<p>I am trying to store a map as unsafe. Pointer and trying to retrieve it later. Below is the code snippet:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"sync/atomic\"\n    \"unsafe\"\n)\n\ntype MapHolder struct {\n    ptr unsafe.Pointer\n}\n\nfunc (m MapHolder) Set(myMap map[string]int64) {\n    atomic.StorePointer(&amp;m.ptr, unsafe.Pointer(&amp;myMap))\n    fmt.Printf(\"The pointer value is: %v\\n\", atomic.LoadPointer(&amp;m.ptr))\n}\n\nfunc (m MapHolder) Get() map[string]int64 {\n    ptr := atomic.LoadPointer(&amp;m.ptr)\n    if ptr == nil {\n        fmt.Printf(\"Why is this pointer value nil?\")\n        return nil\n    } else {\n        return *(*map[string]int64)(ptr)\n    }\n}\n\nfunc main() {\n    var m MapHolder\n    test := make(map[string]int64)\n    test[\"hello\"] = 1\n    m.Set(test)\n    m.Get()\n\n}\n</code></pre>\n\n<p>When <code>Set()</code>, executes, it prints the contents of <code>m.ptr</code> correctly. However, when we do a <code>Get()</code>, it returns nil. This looks totally un-expected to me. I am using go 1.11.6</p>\n\n<p>The output of the above program is:</p>\n\n<pre><code>The pointer loaded is: 0x40c130\n</code></pre>\n\n<p>Why is this pointer value nil?</p>\n"}, {"tags": ["sql-server", "go"], "comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559481187, "post_id": 56415174, "comment_id": 99426741, "body": "Check the thread here. <a href=\"https://github.com/denisenkom/go-mssqldb/issues/176\" rel=\"nofollow noreferrer\">github.com/denisenkom/go-mssqldb/issues/176</a>"}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559481353, "post_id": 56415174, "comment_id": 99426773, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/56411705/go-mssql-connection\">Go MSSQL Connection</a>"}], "answers": [{"tags": [], "owner": {"reputation": 55, "user_id": 4716174, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-CY-aWQ-kjNg/AAAAAAAAAAI/AAAAAAAAFLA/Vvg35G6x2-E/photo.jpg?sz=128", "display_name": "Burak Keskin", "link": "https://stackoverflow.com/users/4716174/burak-keskin"}, "is_accepted": false, "score": 0, "last_activity_date": 1601549473, "creation_date": 1601549473, "answer_id": 64153847, "question_id": 56415174, "link": "https://stackoverflow.com/questions/56415174/golang-unable-to-get-instances-from-sql-server-browser-on-host/64153847#64153847", "title": "Golang Unable to get instances from Sql Server Browser on host", "body": "<p>you can use <code>sqlserver://user:pass@host:1433/instance?database=dbname</code> as the DSN.</p>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8390901"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 758, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1601549473, "creation_date": 1559479462, "last_edit_date": 1580748822, "question_id": 56415174, "link": "https://stackoverflow.com/questions/56415174/golang-unable-to-get-instances-from-sql-server-browser-on-host", "title": "Golang Unable to get instances from Sql Server Browser on host", "body": "<p>I can't provide an Mssql connection. What's the problem?</p>\n\n<blockquote>\n  <p>Unable to get instances from Sql Server Browser on host DESKTOP-A:\n  read udp [8c32%vEthernet (Default Switch)]:55199->[8c32%vEthernet\n  (Default Switch)]:1434: i/o timeout</p>\n</blockquote>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package  main\n\nimport (\n    \"database/sql\"\n    \"flag\"\n    \"fmt\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n)\n\nfunc main() {\n    var (\n        userid   = flag.String(\"U\", \"loginx\", \"login_id\")\n        password = flag.String(\"P\", \"1\", \"password\")\n        server   = flag.String(\"S\", \"DESKTOP-A\\\\SQLEXPRESS\", \"server_name[\\\\instance_name]\")\n        database = flag.String(\"d\", \"test\", \"db_name\")\n    )\n    flag.Parse()\n\n    dsn := \"server=\" + *server + \";user id=\" + *userid + \";password=\" + *password + \";database=\" + *database\n    db, err := sql.Open(\"mssql\", dsn)\n    if err != nil {\n        fmt.Println(\"Cannot connect: \", err.Error())\n        return\n    }\n    err = db.Ping()\n    if err != nil {\n        fmt.Println(\"Cannot connect: \", err.Error())\n        return\n    }\n    defer db.Close()\n}\n</code></pre>\n"}, {"tags": ["go", "protocol-buffers"], "comments": [{"owner": {"reputation": 13954, "user_id": 3422652, "user_type": "registered", "accept_rate": 75, "profile_image": "https://i.stack.imgur.com/sQ3DW.jpg?s=128&g=1", "display_name": "Chris Drew", "link": "https://stackoverflow.com/users/3422652/chris-drew"}, "edited": false, "score": 0, "creation_date": 1573677017, "post_id": 56414869, "comment_id": 103963873, "body": "It is not clear to me what you are asking. A &quot;null&quot; string is not a valid protobuf. You can serialize and deserialize your <code>NullInt64</code> type to protobuf fine. Is that not sufficient?"}], "answers": [{"tags": [], "owner": {"reputation": 6761, "user_id": 664345, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/34de936228acd10be7665e5c73c53d92?s=128&d=identicon&r=PG", "display_name": "Liyan Chang", "link": "https://stackoverflow.com/users/664345/liyan-chang"}, "is_accepted": false, "score": 1, "last_activity_date": 1593709613, "creation_date": 1593709613, "answer_id": 62701581, "question_id": 56414869, "link": "https://stackoverflow.com/questions/56414869/write-custom-marshall-and-unmarshaller-for-proto-buf-type-in-golang/62701581#62701581", "title": "write custom Marshall and Unmarshaller for proto buf type in golang", "body": "<p>Protoc will not generate <code>MarshalJSON</code> and <code>UnmarshalJSON</code> functions.</p>\n<p>You can:</p>\n<ol>\n<li><p>Use a different protobuf generator (see <a href=\"https://github.com/gogo/protobuf\" rel=\"nofollow noreferrer\">gogo/protobuf</a> and it's many <a href=\"https://github.com/gogo/protobuf/blob/master/extensions.md\" rel=\"nofollow noreferrer\">extensions</a> or fork golang/protobuf to change their <a href=\"https://github.com/golang/protobuf/blob/master/protoc-gen-go/generator/generator.go\" rel=\"nofollow noreferrer\">generator</a>)</p>\n</li>\n<li><p>Insert your own functions into the <code>proto</code> package by adding a file to that folder. You can either hand-write or code gen these functions.</p>\n</li>\n</ol>\n"}], "owner": {"reputation": 455, "user_id": 8779111, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a41cec418b896f4691bfd51d1bdff464?s=128&d=identicon&r=PG&f=1", "display_name": "slifer2015", "link": "https://stackoverflow.com/users/8779111/slifer2015"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 808, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1593709613, "creation_date": 1559477322, "question_id": 56414869, "link": "https://stackoverflow.com/questions/56414869/write-custom-marshall-and-unmarshaller-for-proto-buf-type-in-golang", "title": "write custom Marshall and Unmarshaller for proto buf type in golang", "body": "<p>I have custom type that I wrote my own Marshall and Unmarshaller\nAnd the problem is I Want to do the same using protobuf</p>\n\n<p>I just want to implement the same using protobuf, so that I can implement my own Marshall and Unmarshaller</p>\n\n<pre><code>syntax=\"proto3\";\n\npackage main;\n\nmessage NullInt64{\n    bool Valid = 1;\n    int64 Int64 = 2;\n}\n</code></pre>\n\n<p>In the way that if the Valid value is false in return the <code>null</code> string</p>\n\n<pre><code>type NullInt64 struct {\n    Int64 int64\n    Valid bool\n}\n\n// MarshalJSON try to marshaling to json\nfunc (nt NullInt64) MarshalJSON() ([]byte, error) {\n    if nt.Valid {\n        return []byte(fmt.Sprintf(`%d`, nt.Int64)), nil\n    }\n\n    return []byte(\"null\"), nil\n}\n\n// UnmarshalJSON try to unmarshal dae from input\nfunc (nt *NullInt64) UnmarshalJSON(b []byte) error {\n    text := strings.ToLower(string(b))\n    if text == \"null\" {\n        nt.Valid = false\n\n        return nil\n    }\n\n    err := json.Unmarshal(b, &amp;nt.Int64)\n    if err != nil {\n        return err\n    }\n\n    nt.Valid = true\n    return nil\n}\n</code></pre>\n"}, {"tags": ["go"], "answers": [{"comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559564811, "post_id": 56414689, "comment_id": 99449197, "body": "Both files have <code>package main</code>, so they are not in <code>package app</code>."}, {"owner": {"reputation": 236, "user_id": 11003521, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5bc7e1937435e681b6646cdb67f598d6?s=128&d=identicon&r=PG&f=1", "display_name": "Kevin Z. Li", "link": "https://stackoverflow.com/users/11003521/kevin-z-li"}, "edited": false, "score": 0, "creation_date": 1559628951, "post_id": 56414689, "comment_id": 99470167, "body": "After remove import &quot;app&quot;, also need to change app.FunctionOne() to FunctionOne()."}], "tags": [], "owner": {"reputation": 4187, "user_id": 288208, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4d6e4de1d6760e455edf9e1b90d1baaa?s=128&d=identicon&r=PG", "display_name": "Rami Jarrar", "link": "https://stackoverflow.com/users/288208/rami-jarrar"}, "is_accepted": false, "score": 2, "last_activity_date": 1559635165, "last_edit_date": 1559635165, "creation_date": 1559475886, "answer_id": 56414689, "question_id": 56414579, "link": "https://stackoverflow.com/questions/56414579/two-go-files-having-package-declaration-main-inside-a-package/56414689#56414689", "title": "Two go files having package declaration main inside a package", "body": "<p>You don't have to import <code>app</code>! you're in the same package which is <code>main</code> package.</p>\n\n<p>just remove the extra import, and use <code>FunctionOne()</code> no need for <code>app</code></p>\n"}], "owner": {"reputation": 60, "user_id": 6641436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/806aecadba95a889f8cc1f4552642c65?s=128&d=identicon&r=PG&f=1", "display_name": "nitin", "link": "https://stackoverflow.com/users/6641436/nitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 43, "favorite_count": 0, "answer_count": 1, "score": -2, "last_activity_date": 1559635165, "creation_date": 1559474832, "last_edit_date": 1559478653, "question_id": 56414579, "link": "https://stackoverflow.com/questions/56414579/two-go-files-having-package-declaration-main-inside-a-package", "title": "Two go files having package declaration main inside a package", "body": "<p>So i have created a package named <code>app</code> inside which there are two go files named <code>entry.go</code> and <code>entry1.go</code> where <code>entry.go</code> is having function main while <code>entry1.go</code> is having a function which is being called by <code>entry.go</code>.</p>\n\n<p>content of <code>entry.go</code>:</p>\n\n<pre><code>package main \n\nimport \"fmt\"\nimport \"app\"\n\nfunc main(){\n    fmt.Println(\"app/entry.go\")\n    app.FunctionOne()\n}\n</code></pre>\n\n<p>content of <code>entry1.go</code>:</p>\n\n<pre><code>package main\n\nfunc FunctionOne() {\n    fmt.Println(\"this is having different name\")\n}\n</code></pre>\n\n<p>on running go build it shows import cycle</p>\n"}, {"tags": ["go", "visual-studio-code", "vscode-debugger"], "answers": [{"comments": [{"owner": {"reputation": 1004, "user_id": 220376, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ee4bd3b596f1cd8e983c5aa0af9f0b5?s=128&d=identicon&r=PG", "display_name": "Saurabh Hirani", "link": "https://stackoverflow.com/users/220376/saurabh-hirani"}, "edited": false, "score": 0, "creation_date": 1560520616, "post_id": 56593670, "comment_id": 99775252, "body": "Thanks Brian - I upgraded to vscode 1.35.1 on MacOS - but still stuck at the same issue. :("}, {"owner": {"reputation": 36, "user_id": 3843186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/832b2ef58cbb60c2c5e0121af7149e8e?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/3843186/brian"}, "reply_to_user": {"reputation": 1004, "user_id": 220376, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ee4bd3b596f1cd8e983c5aa0af9f0b5?s=128&d=identicon&r=PG", "display_name": "Saurabh Hirani", "link": "https://stackoverflow.com/users/220376/saurabh-hirani"}, "edited": false, "score": 0, "creation_date": 1560740277, "post_id": 56593670, "comment_id": 99820976, "body": "@SaurabhHirani I tried again this morning and I could get it works only if I put the breakpoint at line 12. Digged a bit deeper and think I found the problem. Updated my answer."}, {"owner": {"reputation": 1004, "user_id": 220376, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ee4bd3b596f1cd8e983c5aa0af9f0b5?s=128&d=identicon&r=PG", "display_name": "Saurabh Hirani", "link": "https://stackoverflow.com/users/220376/saurabh-hirani"}, "edited": false, "score": 0, "creation_date": 1560772257, "post_id": 56593670, "comment_id": 99833233, "body": "Thanks Brian. That helped - using build -gcflags=all=&quot;-N -l&quot; fixed the single stepping. Cheers!"}, {"owner": {"reputation": 1094, "user_id": 111148, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/ea21c8fb2c0cf7b6bfffa97c9266d173?s=128&d=identicon&r=PG&f=1", "display_name": "zuraff", "link": "https://stackoverflow.com/users/111148/zuraff"}, "edited": false, "score": 0, "creation_date": 1574691729, "post_id": 56593670, "comment_id": 104311122, "body": "Worked on Windows for me. Thanks a lot."}], "tags": [], "owner": {"reputation": 36, "user_id": 3843186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/832b2ef58cbb60c2c5e0121af7149e8e?s=128&d=identicon&r=PG&f=1", "display_name": "Brian", "link": "https://stackoverflow.com/users/3843186/brian"}, "is_accepted": true, "score": 2, "last_activity_date": 1585109624, "last_edit_date": 1585109624, "creation_date": 1560498292, "answer_id": 56593670, "question_id": 56414356, "link": "https://stackoverflow.com/questions/56414356/unable-to-get-local-variables-in-vscode-while-debugging-golang-executable/56593670#56593670", "title": "Unable to get local variables in vscode while debugging golang executable", "body": "<p><s>I could reproduce your issue initially but after I upgrade to VSCode Version 1.35.1 (I am on MacOSX), the issue is gone. I can see the variable values during debug with \"Launch exec\"</s></p>\n\n<p>I think the compiler optimisation made it problematic. Should works fine for executable built with \n<code>go build -gcflags=all=\"-N -l\"</code></p>\n\n<p><code>-N: disable optimization\n-l: disable inlining</code></p>\n\n<p>Golang officially suggested it as well: <a href=\"https://golang.org/doc/gdb\" rel=\"nofollow noreferrer\">https://golang.org/doc/gdb</a></p>\n"}], "owner": {"reputation": 1004, "user_id": 220376, "user_type": "registered", "accept_rate": 25, "profile_image": "https://www.gravatar.com/avatar/7ee4bd3b596f1cd8e983c5aa0af9f0b5?s=128&d=identicon&r=PG", "display_name": "Saurabh Hirani", "link": "https://stackoverflow.com/users/220376/saurabh-hirani"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1443, "favorite_count": 0, "accepted_answer_id": 56593670, "answer_count": 1, "score": 2, "last_activity_date": 1585109624, "creation_date": 1559472810, "question_id": 56414356, "link": "https://stackoverflow.com/questions/56414356/unable-to-get-local-variables-in-vscode-while-debugging-golang-executable", "title": "Unable to get local variables in vscode while debugging golang executable", "body": "<p>I create a sample project in Golang:</p>\n\n<pre><code>sampleapp/\nsampleapp/main.go\n</code></pre>\n\n<p>which has the following code:</p>\n\n<pre><code>package main\n\nimport (\n    \"flag\"\n    \"fmt\"\n)\n\nfunc main() {\n    var name = flag.String(\"name\", \"user1\", \"user name\")\n    var age = flag.Int(\"age\", 20, \"user age\")\n    fmt.Println(*name)\n    fmt.Println(*age)\n}\n</code></pre>\n\n<p>I followed <a href=\"https://code.visualstudio.com/docs/editor/debugging\" rel=\"nofollow noreferrer\">https://code.visualstudio.com/docs/editor/debugging</a> and created the following launch.json</p>\n\n<pre><code> {\n    \"version\": \"0.2.0\",\n    \"configurations\": [\n        {\n            \"name\": \"Launch file\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"auto\",\n            \"program\": \"${workspaceFolder}/main.go\",\n            \"env\": {},\n            \"args\": []\n        },\n        {\n            \"name\": \"Launch exec\",\n            \"type\": \"go\",\n            \"request\": \"launch\",\n            \"mode\": \"exec\",\n            \"program\": \"${workspaceFolder}/sampleapp\",\n            \"env\": {},\n            \"args\": []\n        }\n    ]\n}\n</code></pre>\n\n<p>When I use <strong>Launch File</strong> debug mode setting breakpoints on main - I am able to single step through the program and can see the values of <strong>username</strong> and <strong>age</strong> as follows:</p>\n\n<p><a href=\"https://i.stack.imgur.com/6Ux1R.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/6Ux1R.png\" alt=\"enter image description here\"></a></p>\n\n<p>But when I use <strong>Launch exec</strong> debug mode after building the app like so:</p>\n\n<pre><code>go build\n</code></pre>\n\n<p>I can single step through the code but the <strong>Local</strong> section hangs with a spinner going on continuously and doesn't show any local variables as per the following:</p>\n\n<p><a href=\"https://i.stack.imgur.com/59UIL.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/59UIL.png\" alt=\"enter image description here\"></a></p>\n\n<p>I have to do a <strong>Reload window</strong> to get rid of the hanging Local vars spinner. I checked vscode issues and saw <a href=\"https://github.com/microsoft/vscode-go/issues/2444\" rel=\"nofollow noreferrer\">https://github.com/microsoft/vscode-go/issues/2444</a> but in that case the variables are not shown when there is a panic. But in my case, I am just printing 2 variables. </p>\n\n<p>I thought it might be an issue with my <strong>dlv</strong> installation but when I debugged using <strong>dlv</strong> with the executable, I was able to get the values (deleting unnecessary lines from <strong>dlv</strong> output):</p>\n\n<pre><code>dlv exec sampleapp\nType 'help' for list of commands.\n(dlv) break main.main\nBreakpoint 1 set at 0x109e1f3 for main.main() ./main.go:8\n(dlv) s\n&gt; main.main() ./main.go:8 (hits goroutine(1):1 total:1) (PC: 0x109e1f3)\nWarning: debugging optimized function\n     3: import (\n     4:         \"flag\"\n     5:         \"fmt\"\n     6: )\n     7:\n=&gt;   8: func main() {\n     9:         var name = flag.String(\"name\", \"user1\", \"user name\")\n    10:         var age = flag.Int(\"age\", 20, \"user age\")\n    11:         fmt.Println(*name)\n    12:         fmt.Println(*age)\n    13: }\n(dlv) s\n&gt; main.main() ./main.go:9 (PC: 0x109e202)\nWarning: debugging optimized function\n     4:         \"flag\"\n     5:         \"fmt\"\n     6: )\n     7:\n     8: func main() {\n=&gt;   9:         var name = flag.String(\"name\", \"user1\", \"user name\")\n    10:         var age = flag.Int(\"age\", 20, \"user age\")\n    11:         fmt.Println(*name)\n    12:         fmt.Println(*age)\n    13: }\n(dlv) s\n&gt; main.main() ./main.go:11 (PC: 0x109e29f)\nWarning: debugging optimized function\n     6: )\n     7:\n     8: func main() {\n     9:         var name = flag.String(\"name\", \"user1\", \"user name\")\n    10:         var age = flag.Int(\"age\", 20, \"user age\")\n=&gt;  11:         fmt.Println(*name)\n    12:         fmt.Println(*age)\n    13: }\n(dlv) stepout\nuser1\n&gt; main.main() ./main.go:12 (PC: 0x109e31a)\nWarning: debugging optimized function\n     7:\n     8: func main() {\n     9:         var name = flag.String(\"name\", \"user1\", \"user name\")\n    10:         var age = flag.Int(\"age\", 20, \"user age\")\n    11:         fmt.Println(*name)\n=&gt;  12:         fmt.Println(*age)\n    13: }\n(dlv) p name\n*\"user1\"\n(dlv) p age\n*20\n</code></pre>\n\n<p>Is there something very basic that I am missing here? </p>\n"}, {"tags": ["go", "swagger", "go-swagger"], "comments": [{"owner": {"reputation": 404, "user_id": 7045032, "user_type": "registered", "accept_rate": 43, "profile_image": "https://lh3.googleusercontent.com/-5mDw63z0-Lg/AAAAAAAAAAI/AAAAAAAAAmo/scKJTPQkgSc/photo.jpg?sz=128", "display_name": "Raxit Solanki", "link": "https://stackoverflow.com/users/7045032/raxit-solanki"}, "edited": false, "score": 0, "creation_date": 1614811377, "post_id": 56413951, "comment_id": 117502513, "body": "Hi, did you solve this issue ?"}], "answers": [{"comments": [{"owner": {"reputation": 758, "user_id": 6851769, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2b122ab505e1a54a441f737629a2d766?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel", "link": "https://stackoverflow.com/users/6851769/samuel"}, "edited": false, "score": 0, "creation_date": 1559717553, "post_id": 56415218, "comment_id": 99503190, "body": "No luck with absolute path : <code>D:\\Personal\\Learning\\GoLang\\swagger&gt;C:\\Go\\bin\\swagger validate https:&#47;&#47;raw.githubusercontent.com&#47;swagger-api&#47;swagger-spec&#47;m&zwnj;&#8203;aster&#47;examples&#47;v2.0&#47;&zwnj;&#8203;json&#47;petstore-expand&zwnj;&#8203;ed.json &#39;C:\\Go\\bin\\swagger&#39; is not recognized as an internal or external command, operable program or batch file.</code> ."}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1559479788, "creation_date": 1559479788, "answer_id": 56415218, "question_id": 56413951, "link": "https://stackoverflow.com/questions/56413951/setting-up-go-swagger-for-first-time/56415218#56415218", "title": "Setting up go-swagger for first time", "body": "<p>When you install swagger or any other Go binary, the executable is on the <code>%GOBIN%</code> directory. To call the <code>swagger</code> executable you need to add the <code>%GOBIN%</code> directory to the <code>Windows Path</code> not the <code>GOPATH</code> or call it using the absolute path.</p>\n\n<pre><code>D:\\Personal\\Learning\\GoLang\\swagger&gt; C:\\Go\\bin\\swagger ./swagger.yaml\n</code></pre>\n\n<p>To add the go binaries to the path look here <a href=\"https://stackoverflow.com/a/9546345/1199408\">https://stackoverflow.com/a/9546345/1199408</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 5734, "user_id": 415628, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/84d8280499418f22f42778cc40c20a12?s=128&d=identicon&r=PG", "display_name": "Ezequiel Muns", "link": "https://stackoverflow.com/users/415628/ezequiel-muns"}, "is_accepted": false, "score": 0, "last_activity_date": 1610120970, "creation_date": 1610120970, "answer_id": 65632192, "question_id": 56413951, "link": "https://stackoverflow.com/questions/56413951/setting-up-go-swagger-for-first-time/65632192#65632192", "title": "Setting up go-swagger for first time", "body": "<p>When you do <code>go get somepackage/cmd/somecmd</code> the executable is added, not to <code>%GOBIN%</code>, but rather to <code>%GOPATH%/bin</code>.</p>\n<p>You must therefore add this directory to your path:</p>\n<pre><code>echo %GOPATH%\n// make sure you have a nonempty GOPATH\nsetx PATH %PATH%;%GOPATH%/bin\n</code></pre>\n"}], "owner": {"reputation": 758, "user_id": 6851769, "user_type": "registered", "accept_rate": 80, "profile_image": "https://www.gravatar.com/avatar/2b122ab505e1a54a441f737629a2d766?s=128&d=identicon&r=PG&f=1", "display_name": "Samuel", "link": "https://stackoverflow.com/users/6851769/samuel"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 3045, "favorite_count": 0, "answer_count": 2, "score": 3, "last_activity_date": 1610120970, "creation_date": 1559469080, "last_edit_date": 1559724458, "question_id": 56413951, "link": "https://stackoverflow.com/questions/56413951/setting-up-go-swagger-for-first-time", "title": "Setting up go-swagger for first time", "body": "<p>I am new to <code>go-lang</code> and so to <code>go-swagger</code>. I am following <a href=\"https://posener.github.io/go-swagger/\" rel=\"nofollow noreferrer\">a blog</a> and have installed <code>go-swagger</code>  with command :</p>\n\n<pre><code>go get -u github.com/go-swagger/go-swagger/cmd/swagger\n</code></pre>\n\n<p>I can see that the <code>go-swagger</code> folder is created in </p>\n\n<pre><code>C:\\Go\\bin\\src\\github.com\\go-swagger\n</code></pre>\n\n<p>Now, I added my project path to <code>$GOPATH</code> :</p>\n\n<pre><code>echo %GOPATH%\nC:\\Go\\bin;D:\\Personal\\Learning\\GoLang\\Project-2;D:\\Personal\\Learning\\GoLang\\swagger;\n</code></pre>\n\n<p>When I run </p>\n\n<pre><code>D:\\Personal\\Learning\\GoLang\\swagger&gt;swagger ./swagger.yaml\n'swagger' is not recognized as an internal or external command,\noperable program or batch file.\n</code></pre>\n\n<p>What am I missing ? Also, I would be grateful if you can suggest me some good material for <code>go-swagger</code> as I am finding it very difficult to setup everything. There arent much blogs which can help me do <code>HELLO WORLD</code> kinda setup</p>\n\n<p>Thanks</p>\n\n<blockquote>\n  <p>Update 1:</p>\n</blockquote>\n\n<p>I tried to set <code>GOBIN</code> but no luck with that:</p>\n\n<pre><code>D:\\Personal\\Learning\\GoLang\\swagger&gt;swagger validate https://raw.githubusercontent.com/swagger-api/swagger-spec/master/examples/v2.0/json/petstore-expanded.json\n'swagger' is not recognized as an internal or external command,\noperable program or batch file.\n\nD:\\Personal\\Learning\\GoLang\\swagger&gt;echo %GOBIN%\nC:\\Go\\bin\\;\n\n</code></pre>\n\n<blockquote>\n  <p>Update 2:</p>\n</blockquote>\n\n<p>I tried absolute path as suggested as well, but no luck:</p>\n\n<pre><code>D:\\Personal\\Learning\\GoLang\\swagger&gt;C:\\Go\\bin\\swagger validate https://raw.githubusercontent.com/swagger-api/swagger-spec/master/examples/v2.0/json/petstore-expanded.json\n'C:\\Go\\bin\\swagger' is not recognized as an internal or external command,\noperable program or batch file.\n</code></pre>\n\n<blockquote>\n  <p>Update 3:</p>\n</blockquote>\n\n<p>Below command worked for me but it doesn't seem to be proper way:</p>\n\n<pre><code>go run C:\\Go\\bin\\src\\github.com\\go-swagger\\go-swagger\\cmd\\swagger\\swagger.go  validate https://raw.githubusercontent.com/swagger-api/swagger-spec/master/examples/v2.0/json/petstore-expanded.json\n</code></pre>\n"}, {"tags": ["go", "graphql"], "comments": [{"owner": {"reputation": 64542, "user_id": 10008173, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/e3ea5d6d5d63e054acb8cfa95a39240d?s=128&d=identicon&r=PG&f=1", "display_name": "David Maze", "link": "https://stackoverflow.com/users/10008173/david-maze"}, "edited": false, "score": 0, "creation_date": 1559470482, "post_id": 56412849, "comment_id": 99424483, "body": "That looks like one resolver for each field in the <code>MyQuery</code> type, which happens to be the top-level query type (but otherwise is an ordinary GraphQL object type)."}], "answers": [{"comments": [{"owner": {"reputation": 351, "user_id": 10946826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ebee3f352a4b3f8d5bca9c2e4b13da?s=128&d=identicon&r=PG&f=1", "display_name": "James Larkin", "link": "https://stackoverflow.com/users/10946826/james-larkin"}, "edited": false, "score": 0, "creation_date": 1559462945, "post_id": 56413232, "comment_id": 99423106, "body": "I&#39;ll be happy with an example in any programming language (want to see the types with relations &amp; required fields). BTW is it correct that if I create a relationship between 2 types: i.e., <i>todo</i> contains <i>task</i> then I&#39;d expect a separate autogenerated resolver for a task?"}, {"owner": {"reputation": 6795, "user_id": 6124657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7495ab593769f0b51cec8aa260dec79f?s=128&d=identicon&r=PG", "display_name": "xadm", "link": "https://stackoverflow.com/users/6124657/xadm"}, "reply_to_user": {"reputation": 351, "user_id": 10946826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ebee3f352a4b3f8d5bca9c2e4b13da?s=128&d=identicon&r=PG&f=1", "display_name": "James Larkin", "link": "https://stackoverflow.com/users/10946826/james-larkin"}, "edited": false, "score": 0, "creation_date": 1559463194, "post_id": 56413232, "comment_id": 99423149, "body": "In the lib you&#39;re using ... <a href=\"https://github.com/99designs/gqlgen#how-do-i-prevent-fetching-child-objects-that-might-not-be-used\" rel=\"nofollow noreferrer\">gqlgen</a> - you have <code>friends</code> - field for relation with separate resolver"}, {"owner": {"reputation": 351, "user_id": 10946826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ebee3f352a4b3f8d5bca9c2e4b13da?s=128&d=identicon&r=PG&f=1", "display_name": "James Larkin", "link": "https://stackoverflow.com/users/10946826/james-larkin"}, "edited": false, "score": 0, "creation_date": 1559487028, "post_id": 56413232, "comment_id": 99428111, "body": "And how does it work for 2 resolvers under the hood in <code>gqlgen</code>? I.e., if there&#39;s <code>users.friends</code> field and <code>allUsers</code> query, will <code>users_resolver</code> init all fields but <code>.friends</code> and then <code>friends</code> will be resolved separately by its resolver? I don&#39;t really get the workflow since <code>allUsers</code> returns <code>[Users]</code> and we can&#39;t init <code>users.friends</code> field."}, {"owner": {"reputation": 6795, "user_id": 6124657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7495ab593769f0b51cec8aa260dec79f?s=128&d=identicon&r=PG", "display_name": "xadm", "link": "https://stackoverflow.com/users/6124657/xadm"}, "reply_to_user": {"reputation": 351, "user_id": 10946826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ebee3f352a4b3f8d5bca9c2e4b13da?s=128&d=identicon&r=PG&f=1", "display_name": "James Larkin", "link": "https://stackoverflow.com/users/10946826/james-larkin"}, "edited": false, "score": 0, "creation_date": 1559487704, "post_id": 56413232, "comment_id": 99428245, "body": "&#39;engine&#39; tries to collect required data for all fields - additional resolvers are used for each object (<code>User</code>) and each field/property (undefined at start) not resolved by type resolver (on each level, top-down) - returns null for not resolved fields (no field resolver, no matching data etc)"}], "tags": [], "owner": {"reputation": 6795, "user_id": 6124657, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/7495ab593769f0b51cec8aa260dec79f?s=128&d=identicon&r=PG", "display_name": "xadm", "link": "https://stackoverflow.com/users/6124657/xadm"}, "is_accepted": true, "score": 1, "last_activity_date": 1559462450, "creation_date": 1559462450, "answer_id": 56413232, "question_id": 56412849, "link": "https://stackoverflow.com/questions/56412849/shall-i-create-resolver-for-each-query-or-for-all-of-its-fields-in-graphql/56413232#56413232", "title": "Shall I create resolver for each query or for all of its fields in GraphQL?", "body": "<p>When entire type is backed by a resolver then it's still true that each field is backed by resolver ;)</p>\n\n<p>Comparing to SQL - usually you don't ask for each (single) field separately when you want entire record/row.</p>\n\n<p>Field level resolvers are needed when type resolver don't return data for all required (by query) fields - f.e. for relations.</p>\n"}], "owner": {"reputation": 351, "user_id": 10946826, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/55ebee3f352a4b3f8d5bca9c2e4b13da?s=128&d=identicon&r=PG&f=1", "display_name": "James Larkin", "link": "https://stackoverflow.com/users/10946826/james-larkin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 156, "favorite_count": 0, "accepted_answer_id": 56413232, "answer_count": 1, "score": 0, "last_activity_date": 1559462450, "creation_date": 1559458866, "last_edit_date": 1559459243, "question_id": 56412849, "link": "https://stackoverflow.com/questions/56412849/shall-i-create-resolver-for-each-query-or-for-all-of-its-fields-in-graphql", "title": "Shall I create resolver for each query or for all of its fields in GraphQL?", "body": "<p>I'm interested in using GraphQL and I've just started experimenting with it.</p>\n\n<p>In a GraphQL <a href=\"https://www.prisma.io/blog/graphql-server-basics-the-schema-ac5e2950214e\" rel=\"nofollow noreferrer\">tutorial</a>, one can see the following quote:</p>\n\n<blockquote>\n  <p>Each field in a GraphQL schema is backed by a resolver.</p>\n</blockquote>\n\n<p>But if you look at <a href=\"https://github.com/99designs/gqlgen\" rel=\"nofollow noreferrer\">gqlgen</a> (which is a golang library for building GraphQL servers) <a href=\"https://github.com/99designs/gqlgen/blob/master/example/todo/todo.go\" rel=\"nofollow noreferrer\">todo example</a> that uses the following schema:</p>\n\n<pre><code>...\ntype MyQuery {\n    todo(id: ID!): Todo\n    lastTodo: Todo\n    todos: [Todo!]!\n}\n\ntype MyMutation {\n    createTodo(todo: TodoInput!): Todo!\n    updateTodo(id: ID!, changes: Map!): Todo\n}\n\ntype Todo {\n    id: ID!\n    text: String!\n    done: Boolean!\n}\n...\n</code></pre>\n\n<p>it actually uses 3 autogenerated resolvers (i.e., 1 for each <em>query</em>, not a field):</p>\n\n<pre><code>func (r *QueryResolver) Todo(ctx context.Context, id int) (*Todo, error) {\nfunc (r *QueryResolver) LastTodo(ctx context.Context) (*Todo, error) {\nfunc (r *QueryResolver) Todos(ctx context.Context) ([]*Todo, error) {\n</code></pre>\n\n<p>Is it the expected behavior not to autogenerate resolvers for each field (but for each query instead)?</p>\n"}, {"tags": ["go", "microservices", "prometheus"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559465144, "post_id": 56412460, "comment_id": 99423557, "body": "Implement and register a <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#Collector\" rel=\"nofollow noreferrer\">Collector</a>. It will be called for each /metric request. See the example in the docs to get started."}, {"owner": {"reputation": 3320, "user_id": 3480808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbca64f49de22131b4b51fddfa8a7df4?s=128&d=identicon&r=PG", "display_name": "Michael Doubez", "link": "https://stackoverflow.com/users/3480808/michael-doubez"}, "edited": false, "score": 0, "creation_date": 1559473639, "post_id": 56412460, "comment_id": 99425120, "body": "You are not abusing the use cases, this is quite common (See <a href=\"https://www.robustperception.io/exposing-the-software-version-to-prometheus\" rel=\"nofollow noreferrer\">robust perception article</a> about version. About ping, it is more common to make metrics request and set a down status when you couldn&#39;t join the service. An alternative is to return an error code since it may not make sense to expose metrics if the service is not joinable and it will be reported it in the target <code>up</code> metric."}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1559479321, "post_id": 56412460, "comment_id": 99426311, "body": "Collector example seems a little complex! <a href=\"https://godoc.org/github.com/prometheus/client_golang/prometheus#Collector\" rel=\"nofollow noreferrer\">godoc.org/github.com/prometheus/client_golang/&hellip;</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "reply_to_user": {"reputation": 3320, "user_id": 3480808, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/bbca64f49de22131b4b51fddfa8a7df4?s=128&d=identicon&r=PG", "display_name": "Michael Doubez", "link": "https://stackoverflow.com/users/3480808/michael-doubez"}, "edited": false, "score": 0, "creation_date": 1559479419, "post_id": 56412460, "comment_id": 99426341, "body": "@MichaelDoubez couldn&#39;t find a simple example of returning an error code when a ping fails <a href=\"https://github.com/search?l=Go&amp;q=prometheus.NewProcessCollector+%22db.Ping%28%29%22+up&amp;type=Code\" rel=\"nofollow noreferrer\">github.com/&hellip;</a>"}, {"owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "edited": false, "score": 0, "creation_date": 1559482933, "post_id": 56412460, "comment_id": 99427146, "body": "This is where I&#39;m at <a href=\"https://play.golang.org/p/NhlVgt2oOrJ\" rel=\"nofollow noreferrer\">play.golang.org/p/NhlVgt2oOrJ</a>"}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": true, "score": 1, "last_activity_date": 1588880839, "last_edit_date": 1588880839, "creation_date": 1561032314, "answer_id": 56685615, "question_id": 56412460, "link": "https://stackoverflow.com/questions/56412460/how-to-re-evaluate-promhttp-handler-on-database-change/56685615#56685615", "title": "How to re-evaluate promhttp.Handler on database change?", "body": "<p>You could also add a middleware hook that does a <a href=\"https://medium.com/statuscode/how-i-write-go-http-services-after-seven-years-37c208122831\" rel=\"nofollow noreferrer\">preflight routine</a> (i.e. your ping test) before calling <code>promhttp.Handler()</code>. However, at collection time, I think metrics should already have been tallied; and not generated at the instance of collection. So...</p>\n\n<p>Try a separate go-routine that will poll the health of the DB connection at regular intervals. This avoids any messy hooks or custom collectors:</p>\n\n<pre><code>var pingPollingFreq = 5 * time.Second // this should probably match the Prometheus scrape interval\n\nfunc (a *App) Initialize() {       \n    // ...\n\n    prometheus.MustRegister(microservicecheck)\n\n    go func() {\n        for {\n            if a.DB.Ping() == nil {\n                microservicecheck.WithLabelValues(version).Set(1)\n            } else {\n                microservicecheck.WithLabelValues(version).Set(0)\n            }\n            time.Sleep(pingPollingFreq)\n        }\n    }()\n\n    // ...\n}\n</code></pre>\n"}], "owner": {"reputation": 8233, "user_id": 4534, "user_type": "registered", "accept_rate": 74, "profile_image": "https://www.gravatar.com/avatar/29ab3f223a10c7b19916ea38141da74d?s=128&d=identicon&r=PG", "display_name": "hendry", "link": "https://stackoverflow.com/users/4534/hendry"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 216, "favorite_count": 0, "accepted_answer_id": 56685615, "answer_count": 1, "score": 2, "last_activity_date": 1588880839, "creation_date": 1559453939, "question_id": 56412460, "link": "https://stackoverflow.com/questions/56412460/how-to-re-evaluate-promhttp-handler-on-database-change", "title": "How to re-evaluate promhttp.Handler on database change?", "body": "<p>I'm perhaps abusing <code>promhttp.Handler()</code> to realise the use case for my microservice to tell me the:</p>\n\n<ul>\n<li>version</li>\n<li>if it has database connectivity</li>\n</ul>\n\n<p>If there is a better way to monitor my microservices, do let me know!</p>\n\n<p>I'm not sure how to structure the handle in such a way that when /metrics are called, the <a href=\"https://godoc.org/database/sql#DB.Ping\" rel=\"nofollow noreferrer\">db.Ping()</a> is re-evaluated.</p>\n\n<p><a href=\"https://s.natalian.org/2019-06-02/msping.mp4\" rel=\"nofollow noreferrer\">https://s.natalian.org/2019-06-02/msping.mp4</a></p>\n\n<pre><code>package main\n\nimport (\n    \"log\"\n    \"net/http\"\n    \"os\"\n\n    _ \"github.com/go-sql-driver/mysql\"\n    \"github.com/gorilla/mux\"\n    \"github.com/jmoiron/sqlx\"\n    \"github.com/prometheus/client_golang/prometheus\"\n    \"github.com/prometheus/client_golang/prometheus/promhttp\"\n)\n\nconst version = \"0.0.1\"\n\ntype App struct {\n    Router *mux.Router\n    DB     *sqlx.DB\n}\n\nfunc main() {\n    a := App{}\n    a.Initialize()\n\n    log.Fatal(http.ListenAndServe(\":\"+os.Getenv(\"PORT\"), a.Router))\n}\n\nfunc (a *App) Initialize() {\n    connectionString := \"root:secret@tcp(localhost:3306)/rest_api_example?multiStatements=true&amp;sql_mode=TRADITIONAL&amp;timeout=5s\"\n    var err error\n    a.DB, err = sqlx.Open(\"mysql\", connectionString)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    microservicecheck := prometheus.NewGaugeVec(\n        prometheus.GaugeOpts{\n            Name: \"mscheck\",\n            Help: \"Version with DB ping check\",\n        },\n        []string{\n            \"commit\",\n        },\n    )\n\n    if a.DB.Ping() == nil {\n        microservicecheck.WithLabelValues(version).Set(1)\n    } else {\n        microservicecheck.WithLabelValues(version).Set(0)\n    }\n\n    prometheus.MustRegister(microservicecheck)\n\n    a.Router = mux.NewRouter()\n    a.initializeRoutes()\n}\n\nfunc (a *App) initializeRoutes() {\n    a.Router.Handle(\"/metrics\", promhttp.Handler()).Methods(\"GET\")\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/9DdXnz77S55\" rel=\"nofollow noreferrer\">https://play.golang.org/p/9DdXnz77S55</a></p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 0, "creation_date": 1559448296, "post_id": 56412006, "comment_id": 99421087, "body": "<code>Remove</code> doesn&#39;t return the head of the list. Despite the name, <code>head</code> is your iteration variable."}], "answers": [{"comments": [{"owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "edited": false, "score": 0, "creation_date": 1559533790, "post_id": 56412108, "comment_id": 99436960, "body": "Thanks. Why in Python I can do the same thing and it will modify the node in place?"}], "tags": [], "owner": {"reputation": 46, "user_id": 11215537, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/a01cb488bc7de7e60115c699259cb315?s=128&d=identicon&r=PG&f=1", "display_name": "Cameron", "link": "https://stackoverflow.com/users/11215537/cameron"}, "is_accepted": true, "score": 3, "last_activity_date": 1559448113, "creation_date": 1559448113, "answer_id": 56412108, "question_id": 56412006, "link": "https://stackoverflow.com/questions/56412006/removing-an-item-in-a-linked-list-with-go/56412108#56412108", "title": "Removing an item in a Linked List with Go", "body": "<p>You lose the head from returning a node you use to traverse. Also you are printing out the wrong object</p>\n\n<pre><code>type Node struct {\n    Next *Node\n    Val  int\n}\n\nfunc (n *Node) Append(val int) {\n    end := &amp;Node{Val: val}\n    here := n\n    for here.Next != nil {\n        here = here.Next\n    }\n    here.Next = end\n}\n\nfunc Remove(n *Node, val int) *Node {\n    traverser := n\n    for traverser.Next != nil {\n        if traverser.Next.Val == val {\n            traverser.Next = traverser.Next.Next\n            return n\n        }\n        traverser = traverser.Next\n    }\n    return n\n}\n\nfunc NewNode(val int) *Node {\n    return &amp;Node{Val: val}\n}\n\nfunc main() {\n    n := NewNode(1)\n    n.Append(2)\n    n.Append(3)\n    n.Append(4)\n    n.Append(5)\n\n    m := Remove(n, 3)\n\n    for m != nil {\n        fmt.Println(m.Val)\n        m = m.Next\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 1726, "user_id": 609041, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/a1c37f80358135cdd3a310aef075060e?s=128&d=identicon&r=PG", "display_name": "AAA", "link": "https://stackoverflow.com/users/609041/aaa"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 650, "favorite_count": 0, "accepted_answer_id": 56412108, "answer_count": 1, "score": 0, "last_activity_date": 1559448113, "creation_date": 1559446278, "question_id": 56412006, "link": "https://stackoverflow.com/questions/56412006/removing-an-item-in-a-linked-list-with-go", "title": "Removing an item in a Linked List with Go", "body": "<p>I want to remove a <code>Node</code> from a linked list in Go, and I have this struct and these methods:</p>\n\n<pre><code>type Node struct {\n    Next *Node\n    Val  int\n}\n\nfunc (n *Node) Append(val int) {\n    end := &amp;Node{Val: val}\n    here := n\n    for here.Next != nil {\n        here = here.Next\n    }\n    here.Next = end\n}\n\nfunc Remove(n *Node, val int) *Node {\n    head := n\n    for head.Next != nil {\n        if head.Next.Val == val {\n            head.Next = head.Next.Next\n            return head\n        }\n        head = head.Next\n    }\n    return head\n}\n\nfunc NewNode(val int) *Node {\n    return &amp;Node{Val: val}\n}\n</code></pre>\n\n<p>I want to remove an item like this:</p>\n\n<pre><code>\nn := NewNode(1)\nn.Append(2)\nn.Append(3)\nn.Append(4)\nn.Append(5)\n\nm := Remove(n, 3)\n\nfor m != nil {\n    fmt.Println(n.Val)\n    m = m.Next\n}\n\n</code></pre>\n\n<p>The items that get printed out are <code>3</code> and <code>5</code>, not <code>1,</code>2<code>,</code>4<code>and</code>5`. I re-implemented this code in Python and got the expected answer. What is going on in Go? I have a feeling it has to do something with pointers.</p>\n"}, {"tags": ["postgresql", "docker", "go", "docker-compose"], "comments": [{"owner": {"reputation": 10726, "user_id": 4956907, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1ypfs.jpg?s=128&g=1", "display_name": "michalk", "link": "https://stackoverflow.com/users/4956907/michalk"}, "edited": false, "score": 0, "creation_date": 1559455194, "post_id": 56411821, "comment_id": 99421854, "body": "Try adding password fotr superuser for your database. As documentation for <code>POSTGRES_PASSWORD</code> states <code>The PostgreSQL image sets up trust authentication locally so you may notice a password is not required when connecting from localhost (inside the same container). However, a password will be required if connecting from a different host&#47;container</code>"}], "answers": [{"comments": [{"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "edited": false, "score": 0, "creation_date": 1559534159, "post_id": 56415290, "comment_id": 99437025, "body": "Thank you so much! This works. It looks like the <code>links</code> feature is deprecated, though (<a href=\"https://docs.docker.com/compose/compose-file/#links\" rel=\"nofollow noreferrer\">docs.docker.com/compose/compose-file/#links</a>). You don&#39;t happen to know how you&#39;d set this up with the &quot;user-defined networks&quot; feature that Docker recommends, do you?"}], "tags": [], "owner": {"reputation": 394, "user_id": 9289181, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/kEJV4.jpg?s=128&g=1", "display_name": "fl9", "link": "https://stackoverflow.com/users/9289181/fl9"}, "is_accepted": false, "score": 0, "last_activity_date": 1559480380, "creation_date": 1559480380, "answer_id": 56415290, "question_id": 56411821, "link": "https://stackoverflow.com/questions/56411821/docker-compose-communication-issues-between-a-go-app-and-postgres/56415290#56415290", "title": "Docker-compose communication issues between a Go app and Postgres", "body": "<p>Your docker-compose.yml misses a link to <code>db</code>, i.e., it should look like</p>\n\n<pre><code>services:\n  api:\n    build: .\n    ports:\n      - 8080:8080\n    environment:\n      - GOPATH=/go # set up GOPATH in container to reference modules\n      - DB_USERNAME=${DB_USERNAME}  # this is `postgres`\n      - DB_PASSWORD=${DB_PASSWORD}  # this is an empty string\n    volumes:\n      - $GOPATH/pkg/mod:/go/pkg/mod\n    links:\n      - db\n\n  db:\n    image: postgres:11.3\n    ports:\n      - 5432:5432\n    volumes:\n      - ../db/postgres/data:/var/lib/postgresql/data\n</code></pre>\n"}, {"comments": [{"owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "edited": false, "score": 1, "creation_date": 1559534985, "post_id": 56416212, "comment_id": 99437168, "body": "Great! Three things from here that fixed my docker-compose.yml.  1) I didn&#39;t have a correct <code>version</code> specified, to indicate the compose file version (3.4)  2) I added the <code>depends_on</code> field in my <code>api</code> service to have it wait for <code>db</code> to start, first  3) I added an <code>expose</code> field for the <code>db</code> service exposing ports 5432, for the <code>api</code> service to access  Thank you!! :)"}], "tags": [], "owner": {"reputation": 1782, "user_id": 7247053, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/NoDc0.jpg?s=128&g=1", "display_name": "Truong Dang", "link": "https://stackoverflow.com/users/7247053/truong-dang"}, "is_accepted": true, "score": 1, "last_activity_date": 1559487748, "creation_date": 1559487748, "answer_id": 56416212, "question_id": 56411821, "link": "https://stackoverflow.com/questions/56411821/docker-compose-communication-issues-between-a-go-app-and-postgres/56416212#56416212", "title": "Docker-compose communication issues between a Go app and Postgres", "body": "<p>Take a look to my example docker-compose file (with mysql, postgres is the same way)</p>\n\n<pre><code>version: '3'\nservices:\n  application:\n    image: dangminhtruong/truyencotich:v1\n    container_name: truyencotich\n    ports:\n    - 80:8080\n    depends_on:\n    - mysql\n    volumes:\n     - .:/app\n    tty: true\n    restart: always\n    expose:\n      - 8080\n  mysql:\n    image: mysql:5.7\n    container_name: truyencotichDB\n    environment:\n      MYSQL_DATABASE: rivendell\n      MYSQL_USER: truyencotich\n      MYSQL_PASSWORD: 789852\n      MYSQL_ROOT_PASSWORD: 789852\n    volumes:\n      - ./database/exported/exported.sql:/docker-entrypoint-initdb.d/rivendell.sql\n    expose:\n    - 3306\n    ports:\n    - 3306:3306\n</code></pre>\n\n<p>And then I connect by following (we connect to mysql db by host name now is mysql container name - truyencotichDB)</p>\n\n<pre><code>package database \n\nimport (\n    \"database/sql\"\n    _ \"github.com/go-sql-driver/mysql\"\n)\n\nfunc DBConn() (db *sql.DB) {\n    dbDriver := \"mysql\"\n    dbUser := \"root\"\n    dbPass := \"789852\"\n    dbName := \"rivendell\"\n    db, err := sql.Open(dbDriver, dbUser+\":\"+dbPass+\"@tcp(truyencotichDB)/\"+dbName)\n    if err != nil {\n        panic(err.Error())\n    }\n</code></pre>\n"}], "owner": {"reputation": 131, "user_id": 10766186, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f254e3d09ba2281d78d567441c1a8fea?s=128&d=identicon&r=PG&f=1", "display_name": "N N", "link": "https://stackoverflow.com/users/10766186/n-n"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 556, "favorite_count": 0, "accepted_answer_id": 56416212, "answer_count": 2, "score": 0, "last_activity_date": 1559487748, "creation_date": 1559442882, "last_edit_date": 1559451186, "question_id": 56411821, "link": "https://stackoverflow.com/questions/56411821/docker-compose-communication-issues-between-a-go-app-and-postgres", "title": "Docker-compose communication issues between a Go app and Postgres", "body": "<p>I'm trying to set up my basic Go app to make a connection to a Postgres database. I have both being spun up as services using docker-compose. When I run <code>docker-compose up</code>, I end up getting a timeout error when the Go app tries to connect to Postgres. Something is wrong or missing that is preventing my Go app from being able to make a connection to Postgres.</p>\n\n<p>docker-compose.yml</p>\n\n<pre><code>services:\n  api:\n    build: .\n    ports:\n      - 8080:8080\n    environment:\n      - GOPATH=/go # set up GOPATH in container to reference modules\n      - DB_USERNAME=${DB_USERNAME}  # this is `postgres`\n      - DB_PASSWORD=${DB_PASSWORD}  # this is an empty string\n    volumes:\n      - $GOPATH/pkg/mod:/go/pkg/mod\n\n  db:\n    image: postgres:11.3\n    ports:\n      - 5432:5432\n    volumes:\n      - ../db/postgres/data:/var/lib/postgresql/data\n</code></pre>\n\n<p>main.go</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>import (\n    \"database/sql\"\n    \"log\"\n\n    \"github.com/lib/pq\"\n)\n\nfunc main() {\n    dbConn, err := sql.Open(\"postgres\", \"sslmode=disable host=db port=5432 user=postgres dbname=postgres connect_timeout=30\")\n    if err != nil {\n        log.Fatalf(\"error defining connection to database: %v\", err)\n    }\n    defer func() { _ = dbConn.Close() }()\n\n    // This forces the connection to be created\n    err = dbConn.Ping()\n    if err != nil {\n        log.Fatalf(\"error opening connection to database: %v\", err)\n    }\n    log.Println(\"Never get here because we timeout...\")\n}\n</code></pre>\n\n<p>I expect to make the connection and get to the end of <code>main.go</code>. Instead, I get the following error: <code>error opening connection to database: dial tcp &lt;container-ip&gt;:5432: i/o timeout</code></p>\n\n<p>I've tried starting the Postgres container first (<code>docker-compose up db</code>), to make sure it was ready, then spinning up my Go app (<code>docker-compose up api</code>). Same error.</p>\n\n<p>I've logged into the Postgres container and connected to Postgres by using the connection string, manually: <code>psql \"sslmode=disable host=localhost port=5432 user=postgres dbname=postgres connect_timeout=30\"</code> (notice that only the <code>host</code> field changed from <code>db</code> to <code>localhost</code>, as compared to the connection string used in the <code>main.go</code> code, above). This works, so the connection string is fine.</p>\n\n<p>When logged in to the Postgres container, I've verified that there is a database named <code>postgres</code> that I use in the <code>dbname</code> field in the connection string:</p>\n\n<pre class=\"lang-sh prettyprint-override\"><code>postgres=# \\l\n                                 List of databases\n   Name    |  Owner   | Encoding |  Collate   |   Ctype    |   Access privileges   \n-----------+----------+----------+------------+------------+-----------------------\n postgres  | postgres | UTF8     | en_US.utf8 | en_US.utf8 | \n template0 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +\n           |          |          |            |            | postgres=CTc/postgres\n template1 | postgres | UTF8     | en_US.utf8 | en_US.utf8 | =c/postgres          +\n           |          |          |            |            | postgres=CTc/postgres\n(3 rows)\n</code></pre>\n\n<p>I've also tried making my own database and using that in my connection string.</p>\n\n<p>In the <code>main.go</code> code, above, I've also tried switching the <code>sql.Open</code> line out for the alternative approach:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>c, err := pq.NewConnector(\"sslmode=disable host=db port=5432 user=postgres dbname=postgres connect_timeout=30\")\ndbConn = sql.OpenDB(c)\n</code></pre>\n\n<p>If I run my app with <code>go run main.go</code> (not running in a container) and make sure to switch the <code>host</code> to <code>localhost</code> in the Postgres connection string, it works fine. So, it's something to do with the communication between my app's container and the Postgres container.</p>\n"}, {"tags": ["sql-server", "go", "goland"], "answers": [{"comments": [{"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559441798, "post_id": 56411732, "comment_id": 99420458, "body": "Please make sure you used <code>db</code> unplaced of <code>conn</code> as updated in solution."}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559442101, "post_id": 56411732, "comment_id": 99420491, "body": "@Corbas save this <a href=\"https://pastebin.com/tyiKz2U6\" rel=\"nofollow noreferrer\">pastebin.com/tyiKz2U6</a> and try run <code>go run connect.go</code> what is the output?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8390901"}, "edited": false, "score": 0, "creation_date": 1559475434, "post_id": 56411732, "comment_id": 99425491, "body": "Still same: Error pinging database: Unable to get instances from Sql Server Browser on host DESKTOP: read udp"}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559480641, "post_id": 56411732, "comment_id": 99426604, "body": "It mean, you mssql instance is not open to accept connect. Please check with server administrator. At least your connect issue has resolved :)"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8390901"}, "edited": false, "score": 0, "creation_date": 1559480796, "post_id": 56411732, "comment_id": 99426636, "body": "I try local connection.I can connect with c# or another one."}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559480886, "post_id": 56411732, "comment_id": 99426655, "body": "Desktop is your computer name?"}, {"owner": {"user_type": "does_not_exist", "display_name": "user8390901"}, "edited": false, "score": 0, "creation_date": 1559480973, "post_id": 56411732, "comment_id": 99426686, "body": "Yes my computer name is Desktop :)"}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559481110, "post_id": 56411732, "comment_id": 99426716, "body": "In Win 10, note that to let ip connect to DB works, you need to enable TCP/IP in SQL Server Configuration Manager (see this link) , in the Service set the SQL Server Browser Stratup type to Automatic (see this link), and configure Database Engine Access in Windows Firewall."}, {"owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "edited": false, "score": 0, "creation_date": 1559481148, "post_id": 56411732, "comment_id": 99426728, "body": "Check the thread here <a href=\"https://github.com/denisenkom/go-mssqldb/issues/176\" rel=\"nofollow noreferrer\">github.com/denisenkom/go-mssqldb/issues/176</a>"}, {"owner": {"reputation": 42799, "user_id": 720999, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/04ee78e90161fa1c4dce14d615315160?s=128&d=identicon&r=PG", "display_name": "kostix", "link": "https://stackoverflow.com/users/720999/kostix"}, "edited": false, "score": 0, "creation_date": 1559489214, "post_id": 56411732, "comment_id": 99428569, "body": "May be &quot;the problem&quot; is that <code>database&#47;sql.DB.Open()</code> is not defined to <i>actually establish a connection,</i> and this is only done on the first real use of that connection? I&#39;d suggest reading through <a href=\"http://go-database-sql.org\" rel=\"nofollow noreferrer\">this tutorial</a> \u2014 in particular, <a href=\"http://go-database-sql.org/accessing.html\" rel=\"nofollow noreferrer\">this part of it</a>."}], "tags": [], "owner": {"reputation": 2867, "user_id": 2867881, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/61Npk.jpg?s=128&g=1", "display_name": "Vikash Pathak", "link": "https://stackoverflow.com/users/2867881/vikash-pathak"}, "is_accepted": false, "score": 1, "last_activity_date": 1559441257, "creation_date": 1559441257, "answer_id": 56411732, "question_id": 56411705, "link": "https://stackoverflow.com/questions/56411705/go-mssql-connection/56411732#56411732", "title": "Go MSSQL Connection", "body": "<p><code>mssql</code> in Open() should be <code>sqlserver</code></p>\n\n<p>Try change this.</p>\n\n<p><code>db, err = sql.Open(\"sqlserver\", connString)</code></p>\n\n<p>So your main() would look like..</p>\n\n<pre><code>var db *sql.DB\n\nfunc main() {\n    var err error\n\n    // Create connection string\n    connString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d\",\n        server, user, password, port)\n\n    // Create connection pool\n    db, err = sql.Open(\"sqlserver\", connString)\n    if err != nil {\n        log.Fatal(\"Error creating connection pool: \" + err.Error())\n    }\n    log.Printf(\"Connected!\\n\")\n\n    // Close the database connection pool after program executes\n    defer db.Close()\n}\n\n</code></pre>\n"}], "owner": {"user_type": "does_not_exist", "display_name": "user8390901"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 354, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559441556, "creation_date": 1559440692, "last_edit_date": 1559441446, "question_id": 56411705, "link": "https://stackoverflow.com/questions/56411705/go-mssql-connection", "title": "Go MSSQL Connection", "body": "<p>How do I provide an MSSQL connection? It says it's always connected with the code. Even if the information is incorrect, it does not give errors.</p>\n\n<pre><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    _ \"github.com/denisenkom/go-mssqldb\"\n    \"log\"\n)\n\nvar server = \"DESKTOP\\\\SQLEXPRESS\"\nvar port = 1433\nvar user = \"loginx\"\nvar password = \"1\"\nvar database = \"test\"\n\nvar db *sql.DB\n\nfunc main() {\n    var err error\n\n    connString := fmt.Sprintf(\"server=%s;user id=%s;password=%s;port=%d;database=%s;\",\n        server, user, password, port, database)\n    fmt.Println(server, user, password, database)\n    conn, err := sql.Open(\"mssql\", connString)\n    if err != nil {\n        log.Fatal(\"Open connection failed:\", err.Error())\n    }\n    fmt.Printf(\"Connected!\\n\")\n    defer conn.Close()\n\n}\n\n</code></pre>\n"}, {"tags": ["go", "go-gin"], "comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559505223, "post_id": 56410895, "comment_id": 99432614, "body": "What have you tried? Include your code. What problems did you encounter?"}], "answers": [{"comments": [{"owner": {"reputation": 226, "user_id": 5131438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XViWv8_F13Q/AAAAAAAAAAI/AAAAAAAAEsI/7at09k4TT1c/photo.jpg?sz=128", "display_name": "mousi", "link": "https://stackoverflow.com/users/5131438/mousi"}, "edited": false, "score": 0, "creation_date": 1559468550, "post_id": 56411381, "comment_id": 99424149, "body": "This means that I have to save the resized file to the disk first (and in extend take care of deleting it after I send the response). It&#39;s not a big deal of course, I could do that so thank you for the code, I might end up doing it this way"}, {"owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "reply_to_user": {"reputation": 226, "user_id": 5131438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XViWv8_F13Q/AAAAAAAAAAI/AAAAAAAAEsI/7at09k4TT1c/photo.jpg?sz=128", "display_name": "mousi", "link": "https://stackoverflow.com/users/5131438/mousi"}, "edited": false, "score": 1, "creation_date": 1559469517, "post_id": 56411381, "comment_id": 99424291, "body": "No, my example provided exactly the opposite, it generates a []byte, which you can use in your response."}, {"owner": {"reputation": 226, "user_id": 5131438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XViWv8_F13Q/AAAAAAAAAAI/AAAAAAAAEsI/7at09k4TT1c/photo.jpg?sz=128", "display_name": "mousi", "link": "https://stackoverflow.com/users/5131438/mousi"}, "edited": false, "score": 0, "creation_date": 1559476173, "post_id": 56411381, "comment_id": 99425656, "body": "Oh you&#39;re right, my bad. I didn&#39;t think about that. Marked as answer as this is exactly what I wanted, thank you"}, {"owner": {"reputation": 118, "user_id": 12987677, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/a-/AOh14GjVNfybeeaXbaVyqVjb8kIcDY4imCwNeXFV_g6D=k-s128", "display_name": "Mohit Yadav", "link": "https://stackoverflow.com/users/12987677/mohit-yadav"}, "edited": false, "score": 0, "creation_date": 1598455959, "post_id": 56411381, "comment_id": 112466603, "body": "i get a warning that ZP is depreciated."}], "tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": true, "score": 2, "last_activity_date": 1559472820, "last_edit_date": 1559472820, "creation_date": 1559435552, "answer_id": 56411381, "question_id": 56410895, "link": "https://stackoverflow.com/questions/56410895/resize-image-before-sending/56411381#56411381", "title": "Resize image before sending", "body": "<p>Yes, you can just resize it using built in package <a href=\"https://godoc.org/image\" rel=\"nofollow noreferrer\">\"image\"</a>, i just built it for you, with different resize options and bytes / pure image output, pick what you want. I didnt use this particular package in the past, so any correction / recommendation for this pice of code is welcome. code:</p>\n\n<pre><code>package main\n\nimport (\n    \"bytes\"\n    \"image\"\n    \"image/color\"\n    \"image/draw\"\n    \"image/jpeg\"\n    \"io/ioutil\"\n    \"log\"\n    \"math\"\n    \"os\"\n)\n\nfunc main() {\n    f, err := os.Open(\"resources/image.jpg\")\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    //encoding message is discarded, because OP wanted only jpg, else use encoding in resize function\n    img, _, err := image.Decode(f)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    //this is the resized image\n    resImg := resize(img, 20, 20)\n\n    //this is the resized image []bytes\n    imgBytes := imgToBytes(resImg)\n\n    //optional written to file\n    err = ioutil.WriteFile(\"resources/test.jpg\", imgBytes, 0777)\n    if err != nil {\n        log.Fatal(err)\n    }\n}\n\nfunc resize(img image.Image, length int, width int) image.Image {\n    //truncate pixel size\n    minX := img.Bounds().Min.X\n    minY := img.Bounds().Min.Y\n    maxX := img.Bounds().Max.X\n    maxY := img.Bounds().Max.Y\n    for (maxX-minX)%length != 0 {\n        maxX--\n    }\n    for (maxY-minY)%width!= 0 {\n        maxY--\n    }\n    scaleX := (maxX - minX) / length\n    scaleY := (maxY - minY) / width\n\n    imgRect := image.Rect(0, 0, length, width)\n    resImg := image.NewRGBA(imgRect)\n    draw.Draw(resImg, resImg.Bounds(), &amp;image.Uniform{C: color.White}, image.ZP, draw.Src)\n    for y := 0; y &lt; width; y += 1 {\n        for x := 0; x &lt; length; x += 1 {\n            averageColor := getAverageColor(img, minX+x*scaleX, minX+(x+1)*scaleX, minY+y*scaleY, minY+(y+1)*scaleY)\n            resImg.Set(x, y, averageColor)\n        }\n    }\n    return resImg\n}\n\nfunc getAverageColor(img image.Image, minX int, maxX int, minY int, maxY int) color.Color {\n    var averageRed float64\n    var averageGreen float64\n    var averageBlue float64\n    var averageAlpha float64\n    scale := 1.0 / float64((maxX-minX)*(maxY-minY))\n\n    for i := minX; i &lt; maxX; i++ {\n        for k := minY; k &lt; maxY; k++ {\n            r, g, b, a := img.At(i, k).RGBA()\n            averageRed += float64(r) * scale\n            averageGreen += float64(g) * scale\n            averageBlue += float64(b) * scale\n            averageAlpha += float64(a) * scale\n        }\n    }\n\n    averageRed = math.Sqrt(averageRed)\n    averageGreen = math.Sqrt(averageGreen)\n    averageBlue = math.Sqrt(averageBlue)\n    averageAlpha = math.Sqrt(averageAlpha)\n\n    averageColor := color.RGBA{\n        R: uint8(averageRed),\n        G: uint8(averageGreen),\n        B: uint8(averageBlue),\n        A: uint8(averageAlpha)}\n\n    return averageColor\n}\n\nfunc imgToBytes(img image.Image) []byte {\n    var opt jpeg.Options\n    opt.Quality = 80\n\n    buff := bytes.NewBuffer(nil)\n    err := jpeg.Encode(buff, img, &amp;opt)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    return buff.Bytes()\n}\n\n\n</code></pre>\n"}], "owner": {"reputation": 226, "user_id": 5131438, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-XViWv8_F13Q/AAAAAAAAAAI/AAAAAAAAEsI/7at09k4TT1c/photo.jpg?sz=128", "display_name": "mousi", "link": "https://stackoverflow.com/users/5131438/mousi"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 887, "favorite_count": 0, "accepted_answer_id": 56411381, "answer_count": 1, "score": -1, "last_activity_date": 1597031223, "creation_date": 1559428222, "last_edit_date": 1597031223, "question_id": 56410895, "link": "https://stackoverflow.com/questions/56410895/resize-image-before-sending", "title": "Resize image before sending", "body": "<p>I want to have a route with gin that will send an image (jpeg) as the response but instead of sending the original image that's saved to disk I would like to resize it first (to thumbnail size).</p>\n<p>So far I can send images using <code>c.File(filepath string)</code> but that doesn't allow me to resize the image. Is there any way to do that without having to create a new file on the disk?</p>\n"}, {"tags": ["go"], "answers": [{"tags": [], "owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "is_accepted": false, "score": 8, "last_activity_date": 1559420451, "last_edit_date": 1559420451, "creation_date": 1559419272, "answer_id": 56410029, "question_id": 56409856, "link": "https://stackoverflow.com/questions/56409856/will-go-get-command-update-the-package-in-my-local-machine/56410029#56410029", "title": "Will go get command update the package in my local machine", "body": "<p>The <code>go get &lt;Import path of package&gt;</code> command will not update the local copy if there is already a local copy installed.</p>\n\n<p>The <a href=\"https://golang.org/cmd/go/#hdr-Download_and_install_packages_and_dependencies\" rel=\"noreferrer\"><code>go get</code> documentation</a> says:</p>\n\n<blockquote>\n  <p>The -u flag instructs get to use the network to update the named packages and their dependencies. By default, get uses the network to check out missing packages but does not use it to look for updates to existing packages.</p>\n</blockquote>\n\n<p>Run <code>go get -u &lt;Import path of package&gt;</code> to get or update the local copy.</p>\n"}, {"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": false, "score": 0, "last_activity_date": 1559419318, "creation_date": 1559419318, "answer_id": 56410036, "question_id": 56409856, "link": "https://stackoverflow.com/questions/56409856/will-go-get-command-update-the-package-in-my-local-machine/56410036#56410036", "title": "Will go get command update the package in my local machine", "body": "<p>No. According to the <code>go get</code> documentation it will not. If you want to update a local package you have to use the <code>-u</code> flag.</p>\n\n<pre><code>$ go help get\n\n......\nThe -u flag instructs get to use the network to update the named packages\nand their dependencies. By default, get uses the network to check out\nmissing packages but does not use it to look for updates to existing packages.\n</code></pre>\n\n<p>Things change a bit if you use Go modules. Then the <code>go.mod</code> file is consulted, but by default it won't fetch the latest version automatically unless you tell it too. For this new behaviour please take a deeper look at the official docs <a href=\"https://github.com/golang/go/wiki/Modules#daily-workflow\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/Modules#daily-workflow</a>.</p>\n"}], "owner": {"reputation": 60, "user_id": 6641436, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/806aecadba95a889f8cc1f4552642c65?s=128&d=identicon&r=PG&f=1", "display_name": "nitin", "link": "https://stackoverflow.com/users/6641436/nitin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1701, "favorite_count": 0, "answer_count": 2, "score": 1, "last_activity_date": 1559420451, "creation_date": 1559417782, "last_edit_date": 1559418889, "question_id": 56409856, "link": "https://stackoverflow.com/questions/56409856/will-go-get-command-update-the-package-in-my-local-machine", "title": "Will go get command update the package in my local machine", "body": "<p>Suppose I download a package using <code>go get &lt;Import path of package&gt;</code>. Now after x number of days that package has been updated remotely and now if I run again <code>go get &lt;Import path of package&gt;</code> will it be updated on my local too?</p>\n"}, {"tags": ["go", "go-modules"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1559406823, "post_id": 56408476, "comment_id": 99414240, "body": "What command are you using? Specifying master will get master, though the synthetic version generated in go.mod may appear to reference an older tag. Just check the commit hash itself."}, {"owner": {"reputation": 355, "user_id": 8177720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MaB7WPKxe98/AAAAAAAAAAI/AAAAAAAAAbM/sqkLZT9ecng/photo.jpg?sz=128", "display_name": "Adib Rastegarnia", "link": "https://stackoverflow.com/users/8177720/adib-rastegarnia"}, "reply_to_user": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1559410003, "post_id": 56408476, "comment_id": 99415074, "body": "It looks like go modules retrieve an old tag for one of the deps in my project. I used go get to get the master branch and go.mod files gets updated automatically."}, {"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 0, "creation_date": 1559415288, "post_id": 56408476, "comment_id": 99416275, "body": "What was the exact command? If you want master, did you specify that in the command?"}], "answers": [{"comments": [{"owner": {"reputation": 1277, "user_id": 543426, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/MaTJe.jpg?s=128&g=1", "display_name": "4F2E4A2E", "link": "https://stackoverflow.com/users/543426/4f2e4a2e"}, "edited": false, "score": 0, "creation_date": 1604989162, "post_id": 56410071, "comment_id": 114508285, "body": "branches are not working in go v1.15.3: <a href=\"https://github.com/golang/go/issues/37438\" rel=\"nofollow noreferrer\">github.com/golang/go/issues/37438</a>"}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 8, "last_activity_date": 1559419629, "creation_date": 1559419629, "answer_id": 56410071, "question_id": 56408476, "link": "https://stackoverflow.com/questions/56408476/how-can-i-get-master-branch-of-a-dependency-when-using-go-modules/56410071#56410071", "title": "How can I get master branch of a dependency when using Go modules", "body": "<p>Use:</p>\n\n<pre><code>go get foo@master\n</code></pre>\n\n<pre><code>go get foo@v1.2.3    //for v1.2.3 tag\ngo get foo@master    // for master\ngo get foo@e3702bed2 // for a specific commit\n</code></pre>\n\n<p>There are some more details about versioning here:</p>\n\n<p><a href=\"https://github.com/golang/go/wiki/Modules#daily-workflow\" rel=\"noreferrer\">https://github.com/golang/go/wiki/Modules#daily-workflow</a></p>\n"}], "owner": {"reputation": 355, "user_id": 8177720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-MaB7WPKxe98/AAAAAAAAAAI/AAAAAAAAAbM/sqkLZT9ecng/photo.jpg?sz=128", "display_name": "Adib Rastegarnia", "link": "https://stackoverflow.com/users/8177720/adib-rastegarnia"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3920, "favorite_count": 0, "accepted_answer_id": 56410071, "answer_count": 1, "score": -1, "last_activity_date": 1559419629, "creation_date": 1559406402, "question_id": 56408476, "link": "https://stackoverflow.com/questions/56408476/how-can-i-get-master-branch-of-a-dependency-when-using-go-modules", "title": "How can I get master branch of a dependency when using Go modules", "body": "<p>I am using Go-modules for a project. When I retrieve the dependency for a package, it retrieves an old release. How can I get the code in the master branch?</p>\n"}, {"tags": ["go", "time", "timestamp"], "comments": [{"owner": {"reputation": 3728, "user_id": 152043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d7fe904771aa932cb3ab37553916c45?s=128&d=identicon&r=PG", "display_name": "Michael Speer", "link": "https://stackoverflow.com/users/152043/michael-speer"}, "edited": false, "score": 3, "creation_date": 1559385106, "post_id": 56405879, "comment_id": 99409348, "body": "<a href=\"https://golang.org/pkg/time/#Parse\" rel=\"nofollow noreferrer\">golang.org/pkg/time/#Parse</a> - what have you tried?"}, {"owner": {"reputation": 23, "user_id": 8271547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6411657cf5500e34bea18d3106591ca2?s=128&d=identicon&r=PG&f=1", "display_name": "SadDeveloper", "link": "https://stackoverflow.com/users/8271547/saddeveloper"}, "reply_to_user": {"reputation": 3728, "user_id": 152043, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5d7fe904771aa932cb3ab37553916c45?s=128&d=identicon&r=PG", "display_name": "Michael Speer", "link": "https://stackoverflow.com/users/152043/michael-speer"}, "edited": false, "score": 0, "creation_date": 1559385148, "post_id": 56405879, "comment_id": 99409358, "body": "I recieved from another service this timestamp, but I can&#39;t parse it"}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 3, "creation_date": 1559390889, "post_id": 56405879, "comment_id": 99410475, "body": "That doesn&#39;t answer the question. What have you tried? You must include the code you need help debugging."}], "answers": [{"tags": [], "owner": {"reputation": 11296, "user_id": 1931641, "user_type": "registered", "accept_rate": 67, "profile_image": "https://www.gravatar.com/avatar/d97ff8806b1550dfde5f6c9f09af6f92?s=128&d=identicon&r=PG", "display_name": "PassKit", "link": "https://stackoverflow.com/users/1931641/passkit"}, "is_accepted": true, "score": 2, "last_activity_date": 1559386015, "last_edit_date": 1559386015, "creation_date": 1559385777, "answer_id": 56405980, "question_id": 56405879, "link": "https://stackoverflow.com/questions/56405879/how-to-parse-this-date-2018-10-22t2250/56405980#56405980", "title": "How to parse this date 2018-10-22T2250?", "body": "<p>You can create your own custom format.  In production, you should also handle the error.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"time\"\n)\n\nfunc main() {\n    timeString := \"2018-10-22T2250\"\n    timeFormat := \"2006-01-02T1504\"\n\n    t, _ := time.Parse(timeFormat, timeString)\n\n    fmt.Println(t)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/iOsO2VlhBoW\" rel=\"nofollow noreferrer\">Playground link</a></p>\n\n<p>This returns the time in UTC.  You may need to adjust to another timezone, depending on your source.</p>\n\n<pre><code>//init the location\nloc, _ := time.LoadLocation(\"Asia/Shanghai\")\n//localize the time\nlocalTime := t.In(loc)\n</code></pre>\n"}], "owner": {"reputation": 23, "user_id": 8271547, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/6411657cf5500e34bea18d3106591ca2?s=128&d=identicon&r=PG&f=1", "display_name": "SadDeveloper", "link": "https://stackoverflow.com/users/8271547/saddeveloper"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 79, "favorite_count": 0, "accepted_answer_id": 56405980, "answer_count": 1, "score": -3, "last_activity_date": 1559388764, "creation_date": 1559384898, "question_id": 56405879, "link": "https://stackoverflow.com/questions/56405879/how-to-parse-this-date-2018-10-22t2250", "title": "How to parse this date 2018-10-22T2250?", "body": "<p>How to parse this strange datetime 2018-10-22T2250 in golang?\nI couldn't find date layout</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 0, "creation_date": 1559398232, "post_id": 56405281, "comment_id": 99412137, "body": "There is a lot of important stuff missing in that code snippet. Is this using the standard <code>net&#47;http</code> package? Where is <code>worker(jobs)</code> getting called? What is the purpose of the <code>WaitGroup</code> on <code>GlobalVars</code>?"}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "reply_to_user": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 0, "creation_date": 1559447718, "post_id": 56405281, "comment_id": 99421028, "body": "using std net/http yes - worker is started in main, waitgroup in globalvars isnt used - can post full source if its needed ?"}, {"owner": {"reputation": 18763, "user_id": 472495, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/4rtxd.png?s=128&g=1", "display_name": "halfer", "link": "https://stackoverflow.com/users/472495/halfer"}, "edited": false, "score": 0, "creation_date": 1576572564, "post_id": 56405281, "comment_id": 104933867, "body": "There were around twenty spelling mistakes in this post alone. Please install an English spelling checker prior to writing more material. The main errors are the personal pronoun &quot;I&quot; - this is always written in upper case. Also, the contractions are don&#39;t, won&#39;t, can&#39;t, doesn&#39;t, wasn&#39;t etc - the apostrophe serves to show there is a missing &quot;o&quot; in the word &quot;not&quot;. If this is missing, it is a misspelling, which makes it harder to read."}], "answers": [{"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559447825, "post_id": 56408766, "comment_id": 99421040, "body": "But that will still block httpServe and cause delays for all incoming apis ?"}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559468070, "post_id": 56408766, "comment_id": 99424079, "body": "would you be able to help me write the modified code in the way you would suggest it should be ?"}, {"owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "reply_to_user": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559486743, "post_id": 56408766, "comment_id": 99428047, "body": "Actually it should work without blocking if you use standard http lib. Also it is possible to get blocked if channel is full and cannot store more data (when the channel size is 3 and you have already pushed 3 items in it and still trying to put 4th one)."}], "tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 1, "last_activity_date": 1559408753, "creation_date": 1559408753, "answer_id": 56408766, "question_id": 56405281, "link": "https://stackoverflow.com/questions/56405281/print-spooler-concept-api-channels-issue-passing-jobs-to-a-queue-from-serve/56408766#56408766", "title": "Print spooler concept / API &amp; Channels: issue passing jobs to a queue from serveHTTP", "body": "<p><code>select</code> statement should be outside the goroutine function and blocks request till the end of the job execution or reaching timeout. </p>\n"}, {"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559461675, "post_id": 56412453, "comment_id": 99422862, "body": "i have added my main to the post - i just use standard net/http - but it does seem to be blocking is that correct ? i thought it were calling it as a go routine but if i launch ex 20 simultanous connections to it the they are getting much much longer reply times than max 5 seconds"}, {"owner": {"reputation": 170, "user_id": 8819631, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8kvBO.jpg?s=128&g=1", "display_name": "Avinash Dhinwa", "link": "https://stackoverflow.com/users/8819631/avinash-dhinwa"}, "reply_to_user": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559466164, "post_id": 56412453, "comment_id": 99423717, "body": "@MdTp, can you please look at the answer again. I have updated it to accommodate your question."}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559467692, "post_id": 56412453, "comment_id": 99424017, "body": "but &quot;you should call serveHTTP as a go routine&quot; - its the system that calls it when clients connects, i dont call it actively ? reading up on it says net/http launch it already as a go routine but for some reason it doesnt look like they run parallel - ex the first one times out after 5 seconds but ex connection no 20 will make take ex 30 seconds before it times out ( all of them should time out after max 5 seconds )"}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559467745, "post_id": 56412453, "comment_id": 99424025, "body": "and the reason why the singlejob channel is blocked is because i need to know if the worker get hold of it in time and processes the job, if its not blocking then i dont have the intercomm between serveHTTP and worker"}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "reply_to_user": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559519927, "post_id": 56412453, "comment_id": 99435093, "body": "@MdTp Yes, you do. You know from <code>doneChan</code> whether the worker processed the job or not."}, {"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "reply_to_user": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 0, "creation_date": 1559552209, "post_id": 56412453, "comment_id": 99442776, "body": "thanks @kbolino - bogdan&#39;s correction mocing the waiting outside the func ( which makes sense now ) made it all work - thanks for your help"}], "tags": [], "owner": {"reputation": 170, "user_id": 8819631, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/8kvBO.jpg?s=128&g=1", "display_name": "Avinash Dhinwa", "link": "https://stackoverflow.com/users/8819631/avinash-dhinwa"}, "is_accepted": false, "score": 2, "last_activity_date": 1559466109, "last_edit_date": 1559466109, "creation_date": 1559453826, "answer_id": 56412453, "question_id": 56405281, "link": "https://stackoverflow.com/questions/56405281/print-spooler-concept-api-channels-issue-passing-jobs-to-a-queue-from-serve/56412453#56412453", "title": "Print spooler concept / API &amp; Channels: issue passing jobs to a queue from serveHTTP", "body": "<p>Yes, you are right with your point <strong>\"c) if i don't block it ex\"</strong>.</p>\n\n<p>In order to save the response writer, you shouldn't call a go routine inside it. Rather you should call <strong>ServeHTTP</strong> as a go-routine, which most of the http server implementations do. <br>\nThis way you won't be blocking any api calls, each api call will run in a different go-routine, blocked by their functionalities.</p>\n\n<p>Since your <strong>\"jobs chan QueueElement\"</strong> is a single channel (not a buffered channel), so all your processes get blocked at <strong>\"gv.jobs &lt;- newPrintJob\"</strong>.<br>\nYou should rather use a buffered channel so that all api calls can add it to the queue and get response depending on work completion or time out. <br><br>\nHaving a buffered channel simulates the real world memory limit of printers too. (queue length 1 being a special case)</p>\n"}, {"comments": [{"owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "edited": false, "score": 0, "creation_date": 1559491730, "post_id": 56416170, "comment_id": 99429240, "body": "amazing bogdan ! it seems to work ! god ive spent time on this one :/ so what i did wrong was that i launched a function where i had the waiting inside of it ?"}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 0, "creation_date": 1559518642, "post_id": 56416170, "comment_id": 99434955, "body": "This isn&#39;t using a queue. It won&#39;t have FIFO behavior; if 2 or more jobs are submitted while one is currently running, they will be handled in random order."}, {"owner": {"reputation": 1027, "user_id": 814422, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/ad082805d1ce2e3766886195c720fca6?s=128&d=identicon&r=PG", "display_name": "kbolino", "link": "https://stackoverflow.com/users/814422/kbolino"}, "edited": false, "score": 0, "creation_date": 1559520873, "post_id": 56416170, "comment_id": 99435218, "body": "Also, <code>time.Tick</code> is the wrong choice here (and probably everywhere that isn&#39;t a trivial 1-shot program). You want <code>time.After</code> which only sends once and doesn&#39;t leak memory."}], "tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": true, "score": 1, "last_activity_date": 1559487391, "creation_date": 1559487391, "answer_id": 56416170, "question_id": 56405281, "link": "https://stackoverflow.com/questions/56405281/print-spooler-concept-api-channels-issue-passing-jobs-to-a-queue-from-serve/56416170#56416170", "title": "Print spooler concept / API &amp; Channels: issue passing jobs to a queue from serveHTTP", "body": "<p>I've add some updates to your code. Now it works as you've described.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"database/sql\"\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"net/http\"\n    \"sync\"\n    \"time\"\n)\n\ntype QueueElement struct {\n    jobid    string\n    rw       http.ResponseWriter\n    doneChan chan struct{}\n}\n\ntype GlobalVars struct {\n    db   *sql.DB\n    wg   sync.WaitGroup\n    jobs chan QueueElement\n}\n\nfunc (gv *GlobalVars) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\n    switch r.URL.Path {\n    case \"/StartJob\":\n        fmt.Printf(\"incoming\\r\\n\")\n\n        doneC := make(chan struct{}, 1) //Buffered channel in order not to block the worker routine\n\n        go func(doneChan chan struct{}, w http.ResponseWriter) {\n            gv.jobs &lt;- QueueElement{\n                doneChan: doneC,\n                jobid:    \"jobid\",\n            }\n        }(doneC, w)\n\n        select {\n        case &lt;-time.Tick(time.Second * 5):\n            fmt.Fprintf(w, \"job is taking more than 5 seconds to complete\\r\\n\")\n            fmt.Printf(\"took longer than 5 secs\\r\\n\")\n        case &lt;-doneC:\n            fmt.Fprintf(w, \"instant reply from serveHTTP\\r\\n\")\n            fmt.Printf(\"instant\\r\\n\")\n        }\n    default:\n        fmt.Fprintf(w, \"No such Api\")\n    }\n}\n\nfunc worker(jobs &lt;-chan QueueElement) {\n    for {\n        job := &lt;-jobs\n        fmt.Println(\"START /i /b try.cmd\")\n        fmt.Printf(\"job done\")\n\n        randTimeDuration := time.Second * time.Duration(rand.Intn(7))\n\n        time.Sleep(randTimeDuration)\n\n        //  processExec(\"START /i /b processAndPrint.exe -\" + job.jobid)\n        job.doneChan &lt;- struct{}{}\n    }\n}\n\nfunc main() {\n\n    // create a GlobalVars instance\n    gv := GlobalVars{\n        //db:   db,\n        jobs: make(chan QueueElement),\n    }\n    go worker(gv.jobs)\n    // create an http.Server instance and specify our job manager as\n    // the handler for requests.\n    server := http.Server{\n        Handler: &amp;gv,\n        Addr:    \":8888\",\n    }\n    // start server and accept connections.\n    log.Fatal(server.ListenAndServe())\n}\n</code></pre>\n"}], "owner": {"reputation": 317, "user_id": 7868246, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/07273a6f68864edf11c793a2f774066a?s=128&d=identicon&r=PG&f=1", "display_name": "MdTp", "link": "https://stackoverflow.com/users/7868246/mdtp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 77, "favorite_count": 0, "accepted_answer_id": 56416170, "answer_count": 3, "score": 0, "last_activity_date": 1576572395, "creation_date": 1559379809, "last_edit_date": 1576572395, "question_id": 56405281, "link": "https://stackoverflow.com/questions/56405281/print-spooler-concept-api-channels-issue-passing-jobs-to-a-queue-from-serve", "title": "Print spooler concept / API &amp; Channels: issue passing jobs to a queue from serveHTTP", "body": "<p>Got some help here already that made me move forward in this concept I'm trying, but it still isn't quite working and I hit a conflict that I can't seem to get around.</p>\n\n<p>I have tried here to illustrate what I want in a flowchart - please note that the client can be many clients that will send in with printjobs therefore we cannot reply on the worker to be processing our job at that moment, but for most it will (peak times it won't as the processing job of printing can take time).</p>\n\n<p><a href=\"https://i.stack.imgur.com/zMxTt.png\" rel=\"nofollow noreferrer\"><img src=\"https://i.stack.imgur.com/zMxTt.png\" alt=\"enter image description here\"></a></p>\n\n<pre><code>type QueueElement struct {\n    jobid string\n    rw   http.ResponseWriter\n  doneChan chan struct{}\n}\n\ntype GlobalVars struct {\n    db   *sql.DB\n    wg   sync.WaitGroup\n    jobs chan QueueElement\n}\n\nfunc (gv *GlobalVars) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n\n    switch r.URL.Path {\n    case \"/StartJob\":\n        fmt.Printf (\"incoming\\r\\n\")\n\n            doneC := make(chan struct{}, 1) //Buffered channel in order not to block the worker routine\n            newPrintJob := QueueElement{\n                    doneChan: doneC,    \n                    jobid:    \"jobid\",\n            }\n\n            gv.jobs &lt;- newPrintJob\n            func(doneChan chan struct{},w http.ResponseWriter) {\n\n                  ctx, cancel := context.WithTimeout(context.Background(), 5*time.Second)\n                    defer cancel()\n                    select {\n                    //If this triggers first, then this waiting goroutine would exit\n                    //and nobody would be listeding the 'doneChan'. This is why it has to be buffered.\n                    case &lt;-ctx.Done():\n                            fmt.Fprintf(w, \"job is taking more than 5 seconds to complete\\r\\n\")\n                            fmt.Printf (\"took longer than 5 secs\\r\\n\")\n                    case &lt;-doneChan:\n                            fmt.Fprintf(w, \"instant reply from serveHTTP\\r\\n\")\n                            fmt.Printf (\"instant\\r\\n\")\n                    }\n            }(doneC,w)\n\n    default:\n            fmt.Fprintf(w, \"No such Api\")\n    }\n}\n\nfunc worker(jobs &lt;-chan QueueElement) {\n    for {\n            job := &lt;-jobs\n            processExec (\"START /i /b try.cmd\")\n            fmt.Printf (\"job done\")\n        //  processExec(\"START /i /b processAndPrint.exe -\" + job.jobid)\n            job.doneChan &lt;- struct{}{}\n\n    }\n}\n\nfunc main() {\n      db, err := sql.Open(\"sqlite3\", \"jobs.sqlite\")\n      if err := db.Ping(); err != nil {\n        log.Fatal(err)\n    }   \n\n      db.SetMaxOpenConns(1) // prevents locked database error\n      _, err = db.Exec(setupSQL)\n      if err != nil {\n          log.Fatal(err)\n      }\n\n    // create a GlobalVars instance\n    gv := GlobalVars{\n        db  :   db,\n        jobs: make(chan QueueElement),\n    }\n    go worker (gv.jobs)\n    // create an http.Server instance and specify our job manager as\n    // the handler for requests.\n    server := http.Server{\n        Handler: &amp;gv,\n        Addr : \":8888\",\n    }\n    // start server and accept connections.\n    log.Fatal(server.ListenAndServe())\n}\n</code></pre>\n\n<p>The above code is of the serveHTTP and the worker with help from here, initially the func inside the ServeHTTP was a go routine and it's here the whole conflict arises for me - the concept is that in the serveHTTP it spawns a process that will get reply from the worker if the worker were able to process the job in time, within 5 seconds.</p>\n\n<p>If the job was able to finish in 1 second, I want to reply back instantly after that 1 second to the client, if it takes 3 I want to reply after 3, if it takes more than 5 I will send reply back after 5 seconds (if the job takes 13 seconds I still want to reply after 5 seconds). That the client has to poll on the job from now on - but the conflict is:</p>\n\n<p>a) When ServeHTTP exits - then the ResponseWriter closes - and to be able to reply back to the client, we have to write the answer to the ResponseWriter.</p>\n\n<p>b) if I block serveHTTP (like in the code example below where I don't call the func as a go routine) then it affects not only that single API call but it seems that all others after that will be affected, so the first call in will be served correctly in time but the calls that would be coming in at the same time after the first will be sequentially delayed by the blocking operation.</p>\n\n<p>c) if I don't block it ex - and change it to a go routine :</p>\n\n<pre><code>    gv.jobs &lt;- newPrintJob\n    go func(doneChan chan struct{},w http.ResponseWriter) {\n</code></pre>\n\n<p>Then there's no delay - can call in many APIs - but problem is here serveHTTP exists right away and thereby kills ResponseWriter and then I'm not able to reply back to the client.</p>\n\n<p>I am not sure how I can get around this conflict where I don't cause any blockage to serveHTTP so I can handle all requests parallel, but still able to reply back to the ResponseWriter in question.</p>\n\n<p>Is there any way of preventing serveHTTP of shutting down a responsewriter even though the function exits?</p>\n"}, {"tags": ["go", "cross-compiling"], "comments": [{"owner": {"reputation": 86274, "user_id": 32880, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/35b00dd652b316f6cd6bb5c12c5be999?s=128&d=identicon&r=PG", "display_name": "JimB", "link": "https://stackoverflow.com/users/32880/jimb"}, "edited": false, "score": 1, "creation_date": 1559394107, "post_id": 56404518, "comment_id": 99411161, "body": "What does Linux say the file is? Are you sending the correct file? I don\u2019t think the compiler adds a <code>.exe</code> extension when cross compiling."}, {"owner": {"reputation": 3321, "user_id": 7450049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f14acd868cb2fd0a35a7d2084eed5d?s=128&d=identicon&r=PG", "display_name": "Vitaly Migunov", "link": "https://stackoverflow.com/users/7450049/vitaly-migunov"}, "edited": false, "score": 0, "creation_date": 1559408723, "post_id": 56404518, "comment_id": 99414743, "body": "Do you use PowerShell?"}, {"owner": {"reputation": 59, "user_id": 10639347, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "mohammad ghari", "link": "https://stackoverflow.com/users/10639347/mohammad-ghari"}, "reply_to_user": {"reputation": 3321, "user_id": 7450049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f14acd868cb2fd0a35a7d2084eed5d?s=128&d=identicon&r=PG", "display_name": "Vitaly Migunov", "link": "https://stackoverflow.com/users/7450049/vitaly-migunov"}, "edited": false, "score": 0, "creation_date": 1560079870, "post_id": 56404518, "comment_id": 99614420, "body": "@VitalyMigunov Yes"}, {"owner": {"reputation": 3321, "user_id": 7450049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f14acd868cb2fd0a35a7d2084eed5d?s=128&d=identicon&r=PG", "display_name": "Vitaly Migunov", "link": "https://stackoverflow.com/users/7450049/vitaly-migunov"}, "edited": false, "score": 0, "creation_date": 1560087049, "post_id": 56404518, "comment_id": 99615803, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/50911153/how-to-crosscompile-go-programs-on-windows-10\">How to CrossCompile Go programs on Windows 10</a>"}], "answers": [{"comments": [{"owner": {"reputation": 59, "user_id": 10639347, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "mohammad ghari", "link": "https://stackoverflow.com/users/10639347/mohammad-ghari"}, "edited": false, "score": 1, "creation_date": 1560079769, "post_id": 56408720, "comment_id": 99614401, "body": "I did it but made a mistake,GOOS=linux : The term &#39;GOOS=linux&#39; is not recognized as the name of a cmdlet, function, script file, or operable program. Check the spelling of the name, or if a path was included, verify that the path is correct and try again. At line:1 char:1 + GOOS=linux GOARCH=amd64 go build .\\main.go + ~~~~~~~~~~     + CategoryInfo          : ObjectNotFound: (GOOS=linux:String) [], CommandNotFoundException     + FullyQualifiedErrorId : CommandNotFoundException"}], "tags": [], "owner": {"reputation": 86, "user_id": 5715068, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-o9dzJNgSvKE/AAAAAAAAAAI/AAAAAAAAAQ0/14GkM4SsL8M/photo.jpg?sz=128", "display_name": "Bogdan Daragan", "link": "https://stackoverflow.com/users/5715068/bogdan-daragan"}, "is_accepted": false, "score": 0, "last_activity_date": 1559408397, "creation_date": 1559408397, "answer_id": 56408720, "question_id": 56404518, "link": "https://stackoverflow.com/questions/56404518/i-can-not-use-cross-compiler/56408720#56408720", "title": "I Can not use Cross Compiler", "body": "<p>Try this like a one line command in the terminal: <code>GOOS=linux GOARCH=amd64 go build .\\main.go</code></p>\n"}, {"comments": [{"owner": {"reputation": 893, "user_id": 6254435, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-9dM4j8r6xpw/AAAAAAAAAAI/AAAAAAAAAas/NJ66NNi8JOk/photo.jpg?sz=128", "display_name": "Dan Ortega", "link": "https://stackoverflow.com/users/6254435/dan-ortega"}, "edited": false, "score": 0, "creation_date": 1616023033, "post_id": 56514992, "comment_id": 117877078, "body": "Thank very useful."}], "tags": [], "owner": {"reputation": 3321, "user_id": 7450049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f14acd868cb2fd0a35a7d2084eed5d?s=128&d=identicon&r=PG", "display_name": "Vitaly Migunov", "link": "https://stackoverflow.com/users/7450049/vitaly-migunov"}, "is_accepted": true, "score": 2, "last_activity_date": 1560087014, "creation_date": 1560087014, "answer_id": 56514992, "question_id": 56404518, "link": "https://stackoverflow.com/questions/56404518/i-can-not-use-cross-compiler/56514992#56514992", "title": "I Can not use Cross Compiler", "body": "<p>If you use PowerShell then you should use <code>$Env:GOOS = \"linux\"; $Env:GOARCH = \"amd64\"; go build .\\main.go</code></p>\n"}], "owner": {"reputation": 59, "user_id": 10639347, "user_type": "registered", "profile_image": "https://lh3.googleusercontent.com/-XdUIqdMkCWA/AAAAAAAAAAI/AAAAAAAAAAA/4252rscbv5M/photo.jpg?sz=128", "display_name": "mohammad ghari", "link": "https://stackoverflow.com/users/10639347/mohammad-ghari"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 256, "favorite_count": 0, "accepted_answer_id": 56514992, "answer_count": 2, "score": 0, "last_activity_date": 1560087014, "creation_date": 1559371931, "last_edit_date": 1559396859, "question_id": 56404518, "link": "https://stackoverflow.com/questions/56404518/i-can-not-use-cross-compiler", "title": "I Can not use Cross Compiler", "body": "<p>I want to compile my Go code in windows 10 for Linux (Ubuntu).</p>\n\n<p>I use the commands:</p>\n\n<pre><code>SET GOOS=linux\nSET GOARCH=amd64\ngo build .\\main.go\n</code></pre>\n\n<p>but the compiler creates an .exe file.</p>\n\n<p>How to cross-compile this code for linux?</p>\n"}, {"tags": ["go", "testing"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559371042, "post_id": 56404355, "comment_id": 99406838, "body": "You could call it <code>test_helpers.go</code> but have it in a package called <code>testdata</code>."}, {"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559371327, "post_id": 56404355, "comment_id": 99406886, "body": "How would that be different from calling it <code>test_helpers.go</code> in a package called <code>test</code>?"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559371445, "post_id": 56404355, "comment_id": 99406902, "body": "Not sure about <code>test</code> package names, but <code>testdata</code> gets ignored by the go tool."}, {"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559371993, "post_id": 56404355, "comment_id": 99406984, "body": "I don&#39;t want it to be ignored. It contains test code I want to call."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559373260, "post_id": 56404355, "comment_id": 99407173, "body": "You can still import it into your test files, although that directory seems to be intended mainly for non go files you can still put go files in it and import it. The ignored-by-the-go-tool might come in handy when you want to run a &quot;project wide&quot; command but you want it to skip the code in testdata, e.g. <code>go test .&#47;...</code> or  something like that."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559373845, "post_id": 56404355, "comment_id": 99407266, "body": "Either way there&#39;s not much you can do about not being able to import code declared in <code>*_test.go</code> files. You just have to use a different file name, where you put that file is up to you, as long as you don&#39;t violate the no-import-cycle-allowed rule."}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559373994, "post_id": 56404355, "comment_id": 99407295, "body": "To avoid the test helper code being part of your package&#39;s api maybe you could use the <code>internal</code> directory, have you considered that?"}, {"owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559379756, "post_id": 56404355, "comment_id": 99408309, "body": "That would be no different from having it in the test directory."}, {"owner": {"reputation": 24447, "user_id": 603316, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/4db0c2cbf2d5c9c196902dfc9db8218d?s=128&d=identicon&r=PG", "display_name": "Peter", "link": "https://stackoverflow.com/users/603316/peter"}, "edited": false, "score": 1, "creation_date": 1559380132, "post_id": 56404355, "comment_id": 99408376, "body": "@Karl, yes it would be. Users of your library cannot import your internal packages."}], "answers": [{"tags": [], "owner": {"reputation": 1034911, "user_id": 6309, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7aa22372b695ed2b26052c340f9097eb?s=128&d=identicon&r=PG", "display_name": "VonC", "link": "https://stackoverflow.com/users/6309/vonc"}, "is_accepted": false, "score": 2, "last_activity_date": 1559391033, "last_edit_date": 1559391033, "creation_date": 1559370298, "answer_id": 56404375, "question_id": 56404355, "link": "https://stackoverflow.com/questions/56404355/how-do-i-package-golang-test-helper-code/56404375#56404375", "title": "How do I package golang test helper code?", "body": "<p>Following <a href=\"https://github.com/golang/go/issues/8279\" rel=\"nofollow noreferrer\">go issue 8279</a>, I have seen dummy files added, as in <a href=\"https://github.com/tommie/acme-cli/commit/479f8c7fcafc04a1bdfb2d4a17f209736715120d\" rel=\"nofollow noreferrer\"><code>tommie/acme-cli</code> commit 479f8c7</a></p>\n\n<pre><code>outer/outer.go\n\n// +build ignore+\npackage outer\n</code></pre>\n\n<p>See if that could help here, as a workaround.</p>\n\n<hr>\n\n<p>As commented above, using a test helper code in an <a href=\"https://golang.org/doc/go1.4#internalpackages\" rel=\"nofollow noreferrer\">internal package (from Go 1.4+)</a> is another option, since no client from this project would be able to access said helper. See <a href=\"https://docs.google.com/document/d/1e8kOo3r51b2BWtTs_1uADIA5djfXhPT36s6eHVRIvaU/edit\" rel=\"nofollow noreferrer\">design document</a>.<br>\nYou can see it used in a <a href=\"https://github.com/golang-standards/project-layout#internal\" rel=\"nofollow noreferrer\">typical Go project layout</a>.</p>\n"}, {"tags": [], "owner": {"reputation": 2476, "user_id": 5788720, "user_type": "registered", "profile_image": "https://lh5.googleusercontent.com/-tkE-8jM--HE/AAAAAAAAAAI/AAAAAAAAAEw/g51C7_m9JWU/photo.jpg?sz=128", "display_name": "Iain Duncan", "link": "https://stackoverflow.com/users/5788720/iain-duncan"}, "is_accepted": true, "score": 7, "last_activity_date": 1559452418, "creation_date": 1559452418, "answer_id": 56412373, "question_id": 56404355, "link": "https://stackoverflow.com/questions/56404355/how-do-i-package-golang-test-helper-code/56412373#56412373", "title": "How do I package golang test helper code?", "body": "<p>You are right that you cannot import test code from another package so your helper functions have to go into proper code files rather than test files.</p>\n\n<p>If it isn't imported from your non-test code then it won't be built into the final binary.</p>\n\n<p>Authors tend to call the package <code>...test</code> to indicate it is just test helpers, for instance <code>httptest</code> from the standard library or <code>zaptest</code> from open source.</p>\n\n<p><a href=\"https://golang.org/pkg/net/http/httptest/\" rel=\"noreferrer\">https://golang.org/pkg/net/http/httptest/</a>\n<a href=\"https://godoc.org/go.uber.org/zap/zaptest\" rel=\"noreferrer\">https://godoc.org/go.uber.org/zap/zaptest</a></p>\n"}], "owner": {"reputation": 12876, "user_id": 377446, "user_type": "registered", "accept_rate": 88, "profile_image": "https://www.gravatar.com/avatar/0479a8c7ebd088dbcf459147ba3b2569?s=128&d=identicon&r=PG", "display_name": "Karl", "link": "https://stackoverflow.com/users/377446/karl"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2401, "favorite_count": 1, "accepted_answer_id": 56412373, "answer_count": 2, "score": 4, "last_activity_date": 1559452418, "creation_date": 1559370016, "last_edit_date": 1559371649, "question_id": 56404355, "link": "https://stackoverflow.com/questions/56404355/how-do-i-package-golang-test-helper-code", "title": "How do I package golang test helper code?", "body": "<p>I have some test helper code in my golang library that I want to use when testing in various subpackages. However, I've hit a snag:</p>\n\n<pre><code>outer\n|\n+- test_helpers_test.go\n|\n+- inner\n   |\n   +- something.go\n   +- something_test.go\n</code></pre>\n\n<p>To use the code in <code>test_helpers_test.go</code>, I have to import the outer package. But when I import the outer package from <code>something_test.go</code>, it complains \"import cycle not allowed in test\"</p>\n\n<p>So I tried making a package for the shared test helpers:</p>\n\n<pre><code>outer\n|\n+- test\n|  |\n|  +- test_helpers_test.go\n|\n+- inner\n   |\n   +- something.go\n   +- something_test.go\n</code></pre>\n\n<p>And now it complains \"no non-test Go files in /home/karl/Projects/outer/test\"</p>\n\n<p>I don't want to call it <code>test_helpers.go</code> because it's part of my testing code, not my library code. I don't want to ship that code in the library.</p>\n\n<p>How do I solve this?</p>\n\n<hr>\n\n<p>Update: I can work around the issue by creating a <code>dummy.go</code> file in the <code>test</code> directory, but now there's a new problem: Importing a package DOESN'T import its test code! So now I get: <code>./something_test.go:12:2: undefined: test.AssertDoesPanic</code></p>\n"}, {"tags": ["unit-testing", "go"], "answers": [{"tags": [], "owner": {"reputation": 990, "user_id": 3055558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1cde28ce033c8cd6f4be4059efbe00b?s=128&d=identicon&r=PG", "display_name": "lynn", "link": "https://stackoverflow.com/users/3055558/lynn"}, "is_accepted": false, "score": 1, "last_activity_date": 1559364834, "creation_date": 1559364834, "answer_id": 56403953, "question_id": 56403366, "link": "https://stackoverflow.com/questions/56403366/test-an-error-response-in-a-method-thats-internal-to-a-struct/56403953#56403953", "title": "Test an error response in a method that&#39;s internal to a struct", "body": "<p>I figured out one solution, inspired by <a href=\"https://stackoverflow.com/a/48206430/3055558\">https://stackoverflow.com/a/48206430/3055558</a></p>\n\n<p>Using a <code>internal{{ your struct }}</code> struct and associated interface, and mocking that.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code># example.go\n\npackage example\n\nimport \"fmt\"\n\ntype internalFooAPI interface {\n    internalBehavior(string) (string, error)\n}\n\ntype Foo struct {\n    internal internalFooAPI\n}\n\ntype internalFoo struct{}\n\nfunc NewFoo(internal internalFooAPI) Foo {\n    return Foo{\n        internal: internal,\n    }\n}\n\nfunc (foo Foo) Start() (err error) {\n\n    data, err := foo.internal.internalBehavior(\"bar\")\n    if err != nil {\n        return err\n    }\n\n    fmt.Println(data)\n    return err\n}\n\nfunc (foo internalFoo) internalBehavior(input string) (output string, err error) {\n    return output, err\n}\n</code></pre>\n\n<pre><code># example_test.go\n\npackage example\n\nimport (\n    \"testing\"\n\n    \"github.com/pkg/errors\"\n)\n\ntype mockInternalFoo struct{}\n\ntype mockInternalFooWithErrors struct{}\n\nfunc (foo mockInternalFoo) internalBehavior(input string) (output string, err error) {\n    return output, err\n}\n\nfunc (foo mockInternalFooWithErrors) internalBehavior(input string) (output string, err error) {\n    return output, errors.New(\"big error\")\n}\n\nfunc TestStart(t *testing.T) {\n    tdata := []struct {\n        testCase        string\n        expectedAnError bool\n        foo             Foo\n    }{\n        {\n            testCase:        \"standard_case\",\n            expectedAnError: false,\n            foo:             NewFoo(internalFoo{}),\n        },\n        {\n            testCase:        \"mock_case\",\n            expectedAnError: false,\n            foo:             NewFoo(mockInternalFoo{}),\n        },\n        {\n            testCase:        \"error_case\",\n            expectedAnError: true,\n            foo:             NewFoo(mockInternalFooWithErrors{}),\n        },\n    }\n    for _, test := range tdata {\n        t.Run(test.testCase, func(t *testing.T) {\n            // The function under test\n            err := test.foo.Start()\n\n            // Assertion 1\n            if test.expectedAnError == false &amp;&amp; err != nil {\n                t.Error(err.Error())\n            }\n\n            // Assertion 2\n            if test.expectedAnError == true &amp;&amp; err == nil {\n                t.Error(\"expected an error, but there was none!\")\n            }\n        })\n    }\n}\n</code></pre>\n"}], "owner": {"reputation": 990, "user_id": 3055558, "user_type": "registered", "accept_rate": 75, "profile_image": "https://www.gravatar.com/avatar/b1cde28ce033c8cd6f4be4059efbe00b?s=128&d=identicon&r=PG", "display_name": "lynn", "link": "https://stackoverflow.com/users/3055558/lynn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 82, "favorite_count": 0, "answer_count": 1, "score": 1, "last_activity_date": 1559364854, "creation_date": 1559355208, "last_edit_date": 1559364854, "question_id": 56403366, "link": "https://stackoverflow.com/questions/56403366/test-an-error-response-in-a-method-thats-internal-to-a-struct", "title": "Test an error response in a method that&#39;s internal to a struct", "body": "<p>I'm writing unit tests, and I want to write a unit test that asserts that a public method on the struct (<code>Foo.Start</code>) properly handles error responses from an internal method on the struct (<code>Foo.internal</code>).</p>\n\n<p>Essentially I want to get test coverage on the this section of my code:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>if err != nil {\n    return err\n}\n</code></pre>\n\n<p>Here's an example of code and associated test that doesn't work (but would work in say, Python)</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code># example.go\n\npackage example\n\nimport \"fmt\"\n\ntype FooAPI interface {\n    Start() error\n    internal(string) (string, error)\n}\n\ntype Foo struct {\n    FooAPI\n}\n\nfunc (foo Foo) Start() (err error) {\n\n    data, err := foo.internal(\"bar\")\n    if err != nil {\n        return err\n    }\n\n    fmt.Println(data)\n    return err\n}\n\nfunc (foo Foo) internal(input string) (output string, err error) {\n    return output, err\n}\n</code></pre>\n\n<pre><code># example_test.go\n\npackage example\n\nimport (\n    \"testing\"\n\n    \"github.com/pkg/errors\"\n)\n\ntype MockFoo struct {\n    FooAPI\n}\n\nfunc (foo MockFoo) internal(input string) (output string, err error) {\n    return output, errors.New(\"big error\")\n}\n\nfunc TestStart(t *testing.T) {\n    tdata := []struct {\n        testCase        string\n        expectedAnError bool\n        foo             FooAPI\n    }{\n        {\n            testCase:        \"standard_case\",\n            expectedAnError: false,\n            foo:             Foo{},\n        },\n        {\n            testCase:        \"error_case\",\n            expectedAnError: true,\n            foo:             MockFoo{},\n        },\n    }\n    for _, test := range tdata {\n        t.Run(test.testCase, func(t *testing.T) {\n            // The function under test\n            test.foo.Start = Foo.Start // &lt;= this doesn't work\n            err := test.foo.Start()\n\n            // Assertion 1\n            if test.expectedAnError == false &amp;&amp; err != nil {\n                t.Error(err.Error())\n            }\n\n            // Assertion 2\n            if test.expectedAnError == true &amp;&amp; err == nil {\n                t.Error(\"expected an error, but there was none!\")\n            }\n        })\n    }\n}\n</code></pre>\n\n<p>I'm less interested in correcting the specific example, more-so my goal is to get test coverage on <code>Foo.Start</code>'s error handling. I feel like there's some trick with interfaces or pointers that will get me across the finish line here?</p>\n"}, {"tags": ["go", "timeout", "race-condition", "child-process", "goroutine"], "comments": [{"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559410939, "post_id": 56403297, "comment_id": 99415280, "body": "Run the application with the <a href=\"https://golang.org/doc/articles/race_detector.html\" rel=\"nofollow noreferrer\">race detector</a> in case it points to any problems."}], "answers": [{"tags": [], "owner": {"reputation": 2217, "user_id": 2604708, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/2b62fe48f9c75ebe5e3868f9d428c125?s=128&d=identicon&r=PG", "display_name": "Dirbaio", "link": "https://stackoverflow.com/users/2604708/dirbaio"}, "is_accepted": false, "score": 0, "last_activity_date": 1571617046, "creation_date": 1571617046, "answer_id": 58478372, "question_id": 56403297, "link": "https://stackoverflow.com/questions/56403297/race-condition-reading-stdout-and-stderr-of-child-process/58478372#58478372", "title": "Race condition reading stdout and stderr of child process", "body": "<blockquote>\n  <p>But sometimes it will return no output, as if the goroutine that reads stdout didn't start soon enough to \"catch\" all the output</p>\n</blockquote>\n\n<p>This is impossible, because a pipe can't \"lose\" data. If the process is writing to stdout and the Go program isn't reading yet, the process will block.</p>\n\n<p>The simplest way to approach the problem is:</p>\n\n<ul>\n<li>Launch goroutines to collect stdout, stderr</li>\n<li>Launch a timer that kills the process</li>\n<li>Start the process</li>\n<li>Wait for it to finish (or be killed by the timer) with .Wait()</li>\n<li>If timer is fired, return timeout error</li>\n<li>Handle wait error</li>\n</ul>\n\n<pre class=\"lang-golang prettyprint-override\"><code>\nfunc GetOutputsWithTimeout(command string, args []string, timeout int) ([]byte, []byte, int, error) {\n    cmd := exec.Command(command, args...)\n\n    // get pipes to standard output/error\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        return nil, nil, -1, fmt.Errorf(\"cmd.StdoutPipe() error: %+v\", err.Error())\n    }\n    stderr, err := cmd.StderrPipe()\n    if err != nil {\n        return nil, nil, -1, fmt.Errorf(\"cmd.StderrPipe() error: %+v\", err.Error())\n    }\n\n    // setup buffers to capture standard output and standard error\n    var stdoutBuf, stderrBuf []byte\n\n    // create 3 goroutines: stdout, stderr, timer.\n    // Use a waitgroup to wait.\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go func() {\n        var err error\n        if stdoutBuf, err = ioutil.ReadAll(stdout); err != nil {\n            log.Printf(\"%s: Error Slurping stdout: %+v\", command, err)\n        }\n        wg.Done()\n    }()\n    go func() {\n        var err error\n        if stderrBuf, err = ioutil.ReadAll(stderr); err != nil {\n            log.Printf(\"%s: Error Slurping stderr: %+v\", command, err)\n        }\n        wg.Done()\n    }()\n\n    t := time.AfterFunc(time.Duration(timeout)*time.Second, func() {\n        cmd.Process.Kill()\n    })\n\n    // start process\n    if err := cmd.Start(); err != nil {\n        t.Stop()\n        return nil, nil, -1, fmt.Errorf(\"cmd.Start() error: %+v\", err.Error())\n    }\n\n    err = cmd.Wait()\n    timedOut := !t.Stop()\n    wg.Wait()\n\n    // check if the timer timed out.\n    if timedOut {\n        return stdoutBuf, stderrBuf, -1,\n            fmt.Errorf(\"%s: timeout %d s reached, pid=%d process killed\",\n                command, timeout, cmd.Process.Pid)\n    }\n\n    if err != nil {\n        rc := -1\n        if exitErr, ok := err.(*exec.ExitError); ok {\n            rc = exitErr.Sys().(syscall.WaitStatus).ExitStatus()\n        }\n        return stdoutBuf, stderrBuf, rc,\n            fmt.Errorf(\"%s: process done with error: %+v\",\n                command, err)\n    }\n\n    // cmd.Wait docs say that if err == nil, exit code is 0\n    return stdoutBuf, stderrBuf, 0, nil\n}\n\n</code></pre>\n"}], "owner": {"reputation": 51, "user_id": 3163661, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/452b0d109fa7df1d9e2266454702fcaf?s=128&d=identicon&r=PG", "display_name": "Tom Malaher", "link": "https://stackoverflow.com/users/3163661/tom-malaher"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 394, "favorite_count": 0, "answer_count": 1, "score": 4, "last_activity_date": 1571617046, "creation_date": 1559354185, "last_edit_date": 1559354638, "question_id": 56403297, "link": "https://stackoverflow.com/questions/56403297/race-condition-reading-stdout-and-stderr-of-child-process", "title": "Race condition reading stdout and stderr of child process", "body": "<p>In Go, I'm trying to:</p>\n\n<ol>\n<li>start a subprocess</li>\n<li>read from stdout and stderr separately</li>\n<li>implement an overall timeout</li>\n</ol>\n\n<p>After much googling, we've come up with some code that seems to do the job, most of the time. But there seems to be a race condition whereby some output is not read.</p>\n\n<p>The problem seems to only occur on Linux, not Windows.</p>\n\n<p>Following the simplest possible solution found with google, we tried creating a context with a timeout: </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>context.WithTimeout(context.Background(), 10*time.Second)\n</code></pre>\n\n<p>While this worked most of the time, we were able to find cases where it would just hang forever. There was some aspect of the child process that caused this to deadlock. (Something to do with grandchildren that were not sufficiently dissasociated from the child process, and thus caused the child to never completely exit.)</p>\n\n<p>Also, it seemed that in some cases the <code>error</code> that is returned when the timeout occurrs would indicate a timeout, but would only be delivered <strong>after</strong> the process had actually exited (thus making the whole concept of the timeout useless).</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func GetOutputsWithTimeout(command string, args []string, timeout int) (io.ReadCloser, io.ReadCloser, int, error) {\n    start := time.Now()\n    procLogger.Tracef(\"Initializing %s %+v\", command, args)\n    cmd := exec.Command(command, args...)\n\n    // get pipes to standard output/error\n    stdout, err := cmd.StdoutPipe()\n    if err != nil {\n        return emptyReader(), emptyReader(), -1, fmt.Errorf(\"cmd.StdoutPipe() error: %+v\", err.Error())\n    }\n    stderr, err := cmd.StderrPipe()\n    if err != nil {\n        return emptyReader(), emptyReader(), -1, fmt.Errorf(\"cmd.StderrPipe() error: %+v\", err.Error())\n    }\n\n    // setup buffers to capture standard output and standard error\n    var buf bytes.Buffer\n    var ebuf bytes.Buffer\n\n    // create a channel to capture any errors from wait\n    done := make(chan error)\n    // create a semaphore to indicate when both pipes are closed\n    var wg sync.WaitGroup\n    wg.Add(2)\n\n    go func() {\n        if _, err := buf.ReadFrom(stdout); err != nil {\n            procLogger.Debugf(\"%s: Error Slurping stdout: %+v\", command, err)\n        }\n        wg.Done()\n    }()\n    go func() {\n        if _, err := ebuf.ReadFrom(stderr); err != nil {\n            procLogger.Debugf(\"%s: Error  Slurping stderr: %+v\", command, err)\n        }\n        wg.Done()\n    }()\n\n    // start process\n    procLogger.Debugf(\"Starting %s\", command)\n    if err := cmd.Start(); err != nil {\n        procLogger.Errorf(\"%s: failed to start: %+v\", command, err)\n        return emptyReader(), emptyReader(), -1, fmt.Errorf(\"cmd.Start() error: %+v\", err.Error())\n    }\n\n    go func() {\n        procLogger.Debugf(\"Waiting for %s (%d) to finish\", command, cmd.Process.Pid)\n        err := cmd.Wait()                                             // this can  be 'forced' by the killing of the process\n        procLogger.Tracef(\"%s finished: errStatus=%+v\", command, err) // err could be nil here\n        //notify select of completion, and the status\n        done &lt;- err\n    }()\n\n    // Wait for timeout or completion.\n    select {\n    // Timed out\n    case &lt;-time.After(time.Duration(timeout) * time.Second):\n        elapsed := time.Since(start)\n        procLogger.Errorf(\"%s: timeout after %.1f\\n\", command, elapsed.Seconds())\n        if err := TerminateTree(cmd); err != nil {\n            return ioutil.NopCloser(&amp;buf), ioutil.NopCloser(&amp;ebuf), -1,\n                fmt.Errorf(\"failed to kill %s, pid=%d: %+v\",\n                    command, cmd.Process.Pid, err)\n        }\n        wg.Wait() // this *should* take care of waiting for stdout and stderr to be collected after we killed the process\n        return ioutil.NopCloser(&amp;buf), ioutil.NopCloser(&amp;ebuf), -1,\n            fmt.Errorf(\"%s: timeout %d s reached, pid=%d process killed\",\n                command, timeout, cmd.Process.Pid)\n    //Exited normally or with a non-zero exit code\n    case err := &lt;-done:\n        wg.Wait() // this *should* take care of waiting for stdout and stderr to be collected after the process terminated naturally.\n        elapsed := time.Since(start)\n        procLogger.Tracef(\"%s: Done after %.1f\\n\", command, elapsed.Seconds())\n        rc := -1\n        // Note that we have to use go1.10 compatible mechanism.\n        if err != nil {\n            procLogger.Tracef(\"%s exited with error: %+v\", command, err)\n            exitErr, ok := err.(*exec.ExitError)\n            if ok {\n                ws := exitErr.Sys().(syscall.WaitStatus)\n                rc = ws.ExitStatus()\n            }\n            procLogger.Debugf(\"%s exited with status %d\", command, rc)\n            return ioutil.NopCloser(&amp;buf), ioutil.NopCloser(&amp;ebuf), rc,\n                fmt.Errorf(\"%s: process done with error: %+v\",\n                    command, err)\n        } else {\n            ws := cmd.ProcessState.Sys().(syscall.WaitStatus)\n            rc = ws.ExitStatus()\n        }\n        procLogger.Debugf(\"%s exited with status %d\", command, rc)\n        return ioutil.NopCloser(&amp;buf), ioutil.NopCloser(&amp;ebuf), rc, nil\n    }\n    //NOTREACHED: should not reach this line!\n}\n</code></pre>\n\n<p>Calling <code>GetOutputsWithTimeout(\"uname\",[]string{\"-mpi\"},10)</code> will return the expected single line of output <em>most of the time</em>. But sometimes it will return <em>no output</em>, as if the goroutine that reads stdout didn't start soon enough to \"catch\" all the output (or exited early?) The \"most of the time\" strongly suggests a race condition.</p>\n\n<p>We will also sometimes see errors from the goroutines about \"file already closed\" (this seems to happen with the timeout condition, but will happen at other \"normal\" times as well).</p>\n\n<p>I would have thought that starting the goroutines before the <code>cmd.Start()</code> would have ensured that no output would be missed, and that using the <code>WaitGroup</code> would guarantee they would both complete before reading the buffers.</p>\n\n<p>So how are we missing output? Is there still a race condition between the two \"reader\" goroutines and the <code>cmd.Start()</code>? Should we ensure those two are running using yet another <code>WaitGroup</code>?</p>\n\n<p>Or is there a problem with the implementation of <code>ReadFrom()</code>?</p>\n\n<p>Note that we are currently using go1.10 due to backward-compatibility problems with older OSs but the same effect occurs with go1.12.4.</p>\n\n<p>Or are we overthinking this, and a simple implementation with <code>context.WithTimeout()</code> would do the job?</p>\n"}, {"tags": ["go", "threadpool", "goroutine"], "answers": [{"comments": [{"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 1, "creation_date": 1559377911, "post_id": 56403275, "comment_id": 99407959, "body": "Even if an OS supports sub-process permissions, Go doesn&#39;t expose that functionality. (I&#39;m also not aware of any such OS in existence)"}], "tags": [], "owner": {"reputation": 529, "user_id": 1317806, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/494fd6fab92e92a5a0bb35c5046d93b2?s=128&d=identicon&r=PG", "display_name": "SJP", "link": "https://stackoverflow.com/users/1317806/sjp"}, "is_accepted": false, "score": 3, "last_activity_date": 1559353714, "creation_date": 1559353714, "answer_id": 56403275, "question_id": 56403237, "link": "https://stackoverflow.com/questions/56403237/is-it-possible-to-run-a-goroutine-or-go-method-under-a-different-user/56403275#56403275", "title": "Is it possible to run a goroutine or go method under a different user?", "body": "<p>It is not possible to run a goroutine or method as a different user because they both run within the same context as the parent process. Goroutines are equivalent to green threads and don't even necessarily spawn off proper OS thread per routine. </p>\n\n<p>This answer might also depend on OS, but I don't think this will work on windows either.</p>\n\n<p>if you are spawning another process via the <code>cmd</code> package, then this answer may be useful\n<a href=\"https://stackoverflow.com/questions/21705950/running-external-commands-through-os-exec-under-another-user\">Running external commands through os/exec under another user</a></p>\n"}, {"tags": [], "owner": {"reputation": 186, "user_id": 1698629, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/762306680c167ef96cb280f4fade89a2?s=128&d=identicon&r=PG", "display_name": "A.Steinel", "link": "https://stackoverflow.com/users/1698629/a-steinel"}, "is_accepted": true, "score": 2, "last_activity_date": 1573326743, "creation_date": 1573326743, "answer_id": 58782676, "question_id": 56403237, "link": "https://stackoverflow.com/questions/56403237/is-it-possible-to-run-a-goroutine-or-go-method-under-a-different-user/58782676#58782676", "title": "Is it possible to run a goroutine or go method under a different user?", "body": "<p>Yes, you can do that with the use of the Linux syscall <code>setuid</code> (not the built in function <code>setuid</code>). I just found this question and thought that it has to be possible, as I use this in other programming languages too. So I got my problem solved and wanted to report back how to do this.</p>\n\n<p>However, it is correct what SJP wrote about the threads and there lies exactly the answer to my problem, but it will not solve your problem, due to the threading issue - <a href=\"https://github.com/golang/go/issues/1435\" rel=\"nofollow noreferrer\">whole story in this very long issue 1435</a>. Therein is also a suggestion in how to solve a specific subset of the <code>setuid</code> problem and that solved my problem.</p>\n\n<p>But back to code ... you need to call <code>LockOSThread</code> in order to fix the current go routine to the thread you're currently executing in and in that, you can change the context with the syscall <code>setuid</code>.</p>\n\n<p>Here is a working example for Linux:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n        \"fmt\"\n        \"log\"\n        \"os\"\n        \"runtime\"\n        \"sync\"\n        \"syscall\"\n        \"time\"\n\n)\n\nfunc printUID() {\n        fmt.Printf(\"Real UID: %d\\n\", syscall.Getuid())\n        fmt.Printf(\"Effective UID: %d\\n\", syscall.Geteuid())\n}\n\nfunc main() {\n        printUID()\n        var wg sync.WaitGroup\n        wg.Add(2)\n\n        go func(wg *sync.WaitGroup) {\n                defer wg.Done()\n                time.Sleep(2 * time.Second)\n                printUID()\n        }(&amp;wg)\n\n        go func(wg *sync.WaitGroup) {\n                runtime.LockOSThread()\n                defer runtime.UnlockOSThread()\n                defer wg.Done()\n\n                _, _, serr := syscall.Syscall(syscall.SYS_SETUID, 1, 0, 0)\n                if serr != 0 {\n                        log.Fatal(serr)\n                        os.Exit(1)\n                }\n                printUID()\n\n        }(&amp;wg)\n        wg.Wait()\n        printUID()\n}\n</code></pre>\n\n<p>You will receive <code>operation not supported</code> if you use <code>syscall.Setuid</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>serr := syscall.Setuid(1)\n</code></pre>\n\n<p>instead of </p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>_, _, serr := syscall.Syscall(syscall.SYS_SETUID, 1, 0, 0)\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 91, "user_id": 5739452, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/9cacdf39dca26d5f1e7e13f96e76ba59?s=128&d=identicon&r=PG&f=1", "display_name": "Tinkerer", "link": "https://stackoverflow.com/users/5739452/tinkerer"}, "is_accepted": false, "score": 0, "last_activity_date": 1615171348, "creation_date": 1615171348, "answer_id": 66523695, "question_id": 56403237, "link": "https://stackoverflow.com/questions/56403237/is-it-possible-to-run-a-goroutine-or-go-method-under-a-different-user/66523695#66523695", "title": "Is it possible to run a goroutine or go method under a different user?", "body": "<p>[This answer is similar to the one by @A.Steinel but, alas, I have insufficient reputation to actually comment on that one. Hopefully, this offers a little more of a complete worked example and, importantly, demonstrates keeping the runtime free of the confusion of threads running with different UIDs.]</p>\n<p>First, to strictly do what you asked requires a number of hacks and isn't all that secure...</p>\n<p>[Go likes to operate with <a href=\"https://man7.org/linux/man-pages/man7/nptl.7.html\" rel=\"nofollow noreferrer\">POSIX semantics</a>, and what you want to do is break POSIX semantics by operating with two or more UIDs at the same time in a single process. Go wants POSIX semantics because it runs goroutines on whatever thread is available, and the runtime needs them to all behave the same for this to work reliably. Since Linux's <code>setuid()</code> syscall doesn't honor POSIX semantics, Go opted to <a href=\"https://github.com/golang/go/issues/1435\" rel=\"nofollow noreferrer\">not implement syscall.Setuid()</a> until very recently when it became <a href=\"https://golang.org/doc/go1.16#minor_library_changes\" rel=\"nofollow noreferrer\">possible to implement it <em>with</em> POSIX semantics in go1.16</a>.</p>\n<ul>\n<li>Note, <code>glibc</code>, if you call <code>setuid()</code>, wraps the syscall itself with a fix-up mechanism (<a href=\"https://ewontfix.com/17/\" rel=\"nofollow noreferrer\">glibc/nptl/setxid</a>) and will change the UID values for all the threads in the program <em>simultaneously</em>. So, even in C, you will have to do some hacking to work around this detail.]</li>\n</ul>\n<p>That being said, you can make goroutines work the way you want with the <code>runtime.LockOSThread()</code> call, but not confuse the Go runtime by discarding the locked threads immediately after each specialized use.</p>\n<p>Something like this (call it <code>uidserve.go</code>):</p>\n<pre><code>// Program uidserve serves content as different uids. This is adapted\n// from the https://golang.org/pkg/net/http/#ListenAndServe example.\npackage main\n\nimport (\n        &quot;fmt&quot;\n        &quot;log&quot;\n        &quot;net/http&quot;\n        &quot;runtime&quot;\n        &quot;syscall&quot;\n)\n\n// Simple username to uid mapping.\nvar prefixUIDs = map[string]uintptr{\n        &quot;apple&quot;:  100,\n        &quot;banana&quot;: 101,\n        &quot;cherry&quot;: 102,\n}\n\ntype uidRunner struct {\n        uid uintptr\n}\n\nfunc (u *uidRunner) ServeHTTP(w http.ResponseWriter, r *http.Request) {\n        runtime.LockOSThread()\n        // Note, we never runtime.UnlockOSThread().\n        if _, _, e := syscall.RawSyscall(syscall.SYS_SETUID, u.uid, 0, 0); e != 0 {\n                http.Error(w, &quot;permission problem&quot;, http.StatusInternalServerError)\n                return\n        }\n        fmt.Fprintf(w, &quot;query %q executing as UID=%d\\n&quot;, r.URL.Path, syscall.Getuid())\n}\n\nfunc main() {\n        for u, uid := range prefixUIDs {\n                h := &amp;uidRunner{uid: uid}\n                http.Handle(fmt.Sprint(&quot;/&quot;, u, &quot;/&quot;), h)\n        }\n        http.HandleFunc(&quot;/&quot;, func(w http.ResponseWriter, r *http.Request) {\n                fmt.Fprintf(w, &quot;general query %q executing as UID=%d\\n&quot;, r.URL.Path, syscall.Getuid())\n        })\n        log.Fatal(http.ListenAndServe(&quot;:8080&quot;, nil))\n}\n</code></pre>\n<p>Build it like this:</p>\n<pre><code>$ go build uidserve.go\n</code></pre>\n<p>Next, to get this to work, you have to grant this program some privilege. That is do one or the other of (<code>setcap</code> is a tool from the <a href=\"https://sites.google.com/site/fullycapable/\" rel=\"nofollow noreferrer\">libcap suite</a>):</p>\n<pre><code>$ sudo /sbin/setcap cap_setuid=ep ./uidserve\n</code></pre>\n<p>or, alternatively, the more traditional way of running <em>setuid-root</em>:</p>\n<pre><code>$ sudo chown root ./uidserve\n$ sudo chmod +s ./uidserve\n</code></pre>\n<p>Now, if you run <code>./uidserve</code> and connect to your browser to <code>localhost:8080</code> you can try fetching the following URLs:</p>\n<ul>\n<li><code>localhost:8080/something</code> which shows something like <code>general query &quot;/something&quot; executing as UID=</code><em>your UID here</em>.</li>\n<li><code>localhost:8080/apple/pie</code> which shows something like <code>query &quot;/apple/pie&quot; executing as UID=100</code>.</li>\n<li>etc.</li>\n</ul>\n<p>Hope that helps show how to do what you asked. [Since it involves lots of hacks, however, I wouldn't recommend doing this for real though...]</p>\n"}], "owner": {"reputation": 1194, "user_id": 570921, "user_type": "registered", "accept_rate": 57, "profile_image": "https://www.gravatar.com/avatar/81abbc463ce5d9e39a930728d154d5b9?s=128&d=identicon&r=PG", "display_name": "Reza", "link": "https://stackoverflow.com/users/570921/reza"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 723, "favorite_count": 0, "accepted_answer_id": 58782676, "answer_count": 3, "score": 0, "last_activity_date": 1615171348, "creation_date": 1559352560, "question_id": 56403237, "link": "https://stackoverflow.com/questions/56403237/is-it-possible-to-run-a-goroutine-or-go-method-under-a-different-user", "title": "Is it possible to run a goroutine or go method under a different user?", "body": "<p>I am working on a small web server that serves files and provides access to each user's home directory.</p>\n\n<p>If the source was to be in C I had the option of answering each request under different threads and to make sure each thread gets to run with the user of the caller as its users.</p>\n\n<p>Is there any approach to achieve something similar to that in Go?\nIdeally, the part of the code that handles the request, the goroutine or the method that gets called should be run under the user account of the caller.</p>\n\n<p>I have done some research and it seems in Go we can stick a single goroutine to the current thread but I can't see how it is possible to create a new thread and then attach a goroutine to that thread.</p>\n"}, {"tags": ["sql", "go", "google-bigquery"], "comments": [{"owner": {"reputation": 48, "user_id": 10161872, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/owbi0.jpg?s=128&g=1", "display_name": "Bernardo Villasenor", "link": "https://stackoverflow.com/users/10161872/bernardo-villasenor"}, "edited": false, "score": 0, "creation_date": 1568674518, "post_id": 56402952, "comment_id": 102341476, "body": "As the error message describes, DML does not support <a href=\"https://cloud.google.com/bigquery/docs/reference/standard-sql/dml-syntax#update_examples\" rel=\"nofollow noreferrer\">array modifications</a>. You need to select the array as a <a href=\"https://stackoverflow.com/a/46301668/10161872\">struct</a> in order to iterate and update a value within the array."}], "owner": {"reputation": 21, "user_id": 11047597, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-4N_Hq13d0mU/AAAAAAAAAAI/AAAAAAAAAAA/ACevoQNgppf8cHVe_fZ-3gHLQ6npuYb7oA/mo/photo.jpg?sz=128", "display_name": "Andrew Ahn", "link": "https://stackoverflow.com/users/11047597/andrew-ahn"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 163, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559901027, "creation_date": 1559348550, "last_edit_date": 1559901027, "question_id": 56402952, "link": "https://stackoverflow.com/questions/56402952/how-to-access-column-name-of-an-array-of-data-inside-a-column-in-a-bigquery-tabl", "title": "How to access column name of an array of data inside a column in a bigquery table?", "body": "<p>I have a structure that holds an array of class objects which I uploaded to my BigQuery table using <code>inferschema</code>. However, I am now trying to iterate through that table and update the values accordingly and I am not able to access the column which holds the array of class objects.</p>\n\n<p>I have already tried to access it using different class names such as: </p>\n\n<ul>\n<li>\"Reviewers[0].Role\"</li>\n<li>\"`Reviewers[0].Role`\"</li>\n<li>\"Reviewers_0.Role\"</li>\n<li>\"Reviewers(0).Role\"</li>\n</ul>\n\n<p>... None of which works</p>\n\n<pre><code>//Models which I'm using for the schema of the tables\ntype PullRequest struct {   \nReviewers         []*Reviewer  `json:\"reviewers\"`\n}\ntype Reviewer struct {\n    Role   string `json:\"role\"`\n    Status string `json:\"status\"`\n    User   *User  `json:\"user\"`\n}\n\n//Putting sql statements in constant to avoid SQL injection\nconst (\n    prUpdateSQL = \"UPDATE %s.%s.%s\"\n    prSetSQL = \"SET %v = '%v'\"\n    prSetNonEscapeSQL = \"%v = %v\"\n    prSetEscapeSQL = \"%v = '%v'\"\n    prWhereSQL = \"WHERE ID = %v\"\n)\n\ncommandstring := fmt.Sprintf(prUpdateSQL+\" \", projectID, datasetID, tableName)\nfor i, r := range pr.Reviewers{\n                reviewerString := fmt.Sprintf(\"Reviewers.%d\", i)\n                commandstring += fmt.Sprintf(prSetEscapeSQL+\", \", reviewerString+\".Role\", r.Role)\n                commandstring += fmt.Sprintf(prSetEscapeSQL+\", \", reviewerString+\".Status\", r.Status)\n                commandstring += fmt.Sprintf(prSetEscapeSQL+\", \", reviewerString+\".User.Name\", r.User.Name)\n}\n</code></pre>\n\n<p>I am expecting the results to be able to set the different class objects values in the array to my new value which pr holds. Instead I get this error message: </p>\n\n<blockquote>\n  <p>UPDATE ... SET does not support array modification with [] at [1:914], invalidQuery\"</p>\n</blockquote>\n"}, {"tags": ["go", "graphql"], "owner": {"reputation": 9, "user_id": 11585265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/459bc1f039d4567a76611ff58eac6d07?s=128&d=identicon&r=PG&f=1", "display_name": "Alex Korzin", "link": "https://stackoverflow.com/users/11585265/alex-korzin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 104, "favorite_count": 0, "answer_count": 0, "score": 1, "last_activity_date": 1559345669, "creation_date": 1559345347, "last_edit_date": 1559345669, "question_id": 56402698, "link": "https://stackoverflow.com/questions/56402698/how-can-i-autogenerate-sdl-schema-of-graphql-for-any-api-explorer", "title": "How can I autogenerate SDL schema of GraphQL for any API explorer?", "body": "<p>Given an API explorer (e.g., <a href=\"https://developers.google.com/apis-explorer/\" rel=\"nofollow noreferrer\"><em>Google APIs Explorer</em></a>), how can one autogenerate <a href=\"http://graphql.org/learn/schema/\" rel=\"nofollow noreferrer\">SDL (Schema Definition Language)</a> schema for all of the queries?</p>\n\n<p>More specifically, I'm interested in doing it in a golang using <a href=\"https://github.com/99designs/gqlgen\" rel=\"nofollow noreferrer\">gqlgen</a>.</p>\n\n<p><em>Some context</em>: I'm interested in using GraphQL and would like to find out whether it's possible to generate SDL schema automatically (right now, I <em>convert</em> it manually which doesn't look right).</p>\n"}, {"tags": ["go", "parallel-processing"], "comments": [{"owner": {"reputation": 1, "user_id": 9377484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214330381605474/picture?type=large", "display_name": "Shahzeb Faheem", "link": "https://stackoverflow.com/users/9377484/shahzeb-faheem"}, "edited": false, "score": 0, "creation_date": 1559335493, "post_id": 56401540, "comment_id": 99401444, "body": "The second snippet is the code or loop in the first snippet that i had to parallelize."}, {"owner": {"reputation": 1, "user_id": 9377484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214330381605474/picture?type=large", "display_name": "Shahzeb Faheem", "link": "https://stackoverflow.com/users/9377484/shahzeb-faheem"}, "edited": false, "score": 0, "creation_date": 1559336178, "post_id": 56401540, "comment_id": 99401654, "body": "The objective was to update all the &quot;bodies&quot; in parallel using go routines."}, {"owner": {"reputation": 2360, "user_id": 367332, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/6D0rd.png?s=128&g=1", "display_name": "DarthFennec", "link": "https://stackoverflow.com/users/367332/darthfennec"}, "edited": false, "score": 0, "creation_date": 1559336566, "post_id": 56401540, "comment_id": 99401758, "body": "One way to do this would be to loop over every item in the list and spawn a goroutine for each one. Though, as your professor mentioned recursion, he might have in mind a binary divide-and-conquer approach: spawn a goroutine for each half of the list, in each of those goroutines spawn another for each half of the half, etc."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559378047, "post_id": 56401540, "comment_id": 99407980, "body": "If your assignment is literally to make this parallel, then your professor doesn&#39;t understand Go. Go doesn&#39;t give you the option to parallelize things. It only lets you run things concurrently, which Go itself may, or may not, choose to run in parallel. Watch <a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">this</a>, and tell your professor to do the same."}, {"owner": {"reputation": 1, "user_id": 9377484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214330381605474/picture?type=large", "display_name": "Shahzeb Faheem", "link": "https://stackoverflow.com/users/9377484/shahzeb-faheem"}, "edited": false, "score": 0, "creation_date": 1559385069, "post_id": 56401540, "comment_id": 99409340, "body": "Your task is to make the outer loop parallel such that all bodies are updated in parallel. You must use goroutines and must ensure that no concurrency isseus (shared memory) are introduced and the output is correct. Lambda functions are not required but will make this part very simple. These are the exact wordings."}, {"owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "edited": false, "score": 0, "creation_date": 1559467754, "post_id": 56401540, "comment_id": 99424026, "body": "That exact wording is confused. :) You can write concurrent code, which may or may not execute in parallel. There&#39;s no guarantee that your code will run in parallel."}], "answers": [{"comments": [{"owner": {"reputation": 1, "user_id": 9377484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214330381605474/picture?type=large", "display_name": "Shahzeb Faheem", "link": "https://stackoverflow.com/users/9377484/shahzeb-faheem"}, "edited": false, "score": 0, "creation_date": 1559384934, "post_id": 56405126, "comment_id": 99409319, "body": "Thanks this does help me. Will post any update I get."}], "tags": [], "owner": {"reputation": 60130, "user_id": 13860, "user_type": "registered", "accept_rate": 63, "profile_image": "https://www.gravatar.com/avatar/6bdc06836b7bcec9fce2c5c6e5242192?s=128&d=identicon&r=PG", "display_name": "Flimzy", "link": "https://stackoverflow.com/users/13860/flimzy"}, "is_accepted": false, "score": 2, "last_activity_date": 1559378319, "creation_date": 1559378319, "answer_id": 56405126, "question_id": 56401540, "link": "https://stackoverflow.com/questions/56401540/is-the-following-implementation-making-my-code-parallel/56405126#56405126", "title": "Is the following implementation making my code parallel?", "body": "<p>Your code does run concurrently*, but not necessarily in a very optimal way.  You've essentially split your workload into two, and you're running both halves concurrently.</p>\n\n<blockquote>\n  <p>[The professor] said I had to recursively run a go routine to make the loop parallel.</p>\n</blockquote>\n\n<p>This is not true, but I don't know the exact words your professor said, so he may not have been lying to you.  He apparently has some sort of recursive solution in mind. I wouldn't use recursion here, but it would be one way.</p>\n\n<p>It's hard to provide the answer your professor is looking for. The best advice is to ask your professor to explain his intentions.</p>\n\n<p>*concurrency is not parallelism. Please read/watch <a href=\"https://blog.golang.org/concurrency-is-not-parallelism\" rel=\"nofollow noreferrer\">this</a>.</p>\n"}], "owner": {"reputation": 1, "user_id": 9377484, "user_type": "registered", "profile_image": "https://graph.facebook.com/10214330381605474/picture?type=large", "display_name": "Shahzeb Faheem", "link": "https://stackoverflow.com/users/9377484/shahzeb-faheem"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 52, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1559378319, "creation_date": 1559335441, "last_edit_date": 1559377971, "question_id": 56401540, "link": "https://stackoverflow.com/questions/56401540/is-the-following-implementation-making-my-code-parallel", "title": "Is the following implementation making my code parallel?", "body": "<p>I had an assignment in Go to parallelize a given loop of a code. I am unsure whether or not my code is parallel. </p>\n\n<p>I tried simply dividing the array i had into two halves, and used a go routine on both halves.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"math\"\n)\n\ntype Body struct {\n    x, y, vx, vy, mass float64\n    r, g, b uint\n}\n\nfunc main() {\n    var count uint\n    var radius float64\n    done := make(chan bool)\n    fmt.Scan(&amp;count, &amp;radius)\n    bodies := make([]Body, count)\n    for i := range bodies {\n        b := &amp;bodies[i]\n        fmt.Scan(&amp;b.x, &amp;b.y, &amp;b.vx, &amp;b.vy, &amp;b.mass, &amp;b.r, &amp;b.g, &amp;b.b)\n    }\n\n    updatedBodies := make([]Body, count)\n    copy(updatedBodies, bodies)\n    mid := len(updatedBodies)/2\n\n\n    go func(){\n    for i := range updatedBodies[mid:] {\n        b := &amp;updatedBodies[i+mid]\n        for _, ob := range bodies {\n            dx, dy := ob.x - b.x, ob.y - b.y\n            if dist := math.Sqrt(dx*dx + dy*dy); dist &gt; 1 { // far enough\n                accel := 0.0000000000667 * ob.mass / (dist * dist * dist)\n                b.vx += accel * dx\n                b.vy += accel * dy\n            }\n        }\n        b.x += b.vx\n        b.y += b.vy\n\n    }\n    done &lt;- true\n}()\n    go func(){\n        for i := range updatedBodies[:mid] {\n        b := &amp;updatedBodies[i]\n        for _, ob := range bodies {\n            dx, dy := ob.x - b.x, ob.y - b.y\n            if dist := math.Sqrt(dx*dx + dy*dy); dist &gt; 1 { // far enough\n                accel := 0.0000000000667 * ob.mass / (dist * dist * dist)\n                b.vx += accel * dx\n                b.vy += accel * dy\n            }\n        }\n        b.x += b.vx\n        b.y += b.vy\n\n    }\n    done &lt;- true\n}()\n\n    &lt;- done\n    &lt;- done\n    fmt.Println(count)\n    fmt.Println(radius)\n    for _, b := range updatedBodies {\n        fmt.Println(b.x, b.y, b.vx, b.vy, b.mass, b.r, b.g, b.b)\n    }\n}\n</code></pre>\n\n<pre><code>for i := range updatedBodies {\n        b := &amp;updatedBodies[i]\n        for _, ob := range bodies {\n            dx, dy := ob.x - b.x, ob.y - b.y\n            if dist := math.Sqrt(dx*dx + dy*dy); dist &gt; 1 { // far enough\n                accel := 0.0000000000667 * ob.mass / (dist * dist * dist)\n                b.vx += accel * dx\n                b.vy += accel * dy\n            }\n        }\n        b.x += b.vx\n        b.y += b.vy\n\n    }\n</code></pre>\n\n<p>I asked a professor about the code he said I had to recursively run a go routine to make the loop parallel.</p>\n"}, {"tags": ["go", "yaml"], "answers": [{"comments": [{"owner": {"reputation": 4866, "user_id": 215713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa4a82dca6b5d2d0b58e784231caf3a?s=128&d=identicon&r=PG", "display_name": "rfay", "link": "https://stackoverflow.com/users/215713/rfay"}, "edited": false, "score": 1, "creation_date": 1559522712, "post_id": 56409676, "comment_id": 99435463, "body": "Thanks for pointing out Decode(). I&#39;m still not understanding proper use of Node though, since per <a href=\"https://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-available\" rel=\"nofollow noreferrer\">the announcement post</a> the biggest benefit is to be able to preserve comments and keep them in the right place. I don&#39;t understand how to do that successfully if you can&#39;t tie the contents of Node together. I updated the question to focus on access to the comments."}], "tags": [], "owner": {"reputation": 225, "user_id": 4321151, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/H3dyj.jpg?s=128&g=1", "display_name": "Gokul Raj Kumar", "link": "https://stackoverflow.com/users/4321151/gokul-raj-kumar"}, "is_accepted": false, "score": 0, "last_activity_date": 1559416227, "creation_date": 1559416227, "answer_id": 56409676, "question_id": 56401238, "link": "https://stackoverflow.com/questions/56401238/how-to-unmarshall-yaml-v3-with-full-access-to-node/56409676#56409676", "title": "How to unmarshall YAML v3 with full access to node", "body": "<p>You have to declare the complete <strong>struct</strong> instead of using <strong>yaml.Node</strong></p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v3\"\n    \"os\"\n)\n\nfunc main() {\n    type Address struct {\n        Street string\n        City   string\n        State  string\n        Zip    string\n    }\n    type Person struct {\n        Name    string\n        Address Address\n    }\n\n\n\ndata := `\n    name: John Doe\n    address: \n        street: 123 E 3rd St\n        city: Denver\n        state: CO\n        zip: 81526\n    `\n\n    var person Person\n    err := yaml.Unmarshal([]byte(data), &amp;person)\n    if (err != nil) {\n        fmt.Printf(\"Failed to unmarshall: %v\", err)\n        os.Exit(1)\n    }\n    fmt.Printf(\"Marshalled person=%v\", person)\n}\n</code></pre>\n\n<p>yaml.Node seems like an <strong>intermediate representation.</strong>\nIt has to be decoded to get the values.</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"gopkg.in/yaml.v3\"\n    \"os\"\n)\n\nfunc main() {\n    type Address struct {\n        Street string\n        City   string\n        State  string\n        Zip    string\n    }\ntype Person struct {\n    Name    string\n    Address yaml.Node\n}\n\ndata := `\nname: John Doe\naddress: \n    street: 123 E 3rd St\n    city: Denver\n    state: CO\n    zip: 81526\n`\n\nvar person Person\nerr := yaml.Unmarshal([]byte(data), &amp;person)\nif (err != nil) {\n    fmt.Printf(\"Failed to unmarshall: %v\", err)\n    os.Exit(1)\n}\naddress := &amp;Address{}\n_ = person.Address.Decode(address)\nfmt.Printf(\"Marshalled person=%v\\n %v\", person, *address)\n\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 11, "user_id": 11912481, "user_type": "registered", "profile_image": "https://lh6.googleusercontent.com/-RRphejVH8jQ/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rf7jZ28UIUOich8bjuXOTjLlA4fvw/photo.jpg?sz=128", "display_name": "Martin Dekov", "link": "https://stackoverflow.com/users/11912481/martin-dekov"}, "is_accepted": false, "score": 1, "last_activity_date": 1565474617, "creation_date": 1565474617, "answer_id": 57445988, "question_id": 56401238, "link": "https://stackoverflow.com/questions/56401238/how-to-unmarshall-yaml-v3-with-full-access-to-node/57445988#57445988", "title": "How to unmarshall YAML v3 with full access to node", "body": "<p>So the Node struct has three fields which are:</p>\n\n<pre><code>// HeadComment holds any comments in the lines preceding the node and\n// not separated by an empty line.\nHeadComment string\n\n// LineComment holds any comments at the end of the line where the node is in.\nLineComment string\n\n// FootComment holds any comments following the node and before empty lines.\nFootComment string\n</code></pre>\n\n<p>This ^ is taken from the documentation <a href=\"https://godoc.org/gopkg.in/yaml.v3#Node.Decode\" rel=\"nofollow noreferrer\">here</a>. With slight augmentation on the example above:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"os\"\n\n    \"gopkg.in/yaml.v3\"\n)\n\nfunc main() {\n    type Person struct {\n        Name    yaml.Node\n        Address yaml.Node\n    }\n\n    data := `\nname: John Doe\n#comment here\naddress: \n    street: 123 E 3rd St\n    city: Denver\n    state: CO\n    zip: 81526\n`\n\n    var person Person\n    err := yaml.Unmarshal([]byte(data), &amp;person)\n    if err != nil {\n        fmt.Printf(\"Failed to unmarshall: %v\", err)\n        os.Exit(1)\n    }\n    address := &amp;yaml.Node{}\n\n    decErr := person.Address.Decode(address)\n    if decErr != nil {\n        fmt.Printf(\"Failed to decode: %v\", decErr)\n        os.Exit(1)\n    }\n    fmt.Printf(\"%v\", address.HeadComment)\n}\n</code></pre>\n\n<p>In our case </p>\n\n<pre><code>#comment here\naddress: \n    street: 123 E 3rd St\n    city: Denver\n    state: CO\n    zip: 81526\n</code></pre>\n\n<p>can be referred to as Node and its comments can be accessed from the fields in the Node struct. But still I am unable to get the comment above the Node, though I am able to access the other fields as pointed in the documentation.</p>\n"}], "owner": {"reputation": 4866, "user_id": 215713, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/eaa4a82dca6b5d2d0b58e784231caf3a?s=128&d=identicon&r=PG", "display_name": "rfay", "link": "https://stackoverflow.com/users/215713/rfay"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2577, "favorite_count": 1, "answer_count": 2, "score": 2, "last_activity_date": 1565524892, "creation_date": 1559333693, "last_edit_date": 1565524892, "question_id": 56401238, "link": "https://stackoverflow.com/questions/56401238/how-to-unmarshall-yaml-v3-with-full-access-to-node", "title": "How to unmarshall YAML v3 with full access to node", "body": "<p>I'm trying to learn to use YAML v3 unmarshaling with full access to the Node in a complex embedded struct.</p>\n\n<p><a href=\"https://blog.ubuntu.com/2019/04/05/api-v3-of-the-yaml-package-for-go-is-available\" rel=\"nofollow noreferrer\">The announcement</a> post explains how to use yaml.Node, but doesn't give a serious example. And the <a href=\"https://godoc.org/gopkg.in/yaml.v3#example-Unmarshal--Embedded\" rel=\"nofollow noreferrer\">documentation</a> also doesn't show working with the Node. The primary purpose seems to be the excellent preservation of comments in YAML files.</p>\n\n<p>For example, working with an extension of the announcement article, I have</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport(\n    \"fmt\"\n    \"gopkg.in/yaml.v3\"\n    \"os\"\n)\n\nfunc main() {\n\n    type Person struct {\n        Name    string\n        Address yaml.Node\n    }\n\n    data := `\nname: John Doe\naddress: \n    street: 123 E 3rd St # street is like an avenue\n    city: Denver  # A city might be a town as well\n    state: CO  # A state might be a province or administrative unit\n    zip: 81526 # zip might be \"postal_code\"\n`\n\n    var person Person\n    err := yaml.Unmarshal([]byte(data), &amp;person)\n    if (err != nil) {\n        fmt.Printf(\"Failed to unmarshall: %v\", err)\n        os.Exit(1)\n    }\n    fmt.Printf(\"Marshalled person=%v\", person)\n\n}\n</code></pre>\n\n<p>But if I try to use the address items, I find them each listed as an array of Content inside the node; there's no actual useful information there. The comments are in there, but it's not clear what they're associated with.</p>\n\n<p><a href=\"https://stackoverflow.com/questions/55674853/modify-existing-yaml-file-and-add-new-data-and-comments\">Modify existing yaml file and add new data and comments</a> also deals with the same territory, but doesn't show navigating the structure after unmarshalling into the struct.</p>\n\n<p>How can I navigate the \"Address\" node once unmarshalled, and preserve the comments on marshalling again?</p>\n"}, {"tags": ["go", "mongo-go"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1559420432, "post_id": 56400734, "comment_id": 99417398, "body": "Not sure if that&#39;s the best way, but it will work <a href=\"https://gist.github.com/miguelmota/904f0fdad34eaac09c5d53098f960c5c#file-struct_custom_unmarshal-go-L15\" rel=\"nofollow noreferrer\">gist.github.com/miguelmota/&hellip;</a>."}], "answers": [{"comments": [{"owner": {"reputation": 86, "user_id": 2968535, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/DBJL6.jpg?s=128&g=1", "display_name": "tutu_magi", "link": "https://stackoverflow.com/users/2968535/tutu-magi"}, "edited": false, "score": 0, "creation_date": 1597116010, "post_id": 58428184, "comment_id": 112021580, "body": "Perfect answer."}], "tags": [], "owner": {"reputation": 363, "user_id": 5040388, "user_type": "registered", "accept_rate": 40, "profile_image": "https://lh3.googleusercontent.com/-smIq4fgpQ34/AAAAAAAAAAI/AAAAAAAAABE/e5qpViT4k8Y/photo.jpg?sz=128", "display_name": "tetafro", "link": "https://stackoverflow.com/users/5040388/tetafro"}, "is_accepted": false, "score": 3, "last_activity_date": 1571301053, "creation_date": 1571301053, "answer_id": 58428184, "question_id": 56400734, "link": "https://stackoverflow.com/questions/56400734/custom-unmarshalbson-in-mongo-go-driver/58428184#58428184", "title": "Custom UnmarshalBSON in mongo-go-driver", "body": "<p>Make another type. It will inherit fields, but not methods. Therefore no infinite loop here.</p>\n\n<pre><code>func (t *T) UnmarshalBSON(b []byte) error {\n    type Alias T\n    bson.Unmarshal(b, (*Alias)(t))\n    // Do something here\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 1789, "user_id": 4056372, "user_type": "registered", "accept_rate": 69, "profile_image": "https://www.gravatar.com/avatar/285fed6a5df00f048a00732292105729?s=128&d=identicon&r=PG&f=1", "display_name": "Andrew", "link": "https://stackoverflow.com/users/4056372/andrew"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 712, "favorite_count": 1, "answer_count": 1, "score": 2, "last_activity_date": 1571301053, "creation_date": 1559330784, "question_id": 56400734, "link": "https://stackoverflow.com/questions/56400734/custom-unmarshalbson-in-mongo-go-driver", "title": "Custom UnmarshalBSON in mongo-go-driver", "body": "<p>I would like to have some kind of a \"hook\" that runs whenever I get a specific type of object from the database. I thought the <a href=\"https://godoc.org/go.mongodb.org/mongo-driver/bson#Unmarshaler\" rel=\"nofollow noreferrer\"><code>Unmarshaler</code></a> interface is perfect for that, but... How can I implement that interface without manually unmarshalling every single field myself?</p>\n\n<p>I thought of doing something like this: </p>\n\n<pre><code>func (t *T) UnmarshalBSON(b []byte) error {\n    // Simply unmarshal `b` into `t` like it would otherwise\n    bson.Unmarshal(b, t) // Obviously this won't work, it'll be an infinite loop\n    // Do something here\n    return nil\n}\n</code></pre>\n\n<p>How could I achieve this without manually unmarshalling the fields using the reflect pkg?</p>\n"}, {"tags": ["c++", "c", "go", "swig"], "answers": [{"tags": [], "owner": {"reputation": 41, "user_id": 10927265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/202e468e773866ea0d0fc5a4ede53edf?s=128&d=identicon&r=PG&f=1", "display_name": "aacebedo", "link": "https://stackoverflow.com/users/10927265/aacebedo"}, "is_accepted": false, "score": 1, "last_activity_date": 1559417597, "creation_date": 1559417597, "answer_id": 56409837, "question_id": 56400400, "link": "https://stackoverflow.com/questions/56400400/build-issue-with-go-using-swig-and-an-external-c-library/56409837#56409837", "title": "Build issue with go using SWIG and an external C library", "body": "<p>Someone on the <a href=\"https://github.com/golang/go/issues/32374\" rel=\"nofollow noreferrer\">golang github repository</a> has solved my issue.</p>\n\n<p>The solution was to remove the newline between the import \"C\" directive and the comments containing the #cgo directives.</p>\n"}], "owner": {"reputation": 41, "user_id": 10927265, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/202e468e773866ea0d0fc5a4ede53edf?s=128&d=identicon&r=PG&f=1", "display_name": "aacebedo", "link": "https://stackoverflow.com/users/10927265/aacebedo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 370, "favorite_count": 1, "answer_count": 1, "score": 3, "last_activity_date": 1559417597, "creation_date": 1559328879, "question_id": 56400400, "link": "https://stackoverflow.com/questions/56400400/build-issue-with-go-using-swig-and-an-external-c-library", "title": "Build issue with go using SWIG and an external C library", "body": "<p>I am trying to create a golang program which will use an external C library.\nBefore doing complex stuff, I wanted to test the use of SWIG in a small foo example.\nI also want to be able to use the \"go get\" syntax without having to manually run swig. And to take into account that the external C library shall have been built before and can be located anywhere on the machine.</p>\n\n<p>I am using golang 1.12.5 and swig 3.0.12</p>\n\n<p>I have created the following structure:</p>\n\n<pre><code>.\n|-- libfoo\n|   |-- foo.c\n|   |-- foo.h\n|   `-- libfoo.so\n`-- src\n    |-- example_test.go\n    |-- lib.go\n    `-- libfoo.swig\n</code></pre>\n\n<p>In the libfoo folder I have a simple shared library. The files contain:\nfoo.c:</p>\n\n<pre><code>#include \"foo.h\"\n\nint foo(int c){\n    return c+1;\n};\n</code></pre>\n\n<p>foo.h</p>\n\n<pre><code>int foo(int c);\n</code></pre>\n\n<p>That I've compiled it with:</p>\n\n<pre><code>gcc -o ./libfoo.so -fPIC -shared ./foo.c\n</code></pre>\n\n<p>Then the golang files:\nlibfoo.swig</p>\n\n<pre><code>%module libfoo\n\n%{\n  extern int foo(int a);\n%}\n\nextern int foo(int a);\n</code></pre>\n\n<p>lib.go</p>\n\n<pre><code>package libfoo\n\n/*\n#cgo LDFLAGS: -L../libfoo -lfoo\n*/\n\nimport \"C\"\n</code></pre>\n\n<p>And finally example_test.go</p>\n\n<pre><code>package libfoo\n\nimport (\n    \"testing\"\n    \"fmt\"\n)\n\nfunc TestFoo(*testing.T) {\n    i := Foo(1)\n    fmt.Printf(\"%v\\n\",i)\n}\n</code></pre>\n\n<p>When I try to build with \"go build -x\" It seems that the cgo directives located in the \"lib.go\" file are not taken into account as I do not see the flag appears in the output. Here is the output </p>\n\n<pre><code>06aa7e308d6:/mnt/data/src# go build -x\nWORK=/tmp/go-build551116655\nmkdir -p $WORK/b001/\nswig -version\ncd $WORK\n/opt/go/pkg/tool/linux_amd64/compile -o ./b001/_go_.o -trimpath ./b001 -p main -complete -goversion go1.12.5 -D _$WORK -c=4 ./swig_intsize.go\ncd /mnt/data/src\nswig -go -cgo -intgosize 64 -module libfoo -o $WORK/b001/libfoo_wrap.c -outdir $WORK/b001/ libfoo.swig\nCGO_LDFLAGS='\"-g\" \"-O2\"' /opt/go/pkg/tool/linux_amd64/cgo -objdir $WORK/b001/ -importpath _/mnt/data/src -- -I $WORK/b001/ -g -O2 ./lib.go $WORK/b001/_libfoo_swig.go\ncd $WORK\ngcc -fno-caret-diagnostics -c -x c - || true\ngcc -Qunused-arguments -c -x c - || true\ngcc -fdebug-prefix-map=a=b -c -x c - || true\ngcc -gno-record-gcc-switches -c -x c - || true\ncd $WORK/b001\nTERM='dumb' gcc -I /mnt/data/src -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -I ./ -g -O2 -o ./_x001.o -c _cgo_export.c\nTERM='dumb' gcc -I /mnt/data/src -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -I ./ -g -O2 -o ./_x002.o -c lib.cgo2.c\nTERM='dumb' gcc -I /mnt/data/src -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -I ./ -g -O2 -o ./_x003.o -c _libfoo_swig.cgo2.c\nTERM='dumb' gcc -I /mnt/data/src -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -I ./ -g -O2 -o ./_x004.o -c libfoo_wrap.c\nTERM='dumb' gcc -I /mnt/data/src -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -I ./ -g -O2 -o ./_cgo_main.o -c _cgo_main.c\ncd /mnt/data/src\nTERM='dumb' gcc -I . -fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK/b001=/tmp/go-build -gno-record-gcc-switches -o $WORK/b001/_cgo_.o $WORK/b001/_cgo_main.o $WORK/b001/_x001.o $WORK/b001/_x002.o $WORK/b001/_x003.o $WORK/b001/_x004.o -g -O2\n# _/mnt/data/src\n/tmp/go-build551116655/b001/_x004.o: In function `_wrap_foo_libfoo_0f106433f15c8754':\n/tmp/go-build/libfoo_wrap.c:255: undefined reference to `foo'\ncollect2: error: ld returned 1 exit status\n</code></pre>\n\n<p>If I set the CGO_LDFLAGS using an environment variable, it works. However I want to be able to just use \"go get\" without having those variables before.</p>\n\n<p>I don't understand why go does not take my #cgo directive into account.\nDid I miss something ?</p>\n"}, {"tags": ["macos", "go", "launchd", "launchctl"], "comments": [{"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 1, "creation_date": 1559320720, "post_id": 56398366, "comment_id": 99396069, "body": "Change <code>&lt;key&gt;RunAtLoad&lt;&#47;key&gt;&lt;true&#47;&gt;</code> to <code>&lt;key&gt;RunAtLoad&lt;&#47;key&gt;&lt;false&#47;&gt;</code> and start then call <code>launchctl load ....</code>  and <code>launchctl start daemon</code>"}, {"owner": {"reputation": 827, "user_id": 3261253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012303c103f5013add696fbd42b998d4?s=128&d=identicon&r=PG&f=1", "display_name": "agillgilla", "link": "https://stackoverflow.com/users/3261253/agillgilla"}, "reply_to_user": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1559322412, "post_id": 56398366, "comment_id": 99396769, "body": "@George Oikonomou That doesn&#39;t work.  The binary is already running.  I don&#39;t want to start it manually with launchctl.  All I want to do is dynamically enable/disable running a program at startup without restarting the program or creating another instance of it."}, {"owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "edited": false, "score": 0, "creation_date": 1559324150, "post_id": 56398366, "comment_id": 99397473, "body": "launchctl should start a new instance if the main process of your software is still around. Are you using any kind of subprocess or forks (daemonize)?"}], "answers": [{"tags": [], "owner": {"reputation": 827, "user_id": 3261253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012303c103f5013add696fbd42b998d4?s=128&d=identicon&r=PG&f=1", "display_name": "agillgilla", "link": "https://stackoverflow.com/users/3261253/agillgilla"}, "is_accepted": true, "score": 0, "last_activity_date": 1559324437, "creation_date": 1559324437, "answer_id": 56399585, "question_id": 56398366, "link": "https://stackoverflow.com/questions/56398366/how-to-set-already-running-binary-to-run-at-startup/56399585#56399585", "title": "How to set already running binary to run at startup", "body": "<p>I figured it out.</p>\n\n<p>So first, the binary is running.  It starts out as not enabled to run at startup.  To initialize, you <code>cp</code> the <code>plist</code> to the <code>~/Library/LaunchAgents/</code> directory:</p>\n\n<pre><code>cp daemon.plist ~/Library/LaunchAgents/daemon.plist\n</code></pre>\n\n<p>And the <code>plist</code> looks like this:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;\n&lt;plist version=\"1.0\"&gt;\n&lt;dict&gt;\n    &lt;key&gt;Label&lt;/key&gt;\n    &lt;string&gt;daemon&lt;/string&gt;\n    &lt;key&gt;ProgramArguments&lt;/key&gt;\n    &lt;array&gt;\n        &lt;string&gt;/Applications/Daemon.app/Contents/MacOS/daemon&lt;/string&gt;\n    &lt;/array&gt;\n    &lt;key&gt;ProcessType&lt;/key&gt;\n    &lt;string&gt;Interactive&lt;/string&gt;\n    &lt;key&gt;RunAtLoad&lt;/key&gt;\n    &lt;false/&gt;\n    &lt;key&gt;KeepAlive&lt;/key&gt;\n    &lt;false/&gt;\n&lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre>\n\n<p><strong>NOTE: The <code>RunAtLoad</code> key is set to <code>false</code>.</strong></p>\n\n<p>Then we load it into <code>launchctl</code>:</p>\n\n<pre><code>launchctl load -w ~/Library/LaunchAgents/daemon.plist\n</code></pre>\n\n<p>It shouldn't load since <code>RunAtLoad</code> is set to <code>false</code>.</p>\n\n<p>Then, we can enable and disable running at startup like so:</p>\n\n<p>To enable:</p>\n\n<ul>\n<li>Set <code>RunAtLoad</code> to <code>true</code></li>\n<li><code>cp</code> the <code>plist</code> over</li>\n</ul>\n\n<p>To disable:</p>\n\n<ul>\n<li>Set <code>RunAtLoad</code> to <code>false</code></li>\n<li><code>cp</code> the <code>plist</code> over</li>\n</ul>\n\n<p>Kind of hacky, but it works.</p>\n"}], "owner": {"reputation": 827, "user_id": 3261253, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/012303c103f5013add696fbd42b998d4?s=128&d=identicon&r=PG&f=1", "display_name": "agillgilla", "link": "https://stackoverflow.com/users/3261253/agillgilla"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 215, "favorite_count": 0, "accepted_answer_id": 56399585, "answer_count": 1, "score": 0, "last_activity_date": 1559324437, "creation_date": 1559318435, "last_edit_date": 1559321060, "question_id": 56398366, "link": "https://stackoverflow.com/questions/56398366/how-to-set-already-running-binary-to-run-at-startup", "title": "How to set already running binary to run at startup", "body": "<p>I have a Go program that is supposed to run as a daemon with minimal front-end for the user (just an icon in the system tray.)</p>\n\n<p>The fact that it's written in Go doesn't really matter much, the main issue I have is getting a binary (that is already running) to run at startup on a Mac.</p>\n\n<p>I can set the binary to run at startup like so:</p>\n\n<pre><code>cp daemon.plist ~/Library/LaunchAgents/daemon.plist\n</code></pre>\n\n<p>(<code>cp</code> the plist into the LaunchAgents directory)</p>\n\n<pre><code>launchctl load -w ~/Library/LaunchAgents/daemon.plist\n</code></pre>\n\n<p>(then load the plist with <code>launchctl</code>.)</p>\n\n<p>And that works fine.  The only issue is that <code>launchctl load</code> <strong>it starts another instance of the binary that is already running</strong>.  I want to be able to enable (and disable) running the binary at startup for the binary that is running, without starting another instance of it.</p>\n\n<p>And here's the <code>.plist</code> file if you want to see it:</p>\n\n<pre><code>&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;\n&lt;!DOCTYPE plist PUBLIC \"-//Apple//DTD PLIST 1.0//EN\" \"http://www.apple.com/DTDs/PropertyList-1.0.dtd\"&gt;\n&lt;plist version=\"1.0\"&gt;\n&lt;dict&gt;\n    &lt;key&gt;Label&lt;/key&gt;\n    &lt;string&gt;daemon&lt;/string&gt;\n    &lt;key&gt;ProgramArguments&lt;/key&gt;\n    &lt;array&gt;\n        &lt;string&gt;/Applications/Daemon.app/Contents/MacOS/daemon&lt;/string&gt;\n    &lt;/array&gt;\n    &lt;key&gt;ProcessType&lt;/key&gt;\n    &lt;string&gt;Interactive&lt;/string&gt;\n    &lt;key&gt;RunAtLoad&lt;/key&gt;\n    &lt;true/&gt;\n    &lt;key&gt;KeepAlive&lt;/key&gt;\n    &lt;false/&gt;\n&lt;/dict&gt;\n&lt;/plist&gt;\n</code></pre>\n"}, {"tags": ["javascript", "go", "webassembly"], "comments": [{"owner": {"reputation": 196, "user_id": 7486476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TaxLK.jpg?s=128&g=1", "display_name": "krlc", "link": "https://stackoverflow.com/users/7486476/krlc"}, "edited": false, "score": 0, "creation_date": 1559377274, "post_id": 56398142, "comment_id": 99407844, "body": "The only working solution I found is to make <code>add()</code> a global JS function, by using <code>js.Global().Set(&quot;add&quot;, js.FuncOf(add))</code>, and changing <code>add()</code> signature to <code>func add(this js.Value, args []js.Value) interface{}</code>, and then using <code>add</code> in a global JS scope, which is, in my opinion, kind of <i>dirty</i>"}, {"owner": {"reputation": 2296, "user_id": 4209136, "user_type": "registered", "profile_image": "https://graph.facebook.com/100000376796894/picture?type=large", "display_name": "bigless", "link": "https://stackoverflow.com/users/4209136/bigless"}, "edited": false, "score": 0, "creation_date": 1560563916, "post_id": 56398142, "comment_id": 99789414, "body": "It has own unresolved <a href=\"https://github.com/golang/go/issues/25612\" rel=\"nofollow noreferrer\">issue in Golang repo</a>"}], "answers": [{"tags": [], "owner": {"reputation": 4702, "user_id": 1108098, "user_type": "registered", "accept_rate": 73, "profile_image": "https://www.gravatar.com/avatar/9201c501532256286e60080ce8739045?s=128&d=identicon&r=PG", "display_name": "jordiburgos", "link": "https://stackoverflow.com/users/1108098/jordiburgos"}, "is_accepted": false, "score": 5, "last_activity_date": 1564652188, "creation_date": 1564652188, "answer_id": 57306053, "question_id": 56398142, "link": "https://stackoverflow.com/questions/56398142/is-it-possible-to-explicitly-call-an-exported-go-webassembly-function-from-js/57306053#57306053", "title": "Is it possible to explicitly call an exported Go WebAssembly function from JS?", "body": "<p>Yes, it is possible. You can \"export\" a function to the global context (i.e. window in browser, global in nodejs):</p>\n\n<pre><code>js.Global().Set(\"add\", js.FuncOf(addFunction))\n</code></pre>\n\n<p>Where \"add\" is the name that you can use to call the function from Javascript (window.add) and \"addFunction\" is a Go function in your Go code, next to your main.</p>\n\n<p>Note that \"addFunction\" must follow that method signature:</p>\n\n<pre><code>package main\n\nimport (\n    \"syscall/js\"\n)\n\nfunc addFunction(this js.Value, p []js.Value) interface{} {\n    sum := p[0].Int() + p[1].Int()\n    return js.ValueOf(sum)\n}\n\nfunc main() {\n    c := make(chan struct{}, 0)\n\n    js.Global().Set(\"add\", js.FuncOf(addFunction))\n\n    &lt;-c\n}\n</code></pre>\n\n<p>After \"go.run(result.instance);\" you can run.</p>\n\n<pre><code>go.run(result.instance);\nadd(100,200);\n</code></pre>\n"}], "owner": {"reputation": 196, "user_id": 7486476, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/TaxLK.jpg?s=128&g=1", "display_name": "krlc", "link": "https://stackoverflow.com/users/7486476/krlc"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1414, "favorite_count": 4, "answer_count": 1, "score": 7, "last_activity_date": 1564652188, "creation_date": 1559317539, "last_edit_date": 1559321144, "question_id": 56398142, "link": "https://stackoverflow.com/questions/56398142/is-it-possible-to-explicitly-call-an-exported-go-webassembly-function-from-js", "title": "Is it possible to explicitly call an exported Go WebAssembly function from JS?", "body": "<p><strong>Is it possible to call a Go WebAssembly function, other than <code>main</code>, in Javascript?</strong></p>\n\n<p>Let me first show what I did. My Go functions are defined as follows:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport \"fmt\"\n\nfunc main() {\n    fmt.Println(\"it works!\")\n}\n\nfunc add(a, b int) int {\n    return a + b\n}\n</code></pre>\n\n<p>I can only invoke the <code>main</code> function:</p>\n\n<pre class=\"lang-js prettyprint-override\"><code>const go = new Go();\n\nconst data   = await fetch(\"http://localhost:3333/main.wasm\");\nconst result = await WebAssembly.instantiateStreaming(data, go.importObject);\n\ngo.run(result.instance);\n</code></pre>\n\n<p>which returns <code>it works!</code> as expected.</p>\n\n<p>However, whenever I try to invoke the <code>add</code> function, I receive <code>TypeError: Cannot read property 'add' of undefined at Welcome.getWasm</code>, because both <code>result.exports</code>, <code>result.instance.exports</code> do not contain my function. I also tried capitalizing the Go function, but at no avail.</p>\n\n<p>Thus, I started wondering what could be a problem \u2013 <strong>is it even possible to call a random Go function from Javascript?</strong> Or can I only call the default <code>main()</code> function?</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 5, "creation_date": 1559317008, "post_id": 56397903, "comment_id": 99394509, "body": "The shorthand operator <code>:=</code> <i>always</i> creates a new variable. If you want to use an existing variable, use <code>=</code>."}, {"owner": {"reputation": 546, "user_id": 1128094, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/0u2o6.png?s=128&g=1", "display_name": "sabbir", "link": "https://stackoverflow.com/users/1128094/sabbir"}, "reply_to_user": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 0, "creation_date": 1559317497, "post_id": 56397903, "comment_id": 99394751, "body": "OK that explains. I interpreted the ability to use existing variable name to the left of short hand operator in different way. Thanks!"}], "answers": [{"tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 1, "last_activity_date": 1559322169, "creation_date": 1559322169, "answer_id": 56399118, "question_id": 56397903, "link": "https://stackoverflow.com/questions/56397903/use-package-variable-instead-of-creating-local-variable/56399118#56399118", "title": "Use Package variable instead of creating local variable", "body": "<p>The <code>:=</code> operator always creates new variables. You can it like this:</p>\n\n<pre><code>var name string\n\nfunc init() {\n   name = \"ginny\"\n}\n\nfunc test() {\n   var err error\n   name, err = ...&lt;some method&gt;..\n}\n</code></pre>\n"}], "owner": {"reputation": 546, "user_id": 1128094, "user_type": "registered", "accept_rate": 0, "profile_image": "https://i.stack.imgur.com/0u2o6.png?s=128&g=1", "display_name": "sabbir", "link": "https://stackoverflow.com/users/1128094/sabbir"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 61, "favorite_count": 0, "accepted_answer_id": 56399118, "answer_count": 1, "score": 1, "last_activity_date": 1559322169, "creation_date": 1559316587, "last_edit_date": 1559321083, "question_id": 56397903, "link": "https://stackoverflow.com/questions/56397903/use-package-variable-instead-of-creating-local-variable", "title": "Use Package variable instead of creating local variable", "body": "<p>Consider following code snippet:</p>\n\n<pre><code>var name string\n\nfunc init() {\n   name = \"ginny\"\n}\n\nfunc test() {\n   name, err := ...&lt;some method&gt;..\n}\n</code></pre>\n\n<p>In the method test, <strong>name</strong> is created as new local variable.</p>\n\n<p>How do I make the test method to use the package variable <strong>name</strong> instead of creating new local variable?</p>\n"}, {"tags": ["mysql", "go", "timezone", "timestamp-with-timezone"], "comments": [{"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1559369497, "post_id": 56397882, "comment_id": 99406584, "body": "The system time zone should <code>America&#47;Chicago</code>.  If it&#39;s <code>CDT</code>, it&#39;s likely set wrong on the system.  What OS is the system anyway?"}, {"owner": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1559369591, "post_id": 56397882, "comment_id": 99406593, "body": "Keep in mind that time zone abbreviations can sometimes be derived from time zone identifiers, but not usually the other way around.  There&#39;s just too much ambiguity.  The C in CST could just as well be for China or Cuba."}, {"owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "reply_to_user": {"reputation": 195413, "user_id": 634824, "user_type": "registered", "accept_rate": 87, "profile_image": "https://www.gravatar.com/avatar/889cf720c96957e615463b5c903a5e18?s=128&d=identicon&r=PG", "display_name": "Matt Johnson-Pint", "link": "https://stackoverflow.com/users/634824/matt-johnson-pint"}, "edited": false, "score": 0, "creation_date": 1562179007, "post_id": 56397882, "comment_id": 100300831, "body": "@MattJohnson yep - that&#39;s the conclusion I came to also. Rather than reverse engineer how MySQL reports the timezone, the simplest approach was to normalize the time from within the SQL query, so <code>go</code> would get UTC times and thus not need to be converted."}], "answers": [{"tags": [], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "is_accepted": false, "score": 0, "last_activity_date": 1560005455, "creation_date": 1560005455, "answer_id": 56507430, "question_id": 56397882, "link": "https://stackoverflow.com/questions/56397882/timezone-reconciliation-with-sql/56507430#56507430", "title": "timezone reconciliation with SQL", "body": "<h3>1/3</h3>\n\n<p><code>go</code> uses IANA's <a href=\"https://www.iana.org/time-zones\" rel=\"nofollow noreferrer\">Time Zone Database</a> with precise zone names.\nTrying to reverse engineer how MySQL determines the local timezone format from a (Linux) host and duplicate that logic in a <code>go</code> clients - as @MattJohnson pointed out - proves to be unreliable.</p>\n\n<h3>2/3</h3>\n\n<p><code>database/sql.DB</code> - created via <code>Open(drv, DSN)</code> - will use the same <code>DSN</code> for all connections. While an <code>sql.DB</code> is meant to be created once and used many times - there is no way to change the <code>DSN</code> after the fact - so one would need to create a brand new <code>sql.DB</code> when changing the <code>DSN</code>.</p>\n\n<h3>3/3</h3>\n\n<p>So the better tack, appears to leverage <code>MySQL</code> to convert all <code>datetime</code> values from local to UTC timezone before transmission to the client. This removes the complication of setting the database's (possibly unknown) timezone at connection time via the <code>DSN</code>.</p>\n\n<p>One promising option, is to set the connection's session timezone:</p>\n\n<ul>\n<li><code>SET @@session.time_zone = \"+00:00\";</code></li>\n<li>however, this only works for the <em>current</em> connection (within the connection pool). A <code>go</code> client however will not know which free connection they may be using at any give time.</li>\n<li>So to ensure this always works, one would need to apply it manually before <strong><em>all queries</em></strong>. Even if only one DB connection is in use - if the connection fails and connection retry kicks in - any previous session state would be lost.</li>\n</ul>\n\n<p>So instead, wrapping all <code>datatime</code> columns with a conversion function like so:</p>\n\n<pre><code>CONVERT_TZ(`STAMP_UPDATED`,@@session.time_zone,'+00:00')\n</code></pre>\n\n<p>ensures the timezone calculation is done at query time and will not be lost during a connection reconnection etc.</p>\n\n<p>So now the <code>DSN</code> no longer needs to specify <code>loc</code> - as <code>UTC</code> is the default. In fact the <code>DSN</code> only needs the suffix option of <code>?parseTime=true</code> to allow the <code>datetime</code> to be translated into <code>go</code>'s native <code>time.Time</code>.</p>\n\n<p>Finally and most importantly, this will work with any server set to any timezone.</p>\n\n<p>H/T to this <a href=\"https://stackoverflow.com/a/19069310/1218512\">answer</a>.</p>\n"}], "owner": {"reputation": 7788, "user_id": 1218512, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/f40bbe64fcdaa806d999fe25dffc0690?s=128&d=identicon&r=PG", "display_name": "colm.anseo", "link": "https://stackoverflow.com/users/1218512/colm-anseo"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 115, "favorite_count": 0, "answer_count": 1, "score": -1, "last_activity_date": 1560005455, "creation_date": 1559316479, "question_id": 56397882, "link": "https://stackoverflow.com/questions/56397882/timezone-reconciliation-with-sql", "title": "timezone reconciliation with SQL", "body": "<h3>Question 1/3:</h3>\n\n<p>I have a number of <code>MySQL</code> databases to connect to and want to ensure time consistency across queries. So for example, one of these servers is currently in the <code>CDT</code> timezone.</p>\n\n<pre><code>&gt; select CURRENT_TIMESTAMP, @@system_time_zone, @@global.time_zone, @@session.time_zone;\n\n+---------------------+--------------------+--------------------+---------------------+\n| CURRENT_TIMESTAMP   | @@system_time_zone | @@global.time_zone | @@session.time_zone |\n+---------------------+--------------------+--------------------+---------------------+\n| 2019-05-31 09:44:45 | CDT                | SYSTEM             | SYSTEM              |\n+---------------------+--------------------+--------------------+---------------------+\n</code></pre>\n\n<p>Note: We're in <code>DST</code> right now, so it's <code>CDT</code>. I'm <em>assuming</em> this would automatically change to <code>CST</code> when outside <code>DST</code>, right?</p>\n\n<p>So with the above knowledge, my <code>DSN</code> suffix looks something like this:</p>\n\n<pre><code>...?parseTime=true&amp;loc=America%2FChicago // i.e. 'America/Chicago' - maybe 'CST6CDT' would work too?\n</code></pre>\n\n<p>So, is there a programatic way in <code>go</code> to map from the 3-letter code <code>CDT</code> to the more formal timezone names like <code>America/Chicago</code>.</p>\n\n<h3>2/3:</h3>\n\n<p>The above presents a chicken/egg scenario: in order to determine the remote server's timezone, one needs to connect/query the server; with that knowledge the DSN parameters may change for future calls.</p>\n\n<p>Can DSN parameters be changed after the fact, or does a brand new connection <code>sql.DB</code> connection pool need to be created?</p>\n\n<h3>3/3:</h3>\n\n<p>You may ask, why check to see if the timezone has changed - isn't it static? What should one do in a Load-Balanced DB situation? Two replicas could in theory be in differing timezones?</p>\n\n<p>Should all columns with timestamps just be wrapped with an SQL <code>UNIX_TIMESTAMP()</code> to normalize the data and avoid this headache?</p>\n\n<p>I could get into time-drifts too, but I'll stop here for now.</p>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1559314646, "post_id": 56397402, "comment_id": 99393304, "body": "What do you mean, &quot;integers separated by a space&quot;? Is it a string? In your python example you have something different"}, {"owner": {"reputation": 29, "user_id": 7623767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YkfVX.jpg?s=128&g=1", "display_name": "Mohammed Ali", "link": "https://stackoverflow.com/users/7623767/mohammed-ali"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559314822, "post_id": 56397402, "comment_id": 99393387, "body": "My bad I&#39;ll edit the original post. I already converted the values into the list in Python. In Golang, the input is just numbers separated by a space as shown above."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 3, "creation_date": 1559315421, "post_id": 56397402, "comment_id": 99393696, "body": "&quot;All I can figure is that I have to put the numbers into a slice then apply the function to each of the numbers.&quot; - yes, that is precisely what you need to do. Which of these two parts do you have problems with?"}, {"owner": {"reputation": 29, "user_id": 7623767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YkfVX.jpg?s=128&g=1", "display_name": "Mohammed Ali", "link": "https://stackoverflow.com/users/7623767/mohammed-ali"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559315654, "post_id": 56397402, "comment_id": 99393820, "body": "Applying the function to the numbers, I don&#39;t know how to go about doing this."}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 2, "creation_date": 1559315868, "post_id": 56397402, "comment_id": 99393947, "body": "It&#39;s actually very easy. <code>b := make([]int, 0); for _, x in range n { b = append(b, x * x) }</code>"}, {"owner": {"reputation": 29, "user_id": 7623767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YkfVX.jpg?s=128&g=1", "display_name": "Mohammed Ali", "link": "https://stackoverflow.com/users/7623767/mohammed-ali"}, "reply_to_user": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 0, "creation_date": 1559316751, "post_id": 56397402, "comment_id": 99394391, "body": "Thank you so much, Is there any way to do this with a recursion instead?"}, {"owner": {"reputation": 209014, "user_id": 125816, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/7f5aa40b1e7a95599c7a19451f88ff3a?s=128&d=identicon&r=PG", "display_name": "Sergio Tulentsev", "link": "https://stackoverflow.com/users/125816/sergio-tulentsev"}, "edited": false, "score": 1, "creation_date": 1559317114, "post_id": 56397402, "comment_id": 99394554, "body": "Yes, there is, quite easy too. Let it be your homework :)"}], "answers": [{"tags": [], "owner": {"reputation": 3321, "user_id": 7450049, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/10f14acd868cb2fd0a35a7d2084eed5d?s=128&d=identicon&r=PG", "display_name": "Vitaly Migunov", "link": "https://stackoverflow.com/users/7450049/vitaly-migunov"}, "is_accepted": false, "score": 0, "last_activity_date": 1559316535, "creation_date": 1559316535, "answer_id": 56397895, "question_id": 56397402, "link": "https://stackoverflow.com/questions/56397402/how-to-apply-a-function-to-an-input-of-integers-in-golang/56397895#56397895", "title": "How to apply a function to an input of integers in Golang", "body": "<p>You can do it like this if your integers are actually a string separated by spaces.</p>\n\n<pre><code>package main\n\nimport \"fmt\"\nimport \"strings\"\nimport \"strconv\"\n\nfunc main() {\n    numbers := \"1 3 4 5\"\n    var n []int\n    for _, v := range strings.Fields(numbers) {\n        i, err := strconv.Atoi(v)\n        if err != nil {\n            fmt.Println(err.Error())\n            break\n        }\n        n = append(n, i*i)\n    }\n    fmt.Println(n)\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/JcivNd29Gzg\" rel=\"nofollow noreferrer\">https://play.golang.org/p/JcivNd29Gzg</a></p>\n"}, {"tags": [], "owner": {"reputation": 556, "user_id": 3922951, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/724ac1836bf5cfe12089e7b33bfed239?s=128&d=identicon&r=PG&f=1", "display_name": "Chus", "link": "https://stackoverflow.com/users/3922951/chus"}, "is_accepted": false, "score": 0, "last_activity_date": 1559316733, "creation_date": 1559316733, "answer_id": 56397935, "question_id": 56397402, "link": "https://stackoverflow.com/questions/56397402/how-to-apply-a-function-to-an-input-of-integers-in-golang/56397935#56397935", "title": "How to apply a function to an input of integers in Golang", "body": "<pre><code>package main\n\nimport (\n \"strconv\"\n \"fmt\"\n \"strings\"\n)\n\nfunc main() {\nstringwithnumbers := \"1 2 3 4 5\"\nnumberarray := strings.Split(stringwithnumbers, \" \")\n\nstringwithnumbers = \"\"\n\nfor _, number := range numberarray {\n    numbernew,err := strconv.Atoi(number)\n    if err != nil{\n    return\n    }\n\n    numbernew = numbernew * 2\n    stringwithnumbers += strconv.Itoa(numbernew)\n    stringwithnumbers += \" \"\n}\n\nstringwithnumbers = strings.Trim(stringwithnumbers, \" \")\n\n//You can check the result...\nfmt.Print(stringwithnumbers)\n}\n</code></pre>\n\n<p>You can check the code and your changes here:\n<a href=\"https://play.golang.org/\" rel=\"nofollow noreferrer\">https://play.golang.org/</a></p>\n"}], "owner": {"reputation": 29, "user_id": 7623767, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/YkfVX.jpg?s=128&g=1", "display_name": "Mohammed Ali", "link": "https://stackoverflow.com/users/7623767/mohammed-ali"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 208, "favorite_count": 0, "answer_count": 2, "score": -2, "last_activity_date": 1559316733, "creation_date": 1559314564, "last_edit_date": 1559314886, "question_id": 56397402, "link": "https://stackoverflow.com/questions/56397402/how-to-apply-a-function-to-an-input-of-integers-in-golang", "title": "How to apply a function to an input of integers in Golang", "body": "<p>For example, if the input was this</p>\n\n<pre><code>1 3 4 5\n</code></pre>\n\n<p>all separated by a space, I want to apply the function of squaring each individual number then adding it.</p>\n\n<p>I just don't know how to apply the function to each number. All I can figure is that I have to put the numbers into a slice then apply the function to each of the numbers. I have looked everywhere and can't find out how to do this.</p>\n\n<p>in Python I just do it like this and I already put the values into a list called \"n\".</p>\n\n<pre><code>#The list is pasted from the initial puzzle\nn=[10, 10, 9, 8, 10, 10, 10]\n\n# The list is first squared\nb = (list(map(lambda x:x**2,n)))\n</code></pre>\n\n<p>b becomes the new list where the function is done to each number.</p>\n"}, {"tags": ["unit-testing", "go"], "comments": [{"owner": {"reputation": 32095, "user_id": 7426, "user_type": "registered", "profile_image": "https://www.gravatar.com/avatar/5a562698800b535e47b68590f63c402a?s=128&d=identicon&r=PG", "display_name": "Adrian", "link": "https://stackoverflow.com/users/7426/adrian"}, "edited": false, "score": 3, "creation_date": 1559314426, "post_id": 56397240, "comment_id": 99393177, "body": "The &quot;correct&quot; way would be for it to take in a <code>io.Reader</code> instead of a file path, so that you can pass an in-memory buffer of test data in tests, and an <code>os.File</code> in production code."}], "answers": [{"comments": [{"owner": {"reputation": 359, "user_id": 2126218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/600beb8d18f926727bec4e9b37e6cda3?s=128&d=identicon&r=PG", "display_name": "jsm1th", "link": "https://stackoverflow.com/users/2126218/jsm1th"}, "edited": false, "score": 1, "creation_date": 1559394518, "post_id": 56398447, "comment_id": 99411249, "body": "This is working nicely and cleaned up <code>openAndReadFile</code> as well which I was thinking needed to happen."}], "tags": [], "owner": {"reputation": 4173, "user_id": 1199408, "user_type": "registered", "accept_rate": 33, "profile_image": "https://i.stack.imgur.com/5HJv7.jpg?s=128&g=1", "display_name": "georgeok", "link": "https://stackoverflow.com/users/1199408/georgeok"}, "is_accepted": true, "score": 9, "last_activity_date": 1559318776, "creation_date": 1559318776, "answer_id": 56398447, "question_id": 56397240, "link": "https://stackoverflow.com/questions/56397240/unit-test-function-that-is-opening-and-reading-a-file/56398447#56398447", "title": "Unit test function that is opening and reading a file", "body": "<p>You need to refactor your code and make more suitable for testing.</p>\n\n<p>Here is how I would do it:</p>\n\n<pre><code>func openAndReadFile(fileName string) [][]string {\n    file, err := os.Open(fileName)\n    if err != nil {\n        fmt.Printf(\"Failed to open file: %s\", fileName)\n    }\n    lines, err := readFile(file)\n    if err != nil {\n        fmt.Printf(\"Failed to read file: %s\", fileName)\n    }\n    return lines\n}\n\nfunc readFile(reader io.Reader) ([][]string, error) {\n    r := csv.NewReader(reader)\n    lines, err := r.ReadAll()\n    if err != nil {\n        log.Fatal(err)\n    }\n    return lines, err\n}\n</code></pre>\n\n<p>Then for testing you can simply use any data structure that implements the <code>io.reader</code> interface. For example, I use a bytes buffer, but you can choose a network connection:</p>\n\n<pre><code>func TestReadFile(t *testing.T) {\n    var buffer bytes.Buffer\n    buffer.WriteString(\"fake, csv, data\")\n    content, err := readFile(&amp;buffer)\n    if err != nil {\n        t.Error(\"Failed to read csv data\")\n    }\n    fmt.Print(content)\n}\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 4501, "user_id": 5747415, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/WgeaU.jpg?s=128&g=1", "display_name": "Dirk Herrmann", "link": "https://stackoverflow.com/users/5747415/dirk-herrmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1559338702, "creation_date": 1559338702, "answer_id": 56401986, "question_id": 56397240, "link": "https://stackoverflow.com/questions/56397240/unit-test-function-that-is-opening-and-reading-a-file/56401986#56401986", "title": "Unit test function that is opening and reading a file", "body": "<p>The function you have shown is dominated by interactions: Interactions with the file system and interactions with the csv reader.  To be sure that these interactions work nicely you will later anyway have to do some integration-testing against the file system and the csv reader.  Think about which bugs you are hoping to find, and you will see that bugs are more likely on the interaction level: Is the order of file,err correct, or should it be the other way around?  Is nil really the value indicating no error?  Do you have to give more arguments to Open?  etc.</p>\n\n<p>Therefore, I would not concentrate on unit-testing this function.  However, this function is a good candidate to be mocked to make unit-testing the surrounding code easier.  Thus, mock <code>openAndReadFile</code> to unit-test the surrounding code, and test <code>openAndReadFile</code> using integration-testing.</p>\n"}, {"tags": [], "owner": {"reputation": 15599, "user_id": 73831, "user_type": "registered", "accept_rate": 93, "profile_image": "https://www.gravatar.com/avatar/4813b578ef6e0ca5ba25a77f57fdb5f1?s=128&d=identicon&r=PG", "display_name": "Sudhir Jonathan", "link": "https://stackoverflow.com/users/73831/sudhir-jonathan"}, "is_accepted": false, "score": 0, "last_activity_date": 1559387335, "creation_date": 1559387335, "answer_id": 56406175, "question_id": 56397240, "link": "https://stackoverflow.com/questions/56397240/unit-test-function-that-is-opening-and-reading-a-file/56406175#56406175", "title": "Unit test function that is opening and reading a file", "body": "<p>I'd strongly suggest using an interface instead of the filename string like the other answers here are recommending, but if you really must do this the only way is likely with a <a href=\"https://golang.org/pkg/io/ioutil/#TempFile\" rel=\"nofollow noreferrer\">temp file</a>. The decision to use a string file name has locked the code into assuming something to be present on the file system and has pushed in the responsibility of file management. </p>\n"}], "owner": {"reputation": 359, "user_id": 2126218, "user_type": "registered", "accept_rate": 62, "profile_image": "https://www.gravatar.com/avatar/600beb8d18f926727bec4e9b37e6cda3?s=128&d=identicon&r=PG", "display_name": "jsm1th", "link": "https://stackoverflow.com/users/2126218/jsm1th"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 3608, "favorite_count": 1, "accepted_answer_id": 56398447, "answer_count": 3, "score": 6, "last_activity_date": 1559387335, "creation_date": 1559314000, "question_id": 56397240, "link": "https://stackoverflow.com/questions/56397240/unit-test-function-that-is-opening-and-reading-a-file", "title": "Unit test function that is opening and reading a file", "body": "<p>I am working on learning go with a simple program that is doing some file reading and am working on adding unit testing to my program. I have ran into an issue/question while doing this. I want to unit test the function below and my question is that the function takes a name of the file which is then opened and processed. During testing I do not want to actually pass it a real file. I am wondering is this something I can somehow mock so that I can just pass it a \"fake\" file and have it process that instead? Thanks!    </p>\n\n<pre><code>func openAndReadFile(fileName string) [][]string {\n    file, err := os.Open(fileName)\n    if err != nil {\n        fmt.Printf(\"Failed to read file: %s\", fileName)\n    }\n    r := csv.NewReader(file)\n    lines, err := r.ReadAll()\n    if err != nil {\n        log.Fatal(err)\n    }\n    return lines\n}\n</code></pre>\n"}, {"tags": ["go", "gomail"], "comments": [{"owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1559422022, "post_id": 56397055, "comment_id": 99417722, "body": "I&#39;ve never encountered a &#39;Send-As&#39; header in emails - where is this documented? Are you sure it exists? Normally extensions to headers have an X- prefix. Also, there is no mention of this in google docs that I can see. You simply set the from address in your client (in this case gomail) and if setup it should work. <a href=\"https://support.google.com/mail/answer/22370\" rel=\"nofollow noreferrer\">support.google.com/mail/answer/22370</a>"}, {"owner": {"reputation": 3, "user_id": 1742163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1bcph.jpg?s=128&g=1", "display_name": "Maxwell Morin", "link": "https://stackoverflow.com/users/1742163/maxwell-morin"}, "reply_to_user": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "edited": false, "score": 0, "creation_date": 1559751756, "post_id": 56397055, "comment_id": 99520471, "body": "Found the documentation here: <a href=\"https://developers.google.com/gmail/api/v1/reference/\" rel=\"nofollow noreferrer\">developers.google.com/gmail/api/v1/reference</a> Search for &#39;send-as&#39;."}], "answers": [{"tags": [], "owner": {"reputation": 8142, "user_id": 1601137, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/VbZbR.jpg?s=128&g=1", "display_name": "Kenny Grant", "link": "https://stackoverflow.com/users/1601137/kenny-grant"}, "is_accepted": true, "score": 0, "last_activity_date": 1559754375, "creation_date": 1559754375, "answer_id": 56465038, "question_id": 56397055, "link": "https://stackoverflow.com/questions/56397055/how-to-set-send-as-email-address-using-gomail/56465038#56465038", "title": "How to set send-as email address using gomail", "body": "<p>The docs for the google api you linked do not talk about setting a mime header - there is no such thing as far as I can see. So setting a \"SendAs\" mime header on the email is not going to have any effect.</p>\n\n<p>You are using gomail - the <a href=\"https://github.com/go-gomail/gomail\" rel=\"nofollow noreferrer\">github repo</a> for it states 'Gomail can only send emails using an SMTP server' - that means it's not using the api you have linked (which has nothing to do with mime headers). </p>\n\n<p>What may work for you instead is simply setting the from address to the address you have already set up on your google account as a sender, and using gomail to send via your google account. </p>\n"}], "owner": {"reputation": 3, "user_id": 1742163, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/1bcph.jpg?s=128&g=1", "display_name": "Maxwell Morin", "link": "https://stackoverflow.com/users/1742163/maxwell-morin"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 316, "favorite_count": 0, "accepted_answer_id": 56465038, "answer_count": 1, "score": 0, "last_activity_date": 1559754375, "creation_date": 1559313247, "question_id": 56397055, "link": "https://stackoverflow.com/questions/56397055/how-to-set-send-as-email-address-using-gomail", "title": "How to set send-as email address using gomail", "body": "<p>I am trying to send email using <code>gomail</code> and need to set the send-as emailed address. I found the link to set the reply-to address, which is close, but not exactly what I'm looking for. </p>\n\n<p>Send-as is a function that I know GMail supports, others prob do as well. I have send-as already configured in GMail itself and working correctly, just trying to see if I can set it via <code>gomail</code></p>\n\n<p>I have tried the following:</p>\n\n<p>Read through the docs for <code>gomail</code></p>\n\n<pre><code>m.SetHeader(\"SendAs\", emailAddress)\nm.SetHeader(\"Send-As\", emailAddress)\nm.SetHeader(\"sendAs\", emailAddress)\nm.SetAddressHeader(\"SendAs\", emailAddress, \"\")\nm.SetAddressHeader(\"Send-As\", emailAddress, \"\")\nm.SetAddressHeader(\"sendAs\", emailAddress, \"\")\n</code></pre>\n\n<pre class=\"lang-golang prettyprint-override\"><code>func TestEmail(to, from, cc, bcc, subject, message, password, fileName string) (string, error) {\n    // We need to parse the TO, CC, and BCC lists, which may contain more than one email address each.\n    splitToField := strings.Split(to, \",\")\n    splitCCField := strings.Split(cc, \",\")\n    splitBCCField := strings.Split(bcc, \",\")\n\n    m := gomail.NewMessage()\n    m.SetHeader(\"From\", from)\n    m.SetHeader(\"To\", splitToField...)\n    // If there is a CC address(s), then add them.\n    if len(cc) &gt; 0 {\n        fmt.Println(\"CC LEN &gt; 0\", len(splitCCField))\n        m.SetHeader(\"Cc\", splitCCField...)\n    }\n    // If there is a BCC address(s), then add them.\n    if len(bcc) &gt; 0 {\n        fmt.Println(\"BCC LEN &gt; 0\", len(splitBCCField))\n        m.SetHeader(\"Bcc\", splitBCCField...)\n    }\n    m.SetHeader(\"Subject\", subject)\n    m.SetBody(\"text/html\", message)\n    m.Attach(\"emailedQuotes/\"+fileName)\n\n    // So far, we configured this to ONLY work with GMail accounts.\n    // Possibly in the future we can add an input on the front end and have them enter\n    // their host/port manually. Or get fancy and parse the email address and have the most common\n    // types in a struct.\n    d := gomail.NewDialer(\"smtp.gmail.com\", 587, from, password)\n\n    err := d.DialAndSend(m)\n    if err != nil {\n        fmt.Println(\"ERROR SENDING EMAIL!\", err)\n        return \"\", err\n    } else {\n        fmt.Println(\"Email successfully sent to: \", to)\n        return \"Email successfully sent to:\" + to, nil\n    }\n}\n</code></pre>\n\n<p>My expectation is that you'll be able to enter in the username/password for the <code>from</code> address and be able to send mail with the <code>from</code> address showing as the <code>send-as</code> address. </p>\n\n<p>If I execute this (with the correct username/password for the <code>from</code> address) it will fire the email correctly, but the <code>send-as</code> doesn't take over the <code>from</code> address. So, doesn't work, but no errors.</p>\n"}, {"tags": ["go", "reflection", "null", "slice"], "comments": [{"owner": {"reputation": 5151, "user_id": 4466350, "user_type": "registered", "accept_rate": 70, "profile_image": "https://www.gravatar.com/avatar/cd5606b873067472e30c5ef5bc2ac5bf?s=128&d=identicon&r=PG&f=1", "display_name": "mh-cbon", "link": "https://stackoverflow.com/users/4466350/mh-cbon"}, "edited": false, "score": 2, "creation_date": 1559312540, "post_id": 56396510, "comment_id": 99392182, "body": "i think you should do a pointer then dereference it. Its what need to be done to create a nil error using golang reflection package. <a href=\"https://stackoverflow.com/a/51092790/4466350\">stackoverflow.com/a/51092790/4466350</a>"}, {"owner": {"reputation": 87059, "user_id": 5728991, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/4kTj8.png?s=128&g=1", "display_name": "Cerise Lim&#243;n", "link": "https://stackoverflow.com/users/5728991/cerise-lim%c3%b3n"}, "edited": false, "score": 1, "creation_date": 1559315864, "post_id": 56396510, "comment_id": 99393945, "body": "Possible duplicate of <a href=\"https://stackoverflow.com/questions/43937731/golang-pass-nil-value-as-an-interface-through-reflection\">Golang pass nil value as an interface through reflection</a>."}], "answers": [{"tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": true, "score": 4, "last_activity_date": 1559313766, "last_edit_date": 1559313766, "creation_date": 1559312532, "answer_id": 56396855, "question_id": 56396510, "link": "https://stackoverflow.com/questions/56396510/how-to-append-nil-to-dynamic-type-slice-by-reflect-append/56396855#56396855", "title": "how to append nil to dynamic type slice by reflect.Append", "body": "<p><code>interface{}</code> is an interface type, and they are \"tricky\". They are wrappers around a concrete value and the concrete type, schematically a (value, type) pair.</p>\n\n<p>So when you pass a concrete value to a function that expects an <code>interface{}</code> value, the concrete value will be wrapped in an <code>interface{}</code> value automatically, implicitly. If you pass a <code>nil</code> to such a function, the interface value itself will be <code>nil</code>. If you pass a <code>nil</code> pointer to it, such as <code>(*int)(nil)</code>, the interface value will not be <code>nil</code> but an interface value holding \"(nil, *int)\".</p>\n\n<p>If you pass <code>nil</code> to <code>reflect.ValueOf()</code>, it results in a \"zero\" <code>reflect.Value</code> which represents no value at all. If you pass this to <code>reflect.Append()</code>, it will not have the type information, it will not know what you want to append to the slice.</p>\n\n<p>It is possible to create a value that represents the <code>nil</code> interface value.</p>\n\n<p>To do that, we may start from the type descriptor of a value of an interface pointer (pointers to interface <em>rarely</em> makes sense, but this is one of them). We navigate to the type descriptor of the pointed type, which is <code>interface{}</code>. We obtain a zero value of this type (using <a href=\"https://golang.org/pkg/reflect/#Zero\" rel=\"nofollow noreferrer\"><code>reflect.Zero()</code></a>), which is <code>nil</code> (zero value of interface types is <code>nil</code>).</p>\n\n<blockquote>\n  <p>Zero returns a Value representing the zero value for the specified type. The result is different from the zero value of the Value struct, which represents no value at all.</p>\n</blockquote>\n\n<p>So this is how it looks like:</p>\n\n<pre><code>typeOfEmptyIface := reflect.TypeOf((*interface{})(nil)).Elem()\nvalueOfZeroEmptyIface := reflect.Zero(typeOfEmptyIface)\nv = reflect.Append(v, valueOfZeroEmptyIface)\n</code></pre>\n\n<p>Or as a single line:</p>\n\n<pre><code>v = reflect.Append(v, reflect.Zero(reflect.TypeOf((*interface{})(nil)).Elem()))\n</code></pre>\n\n<p>To check the results, let's use:</p>\n\n<pre><code>fmt.Printf(\"%#v\\n\", v)\n</code></pre>\n\n<p>And also let's type-assert back the slice, and add a <code>nil</code> value using the builtin <code>append()</code> function:</p>\n\n<pre><code>list = v.Interface().([]interface{})\nlist = append(list, nil)\nfmt.Printf(\"%#v\\n\", list)\n</code></pre>\n\n<p>Let's do an explicit, extra check if the elements are <code>nil</code> (compare them to <code>nil</code>). Although using <code>%#v</code> verb this is redundant, <code>%v</code> likes to print non-<code>nil</code> interfaces holding <code>nil</code> concrete values just as <code>nil</code> (the same as if the interface value itself would be <code>nil</code>).</p>\n\n<pre><code>fmt.Println(list[2] == nil, list[3] == nil)\n</code></pre>\n\n<p>Ouptut will be (try it on the <a href=\"https://play.golang.org/p/Z78TdGyA9lr\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>[]interface {}{1, \"1\", interface {}(nil)}\n[]interface {}{1, \"1\", interface {}(nil), interface {}(nil)}\ntrue true\n</code></pre>\n\n<p>See related question: <a href=\"https://stackoverflow.com/questions/29138591/hiding-nil-values-understanding-why-golang-fails-here/29138676#29138676\">Hiding nil values, understanding why golang fails here</a></p>\n\n<p>Also: <a href=\"https://blog.golang.org/laws-of-reflection\" rel=\"nofollow noreferrer\">The Go Blog: The Laws of Reflection</a></p>\n"}], "owner": {"reputation": 333, "user_id": 5772365, "user_type": "registered", "accept_rate": 86, "profile_image": "https://www.gravatar.com/avatar/e114544cf6b0a39de7e4df2a2d9a0c65?s=128&d=identicon&r=PG", "display_name": "gaoxinge", "link": "https://stackoverflow.com/users/5772365/gaoxinge"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 283, "favorite_count": 0, "accepted_answer_id": 56396855, "answer_count": 1, "score": 1, "last_activity_date": 1559313766, "creation_date": 1559311098, "last_edit_date": 1559313012, "question_id": 56396510, "link": "https://stackoverflow.com/questions/56396510/how-to-append-nil-to-dynamic-type-slice-by-reflect-append", "title": "how to append nil to dynamic type slice by reflect.Append", "body": "<p>Code below will raise a runtime error when append <code>reflect.Value</code> of <code>nil</code>:</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>package main\n\nimport (\n    \"fmt\"\n    \"reflect\"\n)\n\nfunc main() {\n    var list []interface{}\n    v := reflect.ValueOf(list)\n    v = reflect.Append(v, reflect.ValueOf(1))   // [1]\n    v = reflect.Append(v, reflect.ValueOf(\"1\")) // [1, 1]\n    v = reflect.Append(v, reflect.ValueOf(nil)) // runtime error\n    fmt.Println(v)\n}\n</code></pre>\n\n<p>So </p>\n\n<ul>\n<li>why there is a runtime error? </li>\n<li>how can I use <code>reflect.Append</code> to add a <code>nil</code> to <code>interface{}</code> slice?</li>\n</ul>\n"}, {"tags": ["go", "go-xorm"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1559312678, "post_id": 56396386, "comment_id": 99392259, "body": "You&#39;re shadowing over the global <code>orm</code> variable with <code>:=</code> in your main. Use <code>=</code> instead, (predeclare the <code>err</code> to make it work). Or use <code>:=</code> but use different variable name in <code>main</code> then after error check assign that variable to the global, with <code>=</code>."}, {"owner": {"reputation": 343, "user_id": 2035749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af735b1d80ec7eb3b5d311306bb397a4?s=128&d=identicon&r=PG", "display_name": "mispp", "link": "https://stackoverflow.com/users/2035749/mispp"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559314026, "post_id": 56396386, "comment_id": 99392941, "body": "i can&#39;t believe that i didn&#39;t see that. thanks."}], "answers": [{"tags": [], "owner": {"reputation": 343, "user_id": 2035749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af735b1d80ec7eb3b5d311306bb397a4?s=128&d=identicon&r=PG", "display_name": "mispp", "link": "https://stackoverflow.com/users/2035749/mispp"}, "is_accepted": true, "score": 1, "last_activity_date": 1559314308, "creation_date": 1559314308, "answer_id": 56397334, "question_id": 56396386, "link": "https://stackoverflow.com/questions/56396386/xorm-example-not-working-runtime-error-invalid-memory-address-or-nil-pointer/56397334#56397334", "title": "xorm example not working: &quot;runtime error: invalid memory address or nil pointer dereference&quot;", "body": "<p>As noted by <a href=\"https://stackoverflow.com/users/965900/mkopriva\">mkopriva</a>, the problem was using the same variable name for assignment.</p>\n\n<p>Solution for the problem was:</p>\n\n<p>instead of </p>\n\n<pre><code>orm, err := xorm.NewEngine(\"postgres\", connString)\n</code></pre>\n\n<p>use</p>\n\n<pre><code>var err error\norm, err = xorm.NewEngine(\"postgres\", connString)\n</code></pre>\n"}], "owner": {"reputation": 343, "user_id": 2035749, "user_type": "registered", "accept_rate": 100, "profile_image": "https://www.gravatar.com/avatar/af735b1d80ec7eb3b5d311306bb397a4?s=128&d=identicon&r=PG", "display_name": "mispp", "link": "https://stackoverflow.com/users/2035749/mispp"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 223, "favorite_count": 0, "accepted_answer_id": 56397334, "answer_count": 1, "score": 0, "last_activity_date": 1559314308, "creation_date": 1559310618, "question_id": 56396386, "link": "https://stackoverflow.com/questions/56396386/xorm-example-not-working-runtime-error-invalid-memory-address-or-nil-pointer", "title": "xorm example not working: &quot;runtime error: invalid memory address or nil pointer dereference&quot;", "body": "<p>Based on <a href=\"https://github.com/go-xorm/xorm/blob/master/examples/find.go\" rel=\"nofollow noreferrer\">this</a> example i tried to write a program that would return some data from a database. Unfortunately, (more-or-less) the same program structure causes memory errors here <code>err := orm.Find(&amp;sensorDataEntry)</code> according to runtime console output.</p>\n\n<p>What am i missing here? Both example and my program has the slice created using make() and uses reference in Find() method.</p>\n\n<p>Code in question:</p>\n\n<pre><code>package main\n\nimport (\n    \"fmt\"\n    \"net/http\"\n    \"time\"\n\n    \"github.com/gorilla/mux\"\n    _ \"github.com/lib/pq\"\n    //\"database/sql\"\n    \"github.com/go-xorm/xorm\"\n\n)\n\nvar orm *xorm.Engine\n\nfunc newRouter() *mux.Router {\n    r := mux.NewRouter()\n    r.HandleFunc(\"/sensorentries\", GetSensorEntriesHandler).Methods(\"GET\")\n\n    return r\n}\n\ntype SensorDataEntry struct {\n    id int `xorm:\"int\"`\n    sensor_id string `xorm:\"varchar(32)\"`\n    key string `xorm:\"varchar(128)\"`\n    value float64 `xorm:\"numeric(20,2)\"`\n    created_at time.Time `xorm:\"timestamp\"`\n}\n\nfunc main() {\n    connString := \"host=server.lan user=x password=x dbname=testdb sslmode=disable\"\n    orm, err := xorm.NewEngine(\"postgres\", connString)\n    //orm.ShowSQL(true)\n\n    if err != nil {\n        println(err)\n        return\n    }\n\n    if err = orm.Sync2(SensorDataEntry{}); err != nil {\n        return\n    }\n\n    r := newRouter()\n    http.ListenAndServe(\":8080\", r)\n}\n\nfunc GetSensorEntriesHandler(resp http.ResponseWriter, req *http.Request) {\n    sensorDataEntry := make([]SensorDataEntry, 0)\n    err := orm.Find(&amp;sensorDataEntry)\n\n    if err != nil {\n        println(err)\n    }\n\n    fmt.Println(sensorDataEntry)\n\n    fmt.Fprintf(resp, \"return text\")\n}\n</code></pre>\n"}, {"tags": ["xml", "go", "xml-parsing"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559314044, "post_id": 56396114, "comment_id": 99392955, "body": "The std lib&#39;s <code>encoding&#47;xml</code> package has no support for what you&#39;re after. You&#39;ll need to look for 3rd party packages or implement this yourself. The most you can do with the standard library is to collect unknown elements/attributes using the <code>,any</code> tag option, however then, you would have to pollute all of your structs where the unknowns can occur. E.g. <a href=\"https://play.golang.com/p/RdB9Ub8fv__Q\" rel=\"nofollow noreferrer\">play.golang.com/p/RdB9Ub8fv__Q</a>"}, {"owner": {"reputation": 768, "user_id": 1011867, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3c7d3778a88027a6e925cd4360057d48?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011867/michael"}, "reply_to_user": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 0, "creation_date": 1559395060, "post_id": 56396114, "comment_id": 99411374, "body": "It looks like I need something custom. Your solution won&#39;t work if I add an attribute: var data = []byte(`&lt;body attr=&quot;foo&quot; uattr=&quot;bar&quot; uattr2=&quot;baz&quot;&gt; \t&lt;elem&gt;abc&lt;/elem&gt; \t&lt;uelem uuattr=&quot;qwe&quot;&gt;def&lt;/uelem&gt; \t&lt;uelem2&gt;ghi&lt;/uelem2&gt; \t&lt;elem2 subattr=&quot;quux&quot; usubattr=&quot;...&quot;&gt; \t\t&lt;subelem&gt;jkl&lt;/subelem&gt; \t\t&lt;usubelem&gt;mno&lt;/usubelem&gt; \t&lt;/elem2&gt;  For the unknown elements I just need to report them in full. No processing is required. For the unknown attributes within known elements I need to report them."}], "answers": [{"tags": [], "owner": {"reputation": 1143, "user_id": 370213, "user_type": "registered", "accept_rate": 64, "profile_image": "https://i.stack.imgur.com/PH4vL.jpg?s=128&g=1", "display_name": "zhengchun", "link": "https://stackoverflow.com/users/370213/zhengchun"}, "is_accepted": false, "score": 0, "last_activity_date": 1563106225, "creation_date": 1563106225, "answer_id": 57027270, "question_id": 56396114, "link": "https://stackoverflow.com/questions/56396114/parsing-xml-report-unknown-tags-attributes/57027270#57027270", "title": "parsing XML, report unknown tags/attributes", "body": "<p>you can use <a href=\"https://github.com/antchfx/xmlquery\" rel=\"nofollow noreferrer\">xmlquery</a> to parse XML file and extract data and without defined XML data structure, it's a XPath query package.</p>\n\n<pre class=\"lang-golang prettyprint-override\"><code>f, err := os.Open(\"../books.xml\")\ndoc, err := xmlquery.Parse(f)\nlist:=xmlquery.Find(doc, \"//book//author\")\n</code></pre>\n"}], "owner": {"reputation": 768, "user_id": 1011867, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/3c7d3778a88027a6e925cd4360057d48?s=128&d=identicon&r=PG", "display_name": "Michael", "link": "https://stackoverflow.com/users/1011867/michael"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": false, "view_count": 60, "favorite_count": 0, "answer_count": 1, "score": 0, "last_activity_date": 1563106225, "creation_date": 1559309648, "last_edit_date": 1559321170, "question_id": 56396114, "link": "https://stackoverflow.com/questions/56396114/parsing-xml-report-unknown-tags-attributes", "title": "parsing XML, report unknown tags/attributes", "body": "<p>I need to parse a well-defined XML file.\nI defined structures and used</p>\n\n<p><code>err = xml.Unmarshal(byteValue, &amp;mystruct)</code></p>\n\n<p>It works well. But I need to detect unknown tags and attributes.</p>\n\n<p>When I see an unknown tag I want to report the full tag \"as-is\" back to the user. The same for unknown attribute.</p>\n\n<p>How I can do that in Go?</p>\n"}, {"tags": ["amazon-web-services", "go", "aws-sdk", "amazon-sqs", "aws-sdk-go"], "answers": [{"comments": [{"owner": {"reputation": 3511, "user_id": 428013, "user_type": "registered", "accept_rate": 85, "profile_image": "https://www.gravatar.com/avatar/b76694b0e2da86269279281888ff711c?s=128&d=identicon&r=PG", "display_name": "Steven", "link": "https://stackoverflow.com/users/428013/steven"}, "edited": false, "score": 0, "creation_date": 1616494753, "post_id": 56576659, "comment_id": 118013390, "body": "Thanks - this was a big help. I needed to make sure to have a security group which allowed ALL traffic, not just TCP, both in and out. This security group was assigned to the SQS endpoint in my vpc."}], "tags": [], "owner": {"reputation": 61, "user_id": 11641152, "user_type": "registered", "profile_image": "https://lh4.googleusercontent.com/-tlplqHdfpd0/AAAAAAAAAAI/AAAAAAAAAAA/ACHi3rebPbX5gkunIWdmTr9HCk4v2tfxvg/mo/photo.jpg?sz=128", "display_name": "Mikhailov Dmitriy", "link": "https://stackoverflow.com/users/11641152/mikhailov-dmitriy"}, "is_accepted": false, "score": 6, "last_activity_date": 1567762311, "last_edit_date": 1567762311, "creation_date": 1560415318, "answer_id": 56576659, "question_id": 56395790, "link": "https://stackoverflow.com/questions/56395790/cant-send-message-from-lambda-to-aws-sqs-and-no-error-is-returned-from-aws-sdk/56576659#56576659", "title": "Can&#39;t send message from lambda to aws sqs and no error is returned from aws-sdk", "body": "<p>I have the same issue.\nLook in CloudWatch labmda's logs. There is an error like </p>\n\n<blockquote>\n  <p>Task timed out after 10.01 seconds</p>\n</blockquote>\n\n<p>This is a lambda's timeout. You have no errors regarding sqs because timeout of lambda is smaller than default timeout of http.Client inside <code>svc.SendMessage</code> (sendMessage is just a POST request to aws api) and lambda is terminated before it gets any response from sqs. 10 seconds for lambda and 30 seconds for http request in my case. Add <code>LogLevel</code> to <code>aws.Config</code> like this:</p>\n\n<p><code>&amp;aws.Config{\n      LogLevel: aws.LogLevel(aws.LogDebug),\n}</code></p>\n\n<p>and you will see this http request in CloudWatch logs. Also you can set lambda's timeout to 2-3 times bigger than http.Client timeout and you will see retries in logs (3 retries by default). </p>\n\n<p>Looks like lambda can't resolve the host of sqs or something like this because I get the same errors when VPC is configured wrong.</p>\n\n<p><strong>UPD</strong>\nFixed the problem. If you use VPC in your lambda it should have special configuration to access to SQS from VPC. Take a look here <a href=\"https://docs.aws.amazon.com/en_us/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-sending-messages-from-vpc.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/en_us/AWSSimpleQueueService/latest/SQSDeveloperGuide/sqs-sending-messages-from-vpc.html</a></p>\n"}], "owner": {"reputation": 117, "user_id": 4129386, "user_type": "registered", "accept_rate": 38, "profile_image": "https://www.gravatar.com/avatar/2e3f2a58a1ddbed922e4076e6bddec36?s=128&d=identicon&r=PG&f=1", "display_name": "Blackout", "link": "https://stackoverflow.com/users/4129386/blackout"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 2353, "favorite_count": 1, "answer_count": 1, "score": 1, "last_activity_date": 1567762311, "creation_date": 1559308382, "last_edit_date": 1559309085, "question_id": 56395790, "link": "https://stackoverflow.com/questions/56395790/cant-send-message-from-lambda-to-aws-sqs-and-no-error-is-returned-from-aws-sdk", "title": "Can&#39;t send message from lambda to aws sqs and no error is returned from aws-sdk", "body": "<p>I am trying to send a message from my lambda function to a sqs queue that is already created. When I run the code, it literally stops the execution and no feedback is provided by aws-sdk.</p>\n\n<p>I also have a function to read from the queue when I insert the messages manually, I use the same code to create the session. Which I believe can be used on both situations.</p>\n\n<p>Then I tried to use the code provided by amazon but the outcome was the same.\n<a href=\"https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/sqs-example-receive-message.html\" rel=\"nofollow noreferrer\">https://docs.aws.amazon.com/sdk-for-go/v1/developer-guide/sqs-example-receive-message.html</a></p>\n\n<p>The only difference on my code is how I create the session. Like I mentioned above, that's the same way I use to read messages when they are inserted manually in the queue. On that function everything seems perfect.</p>\n\n<pre><code>func sendToOrderQueue(rID string, c Course) error {                            \n  log.Println(1)\n   var err error                                                                    \n   sess := session.Must(session.New(&amp;aws.Config{\n      Region: aws.String(\"eu-central-1\"),                                                                        \n   }), err)                                            \n   svc := sqs.New(sess)                                                              \n   log.Println(2)                                                                    \n\n   url := \"https://sqs.eu-central-1.amazonaws.com/XXXXXX/myqueue\"              \n\n   log.Println(3)                                                                         \n   result, err := svc.SendMessage(&amp;sqs.SendMessageInput{                            \n     DelaySeconds: aws.Int64(10),                                                    \n     MessageAttributes: map[string]*sqs.MessageAttributeValue{                      \n       \"Title\": &amp;sqs.MessageAttributeValue{                                          \n         DataType:    aws.String(\"String\"),                                          \n         StringValue: aws.String(\"The Whistler\"),                                    \n       },                                                                            \n       \"Author\": &amp;sqs.MessageAttributeValue{                                        \n         DataType:    aws.String(\"String\"),                                          \n         StringValue: aws.String(\"John Grisham\"),                                    \n       },                                                                            \n       \"WeeksOn\": &amp;sqs.MessageAttributeValue{                                        \n         DataType:    aws.String(\"Number\"),                                          \n         StringValue: aws.String(\"6\"),                                              \n       },                                                                            \n     },                                                                              \n     MessageBody: aws.String(\"Information about current NY Times fiction bestseller for week of 12/11/2016.\"),    \n     QueueUrl:    &amp;url,                                                              \n   })\n    log.Println(4)\n\n   if err != nil {                                                              \n     log.Println(\"Error\", err)                                                  \n      return err                                                                  \n    }                                                                            \n\n   log.Println(5, *result.MessageId, err)                                        \n   return err                                                                    \n  }\n</code></pre>\n\n<p>Also, my serverless.yaml</p>\n\n<pre><code>service: client                                                          \n  frameworkVersion: \"&gt;=1.28.0 &lt;2.0.0\"                                            \n\n  provider:                                                                      \n    name: aws                                                                    \n    runtime: go1.x                                                                \n    vpc: ${file(../security.yaml):vpc}                                            \n\n  package:                                                                        \n   exclude:                                                                      \n     - ./**                                                                      \n   include:                                                                      \n     - ./bin/**                                                                  \n\n  functions:\n   postFunction:                                                    \n    handler: bin/post                                                        \n    environment:                                                                  \n      REDIS_URL: ${file(../env.yaml):environment.REDIS_URL}                      \n      HASH_KEY: ${file(../env.yaml):environment.HASH_KEY}\n    events:                                                                      \n     - http:                                                                      \n        path: /func                                                            \n        method: post                                                              \n        cors: ${file(../cors.yaml):cors}\n</code></pre>\n\n<p>Checking the cloudwatch's logs the execution <strong>prints</strong> <em>1</em>, <em>2</em>, <em>3</em> and nothing else. <strong>No</strong> <em>4</em>, <strong>no</strong> <em>Error</em> and <strong>no</strong> <em>5</em>.</p>\n\n<p>What am I doing wrong here?</p>\n"}, {"tags": ["loops", "go", "iterator", "slice"], "answers": [{"comments": [{"owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 0, "creation_date": 1559317287, "post_id": 56394697, "comment_id": 99394650, "body": "thanks for the overview and the external resources, I still don&#39;t get why I am not able to &quot;remove&quot; the last item (&quot;duplicated&quot;) when shrinking the original input slice provided as a pointer. I&#39;ve updated the original question with more code. Thanks"}, {"owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "reply_to_user": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "edited": false, "score": 1, "creation_date": 1559322836, "post_id": 56394697, "comment_id": 99396919, "body": "@tppz Because you dereference the pointer: <code>pointedInSl := *inSl</code> which makes a copy, and you only assign to this copy. Before returning be sure to assign the new slice to the <i>pointed</i> value like this: <code>*inSl = pointedInSl</code>."}], "tags": [], "owner": {"reputation": 284620, "user_id": 1705598, "user_type": "registered", "accept_rate": 92, "profile_image": "https://i.stack.imgur.com/aTFoe.jpg?s=128&g=1", "display_name": "icza", "link": "https://stackoverflow.com/users/1705598/icza"}, "is_accepted": false, "score": 4, "last_activity_date": 1559852806, "last_edit_date": 1559852806, "creation_date": 1559303926, "answer_id": 56394697, "question_id": 56394632, "link": "https://stackoverflow.com/questions/56394632/remove-from-slice-inplace-in-golang/56394697#56394697", "title": "Remove from slice inplace in Golang", "body": "<p>When you have a variable of <code>int</code> type, and you want to write a function that increments its value, how do you do it? You either pass a pointer to the variable, or you return the incremented value which you have to assign to the original variable.</p>\n\n<p>For example (try it on the <a href=\"https://play.golang.org/p/O9pD2SfUFM0\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func inc(i int) int { i++; return i }\n\nvar i int = 2\ninc(i)\nfmt.Println(i) // This will be 2\n</code></pre>\n\n<p>In the above code you pass <code>i</code> to <code>inc()</code> which increments it and returns its value. The original <code>i</code> of course will not change, <code>i</code> inside <code>inc()</code> is just a copy, independent form the original <code>i</code>. For the original to change, you would have to assing the return value:</p>\n\n<pre><code>i = inc(i)\n</code></pre>\n\n<p>Or use pointers in the first place (try it on the <a href=\"https://play.golang.org/p/uqIEb_id_Jh\" rel=\"nofollow noreferrer\">Go Playground</a>):</p>\n\n<pre><code>func inc(i *int) { *i++ }\n\nvar i int = 2\ninc(&amp;i)\nfmt.Println(i) // This will be 3\n</code></pre>\n\n<p>The same thing goes with slices. If you want / have to modify the slice header (which is a data pointer, length and capacity, see <a href=\"https://golang.org/pkg/reflect/#SliceHeader\" rel=\"nofollow noreferrer\"><code>reflect.SliceHeader</code></a>), you either have to pass a pointer to that slice (not very common), or you have to return the modified, new slice header which you have to assign at the caller. This is the solution used more often, this is the approach the builtin <a href=\"https://golang.org/pkg/builtin/#append\" rel=\"nofollow noreferrer\"><code>append()</code></a> follows too.</p>\n\n<p>When you slice a slice, (e.g. <code>someslice[min:max]</code>), the new slice will share the backing array with the original one. Which means if you modify the <em>elements</em> of the new slice, the original will also observe those changes. So if you remove an element from the new slice and you copy the elements to the place of the removed element, the last element of the original slice will still be there, which is \"covered\" by the original slice. Usual practice is to zero the last element so the garbage collector can reclaim its memory should it be a pointer type (or \"similar\" like a slice, map or channel). For details, see <a href=\"https://stackoverflow.com/questions/55045402/memory-leak-in-golang-slice/55046506#55046506\">Memory leak in golang slice</a> and <a href=\"https://stackoverflow.com/questions/28432658/does-go-garbage-collect-parts-of-slices/28432812#28432812\">Does go garbage collect parts of slices?</a></p>\n\n<p><strong>To answer you questions directly:</strong></p>\n\n<blockquote>\n  <ul>\n  <li>how can I avoid to have an \"output slice\"? (which is printed in the correct way, containing the right elements, having the expected length and capacity)</li>\n  </ul>\n</blockquote>\n\n<p>As stated in this answer: you would have to pass a pointer to your slice, and modify the pointed value in <code>FindAndRemoveFromFooSlice()</code>, and so you don't have to return the new slice.</p>\n\n<blockquote>\n  <ul>\n  <li>why my attempt at \"removing inplace\" leads to having the \"input slice\" with the same length as it had before the filtering process?</li>\n  </ul>\n</blockquote>\n\n<p>You never modified the original slice, you passed it so a copy is made, and inside <code>FindAndRemoveFromFooSlice()</code> you can only modify the copy (but you didn't even modify the copy). You return a new slice, but you didn't assign it, so the original slice (header) is intact.</p>\n\n<blockquote>\n  <ul>\n  <li>why the \"input slice\" has the same length as before I was applying the filtering process? How can I make the remove operation to change the length of the \"input slice\"?</li>\n  </ul>\n</blockquote>\n\n<p>This is answered by the previous 2 questions.</p>\n\n<p><strong>See related questions:</strong></p>\n\n<p><a href=\"https://stackoverflow.com/questions/39993688/are-golang-slices-pass-by-value/39993797#39993797\">Are golang slices pass by value?</a></p>\n\n<p><a href=\"https://stackoverflow.com/questions/47590444/slice-vs-map-to-be-used-in-parameter/47590531#47590531\">slice vs map to be used in parameter</a></p>\n"}, {"tags": [], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "is_accepted": true, "score": 0, "last_activity_date": 1559639321, "creation_date": 1559639321, "answer_id": 56440800, "question_id": 56394632, "link": "https://stackoverflow.com/questions/56394632/remove-from-slice-inplace-in-golang/56440800#56440800", "title": "Remove from slice inplace in Golang", "body": "<p>I suggested an edit of icza answer to provide at its bottom a minimum working code example for the useful information he gave. It was rejected stating that it makes no sense as an edit and that it should have been written as a comment or an answer, so here it is (the credit goes mostly to icza):</p>\n\n<p>Minimum Working Code Example (with comments to give some context):</p>\n\n<pre><code>// use a pointer for the input slice so then it is changed in-place\nfunc FindAndRemoveFromFooSliceInPlace(iFilter int, inSl *[]FooItem) *FooItem {\n    pointedInSl := *inSl // dereference the pointer so then we can use `append`\n    inLen := len(pointedInSl)\n    for idx, elem := range pointedInSl {\n        if elem.Id == iFilter {\n            log.Printf(\"Loop ID %v\", idx)\n\n            // check these docs: https://github.com/golang/go/wiki/SliceTricks#delete\n            pointedInSl = append(pointedInSl[:idx], pointedInSl[idx+1:inLen]...)\n            pointedInSl = pointedInSl[:inLen-1]\n            *inSl = pointedInSl // assigning the new slice to the pointed value before returning\n\n            return &amp;elem\n        }\n    }\n    return nil\n}\n</code></pre>\n"}], "owner": {"reputation": 3020, "user_id": 1264920, "user_type": "registered", "accept_rate": 84, "profile_image": "https://www.gravatar.com/avatar/6401cada72e3e86775c409db49e6befb?s=128&d=identicon&r=PG", "display_name": "TPPZ", "link": "https://stackoverflow.com/users/1264920/tppz"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 694, "favorite_count": 0, "accepted_answer_id": 56440800, "answer_count": 2, "score": 1, "last_activity_date": 1559852806, "creation_date": 1559303669, "last_edit_date": 1559317198, "question_id": 56394632, "link": "https://stackoverflow.com/questions/56394632/remove-from-slice-inplace-in-golang", "title": "Remove from slice inplace in Golang", "body": "<p>I have the following test that is printing the original input slice (after the filtering) without the element that has been removed, but with an extra element at the end making the input slice of the same length, even if after the filtering it should be shorter.</p>\n\n<p>I've gone through this doc <a href=\"https://github.com/golang/go/wiki/SliceTricks#delete\" rel=\"nofollow noreferrer\">https://github.com/golang/go/wiki/SliceTricks#delete</a>\nHowever I think I am missing some gotchas about Go, because it seems I am using slices with the wrong approach.</p>\n\n<ul>\n<li>how can I avoid to have an \"output slice\"? (which is printed in the correct way, containing the right elements, having the expected length and capacity)</li>\n<li>why my attempt at \"removing inplace\" leads to having the \"input slice\" with the same length as it had before the filtering process? </li>\n<li>why the \"input slice\" has the same length as before I was applying the filtering process? How can I make the remove operation to change the length of the \"input slice\"?</li>\n</ul>\n\n<p>This is the code:</p>\n\n<pre><code>package foo\n\nimport (\n    \"fmt\"\n    \"log\"\n    \"math/rand\"\n    \"testing\"\n)\n\ntype FooItem struct {\n    Id       int\n    Category string\n    Value    float64\n}\n\nconst minRand = 0\nconst maxRand = 10\n\nconst maxSliceLen = 3\n\nvar inFooSlice []FooItem\n\nfunc init() {\n    for i := 1; i &lt;= maxSliceLen; i++ {\n        inFooSlice = append(inFooSlice, FooItem{\n            Id:       i,\n            Category: \"FooCat\",\n            Value:    minRand + rand.Float64()*(maxRand-minRand),\n        })\n    }\n}\n\n// this is the function I am testing\nfunc FindAndRemoveFromFooSlice(iFilter int, inSl []FooItem) (*FooItem, []FooItem) {\n\n    inLen := len(inSl)\n    outSl := make([]FooItem, inLen)\n\n    for idx, elem := range inSl {\n        if elem.Id == iFilter {\n            log.Printf(\"Loop ID %v\", idx)\n\n            // check these docs: https://github.com/golang/go/wiki/SliceTricks#delete\n            outSl = inSl[:idx+copy(inSl[idx:], inSl[idx+1:inLen])]\n            outSl = outSl[:inLen-1]\n\n            return &amp;elem, outSl\n        }\n    }\n    return nil, nil\n}\n\nfunc TestFoo(t *testing.T) {\n    fmt.Printf(\"\\nOriginal (PRE) slice\\n\")\n    fmt.Println(inFooSlice)\n    fmt.Println(len(inFooSlice))\n    fmt.Println(cap(inFooSlice))\n\n    idFilter := 1\n\n    fePtr, outFooSlice := FindAndRemoveFromFooSlice(idFilter, inFooSlice)\n\n    fmt.Printf(\"\\nOriginal (POST) slice\\n\")\n    fmt.Println(inFooSlice)\n    fmt.Println(len(inFooSlice))\n    fmt.Println(cap(inFooSlice))\n\n    fmt.Printf(\"\\nFiltered element\\n\")\n    fmt.Println(*fePtr)\n\n    fmt.Printf(\"\\nOutput slice\\n\")\n    fmt.Println(outFooSlice)\n    fmt.Println(len(outFooSlice))\n    fmt.Println(cap(outFooSlice))\n}\n</code></pre>\n\n<p>This is the output of the test execution:</p>\n\n<pre><code>$ go test -v -run TestFoo\n=== RUN   TestFoo\n\nOriginal (PRE) slice\n[{1 FooCat 6.046602879796196} {2 FooCat 9.405090880450125} {3 FooCat 6.645600532184904}]\n3\n4\n2019/05/31 12:53:30 Loop ID 0\n\nOriginal (POST) slice\n[{2 FooCat 9.405090880450125} {3 FooCat 6.645600532184904} {3 FooCat 6.645600532184904}]\n3\n4\n\nFiltered element\n{1 FooCat 6.046602879796196}\n\nOutput slice\n[{2 FooCat 9.405090880450125} {3 FooCat 6.645600532184904}]\n2\n4\n--- PASS: TestFoo (0.00s)\nPASS\nok      git.openenergi.net/scm/flex/service/common  0.008s\n</code></pre>\n\n<p><strong>Update on the \"input slice as pointer\"</strong></p>\n\n<p>OK, so assuming I would like to deal with the original input slice, i.e. no copy or output slice.</p>\n\n<ul>\n<li>Why the following code throws a runtime panic in the commented line of code? (<code>pointedInSl[inLen-1] = FooItem{}</code>)</li>\n<li>Why the printed slice (after applying the function) contains 2 identical itmes at the end of it? How con I remove the last redundant element?</li>\n<li>Why the length of the slice after applying the function is still the same as the one of the slice before applying the function?</li>\n<li>How can I make the original slice shrink of 1 (i.e. being of output length = original length - 1)?</li>\n</ul>\n\n<p>This is the code:</p>\n\n<pre><code>func FindAndRemoveFromFooSliceInPlace(iFilter int, inSl *[]FooItem) *FooItem {\n    pointedInSl := *inSl\n    inLen := len(pointedInSl)\n    for idx, elem := range pointedInSl {\n        if elem.Id == iFilter {\n            log.Printf(\"Loop ID %v\", idx)\n\n            // check these docs: https://github.com/golang/go/wiki/SliceTricks#delete\n            pointedInSl = append(pointedInSl[:idx], pointedInSl[idx+1:inLen]...)\n            // pointedInSl[inLen-1] = FooItem{} // why this throws a runtime \"panic: runtime error: index out of range\" ???\n            pointedInSl = pointedInSl[:inLen-1]\n\n            return &amp;elem\n        }\n    }\n    return nil\n}\n\nfunc TestFooInPlace(t *testing.T) {\n    fmt.Printf(\"\\nOriginal (PRE) slice\\n\")\n    fmt.Println(inFooSlice)\n    fmt.Println(len(inFooSlice))\n    fmt.Println(cap(inFooSlice))\n\n    idFilter := 1\n\n    fePtr := FindAndRemoveFromFooSliceInPlace(idFilter, &amp;inFooSlice)\n\n    fmt.Printf(\"\\nOriginal (POST) slice\\n\")\n    fmt.Println(inFooSlice)\n    fmt.Println(len(inFooSlice))\n    fmt.Println(cap(inFooSlice))\n\n    fmt.Printf(\"\\nFiltered element\\n\")\n    fmt.Println(*fePtr)\n}\n</code></pre>\n\n<p>This is the weird output:</p>\n\n<pre><code>$ go test -v -run TestFooInPlace\n=== RUN   TestFooInPlace\n\nOriginal (PRE) slice\n[{1 FooCat 6.046602879796196} {2 FooCat 9.405090880450125} {3 FooCat 6.645600532184904}]\n3\n4\n2019/05/31 16:32:38 Loop ID 0\n\nOriginal (POST) slice\n[{2 FooCat 9.405090880450125} {3 FooCat 6.645600532184904} {3 FooCat 6.645600532184904}]\n3\n4\n\nFiltered element\n{1 FooCat 6.046602879796196}\n--- PASS: TestFooInPlace (0.00s)\nPASS\nok      git.openenergi.net/scm/flex/service/common  0.007s\n</code></pre>\n"}, {"tags": ["go"], "comments": [{"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 2, "creation_date": 1559304592, "post_id": 56394456, "comment_id": 99388129, "body": "If you can use <code>json.Number</code> <a href=\"https://play.golang.com/p/J1wtELaHEI7\" rel=\"nofollow noreferrer\">play.golang.com/p/J1wtELaHEI7</a>"}, {"owner": {"reputation": 18601, "user_id": 965900, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/5KqAT.png?s=128&g=1", "display_name": "mkopriva", "link": "https://stackoverflow.com/users/965900/mkopriva"}, "edited": false, "score": 1, "creation_date": 1559306607, "post_id": 56394456, "comment_id": 99389175, "body": "If you can&#39;t, or don&#39;t want to, change the type of the struct field, you can do something like this: <a href=\"https://play.golang.com/p/attt6yLBzt8\" rel=\"nofollow noreferrer\">play.golang.com/p/attt6yLBzt8</a>"}], "answers": [{"tags": [], "owner": {"reputation": 442, "user_id": 9429150, "user_type": "registered", "profile_image": "https://i.stack.imgur.com/nkBiN.jpg?s=128&g=1", "display_name": "sHartmann", "link": "https://stackoverflow.com/users/9429150/shartmann"}, "is_accepted": false, "score": 2, "last_activity_date": 1559304711, "last_edit_date": 1559304711, "creation_date": 1559303591, "answer_id": 56394616, "question_id": 56394456, "link": "https://stackoverflow.com/questions/56394456/unmarshal-json-field-is-int-or-string/56394616#56394616", "title": "unmarshal json field is int or string", "body": "<p>Check out <a href=\"https://golang.org/pkg/encoding/json/#RawMessage\" rel=\"nofollow noreferrer\">\"json - raw Message\"</a> in the docs, from there on out you can try to parse it however you want. Example below and on <a href=\"https://play.golang.org/p/f-wJWjcDVxv\" rel=\"nofollow noreferrer\">GoPlayground</a></p>\n\n<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"log\"\n    \"strconv\"\n    \"unicode/utf8\"\n)\n\ntype Person struct {\n    Name string          `json:\"name\"`\n    Age  json.RawMessage `json:\"age\"`\n}\n\nfunc main() {\n    var j = []byte(`{\"name\": \"Joe\",\"age\": \"42\"}`)\n    var j2 = []byte(`{\"name\": \"Joe\",\"age\": 42}`)\n    stringOrInt(j)\n    stringOrInt(j2)\n}\n\nfunc stringOrInt(bytes []byte) {\n    var p Person\n    err := json.Unmarshal(bytes, &amp;p)\n    if err != nil {\n        log.Fatal(err)\n    }\n\n    if utf8.Valid(p.Age) {\n        i, err := strconv.Atoi(string(p.Age))\n        if err != nil {\n            fmt.Println(\"got int \" + strconv.Itoa(i))\n        } else {\n            fmt.Println(\"got string\")\n        }\n    } else {\n        fmt.Println(\"whoops\")\n    }\n}\n\n</code></pre>\n"}, {"tags": [], "owner": {"reputation": 2907, "user_id": 3968921, "user_type": "registered", "accept_rate": 43, "profile_image": "https://www.gravatar.com/avatar/9d5c954a2cee47c08a8ead21e79e24ab?s=128&d=identicon&r=PG&f=1", "display_name": "Ankit Deshpande", "link": "https://stackoverflow.com/users/3968921/ankit-deshpande"}, "is_accepted": true, "score": 1, "last_activity_date": 1559304036, "creation_date": 1559304036, "answer_id": 56394726, "question_id": 56394456, "link": "https://stackoverflow.com/questions/56394456/unmarshal-json-field-is-int-or-string/56394726#56394726", "title": "unmarshal json field is int or string", "body": "<pre><code>package main\n\nimport (\n    \"encoding/json\"\n    \"fmt\"\n    \"strconv\"\n)\n\ntype Person struct {\n    Name string `json:\"name\"`\n    Age  int    `json:\"age\"`\n}\n\nfunc (p *Person) UnmarshalJSON(b []byte) error {\n    var objMap map[string]*json.RawMessage\n    err := json.Unmarshal(b, &amp;objMap)\n    if err != nil {\n        return err\n    }\n\n    var name string\n    err = json.Unmarshal(*objMap[\"name\"], &amp;name)\n    if err != nil {\n        return err\n    }\n\n    var ageInt int\n    err = json.Unmarshal(*objMap[\"age\"], &amp;ageInt)\n    if err != nil {\n        // age  is string\n        var ageString string\n        err = json.Unmarshal(*objMap[\"age\"], &amp;ageString)\n        if err != nil {\n            return err\n        }\n        aI, err := strconv.Atoi(ageString)\n        if err != nil {\n            return err\n        }\n        p.Age = aI\n\n    } else {\n        p.Age = ageInt\n    }\n\n    p.Name = name\n\n    fmt.Printf(\"%+v\", *p)\n\n    return nil\n}\n\nfunc main() {\n    p := `{\"name\": \"John\", \"age\": \"10\"}`\n    //  p := `{\"name\": \"John\", \"age\": 10}`\n\n\n    newP := Person{}\n    err := newP.UnmarshalJSON([]byte(p))\n    if err != nil {\n        fmt.Printf(\"Error %+v\", err)\n    }\n\n}\n</code></pre>\n\n<p><a href=\"https://play.golang.org/p/AK8H_wdNqmt\" rel=\"nofollow noreferrer\">https://play.golang.org/p/AK8H_wdNqmt</a></p>\n\n<p>You can try something like this. Try to read and parse Into int, if that fails check for string value, parse it to int and then assign int value to person struct</p>\n"}], "owner": {"reputation": 970, "user_id": 1445634, "user_type": "registered", "accept_rate": 64, "profile_image": "https://www.gravatar.com/avatar/bd53d00d28f28bdec62ebb162db7b688?s=128&d=identicon&r=PG", "display_name": "MichaelB", "link": "https://stackoverflow.com/users/1445634/michaelb"}, "delete_vote_count": 0, "reopen_vote_count": 0, "close_vote_count": 0, "is_answered": true, "view_count": 1640, "favorite_count": 1, "closed_date": 1559312084, "accepted_answer_id": 56394726, "answer_count": 2, "score": 1, "last_activity_date": 1559321184, "creation_date": 1559302919, "last_edit_date": 1559321184, "question_id": 56394456, "link": "https://stackoverflow.com/questions/56394456/unmarshal-json-field-is-int-or-string", "closed_reason": "Duplicate", "title": "unmarshal json field is int or string", "body": "<p>I have an app where the type is</p>\n\n<pre><code>type Person struct {\n  Name string `json:\"name\"`\n  Age  int    `json:\"age\"`\n}\n</code></pre>\n\n<p>But we have legacy clients that send the <code>Age</code> field as either a string or an integer, so...</p>\n\n<pre><code>{\n  \"name\": \"Joe\",\n  \"age\": \"42\"\n}\n</code></pre>\n\n<p>OR</p>\n\n<pre><code>{\n  \"name\": \"Joe\",\n  \"age\": 42\n}\n</code></pre>\n\n<p>I know I can annotate the \"age\" field with \",string\" if it's a string that I want coerced into an integer, but what if the field could be either one?</p>\n"}]